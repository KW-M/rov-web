var fc=Object.defineProperty;var dc=(e,t,n)=>t in e?fc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var F=(e,t,n)=>(dc(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function he(){}const Gt=e=>e;function B(e,t){for(const n in t)e[n]=t[n];return e}function ca(e){return e()}function Ro(){return Object.create(null)}function z(e){e.forEach(ca)}function Y(e){return typeof e=="function"}function Te(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function pc(e){return Object.keys(e).length===0}function ua(e,...t){if(e==null)return he;const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function lt(e){let t;return ua(e,n=>t=n)(),t}function ut(e,t,n){e.$$.on_destroy.push(ua(t,n))}function V(e,t,n,r){if(e){const i=fa(e,t,n,r);return e[0](i)}}function fa(e,t,n,r){return e[1]&&r?B(n.ctx.slice(),e[1](r(t))):n.ctx}function W(e,t,n,r){if(e[2]&&r){const i=e[2](r(n));if(t.dirty===void 0)return i;if(typeof i=="object"){const o=[],l=Math.max(t.dirty.length,i.length);for(let c=0;c<l;c+=1)o[c]=t.dirty[c]|i[c];return o}return t.dirty|i}return t.dirty}function q(e,t,n,r,i,o){if(i){const l=fa(t,n,r,o);e.p(l,i)}}function J(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let r=0;r<n;r++)t[r]=-1;return t}return-1}function fn(e){const t={};for(const n in e)n[0]!=="$"&&(t[n]=e[n]);return t}function Xe(e,t){const n={};t=new Set(t);for(const r in e)!t.has(r)&&r[0]!=="$"&&(n[r]=e[r]);return n}function Po(e){return e==null?"":e}function D(e){return e&&Y(e.destroy)?e.destroy:he}const da=typeof window<"u";let Zn=da?()=>window.performance.now():()=>Date.now(),eo=da?e=>requestAnimationFrame(e):he;const Xt=new Set;function pa(e){Xt.forEach(t=>{t.c(e)||(Xt.delete(t),t.f())}),Xt.size!==0&&eo(pa)}function er(e){let t;return Xt.size===0&&eo(pa),{promise:new Promise(n=>{Xt.add(t={c:e,f:n})}),abort(){Xt.delete(t)}}}function ot(e,t){e.appendChild(t)}function ha(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function hc(e){const t=N("style");return mc(ha(e),t),t.sheet}function mc(e,t){return ot(e.head||e,t),t.sheet}function O(e,t,n){e.insertBefore(t,n||null)}function k(e){e.parentNode.removeChild(e)}function gc(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function N(e){return document.createElement(e)}function vc(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function ft(e){return document.createTextNode(e)}function ke(){return ft(" ")}function dn(){return ft("")}function Se(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function yc(e){return function(t){return t.preventDefault(),e.call(this,t)}}function _c(e){return function(t){return t.stopPropagation(),e.call(this,t)}}function K(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function A(e,t){const n=Object.getOwnPropertyDescriptors(e.__proto__);for(const r in t)t[r]==null?e.removeAttribute(r):r==="style"?e.style.cssText=t[r]:r==="__value"?e.value=e[r]=t[r]:n[r]&&n[r].set?e[r]=t[r]:K(e,r,t[r])}function bc(e){return Array.from(e.childNodes)}function to(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function Oo(e,t){e.value=t==null?"":t}function lr(e,t,n){e.classList[n?"add":"remove"](t)}function ma(e,t,{bubbles:n=!1,cancelable:r=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(e,n,r,t),i}class Cc{constructor(t=!1){this.is_svg=!1,this.is_svg=t,this.e=this.n=null}c(t){this.h(t)}m(t,n,r=null){this.e||(this.is_svg?this.e=vc(n.nodeName):this.e=N(n.nodeName),this.t=n,this.c(t)),this.i(r)}h(t){this.e.innerHTML=t,this.n=Array.from(this.e.childNodes)}i(t){for(let n=0;n<this.n.length;n+=1)O(this.t,this.n[n],t)}p(t){this.d(),this.h(t),this.i(this.a)}d(){this.n.forEach(k)}}const Lr=new Map;let Nr=0;function Sc(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}function Tc(e,t){const n={stylesheet:hc(t),rules:{}};return Lr.set(e,n),n}function zn(e,t,n,r,i,o,l,c=0){const s=16.666/r;let u=`{
`;for(let m=0;m<=1;m+=s){const v=t+(n-t)*o(m);u+=m*100+`%{${l(v,1-v)}}
`}const f=u+`100% {${l(n,1-n)}}
}`,a=`__svelte_${Sc(f)}_${c}`,d=ha(e),{stylesheet:p,rules:h}=Lr.get(d)||Tc(d,e);h[a]||(h[a]=!0,p.insertRule(`@keyframes ${a} ${f}`,p.cssRules.length));const g=e.style.animation||"";return e.style.animation=`${g?`${g}, `:""}${a} ${r}ms linear ${i}ms 1 both`,Nr+=1,a}function Hn(e,t){const n=(e.style.animation||"").split(", "),r=n.filter(t?o=>o.indexOf(t)<0:o=>o.indexOf("__svelte")===-1),i=n.length-r.length;i&&(e.style.animation=r.join(", "),Nr-=i,Nr||Ec())}function Ec(){eo(()=>{Nr||(Lr.forEach(e=>{const{ownerNode:t}=e.stylesheet;t&&k(t)}),Lr.clear())})}function kc(e,t,n,r){if(!t)return he;const i=e.getBoundingClientRect();if(t.left===i.left&&t.right===i.right&&t.top===i.top&&t.bottom===i.bottom)return he;const{delay:o=0,duration:l=300,easing:c=Gt,start:s=Zn()+o,end:u=s+l,tick:f=he,css:a}=n(e,{from:t,to:i},r);let d=!0,p=!1,h;function g(){a&&(h=zn(e,0,1,l,o,c,a)),o||(p=!0)}function m(){a&&Hn(e,h),d=!1}return er(v=>{if(!p&&v>=s&&(p=!0),p&&v>=u&&(f(1,0),m()),!d)return!1;if(p){const y=v-s,b=0+1*c(y/l);f(b,1-b)}return!0}),g(),f(0,1),m}function Rc(e){const t=getComputedStyle(e);if(t.position!=="absolute"&&t.position!=="fixed"){const{width:n,height:r}=t,i=e.getBoundingClientRect();e.style.position="absolute",e.style.width=n,e.style.height=r,ga(e,i)}}function ga(e,t){const n=e.getBoundingClientRect();if(t.left!==n.left||t.top!==n.top){const r=getComputedStyle(e),i=r.transform==="none"?"":r.transform;e.style.transform=`${i} translate(${t.left-n.left}px, ${t.top-n.top}px)`}}let $n;function Nn(e){$n=e}function ht(){if(!$n)throw new Error("Function called outside component initialization");return $n}function tr(e){ht().$$.on_mount.push(e)}function Mt(e){ht().$$.on_destroy.push(e)}function nr(){const e=ht();return(t,n,{cancelable:r=!1}={})=>{const i=e.$$.callbacks[t];if(i){const o=ma(t,n,{cancelable:r});return i.slice().forEach(l=>{l.call(e,o)}),!o.defaultPrevented}return!0}}function rr(e,t){return ht().$$.context.set(e,t),t}function pn(e){return ht().$$.context.get(e)}function Pc(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(r=>r.call(this,t))}const Tn=[],U=[],Tr=[],gi=[],va=Promise.resolve();let vi=!1;function ya(){vi||(vi=!0,va.then(_a))}function no(){return ya(),va}function _t(e){Tr.push(e)}function dt(e){gi.push(e)}const oi=new Set;let cr=0;function _a(){const e=$n;do{for(;cr<Tn.length;){const t=Tn[cr];cr++,Nn(t),Oc(t.$$)}for(Nn(null),Tn.length=0,cr=0;U.length;)U.pop()();for(let t=0;t<Tr.length;t+=1){const n=Tr[t];oi.has(n)||(oi.add(n),n())}Tr.length=0}while(Tn.length);for(;gi.length;)gi.pop()();vi=!1,oi.clear(),Nn(e)}function Oc(e){if(e.fragment!==null){e.update(),z(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(_t)}}let yn;function ro(){return yn||(yn=Promise.resolve(),yn.then(()=>{yn=null})),yn}function Lt(e,t,n){e.dispatchEvent(ma(`${t?"intro":"outro"}${n}`))}const Er=new Set;let st;function xt(){st={r:0,c:[],p:st}}function Ut(){st.r||z(st.c),st=st.p}function S(e,t){e&&e.i&&(Er.delete(e),e.i(t))}function E(e,t,n,r){if(e&&e.o){if(Er.has(e))return;Er.add(e),st.c.push(()=>{Er.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}else r&&r()}const io={duration:0};function wc(e,t,n){let r=t(e,n),i=!1,o,l,c=0;function s(){o&&Hn(e,o)}function u(){const{delay:a=0,duration:d=300,easing:p=Gt,tick:h=he,css:g}=r||io;g&&(o=zn(e,0,1,d,a,p,g,c++)),h(0,1);const m=Zn()+a,v=m+d;l&&l.abort(),i=!0,_t(()=>Lt(e,!0,"start")),l=er(y=>{if(i){if(y>=v)return h(1,0),Lt(e,!0,"end"),s(),i=!1;if(y>=m){const b=p((y-m)/d);h(b,1-b)}}return i})}let f=!1;return{start(){f||(f=!0,Hn(e),Y(r)?(r=r(),ro().then(u)):u())},invalidate(){f=!1},end(){i&&(s(),i=!1)}}}function Dc(e,t,n){let r=t(e,n),i=!0,o;const l=st;l.r+=1;function c(){const{delay:s=0,duration:u=300,easing:f=Gt,tick:a=he,css:d}=r||io;d&&(o=zn(e,1,0,u,s,f,d));const p=Zn()+s,h=p+u;_t(()=>Lt(e,!1,"start")),er(g=>{if(i){if(g>=h)return a(0,1),Lt(e,!1,"end"),--l.r||z(l.c),!1;if(g>=p){const m=f((g-p)/u);a(1-m,m)}}return i})}return Y(r)?ro().then(()=>{r=r(),c()}):c(),{end(s){s&&r.tick&&r.tick(1,0),i&&(o&&Hn(e,o),i=!1)}}}function ur(e,t,n,r){let i=t(e,n),o=r?0:1,l=null,c=null,s=null;function u(){s&&Hn(e,s)}function f(d,p){const h=d.b-o;return p*=Math.abs(h),{a:o,b:d.b,d:h,duration:p,start:d.start,end:d.start+p,group:d.group}}function a(d){const{delay:p=0,duration:h=300,easing:g=Gt,tick:m=he,css:v}=i||io,y={start:Zn()+p,b:d};d||(y.group=st,st.r+=1),l||c?c=y:(v&&(u(),s=zn(e,o,d,h,p,g,v)),d&&m(0,1),l=f(y,h),_t(()=>Lt(e,d,"start")),er(b=>{if(c&&b>c.start&&(l=f(c,h),c=null,Lt(e,l.b,"start"),v&&(u(),s=zn(e,o,l.b,l.duration,0,g,i.css))),l){if(b>=l.end)m(o=l.b,1-o),Lt(e,l.b,"end"),c||(l.b?u():--l.group.r||z(l.group.c)),l=null;else if(b>=l.start){const P=b-l.start;o=l.a+l.d*g(P/l.duration),m(o,1-o)}}return!!(l||c)}))}return{run(d){Y(i)?ro().then(()=>{i=i(),a(d)}):a(d)},end(){u(),l=c=null}}}const ba=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Ac(e,t){E(e,1,1,()=>{t.delete(e.key)})}function Ic(e,t){e.f(),Ac(e,t)}function Mc(e,t,n,r,i,o,l,c,s,u,f,a){let d=e.length,p=o.length,h=d;const g={};for(;h--;)g[e[h].key]=h;const m=[],v=new Map,y=new Map;for(h=p;h--;){const w=a(i,o,h),R=n(w);let I=l.get(R);I?r&&I.p(w,t):(I=u(R,w),I.c()),v.set(R,m[h]=I),R in g&&y.set(R,Math.abs(h-g[R]))}const b=new Set,P=new Set;function T(w){S(w,1),w.m(c,f),l.set(w.key,w),f=w.first,p--}for(;d&&p;){const w=m[p-1],R=e[d-1],I=w.key,j=R.key;w===R?(f=w.first,d--,p--):v.has(j)?!l.has(I)||b.has(I)?T(w):P.has(j)?d--:y.get(I)>y.get(j)?(P.add(I),T(w)):(b.add(j),d--):(s(R,l),d--)}for(;d--;){const w=e[d];v.has(w.key)||s(w,l)}for(;p;)T(m[p-1]);return m}function X(e,t){const n={},r={},i={$$scope:1};let o=e.length;for(;o--;){const l=e[o],c=t[o];if(c){for(const s in l)s in c||(r[s]=1);for(const s in c)i[s]||(n[s]=c[s],i[s]=1);e[o]=c}else for(const s in l)i[s]=1}for(const l in r)l in n||(n[l]=void 0);return n}function Vn(e){return typeof e=="object"&&e!==null?e:{}}function nt(e,t,n){const r=e.$$.props[t];r!==void 0&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function oe(e){e&&e.c()}function re(e,t,n,r){const{fragment:i,on_mount:o,on_destroy:l,after_update:c}=e.$$;i&&i.m(t,n),r||_t(()=>{const s=o.map(ca).filter(Y);l?l.push(...s):z(s),e.$$.on_mount=[]}),c.forEach(_t)}function ie(e,t){const n=e.$$;n.fragment!==null&&(z(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Lc(e,t){e.$$.dirty[0]===-1&&(Tn.push(e),ya(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Re(e,t,n,r,i,o,l,c=[-1]){const s=$n;Nn(e);const u=e.$$={fragment:null,ctx:null,props:o,update:he,not_equal:i,bound:Ro(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(s?s.$$.context:[])),callbacks:Ro(),dirty:c,skip_bound:!1,root:t.target||s.$$.root};l&&l(u.root);let f=!1;if(u.ctx=n?n(e,t.props||{},(a,d,...p)=>{const h=p.length?p[0]:d;return u.ctx&&i(u.ctx[a],u.ctx[a]=h)&&(!u.skip_bound&&u.bound[a]&&u.bound[a](h),f&&Lc(e,a)),d}):[],u.update(),f=!0,z(u.before_update),u.fragment=r?r(u.ctx):!1,t.target){if(t.hydrate){const a=bc(t.target);u.fragment&&u.fragment.l(a),a.forEach(k)}else u.fragment&&u.fragment.c();t.intro&&S(e.$$.fragment),re(e,t.target,t.anchor,t.customElement),_a()}Nn(s)}class Pe{$destroy(){ie(this,1),this.$destroy=he}$on(t,n){const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(t){this.$$set&&!pc(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Ht=[];function Ue(e,t=he){let n;const r=new Set;function i(c){if(Te(e,c)&&(e=c,n)){const s=!Ht.length;for(const u of r)u[1](),Ht.push(u,e);if(s){for(let u=0;u<Ht.length;u+=2)Ht[u][0](Ht[u+1]);Ht.length=0}}}function o(c){i(c(e))}function l(c,s=he){const u=[c,s];return r.add(u),r.size===1&&(n=t(i)||he),c(e),()=>{r.delete(u),r.size===0&&(n(),n=null)}}return{set:i,update:o,subscribe:l}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var at=function(){return at=Object.assign||function(t){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},at.apply(this,arguments)};function Nc(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}function Bc(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var M=function(){return M=Object.assign||function(t){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},M.apply(this,arguments)};function oo(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}function te(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ee(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,o=[],l;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(c){l={error:c}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(l)throw l.error}}return o}function pe(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,o;r<i;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}var de;(function(e){e.Start="xstate.start",e.Stop="xstate.stop",e.Raise="xstate.raise",e.Send="xstate.send",e.Cancel="xstate.cancel",e.NullEvent="",e.Assign="xstate.assign",e.After="xstate.after",e.DoneState="done.state",e.DoneInvoke="done.invoke",e.Log="xstate.log",e.Init="xstate.init",e.Invoke="xstate.invoke",e.ErrorExecution="error.execution",e.ErrorCommunication="error.communication",e.ErrorPlatform="error.platform",e.ErrorCustom="xstate.error",e.Update="xstate.update",e.Pure="xstate.pure",e.Choose="xstate.choose"})(de||(de={}));var Pt;(function(e){e.Parent="#_parent",e.Internal="#_internal"})(Pt||(Pt={}));var yi=de.Start,so=de.Stop,tn=de.Raise,nn=de.Send,Ca=de.Cancel,jc=de.NullEvent,ao=de.Assign;de.After;de.DoneState;var Sa=de.Log,Fc=de.Init,_i=de.Invoke;de.ErrorExecution;var wo=de.ErrorPlatform,Gc=de.ErrorCustom,Ta=de.Update,xc=de.Choose,Uc=de.Pure,Ea=".",Do={},bi="xstate.guard",zc="",ka=!0,fr;function lo(e,t,n){n===void 0&&(n=Ea);var r=Bn(e,n),i=Bn(t,n);return se(i)?se(r)?i===r:!1:se(r)?r in i:Object.keys(r).every(function(o){return o in i?lo(r[o],i[o]):!1})}function Ra(e){try{return se(e)||typeof e=="number"?"".concat(e):e.type}catch{throw new Error("Events must be strings or objects with a string event.type property.")}}function Ci(e,t){try{return hn(e)?e:e.toString().split(t)}catch{throw new Error("'".concat(e,"' is not a valid state path."))}}function Hc(e){return typeof e=="object"&&"value"in e&&"context"in e&&"event"in e&&"_event"in e}function Bn(e,t){if(Hc(e))return e.value;if(hn(e))return Br(e);if(typeof e!="string")return e;var n=Ci(e,t);return Br(n)}function Br(e){if(e.length===1)return e[0];for(var t={},n=t,r=0;r<e.length-1;r++)r===e.length-2?n[e[r]]=e[r+1]:(n[e[r]]={},n=n[e[r]]);return t}function En(e,t){for(var n={},r=Object.keys(e),i=0;i<r.length;i++){var o=r[i];n[o]=t(e[o],o,e,i)}return n}function Ao(e,t,n){var r,i,o={};try{for(var l=te(Object.keys(e)),c=l.next();!c.done;c=l.next()){var s=c.value,u=e[s];!n(u)||(o[s]=t(u,s,e))}}catch(f){r={error:f}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}return o}var $c=function(e){return function(t){var n,r,i=t;try{for(var o=te(e),l=o.next();!l.done;l=o.next()){var c=l.value;i=i[c]}}catch(s){n={error:s}}finally{try{l&&!l.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return i}};function Vc(e,t){return function(n){var r,i,o=n;try{for(var l=te(e),c=l.next();!c.done;c=l.next()){var s=c.value;o=o[t][s]}}catch(u){r={error:u}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}return o}}function kr(e){if(!e)return[[]];if(se(e))return[[e]];var t=ve(Object.keys(e).map(function(n){var r=e[n];return typeof r!="string"&&(!r||!Object.keys(r).length)?[[n]]:kr(e[n]).map(function(i){return[n].concat(i)})}));return t}function ve(e){var t;return(t=[]).concat.apply(t,pe([],ee(e),!1))}function Pa(e){return hn(e)?e:[e]}function Ze(e){return e===void 0?[]:Pa(e)}function jr(e,t,n){var r,i;if(fe(e))return e(t,n.data);var o={};try{for(var l=te(Object.keys(e)),c=l.next();!c.done;c=l.next()){var s=c.value,u=e[s];fe(u)?o[s]=u(t,n.data):o[s]=u}}catch(f){r={error:f}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}return o}function Wc(e){return/^(done|error)\./.test(e)}function Io(e){return!!(e instanceof Promise||e!==null&&(fe(e)||typeof e=="object")&&fe(e.then))}function qc(e){return e!==null&&typeof e=="object"&&"transition"in e&&typeof e.transition=="function"}function Jc(e,t){var n,r,i=ee([[],[]],2),o=i[0],l=i[1];try{for(var c=te(e),s=c.next();!s.done;s=c.next()){var u=s.value;t(u)?o.push(u):l.push(u)}}catch(f){n={error:f}}finally{try{s&&!s.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}return[o,l]}function Oa(e,t){return En(e.states,function(n,r){if(!!n){var i=(se(t)?void 0:t[r])||(n?n.current:void 0);if(!!i)return{current:i,states:Oa(n,i)}}})}function Yc(e,t){return{current:t,states:Oa(e,t)}}function Mo(e,t,n,r){var i=e&&n.reduce(function(o,l){var c,s,u=l.assignment,f={state:r,action:l,_event:t},a={};if(fe(u))a=u(o,t.data,f);else try{for(var d=te(Object.keys(u)),p=d.next();!p.done;p=d.next()){var h=p.value,g=u[h];a[h]=fe(g)?g(o,t.data,f):g}}catch(m){c={error:m}}finally{try{p&&!p.done&&(s=d.return)&&s.call(d)}finally{if(c)throw c.error}}return Object.assign({},o,a)},e);return i}var wa=function(){};ka||(wa=function(e,t){var n=e instanceof Error?e:void 0;if(!(!n&&e)&&console!==void 0){var r=["Warning: ".concat(t)];n&&r.push(n),console.warn.apply(console,r)}});function hn(e){return Array.isArray(e)}function fe(e){return typeof e=="function"}function se(e){return typeof e=="string"}function Da(e,t){if(!!e)return se(e)?{type:bi,name:e,predicate:t?t[e]:void 0}:fe(e)?{type:bi,name:e.name,predicate:e}:e}function Xc(e){try{return"subscribe"in e&&fe(e.subscribe)}catch{return!1}}var Tt=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();fr={},fr[Tt]=function(){return this},fr[Symbol.observable]=function(){return this};function rn(e){return!!e&&"__xstatenode"in e}function Qc(e){return!!e&&typeof e.send=="function"}function Xr(e,t){return se(e)||typeof e=="number"?M({type:e},t):e}function De(e,t){if(!se(e)&&"$$type"in e&&e.$$type==="scxml")return e;var n=Xr(e);return M({name:n.type,data:n,$$type:"scxml",type:"external"},t)}function $t(e,t){var n=Pa(t).map(function(r){return typeof r>"u"||typeof r=="string"||rn(r)?{target:r,event:e}:M(M({},r),{event:e})});return n}function Kc(e){if(!(e===void 0||e===zc))return Ze(e)}function Aa(e,t,n,r,i){var o=e.options.guards,l={state:i,cond:t,_event:r};if(t.type===bi)return((o==null?void 0:o[t.name])||t.predicate)(n,r.data,l);var c=o==null?void 0:o[t.type];if(!c)throw new Error("Guard '".concat(t.type,"' is not implemented on machine '").concat(e.id,"'."));return c(n,r.data,l)}function Ia(e){return typeof e=="string"?{type:e}:e}function jn(e,t,n){var r=function(){},i=typeof e=="object",o=i?e:null;return{next:((i?e.next:e)||r).bind(o),error:((i?e.error:t)||r).bind(o),complete:((i?e.complete:n)||r).bind(o)}}function dr(e,t){return"".concat(e,":invocation[").concat(t,"]")}var Qt=De({type:Fc});function Si(e,t){return t&&t[e]||void 0}function Wn(e,t){var n;if(se(e)||typeof e=="number"){var r=Si(e,t);fe(r)?n={type:e,exec:r}:r?n=r:n={type:e,exec:void 0}}else if(fe(e))n={type:e.name||e.toString(),exec:e};else{var r=Si(e.type,t);if(fe(r))n=M(M({},e),{exec:r});else if(r){var i=r.type||e.type;n=M(M(M({},r),e),{type:i})}else n=e}return n}var Et=function(e,t){if(!e)return[];var n=hn(e)?e:[e];return n.map(function(r){return Wn(r,t)})};function co(e){var t=Wn(e);return M(M({id:se(e)?e:t.id},t),{type:t.type})}function Zc(e){return se(e)?{type:tn,event:e}:Ma(e,{to:Pt.Internal})}function eu(e){return{type:tn,_event:De(e.event)}}function Ma(e,t){return{to:t?t.to:void 0,type:nn,event:fe(e)?e:Xr(e),delay:t?t.delay:void 0,id:t&&t.id!==void 0?t.id:fe(e)?e.name:Ra(e)}}function tu(e,t,n,r){var i={_event:n},o=De(fe(e.event)?e.event(t,n.data,i):e.event),l;if(se(e.delay)){var c=r&&r[e.delay];l=fe(c)?c(t,n.data,i):c}else l=fe(e.delay)?e.delay(t,n.data,i):e.delay;var s=fe(e.to)?e.to(t,n.data,i):e.to;return M(M({},e),{to:s,_event:o,event:o.data,delay:l})}var nu=function(e,t,n){return M(M({},e),{value:se(e.expr)?e.expr:e.expr(t,n.data,{_event:n})})},ru=function(e){return{type:Ca,sendId:e}};function iu(e){var t=co(e);return{type:de.Start,activity:t,exec:void 0}}function ou(e){var t=fe(e)?e:co(e);return{type:de.Stop,activity:t,exec:void 0}}function su(e,t,n){var r=fe(e.activity)?e.activity(t,n.data):e.activity,i=typeof r=="string"?{id:r}:r,o={type:de.Stop,activity:i};return o}var au=function(e){return{type:ao,assignment:e}};function lu(e,t){var n=t?"#".concat(t):"";return"".concat(de.After,"(").concat(e,")").concat(n)}function pr(e,t){var n="".concat(de.DoneState,".").concat(e),r={type:n,data:t};return r.toString=function(){return n},r}function Rr(e,t){var n="".concat(de.DoneInvoke,".").concat(e),r={type:n,data:t};return r.toString=function(){return n},r}function kn(e,t){var n="".concat(de.ErrorPlatform,".").concat(e),r={type:n,data:t};return r.toString=function(){return n},r}var cu=function(e){var t,n,r=[];try{for(var i=te(e),o=i.next();!o.done;o=i.next())for(var l=o.value,c=0;c<l.length;){if(l[c].type===ao){r.push(l[c]),l.splice(c,1);continue}c++}}catch(s){t={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r};function Fr(e,t,n,r,i,o,l){l===void 0&&(l=!1);var c=l?[]:cu(i),s=c.length?Mo(n,r,c,t):n,u=l?[n]:void 0,f=[];function a(h){var g;switch(h.type){case tn:return eu(h);case nn:var m=tu(h,s,r,e.options.delays);return o&&m.to!==Pt.Internal&&f.push(m),m;case Sa:{var v=nu(h,s,r);return o==null||o(v,s,r),v}case xc:{var y=h,b=(g=y.conds.find(function(ne){var ue=Da(ne.cond,e.options.guards);return!ue||Aa(e,ue,s,r,o?void 0:t)}))===null||g===void 0?void 0:g.actions;if(!b)return[];var P=ee(Fr(e,t,s,r,[Et(Ze(b),e.options.actions)],o,l),2),T=P[0],w=P[1];return s=w,u==null||u.push(s),T}case Uc:{var b=h.get(s,r.data);if(!b)return[];var R=ee(Fr(e,t,s,r,[Et(Ze(b),e.options.actions)],o,l),2),I=R[0],j=R[1];return s=j,u==null||u.push(s),I}case so:{var v=su(h,s,r);return o==null||o(v,n,r),v}case ao:{s=Mo(s,r,[h],o?void 0:t),u==null||u.push(s);break}default:var C=Wn(h,e.options.actions),H=C.exec;if(o)o(C,s,r);else if(H&&u){var Z=u.length-1;C=M(M({},C),{exec:function(ne){for(var ue=[],_e=1;_e<arguments.length;_e++)ue[_e-1]=arguments[_e];H.apply(void 0,pe([u[Z]],ee(ue),!1))}})}return C}}function d(h){var g,m,v=[];try{for(var y=te(h),b=y.next();!b.done;b=y.next()){var P=b.value,T=a(P);T&&(v=v.concat(T))}}catch(w){g={error:w}}finally{try{b&&!b.done&&(m=y.return)&&m.call(y)}finally{if(g)throw g.error}}return f.forEach(function(w){o(w,s,r)}),f.length=0,v}var p=ve(i.map(d));return[p,s]}var Jt=function(e,t){var n=t(e);return n};function La(e){var t;return t={id:e,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:e}}},t[Tt]=function(){return this},t}function uu(e,t,n,r){var i,o=Ia(e.src),l=(i=t==null?void 0:t.options.services)===null||i===void 0?void 0:i[o.type],c=e.data?jr(e.data,n,r):void 0,s=l?Na(l,e.id,c):La(e.id);return s.meta=e,s}function Na(e,t,n){var r=La(t);if(r.deferred=!0,rn(e)){var i=r.state=Jt(void 0,function(){return(n?e.withContext(n):e).initialState});r.getSnapshot=function(){return i}}return r}function fu(e){try{return typeof e.send=="function"}catch{return!1}}function du(e){return fu(e)&&"id"in e}function pu(e){var t;return M((t={subscribe:function(){return{unsubscribe:function(){}}},id:"anonymous",getSnapshot:function(){}},t[Tt]=function(){return this},t),e)}var Gr=function(e){return e.type==="atomic"||e.type==="final"};function Ba(e){return Object.keys(e.states).map(function(t){return e.states[t]})}function qn(e){return Ba(e).filter(function(t){return t.type!=="history"})}function ja(e){var t=[e];return Gr(e)?t:t.concat(ve(qn(e).map(ja)))}function Rn(e,t){var n,r,i,o,l,c,s,u,f=new Set(e),a=Ti(f),d=new Set(t);try{for(var p=te(d),h=p.next();!h.done;h=p.next())for(var g=h.value,m=g.parent;m&&!d.has(m);)d.add(m),m=m.parent}catch(j){n={error:j}}finally{try{h&&!h.done&&(r=p.return)&&r.call(p)}finally{if(n)throw n.error}}var v=Ti(d);try{for(var y=te(d),b=y.next();!b.done;b=y.next()){var g=b.value;if(g.type==="compound"&&(!v.get(g)||!v.get(g).length))a.get(g)?a.get(g).forEach(function(C){return d.add(C)}):g.initialStateNodes.forEach(function(C){return d.add(C)});else if(g.type==="parallel")try{for(var P=(l=void 0,te(qn(g))),T=P.next();!T.done;T=P.next()){var w=T.value;d.has(w)||(d.add(w),a.get(w)?a.get(w).forEach(function(C){return d.add(C)}):w.initialStateNodes.forEach(function(C){return d.add(C)}))}}catch(C){l={error:C}}finally{try{T&&!T.done&&(c=P.return)&&c.call(P)}finally{if(l)throw l.error}}}}catch(j){i={error:j}}finally{try{b&&!b.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}try{for(var R=te(d),I=R.next();!I.done;I=R.next())for(var g=I.value,m=g.parent;m&&!d.has(m);)d.add(m),m=m.parent}catch(j){s={error:j}}finally{try{I&&!I.done&&(u=R.return)&&u.call(R)}finally{if(s)throw s.error}}return d}function Fa(e,t){var n=t.get(e);if(!n)return{};if(e.type==="compound"){var r=n[0];if(r){if(Gr(r))return r.key}else return{}}var i={};return n.forEach(function(o){i[o.key]=Fa(o,t)}),i}function Ti(e){var t,n,r=new Map;try{for(var i=te(e),o=i.next();!o.done;o=i.next()){var l=o.value;r.has(l)||r.set(l,[]),l.parent&&(r.has(l.parent)||r.set(l.parent,[]),r.get(l.parent).push(l))}}catch(c){t={error:c}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}function hu(e,t){var n=Rn([e],t);return Fa(e,Ti(n))}function Pn(e,t){return Array.isArray(e)?e.some(function(n){return n===t}):e instanceof Set?e.has(t):!1}function mu(e){return pe([],ee(new Set(ve(pe([],ee(e.map(function(t){return t.ownEvents})),!1)))),!1)}function Pr(e,t){return t.type==="compound"?qn(t).some(function(n){return n.type==="final"&&Pn(e,n)}):t.type==="parallel"?qn(t).every(function(n){return Pr(e,n)}):!1}function gu(e){return e===void 0&&(e=[]),e.reduce(function(t,n){return n.meta!==void 0&&(t[n.id]=n.meta),t},{})}function Lo(e){return new Set(ve(e.map(function(t){return t.tags})))}function Ga(e,t){if(e===t)return!0;if(e===void 0||t===void 0)return!1;if(se(e)||se(t))return e===t;var n=Object.keys(e),r=Object.keys(t);return n.length===r.length&&n.every(function(i){return Ga(e[i],t[i])})}function vu(e){return typeof e!="object"||e===null?!1:"value"in e&&"_event"in e}function yu(e,t){var n=e.exec,r=M(M({},e),{exec:n!==void 0?function(){return n(t.context,t.event,{action:e,state:t,_event:t._event})}:void 0});return r}var it=function(){function e(t){var n=this,r;this.actions=[],this.activities=Do,this.meta={},this.events=[],this.value=t.value,this.context=t.context,this._event=t._event,this._sessionid=t._sessionid,this.event=this._event.data,this.historyValue=t.historyValue,this.history=t.history,this.actions=t.actions||[],this.activities=t.activities||Do,this.meta=gu(t.configuration),this.events=t.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=t.configuration,this.transitions=t.transitions,this.children=t.children,this.done=!!t.done,this.tags=(r=Array.isArray(t.tags)?new Set(t.tags):t.tags)!==null&&r!==void 0?r:new Set,this.machine=t.machine,Object.defineProperty(this,"nextEvents",{get:function(){return mu(n.configuration)}})}return e.from=function(t,n){if(t instanceof e)return t.context!==n?new e({value:t.value,context:n,_event:t._event,_sessionid:null,historyValue:t.historyValue,history:t.history,actions:[],activities:t.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):t;var r=Qt;return new e({value:t,context:n,_event:r,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},e.create=function(t){return new e(t)},e.inert=function(t,n){if(t instanceof e){if(!t.actions.length)return t;var r=Qt;return new e({value:t.value,context:n,_event:r,_sessionid:null,historyValue:t.historyValue,history:t.history,activities:t.activities,configuration:t.configuration,transitions:[],children:{}})}return e.from(t,n)},e.prototype.toStrings=function(t,n){var r=this;if(t===void 0&&(t=this.value),n===void 0&&(n="."),se(t))return[t];var i=Object.keys(t);return i.concat.apply(i,pe([],ee(i.map(function(o){return r.toStrings(t[o],n).map(function(l){return o+n+l})})),!1))},e.prototype.toJSON=function(){var t=this;t.configuration,t.transitions;var n=t.tags;t.machine;var r=oo(t,["configuration","transitions","tags","machine"]);return M(M({},r),{tags:Array.from(n)})},e.prototype.matches=function(t){return lo(t,this.value)},e.prototype.hasTag=function(t){return this.tags.has(t)},e.prototype.can=function(t){var n;wa(!!this.machine,"state.can(...) used outside of a machine-created State object; this will always return false.");var r=(n=this.machine)===null||n===void 0?void 0:n.getTransitionData(this,t);return!!(r!=null&&r.transitions.length)&&r.transitions.some(function(i){return i.target!==void 0||i.actions.length})},e}(),_u={deferEvents:!1},No=function(){function e(t){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=M(M({},_u),t)}return e.prototype.initialize=function(t){if(this.initialized=!0,t){if(!this.options.deferEvents){this.schedule(t);return}this.process(t)}this.flushEvents()},e.prototype.schedule=function(t){if(!this.initialized||this.processingEvent){this.queue.push(t);return}if(this.queue.length!==0)throw new Error("Event queue should be empty when it is not processing events");this.process(t),this.flushEvents()},e.prototype.clear=function(){this.queue=[]},e.prototype.flushEvents=function(){for(var t=this.queue.shift();t;)this.process(t),t=this.queue.shift()},e.prototype.process=function(t){this.processingEvent=!0;try{t()}catch(n){throw this.clear(),n}finally{this.processingEvent=!1}},e}(),si=new Map,bu=0,hr={bookId:function(){return"x:".concat(bu++)},register:function(e,t){return si.set(e,t),e},get:function(e){return si.get(e)},free:function(e){si.delete(e)}};function uo(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global}function Cu(){var e=uo();if(e&&"__xstate__"in e)return e.__xstate__}function Su(e){if(!!uo()){var t=Cu();t&&t.register(e)}}function Tu(e,t){t===void 0&&(t={});var n=e.initialState,r=new Set,i=[],o=!1,l=function(){if(!o){for(o=!0;i.length>0;){var u=i.shift();n=e.transition(n,u,s),r.forEach(function(f){return f.next(n)})}o=!1}},c=pu({id:t.id,send:function(u){i.push(u),l()},getSnapshot:function(){return n},subscribe:function(u,f,a){var d=jn(u,f,a);return r.add(d),d.next(n),{unsubscribe:function(){r.delete(d)}}}}),s={parent:t.parent,self:c,id:t.id||"anonymous",observers:r};return n=e.start?e.start(s):n,c}var Eu={sync:!1,autoForward:!1},Ie;(function(e){e[e.NotStarted=0]="NotStarted",e[e.Running=1]="Running",e[e.Stopped=2]="Stopped"})(Ie||(Ie={}));var ku=function(){function e(t,n){n===void 0&&(n=e.defaultOptions);var r=this;this.machine=t,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=Ie.NotStarted,this.children=new Map,this.forwardTo=new Set,this._outgoingQueue=[],this.init=this.start,this.send=function(f,a){if(hn(f))return r.batch(f),r.state;var d=De(Xr(f,a));if(r.status===Ie.Stopped)return r.state;if(r.status!==Ie.Running&&!r.options.deferEvents)throw new Error('Event "'.concat(d.name,'" was sent to uninitialized service "').concat(r.machine.id,`". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.
Event: `).concat(JSON.stringify(d.data)));return r.scheduler.schedule(function(){r.forward(d);var p=r._nextState(d);r.update(p,d)}),r._state},this.sendTo=function(f,a,d){var p=r.parent&&(a===Pt.Parent||r.parent.id===a),h=p?r.parent:se(a)?r.children.get(a)||hr.get(a):Qc(a)?a:void 0;if(!h){if(!p)throw new Error("Unable to send event to child '".concat(a,"' from service '").concat(r.id,"'."));return}if("machine"in h){if(r.status!==Ie.Stopped||r.parent!==h||r.state.done){var g=M(M({},f),{name:f.name===Gc?"".concat(kn(r.id)):f.name,origin:r.sessionId});!d&&r.machine.config.predictableActionArguments?r._outgoingQueue.push([h,g]):h.send(g)}}else!d&&r.machine.config.predictableActionArguments?r._outgoingQueue.push([h,f.data]):h.send(f.data)},this._exec=function(f,a,d,p){p===void 0&&(p=r.machine.options.actions);var h=f.exec||Si(f.type,p),g=fe(h)?h:h?h.exec:f.exec;if(g)try{return g(a,d.data,r.machine.config.predictableActionArguments?{action:f,_event:d}:{action:f,state:r.state,_event:d})}catch(Z){throw r.parent&&r.parent.send({type:"xstate.error",data:Z}),Z}switch(f.type){case nn:var m=f;if(typeof m.delay=="number"){r.defer(m);return}else m.to?r.sendTo(m._event,m.to,d===Qt):r.send(m._event);break;case Ca:r.cancel(f.sendId);break;case yi:{if(r.status!==Ie.Running)return;var v=f.activity;if(!r.machine.config.predictableActionArguments&&!r.state.activities[v.id||v.type])break;if(v.type===de.Invoke){var y=Ia(v.src),b=r.machine.options.services?r.machine.options.services[y.type]:void 0,P=v.id,T=v.data,w="autoForward"in v?v.autoForward:!!v.forward;if(!b)return;var R=T?jr(T,a,d):void 0;if(typeof b=="string")return;var I=fe(b)?b(a,d.data,{data:R,src:y,meta:v.meta}):b;if(!I)return;var j=void 0;rn(I)&&(I=R?I.withContext(R):I,j={autoForward:w}),r.spawn(I,P,j)}else r.spawnActivity(v);break}case so:{r.stopChild(f.activity.id);break}case Sa:var C=f.label,H=f.value;C?r.logger(C,H):r.logger(H);break}};var i=M(M({},e.defaultOptions),n),o=i.clock,l=i.logger,c=i.parent,s=i.id,u=s!==void 0?s:t.id;this.id=u,this.logger=l,this.clock=o,this.parent=c,this.options=i,this.scheduler=new No({deferEvents:this.options.deferEvents}),this.sessionId=hr.bookId()}return Object.defineProperty(e.prototype,"initialState",{get:function(){var t=this;return this._initialState?this._initialState:Jt(this,function(){return t._initialState=t.machine.initialState,t._initialState})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),e.prototype.execute=function(t,n){var r,i;try{for(var o=te(t.actions),l=o.next();!l.done;l=o.next()){var c=l.value;this.exec(c,t,n)}}catch(s){r={error:s}}finally{try{l&&!l.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}},e.prototype.update=function(t,n){var r,i,o,l,c,s,u,f,a=this;if(t._sessionid=this.sessionId,this._state=t,(!this.machine.config.predictableActionArguments||n===Qt)&&this.options.execute)this.execute(this.state);else for(var d=void 0;d=this._outgoingQueue.shift();)d[0].send(d[1]);if(this.children.forEach(function(j){a.state.children[j.id]=j}),this.devTools&&this.devTools.send(n.data,t),t.event)try{for(var p=te(this.eventListeners),h=p.next();!h.done;h=p.next()){var g=h.value;g(t.event)}}catch(j){r={error:j}}finally{try{h&&!h.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}try{for(var m=te(this.listeners),v=m.next();!v.done;v=m.next()){var g=v.value;g(t,t.event)}}catch(j){o={error:j}}finally{try{v&&!v.done&&(l=m.return)&&l.call(m)}finally{if(o)throw o.error}}try{for(var y=te(this.contextListeners),b=y.next();!b.done;b=y.next()){var P=b.value;P(this.state.context,this.state.history?this.state.history.context:void 0)}}catch(j){c={error:j}}finally{try{b&&!b.done&&(s=y.return)&&s.call(y)}finally{if(c)throw c.error}}if(this.state.done){var T=t.configuration.find(function(j){return j.type==="final"&&j.parent===a.machine}),w=T&&T.doneData?jr(T.doneData,t.context,n):void 0;try{for(var R=te(this.doneListeners),I=R.next();!I.done;I=R.next()){var g=I.value;g(Rr(this.id,w))}}catch(j){u={error:j}}finally{try{I&&!I.done&&(f=R.return)&&f.call(R)}finally{if(u)throw u.error}}this._stop(),this._stopChildren()}},e.prototype.onTransition=function(t){return this.listeners.add(t),this.status===Ie.Running&&t(this.state,this.state.event),this},e.prototype.subscribe=function(t,n,r){var i=this,o=jn(t,n,r);this.listeners.add(o.next),this.status!==Ie.NotStarted&&o.next(this.state);var l=function(){i.doneListeners.delete(l),i.stopListeners.delete(l),o.complete()};return this.status===Ie.Stopped?o.complete():(this.onDone(l),this.onStop(l)),{unsubscribe:function(){i.listeners.delete(o.next),i.doneListeners.delete(l),i.stopListeners.delete(l)}}},e.prototype.onEvent=function(t){return this.eventListeners.add(t),this},e.prototype.onSend=function(t){return this.sendListeners.add(t),this},e.prototype.onChange=function(t){return this.contextListeners.add(t),this},e.prototype.onStop=function(t){return this.stopListeners.add(t),this},e.prototype.onDone=function(t){return this.doneListeners.add(t),this},e.prototype.off=function(t){return this.listeners.delete(t),this.eventListeners.delete(t),this.sendListeners.delete(t),this.stopListeners.delete(t),this.doneListeners.delete(t),this.contextListeners.delete(t),this},e.prototype.start=function(t){var n=this;if(this.status===Ie.Running)return this;this.machine._init(),hr.register(this.sessionId,this),this.initialized=!0,this.status=Ie.Running;var r=t===void 0?this.initialState:Jt(this,function(){return vu(t)?n.machine.resolveState(t):n.machine.resolveState(it.from(t,n.machine.context))});return this.options.devTools&&this.attachDev(),this.scheduler.initialize(function(){n.update(r,Qt)}),this},e.prototype._stopChildren=function(){this.children.forEach(function(t){fe(t.stop)&&t.stop()}),this.children.clear()},e.prototype._stop=function(){var t,n,r,i,o,l,c,s,u,f;try{for(var a=te(this.listeners),d=a.next();!d.done;d=a.next()){var p=d.value;this.listeners.delete(p)}}catch(R){t={error:R}}finally{try{d&&!d.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}try{for(var h=te(this.stopListeners),g=h.next();!g.done;g=h.next()){var p=g.value;p(),this.stopListeners.delete(p)}}catch(R){r={error:R}}finally{try{g&&!g.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}try{for(var m=te(this.contextListeners),v=m.next();!v.done;v=m.next()){var p=v.value;this.contextListeners.delete(p)}}catch(R){o={error:R}}finally{try{v&&!v.done&&(l=m.return)&&l.call(m)}finally{if(o)throw o.error}}try{for(var y=te(this.doneListeners),b=y.next();!b.done;b=y.next()){var p=b.value;this.doneListeners.delete(p)}}catch(R){c={error:R}}finally{try{b&&!b.done&&(s=y.return)&&s.call(y)}finally{if(c)throw c.error}}if(!this.initialized)return this;this.initialized=!1,this.status=Ie.Stopped,this._initialState=void 0;try{for(var P=te(Object.keys(this.delayedEventsMap)),T=P.next();!T.done;T=P.next()){var w=T.value;this.clock.clearTimeout(this.delayedEventsMap[w])}}catch(R){u={error:R}}finally{try{T&&!T.done&&(f=P.return)&&f.call(P)}finally{if(u)throw u.error}}this.scheduler.clear(),this.scheduler=new No({deferEvents:this.options.deferEvents})},e.prototype.stop=function(){var t=this,n=this.scheduler;return this._stop(),n.schedule(function(){var r=De({type:"xstate.stop"}),i=Jt(t,function(){var o=ve(pe([],ee(t.state.configuration),!1).sort(function(f,a){return a.order-f.order}).map(function(f){return Et(f.onExit,t.machine.options.actions)})),l=ee(Fr(t.machine,t.state,t.state.context,r,[o],t.machine.config.predictableActionArguments?t._exec:void 0,t.machine.config.predictableActionArguments||t.machine.config.preserveActionOrder),2),c=l[0],s=l[1],u=new it({value:t.state.value,context:s,_event:r,_sessionid:t.sessionId,historyValue:void 0,history:t.state,actions:c.filter(function(f){return f.type!==tn&&(f.type!==nn||!!f.to&&f.to!==Pt.Internal)}),activities:{},events:[],configuration:[],transitions:[],children:{},done:t.state.done,tags:t.state.tags,machine:t.machine});return u.changed=!0,u});t.update(i,r),t._stopChildren(),hr.free(t.sessionId)}),this},e.prototype.batch=function(t){var n=this;if(!(this.status===Ie.NotStarted&&this.options.deferEvents)){if(this.status!==Ie.Running)throw new Error("".concat(t.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.'))}if(!!t.length){var r=!!this.machine.config.predictableActionArguments&&this._exec;this.scheduler.schedule(function(){var i,o,l=n.state,c=!1,s=[],u=function(p){var h=De(p);n.forward(h),l=Jt(n,function(){return n.machine.transition(l,h,void 0,r||void 0)}),s.push.apply(s,pe([],ee(n.machine.config.predictableActionArguments?l.actions:l.actions.map(function(g){return yu(g,l)})),!1)),c=c||!!l.changed};try{for(var f=te(t),a=f.next();!a.done;a=f.next()){var d=a.value;u(d)}}catch(p){i={error:p}}finally{try{a&&!a.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}l.changed=c,l.actions=s,n.update(l,De(t[t.length-1]))})}},e.prototype.sender=function(t){return this.send.bind(this,t)},e.prototype._nextState=function(t,n){var r=this;n===void 0&&(n=!!this.machine.config.predictableActionArguments&&this._exec);var i=De(t);if(i.name.indexOf(wo)===0&&!this.state.nextEvents.some(function(l){return l.indexOf(wo)===0}))throw i.data.data;var o=Jt(this,function(){return r.machine.transition(r.state,i,void 0,n||void 0)});return o},e.prototype.nextState=function(t){return this._nextState(t,!1)},e.prototype.forward=function(t){var n,r;try{for(var i=te(this.forwardTo),o=i.next();!o.done;o=i.next()){var l=o.value,c=this.children.get(l);if(!c)throw new Error("Unable to forward event '".concat(t,"' from interpreter '").concat(this.id,"' to nonexistant child '").concat(l,"'."));c.send(t)}}catch(s){n={error:s}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype.defer=function(t){var n=this;this.delayedEventsMap[t.id]=this.clock.setTimeout(function(){t.to?n.sendTo(t._event,t.to,!0):n.send(t._event)},t.delay)},e.prototype.cancel=function(t){this.clock.clearTimeout(this.delayedEventsMap[t]),delete this.delayedEventsMap[t]},e.prototype.exec=function(t,n,r){r===void 0&&(r=this.machine.options.actions),this._exec(t,n.context,n._event,r)},e.prototype.removeChild=function(t){var n;this.children.delete(t),this.forwardTo.delete(t),(n=this.state)===null||n===void 0||delete n.children[t]},e.prototype.stopChild=function(t){var n=this.children.get(t);!n||(this.removeChild(t),fe(n.stop)&&n.stop())},e.prototype.spawn=function(t,n,r){if(this.status!==Ie.Running)return Na(t,n);if(Io(t))return this.spawnPromise(Promise.resolve(t),n);if(fe(t))return this.spawnCallback(t,n);if(du(t))return this.spawnActor(t,n);if(Xc(t))return this.spawnObservable(t,n);if(rn(t))return this.spawnMachine(t,M(M({},r),{id:n}));if(qc(t))return this.spawnBehavior(t,n);throw new Error('Unable to spawn entity "'.concat(n,'" of type "').concat(typeof t,'".'))},e.prototype.spawnMachine=function(t,n){var r=this;n===void 0&&(n={});var i=new e(t,M(M({},this.options),{parent:this,id:n.id||t.id})),o=M(M({},Eu),n);o.sync&&i.onTransition(function(c){r.send(Ta,{state:c,id:i.id})});var l=i;return this.children.set(i.id,l),o.autoForward&&this.forwardTo.add(i.id),i.onDone(function(c){r.removeChild(i.id),r.send(De(c,{origin:i.id}))}).start(),l},e.prototype.spawnBehavior=function(t,n){var r=Tu(t,{id:n,parent:this});return this.children.set(n,r),r},e.prototype.spawnPromise=function(t,n){var r,i=this,o=!1,l;t.then(function(s){o||(l=s,i.removeChild(n),i.send(De(Rr(n,s),{origin:n})))},function(s){if(!o){i.removeChild(n);var u=kn(n,s);try{i.send(De(u,{origin:n}))}catch{i.devTools&&i.devTools.send(u,i.state),i.machine.strict&&i.stop()}}});var c=(r={id:n,send:function(){},subscribe:function(s,u,f){var a=jn(s,u,f),d=!1;return t.then(function(p){d||(a.next(p),!d&&a.complete())},function(p){d||a.error(p)}),{unsubscribe:function(){return d=!0}}},stop:function(){o=!0},toJSON:function(){return{id:n}},getSnapshot:function(){return l}},r[Tt]=function(){return this},r);return this.children.set(n,c),c},e.prototype.spawnCallback=function(t,n){var r,i=this,o=!1,l=new Set,c=new Set,s,u=function(d){s=d,c.forEach(function(p){return p(d)}),!o&&i.send(De(d,{origin:n}))},f;try{f=t(u,function(d){l.add(d)})}catch(d){this.send(kn(n,d))}if(Io(f))return this.spawnPromise(f,n);var a=(r={id:n,send:function(d){return l.forEach(function(p){return p(d)})},subscribe:function(d){var p=jn(d);return c.add(p.next),{unsubscribe:function(){c.delete(p.next)}}},stop:function(){o=!0,fe(f)&&f()},toJSON:function(){return{id:n}},getSnapshot:function(){return s}},r[Tt]=function(){return this},r);return this.children.set(n,a),a},e.prototype.spawnObservable=function(t,n){var r,i=this,o,l=t.subscribe(function(s){o=s,i.send(De(s,{origin:n}))},function(s){i.removeChild(n),i.send(De(kn(n,s),{origin:n}))},function(){i.removeChild(n),i.send(De(Rr(n),{origin:n}))}),c=(r={id:n,send:function(){},subscribe:function(s,u,f){return t.subscribe(s,u,f)},stop:function(){return l.unsubscribe()},getSnapshot:function(){return o},toJSON:function(){return{id:n}}},r[Tt]=function(){return this},r);return this.children.set(n,c),c},e.prototype.spawnActor=function(t,n){return this.children.set(n,t),t},e.prototype.spawnActivity=function(t){var n=this.machine.options&&this.machine.options.activities?this.machine.options.activities[t.type]:void 0;if(!!n){var r=n(this.state.context,t);this.spawnEffect(t.id,r)}},e.prototype.spawnEffect=function(t,n){var r;this.children.set(t,(r={id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},stop:n||void 0,getSnapshot:function(){},toJSON:function(){return{id:t}}},r[Tt]=function(){return this},r))},e.prototype.attachDev=function(){var t=uo();if(this.options.devTools&&t){if(t.__REDUX_DEVTOOLS_EXTENSION__){var n=typeof this.options.devTools=="object"?this.options.devTools:void 0;this.devTools=t.__REDUX_DEVTOOLS_EXTENSION__.connect(M(M({name:this.id,autoPause:!0,stateSanitizer:function(r){return{value:r.value,context:r.context,actions:r.actions}}},n),{features:M({jump:!1,skip:!1},n?n.features:void 0)}),this.machine),this.devTools.init(this.state)}Su(this)}},e.prototype.toJSON=function(){return{id:this.id}},e.prototype[Tt]=function(){return this},e.prototype.getSnapshot=function(){return this.status===Ie.NotStarted?this.initialState:this._state},e.defaultOptions={execute:!0,deferEvents:!0,clock:{setTimeout:function(t,n){return setTimeout(t,n)},clearTimeout:function(t){return clearTimeout(t)}},logger:console.log.bind(console),devTools:!1},e.interpret=mn,e}();function mn(e,t){var n=new ku(e,t);return n}function Ru(e){if(typeof e=="string"){var t={type:e};return t.toString=function(){return e},t}return e}function mr(e){return M(M({type:_i},e),{toJSON:function(){e.onDone,e.onError;var t=oo(e,["onDone","onError"]);return M(M({},t),{type:_i,src:Ru(e.src)})}})}var gr="",Ei="#",ai="*",Vt={},Wt=function(e){return e[0]===Ei},Pu=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},Ou=function(){function e(t,n,r,i){r===void 0&&(r="context"in t?t.context:void 0);var o=this,l;this.config=t,this._context=r,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign(Pu(),n),this.parent=i==null?void 0:i.parent,this.key=this.config.key||(i==null?void 0:i.key)||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:Ea),this.id=this.config.id||pe([this.machine.key],ee(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:(l=this.config.schema)!==null&&l!==void 0?l:{},this.description=this.config.description,this.initial=this.config.initial,this.states=this.config.states?En(this.config.states,function(u,f){var a,d=new e(u,{},void 0,{parent:o,key:f});return Object.assign(o.idMap,M((a={},a[d.id]=d,a),d.idMap)),d}):Vt;var c=0;function s(u){var f,a;u.order=c++;try{for(var d=te(Ba(u)),p=d.next();!p.done;p=d.next()){var h=p.value;s(h)}}catch(g){f={error:g}}finally{try{p&&!p.done&&(a=d.return)&&a.call(d)}finally{if(f)throw f.error}}}s(this),this.history=this.config.history===!0?"shallow":this.config.history||!1,this._transient=!!this.config.always||(this.config.on?Array.isArray(this.config.on)?this.config.on.some(function(u){var f=u.event;return f===gr}):gr in this.config.on:!1),this.strict=!!this.config.strict,this.onEntry=Ze(this.config.entry||this.config.onEntry).map(function(u){return Wn(u)}),this.onExit=Ze(this.config.exit||this.config.onExit).map(function(u){return Wn(u)}),this.meta=this.config.meta,this.doneData=this.type==="final"?this.config.data:void 0,this.invoke=Ze(this.config.invoke).map(function(u,f){var a,d;if(rn(u)){var p=dr(o.id,f);return o.machine.options.services=M((a={},a[p]=u,a),o.machine.options.services),mr({src:p,id:p})}else if(se(u.src)){var p=u.id||dr(o.id,f);return mr(M(M({},u),{id:p,src:u.src}))}else if(rn(u.src)||fe(u.src)){var p=u.id||dr(o.id,f);return o.machine.options.services=M((d={},d[p]=u.src,d),o.machine.options.services),mr(M(M({id:p},u),{src:p}))}else{var h=u.src;return mr(M(M({id:dr(o.id,f)},u),{src:h}))}}),this.activities=Ze(this.config.activities).concat(this.invoke).map(function(u){return co(u)}),this.transition=this.transition.bind(this),this.tags=Ze(this.config.tags)}return e.prototype._init=function(){this.__cache.transitions||ja(this).forEach(function(t){return t.on})},e.prototype.withConfig=function(t,n){var r=this.options,i=r.actions,o=r.activities,l=r.guards,c=r.services,s=r.delays;return new e(this.config,{actions:M(M({},i),t.actions),activities:M(M({},o),t.activities),guards:M(M({},l),t.guards),services:M(M({},c),t.services),delays:M(M({},s),t.delays)},n!=null?n:this.context)},e.prototype.withContext=function(t){return new e(this.config,this.options,t)},Object.defineProperty(e.prototype,"context",{get:function(){return fe(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:En(this.states,function(t){return t.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return this.definition},Object.defineProperty(e.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var t=this.transitions;return this.__cache.on=t.reduce(function(n,r){return n[r.eventType]=n[r.eventType]||[],n[r.eventType].push(r),n},{})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),e.prototype.getCandidates=function(t){if(this.__cache.candidates[t])return this.__cache.candidates[t];var n=t===gr,r=this.transitions.filter(function(i){var o=i.eventType===t;return n?o:o||i.eventType===ai});return this.__cache.candidates[t]=r,r},e.prototype.getDelayedTransitions=function(){var t=this,n=this.config.after;if(!n)return[];var r=function(o,l){var c=fe(o)?"".concat(t.id,":delay[").concat(l,"]"):o,s=lu(c,t.id);return t.onEntry.push(Ma(s,{delay:o})),t.onExit.push(ru(s)),s},i=hn(n)?n.map(function(o,l){var c=r(o.delay,l);return M(M({},o),{event:c})}):ve(Object.keys(n).map(function(o,l){var c=n[o],s=se(c)?{target:c}:c,u=isNaN(+o)?o:+o,f=r(u,l);return Ze(s).map(function(a){return M(M({},a),{event:f,delay:u})})}));return i.map(function(o){var l=o.delay;return M(M({},t.formatTransition(o)),{delay:l})})},e.prototype.getStateNodes=function(t){var n,r=this;if(!t)return[];var i=t instanceof it?t.value:Bn(t,this.delimiter);if(se(i)){var o=this.getStateNode(i).initial;return o!==void 0?this.getStateNodes((n={},n[i]=o,n)):[this,this.states[i]]}var l=Object.keys(i),c=[this];return c.push.apply(c,pe([],ee(ve(l.map(function(s){return r.getStateNode(s).getStateNodes(i[s])}))),!1)),c},e.prototype.handles=function(t){var n=Ra(t);return this.events.includes(n)},e.prototype.resolveState=function(t){var n=t instanceof it?t:it.create(t),r=Array.from(Rn([],this.getStateNodes(n.value)));return new it(M(M({},n),{value:this.resolve(n.value),configuration:r,done:Pr(r,this),tags:Lo(r),machine:this.machine}))},e.prototype.transitionLeafNode=function(t,n,r){var i=this.getStateNode(t),o=i.next(n,r);return!o||!o.transitions.length?this.next(n,r):o},e.prototype.transitionCompoundNode=function(t,n,r){var i=Object.keys(t),o=this.getStateNode(i[0]),l=o._transition(t[i[0]],n,r);return!l||!l.transitions.length?this.next(n,r):l},e.prototype.transitionParallelNode=function(t,n,r){var i,o,l={};try{for(var c=te(Object.keys(t)),s=c.next();!s.done;s=c.next()){var u=s.value,f=t[u];if(!!f){var a=this.getStateNode(u),d=a._transition(f,n,r);d&&(l[u]=d)}}}catch(y){i={error:y}}finally{try{s&&!s.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}var p=Object.keys(l).map(function(y){return l[y]}),h=ve(p.map(function(y){return y.transitions})),g=p.some(function(y){return y.transitions.length>0});if(!g)return this.next(n,r);var m=ve(p.map(function(y){return y.entrySet})),v=ve(Object.keys(l).map(function(y){return l[y].configuration}));return{transitions:h,entrySet:m,exitSet:ve(p.map(function(y){return y.exitSet})),configuration:v,source:n,actions:ve(Object.keys(l).map(function(y){return l[y].actions}))}},e.prototype._transition=function(t,n,r){return se(t)?this.transitionLeafNode(t,n,r):Object.keys(t).length===1?this.transitionCompoundNode(t,n,r):this.transitionParallelNode(t,n,r)},e.prototype.getTransitionData=function(t,n){return this._transition(t.value,t,De(n))},e.prototype.next=function(t,n){var r,i,o=this,l=n.name,c=[],s=[],u;try{for(var f=te(this.getCandidates(l)),a=f.next();!a.done;a=f.next()){var d=a.value,p=d.cond,h=d.in,g=t.context,m=h?se(h)&&Wt(h)?t.matches(Bn(this.getStateNodeById(h).path,this.delimiter)):lo(Bn(h,this.delimiter),$c(this.path.slice(0,-2))(t.value)):!0,v=!1;try{v=!p||Aa(this.machine,p,g,n,t)}catch(T){throw new Error("Unable to evaluate guard '".concat(p.name||p.type,"' in transition for event '").concat(l,"' in state node '").concat(this.id,`':
`).concat(T.message))}if(v&&m){d.target!==void 0&&(s=d.target),c.push.apply(c,pe([],ee(d.actions),!1)),u=d;break}}}catch(T){r={error:T}}finally{try{a&&!a.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}if(!!u){if(!s.length)return{transitions:[u],entrySet:[],exitSet:[],configuration:t.value?[this]:[],source:t,actions:c};var y=ve(s.map(function(T){return o.getRelativeStateNodes(T,t.historyValue)})),b=!!u.internal,P=[];return b||s.forEach(function(T){P.push.apply(P,pe([],ee(o.getExternalReentryNodes(T)),!1))}),{transitions:[u],entrySet:P,exitSet:b?[]:[this],configuration:y,source:t,actions:c}}},e.prototype.getExternalReentryNodes=function(t){for(var n=[],r=ee(t.order>this.order?[t,this]:[this,t],2),i=r[0],o=r[1];i&&i!==o;)n.push(i),i=i.parent;return i!==o?[]:(n.push(o),n)},e.prototype.getActions=function(t,n,r,i,o,l,c){var s,u,f,a,d=this,p=Rn([],l?this.getStateNodes(l.value):[this]);try{for(var h=te(t),g=h.next();!g.done;g=h.next()){var m=g.value;(!Pn(p,m)||Pn(r.entrySet,m.parent))&&r.entrySet.push(m)}}catch(C){s={error:C}}finally{try{g&&!g.done&&(u=h.return)&&u.call(h)}finally{if(s)throw s.error}}try{for(var v=te(p),y=v.next();!y.done;y=v.next()){var m=y.value;(!Pn(t,m)||Pn(r.exitSet,m.parent))&&r.exitSet.push(m)}}catch(C){f={error:C}}finally{try{y&&!y.done&&(a=v.return)&&a.call(v)}finally{if(f)throw f.error}}var b=ve(r.entrySet.map(function(C){var H=[];if(C.type!=="final")return H;var Z=C.parent;if(!Z.parent)return H;H.push(pr(C.id,C.doneData),pr(Z.id,C.doneData?jr(C.doneData,i,o):void 0));var ne=Z.parent;return ne.type==="parallel"&&qn(ne).every(function(ue){return Pr(r.configuration,ue)})&&H.push(pr(ne.id)),H}));r.exitSet.sort(function(C,H){return H.order-C.order}),r.entrySet.sort(function(C,H){return C.order-H.order});var P=new Set(r.entrySet),T=new Set(r.exitSet),w=Array.from(P).map(function(C){var H=C.onEntry,Z=C.activities.map(function(ne){return iu(ne)});return Et(c?pe(pe([],ee(H),!1),ee(Z),!1):pe(pe([],ee(Z),!1),ee(H),!1),d.machine.options.actions)}).concat([b.map(Zc)]),R=Array.from(T).map(function(C){return Et(pe(pe([],ee(C.onExit),!1),ee(C.activities.map(function(H){return ou(H)})),!1),d.machine.options.actions)}),I=R.concat([Et(r.actions,this.machine.options.actions)]).concat(w);if(n){var j=Et(ve(pe([],ee(t),!1).sort(function(C,H){return H.order-C.order}).map(function(C){return C.onExit})),this.machine.options.actions).filter(function(C){return C.type!==tn&&(C.type!==nn||!!C.to&&C.to!==Pt.Internal)});return I.concat([j])}return I},e.prototype.transition=function(t,n,r,i){t===void 0&&(t=this.initialState);var o=De(n),l;if(t instanceof it)l=r===void 0?t:this.resolveState(it.from(t,r));else{var c=se(t)?this.resolve(Br(this.getResolvedPath(t))):this.resolve(t),s=r!=null?r:this.machine.context;l=this.resolveState(it.from(c,s))}if(this.strict&&!this.events.includes(o.name)&&!Wc(o.name))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(o.name,"'"));var u=this._transition(l.value,l,o)||{transitions:[],configuration:[],entrySet:[],exitSet:[],source:l,actions:[]},f=Rn([],this.getStateNodes(l.value)),a=u.configuration.length?Rn(f,u.configuration):f;return u.configuration=pe([],ee(a),!1),this.resolveTransition(u,l,l.context,i,o)},e.prototype.resolveRaisedTransition=function(t,n,r,i){var o,l=t.actions;return t=this.transition(t,n,void 0,i),t._event=r,t.event=r.data,(o=t.actions).unshift.apply(o,pe([],ee(l),!1)),t},e.prototype.resolveTransition=function(t,n,r,i,o){var l,c,s,u,f=this;o===void 0&&(o=Qt);var a=t.configuration,d=!n||t.transitions.length>0,p=d?t.configuration:n?n.configuration:[],h=Pr(p,this),g=d?hu(this.machine,a):void 0,m=n?n.historyValue?n.historyValue:t.source?this.machine.historyValue(n.value):void 0:void 0,v=this.getActions(new Set(p),h,t,r,o,n,i),y=n?M({},n.activities):{};try{for(var b=te(v),P=b.next();!P.done;P=b.next()){var T=P.value;try{for(var w=(s=void 0,te(T)),R=w.next();!R.done;R=w.next()){var I=R.value;I.type===yi?y[I.activity.id||I.activity.type]=I:I.type===so&&(y[I.activity.id||I.activity.type]=!1)}}catch(ce){s={error:ce}}finally{try{R&&!R.done&&(u=w.return)&&u.call(w)}finally{if(s)throw s.error}}}}catch(ce){l={error:ce}}finally{try{P&&!P.done&&(c=b.return)&&c.call(b)}finally{if(l)throw l.error}}var j=ee(Fr(this,n,r,o,v,i,this.machine.config.predictableActionArguments||this.machine.config.preserveActionOrder),2),C=j[0],H=j[1],Z=ee(Jc(C,function(ce){return ce.type===tn||ce.type===nn&&ce.to===Pt.Internal}),2),ne=Z[0],ue=Z[1],_e=C.filter(function(ce){var Oe;return ce.type===yi&&((Oe=ce.activity)===null||Oe===void 0?void 0:Oe.type)===_i}),$e=_e.reduce(function(ce,Oe){return ce[Oe.activity.id]=uu(Oe.activity,f.machine,H,o),ce},n?M({},n.children):{}),Ee=new it({value:g||n.value,context:H,_event:o,_sessionid:n?n._sessionid:null,historyValue:g?m?Yc(m,g):void 0:n?n.historyValue:void 0,history:!g||t.source?n:void 0,actions:g?ue:[],activities:g?y:n?n.activities:{},events:[],configuration:p,transitions:t.transitions,children:$e,done:h,tags:Lo(p),machine:this}),x=r!==H;Ee.changed=o.name===Ta||x;var le=Ee.history;le&&delete le.history;var Ve=!h&&(this._transient||a.some(function(ce){return ce._transient}));if(!d&&(!Ve||o.name===gr))return Ee;var me=Ee;if(!h)for(Ve&&(me=this.resolveRaisedTransition(me,{type:jc},o,i));ne.length;){var rt=ne.shift();me=this.resolveRaisedTransition(me,rt._event,o,i)}var Ct=me.changed||(le?!!me.actions.length||x||typeof le.value!=typeof me.value||!Ga(me.value,le.value):void 0);return me.changed=Ct,me.history=le,me},e.prototype.getStateNode=function(t){if(Wt(t))return this.machine.getStateNodeById(t);if(!this.states)throw new Error("Unable to retrieve child state '".concat(t,"' from '").concat(this.id,"'; no child states exist."));var n=this.states[t];if(!n)throw new Error("Child state '".concat(t,"' does not exist on '").concat(this.id,"'"));return n},e.prototype.getStateNodeById=function(t){var n=Wt(t)?t.slice(Ei.length):t;if(n===this.id)return this;var r=this.machine.idMap[n];if(!r)throw new Error("Child state node '#".concat(n,"' does not exist on machine '").concat(this.id,"'"));return r},e.prototype.getStateNodeByPath=function(t){if(typeof t=="string"&&Wt(t))try{return this.getStateNodeById(t.slice(1))}catch{}for(var n=Ci(t,this.delimiter).slice(),r=this;n.length;){var i=n.shift();if(!i.length)break;r=r.getStateNode(i)}return r},e.prototype.resolve=function(t){var n,r=this;if(!t)return this.initialStateValue||Vt;switch(this.type){case"parallel":return En(this.initialStateValue,function(o,l){return o?r.getStateNode(l).resolve(t[l]||o):Vt});case"compound":if(se(t)){var i=this.getStateNode(t);return i.type==="parallel"||i.type==="compound"?(n={},n[t]=i.initialStateValue,n):t}return Object.keys(t).length?En(t,function(o,l){return o?r.getStateNode(l).resolve(o):Vt}):this.initialStateValue||{};default:return t||Vt}},e.prototype.getResolvedPath=function(t){if(Wt(t)){var n=this.machine.idMap[t.slice(Ei.length)];if(!n)throw new Error("Unable to find state node '".concat(t,"'"));return n.path}return Ci(t,this.delimiter)},Object.defineProperty(e.prototype,"initialStateValue",{get:function(){var t;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;var n;if(this.type==="parallel")n=Ao(this.states,function(r){return r.initialStateValue||Vt},function(r){return r.type!=="history"});else if(this.initial!==void 0){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));n=Gr(this.states[this.initial])?this.initial:(t={},t[this.initial]=this.states[this.initial].initialStateValue,t)}else n={};return this.__cache.initialStateValue=n,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),e.prototype.getInitialState=function(t,n){this._init();var r=this.getStateNodes(t);return this.resolveTransition({configuration:r,entrySet:pe([],ee(r),!1),exitSet:[],transitions:[],source:void 0,actions:[]},void 0,n!=null?n:this.machine.context,void 0)},Object.defineProperty(e.prototype,"initialState",{get:function(){var t=this.initialStateValue;if(!t)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){var t;if(this.type==="history"){var n=this.config;se(n.target)?t=Wt(n.target)?Br(this.machine.getStateNodeById(n.target).path.slice(this.path.length-1)):n.target:t=n.target}return t},enumerable:!1,configurable:!0}),e.prototype.getRelativeStateNodes=function(t,n,r){return r===void 0&&(r=!0),r?t.type==="history"?t.resolveHistory(n):t.initialStateNodes:[t]},Object.defineProperty(e.prototype,"initialStateNodes",{get:function(){var t=this;if(Gr(this))return[this];if(this.type==="compound"&&!this.initial)return[this];var n=kr(this.initialStateValue);return ve(n.map(function(r){return t.getFromRelativePath(r)}))},enumerable:!1,configurable:!0}),e.prototype.getFromRelativePath=function(t){if(!t.length)return[this];var n=ee(t),r=n[0],i=n.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(r,"' from node with no states"));var o=this.getStateNode(r);if(o.type==="history")return o.resolveHistory();if(!this.states[r])throw new Error("Child state '".concat(r,"' does not exist on '").concat(this.id,"'"));return this.states[r].getFromRelativePath(i)},e.prototype.historyValue=function(t){if(!!Object.keys(this.states).length)return{current:t||this.initialStateValue,states:Ao(this.states,function(n,r){if(!t)return n.historyValue();var i=se(t)?void 0:t[r];return n.historyValue(i||n.initialStateValue)},function(n){return!n.history})}},e.prototype.resolveHistory=function(t){var n=this;if(this.type!=="history")return[this];var r=this.parent;if(!t){var i=this.target;return i?ve(kr(i).map(function(l){return r.getFromRelativePath(l)})):r.initialStateNodes}var o=Vc(r.path,"states")(t).current;return se(o)?[r.getStateNode(o)]:ve(kr(o).map(function(l){return n.history==="deep"?r.getFromRelativePath(l):[r.states[l[0]]]}))},Object.defineProperty(e.prototype,"stateIds",{get:function(){var t=this,n=ve(Object.keys(this.states).map(function(r){return t.states[r].stateIds}));return[this.id].concat(n)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"events",{get:function(){var t,n,r,i;if(this.__cache.events)return this.__cache.events;var o=this.states,l=new Set(this.ownEvents);if(o)try{for(var c=te(Object.keys(o)),s=c.next();!s.done;s=c.next()){var u=s.value,f=o[u];if(f.states)try{for(var a=(r=void 0,te(f.events)),d=a.next();!d.done;d=a.next()){var p=d.value;l.add("".concat(p))}}catch(h){r={error:h}}finally{try{d&&!d.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}}}catch(h){t={error:h}}finally{try{s&&!s.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}return this.__cache.events=Array.from(l)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ownEvents",{get:function(){var t=new Set(this.transitions.filter(function(n){return!(!n.target&&!n.actions.length&&n.internal)}).map(function(n){return n.eventType}));return Array.from(t)},enumerable:!1,configurable:!0}),e.prototype.resolveTarget=function(t){var n=this;if(t!==void 0)return t.map(function(r){if(!se(r))return r;var i=r[0]===n.delimiter;if(i&&!n.parent)return n.getStateNodeByPath(r.slice(1));var o=i?n.key+r:r;if(n.parent)try{var l=n.parent.getStateNodeByPath(o);return l}catch(c){throw new Error("Invalid transition definition for state node '".concat(n.id,`':
`).concat(c.message))}else return n.getStateNodeByPath(o)})},e.prototype.formatTransition=function(t){var n=this,r=Kc(t.target),i="internal"in t?t.internal:r?r.some(function(s){return se(s)&&s[0]===n.delimiter}):!0,o=this.machine.options.guards,l=this.resolveTarget(r),c=M(M({},t),{actions:Et(Ze(t.actions)),cond:Da(t.cond,o),target:l,source:this,internal:i,eventType:t.event,toJSON:function(){return M(M({},c),{target:c.target?c.target.map(function(s){return"#".concat(s.id)}):void 0,source:"#".concat(n.id)})}});return c},e.prototype.formatTransitions=function(){var t,n,r=this,i;if(!this.config.on)i=[];else if(Array.isArray(this.config.on))i=this.config.on;else{var o=this.config.on,l=ai,c=o[l],s=c===void 0?[]:c,u=oo(o,[typeof l=="symbol"?l:l+""]);i=ve(Object.keys(u).map(function(y){var b=$t(y,u[y]);return b}).concat($t(ai,s)))}var f=this.config.always?$t("",this.config.always):[],a=this.config.onDone?$t(String(pr(this.id)),this.config.onDone):[],d=ve(this.invoke.map(function(y){var b=[];return y.onDone&&b.push.apply(b,pe([],ee($t(String(Rr(y.id)),y.onDone)),!1)),y.onError&&b.push.apply(b,pe([],ee($t(String(kn(y.id)),y.onError)),!1)),b})),p=this.after,h=ve(pe(pe(pe(pe([],ee(a),!1),ee(d),!1),ee(i),!1),ee(f),!1).map(function(y){return Ze(y).map(function(b){return r.formatTransition(b)})}));try{for(var g=te(p),m=g.next();!m.done;m=g.next()){var v=m.value;h.push(v)}}catch(y){t={error:y}}finally{try{m&&!m.done&&(n=g.return)&&n.call(g)}finally{if(t)throw t.error}}return h},e}(),Bo=!1;function ir(e,t){return!ka&&!e.predictableActionArguments&&!Bo&&(Bo=!0,console.warn("It is highly recommended to set `predictableActionArguments` to `true` when using `createMachine`. https://xstate.js.org/docs/guides/actions.html")),new Ou(e,t)}var wu=au,Du=Jn;Jn.default=Jn;Jn.stable=za;Jn.stableStringify=za;var xr="[...]",xa="[Circular]",jt=[],It=[];function Ua(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function Jn(e,t,n,r){typeof r>"u"&&(r=Ua()),ki(e,"",0,[],void 0,0,r);var i;try{It.length===0?i=JSON.stringify(e,t,n):i=JSON.stringify(e,Ha(t),n)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;jt.length!==0;){var o=jt.pop();o.length===4?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}}return i}function Kt(e,t,n,r){var i=Object.getOwnPropertyDescriptor(r,n);i.get!==void 0?i.configurable?(Object.defineProperty(r,n,{value:e}),jt.push([r,n,t,i])):It.push([t,n,e]):(r[n]=e,jt.push([r,n,t]))}function ki(e,t,n,r,i,o,l){o+=1;var c;if(typeof e=="object"&&e!==null){for(c=0;c<r.length;c++)if(r[c]===e){Kt(xa,e,t,i);return}if(typeof l.depthLimit<"u"&&o>l.depthLimit){Kt(xr,e,t,i);return}if(typeof l.edgesLimit<"u"&&n+1>l.edgesLimit){Kt(xr,e,t,i);return}if(r.push(e),Array.isArray(e))for(c=0;c<e.length;c++)ki(e[c],c,c,r,e,o,l);else{var s=Object.keys(e);for(c=0;c<s.length;c++){var u=s[c];ki(e[u],u,c,r,e,o,l)}}r.pop()}}function Au(e,t){return e<t?-1:e>t?1:0}function za(e,t,n,r){typeof r>"u"&&(r=Ua());var i=Ri(e,"",0,[],void 0,0,r)||e,o;try{It.length===0?o=JSON.stringify(i,t,n):o=JSON.stringify(i,Ha(t),n)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;jt.length!==0;){var l=jt.pop();l.length===4?Object.defineProperty(l[0],l[1],l[3]):l[0][l[1]]=l[2]}}return o}function Ri(e,t,n,r,i,o,l){o+=1;var c;if(typeof e=="object"&&e!==null){for(c=0;c<r.length;c++)if(r[c]===e){Kt(xa,e,t,i);return}try{if(typeof e.toJSON=="function")return}catch{return}if(typeof l.depthLimit<"u"&&o>l.depthLimit){Kt(xr,e,t,i);return}if(typeof l.edgesLimit<"u"&&n+1>l.edgesLimit){Kt(xr,e,t,i);return}if(r.push(e),Array.isArray(e))for(c=0;c<e.length;c++)Ri(e[c],c,c,r,e,o,l);else{var s={},u=Object.keys(e).sort(Au);for(c=0;c<u.length;c++){var f=u[c];Ri(e[f],f,c,r,e,o,l),s[f]=e[f]}if(typeof i<"u")jt.push([i,t,e]),i[t]=s;else return s}r.pop()}}function Ha(e){return e=typeof e<"u"?e:function(t,n){return n},function(t,n){if(It.length>0)for(var r=0;r<It.length;r++){var i=It[r];if(i[1]===t&&i[0]===n){n=i[2],It.splice(r,1);break}}return e.call(this,t,n)}}const Iu=Du;function jo(e){return typeof e=="function"?e():e}function Pi(e,t){try{return JSON.stringify(e,t)}catch{return Iu(e,t)}}function $a(e,t,n){var r,i,o={};try{for(var l=Bc(t),c=l.next();!c.done;c=l.next()){var s=c.value;o[s]=e[s]}}catch(f){r={error:f}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}var u=JSON.parse(Pi(o,n));return Pi(at(at({},e),u))}function Oi(e,t){e.machine,e.configuration,e.history;var n=Nc(e,["machine","configuration","history"]);return $a(n,["context","event","_event"],t)}function Va(e,t){return $a(e.definition,["context"],t)}function Mu(e,t){e===void 0&&(e=globalThis.__xstate__);var n=new Map,r=e.onRegister(function(i){n.set(i.sessionId,i)});return ir({initial:"pendingConnection",context:{client:void 0},states:{pendingConnection:{},connected:{on:{"service.state":{actions:function(i,o){return i.client.send(o)}},"service.event":{actions:function(i,o){return i.client.send(o)}},"service.register":{actions:function(i,o){return i.client.send(o)}},"service.stop":{actions:function(i,o){return i.client.send(o)}},"xstate.event":{actions:function(i,o){var l=o.event,c=JSON.parse(l),s=n.get(c.origin);s==null||s.send(c)}},unload:{actions:function(i){i.client.send({type:"xstate.disconnect"})}},disconnect:"disconnected"}},disconnected:{entry:function(){r.unsubscribe()},type:"final"}},on:{"xstate.inspecting":{target:".connected",actions:[wu({client:function(i,o){return o.client}}),function(i){e.services.forEach(function(o){var l;(l=i.client)===null||l===void 0||l.send({type:"service.register",machine:Va(o.machine,t==null?void 0:t.serialize),state:Oi(o.state||o.initialState,t==null?void 0:t.serialize),sessionId:o.sessionId})})}]}}})}var li=new Map;function Lu(){var e=new Set,t=new Set;return{services:e,register:function(n){e.add(n),li.set(n.sessionId,n),t.forEach(function(r){return r(n)}),n.onStop(function(){e.delete(n),li.delete(n.sessionId)})},unregister:function(n){e.delete(n),li.delete(n.sessionId)},onRegister:function(n){return t.add(n),e.forEach(function(r){return n(r)}),{unsubscribe:function(){t.delete(n)}}}}}var Nu={url:"https://stately.ai/viz?inspect",iframe:function(){return document.querySelector("iframe[data-xstate]")},devTools:function(){var e=Lu();return globalThis.__xstate__=e,e},serialize:void 0},Bu=function(e){var t=at(at({},Nu),e);return at(at({},t),{url:new URL(t.url),iframe:jo(t.iframe),devTools:jo(t.devTools)})},Fo=new Set;function ju(e){var t=Bu(e),n=t.iframe,r=t.url,i=t.devTools;if(n===null){console.warn("No suitable <iframe> found to embed the inspector. Please pass an <iframe> element to `inspect(iframe)` or create an <iframe data-xstate></iframe> element.");return}var o=Mu(i,e),l=mn(o).start(),c=new Set,s=l.subscribe(function(p){c.forEach(function(h){return h.next(p)})}),u,f,a=function(p){if(typeof p.data=="object"&&p.data!==null&&"type"in p.data){n&&!u&&(u=n.contentWindow),f||(f={send:function(g){u.postMessage(g,r.origin)}});var h=at(at({},p.data),{client:f});l.send(h)}};window.addEventListener("message",a),window.addEventListener("unload",function(){l.send({type:"unload"})});var d=function(p){return Pi(p,e==null?void 0:e.serialize)};return i.onRegister(function(p){var h,g=p.state||p.initialState;if(l.send({type:"service.register",machine:Va(p.machine,e==null?void 0:e.serialize),state:Oi(g,e==null?void 0:e.serialize),sessionId:p.sessionId,id:p.id,parent:(h=p.parent)===null||h===void 0?void 0:h.sessionId}),l.send({type:"service.event",event:d(g._event),sessionId:p.sessionId}),!Fo.has(p)){Fo.add(p);var m=p.send.bind(p);p.send=function(y,b){return l.send({type:"service.event",event:d(De(Xr(y,b))),sessionId:p.sessionId}),m(y,b)}}p.subscribe(function(v){v!==void 0&&l.send({type:"service.state",state:Oi(v,e==null?void 0:e.serialize),sessionId:p.sessionId})}),p.onStop(function(){l.send({type:"service.stop",sessionId:p.sessionId})})}),n?(n.addEventListener("load",function(){u=n.contentWindow}),n.setAttribute("src",String(r))):u=window.open(String(r),"xstateinspector"),{send:function(p){l.send(p)},subscribe:function(p,h,g){var m=jn(p,h,g);return c.add(m),m.next(l.state),{unsubscribe:function(){c.delete(m)}}},disconnect:function(){l.send("disconnect"),window.removeEventListener("message",a),s.unsubscribe()}}}function fo(e){const t=e-1;return t*t*t+1}function wi(e,{delay:t=0,duration:n=400,easing:r=Gt}={}){const i=+getComputedStyle(e).opacity;return{delay:t,duration:n,easing:r,css:o=>`opacity: ${o*i}`}}function Fu(e,{delay:t=0,duration:n=400,easing:r=fo,x:i=0,y:o=0,opacity:l=0}={}){const c=getComputedStyle(e),s=+c.opacity,u=c.transform==="none"?"":c.transform,f=s*(1-l);return{delay:t,duration:n,easing:r,css:(a,d)=>`
			transform: ${u} translate(${(1-a)*i}px, ${(1-a)*o}px);
			opacity: ${s-f*d}`}}function Go(e,{delay:t=0,duration:n=400,easing:r=fo}={}){const i=getComputedStyle(e),o=+i.opacity,l=parseFloat(i.height),c=parseFloat(i.paddingTop),s=parseFloat(i.paddingBottom),u=parseFloat(i.marginTop),f=parseFloat(i.marginBottom),a=parseFloat(i.borderTopWidth),d=parseFloat(i.borderBottomWidth);return{delay:t,duration:n,easing:r,css:p=>`overflow: hidden;opacity: ${Math.min(p*20,1)*o};height: ${p*l}px;padding-top: ${p*c}px;padding-bottom: ${p*s}px;margin-top: ${p*u}px;margin-bottom: ${p*f}px;border-top-width: ${p*a}px;border-bottom-width: ${p*d}px;`}}function Gu(e,{from:t,to:n},r={}){const i=getComputedStyle(e),o=i.transform==="none"?"":i.transform,[l,c]=i.transformOrigin.split(" ").map(parseFloat),s=t.left+t.width*l/n.width-(n.left+l),u=t.top+t.height*c/n.height-(n.top+c),{delay:f=0,duration:a=p=>Math.sqrt(p)*120,easing:d=fo}=r;return{delay:f,duration:Y(a)?a(Math.sqrt(s*s+u*u)):a,easing:d,css:(p,h)=>{const g=h*s,m=h*u,v=p+h*t.width/n.width,y=p+h*t.height/n.height;return`transform: ${o} translate(${g}px, ${m}px) scale(${v}, ${y});`}}}const xu={duration:4e3,initial:1,next:0,pausable:!1,dismissable:!0,reversed:!1,intro:{x:256}},Uu=()=>{const{subscribe:e,update:t}=Ue([]);let n=0;const r={},i=u=>u instanceof Object;return{subscribe:e,push:(u,f={})=>{const a={target:"default",...i(u)?u:{...f,msg:u}},d=r[a.target]||{},p={...xu,...d,...a,theme:{...d.theme,...a.theme},classes:[...d.classes||[],...a.classes||[]],id:++n};return t(h=>p.reversed?[...h,p]:[p,...h]),n},pop:u=>{t(f=>{if(!f.length||u===0)return[];if(i(u))return f.filter(d=>u(d));const a=u||Math.max(...f.map(d=>d.id));return f.filter(d=>d.id!==a)})},set:(u,f={})=>{const a=i(u)?{...u}:{...f,id:u};t(d=>{const p=d.findIndex(h=>h.id===a.id);return p>-1&&(d[p]={...d[p],...a}),d})},_init:(u="default",f={})=>(r[u]=f,r)}},Yn=Uu();function xo(e){return Object.prototype.toString.call(e)==="[object Date]"}function Di(e,t){if(e===t||e!==e)return()=>e;const n=typeof e;if(n!==typeof t||Array.isArray(e)!==Array.isArray(t))throw new Error("Cannot interpolate values of different type");if(Array.isArray(e)){const r=t.map((i,o)=>Di(e[o],i));return i=>r.map(o=>o(i))}if(n==="object"){if(!e||!t)throw new Error("Object cannot be null");if(xo(e)&&xo(t)){e=e.getTime(),t=t.getTime();const o=t-e;return l=>new Date(e+l*o)}const r=Object.keys(t),i={};return r.forEach(o=>{i[o]=Di(e[o],t[o])}),o=>{const l={};return r.forEach(c=>{l[c]=i[c](o)}),l}}if(n==="number"){const r=t-e;return i=>e+i*r}throw new Error(`Cannot interpolate ${n} values`)}function zu(e,t={}){const n=Ue(e);let r,i=e;function o(l,c){if(e==null)return n.set(e=l),Promise.resolve();i=l;let s=r,u=!1,{delay:f=0,duration:a=400,easing:d=Gt,interpolate:p=Di}=B(B({},t),c);if(a===0)return s&&(s.abort(),s=null),n.set(e=i),Promise.resolve();const h=Zn()+f;let g;return r=er(m=>{if(m<h)return!0;u||(g=p(e,l),typeof a=="function"&&(a=a(e,l)),u=!0),s&&(s.abort(),s=null);const v=m-h;return v>a?(n.set(e=l),!1):(n.set(e=g(d(v/a))),!0)}),r.promise}return{set:o,update:(l,c)=>o(l(i,e),c),subscribe:n.subscribe}}function Hu(e){let t,n=e[0].msg+"",r;return{c(){t=new Cc(!1),r=dn(),t.a=r},m(i,o){t.m(n,i,o),O(i,r,o)},p(i,o){o&1&&n!==(n=i[0].msg+"")&&t.p(n)},i:he,o:he,d(i){i&&k(r),i&&t.d()}}}function $u(e){let t,n,r;const i=[e[6]()];var o=e[0].component.src;function l(c){let s={};for(let u=0;u<i.length;u+=1)s=B(s,i[u]);return{props:s}}return o&&(t=new o(l())),{c(){t&&oe(t.$$.fragment),n=dn()},m(c,s){t&&re(t,c,s),O(c,n,s),r=!0},p(c,s){const u=s&64?X(i,[Vn(c[6]())]):{};if(o!==(o=c[0].component.src)){if(t){xt();const f=t;E(f.$$.fragment,1,0,()=>{ie(f,1)}),Ut()}o?(t=new o(l()),oe(t.$$.fragment),S(t.$$.fragment,1),re(t,n.parentNode,n)):t=null}else o&&t.$set(u)},i(c){r||(t&&S(t.$$.fragment,c),r=!0)},o(c){t&&E(t.$$.fragment,c),r=!1},d(c){c&&k(n),t&&ie(t,c)}}}function Uo(e){let t,n,r;return{c(){t=N("div"),t.textContent="\u2715",K(t,"class","_toastBtn pe svelte-5er0t9"),K(t,"role","button"),K(t,"tabindex","-1")},m(i,o){O(i,t,o),n||(r=Se(t,"click",e[3]),n=!0)},p:he,d(i){i&&k(t),n=!1,r()}}}function Vu(e){let t,n,r,i,o,l,c,s,u,f;const a=[$u,Hu],d=[];function p(g,m){return g[0].component?0:1}r=p(e),i=d[r]=a[r](e);let h=e[0].dismissable&&Uo(e);return{c(){t=N("div"),n=N("div"),i.c(),o=ke(),h&&h.c(),l=ke(),c=N("progress"),K(n,"role","status"),K(n,"class","_toastMsg svelte-5er0t9"),lr(n,"pe",e[0].component),K(c,"class","_toastBar svelte-5er0t9"),c.value=e[1],K(t,"class","_toastItem svelte-5er0t9"),lr(t,"pe",e[0].pausable)},m(g,m){O(g,t,m),ot(t,n),d[r].m(n,null),ot(t,o),h&&h.m(t,null),ot(t,l),ot(t,c),s=!0,u||(f=[Se(t,"mouseenter",e[4]),Se(t,"mouseleave",e[5])],u=!0)},p(g,[m]){let v=r;r=p(g),r===v?d[r].p(g,m):(xt(),E(d[v],1,1,()=>{d[v]=null}),Ut(),i=d[r],i?i.p(g,m):(i=d[r]=a[r](g),i.c()),S(i,1),i.m(n,null)),(!s||m&1)&&lr(n,"pe",g[0].component),g[0].dismissable?h?h.p(g,m):(h=Uo(g),h.c(),h.m(t,l)):h&&(h.d(1),h=null),(!s||m&2)&&(c.value=g[1]),(!s||m&1)&&lr(t,"pe",g[0].pausable)},i(g){s||(S(i),s=!0)},o(g){E(i),s=!1},d(g){g&&k(t),d[r].d(),h&&h.d(),u=!1,z(f)}}}function Wu(e,t,n){let r,{item:i}=t;const o=zu(i.initial,{duration:i.duration,easing:Gt});ut(e,o,h=>n(1,r=h));const l=()=>Yn.pop(i.id),c=()=>{(r===1||r===0)&&l()};let s=i.initial,u=s,f=!1;const a=()=>{i.pausable&&!f&&r!==s&&(o.set(r,{duration:0}),f=!0)},d=()=>{if(f){const h=i.duration,g=h-h*((r-u)/(s-u));o.set(s,{duration:g}).then(c),f=!1}},p=()=>{const{props:h={},sendIdTo:g}=i.component;return g&&(h[g]=i.id),h};return Mt(()=>{typeof i.onpop=="function"&&i.onpop(i.id)}),e.$$set=h=>{"item"in h&&n(0,i=h.item)},e.$$.update=()=>{e.$$.dirty&1&&typeof i.progress<"u"&&n(0,i.next=i.progress,i),e.$$.dirty&131&&s!==i.next&&(n(7,s=i.next),u=r,f=!1,o.set(s).then(c))},[i,r,o,l,a,d,p,s]}class qu extends Pe{constructor(t){super(),Re(this,t,Wu,Vu,Te,{item:0})}}function zo(e,t,n){const r=e.slice();return r[5]=t[n],r}function Ho(e,t){let n,r,i,o,l,c,s,u,f=he,a;return r=new qu({props:{item:t[5]}}),{key:e,first:null,c(){n=N("li"),oe(r.$$.fragment),i=ke(),K(n,"class",o=Po(t[5].classes.join(" "))+" svelte-yh90az"),K(n,"style",l=t[1](t[5].theme)),this.first=n},m(d,p){O(d,n,p),re(r,n,null),ot(n,i),a=!0},p(d,p){t=d;const h={};p&1&&(h.item=t[5]),r.$set(h),(!a||p&1&&o!==(o=Po(t[5].classes.join(" "))+" svelte-yh90az"))&&K(n,"class",o),(!a||p&1&&l!==(l=t[1](t[5].theme)))&&K(n,"style",l)},r(){u=n.getBoundingClientRect()},f(){Rc(n),f(),ga(n,u)},a(){f(),f=kc(n,u,Gu,{duration:200})},i(d){a||(S(r.$$.fragment,d),_t(()=>{s&&s.end(1),c=wc(n,Fu,t[5].intro),c.start()}),a=!0)},o(d){E(r.$$.fragment,d),c&&c.invalidate(),s=Dc(n,wi,{}),a=!1},d(d){d&&k(n),ie(r),d&&s&&s.end()}}}function Ju(e){let t,n=[],r=new Map,i,o=e[0];const l=c=>c[5].id;for(let c=0;c<o.length;c+=1){let s=zo(e,o,c),u=l(s);r.set(u,n[c]=Ho(u,s))}return{c(){t=N("ul");for(let c=0;c<n.length;c+=1)n[c].c();K(t,"class","_toastContainer svelte-yh90az")},m(c,s){O(c,t,s);for(let u=0;u<n.length;u+=1)n[u].m(t,null);i=!0},p(c,[s]){if(s&3){o=c[0],xt();for(let u=0;u<n.length;u+=1)n[u].r();n=Mc(n,s,l,1,c,o,r,t,Ic,Ho,null,zo);for(let u=0;u<n.length;u+=1)n[u].a();Ut()}},i(c){if(!i){for(let s=0;s<o.length;s+=1)S(n[s]);i=!0}},o(c){for(let s=0;s<n.length;s+=1)E(n[s]);i=!1},d(c){c&&k(t);for(let s=0;s<n.length;s+=1)n[s].d()}}}function Yu(e,t,n){let r;ut(e,Yn,s=>n(4,r=s));let{options:i={}}=t,{target:o="default"}=t,l;const c=s=>Object.keys(s).reduce((u,f)=>`${u}${f}:${s[f]};`,"");return e.$$set=s=>{"options"in s&&n(2,i=s.options),"target"in s&&n(3,o=s.target)},e.$$.update=()=>{e.$$.dirty&12&&Yn._init(o,i),e.$$.dirty&24&&n(0,l=r.filter(s=>s.target===o))},[l,c,i,o,r]}class Xu extends Pe{constructor(t){super(),Re(this,t,Yu,Ju,Te,{options:2,target:3})}}var Fn;(function(e){e[e.Open=0]="Open",e[e.Closed=1]="Closed"})(Fn||(Fn={}));const Qu="headlessui-open-closed-context";function Ku(){return pn(Qu)}function Ai(e,t,...n){if(e in t){let i=t[e];return typeof i=="function"?i(...n):i}let r=new Error(`Tried to handle "${e}" but there is no handler defined. Only defined handlers are: ${Object.keys(t).map(i=>`"${i}"`).join(", ")}.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,Ai),r}let Zu=0;function ef(){return++Zu}function Qr(){return ef()}let qt=new Set,St=new Map;function $o(e){e.setAttribute("aria-hidden","true"),e.inert=!0}function Vo(e){let t=St.get(e);!t||(t["aria-hidden"]===null?e.removeAttribute("aria-hidden"):e.setAttribute("aria-hidden",t["aria-hidden"]),e.inert=t.inert)}function tf(e,t=!0){if(!t||!e)return;let n=e;qt.add(n);for(let r of St.keys())r.contains(n)&&(Vo(r),St.delete(r));return document.querySelectorAll("body > *").forEach(r=>{if(r instanceof HTMLElement){for(let i of qt)if(r.contains(i))return;qt.size===1&&(St.set(r,{"aria-hidden":r.getAttribute("aria-hidden"),inert:r.inert}),$o(r))}}),()=>{if(qt.delete(n),qt.size>0)document.querySelectorAll("body > *").forEach(r=>{if(r instanceof HTMLElement&&!St.has(r)){for(let i of qt)if(r.contains(i))return;St.set(r,{"aria-hidden":r.getAttribute("aria-hidden"),inert:r.inert}),$o(r)}});else for(let r of St.keys())Vo(r),St.delete(r)}}function Ii(e,t){for(let n of e)if(n.contains(t))return!0;return!1}var Ur;(function(e){e.Space=" ",e.Enter="Enter",e.Escape="Escape",e.Backspace="Backspace",e.ArrowLeft="ArrowLeft",e.ArrowUp="ArrowUp",e.ArrowRight="ArrowRight",e.ArrowDown="ArrowDown",e.Home="Home",e.End="End",e.PageUp="PageUp",e.PageDown="PageDown",e.Tab="Tab"})(Ur||(Ur={}));let nf=["[contentEditable=true]","[tabindex]","a[href]","area[href]","button:not([disabled])","iframe","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].map(e=>`${e}:not([tabindex='-1'])`).join(",");var je;(function(e){e[e.First=1]="First",e[e.Previous=2]="Previous",e[e.Next=4]="Next",e[e.Last=8]="Last",e[e.WrapAround=16]="WrapAround",e[e.NoScroll=32]="NoScroll"})(je||(je={}));var kt;(function(e){e[e.Error=0]="Error",e[e.Overflow=1]="Overflow",e[e.Success=2]="Success",e[e.Underflow=3]="Underflow"})(kt||(kt={}));var zr;(function(e){e[e.Previous=-1]="Previous",e[e.Next=1]="Next"})(zr||(zr={}));function rf(e=document.body){return e==null?[]:Array.from(e.querySelectorAll(nf))}var Wo;(function(e){e[e.Strict=0]="Strict",e[e.Loose=1]="Loose"})(Wo||(Wo={}));function _n(e){e==null||e.focus({preventScroll:!0})}function qo(e,t){let n=Array.isArray(e)?e:rf(e),r=document.activeElement,i=(()=>{if(t&(je.First|je.Next))return zr.Next;if(t&(je.Previous|je.Last))return zr.Previous;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),o=(()=>{if(t&je.First)return 0;if(t&je.Previous)return Math.max(0,n.indexOf(r))-1;if(t&je.Next)return Math.max(0,n.indexOf(r))+1;if(t&je.Last)return n.length-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),l=t&je.NoScroll?{preventScroll:!0}:{},c=0,s=n.length,u;do{if(c>=s||c+s<=0)return kt.Error;let f=o+c;if(t&je.WrapAround)f=(f+s)%s;else{if(f<0)return kt.Underflow;if(f>=s)return kt.Overflow}u=n[f],u==null||u.focus(l),c+=i}while(u!==document.activeElement);return u.hasAttribute("tabindex")||u.setAttribute("tabindex","0"),kt.Success}const{window:Jo}=ba;function of(e){let t,n;return{c:he,m(r,i){t||(n=[Se(Jo,"keydown",e[0]),Se(Jo,"focus",e[1],!0)],t=!0)},p:he,i:he,o:he,d(r){t=!1,z(n)}}}function sf(e,t,n){let{containers:r}=t,{enabled:i=!0}=t,{options:o={}}=t,l=typeof window<"u"?document.activeElement:null,c=null;async function s(){if(!i||r.size!==1)return;let{initialFocus:p}=o;await no();let h=document.activeElement;if(p){if(p===h)return}else if(Ii(r,h))return;if(l=h,p)_n(p);else{let g=!1;for(let m of r)if(qo(m,je.First)===kt.Success){g=!0;break}g||console.warn("There are no focusable elements inside the <FocusTrap />")}c=document.activeElement}function u(){_n(l),l=null,c=null}tr(s);let f=!1;Mt(()=>{f=!0,u()});function a(p){if(!!i&&p.key===Ur.Tab&&!!document.activeElement&&r.size===1){p.preventDefault();for(let h of r)if(qo(h,(p.shiftKey?je.Previous:je.Next)|je.WrapAround)===kt.Success){c=document.activeElement;break}}}function d(p){if(p.target===window.document.body||!i||r.size!==1||f)return;let h=c;if(!h)return;let g=p.target;g&&g instanceof HTMLElement?Ii(r,g)?(c=g,_n(g)):(p.preventDefault(),p.stopPropagation(),_n(h)):_n(c)}return e.$$set=p=>{"containers"in p&&n(2,r=p.containers),"enabled"in p&&n(3,i=p.enabled),"options"in p&&n(4,o=p.options)},e.$$.update=()=>{e.$$.dirty&12&&(i&&r?s():u())},[a,d,r,i,o]}class af extends Pe{constructor(t){super(),Re(this,t,sf,of,Te,{containers:2,enabled:3,options:4})}}function lf(e){let t;const n=e[4].default,r=V(n,e,e[3],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),t=!0},p(i,[o]){r&&r.p&&(!t||o&8)&&q(r,n,i,i[3],t?W(n,i[3],o,null):J(i[3]),null)},i(i){t||(S(r,i),t=!0)},o(i){E(r,i),t=!1},d(i){r&&r.d(i)}}}var on;(function(e){e[e.Add=0]="Add",e[e.Remove=1]="Remove"})(on||(on={}));const Yo="headlessui-stack-context";function cf(e,t,n){let r,{$$slots:i={},$$scope:o}=t,{onUpdate:l}=t,{element:c}=t;function s(...f){l==null||l(...f),u==null||u(...f)}let u=pn(Yo);return rr(Yo,s),Mt(()=>{r&&r()}),e.$$set=f=>{"onUpdate"in f&&n(0,l=f.onUpdate),"element"in f&&n(1,c=f.element),"$$scope"in f&&n(3,o=f.$$scope)},e.$$.update=()=>{e.$$.dirty&6&&n(2,r=(()=>{if(r&&r(),!c)return null;let f=c;return s(on.Add,f),()=>s(on.Remove,f)})())},[l,c,r,o,i]}class uf extends Pe{constructor(t){super(),Re(this,t,cf,lf,Te,{onUpdate:0,element:1})}}const ff=e=>({describedby:e&1}),Xo=e=>({describedby:e[0].descriptionIds});function df(e){let t;const n=e[6].default,r=V(n,e,e[5],Xo);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),t=!0},p(i,[o]){r&&r.p&&(!t||o&33)&&q(r,n,i,i[5],t?W(n,i[5],o,ff):J(i[5]),Xo)},i(i){t||(S(r,i),t=!0)},o(i){E(r,i),t=!1},d(i){r&&r.d(i)}}}const Wa="headlessui-description-context";function pf(){return pn(Wa)}function hf(e,t,n){const r=["name","slotProps"];let i=Xe(t,r),o,{$$slots:l={},$$scope:c}=t,{name:s}=t,{slotProps:u={}}=t,f=[],a=Ue({name:s,slotProps:u,props:i,register:d});ut(e,a,p=>n(0,o=p)),rr(Wa,a);function d(p){return n(4,f=[...f,p]),()=>{n(4,f=f.filter(h=>h!==p))}}return e.$$set=p=>{t=B(B({},t),fn(p)),n(8,i=Xe(t,r)),"name"in p&&n(2,s=p.name),"slotProps"in p&&n(3,u=p.slotProps),"$$scope"in p&&n(5,c=p.$$scope)},e.$$.update=()=>{a.set({name:s,slotProps:u,props:i,register:d,descriptionIds:f.length>0?f.join(" "):void 0})},[o,a,s,u,f,c,l]}class mf extends Pe{constructor(t){super(),Re(this,t,hf,df,Te,{name:2,slotProps:3})}}function gf(e){let t;const n=e[2].default,r=V(n,e,e[1],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),t=!0},p(i,[o]){r&&r.p&&(!t||o&2)&&q(r,n,i,i[1],t?W(n,i[1],o,null):J(i[1]),null)},i(i){t||(S(r,i),t=!0)},o(i){E(r,i),t=!1},d(i){r&&r.d(i)}}}const qa="headlessui-force-portal-root-context";function vf(){return pn(qa)}function yf(e,t,n){let{$$slots:r={},$$scope:i}=t,{force:o}=t;return rr(qa,Ue(o)),e.$$set=l=>{"force"in l&&n(0,o=l.force),"$$scope"in l&&n(1,i=l.$$scope)},[o,i,r]}class Ja extends Pe{constructor(t){super(),Re(this,t,yf,gf,Te,{force:0})}}function _f(e){let t;const n=e[2].default,r=V(n,e,e[1],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),t=!0},p(i,[o]){r&&r.p&&(!t||o&2)&&q(r,n,i,i[1],t?W(n,i[1],o,null):J(i[1]),null)},i(i){t||(S(r,i),t=!0)},o(i){E(r,i),t=!1},d(i){r&&r.d(i)}}}const Ya="headlessui-portal-group-context";function bf(){return pn(Ya)}function Cf(e,t,n){let{$$slots:r={},$$scope:i}=t,{target:o}=t,l=Ue(o);return rr(Ya,l),e.$$set=c=>{"target"in c&&n(0,o=c.target),"$$scope"in c&&n(1,i=c.$$scope)},e.$$.update=()=>{e.$$.dirty&1&&l.set(o)},[o,i,r]}class Sf extends Pe{constructor(t){super(),Re(this,t,Cf,_f,Te,{target:0})}}function Tf(e,t){return t&&t.append(e),{update(n){t=n,n.append(e)},destroy(){var n;t!=null&&t.contains(e)&&t.removeChild(e),t&&t.childNodes.length<=0&&((n=t.parentElement)==null||n.removeChild(t))}}}function Ef(e){let t,n,r,i,o;const l=e[6].default,c=V(l,e,e[5],null);return{c(){t=N("div"),c&&c.c()},m(s,u){O(s,t,u),c&&c.m(t,null),r=!0,i||(o=D(n=Tf.call(null,t,e[0])),i=!0)},p(s,[u]){c&&c.p&&(!r||u&32)&&q(c,l,s,s[5],r?W(l,s[5],u,null):J(s[5]),null),n&&Y(n.update)&&u&1&&n.update.call(null,s[0])},i(s){r||(S(c,s),r=!0)},o(s){E(c,s),r=!1},d(s){s&&k(t),c&&c.d(s),i=!1,o()}}}function kf(e,t,n){let r,i,o,{$$slots:l={},$$scope:c}=t,s=vf();ut(e,s,f=>n(4,o=f));let u=bf();return ut(e,u,f=>n(3,i=f)),e.$$set=f=>{"$$scope"in f&&n(5,c=f.$$scope)},e.$$.update=()=>{e.$$.dirty&24&&n(0,r=(()=>{if(!(s&&o)&&u!==void 0&&i!==null)return i;if(typeof window>"u")return null;let f=document.getElementById("headlessui-portal-root");if(f)return f;let a=document.createElement("div");return a.setAttribute("id","headlessui-portal-root"),no().then(()=>{a!==document.body.lastChild&&document.body.appendChild(a)}),document.body.appendChild(a)})())},[r,s,u,i,o,c,l]}class Rf extends Pe{constructor(t){super(),Re(this,t,kf,Ef,Te,{})}}const Mi="!",Pf=new RegExp(`^[^${Mi}]+(?:${Mi}(?:preventDefault|stopPropagation|passive|nonpassive|capture|once|self))+$`);function or(e,t=[]){let n,r=[];e.$on=(o,l)=>{let c=o,s=()=>{};for(let u of t){if(typeof u=="string"&&u===c){const f=e.$$.callbacks[c]||(e.$$.callbacks[c]=[]);return f.push(l),()=>{const a=f.indexOf(l);a!==-1&&f.splice(a,1)}}if(typeof u=="object"&&u.name===c){let f=l;l=(...a)=>{typeof u=="object"&&u.shouldExclude()||f(...a)}}}return n?s=n(c,l):r.push([c,l]),()=>{s()}};function i(o){Pc(e,o)}return o=>{const l=[],c={};n=(s,u)=>{let f=s,a=u,d=!1;if(f.match(Pf)){const m=f.split(Mi);f=m[0];const v=Object.fromEntries(m.slice(1).map(y=>[y,!0]));v.passive&&(d=d||{},d.passive=!0),v.nonpassive&&(d=d||{},d.passive=!1),v.capture&&(d=d||{},d.capture=!0),v.once&&(d=d||{},d.once=!0),v.preventDefault&&(a=yc(a)),v.stopPropagation&&(a=_c(a))}const h=Se(o,f,a,d),g=()=>{h();const m=l.indexOf(g);m>-1&&l.splice(m,1)};return l.push(g),f in c||(c[f]=Se(o,f,i)),g};for(let s=0;s<r.length;s++)n(r[s][0],r[s][1]);return{destroy:()=>{for(let s=0;s<l.length;s++)l[s]();for(let s of Object.entries(c))s[1]()}}}}const Of=["a","address","article","aside","b","bdi","bdo","blockquote","button","cite","code","data","datalist","dd","dl","dt","div","em","footer","form","h1","h2","h3","h4","h5","h6","header","i","input","label","li","main","nav","ol","p","section","span","strong","ul"];function wf(e){return!(typeof e=="string"&&!Of.includes(e))}function Q(e,t){let n=[];if(t)for(let r=0;r<t.length;r++){const i=t[r],o=Array.isArray(i)?i[0]:i;Array.isArray(i)&&i.length>1?n.push(o(e,i[1])):n.push(o(e))}return{update(r){if((r&&r.length||0)!=n.length)throw new Error("You must not change the length of an actions array.");if(r)for(let i=0;i<r.length;i++){const o=n[i];if(o&&o.update){const l=r[i];Array.isArray(l)&&l.length>1?o.update(l[1]):o.update()}}},destroy(){for(let r=0;r<n.length;r++){const i=n[r];i&&i.destroy&&i.destroy()}}}}var et;(function(e){e[e.None=0]="None",e[e.RenderStrategy=1]="RenderStrategy",e[e.Static=2]="Static"})(et||(et={}));function Qo(e){let t,n,r,i;const o=[md,hd,pd,dd,fd,ud,cd,ld,ad,sd,od,id,rd,nd,td,ed,Zf,Kf,Qf,Xf,Yf,Jf,qf,Wf,Vf,$f,Hf,zf,Uf,xf,Gf,Ff,jf,Bf,Nf,Lf,Mf,If,Af,Df],l=[];function c(s,u){return s[1]==="a"?0:s[1]==="address"?1:s[1]==="article"?2:s[1]==="aside"?3:s[1]==="b"?4:s[1]==="bdi"?5:s[1]==="bdo"?6:s[1]==="blockquote"?7:s[1]==="button"?8:s[1]==="cite"?9:s[1]==="code"?10:s[1]==="data"?11:s[1]==="datalist"?12:s[1]==="dd"?13:s[1]==="dl"?14:s[1]==="dt"?15:s[1]==="div"?16:s[1]==="em"?17:s[1]==="footer"?18:s[1]==="form"?19:s[1]==="h1"?20:s[1]==="h2"?21:s[1]==="h3"?22:s[1]==="h4"?23:s[1]==="h5"?24:s[1]==="h6"?25:s[1]==="header"?26:s[1]==="i"?27:s[1]==="input"?28:s[1]==="label"?29:s[1]==="li"?30:s[1]==="main"?31:s[1]==="nav"?32:s[1]==="ol"?33:s[1]==="p"?34:s[1]==="section"?35:s[1]==="span"?36:s[1]==="strong"?37:s[1]==="ul"?38:39}return t=c(e),n=l[t]=o[t](e),{c(){n.c(),r=dn()},m(s,u){l[t].m(s,u),O(s,r,u),i=!0},p(s,u){let f=t;t=c(s),t===f?l[t].p(s,u):(xt(),E(l[f],1,1,()=>{l[f]=null}),Ut(),n=l[t],n?n.p(s,u):(n=l[t]=o[t](s),n.c()),S(n,1),n.m(r.parentNode,r))},i(s){i||(S(n),i=!0)},o(s){E(n),i=!1},d(s){l[t].d(s),s&&k(r)}}}function Df(e){let t,n,r,i;const o=[{use:[...e[2],e[6]]},e[7],e[3],{hidden:e[4]||void 0}];function l(u){e[58](u)}var c=e[1];function s(u){let f={$$slots:{default:[gd]},$$scope:{ctx:u}};for(let a=0;a<o.length;a+=1)f=B(f,o[a]);return u[0]!==void 0&&(f.el=u[0]),{props:f}}return c&&(t=new c(s(e)),U.push(()=>nt(t,"el",l))),{c(){t&&oe(t.$$.fragment),r=dn()},m(u,f){t&&re(t,u,f),O(u,r,f),i=!0},p(u,f){const a=f[0]&220?X(o,[f[0]&68&&{use:[...u[2],u[6]]},f[0]&128&&Vn(u[7]),f[0]&8&&Vn(u[3]),f[0]&16&&{hidden:u[4]||void 0}]):{};if(f[1]&268435456&&(a.$$scope={dirty:f,ctx:u}),!n&&f[0]&1&&(n=!0,a.el=u[0],dt(()=>n=!1)),c!==(c=u[1])){if(t){xt();const d=t;E(d.$$.fragment,1,0,()=>{ie(d,1)}),Ut()}c?(t=new c(s(u)),U.push(()=>nt(t,"el",l)),oe(t.$$.fragment),S(t.$$.fragment,1),re(t,r.parentNode,r)):t=null}else c&&t.$set(a)},i(u){i||(t&&S(t.$$.fragment,u),i=!0)},o(u){t&&E(t.$$.fragment,u),i=!1},d(u){u&&k(r),t&&ie(t,u)}}}function Af(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("ul"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[57](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[57](null),o=!1,z(l)}}}function If(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("strong"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[56](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[56](null),o=!1,z(l)}}}function Mf(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("span"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[55](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[55](null),o=!1,z(l)}}}function Lf(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("section"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[54](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[54](null),o=!1,z(l)}}}function Nf(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("p"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[53](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[53](null),o=!1,z(l)}}}function Bf(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("ol"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[52](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[52](null),o=!1,z(l)}}}function jf(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("nav"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[51](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[51](null),o=!1,z(l)}}}function Ff(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("main"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[50](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[50](null),o=!1,z(l)}}}function Gf(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("li"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[49](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[49](null),o=!1,z(l)}}}function xf(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("label"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[48](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[48](null),o=!1,z(l)}}}function Uf(e){let t,n,r,i,o,l=[e[7],e[3],{hidden:n=e[4]||void 0}],c={};for(let s=0;s<l.length;s+=1)c=B(c,l[s]);return{c(){t=N("input"),A(t,c)},m(s,u){O(s,t,u),t.autofocus&&t.focus(),e[47](t),i||(o=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],i=!0)},p(s,u){A(t,c=X(l,[u[0]&128&&s[7],u[0]&8&&s[3],u[0]&16&&n!==(n=s[4]||void 0)&&{hidden:n}])),r&&Y(r.update)&&u[0]&4&&r.update.call(null,s[2])},i:he,o:he,d(s){s&&k(t),e[47](null),i=!1,z(o)}}}function zf(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("i"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[46](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[46](null),o=!1,z(l)}}}function Hf(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("header"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[45](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[45](null),o=!1,z(l)}}}function $f(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("h6"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[44](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[44](null),o=!1,z(l)}}}function Vf(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("h5"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[43](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[43](null),o=!1,z(l)}}}function Wf(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("h4"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[42](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[42](null),o=!1,z(l)}}}function qf(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("h3"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[41](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[41](null),o=!1,z(l)}}}function Jf(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("h2"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[40](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[40](null),o=!1,z(l)}}}function Yf(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("h1"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[39](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[39](null),o=!1,z(l)}}}function Xf(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("form"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[38](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[38](null),o=!1,z(l)}}}function Qf(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("footer"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[37](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[37](null),o=!1,z(l)}}}function Kf(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("em"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[36](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[36](null),o=!1,z(l)}}}function Zf(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("div"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[35](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[35](null),o=!1,z(l)}}}function ed(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("dt"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[34](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[34](null),o=!1,z(l)}}}function td(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("dl"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[33](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[33](null),o=!1,z(l)}}}function nd(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("dd"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[32](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[32](null),o=!1,z(l)}}}function rd(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("datalist"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[31](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[31](null),o=!1,z(l)}}}function id(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("data"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[30](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[30](null),o=!1,z(l)}}}function od(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("code"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[29](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[29](null),o=!1,z(l)}}}function sd(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("cite"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[28](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[28](null),o=!1,z(l)}}}function ad(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("button"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),t.autofocus&&t.focus(),e[27](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[27](null),o=!1,z(l)}}}function ld(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("blockquote"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[26](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[26](null),o=!1,z(l)}}}function cd(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("bdo"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[25](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[25](null),o=!1,z(l)}}}function ud(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("bdi"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[24](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[24](null),o=!1,z(l)}}}function fd(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("b"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[23](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[23](null),o=!1,z(l)}}}function dd(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("aside"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[22](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[22](null),o=!1,z(l)}}}function pd(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("article"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[21](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[21](null),o=!1,z(l)}}}function hd(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("address"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[20](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[20](null),o=!1,z(l)}}}function md(e){let t,n,r,i,o,l;const c=e[18].default,s=V(c,e,e[59],null);let u=[e[7],e[3],{hidden:n=e[4]||void 0}],f={};for(let a=0;a<u.length;a+=1)f=B(f,u[a]);return{c(){t=N("a"),s&&s.c(),A(t,f)},m(a,d){O(a,t,d),s&&s.m(t,null),e[19](t),i=!0,o||(l=[D(r=Q.call(null,t,e[2])),D(e[6].call(null,t))],o=!0)},p(a,d){s&&s.p&&(!i||d[1]&268435456)&&q(s,c,a,a[59],i?W(c,a[59],d,null):J(a[59]),null),A(t,f=X(u,[d[0]&128&&a[7],d[0]&8&&a[3],(!i||d[0]&16&&n!==(n=a[4]||void 0))&&{hidden:n}])),r&&Y(r.update)&&d[0]&4&&r.update.call(null,a[2])},i(a){i||(S(s,a),i=!0)},o(a){E(s,a),i=!1},d(a){a&&k(t),s&&s.d(a),e[19](null),o=!1,z(l)}}}function gd(e){let t;const n=e[18].default,r=V(n,e,e[59],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),t=!0},p(i,o){r&&r.p&&(!t||o[1]&268435456)&&q(r,n,i,i[59],t?W(n,i[59],o,null):J(i[59]),null)},i(i){t||(S(r,i),t=!0)},o(i){E(r,i),t=!1},d(i){r&&r.d(i)}}}function vd(e){let t,n,r=e[5]&&Qo(e);return{c(){r&&r.c(),t=dn()},m(i,o){r&&r.m(i,o),O(i,t,o),n=!0},p(i,o){i[5]?r?(r.p(i,o),o[0]&32&&S(r,1)):(r=Qo(i),r.c(),S(r,1),r.m(t.parentNode,t)):r&&(xt(),E(r,1,1,()=>{r=null}),Ut())},i(i){n||(S(r),n=!0)},o(i){E(r),n=!1},d(i){r&&r.d(i),i&&k(t)}}}var Ko;(function(e){e[e.Unmount=0]="Unmount",e[e.Hidden=1]="Hidden"})(Ko||(Ko={}));function yd(e,t,n){let r,i,o,l,c;const s=["name","as","slotProps","el","use","visible","features","unmount","static","class","style"];let u=Xe(t,s),{$$slots:f={},$$scope:a}=t;const d=or(ht());let{name:p}=t,{as:h}=t,{slotProps:g}=t,{el:m=null}=t,{use:v=[]}=t,{visible:y=!0}=t,{features:b=et.None}=t,{unmount:P=!0}=t,{static:T=!1}=t,{class:w=void 0}=t,{style:R=void 0}=t;if(!h)throw new Error(`<${p}> did not provide an \`as\` value to <Render>`);if(!wf(h))throw new Error(`<${p}> has an invalid or unsupported \`as\` prop: ${h}`);function I(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function j(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function C(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function H(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function Z(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function ne(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function ue(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function _e(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function $e(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function Ee(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function x(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function le(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function Ve(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function me(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function rt(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function Ct(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function ce(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function Oe(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function Ke(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function vn(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function zt(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function we(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function ar(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function ii(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function Yl(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function Xl(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function Ql(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function Kl(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function Zl(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function ec(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function tc(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function nc(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function rc(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function ic(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function oc(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function sc(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function ac(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function lc(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function cc(_){U[_?"unshift":"push"](()=>{m=_,n(0,m)})}function uc(_){m=_,n(0,m)}return e.$$set=_=>{t=B(B({},t),fn(_)),n(7,u=Xe(t,s)),"name"in _&&n(8,p=_.name),"as"in _&&n(1,h=_.as),"slotProps"in _&&n(9,g=_.slotProps),"el"in _&&n(0,m=_.el),"use"in _&&n(2,v=_.use),"visible"in _&&n(10,y=_.visible),"features"in _&&n(11,b=_.features),"unmount"in _&&n(12,P=_.unmount),"static"in _&&n(13,T=_.static),"class"in _&&n(14,w=_.class),"style"in _&&n(15,R=_.style),"$$scope"in _&&n(59,a=_.$$scope)},e.$$.update=()=>{e.$$.dirty[0]&16896&&n(17,r=typeof w=="function"?w(g):w),e.$$.dirty[0]&33280&&n(16,i=typeof R=="function"?R(g):R),e.$$.dirty[0]&15360&&n(5,o=y||b&et.Static&&T||!(b&et.RenderStrategy&&P)),e.$$.dirty[0]&15360&&n(4,l=!y&&!(b&et.Static&&T)&&b&et.RenderStrategy&&!P),e.$$.dirty[0]&196624&&n(3,c={class:r,style:`${i!=null?i:""}${l?" display: none":""}`||void 0}),e.$$.dirty[0]&8&&c.style===void 0&&delete c.style},[m,h,v,c,l,o,d,u,p,g,y,b,P,T,w,R,i,r,f,I,j,C,H,Z,ne,ue,_e,$e,Ee,x,le,Ve,me,rt,Ct,ce,Oe,Ke,vn,zt,we,ar,ii,Yl,Xl,Ql,Kl,Zl,ec,tc,nc,rc,ic,oc,sc,ac,lc,cc,uc,a]}class Kr extends Pe{constructor(t){super(),Re(this,t,yd,vd,Te,{name:8,as:1,slotProps:9,el:0,use:2,visible:10,features:11,unmount:12,static:13,class:14,style:15},null,[-1,-1])}}const{window:Zo}=ba,_d=e=>e&64,bd=e=>({}),es=e=>({...e[6]});function Cd(e){let t;const n=e[24].default,r=V(n,e,e[27],es);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),t=!0},p(i,o){r&&r.p&&(!t||o&134217792)&&q(r,n,i,i[27],_d(o)||!t?J(i[27]):W(n,i[27],o,bd),es)},i(i){t||(S(r,i),t=!0)},o(i){E(r,i),t=!1},d(i){r&&r.d(i)}}}function Sd(e){let t,n,r;const i=[{...e[14],...e[7]},{as:e[0]},{slotProps:e[6]},{use:[...e[1],e[9]]},{name:"Dialog"},{"aria-describedby":e[30]},{visible:e[8]},{features:et.RenderStrategy|et.Static}];function o(c){e[25](c)}let l={$$slots:{default:[Cd]},$$scope:{ctx:e}};for(let c=0;c<i.length;c+=1)l=B(l,i[c]);return e[3]!==void 0&&(l.el=e[3]),t=new Kr({props:l}),U.push(()=>nt(t,"el",o)),t.$on("click",wd),{c(){oe(t.$$.fragment)},m(c,s){re(t,c,s),r=!0},p(c,s){const u=s&1073759171?X(i,[s&16512&&{...c[14],...c[7]},s&1&&{as:c[0]},s&64&&{slotProps:c[6]},s&514&&{use:[...c[1],c[9]]},i[4],s&1073741824&&{"aria-describedby":c[30]},s&256&&{visible:c[8]},s&0&&{features:et.RenderStrategy|et.Static}]):{};s&134217792&&(u.$$scope={dirty:s,ctx:c}),!n&&s&8&&(n=!0,u.el=c[3],dt(()=>n=!1)),t.$set(u)},i(c){r||(S(t.$$.fragment,c),r=!0)},o(c){E(t.$$.fragment,c),r=!1},d(c){ie(t,c)}}}function Td(e){let t,n;return t=new mf({props:{name:"DialogDescription",slotProps:e[6],$$slots:{default:[Sd,({describedby:r})=>({30:r}),({describedby:r})=>r?1073741824:0]},$$scope:{ctx:e}}}),{c(){oe(t.$$.fragment)},m(r,i){re(t,r,i),n=!0},p(r,i){const o={};i&64&&(o.slotProps=r[6]),i&1207976395&&(o.$$scope={dirty:i,ctx:r}),t.$set(o)},i(r){n||(S(t.$$.fragment,r),n=!0)},o(r){E(t.$$.fragment,r),n=!1},d(r){ie(t,r)}}}function Ed(e){let t,n;return t=new Ja({props:{force:!1,$$slots:{default:[Td]},$$scope:{ctx:e}}}),{c(){oe(t.$$.fragment)},m(r,i){re(t,r,i),n=!0},p(r,i){const o={};i&134234571&&(o.$$scope={dirty:i,ctx:r}),t.$set(o)},i(r){n||(S(t.$$.fragment,r),n=!0)},o(r){E(t.$$.fragment,r),n=!1},d(r){ie(t,r)}}}function kd(e){let t,n;return t=new Sf({props:{target:e[3],$$slots:{default:[Ed]},$$scope:{ctx:e}}}),{c(){oe(t.$$.fragment)},m(r,i){re(t,r,i),n=!0},p(r,i){const o={};i&8&&(o.target=r[3]),i&134234571&&(o.$$scope={dirty:i,ctx:r}),t.$set(o)},i(r){n||(S(t.$$.fragment,r),n=!0)},o(r){E(t.$$.fragment,r),n=!1},d(r){ie(t,r)}}}function Rd(e){let t,n;return t=new Rf({props:{$$slots:{default:[kd]},$$scope:{ctx:e}}}),{c(){oe(t.$$.fragment)},m(r,i){re(t,r,i),n=!0},p(r,i){const o={};i&134234571&&(o.$$scope={dirty:i,ctx:r}),t.$set(o)},i(r){n||(S(t.$$.fragment,r),n=!0)},o(r){E(t.$$.fragment,r),n=!1},d(r){ie(t,r)}}}function Pd(e){let t,n;return t=new Ja({props:{force:!0,$$slots:{default:[Rd]},$$scope:{ctx:e}}}),{c(){oe(t.$$.fragment)},m(r,i){re(t,r,i),n=!0},p(r,i){const o={};i&134234571&&(o.$$scope={dirty:i,ctx:r}),t.$set(o)},i(r){n||(S(t.$$.fragment,r),n=!0)},o(r){E(t.$$.fragment,r),n=!1},d(r){ie(t,r)}}}function Od(e){let t,n,r,i,o,l;return t=new af({props:{containers:e[5],enabled:e[4],options:{initialFocus:e[2]}}}),r=new uf({props:{element:e[3],onUpdate:e[26],$$slots:{default:[Pd]},$$scope:{ctx:e}}}),{c(){oe(t.$$.fragment),n=ke(),oe(r.$$.fragment)},m(c,s){re(t,c,s),O(c,n,s),re(r,c,s),i=!0,o||(l=[Se(Zo,"mousedown",e[12]),Se(Zo,"keydown",e[13])],o=!0)},p(c,[s]){const u={};s&32&&(u.containers=c[5]),s&16&&(u.enabled=c[4]),s&4&&(u.options={initialFocus:c[2]}),t.$set(u);const f={};s&8&&(f.element=c[3]),s&32&&(f.onUpdate=c[26]),s&134234571&&(f.$$scope={dirty:s,ctx:c}),r.$set(f)},i(c){i||(S(t.$$.fragment,c),S(r.$$.fragment,c),i=!0)},o(c){E(t.$$.fragment,c),E(r.$$.fragment,c),i=!1},d(c){ie(t,c),c&&k(n),ie(r,c),o=!1,z(l)}}}var qe;(function(e){e[e.Open=0]="Open",e[e.Closed=1]="Closed"})(qe||(qe={}));const Xa="headlessui-dialog-context";function Qa(e){let t=pn(Xa);if(t===void 0)throw new Error(`<${e} /> is missing a parent <Dialog /> component.`);return t}function wd(e){e.stopPropagation()}function Dd(e,t,n){let r,i,o,l,c,s,u,f;const a=["as","use","open","initialFocus"];let d=Xe(t,a),p,h,{$$slots:g={},$$scope:m}=t,{as:v="div"}=t,{use:y=[]}=t,{open:b=void 0}=t,{initialFocus:P=null}=t;const T=or(ht(),["close"]),w=nr();let R=new Set,I=Ku();ut(e,I,x=>n(23,h=x));let j=null;const C=`headlessui-dialog-${Qr()}`;Mt(()=>{l&&l()});let H,Z=Ue({titleId:H,dialogState:r,setTitleId(x){H!==x&&n(16,H=x)},close(){w("close",!1)}});ut(e,Z,x=>n(22,p=x)),rr(Xa,Z);async function ne(x){let le=x.target;r===qe.Open&&R.size===1&&(Ii(R,le)||(p.close(),await no(),le==null||le.focus()))}function ue(x){x.key===Ur.Escape&&r===qe.Open&&(R.size>1||(x.preventDefault(),x.stopPropagation(),p.close()))}let _e=!1;tr(()=>n(17,_e=!0)),Mt(()=>{c&&c()}),Mt(()=>{s&&s()});function $e(x){j=x,n(3,j)}const Ee=(x,le)=>Ai(x,{[on.Add](){n(5,R=new Set([...R,le]))},[on.Remove](){R.delete(le),n(5,R=new Set([...R]))}});return e.$$set=x=>{t=B(B({},t),fn(x)),n(14,d=Xe(t,a)),"as"in x&&n(0,v=x.as),"use"in x&&n(1,y=x.use),"open"in x&&n(15,b=x.open),"initialFocus"in x&&n(2,P=x.initialFocus),"$$scope"in x&&n(27,m=x.$$scope)},e.$$.update=()=>{if(e.$$.dirty&8421376){if(n(15,b=b===void 0&&I!==void 0?Ai(h,{[Fn.Open]:!0,[Fn.Closed]:!1}):b),!(b!==void 0||I!==void 0))throw new Error("You forgot to provide an `open` prop to the `Dialog` component.");if(typeof b!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${b}`)}e.$$.dirty&32768&&n(18,r=b?qe.Open:qe.Closed),e.$$.dirty&8650752&&n(8,i=I!==void 0?h===Fn.Open:r===qe.Open),e.$$.dirty&262144&&n(4,o=r===qe.Open),e.$$.dirty&2097176&&n(21,l=(()=>(l&&l(),tf(j,o)))()),e.$$.dirty&327680&&Z.update(x=>({...x,titleId:H,dialogState:r})),e.$$.dirty&1441792&&n(20,c=(()=>{if(c&&c(),r!==qe.Open||!_e)return;let x=document.documentElement.style.overflow,le=document.documentElement.style.paddingRight,Ve=window.innerWidth-document.documentElement.clientWidth;return document.documentElement.style.overflow="hidden",document.documentElement.style.paddingRight=`${Ve}px`,()=>{document.documentElement.style.overflow=x,document.documentElement.style.paddingRight=le}})()),e.$$.dirty&4980744&&n(19,s=(()=>{if(s&&s(),r!==qe.Open)return;let x=j;if(!x)return;let le=new IntersectionObserver(Ve=>{for(let me of Ve)me.boundingClientRect.x===0&&me.boundingClientRect.y===0&&me.boundingClientRect.width===0&&me.boundingClientRect.height===0&&p.close()});return le.observe(x),()=>le.disconnect()})()),e.$$.dirty&327680&&n(7,u={id:C,role:"dialog","aria-modal":r===qe.Open?!0:void 0,"aria-labelledby":H}),e.$$.dirty&32768&&n(6,f={open:b})},[v,y,P,j,o,R,f,u,i,T,I,Z,ne,ue,d,b,H,_e,r,s,c,l,p,h,g,$e,Ee,m]}class Ad extends Pe{constructor(t){super(),Re(this,t,Dd,Od,Te,{as:0,use:1,open:15,initialFocus:2})}}const Id=e=>e&4,Md=e=>({}),ts=e=>({...e[2]});function Ld(e){let t;const n=e[8].default,r=V(n,e,e[9],ts);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),t=!0},p(i,o){r&&r.p&&(!t||o&516)&&q(r,n,i,i[9],Id(o)||!t?J(i[9]):W(n,i[9],o,Md),ts)},i(i){t||(S(r,i),t=!0)},o(i){E(r,i),t=!1},d(i){r&&r.d(i)}}}function Nd(e){let t,n;const r=[{...e[6],...e[3]},{as:e[0]},{slotProps:e[2]},{use:[...e[1],e[4]]},{name:"DialogTitle"}];let i={$$slots:{default:[Ld]},$$scope:{ctx:e}};for(let o=0;o<r.length;o+=1)i=B(i,r[o]);return t=new Kr({props:i}),{c(){oe(t.$$.fragment)},m(o,l){re(t,o,l),n=!0},p(o,[l]){const c=l&95?X(r,[l&72&&{...o[6],...o[3]},l&1&&{as:o[0]},l&4&&{slotProps:o[2]},l&18&&{use:[...o[1],o[4]]},r[4]]):{};l&516&&(c.$$scope={dirty:l,ctx:o}),t.$set(c)},i(o){n||(S(t.$$.fragment,o),n=!0)},o(o){E(t.$$.fragment,o),n=!1},d(o){ie(t,o)}}}function Bd(e,t,n){let r,i;const o=["as","use"];let l=Xe(t,o),c,{$$slots:s={},$$scope:u}=t,{as:f="h2"}=t,{use:a=[]}=t;const d=or(ht());let p=Qa("DialogTitle");ut(e,p,g=>n(7,c=g));let h=`headlessui-dialog-title-${Qr()}`;return tr(()=>(c.setTitleId(h),()=>c.setTitleId(void 0))),e.$$set=g=>{t=B(B({},t),fn(g)),n(6,l=Xe(t,o)),"as"in g&&n(0,f=g.as),"use"in g&&n(1,a=g.use),"$$scope"in g&&n(9,u=g.$$scope)},e.$$.update=()=>{e.$$.dirty&128&&n(2,i={open:c.dialogState===qe.Open})},n(3,r={id:h}),[f,a,i,r,d,p,l,c,s,u]}class Zr extends Pe{constructor(t){super(),Re(this,t,Bd,Nd,Te,{as:0,use:1})}}const jd=e=>e&4,Fd=e=>({}),ns=e=>({...e[2]});function Gd(e){let t;const n=e[9].default,r=V(n,e,e[10],ns);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),t=!0},p(i,o){r&&r.p&&(!t||o&1028)&&q(r,n,i,i[10],jd(o)||!t?J(i[10]):W(n,i[10],o,Fd),ns)},i(i){t||(S(r,i),t=!0)},o(i){E(r,i),t=!1},d(i){r&&r.d(i)}}}function xd(e){let t,n;const r=[{...e[7],...e[3]},{as:e[0]},{slotProps:e[2]},{use:[...e[1],e[4]]},{name:"DialogOverlay"}];let i={$$slots:{default:[Gd]},$$scope:{ctx:e}};for(let o=0;o<r.length;o+=1)i=B(i,r[o]);return t=new Kr({props:i}),t.$on("click",e[6]),{c(){oe(t.$$.fragment)},m(o,l){re(t,o,l),n=!0},p(o,[l]){const c=l&159?X(r,[l&136&&{...o[7],...o[3]},l&1&&{as:o[0]},l&4&&{slotProps:o[2]},l&18&&{use:[...o[1],o[4]]},r[4]]):{};l&1028&&(c.$$scope={dirty:l,ctx:o}),t.$set(c)},i(o){n||(S(t.$$.fragment,o),n=!0)},o(o){E(t.$$.fragment,o),n=!1},d(o){ie(t,o)}}}function Ud(e,t,n){let r,i;const o=["as","use"];let l=Xe(t,o),c,{$$slots:s={},$$scope:u}=t,{as:f="div"}=t,{use:a=[]}=t;const d=or(ht());let p=Qa("DialogOverlay");ut(e,p,m=>n(8,c=m));let h=`headlessui-dialog-overlay-${Qr()}`;function g(m){let v=m;v.target===v.currentTarget&&(v.preventDefault(),v.stopPropagation(),c.close())}return e.$$set=m=>{t=B(B({},t),fn(m)),n(7,l=Xe(t,o)),"as"in m&&n(0,f=m.as),"use"in m&&n(1,a=m.use),"$$scope"in m&&n(10,u=m.$$scope)},e.$$.update=()=>{e.$$.dirty&256&&n(2,i={open:c.dialogState===qe.Open})},n(3,r={id:h,"aria-hidden":!0}),[f,a,i,r,d,p,g,l,c,s,u]}class zd extends Pe{constructor(t){super(),Re(this,t,Ud,xd,Te,{as:0,use:1})}}const Hd=e=>e&8,$d=e=>({}),rs=e=>({...e[3]});function Vd(e){let t;const n=e[8].default,r=V(n,e,e[9],rs);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),t=!0},p(i,o){r&&r.p&&(!t||o&520)&&q(r,n,i,i[9],Hd(o)||!t?J(i[9]):W(n,i[9],o,$d),rs)},i(i){t||(S(r,i),t=!0)},o(i){E(r,i),t=!1},d(i){r&&r.d(i)}}}function Wd(e){var o;let t,n;const r=[{name:"Description"},e[7],{as:e[0]},{slotProps:e[3]},(o=e[2])==null?void 0:o.props,{id:e[5]},{use:[...e[1],e[4]]}];let i={$$slots:{default:[Vd]},$$scope:{ctx:e}};for(let l=0;l<r.length;l+=1)i=B(i,r[l]);return t=new Kr({props:i}),{c(){oe(t.$$.fragment)},m(l,c){re(t,l,c),n=!0},p(l,[c]){var u;const s=c&191?X(r,[r[0],c&128&&Vn(l[7]),c&1&&{as:l[0]},c&8&&{slotProps:l[3]},c&4&&Vn((u=l[2])==null?void 0:u.props),c&32&&{id:l[5]},c&18&&{use:[...l[1],l[4]]}]):{};c&520&&(s.$$scope={dirty:c,ctx:l}),t.$set(s)},i(l){n||(S(t.$$.fragment,l),n=!0)},o(l){E(t.$$.fragment,l),n=!1},d(l){ie(t,l)}}}function qd(e,t,n){let r;const i=["as","use"];let o=Xe(t,i),l,{$$slots:c={},$$scope:s}=t;const u=or(ht());let{as:f="p"}=t,{use:a=[]}=t;const d=`headlessui-description-${Qr()}`;let p=pf();if(ut(e,p,h=>n(2,l=h)),!p)throw new Error("You used a <Description /> component, but it is not inside a relevant parent.");return tr(()=>l==null?void 0:l.register(d)),e.$$set=h=>{t=B(B({},t),fn(h)),n(7,o=Xe(t,i)),"as"in h&&n(0,f=h.as),"use"in h&&n(1,a=h.use),"$$scope"in h&&n(9,s=h.$$scope)},e.$$.update=()=>{e.$$.dirty&4&&n(3,r=l.slotProps||{})},[f,a,l,r,u,d,p,o,c,s]}class Jd extends Pe{constructor(t){super(),Re(this,t,qd,Wd,Te,{as:0,use:1})}}var is;(function(e){e[e.Open=0]="Open",e[e.Closed=1]="Closed"})(is||(is={}));var os;(function(e){e[e.First=0]="First",e[e.Previous=1]="Previous",e[e.Next=2]="Next",e[e.Last=3]="Last",e[e.Specific=4]="Specific",e[e.Nothing=5]="Nothing"})(os||(os={}));var ss;(function(e){e[e.Open=0]="Open",e[e.Closed=1]="Closed"})(ss||(ss={}));var as;(function(e){e[e.Open=0]="Open",e[e.Closed=1]="Closed"})(as||(as={}));var ls;(function(e){e[e.Open=0]="Open",e[e.Closed=1]="Closed"})(ls||(ls={}));var cs;(function(e){e.Finished="finished",e.Cancelled="cancelled"})(cs||(cs={}));var us;(function(e){e.Visible="visible",e.Hidden="hidden"})(us||(us={}));function Yd(e){let t;return{c(){t=ft("Dialog w/o content")},m(n,r){O(n,t,r)},d(n){n&&k(t)}}}function Xd(e){let t;return{c(){t=ft("Please add some content")},m(n,r){O(n,t,r)},d(n){n&&k(t)}}}function Qd(e){let t,n,r,i,o,l,c,s,u,f,a;return t=new Zr({props:{as:"h3",class:"font-bold text-lg",$$slots:{default:[Yd]},$$scope:{ctx:e}}}),r=new Jd({props:{class:"py-",$$slots:{default:[Xd]},$$scope:{ctx:e}}}),{c(){oe(t.$$.fragment),n=ke(),oe(r.$$.fragment),i=ke(),o=N("button"),o.textContent="\u2715",l=ke(),c=N("div"),s=N("button"),s.textContent="Got it, thanks!",K(o,"for",""),K(o,"class","btn btn-sm btn-circle absolute right-2 top-2"),K(s,"type","button"),K(s,"class","btn"),K(c,"class","modal-action")},m(d,p){re(t,d,p),O(d,n,p),re(r,d,p),O(d,i,p),O(d,o,p),O(d,l,p),O(d,c,p),ot(c,s),u=!0,f||(a=[Se(o,"click",e[3]),Se(s,"click",e[3])],f=!0)},p(d,p){const h={};p&256&&(h.$$scope={dirty:p,ctx:d}),t.$set(h);const g={};p&256&&(g.$$scope={dirty:p,ctx:d}),r.$set(g)},i(d){u||(S(t.$$.fragment,d),S(r.$$.fragment,d),u=!0)},o(d){E(t.$$.fragment,d),E(r.$$.fragment,d),u=!1},d(d){ie(t,d),d&&k(n),ie(r,d),d&&k(i),d&&k(o),d&&k(l),d&&k(c),f=!1,z(a)}}}function Kd(e){let t,n,r,i,o,l,c,s,u,f;n=new zd({props:{class:"absolute inset-0 bg-black opacity-70"}});const a=e[5].default,d=V(a,e,e[8],null),p=d||Qd(e);return{c(){t=N("div"),oe(n.$$.fragment),i=ke(),o=N("div"),p&&p.c(),K(t,"class","inset-0 absolute"),K(o,"class",l="modal-box max-w-2xl "+e[0]),K(o,"style",e[1])},m(h,g){O(h,t,g),re(n,t,null),O(h,i,g),O(h,o,g),p&&p.m(o,null),s=!0,u||(f=[Se(o,"introstart",e[6]),Se(o,"outroend",e[7])],u=!0)},p(h,g){d&&d.p&&(!s||g&256)&&q(d,a,h,h[8],s?W(a,h[8],g,null):J(h[8]),null),(!s||g&1&&l!==(l="modal-box max-w-2xl "+h[0]))&&K(o,"class",l),(!s||g&2)&&K(o,"style",h[1])},i(h){s||(S(n.$$.fragment,h),_t(()=>{r||(r=ur(t,wi,{duration:300},!0)),r.run(1)}),S(p,h),_t(()=>{c||(c=ur(o,Go,{duration:300},!0)),c.run(1)}),s=!0)},o(h){E(n.$$.fragment,h),r||(r=ur(t,wi,{duration:300},!1)),r.run(0),E(p,h),c||(c=ur(o,Go,{duration:300},!1)),c.run(0),s=!1},d(h){h&&k(t),ie(n),h&&r&&r.end(),h&&k(i),h&&k(o),p&&p.d(h),h&&c&&c.end(),u=!1,z(f)}}}function Zd(e){let t,n;return t=new Ad({props:{class:"inset-0 fixed modal modal-bottom modal-open",open:e[2],static:!0,$$slots:{default:[Kd]},$$scope:{ctx:e}}}),t.$on("close",e[3]),{c(){oe(t.$$.fragment)},m(r,i){re(t,r,i),n=!0},p(r,[i]){const o={};i&4&&(o.open=r[2]),i&263&&(o.$$scope={dirty:i,ctx:r}),t.$set(o)},i(r){n||(S(t.$$.fragment,r),n=!0)},o(r){E(t.$$.fragment,r),n=!1},d(r){ie(t,r)}}}function ep(e,t,n){let{$$slots:r={},$$scope:i}=t,{isOpen:o=!0}=t,{modalClass:l="mx-10"}=t,{modalStyle:c=""}=t,s=!0;const u=nr();function f(){n(4,o=!1),u("close")}const a=()=>n(2,s=!0),d=()=>n(2,s=!1);return e.$$set=p=>{"isOpen"in p&&n(4,o=p.isOpen),"modalClass"in p&&n(0,l=p.modalClass),"modalStyle"in p&&n(1,c=p.modalStyle),"$$scope"in p&&n(8,i=p.$$scope)},[l,c,s,f,o,r,a,d,i]}class po extends Pe{constructor(t){super(),Re(this,t,ep,Zd,Te,{isOpen:4,modalClass:0,modalStyle:1})}}function tp(e){let t;return{c(){t=ft(e[1])},m(n,r){O(n,t,r)},p(n,r){r&2&&to(t,n[1])},d(n){n&&k(t)}}}function np(e){let t,n,r,i,o,l,c,s;return t=new Zr({props:{as:"h3",class:"font-bold text-lg mb-5",$$slots:{default:[tp]},$$scope:{ctx:e}}}),{c(){oe(t.$$.fragment),n=ke(),r=N("button"),r.textContent="Ok",i=ke(),o=N("button"),o.textContent="Cancel",K(r,"type","button"),K(r,"class","btn btn-primary btn-block flex-1 mb-2"),K(o,"type","button"),K(o,"class","btn btn-outline btn-block flex-1")},m(u,f){re(t,u,f),O(u,n,f),O(u,r,f),O(u,i,f),O(u,o,f),l=!0,c||(s=[Se(r,"click",e[4]),Se(o,"click",e[5])],c=!0)},p(u,f){const a={};f&514&&(a.$$scope={dirty:f,ctx:u}),t.$set(a)},i(u){l||(S(t.$$.fragment,u),l=!0)},o(u){E(t.$$.fragment,u),l=!1},d(u){ie(t,u),u&&k(n),u&&k(r),u&&k(i),u&&k(o),c=!1,z(s)}}}function rp(e){let t,n,r,i,o;function l(s){e[6](s)}let c={modalStyle:"max-width:16rem; text-align:center",modalClass:"modal-bottom",$$slots:{default:[np]},$$scope:{ctx:e}};return e[0]!==void 0&&(c.isOpen=e[0]),r=new po({props:c}),U.push(()=>nt(r,"isOpen",l)),r.$on("close",e[7]),{c(){t=N("br"),n=ke(),oe(r.$$.fragment)},m(s,u){O(s,t,u),O(s,n,u),re(r,s,u),o=!0},p(s,[u]){const f={};u&514&&(f.$$scope={dirty:u,ctx:s}),!i&&u&1&&(i=!0,f.isOpen=s[0],dt(()=>i=!1)),r.$set(f)},i(s){o||(S(r.$$.fragment,s),o=!0)},o(s){E(r.$$.fragment,s),o=!1},d(s){s&&k(t),s&&k(n),ie(r,s)}}}function ip(e,t,n){let r;const i=nr();let{isOpen:o=!0}=t,{extraData:l={}}=t;function c(d){i("close",d),n(0,o=!1)}const s=()=>c(!0),u=()=>c(!1);function f(d){o=d,n(0,o)}const a=()=>c(!1);return e.$$set=d=>{"isOpen"in d&&n(0,o=d.isOpen),"extraData"in d&&n(3,l=d.extraData)},e.$$.update=()=>{e.$$.dirty&8&&n(1,r=l.title||"Are you sure?")},[o,r,c,l,s,u,f,a]}class op extends Pe{constructor(t){super(),Re(this,t,ip,rp,Te,{isOpen:0,extraData:3})}}function sp(e){let t;return{c(){t=ft("Please enter the driver password")},m(n,r){O(n,t,r)},d(n){n&&k(t)}}}function ap(e){let t,n,r,i,o,l,c,s,u,f;return t=new Zr({props:{as:"h3",class:"font-bold text-lg",$$slots:{default:[sp]},$$scope:{ctx:e}}}),{c(){oe(t.$$.fragment),n=ke(),r=N("input"),i=ke(),o=N("button"),o.textContent="Ok",l=ke(),c=N("button"),c.textContent="Cancel",K(r,"type","password"),K(r,"placeholder","Password"),K(r,"class","input input-bordered block w-full my-5"),K(o,"type","button"),K(o,"class","btn btn-primary btn-block btn-shadow flex-1 mb-2"),K(c,"type","button"),K(c,"class","btn btn-outline btn-block flex-1")},m(a,d){re(t,a,d),O(a,n,d),O(a,r,d),Oo(r,e[1]),O(a,i,d),O(a,o,d),O(a,l,d),O(a,c,d),s=!0,u||(f=[Se(r,"input",e[3]),Se(r,"keypress",e[4]),Se(o,"click",e[5]),Se(c,"click",e[6])],u=!0)},p(a,d){const p={};d&1024&&(p.$$scope={dirty:d,ctx:a}),t.$set(p),d&2&&r.value!==a[1]&&Oo(r,a[1])},i(a){s||(S(t.$$.fragment,a),s=!0)},o(a){E(t.$$.fragment,a),s=!1},d(a){ie(t,a),a&&k(n),a&&k(r),a&&k(i),a&&k(o),a&&k(l),a&&k(c),u=!1,z(f)}}}function lp(e){let t,n,r,i,o;function l(s){e[7](s)}let c={modalStyle:"max-width:16rem; text-align:center",modalClass:"modal-bottom",$$slots:{default:[ap]},$$scope:{ctx:e}};return e[0]!==void 0&&(c.isOpen=e[0]),r=new po({props:c}),U.push(()=>nt(r,"isOpen",l)),r.$on("close",e[8]),{c(){t=N("br"),n=ke(),oe(r.$$.fragment)},m(s,u){O(s,t,u),O(s,n,u),re(r,s,u),o=!0},p(s,[u]){const f={};u&1026&&(f.$$scope={dirty:u,ctx:s}),!i&&u&1&&(i=!0,f.isOpen=s[0],dt(()=>i=!1)),r.$set(f)},i(s){o||(S(r.$$.fragment,s),o=!0)},o(s){E(r.$$.fragment,s),o=!1},d(s){s&&k(t),s&&k(n),ie(r,s)}}}function cp(e,t,n){let{isOpen:r=!0}=t,i="";const o=nr();function l(p){if(p&&i.length==0){console.log("Password is empty");return}else p?o("close",i):o("close",null);n(0,r=!1)}function c(){i=this.value,n(1,i)}const s=p=>{p.key=="Enter"&&l(!0)},u=()=>l(!0),f=()=>l(!1);function a(p){r=p,n(0,r)}const d=()=>l(!1);return e.$$set=p=>{"isOpen"in p&&n(0,r=p.isOpen)},[r,i,l,c,s,u,f,a,d]}class up extends Pe{constructor(t){super(),Re(this,t,cp,lp,Te,{isOpen:0})}}const Ka="ROV-",fp=74646,Hr={host:"0.peerjs.com",secure:!0,path:"/",port:443},dp={host:"raspberrypi.local",path:"/",secure:!1,port:9e3};var G=(e=>(e.connecting="Connecting",e.connected="Connected",e.reconnecting="Reconnecting",e.disconnected="Disconnected",e))(G||{}),Nt=(e=>(e.ping="ping",e.password_attempt="password_attempt",e.authtoken_attempt="authtoken_attempt",e.take_control="take_control",e.move="move",e.begin_video_stream="begin_video_stream",e.take_photo="take_photo",e.start_video_rec="start_video_rec",e.stop_video_rec="stop_video_rec",e.toogle_lights="toogle_lights",e.shutdown_rov="shutdown_rov",e.reboot_rov="reboot_rov",e.enable_wifi="enable_wifi",e.disable_wifi="disable_wifi",e.rov_status_report="rov_status_report",e.restart_rov_services="restart_rov_services",e.rov_logs="rov_logs",e))(Nt||{});const Li={default:"Loading...","ip-scan":"Scanning for ROV IP address...","internet-check":"Checking internet access...","server-connecting":"Connecting to peer server...","server-reconnecting":"Reconnecting to peer server...","webrtc-connecting":"Searching for ROV...","webrtc-reconnecting":"Reconnecting to ROV...","reloading-site":"Reloading site...","awaiting-video-call":"Waiting for livestream...","awaiting-rov-reconnect":"Waiting for ROV to reconnect..."},fs=[{btnName:"button_1",remoteAction:"lights",helpLabel:"TODO: Lights"},{btnName:"button_2",remoteAction:"record",helpLabel:"TODO: Start/Stop Recording"},{btnName:"button_3",remoteAction:"photo",helpLabel:"TODO: Take Phtoto"},{btnName:"button_4",remoteAction:null,helpLabel:"Nothing"},{btnName:"shoulder_btn_front_left",remoteAction:null,localAction:null,helpLabel:"Nothing"},{btnName:"shoulder_btn_front_right",remoteAction:"claw_open",helpLabel:"TODO: Open Claw",holdAllowed:!0},{btnName:"shoulder_trigger_back_left",remoteAction:null,helpLabel:"Nothing"},{btnName:"shoulder_trigger_back_right",remoteAction:"claw_close",helpLabel:"TODO: Close Claw",holdAllowed:!0},{btnName:"select",remoteAction:null,helpLabel:"Show/Hide Gamepad Help"},{btnName:"start",remoteAction:null,helpLabel:"Show/Hide Gamepad Help"},{btnName:"stick_button_left",remoteAction:null,helpLabel:"TODO: Lock Vertical Thruster"},{btnName:"stick_button_right",remoteAction:null,helpLabel:"TODO: Lock Horizontal"},{btnName:"d_pad_up",remoteAction:"exposure_plus",helpLabel:"TODO: Increase Camera Brightness",holdAllowed:!0},{btnName:"d_pad_down",remoteAction:"exposure_minus",helpLabel:"TODO: Decreases Camera Brightness",holdAllowed:!0},{btnName:"d_pad_left",remoteAction:"v_quality_plus",helpLabel:"TODO: Decrease Video Quality (reduces latency)",holdAllowed:!0},{btnName:"d_pad_right",remoteAction:"v_quality_minus",helpLabel:"TODO: Increase Video Quality (increases latency)",holdAllowed:!0},{btnName:"vendor",remoteAction:null,helpLabel:"Nothing"}],pp=["button_1","button_2","button_3","button_4","shoulder_btn_front_left","shoulder_btn_front_right","shoulder_trigger_back_left","shoulder_trigger_back_right","select","start","stick_button_left","stick_button_right","d_pad_up","d_pad_down","d_pad_left","d_pad_right"],ds="touched",ps="pressed",ye={connManager:null,msgHandler:null,gpadCtrl:null,openDialog:(e,t,n)=>r=>{}},sn=Ue(!1),hs=Ue({}),hp=Ue("raspberrypi.local"),an=Ue(0),ms=Ue(!1),Zt=Ue("No Peer Id"),On=Ue(G.disconnected),Ni=Ue(G.disconnected),Bi=Ue(G.disconnected);function gs(e,t,n){const r=e.slice();return r[10]=t[n],r}function mp(e){let t;return{c(){t=ft(e[3])},m(n,r){O(n,t,r)},p(n,r){r&8&&to(t,n[3])},d(n){n&&k(t)}}}function vs(e){let t=e[10]+"",n;return{c(){n=ft(t)},m(r,i){O(r,n,i)},p(r,i){i&4&&t!==(t=r[10]+"")&&to(n,t)},d(r){r&&k(n)}}}function gp(e){let t,n,r,i,o,l,c,s,u,f;r=new Zr({props:{as:"h3",class:"font-bold text-lg mb-5",$$slots:{default:[mp]},$$scope:{ctx:e}}});let a=e[2],d=[];for(let p=0;p<a.length;p+=1)d[p]=vs(gs(e,a,p));return{c(){t=N("button"),t.textContent="\u2715",n=ke(),oe(r.$$.fragment),i=ke(),o=N("pre"),l=ft("    ");for(let p=0;p<d.length;p+=1)d[p].c();c=ft(`
  `),K(t,"class","btn btn-sm btn-circle absolute right-2 top-2"),K(o,"class","overflow-auto flex-1 -mx-5 px-6 -mb-2 pb-2")},m(p,h){O(p,t,h),O(p,n,h),re(r,p,h),O(p,i,h),O(p,o,h),ot(o,l);for(let g=0;g<d.length;g+=1)d[g].m(o,null);ot(o,c),e[6](o),s=!0,u||(f=Se(t,"click",e[4]),u=!0)},p(p,h){const g={};if(h&8200&&(g.$$scope={dirty:h,ctx:p}),r.$set(g),h&4){a=p[2];let m;for(m=0;m<a.length;m+=1){const v=gs(p,a,m);d[m]?d[m].p(v,h):(d[m]=vs(v),d[m].c(),d[m].m(o,c))}for(;m<d.length;m+=1)d[m].d(1);d.length=a.length}},i(p){s||(S(r.$$.fragment,p),s=!0)},o(p){E(r.$$.fragment,p),s=!1},d(p){p&&k(t),p&&k(n),ie(r,p),p&&k(i),p&&k(o),gc(d,p),e[6](null),u=!1,f()}}}function vp(e){let t,n,r,i,o;function l(s){e[7](s)}let c={modalClass:"flex-col flex",$$slots:{default:[gp]},$$scope:{ctx:e}};return e[0]!==void 0&&(c.isOpen=e[0]),r=new po({props:c}),U.push(()=>nt(r,"isOpen",l)),r.$on("close",e[8]),{c(){t=N("br"),n=ke(),oe(r.$$.fragment)},m(s,u){O(s,t,u),O(s,n,u),re(r,s,u),o=!0},p(s,[u]){const f={};u&8206&&(f.$$scope={dirty:u,ctx:s}),!i&&u&1&&(i=!0,f.isOpen=s[0],dt(()=>i=!1)),r.$set(f)},i(s){o||(S(r.$$.fragment,s),o=!0)},o(s){E(r.$$.fragment,s),o=!1},d(s){s&&k(t),s&&k(n),ie(r,s)}}}function yp(e,t,n){let r,i;const o=nr();let{isOpen:l=!0}=t,{extraData:c={title:"Title",messageLines:[]}}=t,s=null;function u(){o("close",null),n(0,l=!1)}function f(p){U[p?"unshift":"push"](()=>{s=p,n(1,s),n(5,c)})}function a(p){l=p,n(0,l)}const d=()=>u();return e.$$set=p=>{"isOpen"in p&&n(0,l=p.isOpen),"extraData"in p&&n(5,c=p.extraData)},e.$$.update=()=>{e.$$.dirty&32&&n(3,r=c.title||""),e.$$.dirty&32&&n(2,i=c.messageLines||[]),e.$$.dirty&34&&c&&s!=null&&s.scrollTop&&s.scrollTop+s.clientHeight+100>s.scrollHeight&&n(1,s.scrollTop=s.scrollHeight,s)},[l,s,i,r,u,c,f,a,d]}class _p extends Pe{constructor(t){super(),Re(this,t,yp,vp,Te,{isOpen:0,extraData:5})}}function bp(e){let t,n,r,i;function o(s){e[5](s)}function l(s){e[6](s)}let c={};return e[0].isOpen!==void 0&&(c.isOpen=e[0].isOpen),e[0].extraData!==void 0&&(c.extraData=e[0].extraData),t=new _p({props:c}),U.push(()=>nt(t,"isOpen",o)),U.push(()=>nt(t,"extraData",l)),t.$on("close",e[1]),{c(){oe(t.$$.fragment)},m(s,u){re(t,s,u),i=!0},p(s,u){const f={};!n&&u&1&&(n=!0,f.isOpen=s[0].isOpen,dt(()=>n=!1)),!r&&u&1&&(r=!0,f.extraData=s[0].extraData,dt(()=>r=!1)),t.$set(f)},i(s){i||(S(t.$$.fragment,s),i=!0)},o(s){E(t.$$.fragment,s),i=!1},d(s){ie(t,s)}}}function Cp(e){let t,n,r,i;function o(s){e[3](s)}function l(s){e[4](s)}let c={};return e[0].isOpen!==void 0&&(c.isOpen=e[0].isOpen),e[0].extraData!==void 0&&(c.extraData=e[0].extraData),t=new op({props:c}),U.push(()=>nt(t,"isOpen",o)),U.push(()=>nt(t,"extraData",l)),t.$on("close",e[1]),{c(){oe(t.$$.fragment)},m(s,u){re(t,s,u),i=!0},p(s,u){const f={};!n&&u&1&&(n=!0,f.isOpen=s[0].isOpen,dt(()=>n=!1)),!r&&u&1&&(r=!0,f.extraData=s[0].extraData,dt(()=>r=!1)),t.$set(f)},i(s){i||(S(t.$$.fragment,s),i=!0)},o(s){E(t.$$.fragment,s),i=!1},d(s){ie(t,s)}}}function Sp(e){let t,n,r;function i(l){e[2](l)}let o={};return e[0].isOpen!==void 0&&(o.isOpen=e[0].isOpen),t=new up({props:o}),U.push(()=>nt(t,"isOpen",i)),t.$on("close",e[1]),{c(){oe(t.$$.fragment)},m(l,c){re(t,l,c),r=!0},p(l,c){const s={};!n&&c&1&&(n=!0,s.isOpen=l[0].isOpen,dt(()=>n=!1)),t.$set(s)},i(l){r||(S(t.$$.fragment,l),r=!0)},o(l){E(t.$$.fragment,l),r=!1},d(l){ie(t,l)}}}function Tp(e){let t,n,r,i;const o=[Sp,Cp,bp],l=[];function c(s,u){return s[0].dialogType=="password"?0:s[0].dialogType=="alert"?1:s[0].dialogType=="scrollText"?2:-1}return~(t=c(e))&&(n=l[t]=o[t](e)),{c(){n&&n.c(),r=dn()},m(s,u){~t&&l[t].m(s,u),O(s,r,u),i=!0},p(s,[u]){let f=t;t=c(s),t===f?~t&&l[t].p(s,u):(n&&(xt(),E(l[f],1,1,()=>{l[f]=null}),Ut()),~t?(n=l[t],n?n.p(s,u):(n=l[t]=o[t](s),n.c()),S(n,1),n.m(r.parentNode,r)):n=null)},i(s){i||(S(n),i=!0)},o(s){E(n),i=!1},d(s){~t&&l[t].d(s),s&&k(r)}}}function Ep(e,t,n){let r=[],i={};function o(d,p,h){let m={isOpen:!0,dialogType:d,callback:h,extraData:p};return r=[...r,m],n(0,i=m),v=>{m.extraData=v(m.extraData),n(0,i)}}ye.openDialog=o;function l(d){n(0,i.isOpen=!1,i),n(0,i),i.callback&&i.callback(d.detail),r.pop(),n(0,i=r[r.length-1]),i?(n(0,i.isOpen=!0,i),n(0,i)):n(0,i={})}function c(d){e.$$.not_equal(i.isOpen,d)&&(i.isOpen=d,n(0,i))}function s(d){e.$$.not_equal(i.isOpen,d)&&(i.isOpen=d,n(0,i))}function u(d){e.$$.not_equal(i.extraData,d)&&(i.extraData=d,n(0,i))}function f(d){e.$$.not_equal(i.isOpen,d)&&(i.isOpen=d,n(0,i))}function a(d){e.$$.not_equal(i.extraData,d)&&(i.extraData=d,n(0,i))}return[i,l,c,s,u,f,a]}class kp extends Pe{constructor(t){super(),Re(this,t,Ep,Tp,Te,{})}}const $r=["Ancient","Dawn","Small","Broken","Red","Cold","Wild","Divine","Empty","Patient","Holy","Long","Wispy","White","Delicate","Bold","Billowing","Blue","Crimson","Aged","Misty","Snowy","Withered","Little","Frosty","Weathered","Nameless","Fragrant","Lively","Quiet","Purple","Proud","Dry","Bitter","Dark","Icy","Twilight","Wandering","Solitary","Morning","Lingering","Still","Late","Sparkling","Restless","Winter","Silent","Floral","Young","Green","Cool","Autumn","Falling","Spring","Summer","Polished","Hidden","Damp","Muddy","Black","Old","Rough"],Vr=["Pond","Snow","Glade","Hill","Voice","River","Sun","Dawn","Forest","Frog","Grass","Shadow","Dust","Water","Meadow","Moon","Thunder","Sun","Wildflower","Snowflake","Silence","Haze","Shape","Pine","Waterfall","Sound","Wood","Tree","Night","Flower","Dream","Cherry","Resonance","Firefly","Bush","Star","Darkness","Lake","Frost","Paper","Surf","Fog","Brook","Mountain","Field","Bird","Leaf","Sea","Water","Sky","Smoke","Sunset","Glitter","Dew","Butterfly","Wind","Fire","Rain","Morning","Feather","Cloud","Breeze","Violet","Wave"];function Rp(e,t){let n=$r.length>>>0,r=Vr.length>>>0,i=Math.max(n,r)>>>0,o=Math.max(1,(e+1)%i)>>>0,l=Math.max(1,(t+1)%i)>>>0,c=$r[(o+l)%n],s=Vr[o*l%r];return c+"-"+s}function ys(){var e=$r[Math.floor(Math.random()*$r.length)],t=Vr[Math.floor(Math.random()*Vr.length)];return e+"-"+t}function Pp(e){for(var t=window.location.search.substring(1),n=t.split("&"),r=0;r<n.length;r++){var i=n[r].split("=");if(decodeURIComponent(i[0])==e)return decodeURIComponent(i[1])}}class Op{constructor(){this.items=[]}push(t){this.items.push(t)}pop(){if(!this.isEmpty())return this.items.splice(0,1)}peak(){if(!this.isEmpty())return this.items[0]}isEmpty(){return this.items.length==0}printQueue(){for(var t="",n=0;n<this.items.length;n++)t+=this.items[n]+" ";return t}}function wp(e){return new Promise(t=>{console.info("checkingUrl",e);try{fetch(e).then(()=>{t(!0)}).catch(n=>{console.warn("Internet Offline, starting switch to local mode",n),t(!1)})}catch(n){console.warn("Error Checking internet, starting switch to local mode",n),t(!1)}})}window.closeFullscreen=()=>{const e=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(e){const t=()=>{e.classList.remove("fullscreen-open")};document.exitFullscreen?document.exitFullscreen().then(t):document.msExitFullscreen?document.msExitFullscreen().then(t):document.mozCancelFullScreen?document.mozCancelFullScreen().then(t):document.webkitExitFullscreen&&document.webkitExitFullscreen().then(t)}};window.toggleFullscreen=(e,t)=>{t=t||document.documentElement,e&&e.initialTarget&&e.initialTarget.classList.toggle("fullscreen-open");const n=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement,r=()=>{t.classList.add("fullscreen-open")},i=()=>{n.classList.remove("fullscreen-open"),t!==n&&(t.requestFullscreen?t.requestFullscreen().then(r):t.msRequestFullscreen?t.msRequestFullscreen().then(r):t.mozRequestFullScreen?t.mozRequestFullScreen().then(r):t.webkitRequestFullscreen&&t.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT).then(r))};n?document.exitFullscreen?document.exitFullscreen().then(i):document.msExitFullscreen?document.msExitFullscreen().then(i):document.mozCancelFullScreen?document.mozCancelFullScreen().then(i):document.webkitExitFullscreen&&document.webkitExitFullscreen().then(i):t.requestFullscreen?t.requestFullscreen().then(r):t.msRequestFullscreen?t.msRequestFullscreen().then(r):t.mozRequestFullScreen?t.mozRequestFullScreen().then(r):t.webkitRequestFullscreen&&t.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT).then(r)};const Dp=new TextEncoder,Ap=new TextDecoder;let Ip=e=>{console.info("Toast: "+e)};class ci{constructor(t,n,r,i){F(this,"eventHandlers",{});F(this,"currentPeer",null);F(this,"rovPeerId",null);F(this,"currentState",null);F(this,"connectionTimeout");F(this,"runningMachine",null);F(this,"lastRecivedMessageTime",0);F(this,"onStateChangeCallback",t=>{});F(this,"onMessageRecivedCallback",t=>{});F(this,"xstateMachineLayout",ir({predictableActionArguments:!0,preserveActionOrder:!0,id:"DataConnection",initial:"Connecting",states:{Connecting:{entry:"onConnectingFunction",on:{ON_CONNECTED:{target:"Connected"},ON_DESTROY:{target:"Destroyed"}}},Reconnecting:{entry:"onConnectingFunction",on:{ON_CONNECTED:{target:"Connected"},ON_DESTROY:{target:"Destroyed"}}},Connected:{entry:"onConnectedFunction",on:{ON_DISCONNECTED:{target:"Reconnecting"},ON_DESTROY:{target:"Destroyed"}}},Destroyed:{entry:"onDestoyedFunction",type:"final"}}},{actions:{onConnectingFunction:this.onConnecting.bind(this),onConnectedFunction:this.onConnected.bind(this),onDestoyedFunction:this.cleanup.bind(this)}}));this.currentState=null,this.onStateChangeCallback=r,this.onMessageRecivedCallback=i,this.currentPeer=t,this.rovPeerId=n,console.log("DataConnectionMachine created")}start(){if(this.runningMachine=mn(this.xstateMachineLayout,{devTools:lt(sn)}),this.runningMachine.onTransition(t=>{this.currentState!=t.value&&(this.currentState=t.value,this.onStateChangeCallback(this.currentState))}),this.runningMachine.start(),this.currentPeer==null)return this.cleanup();this.dataConnection=this.currentPeer.connect(this.rovPeerId,{reliable:!0,serialization:"none"}),console.info("connecting to rov peer: "+this.rovPeerId),this.eventHandlers.onOpen=()=>{this.sendEventToMachine("ON_CONNECTED"),Ip("Rov datachannel Open!")},this.dataConnection.on("open",this.eventHandlers.onOpen),this.eventHandlers.onError=t=>{console.warn("!!!UNHANDLED!! DATACHANNEL_ERROR:",t),this.sendEventToMachine("ON_DESTROY")},this.dataConnection.on("error",this.eventHandlers.onError),this.eventHandlers.onClose=t=>{console.warn("!!UNHANDLED!! DATACHANNEL_CLOSE:",t),this.sendEventToMachine("ON_DESTROY")},this.dataConnection.on("close",this.eventHandlers.onClose),this.eventHandlers.onPeerError=t=>{t.type=="peer-unavailable"&&this.sendEventToMachine("ON_DESTROY")},this.currentPeer.on("error",this.eventHandlers.onPeerError),this.eventHandlers.onData=t=>{this.lastRecivedMessageTime=Date.now(),this.sendEventToMachine("ON_CONNECTED");const n=Ap.decode(t);this.onMessageRecivedCallback(n)},this.dataConnection.on("data",this.eventHandlers.onData)}sendEventToMachine(t){this.runningMachine&&this.runningMachine.send(t)}onConnecting(){this.connectionTimeout=setTimeout(()=>{this.sendEventToMachine("ON_DESTROY")},12e3)}onConnected(){clearInterval(this.disconnectPollInterval),clearTimeout(this.connectionTimeout),this.connectionTimeout=void 0,this.disconnectPollInterval=setInterval(()=>{console.info("last msg since: "+(Date.now()-this.lastRecivedMessageTime));let t=Date.now()-this.lastRecivedMessageTime<3e3;t&&this.connectionTimeout!=null?(clearTimeout(this.connectionTimeout),this.connectionTimeout=void 0):!t&&this.connectionTimeout==null&&(this.sendEventToMachine("ON_DISCONNECTED"),this.connectionTimeout=setTimeout(()=>{this.sendEventToMachine("ON_DESTROY")},8e3))},1e3)}sendMessage(t){if(this.dataConnection&&this.currentState=="Connected"){const n=Dp.encode(t);return this.dataConnection.send(n)||!0}else return!1}cleanup(){clearTimeout(this.connectionTimeout),clearTimeout(this.disconnectPollInterval),this.runningMachine.stop(),this.currentState="Destroyed",this.onStateChangeCallback(this.currentState),this.eventHandlers&&(this.currentPeer&&this.currentPeer.off("error",this.eventHandlers.onPeerError),this.dataConnection&&(this.dataConnection.off("open",this.eventHandlers.onOpen),this.dataConnection.off("error",this.eventHandlers.onError),this.dataConnection.off("close",this.eventHandlers.onClose),this.dataConnection.off("data",this.eventHandlers.onData),this.dataConnection.close()),this.eventHandlers=null)}}function ji(e){return Ka+Rp(e,fp)}function Mp(e){var t=e[0].toFixed(3),n=-1*e[1].toFixed(3),r=e[2].toFixed(3),i=-1*e[3].toFixed(3);return{thrustVector:[r,n,i],turnRate:t}}let ui={};function ge(e,t,n){if(ui[e])return;let i=Yn.push({msg:e,duration:t||5e3});return ui[e]=i,Yn.subscribe(o=>{o.find(c=>c.msg===e)||(delete ui[e],n&&n())}),i}function vr(e,t){ye.openDialog("alert",{title:e},n=>{t&&n==!0&&t(n)})}let _s=!1;function Lp(e,t){_s||(_s=!0,ye.openDialog("password",{},n=>{n!=null&&t&&t(n)}))}function Np(e,t){let n=ye.openDialog("scrollText",{title:e,messageLines:[]},()=>{t&&t(null)});return i=>{n(o=>({...o,messageLines:[...o.messageLines,i]}))}}const Fi=document.getElementById("connect_btn"),Wr=document.getElementById("connect_btn_options"),bs=document.getElementById("disconnect_btn"),Bp=document.getElementById("connected_rov_label");document.getElementById("rov_connection_bar");function Cs(){Wr.style.display="flex",document.body.classList.remove("rov-connected"),Ui()}function Ss(e){console.log("showROVConnectingUi",Wr),Wr.style.display="none",document.body.classList.remove("rov-connected"),vt("webrtc-connecting","Searching for "+e)}function jp(){Wr.style.display="none",zi(!1),document.body.classList.add("rov-connected"),ze("webrtc-connecting"),ze("webrtc-reconnecting")}function Gi(){let e=lt(an),t=ji(e),n="ROV "+e+" ("+t.replace(Ka,"")+")";Fi.innerText="Connect to "+n,Bp.innerText=n}function Fp(e){return Fi.addEventListener("click",e),()=>{Fi.removeEventListener("click",e)}}function Gp(e){return bs.addEventListener("click",e),()=>{bs.removeEventListener("click",e)}}function Ts(){document.getElementById("scan_for_ip_btn").style.display="block"}function xp(){document.getElementById("scan_for_ip_btn").style.display="none"}const xi=document.getElementById("site_loading_indicator"),Za=document.getElementById("site_loading_text");let wn={};function vt(e,t){const n=wn[e]=t||Li[e]||Li.default;xi.style.display="block",Za.innerHTML=n}function ze(e){delete wn[e];const t=Object.keys(wn);if(e=="all"||t.length==0)xi.style.display="none",wn={},console.log("Done Loading:",e);else{console.log("Loading:",e);const n=wn[t[t.length-1]];Za.innerHTML=n||Li.default,xi.style.display="block"}}const el=document.getElementById("livestream_container");function Es(){el.style.display="block"}function Ui(){el.style.display="none"}const Up=document.getElementById("client_peer_id_label");function zp(e){Up.innerText=e}document.getElementById("role_display_text");const ks=document.getElementById("take_control_btn");function zi(e){e?(document.body.classList.add("rov-driver"),ks.classList.add("hidden")):(document.body.classList.remove("rov-driver"),ks.classList.remove("hidden"))}var Hp=document.getElementById("ping_value");function $p(e){Hp.innerText=e}document.getElementById("battery_value");var Vp=document.getElementById("pressure_value"),Wp=document.getElementById("temp_value");function qp(e){e.pressure&&(Vp.innerText=String(e.pressure/.001*(1023.6*9.8065))),e.temperature&&(Wp.innerText=e.temperature),e.yaw&&Kp(e.yaw),e.pitch&&e.roll&&eh(e.roll,-e.pitch)}let Rs=document.getElementById("actions-menu-overlay"),Jp=document.getElementById("actions-menu-button"),fi=!0;function Yp(){fi=!fi,fi?Rs.classList.add("hidden"):Rs.classList.remove("hidden")}Jp.onclick=Yp;var Xp=document.getElementById("compassDiscImg");const Qp=135;function Kp(e){var t=-(e+Qp);Xp.style.transform=`translateX(${t}px)`}const Zp=document.body;function eh(e,t){var n=Math.min(Math.max(t,-90),90)/90*100;Zp.style.backgroundImage=`linear-gradient(${e}deg, rgba(2,0,36,1) ${-100+n}%, rgba(9,88,116,1) ${50+n}%, rgba(10,109,140,1) ${50+n}%, rgba(0,255,235,1) ${200+n}%)`}new TextEncoder;new TextDecoder;class di{constructor(t,n,r){F(this,"eventHandlers",{});F(this,"currentPeer",null);F(this,"connectionTimeout");F(this,"runningMachine",null);F(this,"mediaChannel",null);F(this,"mainTrack",null);F(this,"onStateChangeCallback",t=>{});F(this,"lastRecivedFrameTime",0);F(this,"xstateMachineLayout",ir({predictableActionArguments:!0,preserveActionOrder:!0,id:"DataConnection",initial:"Connecting",states:{Connecting:{entry:"onConnectingFunction",on:{ON_CONNECTED:{target:"Connected"},ON_DESTROY:{target:"Destroyed"}}},Reconnecting:{entry:"onConnectingFunction",on:{ON_CONNECTED:{target:"Connected"},ON_DESTROY:{target:"Destroyed"}}},Connected:{entry:"onConnectedFunction",on:{ON_DISCONNECTED:{target:"Reconnecting"},ON_DESTROY:{target:"Destroyed"}}},Destroyed:{entry:"onDestoyedFunction",type:"final"}}},{actions:{onConnectingFunction:this.onConnecting.bind(this),onConnectedFunction:this.onConnected.bind(this),onDestoyedFunction:this.cleanup.bind(this)}}));this.currentState=this.xstateMachineLayout.config.initial,this.onStateChangeCallback=r,this.currentPeer=t,this.rovPeerId=n}start(){this.runningMachine=mn(this.xstateMachineLayout,{devTools:lt(sn)}),this.runningMachine.onTransition(t=>{this.currentState!=t.value&&(this.currentState=t.value,this.onStateChangeCallback(this.currentState))}),this.runningMachine.start(),console.info("Waiting for rov peer to call: "+this.rovPeerId),this.eventHandlers.onCall=t=>{console.info("Rov peer called us, answering call"),t.answer(),this.eventHandlers.onStream=n=>{this.sendEventToMachine("ON_CONNECTED"),this.mainTrack=n.getVideoTracks()[0];let r=document.getElementById("video-livestream");console.log("MediaChannel got Stream: ",n,this.mainTrack,r),this.eventHandlers.onStreamMute=()=>{ge("Frozen video stream detected!",1e3)},this.mainTrack.addEventListener("mute",this.eventHandlers.onStreamMute),r.srcObject=n,r.muted=!0,r.autoplay=!0,r.controls=!1,r.play()},t.on("stream",this.eventHandlers.onStream),this.eventHandlers.onError=n=>{console.log("MediaChannel Error: ",n),this.sendEventToMachine("ON_DESTROY")},t.on("error",this.eventHandlers.onError),this.eventHandlers.onClose=()=>{this.sendEventToMachine("ON_DESTROY")},t.on("close",this.eventHandlers.onClose)},this.currentPeer.on("call",this.eventHandlers.onCall)}sendEventToMachine(t){this.runningMachine&&this.runningMachine.send(t)}onConnecting(){this.connectionTimeout=setTimeout(()=>{this.sendEventToMachine("ON_DESTROY")},8e3)}onConnected(){clearInterval(this.disconnectPollInterval),clearTimeout(this.connectionTimeout),this.currentPeer.off("call",this.eventHandlers.onCall),this.connectionTimeout=void 0,this.disconnectPollInterval=setInterval(()=>{this.connectionTimeout!=null&&(clearTimeout(this.connectionTimeout),this.connectionTimeout=void 0)},1e3)}cleanup(){clearTimeout(this.connectionTimeout),clearTimeout(this.disconnectPollInterval),this.runningMachine.stop(),this.currentState="Destroyed",this.onStateChangeCallback(this.currentState),this.eventHandlers&&(this.currentPeer&&this.currentPeer.off("call",this.eventHandlers.onCall),this.mediaChannel&&(this.mediaChannel.off("stream",this.eventHandlers.onStream),this.mediaChannel.off("error",this.eventHandlers.onError),this.mediaChannel.off("close",this.eventHandlers.onClose),this.mediaChannel.close()),this.mainTrack&&(this.mainTrack.removeEventListener("mute",this.eventHandlers.onStreamMute),this.mainTrack.ended=!0),this.eventHandlers=null)}}var ho={exports:{}};(function(e){var t={};t.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),t.useArrayBufferView=!t.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch{return!0}}(),e.exports.binaryFeatures=t;var n=e.exports.BlobBuilder;typeof window<"u"&&(n=e.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder);function r(){this._pieces=[],this._parts=[]}r.prototype.append=function(i){typeof i=="number"?this._pieces.push(i):(this.flush(),this._parts.push(i))},r.prototype.flush=function(){if(this._pieces.length>0){var i=new Uint8Array(this._pieces);t.useArrayBufferView||(i=i.buffer),this._parts.push(i),this._pieces=[]}},r.prototype.getBuffer=function(){if(this.flush(),t.useBlobBuilder){for(var i=new n,o=0,l=this._parts.length;o<l;o++)i.append(this._parts[o]);return i.getBlob()}else return new Blob(this._parts)},e.exports.BufferBuilder=r})(ho);var th=ho.exports.BufferBuilder,Ps=ho.exports.binaryFeatures,nh={unpack:function(e){var t=new Le(e);return t.unpack()},pack:function(e){var t=new Ne;t.pack(e);var n=t.getBuffer();return n}},Os=nh;function Le(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}Le.prototype.unpack=function(){var e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;var t;if((t=e^160)<=15)return this.unpack_raw(t);if((t=e^176)<=15)return this.unpack_string(t);if((t=e^144)<=15)return this.unpack_array(t);if((t=e^128)<=15)return this.unpack_map(t);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return t=this.unpack_uint16(),this.unpack_string(t);case 217:return t=this.unpack_uint32(),this.unpack_string(t);case 218:return t=this.unpack_uint16(),this.unpack_raw(t);case 219:return t=this.unpack_uint32(),this.unpack_raw(t);case 220:return t=this.unpack_uint16(),this.unpack_array(t);case 221:return t=this.unpack_uint32(),this.unpack_array(t);case 222:return t=this.unpack_uint16(),this.unpack_map(t);case 223:return t=this.unpack_uint32(),this.unpack_map(t)}};Le.prototype.unpack_uint8=function(){var e=this.dataView[this.index]&255;return this.index++,e};Le.prototype.unpack_uint16=function(){var e=this.read(2),t=(e[0]&255)*256+(e[1]&255);return this.index+=2,t};Le.prototype.unpack_uint32=function(){var e=this.read(4),t=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,t};Le.prototype.unpack_uint64=function(){var e=this.read(8),t=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,t};Le.prototype.unpack_int8=function(){var e=this.unpack_uint8();return e<128?e:e-(1<<8)};Le.prototype.unpack_int16=function(){var e=this.unpack_uint16();return e<32768?e:e-(1<<16)};Le.prototype.unpack_int32=function(){var e=this.unpack_uint32();return e<Math.pow(2,31)?e:e-Math.pow(2,32)};Le.prototype.unpack_int64=function(){var e=this.unpack_uint64();return e<Math.pow(2,63)?e:e-Math.pow(2,64)};Le.prototype.unpack_raw=function(e){if(this.length<this.index+e)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+e+" "+this.length);var t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t};Le.prototype.unpack_string=function(e){for(var t=this.read(e),n=0,r="",i,o;n<e;)i=t[n],i<128?(r+=String.fromCharCode(i),n++):(i^192)<32?(o=(i^192)<<6|t[n+1]&63,r+=String.fromCharCode(o),n+=2):(o=(i&15)<<12|(t[n+1]&63)<<6|t[n+2]&63,r+=String.fromCharCode(o),n+=3);return this.index+=e,r};Le.prototype.unpack_array=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=this.unpack();return t};Le.prototype.unpack_map=function(e){for(var t={},n=0;n<e;n++){var r=this.unpack(),i=this.unpack();t[r]=i}return t};Le.prototype.unpack_float=function(){var e=this.unpack_uint32(),t=e>>31,n=(e>>23&255)-127,r=e&8388607|8388608;return(t===0?1:-1)*r*Math.pow(2,n-23)};Le.prototype.unpack_double=function(){var e=this.unpack_uint32(),t=this.unpack_uint32(),n=e>>31,r=(e>>20&2047)-1023,i=e&1048575|1048576,o=i*Math.pow(2,r-20)+t*Math.pow(2,r-52);return(n===0?1:-1)*o};Le.prototype.read=function(e){var t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")};function Ne(){this.bufferBuilder=new th}Ne.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()};Ne.prototype.pack=function(e){var t=typeof e;if(t==="string")this.pack_string(e);else if(t==="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(t==="boolean")e===!0?this.bufferBuilder.append(195):e===!1&&this.bufferBuilder.append(194);else if(t==="undefined")this.bufferBuilder.append(192);else if(t==="object")if(e===null)this.bufferBuilder.append(192);else{var n=e.constructor;if(n==Array)this.pack_array(e);else if(n==Blob||n==File||e instanceof Blob||e instanceof File)this.pack_bin(e);else if(n==ArrayBuffer)Ps.useArrayBufferView?this.pack_bin(new Uint8Array(e)):this.pack_bin(e);else if("BYTES_PER_ELEMENT"in e)Ps.useArrayBufferView?this.pack_bin(new Uint8Array(e.buffer)):this.pack_bin(e.buffer);else if(n==Object||n.toString().startsWith("class"))this.pack_object(e);else if(n==Date)this.pack_string(e.toString());else if(typeof e.toBinaryPack=="function")this.bufferBuilder.append(e.toBinaryPack());else throw new Error('Type "'+n.toString()+'" not yet supported')}else throw new Error('Type "'+t+'" not yet supported');this.bufferBuilder.flush()};Ne.prototype.pack_bin=function(e){var t=e.length||e.byteLength||e.size;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this.bufferBuilder.append(218),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(219),this.pack_uint32(t);else throw new Error("Invalid length");this.bufferBuilder.append(e)};Ne.prototype.pack_string=function(e){var t=ih(e);if(t<=15)this.pack_uint8(176+t);else if(t<=65535)this.bufferBuilder.append(216),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(217),this.pack_uint32(t);else throw new Error("Invalid length");this.bufferBuilder.append(e)};Ne.prototype.pack_array=function(e){var t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this.bufferBuilder.append(220),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(221),this.pack_uint32(t);else throw new Error("Invalid length");for(var n=0;n<t;n++)this.pack(e[n])};Ne.prototype.pack_integer=function(e){if(e>=-32&&e<=127)this.bufferBuilder.append(e&255);else if(e>=0&&e<=255)this.bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this.bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this.bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this.bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this.bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this.bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")};Ne.prototype.pack_double=function(e){var t=0;e<0&&(t=1,e=-e);var n=Math.floor(Math.log(e)/Math.LN2),r=e/Math.pow(2,n)-1,i=Math.floor(r*Math.pow(2,52)),o=Math.pow(2,32),l=t<<31|n+1023<<20|i/o&1048575,c=i%o;this.bufferBuilder.append(203),this.pack_int32(l),this.pack_int32(c)};Ne.prototype.pack_object=function(e){var t=Object.keys(e),n=t.length;if(n<=15)this.pack_uint8(128+n);else if(n<=65535)this.bufferBuilder.append(222),this.pack_uint16(n);else if(n<=4294967295)this.bufferBuilder.append(223),this.pack_uint32(n);else throw new Error("Invalid length");for(var r in e)e.hasOwnProperty(r)&&(this.pack(r),this.pack(e[r]))};Ne.prototype.pack_uint8=function(e){this.bufferBuilder.append(e)};Ne.prototype.pack_uint16=function(e){this.bufferBuilder.append(e>>8),this.bufferBuilder.append(e&255)};Ne.prototype.pack_uint32=function(e){var t=e&4294967295;this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)};Ne.prototype.pack_uint64=function(e){var t=e/Math.pow(2,32),n=e%Math.pow(2,32);this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255),this.bufferBuilder.append((n&4278190080)>>>24),this.bufferBuilder.append((n&16711680)>>>16),this.bufferBuilder.append((n&65280)>>>8),this.bufferBuilder.append(n&255)};Ne.prototype.pack_int8=function(e){this.bufferBuilder.append(e&255)};Ne.prototype.pack_int16=function(e){this.bufferBuilder.append((e&65280)>>8),this.bufferBuilder.append(e&255)};Ne.prototype.pack_int32=function(e){this.bufferBuilder.append(e>>>24&255),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255)};Ne.prototype.pack_int64=function(e){var t=Math.floor(e/Math.pow(2,32)),n=e%Math.pow(2,32);this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255),this.bufferBuilder.append((n&4278190080)>>>24),this.bufferBuilder.append((n&16711680)>>>16),this.bufferBuilder.append((n&65280)>>>8),this.bufferBuilder.append(n&255)};function rh(e){var t=e.charCodeAt(0);return t<=2047?"00":t<=65535?"000":t<=2097151?"0000":t<=67108863?"00000":"000000"}function ih(e){return e.length>600?new Blob([e]).size:e.replace(/[^\u0000-\u007F]/g,rh).length}let tl=!0,nl=!0;function Dn(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function gn(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(l,c){if(l!==t)return i.apply(this,arguments);const s=u=>{const f=n(u);f&&(c.handleEvent?c.handleEvent(f):c(f))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(c,s),i.apply(this,[l,s])};const o=r.removeEventListener;r.removeEventListener=function(l,c){if(l!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(c))return o.apply(this,arguments);const s=this._eventMap[t].get(c);return this._eventMap[t].delete(c),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[l,s])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(l){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),l&&this.addEventListener(t,this["_on"+t]=l)},enumerable:!0,configurable:!0})}function oh(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(tl=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function sh(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(nl=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function mo(){if(typeof window=="object"){if(tl)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function ei(e,t){!nl||console.warn(e+" is deprecated, please use "+t+" instead.")}function ah(e){const t={browser:null,version:null};if(typeof e>"u"||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=Dn(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=Dn(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.mediaDevices&&n.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=Dn(n.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(e.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=Dn(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}function ws(e){return Object.prototype.toString.call(e)==="[object Object]"}function rl(e){return ws(e)?Object.keys(e).reduce(function(t,n){const r=ws(e[n]),i=r?rl(e[n]):e[n],o=r&&!Object.keys(i).length;return i===void 0||o?t:Object.assign(t,{[n]:i})},{}):e}function Hi(e,t,n){!t||n.has(t.id)||(n.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?Hi(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(i=>{Hi(e,e.get(i),n)})}))}function Ds(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;const o=[];return e.forEach(l=>{l.type==="track"&&l.trackIdentifier===t.id&&o.push(l)}),o.forEach(l=>{e.forEach(c=>{c.type===r&&c.trackId===l.id&&Hi(e,c,i)})}),i}const As=mo;function il(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;const s={};return Object.keys(c).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const f=typeof c[u]=="object"?c[u]:{ideal:c[u]};f.exact!==void 0&&typeof f.exact=="number"&&(f.min=f.max=f.exact);const a=function(d,p){return d?d+p.charAt(0).toUpperCase()+p.slice(1):p==="deviceId"?"sourceId":p};if(f.ideal!==void 0){s.optional=s.optional||[];let d={};typeof f.ideal=="number"?(d[a("min",u)]=f.ideal,s.optional.push(d),d={},d[a("max",u)]=f.ideal,s.optional.push(d)):(d[a("",u)]=f.ideal,s.optional.push(d))}f.exact!==void 0&&typeof f.exact!="number"?(s.mandatory=s.mandatory||{},s.mandatory[a("",u)]=f.exact):["min","max"].forEach(d=>{f[d]!==void 0&&(s.mandatory=s.mandatory||{},s.mandatory[a(d,u)]=f[d])})}),c.advanced&&(s.optional=(s.optional||[]).concat(c.advanced)),s},i=function(c,s){if(t.version>=61)return s(c);if(c=JSON.parse(JSON.stringify(c)),c&&typeof c.audio=="object"){const u=function(f,a,d){a in f&&!(d in f)&&(f[d]=f[a],delete f[a])};c=JSON.parse(JSON.stringify(c)),u(c.audio,"autoGainControl","googAutoGainControl"),u(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=r(c.audio)}if(c&&typeof c.video=="object"){let u=c.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const f=t.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!f)){delete c.video.facingMode;let a;if(u.exact==="environment"||u.ideal==="environment"?a=["back","rear"]:(u.exact==="user"||u.ideal==="user")&&(a=["front"]),a)return n.mediaDevices.enumerateDevices().then(d=>{d=d.filter(h=>h.kind==="videoinput");let p=d.find(h=>a.some(g=>h.label.toLowerCase().includes(g)));return!p&&d.length&&a.includes("back")&&(p=d[d.length-1]),p&&(c.video.deviceId=u.exact?{exact:p.deviceId}:{ideal:p.deviceId}),c.video=r(c.video),As("chrome: "+JSON.stringify(c)),s(c)})}c.video=r(c.video)}return As("chrome: "+JSON.stringify(c)),s(c)},o=function(c){return t.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},l=function(c,s,u){i(c,f=>{n.webkitGetUserMedia(f,s,a=>{u&&u(o(a))})})};if(n.getUserMedia=l.bind(n),n.mediaDevices.getUserMedia){const c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(s){return i(s,u=>c(u).then(f=>{if(u.audio&&!f.getAudioTracks().length||u.video&&!f.getVideoTracks().length)throw f.getTracks().forEach(a=>{a.stop()}),new DOMException("","NotFoundError");return f},f=>Promise.reject(o(f))))}}}function lh(e,t){if(!(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)&&!!e.navigator.mediaDevices){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(i=>{const o=r.video&&r.video.width,l=r.video&&r.video.height,c=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:c||3}},o&&(r.video.mandatory.maxWidth=o),l&&(r.video.mandatory.maxHeight=l),e.navigator.mediaDevices.getUserMedia(r)})}}}function ol(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function sl(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let o;e.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(c=>c.track&&c.track.id===i.track.id):o={track:i.track};const l=new Event("track");l.track=i.track,l.receiver=o,l.transceiver={receiver:o},l.streams=[r.stream],this.dispatchEvent(l)}),r.stream.getTracks().forEach(i=>{let o;e.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(c=>c.track&&c.track.id===i.id):o={track:i};const l=new Event("track");l.track=i,l.receiver=o,l.transceiver={receiver:o},l.streams=[r.stream],this.dispatchEvent(l)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else gn(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function al(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(i,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=i.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(c,s){let u=i.apply(this,arguments);return u||(u=t(this,c),this._senders.push(u)),u};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(c){o.apply(this,arguments);const s=this._senders.indexOf(c);s!==-1&&this._senders.splice(s,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(l=>{this._senders.push(t(this,l))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],r.apply(this,[o]),o.getTracks().forEach(l=>{const c=this._senders.find(s=>s.track===l);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function ll(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[r,i,o]=arguments;if(arguments.length>0&&typeof r=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof r!="function"))return t.apply(this,[]);const l=function(s){const u={};return s.result().forEach(a=>{const d={id:a.id,timestamp:a.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||a.type};a.names().forEach(p=>{d[p]=a.stat(p)}),u[d.id]=d}),u},c=function(s){return new Map(Object.keys(s).map(u=>[u,s[u]]))};if(arguments.length>=2){const s=function(u){i(c(l(u)))};return t.apply(this,[s,r])}return new Promise((s,u)=>{t.apply(this,[function(f){s(c(l(f)))},u])}).then(i,o)}}function cl(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(l=>l._pc=this),o});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=r.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(l=>Ds(l,o.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i}),gn(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>Ds(o,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const r=arguments[0];let i,o,l;return this.getSenders().forEach(c=>{c.track===r&&(i?l=!0:i=c)}),this.getReceivers().forEach(c=>(c.track===r&&(o?l=!0:o=c),c.track===r)),l||i&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function ul(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(l=>this._shimmedLocalStreams[l][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(l,c){if(!c)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const s=t.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(s)===-1&&this._shimmedLocalStreams[c.id].push(s):this._shimmedLocalStreams[c.id]=[c,s],s};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){this._shimmedLocalStreams=this._shimmedLocalStreams||{},l.getTracks().forEach(u=>{if(this.getSenders().find(a=>a.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();n.apply(this,arguments);const s=this.getSenders().filter(u=>c.indexOf(u)===-1);this._shimmedLocalStreams[l.id]=[l].concat(s)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[l.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},l&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const s=this._shimmedLocalStreams[c].indexOf(l);s!==-1&&this._shimmedLocalStreams[c].splice(s,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),i.apply(this,arguments)}}function fl(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return ul(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const f=n.apply(this);return this._reverseStreams=this._reverseStreams||{},f.map(a=>this._reverseStreams[a.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(f){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},f.getTracks().forEach(a=>{if(this.getSenders().find(p=>p.track===a))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[f.id]){const a=new e.MediaStream(f.getTracks());this._streams[f.id]=a,this._reverseStreams[a.id]=f,f=a}r.apply(this,[f])};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(f){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[f.id]||f]),delete this._reverseStreams[this._streams[f.id]?this._streams[f.id].id:f.id],delete this._streams[f.id]},e.RTCPeerConnection.prototype.addTrack=function(f,a){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const d=[].slice.call(arguments,1);if(d.length!==1||!d[0].getTracks().find(g=>g===f))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===f))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const h=this._streams[a.id];if(h)h.addTrack(f),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new e.MediaStream([f]);this._streams[a.id]=g,this._reverseStreams[g.id]=a,this.addStream(g)}return this.getSenders().find(g=>g.track===f)};function o(u,f){let a=f.sdp;return Object.keys(u._reverseStreams||[]).forEach(d=>{const p=u._reverseStreams[d],h=u._streams[p.id];a=a.replace(new RegExp(h.id,"g"),p.id)}),new RTCSessionDescription({type:f.type,sdp:a})}function l(u,f){let a=f.sdp;return Object.keys(u._reverseStreams||[]).forEach(d=>{const p=u._reverseStreams[d],h=u._streams[p.id];a=a.replace(new RegExp(p.id,"g"),h.id)}),new RTCSessionDescription({type:f.type,sdp:a})}["createOffer","createAnswer"].forEach(function(u){const f=e.RTCPeerConnection.prototype[u],a={[u](){const d=arguments;return arguments.length&&typeof arguments[0]=="function"?f.apply(this,[h=>{const g=o(this,h);d[0].apply(null,[g])},h=>{d[1]&&d[1].apply(null,h)},arguments[2]]):f.apply(this,arguments).then(h=>o(this,h))}};e.RTCPeerConnection.prototype[u]=a[u]});const c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?c.apply(this,arguments):(arguments[0]=l(this,arguments[0]),c.apply(this,arguments))};const s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const u=s.get.apply(this);return u.type===""?u:o(this,u)}}),e.RTCPeerConnection.prototype.removeTrack=function(f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!f._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(f._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let d;Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(g=>f.track===g)&&(d=this._streams[p])}),d&&(d.getTracks().length===1?this.removeStream(this._reverseStreams[d.id]):d.removeTrack(f.track),this.dispatchEvent(new Event("negotiationneeded")))}}function $i(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),!!e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=e.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=i[n]})}function dl(e,t){gn(e,"negotiationneeded",n=>{const r=n.target;if(!((t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}const Is=Object.freeze(Object.defineProperty({__proto__:null,shimMediaStream:ol,shimOnTrack:sl,shimGetSendersWithDtmf:al,shimGetStats:ll,shimSenderReceiverGetStats:cl,shimAddTrackRemoveTrackWithNative:ul,shimAddTrackRemoveTrack:fl,shimPeerConnection:$i,fixNegotiationNeeded:dl,shimGetUserMedia:il,shimGetDisplayMedia:lh},Symbol.toStringTag,{value:"Module"}));function ch(e,t){let n=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(r=>{if(r&&(r.urls||r.url)){let i=r.urls||r.url;r.url&&!r.urls&&ei("RTCIceServer.url","RTCIceServer.urls");const o=typeof i=="string";return o&&(i=[i]),i=i.filter(l=>{if(l.indexOf("stun:")===0)return!1;const c=l.startsWith("turn")&&!l.startsWith("turn:[")&&l.includes("transport=udp");return c&&!n?(n=!0,!0):c&&!n}),delete r.url,r.urls=o?i[0]:i,!!i.length}})}var go={exports:{}};(function(e){var t={};t.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(function(r){return r.trim()})},t.splitSections=function(n){var r=n.split(`
m=`);return r.map(function(i,o){return(o>0?"m="+i:i).trim()+`\r
`})},t.getDescription=function(n){var r=t.splitSections(n);return r&&r[0]},t.getMediaSections=function(n){var r=t.splitSections(n);return r.shift(),r},t.matchPrefix=function(n,r){return t.splitLines(n).filter(function(i){return i.indexOf(r)===0})},t.parseCandidate=function(n){var r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");for(var i={foundation:r[0],component:parseInt(r[1],10),protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]},o=8;o<r.length;o+=2)switch(r[o]){case"raddr":i.relatedAddress=r[o+1];break;case"rport":i.relatedPort=parseInt(r[o+1],10);break;case"tcptype":i.tcpType=r[o+1];break;case"ufrag":i.ufrag=r[o+1],i.usernameFragment=r[o+1];break;default:i[r[o]]=r[o+1];break}return i},t.writeCandidate=function(n){var r=[];r.push(n.foundation),r.push(n.component),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);var i=n.type;return r.push("typ"),r.push(i),i!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(n){return n.substr(14).split(" ")},t.parseRtpMap=function(n){var r=n.substr(9).split(" "),i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(n){var r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);var i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},t.parseExtmap=function(n){var r=n.substr(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1]}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+`\r
`},t.parseFmtp=function(n){for(var r={},i,o=n.substr(n.indexOf(" ")+1).split(";"),l=0;l<o.length;l++)i=o[l].trim().split("="),r[i[0].trim()]=i[1];return r},t.writeFmtp=function(n){var r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){var o=[];Object.keys(n.parameters).forEach(function(l){n.parameters[l]?o.push(l+"="+n.parameters[l]):o.push(l)}),r+="a=fmtp:"+i+" "+o.join(";")+`\r
`}return r},t.parseRtcpFb=function(n){var r=n.substr(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(n){var r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(function(o){r+="a=rtcp-fb:"+i+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(n){var r=n.indexOf(" "),i={ssrc:parseInt(n.substr(7,r-7),10)},o=n.indexOf(":",r);return o>-1?(i.attribute=n.substr(r+1,o-r-1),i.value=n.substr(o+1)):i.attribute=n.substr(r+1),i},t.parseSsrcGroup=function(n){var r=n.substr(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(function(i){return parseInt(i,10)})}},t.getMid=function(n){var r=t.matchPrefix(n,"a=mid:")[0];if(r)return r.substr(6)},t.parseFingerprint=function(n){var r=n.substr(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1]}},t.getDtlsParameters=function(n,r){var i=t.matchPrefix(n+r,"a=fingerprint:");return{role:"auto",fingerprints:i.map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,r){var i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(function(o){i+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),i},t.parseCryptoLine=function(n){var r=n.substr(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;var r=n.substr(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,r){var i=t.matchPrefix(n+r,"a=crypto:");return i.map(t.parseCryptoLine)},t.getIceParameters=function(n,r){var i=t.matchPrefix(n+r,"a=ice-ufrag:")[0],o=t.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&o?{usernameFragment:i.substr(12),password:o.substr(10)}:null},t.writeIceParameters=function(n){return"a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`},t.parseRtpParameters=function(n){for(var r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(n),o=i[0].split(" "),l=3;l<o.length;l++){var c=o[l],s=t.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(s){var u=t.parseRtpMap(s),f=t.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=f.length?t.parseFmtp(f[0]):{},u.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(t.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase());break}}}return t.matchPrefix(n,"a=extmap:").forEach(function(a){r.headerExtensions.push(t.parseExtmap(a))}),r},t.writeRtpDescription=function(n,r){var i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=r.codecs.map(function(l){return l.preferredPayloadType!==void 0?l.preferredPayloadType:l.payloadType}).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(function(l){i+=t.writeRtpMap(l),i+=t.writeFmtp(l),i+=t.writeRtcpFb(l)});var o=0;return r.codecs.forEach(function(l){l.maxptime>o&&(o=l.maxptime)}),o>0&&(i+="a=maxptime:"+o+`\r
`),i+=`a=rtcp-mux\r
`,r.headerExtensions&&r.headerExtensions.forEach(function(l){i+=t.writeExtmap(l)}),i},t.parseRtpEncodingParameters=function(n){var r=[],i=t.parseRtpParameters(n),o=i.fecMechanisms.indexOf("RED")!==-1,l=i.fecMechanisms.indexOf("ULPFEC")!==-1,c=t.matchPrefix(n,"a=ssrc:").map(function(d){return t.parseSsrcMedia(d)}).filter(function(d){return d.attribute==="cname"}),s=c.length>0&&c[0].ssrc,u,f=t.matchPrefix(n,"a=ssrc-group:FID").map(function(d){var p=d.substr(17).split(" ");return p.map(function(h){return parseInt(h,10)})});f.length>0&&f[0].length>1&&f[0][0]===s&&(u=f[0][1]),i.codecs.forEach(function(d){if(d.name.toUpperCase()==="RTX"&&d.parameters.apt){var p={ssrc:s,codecPayloadType:parseInt(d.parameters.apt,10)};s&&u&&(p.rtx={ssrc:u}),r.push(p),o&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:s,mechanism:l?"red+ulpfec":"red"},r.push(p))}}),r.length===0&&s&&r.push({ssrc:s});var a=t.matchPrefix(n,"b=");return a.length&&(a[0].indexOf("b=TIAS:")===0?a=parseInt(a[0].substr(7),10):a[0].indexOf("b=AS:")===0?a=parseInt(a[0].substr(5),10)*1e3*.95-50*40*8:a=void 0,r.forEach(function(d){d.maxBitrate=a})),r},t.parseRtcpParameters=function(n){var r={},i=t.matchPrefix(n,"a=ssrc:").map(function(c){return t.parseSsrcMedia(c)}).filter(function(c){return c.attribute==="cname"})[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);var o=t.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=o.length>0,r.compound=o.length===0;var l=t.matchPrefix(n,"a=rtcp-mux");return r.mux=l.length>0,r},t.parseMsid=function(n){var r,i=t.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substr(7).split(" "),{stream:r[0],track:r[1]};var o=t.matchPrefix(n,"a=ssrc:").map(function(l){return t.parseSsrcMedia(l)}).filter(function(l){return l.attribute==="msid"});if(o.length>0)return r=o[0].value.split(" "),{stream:r[0],track:r[1]}},t.parseSctpDescription=function(n){var r=t.parseMLine(n),i=t.matchPrefix(n,"a=max-message-size:"),o;i.length>0&&(o=parseInt(i[0].substr(19),10)),isNaN(o)&&(o=65536);var l=t.matchPrefix(n,"a=sctp-port:");if(l.length>0)return{port:parseInt(l[0].substr(12),10),protocol:r.fmt,maxMessageSize:o};var c=t.matchPrefix(n,"a=sctpmap:");if(c.length>0){var s=t.matchPrefix(n,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(s[0],10),protocol:s[1],maxMessageSize:o}}},t.writeSctpDescription=function(n,r){var i=[];return n.protocol!=="DTLS/SCTP"?i=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:i=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(n,r,i){var o,l=r!==void 0?r:2;n?o=n:o=t.generateSessionId();var c=i||"thisisadapterortc";return`v=0\r
o=`+c+" "+o+" "+l+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.writeMediaSection=function(n,r,i,o){var l=t.writeRtpDescription(n.kind,r);if(l+=t.writeIceParameters(n.iceGatherer.getLocalParameters()),l+=t.writeDtlsParameters(n.dtlsTransport.getLocalParameters(),i==="offer"?"actpass":"active"),l+="a=mid:"+n.mid+`\r
`,n.direction?l+="a="+n.direction+`\r
`:n.rtpSender&&n.rtpReceiver?l+=`a=sendrecv\r
`:n.rtpSender?l+=`a=sendonly\r
`:n.rtpReceiver?l+=`a=recvonly\r
`:l+=`a=inactive\r
`,n.rtpSender){var c="msid:"+o.id+" "+n.rtpSender.track.id+`\r
`;l+="a="+c,l+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" "+c,n.sendEncodingParameters[0].rtx&&(l+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" "+c,l+="a=ssrc-group:FID "+n.sendEncodingParameters[0].ssrc+" "+n.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return l+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" cname:"+t.localCName+`\r
`,n.rtpSender&&n.sendEncodingParameters[0].rtx&&(l+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" cname:"+t.localCName+`\r
`),l},t.getDirection=function(n,r){for(var i=t.splitLines(n),o=0;o<i.length;o++)switch(i[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[o].substr(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(n){var r=t.splitLines(n),i=r[0].split(" ");return i[0].substr(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){var r=t.splitLines(n),i=r[0].substr(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(n){var r=t.matchPrefix(n,"o=")[0],i=r.substr(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;for(var r=t.splitLines(n),i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},e.exports=t})(go);const Or=go.exports;var $=go.exports;function uh(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}function Ms(e,t,n,r,i){var o=$.writeRtpDescription(e.kind,t);if(o+=$.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=$.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),n==="offer"?"actpass":i||"active"),o+="a=mid:"+e.mid+`\r
`,e.rtpSender&&e.rtpReceiver?o+=`a=sendrecv\r
`:e.rtpSender?o+=`a=sendonly\r
`:e.rtpReceiver?o+=`a=recvonly\r
`:o+=`a=inactive\r
`,e.rtpSender){var l=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=l;var c="msid:"+(r?r.id:"-")+" "+l+`\r
`;o+="a="+c,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+$.localCName+`\r
`,e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+$.localCName+`\r
`),o}function fh(e,t){var n=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(r){if(r&&(r.urls||r.url)){var i=r.urls||r.url;r.url&&!r.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var o=typeof i=="string";return o&&(i=[i]),i=i.filter(function(l){var c=l.indexOf("turn:")===0&&l.indexOf("transport=udp")!==-1&&l.indexOf("turn:[")===-1&&!n;return c?(n=!0,!0):l.indexOf("stun:")===0&&t>=14393&&l.indexOf("?transport=udp")===-1}),delete r.url,r.urls=o?i[0]:i,!!i.length}})}function yr(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(o,l){o=parseInt(o,10);for(var c=0;c<l.length;c++)if(l[c].payloadType===o||l[c].preferredPayloadType===o)return l[c]},i=function(o,l,c,s){var u=r(o.parameters.apt,c),f=r(l.parameters.apt,s);return u&&f&&u.name.toLowerCase()===f.name.toLowerCase()};return e.codecs.forEach(function(o){for(var l=0;l<t.codecs.length;l++){var c=t.codecs[l];if(o.name.toLowerCase()===c.name.toLowerCase()&&o.clockRate===c.clockRate){if(o.name.toLowerCase()==="rtx"&&o.parameters&&c.parameters.apt&&!i(o,c,e.codecs,t.codecs))continue;c=JSON.parse(JSON.stringify(c)),c.numChannels=Math.min(o.numChannels,c.numChannels),n.codecs.push(c),c.rtcpFeedback=c.rtcpFeedback.filter(function(s){for(var u=0;u<o.rtcpFeedback.length;u++)if(o.rtcpFeedback[u].type===s.type&&o.rtcpFeedback[u].parameter===s.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(o){for(var l=0;l<t.headerExtensions.length;l++){var c=t.headerExtensions[l];if(o.uri===c.uri){n.headerExtensions.push(c);break}}}),n}function Ls(e,t,n){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)!==-1}function pi(e,t){var n=e.getRemoteCandidates().find(function(r){return t.foundation===r.foundation&&t.ip===r.ip&&t.port===r.port&&t.priority===r.priority&&t.protocol===r.protocol&&t.type===r.type});return n||e.addRemoteCandidate(t),!n}function Be(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}var dh=function(e,t){function n(s,u){u.addTrack(s),u.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:s}))}function r(s,u){u.removeTrack(s),u.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:s}))}function i(s,u,f,a){var d=new Event("track");d.track=u,d.receiver=f,d.transceiver={receiver:f},d.streams=a,e.setTimeout(function(){s._dispatchEvent("track",d)})}var o=function(s){var u=this,f=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(d){u[d]=f[d].bind(f)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",s=JSON.parse(JSON.stringify(s||{})),this.usingBundle=s.bundlePolicy==="max-bundle",s.rtcpMuxPolicy==="negotiate")throw Be("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(s.rtcpMuxPolicy||(s.rtcpMuxPolicy="require"),s.iceTransportPolicy){case"all":case"relay":break;default:s.iceTransportPolicy="all";break}switch(s.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:s.bundlePolicy="balanced";break}if(s.iceServers=fh(s.iceServers||[],t),this._iceGatherers=[],s.iceCandidatePoolSize)for(var a=s.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:s.iceServers,gatherPolicy:s.iceTransportPolicy}));else s.iceCandidatePoolSize=0;this._config=s,this.transceivers=[],this._sdpSessionId=$.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(o.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(o.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),o.prototype.onicecandidate=null,o.prototype.onaddstream=null,o.prototype.ontrack=null,o.prototype.onremovestream=null,o.prototype.onsignalingstatechange=null,o.prototype.oniceconnectionstatechange=null,o.prototype.onconnectionstatechange=null,o.prototype.onicegatheringstatechange=null,o.prototype.onnegotiationneeded=null,o.prototype.ondatachannel=null,o.prototype._dispatchEvent=function(s,u){this._isClosed||(this.dispatchEvent(u),typeof this["on"+s]=="function"&&this["on"+s](u))},o.prototype._emitGatheringStateChange=function(){var s=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",s)},o.prototype.getConfiguration=function(){return this._config},o.prototype.getLocalStreams=function(){return this.localStreams},o.prototype.getRemoteStreams=function(){return this.remoteStreams},o.prototype._createTransceiver=function(s,u){var f=this.transceivers.length>0,a={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:s,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&f)a.iceTransport=this.transceivers[0].iceTransport,a.dtlsTransport=this.transceivers[0].dtlsTransport;else{var d=this._createIceAndDtlsTransports();a.iceTransport=d.iceTransport,a.dtlsTransport=d.dtlsTransport}return u||this.transceivers.push(a),a},o.prototype.addTrack=function(s,u){if(this._isClosed)throw Be("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var f=this.transceivers.find(function(p){return p.track===s});if(f)throw Be("InvalidAccessError","Track already exists.");for(var a,d=0;d<this.transceivers.length;d++)!this.transceivers[d].track&&this.transceivers[d].kind===s.kind&&(a=this.transceivers[d]);return a||(a=this._createTransceiver(s.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(u)===-1&&this.localStreams.push(u),a.track=s,a.stream=u,a.rtpSender=new e.RTCRtpSender(s,a.dtlsTransport),a.rtpSender},o.prototype.addStream=function(s){var u=this;if(t>=15025)s.getTracks().forEach(function(a){u.addTrack(a,s)});else{var f=s.clone();s.getTracks().forEach(function(a,d){var p=f.getTracks()[d];a.addEventListener("enabled",function(h){p.enabled=h.enabled})}),f.getTracks().forEach(function(a){u.addTrack(a,f)})}},o.prototype.removeTrack=function(s){if(this._isClosed)throw Be("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(s instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var u=this.transceivers.find(function(d){return d.rtpSender===s});if(!u)throw Be("InvalidAccessError","Sender was not created by this connection.");var f=u.stream;u.rtpSender.stop(),u.rtpSender=null,u.track=null,u.stream=null;var a=this.transceivers.map(function(d){return d.stream});a.indexOf(f)===-1&&this.localStreams.indexOf(f)>-1&&this.localStreams.splice(this.localStreams.indexOf(f),1),this._maybeFireNegotiationNeeded()},o.prototype.removeStream=function(s){var u=this;s.getTracks().forEach(function(f){var a=u.getSenders().find(function(d){return d.track===f});a&&u.removeTrack(a)})},o.prototype.getSenders=function(){return this.transceivers.filter(function(s){return!!s.rtpSender}).map(function(s){return s.rtpSender})},o.prototype.getReceivers=function(){return this.transceivers.filter(function(s){return!!s.rtpReceiver}).map(function(s){return s.rtpReceiver})},o.prototype._createIceGatherer=function(s,u){var f=this;if(u&&s>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var a=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(a,"state",{value:"new",writable:!0}),this.transceivers[s].bufferedCandidateEvents=[],this.transceivers[s].bufferCandidates=function(d){var p=!d.candidate||Object.keys(d.candidate).length===0;a.state=p?"completed":"gathering",f.transceivers[s].bufferedCandidateEvents!==null&&f.transceivers[s].bufferedCandidateEvents.push(d)},a.addEventListener("localcandidate",this.transceivers[s].bufferCandidates),a},o.prototype._gather=function(s,u){var f=this,a=this.transceivers[u].iceGatherer;if(!a.onlocalcandidate){var d=this.transceivers[u].bufferedCandidateEvents;this.transceivers[u].bufferedCandidateEvents=null,a.removeEventListener("localcandidate",this.transceivers[u].bufferCandidates),a.onlocalcandidate=function(p){if(!(f.usingBundle&&u>0)){var h=new Event("icecandidate");h.candidate={sdpMid:s,sdpMLineIndex:u};var g=p.candidate,m=!g||Object.keys(g).length===0;if(m)(a.state==="new"||a.state==="gathering")&&(a.state="completed");else{a.state==="new"&&(a.state="gathering"),g.component=1,g.ufrag=a.getLocalParameters().usernameFragment;var v=$.writeCandidate(g);h.candidate=Object.assign(h.candidate,$.parseCandidate(v)),h.candidate.candidate=v,h.candidate.toJSON=function(){return{candidate:h.candidate.candidate,sdpMid:h.candidate.sdpMid,sdpMLineIndex:h.candidate.sdpMLineIndex,usernameFragment:h.candidate.usernameFragment}}}var y=$.getMediaSections(f._localDescription.sdp);m?y[h.candidate.sdpMLineIndex]+=`a=end-of-candidates\r
`:y[h.candidate.sdpMLineIndex]+="a="+h.candidate.candidate+`\r
`,f._localDescription.sdp=$.getDescription(f._localDescription.sdp)+y.join("");var b=f.transceivers.every(function(P){return P.iceGatherer&&P.iceGatherer.state==="completed"});f.iceGatheringState!=="gathering"&&(f.iceGatheringState="gathering",f._emitGatheringStateChange()),m||f._dispatchEvent("icecandidate",h),b&&(f._dispatchEvent("icecandidate",new Event("icecandidate")),f.iceGatheringState="complete",f._emitGatheringStateChange())}},e.setTimeout(function(){d.forEach(function(p){a.onlocalcandidate(p)})},0)}},o.prototype._createIceAndDtlsTransports=function(){var s=this,u=new e.RTCIceTransport(null);u.onicestatechange=function(){s._updateIceConnectionState(),s._updateConnectionState()};var f=new e.RTCDtlsTransport(u);return f.ondtlsstatechange=function(){s._updateConnectionState()},f.onerror=function(){Object.defineProperty(f,"state",{value:"failed",writable:!0}),s._updateConnectionState()},{iceTransport:u,dtlsTransport:f}},o.prototype._disposeIceAndDtlsTransports=function(s){var u=this.transceivers[s].iceGatherer;u&&(delete u.onlocalcandidate,delete this.transceivers[s].iceGatherer);var f=this.transceivers[s].iceTransport;f&&(delete f.onicestatechange,delete this.transceivers[s].iceTransport);var a=this.transceivers[s].dtlsTransport;a&&(delete a.ondtlsstatechange,delete a.onerror,delete this.transceivers[s].dtlsTransport)},o.prototype._transceive=function(s,u,f){var a=yr(s.localCapabilities,s.remoteCapabilities);u&&s.rtpSender&&(a.encodings=s.sendEncodingParameters,a.rtcp={cname:$.localCName,compound:s.rtcpParameters.compound},s.recvEncodingParameters.length&&(a.rtcp.ssrc=s.recvEncodingParameters[0].ssrc),s.rtpSender.send(a)),f&&s.rtpReceiver&&a.codecs.length>0&&(s.kind==="video"&&s.recvEncodingParameters&&t<15019&&s.recvEncodingParameters.forEach(function(d){delete d.rtx}),s.recvEncodingParameters.length?a.encodings=s.recvEncodingParameters:a.encodings=[{}],a.rtcp={compound:s.rtcpParameters.compound},s.rtcpParameters.cname&&(a.rtcp.cname=s.rtcpParameters.cname),s.sendEncodingParameters.length&&(a.rtcp.ssrc=s.sendEncodingParameters[0].ssrc),s.rtpReceiver.receive(a))},o.prototype.setLocalDescription=function(s){var u=this;if(["offer","answer"].indexOf(s.type)===-1)return Promise.reject(Be("TypeError",'Unsupported type "'+s.type+'"'));if(!Ls("setLocalDescription",s.type,u.signalingState)||u._isClosed)return Promise.reject(Be("InvalidStateError","Can not set local "+s.type+" in state "+u.signalingState));var f,a;if(s.type==="offer")f=$.splitSections(s.sdp),a=f.shift(),f.forEach(function(p,h){var g=$.parseRtpParameters(p);u.transceivers[h].localCapabilities=g}),u.transceivers.forEach(function(p,h){u._gather(p.mid,h)});else if(s.type==="answer"){f=$.splitSections(u._remoteDescription.sdp),a=f.shift();var d=$.matchPrefix(a,"a=ice-lite").length>0;f.forEach(function(p,h){var g=u.transceivers[h],m=g.iceGatherer,v=g.iceTransport,y=g.dtlsTransport,b=g.localCapabilities,P=g.remoteCapabilities,T=$.isRejected(p)&&$.matchPrefix(p,"a=bundle-only").length===0;if(!T&&!g.rejected){var w=$.getIceParameters(p,a),R=$.getDtlsParameters(p,a);d&&(R.role="server"),(!u.usingBundle||h===0)&&(u._gather(g.mid,h),v.state==="new"&&v.start(m,w,d?"controlling":"controlled"),y.state==="new"&&y.start(R));var I=yr(b,P);u._transceive(g,I.codecs.length>0,!1)}})}return u._localDescription={type:s.type,sdp:s.sdp},s.type==="offer"?u._updateSignalingState("have-local-offer"):u._updateSignalingState("stable"),Promise.resolve()},o.prototype.setRemoteDescription=function(s){var u=this;if(["offer","answer"].indexOf(s.type)===-1)return Promise.reject(Be("TypeError",'Unsupported type "'+s.type+'"'));if(!Ls("setRemoteDescription",s.type,u.signalingState)||u._isClosed)return Promise.reject(Be("InvalidStateError","Can not set remote "+s.type+" in state "+u.signalingState));var f={};u.remoteStreams.forEach(function(v){f[v.id]=v});var a=[],d=$.splitSections(s.sdp),p=d.shift(),h=$.matchPrefix(p,"a=ice-lite").length>0,g=$.matchPrefix(p,"a=group:BUNDLE ").length>0;u.usingBundle=g;var m=$.matchPrefix(p,"a=ice-options:")[0];return m?u.canTrickleIceCandidates=m.substr(14).split(" ").indexOf("trickle")>=0:u.canTrickleIceCandidates=!1,d.forEach(function(v,y){var b=$.splitLines(v),P=$.getKind(v),T=$.isRejected(v)&&$.matchPrefix(v,"a=bundle-only").length===0,w=b[0].substr(2).split(" ")[2],R=$.getDirection(v,p),I=$.parseMsid(v),j=$.getMid(v)||$.generateIdentifier();if(T||P==="application"&&(w==="DTLS/SCTP"||w==="UDP/DTLS/SCTP")){u.transceivers[y]={mid:j,kind:P,protocol:w,rejected:!0};return}!T&&u.transceivers[y]&&u.transceivers[y].rejected&&(u.transceivers[y]=u._createTransceiver(P,!0));var C,H,Z,ne,ue,_e,$e,Ee,x,le=$.parseRtpParameters(v),Ve,me;T||(Ve=$.getIceParameters(v,p),me=$.getDtlsParameters(v,p),me.role="client"),$e=$.parseRtpEncodingParameters(v);var rt=$.parseRtcpParameters(v),Ct=$.matchPrefix(v,"a=end-of-candidates",p).length>0,ce=$.matchPrefix(v,"a=candidate:").map(function(we){return $.parseCandidate(we)}).filter(function(we){return we.component===1});if((s.type==="offer"||s.type==="answer")&&!T&&g&&y>0&&u.transceivers[y]&&(u._disposeIceAndDtlsTransports(y),u.transceivers[y].iceGatherer=u.transceivers[0].iceGatherer,u.transceivers[y].iceTransport=u.transceivers[0].iceTransport,u.transceivers[y].dtlsTransport=u.transceivers[0].dtlsTransport,u.transceivers[y].rtpSender&&u.transceivers[y].rtpSender.setTransport(u.transceivers[0].dtlsTransport),u.transceivers[y].rtpReceiver&&u.transceivers[y].rtpReceiver.setTransport(u.transceivers[0].dtlsTransport)),s.type==="offer"&&!T){C=u.transceivers[y]||u._createTransceiver(P),C.mid=j,C.iceGatherer||(C.iceGatherer=u._createIceGatherer(y,g)),ce.length&&C.iceTransport.state==="new"&&(Ct&&(!g||y===0)?C.iceTransport.setRemoteCandidates(ce):ce.forEach(function(we){pi(C.iceTransport,we)})),Ee=e.RTCRtpReceiver.getCapabilities(P),t<15019&&(Ee.codecs=Ee.codecs.filter(function(we){return we.name!=="rtx"})),_e=C.sendEncodingParameters||[{ssrc:(2*y+2)*1001}];var Oe=!1;if(R==="sendrecv"||R==="sendonly"){if(Oe=!C.rtpReceiver,ue=C.rtpReceiver||new e.RTCRtpReceiver(C.dtlsTransport,P),Oe){var Ke;x=ue.track,I&&I.stream==="-"||(I?(f[I.stream]||(f[I.stream]=new e.MediaStream,Object.defineProperty(f[I.stream],"id",{get:function(){return I.stream}})),Object.defineProperty(x,"id",{get:function(){return I.track}}),Ke=f[I.stream]):(f.default||(f.default=new e.MediaStream),Ke=f.default)),Ke&&(n(x,Ke),C.associatedRemoteMediaStreams.push(Ke)),a.push([x,ue,Ke])}}else C.rtpReceiver&&C.rtpReceiver.track&&(C.associatedRemoteMediaStreams.forEach(function(we){var ar=we.getTracks().find(function(ii){return ii.id===C.rtpReceiver.track.id});ar&&r(ar,we)}),C.associatedRemoteMediaStreams=[]);C.localCapabilities=Ee,C.remoteCapabilities=le,C.rtpReceiver=ue,C.rtcpParameters=rt,C.sendEncodingParameters=_e,C.recvEncodingParameters=$e,u._transceive(u.transceivers[y],!1,Oe)}else if(s.type==="answer"&&!T){C=u.transceivers[y],H=C.iceGatherer,Z=C.iceTransport,ne=C.dtlsTransport,ue=C.rtpReceiver,_e=C.sendEncodingParameters,Ee=C.localCapabilities,u.transceivers[y].recvEncodingParameters=$e,u.transceivers[y].remoteCapabilities=le,u.transceivers[y].rtcpParameters=rt,ce.length&&Z.state==="new"&&((h||Ct)&&(!g||y===0)?Z.setRemoteCandidates(ce):ce.forEach(function(we){pi(C.iceTransport,we)})),(!g||y===0)&&(Z.state==="new"&&Z.start(H,Ve,"controlling"),ne.state==="new"&&ne.start(me));var vn=yr(C.localCapabilities,C.remoteCapabilities),zt=vn.codecs.filter(function(we){return we.name.toLowerCase()==="rtx"}).length;!zt&&C.sendEncodingParameters[0].rtx&&delete C.sendEncodingParameters[0].rtx,u._transceive(C,R==="sendrecv"||R==="recvonly",R==="sendrecv"||R==="sendonly"),ue&&(R==="sendrecv"||R==="sendonly")?(x=ue.track,I?(f[I.stream]||(f[I.stream]=new e.MediaStream),n(x,f[I.stream]),a.push([x,ue,f[I.stream]])):(f.default||(f.default=new e.MediaStream),n(x,f.default),a.push([x,ue,f.default]))):delete C.rtpReceiver}}),u._dtlsRole===void 0&&(u._dtlsRole=s.type==="offer"?"active":"passive"),u._remoteDescription={type:s.type,sdp:s.sdp},s.type==="offer"?u._updateSignalingState("have-remote-offer"):u._updateSignalingState("stable"),Object.keys(f).forEach(function(v){var y=f[v];if(y.getTracks().length){if(u.remoteStreams.indexOf(y)===-1){u.remoteStreams.push(y);var b=new Event("addstream");b.stream=y,e.setTimeout(function(){u._dispatchEvent("addstream",b)})}a.forEach(function(P){var T=P[0],w=P[1];y.id===P[2].id&&i(u,T,w,[y])})}}),a.forEach(function(v){v[2]||i(u,v[0],v[1],[])}),e.setTimeout(function(){!(u&&u.transceivers)||u.transceivers.forEach(function(v){v.iceTransport&&v.iceTransport.state==="new"&&v.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),v.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},o.prototype.close=function(){this.transceivers.forEach(function(s){s.iceTransport&&s.iceTransport.stop(),s.dtlsTransport&&s.dtlsTransport.stop(),s.rtpSender&&s.rtpSender.stop(),s.rtpReceiver&&s.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},o.prototype._updateSignalingState=function(s){this.signalingState=s;var u=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",u)},o.prototype._maybeFireNegotiationNeeded=function(){var s=this;this.signalingState!=="stable"||this.needNegotiation===!0||(this.needNegotiation=!0,e.setTimeout(function(){if(s.needNegotiation){s.needNegotiation=!1;var u=new Event("negotiationneeded");s._dispatchEvent("negotiationneeded",u)}},0))},o.prototype._updateIceConnectionState=function(){var s,u={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(a){a.iceTransport&&!a.rejected&&u[a.iceTransport.state]++}),s="new",u.failed>0?s="failed":u.checking>0?s="checking":u.disconnected>0?s="disconnected":u.new>0?s="new":u.connected>0?s="connected":u.completed>0&&(s="completed"),s!==this.iceConnectionState){this.iceConnectionState=s;var f=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",f)}},o.prototype._updateConnectionState=function(){var s,u={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(a){a.iceTransport&&a.dtlsTransport&&!a.rejected&&(u[a.iceTransport.state]++,u[a.dtlsTransport.state]++)}),u.connected+=u.completed,s="new",u.failed>0?s="failed":u.connecting>0?s="connecting":u.disconnected>0?s="disconnected":u.new>0?s="new":u.connected>0&&(s="connected"),s!==this.connectionState){this.connectionState=s;var f=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",f)}},o.prototype.createOffer=function(){var s=this;if(s._isClosed)return Promise.reject(Be("InvalidStateError","Can not call createOffer after close"));var u=s.transceivers.filter(function(h){return h.kind==="audio"}).length,f=s.transceivers.filter(function(h){return h.kind==="video"}).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");a.offerToReceiveAudio!==void 0&&(a.offerToReceiveAudio===!0?u=1:a.offerToReceiveAudio===!1?u=0:u=a.offerToReceiveAudio),a.offerToReceiveVideo!==void 0&&(a.offerToReceiveVideo===!0?f=1:a.offerToReceiveVideo===!1?f=0:f=a.offerToReceiveVideo)}for(s.transceivers.forEach(function(h){h.kind==="audio"?(u--,u<0&&(h.wantReceive=!1)):h.kind==="video"&&(f--,f<0&&(h.wantReceive=!1))});u>0||f>0;)u>0&&(s._createTransceiver("audio"),u--),f>0&&(s._createTransceiver("video"),f--);var d=$.writeSessionBoilerplate(s._sdpSessionId,s._sdpSessionVersion++);s.transceivers.forEach(function(h,g){var m=h.track,v=h.kind,y=h.mid||$.generateIdentifier();h.mid=y,h.iceGatherer||(h.iceGatherer=s._createIceGatherer(g,s.usingBundle));var b=e.RTCRtpSender.getCapabilities(v);t<15019&&(b.codecs=b.codecs.filter(function(T){return T.name!=="rtx"})),b.codecs.forEach(function(T){T.name==="H264"&&T.parameters["level-asymmetry-allowed"]===void 0&&(T.parameters["level-asymmetry-allowed"]="1"),h.remoteCapabilities&&h.remoteCapabilities.codecs&&h.remoteCapabilities.codecs.forEach(function(w){T.name.toLowerCase()===w.name.toLowerCase()&&T.clockRate===w.clockRate&&(T.preferredPayloadType=w.payloadType)})}),b.headerExtensions.forEach(function(T){var w=h.remoteCapabilities&&h.remoteCapabilities.headerExtensions||[];w.forEach(function(R){T.uri===R.uri&&(T.id=R.id)})});var P=h.sendEncodingParameters||[{ssrc:(2*g+1)*1001}];m&&t>=15019&&v==="video"&&!P[0].rtx&&(P[0].rtx={ssrc:P[0].ssrc+1}),h.wantReceive&&(h.rtpReceiver=new e.RTCRtpReceiver(h.dtlsTransport,v)),h.localCapabilities=b,h.sendEncodingParameters=P}),s._config.bundlePolicy!=="max-compat"&&(d+="a=group:BUNDLE "+s.transceivers.map(function(h){return h.mid}).join(" ")+`\r
`),d+=`a=ice-options:trickle\r
`,s.transceivers.forEach(function(h,g){d+=Ms(h,h.localCapabilities,"offer",h.stream,s._dtlsRole),d+=`a=rtcp-rsize\r
`,h.iceGatherer&&s.iceGatheringState!=="new"&&(g===0||!s.usingBundle)&&(h.iceGatherer.getLocalCandidates().forEach(function(m){m.component=1,d+="a="+$.writeCandidate(m)+`\r
`}),h.iceGatherer.state==="completed"&&(d+=`a=end-of-candidates\r
`))});var p=new e.RTCSessionDescription({type:"offer",sdp:d});return Promise.resolve(p)},o.prototype.createAnswer=function(){var s=this;if(s._isClosed)return Promise.reject(Be("InvalidStateError","Can not call createAnswer after close"));if(!(s.signalingState==="have-remote-offer"||s.signalingState==="have-local-pranswer"))return Promise.reject(Be("InvalidStateError","Can not call createAnswer in signalingState "+s.signalingState));var u=$.writeSessionBoilerplate(s._sdpSessionId,s._sdpSessionVersion++);s.usingBundle&&(u+="a=group:BUNDLE "+s.transceivers.map(function(d){return d.mid}).join(" ")+`\r
`),u+=`a=ice-options:trickle\r
`;var f=$.getMediaSections(s._remoteDescription.sdp).length;s.transceivers.forEach(function(d,p){if(!(p+1>f)){if(d.rejected){d.kind==="application"?d.protocol==="DTLS/SCTP"?u+=`m=application 0 DTLS/SCTP 5000\r
`:u+="m=application 0 "+d.protocol+` webrtc-datachannel\r
`:d.kind==="audio"?u+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:d.kind==="video"&&(u+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),u+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+d.mid+`\r
`;return}if(d.stream){var h;d.kind==="audio"?h=d.stream.getAudioTracks()[0]:d.kind==="video"&&(h=d.stream.getVideoTracks()[0]),h&&t>=15019&&d.kind==="video"&&!d.sendEncodingParameters[0].rtx&&(d.sendEncodingParameters[0].rtx={ssrc:d.sendEncodingParameters[0].ssrc+1})}var g=yr(d.localCapabilities,d.remoteCapabilities),m=g.codecs.filter(function(v){return v.name.toLowerCase()==="rtx"}).length;!m&&d.sendEncodingParameters[0].rtx&&delete d.sendEncodingParameters[0].rtx,u+=Ms(d,g,"answer",d.stream,s._dtlsRole),d.rtcpParameters&&d.rtcpParameters.reducedSize&&(u+=`a=rtcp-rsize\r
`)}});var a=new e.RTCSessionDescription({type:"answer",sdp:u});return Promise.resolve(a)},o.prototype.addIceCandidate=function(s){var u=this,f;return s&&!(s.sdpMLineIndex!==void 0||s.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(a,d){if(u._remoteDescription)if(!s||s.candidate==="")for(var p=0;p<u.transceivers.length&&!(!u.transceivers[p].rejected&&(u.transceivers[p].iceTransport.addRemoteCandidate({}),f=$.getMediaSections(u._remoteDescription.sdp),f[p]+=`a=end-of-candidates\r
`,u._remoteDescription.sdp=$.getDescription(u._remoteDescription.sdp)+f.join(""),u.usingBundle));p++);else{var h=s.sdpMLineIndex;if(s.sdpMid){for(var g=0;g<u.transceivers.length;g++)if(u.transceivers[g].mid===s.sdpMid){h=g;break}}var m=u.transceivers[h];if(m){if(m.rejected)return a();var v=Object.keys(s.candidate).length>0?$.parseCandidate(s.candidate):{};if(v.protocol==="tcp"&&(v.port===0||v.port===9)||v.component&&v.component!==1)return a();if((h===0||h>0&&m.iceTransport!==u.transceivers[0].iceTransport)&&!pi(m.iceTransport,v))return d(Be("OperationError","Can not add ICE candidate"));var y=s.candidate.trim();y.indexOf("a=")===0&&(y=y.substr(2)),f=$.getMediaSections(u._remoteDescription.sdp),f[h]+="a="+(v.type?y:"end-of-candidates")+`\r
`,u._remoteDescription.sdp=$.getDescription(u._remoteDescription.sdp)+f.join("")}else return d(Be("OperationError","Can not add ICE candidate"))}else return d(Be("InvalidStateError","Can not add ICE candidate without a remote description"));a()})},o.prototype.getStats=function(s){if(s&&s instanceof e.MediaStreamTrack){var u=null;if(this.transceivers.forEach(function(a){a.rtpSender&&a.rtpSender.track===s?u=a.rtpSender:a.rtpReceiver&&a.rtpReceiver.track===s&&(u=a.rtpReceiver)}),!u)throw Be("InvalidAccessError","Invalid selector.");return u.getStats()}var f=[];return this.transceivers.forEach(function(a){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(d){a[d]&&f.push(a[d].getStats())})}),Promise.all(f).then(function(a){var d=new Map;return a.forEach(function(p){p.forEach(function(h){d.set(h.id,h)})}),d})};var l=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];l.forEach(function(s){var u=e[s];if(u&&u.prototype&&u.prototype.getStats){var f=u.prototype.getStats;u.prototype.getStats=function(){return f.apply(this).then(function(a){var d=new Map;return Object.keys(a).forEach(function(p){a[p].type=uh(a[p]),d.set(p,a[p])}),d})}}});var c=["createOffer","createAnswer"];return c.forEach(function(s){var u=o.prototype[s];o.prototype[s]=function(){var f=arguments;return typeof f[0]=="function"||typeof f[1]=="function"?u.apply(this,[arguments[2]]).then(function(a){typeof f[0]=="function"&&f[0].apply(null,[a])},function(a){typeof f[1]=="function"&&f[1].apply(null,[a])}):u.apply(this,arguments)}}),c=["setLocalDescription","setRemoteDescription","addIceCandidate"],c.forEach(function(s){var u=o.prototype[s];o.prototype[s]=function(){var f=arguments;return typeof f[1]=="function"||typeof f[2]=="function"?u.apply(this,arguments).then(function(){typeof f[1]=="function"&&f[1].apply(null)},function(a){typeof f[2]=="function"&&f[2].apply(null,[a])}):u.apply(this,arguments)}}),["getStats"].forEach(function(s){var u=o.prototype[s];o.prototype[s]=function(){var f=arguments;return typeof f[1]=="function"?u.apply(this,arguments).then(function(){typeof f[1]=="function"&&f[1].apply(null)}):u.apply(this,arguments)}}),o};function pl(e){const t=e&&e.navigator,n=function(i){return{name:{PermissionDeniedError:"NotAllowedError"}[i.name]||i.name,message:i.message,constraint:i.constraint,toString(){return this.name}}},r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(i){return r(i).catch(o=>Promise.reject(n(o)))}}function hl(e){"getDisplayMedia"in e.navigator&&(!e.navigator.mediaDevices||e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}function Vi(e,t){if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(i){return i}),e.RTCSessionDescription||(e.RTCSessionDescription=function(i){return i}),t.version<15025)){const r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set(i){r.set.call(this,i);const o=new Event("enabled");o.enabled=i,this.dispatchEvent(o)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new e.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);const n=dh(e,t.version);e.RTCPeerConnection=function(i){return i&&i.iceServers&&(i.iceServers=ch(i.iceServers,t.version),mo("ICE servers after filtering:",i.iceServers)),new n(i)},e.RTCPeerConnection.prototype=n.prototype}function ml(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}const Ns=Object.freeze(Object.defineProperty({__proto__:null,shimPeerConnection:Vi,shimReplaceTrack:ml,shimGetUserMedia:pl,shimGetDisplayMedia:hl},Symbol.toStringTag,{value:"Module"}));function gl(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(i,o,l){ei("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(o,l)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(l,c,s){c in l&&!(s in l)&&(l[s]=l[c],delete l[c])},o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(l){return typeof l=="object"&&typeof l.audio=="object"&&(l=JSON.parse(JSON.stringify(l)),i(l.audio,"autoGainControl","mozAutoGainControl"),i(l.audio,"noiseSuppression","mozNoiseSuppression")),o(l)},r&&r.prototype.getSettings){const l=r.prototype.getSettings;r.prototype.getSettings=function(){const c=l.apply(this,arguments);return i(c,"mozAutoGainControl","autoGainControl"),i(c,"mozNoiseSuppression","noiseSuppression"),c}}if(r&&r.prototype.applyConstraints){const l=r.prototype.applyConstraints;r.prototype.applyConstraints=function(c){return this.kind==="audio"&&typeof c=="object"&&(c=JSON.parse(JSON.stringify(c)),i(c,"autoGainControl","mozAutoGainControl"),i(c,"noiseSuppression","mozNoiseSuppression")),l.apply(this,[c])}}}}function ph(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||!e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}function vl(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Wi(e,t){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const o=e.RTCPeerConnection.prototype[i],l={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=l[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[o,l,c]=arguments;return r.apply(this,[o||null]).then(s=>{if(t.version<53&&!l)try{s.forEach(u=>{u.type=n[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;s.forEach((f,a)=>{s.set(a,Object.assign({},f,{type:n[f.type]||f.type}))})}return s}).then(l,c)}}function yl(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(o=>o._pc=this),i});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function _l(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r}),gn(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function bl(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){ei("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function Cl(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Sl(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const r=arguments[1],i=r&&"sendEncodings"in r;i&&r.sendEncodings.forEach(l=>{if("rid"in l&&!/^[a-z0-9]{0,16}$/i.test(l.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in l&&!(parseFloat(l.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in l&&!(parseFloat(l.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=t.apply(this,arguments);if(i){const{sender:l}=o,c=l.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=r.sendEncodings,l.sendEncodings=r.sendEncodings,this.setParametersPromises.push(l.setParameters(c).then(()=>{delete l.sendEncodings}).catch(()=>{delete l.sendEncodings})))}return o})}function Tl(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function El(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function kl(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}const Bs=Object.freeze(Object.defineProperty({__proto__:null,shimOnTrack:vl,shimPeerConnection:Wi,shimSenderGetStats:yl,shimReceiverGetStats:_l,shimRemoveStream:bl,shimRTCDataChannel:Cl,shimAddTransceiver:Sl,shimGetParameters:Tl,shimCreateOffer:El,shimCreateAnswer:kl,shimGetUserMedia:gl,shimGetDisplayMedia:ph},Symbol.toStringTag,{value:"Module"}));function Rl(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>t.call(this,i,r)),r.getVideoTracks().forEach(i=>t.call(this,i,r))},e.RTCPeerConnection.prototype.addTrack=function(r,...i){return i&&i.forEach(o=>{this._localStreams?this._localStreams.includes(o)||this._localStreams.push(o):this._localStreams=[o]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const i=n.getTracks();this.getSenders().forEach(o=>{i.includes(o.track)&&this.removeTrack(o)})})}}function Pl(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,this.dispatchEvent(o)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(o=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(o)>=0)return;r._remoteStreams.push(o);const l=new Event("addstream");l.stream=o,r.dispatchEvent(l)})}),t.apply(r,arguments)}}}function Ol(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,l=t.addIceCandidate;t.createOffer=function(u,f){const a=arguments.length>=2?arguments[2]:arguments[0],d=n.apply(this,[a]);return f?(d.then(u,f),Promise.resolve()):d},t.createAnswer=function(u,f){const a=arguments.length>=2?arguments[2]:arguments[0],d=r.apply(this,[a]);return f?(d.then(u,f),Promise.resolve()):d};let c=function(s,u,f){const a=i.apply(this,[s]);return f?(a.then(u,f),Promise.resolve()):a};t.setLocalDescription=c,c=function(s,u,f){const a=o.apply(this,[s]);return f?(a.then(u,f),Promise.resolve()):a},t.setRemoteDescription=c,c=function(s,u,f){const a=l.apply(this,[s]);return f?(a.then(u,f),Promise.resolve()):a},t.addIceCandidate=c}function wl(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=i=>r(Dl(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(r,i,o){t.mediaDevices.getUserMedia(r).then(i,o)}.bind(t))}function Dl(e){return e&&e.video!==void 0?Object.assign({},e,{video:rl(e.video)}):e}function Al(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,i){if(r&&r.iceServers){const o=[];for(let l=0;l<r.iceServers.length;l++){let c=r.iceServers[l];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(ei("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,o.push(c)):o.push(r.iceServers[l])}r.iceServers=o}return new t(r,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function Il(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ml(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const i=this.getTransceivers().find(l=>l.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio"),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const o=this.getTransceivers().find(l=>l.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):r.offerToReceiveVideo===!0&&!o&&this.addTransceiver("video")}return t.apply(this,arguments)}}function Ll(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}const js=Object.freeze(Object.defineProperty({__proto__:null,shimLocalStreamsAPI:Rl,shimRemoteStreamsAPI:Pl,shimCallbacksAPI:Ol,shimGetUserMedia:wl,shimConstraints:Dl,shimRTCIceServerUrls:Al,shimTrackEventTransceiver:Il,shimCreateOfferLegacy:Ml,shimAudioContext:Ll},Symbol.toStringTag,{value:"Module"}));function wr(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){const i=new t(r),o=Or.parseCandidate(r.candidate),l=Object.assign(i,o);return l.toJSON=function(){return{candidate:l.candidate,sdpMid:l.sdpMid,sdpMLineIndex:l.sdpMLineIndex,usernameFragment:l.usernameFragment}},l}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,gn(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function An(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(c){if(!c||!c.sdp)return!1;const s=Or.splitSections(c.sdp);return s.shift(),s.some(u=>{const f=Or.parseMLine(u);return f&&f.kind==="application"&&f.protocol.indexOf("SCTP")!==-1})},r=function(c){const s=c.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(s===null||s.length<2)return-1;const u=parseInt(s[1],10);return u!==u?-1:u},i=function(c){let s=65536;return t.browser==="firefox"&&(t.version<57?c===-1?s=16384:s=2147483637:t.version<60?s=t.version===57?65535:65536:s=2147483637),s},o=function(c,s){let u=65536;t.browser==="firefox"&&t.version===57&&(u=65535);const f=Or.matchPrefix(c.sdp,"a=max-message-size:");return f.length>0?u=parseInt(f[0].substr(19),10):t.browser==="firefox"&&s!==-1&&(u=2147483637),u},l=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:s}=this.getConfiguration();s==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const s=r(arguments[0]),u=i(s),f=o(arguments[0],s);let a;u===0&&f===0?a=Number.POSITIVE_INFINITY:u===0||f===0?a=Math.max(u,f):a=Math.min(u,f);const d={};Object.defineProperty(d,"maxMessageSize",{get(){return a}}),this._sctp=d}return l.apply(this,arguments)}}function In(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,i){const o=r.send;r.send=function(){const c=arguments[0],s=c.length||c.size||c.byteLength;if(r.readyState==="open"&&i.sctp&&s>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return o.apply(r,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return t(i,this),i},gn(e,"datachannel",r=>(t(r.channel,r.target),r))}function qi(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const o=i.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const l=new Event("connectionstatechange",i);o.dispatchEvent(l)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Ji(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=i.sdp.split(`
`).filter(l=>l.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:o}):i.sdp=o}return n.apply(this,arguments)}}function Dr(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const n=e.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}const hh=Object.freeze(Object.defineProperty({__proto__:null,shimRTCIceCandidate:wr,shimMaxMessageSize:An,shimSendThrowTypeError:In,shimConnectionState:qi,removeExtmapAllowMixed:Ji,shimAddIceCandidateNullOrEmpty:Dr},Symbol.toStringTag,{value:"Module"}));function mh({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const n=mo,r=ah(e),i={browserDetails:r,commonShim:hh,extractVersion:Dn,disableLog:oh,disableWarnings:sh};switch(r.browser){case"chrome":if(!Is||!$i||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=Is,Dr(e,r),il(e,r),ol(e),$i(e,r),sl(e),fl(e,r),al(e),ll(e),cl(e),dl(e,r),wr(e),qi(e),An(e,r),In(e),Ji(e,r);break;case"firefox":if(!Bs||!Wi||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=Bs,Dr(e,r),gl(e,r),Wi(e,r),vl(e),bl(e),yl(e),_l(e),Cl(e),Sl(e),Tl(e),El(e),kl(e),wr(e),qi(e),An(e,r),In(e);break;case"edge":if(!Ns||!Vi||!t.shimEdge)return n("MS edge shim is not included in this adapter release."),i;n("adapter.js shimming edge."),i.browserShim=Ns,pl(e),hl(e),Vi(e,r),ml(e),An(e,r),In(e);break;case"safari":if(!js||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=js,Dr(e,r),Al(e),Ml(e),Ol(e),Rl(e),Pl(e),Il(e),wl(e),Ll(e),wr(e),An(e,r),In(e),Ji(e,r);break;default:n("Unsupported browser!");break}return i}const Fs=mh({window:typeof window>"u"?void 0:window});function mt(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}var hi=Fs.default||Fs,bn=new(function(){function e(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return e.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection<"u"},e.prototype.isBrowserSupported=function(){var t=this.getBrowser(),n=this.getVersion(),r=this.supportedBrowsers.includes(t);return r?t==="chrome"?n>=this.minChromeVersion:t==="firefox"?n>=this.minFirefoxVersion:t==="safari"?!this.isIOS&&n>=this.minSafariVersion:!1:!1},e.prototype.getBrowser=function(){return hi.browserDetails.browser},e.prototype.getVersion=function(){return hi.browserDetails.version||0},e.prototype.isUnifiedPlanSupported=function(){var t=this.getBrowser(),n=hi.browserDetails.version||0;if(t==="chrome"&&n<this.minChromeVersion)return!1;if(t==="firefox"&&n>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var r,i=!1;try{r=new RTCPeerConnection,r.addTransceiver("audio"),i=!0}catch{}finally{r&&r.close()}return i},e.prototype.toString=function(){return`Supports:
    browser:`.concat(this.getBrowser(),`
    version:`).concat(this.getVersion(),`
    isIOS:`).concat(this.isIOS,`
    isWebRTCSupported:`).concat(this.isWebRTCSupported(),`
    isBrowserSupported:`).concat(this.isBrowserSupported(),`
    isUnifiedPlanSupported:`).concat(this.isUnifiedPlanSupported())},e}()),Gs={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},gh=function(){function e(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=Gs,this.browser=bn.getBrowser(),this.browserVersion=bn.getVersion(),this.supports=function(){var t={browser:bn.isBrowserSupported(),webRTC:bn.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;var n;try{n=new RTCPeerConnection(Gs),t.audioVideo=!0;var r=void 0;try{r=n.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!r.ordered;try{r.binaryType="blob",t.binaryBlob=!bn.isIOS}catch{}}catch{}finally{r&&r.close()}}catch{}finally{n&&n.close()}return t}(),this.pack=Os.pack,this.unpack=Os.unpack,this._dataCount=1}return e.prototype.noop=function(){},e.prototype.validateId=function(t){return!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(t)},e.prototype.chunk=function(t){for(var n=[],r=t.size,i=Math.ceil(r/ae.chunkedMTU),o=0,l=0;l<r;){var c=Math.min(r,l+ae.chunkedMTU),s=t.slice(l,c),u={__peerData:this._dataCount,n:o,data:s,total:i};n.push(u),l=c,o++}return this._dataCount++,n},e.prototype.blobToArrayBuffer=function(t,n){var r=new FileReader;return r.onload=function(i){i.target&&n(i.target.result)},r.readAsArrayBuffer(t),r},e.prototype.binaryStringToArrayBuffer=function(t){for(var n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r)&255;return n.buffer},e.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},e.prototype.isSecure=function(){return location.protocol==="https:"},e}(),ae=new gh,Nl={};mt(Nl,"Peer",()=>Xs,e=>Xs=e);var sr={},vh=Object.prototype.hasOwnProperty,xe="~";function Xn(){}Object.create&&(Xn.prototype=Object.create(null),new Xn().__proto__||(xe=!1));function yh(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function Bl(e,t,n,r,i){if(typeof n!="function")throw new TypeError("The listener must be a function");var o=new yh(n,r||e,i),l=xe?xe+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function Ar(e,t){--e._eventsCount===0?e._events=new Xn:delete e._events[t]}function Fe(){this._events=new Xn,this._eventsCount=0}Fe.prototype.eventNames=function(){var t=[],n,r;if(this._eventsCount===0)return t;for(r in n=this._events)vh.call(n,r)&&t.push(xe?r.slice(1):r);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(n)):t};Fe.prototype.listeners=function(t){var n=xe?xe+t:t,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,l=new Array(o);i<o;i++)l[i]=r[i].fn;return l};Fe.prototype.listenerCount=function(t){var n=xe?xe+t:t,r=this._events[n];return r?r.fn?1:r.length:0};Fe.prototype.emit=function(t,n,r,i,o,l){var c=xe?xe+t:t;if(!this._events[c])return!1;var s=this._events[c],u=arguments.length,f,a;if(s.fn){switch(s.once&&this.removeListener(t,s.fn,void 0,!0),u){case 1:return s.fn.call(s.context),!0;case 2:return s.fn.call(s.context,n),!0;case 3:return s.fn.call(s.context,n,r),!0;case 4:return s.fn.call(s.context,n,r,i),!0;case 5:return s.fn.call(s.context,n,r,i,o),!0;case 6:return s.fn.call(s.context,n,r,i,o,l),!0}for(a=1,f=new Array(u-1);a<u;a++)f[a-1]=arguments[a];s.fn.apply(s.context,f)}else{var d=s.length,p;for(a=0;a<d;a++)switch(s[a].once&&this.removeListener(t,s[a].fn,void 0,!0),u){case 1:s[a].fn.call(s[a].context);break;case 2:s[a].fn.call(s[a].context,n);break;case 3:s[a].fn.call(s[a].context,n,r);break;case 4:s[a].fn.call(s[a].context,n,r,i);break;default:if(!f)for(p=1,f=new Array(u-1);p<u;p++)f[p-1]=arguments[p];s[a].fn.apply(s[a].context,f)}}return!0};Fe.prototype.on=function(t,n,r){return Bl(this,t,n,r,!1)};Fe.prototype.once=function(t,n,r){return Bl(this,t,n,r,!0)};Fe.prototype.removeListener=function(t,n,r,i){var o=xe?xe+t:t;if(!this._events[o])return this;if(!n)return Ar(this,o),this;var l=this._events[o];if(l.fn)l.fn===n&&(!i||l.once)&&(!r||l.context===r)&&Ar(this,o);else{for(var c=0,s=[],u=l.length;c<u;c++)(l[c].fn!==n||i&&!l[c].once||r&&l[c].context!==r)&&s.push(l[c]);s.length?this._events[o]=s.length===1?s[0]:s:Ar(this,o)}return this};Fe.prototype.removeAllListeners=function(t){var n;return t?(n=xe?xe+t:t,this._events[n]&&Ar(this,n)):(this._events=new Xn,this._eventsCount=0),this};Fe.prototype.off=Fe.prototype.removeListener;Fe.prototype.addListener=Fe.prototype.on;Fe.prefixed=xe;Fe.EventEmitter=Fe;sr=Fe;var L={};mt(L,"LogLevel",()=>He,e=>He=e);mt(L,"default",()=>xs,e=>xs=e);var Dt=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,o=[],l;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(c){l={error:c}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(l)throw l.error}}return o},At=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,o;r<i;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},_h="PeerJS: ",He;(function(e){e[e.Disabled=0]="Disabled",e[e.Errors=1]="Errors",e[e.Warnings=2]="Warnings",e[e.All=3]="All"})(He||(He={}));var bh=function(){function e(){this._logLevel=He.Disabled}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){this._logLevel=t},enumerable:!1,configurable:!0}),e.prototype.log=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._logLevel>=He.All&&this._print.apply(this,At([He.All],Dt(t),!1))},e.prototype.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._logLevel>=He.Warnings&&this._print.apply(this,At([He.Warnings],Dt(t),!1))},e.prototype.error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._logLevel>=He.Errors&&this._print.apply(this,At([He.Errors],Dt(t),!1))},e.prototype.setLogFunction=function(t){this._print=t},e.prototype._print=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=At([_h],Dt(n),!1);for(var o in i)i[o]instanceof Error&&(i[o]="("+i[o].name+") "+i[o].message);t>=He.All?console.log.apply(console,At([],Dt(i),!1)):t>=He.Warnings?console.warn.apply(console,At(["WARNING"],Dt(i),!1)):t>=He.Errors&&console.error.apply(console,At(["ERROR"],Dt(i),!1))},e}(),xs=new bh,jl={};mt(jl,"Socket",()=>Us,e=>Us=e);var tt;(function(e){e.Data="data",e.Media="media"})(tt||(tt={}));var Ce;(function(e){e.BrowserIncompatible="browser-incompatible",e.Disconnected="disconnected",e.InvalidID="invalid-id",e.InvalidKey="invalid-key",e.Network="network",e.PeerUnavailable="peer-unavailable",e.SslUnavailable="ssl-unavailable",e.ServerError="server-error",e.SocketError="socket-error",e.SocketClosed="socket-closed",e.UnavailableID="unavailable-id",e.WebRTC="webrtc"})(Ce||(Ce={}));var gt;(function(e){e.Binary="binary",e.BinaryUTF8="binary-utf8",e.JSON="json"})(gt||(gt={}));var yt;(function(e){e.Message="message",e.Disconnected="disconnected",e.Error="error",e.Close="close"})(yt||(yt={}));var Me;(function(e){e.Heartbeat="HEARTBEAT",e.Candidate="CANDIDATE",e.Offer="OFFER",e.Answer="ANSWER",e.Open="OPEN",e.Error="ERROR",e.IdTaken="ID-TAKEN",e.InvalidKey="INVALID-KEY",e.Leave="LEAVE",e.Expire="EXPIRE"})(Me||(Me={}));var vo={};vo=JSON.parse('{"name":"peerjs","version":"1.4.7","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz St\xFCckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","So\u0308ren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var Ch=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},e(t,n)};return function(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Sh=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,o=[],l;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(c){l={error:c}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(l)throw l.error}}return o},Th=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,o;r<i;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},Eh=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Us=function(e){Ch(t,e);function t(n,r,i,o,l,c){c===void 0&&(c=5e3);var s=e.call(this)||this;s.pingInterval=c,s._disconnected=!0,s._messagesQueue=[];var u=n?"wss://":"ws://";return s._baseUrl=u+r+":"+i+o+"peerjs?key="+l,s}return t.prototype.start=function(n,r){var i=this;this._id=n;var o="".concat(this._baseUrl,"&id=").concat(n,"&token=").concat(r);!!this._socket||!this._disconnected||(this._socket=new WebSocket(o+"&version="+vo.version),this._disconnected=!1,this._socket.onmessage=function(l){var c;try{c=JSON.parse(l.data),L.default.log("Server message received:",c)}catch{L.default.log("Invalid server message",l.data);return}i.emit(yt.Message,c)},this._socket.onclose=function(l){i._disconnected||(L.default.log("Socket closed.",l),i._cleanup(),i._disconnected=!0,i.emit(yt.Disconnected))},this._socket.onopen=function(){i._disconnected||(i._sendQueuedMessages(),L.default.log("Socket open"),i._scheduleHeartbeat())})},t.prototype._scheduleHeartbeat=function(){var n=this;this._wsPingTimer=setTimeout(function(){n._sendHeartbeat()},this.pingInterval)},t.prototype._sendHeartbeat=function(){if(!this._wsOpen()){L.default.log("Cannot send heartbeat, because socket closed");return}var n=JSON.stringify({type:Me.Heartbeat});this._socket.send(n),this._scheduleHeartbeat()},t.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},t.prototype._sendQueuedMessages=function(){var n,r,i=Th([],Sh(this._messagesQueue),!1);this._messagesQueue=[];try{for(var o=Eh(i),l=o.next();!l.done;l=o.next()){var c=l.value;this.send(c)}}catch(s){n={error:s}}finally{try{l&&!l.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},t.prototype.send=function(n){if(!this._disconnected){if(!this._id){this._messagesQueue.push(n);return}if(!n.type){this.emit(yt.Error,"Invalid message");return}if(!!this._wsOpen()){var r=JSON.stringify(n);this._socket.send(r)}}},t.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},t.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},t}(sr.EventEmitter),Yi={};mt(Yi,"MediaConnection",()=>$s,e=>$s=e);var yo={};mt(yo,"Negotiator",()=>zs,e=>zs=e);var qr=function(){return qr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},qr.apply(this,arguments)},_r=function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(l){l(o)})}return new(n||(n=Promise))(function(o,l){function c(f){try{u(r.next(f))}catch(a){l(a)}}function s(f){try{u(r.throw(f))}catch(a){l(a)}}function u(f){f.done?o(f.value):i(f.value).then(c,s)}u((r=r.apply(e,t||[])).next())})},br=function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,l;return l={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function c(u){return function(f){return s([u,f])}}function s(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,i=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){n.label=u[1];break}if(u[0]===6&&n.label<o[1]){n.label=o[1],o=u;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(u);break}o[2]&&n.ops.pop(),n.trys.pop();continue}u=t.call(e,n)}catch(f){u=[6,f],i=0}finally{r=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},zs=function(){function e(t){this.connection=t}return e.prototype.startConnection=function(t){var n=this._startPeerConnection();if(this.connection.peerConnection=n,this.connection.type===tt.Media&&t._stream&&this._addTracksToConnection(t._stream,n),t.originator){if(this.connection.type===tt.Data){var r=this.connection,i={ordered:!!t.reliable},o=n.createDataChannel(r.label,i);r.initialize(o)}this._makeOffer()}else this.handleSDP("OFFER",t.sdp)},e.prototype._startPeerConnection=function(){L.default.log("Creating RTCPeerConnection.");var t=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(t),t},e.prototype._setupListeners=function(t){var n=this,r=this.connection.peer,i=this.connection.connectionId,o=this.connection.type,l=this.connection.provider;L.default.log("Listening for ICE candidates."),t.onicecandidate=function(c){!c.candidate||!c.candidate.candidate||(L.default.log("Received ICE candidates for ".concat(r,":"),c.candidate),l.socket.send({type:Me.Candidate,payload:{candidate:c.candidate,type:o,connectionId:i},dst:r}))},t.oniceconnectionstatechange=function(){switch(t.iceConnectionState){case"failed":L.default.log("iceConnectionState is failed, closing connections to "+r),n.connection.emit("error",new Error("Negotiation of connection to "+r+" failed.")),n.connection.close();break;case"closed":L.default.log("iceConnectionState is closed, closing connections to "+r),n.connection.emit("error",new Error("Connection to "+r+" closed.")),n.connection.close();break;case"disconnected":L.default.log("iceConnectionState changed to disconnected on the connection with "+r);break;case"completed":t.onicecandidate=ae.noop;break}n.connection.emit("iceStateChanged",t.iceConnectionState)},L.default.log("Listening for data channel"),t.ondatachannel=function(c){L.default.log("Received data channel");var s=c.channel,u=l.getConnection(r,i);u.initialize(s)},L.default.log("Listening for remote stream"),t.ontrack=function(c){L.default.log("Received remote stream");var s=c.streams[0],u=l.getConnection(r,i);if(u.type===tt.Media){var f=u;n._addStreamToMediaConnection(s,f)}}},e.prototype.cleanup=function(){L.default.log("Cleaning up PeerConnection to "+this.connection.peer);var t=this.connection.peerConnection;if(!!t){this.connection.peerConnection=null,t.onicecandidate=t.oniceconnectionstatechange=t.ondatachannel=t.ontrack=function(){};var n=t.signalingState!=="closed",r=!1;if(this.connection.type===tt.Data){var i=this.connection,o=i.dataChannel;o&&(r=!!o.readyState&&o.readyState!=="closed")}(n||r)&&t.close()}},e.prototype._makeOffer=function(){return _r(this,void 0,Promise,function(){var t,n,r,i,o,l,c;return br(this,function(s){switch(s.label){case 0:t=this.connection.peerConnection,n=this.connection.provider,s.label=1;case 1:return s.trys.push([1,7,,8]),[4,t.createOffer(this.connection.options.constraints)];case 2:r=s.sent(),L.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp),s.label=3;case 3:return s.trys.push([3,5,,6]),[4,t.setLocalDescription(r)];case 4:return s.sent(),L.default.log("Set localDescription:",r,"for:".concat(this.connection.peer)),i={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:ae.browser},this.connection.type===tt.Data&&(o=this.connection,i=qr(qr({},i),{label:o.label,reliable:o.reliable,serialization:o.serialization})),n.socket.send({type:Me.Offer,payload:i,dst:this.connection.peer}),[3,6];case 5:return l=s.sent(),l!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(n.emitError(Ce.WebRTC,l),L.default.log("Failed to setLocalDescription, ",l)),[3,6];case 6:return[3,8];case 7:return c=s.sent(),n.emitError(Ce.WebRTC,c),L.default.log("Failed to createOffer, ",c),[3,8];case 8:return[2]}})})},e.prototype._makeAnswer=function(){return _r(this,void 0,Promise,function(){var t,n,r,i,o;return br(this,function(l){switch(l.label){case 0:t=this.connection.peerConnection,n=this.connection.provider,l.label=1;case 1:return l.trys.push([1,7,,8]),[4,t.createAnswer()];case 2:r=l.sent(),L.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp),l.label=3;case 3:return l.trys.push([3,5,,6]),[4,t.setLocalDescription(r)];case 4:return l.sent(),L.default.log("Set localDescription:",r,"for:".concat(this.connection.peer)),n.socket.send({type:Me.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,browser:ae.browser},dst:this.connection.peer}),[3,6];case 5:return i=l.sent(),n.emitError(Ce.WebRTC,i),L.default.log("Failed to setLocalDescription, ",i),[3,6];case 6:return[3,8];case 7:return o=l.sent(),n.emitError(Ce.WebRTC,o),L.default.log("Failed to create answer, ",o),[3,8];case 8:return[2]}})})},e.prototype.handleSDP=function(t,n){return _r(this,void 0,Promise,function(){var r,i,o,l;return br(this,function(c){switch(c.label){case 0:n=new RTCSessionDescription(n),r=this.connection.peerConnection,i=this.connection.provider,L.default.log("Setting remote description",n),o=this,c.label=1;case 1:return c.trys.push([1,5,,6]),[4,r.setRemoteDescription(n)];case 2:return c.sent(),L.default.log("Set remoteDescription:".concat(t," for:").concat(this.connection.peer)),t!=="OFFER"?[3,4]:[4,o._makeAnswer()];case 3:c.sent(),c.label=4;case 4:return[3,6];case 5:return l=c.sent(),i.emitError(Ce.WebRTC,l),L.default.log("Failed to setRemoteDescription, ",l),[3,6];case 6:return[2]}})})},e.prototype.handleCandidate=function(t){return _r(this,void 0,Promise,function(){var n,r,i,o,l,c;return br(this,function(s){switch(s.label){case 0:L.default.log("handleCandidate:",t),n=t.candidate,r=t.sdpMLineIndex,i=t.sdpMid,o=this.connection.peerConnection,l=this.connection.provider,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,o.addIceCandidate(new RTCIceCandidate({sdpMid:i,sdpMLineIndex:r,candidate:n}))];case 2:return s.sent(),L.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return c=s.sent(),l.emitError(Ce.WebRTC,c),L.default.log("Failed to handleCandidate, ",c),[3,4];case 4:return[2]}})})},e.prototype._addTracksToConnection=function(t,n){if(L.default.log("add tracks from stream ".concat(t.id," to peer connection")),!n.addTrack)return L.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");t.getTracks().forEach(function(r){n.addTrack(r,t)})},e.prototype._addStreamToMediaConnection=function(t,n){L.default.log("add stream ".concat(t.id," to media connection ").concat(n.connectionId)),n.addStream(t)},e}(),_o={};mt(_o,"BaseConnection",()=>Hs,e=>Hs=e);var kh=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},e(t,n)};return function(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Hs=function(e){kh(t,e);function t(n,r,i){var o=e.call(this)||this;return o.peer=n,o.provider=r,o.options=i,o._open=!1,o.metadata=i.metadata,o}return Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),t}(sr.EventEmitter),Rh=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},e(t,n)};return function(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Jr=function(){return Jr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Jr.apply(this,arguments)},Ph=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},$s=function(e){Rh(t,e);function t(n,r,i){var o=e.call(this,n,r,i)||this;return o._localStream=o.options._stream,o.connectionId=o.options.connectionId||t.ID_PREFIX+ae.randomToken(),o._negotiator=new yo.Negotiator(o),o._localStream&&o._negotiator.startConnection({_stream:o._localStream,originator:!0}),o}return Object.defineProperty(t.prototype,"type",{get:function(){return tt.Media},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),t.prototype.addStream=function(n){L.default.log("Receiving stream",n),this._remoteStream=n,e.prototype.emit.call(this,"stream",n)},t.prototype.handleMessage=function(n){var r=n.type,i=n.payload;switch(n.type){case Me.Answer:this._negotiator.handleSDP(r,i.sdp),this._open=!0;break;case Me.Candidate:this._negotiator.handleCandidate(i.candidate);break;default:L.default.warn("Unrecognized message type:".concat(r," from peer:").concat(this.peer));break}},t.prototype.answer=function(n,r){var i,o;if(r===void 0&&(r={}),this._localStream){L.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=n,r&&r.sdpTransform&&(this.options.sdpTransform=r.sdpTransform),this._negotiator.startConnection(Jr(Jr({},this.options._payload),{_stream:n}));var l=this.provider._getMessages(this.connectionId);try{for(var c=Ph(l),s=c.next();!s.done;s=c.next()){var u=s.value;this.handleMessage(u)}}catch(f){i={error:f}}finally{try{s&&!s.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}this._open=!0},t.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,e.prototype.emit.call(this,"close"))},t.ID_PREFIX="mc_",t}(_o.BaseConnection),Xi={};mt(Xi,"DataConnection",()=>Ws,e=>Ws=e);var Fl={};mt(Fl,"EncodingQueue",()=>Vs,e=>Vs=e);var Oh=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},e(t,n)};return function(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Vs=function(e){Oh(t,e);function t(){var n=e.call(this)||this;return n.fileReader=new FileReader,n._queue=[],n._processing=!1,n.fileReader.onload=function(r){n._processing=!1,r.target&&n.emit("done",r.target.result),n.doNextTask()},n.fileReader.onerror=function(r){L.default.error("EncodingQueue error:",r),n._processing=!1,n.destroy(),n.emit("error",r)},n}return Object.defineProperty(t.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),t.prototype.enque=function(n){this.queue.push(n),!this.processing&&this.doNextTask()},t.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},t.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},t}(sr.EventEmitter),wh=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},e(t,n)};return function(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Dh=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ws=function(e){wh(t,e);function t(n,r,i){var o=e.call(this,n,r,i)||this;return o.stringify=JSON.stringify,o.parse=JSON.parse,o._buffer=[],o._bufferSize=0,o._buffering=!1,o._chunkedData={},o._encodingQueue=new Fl.EncodingQueue,o.connectionId=o.options.connectionId||t.ID_PREFIX+ae.randomToken(),o.label=o.options.label||o.connectionId,o.serialization=o.options.serialization||gt.Binary,o.reliable=!!o.options.reliable,o._encodingQueue.on("done",function(l){o._bufferedSend(l)}),o._encodingQueue.on("error",function(){L.default.error("DC#".concat(o.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),o.close()}),o._negotiator=new yo.Negotiator(o),o._negotiator.startConnection(o.options._payload||{originator:!0}),o}return Object.defineProperty(t.prototype,"type",{get:function(){return tt.Data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),t.prototype.initialize=function(n){this._dc=n,this._configureDataChannel()},t.prototype._configureDataChannel=function(){var n=this;(!ae.supports.binaryBlob||ae.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){L.default.log("DC#".concat(n.connectionId," dc connection success")),n._open=!0,n.emit("open")},this.dataChannel.onmessage=function(r){L.default.log("DC#".concat(n.connectionId," dc onmessage:"),r.data),n._handleDataMessage(r)},this.dataChannel.onclose=function(){L.default.log("DC#".concat(n.connectionId," dc closed for:"),n.peer),n.close()}},t.prototype._handleDataMessage=function(n){var r=this,i=n.data,o=i.constructor,l=this.serialization===gt.Binary||this.serialization===gt.BinaryUTF8,c=i;if(l){if(o===Blob){ae.blobToArrayBuffer(i,function(u){var f=ae.unpack(u);r.emit("data",f)});return}else if(o===ArrayBuffer)c=ae.unpack(i);else if(o===String){var s=ae.binaryStringToArrayBuffer(i);c=ae.unpack(s)}}else this.serialization===gt.JSON&&(c=this.parse(i));if(c.__peerData){this._handleChunk(c);return}e.prototype.emit.call(this,"data",c)},t.prototype._handleChunk=function(n){var r=n.__peerData,i=this._chunkedData[r]||{data:[],count:0,total:n.total};if(i.data[n.n]=n.data,i.count++,this._chunkedData[r]=i,i.total===i.count){delete this._chunkedData[r];var o=new Blob(i.data);this._handleDataMessage({data:o})}},t.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,e.prototype.emit.call(this,"close"))},t.prototype.send=function(n,r){if(!this.open){e.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this.serialization===gt.JSON)this._bufferedSend(this.stringify(n));else if(this.serialization===gt.Binary||this.serialization===gt.BinaryUTF8){var i=ae.pack(n);if(!r&&i.size>ae.chunkedMTU){this._sendChunks(i);return}ae.supports.binaryBlob?this._bufferedSend(i):this._encodingQueue.enque(i)}else this._bufferedSend(n)},t.prototype._bufferedSend=function(n){(this._buffering||!this._trySend(n))&&(this._buffer.push(n),this._bufferSize=this._buffer.length)},t.prototype._trySend=function(n){var r=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>t.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){r._buffering=!1,r._tryBuffer()},50),!1;try{this.dataChannel.send(n)}catch(i){return L.default.error("DC#:".concat(this.connectionId," Error when sending:"),i),this._buffering=!0,this.close(),!1}return!0},t.prototype._tryBuffer=function(){if(!!this.open&&this._buffer.length!==0){var n=this._buffer[0];this._trySend(n)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},t.prototype._sendChunks=function(n){var r,i,o=ae.chunk(n);L.default.log("DC#".concat(this.connectionId," Try to send ").concat(o.length," chunks..."));try{for(var l=Dh(o),c=l.next();!c.done;c=l.next()){var s=c.value;this.send(s,!0)}}catch(u){r={error:u}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}},t.prototype.handleMessage=function(n){var r=n.payload;switch(n.type){case Me.Answer:this._negotiator.handleSDP(n.type,r.sdp);break;case Me.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:L.default.warn("Unrecognized message type:",n.type,"from peer:",this.peer);break}},t.ID_PREFIX="dc_",t.MAX_BUFFERED_AMOUNT=8388608,t}(_o.BaseConnection),Gl={};mt(Gl,"API",()=>Ys,e=>Ys=e);var qs=function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(l){l(o)})}return new(n||(n=Promise))(function(o,l){function c(f){try{u(r.next(f))}catch(a){l(a)}}function s(f){try{u(r.throw(f))}catch(a){l(a)}}function u(f){f.done?o(f.value):i(f.value).then(c,s)}u((r=r.apply(e,t||[])).next())})},Js=function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,l;return l={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function c(u){return function(f){return s([u,f])}}function s(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,i=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){n.label=u[1];break}if(u[0]===6&&n.label<o[1]){n.label=o[1],o=u;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(u);break}o[2]&&n.ops.pop(),n.trys.pop();continue}u=t.call(e,n)}catch(f){u=[6,f],i=0}finally{r=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},Ys=function(){function e(t){this._options=t}return e.prototype._buildRequest=function(t){var n=this._options.secure?"https":"http",r=this._options,i=r.host,o=r.port,l=r.path,c=r.key,s=new URL("".concat(n,"://").concat(i,":").concat(o).concat(l).concat(c,"/").concat(t));return s.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),s.searchParams.set("version",vo.version),fetch(s.href,{referrerPolicy:this._options.referrerPolicy})},e.prototype.retrieveId=function(){return qs(this,void 0,Promise,function(){var t,n,r;return Js(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(t=i.sent(),t.status!==200)throw new Error("Error. Status:".concat(t.status));return[2,t.text()];case 2:throw n=i.sent(),L.default.error("Error retrieving ID",n),r="",this._options.path==="/"&&this._options.host!==ae.CLOUD_HOST&&(r=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+r);case 3:return[2]}})})},e.prototype.listAllPeers=function(){return qs(this,void 0,Promise,function(){var t,n,r;return Js(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(t=i.sent(),t.status!==200)throw t.status===401?(n="",this._options.host===ae.CLOUD_HOST?n="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":n="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+n)):new Error("Error. Status:".concat(t.status));return[2,t.json()];case 2:throw r=i.sent(),L.default.error("Error retrieving list peers",r),new Error("Could not get list peers from the server."+r);case 3:return[2]}})})},e}(),Ah=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},e(t,n)};return function(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Gn=function(){return Gn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Gn.apply(this,arguments)},Cn=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ih=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,o=[],l;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(c){l={error:c}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(l)throw l.error}}return o},Xs=function(e){Ah(t,e);function t(n,r){var i=e.call(this)||this;i._id=null,i._lastServerId=null,i._destroyed=!1,i._disconnected=!1,i._open=!1,i._connections=new Map,i._lostMessages=new Map;var o;return n&&n.constructor==Object?r=n:n&&(o=n.toString()),r=Gn({debug:0,host:ae.CLOUD_HOST,port:ae.CLOUD_PORT,path:"/",key:t.DEFAULT_KEY,token:ae.randomToken(),config:ae.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},r),i._options=r,i._options.host==="/"&&(i._options.host=window.location.hostname),i._options.path&&(i._options.path[0]!=="/"&&(i._options.path="/"+i._options.path),i._options.path[i._options.path.length-1]!=="/"&&(i._options.path+="/")),i._options.secure===void 0&&i._options.host!==ae.CLOUD_HOST?i._options.secure=ae.isSecure():i._options.host==ae.CLOUD_HOST&&(i._options.secure=!0),i._options.logFunction&&L.default.setLogFunction(i._options.logFunction),L.default.logLevel=i._options.debug||0,i._api=new Gl.API(r),i._socket=i._createServerConnection(),!ae.supports.audioVideo&&!ae.supports.data?(i._delayedAbort(Ce.BrowserIncompatible,"The current browser does not support WebRTC"),i):!!o&&!ae.validateId(o)?(i._delayedAbort(Ce.InvalidID,'ID "'.concat(o,'" is invalid')),i):(o?i._initialize(o):i._api.retrieveId().then(function(l){return i._initialize(l)}).catch(function(l){return i._abort(Ce.ServerError,l)}),i)}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"connections",{get:function(){var n,r,i=Object.create(null);try{for(var o=Cn(this._connections),l=o.next();!l.done;l=o.next()){var c=Ih(l.value,2),s=c[0],u=c[1];i[s]=u}}catch(f){n={error:f}}finally{try{l&&!l.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),t.prototype._createServerConnection=function(){var n=this,r=new jl.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return r.on(yt.Message,function(i){n._handleMessage(i)}),r.on(yt.Error,function(i){n._abort(Ce.SocketError,i)}),r.on(yt.Disconnected,function(){n.disconnected||(n.emitError(Ce.Network,"Lost connection to server."),n.disconnect())}),r.on(yt.Close,function(){n.disconnected||n._abort(Ce.SocketClosed,"Underlying socket is already closed.")}),r},t.prototype._initialize=function(n){this._id=n,this.socket.start(n,this._options.token)},t.prototype._handleMessage=function(n){var r,i,o=n.type,l=n.payload,c=n.src;switch(o){case Me.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case Me.Error:this._abort(Ce.ServerError,l.msg);break;case Me.IdTaken:this._abort(Ce.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case Me.InvalidKey:this._abort(Ce.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case Me.Leave:L.default.log("Received leave message from ".concat(c)),this._cleanupPeer(c),this._connections.delete(c);break;case Me.Expire:this.emitError(Ce.PeerUnavailable,"Could not connect to peer ".concat(c));break;case Me.Offer:var h=l.connectionId,g=this.getConnection(c,h);if(g&&(g.close(),L.default.warn("Offer received for existing Connection ID:".concat(h))),l.type===tt.Media){var s=new Yi.MediaConnection(c,this,{connectionId:h,_payload:l,metadata:l.metadata});g=s,this._addConnection(c,g),this.emit("call",s)}else if(l.type===tt.Data){var u=new Xi.DataConnection(c,this,{connectionId:h,_payload:l,metadata:l.metadata,label:l.label,serialization:l.serialization,reliable:l.reliable});g=u,this._addConnection(c,g),this.emit("connection",u)}else{L.default.warn("Received malformed connection type:".concat(l.type));return}var f=this._getMessages(h);try{for(var a=Cn(f),d=a.next();!d.done;d=a.next()){var p=d.value;g.handleMessage(p)}}catch(m){r={error:m}}finally{try{d&&!d.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}break;default:if(!l){L.default.warn("You received a malformed message from ".concat(c," of type ").concat(o));return}var h=l.connectionId,g=this.getConnection(c,h);g&&g.peerConnection?g.handleMessage(n):h?this._storeMessage(h,n):L.default.warn("You received an unrecognized message:",n);break}},t.prototype._storeMessage=function(n,r){this._lostMessages.has(n)||this._lostMessages.set(n,[]),this._lostMessages.get(n).push(r)},t.prototype._getMessages=function(n){var r=this._lostMessages.get(n);return r?(this._lostMessages.delete(n),r):[]},t.prototype.connect=function(n,r){if(r===void 0&&(r={}),this.disconnected){L.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(Ce.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}var i=new Xi.DataConnection(n,this,r);return this._addConnection(n,i),i},t.prototype.call=function(n,r,i){if(i===void 0&&(i={}),this.disconnected){L.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(Ce.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!r){L.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}var o=new Yi.MediaConnection(n,this,Gn(Gn({},i),{_stream:r}));return this._addConnection(n,o),o},t.prototype._addConnection=function(n,r){L.default.log("add connection ".concat(r.type,":").concat(r.connectionId," to peerId:").concat(n)),this._connections.has(n)||this._connections.set(n,[]),this._connections.get(n).push(r)},t.prototype._removeConnection=function(n){var r=this._connections.get(n.peer);if(r){var i=r.indexOf(n);i!==-1&&r.splice(i,1)}this._lostMessages.delete(n.connectionId)},t.prototype.getConnection=function(n,r){var i,o,l=this._connections.get(n);if(!l)return null;try{for(var c=Cn(l),s=c.next();!s.done;s=c.next()){var u=s.value;if(u.connectionId===r)return u}}catch(f){i={error:f}}finally{try{s&&!s.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}return null},t.prototype._delayedAbort=function(n,r){var i=this;setTimeout(function(){i._abort(n,r)},0)},t.prototype._abort=function(n,r){L.default.error("Aborting!"),this.emitError(n,r),this._lastServerId?this.disconnect():this.destroy()},t.prototype.emitError=function(n,r){L.default.error("Error:",r);var i;typeof r=="string"?i=new Error(r):i=r,i.type=n,this.emit("error",i)},t.prototype.destroy=function(){this.destroyed||(L.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},t.prototype._cleanup=function(){var n,r;try{for(var i=Cn(this._connections.keys()),o=i.next();!o.done;o=i.next()){var l=o.value;this._cleanupPeer(l),this._connections.delete(l)}}catch(c){n={error:c}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}this.socket.removeAllListeners()},t.prototype._cleanupPeer=function(n){var r,i,o=this._connections.get(n);if(!!o)try{for(var l=Cn(o),c=l.next();!c.done;c=l.next()){var s=c.value;s.close()}}catch(u){r={error:u}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}},t.prototype.disconnect=function(){if(!this.disconnected){var n=this.id;L.default.log("Disconnect peer with ID:".concat(n)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=n,this._id=null,this.emit("disconnected",n)}},t.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)L.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)L.default.error("In a hurry? We're still trying to make the initial connection!");else throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"))}},t.prototype.listAllPeers=function(n){var r=this;n===void 0&&(n=function(i){}),this._api.listAllPeers().then(function(i){return n(i)}).catch(function(i){return r._abort(Ce.ServerError,i)})},t.DEFAULT_KEY="peerjs",t}(sr.EventEmitter),Mh=Nl.Peer;class Qs{constructor(t){F(this,"eventHandlers",{});F(this,"connectionTimeout");F(this,"runningMachine",null);F(this,"peer",null);F(this,"ourPeerId",null);F(this,"onStateChangeCallback",t=>{});F(this,"xstateMachineLayout",ir({predictableActionArguments:!0,preserveActionOrder:!0,id:"DataConnection",initial:"Connecting",states:{Connecting:{entry:"onConnectingFunction",on:{ON_CONNECTED:{target:"Connected"},ON_DESTROY:{target:"Destroyed"}}},Reconnecting:{entry:"onReConnectingFunction",on:{ON_CONNECTED:{target:"Connected"},ON_DESTROY:{target:"Destroyed"}}},Connected:{entry:"onConnectedFunction",on:{ON_DISCONNECTED:{target:"Reconnecting"},ON_DESTROY:{target:"Destroyed"}}},Destroyed:{entry:"onDestoyedFunction",type:"final"}}},{actions:{onConnectingFunction:()=>{this.onConnecting()},onReConnectingFunction:()=>{this.onReConnecting()},onConnectedFunction:()=>{this.onConnected()},onDestoyedFunction:()=>{this.cleanup()}}}));this.currentState=this.xstateMachineLayout.config.initial,this.onStateChangeCallback=t}start(){this.runningMachine=mn(this.xstateMachineLayout,{devTools:lt(sn)}),this.runningMachine.onTransition(r=>{this.currentState=r.value,this.onStateChangeCallback(this.currentState)}),this.runningMachine.start(),this.ourPeerId=lt(Zt),this.ourPeerId||(this.ourPeerId=ys(),localStorage.setItem("ourPeerId",this.ourPeerId),Zt.set(this.ourPeerId));let t=localStorage.getItem("peerToken"),n=t?{...Hr,token:t}:Hr;this.peer=new Mh(this.ourPeerId,n),console.log("Our PeerToken:",this.peer.options.token),!t&&this.peer.options.token&&localStorage.setItem("peerToken",this.peer.options.token),this.eventHandlers.onOpen=()=>{this.sendEventToMachine("ON_CONNECTED"),ge("OurPeer Open!")},this.peer.on("open",this.eventHandlers.onOpen),this.eventHandlers.onError=r=>{r.type!="peer-unavailable"&&(r.type=="unavailable-id"?(ge("peer id "+this.ourPeerId+" already taken"),this.ourPeerId=ys(),Zt.set(this.ourPeerId)):r.type=="webrtc"&&r.message.indexOf("No remoteDescription")==-1?ge("Webrtc Error: "+r.message):console.log("!!!UNHANDLED!! OURPEER_ERROR:"+r.message+" | "+r.type),this.sendEventToMachine("ON_DESTROY"))},this.peer.on("error",this.eventHandlers.onError),this.eventHandlers.onClose=r=>{console.warn("!!UNHANDLED!! OURPEER_CLOSE:",r),this.sendEventToMachine("ON_DESTROY")},this.peer.on("close",this.eventHandlers.onClose),this.eventHandlers.onDisconnected=r=>{console.warn("!!UNHANDLED!! OURPEER_CLOSE:",r),this.sendEventToMachine("ON_DISCONNECTED")},this.peer.on("disconnected",this.eventHandlers.onDisconnected)}sendEventToMachine(t){this.runningMachine&&this.runningMachine.send(t)}onConnecting(){console.log("OnConnecting...."),this.connectionTimeout=setTimeout(()=>{this.sendEventToMachine("ON_DESTROY")},12e3)}onReConnecting(){console.log("OnReConnecting...."),this.peer.reconnect(),this.onConnecting()}onConnected(){clearTimeout(this.connectionTimeout),this.connectionTimeout=void 0}cleanup(){clearTimeout(this.connectionTimeout),this.runningMachine.stop(),this.currentState="Destroyed",this.onStateChangeCallback(this.currentState),this.peer&&(this.peer.off("open",this.eventHandlers.onOpen),this.peer.off("error",this.eventHandlers.onError),this.peer.off("close",this.eventHandlers.onClose),this.peer.off("disconnected",this.eventHandlers.onDisconnected),this.peer.destroy(),this.peer=null)}}class Lh{constructor(t,n,r,i){F(this,"rovPeerId",null);F(this,"ourPeerMachine",null);F(this,"trusted",!1);F(this,"dataConnections",[]);F(this,"mediaConnections",[]);F(this,"msgQueue",new Op);F(this,"connectedDataConnIndex",0);F(this,"overallDCState",null);F(this,"overallMCState",null);F(this,"onOverallStateChange",t=>{});F(this,"onMesssageRecivedCallback",t=>{});F(this,"reconnectFailureCount",0);this.rovPeerId=t,this.ourPeerMachine=n,this.onMesssageRecivedCallback=o=>{r(o,this.rovPeerId)},this.onOverallStateChange=()=>{console.log("onOverallStateChangeCallback",i),i(this.overallDCState,this.overallMCState,this.rovPeerId)},console.log("Rov constructor",t,i)}start(){if(this.dataConnections.length==0){let t=new ci(this.ourPeerMachine.peer,this.rovPeerId,this.dcStateChange.bind(this),this.onMesssageRecivedCallback);this.dataConnections=[t],t.start()}if(this.mediaConnections.length==0){let t=new di(this.ourPeerMachine.peer,this.rovPeerId,this.mcStateChange.bind(this));this.mediaConnections=[t],t.start(),this.sendMessage({action:Nt.begin_video_stream})}}emptyMsgQueue(){if(console.info("emptying msg queue for rov: ",this.rovPeerId),this.overallDCState!=G.connected)return;e:for(;!this.msgQueue.isEmpty();){let t=this.msgQueue.peak();for(let n=0;n<this.dataConnections.length;n++){const r=(this.connectedDataConnIndex+n)%this.dataConnections.length;if(this.dataConnections[r].sendMessage(t.msg)){console.info(`Msg sent to rov: ${this.rovPeerId}`,t.msg),t.onSendCallback&&t.onSendCallback(t.msg),this.msgQueue.pop(),this.connectedDataConnIndex=r;continue e}else console.info('Failed to send "{}" to rov: {}',t.msg,this.rovPeerId)}break e}}sendMessage(t,n){typeof t!="string"&&(t=JSON.stringify(t)),console.info("Adding msg to queue:",t),this.msgQueue.push({msg:t,onSendCallback:n}),this.emptyMsgQueue()}stateChangeHandler(t,n,r){if(this[t]==null||this[t].length==0)return[-1,[]];let i=this[t].map(l=>l.currentState),o=0;console.log(t,i);for(let l=0;l<i.length;l++){const c=i[l];if(c==G.connected)o++,o>1&&(this[t][l].cleanup(),this[t].splice(l,1)),this.reconnectFailureCount=0;else if(c==G.reconnecting&&i.length<=1){let s=n();this[t].push(s),r(s)}else if(c=="Destroyed"){if(this.reconnectFailureCount++,this[t].splice(l,1),this.reconnectFailureCount>=5)return this.reconnectFailureCount=0,console.info("Rov "+t+" Too Many Failures, exiting..."),[0,[]];if(this[t].length===0){let s=n();return this[t]=[s],r(s),[-1,[]]}}}return console.log("Returning states"),[o,i]}dcStateChange(){let[t,n]=this.stateChangeHandler("dataConnections",()=>new ci(this.ourPeerMachine.peer,this.rovPeerId,this.dcStateChange.bind(this),this.onMesssageRecivedCallback.bind(this)),r=>{r.start()});if(t!=-1)if(console.debug("dc states:",n,t),t>0){if(this.overallDCState==G.connected)return;this.overallDCState=G.connected,this.onOverallStateChange(),this.emptyMsgQueue()}else if(n.indexOf(G.reconnecting)!=-1){if(this.overallDCState==G.reconnecting)return;this.overallDCState=G.reconnecting,this.onOverallStateChange()}else if(n.indexOf(G.connecting)!=-1){if(this.overallDCState==G.connecting)return;this.overallDCState=G.connecting,this.onOverallStateChange()}else this.overallDCState!=G.disconnected&&(this.overallDCState=G.disconnected,this.onOverallStateChange(),this.overallMCState!=G.disconnected&&this.mediaConnections.forEach(r=>{r.cleanup()}))}mcStateChange(){if(this.dataConnections.length==0)return;let[t,n]=this.stateChangeHandler("mediaConnections",()=>new di(this.ourPeerMachine.peer,this.rovPeerId,this.mcStateChange.bind(this)),r=>{r.start(),this.sendMessage({action:Nt.begin_video_stream})});if(t!=-1)if(console.debug("mc states:",n,t),t>0){if(this.overallMCState==G.connected)return;this.overallMCState=G.connected,this.onOverallStateChange()}else if(n.indexOf(G.reconnecting)!=-1){if(this.overallMCState==G.reconnecting)return;this.overallMCState=G.reconnecting,this.onOverallStateChange()}else if(n.indexOf(G.connecting)!=-1){if(this.overallMCState==G.connecting)return;this.overallMCState=G.connecting,this.onOverallStateChange()}else this.overallMCState!=G.disconnected&&(this.overallMCState=G.disconnected,this.onOverallStateChange())}switchOutThisPeer(t){this.ourPeerMachine=t;let n=new ci(this.ourPeerMachine.peer,this.rovPeerId,this.dcStateChange.bind(this),this.onMesssageRecivedCallback);this.dataConnections=[...this.dataConnections,n],n.start();let r=new di(this.ourPeerMachine.peer,this.rovPeerId,this.mcStateChange.bind(this));this.mediaConnections=[...this.mediaConnections,r],r.start(),this.sendMessage({action:Nt.begin_video_stream})}cleanup(){console.info("Cleaning up RovConnection: ",this.rovPeerId),this.dataConnections.forEach(t=>{t.cleanup()}),this.mediaConnections.forEach(t=>{t.cleanup()})}}class Nh{constructor(t){F(this,"ROVs",{});F(this,"currentTargetRovId",ji(lt(an)));F(this,"ourPeerMachines",[]);F(this,"overallPeerServerState",G.disconnected);F(this,"reconnectFailureCount",0);F(this,"onMessageRecivedCallback",t=>{console.info("msg recived:"+t)});this.onMessageRecivedCallback=t}start(){if(this.ourPeerMachines.length==0){let t=new Qs(this.peerConnStateChange.bind(this));this.ourPeerMachines=[t],t.start()}}getThisPeerId(){return lt(Zt)}peerConnStateChange(){let t=this.ourPeerMachines.map(r=>r.currentState);console.log("PeerStatesChange: ",t);let n=0;for(let r=0;r<t.length;r++){const i=t[r];let o=null;if(i==G.connected?(n++,n>1?(this.ourPeerMachines[r].cleanup(),this.ourPeerMachines.splice(r,1)):this.connectToCurrentTargetRov(),this.reconnectFailureCount=0):i==G.reconnecting&&t.length<=1?(o=new Qs(this.peerConnStateChange.bind(this)),this.ourPeerMachines=[...this.ourPeerMachines,o]):i=="Destroyed"&&(this.reconnectFailureCount++,this.ourPeerMachines.splice(r,1),this.reconnectFailureCount>=3?(this.reconnectFailureCount=0,ge("Our Peer has Too Many Failures, try reloading the page...")):this.ourPeerMachines.length===0&&this.start()),o){o.start();for(const l in this.ROVs){const c=this.ROVs[l].switchOutThisPeer;c&&c(o)}}}if(n!=-1)if(console.debug("peer states:",t,n),n>0){if(this.overallPeerServerState==G.connected)return;On.set(G.connected)}else if(t.indexOf(G.reconnecting)!=-1){if(this.overallPeerServerState==G.reconnecting)return;On.set(G.reconnecting)}else if(t.indexOf(G.connecting)!=-1){if(this.overallPeerServerState==G.connecting)return;On.set(G.connecting)}else this.overallPeerServerState!=G.disconnected&&On.set(G.disconnected)}rovConnStateChange(t,n,r){console.info(r+" Conn State: dc:"+t+" mc:"+n),r==this.currentTargetRovId&&(console.info("Current Rov "+r+" state changed"),Ni.set(t),Bi.set(n))}messageRecived(t,n){n===this.currentTargetRovId&&this.onMessageRecivedCallback(t)}connectToRov(t){this.ROVs[t]||(console.log("new Rov: ",t,this.rovConnStateChange.bind(this)),this.ROVs[t]=new Lh(t,this.ourPeerMachines[0],this.messageRecived.bind(this),this.rovConnStateChange.bind(this))),this.ROVs[t].start()}connectToCurrentTargetRov(){this.currentTargetRovId=ji(lt(an)),this.connectToRov(this.currentTargetRovId)}disconnectFromRov(t){t==this.currentTargetRovId&&(Ni.set(G.disconnected),Bi.set(G.disconnected)),this.ROVs[t]!==void 0&&(this.ROVs[t].cleanup(),delete this.ROVs[t])}disconnectFromCurrentRov(){this.disconnectFromRov(this.currentTargetRovId)}sendMessageToRov(t,n){this.ROVs[n].sendMessage(t)}sendMessageToCurrentRov(t){this.sendMessageToRov(t,this.currentTargetRovId)}cleanup(){for(const t in this.ROVs)this.disconnectFromRov(t);for(const t of this.ourPeerMachines)t.cleanup();this.ourPeerMachines=[]}}function Bh(e,t,n){return e>=n.x&&e<=n.x+n.width&&t>=n.y&&t<=n.y+n.height}const mi={emulatedGamepads:[],DEFAULT_BUTTON_COUNT:18,DEFAULT_AXIS_COUNT:4,addEmulatedGamepad:function(e,t,n){var r={connected:!0,timestamp:Math.floor(Date.now()/1e3),buttons:new Array(t).fill({pressed:!1,value:0,touched:!1},0,t),axes:new Array(n).fill(0,0,n),id:"Emulated Gamepad "+e+" (Xinput STANDARD GAMEPAD)",mapping:"standard"};e||(e=this.emulatedGamepads.length),this.emulatedGamepads[e]=r;const i=new Event("gamepadconnected");return i.gamepad=r,r},disconnectEmulatedGamepad:function(e){var t=this.emulatedGamepads[e];if(t&&(this.emulatedGamepads.splice(e,1),!window.getGamepads()[e])){const n=new Event("gamepaddisconnected");t.connected=!1,t.timestamp=Math.floor(Date.now()/1e3),n.gamepad=t,window.dispatchEvent(n)}},pressButton:function(e,t,n,r){var i=this.emulatedGamepads[e];i||(i=this.addEmulatedGamepad(e,this.DEFAULT_BUTTON_COUNT,this.DEFAULT_AXIS_COUNT));var o=n>.1;this.emulatedGamepads[e].buttons[t]={pressed:o,value:n||0,touched:o||r||!1}},moveAxis:function(e,t,n){var r=this.emulatedGamepads[e];r||(r=this.addEmulatedGamepad(e,this.DEFAULT_BUTTON_COUNT,this.DEFAULT_AXIS_COUNT)),this.emulatedGamepads[e].axes[t]=n},registerOnScreenGamepadButtonEvents:function(e,t){var n=this;t.forEach(function(r,i){!r||(r.addEventListener("pointerover",()=>{n.pressButton(e,i,0,!0)}),r.addEventListener("pointerleave",()=>{n.pressButton(e,i,0,!1)}),r.addEventListener("pointerdown",()=>{n.pressButton(e,i,1,!0)}),r.addEventListener("pointerup",()=>{n.pressButton(e,i,0,!0)}))})},registerOnScreenGamepadAxisEvents:function(e,t){var n=100,r=this,i={};const o=function(c){var s=c.pointerId;for(const a in i)if(a==s){const d=i[a];var u=Math.max(Math.min((c.clientX-d.startX)/n,1),-1),f=Math.max(Math.min((c.clientY-d.startY)/n,1),-1);d.horizontalGpadAction&&d.horizontalGpadAction.type=="axis"?r.moveAxis(e,d.horizontalGpadAction.index,u):d.horizontalGpadAction&&d.horizontalGpadAction.type=="button"&&r.pressButton(e,d.horizontalGpadAction.index,u,!0),d.verticalGpadAction&&d.verticalGpadAction.type=="axis"?r.moveAxis(e,d.verticalGpadAction.index,f):d.verticalGpadAction&&d.verticalGpadAction.type=="button"&&r.pressButton(e,d.verticalGpadAction.index,f,!0)}},l=function(c){var s=c.pointerId;for(const u in i)if(u==s){const f=i[u];f.horizontalGpadAction&&f.horizontalGpadAction.type=="axis"?r.moveAxis(e,f.horizontalGpadAction.index,0):f.horizontalGpadAction&&f.horizontalGpadAction.type=="button"&&r.pressButton(e,f.horizontalGpadAction.index,0,!1),f.verticalGpadAction&&f.verticalGpadAction.type=="axis"?r.moveAxis(e,f.verticalGpadAction.index,0):f.verticalGpadAction&&f.verticalGpadAction.type=="button"&&r.pressButton(e,f.verticalGpadAction.index,0,!1),delete i[u]}Object.keys(i).length==0&&(document.removeEventListener("pointermove",o,!1),document.removeEventListener("pointerup",l,!1))};document.addEventListener("pointerdown",function(c){t.forEach(function(s){const u=s.elem.getBoundingClientRect();Bh(c.clientX,c.clientY,u)&&(s.startX=c.clientX,s.startY=c.clientY,i[c.pointerId]=s)}),Object.keys(i).length==1&&(document.addEventListener("pointermove",o,!1),document.addEventListener("pointerup",l,!1))})},monkeyPatchGetGamepads:function(){var e=navigator.getGamepads||navigator.webkitGetGamepads||navigator.mozGetGamepads||navigator.msGetGamepads;e&&(e=e.bind(navigator));var t=this;navigator.getGamepads=function(){var n=e!=null?e():[];n=Array.from(n);for(var r=0;r<t.emulatedGamepads.length;r++){var i=n[r],o=t.emulatedGamepads[r];if(o&&i){i.emulated=!0;for(let l=0;l<o.buttons.length;l++){const c=o.buttons[l],s=i.buttons[l];!c||!i.buttons[l]||(n[r].buttons[l]={touched:c.touched||s.touched||!1,pressed:c.pressed||s.pressed||!1,value:Math.max(c.value,s.value)||0})}for(let l=0;l<o.axes.length;l++){const c=o.axes[l],s=i.axes[l];n[r].axes[l]=Math.max(c,s)||0}}else o&&(o.emulated=!0,o.timestamp=Math.floor(Date.now()/1e3),n[r]=t.cloneGamepad(o))}return n}},cloneGamepad:function(e){if(!e)return e;let t={id:e.id,displayId:e.displayId,mapping:e.mapping,index:e.index,emulated:e.emulated,timestamp:e.timestamp,connected:e.connected,axes:new Array(e.axes.length),buttons:new Array(e.buttons.length)};for(let n=0;n<e.axes.length;++n)t.axes[n]=e.axes[n];for(let n=0;n<e.buttons.length;++n){let{pressed:r,value:i,touched:o}=e.buttons[n];o=o||!1,t.buttons[n]={pressed:r,value:i,touched:o}}return t}};function Qe(e){if(e==null)return window;if(e.toString()!=="[object Window]"){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function Ft(e){var t=Qe(e).Element;return e instanceof t||e instanceof Element}function Ye(e){var t=Qe(e).HTMLElement;return e instanceof t||e instanceof HTMLElement}function bo(e){if(typeof ShadowRoot>"u")return!1;var t=Qe(e).ShadowRoot;return e instanceof t||e instanceof ShadowRoot}var xn=Math.max,Ks=Math.min,ln=Math.round;function Qi(){var e=navigator.userAgentData;return e!=null&&e.brands?e.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function xl(){return!/^((?!chrome|android).)*safari/i.test(Qi())}function cn(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var r=e.getBoundingClientRect(),i=1,o=1;t&&Ye(e)&&(i=e.offsetWidth>0&&ln(r.width)/e.offsetWidth||1,o=e.offsetHeight>0&&ln(r.height)/e.offsetHeight||1);var l=Ft(e)?Qe(e):window,c=l.visualViewport,s=!xl()&&n,u=(r.left+(s&&c?c.offsetLeft:0))/i,f=(r.top+(s&&c?c.offsetTop:0))/o,a=r.width/i,d=r.height/o;return{width:a,height:d,top:f,right:u+a,bottom:f+d,left:u,x:u,y:f}}function Co(e){var t=Qe(e),n=t.pageXOffset,r=t.pageYOffset;return{scrollLeft:n,scrollTop:r}}function jh(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}function Fh(e){return e===Qe(e)||!Ye(e)?Co(e):jh(e)}function pt(e){return e?(e.nodeName||"").toLowerCase():null}function wt(e){return((Ft(e)?e.ownerDocument:e.document)||window.document).documentElement}function So(e){return cn(wt(e)).left+Co(e).scrollLeft}function bt(e){return Qe(e).getComputedStyle(e)}function To(e){var t=bt(e),n=t.overflow,r=t.overflowX,i=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+i+r)}function Gh(e){var t=e.getBoundingClientRect(),n=ln(t.width)/e.offsetWidth||1,r=ln(t.height)/e.offsetHeight||1;return n!==1||r!==1}function xh(e,t,n){n===void 0&&(n=!1);var r=Ye(t),i=Ye(t)&&Gh(t),o=wt(t),l=cn(e,i,n),c={scrollLeft:0,scrollTop:0},s={x:0,y:0};return(r||!r&&!n)&&((pt(t)!=="body"||To(o))&&(c=Fh(t)),Ye(t)?(s=cn(t,!0),s.x+=t.clientLeft,s.y+=t.clientTop):o&&(s.x=So(o))),{x:l.left+c.scrollLeft-s.x,y:l.top+c.scrollTop-s.y,width:l.width,height:l.height}}function Uh(e){var t=cn(e),n=e.offsetWidth,r=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-r)<=1&&(r=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:r}}function ti(e){return pt(e)==="html"?e:e.assignedSlot||e.parentNode||(bo(e)?e.host:null)||wt(e)}function Ul(e){return["html","body","#document"].indexOf(pt(e))>=0?e.ownerDocument.body:Ye(e)&&To(e)?e:Ul(ti(e))}function Un(e,t){var n;t===void 0&&(t=[]);var r=Ul(e),i=r===((n=e.ownerDocument)==null?void 0:n.body),o=Qe(r),l=i?[o].concat(o.visualViewport||[],To(r)?r:[]):r,c=t.concat(l);return i?c:c.concat(Un(ti(l)))}function zh(e){return["table","td","th"].indexOf(pt(e))>=0}function Zs(e){return!Ye(e)||bt(e).position==="fixed"?null:e.offsetParent}function Hh(e){var t=/firefox/i.test(Qi()),n=/Trident/i.test(Qi());if(n&&Ye(e)){var r=bt(e);if(r.position==="fixed")return null}var i=ti(e);for(bo(i)&&(i=i.host);Ye(i)&&["html","body"].indexOf(pt(i))<0;){var o=bt(i);if(o.transform!=="none"||o.perspective!=="none"||o.contain==="paint"||["transform","perspective"].indexOf(o.willChange)!==-1||t&&o.willChange==="filter"||t&&o.filter&&o.filter!=="none")return i;i=i.parentNode}return null}function Eo(e){for(var t=Qe(e),n=Zs(e);n&&zh(n)&&bt(n).position==="static";)n=Zs(n);return n&&(pt(n)==="html"||pt(n)==="body"&&bt(n).position==="static")?t:n||Hh(e)||t}var Rt="top",Ot="bottom",un="right",en="left",ko="auto",ni=[Rt,Ot,un,en],ri="start",Qn="end",$h="clippingParents",zl="viewport",Sn="popper",Vh="reference",ea=ni.reduce(function(e,t){return e.concat([t+"-"+ri,t+"-"+Qn])},[]),Wh=[].concat(ni,[ko]).reduce(function(e,t){return e.concat([t,t+"-"+ri,t+"-"+Qn])},[]),qh="beforeRead",Jh="read",Yh="afterRead",Xh="beforeMain",Qh="main",Kh="afterMain",Zh="beforeWrite",em="write",tm="afterWrite",nm=[qh,Jh,Yh,Xh,Qh,Kh,Zh,em,tm];function rm(e){var t=new Map,n=new Set,r=[];e.forEach(function(o){t.set(o.name,o)});function i(o){n.add(o.name);var l=[].concat(o.requires||[],o.requiresIfExists||[]);l.forEach(function(c){if(!n.has(c)){var s=t.get(c);s&&i(s)}}),r.push(o)}return e.forEach(function(o){n.has(o.name)||i(o)}),r}function im(e){var t=rm(e);return nm.reduce(function(n,r){return n.concat(t.filter(function(i){return i.phase===r}))},[])}function om(e){var t;return function(){return t||(t=new Promise(function(n){Promise.resolve().then(function(){t=void 0,n(e())})})),t}}function Bt(e){return e.split("-")[0]}function sm(e){var t=e.reduce(function(n,r){var i=n[r.name];return n[r.name]=i?Object.assign({},i,r,{options:Object.assign({},i.options,r.options),data:Object.assign({},i.data,r.data)}):r,n},{});return Object.keys(t).map(function(n){return t[n]})}function am(e,t){var n=Qe(e),r=wt(e),i=n.visualViewport,o=r.clientWidth,l=r.clientHeight,c=0,s=0;if(i){o=i.width,l=i.height;var u=xl();(u||!u&&t==="fixed")&&(c=i.offsetLeft,s=i.offsetTop)}return{width:o,height:l,x:c+So(e),y:s}}function lm(e){var t,n=wt(e),r=Co(e),i=(t=e.ownerDocument)==null?void 0:t.body,o=xn(n.scrollWidth,n.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),l=xn(n.scrollHeight,n.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),c=-r.scrollLeft+So(e),s=-r.scrollTop;return bt(i||n).direction==="rtl"&&(c+=xn(n.clientWidth,i?i.clientWidth:0)-o),{width:o,height:l,x:c,y:s}}function cm(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&bo(n)){var r=t;do{if(r&&e.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function Ki(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function um(e,t){var n=cn(e,!1,t==="fixed");return n.top=n.top+e.clientTop,n.left=n.left+e.clientLeft,n.bottom=n.top+e.clientHeight,n.right=n.left+e.clientWidth,n.width=e.clientWidth,n.height=e.clientHeight,n.x=n.left,n.y=n.top,n}function ta(e,t,n){return t===zl?Ki(am(e,n)):Ft(t)?um(t,n):Ki(lm(wt(e)))}function fm(e){var t=Un(ti(e)),n=["absolute","fixed"].indexOf(bt(e).position)>=0,r=n&&Ye(e)?Eo(e):e;return Ft(r)?t.filter(function(i){return Ft(i)&&cm(i,r)&&pt(i)!=="body"}):[]}function dm(e,t,n,r){var i=t==="clippingParents"?fm(e):[].concat(t),o=[].concat(i,[n]),l=o[0],c=o.reduce(function(s,u){var f=ta(e,u,r);return s.top=xn(f.top,s.top),s.right=Ks(f.right,s.right),s.bottom=Ks(f.bottom,s.bottom),s.left=xn(f.left,s.left),s},ta(e,l,r));return c.width=c.right-c.left,c.height=c.bottom-c.top,c.x=c.left,c.y=c.top,c}function Kn(e){return e.split("-")[1]}function pm(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function Hl(e){var t=e.reference,n=e.element,r=e.placement,i=r?Bt(r):null,o=r?Kn(r):null,l=t.x+t.width/2-n.width/2,c=t.y+t.height/2-n.height/2,s;switch(i){case Rt:s={x:l,y:t.y-n.height};break;case Ot:s={x:l,y:t.y+t.height};break;case un:s={x:t.x+t.width,y:c};break;case en:s={x:t.x-n.width,y:c};break;default:s={x:t.x,y:t.y}}var u=i?pm(i):null;if(u!=null){var f=u==="y"?"height":"width";switch(o){case ri:s[u]=s[u]-(t[f]/2-n[f]/2);break;case Qn:s[u]=s[u]+(t[f]/2-n[f]/2);break}}return s}function hm(){return{top:0,right:0,bottom:0,left:0}}function mm(e){return Object.assign({},hm(),e)}function gm(e,t){return t.reduce(function(n,r){return n[r]=e,n},{})}function $l(e,t){t===void 0&&(t={});var n=t,r=n.placement,i=r===void 0?e.placement:r,o=n.strategy,l=o===void 0?e.strategy:o,c=n.boundary,s=c===void 0?$h:c,u=n.rootBoundary,f=u===void 0?zl:u,a=n.elementContext,d=a===void 0?Sn:a,p=n.altBoundary,h=p===void 0?!1:p,g=n.padding,m=g===void 0?0:g,v=mm(typeof m!="number"?m:gm(m,ni)),y=d===Sn?Vh:Sn,b=e.rects.popper,P=e.elements[h?y:d],T=dm(Ft(P)?P:P.contextElement||wt(e.elements.popper),s,f,l),w=cn(e.elements.reference),R=Hl({reference:w,element:b,strategy:"absolute",placement:i}),I=Ki(Object.assign({},b,R)),j=d===Sn?I:w,C={top:T.top-j.top+v.top,bottom:j.bottom-T.bottom+v.bottom,left:T.left-j.left+v.left,right:j.right-T.right+v.right},H=e.modifiersData.offset;if(d===Sn&&H){var Z=H[i];Object.keys(C).forEach(function(ne){var ue=[un,Ot].indexOf(ne)>=0?1:-1,_e=[Rt,Ot].indexOf(ne)>=0?"y":"x";C[ne]+=Z[_e]*ue})}return C}var na={placement:"bottom",modifiers:[],strategy:"absolute"};function ra(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function vm(e){e===void 0&&(e={});var t=e,n=t.defaultModifiers,r=n===void 0?[]:n,i=t.defaultOptions,o=i===void 0?na:i;return function(c,s,u){u===void 0&&(u=o);var f={placement:"bottom",orderedModifiers:[],options:Object.assign({},na,o),modifiersData:{},elements:{reference:c,popper:s},attributes:{},styles:{}},a=[],d=!1,p={state:f,setOptions:function(v){var y=typeof v=="function"?v(f.options):v;g(),f.options=Object.assign({},o,f.options,y),f.scrollParents={reference:Ft(c)?Un(c):c.contextElement?Un(c.contextElement):[],popper:Un(s)};var b=im(sm([].concat(r,f.options.modifiers)));return f.orderedModifiers=b.filter(function(P){return P.enabled}),h(),p.update()},forceUpdate:function(){if(!d){var v=f.elements,y=v.reference,b=v.popper;if(!!ra(y,b)){f.rects={reference:xh(y,Eo(b),f.options.strategy==="fixed"),popper:Uh(b)},f.reset=!1,f.placement=f.options.placement,f.orderedModifiers.forEach(function(C){return f.modifiersData[C.name]=Object.assign({},C.data)});for(var P=0;P<f.orderedModifiers.length;P++){if(f.reset===!0){f.reset=!1,P=-1;continue}var T=f.orderedModifiers[P],w=T.fn,R=T.options,I=R===void 0?{}:R,j=T.name;typeof w=="function"&&(f=w({state:f,options:I,name:j,instance:p})||f)}}}},update:om(function(){return new Promise(function(m){p.forceUpdate(),m(f)})}),destroy:function(){g(),d=!0}};if(!ra(c,s))return p;p.setOptions(u).then(function(m){!d&&u.onFirstUpdate&&u.onFirstUpdate(m)});function h(){f.orderedModifiers.forEach(function(m){var v=m.name,y=m.options,b=y===void 0?{}:y,P=m.effect;if(typeof P=="function"){var T=P({state:f,name:v,instance:p,options:b}),w=function(){};a.push(T||w)}})}function g(){a.forEach(function(m){return m()}),a=[]}return p}}var Cr={passive:!0};function ym(e){var t=e.state,n=e.instance,r=e.options,i=r.scroll,o=i===void 0?!0:i,l=r.resize,c=l===void 0?!0:l,s=Qe(t.elements.popper),u=[].concat(t.scrollParents.reference,t.scrollParents.popper);return o&&u.forEach(function(f){f.addEventListener("scroll",n.update,Cr)}),c&&s.addEventListener("resize",n.update,Cr),function(){o&&u.forEach(function(f){f.removeEventListener("scroll",n.update,Cr)}),c&&s.removeEventListener("resize",n.update,Cr)}}const _m={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:ym,data:{}};function bm(e){var t=e.state,n=e.name;t.modifiersData[n]=Hl({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})}const Cm={name:"popperOffsets",enabled:!0,phase:"read",fn:bm,data:{}};var Sm={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Tm(e){var t=e.x,n=e.y,r=window,i=r.devicePixelRatio||1;return{x:ln(t*i)/i||0,y:ln(n*i)/i||0}}function ia(e){var t,n=e.popper,r=e.popperRect,i=e.placement,o=e.variation,l=e.offsets,c=e.position,s=e.gpuAcceleration,u=e.adaptive,f=e.roundOffsets,a=e.isFixed,d=l.x,p=d===void 0?0:d,h=l.y,g=h===void 0?0:h,m=typeof f=="function"?f({x:p,y:g}):{x:p,y:g};p=m.x,g=m.y;var v=l.hasOwnProperty("x"),y=l.hasOwnProperty("y"),b=en,P=Rt,T=window;if(u){var w=Eo(n),R="clientHeight",I="clientWidth";if(w===Qe(n)&&(w=wt(n),bt(w).position!=="static"&&c==="absolute"&&(R="scrollHeight",I="scrollWidth")),w=w,i===Rt||(i===en||i===un)&&o===Qn){P=Ot;var j=a&&w===T&&T.visualViewport?T.visualViewport.height:w[R];g-=j-r.height,g*=s?1:-1}if(i===en||(i===Rt||i===Ot)&&o===Qn){b=un;var C=a&&w===T&&T.visualViewport?T.visualViewport.width:w[I];p-=C-r.width,p*=s?1:-1}}var H=Object.assign({position:c},u&&Sm),Z=f===!0?Tm({x:p,y:g}):{x:p,y:g};if(p=Z.x,g=Z.y,s){var ne;return Object.assign({},H,(ne={},ne[P]=y?"0":"",ne[b]=v?"0":"",ne.transform=(T.devicePixelRatio||1)<=1?"translate("+p+"px, "+g+"px)":"translate3d("+p+"px, "+g+"px, 0)",ne))}return Object.assign({},H,(t={},t[P]=y?g+"px":"",t[b]=v?p+"px":"",t.transform="",t))}function Em(e){var t=e.state,n=e.options,r=n.gpuAcceleration,i=r===void 0?!0:r,o=n.adaptive,l=o===void 0?!0:o,c=n.roundOffsets,s=c===void 0?!0:c,u={placement:Bt(t.placement),variation:Kn(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:i,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,ia(Object.assign({},u,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:l,roundOffsets:s})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,ia(Object.assign({},u,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:s})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const km={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Em,data:{}};function Rm(e){var t=e.state;Object.keys(t.elements).forEach(function(n){var r=t.styles[n]||{},i=t.attributes[n]||{},o=t.elements[n];!Ye(o)||!pt(o)||(Object.assign(o.style,r),Object.keys(i).forEach(function(l){var c=i[l];c===!1?o.removeAttribute(l):o.setAttribute(l,c===!0?"":c)}))})}function Pm(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach(function(r){var i=t.elements[r],o=t.attributes[r]||{},l=Object.keys(t.styles.hasOwnProperty(r)?t.styles[r]:n[r]),c=l.reduce(function(s,u){return s[u]="",s},{});!Ye(i)||!pt(i)||(Object.assign(i.style,c),Object.keys(o).forEach(function(s){i.removeAttribute(s)}))})}}const Om={name:"applyStyles",enabled:!0,phase:"write",fn:Rm,effect:Pm,requires:["computeStyles"]};var wm=[_m,Cm,km,Om],Dm=vm({defaultModifiers:wm}),Am={left:"right",right:"left",bottom:"top",top:"bottom"};function Ir(e){return e.replace(/left|right|bottom|top/g,function(t){return Am[t]})}var Im={start:"end",end:"start"};function oa(e){return e.replace(/start|end/g,function(t){return Im[t]})}function Mm(e,t){t===void 0&&(t={});var n=t,r=n.placement,i=n.boundary,o=n.rootBoundary,l=n.padding,c=n.flipVariations,s=n.allowedAutoPlacements,u=s===void 0?Wh:s,f=Kn(r),a=f?c?ea:ea.filter(function(h){return Kn(h)===f}):ni,d=a.filter(function(h){return u.indexOf(h)>=0});d.length===0&&(d=a);var p=d.reduce(function(h,g){return h[g]=$l(e,{placement:g,boundary:i,rootBoundary:o,padding:l})[Bt(g)],h},{});return Object.keys(p).sort(function(h,g){return p[h]-p[g]})}function Lm(e){if(Bt(e)===ko)return[];var t=Ir(e);return[oa(e),t,oa(t)]}function Nm(e){var t=e.state,n=e.options,r=e.name;if(!t.modifiersData[r]._skip){for(var i=n.mainAxis,o=i===void 0?!0:i,l=n.altAxis,c=l===void 0?!0:l,s=n.fallbackPlacements,u=n.padding,f=n.boundary,a=n.rootBoundary,d=n.altBoundary,p=n.flipVariations,h=p===void 0?!0:p,g=n.allowedAutoPlacements,m=t.options.placement,v=Bt(m),y=v===m,b=s||(y||!h?[Ir(m)]:Lm(m)),P=[m].concat(b).reduce(function(ce,Oe){return ce.concat(Bt(Oe)===ko?Mm(t,{placement:Oe,boundary:f,rootBoundary:a,padding:u,flipVariations:h,allowedAutoPlacements:g}):Oe)},[]),T=t.rects.reference,w=t.rects.popper,R=new Map,I=!0,j=P[0],C=0;C<P.length;C++){var H=P[C],Z=Bt(H),ne=Kn(H)===ri,ue=[Rt,Ot].indexOf(Z)>=0,_e=ue?"width":"height",$e=$l(t,{placement:H,boundary:f,rootBoundary:a,altBoundary:d,padding:u}),Ee=ue?ne?un:en:ne?Ot:Rt;T[_e]>w[_e]&&(Ee=Ir(Ee));var x=Ir(Ee),le=[];if(o&&le.push($e[Z]<=0),c&&le.push($e[Ee]<=0,$e[x]<=0),le.every(function(ce){return ce})){j=H,I=!1;break}R.set(H,le)}if(I)for(var Ve=h?3:1,me=function(Oe){var Ke=P.find(function(vn){var zt=R.get(vn);if(zt)return zt.slice(0,Oe).every(function(we){return we})});if(Ke)return j=Ke,"break"},rt=Ve;rt>0;rt--){var Ct=me(rt);if(Ct==="break")break}t.placement!==j&&(t.modifiersData[r]._skip=!0,t.placement=j,t.reset=!0)}}const Bm={name:"flip",enabled:!0,phase:"main",fn:Nm,requiresIfExists:["offset"],data:{_skip:!1}},Vl=pp.map(e=>document.getElementById(e+"_highlight")),Mr=document.querySelector("#gamepad-help-tooltip"),sa=document.querySelector("#gamepad-help-text"),Wl=document.querySelector("#select_button");var Zi=Wl,Mn=!1,Ln=!1;const ql=Dm({getBoundingClientRect:()=>Zi.getBoundingClientRect(),contextElement:document.body},Mr,{modifiers:[Bm],placement:"right",strategy:"fixed"});document.getElementById("too-many-gamepads-notice");document.getElementById("gamepad-container");document.getElementById("gamepad-connect-notice");var ct=!1;function Jl(){ct=!ct,ct?(document.body.classList.add("gamepad-help-open"),document.body.classList.remove("driving-now")):document.body.classList.remove("gamepad-help-open");let e=0;var t=()=>{ql.update(),e++,e<60&&requestAnimationFrame(t)};t()}document.querySelector("#gamepad-help-button").addEventListener("click",Jl);function jm(){alert("Gamepad interface not supported, please use a more modern browser.")}function Yt(e,t){ct?e?(Zi=e,sa.innerText=t,Mr.style.opacity="0.9"):Mr.style.opacity="0":t||(Zi=Wl,sa.innerText="Gamepad Help",Mr.style.opacity="0.8"),ql.update()}function Fm(e,t){e.forEach(function(r){var i=r.thumbStickElement,o=r.axisRange,l=r.xValue||0,c=r.yValue||0;i.style.transform=`rotateY(${-l*30}deg) rotateX(${c*30}deg) translate(${l*o}px,${c*o}px)`,ct&&(r.upIndicatorElement&&r.downIndicatorElement&&(Math.abs(l)<t?c<-t?(r.upIndicatorElement.style.opacity=Math.max(-c,0),r.downIndicatorElement.style.opacity=0,Yt(r.upIndicatorElement,r.upHelpText||"None")):c>t?(r.upIndicatorElement.style.opacity=0,r.downIndicatorElement.style.opacity=Math.max(c,0),Yt(r.downIndicatorElement,r.downHelpText||"None")):(r.upIndicatorElement.style.opacity=0,r.downIndicatorElement.style.opacity=0):(r.upIndicatorElement.style.opacity=0,r.downIndicatorElement.style.opacity=0)),r.leftIndicatorElement&&r.rightIndicatorElement&&(Math.abs(c)<t?l<-t?(r.leftIndicatorElement.style.opacity=Math.max(-l,0),r.rightIndicatorElement.style.opacity=0,Yt(r.leftIndicatorElement,r.leftHelpText||"None")):l>t?(r.leftIndicatorElement.style.opacity=0,r.rightIndicatorElement.style.opacity=Math.max(l,0),Yt(r.rightIndicatorElement,r.rightHelpText||"None")):(r.leftIndicatorElement.style.opacity=0,r.rightIndicatorElement.style.opacity=0):(r.leftIndicatorElement.style.opacity=0,r.rightIndicatorElement.style.opacity=0)))});let n=e.reduce((r,i)=>r+Math.abs(i.xValue)+Math.abs(i.yValue)>.05?1:0,0);!ct&&n>0&&Mn==!1?(Mn=!0,Yr()):Mn==!0&&n==0&&(Mn=!1,Yr())}function Yr(){!ct&&(Mn||Ln)?document.body.classList.add("driving-now"):document.body.classList.remove("driving-now")}function Gm(e,t){var n=t[e],r=Vl[e];!n||!r||(n.touched?r.classList.add(ds):r.classList.remove(ds),n.pressed?r.classList.add(ps):r.classList.remove(ps))}function xm(e){let t=0;for(var n=0;n<e.length;n++)Gm(n,e),t+=e[n].pressed?1:0;!ct&&t>0&&Ln==!1?(Ln=!0,Yr()):Ln==!0&&(Ln=!1,Yr())}function Um(){return Vl}class zm{constructor(t,n){this.updateDelay=n||100,this.buttonConfig=t,this.lastStateOfGamepads=[],this.changeMaskOfGamepads=[],this.gamepadConnectCallback=null,this.gamepadDisconnectCallback=null,this.gamepadButtonChangeCallback=null,this.gamepadAxisChangeCallback=null,this.extraGamepadMappings=[],navigator.gamepadInputEmulation="gamepad",window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,navigator.getGamepads=navigator.getGamepads||navigator.webkitGetGamepads||navigator.mozGetGamepads||navigator.msGetGamepads,this.gamepadApiSupported()&&this.tickLoop()}gamepadApiSupported(){return!!navigator.getGamepads&&!!navigator.getGamepads()}set buttonsConfig(t){this.buttonConfig=t}set onGamepadConnect(t){this.gamepadConnectCallback=t,window.addEventListener("gamepadconnected",this.gamepadConnectCallback,!0)}set onGamepadDisconnect(t){this.gamepadDisconnectCallback=t,window.addEventListener("gamepaddisconnected",this.gamepadDisconnectCallback,!0)}set onGamepadAxisChange(t){this.gamepadAxisChangeCallback=t}set onGamepadButtonChange(t){this.gamepadButtonChangeCallback=t}addGamepadMapping(t){this.extraGamepadMappings.push(t)}tickLoop(){this.checkForGamepadChanges(),requestAnimationFrame(this.tickLoop.bind(this))}checkForGamepadChanges(){let t=navigator.getGamepads();for(var n=0;n<t.length;n++){let r=t[n];!r||(this.lastStateOfGamepads[n]||(this.lastStateOfGamepads[n]=r),this.checkForAxisChanges(n,r),this.checkForButtonChanges(n,r),this.lastStateOfGamepads[n]=r)}}checkForAxisChanges(t,n){let r=n.axes;if(r.length==0)return;let o=this.lastStateOfGamepads[t].axes,l=[],c,s;for(c=0;c<r.length;c++){let u=r[c]||0,f=o[c]||0;u!=f?(l[c]=!0,s=!0):l[c]=!1}s&&this.gamepadAxisChangeCallback&&this.gamepadAxisChangeCallback(t,n,l)}checkForButtonChanges(t,n){let r=n.buttons,o=this.lastStateOfGamepads[t].buttons,l=[],c,s=!1;for(c=0;c<r.length;c++){let u=r[c]||{pressed:!1,value:0,touched:!1},f=o[c]||{pressed:!1,value:0,touched:!1},a=this.buttonConfig[c]||{},d={};u.touched&&!f.touched?(d.touchDown=!0,s=!0):!u.touched&&f.touched&&(d.touchUp=!0,s=!0),u.pressed&&!f.pressed?(d.pressed=!0,s=!0):!u.pressed&&f.pressed&&(d.released=!0,s=!0),a&&a.holdAllowed&&u.pressed&&f.pressed&&(d.heldDown=!0,s=!0),u.value!=f.value&&(d.valueChanged=!0,s=!0);const p=Object.keys(d).length>0;l[c]=p?d:!1}s&&this.gamepadButtonChangeCallback&&this.gamepadButtonChangeCallback(t,n,l)}}class Hm{constructor(){this.touchedGpadButtonCount=0,this.buttonHighlightElements=Um(),mi.monkeyPatchGetGamepads();const t=new zm(fs);t||jm(),t.onGamepadConnect=this.gamepadConnectDisconnectHandler.bind(this),t.onGamepadDisconnect=this.gamepadConnectDisconnectHandler.bind(this),t.onGamepadAxisChange=this.handleAxisChange.bind(this),t.onGamepadButtonChange=this.handleButtonChange.bind(this),mi.registerOnScreenGamepadButtonEvents(0,this.buttonHighlightElements.map(n=>n.id.startsWith("shoulder_trigger")?null:n)),mi.registerOnScreenGamepadAxisEvents(0,[{horizontalGpadAction:{type:"axis",index:0},verticalGpadAction:{type:"axis",index:1},elem:document.getElementById("gamepad-joystick-touch-area-left")},{horizontalGpadAction:{type:"axis",index:2},verticalGpadAction:{type:"axis",index:3},elem:document.getElementById("gamepad-joystick-touch-area-right")},{verticalGpadAction:{type:"button",index:3},elem:document.getElementById("shoulder_trigger_back_right_highlight")},{verticalGpadAction:{type:"button",index:4},elem:document.getElementById("shoulder_trigger_back_left_highlight")}])}gamepadConnectDisconnectHandler(){const t=navigator.getGamepads();var n=t.reduce((r,i)=>i?r+1:r,0);n!=0&&t[0].emulated&&(n-=1),n>1&&console.log("WARNING: More than one gamepad connected!",t)}setupExternalEventListenerCallbacks(t,n){this.onButtonChange=t,this.onAxisChange=n}clearExternalEventListenerCallbacks(){this.onButtonChange=null,this.onAxisChange=null}handleButtonChange(t,n,r){if(t!=0||!n||!n.buttons)return;this.onButtonChange&&!ct&&this.onButtonChange(n,r),xm(n.buttons),(r[8]&&r[8].released||r[9]&&r[9].released)&&Jl();let i=!0;for(let o=0;o<r.length;o++)r[o]&&r[o].touchDown?(Yt(this.buttonHighlightElements[o],fs[o].helpLabel),i=!1):n.buttons[o]&&n.buttons[o].touched&&(i=!1);i&&Yt(null,"Gamepad Help")}handleAxisChange(t,n){if(t!=0||!n||!n.axes)return;this.onAxisChange&&!ct&&this.onAxisChange(n);const r=[{axisRange:14,xValue:n.axes[0]||0,yValue:n.axes[1]||0,thumbStickElement:document.getElementById("stick_left"),upIndicatorElement:document.getElementById("l_stick_up_direction_highlight"),downIndicatorElement:document.getElementById("l_stick_down_direction_highlight"),leftIndicatorElement:document.getElementById("l_stick_left_direction_highlight"),rightIndicatorElement:document.getElementById("l_stick_right_direction_highlight"),upHelpText:"Forward",downHelpText:"Back",leftHelpText:"Turn Left",rightHelpText:"Turn Right"},{axisRange:14,xValue:n.axes[2]||0,yValue:n.axes[3]||0,thumbStickElement:document.getElementById("stick_right"),upIndicatorElement:document.getElementById("r_stick_up_direction_highlight"),downIndicatorElement:document.getElementById("r_stick_down_direction_highlight"),leftIndicatorElement:document.getElementById("r_stick_left_direction_highlight"),rightIndicatorElement:document.getElementById("r_stick_right_direction_highlight"),upHelpText:"Up",downHelpText:"Down",leftHelpText:"Strafe Left",rightHelpText:"Strafe Right"}];Fm(r,.4)}}let Sr;const $m=new Uint8Array(16);function Vm(){if(!Sr&&(Sr=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Sr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Sr($m)}const Ae=[];for(let e=0;e<256;++e)Ae.push((e+256).toString(16).slice(1));function Wm(e,t=0){return(Ae[e[t+0]]+Ae[e[t+1]]+Ae[e[t+2]]+Ae[e[t+3]]+"-"+Ae[e[t+4]]+Ae[e[t+5]]+"-"+Ae[e[t+6]]+Ae[e[t+7]]+"-"+Ae[e[t+8]]+Ae[e[t+9]]+"-"+Ae[e[t+10]]+Ae[e[t+11]]+Ae[e[t+12]]+Ae[e[t+13]]+Ae[e[t+14]]+Ae[e[t+15]]).toLowerCase()}const qm=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),aa={randomUUID:qm};function Jm(e,t,n){if(aa.randomUUID&&!t&&!e)return aa.randomUUID();e=e||{};const r=e.random||(e.rng||Vm)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){n=n||0;for(let i=0;i<16;++i)t[n+i]=r[i];return t}return Wm(r)}let la=NaN;const be=class{static handlePasswordChallenge(t){Lp("Please enter the driver password",n=>{if(n){const r={cid:t,action:"password_attempt",val:n};be.sendRovMessage(r,null)}else delete be.replyContinuityCallbacks[t]})}static handleReplyMsgRecived(t,n){const r=t.status,i=t.val,o=be.replyContinuityCallbacks[n].callback;if(r=="error")console.warn("Rov Action Error: "+i),ge(i);else if(r=="pong"){console.log("Ping->Pong received"),la=Date.now();const l=la-Number.parseFloat(i);$p(l)}else if(r=="done")o?o(t):ge(be.replyContinuityCallbacks[n].originalMsgData.action+": OK");else if(r=="password-required")o&&o(t),be.handlePasswordChallenge(n);else if(r=="password-invalid")o&&o(t),ge("Invalid password"),o&&o(t),be.handlePasswordChallenge(n);else if(r=="password-accepted"){ge("Password accepted"),o&&o(t);const l=be.replyContinuityCallbacks[n].original_msg;console.log("originalMsgData: ",l),be.sendRovMessage(l,null)}else o&&o(t)}static handleDriverChange(t){let n=ye.connManager.getThisPeerId();t==n?(ge("You are now the driver"),zi(!0),ms.set(!0)):(ge("ROV Driver is now "+t),zi(!1),ms.set(!1))}static handleBroadcastMsgRecived(t){const n=t.status,r=t.val;n=="error"?console.error("Rov Error: "+r):n=="sensor-update"?qp(r):n=="driver-changed"&&be.handleDriverChange(r)}static handleRecivedMessage(t){console.info("Msg recived: "+t);const n=JSON.parse(t),r=n.cid;r&&r in be.replyContinuityCallbacks?be.handleReplyMsgRecived(n,r):be.handleBroadcastMsgRecived(n)}static startPingLoop(){setInterval(()=>{be.sendRovMessage({action:"ping",val:Date.now()},null)},1e3)}};let Ge=be;F(Ge,"replyContinuityCallbacks",{}),F(Ge,"sendMessageCallback",null),F(Ge,"setSendMessageCallback",t=>{be.sendMessageCallback=t}),F(Ge,"sendRovMessage",(t,n)=>{let r=t.cid;r||(r=t.cid=Jm().substring(0,8)),be.replyContinuityCallbacks[r]||(be.replyContinuityCallbacks[r]={original_msg:t}),n&&(be.replyContinuityCallbacks[r].callback=n);const i=JSON.stringify(t);be.sendMessageCallback&&be.sendMessageCallback(i)});const Ym=e=>{function t(i){r&&r.send(i)}const n=ir({context:{peerServerConfig:{},rovIpAddr:null},predictableActionArguments:!0,preserveActionOrder:!0,id:"siteInit",initial:"Checking_Internet_Access",states:{Checking_Internet_Access:{entry:"checkInternetAvailable",on:{URL_IS_ROV_IP:{actions:["setLocalPeerServerConfig","showHttpGamepadSupportDisabledAlert"],target:"#siteInit.Site_Ready"},INTERNET_AVAILABLE:{actions:"setCloudPeerServerConfig",target:"#siteInit.Site_Ready"},INTERNET_OFFLINE:{actions:["showIpScanButton","hideLoadingUi"],target:"#siteInit.Waiting_For_User_Scan_Button_Press"}}},Waiting_For_User_Scan_Button_Press:{entry:"setupWaitForUserScanButtonPress",on:{SCAN_BUTTON_CLICKED:{actions:["showIpScanningUi","hideIpScanButton"],target:"#siteInit.Scanning_For_ROV_IP"}}},Scanning_For_ROV_IP:{entry:"scanForRovIP",on:{ROV_IP_FOUND:{actions:"setRovIpAddr",target:"#siteInit.Redirect_Browser_To_ROV_IP"},IP_SCANNING_ERROR:{actions:["showIpScanButton","hideLoadingUi"],target:"#siteInit.Waiting_For_User_Scan_Button_Press"}}},Redirect_Browser_To_ROV_IP:{entry:"redirectBrowserToRovIp"},Site_Ready:{entry:"siteReady",type:"final"}}},{actions:{setCloudPeerServerConfig:()=>{hs.set(Hr)},setLocalPeerServerConfig:()=>{hs.set(dp)},setRovIpAddr:(i,o)=>{hp.set(o.data)},showIpScanButton:()=>{ge("Click scan to find the ROV locally."),ge("No internet connection."),Ts()},hideIpScanButton:()=>{xp()},hideLoadingUi:()=>{ze("ip-scan"),ze("internet-check")},showIpScanningUi:()=>{vt("ip-scan")},redirectBrowserToRovIp:(i,o)=>{window.location.href=`http://${o.data}`},siteReady:()=>{e("SITE_READY")},checkInternetAvailable:()=>{vt("internet-check");const i=Hr;wp((i.secure?"https://":"http://")+i.host+":"+i.port).then(o=>{if(o)t("INTERNET_AVAILABLE");else{const l=window.location.host.split(".");l.length==4&&!isNaN(Number(l[3]))||l.length==2&&l[1]=="local"?t("URL_IS_ROV_IP"):t("INTERNET_OFFLINE")}})},setupWaitForUserScanButtonPress:()=>{Ts();const i=()=>{t("SCAN_BUTTON_CLICKED")},o=document.getElementById("scan_for_ip_btn");return o.addEventListener("click",i),()=>{o.removeEventListener("click",i)}},scanForRovIP:()=>{vt("ip-scan")}},guards:{}}),r=mn(n,{devTools:lt(sn)}).start();return r},We=class{static sendActionAndWaitForDone(t,n){let r="";Ge.sendRovMessage(t,i=>{r+=(i.val||"")+`
`;const l=i.status;l&&n&&(l=="done"?n(r):l=="error"&&n("Error: "+r))})}static startPingMessageSenderLoop(){const t=setInterval(()=>{},2e3);return()=>{clearInterval(t)}}static showCommandOutputPopup(t,n,r){let i=Np(t);return i(n),o=>{let l=o.status;l=="password-required"||l=="password-invalid"||l=="password-accepted"||l=="token-accepted"||(l=="error"?i(`
Error:
`+o.val):o.val?i(o.val):o.status=="done"&&i(r))}}static connectToRov(){ye.connManager&&ye.connManager.connectToCurrentTargetRov()}static disconnectFromRov(){ye.connManager&&ye.connManager.disconnectFromCurrentRov()}static switchToNextRovPeerId(){an.update(t=>(t++,localStorage.setItem("rovPeerIdEndNumber",t.toString()),t)),Gi(),We.disconnectFromRov()}static switchToPrevRovPeerId(){an.update(t=>(t=Math.max(t-1,0),localStorage.setItem("rovPeerIdEndNumber",t.toString()),t)),Gi(),We.disconnectFromRov()}static takeControl(){Ge.sendRovMessage({action:Nt.take_control},null)}static moveRov(t,n){Ge.sendRovMessage({action:Nt.move,val:{thrustVector:t,turnRate:n}},null)}static toggleLights(){Ge.sendRovMessage({action:Nt.toogle_lights},null)}};let Je=We;F(Je,"shutdownRov",()=>{vr("Are you sure you want to shutdown the ROV?",t=>{ge("Sending Shutdown Request..."),We.sendActionAndWaitForDone({action:"shutdown_rov"},n=>{ge("Please wait 20 seconds before unplugging"),ge("ROV:"+n),We.disconnectFromRov()})})}),F(Je,"rebootRov",()=>{vr("Are you sure you want to reboot the ROV?",t=>{ge("Sending Reboot Request..."),We.sendActionAndWaitForDone({action:"reboot_rov"},n=>{ge("Press Connect again in about 30 seconds"),ge("ROV:"+n),We.disconnectFromRov()})})}),F(Je,"restartRovServices",()=>{vr("Are you sure you want to restart services? - The ROV will stop responding for about a minute and then you can re-connect.",()=>{let t=We.showCommandOutputPopup("Restarting ROV Services",`Sending Service Restart Request (Please Wait)...
`,`

Done.`);Ge.sendRovMessage({action:"restart_rov_services"},t)})}),F(Je,"getRovStatusReport",()=>{let t=We.showCommandOutputPopup("ROV Status Report",`Sending Status Request (Please Wait)...
`,`

Done.`);Ge.sendRovMessage({action:"rov_status_report"},t)}),F(Je,"getRovLogs",()=>{let t=We.showCommandOutputPopup("ROV Logs",`Sending Request (Please Wait)...
`,`

Done.`);Ge.sendRovMessage({action:"rov_logs"},t)}),F(Je,"enableRovWifi",()=>{ge("Sending Enable Wifi Command..."),We.sendActionAndWaitForDone({action:"enable_wifi"},t=>{ge("Wifi Enabled! "+t)})}),F(Je,"disableRovWifi",()=>{vr("Are you sure you want to disable rov wifi? If the ROV is connected via wifi, don't do this!",()=>{ge("Sending Disable Wifi Command..."),We.sendActionAndWaitForDone({action:"disable_wifi"},t=>{ge("Wifi Disabled! "+t)})})});window.RovActions=Je;function Xm(e){let t,n,r,i,o;return n=new kp({}),i=new Xu({props:{options:{reversed:!0,intro:{y:192},pausable:!0,classes:["toast-msg"]}}}),{c(){t=N("main"),oe(n.$$.fragment),r=ke(),oe(i.$$.fragment)},m(l,c){O(l,t,c),re(n,t,null),ot(t,r),re(i,t,null),o=!0},p:he,i(l){o||(S(n.$$.fragment,l),S(i.$$.fragment,l),o=!0)},o(l){E(n.$$.fragment,l),E(i.$$.fragment,l),o=!1},d(l){l&&k(t),ie(n),ie(i)}}}function Qm(e){sn.set(!!Pp("debug")),an.set(parseInt(localStorage.getItem("rovPeerIdEndNumber")||"0")),ye.gpadCtrl=new Hm,Zt.set(localStorage.getItem("ourPeerId")||null),Zt.subscribe(r=>{localStorage.setItem("ourPeerId",r),zp(r)}),console.log(ye.gpadCtrl),lt(sn)&&ju({iframe:!1});let t=!0;On.subscribe(r=>{if(t){t=!1;return}console.log("peerServerConnState: ",r),r==G.connecting?vt("server-connecting"):r==G.reconnecting?ze("server-reconnecting"):r==G.disconnected?(ze("server-connecting"),ze("server-reconnecting"),Cs()):r==G.connected&&(ze("server-connecting"),ze("server-reconnecting"))}),Bi.subscribe(r=>{console.log("rovVideoStreamConnState: ",r),r==G.connecting?(vt("awaiting-video-call"),Ui()):r==G.reconnecting?(vt("awaiting-video-call"),Es()):r==G.disconnected?(ze("awaiting-video-call"),Ui()):r==G.connected&&(ze("awaiting-video-call"),Es())});let n=!0;return Ni.subscribe(r=>{if(n){n=!1;return}console.log("rovDataChannelConnState: ",r,ye.gpadCtrl),ye.gpadCtrl.clearExternalEventListenerCallbacks(),r==G.connecting?Ss(ye.connManager&&ye.connManager.currentTargetRovId):r==G.reconnecting?(vt("webrtc-reconnecting"),Ss(ye.connManager&&ye.connManager.currentTargetRovId),vt("webrtc-connecting")):r==G.disconnected?(Cs(),ze("webrtc-reconnecting"),ze("webrtc-connecting")):r==G.connected&&(jp(),ge("Connected to ROV!",1e3),ye.gpadCtrl.setupExternalEventListenerCallbacks((i,o)=>{},i=>{var{thrustVector:o,turnRate:l}=Mp(i.axes);Je.moveRov(o,l)}))}),tr(()=>{Ym(r=>{ze("internet-check");let i=ye.msgHandler=Ge,o=ye.connManager=new Nh(Ge.handleRecivedMessage);i.setSendMessageCallback(o.sendMessageToCurrentRov.bind(o)),o.start(),i.startPingLoop(),Gi(),Fp(Je.connectToRov),Gp(Je.disconnectFromRov)})}),Mt(()=>{console.log("cleaning up"),ye.connManager&&ye.connManager.cleanup()}),[]}class Km extends Pe{constructor(t){super(),Re(this,t,Qm,Xm,Te,{})}}new Km({target:document.getElementById("app")});
