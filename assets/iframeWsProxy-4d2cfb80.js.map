{"version":3,"file":"iframeWsProxy-4d2cfb80.js","sources":["../../shared/js/libraries/websocketHook/wsHook.ts","../../shared/js/iframeWsProxy/iframeWsProxy.ts"],"sourcesContent":["/* eslint-disable no-proto */\n/* eslint-disable accessor-pairs */\n/* eslint-disable no-global-assign */\n\n/* wsHook.js\n * https://github.com/skepticfx/wshook\n * Reference: http://www.w3.org/TR/2011/WD-websockets-20110419/#websocket\n */\n\ndeclare global {\n  interface MessageEvent {\n    path?: string[];\n    parts?: string[];\n    __proto__: MessageEvent\n  }\n  interface WebSocket {\n    _onopen?: (ev?: Event) => void;\n    _onerror?: (ev?: Event) => void;\n    _onclose?: (ev?: CloseEvent) => void;\n    _onmessage?: (ev?: MessageEvent) => void;\n    _addEventListener?: <K extends keyof WebSocketEventMap>(type: K, listener: (this: WebSocket, ev: WebSocketEventMap[K]) => any, options?: boolean | AddEventListenerOptions) => void;\n    _readyState: number;\n    isReal?: boolean;\n  }\n}\n\ntype socketMsgDataTypes = string | ArrayBufferLike | Blob | ArrayBufferView\n\n// Mutable MessageEvent.\n// Subclasses MessageEvent and makes data, origin and other MessageEvent properites mutatble.\nexport interface MutableMessageEvent<T = any> extends MessageEvent<T> {\n  bubbles: boolean;\n  cancelBubble: boolean;\n  cancelable: boolean;\n  currentTarget: EventTarget | null;\n  data: T;\n  defaultPrevented: boolean;\n  eventPhase: number;\n  lastEventId: string;\n  origin: string;\n  path: string[];\n  ports: MessagePort[];\n  returnValue: boolean;\n  source: MessageEventSource | null;\n  srcElement: EventTarget | null;\n  target: EventTarget | null;\n  timeStamp: number;\n  type: string;\n}\n\nconst MakeMutableMessageEvent = (ev: MessageEvent) => {\n  return {\n    ...ev,\n    bubbles: ev.bubbles || false,\n    cancelBubble: ev.cancelBubble || false,\n    cancelable: ev.cancelable || false,\n    currentTarget: ev.currentTarget || null,\n    data: ev.data,\n    defaultPrevented: ev.defaultPrevented || false,\n    eventPhase: ev.eventPhase || 0,\n    lastEventId: ev.lastEventId || '',\n    origin: ev.origin || '',\n    path: ev.path || new Array(0),\n    ports: ev.parts || new Array(0),\n    returnValue: ev.returnValue || true,\n    source: ev.source || null,\n    srcElement: ev.srcElement || null,\n    target: ev.target || null,\n    timeStamp: ev.timeStamp || -1,\n    type: ev.type || 'message',\n    initMessageEvent: ev.initMessageEvent || null,\n    __proto__: ev.__proto__,// || MessageEvent.__proto__\n  } as MutableMessageEvent\n}\n\nconst wsHook = {\n  triggerOnOpen: (wsObject: WebSocket, ev?: Event) => {\n    ev = ev || new Event(\"open\", { composed: false, bubbles: false, cancelable: false })\n    wsObject._readyState = 1;\n    if (wsObject._onopen) wsObject._onopen(ev);\n    // wsObject.dispatchEvent(ev)\n  },\n  triggerOnError: (wsObject: WebSocket, ev?: Event) => {\n    ev = ev || new Event(\"error\", { composed: false, bubbles: false, cancelable: false })\n    wsObject._readyState = 3;\n    if (wsObject._onerror) wsObject._onerror(ev);\n  },\n  triggerOnClose: (wsObject: WebSocket, ev?: CloseEvent) => {\n    ev = ev || new CloseEvent(\"close\", { wasClean: true, reason: \"wsHook\", composed: false, bubbles: false, cancelable: false, code: 1006 })\n    wsObject._readyState = 3;\n    if (wsObject._onclose) wsObject._onclose(ev);\n  },\n  triggerOnMessage: (wsObject: WebSocket, data: socketMsgDataTypes) => {\n    // @ts-ignore\n    if (!(typeof data === typeof '' || data instanceof ArrayBuffer)) data = (data as Uint8Array).buffer;\n    console.log(\"triggerOnMessage\", data, wsObject);\n    const ev = new MessageEvent(\"mesage\", { data: data, origin: wsObject.url, bubbles: false, cancelable: false, composed: false })\n    if (wsObject._onmessage) wsObject._onmessage(ev);\n  },\n  /**\n   * Whenever the a \"new WebSocket()\" call is made, wsHook.allowNewSocket will get called with the url of the new websocket\n   * @param url: the url passed to the new WebSocket() constructor\n   * @returns Return true to allow the default websocket behavior. Return false to create a mock WebSocket that never hits the network but can still be controlled with wsHook.trigger* calls.\n   */\n  allowNewSocket: (url: string): boolean => {\n    return true;\n  },\n  modifyUrl: (url: string | URL) => {\n    return url\n  },\n  afterInit: (wsObject: WebSocket): WebSocket => {\n    return wsObject;\n  },\n  beforeOpen: (ev: Event, url: string, wsObject: WebSocket): Event | null => {\n    return ev;\n  },\n  beforeError: (ev: Event, url: string, wsObject: WebSocket): Event | null => {\n    return ev;\n  },\n  beforeClose: (ev: CloseEvent, url: string, wsObject: WebSocket): CloseEvent | null => {\n    return ev;\n  },\n  beforeSend: (data: socketMsgDataTypes, url: string, wsObject: WebSocket): socketMsgDataTypes | null => {\n    return data;\n  },\n  afterRecive: (ev: MessageEvent, url: string, wsObject: WebSocket): MessageEvent | MutableMessageEvent | null => {\n    return ev;\n  },\n  resetHooks: () => { }\n};\n\n/*\n!!! CALL hookWebsockets() BEFORE ANY WEBSOCKETS GET CREATED !!!\nRewrites the native websocket object to intercept messages and\nallow external triggers through wsHook\n*/\nlet monkeyPatchDone = false;\nexport function hookWebsockets() {\n\n  // prevent double patching\n  if (monkeyPatchDone) {\n    console.warn(\"hookWebsockets() can only be called once!\");\n    return wsHook;\n  }\n  monkeyPatchDone = true;\n\n  // setup WSHook default functions\n  const defaultWSHooks = Object.assign({}, wsHook) // make a copy of the default functions\n  wsHook.resetHooks = function () {\n    Object.assign(wsHook, defaultWSHooks)\n  }\n\n  // Save the native websocket object:\n  const _WS = WebSocket\n\n  // @ts-ignore // Overwrite the native websocket:\n  WebSocket = Object.assign(function (url: string | URL, protocols?: string | string[] | undefined): WebSocket {\n    const allowRealSocket = wsHook.allowNewSocket(url.toString())\n    url = wsHook.modifyUrl(url) || url\n    let WSObject: WebSocket;\n    if (allowRealSocket) {\n      WSObject = protocols ? new _WS(url, protocols) : new _WS(url);\n      WSObject.isReal = true;\n    } else {\n      // @ts-ignore\n      WSObject = Object.assign({}, _WS);\n      Object.defineProperty(WSObject, 'url', { get() { return url } })\n      Object.defineProperty(WSObject, 'protocols', { get() { return protocols } })\n      Object.defineProperty(WSObject, 'readyState', { get() { return this._readyState } })\n      Object.defineProperty(WSObject, 'close', { value: () => { return wsHook.triggerOnClose(this) } })\n      Object.defineProperty(WSObject, 'isReal', { value: false })\n      Object.defineProperty(WSObject, '_readyState', { value: 0, writable: true })\n    }\n\n    // Hook the websocket send function\n    let _send = WSObject.send\n    WSObject.send = function (data) {\n      console.log(\"hook send\")\n      arguments[0] = wsHook.beforeSend(data, WSObject.url, this) || null;\n      if (arguments[0] == null) return;\n      _send.apply(this, arguments)\n    }\n\n    // Events needs to be proxied and bubbled down.\n    WSObject._onopen = undefined;\n    WSObject._onerror = undefined;\n    WSObject._addEventListener = WSObject.addEventListener || function () { };\n    WSObject.addEventListener = function () {\n      const eventThis = this\n      const eventName = arguments[0];\n      const userFunc = arguments[1];\n\n      if (eventName === 'message') {\n        WSObject._onmessage = userFunc\n        arguments[1] = (function (userFunc) {\n          return function () {\n            arguments[0] = wsHook.afterRecive(MakeMutableMessageEvent(arguments[0]), WSObject.url, WSObject)\n            if (arguments[0] === null) return\n            userFunc.apply(eventThis, arguments)\n          }\n        })(userFunc)\n      } else if (eventName === 'open') {\n        WSObject._onopen = userFunc\n        arguments[1] = (function (userFunc) {\n          return function () {\n            arguments[0] = wsHook.beforeOpen(arguments[0], WSObject.url, WSObject)\n            if (arguments[0] === null) return\n            userFunc.apply(eventThis, arguments)\n          }\n        })(userFunc)\n      } else if (eventName === 'error') {\n        WSObject._onerror = userFunc\n        arguments[1] = (function (userFunc) {\n          return function () {\n            arguments[0] = wsHook.beforeError(arguments[0], WSObject.url, WSObject)\n            if (arguments[0] === null) return\n            userFunc.apply(eventThis, arguments)\n          }\n        })(userFunc)\n      } else if (eventName === 'close') {\n        WSObject._onclose = userFunc\n        arguments[1] = (function (userFunc) {\n          return function () {\n            arguments[0] = wsHook.beforeClose(arguments[0], WSObject.url, WSObject)\n            if (arguments[0] === null) return\n            userFunc.apply(eventThis, arguments)\n          }\n        })(userFunc)\n      }\n      return WSObject._addEventListener?.apply(this, arguments)\n    }\n\n    Object.defineProperty(WSObject, 'onmessage', {\n      'set': function () {\n        let eventThis = this\n        let userFunc = arguments[0]\n        WSObject._onmessage = userFunc\n        let onMessageHandler = userFunc ? function () {\n          if (!WSObject.isReal) console.log('onMessageHandler', arguments)\n          arguments[0] = wsHook.afterRecive(MakeMutableMessageEvent(arguments[0]), WSObject.url, WSObject)\n          if (arguments[0] === null) return\n          userFunc.apply(eventThis, arguments)\n        } : null;\n\n        console.log('onMsgHandler', arguments)\n        WSObject._addEventListener?.apply(this, ['message', onMessageHandler, false])\n      }\n    })\n\n    Object.defineProperty(WSObject, 'onopen', {\n      'set': function () {\n        let eventThis = this\n        let userFunc = arguments[0]\n        WSObject._onopen = userFunc\n        let onOpenHandler = userFunc ? function () {\n          if (!WSObject.isReal) console.log('onOpenHandler', arguments)\n          arguments[0] = wsHook.beforeOpen(arguments[0], WSObject.url, WSObject)\n          if (arguments[0] === null) return\n          userFunc.apply(eventThis, arguments)\n        } : null;\n        console.log('onOpenHandler', arguments)\n        WSObject._addEventListener?.apply(this, ['open', onOpenHandler, false])\n      }\n    })\n\n    Object.defineProperty(WSObject, 'onerror', {\n      'set': function () {\n        let eventThis = this\n        let userFunc = arguments[0]\n        WSObject._onerror = userFunc\n        let onErrorHandler = userFunc ? function () {\n          if (!WSObject.isReal) console.log('onErrorHandler', arguments)\n          arguments[0] = wsHook.beforeError(arguments[0], WSObject.url, WSObject)\n          if (arguments[0] === null) return\n          userFunc.apply(eventThis, arguments)\n        } : null\n        WSObject._addEventListener?.apply(this, ['error', onErrorHandler, false])\n      }\n    })\n\n    Object.defineProperty(WSObject, 'onclose', {\n      'set': function () {\n        let eventThis = this\n        let userFunc = arguments[0]\n        WSObject._onclose = userFunc\n        let onCloseHandler = userFunc ? function () {\n          if (!WSObject.isReal) console.log('onCloseHandler', arguments)\n          arguments[0] = wsHook.beforeClose(arguments[0], WSObject.url, WSObject)\n          if (arguments[0] === null) return\n          userFunc.apply(eventThis, arguments)\n        } : null\n        WSObject._addEventListener?.apply(this, ['close', onCloseHandler, false])\n      }\n    })\n\n    wsHook.afterInit(WSObject);\n    WSObject._readyState = _WS.OPEN;\n    return WSObject\n  }, _WS);\n\n  // Return the wsHook object to allow users to alter the hooks behaviour.\n  return wsHook;\n};\nexport default hookWebsockets;\n","// https://stackoverflow.com/questions/61865890/run-websocket-in-web-worker-or-service-worker-javascript\n// https://github.com/skepticfx/wshook\n// https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Transferable_objects\n// Some Ideas\n\nimport { DECODE_TXT, ENCODE_TXT, PROXY_PREFIX } from \"../consts\";\nimport hookWebsockets from \"../libraries/websocketHook/wsHook\";\n\nexport enum proxyMessageTypes {\n    openWebsocket,\n    socketMsg,\n    outgoingHttpReq,\n    incomingHttpReq,\n}\n\nexport type proxyInterchangeFormat = {\n    type: proxyMessageTypes;\n    url: string;\n    body: number[]; // binary data\n    result: object; // for fetch response\n}\n\nexport function enableIframeWebsocketProxying() {\n    if (!window.parent || window.parent === window) return console.warn(\"enableFrameProxy() called without this page being inside an iframe!\")\n\n    // const origin = window.parent.location.protocol.replace(\":\", \"\") + \"://\" + window.parent.location.host;\n    const receiveProxiedMsg = startWebsocketProxying((url: string) => true, (data) => {\n        window.parent.postMessage(data, \"*\")\n    })\n    window.addEventListener('message', (msg) => {\n        // if (msg.origin === origin) { // security check\n        console.log(\"Got iframe parent message\", msg)\n        receiveProxiedMsg(msg.data)\n        // }\n    })\n}\n\nfunction startWebsocketProxying(isProxiedUrl: (url: string) => boolean, sendProxyMessageCallback: (data: ArrayBufferLike) => void) {\n    const proxiedWsObjects: { [key: string]: WebSocket } = {};\n\n    // Monkey Patch the native websocket object\n    const wsHook = hookWebsockets();\n\n    wsHook.allowNewSocket = (url) => {\n        console.log(\"Checking ws url: \", url)\n        if (isProxiedUrl(url)) {\n            console.log(\"Proxying ws url: \", url)\n            return false;\n        } else return true;\n    };\n\n    wsHook.modifyUrl = (url: string | URL) => {\n        url = url.toString();\n        if (isProxiedUrl(url)) url = url.substring(PROXY_PREFIX.length)\n        console.log(\"modifyUrl: \", url)\n        return url\n    };\n\n\n    wsHook.afterInit = (wsObject) => {\n        const url = wsObject.url;\n        if (!wsObject.isReal) {\n            proxiedWsObjects[url] = wsObject;\n            setTimeout(() => {\n                wsHook.triggerOnOpen(wsObject);\n                sendNewConnMsgThruProxy(url);\n            }, 1)\n        }\n        return wsObject;\n    };\n\n    wsHook.beforeSend = (data, url, wsObject) => {\n        if (wsObject.isReal) {\n            return data;\n        } else {\n            console.log(\"beforeSend: \", wsObject.isReal, wsObject.url, data)\n            sendDataThruProxy(url, new Uint8Array(data as ArrayBuffer))\n            return null\n        }\n    }\n\n    function sendNewConnMsgThruProxy(url: string) {\n        const proxiedMsg = {\n            type: proxyMessageTypes.openWebsocket,\n            url: url,\n        } as proxyInterchangeFormat\n        console.log(\"Sending openWebsocket msg Thru Proxy\", proxiedMsg)\n        if (sendProxyMessageCallback) sendProxyMessageCallback(ENCODE_TXT(JSON.stringify(proxiedMsg)))\n    }\n\n    function sendDataThruProxy(url: string, data: ArrayBufferLike) {\n        const binary = new Uint8Array(data)\n        const proxiedMsg = {\n            type: proxyMessageTypes.socketMsg,\n            url: url,\n            body: new Array(...binary)\n        } as proxyInterchangeFormat\n        console.log(\"Sending Data Thru Proxy\", proxiedMsg)\n        if (sendProxyMessageCallback) sendProxyMessageCallback(ENCODE_TXT(JSON.stringify(proxiedMsg)))\n    }\n\n    return function receiveProxiedMsg(rawMsg: ArrayBufferLike) {\n        const proxiedMsg = JSON.parse(DECODE_TXT(rawMsg)) as proxyInterchangeFormat;\n        if (proxiedMsg.type === proxyMessageTypes.socketMsg) {\n            const ws = proxiedWsObjects[proxiedMsg.url]\n            const body = new Uint8Array(proxiedMsg.body)\n            console.log(\"Received Proxy Message\", proxiedMsg, body)\n            if (ws) wsHook.triggerOnMessage(ws, body)\n        }\n    }\n}\n"],"names":["PROXY_PREFIX","ENCODE_TXT","DECODE_TXT","MakeMutableMessageEvent","ev","wsHook","wsObject","data","url","monkeyPatchDone","hookWebsockets","defaultWSHooks","_WS","protocols","allowRealSocket","WSObject","_send","_a","eventThis","eventName","userFunc","onMessageHandler","onOpenHandler","onErrorHandler","onCloseHandler","proxyMessageTypes","proxyMessageTypes2","enableIframeWebsocketProxying","receiveProxiedMsg","startWebsocketProxying","msg","isProxiedUrl","sendProxyMessageCallback","proxiedWsObjects","sendNewConnMsgThruProxy","sendDataThruProxy","proxiedMsg","binary","rawMsg","ws","body"],"mappings":"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"}