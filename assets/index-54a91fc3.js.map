{"version":3,"file":"index-54a91fc3.js","sources":["../../shared/js/wsHook.ts","../../shared/js/proxy.ts","../../shared/js/proxyReciever.ts","../../rov-backend/internal_webpages/offlineframe/js/main.js"],"sourcesContent":["/* eslint-disable no-proto */\n/* eslint-disable accessor-pairs */\n/* eslint-disable no-global-assign */\n\n/* wsHook.js\n * https://github.com/skepticfx/wshook\n * Reference: http://www.w3.org/TR/2011/WD-websockets-20110419/#websocket\n */\n\ndeclare global {\n  interface MessageEvent {\n    path?: string[];\n    parts?: string[];\n    __proto__: MessageEvent\n  }\n  interface WebSocket {\n    _onopen?: (ev?: Event) => void;\n    _onerror?: (ev?: Event) => void;\n    _onclose?: (ev?: CloseEvent) => void;\n    _onmessage?: (ev?: MessageEvent) => void;\n    _addEventListener?: <K extends keyof WebSocketEventMap>(type: K, listener: (this: WebSocket, ev: WebSocketEventMap[K]) => any, options?: boolean | AddEventListenerOptions) => void;\n    _readyState: number;\n    isReal?: boolean;\n  }\n}\n\ntype socketMsgDataTypes = string | ArrayBufferLike | Blob | ArrayBufferView\n\n// Mutable MessageEvent.\n// Subclasses MessageEvent and makes data, origin and other MessageEvent properites mutatble.\nexport interface MutableMessageEvent<T = any> extends MessageEvent<T> {\n  bubbles: boolean;\n  cancelBubble: boolean;\n  cancelable: boolean;\n  currentTarget: EventTarget | null;\n  data: T;\n  defaultPrevented: boolean;\n  eventPhase: number;\n  lastEventId: string;\n  origin: string;\n  path: string[];\n  ports: MessagePort[];\n  returnValue: boolean;\n  source: MessageEventSource | null;\n  srcElement: EventTarget | null;\n  target: EventTarget | null;\n  timeStamp: number;\n  type: string;\n}\n\nconst MakeMutableMessageEvent = (ev: MessageEvent) => {\n  return {\n    ...ev,\n    bubbles: ev.bubbles || false,\n    cancelBubble: ev.cancelBubble || false,\n    cancelable: ev.cancelable || false,\n    currentTarget: ev.currentTarget || null,\n    data: ev.data,\n    defaultPrevented: ev.defaultPrevented || false,\n    eventPhase: ev.eventPhase || 0,\n    lastEventId: ev.lastEventId || '',\n    origin: ev.origin || '',\n    path: ev.path || new Array(0),\n    ports: ev.parts || new Array(0),\n    returnValue: ev.returnValue || true,\n    source: ev.source || null,\n    srcElement: ev.srcElement || null,\n    target: ev.target || null,\n    timeStamp: ev.timeStamp || -1,\n    type: ev.type || 'message',\n    initMessageEvent: ev.initMessageEvent || null,\n    __proto__: ev.__proto__,// || MessageEvent.__proto__\n  } as MutableMessageEvent\n}\n\nexport const wsHook = {\n  triggerOnOpen: (wsObject: WebSocket, ev?: Event) => {\n    ev = ev || new Event(\"open\", { composed: false, bubbles: false, cancelable: false })\n    wsObject._readyState = 1;\n    if (wsObject._onopen) wsObject._onopen(ev);\n    // wsObject.dispatchEvent(ev)\n  },\n  triggerOnError: (wsObject: WebSocket, ev?: Event) => {\n    ev = ev || new Event(\"error\", { composed: false, bubbles: false, cancelable: false })\n    wsObject._readyState = 3;\n    if (wsObject._onerror) wsObject._onerror(ev);\n  },\n  triggerOnClose: (wsObject: WebSocket, ev?: CloseEvent) => {\n    ev = ev || new CloseEvent(\"close\", { wasClean: true, reason: \"wsHook\", composed: false, bubbles: false, cancelable: false, code: 1006 })\n    wsObject._readyState = 3;\n    if (wsObject._onclose) wsObject._onclose(ev);\n  },\n  triggerOnMessage: (wsObject: WebSocket, data: socketMsgDataTypes) => {\n    // @ts-ignore\n    if (!(typeof data === typeof '' || data instanceof ArrayBuffer)) data = (data as Uint8Array).buffer;\n    console.log(\"triggerOnMessage\", data, wsObject);\n    const ev = new MessageEvent(\"mesage\", { data: data, origin: wsObject.url, bubbles: false, cancelable: false, composed: false })\n    if (wsObject._onmessage) wsObject._onmessage(ev);\n  },\n  /**\n   * Whenever the a \"new WebSocket()\" call is made, wsHook.allowNewSocket will get called with the url of the new websocket\n   * @param url: the url passed to the new WebSocket() constructor\n   * @returns Return true to allow the default websocket behavior. Return false to create a mock WebSocket that never hits the network but can still be controlled with wsHook.trigger* calls.\n   */\n  allowNewSocket: (url: string): boolean => {\n    return true;\n  },\n  modifyUrl: (url: string | URL) => {\n    return url\n  },\n  afterInit: (wsObject: WebSocket): WebSocket => {\n    return wsObject;\n  },\n  beforeOpen: (ev: Event, url: string, wsObject: WebSocket): Event | null => {\n    return ev;\n  },\n  beforeError: (ev: Event, url: string, wsObject: WebSocket): Event | null => {\n    return ev;\n  },\n  beforeClose: (ev: CloseEvent, url: string, wsObject: WebSocket): CloseEvent | null => {\n    return ev;\n  },\n  beforeSend: (data: socketMsgDataTypes, url: string, wsObject: WebSocket): socketMsgDataTypes | null => {\n    return data;\n  },\n  afterRecive: (ev: MessageEvent, url: string, wsObject: WebSocket): MessageEvent | MutableMessageEvent | null => {\n    return ev;\n  },\n  resetHooks: () => { }\n};\n\n(function () {\n\n  // setup WSHook default functions\n  const defaultWSHooks = Object.assign({}, wsHook) // make a copy of the default functions\n  wsHook.resetHooks = function () {\n    Object.assign(wsHook, defaultWSHooks)\n  }\n\n  // overwrite the default websocket\n  var _WS = WebSocket\n  // @ts-ignore\n  WebSocket = Object.assign(function (url: string | URL, protocols?: string | string[] | undefined): WebSocket {\n    const allowRealSocket = wsHook.allowNewSocket(url.toString())\n    url = wsHook.modifyUrl(url) || url\n    let WSObject: WebSocket;\n    if (allowRealSocket) {\n      WSObject = protocols ? new _WS(url, protocols) : new _WS(url);\n      WSObject.isReal = true;\n    } else {\n      // @ts-ignore\n      WSObject = Object.assign({}, _WS);\n      Object.defineProperty(WSObject, 'url', { get() { return url } })\n      Object.defineProperty(WSObject, 'protocols', { get() { return protocols } })\n      Object.defineProperty(WSObject, 'readyState', { get() { return this._readyState } })\n      Object.defineProperty(WSObject, 'close', { value: () => { return wsHook.triggerOnClose(this) } })\n      Object.defineProperty(WSObject, 'isReal', { value: false })\n      Object.defineProperty(WSObject, '_readyState', { value: 0, writable: true })\n    }\n\n    // Hook the websocket send function\n    var _send = WSObject.send\n    WSObject.send = function (data) {\n      console.log(\"hook send\")\n      arguments[0] = wsHook.beforeSend(data, WSObject.url, this) || null;\n      if (arguments[0] == null) return;\n      _send.apply(this, arguments)\n    }\n\n    // Events needs to be proxied and bubbled down.\n    WSObject._onopen = undefined;\n    WSObject._onerror = undefined;\n    WSObject._addEventListener = WSObject.addEventListener || function () {\n      // console.log(\"fake addEventListener() called\")\n      // const eventName = arguments[0];\n      // const userFunc = arguments[1];\n      // if (eventName === 'message') {\n      //   WSObject._onmessage = userFunc\n      // } else if (eventName === 'open') {\n      //   WSObject._onopen = userFunc\n      // } else if (eventName === 'error') {\n      //   WSObject._onerror = userFunc\n      // } else if (eventName === 'close') {\n      //   WSObject._onclose = userFunc\n      // }\n    };\n    WSObject.addEventListener = function () {\n      const eventThis = this\n      const eventName = arguments[0];\n      const userFunc = arguments[1];\n\n      if (eventName === 'message') {\n        WSObject._onmessage = userFunc\n        arguments[1] = (function (userFunc) {\n          return function () {\n            arguments[0] = wsHook.afterRecive(MakeMutableMessageEvent(arguments[0]), WSObject.url, WSObject)\n            if (arguments[0] === null) return\n            userFunc.apply(eventThis, arguments)\n          }\n        })(userFunc)\n      } else if (eventName === 'open') {\n        WSObject._onopen = userFunc\n        arguments[1] = (function (userFunc) {\n          return function () {\n            arguments[0] = wsHook.beforeOpen(arguments[0], WSObject.url, WSObject)\n            if (arguments[0] === null) return\n            userFunc.apply(eventThis, arguments)\n          }\n        })(userFunc)\n      } else if (eventName === 'error') {\n        WSObject._onerror = userFunc\n        arguments[1] = (function (userFunc) {\n          return function () {\n            arguments[0] = wsHook.beforeError(arguments[0], WSObject.url, WSObject)\n            if (arguments[0] === null) return\n            userFunc.apply(eventThis, arguments)\n          }\n        })(userFunc)\n      } else if (eventName === 'close') {\n        WSObject._onclose = userFunc\n        arguments[1] = (function (userFunc) {\n          return function () {\n            arguments[0] = wsHook.beforeClose(arguments[0], WSObject.url, WSObject)\n            if (arguments[0] === null) return\n            userFunc.apply(eventThis, arguments)\n          }\n        })(userFunc)\n      }\n      return WSObject._addEventListener?.apply(this, arguments)\n    }\n\n    Object.defineProperty(WSObject, 'onmessage', {\n      'set': function () {\n        var eventThis = this\n        var userFunc = arguments[0]\n        WSObject._onmessage = userFunc\n        var onMessageHandler = userFunc ? function () {\n          if (!WSObject.isReal) console.log('onMessageHandler', arguments)\n          arguments[0] = wsHook.afterRecive(MakeMutableMessageEvent(arguments[0]), WSObject.url, WSObject)\n          if (arguments[0] === null) return\n          userFunc.apply(eventThis, arguments)\n        } : null;\n\n        console.log('onMsgHandler', arguments)\n        WSObject._addEventListener?.apply(this, ['message', onMessageHandler, false])\n      }\n    })\n\n    Object.defineProperty(WSObject, 'onopen', {\n      'set': function () {\n        var eventThis = this\n        var userFunc = arguments[0]\n        WSObject._onopen = userFunc\n        var onOpenHandler = userFunc ? function () {\n          if (!WSObject.isReal) console.log('onOpenHandler', arguments)\n          arguments[0] = wsHook.beforeOpen(arguments[0], WSObject.url, WSObject)\n          if (arguments[0] === null) return\n          userFunc.apply(eventThis, arguments)\n        } : null;\n        console.log('onOpenHandler', arguments)\n        WSObject._addEventListener?.apply(this, ['open', onOpenHandler, false])\n      }\n    })\n\n    Object.defineProperty(WSObject, 'onerror', {\n      'set': function () {\n        var eventThis = this\n        var userFunc = arguments[0]\n        WSObject._onerror = userFunc\n        var onErrorHandler = userFunc ? function () {\n          if (!WSObject.isReal) console.log('onErrorHandler', arguments)\n          arguments[0] = wsHook.beforeError(arguments[0], WSObject.url, WSObject)\n          if (arguments[0] === null) return\n          userFunc.apply(eventThis, arguments)\n        } : null\n        WSObject._addEventListener?.apply(this, ['error', onErrorHandler, false])\n      }\n    })\n\n    Object.defineProperty(WSObject, 'onclose', {\n      'set': function () {\n        var eventThis = this\n        var userFunc = arguments[0]\n        WSObject._onclose = userFunc\n        var onCloseHandler = userFunc ? function () {\n          if (!WSObject.isReal) console.log('onCloseHandler', arguments)\n          arguments[0] = wsHook.beforeClose(arguments[0], WSObject.url, WSObject)\n          if (arguments[0] === null) return\n          userFunc.apply(eventThis, arguments)\n        } : null\n        WSObject._addEventListener?.apply(this, ['close', onCloseHandler, false])\n      }\n    })\n\n    wsHook.afterInit(WSObject);\n    WSObject._readyState = _WS.OPEN;\n    return WSObject\n  }, _WS);\n})();\n","// https://stackoverflow.com/questions/61865890/run-websocket-in-web-worker-or-service-worker-javascript\n// https://github.com/skepticfx/wshook\n// https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Transferable_objects\n// Some Ideas\n\nimport { DECODE_TXT, ENCODE_TXT, PROXY_PREFIX } from \"./consts\";\nimport { waitfor } from \"./util\";\nimport { wsHook } from \"./wsHook\";\n\nexport enum proxyMessageTypes {\n    openWebsocket,\n    socketMsg,\n    outgoingHttpReq,\n    incomingHttpReq,\n}\n\nexport type proxyInterchangeFormat = {\n    type: proxyMessageTypes;\n    url: string;\n    body: number[]; // binary data\n    result: object; // for fetch response\n}\n\nlet isOnline = true;\nconst proxiedWsObjects: { [key: string]: WebSocket } = {};\nlet sendProxyMessageCallback: ((data: ArrayBufferLike) => void) | null = null\nexport function setSendProxyMessageCallback(callback: (data: ArrayBufferLike) => void) {\n    sendProxyMessageCallback = callback;\n}\n\nconst isProxiedUrl = (url: string) => {\n    return url.startsWith(PROXY_PREFIX) || !isOnline\n}\n\nwsHook.allowNewSocket = (url) => {\n    console.log(\"Checking ws url: \", url)\n    if (isProxiedUrl(url)) {\n        console.log(\"Proxying ws url: \", url)\n        return false;\n    } else return true;\n};\n\nwsHook.modifyUrl = (url: string | URL) => {\n    url = url.toString();\n    if (isProxiedUrl(url)) url = url.substring(PROXY_PREFIX.length)\n    console.log(\"modifyUrl: \", url)\n    return url\n};\n\n\nwsHook.afterInit = (wsObject) => {\n    const url = wsObject.url;\n    if (!wsObject.isReal) {\n        proxiedWsObjects[url] = wsObject;\n        setTimeout(() => {\n            wsHook.triggerOnOpen(wsObject);\n            sendNewConnMsgThruProxy(url);\n        }, 1)\n    }\n    return wsObject;\n};\n\nwsHook.beforeSend = (data, url, wsObject) => {\n    if (wsObject.isReal) {\n        return data;\n    } else {\n        console.log(\"beforeSend: \", wsObject.isReal, wsObject.url, data)\n        sendDataThruProxy(url, new Uint8Array(data as ArrayBuffer))\n        return null\n    }\n}\n\nfunction sendNewConnMsgThruProxy(url: string) {\n    const proxiedMsg = {\n        type: proxyMessageTypes.openWebsocket,\n        url: url,\n    } as proxyInterchangeFormat\n    console.log(\"Sending openWebsocket msg Thru Proxy\", proxiedMsg)\n    if (sendProxyMessageCallback) sendProxyMessageCallback(ENCODE_TXT(JSON.stringify(proxiedMsg)))\n}\n\nfunction sendDataThruProxy(url: string, data: ArrayBufferLike) {\n    const binary = new Uint8Array(data)\n    const proxiedMsg = {\n        type: proxyMessageTypes.socketMsg,\n        url: url,\n        body: new Array(...binary)\n    } as proxyInterchangeFormat\n    console.log(\"Sending Data Thru Proxy\", proxiedMsg)\n    if (sendProxyMessageCallback) sendProxyMessageCallback(ENCODE_TXT(JSON.stringify(proxiedMsg)))\n}\n\nexport function receiveProxiedMsg(rawMsg: ArrayBufferLike) {\n    const proxiedMsg = JSON.parse(DECODE_TXT(rawMsg)) as proxyInterchangeFormat;\n    if (proxiedMsg.type === proxyMessageTypes.socketMsg) {\n        const ws = proxiedWsObjects[proxiedMsg.url]\n        const body = new Uint8Array(proxiedMsg.body)\n        console.log(\"Received Proxy Message\", proxiedMsg, body)\n        if (ws) wsHook.triggerOnMessage(ws, body)\n    }\n}\n","import { proxyInterchangeFormat, proxyMessageTypes } from \"../../shared/js/proxy\";\nimport { DECODE_TXT, ENCODE_TXT } from \"./consts\";\n\nconst openHttpConnections: { [key: string]: Promise<Response> } = {}\nconst openWebsocketConnections: { [key: string]: WebSocket } = {}\n\nlet sendProxyMessageCallback: (rawMsg: ArrayBufferLike) => void;\nexport function setSendProxyMessageCallback(callback: (data: ArrayBufferLike) => void) {\n    sendProxyMessageCallback = callback;\n}\n\nfunction openWebsocket(url: string) {\n    if (openWebsocketConnections[url]) return openWebsocketConnections[url];\n    const ws = openWebsocketConnections[url] = new WebSocket(url);\n    ws.binaryType = \"arraybuffer\";\n    ws.addEventListener('message', (ev) => {\n        let data = typeof ev.data === typeof '' ? ENCODE_TXT(ev.data) : ev.data;\n        const binary = new Uint8Array(data)\n        if (sendProxyMessageCallback) sendProxyMessageCallback(ENCODE_TXT(JSON.stringify({\n            type: proxyMessageTypes.socketMsg,\n            body: new Array(...binary),\n            url: url,\n        } as proxyInterchangeFormat)))\n    })\n    ws.addEventListener('error', (ev) => {\n        console.warn('ws err ' + url, ev)\n    })\n    ws.addEventListener('close', (ev) => {\n        console.warn('ws close ' + url, ev)\n    })\n    return ws;\n}\n\nfunction sendWebsocketMsg(url: string, data: ArrayBufferLike) {\n    let ws = openWebsocketConnections[url];\n    if (!ws) ws = openWebsocket(url)\n    if (ws.readyState !== WebSocket.OPEN) {\n        console.log(\"osending\", DECODE_TXT(data), ws.readyState, WebSocket.OPEN)\n        ws.addEventListener('open', () => ws.send(data))\n    } else {\n        console.log(\"sending\")\n        ws.send(data);\n    }\n}\n\nfunction sendHttpRequest(url: string, fetchOptions: object) {\n    if (openHttpConnections[url] != undefined) return;\n    const f = openHttpConnections[url] = fetch(url, fetchOptions);\n    f.then(async (result) => {\n        console.log(\"fetch result\", result)\n        let body = new Uint8Array(await result.arrayBuffer())\n        if (sendProxyMessageCallback) sendProxyMessageCallback(ENCODE_TXT(JSON.stringify({\n            type: proxyMessageTypes.outgoingHttpReq,\n            result: result,\n            body: new Array(...body),\n            url: url,\n        } as proxyInterchangeFormat)))\n    }).catch((err) => {\n        console.log(\"fetch err\", err)\n    });\n}\n\nexport function receiveProxiedMsg(rawMsg: ArrayBufferLike) {\n    const proxiedMsg = JSON.parse(DECODE_TXT(rawMsg)) as proxyInterchangeFormat;\n    console.log(\"Received Proxy Message\", proxiedMsg)\n    if (proxiedMsg.type === proxyMessageTypes.openWebsocket) {\n        openWebsocket(proxiedMsg.url)\n    } else if (proxiedMsg.type === proxyMessageTypes.socketMsg) {\n        sendWebsocketMsg(proxiedMsg.url, new Uint8Array(proxiedMsg.body))\n    } else if (proxiedMsg.type === proxyMessageTypes.incomingHttpReq) {\n        sendHttpRequest(proxiedMsg.url, JSON.parse(DECODE_TXT(new Uint8Array(proxiedMsg.body))))\n    }\n}\n","import { receiveProxiedMsg, setSendProxyMessageCallback } from \"../../../../shared/js/proxyReciever\";\nconst iframe = document.createElement('iframe');\nconst iframeHost = window.location.protocol.replace(\":\", \"\") + '://' + window.location.host;\n// const iframeHost = 'http://10.0.0.48:5173'\niframe.src = iframeHost + '/frontend/index.html'\niframe.sandbox = \"allow-scripts\"\niframe.onload = () => {\n    console.info(\"iframe loaded\")\n}\ndocument.body.appendChild(iframe);\nsetSendProxyMessageCallback((data) => {\n    iframe.contentWindow.postMessage(data, iframeHost)\n})\nwindow.addEventListener('message', (msg) => {\n    if (msg.origin === iframeHost) {\n        console.log(\"Got message\", msg.data)\n        receiveProxiedMsg(msg.data)\n    }\n})\n"],"names":["PROXY_PREFIX","DECODE_TXT","ENCODE_TXT","MakeMutableMessageEvent","ev","wsHook","wsObject","data","url","defaultWSHooks","_WS","protocols","allowRealSocket","WSObject","_send","_a","eventThis","eventName","userFunc","onMessageHandler","onOpenHandler","onErrorHandler","onCloseHandler","proxyMessageTypes","proxyMessageTypes2","isOnline","isProxiedUrl","sendNewConnMsgThruProxy","sendDataThruProxy","binary","proxiedMsg","openHttpConnections","openWebsocketConnections","sendProxyMessageCallback","setSendProxyMessageCallback","callback","openWebsocket","ws","sendWebsocketMsg","sendHttpRequest","fetchOptions","result","body","err","receiveProxiedMsg","rawMsg","iframe","iframeHost","msg"],"mappings":"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"}