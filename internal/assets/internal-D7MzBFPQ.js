var Ya=Object.defineProperty;var Xa=(n,e,t)=>e in n?Ya(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var I=(n,e,t)=>Xa(n,typeof e!="symbol"?e+"":e,t);import{l as D,S as Ds,a as Qa,b as F,M as we,c as Ui,d as Za,e as ec,f as _i,u as Ke,g as ue,h as te,i as $,D as tc,j as nc,p as Ut,E as Bs,R as yi,A as ic,L as Mt,m as vn,k as ce,n as rc,C as B,o as sc,q as oc,r as H,s as Me,P as ac,t as Us,T as cc,v as uc,w as lc,x as Tr,y as dc,z as hc,B as fc,F as wr}from"./logging-AZaVoBkC.js";const Ki=new URLSearchParams(globalThis.window?window.location.search:"");function De(n,e){const t=Ki.get(n);if(t==null||t===""){if(e===void 0)throw new Error("Missing required url query parameter (string): "+n);return D("Using default value for string url query parameter: "+n+"="+e),e}return t}function Sr(n,e){const t=Ki.get(n);return t==null||t===""?(D("Using default value for bool url query parameter: "+n+"="+e),e):t.toLowerCase()!=="false"}function br(n,e){const t=Ki.get(n);if(t==null||t===""){if(e===void 0)throw new Error("Missing required integer url query parameter (integer): "+n);return D("Using default value for integer url query parameter: "+n+"="+e),e}try{return parseInt(t)}catch{throw new Error(`Error parsing integer url query parameter: ${n}=${t}`)}}const V={DEBUG_MODE:Sr("DEBUG_MODE",!1),SEND_LOGS:Sr("SEND_LOGS",!1),ROV_NAME:De("ROV_NAME","Default-ROV"),ROV_CONTROL_PASSWORD:De("ROV_CONTROL_PASSWORD",""),LIVEKIT_API_KEY:De("LIVEKIT_API_KEY"),LIVEKIT_SECRET_KEY:De("LIVEKIT_SECRET_KEY"),TWITCH_STREAM_KEY:De("TWITCH_STREAM_KEY","None"),PYTHON_WEBSOCKET_PORT:br("PYTHON_WEBSOCKET_PORT",0),AUTH_TOKEN_TIMEOUT:br("AUTH_TOKEN_TIMEOUT",Qa),BLUEOS_APIS_ENDPOINT:De("BLUEOS_APIS_ENDPOINT",""),LIVEKIT_CLOUD_ENDPOINT:De("LIVEKIT_CLOUD_URL","https://rov-web.livekit.cloud"),LIVEKIT_LOCAL_ENDPOINT:De("LIVEKIT_LOCAL_URL","http://localhost:7880")};Object.assign({},Ds,{initiator:!1,offerOptions:{offerToReceiveAudio:!1,offerToReceiveVideo:!1}});const kr={video:{width:1920,height:1080,frameRate:60,facingMode:"environment"},audio:!1};function It(n){return new Promise(e=>{setTimeout(()=>{e()},n)})}function Rr(n){const e=n.fn,t=n.maxRetries??3,i=n.initialDelay??100,r=n.exponent??2;let s=!1;return{promise:new Promise(async function(o,l){let f,h=0;for(;h<t;)try{const u=await e();return s?l(null):o(u)}catch(u){if(F("err:",f=u),s)return u.message+=" - asyncExpBackoff() canceled",l(u);await It(i*Math.pow(r,h)),h++}f.message+=" - asyncExpBackoff() failed after "+h+" retries",l(f)}),cancel:()=>{s=!0}}}function dt(n,e){let t=!1,i=n.get();return n.subscribe(s=>{if(t==!1){t=!0,i=s;return}e(s,i),i=s})}function Ks(n,e=!1){return n.replace("http","ws")}function mc(){const n=new Date().getTime()>>>0,e=typeof performance<"u"&&performance.now&&(performance.now()>>>0)*1e3||0,t=crypto.getRandomValues(new Uint8Array(1))[0]>>>0;return n*e*t}const Cr=["Ancient","Dawn","Small","Broken","Red","Cold","Wild","Divine","Empty","Patient","Holy","Long","Wispy","White","Delicate","Bold","Billowing","Blue","Crimson","Aged","Misty","Snowy","Withered","Little","Frosty","Weathered","Nameless","Fragrant","Lively","Quiet","Purple","Proud","Dry","Bitter","Dark","Icy","Twilight","Wandering","Solitary","Morning","Lingering","Still","Late","Sparkling","Restless","Winter","Silent","Floral","Young","Green","Cool","Autumn","Falling","Spring","Summer","Polished","Hidden","Damp","Muddy","Black","Old","Rough"],Ir=["Pond","Snow","Glade","Hill","Voice","River","Sun","Dawn","Forest","Frog","Grass","Shadow","Dust","Water","Meadow","Moon","Thunder","Sun","Wildflower","Snowflake","Silence","Haze","Shape","Pine","Waterfall","Sound","Wood","Tree","Night","Flower","Dream","Cherry","Resonance","Firefly","Bush","Star","Darkness","Lake","Frost","Paper","Surf","Fog","Brook","Mountain","Field","Bird","Leaf","Sea","Water","Sky","Smoke","Sunset","Glitter","Dew","Butterfly","Wind","Fire","Rain","Morning","Feather","Cloud","Breeze","Violet","Wave","Droplet","Swamp","Village","Hut","Path","Book","Rain","Spell","Pig"];function pc(n,e=0){let t=Cr.length>>>0,i=Ir.length>>>0,r=Math.max(t,i)>>>0,s=Math.max(1,(n+1)%r)>>>0,o=Math.max(1,(e+1)%r)>>>0,l=Cr[(s+o)%t],f=Ir[s*o%i];return l+"-"+f}const Vs=n=>{for(const e in n)n[e]===void 0||typeof n[e]=="number"&&isNaN(n[e])?delete n[e]:typeof n[e]=="object"&&Vs(n[e]);return n};we.MAV_STATE_UNINIT+"",we.MAV_STATE_BOOT+"",we.MAV_STATE_CALIBRATING+"",we.MAV_STATE_STANDBY+"",we.MAV_STATE_ACTIVE+"",we.MAV_STATE_CRITICAL+"",we.MAV_STATE_EMERGENCY+"",we.MAV_STATE_POWEROFF+"",we.MAV_STATE_FLIGHT_TERMINATION+"";let gc=-1;const st=(n,e=0)=>({header:{system_id:255,component_id:190,sequence:gc++%255},message:n}),_c=n=>st({type:"COMMAND_LONG",command:{type:"MAV_CMD_COMPONENT_ARM_DISARM"},target_system:1,target_component:1,confirmation:0,param1:1,param2:0,param3:0,param4:0,param5:0,param6:0,param7:0}),yc=n=>st({type:"COMMAND_LONG",command:{type:"MAV_CMD_COMPONENT_ARM_DISARM"},target_system:1,target_component:1,confirmation:1,param1:0,param2:0,param3:0,param4:0,param5:0,param6:0,param7:0}),Ec=(n=1,e=333333.34375)=>st({type:"COMMAND_LONG",command:{type:"MAV_CMD_SET_MESSAGE_INTERVAL"},target_system:1,target_component:1,confirmation:1,param1:n,param2:e,param3:0,param4:0,param5:0,param6:0,param7:0}),Tc=n=>(n=n||19,st({type:Ui.COMMAND_LONG,command:{type:"MAV_CMD_DO_SET_MODE"},param1:1,param2:Number(n),param3:0,param4:0,param5:0,param6:0,param7:0,target_system:1,target_component:1,confirmation:1})),wc=()=>st({type:Ui.HEARTBEAT,custom_mode:0,mavtype:{type:Za.MAV_TYPE_GCS},autopilot:{type:ec.MAV_AUTOPILOT_INVALID},base_mode:{bits:_i.MAV_MODE_FLAG_SAFETY_ARMED|_i.MAV_MODE_FLAG_MANUAL_INPUT_ENABLED},system_status:{type:we.MAV_STATE_ACTIVE},mavlink_version:3,confirmation:0}),Ar=(n,e,t,i,r)=>st({type:Ui.MANUAL_CONTROL,x:Math.floor(n),y:Math.floor(e),z:Math.floor(t),r:Math.floor(i),buttons:r,target:1}),Sc=(n,e,t)=>{const i=Array(8).fill(0);return i[n]=e,st({type:"SET_ACTUATOR_CONTROL_TARGET",group_mlx:t,controls:i,time_usec:Ke()*1e3,target_component:1,target_system:1})};class Hs{constructor(){I(this,"socket");I(this,"serverAddress");I(this,"msgReceivedFn");I(this,"onConnectedFn");I(this,"isRunning");I(this,"isConnected");I(this,"connectionTimerId");this.isConnected=!1,this.isRunning=!1,this.connectionTimerId=0,this.serverAddress=""}start(e,t){this.serverAddress=e,this.msgReceivedFn=t,this.isRunning=!0,this.connect()}stop(){this.isRunning=!1,this.socket&&this.socket.close()}connect(){ue("Attempting to connect to websocket: "+this.serverAddress),this.socket=new WebSocket(this.serverAddress),this.socket.binaryType="arraybuffer";const e=setTimeout(()=>{te("WebSocket connection timed out after 10 seconds"),this.stop(),this.queueConnect()},1e4);this.socket.addEventListener("open",t=>{this.isConnected=!0,clearTimeout(e),this.onConnectedFn&&this.onConnectedFn()}),this.socket.addEventListener("close",t=>{ue("WebSocket connection closed with code: ",t.code),this.isConnected=!1,this.isRunning&&this.queueConnect()}),this.socket.addEventListener("error",t=>{te("WebSocket error:",t),this.isConnected=!1,this.isRunning&&this.queueConnect()}),this.socket.addEventListener("message",t=>{if(!this.msgReceivedFn)return te("No msgReceivedFn defined for WebSocketRelay");if(typeof t.data=="string")this.msgReceivedFn(t.data);else if(t.data instanceof ArrayBuffer)this.msgReceivedFn(new Uint8Array(t.data));else throw t.data instanceof Blob?new Error("WebSocketRelay received Blob type, which is not supported!"):new Error("WebSocketRelay received unknown type")})}queueConnect(){clearTimeout(this.connectionTimerId),this.connectionTimerId=setTimeout(this.connect.bind(this),2e3)}getIsConnected(){return this.isConnected}sendMessage(e){if(this.socket){if(this.socket.readyState!=this.socket.OPEN){$("Can't send WebSocket msg: "+this.socket.readyState);return}this.socket.send(e)}}close(){this.socket&&this.socket.close()}}const Sn=new Hs;class bc{constructor(){I(this,"mavlinkWebsocket");I(this,"onMessage");this.mavlinkWebsocket=new Hs,this.onMessage=e=>{}}start(e,t,i){this.onMessage=t,i&&(this.mavlinkWebsocket.onConnectedFn=i),this.mavlinkWebsocket.start(e,r=>{this.handleMessage(r)})}handleMessage(e){if(e.length===0)return;const t=e instanceof Uint8Array?tc(e):e;try{if(t.startsWith("Ok"))return;const i=JSON.parse(t);this.onMessage(i)}catch(i){te("Failed to parse recived mavlink2rest json. msg='"+t+"'",i)}}sendMessage(e){this.mavlinkWebsocket.sendMessage(JSON.stringify(e))}close(){this.mavlinkWebsocket.close()}}const be=new bc;function $s(n,e){return function(){return n.apply(e,arguments)}}const{toString:kc}=Object.prototype,{getPrototypeOf:Vi}=Object,On=(n=>e=>{const t=kc.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Ee=n=>(n=n.toLowerCase(),e=>On(e)===n),xn=n=>e=>typeof e===n,{isArray:At}=Array,Kt=xn("undefined");function Rc(n){return n!==null&&!Kt(n)&&n.constructor!==null&&!Kt(n.constructor)&&fe(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const qs=Ee("ArrayBuffer");function Cc(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&qs(n.buffer),e}const Ic=xn("string"),fe=xn("function"),Ws=xn("number"),Pn=n=>n!==null&&typeof n=="object",Ac=n=>n===!0||n===!1,mn=n=>{if(On(n)!=="object")return!1;const e=Vi(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Nc=Ee("Date"),vc=Ee("File"),Oc=Ee("Blob"),xc=Ee("FileList"),Pc=n=>Pn(n)&&fe(n.pipe),Lc=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||fe(n.append)&&((e=On(n))==="formdata"||e==="object"&&fe(n.toString)&&n.toString()==="[object FormData]"))},Fc=Ee("URLSearchParams"),[Mc,Dc,Bc,Uc]=["ReadableStream","Request","Response","Headers"].map(Ee),Kc=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Gt(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let i,r;if(typeof n!="object"&&(n=[n]),At(n))for(i=0,r=n.length;i<r;i++)e.call(null,n[i],i,n);else{const s=t?Object.getOwnPropertyNames(n):Object.keys(n),o=s.length;let l;for(i=0;i<o;i++)l=s[i],e.call(null,n[l],l,n)}}function Gs(n,e){e=e.toLowerCase();const t=Object.keys(n);let i=t.length,r;for(;i-- >0;)if(r=t[i],e===r.toLowerCase())return r;return null}const Xe=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:nc,Js=n=>!Kt(n)&&n!==Xe;function Ei(){const{caseless:n}=Js(this)&&this||{},e={},t=(i,r)=>{const s=n&&Gs(e,r)||r;mn(e[s])&&mn(i)?e[s]=Ei(e[s],i):mn(i)?e[s]=Ei({},i):At(i)?e[s]=i.slice():e[s]=i};for(let i=0,r=arguments.length;i<r;i++)arguments[i]&&Gt(arguments[i],t);return e}const Vc=(n,e,t,{allOwnKeys:i}={})=>(Gt(e,(r,s)=>{t&&fe(r)?n[s]=$s(r,t):n[s]=r},{allOwnKeys:i}),n),Hc=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),$c=(n,e,t,i)=>{n.prototype=Object.create(e.prototype,i),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},qc=(n,e,t,i)=>{let r,s,o;const l={};if(e=e||{},n==null)return e;do{for(r=Object.getOwnPropertyNames(n),s=r.length;s-- >0;)o=r[s],(!i||i(o,n,e))&&!l[o]&&(e[o]=n[o],l[o]=!0);n=t!==!1&&Vi(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},Wc=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const i=n.indexOf(e,t);return i!==-1&&i===t},Gc=n=>{if(!n)return null;if(At(n))return n;let e=n.length;if(!Ws(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},Jc=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&Vi(Uint8Array)),jc=(n,e)=>{const i=(n&&n[Symbol.iterator]).call(n);let r;for(;(r=i.next())&&!r.done;){const s=r.value;e.call(n,s[0],s[1])}},zc=(n,e)=>{let t;const i=[];for(;(t=n.exec(e))!==null;)i.push(t);return i},Yc=Ee("HTMLFormElement"),Xc=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,i,r){return i.toUpperCase()+r}),Nr=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),Qc=Ee("RegExp"),js=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),i={};Gt(t,(r,s)=>{let o;(o=e(r,s,n))!==!1&&(i[s]=o||r)}),Object.defineProperties(n,i)},Zc=n=>{js(n,(e,t)=>{if(fe(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const i=n[t];if(fe(i)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},eu=(n,e)=>{const t={},i=r=>{r.forEach(s=>{t[s]=!0})};return At(n)?i(n):i(String(n).split(e)),t},tu=()=>{},nu=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e,Xn="abcdefghijklmnopqrstuvwxyz",vr="0123456789",zs={DIGIT:vr,ALPHA:Xn,ALPHA_DIGIT:Xn+Xn.toUpperCase()+vr},iu=(n=16,e=zs.ALPHA_DIGIT)=>{let t="";const{length:i}=e;for(;n--;)t+=e[Math.random()*i|0];return t};function ru(n){return!!(n&&fe(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const su=n=>{const e=new Array(10),t=(i,r)=>{if(Pn(i)){if(e.indexOf(i)>=0)return;if(!("toJSON"in i)){e[r]=i;const s=At(i)?[]:{};return Gt(i,(o,l)=>{const f=t(o,r+1);!Kt(f)&&(s[l]=f)}),e[r]=void 0,s}}return i};return t(n,0)},ou=Ee("AsyncFunction"),au=n=>n&&(Pn(n)||fe(n))&&fe(n.then)&&fe(n.catch),Ys=((n,e)=>n?setImmediate:e?((t,i)=>(Xe.addEventListener("message",({source:r,data:s})=>{r===Xe&&s===t&&i.length&&i.shift()()},!1),r=>{i.push(r),Xe.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",fe(Xe.postMessage)),cu=typeof queueMicrotask<"u"?queueMicrotask.bind(Xe):typeof Ut<"u"&&Ut.nextTick||Ys,E={isArray:At,isArrayBuffer:qs,isBuffer:Rc,isFormData:Lc,isArrayBufferView:Cc,isString:Ic,isNumber:Ws,isBoolean:Ac,isObject:Pn,isPlainObject:mn,isReadableStream:Mc,isRequest:Dc,isResponse:Bc,isHeaders:Uc,isUndefined:Kt,isDate:Nc,isFile:vc,isBlob:Oc,isRegExp:Qc,isFunction:fe,isStream:Pc,isURLSearchParams:Fc,isTypedArray:Jc,isFileList:xc,forEach:Gt,merge:Ei,extend:Vc,trim:Kc,stripBOM:Hc,inherits:$c,toFlatObject:qc,kindOf:On,kindOfTest:Ee,endsWith:Wc,toArray:Gc,forEachEntry:jc,matchAll:zc,isHTMLForm:Yc,hasOwnProperty:Nr,hasOwnProp:Nr,reduceDescriptors:js,freezeMethods:Zc,toObjectSet:eu,toCamelCase:Xc,noop:tu,toFiniteNumber:nu,findKey:Gs,global:Xe,isContextDefined:Js,ALPHABET:zs,generateString:iu,isSpecCompliantForm:ru,toJSONObject:su,isAsyncFn:ou,isThenable:au,setImmediate:Ys,asap:cu};var Xs={},Ln={};Ln.byteLength=du;Ln.toByteArray=fu;Ln.fromByteArray=gu;var ke=[],pe=[],uu=typeof Uint8Array<"u"?Uint8Array:Array,Qn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var ht=0,lu=Qn.length;ht<lu;++ht)ke[ht]=Qn[ht],pe[Qn.charCodeAt(ht)]=ht;pe[45]=62;pe[95]=63;function Qs(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var i=t===e?0:4-t%4;return[t,i]}function du(n){var e=Qs(n),t=e[0],i=e[1];return(t+i)*3/4-i}function hu(n,e,t){return(e+t)*3/4-t}function fu(n){var e,t=Qs(n),i=t[0],r=t[1],s=new uu(hu(n,i,r)),o=0,l=r>0?i-4:i,f;for(f=0;f<l;f+=4)e=pe[n.charCodeAt(f)]<<18|pe[n.charCodeAt(f+1)]<<12|pe[n.charCodeAt(f+2)]<<6|pe[n.charCodeAt(f+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return r===2&&(e=pe[n.charCodeAt(f)]<<2|pe[n.charCodeAt(f+1)]>>4,s[o++]=e&255),r===1&&(e=pe[n.charCodeAt(f)]<<10|pe[n.charCodeAt(f+1)]<<4|pe[n.charCodeAt(f+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function mu(n){return ke[n>>18&63]+ke[n>>12&63]+ke[n>>6&63]+ke[n&63]}function pu(n,e,t){for(var i,r=[],s=e;s<t;s+=3)i=(n[s]<<16&16711680)+(n[s+1]<<8&65280)+(n[s+2]&255),r.push(mu(i));return r.join("")}function gu(n){for(var e,t=n.length,i=t%3,r=[],s=16383,o=0,l=t-i;o<l;o+=s)r.push(pu(n,o,o+s>l?l:o+s));return i===1?(e=n[t-1],r.push(ke[e>>2]+ke[e<<4&63]+"==")):i===2&&(e=(n[t-2]<<8)+n[t-1],r.push(ke[e>>10]+ke[e>>4&63]+ke[e<<2&63]+"=")),r.join("")}var Hi={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Hi.read=function(n,e,t,i,r){var s,o,l=r*8-i-1,f=(1<<l)-1,h=f>>1,u=-7,p=t?r-1:0,_=t?-1:1,R=n[e+p];for(p+=_,s=R&(1<<-u)-1,R>>=-u,u+=l;u>0;s=s*256+n[e+p],p+=_,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=i;u>0;o=o*256+n[e+p],p+=_,u-=8);if(s===0)s=1-h;else{if(s===f)return o?NaN:(R?-1:1)*(1/0);o=o+Math.pow(2,i),s=s-h}return(R?-1:1)*o*Math.pow(2,s-i)};Hi.write=function(n,e,t,i,r,s){var o,l,f,h=s*8-r-1,u=(1<<h)-1,p=u>>1,_=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=i?0:s-1,b=i?1:-1,C=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(f=Math.pow(2,-o))<1&&(o--,f*=2),o+p>=1?e+=_/f:e+=_*Math.pow(2,1-p),e*f>=2&&(o++,f/=2),o+p>=u?(l=0,o=u):o+p>=1?(l=(e*f-1)*Math.pow(2,r),o=o+p):(l=e*Math.pow(2,p-1)*Math.pow(2,r),o=0));r>=8;n[t+R]=l&255,R+=b,l/=256,r-=8);for(o=o<<r|l,h+=r;h>0;n[t+R]=o&255,R+=b,o/=256,h-=8);n[t+R-b]|=C*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(n){const e=Ln,t=Hi,i=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=u,n.SlowBuffer=v,n.INSPECT_MAX_BYTES=50;const r=2147483647;n.kMaxLength=r;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:l}=globalThis;u.TYPED_ARRAY_SUPPORT=f(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function f(){try{const d=new s(1),a={foo:function(){return 42}};return Object.setPrototypeOf(a,s.prototype),Object.setPrototypeOf(d,a),d.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function h(d){if(d>r)throw new RangeError('The value "'+d+'" is invalid for option "size"');const a=new s(d);return Object.setPrototypeOf(a,u.prototype),a}function u(d,a,c){if(typeof d=="number"){if(typeof a=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return b(d)}return p(d,a,c)}u.poolSize=8192;function p(d,a,c){if(typeof d=="string")return C(d,a);if(o.isView(d))return x(d);if(d==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof d);if(Te(d,o)||d&&Te(d.buffer,o)||typeof l<"u"&&(Te(d,l)||d&&Te(d.buffer,l)))return N(d,a,c);if(typeof d=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const m=d.valueOf&&d.valueOf();if(m!=null&&m!==d)return u.from(m,a,c);const g=A(d);if(g)return g;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof d[Symbol.toPrimitive]=="function")return u.from(d[Symbol.toPrimitive]("string"),a,c);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof d)}u.from=function(d,a,c){return p(d,a,c)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function _(d){if(typeof d!="number")throw new TypeError('"size" argument must be of type number');if(d<0)throw new RangeError('The value "'+d+'" is invalid for option "size"')}function R(d,a,c){return _(d),d<=0?h(d):a!==void 0?typeof c=="string"?h(d).fill(a,c):h(d).fill(a):h(d)}u.alloc=function(d,a,c){return R(d,a,c)};function b(d){return _(d),h(d<0?0:O(d)|0)}u.allocUnsafe=function(d){return b(d)},u.allocUnsafeSlow=function(d){return b(d)};function C(d,a){if((typeof a!="string"||a==="")&&(a="utf8"),!u.isEncoding(a))throw new TypeError("Unknown encoding: "+a);const c=q(d,a)|0;let m=h(c);const g=m.write(d,a);return g!==c&&(m=m.slice(0,g)),m}function k(d){const a=d.length<0?0:O(d.length)|0,c=h(a);for(let m=0;m<a;m+=1)c[m]=d[m]&255;return c}function x(d){if(Te(d,s)){const a=new s(d);return N(a.buffer,a.byteOffset,a.byteLength)}return k(d)}function N(d,a,c){if(a<0||d.byteLength<a)throw new RangeError('"offset" is outside of buffer bounds');if(d.byteLength<a+(c||0))throw new RangeError('"length" is outside of buffer bounds');let m;return a===void 0&&c===void 0?m=new s(d):c===void 0?m=new s(d,a):m=new s(d,a,c),Object.setPrototypeOf(m,u.prototype),m}function A(d){if(u.isBuffer(d)){const a=O(d.length)|0,c=h(a);return c.length===0||d.copy(c,0,0,a),c}if(d.length!==void 0)return typeof d.length!="number"||Yn(d.length)?h(0):k(d);if(d.type==="Buffer"&&Array.isArray(d.data))return k(d.data)}function O(d){if(d>=r)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r.toString(16)+" bytes");return d|0}function v(d){return+d!=d&&(d=0),u.alloc(+d)}u.isBuffer=function(a){return a!=null&&a._isBuffer===!0&&a!==u.prototype},u.compare=function(a,c){if(Te(a,s)&&(a=u.from(a,a.offset,a.byteLength)),Te(c,s)&&(c=u.from(c,c.offset,c.byteLength)),!u.isBuffer(a)||!u.isBuffer(c))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(a===c)return 0;let m=a.length,g=c.length;for(let y=0,T=Math.min(m,g);y<T;++y)if(a[y]!==c[y]){m=a[y],g=c[y];break}return m<g?-1:g<m?1:0},u.isEncoding=function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(a,c){if(!Array.isArray(a))throw new TypeError('"list" argument must be an Array of Buffers');if(a.length===0)return u.alloc(0);let m;if(c===void 0)for(c=0,m=0;m<a.length;++m)c+=a[m].length;const g=u.allocUnsafe(c);let y=0;for(m=0;m<a.length;++m){let T=a[m];if(Te(T,s))y+T.length>g.length?(u.isBuffer(T)||(T=u.from(T)),T.copy(g,y)):s.prototype.set.call(g,T,y);else if(u.isBuffer(T))T.copy(g,y);else throw new TypeError('"list" argument must be an Array of Buffers');y+=T.length}return g};function q(d,a){if(u.isBuffer(d))return d.length;if(o.isView(d)||Te(d,o))return d.byteLength;if(typeof d!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof d);const c=d.length,m=arguments.length>2&&arguments[2]===!0;if(!m&&c===0)return 0;let g=!1;for(;;)switch(a){case"ascii":case"latin1":case"binary":return c;case"utf8":case"utf-8":return zn(d).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c*2;case"hex":return c>>>1;case"base64":return Er(d).length;default:if(g)return m?-1:zn(d).length;a=(""+a).toLowerCase(),g=!0}}u.byteLength=q;function se(d,a,c){let m=!1;if((a===void 0||a<0)&&(a=0),a>this.length||((c===void 0||c>this.length)&&(c=this.length),c<=0)||(c>>>=0,a>>>=0,c<=a))return"";for(d||(d="utf8");;)switch(d){case"hex":return ct(this,a,c);case"utf8":case"utf-8":return Jn(this,a,c);case"ascii":return je(this,a,c);case"latin1":case"binary":return oe(this,a,c);case"base64":return Gn(this,a,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return cn(this,a,c);default:if(m)throw new TypeError("Unknown encoding: "+d);d=(d+"").toLowerCase(),m=!0}}u.prototype._isBuffer=!0;function X(d,a,c){const m=d[a];d[a]=d[c],d[c]=m}u.prototype.swap16=function(){const a=this.length;if(a%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let c=0;c<a;c+=2)X(this,c,c+1);return this},u.prototype.swap32=function(){const a=this.length;if(a%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let c=0;c<a;c+=4)X(this,c,c+3),X(this,c+1,c+2);return this},u.prototype.swap64=function(){const a=this.length;if(a%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let c=0;c<a;c+=8)X(this,c,c+7),X(this,c+1,c+6),X(this,c+2,c+5),X(this,c+3,c+4);return this},u.prototype.toString=function(){const a=this.length;return a===0?"":arguments.length===0?Jn(this,0,a):se.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(a){if(!u.isBuffer(a))throw new TypeError("Argument must be a Buffer");return this===a?!0:u.compare(this,a)===0},u.prototype.inspect=function(){let a="";const c=n.INSPECT_MAX_BYTES;return a=this.toString("hex",0,c).replace(/(.{2})/g,"$1 ").trim(),this.length>c&&(a+=" ... "),"<Buffer "+a+">"},i&&(u.prototype[i]=u.prototype.inspect),u.prototype.compare=function(a,c,m,g,y){if(Te(a,s)&&(a=u.from(a,a.offset,a.byteLength)),!u.isBuffer(a))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof a);if(c===void 0&&(c=0),m===void 0&&(m=a?a.length:0),g===void 0&&(g=0),y===void 0&&(y=this.length),c<0||m>a.length||g<0||y>this.length)throw new RangeError("out of range index");if(g>=y&&c>=m)return 0;if(g>=y)return-1;if(c>=m)return 1;if(c>>>=0,m>>>=0,g>>>=0,y>>>=0,this===a)return 0;let T=y-g,L=m-c;const j=Math.min(T,L),W=this.slice(g,y),z=a.slice(c,m);for(let K=0;K<j;++K)if(W[K]!==z[K]){T=W[K],L=z[K];break}return T<L?-1:L<T?1:0};function Re(d,a,c,m,g){if(d.length===0)return-1;if(typeof c=="string"?(m=c,c=0):c>2147483647?c=2147483647:c<-2147483648&&(c=-2147483648),c=+c,Yn(c)&&(c=g?0:d.length-1),c<0&&(c=d.length+c),c>=d.length){if(g)return-1;c=d.length-1}else if(c<0)if(g)c=0;else return-1;if(typeof a=="string"&&(a=u.from(a,m)),u.isBuffer(a))return a.length===0?-1:on(d,a,c,m,g);if(typeof a=="number")return a=a&255,typeof s.prototype.indexOf=="function"?g?s.prototype.indexOf.call(d,a,c):s.prototype.lastIndexOf.call(d,a,c):on(d,[a],c,m,g);throw new TypeError("val must be string, number or Buffer")}function on(d,a,c,m,g){let y=1,T=d.length,L=a.length;if(m!==void 0&&(m=String(m).toLowerCase(),m==="ucs2"||m==="ucs-2"||m==="utf16le"||m==="utf-16le")){if(d.length<2||a.length<2)return-1;y=2,T/=2,L/=2,c/=2}function j(z,K){return y===1?z[K]:z.readUInt16BE(K*y)}let W;if(g){let z=-1;for(W=c;W<T;W++)if(j(d,W)===j(a,z===-1?0:W-z)){if(z===-1&&(z=W),W-z+1===L)return z*y}else z!==-1&&(W-=W-z),z=-1}else for(c+L>T&&(c=T-L),W=c;W>=0;W--){let z=!0;for(let K=0;K<L;K++)if(j(d,W+K)!==j(a,K)){z=!1;break}if(z)return W}return-1}u.prototype.includes=function(a,c,m){return this.indexOf(a,c,m)!==-1},u.prototype.indexOf=function(a,c,m){return Re(this,a,c,m,!0)},u.prototype.lastIndexOf=function(a,c,m){return Re(this,a,c,m,!1)};function ae(d,a,c,m){c=Number(c)||0;const g=d.length-c;m?(m=Number(m),m>g&&(m=g)):m=g;const y=a.length;m>y/2&&(m=y/2);let T;for(T=0;T<m;++T){const L=parseInt(a.substr(T*2,2),16);if(Yn(L))return T;d[c+T]=L}return T}function ge(d,a,c,m){return un(zn(a,d.length-c),d,c,m)}function Je(d,a,c,m){return un(Ga(a),d,c,m)}function ie(d,a,c,m){return un(Er(a),d,c,m)}function Wn(d,a,c,m){return un(Ja(a,d.length-c),d,c,m)}u.prototype.write=function(a,c,m,g){if(c===void 0)g="utf8",m=this.length,c=0;else if(m===void 0&&typeof c=="string")g=c,m=this.length,c=0;else if(isFinite(c))c=c>>>0,isFinite(m)?(m=m>>>0,g===void 0&&(g="utf8")):(g=m,m=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const y=this.length-c;if((m===void 0||m>y)&&(m=y),a.length>0&&(m<0||c<0)||c>this.length)throw new RangeError("Attempt to write outside buffer bounds");g||(g="utf8");let T=!1;for(;;)switch(g){case"hex":return ae(this,a,c,m);case"utf8":case"utf-8":return ge(this,a,c,m);case"ascii":case"latin1":case"binary":return Je(this,a,c,m);case"base64":return ie(this,a,c,m);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Wn(this,a,c,m);default:if(T)throw new TypeError("Unknown encoding: "+g);g=(""+g).toLowerCase(),T=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Gn(d,a,c){return a===0&&c===d.length?e.fromByteArray(d):e.fromByteArray(d.slice(a,c))}function Jn(d,a,c){c=Math.min(d.length,c);const m=[];let g=a;for(;g<c;){const y=d[g];let T=null,L=y>239?4:y>223?3:y>191?2:1;if(g+L<=c){let j,W,z,K;switch(L){case 1:y<128&&(T=y);break;case 2:j=d[g+1],(j&192)===128&&(K=(y&31)<<6|j&63,K>127&&(T=K));break;case 3:j=d[g+1],W=d[g+2],(j&192)===128&&(W&192)===128&&(K=(y&15)<<12|(j&63)<<6|W&63,K>2047&&(K<55296||K>57343)&&(T=K));break;case 4:j=d[g+1],W=d[g+2],z=d[g+3],(j&192)===128&&(W&192)===128&&(z&192)===128&&(K=(y&15)<<18|(j&63)<<12|(W&63)<<6|z&63,K>65535&&K<1114112&&(T=K))}}T===null?(T=65533,L=1):T>65535&&(T-=65536,m.push(T>>>10&1023|55296),T=56320|T&1023),m.push(T),g+=L}return J(m)}const an=4096;function J(d){const a=d.length;if(a<=an)return String.fromCharCode.apply(String,d);let c="",m=0;for(;m<a;)c+=String.fromCharCode.apply(String,d.slice(m,m+=an));return c}function je(d,a,c){let m="";c=Math.min(d.length,c);for(let g=a;g<c;++g)m+=String.fromCharCode(d[g]&127);return m}function oe(d,a,c){let m="";c=Math.min(d.length,c);for(let g=a;g<c;++g)m+=String.fromCharCode(d[g]);return m}function ct(d,a,c){const m=d.length;(!a||a<0)&&(a=0),(!c||c<0||c>m)&&(c=m);let g="";for(let y=a;y<c;++y)g+=ja[d[y]];return g}function cn(d,a,c){const m=d.slice(a,c);let g="";for(let y=0;y<m.length-1;y+=2)g+=String.fromCharCode(m[y]+m[y+1]*256);return g}u.prototype.slice=function(a,c){const m=this.length;a=~~a,c=c===void 0?m:~~c,a<0?(a+=m,a<0&&(a=0)):a>m&&(a=m),c<0?(c+=m,c<0&&(c=0)):c>m&&(c=m),c<a&&(c=a);const g=this.subarray(a,c);return Object.setPrototypeOf(g,u.prototype),g};function Q(d,a,c){if(d%1!==0||d<0)throw new RangeError("offset is not uint");if(d+a>c)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(a,c,m){a=a>>>0,c=c>>>0,m||Q(a,c,this.length);let g=this[a],y=1,T=0;for(;++T<c&&(y*=256);)g+=this[a+T]*y;return g},u.prototype.readUintBE=u.prototype.readUIntBE=function(a,c,m){a=a>>>0,c=c>>>0,m||Q(a,c,this.length);let g=this[a+--c],y=1;for(;c>0&&(y*=256);)g+=this[a+--c]*y;return g},u.prototype.readUint8=u.prototype.readUInt8=function(a,c){return a=a>>>0,c||Q(a,1,this.length),this[a]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(a,c){return a=a>>>0,c||Q(a,2,this.length),this[a]|this[a+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(a,c){return a=a>>>0,c||Q(a,2,this.length),this[a]<<8|this[a+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(a,c){return a=a>>>0,c||Q(a,4,this.length),(this[a]|this[a+1]<<8|this[a+2]<<16)+this[a+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(a,c){return a=a>>>0,c||Q(a,4,this.length),this[a]*16777216+(this[a+1]<<16|this[a+2]<<8|this[a+3])},u.prototype.readBigUInt64LE=Fe(function(a){a=a>>>0,lt(a,"offset");const c=this[a],m=this[a+7];(c===void 0||m===void 0)&&Ot(a,this.length-8);const g=c+this[++a]*2**8+this[++a]*2**16+this[++a]*2**24,y=this[++a]+this[++a]*2**8+this[++a]*2**16+m*2**24;return BigInt(g)+(BigInt(y)<<BigInt(32))}),u.prototype.readBigUInt64BE=Fe(function(a){a=a>>>0,lt(a,"offset");const c=this[a],m=this[a+7];(c===void 0||m===void 0)&&Ot(a,this.length-8);const g=c*2**24+this[++a]*2**16+this[++a]*2**8+this[++a],y=this[++a]*2**24+this[++a]*2**16+this[++a]*2**8+m;return(BigInt(g)<<BigInt(32))+BigInt(y)}),u.prototype.readIntLE=function(a,c,m){a=a>>>0,c=c>>>0,m||Q(a,c,this.length);let g=this[a],y=1,T=0;for(;++T<c&&(y*=256);)g+=this[a+T]*y;return y*=128,g>=y&&(g-=Math.pow(2,8*c)),g},u.prototype.readIntBE=function(a,c,m){a=a>>>0,c=c>>>0,m||Q(a,c,this.length);let g=c,y=1,T=this[a+--g];for(;g>0&&(y*=256);)T+=this[a+--g]*y;return y*=128,T>=y&&(T-=Math.pow(2,8*c)),T},u.prototype.readInt8=function(a,c){return a=a>>>0,c||Q(a,1,this.length),this[a]&128?(255-this[a]+1)*-1:this[a]},u.prototype.readInt16LE=function(a,c){a=a>>>0,c||Q(a,2,this.length);const m=this[a]|this[a+1]<<8;return m&32768?m|4294901760:m},u.prototype.readInt16BE=function(a,c){a=a>>>0,c||Q(a,2,this.length);const m=this[a+1]|this[a]<<8;return m&32768?m|4294901760:m},u.prototype.readInt32LE=function(a,c){return a=a>>>0,c||Q(a,4,this.length),this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24},u.prototype.readInt32BE=function(a,c){return a=a>>>0,c||Q(a,4,this.length),this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]},u.prototype.readBigInt64LE=Fe(function(a){a=a>>>0,lt(a,"offset");const c=this[a],m=this[a+7];(c===void 0||m===void 0)&&Ot(a,this.length-8);const g=this[a+4]+this[a+5]*2**8+this[a+6]*2**16+(m<<24);return(BigInt(g)<<BigInt(32))+BigInt(c+this[++a]*2**8+this[++a]*2**16+this[++a]*2**24)}),u.prototype.readBigInt64BE=Fe(function(a){a=a>>>0,lt(a,"offset");const c=this[a],m=this[a+7];(c===void 0||m===void 0)&&Ot(a,this.length-8);const g=(c<<24)+this[++a]*2**16+this[++a]*2**8+this[++a];return(BigInt(g)<<BigInt(32))+BigInt(this[++a]*2**24+this[++a]*2**16+this[++a]*2**8+m)}),u.prototype.readFloatLE=function(a,c){return a=a>>>0,c||Q(a,4,this.length),t.read(this,a,!0,23,4)},u.prototype.readFloatBE=function(a,c){return a=a>>>0,c||Q(a,4,this.length),t.read(this,a,!1,23,4)},u.prototype.readDoubleLE=function(a,c){return a=a>>>0,c||Q(a,8,this.length),t.read(this,a,!0,52,8)},u.prototype.readDoubleBE=function(a,c){return a=a>>>0,c||Q(a,8,this.length),t.read(this,a,!1,52,8)};function re(d,a,c,m,g,y){if(!u.isBuffer(d))throw new TypeError('"buffer" argument must be a Buffer instance');if(a>g||a<y)throw new RangeError('"value" argument is out of bounds');if(c+m>d.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(a,c,m,g){if(a=+a,c=c>>>0,m=m>>>0,!g){const L=Math.pow(2,8*m)-1;re(this,a,c,m,L,0)}let y=1,T=0;for(this[c]=a&255;++T<m&&(y*=256);)this[c+T]=a/y&255;return c+m},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(a,c,m,g){if(a=+a,c=c>>>0,m=m>>>0,!g){const L=Math.pow(2,8*m)-1;re(this,a,c,m,L,0)}let y=m-1,T=1;for(this[c+y]=a&255;--y>=0&&(T*=256);)this[c+y]=a/T&255;return c+m},u.prototype.writeUint8=u.prototype.writeUInt8=function(a,c,m){return a=+a,c=c>>>0,m||re(this,a,c,1,255,0),this[c]=a&255,c+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(a,c,m){return a=+a,c=c>>>0,m||re(this,a,c,2,65535,0),this[c]=a&255,this[c+1]=a>>>8,c+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(a,c,m){return a=+a,c=c>>>0,m||re(this,a,c,2,65535,0),this[c]=a>>>8,this[c+1]=a&255,c+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(a,c,m){return a=+a,c=c>>>0,m||re(this,a,c,4,4294967295,0),this[c+3]=a>>>24,this[c+2]=a>>>16,this[c+1]=a>>>8,this[c]=a&255,c+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(a,c,m){return a=+a,c=c>>>0,m||re(this,a,c,4,4294967295,0),this[c]=a>>>24,this[c+1]=a>>>16,this[c+2]=a>>>8,this[c+3]=a&255,c+4};function hr(d,a,c,m,g){yr(a,m,g,d,c,7);let y=Number(a&BigInt(4294967295));d[c++]=y,y=y>>8,d[c++]=y,y=y>>8,d[c++]=y,y=y>>8,d[c++]=y;let T=Number(a>>BigInt(32)&BigInt(4294967295));return d[c++]=T,T=T>>8,d[c++]=T,T=T>>8,d[c++]=T,T=T>>8,d[c++]=T,c}function fr(d,a,c,m,g){yr(a,m,g,d,c,7);let y=Number(a&BigInt(4294967295));d[c+7]=y,y=y>>8,d[c+6]=y,y=y>>8,d[c+5]=y,y=y>>8,d[c+4]=y;let T=Number(a>>BigInt(32)&BigInt(4294967295));return d[c+3]=T,T=T>>8,d[c+2]=T,T=T>>8,d[c+1]=T,T=T>>8,d[c]=T,c+8}u.prototype.writeBigUInt64LE=Fe(function(a,c=0){return hr(this,a,c,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Fe(function(a,c=0){return fr(this,a,c,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(a,c,m,g){if(a=+a,c=c>>>0,!g){const j=Math.pow(2,8*m-1);re(this,a,c,m,j-1,-j)}let y=0,T=1,L=0;for(this[c]=a&255;++y<m&&(T*=256);)a<0&&L===0&&this[c+y-1]!==0&&(L=1),this[c+y]=(a/T>>0)-L&255;return c+m},u.prototype.writeIntBE=function(a,c,m,g){if(a=+a,c=c>>>0,!g){const j=Math.pow(2,8*m-1);re(this,a,c,m,j-1,-j)}let y=m-1,T=1,L=0;for(this[c+y]=a&255;--y>=0&&(T*=256);)a<0&&L===0&&this[c+y+1]!==0&&(L=1),this[c+y]=(a/T>>0)-L&255;return c+m},u.prototype.writeInt8=function(a,c,m){return a=+a,c=c>>>0,m||re(this,a,c,1,127,-128),a<0&&(a=255+a+1),this[c]=a&255,c+1},u.prototype.writeInt16LE=function(a,c,m){return a=+a,c=c>>>0,m||re(this,a,c,2,32767,-32768),this[c]=a&255,this[c+1]=a>>>8,c+2},u.prototype.writeInt16BE=function(a,c,m){return a=+a,c=c>>>0,m||re(this,a,c,2,32767,-32768),this[c]=a>>>8,this[c+1]=a&255,c+2},u.prototype.writeInt32LE=function(a,c,m){return a=+a,c=c>>>0,m||re(this,a,c,4,2147483647,-2147483648),this[c]=a&255,this[c+1]=a>>>8,this[c+2]=a>>>16,this[c+3]=a>>>24,c+4},u.prototype.writeInt32BE=function(a,c,m){return a=+a,c=c>>>0,m||re(this,a,c,4,2147483647,-2147483648),a<0&&(a=4294967295+a+1),this[c]=a>>>24,this[c+1]=a>>>16,this[c+2]=a>>>8,this[c+3]=a&255,c+4},u.prototype.writeBigInt64LE=Fe(function(a,c=0){return hr(this,a,c,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Fe(function(a,c=0){return fr(this,a,c,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function mr(d,a,c,m,g,y){if(c+m>d.length)throw new RangeError("Index out of range");if(c<0)throw new RangeError("Index out of range")}function pr(d,a,c,m,g){return a=+a,c=c>>>0,g||mr(d,a,c,4),t.write(d,a,c,m,23,4),c+4}u.prototype.writeFloatLE=function(a,c,m){return pr(this,a,c,!0,m)},u.prototype.writeFloatBE=function(a,c,m){return pr(this,a,c,!1,m)};function gr(d,a,c,m,g){return a=+a,c=c>>>0,g||mr(d,a,c,8),t.write(d,a,c,m,52,8),c+8}u.prototype.writeDoubleLE=function(a,c,m){return gr(this,a,c,!0,m)},u.prototype.writeDoubleBE=function(a,c,m){return gr(this,a,c,!1,m)},u.prototype.copy=function(a,c,m,g){if(!u.isBuffer(a))throw new TypeError("argument should be a Buffer");if(m||(m=0),!g&&g!==0&&(g=this.length),c>=a.length&&(c=a.length),c||(c=0),g>0&&g<m&&(g=m),g===m||a.length===0||this.length===0)return 0;if(c<0)throw new RangeError("targetStart out of bounds");if(m<0||m>=this.length)throw new RangeError("Index out of range");if(g<0)throw new RangeError("sourceEnd out of bounds");g>this.length&&(g=this.length),a.length-c<g-m&&(g=a.length-c+m);const y=g-m;return this===a&&typeof s.prototype.copyWithin=="function"?this.copyWithin(c,m,g):s.prototype.set.call(a,this.subarray(m,g),c),y},u.prototype.fill=function(a,c,m,g){if(typeof a=="string"){if(typeof c=="string"?(g=c,c=0,m=this.length):typeof m=="string"&&(g=m,m=this.length),g!==void 0&&typeof g!="string")throw new TypeError("encoding must be a string");if(typeof g=="string"&&!u.isEncoding(g))throw new TypeError("Unknown encoding: "+g);if(a.length===1){const T=a.charCodeAt(0);(g==="utf8"&&T<128||g==="latin1")&&(a=T)}}else typeof a=="number"?a=a&255:typeof a=="boolean"&&(a=Number(a));if(c<0||this.length<c||this.length<m)throw new RangeError("Out of range index");if(m<=c)return this;c=c>>>0,m=m===void 0?this.length:m>>>0,a||(a=0);let y;if(typeof a=="number")for(y=c;y<m;++y)this[y]=a;else{const T=u.isBuffer(a)?a:u.from(a,g),L=T.length;if(L===0)throw new TypeError('The value "'+a+'" is invalid for argument "value"');for(y=0;y<m-c;++y)this[y+c]=T[y%L]}return this};const ut={};function jn(d,a,c){ut[d]=class extends c{constructor(){super(),Object.defineProperty(this,"message",{value:a.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${d}]`,this.stack,delete this.name}get code(){return d}set code(g){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:g,writable:!0})}toString(){return`${this.name} [${d}]: ${this.message}`}}}jn("ERR_BUFFER_OUT_OF_BOUNDS",function(d){return d?`${d} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),jn("ERR_INVALID_ARG_TYPE",function(d,a){return`The "${d}" argument must be of type number. Received type ${typeof a}`},TypeError),jn("ERR_OUT_OF_RANGE",function(d,a,c){let m=`The value of "${d}" is out of range.`,g=c;return Number.isInteger(c)&&Math.abs(c)>2**32?g=_r(String(c)):typeof c=="bigint"&&(g=String(c),(c>BigInt(2)**BigInt(32)||c<-(BigInt(2)**BigInt(32)))&&(g=_r(g)),g+="n"),m+=` It must be ${a}. Received ${g}`,m},RangeError);function _r(d){let a="",c=d.length;const m=d[0]==="-"?1:0;for(;c>=m+4;c-=3)a=`_${d.slice(c-3,c)}${a}`;return`${d.slice(0,c)}${a}`}function $a(d,a,c){lt(a,"offset"),(d[a]===void 0||d[a+c]===void 0)&&Ot(a,d.length-(c+1))}function yr(d,a,c,m,g,y){if(d>c||d<a){const T=typeof a=="bigint"?"n":"";let L;throw a===0||a===BigInt(0)?L=`>= 0${T} and < 2${T} ** ${(y+1)*8}${T}`:L=`>= -(2${T} ** ${(y+1)*8-1}${T}) and < 2 ** ${(y+1)*8-1}${T}`,new ut.ERR_OUT_OF_RANGE("value",L,d)}$a(m,g,y)}function lt(d,a){if(typeof d!="number")throw new ut.ERR_INVALID_ARG_TYPE(a,"number",d)}function Ot(d,a,c){throw Math.floor(d)!==d?(lt(d,c),new ut.ERR_OUT_OF_RANGE("offset","an integer",d)):a<0?new ut.ERR_BUFFER_OUT_OF_BOUNDS:new ut.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${a}`,d)}const qa=/[^+/0-9A-Za-z-_]/g;function Wa(d){if(d=d.split("=")[0],d=d.trim().replace(qa,""),d.length<2)return"";for(;d.length%4!==0;)d=d+"=";return d}function zn(d,a){a=a||1/0;let c;const m=d.length;let g=null;const y=[];for(let T=0;T<m;++T){if(c=d.charCodeAt(T),c>55295&&c<57344){if(!g){if(c>56319){(a-=3)>-1&&y.push(239,191,189);continue}else if(T+1===m){(a-=3)>-1&&y.push(239,191,189);continue}g=c;continue}if(c<56320){(a-=3)>-1&&y.push(239,191,189),g=c;continue}c=(g-55296<<10|c-56320)+65536}else g&&(a-=3)>-1&&y.push(239,191,189);if(g=null,c<128){if((a-=1)<0)break;y.push(c)}else if(c<2048){if((a-=2)<0)break;y.push(c>>6|192,c&63|128)}else if(c<65536){if((a-=3)<0)break;y.push(c>>12|224,c>>6&63|128,c&63|128)}else if(c<1114112){if((a-=4)<0)break;y.push(c>>18|240,c>>12&63|128,c>>6&63|128,c&63|128)}else throw new Error("Invalid code point")}return y}function Ga(d){const a=[];for(let c=0;c<d.length;++c)a.push(d.charCodeAt(c)&255);return a}function Ja(d,a){let c,m,g;const y=[];for(let T=0;T<d.length&&!((a-=2)<0);++T)c=d.charCodeAt(T),m=c>>8,g=c%256,y.push(g),y.push(m);return y}function Er(d){return e.toByteArray(Wa(d))}function un(d,a,c,m){let g;for(g=0;g<m&&!(g+c>=a.length||g>=d.length);++g)a[g+c]=d[g];return g}function Te(d,a){return d instanceof a||d!=null&&d.constructor!=null&&d.constructor.name!=null&&d.constructor.name===a.name}function Yn(d){return d!==d}const ja=function(){const d="0123456789abcdef",a=new Array(256);for(let c=0;c<16;++c){const m=c*16;for(let g=0;g<16;++g)a[m+g]=d[c]+d[g]}return a}();function Fe(d){return typeof BigInt>"u"?za:d}function za(){throw new Error("BigInt not supported")}})(Xs);const _u=Xs.Buffer;function P(n,e,t,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}E.inherits(P,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:E.toJSONObject(this.config),code:this.code,status:this.status}}});const Zs=P.prototype,eo={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{eo[n]={value:n}});Object.defineProperties(P,eo);Object.defineProperty(Zs,"isAxiosError",{value:!0});P.from=(n,e,t,i,r,s)=>{const o=Object.create(Zs);return E.toFlatObject(n,o,function(f){return f!==Error.prototype},l=>l!=="isAxiosError"),P.call(o,n.message,e,t,i,r),o.cause=n,o.name=n.name,s&&Object.assign(o,s),o};const yu=null;function Ti(n){return E.isPlainObject(n)||E.isArray(n)}function to(n){return E.endsWith(n,"[]")?n.slice(0,-2):n}function Or(n,e,t){return n?n.concat(e).map(function(r,s){return r=to(r),!t&&s?"["+r+"]":r}).join(t?".":""):e}function Eu(n){return E.isArray(n)&&!n.some(Ti)}const Tu=E.toFlatObject(E,{},null,function(e){return/^is[A-Z]/.test(e)});function Fn(n,e,t){if(!E.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=E.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(C,k){return!E.isUndefined(k[C])});const i=t.metaTokens,r=t.visitor||u,s=t.dots,o=t.indexes,f=(t.Blob||typeof Blob<"u"&&Blob)&&E.isSpecCompliantForm(e);if(!E.isFunction(r))throw new TypeError("visitor must be a function");function h(b){if(b===null)return"";if(E.isDate(b))return b.toISOString();if(!f&&E.isBlob(b))throw new P("Blob is not supported. Use a Buffer instead.");return E.isArrayBuffer(b)||E.isTypedArray(b)?f&&typeof Blob=="function"?new Blob([b]):_u.from(b):b}function u(b,C,k){let x=b;if(b&&!k&&typeof b=="object"){if(E.endsWith(C,"{}"))C=i?C:C.slice(0,-2),b=JSON.stringify(b);else if(E.isArray(b)&&Eu(b)||(E.isFileList(b)||E.endsWith(C,"[]"))&&(x=E.toArray(b)))return C=to(C),x.forEach(function(A,O){!(E.isUndefined(A)||A===null)&&e.append(o===!0?Or([C],O,s):o===null?C:C+"[]",h(A))}),!1}return Ti(b)?!0:(e.append(Or(k,C,s),h(b)),!1)}const p=[],_=Object.assign(Tu,{defaultVisitor:u,convertValue:h,isVisitable:Ti});function R(b,C){if(!E.isUndefined(b)){if(p.indexOf(b)!==-1)throw Error("Circular reference detected in "+C.join("."));p.push(b),E.forEach(b,function(x,N){(!(E.isUndefined(x)||x===null)&&r.call(e,x,E.isString(N)?N.trim():N,C,_))===!0&&R(x,C?C.concat(N):[N])}),p.pop()}}if(!E.isObject(n))throw new TypeError("data must be an object");return R(n),e}function xr(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(i){return e[i]})}function $i(n,e){this._pairs=[],n&&Fn(n,this,e)}const no=$i.prototype;no.append=function(e,t){this._pairs.push([e,t])};no.toString=function(e){const t=e?function(i){return e.call(this,i,xr)}:xr;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};function wu(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function io(n,e,t){if(!e)return n;const i=t&&t.encode||wu,r=t&&t.serialize;let s;if(r?s=r(e,t):s=E.isURLSearchParams(e)?e.toString():new $i(e,t).toString(i),s){const o=n.indexOf("#");o!==-1&&(n=n.slice(0,o)),n+=(n.indexOf("?")===-1?"?":"&")+s}return n}class Pr{constructor(){this.handlers=[]}use(e,t,i){return this.handlers.push({fulfilled:e,rejected:t,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){E.forEach(this.handlers,function(i){i!==null&&e(i)})}}const ro={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Su=typeof URLSearchParams<"u"?URLSearchParams:$i,bu=typeof FormData<"u"?FormData:null,ku=typeof Blob<"u"?Blob:null,Ru={isBrowser:!0,classes:{URLSearchParams:Su,FormData:bu,Blob:ku},protocols:["http","https","file","blob","url","data"]},qi=typeof window<"u"&&typeof document<"u",wi=typeof navigator=="object"&&navigator||void 0,Cu=qi&&(!wi||["ReactNative","NativeScript","NS"].indexOf(wi.product)<0),Iu=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Au=qi&&window.location.href||"http://localhost",Nu=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:qi,hasStandardBrowserEnv:Cu,hasStandardBrowserWebWorkerEnv:Iu,navigator:wi,origin:Au},Symbol.toStringTag,{value:"Module"})),le={...Nu,...Ru};function vu(n,e){return Fn(n,new le.classes.URLSearchParams,Object.assign({visitor:function(t,i,r,s){return le.isNode&&E.isBuffer(t)?(this.append(i,t.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function Ou(n){return E.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function xu(n){const e={},t=Object.keys(n);let i;const r=t.length;let s;for(i=0;i<r;i++)s=t[i],e[s]=n[s];return e}function so(n){function e(t,i,r,s){let o=t[s++];if(o==="__proto__")return!0;const l=Number.isFinite(+o),f=s>=t.length;return o=!o&&E.isArray(r)?r.length:o,f?(E.hasOwnProp(r,o)?r[o]=[r[o],i]:r[o]=i,!l):((!r[o]||!E.isObject(r[o]))&&(r[o]=[]),e(t,i,r[o],s)&&E.isArray(r[o])&&(r[o]=xu(r[o])),!l)}if(E.isFormData(n)&&E.isFunction(n.entries)){const t={};return E.forEachEntry(n,(i,r)=>{e(Ou(i),r,t,0)}),t}return null}function Pu(n,e,t){if(E.isString(n))try{return(e||JSON.parse)(n),E.trim(n)}catch(i){if(i.name!=="SyntaxError")throw i}return(0,JSON.stringify)(n)}const Jt={transitional:ro,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const i=t.getContentType()||"",r=i.indexOf("application/json")>-1,s=E.isObject(e);if(s&&E.isHTMLForm(e)&&(e=new FormData(e)),E.isFormData(e))return r?JSON.stringify(so(e)):e;if(E.isArrayBuffer(e)||E.isBuffer(e)||E.isStream(e)||E.isFile(e)||E.isBlob(e)||E.isReadableStream(e))return e;if(E.isArrayBufferView(e))return e.buffer;if(E.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(s){if(i.indexOf("application/x-www-form-urlencoded")>-1)return vu(e,this.formSerializer).toString();if((l=E.isFileList(e))||i.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return Fn(l?{"files[]":e}:e,f&&new f,this.formSerializer)}}return s||r?(t.setContentType("application/json",!1),Pu(e)):e}],transformResponse:[function(e){const t=this.transitional||Jt.transitional,i=t&&t.forcedJSONParsing,r=this.responseType==="json";if(E.isResponse(e)||E.isReadableStream(e))return e;if(e&&E.isString(e)&&(i&&!this.responseType||r)){const o=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(l){if(o)throw l.name==="SyntaxError"?P.from(l,P.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:le.classes.FormData,Blob:le.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};E.forEach(["delete","get","head","post","put","patch"],n=>{Jt.headers[n]={}});const Lu=E.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Fu=n=>{const e={};let t,i,r;return n&&n.split(`
`).forEach(function(o){r=o.indexOf(":"),t=o.substring(0,r).trim().toLowerCase(),i=o.substring(r+1).trim(),!(!t||e[t]&&Lu[t])&&(t==="set-cookie"?e[t]?e[t].push(i):e[t]=[i]:e[t]=e[t]?e[t]+", "+i:i)}),e},Lr=Symbol("internals");function xt(n){return n&&String(n).trim().toLowerCase()}function pn(n){return n===!1||n==null?n:E.isArray(n)?n.map(pn):String(n)}function Mu(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=t.exec(n);)e[i[1]]=i[2];return e}const Du=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function Zn(n,e,t,i,r){if(E.isFunction(i))return i.call(this,e,t);if(r&&(e=t),!!E.isString(e)){if(E.isString(i))return e.indexOf(i)!==-1;if(E.isRegExp(i))return i.test(e)}}function Bu(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,i)=>t.toUpperCase()+i)}function Uu(n,e){const t=E.toCamelCase(" "+e);["get","set","has"].forEach(i=>{Object.defineProperty(n,i+t,{value:function(r,s,o){return this[i].call(this,e,r,s,o)},configurable:!0})})}class de{constructor(e){e&&this.set(e)}set(e,t,i){const r=this;function s(l,f,h){const u=xt(f);if(!u)throw new Error("header name must be a non-empty string");const p=E.findKey(r,u);(!p||r[p]===void 0||h===!0||h===void 0&&r[p]!==!1)&&(r[p||f]=pn(l))}const o=(l,f)=>E.forEach(l,(h,u)=>s(h,u,f));if(E.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(E.isString(e)&&(e=e.trim())&&!Du(e))o(Fu(e),t);else if(E.isHeaders(e))for(const[l,f]of e.entries())s(f,l,i);else e!=null&&s(t,e,i);return this}get(e,t){if(e=xt(e),e){const i=E.findKey(this,e);if(i){const r=this[i];if(!t)return r;if(t===!0)return Mu(r);if(E.isFunction(t))return t.call(this,r,i);if(E.isRegExp(t))return t.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=xt(e),e){const i=E.findKey(this,e);return!!(i&&this[i]!==void 0&&(!t||Zn(this,this[i],i,t)))}return!1}delete(e,t){const i=this;let r=!1;function s(o){if(o=xt(o),o){const l=E.findKey(i,o);l&&(!t||Zn(i,i[l],l,t))&&(delete i[l],r=!0)}}return E.isArray(e)?e.forEach(s):s(e),r}clear(e){const t=Object.keys(this);let i=t.length,r=!1;for(;i--;){const s=t[i];(!e||Zn(this,this[s],s,e,!0))&&(delete this[s],r=!0)}return r}normalize(e){const t=this,i={};return E.forEach(this,(r,s)=>{const o=E.findKey(i,s);if(o){t[o]=pn(r),delete t[s];return}const l=e?Bu(s):String(s).trim();l!==s&&delete t[s],t[l]=pn(r),i[l]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return E.forEach(this,(i,r)=>{i!=null&&i!==!1&&(t[r]=e&&E.isArray(i)?i.join(", "):i)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const i=new this(e);return t.forEach(r=>i.set(r)),i}static accessor(e){const i=(this[Lr]=this[Lr]={accessors:{}}).accessors,r=this.prototype;function s(o){const l=xt(o);i[l]||(Uu(r,o),i[l]=!0)}return E.isArray(e)?e.forEach(s):s(e),this}}de.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);E.reduceDescriptors(de.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(i){this[t]=i}}});E.freezeMethods(de);function ei(n,e){const t=this||Jt,i=e||t,r=de.from(i.headers);let s=i.data;return E.forEach(n,function(l){s=l.call(t,s,r.normalize(),e?e.status:void 0)}),r.normalize(),s}function oo(n){return!!(n&&n.__CANCEL__)}function Nt(n,e,t){P.call(this,n??"canceled",P.ERR_CANCELED,e,t),this.name="CanceledError"}E.inherits(Nt,P,{__CANCEL__:!0});function ao(n,e,t){const i=t.config.validateStatus;!t.status||!i||i(t.status)?n(t):e(new P("Request failed with status code "+t.status,[P.ERR_BAD_REQUEST,P.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Ku(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function Vu(n,e){n=n||10;const t=new Array(n),i=new Array(n);let r=0,s=0,o;return e=e!==void 0?e:1e3,function(f){const h=Date.now(),u=i[s];o||(o=h),t[r]=f,i[r]=h;let p=s,_=0;for(;p!==r;)_+=t[p++],p=p%n;if(r=(r+1)%n,r===s&&(s=(s+1)%n),h-o<e)return;const R=u&&h-u;return R?Math.round(_*1e3/R):void 0}}function Hu(n,e){let t=0,i=1e3/e,r,s;const o=(h,u=Date.now())=>{t=u,r=null,s&&(clearTimeout(s),s=null),n.apply(null,h)};return[(...h)=>{const u=Date.now(),p=u-t;p>=i?o(h,u):(r=h,s||(s=setTimeout(()=>{s=null,o(r)},i-p)))},()=>r&&o(r)]}const bn=(n,e,t=3)=>{let i=0;const r=Vu(50,250);return Hu(s=>{const o=s.loaded,l=s.lengthComputable?s.total:void 0,f=o-i,h=r(f),u=o<=l;i=o;const p={loaded:o,total:l,progress:l?o/l:void 0,bytes:f,rate:h||void 0,estimated:h&&l&&u?(l-o)/h:void 0,event:s,lengthComputable:l!=null,[e?"download":"upload"]:!0};n(p)},t)},Fr=(n,e)=>{const t=n!=null;return[i=>e[0]({lengthComputable:t,total:n,loaded:i}),e[1]]},Mr=n=>(...e)=>E.asap(()=>n(...e)),$u=le.hasStandardBrowserEnv?function(){const e=le.navigator&&/(msie|trident)/i.test(le.navigator.userAgent),t=document.createElement("a");let i;function r(s){let o=s;return e&&(t.setAttribute("href",o),o=t.href),t.setAttribute("href",o),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return i=r(window.location.href),function(o){const l=E.isString(o)?r(o):o;return l.protocol===i.protocol&&l.host===i.host}}():function(){return function(){return!0}}(),qu=le.hasStandardBrowserEnv?{write(n,e,t,i,r,s){const o=[n+"="+encodeURIComponent(e)];E.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),E.isString(i)&&o.push("path="+i),E.isString(r)&&o.push("domain="+r),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Wu(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function Gu(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function co(n,e){return n&&!Wu(e)?Gu(n,e):e}const Dr=n=>n instanceof de?{...n}:n;function et(n,e){e=e||{};const t={};function i(h,u,p){return E.isPlainObject(h)&&E.isPlainObject(u)?E.merge.call({caseless:p},h,u):E.isPlainObject(u)?E.merge({},u):E.isArray(u)?u.slice():u}function r(h,u,p){if(E.isUndefined(u)){if(!E.isUndefined(h))return i(void 0,h,p)}else return i(h,u,p)}function s(h,u){if(!E.isUndefined(u))return i(void 0,u)}function o(h,u){if(E.isUndefined(u)){if(!E.isUndefined(h))return i(void 0,h)}else return i(void 0,u)}function l(h,u,p){if(p in e)return i(h,u);if(p in n)return i(void 0,h)}const f={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:l,headers:(h,u)=>r(Dr(h),Dr(u),!0)};return E.forEach(Object.keys(Object.assign({},n,e)),function(u){const p=f[u]||r,_=p(n[u],e[u],u);E.isUndefined(_)&&p!==l||(t[u]=_)}),t}const uo=n=>{const e=et({},n);let{data:t,withXSRFToken:i,xsrfHeaderName:r,xsrfCookieName:s,headers:o,auth:l}=e;e.headers=o=de.from(o),e.url=io(co(e.baseURL,e.url),n.params,n.paramsSerializer),l&&o.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):"")));let f;if(E.isFormData(t)){if(le.hasStandardBrowserEnv||le.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((f=o.getContentType())!==!1){const[h,...u]=f?f.split(";").map(p=>p.trim()).filter(Boolean):[];o.setContentType([h||"multipart/form-data",...u].join("; "))}}if(le.hasStandardBrowserEnv&&(i&&E.isFunction(i)&&(i=i(e)),i||i!==!1&&$u(e.url))){const h=r&&s&&qu.read(s);h&&o.set(r,h)}return e},Ju=typeof XMLHttpRequest<"u",ju=Ju&&function(n){return new Promise(function(t,i){const r=uo(n);let s=r.data;const o=de.from(r.headers).normalize();let{responseType:l,onUploadProgress:f,onDownloadProgress:h}=r,u,p,_,R,b;function C(){R&&R(),b&&b(),r.cancelToken&&r.cancelToken.unsubscribe(u),r.signal&&r.signal.removeEventListener("abort",u)}let k=new XMLHttpRequest;k.open(r.method.toUpperCase(),r.url,!0),k.timeout=r.timeout;function x(){if(!k)return;const A=de.from("getAllResponseHeaders"in k&&k.getAllResponseHeaders()),v={data:!l||l==="text"||l==="json"?k.responseText:k.response,status:k.status,statusText:k.statusText,headers:A,config:n,request:k};ao(function(se){t(se),C()},function(se){i(se),C()},v),k=null}"onloadend"in k?k.onloadend=x:k.onreadystatechange=function(){!k||k.readyState!==4||k.status===0&&!(k.responseURL&&k.responseURL.indexOf("file:")===0)||setTimeout(x)},k.onabort=function(){k&&(i(new P("Request aborted",P.ECONNABORTED,n,k)),k=null)},k.onerror=function(){i(new P("Network Error",P.ERR_NETWORK,n,k)),k=null},k.ontimeout=function(){let O=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const v=r.transitional||ro;r.timeoutErrorMessage&&(O=r.timeoutErrorMessage),i(new P(O,v.clarifyTimeoutError?P.ETIMEDOUT:P.ECONNABORTED,n,k)),k=null},s===void 0&&o.setContentType(null),"setRequestHeader"in k&&E.forEach(o.toJSON(),function(O,v){k.setRequestHeader(v,O)}),E.isUndefined(r.withCredentials)||(k.withCredentials=!!r.withCredentials),l&&l!=="json"&&(k.responseType=r.responseType),h&&([_,b]=bn(h,!0),k.addEventListener("progress",_)),f&&k.upload&&([p,R]=bn(f),k.upload.addEventListener("progress",p),k.upload.addEventListener("loadend",R)),(r.cancelToken||r.signal)&&(u=A=>{k&&(i(!A||A.type?new Nt(null,n,k):A),k.abort(),k=null)},r.cancelToken&&r.cancelToken.subscribe(u),r.signal&&(r.signal.aborted?u():r.signal.addEventListener("abort",u)));const N=Ku(r.url);if(N&&le.protocols.indexOf(N)===-1){i(new P("Unsupported protocol "+N+":",P.ERR_BAD_REQUEST,n));return}k.send(s||null)})},zu=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let i=new AbortController,r;const s=function(h){if(!r){r=!0,l();const u=h instanceof Error?h:this.reason;i.abort(u instanceof P?u:new Nt(u instanceof Error?u.message:u))}};let o=e&&setTimeout(()=>{o=null,s(new P(`timeout ${e} of ms exceeded`,P.ETIMEDOUT))},e);const l=()=>{n&&(o&&clearTimeout(o),o=null,n.forEach(h=>{h.unsubscribe?h.unsubscribe(s):h.removeEventListener("abort",s)}),n=null)};n.forEach(h=>h.addEventListener("abort",s));const{signal:f}=i;return f.unsubscribe=()=>E.asap(l),f}},Yu=function*(n,e){let t=n.byteLength;if(t<e){yield n;return}let i=0,r;for(;i<t;)r=i+e,yield n.slice(i,r),i=r},Xu=async function*(n,e){for await(const t of Qu(n))yield*Yu(t,e)},Qu=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:i}=await e.read();if(t)break;yield i}}finally{await e.cancel()}},Br=(n,e,t,i)=>{const r=Xu(n,e);let s=0,o,l=f=>{o||(o=!0,i&&i(f))};return new ReadableStream({async pull(f){try{const{done:h,value:u}=await r.next();if(h){l(),f.close();return}let p=u.byteLength;if(t){let _=s+=p;t(_)}f.enqueue(new Uint8Array(u))}catch(h){throw l(h),h}},cancel(f){return l(f),r.return()}},{highWaterMark:2})},Mn=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",lo=Mn&&typeof ReadableStream=="function",Zu=Mn&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),ho=(n,...e)=>{try{return!!n(...e)}catch{return!1}},el=lo&&ho(()=>{let n=!1;const e=new Request(le.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),Ur=64*1024,Si=lo&&ho(()=>E.isReadableStream(new Response("").body)),kn={stream:Si&&(n=>n.body)};Mn&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!kn[e]&&(kn[e]=E.isFunction(n[e])?t=>t[e]():(t,i)=>{throw new P(`Response type '${e}' is not supported`,P.ERR_NOT_SUPPORT,i)})})})(new Response);const tl=async n=>{if(n==null)return 0;if(E.isBlob(n))return n.size;if(E.isSpecCompliantForm(n))return(await new Request(le.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(E.isArrayBufferView(n)||E.isArrayBuffer(n))return n.byteLength;if(E.isURLSearchParams(n)&&(n=n+""),E.isString(n))return(await Zu(n)).byteLength},nl=async(n,e)=>{const t=E.toFiniteNumber(n.getContentLength());return t??tl(e)},il=Mn&&(async n=>{let{url:e,method:t,data:i,signal:r,cancelToken:s,timeout:o,onDownloadProgress:l,onUploadProgress:f,responseType:h,headers:u,withCredentials:p="same-origin",fetchOptions:_}=uo(n);h=h?(h+"").toLowerCase():"text";let R=zu([r,s&&s.toAbortSignal()],o),b;const C=R&&R.unsubscribe&&(()=>{R.unsubscribe()});let k;try{if(f&&el&&t!=="get"&&t!=="head"&&(k=await nl(u,i))!==0){let v=new Request(e,{method:"POST",body:i,duplex:"half"}),q;if(E.isFormData(i)&&(q=v.headers.get("content-type"))&&u.setContentType(q),v.body){const[se,X]=Fr(k,bn(Mr(f)));i=Br(v.body,Ur,se,X)}}E.isString(p)||(p=p?"include":"omit");const x="credentials"in Request.prototype;b=new Request(e,{..._,signal:R,method:t.toUpperCase(),headers:u.normalize().toJSON(),body:i,duplex:"half",credentials:x?p:void 0});let N=await fetch(b);const A=Si&&(h==="stream"||h==="response");if(Si&&(l||A&&C)){const v={};["status","statusText","headers"].forEach(Re=>{v[Re]=N[Re]});const q=E.toFiniteNumber(N.headers.get("content-length")),[se,X]=l&&Fr(q,bn(Mr(l),!0))||[];N=new Response(Br(N.body,Ur,se,()=>{X&&X(),C&&C()}),v)}h=h||"text";let O=await kn[E.findKey(kn,h)||"text"](N,n);return!A&&C&&C(),await new Promise((v,q)=>{ao(v,q,{data:O,headers:de.from(N.headers),status:N.status,statusText:N.statusText,config:n,request:b})})}catch(x){throw C&&C(),x&&x.name==="TypeError"&&/fetch/i.test(x.message)?Object.assign(new P("Network Error",P.ERR_NETWORK,n,b),{cause:x.cause||x}):P.from(x,x&&x.code,n,b)}}),bi={http:yu,xhr:ju,fetch:il};E.forEach(bi,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const Kr=n=>`- ${n}`,rl=n=>E.isFunction(n)||n===null||n===!1,fo={getAdapter:n=>{n=E.isArray(n)?n:[n];const{length:e}=n;let t,i;const r={};for(let s=0;s<e;s++){t=n[s];let o;if(i=t,!rl(t)&&(i=bi[(o=String(t)).toLowerCase()],i===void 0))throw new P(`Unknown adapter '${o}'`);if(i)break;r[o||"#"+s]=i}if(!i){const s=Object.entries(r).map(([l,f])=>`adapter ${l} `+(f===!1?"is not supported by the environment":"is not available in the build"));let o=e?s.length>1?`since :
`+s.map(Kr).join(`
`):" "+Kr(s[0]):"as no adapter specified";throw new P("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return i},adapters:bi};function ti(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Nt(null,n)}function Vr(n){return ti(n),n.headers=de.from(n.headers),n.data=ei.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),fo.getAdapter(n.adapter||Jt.adapter)(n).then(function(i){return ti(n),i.data=ei.call(n,n.transformResponse,i),i.headers=de.from(i.headers),i},function(i){return oo(i)||(ti(n),i&&i.response&&(i.response.data=ei.call(n,n.transformResponse,i.response),i.response.headers=de.from(i.response.headers))),Promise.reject(i)})}const mo="1.7.7",Wi={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{Wi[n]=function(i){return typeof i===n||"a"+(e<1?"n ":" ")+n}});const Hr={};Wi.transitional=function(e,t,i){function r(s,o){return"[Axios v"+mo+"] Transitional option '"+s+"'"+o+(i?". "+i:"")}return(s,o,l)=>{if(e===!1)throw new P(r(o," has been removed"+(t?" in "+t:"")),P.ERR_DEPRECATED);return t&&!Hr[o]&&(Hr[o]=!0,console.warn(r(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(s,o,l):!0}};function sl(n,e,t){if(typeof n!="object")throw new P("options must be an object",P.ERR_BAD_OPTION_VALUE);const i=Object.keys(n);let r=i.length;for(;r-- >0;){const s=i[r],o=e[s];if(o){const l=n[s],f=l===void 0||o(l,s,n);if(f!==!0)throw new P("option "+s+" must be "+f,P.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new P("Unknown option "+s,P.ERR_BAD_OPTION)}}const ki={assertOptions:sl,validators:Wi},Be=ki.validators;class Qe{constructor(e){this.defaults=e,this.interceptors={request:new Pr,response:new Pr}}async request(e,t){try{return await this._request(e,t)}catch(i){if(i instanceof Error){let r;Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error;const s=r.stack?r.stack.replace(/^.+\n/,""):"";try{i.stack?s&&!String(i.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+s):i.stack=s}catch{}}throw i}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=et(this.defaults,t);const{transitional:i,paramsSerializer:r,headers:s}=t;i!==void 0&&ki.assertOptions(i,{silentJSONParsing:Be.transitional(Be.boolean),forcedJSONParsing:Be.transitional(Be.boolean),clarifyTimeoutError:Be.transitional(Be.boolean)},!1),r!=null&&(E.isFunction(r)?t.paramsSerializer={serialize:r}:ki.assertOptions(r,{encode:Be.function,serialize:Be.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=s&&E.merge(s.common,s[t.method]);s&&E.forEach(["delete","get","head","post","put","patch","common"],b=>{delete s[b]}),t.headers=de.concat(o,s);const l=[];let f=!0;this.interceptors.request.forEach(function(C){typeof C.runWhen=="function"&&C.runWhen(t)===!1||(f=f&&C.synchronous,l.unshift(C.fulfilled,C.rejected))});const h=[];this.interceptors.response.forEach(function(C){h.push(C.fulfilled,C.rejected)});let u,p=0,_;if(!f){const b=[Vr.bind(this),void 0];for(b.unshift.apply(b,l),b.push.apply(b,h),_=b.length,u=Promise.resolve(t);p<_;)u=u.then(b[p++],b[p++]);return u}_=l.length;let R=t;for(p=0;p<_;){const b=l[p++],C=l[p++];try{R=b(R)}catch(k){C.call(this,k);break}}try{u=Vr.call(this,R)}catch(b){return Promise.reject(b)}for(p=0,_=h.length;p<_;)u=u.then(h[p++],h[p++]);return u}getUri(e){e=et(this.defaults,e);const t=co(e.baseURL,e.url);return io(t,e.params,e.paramsSerializer)}}E.forEach(["delete","get","head","options"],function(e){Qe.prototype[e]=function(t,i){return this.request(et(i||{},{method:e,url:t,data:(i||{}).data}))}});E.forEach(["post","put","patch"],function(e){function t(i){return function(s,o,l){return this.request(et(l||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}Qe.prototype[e]=t(),Qe.prototype[e+"Form"]=t(!0)});class Gi{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(s){t=s});const i=this;this.promise.then(r=>{if(!i._listeners)return;let s=i._listeners.length;for(;s-- >0;)i._listeners[s](r);i._listeners=null}),this.promise.then=r=>{let s;const o=new Promise(l=>{i.subscribe(l),s=l}).then(r);return o.cancel=function(){i.unsubscribe(s)},o},e(function(s,o,l){i.reason||(i.reason=new Nt(s,o,l),t(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=i=>{e.abort(i)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new Gi(function(r){e=r}),cancel:e}}}function ol(n){return function(t){return n.apply(null,t)}}function al(n){return E.isObject(n)&&n.isAxiosError===!0}const Ri={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ri).forEach(([n,e])=>{Ri[e]=n});function po(n){const e=new Qe(n),t=$s(Qe.prototype.request,e);return E.extend(t,Qe.prototype,e,{allOwnKeys:!0}),E.extend(t,e,null,{allOwnKeys:!0}),t.create=function(r){return po(et(n,r))},t}const ee=po(Jt);ee.Axios=Qe;ee.CanceledError=Nt;ee.CancelToken=Gi;ee.isCancel=oo;ee.VERSION=mo;ee.toFormData=Fn;ee.AxiosError=P;ee.Cancel=ee.CanceledError;ee.all=function(e){return Promise.all(e)};ee.spread=ol;ee.isAxiosError=al;ee.mergeConfig=et;ee.AxiosHeaders=de;ee.formToJSON=n=>so(E.isHTMLForm(n)?new FormData(n):n);ee.getAdapter=fo.getAdapter;ee.HttpStatusCode=Ri;ee.default=ee;const cl="/commander/v1.0";async function $r(n){return ee({method:"post",url:`${V.BLUEOS_APIS_ENDPOINT+cl}/shutdown`,timeout:5e3,withCredentials:!1,params:{shutdown_type:n,i_know_what_i_am_doing:!0}}).then(e=>e.data).then(e=>"Shutting Down... "+String(e)).catch(e=>{var i;if(e.code==="ECONNABORTED")return"Shutting Down... ";const t=`Could not execute shutdown: ${e.code} - ${e.message} - ${e.message??((i=e.response)==null?void 0:i.data)}.`;throw logWarn(t),new Error(t)})}function Y(n,e){if(!n)throw new Error(e)}const ul=34028234663852886e22,ll=-34028234663852886e22,dl=4294967295,hl=2147483647,fl=-2147483648;function gn(n){if(typeof n!="number")throw new Error("invalid int 32: "+typeof n);if(!Number.isInteger(n)||n>hl||n<fl)throw new Error("invalid int 32: "+n)}function Ci(n){if(typeof n!="number")throw new Error("invalid uint 32: "+typeof n);if(!Number.isInteger(n)||n>dl||n<0)throw new Error("invalid uint 32: "+n)}function go(n){if(typeof n!="number")throw new Error("invalid float 32: "+typeof n);if(Number.isFinite(n)&&(n>ul||n<ll))throw new Error("invalid float 32: "+n)}const _o=Symbol("@bufbuild/protobuf/enum-type");function ml(n){const e=n[_o];return Y(e,"missing enum type on enum object"),e}function yo(n,e,t,i){n[_o]=Eo(e,t.map(r=>({no:r.no,name:r.name,localName:n[r.no]})))}function Eo(n,e,t){const i=Object.create(null),r=Object.create(null),s=[];for(const o of e){const l=To(o);s.push(l),i[o.name]=l,r[o.no]=l}return{typeName:n,values:s,findName(o){return i[o]},findNumber(o){return r[o]}}}function pl(n,e,t){const i={};for(const r of e){const s=To(r);i[s.localName]=s.no,i[s.no]=s.localName}return yo(i,n,e),i}function To(n){return"localName"in n?n:Object.assign(Object.assign({},n),{localName:n.name})}class wo{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const i=this.getType(),r=i.runtime.bin,s=r.makeReadOptions(t);return r.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,t){const i=this.getType(),r=i.runtime.json,s=r.makeReadOptions(t);return r.readMessage(i,e,s,this),this}fromJsonString(e,t){let i;try{i=JSON.parse(e)}catch(r){throw new Error(`cannot decode ${this.getType().typeName} from JSON: ${r instanceof Error?r.message:String(r)}`)}return this.fromJson(i,t)}toBinary(e){const t=this.getType(),i=t.runtime.bin,r=i.makeWriteOptions(e),s=r.writerFactory();return i.writeMessage(this,s,r),s.finish()}toJson(e){const t=this.getType(),i=t.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var t;const i=this.toJson(e);return JSON.stringify(i,null,(t=e==null?void 0:e.prettySpaces)!==null&&t!==void 0?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function gl(n,e,t,i){var r;const s=(r=i==null?void 0:i.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),o={[s]:function(l){n.util.initFields(this),n.util.initPartial(l,this)}}[s];return Object.setPrototypeOf(o.prototype,new wo),Object.assign(o,{runtime:n,typeName:e,fields:n.util.newFieldList(t),fromBinary(l,f){return new o().fromBinary(l,f)},fromJson(l,f){return new o().fromJson(l,f)},fromJsonString(l,f){return new o().fromJsonString(l,f)},equals(l,f){return n.util.equals(o,l,f)}}),o}function _l(){let n=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(n|=(r&127)<<i,!(r&128))return this.assertBounds(),[n,e]}let t=this.buf[this.pos++];if(n|=(t&15)<<28,e=(t&112)>>4,!(t&128))return this.assertBounds(),[n,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,!(r&128))return this.assertBounds(),[n,e]}throw new Error("invalid varint")}function ni(n,e,t){for(let s=0;s<28;s=s+7){const o=n>>>s,l=!(!(o>>>7)&&e==0),f=(l?o|128:o)&255;if(t.push(f),!l)return}const i=n>>>28&15|(e&7)<<4,r=!!(e>>3);if(t.push((r?i|128:i)&255),!!r){for(let s=3;s<31;s=s+7){const o=e>>>s,l=!!(o>>>7),f=(l?o|128:o)&255;if(t.push(f),!l)return}t.push(e>>>31&1)}}const _n=4294967296;function qr(n){const e=n[0]==="-";e&&(n=n.slice(1));const t=1e6;let i=0,r=0;function s(o,l){const f=Number(n.slice(o,l));r*=t,i=i*t+f,i>=_n&&(r=r+(i/_n|0),i=i%_n)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?bo(i,r):Ji(i,r)}function yl(n,e){let t=Ji(n,e);const i=t.hi&2147483648;i&&(t=bo(t.lo,t.hi));const r=So(t.lo,t.hi);return i?"-"+r:r}function So(n,e){if({lo:n,hi:e}=El(n,e),e<=2097151)return String(_n*e+n);const t=n&16777215,i=(n>>>24|e<<8)&16777215,r=e>>16&65535;let s=t+i*6777216+r*6710656,o=i+r*8147497,l=r*2;const f=1e7;return s>=f&&(o+=Math.floor(s/f),s%=f),o>=f&&(l+=Math.floor(o/f),o%=f),l.toString()+Wr(o)+Wr(s)}function El(n,e){return{lo:n>>>0,hi:e>>>0}}function Ji(n,e){return{lo:n|0,hi:e|0}}function bo(n,e){return e=~e,n?n=~n+1:e+=1,Ji(n,e)}const Wr=n=>{const e=String(n);return"0000000".slice(e.length)+e};function Gr(n,e){if(n>=0){for(;n>127;)e.push(n&127|128),n=n>>>7;e.push(n)}else{for(let t=0;t<9;t++)e.push(n&127|128),n=n>>7;e.push(1)}}function Tl(){let n=this.buf[this.pos++],e=n&127;if(!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<7,!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<14,!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<21,!(n&128))return this.assertBounds(),e;n=this.buf[this.pos++],e|=(n&15)<<28;for(let t=5;n&128&&t<10;t++)n=this.buf[this.pos++];if(n&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}var Jr={};function wl(){const n=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"&&(typeof Ut!="object"||typeof Jr!="object"||Jr.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),o=BigInt("0"),l=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(f){const h=typeof f=="bigint"?f:BigInt(f);if(h>s||h<r)throw new Error(`int64 invalid: ${f}`);return h},uParse(f){const h=typeof f=="bigint"?f:BigInt(f);if(h>l||h<o)throw new Error(`uint64 invalid: ${f}`);return h},enc(f){return n.setBigInt64(0,this.parse(f),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},uEnc(f){return n.setBigInt64(0,this.uParse(f),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},dec(f,h){return n.setInt32(0,f,!0),n.setInt32(4,h,!0),n.getBigInt64(0,!0)},uDec(f,h){return n.setInt32(0,f,!0),n.setInt32(4,h,!0),n.getBigUint64(0,!0)}}}const t=r=>Y(/^-?[0-9]+$/.test(r),`int64 invalid: ${r}`),i=r=>Y(/^[0-9]+$/.test(r),`uint64 invalid: ${r}`);return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),t(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),t(r),qr(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),qr(r)},dec(r,s){return yl(r,s)},uDec(r,s){return So(r,s)}}}const he=wl();var w;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(w||(w={}));var He;(function(n){n[n.BIGINT=0]="BIGINT",n[n.STRING=1]="STRING"})(He||(He={}));function Ue(n,e,t){if(e===t)return!0;if(n==w.BYTES){if(!(e instanceof Uint8Array)||!(t instanceof Uint8Array)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}switch(n){case w.UINT64:case w.FIXED64:case w.INT64:case w.SFIXED64:case w.SINT64:return e==t}return!1}function kt(n,e){switch(n){case w.BOOL:return!1;case w.UINT64:case w.FIXED64:case w.INT64:case w.SFIXED64:case w.SINT64:return e==0?he.zero:"0";case w.DOUBLE:case w.FLOAT:return 0;case w.BYTES:return new Uint8Array(0);case w.STRING:return"";default:return 0}}function ko(n,e){switch(n){case w.BOOL:return e===!1;case w.STRING:return e==="";case w.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var Z;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32"})(Z||(Z={}));class Sl{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let t=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)t.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Ci(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return gn(e),Gr(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){go(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){Ci(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){gn(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return gn(e),e=(e<<1^e>>31)>>>0,Gr(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),r=he.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),r=he.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(t)}int64(e){let t=he.enc(e);return ni(t.lo,t.hi,this.buf),this}sint64(e){let t=he.enc(e),i=t.hi>>31,r=t.lo<<1^i,s=(t.hi<<1|t.lo>>>31)^i;return ni(r,s,this.buf),this}uint64(e){let t=he.uEnc(e);return ni(t.lo,t.hi,this.buf),this}}class bl{constructor(e,t){this.varint64=_l,this.uint32=Tl,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t??new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,i=e&7;if(t<=0||i<0||i>5)throw new Error("illegal tag: field no "+t+" wire type "+i);return[t,i]}skip(e,t){let i=this.pos;switch(e){case Z.Varint:for(;this.buf[this.pos++]&128;);break;case Z.Bit64:this.pos+=4;case Z.Bit32:this.pos+=4;break;case Z.LengthDelimited:let r=this.uint32();this.pos+=r;break;case Z.StartGroup:for(;;){const[s,o]=this.tag();if(o===Z.EndGroup){if(t!==void 0&&s!==t)throw new Error("invalid end group tag");break}this.skip(o,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return he.dec(...this.varint64())}uint64(){return he.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),i=-(e&1);return e=(e>>>1|(t&1)<<31)^i,t=t>>>1^i,he.dec(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return he.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return he.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function kl(n,e,t,i){let r;return{typeName:e,extendee:t,get field(){if(!r){const s=typeof i=="function"?i():i;s.name=e.split(".").pop(),s.jsonName=`[${e}]`,r=n.util.newFieldList([s]).list()[0]}return r},runtime:n}}function Ro(n){const e=n.field.localName,t=Object.create(null);return t[e]=Rl(n),[t,()=>t[e]]}function Rl(n){const e=n.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return kt(e.T,e.L);case"message":const t=e.T,i=new t;return t.fieldWrapper?t.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function Cl(n,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let t=n.length-1;t>=0;--t)if(n[t].no==e.no)return[n[t]];return[]}return n.filter(t=>t.no===e.no)}let ve="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Dn=[];for(let n=0;n<ve.length;n++)Dn[ve[n].charCodeAt(0)]=n;Dn[45]=ve.indexOf("+");Dn[95]=ve.indexOf("/");const Co={dec(n){let e=n.length*3/4;n[n.length-2]=="="?e-=2:n[n.length-1]=="="&&(e-=1);let t=new Uint8Array(e),i=0,r=0,s,o=0;for(let l=0;l<n.length;l++){if(s=Dn[n.charCodeAt(l)],s===void 0)switch(n[l]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:o=s,r=1;break;case 1:t[i++]=o<<2|(s&48)>>4,o=s,r=2;break;case 2:t[i++]=(o&15)<<4|(s&60)>>2,o=s,r=3;break;case 3:t[i++]=(o&3)<<6|s,r=0;break}}if(r==1)throw Error("invalid base64 string.");return t.subarray(0,i)},enc(n){let e="",t=0,i,r=0;for(let s=0;s<n.length;s++)switch(i=n[s],t){case 0:e+=ve[i>>2],r=(i&3)<<4,t=1;break;case 1:e+=ve[r|i>>4],r=(i&15)<<2,t=2;break;case 2:e+=ve[r|i>>6],e+=ve[i&63],t=0;break}return t&&(e+=ve[r],e+="=",t==1&&(e+="=")),e}};function Il(n,e,t){Ao(e,n);const i=e.runtime.bin.makeReadOptions(t),r=Cl(n.getType().runtime.bin.listUnknownFields(n),e.field),[s,o]=Ro(e);for(const l of r)e.runtime.bin.readField(s,i.readerFactory(l.data),e.field,l.wireType,i);return o()}function Al(n,e,t,i){Ao(e,n);const r=e.runtime.bin.makeReadOptions(i),s=e.runtime.bin.makeWriteOptions(i);if(Io(n,e)){const h=n.getType().runtime.bin.listUnknownFields(n).filter(u=>u.no!=e.field.no);n.getType().runtime.bin.discardUnknownFields(n);for(const u of h)n.getType().runtime.bin.onUnknownField(n,u.no,u.wireType,u.data)}const o=s.writerFactory();let l=e.field;!l.opt&&!l.repeated&&(l.kind=="enum"||l.kind=="scalar")&&(l=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(l,t,o,s);const f=r.readerFactory(o.finish());for(;f.pos<f.len;){const[h,u]=f.tag(),p=f.skip(u,h);n.getType().runtime.bin.onUnknownField(n,h,u,p)}}function Io(n,e){const t=n.getType();return e.extendee.typeName===t.typeName&&!!t.runtime.bin.listUnknownFields(n).find(i=>i.no==e.field.no)}function Ao(n,e){Y(n.extendee.typeName==e.getType().typeName,`extension ${n.typeName} can only be applied to message ${n.extendee.typeName}`)}function No(n,e){const t=n.localName;if(n.repeated)return e[t].length>0;if(n.oneof)return e[n.oneof.localName].case===t;switch(n.kind){case"enum":case"scalar":return n.opt||n.req?e[t]!==void 0:n.kind=="enum"?e[t]!==n.T.values[0].no:!ko(n.T,e[t]);case"message":return e[t]!==void 0;case"map":return Object.keys(e[t]).length>0}}function jr(n,e){const t=n.localName,i=!n.opt&&!n.req;if(n.repeated)e[t]=[];else if(n.oneof)e[n.oneof.localName]={case:void 0};else switch(n.kind){case"map":e[t]={};break;case"enum":e[t]=i?n.T.values[0].no:void 0;break;case"scalar":e[t]=i?kt(n.T,n.L):void 0;break;case"message":e[t]=void 0;break}}function Ze(n,e){if(n===null||typeof n!="object"||!Object.getOwnPropertyNames(wo.prototype).every(i=>i in n&&typeof n[i]=="function"))return!1;const t=n.getType();return t===null||typeof t!="function"||!("typeName"in t)||typeof t.typeName!="string"?!1:e===void 0?!0:t.typeName==e.typeName}function vo(n,e){return Ze(e)||!n.fieldWrapper?e:n.fieldWrapper.wrapField(e)}w.DOUBLE,w.FLOAT,w.INT64,w.UINT64,w.INT32,w.UINT32,w.BOOL,w.STRING,w.BYTES;const zr={ignoreUnknownFields:!1},Yr={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function Nl(n){return n?Object.assign(Object.assign({},zr),n):zr}function vl(n){return n?Object.assign(Object.assign({},Yr),n):Yr}const Rn=Symbol(),yn=Symbol();function Ol(){return{makeReadOptions:Nl,makeWriteOptions:vl,readMessage(n,e,t,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error(`cannot decode message ${n.typeName} from JSON: ${Se(e)}`);i=i??new n;const r=new Map,s=t.typeRegistry;for(const[o,l]of Object.entries(e)){const f=n.fields.findJsonName(o);if(f){if(f.oneof){if(l===null&&f.kind=="scalar")continue;const h=r.get(f.oneof);if(h!==void 0)throw new Error(`cannot decode message ${n.typeName} from JSON: multiple keys for oneof "${f.oneof.name}" present: "${h}", "${o}"`);r.set(f.oneof,o)}Xr(i,l,f,t,n)}else{let h=!1;if(s!=null&&s.findExtension&&o.startsWith("[")&&o.endsWith("]")){const u=s.findExtension(o.substring(1,o.length-1));if(u&&u.extendee.typeName==n.typeName){h=!0;const[p,_]=Ro(u);Xr(p,l,u.field,t,u),Al(i,u,_(),t)}}if(!h&&!t.ignoreUnknownFields)throw new Error(`cannot decode message ${n.typeName} from JSON: key "${o}" is unknown`)}}return i},writeMessage(n,e){const t=n.getType(),i={};let r;try{for(r of t.fields.byNumber()){if(!No(r,n)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!Pl(r))continue}const o=r.oneof?n[r.oneof.localName].value:n[r.localName],l=Qr(r,o,e);l!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=l)}const s=e.typeRegistry;if(s!=null&&s.findExtensionFor)for(const o of t.runtime.bin.listUnknownFields(n)){const l=s.findExtensionFor(t.typeName,o.no);if(l&&Io(n,l)){const f=Il(n,l,e),h=Qr(l.field,f,e);h!==void 0&&(i[l.field.jsonName]=h)}}}catch(s){const o=r?`cannot encode field ${t.typeName}.${r.name} to JSON`:`cannot encode message ${t.typeName} to JSON`,l=s instanceof Error?s.message:String(s);throw new Error(o+(l.length>0?`: ${l}`:""))}return i},readScalar(n,e,t){return Dt(n,e,t??He.BIGINT,!0)},writeScalar(n,e,t){if(e!==void 0&&(t||ko(n,e)))return En(n,e)},debug:Se}}function Se(n){if(n===null)return"null";switch(typeof n){case"object":return Array.isArray(n)?"array":"object";case"string":return n.length>100?"string":`"${n.split('"').join('\\"')}"`;default:return String(n)}}function Xr(n,e,t,i,r){let s=t.localName;if(t.repeated){if(Y(t.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error(`cannot decode field ${r.typeName}.${t.name} from JSON: ${Se(e)}`);const o=n[s];for(const l of e){if(l===null)throw new Error(`cannot decode field ${r.typeName}.${t.name} from JSON: ${Se(l)}`);switch(t.kind){case"message":o.push(t.T.fromJson(l,i));break;case"enum":const f=ii(t.T,l,i.ignoreUnknownFields,!0);f!==yn&&o.push(f);break;case"scalar":try{o.push(Dt(t.T,l,t.L,!0))}catch(h){let u=`cannot decode field ${r.typeName}.${t.name} from JSON: ${Se(l)}`;throw h instanceof Error&&h.message.length>0&&(u+=`: ${h.message}`),new Error(u)}break}}}else if(t.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error(`cannot decode field ${r.typeName}.${t.name} from JSON: ${Se(e)}`);const o=n[s];for(const[l,f]of Object.entries(e)){if(f===null)throw new Error(`cannot decode field ${r.typeName}.${t.name} from JSON: map value null`);let h;try{h=xl(t.K,l)}catch(u){let p=`cannot decode map key for field ${r.typeName}.${t.name} from JSON: ${Se(e)}`;throw u instanceof Error&&u.message.length>0&&(p+=`: ${u.message}`),new Error(p)}switch(t.V.kind){case"message":o[h]=t.V.T.fromJson(f,i);break;case"enum":const u=ii(t.V.T,f,i.ignoreUnknownFields,!0);u!==yn&&(o[h]=u);break;case"scalar":try{o[h]=Dt(t.V.T,f,He.BIGINT,!0)}catch(p){let _=`cannot decode map value for field ${r.typeName}.${t.name} from JSON: ${Se(e)}`;throw p instanceof Error&&p.message.length>0&&(_+=`: ${p.message}`),new Error(_)}break}}}else switch(t.oneof&&(n=n[t.oneof.localName]={case:s},s="value"),t.kind){case"message":const o=t.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let l=n[s];Ze(l)?l.fromJson(e,i):(n[s]=l=o.fromJson(e,i),o.fieldWrapper&&!t.oneof&&(n[s]=o.fieldWrapper.unwrapField(l)));break;case"enum":const f=ii(t.T,e,i.ignoreUnknownFields,!1);switch(f){case Rn:jr(t,n);break;case yn:break;default:n[s]=f;break}break;case"scalar":try{const h=Dt(t.T,e,t.L,!1);switch(h){case Rn:jr(t,n);break;default:n[s]=h;break}}catch(h){let u=`cannot decode field ${r.typeName}.${t.name} from JSON: ${Se(e)}`;throw h instanceof Error&&h.message.length>0&&(u+=`: ${h.message}`),new Error(u)}break}}function xl(n,e){if(n===w.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Dt(n,e,He.BIGINT,!0).toString()}function Dt(n,e,t,i){if(e===null)return i?kt(n,t):Rn;switch(n){case w.DOUBLE:case w.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return n==w.FLOAT&&go(r),r;case w.INT32:case w.FIXED32:case w.SFIXED32:case w.SINT32:case w.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return n==w.UINT32||n==w.FIXED32?Ci(s):gn(s),s;case w.INT64:case w.SFIXED64:case w.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=he.parse(e);return t?o.toString():o;case w.FIXED64:case w.UINT64:if(typeof e!="number"&&typeof e!="string")break;const l=he.uParse(e);return t?l.toString():l;case w.BOOL:if(typeof e!="boolean")break;return e;case w.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case w.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return Co.dec(e)}throw new Error}function ii(n,e,t,i){if(e===null)return n.typeName=="google.protobuf.NullValue"?0:i?n.values[0].no:Rn;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=n.findName(e);if(r!==void 0)return r.no;if(t)return yn;break}throw new Error(`cannot decode enum ${n.typeName} from JSON: ${Se(e)}`)}function Pl(n){return n.repeated||n.kind=="map"?!0:!(n.oneof||n.kind=="message"||n.opt||n.req)}function Qr(n,e,t){if(n.kind=="map"){Y(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(n.V.kind){case"scalar":for(const[o,l]of r)i[o.toString()]=En(n.V.T,l);break;case"message":for(const[o,l]of r)i[o.toString()]=l.toJson(t);break;case"enum":const s=n.V.T;for(const[o,l]of r)i[o.toString()]=ri(s,l,t.enumAsInteger);break}return t.emitDefaultValues||r.length>0?i:void 0}if(n.repeated){Y(Array.isArray(e));const i=[];switch(n.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(En(n.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(ri(n.T,e[r],t.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(t));break}return t.emitDefaultValues||i.length>0?i:void 0}switch(n.kind){case"scalar":return En(n.T,e);case"enum":return ri(n.T,e,t.enumAsInteger);case"message":return vo(n.T,e).toJson(t)}}function ri(n,e,t){var i;if(Y(typeof e=="number"),n.typeName=="google.protobuf.NullValue")return null;if(t)return e;const r=n.findNumber(e);return(i=r==null?void 0:r.name)!==null&&i!==void 0?i:e}function En(n,e){switch(n){case w.INT32:case w.SFIXED32:case w.SINT32:case w.FIXED32:case w.UINT32:return Y(typeof e=="number"),e;case w.FLOAT:case w.DOUBLE:return Y(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case w.STRING:return Y(typeof e=="string"),e;case w.BOOL:return Y(typeof e=="boolean"),e;case w.UINT64:case w.FIXED64:case w.INT64:case w.SFIXED64:case w.SINT64:return Y(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case w.BYTES:return Y(e instanceof Uint8Array),Co.enc(e)}}const ft=Symbol("@bufbuild/protobuf/unknown-fields"),Zr={readUnknownFields:!0,readerFactory:n=>new bl(n)},es={writeUnknownFields:!0,writerFactory:()=>new Sl};function Ll(n){return n?Object.assign(Object.assign({},Zr),n):Zr}function Fl(n){return n?Object.assign(Object.assign({},es),n):es}function Ml(){return{makeReadOptions:Ll,makeWriteOptions:Fl,listUnknownFields(n){var e;return(e=n[ft])!==null&&e!==void 0?e:[]},discardUnknownFields(n){delete n[ft]},writeUnknownFields(n,e){const i=n[ft];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(n,e,t,i){const r=n;Array.isArray(r[ft])||(r[ft]=[]),r[ft].push({no:e,wireType:t,data:i})},readMessage(n,e,t,i,r){const s=n.getType(),o=r?e.len:e.pos+t;let l,f;for(;e.pos<o&&([l,f]=e.tag(),!(r===!0&&f==Z.EndGroup));){const h=s.fields.find(l);if(!h){const u=e.skip(f,l);i.readUnknownFields&&this.onUnknownField(n,l,f,u);continue}ts(n,e,h,f,i)}if(r&&(f!=Z.EndGroup||l!==t))throw new Error("invalid end group tag")},readField:ts,writeMessage(n,e,t){const i=n.getType();for(const r of i.fields.byNumber()){if(!No(r,n)){if(r.req)throw new Error(`cannot encode field ${i.typeName}.${r.name} to binary: required field not set`);continue}const s=r.oneof?n[r.oneof.localName].value:n[r.localName];ns(r,s,e,t)}return t.writeUnknownFields&&this.writeUnknownFields(n,e),e},writeField(n,e,t,i){e!==void 0&&ns(n,e,t,i)}}}function ts(n,e,t,i,r){let{repeated:s,localName:o}=t;switch(t.oneof&&(n=n[t.oneof.localName],n.case!=o&&delete n.value,n.case=o,o="value"),t.kind){case"scalar":case"enum":const l=t.kind=="enum"?w.INT32:t.T;let f=Cn;if(t.kind=="scalar"&&t.L>0&&(f=Bl),s){let _=n[o];if(i==Z.LengthDelimited&&l!=w.STRING&&l!=w.BYTES){let b=e.uint32()+e.pos;for(;e.pos<b;)_.push(f(e,l))}else _.push(f(e,l))}else n[o]=f(e,l);break;case"message":const h=t.T;s?n[o].push(Tn(e,new h,r,t)):Ze(n[o])?Tn(e,n[o],r,t):(n[o]=Tn(e,new h,r,t),h.fieldWrapper&&!t.oneof&&!t.repeated&&(n[o]=h.fieldWrapper.unwrapField(n[o])));break;case"map":let[u,p]=Dl(t,e,r);n[o][u]=p;break}}function Tn(n,e,t,i){const r=e.getType().runtime.bin,s=i==null?void 0:i.delimited;return r.readMessage(e,n,s?i.no:n.uint32(),t,s),e}function Dl(n,e,t){const i=e.uint32(),r=e.pos+i;let s,o;for(;e.pos<r;){const[l]=e.tag();switch(l){case 1:s=Cn(e,n.K);break;case 2:switch(n.V.kind){case"scalar":o=Cn(e,n.V.T);break;case"enum":o=e.int32();break;case"message":o=Tn(e,new n.V.T,t,void 0);break}break}}if(s===void 0&&(s=kt(n.K,He.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),o===void 0)switch(n.V.kind){case"scalar":o=kt(n.V.T,He.BIGINT);break;case"enum":o=n.V.T.values[0].no;break;case"message":o=new n.V.T;break}return[s,o]}function Bl(n,e){const t=Cn(n,e);return typeof t=="bigint"?t.toString():t}function Cn(n,e){switch(e){case w.STRING:return n.string();case w.BOOL:return n.bool();case w.DOUBLE:return n.double();case w.FLOAT:return n.float();case w.INT32:return n.int32();case w.INT64:return n.int64();case w.UINT64:return n.uint64();case w.FIXED64:return n.fixed64();case w.BYTES:return n.bytes();case w.FIXED32:return n.fixed32();case w.SFIXED32:return n.sfixed32();case w.SFIXED64:return n.sfixed64();case w.SINT64:return n.sint64();case w.UINT32:return n.uint32();case w.SINT32:return n.sint32()}}function ns(n,e,t,i){Y(e!==void 0);const r=n.repeated;switch(n.kind){case"scalar":case"enum":let s=n.kind=="enum"?w.INT32:n.T;if(r)if(Y(Array.isArray(e)),n.packed)Kl(t,s,n.no,e);else for(const o of e)Bt(t,s,n.no,o);else Bt(t,s,n.no,e);break;case"message":if(r){Y(Array.isArray(e));for(const o of e)is(t,i,n,o)}else is(t,i,n,e);break;case"map":Y(typeof e=="object"&&e!=null);for(const[o,l]of Object.entries(e))Ul(t,i,n,o,l);break}}function Ul(n,e,t,i,r){n.tag(t.no,Z.LengthDelimited),n.fork();let s=i;switch(t.K){case w.INT32:case w.FIXED32:case w.UINT32:case w.SFIXED32:case w.SINT32:s=Number.parseInt(i);break;case w.BOOL:Y(i=="true"||i=="false"),s=i=="true";break}switch(Bt(n,t.K,1,s),t.V.kind){case"scalar":Bt(n,t.V.T,2,r);break;case"enum":Bt(n,w.INT32,2,r);break;case"message":Y(r!==void 0),n.tag(2,Z.LengthDelimited).bytes(r.toBinary(e));break}n.join()}function is(n,e,t,i){const r=vo(t.T,i);t.delimited?n.tag(t.no,Z.StartGroup).raw(r.toBinary(e)).tag(t.no,Z.EndGroup):n.tag(t.no,Z.LengthDelimited).bytes(r.toBinary(e))}function Bt(n,e,t,i){Y(i!==void 0);let[r,s]=Oo(e);n.tag(t,r)[s](i)}function Kl(n,e,t,i){if(!i.length)return;n.tag(t,Z.LengthDelimited).fork();let[,r]=Oo(e);for(let s=0;s<i.length;s++)n[r](i[s]);n.join()}function Oo(n){let e=Z.Varint;switch(n){case w.BYTES:case w.STRING:e=Z.LengthDelimited;break;case w.DOUBLE:case w.FIXED64:case w.SFIXED64:e=Z.Bit64;break;case w.FIXED32:case w.SFIXED32:case w.FLOAT:e=Z.Bit32;break}const t=w[n].toLowerCase();return[e,t]}function Vl(){return{setEnumType:yo,initPartial(n,e){if(n===void 0)return;const t=e.getType();for(const i of t.fields.byMember()){const r=i.localName,s=e,o=n;if(o[r]!=null)switch(i.kind){case"oneof":const l=o[r].case;if(l===void 0)continue;const f=i.findField(l);let h=o[r].value;f&&f.kind=="message"&&!Ze(h,f.T)?h=new f.T(h):f&&f.kind==="scalar"&&f.T===w.BYTES&&(h=Pt(h)),s[r]={case:l,value:h};break;case"scalar":case"enum":let u=o[r];i.T===w.BYTES&&(u=i.repeated?u.map(Pt):Pt(u)),s[r]=u;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===w.BYTES)for(const[R,b]of Object.entries(o[r]))s[r][R]=Pt(b);else Object.assign(s[r],o[r]);break;case"message":const _=i.V.T;for(const R of Object.keys(o[r])){let b=o[r][R];_.fieldWrapper||(b=new _(b)),s[r][R]=b}break}break;case"message":const p=i.T;if(i.repeated)s[r]=o[r].map(_=>Ze(_,p)?_:new p(_));else{const _=o[r];p.fieldWrapper?p.typeName==="google.protobuf.BytesValue"?s[r]=Pt(_):s[r]=_:s[r]=Ze(_,p)?_:new p(_)}break}}},equals(n,e,t){return e===t?!0:!e||!t?!1:n.fields.byMember().every(i=>{const r=e[i.localName],s=t[i.localName];if(i.repeated){if(r.length!==s.length)return!1;switch(i.kind){case"message":return r.every((o,l)=>i.T.equals(o,s[l]));case"scalar":return r.every((o,l)=>Ue(i.T,o,s[l]));case"enum":return r.every((o,l)=>Ue(w.INT32,o,s[l]))}throw new Error(`repeated cannot contain ${i.kind}`)}switch(i.kind){case"message":return i.T.equals(r,s);case"enum":return Ue(w.INT32,r,s);case"scalar":return Ue(i.T,r,s);case"oneof":if(r.case!==s.case)return!1;const o=i.findField(r.case);if(o===void 0)return!0;switch(o.kind){case"message":return o.T.equals(r.value,s.value);case"enum":return Ue(w.INT32,r.value,s.value);case"scalar":return Ue(o.T,r.value,s.value)}throw new Error(`oneof cannot contain ${o.kind}`);case"map":const l=Object.keys(r).concat(Object.keys(s));switch(i.V.kind){case"message":const f=i.V.T;return l.every(u=>f.equals(r[u],s[u]));case"enum":return l.every(u=>Ue(w.INT32,r[u],s[u]));case"scalar":const h=i.V.T;return l.every(u=>Ue(h,r[u],s[u]))}break}})},clone(n){const e=n.getType(),t=new e,i=t;for(const r of e.fields.byMember()){const s=n[r.localName];let o;if(r.repeated)o=s.map(ln);else if(r.kind=="map"){o=i[r.localName];for(const[l,f]of Object.entries(s))o[l]=ln(f)}else r.kind=="oneof"?o=r.findField(s.case)?{case:s.case,value:ln(s.value)}:{case:void 0}:o=ln(s);i[r.localName]=o}for(const r of e.runtime.bin.listUnknownFields(n))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return t}}}function ln(n){if(n===void 0)return n;if(Ze(n))return n.clone();if(n instanceof Uint8Array){const e=new Uint8Array(n.byteLength);return e.set(n),e}return n}function Pt(n){return n instanceof Uint8Array?n:new Uint8Array(n)}function Hl(n,e,t){return{syntax:n,json:Ol(),bin:Ml(),util:Object.assign(Object.assign({},Vl()),{newFieldList:e,initFields:t}),makeMessageType(i,r,s){return gl(this,i,r,s)},makeEnum:pl,makeEnumType:Eo,getEnumType:ml,makeExtension(i,r,s){return kl(this,i,r,s)}}}class $l{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const t={};for(const i of this.list())t[i.jsonName]=t[i.name]=i;this.jsonNames=t}return this.jsonNames[e]}find(e){if(!this.numbers){const t={};for(const i of this.list())t[i.no]=i;this.numbers=t}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const i of this.list())i.oneof?i.oneof!==t&&(t=i.oneof,e.push(t)):e.push(i)}return this.members}}function xo(n,e){const t=Po(n);return e?t:zl(jl(t))}function ql(n){return xo(n,!1)}const Wl=Po;function Po(n){let e=!1;const t=[];for(let i=0;i<n.length;i++){let r=n.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":t.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),t.push(r);break}}return t.join("")}const Gl=new Set(["constructor","toString","toJSON","valueOf"]),Jl=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Lo=n=>`${n}$`,jl=n=>Jl.has(n)?Lo(n):n,zl=n=>Gl.has(n)?Lo(n):n;class Yl{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=ql(e)}addField(e){Y(e.oneof===this,`field ${e.name} not one of ${this.name}`),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let t=0;t<this.fields.length;t++)this._lookup[this.fields[t].localName]=this.fields[t]}return this._lookup[e]}}function Xl(n,e){var t,i,r,s,o,l;const f=[];let h;for(const u of typeof n=="function"?n():n){const p=u;if(p.localName=xo(u.name,u.oneof!==void 0),p.jsonName=(t=u.jsonName)!==null&&t!==void 0?t:Wl(u.name),p.repeated=(i=u.repeated)!==null&&i!==void 0?i:!1,u.kind=="scalar"&&(p.L=(r=u.L)!==null&&r!==void 0?r:He.BIGINT),p.delimited=(s=u.delimited)!==null&&s!==void 0?s:!1,p.req=(o=u.req)!==null&&o!==void 0?o:!1,p.opt=(l=u.opt)!==null&&l!==void 0?l:!1,u.packed===void 0&&(p.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=w.BYTES&&u.T!=w.STRING),u.oneof!==void 0){const _=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!h||h.name!=_)&&(h=new Yl(_)),p.oneof=h,h.addField(p)}f.push(p)}return f}const S=Hl("proto3",n=>new $l(n,e=>Xl(e)),n=>{for(const e of n.getType().fields.byMember()){if(e.opt)continue;const t=e.localName,i=n;if(e.repeated){i[t]=[];continue}switch(e.kind){case"oneof":i[t]={case:void 0};break;case"enum":i[t]=0;break;case"map":i[t]={};break;case"scalar":i[t]=kt(e.T,e.L);break}}}),Ql=S.makeEnum("livekit.AudioCodec",[{no:0,name:"DEFAULT_AC"},{no:1,name:"OPUS"},{no:2,name:"AAC"}]),Zl=S.makeEnum("livekit.VideoCodec",[{no:0,name:"DEFAULT_VC"},{no:1,name:"H264_BASELINE"},{no:2,name:"H264_MAIN"},{no:3,name:"H264_HIGH"},{no:4,name:"VP8"}]),ed=S.makeEnum("livekit.ImageCodec",[{no:0,name:"IC_DEFAULT"},{no:1,name:"IC_JPEG"}]),td=S.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),_t=S.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),nd=S.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),id=S.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"}]),rd=S.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"}]),Ii=S.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:sd,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:Do}]),sd=S.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),ji=S.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:S.getEnumType(_t),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Ai=S.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:S.getEnumType(od)},{no:4,name:"tracks",kind:"message",T:Fo,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:ji},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:S.getEnumType(ad)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:S.getEnumType(id)}]),od=S.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),ad=S.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),cd=S.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),ud=S.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Mo,repeated:!0}]),Fo=S.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:S.getEnumType(td)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:S.getEnumType(_t)},{no:10,name:"layers",kind:"message",T:Mo,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:ud,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:S.getEnumType(cd)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:Do},{no:19,name:"audio_features",kind:"enum",T:S.getEnumType(rd),repeated:!0}]),Mo=S.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:S.getEnumType(nd)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]),ld=S.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),dd=S.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),Do=S.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),hd=S.makeEnum("livekit.EncodedFileType",[{no:0,name:"DEFAULT_FILETYPE"},{no:1,name:"MP4"},{no:2,name:"OGG"}]),fd=S.makeEnum("livekit.SegmentedFileProtocol",[{no:0,name:"DEFAULT_SEGMENTED_FILE_PROTOCOL"},{no:1,name:"HLS_PROTOCOL"}]),md=S.makeEnum("livekit.SegmentedFileSuffix",[{no:0,name:"INDEX"},{no:1,name:"TIMESTAMP"}]),pd=S.makeEnum("livekit.ImageFileSuffix",[{no:0,name:"IMAGE_SUFFIX_INDEX"},{no:1,name:"IMAGE_SUFFIX_TIMESTAMP"}]),Bo=S.makeEnum("livekit.StreamProtocol",[{no:0,name:"DEFAULT_PROTOCOL"},{no:1,name:"RTMP"},{no:2,name:"SRT"}]),jt=S.makeEnum("livekit.EncodingOptionsPreset",[{no:0,name:"H264_720P_30"},{no:1,name:"H264_720P_60"},{no:2,name:"H264_1080P_30"},{no:3,name:"H264_1080P_60"},{no:4,name:"PORTRAIT_H264_720P_30"},{no:5,name:"PORTRAIT_H264_720P_60"},{no:6,name:"PORTRAIT_H264_1080P_30"},{no:7,name:"PORTRAIT_H264_1080P_60"}]),gd=S.makeEnum("livekit.EgressStatus",[{no:0,name:"EGRESS_STARTING"},{no:1,name:"EGRESS_ACTIVE"},{no:2,name:"EGRESS_ENDING"},{no:3,name:"EGRESS_COMPLETE"},{no:4,name:"EGRESS_FAILED"},{no:5,name:"EGRESS_ABORTED"},{no:6,name:"EGRESS_LIMIT_REACHED"}]),zi=S.makeMessageType("livekit.RoomCompositeEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"layout",kind:"scalar",T:9},{no:3,name:"audio_only",kind:"scalar",T:8},{no:4,name:"video_only",kind:"scalar",T:8},{no:5,name:"custom_base_url",kind:"scalar",T:9},{no:6,name:"file",kind:"message",T:$e,oneof:"output"},{no:7,name:"stream",kind:"message",T:We,oneof:"output"},{no:10,name:"segments",kind:"message",T:qe,oneof:"output"},{no:8,name:"preset",kind:"enum",T:S.getEnumType(jt),oneof:"options"},{no:9,name:"advanced",kind:"message",T:Zt,oneof:"options"},{no:11,name:"file_outputs",kind:"message",T:$e,repeated:!0},{no:12,name:"stream_outputs",kind:"message",T:We,repeated:!0},{no:13,name:"segment_outputs",kind:"message",T:qe,repeated:!0},{no:14,name:"image_outputs",kind:"message",T:Bn,repeated:!0}]),Uo=S.makeMessageType("livekit.WebEgressRequest",()=>[{no:1,name:"url",kind:"scalar",T:9},{no:2,name:"audio_only",kind:"scalar",T:8},{no:3,name:"video_only",kind:"scalar",T:8},{no:12,name:"await_start_signal",kind:"scalar",T:8},{no:4,name:"file",kind:"message",T:$e,oneof:"output"},{no:5,name:"stream",kind:"message",T:We,oneof:"output"},{no:6,name:"segments",kind:"message",T:qe,oneof:"output"},{no:7,name:"preset",kind:"enum",T:S.getEnumType(jt),oneof:"options"},{no:8,name:"advanced",kind:"message",T:Zt,oneof:"options"},{no:9,name:"file_outputs",kind:"message",T:$e,repeated:!0},{no:10,name:"stream_outputs",kind:"message",T:We,repeated:!0},{no:11,name:"segment_outputs",kind:"message",T:qe,repeated:!0},{no:13,name:"image_outputs",kind:"message",T:Bn,repeated:!0}]),Ko=S.makeMessageType("livekit.ParticipantEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"screen_share",kind:"scalar",T:8},{no:4,name:"preset",kind:"enum",T:S.getEnumType(jt),oneof:"options"},{no:5,name:"advanced",kind:"message",T:Zt,oneof:"options"},{no:6,name:"file_outputs",kind:"message",T:$e,repeated:!0},{no:7,name:"stream_outputs",kind:"message",T:We,repeated:!0},{no:8,name:"segment_outputs",kind:"message",T:qe,repeated:!0},{no:9,name:"image_outputs",kind:"message",T:Bn,repeated:!0}]),Vo=S.makeMessageType("livekit.TrackCompositeEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"audio_track_id",kind:"scalar",T:9},{no:3,name:"video_track_id",kind:"scalar",T:9},{no:4,name:"file",kind:"message",T:$e,oneof:"output"},{no:5,name:"stream",kind:"message",T:We,oneof:"output"},{no:8,name:"segments",kind:"message",T:qe,oneof:"output"},{no:6,name:"preset",kind:"enum",T:S.getEnumType(jt),oneof:"options"},{no:7,name:"advanced",kind:"message",T:Zt,oneof:"options"},{no:11,name:"file_outputs",kind:"message",T:$e,repeated:!0},{no:12,name:"stream_outputs",kind:"message",T:We,repeated:!0},{no:13,name:"segment_outputs",kind:"message",T:qe,repeated:!0},{no:14,name:"image_outputs",kind:"message",T:Bn,repeated:!0}]),Ho=S.makeMessageType("livekit.TrackEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"track_id",kind:"scalar",T:9},{no:3,name:"file",kind:"message",T:_d,oneof:"output"},{no:4,name:"websocket_url",kind:"scalar",T:9,oneof:"output"}]),$e=S.makeMessageType("livekit.EncodedFileOutput",()=>[{no:1,name:"file_type",kind:"enum",T:S.getEnumType(hd)},{no:2,name:"filepath",kind:"scalar",T:9},{no:6,name:"disable_manifest",kind:"scalar",T:8},{no:3,name:"s3",kind:"message",T:zt,oneof:"output"},{no:4,name:"gcp",kind:"message",T:Yt,oneof:"output"},{no:5,name:"azure",kind:"message",T:Xt,oneof:"output"},{no:7,name:"aliOSS",kind:"message",T:Qt,oneof:"output"}]),qe=S.makeMessageType("livekit.SegmentedFileOutput",()=>[{no:1,name:"protocol",kind:"enum",T:S.getEnumType(fd)},{no:2,name:"filename_prefix",kind:"scalar",T:9},{no:3,name:"playlist_name",kind:"scalar",T:9},{no:11,name:"live_playlist_name",kind:"scalar",T:9},{no:4,name:"segment_duration",kind:"scalar",T:13},{no:10,name:"filename_suffix",kind:"enum",T:S.getEnumType(md)},{no:8,name:"disable_manifest",kind:"scalar",T:8},{no:5,name:"s3",kind:"message",T:zt,oneof:"output"},{no:6,name:"gcp",kind:"message",T:Yt,oneof:"output"},{no:7,name:"azure",kind:"message",T:Xt,oneof:"output"},{no:9,name:"aliOSS",kind:"message",T:Qt,oneof:"output"}]),_d=S.makeMessageType("livekit.DirectFileOutput",()=>[{no:1,name:"filepath",kind:"scalar",T:9},{no:5,name:"disable_manifest",kind:"scalar",T:8},{no:2,name:"s3",kind:"message",T:zt,oneof:"output"},{no:3,name:"gcp",kind:"message",T:Yt,oneof:"output"},{no:4,name:"azure",kind:"message",T:Xt,oneof:"output"},{no:6,name:"aliOSS",kind:"message",T:Qt,oneof:"output"}]),Bn=S.makeMessageType("livekit.ImageOutput",()=>[{no:1,name:"capture_interval",kind:"scalar",T:13},{no:2,name:"width",kind:"scalar",T:5},{no:3,name:"height",kind:"scalar",T:5},{no:4,name:"filename_prefix",kind:"scalar",T:9},{no:5,name:"filename_suffix",kind:"enum",T:S.getEnumType(pd)},{no:6,name:"image_codec",kind:"enum",T:S.getEnumType(ed)},{no:7,name:"disable_manifest",kind:"scalar",T:8},{no:8,name:"s3",kind:"message",T:zt,oneof:"output"},{no:9,name:"gcp",kind:"message",T:Yt,oneof:"output"},{no:10,name:"azure",kind:"message",T:Xt,oneof:"output"},{no:11,name:"aliOSS",kind:"message",T:Qt,oneof:"output"}]),zt=S.makeMessageType("livekit.S3Upload",()=>[{no:1,name:"access_key",kind:"scalar",T:9},{no:2,name:"secret",kind:"scalar",T:9},{no:11,name:"session_token",kind:"scalar",T:9},{no:3,name:"region",kind:"scalar",T:9},{no:4,name:"endpoint",kind:"scalar",T:9},{no:5,name:"bucket",kind:"scalar",T:9},{no:6,name:"force_path_style",kind:"scalar",T:8},{no:7,name:"metadata",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:8,name:"tagging",kind:"scalar",T:9},{no:9,name:"content_disposition",kind:"scalar",T:9},{no:10,name:"proxy",kind:"message",T:$o}]),Yt=S.makeMessageType("livekit.GCPUpload",()=>[{no:1,name:"credentials",kind:"scalar",T:9},{no:2,name:"bucket",kind:"scalar",T:9},{no:3,name:"proxy",kind:"message",T:$o}]),Xt=S.makeMessageType("livekit.AzureBlobUpload",()=>[{no:1,name:"account_name",kind:"scalar",T:9},{no:2,name:"account_key",kind:"scalar",T:9},{no:3,name:"container_name",kind:"scalar",T:9}]),Qt=S.makeMessageType("livekit.AliOSSUpload",()=>[{no:1,name:"access_key",kind:"scalar",T:9},{no:2,name:"secret",kind:"scalar",T:9},{no:3,name:"region",kind:"scalar",T:9},{no:4,name:"endpoint",kind:"scalar",T:9},{no:5,name:"bucket",kind:"scalar",T:9}]),$o=S.makeMessageType("livekit.ProxyConfig",()=>[{no:1,name:"url",kind:"scalar",T:9},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"password",kind:"scalar",T:9}]),We=S.makeMessageType("livekit.StreamOutput",()=>[{no:1,name:"protocol",kind:"enum",T:S.getEnumType(Bo)},{no:2,name:"urls",kind:"scalar",T:9,repeated:!0}]),Zt=S.makeMessageType("livekit.EncodingOptions",()=>[{no:1,name:"width",kind:"scalar",T:5},{no:2,name:"height",kind:"scalar",T:5},{no:3,name:"depth",kind:"scalar",T:5},{no:4,name:"framerate",kind:"scalar",T:5},{no:5,name:"audio_codec",kind:"enum",T:S.getEnumType(Ql)},{no:6,name:"audio_bitrate",kind:"scalar",T:5},{no:11,name:"audio_quality",kind:"scalar",T:5},{no:7,name:"audio_frequency",kind:"scalar",T:5},{no:8,name:"video_codec",kind:"enum",T:S.getEnumType(Zl)},{no:9,name:"video_bitrate",kind:"scalar",T:5},{no:12,name:"video_quality",kind:"scalar",T:5},{no:10,name:"key_frame_interval",kind:"scalar",T:1}]),yd=S.makeMessageType("livekit.UpdateLayoutRequest",()=>[{no:1,name:"egress_id",kind:"scalar",T:9},{no:2,name:"layout",kind:"scalar",T:9}]),Ed=S.makeMessageType("livekit.UpdateStreamRequest",()=>[{no:1,name:"egress_id",kind:"scalar",T:9},{no:2,name:"add_output_urls",kind:"scalar",T:9,repeated:!0},{no:3,name:"remove_output_urls",kind:"scalar",T:9,repeated:!0}]),Td=S.makeMessageType("livekit.ListEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"egress_id",kind:"scalar",T:9},{no:3,name:"active",kind:"scalar",T:8}]),wd=S.makeMessageType("livekit.ListEgressResponse",()=>[{no:1,name:"items",kind:"message",T:Ne,repeated:!0}]),Sd=S.makeMessageType("livekit.StopEgressRequest",()=>[{no:1,name:"egress_id",kind:"scalar",T:9}]),Ne=S.makeMessageType("livekit.EgressInfo",()=>[{no:1,name:"egress_id",kind:"scalar",T:9},{no:2,name:"room_id",kind:"scalar",T:9},{no:13,name:"room_name",kind:"scalar",T:9},{no:3,name:"status",kind:"enum",T:S.getEnumType(gd)},{no:10,name:"started_at",kind:"scalar",T:3},{no:11,name:"ended_at",kind:"scalar",T:3},{no:18,name:"updated_at",kind:"scalar",T:3},{no:21,name:"details",kind:"scalar",T:9},{no:9,name:"error",kind:"scalar",T:9},{no:22,name:"error_code",kind:"scalar",T:5},{no:4,name:"room_composite",kind:"message",T:zi,oneof:"request"},{no:14,name:"web",kind:"message",T:Uo,oneof:"request"},{no:19,name:"participant",kind:"message",T:Ko,oneof:"request"},{no:5,name:"track_composite",kind:"message",T:Vo,oneof:"request"},{no:6,name:"track",kind:"message",T:Ho,oneof:"request"},{no:7,name:"stream",kind:"message",T:bd,oneof:"result"},{no:8,name:"file",kind:"message",T:rs,oneof:"result"},{no:12,name:"segments",kind:"message",T:ss,oneof:"result"},{no:15,name:"stream_results",kind:"message",T:qo,repeated:!0},{no:16,name:"file_results",kind:"message",T:rs,repeated:!0},{no:17,name:"segment_results",kind:"message",T:ss,repeated:!0},{no:20,name:"image_results",kind:"message",T:Rd,repeated:!0}]),bd=S.makeMessageType("livekit.StreamInfoList",()=>[{no:1,name:"info",kind:"message",T:qo,repeated:!0}]),qo=S.makeMessageType("livekit.StreamInfo",()=>[{no:1,name:"url",kind:"scalar",T:9},{no:2,name:"started_at",kind:"scalar",T:3},{no:3,name:"ended_at",kind:"scalar",T:3},{no:4,name:"duration",kind:"scalar",T:3},{no:5,name:"status",kind:"enum",T:S.getEnumType(kd)},{no:6,name:"error",kind:"scalar",T:9}]),kd=S.makeEnum("livekit.StreamInfo.Status",[{no:0,name:"ACTIVE"},{no:1,name:"FINISHED"},{no:2,name:"FAILED"}]),rs=S.makeMessageType("livekit.FileInfo",()=>[{no:1,name:"filename",kind:"scalar",T:9},{no:2,name:"started_at",kind:"scalar",T:3},{no:3,name:"ended_at",kind:"scalar",T:3},{no:6,name:"duration",kind:"scalar",T:3},{no:4,name:"size",kind:"scalar",T:3},{no:5,name:"location",kind:"scalar",T:9}]),ss=S.makeMessageType("livekit.SegmentsInfo",()=>[{no:1,name:"playlist_name",kind:"scalar",T:9},{no:8,name:"live_playlist_name",kind:"scalar",T:9},{no:2,name:"duration",kind:"scalar",T:3},{no:3,name:"size",kind:"scalar",T:3},{no:4,name:"playlist_location",kind:"scalar",T:9},{no:9,name:"live_playlist_location",kind:"scalar",T:9},{no:5,name:"segment_count",kind:"scalar",T:3},{no:6,name:"started_at",kind:"scalar",T:3},{no:7,name:"ended_at",kind:"scalar",T:3}]),Rd=S.makeMessageType("livekit.ImagesInfo",()=>[{no:4,name:"filename_prefix",kind:"scalar",T:9},{no:1,name:"image_count",kind:"scalar",T:3},{no:2,name:"started_at",kind:"scalar",T:3},{no:3,name:"ended_at",kind:"scalar",T:3}]),Cd=S.makeMessageType("livekit.AutoParticipantEgress",()=>[{no:1,name:"preset",kind:"enum",T:S.getEnumType(jt),oneof:"options"},{no:2,name:"advanced",kind:"message",T:Zt,oneof:"options"},{no:3,name:"file_outputs",kind:"message",T:$e,repeated:!0},{no:4,name:"segment_outputs",kind:"message",T:qe,repeated:!0}]),Id=S.makeMessageType("livekit.AutoTrackEgress",()=>[{no:1,name:"filepath",kind:"scalar",T:9},{no:5,name:"disable_manifest",kind:"scalar",T:8},{no:2,name:"s3",kind:"message",T:zt,oneof:"output"},{no:3,name:"gcp",kind:"message",T:Yt,oneof:"output"},{no:4,name:"azure",kind:"message",T:Xt,oneof:"output"},{no:6,name:"aliOSS",kind:"message",T:Qt,oneof:"output"}]),Ad=S.makeMessageType("livekit.RoomAgentDispatch",()=>[{no:1,name:"agent_name",kind:"scalar",T:9},{no:2,name:"metadata",kind:"scalar",T:9}]),Nd=S.makeMessageType("livekit.CreateRoomRequest",()=>[{no:1,name:"name",kind:"scalar",T:9},{no:12,name:"config_name",kind:"scalar",T:9},{no:2,name:"empty_timeout",kind:"scalar",T:13},{no:10,name:"departure_timeout",kind:"scalar",T:13},{no:3,name:"max_participants",kind:"scalar",T:13},{no:4,name:"node_id",kind:"scalar",T:9},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"egress",kind:"message",T:vd},{no:11,name:"agent",kind:"message",T:Od},{no:7,name:"min_playout_delay",kind:"scalar",T:13},{no:8,name:"max_playout_delay",kind:"scalar",T:13},{no:9,name:"sync_streams",kind:"scalar",T:8},{no:13,name:"replay_enabled",kind:"scalar",T:8}]),vd=S.makeMessageType("livekit.RoomEgress",()=>[{no:1,name:"room",kind:"message",T:zi},{no:3,name:"participant",kind:"message",T:Cd},{no:2,name:"tracks",kind:"message",T:Id}]),Od=S.makeMessageType("livekit.RoomAgent",()=>[{no:1,name:"dispatches",kind:"message",T:Ad,repeated:!0}]),xd=S.makeMessageType("livekit.ListRoomsRequest",()=>[{no:1,name:"names",kind:"scalar",T:9,repeated:!0}]),Pd=S.makeMessageType("livekit.ListRoomsResponse",()=>[{no:1,name:"rooms",kind:"message",T:Ii,repeated:!0}]),Ld=S.makeMessageType("livekit.DeleteRoomRequest",()=>[{no:1,name:"room",kind:"scalar",T:9}]),Fd=S.makeMessageType("livekit.ListParticipantsRequest",()=>[{no:1,name:"room",kind:"scalar",T:9}]),Md=S.makeMessageType("livekit.ListParticipantsResponse",()=>[{no:1,name:"participants",kind:"message",T:Ai,repeated:!0}]),os=S.makeMessageType("livekit.RoomParticipantIdentity",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9}]),Dd=S.makeMessageType("livekit.MuteRoomTrackRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"track_sid",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8}]),Bd=S.makeMessageType("livekit.MuteRoomTrackResponse",()=>[{no:1,name:"track",kind:"message",T:Fo}]),Ud=S.makeMessageType("livekit.UpdateParticipantRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"permission",kind:"message",T:ji},{no:5,name:"name",kind:"scalar",T:9},{no:6,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}]),Kd=S.makeMessageType("livekit.UpdateSubscriptionsRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"subscribe",kind:"scalar",T:8},{no:5,name:"participant_tracks",kind:"message",T:dd,repeated:!0}]),Vd=S.makeMessageType("livekit.SendDataRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"data",kind:"scalar",T:12},{no:3,name:"kind",kind:"enum",T:S.getEnumType(ld)},{no:4,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:5,name:"topic",kind:"scalar",T:9,opt:!0}]),Hd=S.makeMessageType("livekit.UpdateRoomMetadataRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"metadata",kind:"scalar",T:9}]),Yi=crypto,Wo=n=>n instanceof CryptoKey,yt=new TextEncoder,Ni=new TextDecoder;function $d(...n){const e=n.reduce((r,{length:s})=>r+s,0),t=new Uint8Array(e);let i=0;for(const r of n)t.set(r,i),i+=r.length;return t}const qd=n=>{let e=n;typeof e=="string"&&(e=yt.encode(e));const t=32768,i=[];for(let r=0;r<e.length;r+=t)i.push(String.fromCharCode.apply(null,e.subarray(r,r+t)));return btoa(i.join(""))},si=n=>qd(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),Wd=n=>{const e=atob(n),t=new Uint8Array(e.length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t},Xi=n=>{let e=n;e instanceof Uint8Array&&(e=Ni.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Wd(e)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class Qi extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(t=Error.captureStackTrace)==null||t.call(Error,this,this.constructor)}}class Et extends Qi{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}}class Lt extends Qi{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}}class Gd extends Qi{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}}function Ce(n,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${n}`)}function dn(n,e){return n.name===e}function oi(n){return parseInt(n.name.slice(4),10)}function Jd(n){switch(n){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function jd(n,e){if(e.length&&!e.some(t=>n.usages.includes(t))){let t="CryptoKey does not support this operation, its usages must include ";if(e.length>2){const i=e.pop();t+=`one of ${e.join(", ")}, or ${i}.`}else e.length===2?t+=`one of ${e[0]} or ${e[1]}.`:t+=`${e[0]}.`;throw new TypeError(t)}}function zd(n,e,...t){switch(e){case"HS256":case"HS384":case"HS512":{if(!dn(n.algorithm,"HMAC"))throw Ce("HMAC");const i=parseInt(e.slice(2),10);if(oi(n.algorithm.hash)!==i)throw Ce(`SHA-${i}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!dn(n.algorithm,"RSASSA-PKCS1-v1_5"))throw Ce("RSASSA-PKCS1-v1_5");const i=parseInt(e.slice(2),10);if(oi(n.algorithm.hash)!==i)throw Ce(`SHA-${i}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!dn(n.algorithm,"RSA-PSS"))throw Ce("RSA-PSS");const i=parseInt(e.slice(2),10);if(oi(n.algorithm.hash)!==i)throw Ce(`SHA-${i}`,"algorithm.hash");break}case"EdDSA":{if(n.algorithm.name!=="Ed25519"&&n.algorithm.name!=="Ed448")throw Ce("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!dn(n.algorithm,"ECDSA"))throw Ce("ECDSA");const i=Jd(e);if(n.algorithm.namedCurve!==i)throw Ce(i,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}jd(n,t)}function Go(n,e,...t){var i;if(t=t.filter(Boolean),t.length>2){const r=t.pop();n+=`one of type ${t.join(", ")}, or ${r}.`}else t.length===2?n+=`one of type ${t[0]} or ${t[1]}.`:n+=`of type ${t[0]}.`;return e==null?n+=` Received ${e}`:typeof e=="function"&&e.name?n+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&(i=e.constructor)!=null&&i.name&&(n+=` Received an instance of ${e.constructor.name}`),n}const as=(n,...e)=>Go("Key must be ",n,...e);function Jo(n,e,...t){return Go(`Key for the ${n} algorithm must be `,e,...t)}const jo=n=>Wo(n)?!0:(n==null?void 0:n[Symbol.toStringTag])==="KeyObject",In=["CryptoKey"],Yd=(...n)=>{const e=n.filter(Boolean);if(e.length===0||e.length===1)return!0;let t;for(const i of e){const r=Object.keys(i);if(!t||t.size===0){t=new Set(r);continue}for(const s of r){if(t.has(s))return!1;t.add(s)}}return!0};function Xd(n){return typeof n=="object"&&n!==null}function zo(n){if(!Xd(n)||Object.prototype.toString.call(n)!=="[object Object]")return!1;if(Object.getPrototypeOf(n)===null)return!0;let e=n;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(n)===e}const Qd=(n,e)=>{if(n.startsWith("RS")||n.startsWith("PS")){const{modulusLength:t}=e.algorithm;if(typeof t!="number"||t<2048)throw new TypeError(`${n} requires key modulusLength to be 2048 bits or larger`)}};function en(n){return zo(n)&&typeof n.kty=="string"}function Zd(n){return n.kty!=="oct"&&typeof n.d=="string"}function eh(n){return n.kty!=="oct"&&typeof n.d>"u"}function th(n){return en(n)&&n.kty==="oct"&&typeof n.k=="string"}function nh(n){let e,t;switch(n.kty){case"RSA":{switch(n.alg){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${n.alg.slice(-3)}`},t=n.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${n.alg.slice(-3)}`},t=n.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(n.alg.slice(-3),10)||1}`},t=n.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new Et('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(n.alg){case"ES256":e={name:"ECDSA",namedCurve:"P-256"},t=n.d?["sign"]:["verify"];break;case"ES384":e={name:"ECDSA",namedCurve:"P-384"},t=n.d?["sign"]:["verify"];break;case"ES512":e={name:"ECDSA",namedCurve:"P-521"},t=n.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:"ECDH",namedCurve:n.crv},t=n.d?["deriveBits"]:[];break;default:throw new Et('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(n.alg){case"EdDSA":e={name:n.crv},t=n.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:n.crv},t=n.d?["deriveBits"]:[];break;default:throw new Et('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new Et('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:e,keyUsages:t}}const ih=async n=>{if(!n.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:e,keyUsages:t}=nh(n),i=[e,n.ext??!1,n.key_ops??t],r={...n};return delete r.alg,delete r.use,Yi.subtle.importKey("jwk",r,...i)},Yo=n=>Xi(n);let mt,pt;const Xo=n=>(n==null?void 0:n[Symbol.toStringTag])==="KeyObject",An=async(n,e,t,i,r=!1)=>{let s=n.get(e);if(s!=null&&s[i])return s[i];const o=await ih({...t,alg:i});return r&&Object.freeze(e),s?s[i]=o:n.set(e,{[i]:o}),o},rh=(n,e)=>{if(Xo(n)){let t=n.export({format:"jwk"});return delete t.d,delete t.dp,delete t.dq,delete t.p,delete t.q,delete t.qi,t.k?Yo(t.k):(pt||(pt=new WeakMap),An(pt,n,t,e))}return en(n)?n.k?Xi(n.k):(pt||(pt=new WeakMap),An(pt,n,n,e,!0)):n},sh=(n,e)=>{if(Xo(n)){let t=n.export({format:"jwk"});return t.k?Yo(t.k):(mt||(mt=new WeakMap),An(mt,n,t,e))}return en(n)?n.k?Xi(n.k):(mt||(mt=new WeakMap),An(mt,n,n,e,!0)):n},oh={normalizePublicKey:rh,normalizePrivateKey:sh},gt=n=>n==null?void 0:n[Symbol.toStringTag],vi=(n,e,t)=>{var i,r;if(e.use!==void 0&&e.use!=="sig")throw new TypeError("Invalid key for this operation, when present its use must be sig");if(e.key_ops!==void 0&&((r=(i=e.key_ops).includes)==null?void 0:r.call(i,t))!==!0)throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${t}`);if(e.alg!==void 0&&e.alg!==n)throw new TypeError(`Invalid key for this operation, when present its alg must be ${n}`);return!0},ah=(n,e,t,i)=>{if(!(e instanceof Uint8Array)){if(i&&en(e)){if(th(e)&&vi(n,e,t))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!jo(e))throw new TypeError(Jo(n,e,...In,"Uint8Array",i?"JSON Web Key":null));if(e.type!=="secret")throw new TypeError(`${gt(e)} instances for symmetric algorithms must be of type "secret"`)}},ch=(n,e,t,i)=>{if(i&&en(e))switch(t){case"sign":if(Zd(e)&&vi(n,e,t))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(eh(e)&&vi(n,e,t))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!jo(e))throw new TypeError(Jo(n,e,...In,i?"JSON Web Key":null));if(e.type==="secret")throw new TypeError(`${gt(e)} instances for asymmetric algorithms must not be of type "secret"`);if(t==="sign"&&e.type==="public")throw new TypeError(`${gt(e)} instances for asymmetric algorithm signing must be of type "private"`);if(t==="decrypt"&&e.type==="public")throw new TypeError(`${gt(e)} instances for asymmetric algorithm decryption must be of type "private"`);if(e.algorithm&&t==="verify"&&e.type==="private")throw new TypeError(`${gt(e)} instances for asymmetric algorithm verifying must be of type "public"`);if(e.algorithm&&t==="encrypt"&&e.type==="private")throw new TypeError(`${gt(e)} instances for asymmetric algorithm encryption must be of type "public"`)};function Qo(n,e,t,i){e.startsWith("HS")||e==="dir"||e.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(e)?ah(e,t,i,n):ch(e,t,i,n)}Qo.bind(void 0,!1);const uh=Qo.bind(void 0,!0);function lh(n,e,t,i,r){if(r.crit!==void 0&&(i==null?void 0:i.crit)===void 0)throw new n('"crit" (Critical) Header Parameter MUST be integrity protected');if(!i||i.crit===void 0)return new Set;if(!Array.isArray(i.crit)||i.crit.length===0||i.crit.some(o=>typeof o!="string"||o.length===0))throw new n('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let s;t!==void 0?s=new Map([...Object.entries(t),...e.entries()]):s=e;for(const o of i.crit){if(!s.has(o))throw new Et(`Extension Header Parameter "${o}" is not recognized`);if(r[o]===void 0)throw new n(`Extension Header Parameter "${o}" is missing`);if(s.get(o)&&i[o]===void 0)throw new n(`Extension Header Parameter "${o}" MUST be integrity protected`)}return new Set(i.crit)}function dh(n,e){const t=`SHA-${n.slice(-3)}`;switch(n){case"HS256":case"HS384":case"HS512":return{hash:t,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:t,name:"RSA-PSS",saltLength:n.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:t,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:t,name:"ECDSA",namedCurve:e.namedCurve};case"EdDSA":return{name:e.name};default:throw new Et(`alg ${n} is not supported either by JOSE or your javascript runtime`)}}async function hh(n,e,t){if(e=await oh.normalizePrivateKey(e,n),Wo(e))return zd(e,n,t),e;if(e instanceof Uint8Array){if(!n.startsWith("HS"))throw new TypeError(as(e,...In));return Yi.subtle.importKey("raw",e,{hash:`SHA-${n.slice(-3)}`,name:"HMAC"},!1,[t])}throw new TypeError(as(e,...In,"Uint8Array","JSON Web Key"))}const ze=n=>Math.floor(n.getTime()/1e3),Zo=60,ea=Zo*60,Zi=ea*24,fh=Zi*7,mh=Zi*365.25,ph=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,ai=n=>{const e=ph.exec(n);if(!e||e[4]&&e[1])throw new TypeError("Invalid time period format");const t=parseFloat(e[2]),i=e[3].toLowerCase();let r;switch(i){case"sec":case"secs":case"second":case"seconds":case"s":r=Math.round(t);break;case"minute":case"minutes":case"min":case"mins":case"m":r=Math.round(t*Zo);break;case"hour":case"hours":case"hr":case"hrs":case"h":r=Math.round(t*ea);break;case"day":case"days":case"d":r=Math.round(t*Zi);break;case"week":case"weeks":case"w":r=Math.round(t*fh);break;default:r=Math.round(t*mh);break}return e[1]==="-"||e[4]==="ago"?-r:r},gh=async(n,e,t)=>{const i=await hh(n,e,"sign");Qd(n,i);const r=await Yi.subtle.sign(dh(n,i.algorithm),i,t);return new Uint8Array(r)};class _h{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){if(!this._protectedHeader&&!this._unprotectedHeader)throw new Lt("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!Yd(this._protectedHeader,this._unprotectedHeader))throw new Lt("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const i={...this._protectedHeader,...this._unprotectedHeader},r=lh(Lt,new Map([["b64",!0]]),t==null?void 0:t.crit,this._protectedHeader,i);let s=!0;if(r.has("b64")&&(s=this._protectedHeader.b64,typeof s!="boolean"))throw new Lt('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:o}=i;if(typeof o!="string"||!o)throw new Lt('JWS "alg" (Algorithm) Header Parameter missing or invalid');uh(o,e,"sign");let l=this._payload;s&&(l=yt.encode(si(l)));let f;this._protectedHeader?f=yt.encode(si(JSON.stringify(this._protectedHeader))):f=yt.encode("");const h=$d(f,yt.encode("."),l),u=await gh(o,e,h),p={signature:si(u),payload:""};return s&&(p.payload=Ni.decode(l)),this._unprotectedHeader&&(p.header=this._unprotectedHeader),this._protectedHeader&&(p.protected=Ni.decode(f)),p}}class yh{constructor(e){this._flattened=new _h(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){const i=await this._flattened.sign(e,t);if(i.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${i.protected}.${i.payload}.${i.signature}`}}function Ye(n,e){if(!Number.isFinite(e))throw new TypeError(`Invalid ${n} input`);return e}class Eh{constructor(e={}){if(!zo(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return typeof e=="number"?this._payload={...this._payload,nbf:Ye("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:Ye("setNotBefore",ze(e))}:this._payload={...this._payload,nbf:ze(new Date)+ai(e)},this}setExpirationTime(e){return typeof e=="number"?this._payload={...this._payload,exp:Ye("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:Ye("setExpirationTime",ze(e))}:this._payload={...this._payload,exp:ze(new Date)+ai(e)},this}setIssuedAt(e){return typeof e>"u"?this._payload={...this._payload,iat:ze(new Date)}:e instanceof Date?this._payload={...this._payload,iat:Ye("setIssuedAt",ze(e))}:typeof e=="string"?this._payload={...this._payload,iat:Ye("setIssuedAt",ze(new Date)+ai(e))}:this._payload={...this._payload,iat:Ye("setIssuedAt",e)},this}}class Th extends Eh{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){var r;const i=new yh(yt.encode(JSON.stringify(this._payload)));if(i.setProtectedHeader(this._protectedHeader),Array.isArray((r=this._protectedHeader)==null?void 0:r.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new Gd("JWTs MUST NOT use unencoded payload");return i.sign(e,t)}}function wh(n){switch(n){case _t.CAMERA:return"camera";case _t.MICROPHONE:return"microphone";case _t.SCREEN_SHARE:return"screen_share";case _t.SCREEN_SHARE_AUDIO:return"screen_share_audio";default:throw new TypeError(`Cannot convert TrackSource ${n} to string`)}}function Sh(n){var e;const t=Object.assign({},n);return Array.isArray((e=t.video)===null||e===void 0?void 0:e.canPublishSources)&&(t.video.canPublishSources=t.video.canPublishSources.map(wh)),t}var cs={};const bh="6h";class ta{constructor(e,t,i){if(e||(e=cs.LIVEKIT_API_KEY),t||(t=cs.LIVEKIT_API_SECRET),!e||!t)throw Error("api-key and api-secret must be set");typeof document<"u"&&console.error(`You should not include your API secret in your web client bundle.

Your web client should request a token from your backend server which should then use the API secret to generate a token. See https://docs.livekit.io/client/connect/`),this.apiKey=e,this.apiSecret=t,this.grants={},this.identity=i==null?void 0:i.identity,this.ttl=(i==null?void 0:i.ttl)||bh,typeof this.ttl=="number"&&(this.ttl=`${this.ttl}s`),i!=null&&i.metadata&&(this.metadata=i.metadata),i!=null&&i.name&&(this.name=i.name)}addGrant(e){var t;this.grants.video=Object.assign(Object.assign({},(t=this.grants.video)!==null&&t!==void 0?t:{}),e)}addSIPGrant(e){var t;this.grants.sip=Object.assign(Object.assign({},(t=this.grants.sip)!==null&&t!==void 0?t:{}),e)}get name(){return this.grants.name}set name(e){this.grants.name=e}get metadata(){return this.grants.metadata}set metadata(e){this.grants.metadata=e}get attributes(){return this.grants.attributes}set attributes(e){this.grants.attributes=e}get kind(){return this.grants.kind}set kind(e){this.grants.kind=e}get sha256(){return this.grants.sha256}set sha256(e){this.grants.sha256=e}async toJwt(){var e;const t=new TextEncoder().encode(this.apiSecret),i=new Th(Sh(this.grants)).setProtectedHeader({alg:"HS256"}).setIssuer(this.apiKey).setExpirationTime(this.ttl).setNotBefore(0);if(this.identity)i.setSubject(this.identity);else if(!((e=this.grants.video)===null||e===void 0)&&e.roomJoin)throw Error("identity is required for join but not set");return i.sign(t)}}class na{constructor(e,t,i){this.apiKey=e,this.secret=t,this.ttl=i||"10m"}async authHeader(e,t){const i=new ta(this.apiKey,this.secret,{ttl:this.ttl});return i.addGrant(e),t&&i.addSIPGrant(t),{Authorization:`Bearer ${await i.toJwt()}`}}}const ia=n=>typeof n=="object"&&n!==null,us=n=>ia(n)&&!(n instanceof RegExp)&&!(n instanceof Error)&&!(n instanceof Date),kh=Symbol("mapObjectSkip"),Oi=(n,e,t,i=new WeakMap)=>{if(t={deep:!1,target:{},...t},i.has(n))return i.get(n);i.set(n,t.target);const{target:r}=t;delete t.target;const s=o=>o.map(l=>us(l)?Oi(l,e,t,i):l);if(Array.isArray(n))return s(n);for(const[o,l]of Object.entries(n)){const f=e(o,l,n);if(f===kh)continue;let[h,u,{shouldRecurse:p=!0}={}]=f;h!=="__proto__"&&(t.deep&&p&&us(u)&&(u=Array.isArray(u)?s(u):Oi(u,e,t,i)),r[h]=u)}return r};function ls(n,e,t){if(!ia(n))throw new TypeError(`Expected an object, got \`${n}\` (${typeof n})`);return Oi(n,e,t)}const Rh=/[\p{Lu}]/u,Ch=/[\p{Ll}]/u,ds=/^[\p{Lu}](?![\p{Lu}])/gu,ra=/([\p{Alpha}\p{N}_]|$)/u,er=/[_.\- ]+/,Ih=new RegExp("^"+er.source),hs=new RegExp(er.source+ra.source,"gu"),fs=new RegExp("\\d+"+ra.source,"gu"),Ah=(n,e,t,i)=>{let r=!1,s=!1,o=!1,l=!1;for(let f=0;f<n.length;f++){const h=n[f];l=f>2?n[f-3]==="-":!0,r&&Rh.test(h)?(n=n.slice(0,f)+"-"+n.slice(f),r=!1,o=s,s=!0,f++):s&&o&&Ch.test(h)&&(!l||i)?(n=n.slice(0,f-1)+"-"+n.slice(f-1),o=s,s=!1,r=!0):(r=e(h)===h&&t(h)!==h,o=s,s=t(h)===h&&e(h)!==h)}return n},Nh=(n,e)=>(ds.lastIndex=0,n.replaceAll(ds,t=>e(t))),vh=(n,e)=>(hs.lastIndex=0,fs.lastIndex=0,n.replaceAll(fs,(t,i,r)=>["_","-"].includes(n.charAt(r+t.length))?t:e(t)).replaceAll(hs,(t,i)=>e(i)));function Oh(n,e){if(!(typeof n=="string"||Array.isArray(n)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(n)?n=n.map(s=>s.trim()).filter(s=>s.length).join("-"):n=n.trim(),n.length===0)return"";const t=e.locale===!1?s=>s.toLowerCase():s=>s.toLocaleLowerCase(e.locale),i=e.locale===!1?s=>s.toUpperCase():s=>s.toLocaleUpperCase(e.locale);return n.length===1?er.test(n)?"":e.pascalCase?i(n):t(n):(n!==t(n)&&(n=Ah(n,t,i,e.preserveConsecutiveUppercase)),n=n.replace(Ih,""),n=e.preserveConsecutiveUppercase?Nh(n,t):t(n),e.pascalCase&&(n=i(n.charAt(0))+n.slice(1)),vh(n,i))}class xh extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[t,i]of e)this.onEviction(t,i.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const i=t.get(e);return this._getItemValue(e,i)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,i]=e;this.cache.has(t)||this._deleteIfExpired(t,i)===!1&&(yield e)}for(const e of this.cache){const[t,i]=e;this._deleteIfExpired(t,i)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:i=this.maxAge}={}){const r=typeof i=="number"&&i!==Number.POSITIVE_INFINITY?Date.now()+i:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:r}):this._set(e,{value:t,expiry:r}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],i=t.length-e;i<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(i>0&&this._emitEvictions(t.slice(0,i)),this.oldCache=new Map(t.slice(i)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,i]=e;this._deleteIfExpired(t,i)===!1&&(yield[t,i.value])}for(const e of this.oldCache){const[t,i]=e;this.cache.has(t)||this._deleteIfExpired(t,i)===!1&&(yield[t,i.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const i=e[t],[r,s]=i;this._deleteIfExpired(r,s)===!1&&(yield[r,s.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const i=e[t],[r,s]=i;this.cache.has(r)||this._deleteIfExpired(r,s)===!1&&(yield[r,s.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[i,r]of this.entriesAscending())e.call(t,r,i,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}const Ph=(n,e)=>n.some(t=>typeof t=="string"?t===e:(t.lastIndex=0,t.test(e))),ci=new xh({maxSize:1e5}),ms=n=>typeof n=="object"&&n!==null&&!(n instanceof RegExp)&&!(n instanceof Error)&&!(n instanceof Date),ps=(n,e={})=>{if(!ms(n))return n;const{exclude:t,pascalCase:i=!1,stopPaths:r,deep:s=!1,preserveConsecutiveUppercase:o=!1}=e,l=new Set(r),f=h=>(u,p)=>{if(s&&ms(p)){const _=h===void 0?u:`${h}.${u}`;l.has(_)||(p=ls(p,f(_)))}if(!(t&&Ph(t,u))){const _=i?`${u}_`:u;if(ci.has(_))u=ci.get(_);else{const R=Oh(u,{pascalCase:i,locale:!1,preserveConsecutiveUppercase:o});u.length<100&&ci.set(_,R),u=R}}return[u,p]};return ls(n,f(void 0))};function Lh(n,e){return Array.isArray(n)?Object.keys(n).map(t=>ps(n[t],e)):ps(n,e)}const Fh="/twirp",sa="livekit";class oa{constructor(e,t,i){e.startsWith("ws")&&(e=e.replace("ws","http")),this.host=e,this.pkg=t,this.prefix=i||Fh}async request(e,t,i,r){const s=`${this.prefix}/${this.pkg}.${e}/${t}`,o=new URL(s,this.host),l=await fetch(o,{method:"POST",headers:Object.assign({"Content-Type":"application/json;charset=UTF-8"},r),body:JSON.stringify(i)});if(!l.ok)throw new Error(`Request failed with status ${l.status}: ${l.statusText}`);const f=await l.json();return Lh(f,{deep:!0})}}const Ie="Egress";class aa extends na{constructor(e,t,i){super(t,i),this.rpc=new oa(e,sa)}async startRoomCompositeEgress(e,t,i,r,s,o,l){let f;if(i!==void 0)if(typeof i=="string")f=i;else{const x=i;f=x.layout,r=x.encodingOptions,s=x.audioOnly,o=x.videoOnly,l=x.customBaseUrl}f??(f=""),s??(s=!1),o??(o=!1),l??(l="");const{output:h,options:u,fileOutputs:p,streamOutputs:_,segmentOutputs:R,imageOutputs:b}=this.getOutputParams(t,r),C=new zi({roomName:e,layout:f,audioOnly:s,videoOnly:o,customBaseUrl:l,output:h,options:u,fileOutputs:p,streamOutputs:_,segmentOutputs:R,imageOutputs:b}).toJson(),k=await this.rpc.request(Ie,"StartRoomCompositeEgress",C,await this.authHeader({roomRecord:!0}));return Ne.fromJson(k,{ignoreUnknownFields:!0})}async startWebEgress(e,t,i){const r=(i==null?void 0:i.audioOnly)||!1,s=(i==null?void 0:i.videoOnly)||!1,o=(i==null?void 0:i.awaitStartSignal)||!1,{output:l,options:f,fileOutputs:h,streamOutputs:u,segmentOutputs:p,imageOutputs:_}=this.getOutputParams(t,i==null?void 0:i.encodingOptions),R=new Uo({url:e,audioOnly:r,videoOnly:s,awaitStartSignal:o,output:l,options:f,fileOutputs:h,streamOutputs:u,segmentOutputs:p,imageOutputs:_}).toJson(),b=await this.rpc.request(Ie,"StartWebEgress",R,await this.authHeader({roomRecord:!0}));return Ne.fromJson(b,{ignoreUnknownFields:!0})}async startParticipantEgress(e,t,i,r){const{options:s,fileOutputs:o,streamOutputs:l,segmentOutputs:f,imageOutputs:h}=this.getOutputParams(i,r==null?void 0:r.encodingOptions),u=new Ko({roomName:e,identity:t,options:s,fileOutputs:o,streamOutputs:l,segmentOutputs:f,imageOutputs:h}).toJson(),p=await this.rpc.request(Ie,"StartParticipantEgress",u,await this.authHeader({roomRecord:!0}));return Ne.fromJson(p,{ignoreUnknownFields:!0})}async startTrackCompositeEgress(e,t,i,r,s){let o;if(i!==void 0)if(typeof i=="string")o=i;else{const C=i;o=C.audioTrackId,r=C.videoTrackId,s=C.encodingOptions}o??(o=""),r??(r="");const{output:l,options:f,fileOutputs:h,streamOutputs:u,segmentOutputs:p,imageOutputs:_}=this.getOutputParams(t,s),R=new Vo({roomName:e,audioTrackId:o,videoTrackId:r,output:l,options:f,fileOutputs:h,streamOutputs:u,segmentOutputs:p,imageOutputs:_}).toJson(),b=await this.rpc.request(Ie,"StartTrackCompositeEgress",R,await this.authHeader({roomRecord:!0}));return Ne.fromJson(b,{ignoreUnknownFields:!0})}isEncodedOutputs(e){return e.file!==void 0||e.stream!==void 0||e.segments!==void 0}isEncodedFileOutput(e){return e.filepath!==void 0||e.fileType!==void 0}isSegmentedFileOutput(e){return e.filenamePrefix!==void 0||e.playlistName!==void 0||e.filenameSuffix!==void 0}isStreamOutput(e){return e.protocol!==void 0||e.urls!==void 0}getOutputParams(e,t){let i,r,s,o,l,f,h;this.isEncodedOutputs(e)?(e.file!==void 0&&(r=[e.file]),e.stream!==void 0&&(o=[e.stream]),e.segments!==void 0&&(f=[e.segments]),e.images!==void 0&&(h=[e.images])):this.isEncodedFileOutput(e)?(i=e,r=[i]):this.isSegmentedFileOutput(e)?(l=e,f=[l]):this.isStreamOutput(e)&&(s=e,o=[s]);let u;i?u={case:"file",value:i}:s?u={case:"stream",value:s}:l&&(u={case:"segments",value:l});let p;return t&&(typeof t=="number"?p={case:"preset",value:t}:p={case:"advanced",value:t}),{output:u,options:p,fileOutputs:r,streamOutputs:o,segmentOutputs:f,imageOutputs:h}}async startTrackEgress(e,t,i){let r;typeof t=="string"?r={case:"websocketUrl",value:t}:r={case:"file",value:t};const s=new Ho({roomName:e,trackId:i,output:r}).toJson(),o=await this.rpc.request(Ie,"StartTrackEgress",s,await this.authHeader({roomRecord:!0}));return Ne.fromJson(o,{ignoreUnknownFields:!0})}async updateLayout(e,t){const i=await this.rpc.request(Ie,"UpdateLayout",new yd({egressId:e,layout:t}).toJson(),await this.authHeader({roomRecord:!0}));return Ne.fromJson(i,{ignoreUnknownFields:!0})}async updateStream(e,t,i){t??(t=[]),i??(i=[]);const r=await this.rpc.request(Ie,"UpdateStream",new Ed({egressId:e,addOutputUrls:t,removeOutputUrls:i}).toJson(),await this.authHeader({roomRecord:!0}));return Ne.fromJson(r,{ignoreUnknownFields:!0})}async listEgress(e){var t;let i={};typeof e=="string"?i.roomName=e:e!==void 0&&(i=e);const r=await this.rpc.request(Ie,"ListEgress",new Td(i).toJson(),await this.authHeader({roomRecord:!0}));return(t=wd.fromJson(r,{ignoreUnknownFields:!0}).items)!==null&&t!==void 0?t:[]}async stopEgress(e){const t=await this.rpc.request(Ie,"StopEgress",new Sd({egressId:e}).toJson(),await this.authHeader({roomRecord:!0}));return Ne.fromJson(t,{ignoreUnknownFields:!0})}}const _e="RoomService";class Mh extends na{constructor(e,t,i){super(t,i),this.rpc=new oa(e,sa)}async createRoom(e){const t=await this.rpc.request(_e,"CreateRoom",new Nd(e).toJson(),await this.authHeader({roomCreate:!0}));return Ii.fromJson(t,{ignoreUnknownFields:!0})}async listRooms(e){var t;const i=await this.rpc.request(_e,"ListRooms",new xd({names:e??[]}).toJson(),await this.authHeader({roomList:!0}));return(t=Pd.fromJson(i,{ignoreUnknownFields:!0}).rooms)!==null&&t!==void 0?t:[]}async deleteRoom(e){await this.rpc.request(_e,"DeleteRoom",new Ld({room:e}).toJson(),await this.authHeader({roomCreate:!0}))}async updateRoomMetadata(e,t){const i=await this.rpc.request(_e,"UpdateRoomMetadata",new Hd({room:e,metadata:t}).toJson(),await this.authHeader({roomAdmin:!0,room:e}));return Ii.fromJson(i,{ignoreUnknownFields:!0})}async listParticipants(e){var t;const i=await this.rpc.request(_e,"ListParticipants",new Fd({room:e}).toJson(),await this.authHeader({roomAdmin:!0,room:e}));return(t=Md.fromJson(i,{ignoreUnknownFields:!0}).participants)!==null&&t!==void 0?t:[]}async getParticipant(e,t){const i=await this.rpc.request(_e,"GetParticipant",new os({room:e,identity:t}).toJson(),await this.authHeader({roomAdmin:!0,room:e}));return Ai.fromJson(i,{ignoreUnknownFields:!0})}async removeParticipant(e,t){await this.rpc.request(_e,"RemoveParticipant",new os({room:e,identity:t}).toJson(),await this.authHeader({roomAdmin:!0,room:e}))}async mutePublishedTrack(e,t,i,r){const s=new Dd({room:e,identity:t,trackSid:i,muted:r}).toJson(),o=await this.rpc.request(_e,"MutePublishedTrack",s,await this.authHeader({roomAdmin:!0,room:e}));return Bd.fromJson(o,{ignoreUnknownFields:!0}).track}async updateParticipant(e,t,i,r,s){const o=typeof i=="object",l=o?i==null?void 0:i.metadata:i,f=o?i.permission:r,h=o?i.name:s,u=o?i.attributes:{},p=new Ud({room:e,identity:t,attributes:u,metadata:l,name:h});f&&(p.permission=new ji(f));const _=await this.rpc.request(_e,"UpdateParticipant",p.toJson(),await this.authHeader({roomAdmin:!0,room:e}));return Ai.fromJson(_,{ignoreUnknownFields:!0})}async updateSubscriptions(e,t,i,r){const s=new Kd({room:e,identity:t,trackSids:i,subscribe:r,participantTracks:[]}).toJson();await this.rpc.request(_e,"UpdateSubscriptions",s,await this.authHeader({roomAdmin:!0,room:e}))}async sendData(e,t,i,r={}){const s=Array.isArray(r)?r:r.destinationSids,o=Array.isArray(r)?void 0:r.topic,l=new Vd({room:e,data:t,kind:i,destinationSids:s??[],topic:o});!Array.isArray(r)&&r.destinationIdentities&&(l.destinationIdentities=r.destinationIdentities),await this.rpc.request(_e,"SendData",l.toJson(),await this.authHeader({roomAdmin:!0,room:e}))}}const Dh=16,Bh=12;function Uh(n){let e=new TextEncoder;return window.crypto.subtle.importKey("raw",e.encode(n),{name:"PBKDF2"},!1,["deriveBits","deriveKey"])}function Kh(n,e){return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:e,iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async function Vh(n,e){const t=window.crypto.getRandomValues(new Uint8Array(Dh)),i=window.crypto.getRandomValues(new Uint8Array(Bh));let r=Bs(n),s=await Uh(e),o=await Kh(s,t);const l=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},o,r);return{salt:ui(new Uint8Array(t)),iv:ui(new Uint8Array(i)),encryptedText:ui(new Uint8Array(l))}}const Ae=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];function ui(n){let e="",t,i=n.length;for(t=2;t<i;t+=3)e+=Ae[n[t-2]>>2],e+=Ae[(n[t-2]&3)<<4|n[t-1]>>4],e+=Ae[(n[t-1]&15)<<2|n[t]>>6],e+=Ae[n[t]&63];return t===i+1&&(e+=Ae[n[t-2]>>2],e+=Ae[(n[t-2]&3)<<4],e+="=="),t===i&&(e+=Ae[n[t-2]>>2],e+=Ae[(n[t-2]&3)<<4|n[t-1]>>4],e+=Ae[(n[t-1]&15)<<2],e+="="),e}const Oe=n=>{const e=console.error;Object.assign(console,{error:(...i)=>{(!i[0]||!i[0].toString||!i[0].toString().includes("You should not include your API secret in your web client bundle"))&&e.apply(console,i)}});const t=n();return Object.assign(console,{error:e}),t},Un=(n,e,t)=>Oe(()=>new ta(n,e,t));async function Hh(n,e,t){const i=Un(n,e,{identity:t,ttl:86400});return i.addGrant({room:t,roomJoin:!0,roomCreate:!0,roomAdmin:!0,roomList:!0,canPublish:!0,canSubscribe:!1,canPublishData:!0,canUpdateOwnMetadata:!0}),await i.toJwt()}async function $h(n,e){const{encryptedText:t,iv:i,salt:r}=await Vh(n,e);return{salt:r,iv:i,token:t}}async function qh(n,e,t,i){const r=Un(n,e,{identity:i,name:i,ttl:21600});return r.addGrant({room:t,roomList:!0,roomJoin:!0,canPublish:!1,canSubscribe:!0,canPublishData:!0,canUpdateOwnMetadata:!1}),await r.toJwt()}async function Wh(n,e){const t=Un(n,e,{identity:"lt",ttl:94608e5});return t.addGrant({roomList:!0,roomJoin:!1,canPublish:!1,canSubscribe:!1,canPublishData:!1,canUpdateOwnMetadata:!1}),await t.toJwt()}async function Gh(n,e){const t=Un(n,e,{identity:"lt",ttl:600});return t.addGrant({hidden:!1,room:"connection-test-room",roomList:!0,roomJoin:!0,roomRecord:!1,roomCreate:!1,roomAdmin:!1,canPublish:!1,canSubscribe:!1,canPublishData:!1,canUpdateOwnMetadata:!1}),await t.toJwt()}class Jh{constructor(){I(this,"_twitchStreamKey");I(this,"_egressClient");I(this,"roomName");I(this,"streamEgressID")}init(e,t,i,r){this.roomName=t,this._twitchStreamKey=e,this._egressClient=new aa("https://rov-web.livekit.cloud",i,r)}async listRunningEgress(){if(!this._egressClient)throw new Error("Egress client not initialized!");return await this._egressClient.listEgress({active:!0})}isAnotherEgressRunning(e){return e.filter(t=>!this.streamEgressID||t.egressId!=this.streamEgressID).length>0}getCurrentEgress(e){return e.find(t=>t.roomName==this.roomName)}async closeOtherEgresses(e){return this._egressClient?Promise.allSettled(e.filter(t=>!this.streamEgressID||t.egressId!==this.streamEgressID).map(async t=>!this._egressClient||!t.egressId?!1:(ue("Closing egress: ",t),await this._egressClient.stopEgress(t.egressId)))):!1}async startStream(){if(!this._twitchStreamKey||!this._egressClient||!this.roomName)return F("startStream() err: Twitch stream key not set or twitchStream class not initilized!");let e=await Oe(()=>this.listRunningEgress()),t=this.getCurrentEgress(e);if(t!==void 0){ue("Found current twitch egress: ",t),this.streamEgressID=t.egressId;return}else{for(;await this.isAnotherEgressRunning(e)==!0;){const s=await this.closeOtherEgresses(e);if(D("egressCloseStates",s),ue("Another twitch stream is running, waiting 2 seconds to try again..."),await It(2e3),e=await this.listRunningEgress(),t=this.getCurrentEgress(e),t!==void 0){ue("Found current twitch egress: ",t),this.streamEgressID=t.egressId;return}}const i=new We({protocol:Bo.RTMP,urls:["rtmp://live.twitch.tv/app/"+this._twitchStreamKey]});let r=await Oe(()=>{var s;return(s=this._egressClient)==null?void 0:s.startRoomCompositeEgress(this.roomName,i)});this.streamEgressID=r==null?void 0:r.egressId,D("Twitch stream started: ",r)}}async stopStream(){if(!this._egressClient)return F("stopStream() err: Twitch Stream not started!");const e=this.streamEgressID;if(this.streamEgressID=void 0,e){const r=await Oe(()=>{var s;return(s=this==null?void 0:this._egressClient)==null?void 0:s.stopEgress(e)});D("Twitch stream stopped: ",r)}const t=await Oe(()=>this.listRunningEgress()),i=this.getCurrentEgress(t);if(i){D("Egress still running: ",i);const r=await Oe(()=>{var s;return(s=this==null?void 0:this._egressClient)==null?void 0:s.stopEgress(i.egressId)});D("Twitch stream stopped: ",r)}this.streamEgressID=void 0}}const Nn=new Jh;let li=null,xi=!1,ca=!1,Ft=0,di=1;function hi(n,e=!0){xi=n,ne.sendMessage(ce.create({body:{oneofKind:"arming",arming:{armed:n}}}),!0,[]),xi?be.sendMessage(_c()):be.sendMessage(yc())}function jh(n,e){var r,s,o,l,f,h,u,p,_,R,b;const t=e.body;switch(t.oneofKind){case"ping":return ne.sendMessage(ce.create({body:{oneofKind:"pong",pong:{time:t.ping.time}}}),!1,[n]),be.sendMessage(wc()),!0;case"simplePeerSignal":const C=t.simplePeerSignal.message;return ne.ingestSimplePeerSignalMsg(n,C),!0;case"move":if(li&&li!==n)return!1;let k=t.move.buttonBitmask||0;if(xi){ca||hi(!0);let J=(t.move.velocityX||0)*1e3,je=(t.move.velocityY||0)*1e3,oe=(t.move.velocityZ||0)*500+500,ct=(t.move.angularVelocityYaw||0)*500;return be.sendMessage(Ar(J,je,oe,ct,k)),!0}else return be.sendMessage(Ar(0,0,500,0,k)),!1;case"shutdownRov":return $r("poweroff").then(J=>{ne.sendMessage(ce.create({exchangeId:e.exchangeId,body:{oneofKind:"done",done:{message:J}}}),!1,[])}).catch(J=>{ne.sendMessage(ce.create({exchangeId:e.exchangeId,body:{oneofKind:"error",error:{message:J.message}}}),!1,[])}),!0;case"rebootRov":return $r("reboot").then(J=>{ne.sendMessage(ce.create({exchangeId:e.exchangeId,body:{oneofKind:"done",done:{message:J}}}),!1,[])}).catch(J=>{ne.sendMessage(ce.create({exchangeId:e.exchangeId,body:{oneofKind:"error",error:{message:J.message}}}),!1,[])}),!0;case"moveClaw":const x=.25;return D("Setting servo ",Ft," of group ",di," to ",x),be.sendMessage(Sc(Ft,x,di)),Ft==7?(Ft=0,di++):Ft++,!0;case"setAutopilotMode":return be.sendMessage(Tc(t.setAutopilotMode.mode)),!0;case"disarm":return hi(!1),!0;case"takeControl":return li=n,ne.sendMessage(ce.create({body:{oneofKind:"pilotChanged",pilotChanged:{pilotIdentity:n}}}),!1,[]),hi(!0),!0;case"sendRovLogs":return vn.sendQueuedLogs((J,je)=>ne.sendMessage(ce.create({body:{oneofKind:"logMessage",logMessage:{level:J??rc.Debug,message:je}}}),!0,[])),!0;case"setLivestreamingEnabled":return t.setLivestreamingEnabled.enabled?Nn.startStream():Nn.stopStream(),!0;case"setLivekitVideoOptions":const N=Mt.videoCaptureDefaults,A=Mt.publishDefaults,O=t.setLivekitVideoOptions,v=O.baseStream;if(!O.enabled)return ne.setLivekitVideoOptions(!1),!0;D("Got Livekit Video Options: ",O);const q=16/9,se={...N,resolution:{width:(v==null?void 0:v.width)||Math.floor(((v==null?void 0:v.height)||0)*q)||((r=N==null?void 0:N.resolution)==null?void 0:r.width)||1920,height:(v==null?void 0:v.height)||Math.floor(((v==null?void 0:v.width)||0)/q)||((s=N==null?void 0:N.resolution)==null?void 0:s.height)||1080,frameRate:(v==null?void 0:v.fps)||((o=N==null?void 0:N.resolution)==null?void 0:o.frameRate)},facingMode:N==null?void 0:N.facingMode},X=O.simulcastLayers?O.simulcastLayers.map((J,je)=>{var ct,cn,Q,re;const oe=A!=null&&A.videoSimulcastLayers?A==null?void 0:A.videoSimulcastLayers[je]:void 0;return{encoding:{maxBitrate:J.maxBitrate??(v==null?void 0:v.maxBitrate)??((ct=oe==null?void 0:oe.encoding)==null?void 0:ct.maxBitrate)??99e9,maxFramerate:J.fps||((cn=oe==null?void 0:oe.encoding)==null?void 0:cn.maxFramerate),priority:"high"},width:J.width||(J.height?Math.floor(J.height*q):null)||(oe==null?void 0:oe.width)||((Q=N==null?void 0:N.resolution)==null?void 0:Q.width),height:J.height||(J.width?Math.floor(J.width/q):null)||(oe==null?void 0:oe.height)||((re=N==null?void 0:N.resolution)==null?void 0:re.height)}}):A==null?void 0:A.videoSimulcastLayers,Re=O.codec!==null&&O.codec!==void 0?O.codec:A==null?void 0:A.videoCodec,on={...A,videoCodec:Re,videoEncoding:{maxBitrate:(v==null?void 0:v.maxBitrate)??((l=A==null?void 0:A.videoEncoding)==null?void 0:l.maxBitrate)??99e9,maxFramerate:(v==null?void 0:v.fps)||((f=A==null?void 0:A.videoEncoding)==null?void 0:f.maxFramerate),priority:(h=A==null?void 0:A.videoEncoding)==null?void 0:h.priority},backupCodec:O.allowBackupCodec??(A==null?void 0:A.backupCodec),simulcast:O.simulcastLayers?O.simulcastLayers.length>0:A==null?void 0:A.simulcast,videoSimulcastLayers:X};return ne.setLivekitVideoOptions(!0,se,on),!0;case"setSimplePeerVideoOptions":const ae=Mt.videoCaptureDefaults,ge=Mt.publishDefaults,Je=t.setSimplePeerVideoOptions,ie=Je.baseStream;if(D("Got SimplePeer Video Options: ",Je),!Je.enabled)return ne.setSimplePeerVideoOptions(!1,n),!0;const Wn=16/9,Gn={...ae,resolution:{width:Math.floor(((ie==null?void 0:ie.height)||((u=ae==null?void 0:ae.resolution)==null?void 0:u.height)||0)*Wn),height:(ie==null?void 0:ie.height)||((p=ae==null?void 0:ae.resolution)==null?void 0:p.height)||0,frameRate:(ie==null?void 0:ie.fps)||((_=ae==null?void 0:ae.resolution)==null?void 0:_.frameRate)||60},facingMode:ae==null?void 0:ae.facingMode},an={videoCodec:Je.codec?Je.codec:ge==null?void 0:ge.videoCodec,videoEncoding:{maxBitrate:(ie==null?void 0:ie.maxBitrate)||((R=ge==null?void 0:ge.videoEncoding)==null?void 0:R.maxBitrate)||0,maxFramerate:(ie==null?void 0:ie.fps)||((b=ge==null?void 0:ge.videoEncoding)==null?void 0:b.maxFramerate)}};return ne.setSimplePeerVideoOptions(!0,n,Gn,an),!0;default:return F("Unknown Message Recived: ",yi.toJson(e)),!1}}function gs(n,e){let t=new Uint8Array(e);if(!t||t.length===0)return;const i=yi.fromBinary(t);if(jh(n,i))return;i.backendMetadata=i.backendMetadata||ic.create(),i.backendMetadata.fromUserId=n;const r=yi.toBinary(i);Sn.isConnected&&Sn.sendMessage(r)}function zh(n){if(!n||!n.message)return;const e=n.message;e.type&&e.type==="HEARTBEAT"&&(ca=!!(e.base_mode.bits&_i.MAV_MODE_FLAG_SAFETY_ARMED))}let Tt=[];function xe(n){let e=[],t=(o,l=!0)=>(e.includes(o)||e.push(o),l&&o(n),()=>{e=e.filter(f=>f!=o)});function i(o){if(o===n&&(n===null||typeof n!="object"))return;let l=n;n=o;for(let f of e)f(n,l)}function r(){let o=Tt[Tt.length-1];return o&&t(o[0],!1),n}if(typeof n=="function")return Yh(n);function s(){for(let o of e)o(n,n)}return{subscribe:t,set:i,get:r,refresh:s,update:o=>{typeof o=="function"&&i(o(n))}}}function Yh(n){let e=xe(null),t=[i];return i(),e;function i(){if(Tt.includes(t))throw Error("Circular computation");Tt.push(t);let r;try{r=n()}catch(s){throw Tt.pop(),s}Tt.pop(),e.set(r)}}function ua(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Pi={exports:{}},fi,_s;function Xh(){if(_s)return fi;_s=1;var n=1e3,e=n*60,t=e*60,i=t*24,r=i*7,s=i*365.25;fi=function(u,p){p=p||{};var _=typeof u;if(_==="string"&&u.length>0)return o(u);if(_==="number"&&isFinite(u))return p.long?f(u):l(u);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(u))};function o(u){if(u=String(u),!(u.length>100)){var p=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(p){var _=parseFloat(p[1]),R=(p[2]||"ms").toLowerCase();switch(R){case"years":case"year":case"yrs":case"yr":case"y":return _*s;case"weeks":case"week":case"w":return _*r;case"days":case"day":case"d":return _*i;case"hours":case"hour":case"hrs":case"hr":case"h":return _*t;case"minutes":case"minute":case"mins":case"min":case"m":return _*e;case"seconds":case"second":case"secs":case"sec":case"s":return _*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return _;default:return}}}}function l(u){var p=Math.abs(u);return p>=i?Math.round(u/i)+"d":p>=t?Math.round(u/t)+"h":p>=e?Math.round(u/e)+"m":p>=n?Math.round(u/n)+"s":u+"ms"}function f(u){var p=Math.abs(u);return p>=i?h(u,p,i,"day"):p>=t?h(u,p,t,"hour"):p>=e?h(u,p,e,"minute"):p>=n?h(u,p,n,"second"):u+" ms"}function h(u,p,_,R){var b=p>=_*1.5;return Math.round(u/_)+" "+R+(b?"s":"")}return fi}function Qh(n){t.debug=t,t.default=t,t.coerce=f,t.disable=s,t.enable=r,t.enabled=o,t.humanize=Xh(),t.destroy=h,Object.keys(n).forEach(u=>{t[u]=n[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let p=0;for(let _=0;_<u.length;_++)p=(p<<5)-p+u.charCodeAt(_),p|=0;return t.colors[Math.abs(p)%t.colors.length]}t.selectColor=e;function t(u){let p,_=null,R,b;function C(...k){if(!C.enabled)return;const x=C,N=Number(new Date),A=N-(p||N);x.diff=A,x.prev=p,x.curr=N,p=N,k[0]=t.coerce(k[0]),typeof k[0]!="string"&&k.unshift("%O");let O=0;k[0]=k[0].replace(/%([a-zA-Z%])/g,(q,se)=>{if(q==="%%")return"%";O++;const X=t.formatters[se];if(typeof X=="function"){const Re=k[O];q=X.call(x,Re),k.splice(O,1),O--}return q}),t.formatArgs.call(x,k),(x.log||t.log).apply(x,k)}return C.namespace=u,C.useColors=t.useColors(),C.color=t.selectColor(u),C.extend=i,C.destroy=t.destroy,Object.defineProperty(C,"enabled",{enumerable:!0,configurable:!1,get:()=>_!==null?_:(R!==t.namespaces&&(R=t.namespaces,b=t.enabled(u)),b),set:k=>{_=k}}),typeof t.init=="function"&&t.init(C),C}function i(u,p){const _=t(this.namespace+(typeof p>"u"?":":p)+u);return _.log=this.log,_}function r(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];let p;const _=(typeof u=="string"?u:"").split(/[\s,]+/),R=_.length;for(p=0;p<R;p++)_[p]&&(u=_[p].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.slice(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function s(){const u=[...t.names.map(l),...t.skips.map(l).map(p=>"-"+p)].join(",");return t.enable(""),u}function o(u){if(u[u.length-1]==="*")return!0;let p,_;for(p=0,_=t.skips.length;p<_;p++)if(t.skips[p].test(u))return!1;for(p=0,_=t.names.length;p<_;p++)if(t.names[p].test(u))return!0;return!1}function l(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function f(u){return u instanceof Error?u.stack||u.message:u}function h(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var Zh=Qh;(function(n,e){var t={};e.formatArgs=r,e.save=s,e.load=o,e.useColors=i,e.storage=l(),e.destroy=(()=>{let h=!1;return()=>{h||(h=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function i(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let h;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(h=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(h[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(h){if(h[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+h[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;h.splice(1,0,u,"color: inherit");let p=0,_=0;h[0].replace(/%[a-zA-Z%]/g,R=>{R!=="%%"&&(p++,R==="%c"&&(_=p))}),h.splice(_,0,u)}e.log=console.debug||console.log||(()=>{});function s(h){try{h?e.storage.setItem("debug",h):e.storage.removeItem("debug")}catch{}}function o(){let h;try{h=e.storage.getItem("debug")}catch{}return!h&&typeof Ut<"u"&&"env"in Ut&&(h=t.DEBUG),h}function l(){try{return localStorage}catch{}}n.exports=Zh(e);const{formatters:f}=n.exports;f.j=function(h){try{return JSON.stringify(h)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(Pi,Pi.exports);var ef=Pi.exports;const tf=ua(ef),Pe=typeof window<"u"?window:self,Li=Pe.RTCPeerConnection||Pe.mozRTCPeerConnection||Pe.webkitRTCPeerConnection,nf=Pe.RTCSessionDescription||Pe.mozRTCSessionDescription||Pe.webkitRTCSessionDescription,rf=Pe.RTCIceCandidate||Pe.mozRTCIceCandidate||Pe.webkitRTCIceCandidate;var tr={exports:{}},wt=typeof Reflect=="object"?Reflect:null,ys=wt&&typeof wt.apply=="function"?wt.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)},wn;wt&&typeof wt.ownKeys=="function"?wn=wt.ownKeys:Object.getOwnPropertySymbols?wn=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:wn=function(e){return Object.getOwnPropertyNames(e)};function sf(n){console&&console.warn&&console.warn(n)}var la=Number.isNaN||function(e){return e!==e};function U(){U.init.call(this)}tr.exports=U;tr.exports.once=uf;U.EventEmitter=U;U.prototype._events=void 0;U.prototype._eventsCount=0;U.prototype._maxListeners=void 0;var Es=10;function Kn(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(U,"defaultMaxListeners",{enumerable:!0,get:function(){return Es},set:function(n){if(typeof n!="number"||n<0||la(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");Es=n}});U.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};U.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||la(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function da(n){return n._maxListeners===void 0?U.defaultMaxListeners:n._maxListeners}U.prototype.getMaxListeners=function(){return da(this)};U.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r=e==="error",s=this._events;if(s!==void 0)r=r&&s.error===void 0;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var l=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw l.context=o,l}var f=s[e];if(f===void 0)return!1;if(typeof f=="function")ys(f,this,t);else for(var h=f.length,u=ga(f,h),i=0;i<h;++i)ys(u[i],this,t);return!0};function ha(n,e,t,i){var r,s,o;if(Kn(t),s=n._events,s===void 0?(s=n._events=Object.create(null),n._eventsCount=0):(s.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),s=n._events),o=s[e]),o===void 0)o=s[e]=t,++n._eventsCount;else if(typeof o=="function"?o=s[e]=i?[t,o]:[o,t]:i?o.unshift(t):o.push(t),r=da(n),r>0&&o.length>r&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=n,l.type=e,l.count=o.length,sf(l)}return n}U.prototype.addListener=function(e,t){return ha(this,e,t,!1)};U.prototype.on=U.prototype.addListener;U.prototype.prependListener=function(e,t){return ha(this,e,t,!0)};function of(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function fa(n,e,t){var i={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},r=of.bind(i);return r.listener=t,i.wrapFn=r,r}U.prototype.once=function(e,t){return Kn(t),this.on(e,fa(this,e,t)),this};U.prototype.prependOnceListener=function(e,t){return Kn(t),this.prependListener(e,fa(this,e,t)),this};U.prototype.removeListener=function(e,t){var i,r,s,o,l;if(Kn(t),r=this._events,r===void 0)return this;if(i=r[e],i===void 0)return this;if(i===t||i.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if(typeof i!="function"){for(s=-1,o=i.length-1;o>=0;o--)if(i[o]===t||i[o].listener===t){l=i[o].listener,s=o;break}if(s<0)return this;s===0?i.shift():af(i,s),i.length===1&&(r[e]=i[0]),r.removeListener!==void 0&&this.emit("removeListener",e,l||t)}return this};U.prototype.off=U.prototype.removeListener;U.prototype.removeAllListeners=function(e){var t,i,r;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var s=Object.keys(i),o;for(r=0;r<s.length;++r)o=s[r],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=i[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this};function ma(n,e,t){var i=n._events;if(i===void 0)return[];var r=i[e];return r===void 0?[]:typeof r=="function"?t?[r.listener||r]:[r]:t?cf(r):ga(r,r.length)}U.prototype.listeners=function(e){return ma(this,e,!0)};U.prototype.rawListeners=function(e){return ma(this,e,!1)};U.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):pa.call(n,e)};U.prototype.listenerCount=pa;function pa(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}U.prototype.eventNames=function(){return this._eventsCount>0?wn(this._events):[]};function ga(n,e){for(var t=new Array(e),i=0;i<e;++i)t[i]=n[i];return t}function af(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function cf(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function uf(n,e){return new Promise(function(t,i){function r(o){n.removeListener(e,s),i(o)}function s(){typeof n.removeListener=="function"&&n.removeListener("error",r),t([].slice.call(arguments))}_a(n,e,s,{once:!0}),e!=="error"&&lf(n,r,{once:!0})})}function lf(n,e,t){typeof n.on=="function"&&_a(n,"error",e,t)}function _a(n,e,t,i){if(typeof n.on=="function")i.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function r(s){i.once&&n.removeEventListener(e,r),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var df=tr.exports,hf=typeof queueMicrotask=="function"?queueMicrotask:n=>Promise.resolve().then(n),ff=class{constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return this.buffer[this.btm]===void 0}};const Ts=ff;var mf=class{constructor(e){this.hwm=e||16,this.head=new Ts(this.hwm),this.tail=this.head,this.length=0}clear(){this.head=this.tail,this.head.clear(),this.length=0}push(e){if(this.length++,!this.head.push(e)){const t=this.head;this.head=t.next=new Ts(2*this.head.buffer.length),this.head.push(e)}}shift(){this.length!==0&&this.length--;const e=this.tail.shift();if(e===void 0&&this.tail.next){const t=this.tail.next;return this.tail.next=null,this.tail=t,this.tail.shift()}return e}peek(){const e=this.tail.peek();return e===void 0&&this.tail.next?this.tail.next.peek():e}isEmpty(){return this.length===0}},ya=class{constructor(e){this.decoder=new TextDecoder(e==="utf16le"?"utf16-le":e)}decode(e){return this.decoder.decode(e,{stream:!0})}flush(){return this.decoder.decode(new Uint8Array(0))}};const pf=ya,gf=ya;var _f=class{constructor(e="utf8"){switch(this.encoding=yf(e),this.encoding){case"utf8":this.decoder=new gf;break;case"utf16le":case"base64":throw new Error("Unsupported encoding: "+this.encoding);default:this.decoder=new pf(this.encoding)}}push(e){return typeof e=="string"?e:this.decoder.decode(e)}write(e){return this.push(e)}end(e){let t="";return e&&(t=this.push(e)),t+=this.decoder.flush(),t}};function yf(n){switch(n=n.toLowerCase(),n){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return n;default:throw new Error("Unknown encoding: "+n)}}const{EventEmitter:Ef}=df,Vn=new Error("Stream was destroyed"),mi=new Error("Premature close"),Ea=hf,Ta=mf,Tf=_f,G=(1<<29)-1,ot=1,nr=2,tt=4,Vt=8,wa=G^ot,wf=G^nr,tn=16,Ht=32,vt=64,Ve=128,nn=256,ir=512,nt=1024,Fi=2048,rr=4096,sr=8192,ye=16384,St=32768,Hn=65536,it=131072,Sa=nn|ir,Sf=tn|Hn,bf=vt|tn,kf=rr|Ve,or=nn|it,Rf=G^tn,Cf=G^vt,If=G^(vt|Hn),ws=G^Hn,Af=G^nn,Nf=G^(Ve|sr),vf=G^nt,Ss=G^Sa,ba=G^St,Of=G^Ht,ka=G^it,xf=G^or,Ge=1<<18,Rt=2<<18,rn=4<<18,rt=8<<18,sn=16<<18,at=32<<18,Mi=64<<18,bt=128<<18,ar=256<<18,Ct=512<<18,$n=1024<<18,Ra=G^(Ge|ar),Ca=G^rn,Pf=G^Ct,Lf=G^sn,Ff=G^rt,Ia=G^bt,Mf=G^Rt,Aa=G^$n,$t=tn|Ge,Na=G^$t,cr=ye|at,Le=tt|Vt|nr,me=Le|ot,va=Le|cr,Df=Ca&Cf,ur=bt|St,Bf=ur&Na,Oa=me|Bf,Uf=me|nt|ye,bs=me|ye|Ve,Kf=me|nt|Ve,Vf=me|rr|Ve|sr,Hf=me|tn|nt|ye|Hn|it,$f=Le|nt|ye,qf=Ht|me|St|vt,Wf=me|Ct|at,Gf=rt|sn,xa=rt|Ge,Jf=rt|sn|me|Ge,ks=me|Ge|rt|$n,jf=rn|Ge,zf=Ge|ar,Yf=me|Ct|xa|at,Xf=sn|Le|Ct|at,Qf=Rt|me|bt|rn,hn=Symbol.asyncIterator||Symbol("asyncIterator");class Pa{constructor(e,{highWaterMark:t=16384,map:i=null,mapWritable:r,byteLength:s,byteLengthWritable:o}={}){this.stream=e,this.queue=new Ta,this.highWaterMark=t,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=o||s||Ka,this.map=r||i,this.afterWrite=rm.bind(this),this.afterUpdateNextTick=am.bind(this)}get ended(){return(this.stream._duplexState&at)!==0}push(e){return this.map!==null&&(e=this.map(e)),this.buffered+=this.byteLength(e),this.queue.push(e),this.buffered<this.highWaterMark?(this.stream._duplexState|=rt,!0):(this.stream._duplexState|=Gf,!1)}shift(){const e=this.queue.shift();return this.buffered-=this.byteLength(e),this.buffered===0&&(this.stream._duplexState&=Ff),e}end(e){typeof e=="function"?this.stream.once("finish",e):e!=null&&this.push(e),this.stream._duplexState=(this.stream._duplexState|Ct)&Ca}autoBatch(e,t){const i=[],r=this.stream;for(i.push(e);(r._duplexState&ks)===xa;)i.push(r._writableState.shift());if(r._duplexState&me)return t(null);r._writev(i,t)}update(){const e=this.stream;e._duplexState|=Rt;do{for(;(e._duplexState&ks)===rt;){const t=this.shift();e._duplexState|=zf,e._write(t,this.afterWrite)}e._duplexState&jf||this.updateNonPrimary()}while(this.continueUpdate()===!0);e._duplexState&=Mf}updateNonPrimary(){const e=this.stream;if((e._duplexState&Yf)===Ct){e._duplexState=(e._duplexState|Ge)&Pf,e._final(im.bind(this));return}if((e._duplexState&Le)===tt){e._duplexState&ur||(e._duplexState|=$t,e._destroy(La.bind(this)));return}(e._duplexState&Oa)===ot&&(e._duplexState=(e._duplexState|$t)&wa,e._open(Fa.bind(this)))}continueUpdate(){return this.stream._duplexState&bt?(this.stream._duplexState&=Ia,!0):!1}updateCallback(){(this.stream._duplexState&Qf)===rn?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&bt||(this.stream._duplexState|=bt,this.stream._duplexState&Rt||Ea(this.afterUpdateNextTick))}}class Zf{constructor(e,{highWaterMark:t=16384,map:i=null,mapReadable:r,byteLength:s,byteLengthReadable:o}={}){this.stream=e,this.queue=new Ta,this.highWaterMark=t===0?1:t,this.buffered=0,this.readAhead=t>0,this.error=null,this.pipeline=null,this.byteLength=o||s||Ka,this.map=r||i,this.pipeTo=null,this.afterRead=sm.bind(this),this.afterUpdateNextTick=om.bind(this)}get ended(){return(this.stream._duplexState&ye)!==0}pipe(e,t){if(this.pipeTo!==null)throw new Error("Can only pipe to one destination");if(typeof t!="function"&&(t=null),this.stream._duplexState|=ir,this.pipeTo=e,this.pipeline=new tm(this.stream,e,t),t&&this.stream.on("error",Rs),Wt(e))e._writableState.pipeline=this.pipeline,t&&e.on("error",Rs),e.on("finish",this.pipeline.finished.bind(this.pipeline));else{const i=this.pipeline.done.bind(this.pipeline,e),r=this.pipeline.done.bind(this.pipeline,e,null);e.on("error",i),e.on("close",r),e.on("finish",this.pipeline.finished.bind(this.pipeline))}e.on("drain",nm.bind(this)),this.stream.emit("piping",e),e.emit("pipe",this.stream)}push(e){const t=this.stream;return e===null?(this.highWaterMark=0,t._duplexState=(t._duplexState|nt)&If,!1):this.map!==null&&(e=this.map(e),e===null)?(t._duplexState&=ws,this.buffered<this.highWaterMark):(this.buffered+=this.byteLength(e),this.queue.push(e),t._duplexState=(t._duplexState|Ve)&ws,this.buffered<this.highWaterMark)}shift(){const e=this.queue.shift();return this.buffered-=this.byteLength(e),this.buffered===0&&(this.stream._duplexState&=Nf),e}unshift(e){const t=[this.map!==null?this.map(e):e];for(;this.buffered>0;)t.push(this.shift());for(let i=0;i<t.length-1;i++){const r=t[i];this.buffered+=this.byteLength(r),this.queue.push(r)}this.push(t[t.length-1])}read(){const e=this.stream;if((e._duplexState&bs)===Ve){const t=this.shift();return this.pipeTo!==null&&this.pipeTo.write(t)===!1&&(e._duplexState&=Ss),e._duplexState&Fi&&e.emit("data",t),t}return this.readAhead===!1&&(e._duplexState|=it,this.updateNextTick()),null}drain(){const e=this.stream;for(;(e._duplexState&bs)===Ve&&e._duplexState&Sa;){const t=this.shift();this.pipeTo!==null&&this.pipeTo.write(t)===!1&&(e._duplexState&=Ss),e._duplexState&Fi&&e.emit("data",t)}}update(){const e=this.stream;e._duplexState|=Ht;do{for(this.drain();this.buffered<this.highWaterMark&&(e._duplexState&Hf)===it;)e._duplexState|=Sf,e._read(this.afterRead),this.drain();(e._duplexState&Vf)===kf&&(e._duplexState|=sr,e.emit("readable")),e._duplexState&bf||this.updateNonPrimary()}while(this.continueUpdate()===!0);e._duplexState&=Of}updateNonPrimary(){const e=this.stream;if((e._duplexState&Kf)===nt&&(e._duplexState=(e._duplexState|ye)&vf,e.emit("end"),(e._duplexState&va)===cr&&(e._duplexState|=tt),this.pipeTo!==null&&this.pipeTo.end()),(e._duplexState&Le)===tt){e._duplexState&ur||(e._duplexState|=$t,e._destroy(La.bind(this)));return}(e._duplexState&Oa)===ot&&(e._duplexState=(e._duplexState|$t)&wa,e._open(Fa.bind(this)))}continueUpdate(){return this.stream._duplexState&St?(this.stream._duplexState&=ba,!0):!1}updateCallback(){(this.stream._duplexState&qf)===vt?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&St||(this.stream._duplexState|=St,this.stream._duplexState&Ht||Ea(this.afterUpdateNextTick))}}class em{constructor(e){this.data=null,this.afterTransform=um.bind(e),this.afterFinal=null}}class tm{constructor(e,t,i){this.from=e,this.to=t,this.afterPipe=i,this.error=null,this.pipeToFinished=!1}finished(){this.pipeToFinished=!0}done(e,t){if(t&&(this.error=t),e===this.to&&(this.to=null,this.from!==null)){(!(this.from._duplexState&ye)||!this.pipeToFinished)&&this.from.destroy(this.error||new Error("Writable stream closed prematurely"));return}if(e===this.from&&(this.from=null,this.to!==null)){e._duplexState&ye||this.to.destroy(this.error||new Error("Readable stream closed before ending"));return}this.afterPipe!==null&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null}}function nm(){this.stream._duplexState|=ir,this.updateCallback()}function im(n){const e=this.stream;n&&e.destroy(n),e._duplexState&Le||(e._duplexState|=at,e.emit("finish")),(e._duplexState&va)===cr&&(e._duplexState|=tt),e._duplexState&=Ra,e._duplexState&Rt?this.updateNextTick():this.update()}function La(n){const e=this.stream;!n&&this.error!==Vn&&(n=this.error),n&&e.emit("error",n),e._duplexState|=Vt,e.emit("close");const t=e._readableState,i=e._writableState;if(t!==null&&t.pipeline!==null&&t.pipeline.done(e,n),i!==null){for(;i.drains!==null&&i.drains.length>0;)i.drains.shift().resolve(!1);i.pipeline!==null&&i.pipeline.done(e,n)}}function rm(n){const e=this.stream;n&&e.destroy(n),e._duplexState&=Ra,this.drains!==null&&cm(this.drains),(e._duplexState&Jf)===sn&&(e._duplexState&=Lf,(e._duplexState&Mi)===Mi&&e.emit("drain")),this.updateCallback()}function sm(n){n&&this.stream.destroy(n),this.stream._duplexState&=Rf,this.readAhead===!1&&!(this.stream._duplexState&nn)&&(this.stream._duplexState&=ka),this.updateCallback()}function om(){this.stream._duplexState&Ht||(this.stream._duplexState&=ba,this.update())}function am(){this.stream._duplexState&Rt||(this.stream._duplexState&=Ia,this.update())}function cm(n){for(let e=0;e<n.length;e++)--n[e].writes===0&&(n.shift().resolve(!0),e--)}function Fa(n){const e=this.stream;n&&e.destroy(n),e._duplexState&tt||(e._duplexState&Uf||(e._duplexState|=vt),e._duplexState&Wf||(e._duplexState|=rn),e.emit("open")),e._duplexState&=Na,e._writableState!==null&&e._writableState.updateCallback(),e._readableState!==null&&e._readableState.updateCallback()}function um(n,e){e!=null&&this.push(e),this._writableState.afterWrite(n)}function lm(n){this._readableState!==null&&(n==="data"&&(this._duplexState|=Fi|or,this._readableState.updateNextTick()),n==="readable"&&(this._duplexState|=rr,this._readableState.updateNextTick())),this._writableState!==null&&n==="drain"&&(this._duplexState|=Mi,this._writableState.updateNextTick())}class lr extends Ef{constructor(e){super(),this._duplexState=0,this._readableState=null,this._writableState=null,e&&(e.open&&(this._open=e.open),e.destroy&&(this._destroy=e.destroy),e.predestroy&&(this._predestroy=e.predestroy),e.signal&&e.signal.addEventListener("abort",Tm.bind(this))),this.on("newListener",lm)}_open(e){e(null)}_destroy(e){e(null)}_predestroy(){}get readable(){return this._readableState!==null?!0:void 0}get writable(){return this._writableState!==null?!0:void 0}get destroyed(){return(this._duplexState&Vt)!==0}get destroying(){return(this._duplexState&Le)!==0}destroy(e){this._duplexState&Le||(e||(e=Vn),this._duplexState=(this._duplexState|tt)&Df,this._readableState!==null&&(this._readableState.highWaterMark=0,this._readableState.error=e),this._writableState!==null&&(this._writableState.highWaterMark=0,this._writableState.error=e),this._duplexState|=nr,this._predestroy(),this._duplexState&=wf,this._readableState!==null&&this._readableState.updateNextTick(),this._writableState!==null&&this._writableState.updateNextTick())}}class qt extends lr{constructor(e){super(e),this._duplexState|=ot|at|it,this._readableState=new Zf(this,e),e&&(this._readableState.readAhead===!1&&(this._duplexState&=ka),e.read&&(this._read=e.read),e.eagerOpen&&this._readableState.updateNextTick(),e.encoding&&this.setEncoding(e.encoding))}setEncoding(e){const t=new Tf(e),i=this._readableState.map||mm;return this._readableState.map=r,this;function r(s){const o=t.push(s);return o===""?null:i(o)}}_read(e){e(null)}pipe(e,t){return this._readableState.updateNextTick(),this._readableState.pipe(e,t),e}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(e){return this._readableState.updateNextTick(),this._readableState.push(e)}unshift(e){return this._readableState.updateNextTick(),this._readableState.unshift(e)}resume(){return this._duplexState|=or,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=this._readableState.readAhead===!1?xf:Af,this}static _fromAsyncIterator(e,t){let i;const r=new qt({...t,read(o){e.next().then(s).then(o.bind(null,null)).catch(o)},predestroy(){i=e.return()},destroy(o){if(!i)return o(null);i.then(o.bind(null,null)).catch(o)}});return r;function s(o){o.done?r.push(null):r.push(o.value)}}static from(e,t){if(ym(e))return e;if(e[hn])return this._fromAsyncIterator(e[hn](),t);Array.isArray(e)||(e=e===void 0?[]:[e]);let i=0;return new qt({...t,read(r){this.push(i===e.length?null:e[i++]),r(null)}})}static isBackpressured(e){return(e._duplexState&$f)!==0||e._readableState.buffered>=e._readableState.highWaterMark}static isPaused(e){return(e._duplexState&nn)===0}[hn](){const e=this;let t=null,i=null,r=null;return this.on("error",h=>{t=h}),this.on("readable",s),this.on("close",o),{[hn](){return this},next(){return new Promise(function(h,u){i=h,r=u;const p=e.read();p!==null?l(p):e._duplexState&Vt&&l(null)})},return(){return f(null)},throw(h){return f(h)}};function s(){i!==null&&l(e.read())}function o(){i!==null&&l(null)}function l(h){r!==null&&(t?r(t):h===null&&!(e._duplexState&ye)?r(Vn):i({value:h,done:h===null}),r=i=null)}function f(h){return e.destroy(h),new Promise((u,p)=>{if(e._duplexState&Vt)return u({value:void 0,done:!0});e.once("close",function(){h?p(h):u({value:void 0,done:!0})})})}}}class Ma extends lr{constructor(e){super(e),this._duplexState|=ot|ye,this._writableState=new Pa(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final),e.eagerOpen&&this._writableState.updateNextTick())}cork(){this._duplexState|=$n}uncork(){this._duplexState&=Aa,this._writableState.updateNextTick()}_writev(e,t){t(null)}_write(e,t){this._writableState.autoBatch(e,t)}_final(e){e(null)}static isBackpressured(e){return(e._duplexState&Xf)!==0}static drained(e){if(e.destroyed)return Promise.resolve(!1);const t=e._writableState,r=(wm(e)?Math.min(1,t.queue.length):t.queue.length)+(e._duplexState&ar?1:0);return r===0?Promise.resolve(!0):(t.drains===null&&(t.drains=[]),new Promise(s=>{t.drains.push({writes:r,resolve:s})}))}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}class dr extends qt{constructor(e){super(e),this._duplexState=ot|this._duplexState&it,this._writableState=new Pa(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final))}cork(){this._duplexState|=$n}uncork(){this._duplexState&=Aa,this._writableState.updateNextTick()}_writev(e,t){t(null)}_write(e,t){this._writableState.autoBatch(e,t)}_final(e){e(null)}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}class Da extends dr{constructor(e){super(e),this._transformState=new em(this),e&&(e.transform&&(this._transform=e.transform),e.flush&&(this._flush=e.flush))}_write(e,t){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=e:this._transform(e,this._transformState.afterTransform)}_read(e){if(this._transformState.data!==null){const t=this._transformState.data;this._transformState.data=null,e(null),this._transform(t,this._transformState.afterTransform)}else e(null)}destroy(e){super.destroy(e),this._transformState.data!==null&&(this._transformState.data=null,this._transformState.afterTransform())}_transform(e,t){t(null,e)}_flush(e){e(null)}_final(e){this._transformState.afterFinal=e,this._flush(hm.bind(this))}}class dm extends Da{}function hm(n,e){const t=this._transformState.afterFinal;if(n)return t(n);e!=null&&this.push(e),this.push(null),t(null)}function fm(...n){return new Promise((e,t)=>Ba(...n,i=>{if(i)return t(i);e()}))}function Ba(n,...e){const t=Array.isArray(n)?[...n,...e]:[n,...e],i=t.length&&typeof t[t.length-1]=="function"?t.pop():null;if(t.length<2)throw new Error("Pipeline requires at least 2 streams");let r=t[0],s=null,o=null;for(let h=1;h<t.length;h++)s=t[h],Wt(r)?r.pipe(s,f):(l(r,!0,h>1,f),r.pipe(s)),r=s;if(i){let h=!1;const u=Wt(s)||!!(s._writableState&&s._writableState.autoDestroy);s.on("error",p=>{o===null&&(o=p)}),s.on("finish",()=>{h=!0,u||i(o)}),u&&s.on("close",()=>i(o||(h?null:mi)))}return s;function l(h,u,p,_){h.on("error",_),h.on("close",R);function R(){if(h._readableState&&!h._readableState.ended||p&&h._writableState&&!h._writableState.ended)return _(mi)}}function f(h){if(!(!h||o)){o=h;for(const u of t)u.destroy(h)}}}function mm(n){return n}function Ua(n){return!!n._readableState||!!n._writableState}function Wt(n){return typeof n._duplexState=="number"&&Ua(n)}function pm(n){return!!n._readableState&&n._readableState.ended}function gm(n){return!!n._writableState&&n._writableState.ended}function _m(n,e={}){const t=n._readableState&&n._readableState.error||n._writableState&&n._writableState.error;return!e.all&&t===Vn?null:t}function ym(n){return Wt(n)&&n.readable}function Em(n){return typeof n=="object"&&n!==null&&typeof n.byteLength=="number"}function Ka(n){return Em(n)?n.byteLength:1024}function Rs(){}function Tm(){this.destroy(new Error("Stream aborted."))}function wm(n){return n._writev!==Ma.prototype._writev&&n._writev!==dr.prototype._writev}var Sm={pipeline:Ba,pipelinePromise:fm,isStream:Ua,isStreamx:Wt,isEnded:pm,isFinished:gm,getStreamError:_m,Stream:lr,Writable:Ma,Readable:qt,Duplex:dr,Transform:Da,PassThrough:dm};function Cs(n,e){for(const t in e)Object.defineProperty(n,t,{value:e[t],enumerable:!0,configurable:!0});return n}function bm(n,e,t){if(!n||typeof n=="string")throw new TypeError("Please pass an Error to err-code");t||(t={}),typeof e=="object"&&(t=e,e=""),e&&(t.code=e);try{return Cs(n,t)}catch{t.message=n.message,t.stack=n.stack;const r=function(){};return r.prototype=Object.create(Object.getPrototypeOf(n)),Cs(new r,t)}}var km=bm;const M=ua(km);/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wärting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const Is="0123456789abcdef",Va=[];for(let n=0;n<256;n++)Va[n]=Is[n>>4&15]+Is[n&15];const As=n=>{const e=n.length;let t="",i=0;for(;i<e;)t+=Va[n[i++]];return t};var Ns="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Rm=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var fn=0;fn<Ns.length;fn++)Rm[Ns.charCodeAt(fn)]=fn;new TextDecoder;const Cm=new TextEncoder,Im=n=>Cm.encode(n),vs=typeof window<"u"?window:self,Di=vs.crypto||vs.msCrypto||{};Di.subtle||Di.webkitSubtle;const Os=n=>{const e=new Uint8Array(n);return Di.getRandomValues(e)};/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const Am=tf("simple-peer"),pi=64*1024,Nm=5*1e3,vm=5*1e3,Om=5*1e3;function xs(n){return n.replace(/a=ice-options:trickle\s\n/g,"")}function xm(n){console.warn(n)}let qn=class Bi extends Sm.Duplex{constructor(t){t=Object.assign({allowHalfOpen:!1},t);super(t);I(this,"_pc");if(this.__objectMode=!!t.objectMode,this._id=As(Os(4)).slice(0,7),this._debug("new peer %o",t),this.channelName=t.initiator?t.channelName||As(Os(20)):null,this.initiator=t.initiator||!1,this.channelConfig=t.channelConfig||Bi.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},Bi.config,t.config),this.offerOptions=t.offerOptions||{},this.answerOptions=t.answerOptions||{},this.sdpTransform=t.sdpTransform||(i=>i),this.trickle=t.trickle!==void 0?t.trickle:!0,this.allowHalfTrickle=t.allowHalfTrickle!==void 0?t.allowHalfTrickle:!1,this.iceCompleteTimeout=t.iceCompleteTimeout||Nm,this.iceRestartEnabled=t.iceRestartEnabled??(this.trickle===!0&&!t.wrtc?"onFailure":!1),this.iceRestartEnabled===!0&&(this.iceRestartEnabled="onFailure"),this.iceFailureRecoveryTimeout=t.iceFailureRecoveryTimeout??Om,this._iceFailureRecoveryTimer=null,this._destroying=!1,this._connected=!1,this._connecting=!1,this._connectedOnce=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,!Li)throw M(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceGatheringComplete=!1,this._iceGatheringCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._isRestartingIce=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new Li(this.config)}catch(i){this.__destroy(M(i,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=i=>{this._onIceCandidate(i)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(i=>{this.__destroy(M(i,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=i=>{this._setupData(i)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(t){if(!this._destroying){if(this.destroyed)throw M(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof t=="string")try{t=JSON.parse(t)}catch{t={}}this._debug("signal()"),t.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),t.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(t.transceiverRequest.kind,t.transceiverRequest.init)),t.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(t.candidate):this._pendingCandidates.push(t.candidate)),t.sdp&&this._pc.setRemoteDescription(new nf(t)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(i=>{this._addIceCandidate(i)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(i=>{this.__destroy(M(i,"ERR_SET_REMOTE_DESCRIPTION"))}),!t.sdp&&!t.candidate&&!t.renegotiate&&!t.transceiverRequest&&this.__destroy(M(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(t){const i=new rf(t);this._pc.addIceCandidate(i).catch(r=>{!i.address||i.address.endsWith(".local")?xm("Ignoring unsupported ICE candidate."):this.__destroy(M(r,"ERR_ADD_ICE_CANDIDATE"))})}send(t){if(!this._destroying){if(this.destroyed)throw M(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(t)}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,queueMicrotask(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this._destroying){if(this.destroyed)throw M(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}restartIce(){return this.destroyed||this._destroying?!1:this.initiator?this._isRestartingIce?(this._debug("Already restarting ice, ignoring restartIce()"),!1):(this._debug("Restarting ICE"),this._iceFailureRecoveryTimer!=null&&(clearTimeout(this._iceFailureRecoveryTimer),this._iceFailureRecoveryTimer=null,this._startIceFailureRecoveryTimeout()),this._iceGatheringComplete=!1,clearTimeout(this._iceGatheringCompleteTimer),this._iceGatheringCompleteTimer=null,this._isNegotiating=!1,this._isRestartingIce=!0,this._pc.restartIce&&this._pc.restartIce(),this._needsNegotiation(),!0):(this._debug("restartIce() only works for the initiator"),!1)}_startIceFailureRecoveryTimeout(){this.destroyed||this._destroying||this._iceFailureRecoveryTimer==null&&(this._debug("started iceFailureRecovery timeout"),this._iceGatheringComplete=!1,clearTimeout(this._iceGatheringCompleteTimer),this._iceGatheringCompleteTimer=null,this._iceFailureRecoveryTimer=setTimeout(()=>{const t=this._pc.iceConnectionState,i=this._pc.iceGatheringState;this._debug("checking iceFailureRecovery timeout",t,i,this._iceGatheringComplete),!(t==="connected"||t==="completed")&&(this._debug("iceFailureRecovery timeout completed - failed"),this.__destroy(M(new Error("Ice connection recovery failed."),"ERR_ICE_CONNECTION_FAILURE")))},this.iceFailureRecoveryTimeout))}_final(t){this._readableState.ended||this.push(null),t(null)}__destroy(t){this.end(),this._destroy(()=>{},t)}_destroy(t,i){this.destroyed||this._destroying||(this._destroying=!0,this._debug("destroying (error: %s)",i&&(i.message||i)),setTimeout(()=>{if(this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,i&&this.emit("error",i),t()},0))}_setupData(t){if(!t.channel)return this.__destroy(M(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=t.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=pi),this.channelName=this._channel.label,this._channel.onmessage=r=>{this._onChannelMessage(r)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=r=>{const s=r.error instanceof Error?r.error:new Error(`Datachannel error: ${r.message} ${r.filename}:${r.lineno}:${r.colno}`);this.__destroy(M(s,"ERR_DATA_CHANNEL"))};let i=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(i&&this._onChannelClose(),i=!0):i=!1},vm)}_write(t,i){if(this.destroyed)return i(M(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(t)}catch(r){return this.__destroy(M(r,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>pi?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=i):i(null)}else this._debug("write before connect"),this._chunk=t,this._cb=i}_onFinish(){if(this.destroyed)return;const t=()=>{setTimeout(()=>this.__destroy(),1e3)};this._connected?t():this.once("connect",t)}_startIceCompleteTimeout(){this.destroyed||this._iceGatheringCompleteTimer||(this._debug("started iceComplete timeout"),this._iceGatheringCompleteTimer=setTimeout(()=>{this._iceGatheringComplete||(this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this._onIceGatheringComplete())},this.iceCompleteTimeout))}_createOffer(){if(this.destroyed)return;const t=Object.assign({},this.offerOptions);this._isRestartingIce&&(this.offerOptions.iceRestart=!0),this._pc.createOffer(t).then(i=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(i.sdp=xs(i.sdp)),i.sdp=this.sdpTransform(i.sdp);const r=()=>{if(this.destroyed)return;const l=this._pc.localDescription||i;this._debug("signal"),this.emit("signal",{type:l.type,sdp:l.sdp})},s=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceGatheringComplete?r():this.once("_iceGatheringComplete",r))},o=l=>{this.__destroy(M(l,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(i).then(s).catch(o)}).catch(i=>{this.__destroy(M(i,"ERR_CREATE_OFFER"))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(t=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(t.sdp=xs(t.sdp)),t.sdp=this.sdpTransform(t.sdp);const i=()=>{var l;if(this.destroyed)return;const o=this._pc.localDescription||t;this._debug("signal"),this.emit("signal",{type:o.type,sdp:o.sdp}),this.initiator||(l=this._requestMissingTransceivers)==null||l.call(this)},r=()=>{this.destroyed||(this.trickle||this._iceGatheringComplete?i():this.once("_iceGatheringComplete",i))},s=o=>{this.__destroy(M(o,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(t).then(r).catch(s)}).catch(t=>{this.__destroy(M(t,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){if(!(this.destroyed||this._destroying)){if(this._debug("_onConnectionStateChange "+this._pc.connectionState),this._pc.connectionState!=="connected"&&(this._connected=!1),this._pc.connectionState==="failed")if(this.iceRestartEnabled||this._isRestartingIce)this._startIceFailureRecoveryTimeout();else return this.__destroy(M(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"));(this._pc.connectionState==="failed"&&this.iceRestartEnabled==="onFailure"||this._pc.connectionState==="disconnected"&&this.iceRestartEnabled==="onDisconnect")&&this.initiator&&!this._isRestartingIce&&this.restartIce()}}_onIceStateChange(){if(this.destroyed)return;const t=this._pc.iceConnectionState,i=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",t,i),this.emit("iceStateChange",t,i),i==="complete"&&this._onIceGatheringComplete(),(t==="connected"||t==="completed")&&(this._iceFailureRecoveryTimer!=null&&(clearTimeout(this._iceFailureRecoveryTimer),this._iceFailureRecoveryTimer=null),this._pcReady=!0,this._isRestartingIce=!1,this._maybeReady()),t==="closed"?this.__destroy(M(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED")):t==="failed"&&!this.iceRestartEnabled&&!this._isRestartingIce?this.__destroy(M(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")):t==="failed"&&(this.iceRestartEnabled||this._isRestartingIce)&&this._startIceFailureRecoveryTimeout(),(t==="failed"&&this.iceRestartEnabled==="onFailure"||t==="disconnected"&&this.iceRestartEnabled==="onDisconnect")&&this.initiator&&!this._isRestartingIce&&this.restartIce()}_onIceGatheringComplete(){this._iceGatheringComplete||(this._debug("iceGatheringComplete"),this._iceGatheringComplete=!0,this.emit("_iceGatheringComplete"),clearTimeout(this._iceGatheringCompleteTimer),this._iceGatheringCompleteTimer=null)}getStats(t){const i=r=>(Object.prototype.toString.call(r.values)==="[object Array]"&&r.values.forEach(s=>{Object.assign(r,s)}),r);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(r=>{const s=[];r.forEach(o=>{s.push(i(o))}),t(null,s)},r=>t(r)):this._pc.getStats.length>0?this._pc.getStats(r=>{if(this.destroyed)return;const s=[];r.result().forEach(o=>{const l={};o.names().forEach(f=>{l[f]=o.stat(f)}),l.id=o.id,l.type=o.type,l.timestamp=o.timestamp,s.push(i(l))}),t(null,s)},r=>t(r)):t(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const t=()=>{this.destroyed||this._destroying||this.getStats((i,r)=>{if(this.destroyed||this._destroying)return;i&&(r=[]);const s={},o={},l={};let f=!1;r.forEach(u=>{(u.type==="remotecandidate"||u.type==="remote-candidate")&&(s[u.id]=u),(u.type==="localcandidate"||u.type==="local-candidate")&&(o[u.id]=u),(u.type==="candidatepair"||u.type==="candidate-pair")&&(l[u.id]=u)});const h=u=>{f=!0;let p=o[u.localCandidateId];p&&(p.ip||p.address)?(this.localAddress=p.ip||p.address,this.localPort=Number(p.port)):p&&p.ipAddress?(this.localAddress=p.ipAddress,this.localPort=Number(p.portNumber)):typeof u.googLocalAddress=="string"&&(p=u.googLocalAddress.split(":"),this.localAddress=p[0],this.localPort=Number(p[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let _=s[u.remoteCandidateId];_&&(_.ip||_.address)?(this.remoteAddress=_.ip||_.address,this.remotePort=Number(_.port)):_&&_.ipAddress?(this.remoteAddress=_.ipAddress,this.remotePort=Number(_.portNumber)):typeof u.googRemoteAddress=="string"&&(_=u.googRemoteAddress.split(":"),this.remoteAddress=_[0],this.remotePort=Number(_[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(r.forEach(u=>{u.type==="transport"&&u.selectedCandidatePairId&&h(l[u.selectedCandidatePairId]),(u.type==="googCandidatePair"&&u.googActiveConnection==="true"||(u.type==="candidatepair"||u.type==="candidate-pair")&&u.selected)&&h(u)}),!f&&(!Object.keys(l).length||Object.keys(o).length)){setTimeout(t,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(p){return this.__destroy(M(p,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const u=this._cb;this._cb=null,u(null)}this._connectedOnce?(this._debug("reconnect"),this.emit("reconnect")):(this._connectedOnce=!0,typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect"))})};t()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>pi||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(t=>{this._pc.removeTrack(t),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(t){this.destroyed||(t.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:t.candidate.candidate,sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid}}):!t.candidate&&!this._iceGatheringComplete&&this._onIceGatheringComplete(),t.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(t){if(this.destroyed)return;let i=t.data;i instanceof ArrayBuffer?i=new Uint8Array(i):this.__objectMode===!1&&(i=Im(i)),this.push(i)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const t=this._cb;this._cb=null,t(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.__destroy())}_debug(){const t=[].slice.call(arguments);t[0]="["+this._id+"] "+t[0],Am.apply(null,t)}};qn.WEBRTC_SUPPORT=!!Li;qn.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};qn.channelConfig={};/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */class Ps extends qn{constructor(e={}){super(e),this._pc&&(this.streams=e.streams||(e.stream?[e.stream]:[]),this._senderMap=new Map,this.streams&&this.streams.forEach(t=>{this.addStream(t)}),this._pc.ontrack=t=>{this._onTrack(t)})}addTransceiver(e,t){if(!this._destroying){if(this.destroyed)throw M(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(i){this.__destroy(M(i,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:t}})}}addStream(e){if(!this._destroying){if(this.destroyed)throw M(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach(t=>{this.addTrack(t,e)})}}addTrack(e,t){if(this._destroying)return;if(this.destroyed)throw M(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const i=this._senderMap.get(e)||new Map;let r=i.get(t);if(!r)r=this._pc.addTrack(e,t),i.set(t,r),this._senderMap.set(e,i),this._needsNegotiation();else throw r.removed?M(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):M(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(e,t,i){if(this._destroying)return;if(this.destroyed)throw M(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const r=this._senderMap.get(e),s=r?r.get(i):null;if(!s)throw M(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,r),s.replaceTrack!=null?s.replaceTrack(t):this.__destroy(M(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,t){if(this._destroying)return;if(this.destroyed)throw M(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const i=this._senderMap.get(e),r=i?i.get(t):null;if(!r)throw M(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{r.removed=!0,this._pc.removeTrack(r)}catch(s){s.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(r):this.__destroy(M(s,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){if(!this._destroying){if(this.destroyed)throw M(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach(t=>{this.removeTrack(t,e)})}}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(e=>{!e.mid&&e.sender.track&&!e.requested&&(e.requested=!0,this.addTransceiver(e.sender.track.kind))})}_onTrack(e){this.destroyed||e.streams.forEach(t=>{this._debug("on track"),this.emit("track",e.track,t),this._remoteTracks.push({track:e.track,stream:t}),!this._remoteStreams.some(i=>i.id===t.id)&&(this._remoteStreams.push(t),queueMicrotask(()=>{this._debug("on stream"),this.emit("stream",t)}))})}}class Ha{constructor(){I(this,"lastStats");I(this,"timestamp",0);I(this,"bytesSent",0);I(this,"bytesReceived",0);I(this,"selectedCandidatePairId","");this.lastStats={availableIncomingBitrate:0,availableOutgoingBitrate:0,bitrateReceive:0,bitrateSend:0,recieverStats:{},senderLayerStats:[],rtcStatsJson:"",selectedCandidatePairChanges:0,canidatePairState:"waiting",canidatePairNominated:!1,iceState:"new",dtlsState:"new",allStats:[]}}parse(e){var s;let t={...this.lastStats};if(t.senderLayerStats=[],t.recieverStats={},!e)return t.recieverStats.hung=!0,t;const i=t.allStats=Array.from(e.values?e.values():e),r=new Map;for(const o of i)if(o.type==="codec"){const{mimeType:f,sdpFmtpLine:h,id:u}=o,[p,_]=f.toLowerCase().split("/");r.set(u,{codec:_??"unknown",sdpFmtpLine:h})}for(const o of i){const l=o.type;if(l==="inbound-rtp"&&o.kind==="video"){let{frameWidth:f,frameHeight:h,framesPerSecond:u,estimatedPlayoutTimestamp:p,nackCount:_,pliCount:R,jitterBufferDelay:b,freezeCount:C,jitter:k,codecId:x}=o;_=_??0,R=R??0;const{codec:N,sdpFmtpLine:A}=r.get(x||"")||{codec:"unknown",sdpFmtpLine:""},O=Math.max(p?p-this.timestamp:0,b);t.recieverStats={...t.recieverStats,nackCount:_,pliCount:R,freezeCount:C,estimatedPlayoutDelay:O,jitterBufferDelay:b,jitter:k,frameWidth:f,frameHeight:h,framesPerSecond:Math.floor(u),videoCodec:N,videoSdpFmtpLine:A}}else if(l==="outbound-rtp"&&o.kind==="video"){let{retransmittedBytesSent:f,scalabilityMode:h,qualityLimitationResolutionChanges:u,encoderImplementation:p,powerEfficientEncoder:_,qualityLimitationReason:R,qualityLimitationDurations:b,totalPacketSendDelay:C,frameWidth:k,frameHeight:x,framesPerSecond:N,codecId:A}=o;const{codec:O,sdpFmtpLine:v}=r.get(A||"")||{codec:"unknown",sdpFmtpLine:""};(s=t.senderLayerStats)==null||s.push({qualityLimitationResolutionChanges:u,qualityLimitationReason:R,bandwidthLimitedQualityDurration:b.bandwidth,cpuLimitedQualityDurration:b.cpu,otherLimitedQualityDurration:b.other,noLimitedQualityDurration:b.none,encoderImplementation:p,powerEfficientEncoder:_,scalabilityMode:h,totalPacketSendDelay:C,retransmittedBytesSent:f,frameWidth:k,frameHeight:x,framesPerSecond:N,videoCodec:O,videoSdpFmtpLine:v})}else if(l==="candidate-pair"){const{availableOutgoingBitrate:f,availableIncomingBitrate:h,currentRoundTripTime:u,state:p,nominated:_}=o;if(_===!1)continue;t={...t,recieverStats:{...t.recieverStats,currentRoundTripTime:u},availableOutgoingBitrate:Math.floor(f??0),availableIncomingBitrate:Math.floor(h??0),canidatePairState:p,canidatePairNominated:_}}else if(l==="transport"){let{bytesReceived:f,bytesSent:h,selectedCandidatePairId:u,timestamp:p}=o;f=f??0,h=h??0,u=u??"",u!==this.selectedCandidatePairId&&(t.selectedCandidatePairChanges=(t.selectedCandidatePairChanges||0)+1,this.selectedCandidatePairId=u),p!=this.timestamp&&(t.bitrateReceive=Math.floor((f-this.bytesReceived)/(p-this.timestamp)*8e3),t.bitrateSend=Math.floor((h-this.bytesSent)/(p-this.timestamp)*8e3),t.recieverStats={...t.recieverStats,hung:t.bitrateReceive<=0},this.timestamp=p),this.bytesSent=h,this.bytesReceived=f}}return t.senderLayerStats=t.senderLayerStats?t.senderLayerStats.sort((o,l)=>(l.frameWidth||0)*(l.frameHeight||0)-(o.frameWidth||0)*(o.frameHeight||0)):[],this.lastStats=t,Vs(t)}}class Pm extends Ha{}let Lm=0;class Fm{constructor(e,t=[]){I(this,"lastMsgRecivedTimestamp");I(this,"connectionState",xe(B.init));I(this,"latestRecivedDataMessage",xe(null));I(this,"outgoingSignalingMessages",xe(null));I(this,"remoteVideoStreams",xe(new Map));I(this,"_p",null);I(this,"_spConfig",null);I(this,"_incomingSignalQueue",[]);I(this,"_consecutiveSignalMsgsProcessed",0);I(this,"_msgSendQueue",[]);I(this,"_reconnectAttemptCount");I(this,"_shouldReconnect");I(this,"_stopping",!1);I(this,"_initiator",!1);I(this,"_connectionId",-1);I(this,"_signalMsgSendCounter",0);I(this,"_signalMsgRecivedCounter",0);I(this,"_videoStatsParser",new Ha);this._spConfig=Object.assign({},e,Ps.config,{streams:t})}setStreamsEnabled(e){this.remoteVideoStreams.get().size!==0&&this.remoteVideoStreams.update(t=>(t.forEach(i=>{i&&i.getTracks().forEach(r=>r.enabled=e)}),t))}resetVideoStreamMap(){let e=this.remoteVideoStreams.get();this.remoteVideoStreams.set(new Map),e.forEach(t=>{t&&t.getTracks().forEach(i=>i.stop())})}start(e=!0,t=0,i=[]){if(this._p&&this.stop(),this._stopping=!1,this._shouldReconnect=e,i.length!==0&&(this._spConfig.streams=i),F("SP: starting with opts: ",this._spConfig,Lm++),this._spConfig.initiator&&(this._connectionId=sc()),this._signalMsgRecivedCounter=0,this._signalMsgSendCounter=0,this._p=new Ps(this._spConfig),!this._p)return te("Failed to create SimplePeer instance!");this._p._debug=(...r)=>$("SIMPLEPEER DEBUG: "+r[0],...r.slice(1)),this._reconnectAttemptCount=t,this._initiator=this._spConfig.initiator||!1,this.connectionState.set(B.connecting),this._p.on("signal",r=>{if(this._connectionId===-1){te("SP sending signal message when connectionId is -1, this should not happen!");return}r=Object.assign({},r,{connId:this._connectionId,msgNum:this._signalMsgSendCounter}),this._signalMsgSendCounter++,$("SP: signal out",r),this.outgoingSignalingMessages.set(JSON.stringify(r))}),this._p.on("connect",()=>{D("SP: Connected!"),this._reconnectAttemptCount=0,this.connectionState.set(B.connected)}),this._p.on("data",r=>{this.lastMsgRecivedTimestamp=Ke(),this.latestRecivedDataMessage.set(r)}),this._p.on("stream",r=>{r.addEventListener,D("SP got video stream: ",r),this.remoteVideoStreams.update(s=>(s=new Map,s.set(r.id,r),s))}),this._p.on("iceStateChange",(r,s)=>{D(`SP: ICE State - connection: ${r}, gathering: ${s}`),r==="connected"||r==="completed"?this.setStreamsEnabled(!0):this.setStreamsEnabled(!1)}),this._p.on("close",()=>{this._initiator||this.resetConnectionStats(),F("SP connection closed"),this.resetVideoStreamMap(),this._shouldReconnect||this.connectionState.set(B.disconnectedOk)}),this._p.on("end",()=>{this.resetVideoStreamMap(),D("SP: connection ended")}),this._p.on("pause",()=>{D("SP: connection paused")}),this._p.on("error",r=>{te("SP: ERROR ",r),this.resetVideoStreamMap(),this._shouldReconnect=!1,this.connectionState.set(B.failed)}),this._processSignalMsgQueue()}stop(){var e,t;this._stopping=!0,this.resetConnectionStats(),this.connectionState.set(B.disconnectedOk),this._shouldReconnect=!1,F("SP: Stop",this._connectionId,(e=this._p)==null?void 0:e.destroyed,(t=this._p)==null?void 0:t.destroying),this._p&&this._p.destroy(),this._p=null}restartIce(){this._p&&this._p.restartIce()}async restart(e,t){var i,r;$("SP Restart",this._reconnectAttemptCount,e,this._connectionId,(i=this._p)==null?void 0:i.destroyed,(r=this._p)==null?void 0:r.destroying),this._reconnectAttemptCount++,this.stop(),this._connectionId=e||-1,await It(500*this._reconnectAttemptCount),$("SP Restart2",this._spConfig),this.start(this._shouldReconnect,this._reconnectAttemptCount),t&&this.ingestSignalingMsg(t)}resetConnectionStats(){this._signalMsgRecivedCounter=0,this._signalMsgSendCounter=0,this._consecutiveSignalMsgsProcessed=0}changeMediaStream(e){if(!(!this._p||this._stopping===!0))try{$("SP: changeMediaStream replacing track",e.getVideoTracks()[0].getSettings());const t=this._p.streams[0],i=t.getVideoTracks()[0];this._p.replaceTrack(i,e.getVideoTracks()[0],t)}catch(t){te("SP: changeMediaStream failed to replace track trying stream remove+add",t.message);for(const i of this._p.streams)this._p.removeStream(i);this._p.addStream(e)}}setCodecPreferences(e){var s,o,l;const t=((s=RTCRtpReceiver.getCapabilities("video"))==null?void 0:s.codecs)||[],i=this.sortCodecsByMimeTypes(t,e);if(D("SP: availReceiveCodecs",t,"sortedCodecs",i),!this._p)return;const r=((l=(o=this._p)==null?void 0:o._pc)==null?void 0:l.getTransceivers())||[];for(const f of r)f.setCodecPreferences(i);this._p.negotiate()}getCodecPreferences(){var t,i;if(!this._p)return;const e=((i=(t=this._p)==null?void 0:t._pc)==null?void 0:i.getTransceivers())||[];for(const r of e){const s=r.receiver.getParameters();if(s.codecs)return s.codecs.map(o=>o.mimeType)}}async getStats(){if(!this._p||!this._p._pc)return;const e=await new Promise((t,i)=>{(!this._p||!this._p._pc)&&i("No active simplePeer instance found!"),this._p.getStats((r,s)=>{r&&i(r),t(s)})});return this._videoStatsParser.parse(e)}getPlayoutDelay(){var t,i;if(!this._p)return;const e=((i=(t=this._p)==null?void 0:t._pc)==null?void 0:i.getTransceivers())||[];for(const r of e){if(!r.receiver)continue;const s=r.receiver;if(s.playoutDelayHint)return s.playoutDelayHint;if(s.jitterBufferTarget)return s.jitterBufferTarget/1e3}return 0}setPlayoutDelay(e){var i,r;if(!this._p)return;const t=((r=(i=this._p)==null?void 0:i._pc)==null?void 0:r.getTransceivers())||[];for(const s of t){if(!s.receiver)continue;const o=s.receiver;o.playoutDelayHint!==void 0?o.playoutDelayHint!==e&&($("SP: Setting playoutDelayHint to "+e),o.playoutDelayHint=e):o.jitterBufferTarget!==void 0&&o.jitterBufferTarget!==e&&($("SP: Setting jitterBufferTarget to "+e),o.jitterBufferTarget=e*1e3)}}sortCodecsByMimeTypes(e,t){return e.sort((i,r)=>{const s=t.indexOf(i.mimeType.toLowerCase()),o=t.indexOf(r.mimeType.toLowerCase()),l=s>=0?s:Number.MAX_VALUE,f=o>=0?o:Number.MAX_VALUE;return l-f})}ingestSignalingMsg(e){try{const t=JSON.parse(e);if(t.msgNum===void 0||t.connId===void 0)return F("SP: Ignoring Invalid Signal Message (no connId or msgNum)!",t);if(t.connId>this._connectionId){if(F("SP: Found Newer connid, fastforwarding!",t.connId,this._connectionId),this._consecutiveSignalMsgsProcessed=0,this._connectionId=t.connId,this._incomingSignalQueue=[],this._spConfig&&!this._initiator)return this.restart(t.connId,e)}else if(t.connId<this._connectionId){F("SP: Ignoring Signal Message For Old connid (connId mismatch)!",t.connId,this._connectionId);return}D("SP: signal queued",t,t.msgNum,this._consecutiveSignalMsgsProcessed,t.connId,this._connectionId),this._incomingSignalQueue.push(t)}catch(t){F("SP: Failed to parse json signal message: ",e,t.message)}this._processSignalMsgQueue()}sendMessage(e){this._msgSendQueue.push(e),this._emptyMsgQueue()}_processSignalMsgQueue(){if(!(!this._p||this._stopping===!0))for(let e=0;e<this._incomingSignalQueue.length;e++){if(this._incomingSignalQueue.length===0)return;const t=this._incomingSignalQueue.findIndex(r=>(r==null?void 0:r.msgNum)===this._consecutiveSignalMsgsProcessed);if(t===-1)return;const i=this._incomingSignalQueue[t];D("SP: signal in",i,i.msgNum,this._consecutiveSignalMsgsProcessed,i.connId,this._connectionId),this._incomingSignalQueue.splice(t,1),e--,this._p.signal(i),this._consecutiveSignalMsgsProcessed++}}_emptyMsgQueue(){if(!this._p||!this._p.connected)return!1;for(this._msgSendQueue.length;this._msgSendQueue.length>0;){const e=this._msgSendQueue.shift();try{this._p.send(e)}catch(t){te("failed to send message over simplePeer data channel: ",t.message),this._msgSendQueue.unshift(e)}}}}class Mm{constructor(e=!0){I(this,"config");I(this,"lastMsgRecivedTimestamp");I(this,"connectionState");I(this,"latestRecivedDataMessage");I(this,"participantConnectionEvents");I(this,"_rovRoomName");I(this,"_accessToken");I(this,"_reconnectAttemptCount",0);I(this,"_shouldReconnect");I(this,"_roomConn");this.config={},this._shouldReconnect=e,this.connectionState=xe(B.init),this.latestRecivedDataMessage=xe(null),this.participantConnectionEvents=xe(null)}async init(e){this.config=e,this._shouldReconnect=!0,this._roomConn=new oc(e.roomConfig),this._roomConn.on(H.DCBufferStatusChanged,(t,i)=>{t?F("LK: Data channel buffer is low: ",i):$("LK: Data channel buffer is normal: ",i)}).on(H.SignalConnected,async()=>{$(`LK: Signal connection established to ${this.config.hostUrl}`)}).on(H.Connected,async()=>{D(`LK: Connected to room: ${this._roomConn.name} via ${this.config.hostUrl}`),this.connectionState.set(B.connected)}).on(H.SignalReconnecting,()=>{this.connectionState.set(B.reconnecting)}).on(H.Disconnected,t=>{let i=this._shouldReconnect&&!!this._roomConn;t===Me.DUPLICATE_IDENTITY?(F("LK: disconnected from room - duplicate identity"),i=!1):t===Me.CLIENT_INITIATED?(F("LK: disconnected from room - client initiated"),i=!1):t===Me.PARTICIPANT_REMOVED?(F("LK: disconnected from room - participant removed"),i=!1):t===Me.ROOM_DELETED?F("LK: disconnected from room - room deleted"):t===Me.STATE_MISMATCH?F("LK: disconnected from room - state mismatch"):t===Me.SERVER_SHUTDOWN?F("LK: disconnected from room - server shutdown"):t===Me.JOIN_FAILURE?F("LK: disconnected from room - join failure"):t===Me.UNKNOWN_REASON&&F("LK: disconnected from room - unknown reason"),i?this._reconnect():(this.connectionState.set(B.disconnectedOk),this.close())}).on(H.Reconnecting,()=>{$(`LK: Reconnecting to room ${this._roomConn.name} via ${this.config.hostUrl}`),this.connectionState.set(B.reconnecting)}).on(H.Reconnected,async()=>{D("LK: Successfully reconnected. server=",await this._roomConn.engine.getConnectedServerAddress()),this.connectionState.set(B.connected)}).on(H.ParticipantMetadataChanged,t=>{$("LK: Participant Metadata Changed",t)}).on(H.ParticipantConnected,async t=>{D(`LK: Participant ${t.identity} (${t.sid}) connected`,t.metadata),this.participantConnectionEvents.set({id:t.identity,joined:!0}),t.on(ac.ConnectionQualityChanged,()=>{$("LK: ParticipantEvent.ConnectionQualityChanged",t.connectionQuality)})}).on(H.ParticipantDisconnected,t=>{$(`LK: Participant ${t.identity} (${t.sid}) disconnected`),this.participantConnectionEvents.set({id:t.identity,joined:!1})}).on(H.MediaDevicesError,t=>{const i=Us.getFailure(t);F("LK: Media device failure",i)}).on(H.ConnectionQualityChanged,(t,i)=>{$(`LK: connection quality for ${i?i.identity:"[no identity]"} changed to ${t}`)}).on(H.RoomMetadataChanged,t=>{try{$("LK: New metadata for room",JSON.parse(t))}catch{$("LK: New metadata for room (NOT VALID JSON)",t)}}).on(H.MediaDevicesChanged,()=>{$("LK: MediaDevicesChanged")}).on(H.LocalTrackUnpublished,(t,i)=>{$("LK: LocalTrackUnpublished",t.trackSid,"by participant",i.identity,"source",t.track?t.track.source:"[no track found]")}).on(H.LocalTrackPublished,(t,i)=>{$("LK: LocalVideoTrackPublished",t.trackSid,"by participant",i.identity,"source",t.track?t.track.source:"[no track found]")}).on(H.AudioPlaybackStatusChanged,()=>{$("LK: AudioPlaybackStatusChanged. canPlaybackAudio =",this._roomConn.canPlaybackAudio)})}async start(e,t){this._rovRoomName=e,this._accessToken=t,this._shouldReconnect=!0;const i=Ke();ue(`LK: Starting conn with ${e} via ${this.config.hostUrl} token = ${t}`);try{const r=setTimeout(()=>{ue(`livekit connect timeout for ${this.config.hostUrl}. Reconnecting...`),this._reconnect()},16e3);await this._connect(),clearTimeout(r),ue(`LK: Connected in ${Ke()-i}ms ${this.config.hostUrl}`)}catch(r){ue(`LK: Error connecting to ${this.config.hostUrl}. Reconnecting...`,r),this._reconnect()}}async sendMessage(e,t=!0,i=[]){if(!this._roomConn)return F("LK: Can't send message, room not connected");if(e.length==0)return F("LK: Can't send empty message");try{await this._roomConn.localParticipant.publishData(e,{reliable:t,destinationIdentities:i})}catch(r){te("LK: Error sending message",r)}}getParticipantSid(e){const t=[...this._roomConn.remoteParticipants.values()].find(i=>i.identity===e);return t?t.sid:null}getLivekitIdentitiy(){return this._roomConn?this._roomConn.localParticipant.identity:null}getRoomName(){return this._roomConn?this._roomConn.name:this._rovRoomName}close(){this._shouldReconnect=!1,this.connectionState.set(B.disconnectedOk),this._roomConn&&(D("LK: Closing Livekit Connection: ",this._rovRoomName,this.config.hostUrl),this._roomConn.disconnect(!0))}async _connect(){await this._roomConn.connect(Ks(this.config.hostUrl),this._accessToken,this.config.roomConnectionConfig),D("LK: Connected to room",this._roomConn.name,this._roomConn)}async _reconnect(){this.connectionState.set(B.reconnecting);try{await this._roomConn.disconnect(!0)}catch(e){te("LK: Error disconnecting from room",e)}if(this._shouldReconnect!=!1)if(this._reconnectAttemptCount<this.config.reconnectAttempts){const e=this._reconnectAttemptCount*800;this._reconnectAttemptCount++,await It(e);try{await this._connect()}catch(t){throw te("LK: Error reconnecting to room",t),t}}else te("LK: Failed to reconnect after ",this._reconnectAttemptCount,"/",this.config.reconnectAttempts,"attempts"),this._fail()}_fail(){this._shouldReconnect=!1,this.connectionState.set(B.failed)}}const Ls=1e3;let gi=0;class Dm{constructor(e,t,i,r,s=null){I(this,"client");I(this,"egressClient");I(this,"roomName");I(this,"tokenEncryptionPassword");I(this,"apiKey");I(this,"secretKey");this.apiKey=e,this.secretKey=t,this.roomName=r,this.tokenEncryptionPassword=s,this.client=new Mh(i,e,t),this.egressClient=new aa(i,e,t)}getEgressClient(){return this.egressClient}async waitForRateLimit(){for(;Ke()-gi<Ls;)console.debug("Waiting for rate limit...",Ke()-gi),await It(Ls);gi=Ke()}async deleteLivekitRoom(){try{return await this.client.deleteRoom(this.roomName)}catch(e){F("LK Admin: Failed to delete room: "+this.roomName,e)}}async createLivekitRoom(e,t){const i=await this._generateRoomMetadata(e,t);await this.waitForRateLimit();const r=await Oe(()=>this.client.createRoom({name:this.roomName,maxParticipants:8,metadata:i,syncStreams:!1,emptyTimeout:60,departureTimeout:30}));return D("LK Admin: Created room: "+this.roomName,r),r}async listLivekitRooms(){return await this.waitForRateLimit(),(await Oe(()=>this.client.listRooms())).filter(t=>t.numParticipants>0)}async updateRoomMetadata(e,t){const i=await this._generateRoomMetadata(e,t);await this.waitForRateLimit();try{return await Oe(()=>this.client.updateRoomMetadata(this.roomName,i))}catch(r){throw new Error("LK Admin: Failed to update metadata for room "+this.roomName+r.toString())}}async _generateRoomMetadata(e,t){let r=[],s;for(let l=0;l<3;l++){do s=pc(mc());while(e.includes(s));e.push(s);const f=await qh(this.apiKey,this.secretKey,this.roomName,s);if(this.tokenEncryptionPassword){const h=await $h(f,this.tokenEncryptionPassword);r.push({userGivenIdentity:s,encrypted:!0,...h})}else r.push({userGivenIdentity:s,token:f,encrypted:!1})}return JSON.stringify({numParticipants:t,accessTokens:r})}}class Bm extends Mm{constructor(){super();I(this,"_livekitApiKey");I(this,"_livekitSecretKey");I(this,"_livekitAdmin");I(this,"camTrack");I(this,"videoStatsParser",new Pm);I(this,"_videoStatsIntervalId");I(this,"_videoPublishOptions");I(this,"_videoCaptureOptions")}async init(t){await super.init(t),this._roomConn.on(H.SignalConnected,()=>{this.isVideoActive()||this.enableCamera(!0),this._roomConn.metadata||this.createLivekitRoom()}).on(H.Reconnecting,()=>{this._roomConn.metadata||this.createLivekitRoom()}).on(H.Connected,()=>{this.isVideoActive()||this.enableCamera(!0),this.updateRoomMetadata()}).on(H.Reconnected,()=>{this.isVideoActive()||this.enableCamera(!0),this.updateRoomMetadata()}).on(H.ParticipantConnected,()=>{this.updateRoomMetadata()}).on(H.DataReceived,(i,r)=>{if(!r)return F("LK: Ignoring received data message with no participant. This can happen when the message is sent before connection completes or if the message comes from the server: ",i);const s=r.identity;r.sid,this.lastMsgRecivedTimestamp=Ke(),this.latestRecivedDataMessage.set({senderId:s,msg:i})}).on(H.TrackSubscribed,(i,r,s)=>{F("LK: Subscribed to track ",r.trackSid," from participant: ",s.identity," source: ",i.source," _THIS SHOULDNT HAPPEN on BACKEND_ ")}).on(H.TrackUnsubscribed,(i,r,s)=>{F("LK: Unsubscribed from track",r.trackSid," from participant: ",s.identity," _THIS SHOULDNT HAPPEN on BACKEND_ ")}).on(H.MediaDevicesError,i=>{const r=Us.getFailure(i);te("LK: Media device failure",r),this._reconnect()})}async startRoom(t,i,r){this._rovRoomName=t,this._livekitApiKey=i,this._livekitSecretKey=r,this._livekitAdmin=this._livekitAdmin??new Dm(i,r,this.config.hostUrl,t,V.ROV_CONTROL_PASSWORD),this.createLivekitRoom();const s=await Hh(i,r,t);await super.start(t,s)}async enableCamera(t,i,r){var s,o,l,f;if(!this._roomConn)throw new Error("LK: Can't enable camera, room not initialized");this._videoCaptureOptions=i||this._videoCaptureOptions||this.config.roomConfig.videoCaptureDefaults,this._videoPublishOptions=r||this._videoPublishOptions||this.config.roomConfig.publishDefaults;for(const[h,u]of this._roomConn.localParticipant.videoTrackPublications)ue("LK: Unpublishing video track: ",h,u),u!=null&&u.videoTrack&&this._roomConn.localParticipant.unpublishTrack(u.videoTrack,!0);if(t)for(;;){try{if(this.connectionState.get()===B.failed)return F("LK: Can't enable camera, room connection failed");const h=await this._roomConn.localParticipant.createTracks({video:{resolution:this._videoCaptureOptions.resolution,facingMode:this._videoCaptureOptions.facingMode},audio:!1});for(const u of h){const p=await this._roomConn.localParticipant.publishTrack(h[0],this._videoPublishOptions);p&&u.kind===cc.Kind.Video&&(this.camTrack=p)}if(this.camTrack)return D("LK: Camera enabled",t,this._videoCaptureOptions,this._videoPublishOptions)}catch(h){te(h.message)}await It(1e3)}else(o=(s=this.camTrack)==null?void 0:s.videoTrack)==null||o.stop(),(f=(l=this.camTrack)==null?void 0:l.audioTrack)==null||f.stop(),this.camTrack=void 0,D("LK: Camera disabled",t)}isVideoActive(){if(!this.camTrack||!this.camTrack.videoTrack)return!1;let t=this._roomConn.localParticipant.videoTrackPublications.get(this.camTrack.trackSid);return $("LK: Video Publication: ",t," Enabled: ",t==null?void 0:t.isEnabled),t==null?void 0:t.isEnabled}async getVideoStats(){for(const t of this._roomConn.localParticipant.videoTrackPublications.values()){if(!t||!t.videoTrack)continue;const i=await t.videoTrack.getRTCStatsReport();if(!i)continue;const r=this.videoStatsParser.parse(i);if(r)return r}}getParticipantIds(){return[...this._roomConn.remoteParticipants.values()].map(t=>t.identity)}async updateRoomMetadata(){if(!this._livekitAdmin)return F("LK: Can't update metadata tokens, livekit admin client not initialized");D("LK: Updating room metadata");const t=this.getParticipantIds().filter(i=>i!==this._rovRoomName);await this._livekitAdmin.updateRoomMetadata(t,t.length+1)}async createLivekitRoom(){if(!this._livekitAdmin)return F("LK: Can't create livekit room, livekit admin client not initialized");const t=this.getParticipantIds(),i=await this._livekitAdmin.createLivekitRoom(t,t.length+1);(!i.metadata||i.numParticipants!==t.length+1)&&await this.updateRoomMetadata()}}class Um{constructor(){I(this,"_cloudLivekitConnection",new Bm);I(this,"_simplePeerConnections",new Map);I(this,"_simplePeerCameraStream",null);I(this,"simplePeerCameraOptions",xe(kr));I(this,"_cancelGetUserMedia",null);I(this,"_videoStatsIntervalId",null);this._cloudLivekitConnection.init({hostUrl:V.LIVEKIT_CLOUD_ENDPOINT,publishVideo:!0,reconnectAttempts:300,roomConnectionConfig:uc,roomConfig:Mt,tokenEncryptionPassword:V.ROV_CONTROL_PASSWORD}),dt(this._cloudLivekitConnection.latestRecivedDataMessage,e=>{if(!e)return;const{senderId:t,msg:i}=e;gs(t,i)}),dt(this._cloudLivekitConnection.participantConnectionEvents,e=>{ue("Cloud Conn Participant Event: ",e)})}onConnectedActions(){this.sendPeriodicVideoStats(),this.initSimplepeerCameraStream()}onReconnectedActions(){this.sendPeriodicVideoStats()}onDisconnectedActions(){}initSimplepeerCameraStream(){this._cancelGetUserMedia&&this._cancelGetUserMedia();const{promise:e,cancel:t}=Rr({fn:()=>navigator.mediaDevices.getUserMedia(this.simplePeerCameraOptions.get()),exponent:1.3,maxRetries:10,initialDelay:500});return this._cancelGetUserMedia=t,e.then(i=>{$("SP: Camera Stream Initialized: ",Object.assign({},i),i,i.active),this._simplePeerCameraStream=i,this._cancelGetUserMedia=null,this.setPreviewVideoElement(this._simplePeerCameraStream),this._simplePeerConnections.forEach(r=>{r.changeMediaStream(i)})}).catch(i=>{te("Error getting separate camera stream for simplePeer: ",i),this._cancelGetUserMedia=null}),this._simplePeerCameraStream}async start(e){let t=!1;const i=()=>{if(t)return;t=!0,D("Creating & Starting Livekit Room: "+e.RovName);const{promise:r}=Rr({fn:()=>this._cloudLivekitConnection.startRoom(e.RovName,e.APIKey,e.SecretKey),exponent:1.3,maxRetries:10,initialDelay:1e3});r.then(()=>{D("Livekit Room Started: "+e.RovName),t=!1}).catch(s=>{te(s),ue("Too many room startup errors: Triggering Page Reload"),window.location.reload()})};i(),dt(this._cloudLivekitConnection.connectionState,(r,s)=>{r===B.failed||r===B.init||r===B.disconnectedOk?i():r===B.connected&&s===B.init?this.onConnectedActions():r===B.connected?this.onReconnectedActions():this.onDisconnectedActions()})}sendPeriodicVideoStats(){this.sendVideoStatsUpdate(),clearInterval(this._videoStatsIntervalId),this._videoStatsIntervalId=setInterval(()=>{var e;((e=this._simplePeerCameraStream)==null?void 0:e.active)!==!0&&this._cancelGetUserMedia===null&&this.initSimplepeerCameraStream(),this.sendVideoStatsUpdate()},1e3)}async sendVideoStatsUpdate(){var i,r,s,o,l,f,h,u,p,_,R,b,C,k,x,N,A;const e=await this._cloudLivekitConnection.getVideoStats().catch(O=>(F("LK: Error getting RTP video stats: ",O),{allStats:[String(O)]}));this.sendMessage({body:{oneofKind:"livekitVideoStats",livekitVideoStats:lc.create({enabled:!!this._cloudLivekitConnection.camTrack&&((i=this._cloudLivekitConnection._roomConn)==null?void 0:i.localParticipant.videoTrackPublications.size)>0,allowBackupCodec:!!((r=this._cloudLivekitConnection._videoPublishOptions)!=null&&r.backupCodec),baseStream:{width:((o=(s=this._cloudLivekitConnection._videoCaptureOptions)==null?void 0:s.resolution)==null?void 0:o.width)??0,height:((f=(l=this._cloudLivekitConnection._videoCaptureOptions)==null?void 0:l.resolution)==null?void 0:f.height)??0,fps:((u=(h=this._cloudLivekitConnection._videoCaptureOptions)==null?void 0:h.resolution)==null?void 0:u.frameRate)??0,maxBitrate:((_=(p=this._cloudLivekitConnection._videoPublishOptions)==null?void 0:p.videoEncoding)==null?void 0:_.maxBitrate)??0},codec:((R=this._cloudLivekitConnection._videoPublishOptions)==null?void 0:R.videoCodec)||"unknown",simulcastLayers:((C=(b=this._cloudLivekitConnection._videoPublishOptions)==null?void 0:b.videoSimulcastLayers)==null?void 0:C.map(O=>{var v,q;return{width:O.width,height:O.height,maxBitrate:((v=O.encoding)==null?void 0:v.maxBitrate)??0,fps:((q=O.encoding)==null?void 0:q.maxFramerate)??0}}))||[],stats:{...e}})}},!1,[]).catch(O=>F("LK: Error sending video stats update: ",O));const t=this.simplePeerCameraOptions.get();for(const[O,v]of this._simplePeerConnections){if(!v||v.connectionState.get()!==B.connected)continue;const q=v&&![B.disconnectedOk,B.failed].includes(v.connectionState.get()),se=await v.getStats().catch(X=>(F("SP: Error getting rtc video stats for user "+O+":",X),{}));this.sendMessage({body:{oneofKind:"simplePeerVideoStats",simplePeerVideoStats:Tr.create({enabled:q,codec:((k=se.senderLayerStats[0])==null?void 0:k.videoCodec)||"unknown",baseStream:{width:Number((x=t.video)==null?void 0:x.width),height:Number((N=t.video)==null?void 0:N.height),fps:Number((A=t.video)==null?void 0:A.frameRate),maxBitrate:0},stats:{...se}})}},!1,[O]).catch(X=>F("SP: Error sending video stats update to user "+O+":",X))}}setLivekitVideoOptions(e,t,i){this._cloudLivekitConnection.enableCamera(e,t,i)}createSimplePeer(e,t){const i=this._simplePeerConnections.get(e);if(i)return F("SP: createSimplePeer() err - Connection already exists for user: "+e),i;const r=this._simplePeerCameraStream?[this._simplePeerCameraStream]:[],s=new Fm(Ds,r);return this._simplePeerConnections.set(e,s),t&&s.ingestSignalingMsg(t),dt(s.latestRecivedDataMessage,o=>{o&&gs(e,o)}),dt(s.outgoingSignalingMessages,o=>{this.sendMessage({body:{oneofKind:"simplePeerSignal",simplePeerSignal:{message:o??""}}},!0,[e])}),dt(s.connectionState,o=>{ue("SP: Connection State Changed for "+e+":",o),(o===B.disconnectedOk||o===B.failed)&&this.sendMessage({body:{oneofKind:"simplePeerVideoStats",simplePeerVideoStats:Tr.create({enabled:!1})}},!1,[e]).catch(l=>F("SP: Error sending sp diabled update to user "+e+":",l))}),s}setPreviewVideoElement(e){const t=document.getElementById("preview_video");t&&(t.srcObject=e)}async setSimplePeerVideoOptions(e,t,i,r){var s;if(e){this.simplePeerCameraOptions.update(l=>{var h,u,p;const f=l!=null&&l.video?l.video:kr.video;return{...l,video:{...l.video,width:((h=i==null?void 0:i.resolution)==null?void 0:h.width)||f.width||1920,height:((u=i==null?void 0:i.resolution)==null?void 0:u.height)||f.height||1080,frameRate:((p=i==null?void 0:i.resolution)==null?void 0:p.frameRate)||f.frameRate||60}}}),this.initSimplepeerCameraStream();let o=this._simplePeerConnections.get(t);o||(o=this.createSimplePeer(t))}else this._cancelGetUserMedia&&this._cancelGetUserMedia(),(s=this._simplePeerCameraStream)==null||s.getTracks().forEach(o=>o.stop()),this._simplePeerCameraStream=null}async ingestSimplePeerSignalMsg(e,t){const i=this._simplePeerConnections.get(e);i===void 0?this.createSimplePeer(e,t):i.ingestSignalingMsg(t)}async sendMessage(e,t,i){if(!e)return!1;if(this._cloudLivekitConnection.connectionState.get()!==B.connected)return V.DEBUG_MODE&&$("LK: Message Not Sent, Livekit Not Connected"),!1;V.DEBUG_MODE&&$("LK/SP: "+(i.length==0?"Broadcasting msg ":"Sending msg to ["+i.join(", ")+"]")+(t?"reliably":"unreliably")+":",ce.toJson(e)),e.backendMetadata=dc.create({});const r=ce.toBinary(e);return await this._cloudLivekitConnection.sendMessage(r,t,i),!0}async stop(){clearInterval(this._videoStatsIntervalId),this._cloudLivekitConnection.close();for(const e of this._simplePeerConnections.values())e.stop()}}const ne=new Um,Km="/system-information";async function Vm(){return ee({method:"get",url:`${V.BLUEOS_APIS_ENDPOINT+Km}/system`,timeout:1e4}).then(n=>n.data).catch(n=>{const e=`Could not fetch blueos system info: ${n.message}`;return F(e),e})}function Hm(n){const e=[],t=n?n.map(i=>i.usage).reduce((i,r)=>i+r,0)/n.length:0;return t>90&&e.push(`Rov CPU is nearly maxed out: ${t}%`),{value:t,warnings:e}}function $m(n){const e=n==null?void 0:n.find(l=>l.mount_point==="/");function t(l){const f=l?l.available_space_B/1073741824:0,h=l?l.total_space_B/2**30:0;return[h-f,h]}const[i,r]=t(e),s=100*i/r,o=s>95?[`Disk/SD Card is almost full: ${Math.round(i*10)/10}/${Math.round(i*10)/10}GB Used`]:[];return{value:s,warnings:o}}function qm(n){var f,h,u,p;const e=[],t=((f=n==null?void 0:n.ram)==null?void 0:f.used_kB)??0,i=((h=n==null?void 0:n.ram)==null?void 0:h.total_kB)??0,r=100*t/i,s=((u=n==null?void 0:n.swap)==null?void 0:u.used_kB)??0,o=((p=n==null?void 0:n.swap)==null?void 0:p.total_kB)??0,l=100*s/o;return r>90&&e.push(`RAM is almost full (${t} / ${i})`),l>90&&e.push(`Linux SWAP space is almost full (${s} / ${o})`),{value:r,warnings:e}}function Wm(n){const e=n==null?void 0:n.find(r=>r.name==="CPU"),t=e?e.temperature:0,i=n?n.filter(r=>{const s=r.critical_temperature||1/0;return r.temperature>s}).map(r=>`Critical temperature reached in ${r.name}: ${r.temperature}°C`):[];return{value:t,warnings:i}}vn.defaultLogOrigin=hc.ROV;V.SEND_LOGS&&(vn.sendLogsAllowed=!0);const Fs=document.getElementById("show_recent_logs_btn"),Ms=document.getElementById("recent_logs");Fs&&Ms&&Fs.addEventListener("click",()=>vn.printRecentLogs(Ms));Object.assign(window,{getLongTermStarterAccessToken:()=>{Wh(V.LIVEKIT_API_KEY,V.LIVEKIT_SECRET_KEY).then(n=>{console.log(n),document.write(n)}).catch(n=>{console.error(n),document.write((n.message||"")+" "+n.toString())})},getLongTermTestRoomAccessToken:()=>{Gh(V.LIVEKIT_API_KEY,V.LIVEKIT_SECRET_KEY).then(n=>{console.log(n),document.write(n)}).catch(n=>{console.error(n),document.write((n.message||"")+" "+n.toString())})}});ne.start({RovName:V.ROV_NAME,APIKey:V.LIVEKIT_API_KEY,SecretKey:V.LIVEKIT_SECRET_KEY,LivekitCloudURL:V.LIVEKIT_CLOUD_ENDPOINT,LivekitLocalURL:V.LIVEKIT_LOCAL_ENDPOINT}).then(()=>{document.getElementById("video_stats")});V.TWITCH_STREAM_KEY!=="None"&&Nn.init(V.TWITCH_STREAM_KEY,V.ROV_NAME,V.LIVEKIT_API_KEY,V.LIVEKIT_SECRET_KEY);V.PYTHON_WEBSOCKET_PORT!=0?Sn.start("ws://localhost:"+V.PYTHON_WEBSOCKET_PORT,n=>{if(n.length===0)return;const e=ce.fromBinary(n);if(!e.backendMetadata)return te("No BackendMetadata in message from iROV",ce.toJson(e));const t=e.backendMetadata.targetUserIds,r=e.backendMetadata.transportMethod===fc.LivekitReliable;ne.sendMessage(e,r,t||[])}):D("No PYTHON_WEBSOCKET_PORT url parameter set, skipping python websocket!");if(V.BLUEOS_APIS_ENDPOINT){const n="("+wr.join(")|(")+")";be.start(Ks(V.BLUEOS_APIS_ENDPOINT)+":6040/ws/mavlink?filter="+n,e=>{if(!e.header||!e.message)return te("Mavlink message missing header or message body",e);zh(e);const t=Bs(JSON.stringify(e)),i=ce.create({body:{oneofKind:"mavlink",mavlink:{message:t}}});wr.includes(e.message.type)&&ne.sendMessage(i,!0,[])},()=>{be.sendMessage(Ec(0,8e6))}),setInterval(()=>{Vm().then(e=>{const t=Wm(e.temperature),i=Hm(e.cpu),r=qm(e.memory),s=$m(e.disk),o=t.warnings.concat(i.warnings,r.warnings,s.warnings);V.DEBUG_MODE&&$("/SysInfo cpuTemp",t,"cpuUsage",i,"memUsage",r,"diskUsage",s,o);const l=ce.create({body:{oneofKind:"systemMonitor",systemMonitor:{cpuTemp:t.value,cpuUsage:i.value,memoryUsage:r.value,diskUsage:s.value,warnings:o}}});ne.sendMessage(l,!0,[])})},5e3)}else D("No BLUEOS_APIS_ENDPOINT url parameter set, skipping mavlink & system info monitoring!");window.addEventListener("beforeunload",()=>{Nn.stopStream(),ne.stop(),Sn.close(),be.close()});
//# sourceMappingURL=internal-D7MzBFPQ.js.map
