var Bo=Object.defineProperty;var Vo=(n,e,t)=>e in n?Bo(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var E=(n,e,t)=>(Vo(n,typeof e!="symbol"?e+"":e,t),t);import{l as P,d as ye,E as Bi,M as ee,a as Ho,b as Ko,c as qo,e as In,f as x,g as $,h as ge,D as $o,i as A,S as Wo,r as O,L as Ze,m as jt,j as rt,k as Vi,C as q,R as Jo,n as N,o as he,P as jo,p as bs,T as Go,q as zo,s as ks,t as Rs,u as Yo,F as Cs}from"./logging-68e36512.js";function mt(n){return new Promise(e=>{setTimeout(()=>{e()},n)})}function Xo(n,e=0){return new Promise((t,s)=>{e!==0&&setTimeout(()=>{s()},e);const i=setInterval(()=>{n()&&(clearInterval(i),t())},100)})}function As(n,e=null,t=5,s=1e3,i=2){return async function(...r){let o,a=0;for(;a<t;)try{return await n.apply(e,r)}catch(l){o=l,P("err:",o),await mt(s*Math.pow(i,a)),a++}throw new Error("asyncExpBackoff() func failed after "+a+" retries. Error: "+o)}}function et(n,e){let t=!1;return n.subscribe(i=>{if(t==!1){t=!0;return}e(i)})}function Hi(n,e=!1){return n.replace("http","ws")}const vs=["Ancient","Dawn","Small","Broken","Red","Cold","Wild","Divine","Empty","Patient","Holy","Long","Wispy","White","Delicate","Bold","Billowing","Blue","Crimson","Aged","Misty","Snowy","Withered","Little","Frosty","Weathered","Nameless","Fragrant","Lively","Quiet","Purple","Proud","Dry","Bitter","Dark","Icy","Twilight","Wandering","Solitary","Morning","Lingering","Still","Late","Sparkling","Restless","Winter","Silent","Floral","Young","Green","Cool","Autumn","Falling","Spring","Summer","Polished","Hidden","Damp","Muddy","Black","Old","Rough"],Is=["Pond","Snow","Glade","Hill","Voice","River","Sun","Dawn","Forest","Frog","Grass","Shadow","Dust","Water","Meadow","Moon","Thunder","Sun","Wildflower","Snowflake","Silence","Haze","Shape","Pine","Waterfall","Sound","Wood","Tree","Night","Flower","Dream","Cherry","Resonance","Firefly","Bush","Star","Darkness","Lake","Frost","Paper","Surf","Fog","Brook","Mountain","Field","Bird","Leaf","Sea","Water","Sky","Smoke","Sunset","Glitter","Dew","Butterfly","Wind","Fire","Rain","Morning","Feather","Cloud","Breeze","Violet","Wave","Droplet","Swamp","Village","Hut","Path","Book","Rain","Spell","Pig"];function Qo(n,e=0){let t=vs.length>>>0,s=Is.length>>>0,i=Math.max(t,s)>>>0,r=Math.max(1,(n+1)%i)>>>0,o=Math.max(1,(e+1)%i)>>>0,a=vs[(r+o)%t],l=Is[r*o%s];return a+"-"+l}function F(n,e){if(!n)throw new Error(e)}const Zo=34028234663852886e22,ea=-34028234663852886e22,ta=4294967295,na=2147483647,sa=-2147483648;function Nt(n){if(typeof n!="number")throw new Error("invalid int 32: "+typeof n);if(!Number.isInteger(n)||n>na||n<sa)throw new Error("invalid int 32: "+n)}function Nn(n){if(typeof n!="number")throw new Error("invalid uint 32: "+typeof n);if(!Number.isInteger(n)||n>ta||n<0)throw new Error("invalid uint 32: "+n)}function Ki(n){if(typeof n!="number")throw new Error("invalid float 32: "+typeof n);if(Number.isFinite(n)&&(n>Zo||n<ea))throw new Error("invalid float 32: "+n)}const qi=Symbol("@bufbuild/protobuf/enum-type");function ia(n){const e=n[qi];return F(e,"missing enum type on enum object"),e}function $i(n,e,t,s){n[qi]=Wi(e,t.map(i=>({no:i.no,name:i.name,localName:n[i.no]})))}function Wi(n,e,t){const s=Object.create(null),i=Object.create(null),r=[];for(const o of e){const a=Ji(o);r.push(a),s[o.name]=a,i[o.no]=a}return{typeName:n,values:r,findName(o){return s[o]},findNumber(o){return i[o]}}}function ra(n,e,t){const s={};for(const i of e){const r=Ji(i);s[r.localName]=r.no,s[r.no]=r.localName}return $i(s,n,e),s}function Ji(n){return"localName"in n?n:Object.assign(Object.assign({},n),{localName:n.name})}class ji{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const s=this.getType(),i=s.runtime.bin,r=i.makeReadOptions(t);return i.readMessage(this,r.readerFactory(e),e.byteLength,r),this}fromJson(e,t){const s=this.getType(),i=s.runtime.json,r=i.makeReadOptions(t);return i.readMessage(s,e,r,this),this}fromJsonString(e,t){let s;try{s=JSON.parse(e)}catch(i){throw new Error(`cannot decode ${this.getType().typeName} from JSON: ${i instanceof Error?i.message:String(i)}`)}return this.fromJson(s,t)}toBinary(e){const t=this.getType(),s=t.runtime.bin,i=s.makeWriteOptions(e),r=i.writerFactory();return s.writeMessage(this,r,i),r.finish()}toJson(e){const t=this.getType(),s=t.runtime.json,i=s.makeWriteOptions(e);return s.writeMessage(this,i)}toJsonString(e){var t;const s=this.toJson(e);return JSON.stringify(s,null,(t=e==null?void 0:e.prettySpaces)!==null&&t!==void 0?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function oa(n,e,t,s){var i;const r=(i=s==null?void 0:s.localName)!==null&&i!==void 0?i:e.substring(e.lastIndexOf(".")+1),o={[r]:function(a){n.util.initFields(this),n.util.initPartial(a,this)}}[r];return Object.setPrototypeOf(o.prototype,new ji),Object.assign(o,{runtime:n,typeName:e,fields:n.util.newFieldList(t),fromBinary(a,l){return new o().fromBinary(a,l)},fromJson(a,l){return new o().fromJson(a,l)},fromJsonString(a,l){return new o().fromJsonString(a,l)},equals(a,l){return n.util.equals(o,a,l)}}),o}function aa(){let n=0,e=0;for(let s=0;s<28;s+=7){let i=this.buf[this.pos++];if(n|=(i&127)<<s,!(i&128))return this.assertBounds(),[n,e]}let t=this.buf[this.pos++];if(n|=(t&15)<<28,e=(t&112)>>4,!(t&128))return this.assertBounds(),[n,e];for(let s=3;s<=31;s+=7){let i=this.buf[this.pos++];if(e|=(i&127)<<s,!(i&128))return this.assertBounds(),[n,e]}throw new Error("invalid varint")}function an(n,e,t){for(let r=0;r<28;r=r+7){const o=n>>>r,a=!(!(o>>>7)&&e==0),l=(a?o|128:o)&255;if(t.push(l),!a)return}const s=n>>>28&15|(e&7)<<4,i=!!(e>>3);if(t.push((i?s|128:s)&255),!!i){for(let r=3;r<31;r=r+7){const o=e>>>r,a=!!(o>>>7),l=(a?o|128:o)&255;if(t.push(l),!a)return}t.push(e>>>31&1)}}const Ot=4294967296;function Ns(n){const e=n[0]==="-";e&&(n=n.slice(1));const t=1e6;let s=0,i=0;function r(o,a){const l=Number(n.slice(o,a));i*=t,s=s*t+l,s>=Ot&&(i=i+(s/Ot|0),s=s%Ot)}return r(-24,-18),r(-18,-12),r(-12,-6),r(-6),e?zi(s,i):jn(s,i)}function ca(n,e){let t=jn(n,e);const s=t.hi&2147483648;s&&(t=zi(t.lo,t.hi));const i=Gi(t.lo,t.hi);return s?"-"+i:i}function Gi(n,e){if({lo:n,hi:e}=la(n,e),e<=2097151)return String(Ot*e+n);const t=n&16777215,s=(n>>>24|e<<8)&16777215,i=e>>16&65535;let r=t+s*6777216+i*6710656,o=s+i*8147497,a=i*2;const l=1e7;return r>=l&&(o+=Math.floor(r/l),r%=l),o>=l&&(a+=Math.floor(o/l),o%=l),a.toString()+Os(o)+Os(r)}function la(n,e){return{lo:n>>>0,hi:e>>>0}}function jn(n,e){return{lo:n|0,hi:e|0}}function zi(n,e){return e=~e,n?n=~n+1:e+=1,jn(n,e)}const Os=n=>{const e=String(n);return"0000000".slice(e.length)+e};function Ps(n,e){if(n>=0){for(;n>127;)e.push(n&127|128),n=n>>>7;e.push(n)}else{for(let t=0;t<9;t++)e.push(n&127|128),n=n>>7;e.push(1)}}function ua(){let n=this.buf[this.pos++],e=n&127;if(!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<7,!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<14,!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<21,!(n&128))return this.assertBounds(),e;n=this.buf[this.pos++],e|=(n&15)<<28;for(let t=5;n&128&&t<10;t++)n=this.buf[this.pos++];if(n&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function da(){const n=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"&&(typeof ye.process!="object"||typeof ye.process.env!="object"||{}.BUF_BIGINT_DISABLE!=="1")){const i=BigInt("-9223372036854775808"),r=BigInt("9223372036854775807"),o=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(l){const u=typeof l=="bigint"?l:BigInt(l);if(u>r||u<i)throw new Error(`int64 invalid: ${l}`);return u},uParse(l){const u=typeof l=="bigint"?l:BigInt(l);if(u>a||u<o)throw new Error(`uint64 invalid: ${l}`);return u},enc(l){return n.setBigInt64(0,this.parse(l),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},uEnc(l){return n.setBigInt64(0,this.uParse(l),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},dec(l,u){return n.setInt32(0,l,!0),n.setInt32(4,u,!0),n.getBigInt64(0,!0)},uDec(l,u){return n.setInt32(0,l,!0),n.setInt32(4,u,!0),n.getBigUint64(0,!0)}}}const t=i=>F(/^-?[0-9]+$/.test(i),`int64 invalid: ${i}`),s=i=>F(/^[0-9]+$/.test(i),`uint64 invalid: ${i}`);return{zero:"0",supported:!1,parse(i){return typeof i!="string"&&(i=i.toString()),t(i),i},uParse(i){return typeof i!="string"&&(i=i.toString()),s(i),i},enc(i){return typeof i!="string"&&(i=i.toString()),t(i),Ns(i)},uEnc(i){return typeof i!="string"&&(i=i.toString()),s(i),Ns(i)},dec(i,r){return ca(i,r)},uDec(i,r){return Gi(i,r)}}}const j=da();var g;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(g||(g={}));var Te;(function(n){n[n.BIGINT=0]="BIGINT",n[n.STRING=1]="STRING"})(Te||(Te={}));function fe(n,e,t){if(e===t)return!0;if(n==g.BYTES){if(!(e instanceof Uint8Array)||!(t instanceof Uint8Array)||e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}switch(n){case g.UINT64:case g.FIXED64:case g.INT64:case g.SFIXED64:case g.SINT64:return e==t}return!1}function je(n,e){switch(n){case g.BOOL:return!1;case g.UINT64:case g.FIXED64:case g.INT64:case g.SFIXED64:case g.SINT64:return e==0?j.zero:"0";case g.DOUBLE:case g.FLOAT:return 0;case g.BYTES:return new Uint8Array(0);case g.STRING:return"";default:return 0}}function Yi(n,e){switch(n){case g.BOOL:return e===!1;case g.STRING:return e==="";case g.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var U;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32"})(U||(U={}));class ha{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let i=0;i<this.chunks.length;i++)e+=this.chunks[i].length;let t=new Uint8Array(e),s=0;for(let i=0;i<this.chunks.length;i++)t.set(this.chunks[i],s),s+=this.chunks[i].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Nn(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Nt(e),Ps(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){Ki(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){Nn(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){Nt(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return Nt(e),e=(e<<1^e>>31)>>>0,Ps(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),s=new DataView(t.buffer),i=j.enc(e);return s.setInt32(0,i.lo,!0),s.setInt32(4,i.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),s=new DataView(t.buffer),i=j.uEnc(e);return s.setInt32(0,i.lo,!0),s.setInt32(4,i.hi,!0),this.raw(t)}int64(e){let t=j.enc(e);return an(t.lo,t.hi,this.buf),this}sint64(e){let t=j.enc(e),s=t.hi>>31,i=t.lo<<1^s,r=(t.hi<<1|t.lo>>>31)^s;return an(i,r,this.buf),this}uint64(e){let t=j.uEnc(e);return an(t.lo,t.hi,this.buf),this}}class fa{constructor(e,t){this.varint64=aa,this.uint32=ua,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t??new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,s=e&7;if(t<=0||s<0||s>5)throw new Error("illegal tag: field no "+t+" wire type "+s);return[t,s]}skip(e,t){let s=this.pos;switch(e){case U.Varint:for(;this.buf[this.pos++]&128;);break;case U.Bit64:this.pos+=4;case U.Bit32:this.pos+=4;break;case U.LengthDelimited:let i=this.uint32();this.pos+=i;break;case U.StartGroup:for(;;){const[r,o]=this.tag();if(o===U.EndGroup){if(t!==void 0&&r!==t)throw new Error("invalid end group tag");break}this.skip(o,r)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(s,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return j.dec(...this.varint64())}uint64(){return j.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),s=-(e&1);return e=(e>>>1|(t&1)<<31)^s,t=t>>>1^s,j.dec(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return j.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return j.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function ma(n,e,t,s){let i;return{typeName:e,extendee:t,get field(){if(!i){const r=typeof s=="function"?s():s;r.name=e.split(".").pop(),r.jsonName=`[${e}]`,i=n.util.newFieldList([r]).list()[0]}return i},runtime:n}}function Xi(n){const e=n.field.localName,t=Object.create(null);return t[e]=pa(n),[t,()=>t[e]]}function pa(n){const e=n.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return je(e.T,e.L);case"message":const t=e.T,s=new t;return t.fieldWrapper?t.fieldWrapper.unwrapField(s):s;case"map":throw"map fields are not allowed to be extensions"}}function ga(n,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let t=n.length-1;t>=0;--t)if(n[t].no==e.no)return[n[t]];return[]}return n.filter(t=>t.no===e.no)}let ce="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Gt=[];for(let n=0;n<ce.length;n++)Gt[ce[n].charCodeAt(0)]=n;Gt["-".charCodeAt(0)]=ce.indexOf("+");Gt["_".charCodeAt(0)]=ce.indexOf("/");const Qi={dec(n){let e=n.length*3/4;n[n.length-2]=="="?e-=2:n[n.length-1]=="="&&(e-=1);let t=new Uint8Array(e),s=0,i=0,r,o=0;for(let a=0;a<n.length;a++){if(r=Gt[n.charCodeAt(a)],r===void 0)switch(n[a]){case"=":i=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(i){case 0:o=r,i=1;break;case 1:t[s++]=o<<2|(r&48)>>4,o=r,i=2;break;case 2:t[s++]=(o&15)<<4|(r&60)>>2,o=r,i=3;break;case 3:t[s++]=(o&3)<<6|r,i=0;break}}if(i==1)throw Error("invalid base64 string.");return t.subarray(0,s)},enc(n){let e="",t=0,s,i=0;for(let r=0;r<n.length;r++)switch(s=n[r],t){case 0:e+=ce[s>>2],i=(s&3)<<4,t=1;break;case 1:e+=ce[i|s>>4],i=(s&15)<<2,t=2;break;case 2:e+=ce[i|s>>6],e+=ce[s&63],t=0;break}return t&&(e+=ce[i],e+="=",t==1&&(e+="=")),e}};function _a(n,e,t){er(e,n);const s=e.runtime.bin.makeReadOptions(t),i=ga(n.getType().runtime.bin.listUnknownFields(n),e.field),[r,o]=Xi(e);for(const a of i)e.runtime.bin.readField(r,s.readerFactory(a.data),e.field,a.wireType,s);return o()}function ya(n,e,t,s){er(e,n);const i=e.runtime.bin.makeReadOptions(s),r=e.runtime.bin.makeWriteOptions(s);if(Zi(n,e)){const u=n.getType().runtime.bin.listUnknownFields(n).filter(c=>c.no!=e.field.no);n.getType().runtime.bin.discardUnknownFields(n);for(const c of u)n.getType().runtime.bin.onUnknownField(n,c.no,c.wireType,c.data)}const o=r.writerFactory();let a=e.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(a,t,o,r);const l=i.readerFactory(o.finish());for(;l.pos<l.len;){const[u,c]=l.tag(),d=l.skip(c,u);n.getType().runtime.bin.onUnknownField(n,u,c,d)}}function Zi(n,e){const t=n.getType();return e.extendee.typeName===t.typeName&&!!t.runtime.bin.listUnknownFields(n).find(s=>s.no==e.field.no)}function er(n,e){F(n.extendee.typeName==e.getType().typeName,`extension ${n.typeName} can only be applied to message ${n.extendee.typeName}`)}function tr(n,e){const t=n.localName;if(n.repeated)return e[t].length>0;if(n.oneof)return e[n.oneof.localName].case===t;switch(n.kind){case"enum":case"scalar":return n.opt||n.req?e[t]!==void 0:n.kind=="enum"?e[t]!==n.T.values[0].no:!Yi(n.T,e[t]);case"message":return e[t]!==void 0;case"map":return Object.keys(e[t]).length>0}}function Ls(n,e){const t=n.localName,s=!n.opt&&!n.req;if(n.repeated)e[t]=[];else if(n.oneof)e[n.oneof.localName]={case:void 0};else switch(n.kind){case"map":e[t]={};break;case"enum":e[t]=s?n.T.values[0].no:void 0;break;case"scalar":e[t]=s?je(n.T,n.L):void 0;break;case"message":e[t]=void 0;break}}function Ie(n,e){if(n===null||typeof n!="object"||!Object.getOwnPropertyNames(ji.prototype).every(s=>s in n&&typeof n[s]=="function"))return!1;const t=n.getType();return t===null||typeof t!="function"||!("typeName"in t)||typeof t.typeName!="string"?!1:e===void 0?!0:t.typeName==e.typeName}function nr(n,e){return Ie(e)||!n.fieldWrapper?e:n.fieldWrapper.wrapField(e)}g.DOUBLE,g.FLOAT,g.INT64,g.UINT64,g.INT32,g.UINT32,g.BOOL,g.STRING,g.BYTES;const Ms={ignoreUnknownFields:!1},Ds={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function Ta(n){return n?Object.assign(Object.assign({},Ms),n):Ms}function Ea(n){return n?Object.assign(Object.assign({},Ds),n):Ds}const Bt=Symbol(),Pt=Symbol();function Sa(){return{makeReadOptions:Ta,makeWriteOptions:Ea,readMessage(n,e,t,s){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error(`cannot decode message ${n.typeName} from JSON: ${te(e)}`);s=s??new n;const i=new Map,r=t.typeRegistry;for(const[o,a]of Object.entries(e)){const l=n.fields.findJsonName(o);if(l){if(l.oneof){if(a===null&&l.kind=="scalar")continue;const u=i.get(l.oneof);if(u!==void 0)throw new Error(`cannot decode message ${n.typeName} from JSON: multiple keys for oneof "${l.oneof.name}" present: "${u}", "${o}"`);i.set(l.oneof,o)}xs(s,a,l,t,n)}else{let u=!1;if(r!=null&&r.findExtension&&o.startsWith("[")&&o.endsWith("]")){const c=r.findExtension(o.substring(1,o.length-1));if(c&&c.extendee.typeName==n.typeName){u=!0;const[d,f]=Xi(c);xs(d,a,c.field,t,c),ya(s,c,f(),t)}}if(!u&&!t.ignoreUnknownFields)throw new Error(`cannot decode message ${n.typeName} from JSON: key "${o}" is unknown`)}}return s},writeMessage(n,e){const t=n.getType(),s={};let i;try{for(i of t.fields.byNumber()){if(!tr(i,n)){if(i.req)throw"required field not set";if(!e.emitDefaultValues||!ba(i))continue}const o=i.oneof?n[i.oneof.localName].value:n[i.localName],a=Fs(i,o,e);a!==void 0&&(s[e.useProtoFieldName?i.name:i.jsonName]=a)}const r=e.typeRegistry;if(r!=null&&r.findExtensionFor)for(const o of t.runtime.bin.listUnknownFields(n)){const a=r.findExtensionFor(t.typeName,o.no);if(a&&Zi(n,a)){const l=_a(n,a,e),u=Fs(a.field,l,e);u!==void 0&&(s[a.field.jsonName]=u)}}}catch(r){const o=i?`cannot encode field ${t.typeName}.${i.name} to JSON`:`cannot encode message ${t.typeName} to JSON`,a=r instanceof Error?r.message:String(r);throw new Error(o+(a.length>0?`: ${a}`:""))}return s},readScalar(n,e,t){return ot(n,e,t??Te.BIGINT,!0)},writeScalar(n,e,t){if(e!==void 0&&(t||Yi(n,e)))return Lt(n,e)},debug:te}}function te(n){if(n===null)return"null";switch(typeof n){case"object":return Array.isArray(n)?"array":"object";case"string":return n.length>100?"string":`"${n.split('"').join('\\"')}"`;default:return String(n)}}function xs(n,e,t,s,i){let r=t.localName;if(t.repeated){if(F(t.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error(`cannot decode field ${i.typeName}.${t.name} from JSON: ${te(e)}`);const o=n[r];for(const a of e){if(a===null)throw new Error(`cannot decode field ${i.typeName}.${t.name} from JSON: ${te(a)}`);switch(t.kind){case"message":o.push(t.T.fromJson(a,s));break;case"enum":const l=cn(t.T,a,s.ignoreUnknownFields,!0);l!==Pt&&o.push(l);break;case"scalar":try{o.push(ot(t.T,a,t.L,!0))}catch(u){let c=`cannot decode field ${i.typeName}.${t.name} from JSON: ${te(a)}`;throw u instanceof Error&&u.message.length>0&&(c+=`: ${u.message}`),new Error(c)}break}}}else if(t.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error(`cannot decode field ${i.typeName}.${t.name} from JSON: ${te(e)}`);const o=n[r];for(const[a,l]of Object.entries(e)){if(l===null)throw new Error(`cannot decode field ${i.typeName}.${t.name} from JSON: map value null`);let u;try{u=wa(t.K,a)}catch(c){let d=`cannot decode map key for field ${i.typeName}.${t.name} from JSON: ${te(e)}`;throw c instanceof Error&&c.message.length>0&&(d+=`: ${c.message}`),new Error(d)}switch(t.V.kind){case"message":o[u]=t.V.T.fromJson(l,s);break;case"enum":const c=cn(t.V.T,l,s.ignoreUnknownFields,!0);c!==Pt&&(o[u]=c);break;case"scalar":try{o[u]=ot(t.V.T,l,Te.BIGINT,!0)}catch(d){let f=`cannot decode map value for field ${i.typeName}.${t.name} from JSON: ${te(e)}`;throw d instanceof Error&&d.message.length>0&&(f+=`: ${d.message}`),new Error(f)}break}}}else switch(t.oneof&&(n=n[t.oneof.localName]={case:r},r="value"),t.kind){case"message":const o=t.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let a=n[r];Ie(a)?a.fromJson(e,s):(n[r]=a=o.fromJson(e,s),o.fieldWrapper&&!t.oneof&&(n[r]=o.fieldWrapper.unwrapField(a)));break;case"enum":const l=cn(t.T,e,s.ignoreUnknownFields,!1);switch(l){case Bt:Ls(t,n);break;case Pt:break;default:n[r]=l;break}break;case"scalar":try{const u=ot(t.T,e,t.L,!1);switch(u){case Bt:Ls(t,n);break;default:n[r]=u;break}}catch(u){let c=`cannot decode field ${i.typeName}.${t.name} from JSON: ${te(e)}`;throw u instanceof Error&&u.message.length>0&&(c+=`: ${u.message}`),new Error(c)}break}}function wa(n,e){if(n===g.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return ot(n,e,Te.BIGINT,!0).toString()}function ot(n,e,t,s){if(e===null)return s?je(n,t):Bt;switch(n){case g.DOUBLE:case g.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const i=Number(e);if(Number.isNaN(i)||!Number.isFinite(i))break;return n==g.FLOAT&&Ki(i),i;case g.INT32:case g.FIXED32:case g.SFIXED32:case g.SINT32:case g.UINT32:let r;if(typeof e=="number"?r=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(r=Number(e)),r===void 0)break;return n==g.UINT32||n==g.FIXED32?Nn(r):Nt(r),r;case g.INT64:case g.SFIXED64:case g.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=j.parse(e);return t?o.toString():o;case g.FIXED64:case g.UINT64:if(typeof e!="number"&&typeof e!="string")break;const a=j.uParse(e);return t?a.toString():a;case g.BOOL:if(typeof e!="boolean")break;return e;case g.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case g.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return Qi.dec(e)}throw new Error}function cn(n,e,t,s){if(e===null)return n.typeName=="google.protobuf.NullValue"?0:s?n.values[0].no:Bt;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const i=n.findName(e);if(i!==void 0)return i.no;if(t)return Pt;break}throw new Error(`cannot decode enum ${n.typeName} from JSON: ${te(e)}`)}function ba(n){return n.repeated||n.kind=="map"?!0:!(n.oneof||n.kind=="message"||n.opt||n.req)}function Fs(n,e,t){if(n.kind=="map"){F(typeof e=="object"&&e!=null);const s={},i=Object.entries(e);switch(n.V.kind){case"scalar":for(const[o,a]of i)s[o.toString()]=Lt(n.V.T,a);break;case"message":for(const[o,a]of i)s[o.toString()]=a.toJson(t);break;case"enum":const r=n.V.T;for(const[o,a]of i)s[o.toString()]=ln(r,a,t.enumAsInteger);break}return t.emitDefaultValues||i.length>0?s:void 0}if(n.repeated){F(Array.isArray(e));const s=[];switch(n.kind){case"scalar":for(let i=0;i<e.length;i++)s.push(Lt(n.T,e[i]));break;case"enum":for(let i=0;i<e.length;i++)s.push(ln(n.T,e[i],t.enumAsInteger));break;case"message":for(let i=0;i<e.length;i++)s.push(e[i].toJson(t));break}return t.emitDefaultValues||s.length>0?s:void 0}switch(n.kind){case"scalar":return Lt(n.T,e);case"enum":return ln(n.T,e,t.enumAsInteger);case"message":return nr(n.T,e).toJson(t)}}function ln(n,e,t){var s;if(F(typeof e=="number"),n.typeName=="google.protobuf.NullValue")return null;if(t)return e;const i=n.findNumber(e);return(s=i==null?void 0:i.name)!==null&&s!==void 0?s:e}function Lt(n,e){switch(n){case g.INT32:case g.SFIXED32:case g.SINT32:case g.FIXED32:case g.UINT32:return F(typeof e=="number"),e;case g.FLOAT:case g.DOUBLE:return F(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case g.STRING:return F(typeof e=="string"),e;case g.BOOL:return F(typeof e=="boolean"),e;case g.UINT64:case g.FIXED64:case g.INT64:case g.SFIXED64:case g.SINT64:return F(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case g.BYTES:return F(e instanceof Uint8Array),Qi.enc(e)}}const Ue=Symbol("@bufbuild/protobuf/unknown-fields"),Us={readUnknownFields:!0,readerFactory:n=>new fa(n)},Bs={writeUnknownFields:!0,writerFactory:()=>new ha};function ka(n){return n?Object.assign(Object.assign({},Us),n):Us}function Ra(n){return n?Object.assign(Object.assign({},Bs),n):Bs}function Ca(){return{makeReadOptions:ka,makeWriteOptions:Ra,listUnknownFields(n){var e;return(e=n[Ue])!==null&&e!==void 0?e:[]},discardUnknownFields(n){delete n[Ue]},writeUnknownFields(n,e){const s=n[Ue];if(s)for(const i of s)e.tag(i.no,i.wireType).raw(i.data)},onUnknownField(n,e,t,s){const i=n;Array.isArray(i[Ue])||(i[Ue]=[]),i[Ue].push({no:e,wireType:t,data:s})},readMessage(n,e,t,s,i){const r=n.getType(),o=i?e.len:e.pos+t;let a,l;for(;e.pos<o&&([a,l]=e.tag(),!(i===!0&&l==U.EndGroup));){const u=r.fields.find(a);if(!u){const c=e.skip(l,a);s.readUnknownFields&&this.onUnknownField(n,a,l,c);continue}Vs(n,e,u,l,s)}if(i&&(l!=U.EndGroup||a!==t))throw new Error("invalid end group tag")},readField:Vs,writeMessage(n,e,t){const s=n.getType();for(const i of s.fields.byNumber()){if(!tr(i,n)){if(i.req)throw new Error(`cannot encode field ${s.typeName}.${i.name} to binary: required field not set`);continue}const r=i.oneof?n[i.oneof.localName].value:n[i.localName];Hs(i,r,e,t)}return t.writeUnknownFields&&this.writeUnknownFields(n,e),e},writeField(n,e,t,s){e!==void 0&&Hs(n,e,t,s)}}}function Vs(n,e,t,s,i){let{repeated:r,localName:o}=t;switch(t.oneof&&(n=n[t.oneof.localName],n.case!=o&&delete n.value,n.case=o,o="value"),t.kind){case"scalar":case"enum":const a=t.kind=="enum"?g.INT32:t.T;let l=Vt;if(t.kind=="scalar"&&t.L>0&&(l=va),r){let f=n[o];if(s==U.LengthDelimited&&a!=g.STRING&&a!=g.BYTES){let m=e.uint32()+e.pos;for(;e.pos<m;)f.push(l(e,a))}else f.push(l(e,a))}else n[o]=l(e,a);break;case"message":const u=t.T;r?n[o].push(Mt(e,new u,i,t)):Ie(n[o])?Mt(e,n[o],i,t):(n[o]=Mt(e,new u,i,t),u.fieldWrapper&&!t.oneof&&!t.repeated&&(n[o]=u.fieldWrapper.unwrapField(n[o])));break;case"map":let[c,d]=Aa(t,e,i);n[o][c]=d;break}}function Mt(n,e,t,s){const i=e.getType().runtime.bin,r=s==null?void 0:s.delimited;return i.readMessage(e,n,r?s.no:n.uint32(),t,r),e}function Aa(n,e,t){const s=e.uint32(),i=e.pos+s;let r,o;for(;e.pos<i;){const[a]=e.tag();switch(a){case 1:r=Vt(e,n.K);break;case 2:switch(n.V.kind){case"scalar":o=Vt(e,n.V.T);break;case"enum":o=e.int32();break;case"message":o=Mt(e,new n.V.T,t,void 0);break}break}}if(r===void 0&&(r=je(n.K,Te.BIGINT)),typeof r!="string"&&typeof r!="number"&&(r=r.toString()),o===void 0)switch(n.V.kind){case"scalar":o=je(n.V.T,Te.BIGINT);break;case"enum":o=n.V.T.values[0].no;break;case"message":o=new n.V.T;break}return[r,o]}function va(n,e){const t=Vt(n,e);return typeof t=="bigint"?t.toString():t}function Vt(n,e){switch(e){case g.STRING:return n.string();case g.BOOL:return n.bool();case g.DOUBLE:return n.double();case g.FLOAT:return n.float();case g.INT32:return n.int32();case g.INT64:return n.int64();case g.UINT64:return n.uint64();case g.FIXED64:return n.fixed64();case g.BYTES:return n.bytes();case g.FIXED32:return n.fixed32();case g.SFIXED32:return n.sfixed32();case g.SFIXED64:return n.sfixed64();case g.SINT64:return n.sint64();case g.UINT32:return n.uint32();case g.SINT32:return n.sint32()}}function Hs(n,e,t,s){F(e!==void 0);const i=n.repeated;switch(n.kind){case"scalar":case"enum":let r=n.kind=="enum"?g.INT32:n.T;if(i)if(F(Array.isArray(e)),n.packed)Na(t,r,n.no,e);else for(const o of e)at(t,r,n.no,o);else at(t,r,n.no,e);break;case"message":if(i){F(Array.isArray(e));for(const o of e)Ks(t,s,n,o)}else Ks(t,s,n,e);break;case"map":F(typeof e=="object"&&e!=null);for(const[o,a]of Object.entries(e))Ia(t,s,n,o,a);break}}function Ia(n,e,t,s,i){n.tag(t.no,U.LengthDelimited),n.fork();let r=s;switch(t.K){case g.INT32:case g.FIXED32:case g.UINT32:case g.SFIXED32:case g.SINT32:r=Number.parseInt(s);break;case g.BOOL:F(s=="true"||s=="false"),r=s=="true";break}switch(at(n,t.K,1,r),t.V.kind){case"scalar":at(n,t.V.T,2,i);break;case"enum":at(n,g.INT32,2,i);break;case"message":F(i!==void 0),n.tag(2,U.LengthDelimited).bytes(i.toBinary(e));break}n.join()}function Ks(n,e,t,s){const i=nr(t.T,s);t.delimited?n.tag(t.no,U.StartGroup).raw(i.toBinary(e)).tag(t.no,U.EndGroup):n.tag(t.no,U.LengthDelimited).bytes(i.toBinary(e))}function at(n,e,t,s){F(s!==void 0);let[i,r]=sr(e);n.tag(t,i)[r](s)}function Na(n,e,t,s){if(!s.length)return;n.tag(t,U.LengthDelimited).fork();let[,i]=sr(e);for(let r=0;r<s.length;r++)n[i](s[r]);n.join()}function sr(n){let e=U.Varint;switch(n){case g.BYTES:case g.STRING:e=U.LengthDelimited;break;case g.DOUBLE:case g.FIXED64:case g.SFIXED64:e=U.Bit64;break;case g.FIXED32:case g.SFIXED32:case g.FLOAT:e=U.Bit32;break}const t=g[n].toLowerCase();return[e,t]}function Oa(){return{setEnumType:$i,initPartial(n,e){if(n===void 0)return;const t=e.getType();for(const s of t.fields.byMember()){const i=s.localName,r=e,o=n;if(o[i]!=null)switch(s.kind){case"oneof":const a=o[i].case;if(a===void 0)continue;const l=s.findField(a);let u=o[i].value;l&&l.kind=="message"&&!Ie(u,l.T)?u=new l.T(u):l&&l.kind==="scalar"&&l.T===g.BYTES&&(u=tt(u)),r[i]={case:a,value:u};break;case"scalar":case"enum":let c=o[i];s.T===g.BYTES&&(c=s.repeated?c.map(tt):tt(c)),r[i]=c;break;case"map":switch(s.V.kind){case"scalar":case"enum":if(s.V.T===g.BYTES)for(const[_,m]of Object.entries(o[i]))r[i][_]=tt(m);else Object.assign(r[i],o[i]);break;case"message":const f=s.V.T;for(const _ of Object.keys(o[i])){let m=o[i][_];f.fieldWrapper||(m=new f(m)),r[i][_]=m}break}break;case"message":const d=s.T;if(s.repeated)r[i]=o[i].map(f=>Ie(f,d)?f:new d(f));else{const f=o[i];d.fieldWrapper?d.typeName==="google.protobuf.BytesValue"?r[i]=tt(f):r[i]=f:r[i]=Ie(f,d)?f:new d(f)}break}}},equals(n,e,t){return e===t?!0:!e||!t?!1:n.fields.byMember().every(s=>{const i=e[s.localName],r=t[s.localName];if(s.repeated){if(i.length!==r.length)return!1;switch(s.kind){case"message":return i.every((o,a)=>s.T.equals(o,r[a]));case"scalar":return i.every((o,a)=>fe(s.T,o,r[a]));case"enum":return i.every((o,a)=>fe(g.INT32,o,r[a]))}throw new Error(`repeated cannot contain ${s.kind}`)}switch(s.kind){case"message":return s.T.equals(i,r);case"enum":return fe(g.INT32,i,r);case"scalar":return fe(s.T,i,r);case"oneof":if(i.case!==r.case)return!1;const o=s.findField(i.case);if(o===void 0)return!0;switch(o.kind){case"message":return o.T.equals(i.value,r.value);case"enum":return fe(g.INT32,i.value,r.value);case"scalar":return fe(o.T,i.value,r.value)}throw new Error(`oneof cannot contain ${o.kind}`);case"map":const a=Object.keys(i).concat(Object.keys(r));switch(s.V.kind){case"message":const l=s.V.T;return a.every(c=>l.equals(i[c],r[c]));case"enum":return a.every(c=>fe(g.INT32,i[c],r[c]));case"scalar":const u=s.V.T;return a.every(c=>fe(u,i[c],r[c]))}break}})},clone(n){const e=n.getType(),t=new e,s=t;for(const i of e.fields.byMember()){const r=n[i.localName];let o;if(i.repeated)o=r.map(Ct);else if(i.kind=="map"){o=s[i.localName];for(const[a,l]of Object.entries(r))o[a]=Ct(l)}else i.kind=="oneof"?o=i.findField(r.case)?{case:r.case,value:Ct(r.value)}:{case:void 0}:o=Ct(r);s[i.localName]=o}for(const i of e.runtime.bin.listUnknownFields(n))e.runtime.bin.onUnknownField(s,i.no,i.wireType,i.data);return t}}}function Ct(n){if(n===void 0)return n;if(Ie(n))return n.clone();if(n instanceof Uint8Array){const e=new Uint8Array(n.byteLength);return e.set(n),e}return n}function tt(n){return n instanceof Uint8Array?n:new Uint8Array(n)}function Pa(n,e,t){return{syntax:n,json:Sa(),bin:Ca(),util:Object.assign(Object.assign({},Oa()),{newFieldList:e,initFields:t}),makeMessageType(s,i,r){return oa(this,s,i,r)},makeEnum:ra,makeEnumType:Wi,getEnumType:ia,makeExtension(s,i,r){return ma(this,s,i,r)}}}class La{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const t={};for(const s of this.list())t[s.jsonName]=t[s.name]=s;this.jsonNames=t}return this.jsonNames[e]}find(e){if(!this.numbers){const t={};for(const s of this.list())t[s.no]=s;this.numbers=t}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const s of this.list())s.oneof?s.oneof!==t&&(t=s.oneof,e.push(t)):e.push(s)}return this.members}}function ir(n,e){const t=rr(n);return e?t:Ba(Ua(t))}function Ma(n){return ir(n,!1)}const Da=rr;function rr(n){let e=!1;const t=[];for(let s=0;s<n.length;s++){let i=n.charAt(s);switch(i){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":t.push(i),e=!1;break;default:e&&(e=!1,i=i.toUpperCase()),t.push(i);break}}return t.join("")}const xa=new Set(["constructor","toString","toJSON","valueOf"]),Fa=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),or=n=>`${n}$`,Ua=n=>Fa.has(n)?or(n):n,Ba=n=>xa.has(n)?or(n):n;class Va{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=Ma(e)}addField(e){F(e.oneof===this,`field ${e.name} not one of ${this.name}`),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let t=0;t<this.fields.length;t++)this._lookup[this.fields[t].localName]=this.fields[t]}return this._lookup[e]}}function Ha(n,e){var t,s,i,r,o,a;const l=[];let u;for(const c of typeof n=="function"?n():n){const d=c;if(d.localName=ir(c.name,c.oneof!==void 0),d.jsonName=(t=c.jsonName)!==null&&t!==void 0?t:Da(c.name),d.repeated=(s=c.repeated)!==null&&s!==void 0?s:!1,c.kind=="scalar"&&(d.L=(i=c.L)!==null&&i!==void 0?i:Te.BIGINT),d.delimited=(r=c.delimited)!==null&&r!==void 0?r:!1,d.req=(o=c.req)!==null&&o!==void 0?o:!1,d.opt=(a=c.opt)!==null&&a!==void 0?a:!1,c.packed===void 0&&(e?d.packed=c.kind=="enum"||c.kind=="scalar"&&c.T!=g.BYTES&&c.T!=g.STRING:d.packed=!1),c.oneof!==void 0){const f=typeof c.oneof=="string"?c.oneof:c.oneof.name;(!u||u.name!=f)&&(u=new Va(f)),d.oneof=u,u.addField(d)}l.push(d)}return l}const y=Pa("proto3",n=>new La(n,e=>Ha(e,!0)),n=>{for(const e of n.getType().fields.byMember()){if(e.opt)continue;const t=e.localName,s=n;if(e.repeated){s[t]=[];continue}switch(e.kind){case"oneof":s[t]={case:void 0};break;case"enum":s[t]=0;break;case"map":s[t]={};break;case"scalar":s[t]=je(e.T,e.L);break}}}),Ka=y.makeEnum("livekit.AudioCodec",[{no:0,name:"DEFAULT_AC"},{no:1,name:"OPUS"},{no:2,name:"AAC"}]),qa=y.makeEnum("livekit.VideoCodec",[{no:0,name:"DEFAULT_VC"},{no:1,name:"H264_BASELINE"},{no:2,name:"H264_MAIN"},{no:3,name:"H264_HIGH"},{no:4,name:"VP8"}]),$a=y.makeEnum("livekit.ImageCodec",[{no:0,name:"IC_DEFAULT"},{no:1,name:"IC_JPEG"}]),Wa=y.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Ve=y.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Ja=y.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),ja=y.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"}]),Ga=y.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"}]),On=y.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:za,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:lr}]),za=y.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),Gn=y.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:y.getEnumType(Ve),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Pn=y.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:y.getEnumType(Ya)},{no:4,name:"tracks",kind:"message",T:ar,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:Gn},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:y.getEnumType(Xa)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:y.getEnumType(ja)}]),Ya=y.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Xa=y.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),Qa=y.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),Za=y.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:cr,repeated:!0}]),ar=y.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:y.getEnumType(Wa)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:y.getEnumType(Ve)},{no:10,name:"layers",kind:"message",T:cr,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:Za,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:y.getEnumType(Qa)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:lr},{no:19,name:"audio_features",kind:"enum",T:y.getEnumType(Ga),repeated:!0}]),cr=y.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:y.getEnumType(Ja)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]),ec=y.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),tc=y.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),lr=y.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),nc=y.makeEnum("livekit.EncodedFileType",[{no:0,name:"DEFAULT_FILETYPE"},{no:1,name:"MP4"},{no:2,name:"OGG"}]),sc=y.makeEnum("livekit.SegmentedFileProtocol",[{no:0,name:"DEFAULT_SEGMENTED_FILE_PROTOCOL"},{no:1,name:"HLS_PROTOCOL"}]),ic=y.makeEnum("livekit.SegmentedFileSuffix",[{no:0,name:"INDEX"},{no:1,name:"TIMESTAMP"}]),rc=y.makeEnum("livekit.ImageFileSuffix",[{no:0,name:"IMAGE_SUFFIX_INDEX"},{no:1,name:"IMAGE_SUFFIX_TIMESTAMP"}]),ur=y.makeEnum("livekit.StreamProtocol",[{no:0,name:"DEFAULT_PROTOCOL"},{no:1,name:"RTMP"},{no:2,name:"SRT"}]),pt=y.makeEnum("livekit.EncodingOptionsPreset",[{no:0,name:"H264_720P_30"},{no:1,name:"H264_720P_60"},{no:2,name:"H264_1080P_30"},{no:3,name:"H264_1080P_60"},{no:4,name:"PORTRAIT_H264_720P_30"},{no:5,name:"PORTRAIT_H264_720P_60"},{no:6,name:"PORTRAIT_H264_1080P_30"},{no:7,name:"PORTRAIT_H264_1080P_60"}]),oc=y.makeEnum("livekit.EgressStatus",[{no:0,name:"EGRESS_STARTING"},{no:1,name:"EGRESS_ACTIVE"},{no:2,name:"EGRESS_ENDING"},{no:3,name:"EGRESS_COMPLETE"},{no:4,name:"EGRESS_FAILED"},{no:5,name:"EGRESS_ABORTED"},{no:6,name:"EGRESS_LIMIT_REACHED"}]),zn=y.makeMessageType("livekit.RoomCompositeEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"layout",kind:"scalar",T:9},{no:3,name:"audio_only",kind:"scalar",T:8},{no:4,name:"video_only",kind:"scalar",T:8},{no:5,name:"custom_base_url",kind:"scalar",T:9},{no:6,name:"file",kind:"message",T:Ee,oneof:"output"},{no:7,name:"stream",kind:"message",T:we,oneof:"output"},{no:10,name:"segments",kind:"message",T:Se,oneof:"output"},{no:8,name:"preset",kind:"enum",T:y.getEnumType(pt),oneof:"options"},{no:9,name:"advanced",kind:"message",T:Et,oneof:"options"},{no:11,name:"file_outputs",kind:"message",T:Ee,repeated:!0},{no:12,name:"stream_outputs",kind:"message",T:we,repeated:!0},{no:13,name:"segment_outputs",kind:"message",T:Se,repeated:!0},{no:14,name:"image_outputs",kind:"message",T:zt,repeated:!0}]),dr=y.makeMessageType("livekit.WebEgressRequest",()=>[{no:1,name:"url",kind:"scalar",T:9},{no:2,name:"audio_only",kind:"scalar",T:8},{no:3,name:"video_only",kind:"scalar",T:8},{no:12,name:"await_start_signal",kind:"scalar",T:8},{no:4,name:"file",kind:"message",T:Ee,oneof:"output"},{no:5,name:"stream",kind:"message",T:we,oneof:"output"},{no:6,name:"segments",kind:"message",T:Se,oneof:"output"},{no:7,name:"preset",kind:"enum",T:y.getEnumType(pt),oneof:"options"},{no:8,name:"advanced",kind:"message",T:Et,oneof:"options"},{no:9,name:"file_outputs",kind:"message",T:Ee,repeated:!0},{no:10,name:"stream_outputs",kind:"message",T:we,repeated:!0},{no:11,name:"segment_outputs",kind:"message",T:Se,repeated:!0},{no:13,name:"image_outputs",kind:"message",T:zt,repeated:!0}]),hr=y.makeMessageType("livekit.ParticipantEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"screen_share",kind:"scalar",T:8},{no:4,name:"preset",kind:"enum",T:y.getEnumType(pt),oneof:"options"},{no:5,name:"advanced",kind:"message",T:Et,oneof:"options"},{no:6,name:"file_outputs",kind:"message",T:Ee,repeated:!0},{no:7,name:"stream_outputs",kind:"message",T:we,repeated:!0},{no:8,name:"segment_outputs",kind:"message",T:Se,repeated:!0},{no:9,name:"image_outputs",kind:"message",T:zt,repeated:!0}]),fr=y.makeMessageType("livekit.TrackCompositeEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"audio_track_id",kind:"scalar",T:9},{no:3,name:"video_track_id",kind:"scalar",T:9},{no:4,name:"file",kind:"message",T:Ee,oneof:"output"},{no:5,name:"stream",kind:"message",T:we,oneof:"output"},{no:8,name:"segments",kind:"message",T:Se,oneof:"output"},{no:6,name:"preset",kind:"enum",T:y.getEnumType(pt),oneof:"options"},{no:7,name:"advanced",kind:"message",T:Et,oneof:"options"},{no:11,name:"file_outputs",kind:"message",T:Ee,repeated:!0},{no:12,name:"stream_outputs",kind:"message",T:we,repeated:!0},{no:13,name:"segment_outputs",kind:"message",T:Se,repeated:!0},{no:14,name:"image_outputs",kind:"message",T:zt,repeated:!0}]),mr=y.makeMessageType("livekit.TrackEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"track_id",kind:"scalar",T:9},{no:3,name:"file",kind:"message",T:ac,oneof:"output"},{no:4,name:"websocket_url",kind:"scalar",T:9,oneof:"output"}]),Ee=y.makeMessageType("livekit.EncodedFileOutput",()=>[{no:1,name:"file_type",kind:"enum",T:y.getEnumType(nc)},{no:2,name:"filepath",kind:"scalar",T:9},{no:6,name:"disable_manifest",kind:"scalar",T:8},{no:3,name:"s3",kind:"message",T:gt,oneof:"output"},{no:4,name:"gcp",kind:"message",T:_t,oneof:"output"},{no:5,name:"azure",kind:"message",T:yt,oneof:"output"},{no:7,name:"aliOSS",kind:"message",T:Tt,oneof:"output"}]),Se=y.makeMessageType("livekit.SegmentedFileOutput",()=>[{no:1,name:"protocol",kind:"enum",T:y.getEnumType(sc)},{no:2,name:"filename_prefix",kind:"scalar",T:9},{no:3,name:"playlist_name",kind:"scalar",T:9},{no:11,name:"live_playlist_name",kind:"scalar",T:9},{no:4,name:"segment_duration",kind:"scalar",T:13},{no:10,name:"filename_suffix",kind:"enum",T:y.getEnumType(ic)},{no:8,name:"disable_manifest",kind:"scalar",T:8},{no:5,name:"s3",kind:"message",T:gt,oneof:"output"},{no:6,name:"gcp",kind:"message",T:_t,oneof:"output"},{no:7,name:"azure",kind:"message",T:yt,oneof:"output"},{no:9,name:"aliOSS",kind:"message",T:Tt,oneof:"output"}]),ac=y.makeMessageType("livekit.DirectFileOutput",()=>[{no:1,name:"filepath",kind:"scalar",T:9},{no:5,name:"disable_manifest",kind:"scalar",T:8},{no:2,name:"s3",kind:"message",T:gt,oneof:"output"},{no:3,name:"gcp",kind:"message",T:_t,oneof:"output"},{no:4,name:"azure",kind:"message",T:yt,oneof:"output"},{no:6,name:"aliOSS",kind:"message",T:Tt,oneof:"output"}]),zt=y.makeMessageType("livekit.ImageOutput",()=>[{no:1,name:"capture_interval",kind:"scalar",T:13},{no:2,name:"width",kind:"scalar",T:5},{no:3,name:"height",kind:"scalar",T:5},{no:4,name:"filename_prefix",kind:"scalar",T:9},{no:5,name:"filename_suffix",kind:"enum",T:y.getEnumType(rc)},{no:6,name:"image_codec",kind:"enum",T:y.getEnumType($a)},{no:7,name:"disable_manifest",kind:"scalar",T:8},{no:8,name:"s3",kind:"message",T:gt,oneof:"output"},{no:9,name:"gcp",kind:"message",T:_t,oneof:"output"},{no:10,name:"azure",kind:"message",T:yt,oneof:"output"},{no:11,name:"aliOSS",kind:"message",T:Tt,oneof:"output"}]),gt=y.makeMessageType("livekit.S3Upload",()=>[{no:1,name:"access_key",kind:"scalar",T:9},{no:2,name:"secret",kind:"scalar",T:9},{no:11,name:"session_token",kind:"scalar",T:9},{no:3,name:"region",kind:"scalar",T:9},{no:4,name:"endpoint",kind:"scalar",T:9},{no:5,name:"bucket",kind:"scalar",T:9},{no:6,name:"force_path_style",kind:"scalar",T:8},{no:7,name:"metadata",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:8,name:"tagging",kind:"scalar",T:9},{no:9,name:"content_disposition",kind:"scalar",T:9},{no:10,name:"proxy",kind:"message",T:pr}]),_t=y.makeMessageType("livekit.GCPUpload",()=>[{no:1,name:"credentials",kind:"scalar",T:9},{no:2,name:"bucket",kind:"scalar",T:9},{no:3,name:"proxy",kind:"message",T:pr}]),yt=y.makeMessageType("livekit.AzureBlobUpload",()=>[{no:1,name:"account_name",kind:"scalar",T:9},{no:2,name:"account_key",kind:"scalar",T:9},{no:3,name:"container_name",kind:"scalar",T:9}]),Tt=y.makeMessageType("livekit.AliOSSUpload",()=>[{no:1,name:"access_key",kind:"scalar",T:9},{no:2,name:"secret",kind:"scalar",T:9},{no:3,name:"region",kind:"scalar",T:9},{no:4,name:"endpoint",kind:"scalar",T:9},{no:5,name:"bucket",kind:"scalar",T:9}]),pr=y.makeMessageType("livekit.ProxyConfig",()=>[{no:1,name:"url",kind:"scalar",T:9},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"password",kind:"scalar",T:9}]),we=y.makeMessageType("livekit.StreamOutput",()=>[{no:1,name:"protocol",kind:"enum",T:y.getEnumType(ur)},{no:2,name:"urls",kind:"scalar",T:9,repeated:!0}]),Et=y.makeMessageType("livekit.EncodingOptions",()=>[{no:1,name:"width",kind:"scalar",T:5},{no:2,name:"height",kind:"scalar",T:5},{no:3,name:"depth",kind:"scalar",T:5},{no:4,name:"framerate",kind:"scalar",T:5},{no:5,name:"audio_codec",kind:"enum",T:y.getEnumType(Ka)},{no:6,name:"audio_bitrate",kind:"scalar",T:5},{no:11,name:"audio_quality",kind:"scalar",T:5},{no:7,name:"audio_frequency",kind:"scalar",T:5},{no:8,name:"video_codec",kind:"enum",T:y.getEnumType(qa)},{no:9,name:"video_bitrate",kind:"scalar",T:5},{no:12,name:"video_quality",kind:"scalar",T:5},{no:10,name:"key_frame_interval",kind:"scalar",T:1}]),cc=y.makeMessageType("livekit.UpdateLayoutRequest",()=>[{no:1,name:"egress_id",kind:"scalar",T:9},{no:2,name:"layout",kind:"scalar",T:9}]),lc=y.makeMessageType("livekit.UpdateStreamRequest",()=>[{no:1,name:"egress_id",kind:"scalar",T:9},{no:2,name:"add_output_urls",kind:"scalar",T:9,repeated:!0},{no:3,name:"remove_output_urls",kind:"scalar",T:9,repeated:!0}]),uc=y.makeMessageType("livekit.ListEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"egress_id",kind:"scalar",T:9},{no:3,name:"active",kind:"scalar",T:8}]),dc=y.makeMessageType("livekit.ListEgressResponse",()=>[{no:1,name:"items",kind:"message",T:ae,repeated:!0}]),hc=y.makeMessageType("livekit.StopEgressRequest",()=>[{no:1,name:"egress_id",kind:"scalar",T:9}]),ae=y.makeMessageType("livekit.EgressInfo",()=>[{no:1,name:"egress_id",kind:"scalar",T:9},{no:2,name:"room_id",kind:"scalar",T:9},{no:13,name:"room_name",kind:"scalar",T:9},{no:3,name:"status",kind:"enum",T:y.getEnumType(oc)},{no:10,name:"started_at",kind:"scalar",T:3},{no:11,name:"ended_at",kind:"scalar",T:3},{no:18,name:"updated_at",kind:"scalar",T:3},{no:21,name:"details",kind:"scalar",T:9},{no:9,name:"error",kind:"scalar",T:9},{no:22,name:"error_code",kind:"scalar",T:5},{no:4,name:"room_composite",kind:"message",T:zn,oneof:"request"},{no:14,name:"web",kind:"message",T:dr,oneof:"request"},{no:19,name:"participant",kind:"message",T:hr,oneof:"request"},{no:5,name:"track_composite",kind:"message",T:fr,oneof:"request"},{no:6,name:"track",kind:"message",T:mr,oneof:"request"},{no:7,name:"stream",kind:"message",T:fc,oneof:"result"},{no:8,name:"file",kind:"message",T:qs,oneof:"result"},{no:12,name:"segments",kind:"message",T:$s,oneof:"result"},{no:15,name:"stream_results",kind:"message",T:gr,repeated:!0},{no:16,name:"file_results",kind:"message",T:qs,repeated:!0},{no:17,name:"segment_results",kind:"message",T:$s,repeated:!0},{no:20,name:"image_results",kind:"message",T:pc,repeated:!0}]),fc=y.makeMessageType("livekit.StreamInfoList",()=>[{no:1,name:"info",kind:"message",T:gr,repeated:!0}]),gr=y.makeMessageType("livekit.StreamInfo",()=>[{no:1,name:"url",kind:"scalar",T:9},{no:2,name:"started_at",kind:"scalar",T:3},{no:3,name:"ended_at",kind:"scalar",T:3},{no:4,name:"duration",kind:"scalar",T:3},{no:5,name:"status",kind:"enum",T:y.getEnumType(mc)},{no:6,name:"error",kind:"scalar",T:9}]),mc=y.makeEnum("livekit.StreamInfo.Status",[{no:0,name:"ACTIVE"},{no:1,name:"FINISHED"},{no:2,name:"FAILED"}]),qs=y.makeMessageType("livekit.FileInfo",()=>[{no:1,name:"filename",kind:"scalar",T:9},{no:2,name:"started_at",kind:"scalar",T:3},{no:3,name:"ended_at",kind:"scalar",T:3},{no:6,name:"duration",kind:"scalar",T:3},{no:4,name:"size",kind:"scalar",T:3},{no:5,name:"location",kind:"scalar",T:9}]),$s=y.makeMessageType("livekit.SegmentsInfo",()=>[{no:1,name:"playlist_name",kind:"scalar",T:9},{no:8,name:"live_playlist_name",kind:"scalar",T:9},{no:2,name:"duration",kind:"scalar",T:3},{no:3,name:"size",kind:"scalar",T:3},{no:4,name:"playlist_location",kind:"scalar",T:9},{no:9,name:"live_playlist_location",kind:"scalar",T:9},{no:5,name:"segment_count",kind:"scalar",T:3},{no:6,name:"started_at",kind:"scalar",T:3},{no:7,name:"ended_at",kind:"scalar",T:3}]),pc=y.makeMessageType("livekit.ImagesInfo",()=>[{no:4,name:"filename_prefix",kind:"scalar",T:9},{no:1,name:"image_count",kind:"scalar",T:3},{no:2,name:"started_at",kind:"scalar",T:3},{no:3,name:"ended_at",kind:"scalar",T:3}]),gc=y.makeMessageType("livekit.AutoParticipantEgress",()=>[{no:1,name:"preset",kind:"enum",T:y.getEnumType(pt),oneof:"options"},{no:2,name:"advanced",kind:"message",T:Et,oneof:"options"},{no:3,name:"file_outputs",kind:"message",T:Ee,repeated:!0},{no:4,name:"segment_outputs",kind:"message",T:Se,repeated:!0}]),_c=y.makeMessageType("livekit.AutoTrackEgress",()=>[{no:1,name:"filepath",kind:"scalar",T:9},{no:5,name:"disable_manifest",kind:"scalar",T:8},{no:2,name:"s3",kind:"message",T:gt,oneof:"output"},{no:3,name:"gcp",kind:"message",T:_t,oneof:"output"},{no:4,name:"azure",kind:"message",T:yt,oneof:"output"},{no:6,name:"aliOSS",kind:"message",T:Tt,oneof:"output"}]),yc=y.makeMessageType("livekit.RoomAgentDispatch",()=>[{no:1,name:"agent_name",kind:"scalar",T:9},{no:2,name:"metadata",kind:"scalar",T:9}]),Tc=y.makeMessageType("livekit.CreateRoomRequest",()=>[{no:1,name:"name",kind:"scalar",T:9},{no:12,name:"config_name",kind:"scalar",T:9},{no:2,name:"empty_timeout",kind:"scalar",T:13},{no:10,name:"departure_timeout",kind:"scalar",T:13},{no:3,name:"max_participants",kind:"scalar",T:13},{no:4,name:"node_id",kind:"scalar",T:9},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"egress",kind:"message",T:Ec},{no:11,name:"agent",kind:"message",T:Sc},{no:7,name:"min_playout_delay",kind:"scalar",T:13},{no:8,name:"max_playout_delay",kind:"scalar",T:13},{no:9,name:"sync_streams",kind:"scalar",T:8},{no:13,name:"replay_enabled",kind:"scalar",T:8}]),Ec=y.makeMessageType("livekit.RoomEgress",()=>[{no:1,name:"room",kind:"message",T:zn},{no:3,name:"participant",kind:"message",T:gc},{no:2,name:"tracks",kind:"message",T:_c}]),Sc=y.makeMessageType("livekit.RoomAgent",()=>[{no:1,name:"dispatches",kind:"message",T:yc,repeated:!0}]),wc=y.makeMessageType("livekit.ListRoomsRequest",()=>[{no:1,name:"names",kind:"scalar",T:9,repeated:!0}]),bc=y.makeMessageType("livekit.ListRoomsResponse",()=>[{no:1,name:"rooms",kind:"message",T:On,repeated:!0}]),kc=y.makeMessageType("livekit.DeleteRoomRequest",()=>[{no:1,name:"room",kind:"scalar",T:9}]),Rc=y.makeMessageType("livekit.ListParticipantsRequest",()=>[{no:1,name:"room",kind:"scalar",T:9}]),Cc=y.makeMessageType("livekit.ListParticipantsResponse",()=>[{no:1,name:"participants",kind:"message",T:Pn,repeated:!0}]),Ws=y.makeMessageType("livekit.RoomParticipantIdentity",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9}]),Ac=y.makeMessageType("livekit.MuteRoomTrackRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"track_sid",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8}]),vc=y.makeMessageType("livekit.MuteRoomTrackResponse",()=>[{no:1,name:"track",kind:"message",T:ar}]),Ic=y.makeMessageType("livekit.UpdateParticipantRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"permission",kind:"message",T:Gn},{no:5,name:"name",kind:"scalar",T:9},{no:6,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}]),Nc=y.makeMessageType("livekit.UpdateSubscriptionsRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"subscribe",kind:"scalar",T:8},{no:5,name:"participant_tracks",kind:"message",T:tc,repeated:!0}]),Oc=y.makeMessageType("livekit.SendDataRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"data",kind:"scalar",T:12},{no:3,name:"kind",kind:"enum",T:y.getEnumType(ec)},{no:4,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:5,name:"topic",kind:"scalar",T:9,opt:!0}]),Pc=y.makeMessageType("livekit.UpdateRoomMetadataRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"metadata",kind:"scalar",T:9}]),Yn=crypto,_r=n=>n instanceof CryptoKey,He=new TextEncoder,Ln=new TextDecoder;function Lc(...n){const e=n.reduce((i,{length:r})=>i+r,0),t=new Uint8Array(e);let s=0;for(const i of n)t.set(i,s),s+=i.length;return t}const Mc=n=>{let e=n;typeof e=="string"&&(e=He.encode(e));const t=32768,s=[];for(let i=0;i<e.length;i+=t)s.push(String.fromCharCode.apply(null,e.subarray(i,i+t)));return btoa(s.join(""))},un=n=>Mc(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),Dc=n=>{const e=atob(n),t=new Uint8Array(e.length);for(let s=0;s<e.length;s++)t[s]=e.charCodeAt(s);return t},xc=n=>{let e=n;e instanceof Uint8Array&&(e=Ln.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Dc(e)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class Xn extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(t=Error.captureStackTrace)==null||t.call(Error,this,this.constructor)}}class Ke extends Xn{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}}class nt extends Xn{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}}class Fc extends Xn{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}}function ie(n,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${n}`)}function At(n,e){return n.name===e}function dn(n){return parseInt(n.name.slice(4),10)}function Uc(n){switch(n){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function Bc(n,e){if(e.length&&!e.some(t=>n.usages.includes(t))){let t="CryptoKey does not support this operation, its usages must include ";if(e.length>2){const s=e.pop();t+=`one of ${e.join(", ")}, or ${s}.`}else e.length===2?t+=`one of ${e[0]} or ${e[1]}.`:t+=`${e[0]}.`;throw new TypeError(t)}}function Vc(n,e,...t){switch(e){case"HS256":case"HS384":case"HS512":{if(!At(n.algorithm,"HMAC"))throw ie("HMAC");const s=parseInt(e.slice(2),10);if(dn(n.algorithm.hash)!==s)throw ie(`SHA-${s}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!At(n.algorithm,"RSASSA-PKCS1-v1_5"))throw ie("RSASSA-PKCS1-v1_5");const s=parseInt(e.slice(2),10);if(dn(n.algorithm.hash)!==s)throw ie(`SHA-${s}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!At(n.algorithm,"RSA-PSS"))throw ie("RSA-PSS");const s=parseInt(e.slice(2),10);if(dn(n.algorithm.hash)!==s)throw ie(`SHA-${s}`,"algorithm.hash");break}case"EdDSA":{if(n.algorithm.name!=="Ed25519"&&n.algorithm.name!=="Ed448")throw ie("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!At(n.algorithm,"ECDSA"))throw ie("ECDSA");const s=Uc(e);if(n.algorithm.namedCurve!==s)throw ie(s,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Bc(n,t)}function yr(n,e,...t){var s;if(t.length>2){const i=t.pop();n+=`one of type ${t.join(", ")}, or ${i}.`}else t.length===2?n+=`one of type ${t[0]} or ${t[1]}.`:n+=`of type ${t[0]}.`;return e==null?n+=` Received ${e}`:typeof e=="function"&&e.name?n+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&(s=e.constructor)!=null&&s.name&&(n+=` Received an instance of ${e.constructor.name}`),n}const Js=(n,...e)=>yr("Key must be ",n,...e);function Tr(n,e,...t){return yr(`Key for the ${n} algorithm must be `,e,...t)}const Er=n=>_r(n)?!0:(n==null?void 0:n[Symbol.toStringTag])==="KeyObject",Ht=["CryptoKey"],Hc=(...n)=>{const e=n.filter(Boolean);if(e.length===0||e.length===1)return!0;let t;for(const s of e){const i=Object.keys(s);if(!t||t.size===0){t=new Set(i);continue}for(const r of i){if(t.has(r))return!1;t.add(r)}}return!0},Kc=Hc;function qc(n){return typeof n=="object"&&n!==null}function $c(n){if(!qc(n)||Object.prototype.toString.call(n)!=="[object Object]")return!1;if(Object.getPrototypeOf(n)===null)return!0;let e=n;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(n)===e}const Wc=(n,e)=>{if(n.startsWith("RS")||n.startsWith("PS")){const{modulusLength:t}=e.algorithm;if(typeof t!="number"||t<2048)throw new TypeError(`${n} requires key modulusLength to be 2048 bits or larger`)}};function Jc(n){let e,t;switch(n.kty){case"RSA":{switch(n.alg){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${n.alg.slice(-3)}`},t=n.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${n.alg.slice(-3)}`},t=n.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(n.alg.slice(-3),10)||1}`},t=n.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new Ke('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(n.alg){case"ES256":e={name:"ECDSA",namedCurve:"P-256"},t=n.d?["sign"]:["verify"];break;case"ES384":e={name:"ECDSA",namedCurve:"P-384"},t=n.d?["sign"]:["verify"];break;case"ES512":e={name:"ECDSA",namedCurve:"P-521"},t=n.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:"ECDH",namedCurve:n.crv},t=n.d?["deriveBits"]:[];break;default:throw new Ke('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(n.alg){case"EdDSA":e={name:n.crv},t=n.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:n.crv},t=n.d?["deriveBits"]:[];break;default:throw new Ke('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new Ke('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:e,keyUsages:t}}const jc=async n=>{if(!n.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:e,keyUsages:t}=Jc(n),s=[e,n.ext??!1,n.key_ops??t],i={...n};return delete i.alg,delete i.use,Yn.subtle.importKey("jwk",i,...s)},Gc=jc,Sr=n=>xc(n);let hn,fn;const wr=n=>(n==null?void 0:n[Symbol.toStringTag])==="KeyObject",br=async(n,e,t,s)=>{let i=n.get(e);if(i!=null&&i[s])return i[s];const r=await Gc({...t,alg:s});return i?i[s]=r:n.set(e,{[s]:r}),r},zc=(n,e)=>{if(wr(n)){let t=n.export({format:"jwk"});return delete t.d,delete t.dp,delete t.dq,delete t.p,delete t.q,delete t.qi,t.k?Sr(t.k):(fn||(fn=new WeakMap),br(fn,n,t,e))}return n},Yc=(n,e)=>{if(wr(n)){let t=n.export({format:"jwk"});return t.k?Sr(t.k):(hn||(hn=new WeakMap),br(hn,n,t,e))}return n},js={normalizePublicKey:zc,normalizePrivateKey:Yc},Be=n=>n==null?void 0:n[Symbol.toStringTag],Xc=(n,e)=>{if(!(e instanceof Uint8Array)){if(!Er(e))throw new TypeError(Tr(n,e,...Ht,"Uint8Array"));if(e.type!=="secret")throw new TypeError(`${Be(e)} instances for symmetric algorithms must be of type "secret"`)}},Qc=(n,e,t)=>{if(!Er(e))throw new TypeError(Tr(n,e,...Ht));if(e.type==="secret")throw new TypeError(`${Be(e)} instances for asymmetric algorithms must not be of type "secret"`);if(t==="sign"&&e.type==="public")throw new TypeError(`${Be(e)} instances for asymmetric algorithm signing must be of type "private"`);if(t==="decrypt"&&e.type==="public")throw new TypeError(`${Be(e)} instances for asymmetric algorithm decryption must be of type "private"`);if(e.algorithm&&t==="verify"&&e.type==="private")throw new TypeError(`${Be(e)} instances for asymmetric algorithm verifying must be of type "public"`);if(e.algorithm&&t==="encrypt"&&e.type==="private")throw new TypeError(`${Be(e)} instances for asymmetric algorithm encryption must be of type "public"`)},Zc=(n,e,t)=>{n.startsWith("HS")||n==="dir"||n.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(n)?Xc(n,e):Qc(n,e,t)},el=Zc;function tl(n,e,t,s,i){if(i.crit!==void 0&&(s==null?void 0:s.crit)===void 0)throw new n('"crit" (Critical) Header Parameter MUST be integrity protected');if(!s||s.crit===void 0)return new Set;if(!Array.isArray(s.crit)||s.crit.length===0||s.crit.some(o=>typeof o!="string"||o.length===0))throw new n('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let r;t!==void 0?r=new Map([...Object.entries(t),...e.entries()]):r=e;for(const o of s.crit){if(!r.has(o))throw new Ke(`Extension Header Parameter "${o}" is not recognized`);if(i[o]===void 0)throw new n(`Extension Header Parameter "${o}" is missing`);if(r.get(o)&&s[o]===void 0)throw new n(`Extension Header Parameter "${o}" MUST be integrity protected`)}return new Set(s.crit)}function nl(n,e){const t=`SHA-${n.slice(-3)}`;switch(n){case"HS256":case"HS384":case"HS512":return{hash:t,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:t,name:"RSA-PSS",saltLength:n.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:t,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:t,name:"ECDSA",namedCurve:e.namedCurve};case"EdDSA":return{name:e.name};default:throw new Ke(`alg ${n} is not supported either by JOSE or your javascript runtime`)}}async function sl(n,e,t){if(t==="sign"&&(e=await js.normalizePrivateKey(e,n)),t==="verify"&&(e=await js.normalizePublicKey(e,n)),_r(e))return Vc(e,n,t),e;if(e instanceof Uint8Array){if(!n.startsWith("HS"))throw new TypeError(Js(e,...Ht));return Yn.subtle.importKey("raw",e,{hash:`SHA-${n.slice(-3)}`,name:"HMAC"},!1,[t])}throw new TypeError(Js(e,...Ht,"Uint8Array"))}const Ce=n=>Math.floor(n.getTime()/1e3),kr=60,Rr=kr*60,Qn=Rr*24,il=Qn*7,rl=Qn*365.25,ol=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,mn=n=>{const e=ol.exec(n);if(!e||e[4]&&e[1])throw new TypeError("Invalid time period format");const t=parseFloat(e[2]),s=e[3].toLowerCase();let i;switch(s){case"sec":case"secs":case"second":case"seconds":case"s":i=Math.round(t);break;case"minute":case"minutes":case"min":case"mins":case"m":i=Math.round(t*kr);break;case"hour":case"hours":case"hr":case"hrs":case"h":i=Math.round(t*Rr);break;case"day":case"days":case"d":i=Math.round(t*Qn);break;case"week":case"weeks":case"w":i=Math.round(t*il);break;default:i=Math.round(t*rl);break}return e[1]==="-"||e[4]==="ago"?-i:i},al=async(n,e,t)=>{const s=await sl(n,e,"sign");Wc(n,s);const i=await Yn.subtle.sign(nl(n,s.algorithm),s,t);return new Uint8Array(i)},cl=al;class ll{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){if(!this._protectedHeader&&!this._unprotectedHeader)throw new nt("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!Kc(this._protectedHeader,this._unprotectedHeader))throw new nt("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const s={...this._protectedHeader,...this._unprotectedHeader},i=tl(nt,new Map([["b64",!0]]),t==null?void 0:t.crit,this._protectedHeader,s);let r=!0;if(i.has("b64")&&(r=this._protectedHeader.b64,typeof r!="boolean"))throw new nt('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:o}=s;if(typeof o!="string"||!o)throw new nt('JWS "alg" (Algorithm) Header Parameter missing or invalid');el(o,e,"sign");let a=this._payload;r&&(a=He.encode(un(a)));let l;this._protectedHeader?l=He.encode(un(JSON.stringify(this._protectedHeader))):l=He.encode("");const u=Lc(l,He.encode("."),a),c=await cl(o,e,u),d={signature:un(c),payload:""};return r&&(d.payload=Ln.decode(a)),this._unprotectedHeader&&(d.header=this._unprotectedHeader),this._protectedHeader&&(d.protected=Ln.decode(l)),d}}class ul{constructor(e){this._flattened=new ll(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){const s=await this._flattened.sign(e,t);if(s.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${s.protected}.${s.payload}.${s.signature}`}}function Ae(n,e){if(!Number.isFinite(e))throw new TypeError(`Invalid ${n} input`);return e}class dl{constructor(e={}){if(!$c(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return typeof e=="number"?this._payload={...this._payload,nbf:Ae("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:Ae("setNotBefore",Ce(e))}:this._payload={...this._payload,nbf:Ce(new Date)+mn(e)},this}setExpirationTime(e){return typeof e=="number"?this._payload={...this._payload,exp:Ae("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:Ae("setExpirationTime",Ce(e))}:this._payload={...this._payload,exp:Ce(new Date)+mn(e)},this}setIssuedAt(e){return typeof e>"u"?this._payload={...this._payload,iat:Ce(new Date)}:e instanceof Date?this._payload={...this._payload,iat:Ae("setIssuedAt",Ce(e))}:typeof e=="string"?this._payload={...this._payload,iat:Ae("setIssuedAt",Ce(new Date)+mn(e))}:this._payload={...this._payload,iat:Ae("setIssuedAt",e)},this}}class hl extends dl{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){var i;const s=new ul(He.encode(JSON.stringify(this._payload)));if(s.setProtectedHeader(this._protectedHeader),Array.isArray((i=this._protectedHeader)==null?void 0:i.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new Fc("JWTs MUST NOT use unencoded payload");return s.sign(e,t)}}function fl(n){switch(n){case Ve.CAMERA:return"camera";case Ve.MICROPHONE:return"microphone";case Ve.SCREEN_SHARE:return"screen_share";case Ve.SCREEN_SHARE_AUDIO:return"screen_share_audio";default:throw new TypeError(`Cannot convert TrackSource ${n} to string`)}}function ml(n){var e;const t=Object.assign({},n);return Array.isArray((e=t.video)===null||e===void 0?void 0:e.canPublishSources)&&(t.video.canPublishSources=t.video.canPublishSources.map(fl)),t}const pl="6h";class Cr{constructor(e,t,s){if(e||(e={}.LIVEKIT_API_KEY),t||(t={}.LIVEKIT_API_SECRET),!e||!t)throw Error("api-key and api-secret must be set");typeof document<"u"&&console.error(`You should not include your API secret in your web client bundle.

Your web client should request a token from your backend server which should then use the API secret to generate a token. See https://docs.livekit.io/client/connect/`),this.apiKey=e,this.apiSecret=t,this.grants={},this.identity=s==null?void 0:s.identity,this.ttl=(s==null?void 0:s.ttl)||pl,typeof this.ttl=="number"&&(this.ttl=`${this.ttl}s`),s!=null&&s.metadata&&(this.metadata=s.metadata),s!=null&&s.name&&(this.name=s.name)}addGrant(e){var t;this.grants.video=Object.assign(Object.assign({},(t=this.grants.video)!==null&&t!==void 0?t:{}),e)}addSIPGrant(e){var t;this.grants.sip=Object.assign(Object.assign({},(t=this.grants.sip)!==null&&t!==void 0?t:{}),e)}get name(){return this.grants.name}set name(e){this.grants.name=e}get metadata(){return this.grants.metadata}set metadata(e){this.grants.metadata=e}get attributes(){return this.grants.attributes}set attributes(e){this.grants.attributes=e}get kind(){return this.grants.kind}set kind(e){this.grants.kind=e}get sha256(){return this.grants.sha256}set sha256(e){this.grants.sha256=e}async toJwt(){var e;const t=new TextEncoder().encode(this.apiSecret),s=new hl(ml(this.grants)).setProtectedHeader({alg:"HS256"}).setIssuer(this.apiKey).setExpirationTime(this.ttl).setNotBefore(0);if(this.identity)s.setSubject(this.identity);else if(!((e=this.grants.video)===null||e===void 0)&&e.roomJoin)throw Error("identity is required for join but not set");return s.sign(t)}}class Ar{constructor(e,t,s){this.apiKey=e,this.secret=t,this.ttl=s||"10m"}async authHeader(e,t){const s=new Cr(this.apiKey,this.secret,{ttl:this.ttl});return s.addGrant(e),t&&s.addSIPGrant(t),{Authorization:`Bearer ${await s.toJwt()}`}}}const vr=n=>typeof n=="object"&&n!==null,Gs=n=>vr(n)&&!(n instanceof RegExp)&&!(n instanceof Error)&&!(n instanceof Date),gl=Symbol("mapObjectSkip"),Mn=(n,e,t,s=new WeakMap)=>{if(t={deep:!1,target:{},...t},s.has(n))return s.get(n);s.set(n,t.target);const{target:i}=t;delete t.target;const r=o=>o.map(a=>Gs(a)?Mn(a,e,t,s):a);if(Array.isArray(n))return r(n);for(const[o,a]of Object.entries(n)){const l=e(o,a,n);if(l===gl)continue;let[u,c,{shouldRecurse:d=!0}={}]=l;u!=="__proto__"&&(t.deep&&d&&Gs(c)&&(c=Array.isArray(c)?r(c):Mn(c,e,t,s)),i[u]=c)}return i};function zs(n,e,t){if(!vr(n))throw new TypeError(`Expected an object, got \`${n}\` (${typeof n})`);return Mn(n,e,t)}const _l=/[\p{Lu}]/u,yl=/[\p{Ll}]/u,Ys=/^[\p{Lu}](?![\p{Lu}])/gu,Ir=/([\p{Alpha}\p{N}_]|$)/u,Zn=/[_.\- ]+/,Tl=new RegExp("^"+Zn.source),Xs=new RegExp(Zn.source+Ir.source,"gu"),Qs=new RegExp("\\d+"+Ir.source,"gu"),El=(n,e,t,s)=>{let i=!1,r=!1,o=!1,a=!1;for(let l=0;l<n.length;l++){const u=n[l];a=l>2?n[l-3]==="-":!0,i&&_l.test(u)?(n=n.slice(0,l)+"-"+n.slice(l),i=!1,o=r,r=!0,l++):r&&o&&yl.test(u)&&(!a||s)?(n=n.slice(0,l-1)+"-"+n.slice(l-1),o=r,r=!1,i=!0):(i=e(u)===u&&t(u)!==u,o=r,r=t(u)===u&&e(u)!==u)}return n},Sl=(n,e)=>(Ys.lastIndex=0,n.replaceAll(Ys,t=>e(t))),wl=(n,e)=>(Xs.lastIndex=0,Qs.lastIndex=0,n.replaceAll(Qs,(t,s,i)=>["_","-"].includes(n.charAt(i+t.length))?t:e(t)).replaceAll(Xs,(t,s)=>e(s)));function bl(n,e){if(!(typeof n=="string"||Array.isArray(n)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(n)?n=n.map(r=>r.trim()).filter(r=>r.length).join("-"):n=n.trim(),n.length===0)return"";const t=e.locale===!1?r=>r.toLowerCase():r=>r.toLocaleLowerCase(e.locale),s=e.locale===!1?r=>r.toUpperCase():r=>r.toLocaleUpperCase(e.locale);return n.length===1?Zn.test(n)?"":e.pascalCase?s(n):t(n):(n!==t(n)&&(n=El(n,t,s,e.preserveConsecutiveUppercase)),n=n.replace(Tl,""),n=e.preserveConsecutiveUppercase?Sl(n,t):t(n),e.pascalCase&&(n=s(n.charAt(0))+n.slice(1)),wl(n,s))}class kl extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[t,s]of e)this.onEviction(t,s.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const s=t.get(e);return this._getItemValue(e,s)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,s]=e;this.cache.has(t)||this._deleteIfExpired(t,s)===!1&&(yield e)}for(const e of this.cache){const[t,s]=e;this._deleteIfExpired(t,s)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:s=this.maxAge}={}){const i=typeof s=="number"&&s!==Number.POSITIVE_INFINITY?Date.now()+s:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:i}):this._set(e,{value:t,expiry:i}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],s=t.length-e;s<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(s>0&&this._emitEvictions(t.slice(0,s)),this.oldCache=new Map(t.slice(s)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,s]=e;this._deleteIfExpired(t,s)===!1&&(yield[t,s.value])}for(const e of this.oldCache){const[t,s]=e;this.cache.has(t)||this._deleteIfExpired(t,s)===!1&&(yield[t,s.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const s=e[t],[i,r]=s;this._deleteIfExpired(i,r)===!1&&(yield[i,r.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const s=e[t],[i,r]=s;this.cache.has(i)||this._deleteIfExpired(i,r)===!1&&(yield[i,r.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[s,i]of this.entriesAscending())e.call(t,i,s,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}const Rl=(n,e)=>n.some(t=>typeof t=="string"?t===e:(t.lastIndex=0,t.test(e))),pn=new kl({maxSize:1e5}),Zs=n=>typeof n=="object"&&n!==null&&!(n instanceof RegExp)&&!(n instanceof Error)&&!(n instanceof Date),ei=(n,e={})=>{if(!Zs(n))return n;const{exclude:t,pascalCase:s=!1,stopPaths:i,deep:r=!1,preserveConsecutiveUppercase:o=!1}=e,a=new Set(i),l=u=>(c,d)=>{if(r&&Zs(d)){const f=u===void 0?c:`${u}.${c}`;a.has(f)||(d=zs(d,l(f)))}if(!(t&&Rl(t,c))){const f=s?`${c}_`:c;if(pn.has(f))c=pn.get(f);else{const _=bl(c,{pascalCase:s,locale:!1,preserveConsecutiveUppercase:o});c.length<100&&pn.set(f,_),c=_}}return[c,d]};return zs(n,l(void 0))};function Cl(n,e){return Array.isArray(n)?Object.keys(n).map(t=>ei(n[t],e)):ei(n,e)}const Al="/twirp",Nr="livekit";class Or{constructor(e,t,s){e.startsWith("ws")&&(e=e.replace("ws","http")),this.host=e,this.pkg=t,this.prefix=s||Al}async request(e,t,s,i){const r=`${this.prefix}/${this.pkg}.${e}/${t}`,o=new URL(r,this.host),a=await fetch(o,{method:"POST",headers:Object.assign({"Content-Type":"application/json;charset=UTF-8"},i),body:JSON.stringify(s)});if(!a.ok)throw new Error(`Request failed with status ${a.status}: ${a.statusText}`);const l=await a.json();return Cl(l,{deep:!0})}}const re="Egress";class Pr extends Ar{constructor(e,t,s){super(t,s),this.rpc=new Or(e,Nr)}async startRoomCompositeEgress(e,t,s,i,r,o,a){let l;if(s!==void 0)if(typeof s=="string")l=s;else{const S=s;l=S.layout,i=S.encodingOptions,r=S.audioOnly,o=S.videoOnly,a=S.customBaseUrl}l??(l=""),r??(r=!1),o??(o=!1),a??(a="");const{output:u,options:c,fileOutputs:d,streamOutputs:f,segmentOutputs:_,imageOutputs:m}=this.getOutputParams(t,i),T=new zn({roomName:e,layout:l,audioOnly:r,videoOnly:o,customBaseUrl:a,output:u,options:c,fileOutputs:d,streamOutputs:f,segmentOutputs:_,imageOutputs:m}).toJson(),p=await this.rpc.request(re,"StartRoomCompositeEgress",T,await this.authHeader({roomRecord:!0}));return ae.fromJson(p,{ignoreUnknownFields:!0})}async startWebEgress(e,t,s){const i=(s==null?void 0:s.audioOnly)||!1,r=(s==null?void 0:s.videoOnly)||!1,o=(s==null?void 0:s.awaitStartSignal)||!1,{output:a,options:l,fileOutputs:u,streamOutputs:c,segmentOutputs:d,imageOutputs:f}=this.getOutputParams(t,s==null?void 0:s.encodingOptions),_=new dr({url:e,audioOnly:i,videoOnly:r,awaitStartSignal:o,output:a,options:l,fileOutputs:u,streamOutputs:c,segmentOutputs:d,imageOutputs:f}).toJson(),m=await this.rpc.request(re,"StartWebEgress",_,await this.authHeader({roomRecord:!0}));return ae.fromJson(m,{ignoreUnknownFields:!0})}async startParticipantEgress(e,t,s,i){const{options:r,fileOutputs:o,streamOutputs:a,segmentOutputs:l,imageOutputs:u}=this.getOutputParams(s,i==null?void 0:i.encodingOptions),c=new hr({roomName:e,identity:t,options:r,fileOutputs:o,streamOutputs:a,segmentOutputs:l,imageOutputs:u}).toJson(),d=await this.rpc.request(re,"StartParticipantEgress",c,await this.authHeader({roomRecord:!0}));return ae.fromJson(d,{ignoreUnknownFields:!0})}async startTrackCompositeEgress(e,t,s,i,r){let o;if(s!==void 0)if(typeof s=="string")o=s;else{const T=s;o=T.audioTrackId,i=T.videoTrackId,r=T.encodingOptions}o??(o=""),i??(i="");const{output:a,options:l,fileOutputs:u,streamOutputs:c,segmentOutputs:d,imageOutputs:f}=this.getOutputParams(t,r),_=new fr({roomName:e,audioTrackId:o,videoTrackId:i,output:a,options:l,fileOutputs:u,streamOutputs:c,segmentOutputs:d,imageOutputs:f}).toJson(),m=await this.rpc.request(re,"StartTrackCompositeEgress",_,await this.authHeader({roomRecord:!0}));return ae.fromJson(m,{ignoreUnknownFields:!0})}isEncodedOutputs(e){return e.file!==void 0||e.stream!==void 0||e.segments!==void 0}isEncodedFileOutput(e){return e.filepath!==void 0||e.fileType!==void 0}isSegmentedFileOutput(e){return e.filenamePrefix!==void 0||e.playlistName!==void 0||e.filenameSuffix!==void 0}isStreamOutput(e){return e.protocol!==void 0||e.urls!==void 0}getOutputParams(e,t){let s,i,r,o,a,l,u;this.isEncodedOutputs(e)?(e.file!==void 0&&(i=[e.file]),e.stream!==void 0&&(o=[e.stream]),e.segments!==void 0&&(l=[e.segments]),e.images!==void 0&&(u=[e.images])):this.isEncodedFileOutput(e)?(s=e,i=[s]):this.isSegmentedFileOutput(e)?(a=e,l=[a]):this.isStreamOutput(e)&&(r=e,o=[r]);let c;s?c={case:"file",value:s}:r?c={case:"stream",value:r}:a&&(c={case:"segments",value:a});let d;return t&&(typeof t=="number"?d={case:"preset",value:t}:d={case:"advanced",value:t}),{output:c,options:d,fileOutputs:i,streamOutputs:o,segmentOutputs:l,imageOutputs:u}}async startTrackEgress(e,t,s){let i;typeof t=="string"?i={case:"websocketUrl",value:t}:i={case:"file",value:t};const r=new mr({roomName:e,trackId:s,output:i}).toJson(),o=await this.rpc.request(re,"StartTrackEgress",r,await this.authHeader({roomRecord:!0}));return ae.fromJson(o,{ignoreUnknownFields:!0})}async updateLayout(e,t){const s=await this.rpc.request(re,"UpdateLayout",new cc({egressId:e,layout:t}).toJson(),await this.authHeader({roomRecord:!0}));return ae.fromJson(s,{ignoreUnknownFields:!0})}async updateStream(e,t,s){t??(t=[]),s??(s=[]);const i=await this.rpc.request(re,"UpdateStream",new lc({egressId:e,addOutputUrls:t,removeOutputUrls:s}).toJson(),await this.authHeader({roomRecord:!0}));return ae.fromJson(i,{ignoreUnknownFields:!0})}async listEgress(e){var t;let s={};typeof e=="string"?s.roomName=e:e!==void 0&&(s=e);const i=await this.rpc.request(re,"ListEgress",new uc(s).toJson(),await this.authHeader({roomRecord:!0}));return(t=dc.fromJson(i,{ignoreUnknownFields:!0}).items)!==null&&t!==void 0?t:[]}async stopEgress(e){const t=await this.rpc.request(re,"StopEgress",new hc({egressId:e}).toJson(),await this.authHeader({roomRecord:!0}));return ae.fromJson(t,{ignoreUnknownFields:!0})}}const Y="RoomService";class vl extends Ar{constructor(e,t,s){super(t,s),this.rpc=new Or(e,Nr)}async createRoom(e){const t=await this.rpc.request(Y,"CreateRoom",new Tc(e).toJson(),await this.authHeader({roomCreate:!0}));return On.fromJson(t,{ignoreUnknownFields:!0})}async listRooms(e){var t;const s=await this.rpc.request(Y,"ListRooms",new wc({names:e??[]}).toJson(),await this.authHeader({roomList:!0}));return(t=bc.fromJson(s,{ignoreUnknownFields:!0}).rooms)!==null&&t!==void 0?t:[]}async deleteRoom(e){await this.rpc.request(Y,"DeleteRoom",new kc({room:e}).toJson(),await this.authHeader({roomCreate:!0}))}async updateRoomMetadata(e,t){const s=await this.rpc.request(Y,"UpdateRoomMetadata",new Pc({room:e,metadata:t}).toJson(),await this.authHeader({roomAdmin:!0,room:e}));return On.fromJson(s,{ignoreUnknownFields:!0})}async listParticipants(e){var t;const s=await this.rpc.request(Y,"ListParticipants",new Rc({room:e}).toJson(),await this.authHeader({roomAdmin:!0,room:e}));return(t=Cc.fromJson(s,{ignoreUnknownFields:!0}).participants)!==null&&t!==void 0?t:[]}async getParticipant(e,t){const s=await this.rpc.request(Y,"GetParticipant",new Ws({room:e,identity:t}).toJson(),await this.authHeader({roomAdmin:!0,room:e}));return Pn.fromJson(s,{ignoreUnknownFields:!0})}async removeParticipant(e,t){await this.rpc.request(Y,"RemoveParticipant",new Ws({room:e,identity:t}).toJson(),await this.authHeader({roomAdmin:!0,room:e}))}async mutePublishedTrack(e,t,s,i){const r=new Ac({room:e,identity:t,trackSid:s,muted:i}).toJson(),o=await this.rpc.request(Y,"MutePublishedTrack",r,await this.authHeader({roomAdmin:!0,room:e}));return vc.fromJson(o,{ignoreUnknownFields:!0}).track}async updateParticipant(e,t,s,i,r){const o=typeof s=="object",a=o?s==null?void 0:s.metadata:s,l=o?s.permission:i,u=o?s.name:r,c=o?s.attributes:{},d=new Ic({room:e,identity:t,attributes:c,metadata:a,name:u});l&&(d.permission=new Gn(l));const f=await this.rpc.request(Y,"UpdateParticipant",d.toJson(),await this.authHeader({roomAdmin:!0,room:e}));return Pn.fromJson(f,{ignoreUnknownFields:!0})}async updateSubscriptions(e,t,s,i){const r=new Nc({room:e,identity:t,trackSids:s,subscribe:i,participantTracks:[]}).toJson();await this.rpc.request(Y,"UpdateSubscriptions",r,await this.authHeader({roomAdmin:!0,room:e}))}async sendData(e,t,s,i={}){const r=Array.isArray(i)?i:i.destinationSids,o=Array.isArray(i)?void 0:i.topic,a=new Oc({room:e,data:t,kind:s,destinationSids:r??[],topic:o});!Array.isArray(i)&&i.destinationIdentities&&(a.destinationIdentities=i.destinationIdentities),await this.rpc.request(Y,"SendData",a.toJson(),await this.authHeader({roomAdmin:!0,room:e}))}}const Il=16,Nl=12;function Ol(n){let e=new TextEncoder;return window.crypto.subtle.importKey("raw",e.encode(n),{name:"PBKDF2"},!1,["deriveBits","deriveKey"])}function Pl(n,e){return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:e,iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async function Ll(n,e){const t=window.crypto.getRandomValues(new Uint8Array(Il)),s=window.crypto.getRandomValues(new Uint8Array(Nl));let i=Bi(n),r=await Ol(e),o=await Pl(r,t);const a=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:s},o,i);return{salt:gn(new Uint8Array(t)),iv:gn(new Uint8Array(s)),encryptedText:gn(new Uint8Array(a))}}const oe=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];function gn(n){let e="",t,s=n.length;for(t=2;t<s;t+=3)e+=oe[n[t-2]>>2],e+=oe[(n[t-2]&3)<<4|n[t-1]>>4],e+=oe[(n[t-1]&15)<<2|n[t]>>6],e+=oe[n[t]&63];return t===s+1&&(e+=oe[n[t-2]>>2],e+=oe[(n[t-2]&3)<<4],e+="=="),t===s&&(e+=oe[n[t-2]>>2],e+=oe[(n[t-2]&3)<<4|n[t-1]>>4],e+=oe[(n[t-1]&15)<<2],e+="="),e}const le=n=>{const e=console.error;Object.assign(console,{error:(...s)=>{(!s[0]||!s[0].toString||!s[0].toString().includes("You should not include your API secret in your web client bundle"))&&e.apply(console,s)}});const t=n();return Object.assign(console,{error:e}),t},es=(n,e,t)=>le(()=>new Cr(n,e,t));async function Ml(n,e,t){const s=es(n,e,{identity:t,ttl:86400});return s.addGrant({room:t,roomJoin:!0,roomCreate:!0,roomAdmin:!0,roomList:!0,canPublish:!0,canSubscribe:!1,canPublishData:!0,canUpdateOwnMetadata:!0}),await s.toJwt()}async function Dl(n,e){const{encryptedText:t,iv:s,salt:i}=await Ll(n,e);return{salt:i,iv:s,token:t}}async function xl(n,e,t,s){const i=es(n,e,{identity:s,name:s,ttl:21600});return i.addGrant({room:t,roomList:!0,roomJoin:!0,canPublish:!1,canSubscribe:!0,canPublishData:!0,canUpdateOwnMetadata:!1}),await i.toJwt()}async function Fl(n,e){const t=es(n,e,{identity:"lt",ttl:94608e5});return t.addGrant({roomList:!0,roomJoin:!1,canPublish:!1,canSubscribe:!1,canPublishData:!1,canUpdateOwnMetadata:!1}),await t.toJwt()}ee.MAV_STATE_UNINIT+"",ee.MAV_STATE_BOOT+"",ee.MAV_STATE_CALIBRATING+"",ee.MAV_STATE_STANDBY+"",ee.MAV_STATE_ACTIVE+"",ee.MAV_STATE_CRITICAL+"",ee.MAV_STATE_EMERGENCY+"",ee.MAV_STATE_POWEROFF+"",ee.MAV_STATE_FLIGHT_TERMINATION+"";const De=(n,e=0)=>({header:{system_id:254,component_id:240,sequence:e},message:n}),ti=n=>De({type:"COMMAND_LONG",command:{type:"MAV_CMD_COMPONENT_ARM_DISARM"},target_system:1,target_component:1,confirmation:0,param1:1,param2:0,param3:0,param4:0,param5:0,param6:0,param7:0}),Ul=n=>De({type:"COMMAND_LONG",command:{type:"MAV_CMD_COMPONENT_ARM_DISARM"},target_system:1,target_component:1,confirmation:1,param1:0,param2:0,param3:0,param4:0,param5:0,param6:0,param7:0}),Bl=(n=1,e=333333.34375)=>De({type:"COMMAND_LONG",command:{type:"MAV_CMD_SET_MESSAGE_INTERVAL"},target_system:1,target_component:1,confirmation:1,param1:n,param2:e,param3:0,param4:0,param5:0,param6:0,param7:0}),Vl=n=>(n=n||19,De({type:"COMMAND_LONG",command:{type:"MAV_CMD_DO_SET_MODE"},param1:1,param2:Number(n),param3:0,param4:0,param5:0,param6:0,param7:0,target_system:1,target_component:1,confirmation:1})),Hl=()=>De({type:Ho.HEARTBEAT,custom_mode:0,mavtype:{type:Ko.MAV_TYPE_GCS},autopilot:{type:qo.MAV_AUTOPILOT_INVALID},base_mode:{bits:In.MAV_MODE_FLAG_SAFETY_ARMED|In.MAV_MODE_FLAG_MANUAL_INPUT_ENABLED},system_status:{type:ee.MAV_STATE_ACTIVE},mavlink_version:1,confirmation:0}),Kl=(n,e,t,s,i)=>De({type:"MANUAL_CONTROL",x:Math.floor(n),y:Math.floor(e),z:Math.floor(t),r:Math.floor(s),buttons:i,target:1}),ql=(n,e,t)=>{const s=Array(8).fill(0);return s[n]=e,De({type:"SET_ACTUATOR_CONTROL_TARGET",group_mlx:t,controls:s,time_usec:Date.now()*1e3,target_component:1,target_system:1})};class Lr{constructor(){E(this,"socket");E(this,"serverAddress");E(this,"msgReceivedFn");E(this,"onConnectedFn");E(this,"isRunning");E(this,"isConnected");E(this,"connectionTimerId");this.isConnected=!1,this.isRunning=!1,this.connectionTimerId=0,this.serverAddress=""}start(e,t){this.serverAddress=e,this.msgReceivedFn=t,this.isRunning=!0,this.connect()}stop(){this.isRunning=!1,this.socket&&this.socket.close()}connect(){x("Attempting to connect to websocket: "+this.serverAddress),this.socket=new WebSocket(this.serverAddress),this.socket.binaryType="arraybuffer";const e=setTimeout(()=>{$("WebSocket connection timed out after 10 seconds"),this.stop(),this.queueConnect()},1e4);this.socket.addEventListener("open",t=>{this.isConnected=!0,clearTimeout(e),this.onConnectedFn&&this.onConnectedFn()}),this.socket.addEventListener("close",t=>{x("WebSocket connection closed with code: ",t.code),this.isConnected=!1,this.isRunning&&this.queueConnect()}),this.socket.addEventListener("error",t=>{$("WebSocket error:",t),this.isConnected=!1,this.isRunning&&this.queueConnect()}),this.socket.addEventListener("message",t=>{if(!this.msgReceivedFn)return $("No msgReceivedFn defined for WebSocketRelay");if(typeof t.data=="string")this.msgReceivedFn(t.data);else if(t.data instanceof ArrayBuffer)this.msgReceivedFn(new Uint8Array(t.data));else throw t.data instanceof Blob?new Error("WebSocketRelay received Blob type, which is not supported!"):new Error("WebSocketRelay received unknown type")})}queueConnect(){clearTimeout(this.connectionTimerId),this.connectionTimerId=setTimeout(this.connect.bind(this),2e3)}getIsConnected(){return this.isConnected}sendMessage(e){if(this.socket){if(this.socket.readyState!=this.socket.OPEN){ge("Can't send WebSocket msg: "+this.socket.readyState);return}this.socket.send(e)}}close(){this.socket&&this.socket.close()}}const Kt=new Lr;class $l{constructor(){E(this,"mavlinkWebsocket");E(this,"onMessage");this.mavlinkWebsocket=new Lr}start(e,t,s){this.onMessage=t,s&&(this.mavlinkWebsocket.onConnectedFn=s),this.mavlinkWebsocket.start(e,i=>{this.handleMessage(i)})}handleMessage(e){if(e.length===0)return;const t=e instanceof Uint8Array?$o(e):e;try{if(t.startsWith("Ok"))return;const s=JSON.parse(t);this.onMessage(s)}catch(s){$("Failed to parse recived mavlink2rest json. msg='"+t+"'",s)}}sendMessage(e){this.mavlinkWebsocket.sendMessage(JSON.stringify(e))}close(){this.mavlinkWebsocket.close()}}const ne=new $l;function Mr(n,e){return function(){return n.apply(e,arguments)}}const{toString:Wl}=Object.prototype,{getPrototypeOf:ts}=Object,Yt=(n=>e=>{const t=Wl.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Z=n=>(n=n.toLowerCase(),e=>Yt(e)===n),Xt=n=>e=>typeof e===n,{isArray:Ye}=Array,ct=Xt("undefined");function Jl(n){return n!==null&&!ct(n)&&n.constructor!==null&&!ct(n.constructor)&&G(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const Dr=Z("ArrayBuffer");function jl(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&Dr(n.buffer),e}const Gl=Xt("string"),G=Xt("function"),xr=Xt("number"),Qt=n=>n!==null&&typeof n=="object",zl=n=>n===!0||n===!1,Dt=n=>{if(Yt(n)!=="object")return!1;const e=ts(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Yl=Z("Date"),Xl=Z("File"),Ql=Z("Blob"),Zl=Z("FileList"),eu=n=>Qt(n)&&G(n.pipe),tu=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||G(n.append)&&((e=Yt(n))==="formdata"||e==="object"&&G(n.toString)&&n.toString()==="[object FormData]"))},nu=Z("URLSearchParams"),[su,iu,ru,ou]=["ReadableStream","Request","Response","Headers"].map(Z),au=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function St(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let s,i;if(typeof n!="object"&&(n=[n]),Ye(n))for(s=0,i=n.length;s<i;s++)e.call(null,n[s],s,n);else{const r=t?Object.getOwnPropertyNames(n):Object.keys(n),o=r.length;let a;for(s=0;s<o;s++)a=r[s],e.call(null,n[a],a,n)}}function Fr(n,e){e=e.toLowerCase();const t=Object.keys(n);let s=t.length,i;for(;s-- >0;)if(i=t[s],e===i.toLowerCase())return i;return null}const ve=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:ye.global)(),Ur=n=>!ct(n)&&n!==ve;function Dn(){const{caseless:n}=Ur(this)&&this||{},e={},t=(s,i)=>{const r=n&&Fr(e,i)||i;Dt(e[r])&&Dt(s)?e[r]=Dn(e[r],s):Dt(s)?e[r]=Dn({},s):Ye(s)?e[r]=s.slice():e[r]=s};for(let s=0,i=arguments.length;s<i;s++)arguments[s]&&St(arguments[s],t);return e}const cu=(n,e,t,{allOwnKeys:s}={})=>(St(e,(i,r)=>{t&&G(i)?n[r]=Mr(i,t):n[r]=i},{allOwnKeys:s}),n),lu=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),uu=(n,e,t,s)=>{n.prototype=Object.create(e.prototype,s),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},du=(n,e,t,s)=>{let i,r,o;const a={};if(e=e||{},n==null)return e;do{for(i=Object.getOwnPropertyNames(n),r=i.length;r-- >0;)o=i[r],(!s||s(o,n,e))&&!a[o]&&(e[o]=n[o],a[o]=!0);n=t!==!1&&ts(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},hu=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const s=n.indexOf(e,t);return s!==-1&&s===t},fu=n=>{if(!n)return null;if(Ye(n))return n;let e=n.length;if(!xr(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},mu=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&ts(Uint8Array)),pu=(n,e)=>{const s=(n&&n[Symbol.iterator]).call(n);let i;for(;(i=s.next())&&!i.done;){const r=i.value;e.call(n,r[0],r[1])}},gu=(n,e)=>{let t;const s=[];for(;(t=n.exec(e))!==null;)s.push(t);return s},_u=Z("HTMLFormElement"),yu=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,s,i){return s.toUpperCase()+i}),ni=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),Tu=Z("RegExp"),Br=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),s={};St(t,(i,r)=>{let o;(o=e(i,r,n))!==!1&&(s[r]=o||i)}),Object.defineProperties(n,s)},Eu=n=>{Br(n,(e,t)=>{if(G(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const s=n[t];if(G(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Su=(n,e)=>{const t={},s=i=>{i.forEach(r=>{t[r]=!0})};return Ye(n)?s(n):s(String(n).split(e)),t},wu=()=>{},bu=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e,_n="abcdefghijklmnopqrstuvwxyz",si="0123456789",Vr={DIGIT:si,ALPHA:_n,ALPHA_DIGIT:_n+_n.toUpperCase()+si},ku=(n=16,e=Vr.ALPHA_DIGIT)=>{let t="";const{length:s}=e;for(;n--;)t+=e[Math.random()*s|0];return t};function Ru(n){return!!(n&&G(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const Cu=n=>{const e=new Array(10),t=(s,i)=>{if(Qt(s)){if(e.indexOf(s)>=0)return;if(!("toJSON"in s)){e[i]=s;const r=Ye(s)?[]:{};return St(s,(o,a)=>{const l=t(o,i+1);!ct(l)&&(r[a]=l)}),e[i]=void 0,r}}return s};return t(n,0)},Au=Z("AsyncFunction"),vu=n=>n&&(Qt(n)||G(n))&&G(n.then)&&G(n.catch),Hr=((n,e)=>n?setImmediate:e?((t,s)=>(ve.addEventListener("message",({source:i,data:r})=>{i===ve&&r===t&&s.length&&s.shift()()},!1),i=>{s.push(i),ve.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",G(ve.postMessage)),Iu=typeof queueMicrotask<"u"?queueMicrotask.bind(ve):typeof ye.process<"u"&&ye.process.nextTick||Hr,h={isArray:Ye,isArrayBuffer:Dr,isBuffer:Jl,isFormData:tu,isArrayBufferView:jl,isString:Gl,isNumber:xr,isBoolean:zl,isObject:Qt,isPlainObject:Dt,isReadableStream:su,isRequest:iu,isResponse:ru,isHeaders:ou,isUndefined:ct,isDate:Yl,isFile:Xl,isBlob:Ql,isRegExp:Tu,isFunction:G,isStream:eu,isURLSearchParams:nu,isTypedArray:mu,isFileList:Zl,forEach:St,merge:Dn,extend:cu,trim:au,stripBOM:lu,inherits:uu,toFlatObject:du,kindOf:Yt,kindOfTest:Z,endsWith:hu,toArray:fu,forEachEntry:pu,matchAll:gu,isHTMLForm:_u,hasOwnProperty:ni,hasOwnProp:ni,reduceDescriptors:Br,freezeMethods:Eu,toObjectSet:Su,toCamelCase:yu,noop:wu,toFiniteNumber:bu,findKey:Fr,global:ve,isContextDefined:Ur,ALPHABET:Vr,generateString:ku,isSpecCompliantForm:Ru,toJSONObject:Cu,isAsyncFn:Au,isThenable:vu,setImmediate:Hr,asap:Iu};function w(n,e,t,s,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),s&&(this.request=s),i&&(this.response=i,this.status=i.status?i.status:null)}h.inherits(w,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:h.toJSONObject(this.config),code:this.code,status:this.status}}});const Kr=w.prototype,qr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{qr[n]={value:n}});Object.defineProperties(w,qr);Object.defineProperty(Kr,"isAxiosError",{value:!0});w.from=(n,e,t,s,i,r)=>{const o=Object.create(Kr);return h.toFlatObject(n,o,function(l){return l!==Error.prototype},a=>a!=="isAxiosError"),w.call(o,n.message,e,t,s,i),o.cause=n,o.name=n.name,r&&Object.assign(o,r),o};const Nu=null;function xn(n){return h.isPlainObject(n)||h.isArray(n)}function $r(n){return h.endsWith(n,"[]")?n.slice(0,-2):n}function ii(n,e,t){return n?n.concat(e).map(function(i,r){return i=$r(i),!t&&r?"["+i+"]":i}).join(t?".":""):e}function Ou(n){return h.isArray(n)&&!n.some(xn)}const Pu=h.toFlatObject(h,{},null,function(e){return/^is[A-Z]/.test(e)});function Zt(n,e,t){if(!h.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=h.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(T,p){return!h.isUndefined(p[T])});const s=t.metaTokens,i=t.visitor||c,r=t.dots,o=t.indexes,l=(t.Blob||typeof Blob<"u"&&Blob)&&h.isSpecCompliantForm(e);if(!h.isFunction(i))throw new TypeError("visitor must be a function");function u(m){if(m===null)return"";if(h.isDate(m))return m.toISOString();if(!l&&h.isBlob(m))throw new w("Blob is not supported. Use a Buffer instead.");return h.isArrayBuffer(m)||h.isTypedArray(m)?l&&typeof Blob=="function"?new Blob([m]):ye.Buffer.from(m):m}function c(m,T,p){let S=m;if(m&&!p&&typeof m=="object"){if(h.endsWith(T,"{}"))T=s?T:T.slice(0,-2),m=JSON.stringify(m);else if(h.isArray(m)&&Ou(m)||(h.isFileList(m)||h.endsWith(T,"[]"))&&(S=h.toArray(m)))return T=$r(T),S.forEach(function(v,R){!(h.isUndefined(v)||v===null)&&e.append(o===!0?ii([T],R,r):o===null?T:T+"[]",u(v))}),!1}return xn(m)?!0:(e.append(ii(p,T,r),u(m)),!1)}const d=[],f=Object.assign(Pu,{defaultVisitor:c,convertValue:u,isVisitable:xn});function _(m,T){if(!h.isUndefined(m)){if(d.indexOf(m)!==-1)throw Error("Circular reference detected in "+T.join("."));d.push(m),h.forEach(m,function(S,k){(!(h.isUndefined(S)||S===null)&&i.call(e,S,h.isString(k)?k.trim():k,T,f))===!0&&_(S,T?T.concat(k):[k])}),d.pop()}}if(!h.isObject(n))throw new TypeError("data must be an object");return _(n),e}function ri(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function ns(n,e){this._pairs=[],n&&Zt(n,this,e)}const Wr=ns.prototype;Wr.append=function(e,t){this._pairs.push([e,t])};Wr.toString=function(e){const t=e?function(s){return e.call(this,s,ri)}:ri;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function Lu(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Jr(n,e,t){if(!e)return n;const s=t&&t.encode||Lu,i=t&&t.serialize;let r;if(i?r=i(e,t):r=h.isURLSearchParams(e)?e.toString():new ns(e,t).toString(s),r){const o=n.indexOf("#");o!==-1&&(n=n.slice(0,o)),n+=(n.indexOf("?")===-1?"?":"&")+r}return n}class Mu{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){h.forEach(this.handlers,function(s){s!==null&&e(s)})}}const oi=Mu,jr={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Du=typeof URLSearchParams<"u"?URLSearchParams:ns,xu=typeof FormData<"u"?FormData:null,Fu=typeof Blob<"u"?Blob:null,Uu={isBrowser:!0,classes:{URLSearchParams:Du,FormData:xu,Blob:Fu},protocols:["http","https","file","blob","url","data"]},ss=typeof window<"u"&&typeof document<"u",Fn=typeof navigator=="object"&&navigator||void 0,Bu=ss&&(!Fn||["ReactNative","NativeScript","NS"].indexOf(Fn.product)<0),Vu=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),Hu=ss&&window.location.href||"http://localhost",Ku=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:ss,hasStandardBrowserEnv:Bu,hasStandardBrowserWebWorkerEnv:Vu,navigator:Fn,origin:Hu},Symbol.toStringTag,{value:"Module"})),J={...Ku,...Uu};function qu(n,e){return Zt(n,new J.classes.URLSearchParams,Object.assign({visitor:function(t,s,i,r){return J.isNode&&h.isBuffer(t)?(this.append(s,t.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},e))}function $u(n){return h.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Wu(n){const e={},t=Object.keys(n);let s;const i=t.length;let r;for(s=0;s<i;s++)r=t[s],e[r]=n[r];return e}function Gr(n){function e(t,s,i,r){let o=t[r++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),l=r>=t.length;return o=!o&&h.isArray(i)?i.length:o,l?(h.hasOwnProp(i,o)?i[o]=[i[o],s]:i[o]=s,!a):((!i[o]||!h.isObject(i[o]))&&(i[o]=[]),e(t,s,i[o],r)&&h.isArray(i[o])&&(i[o]=Wu(i[o])),!a)}if(h.isFormData(n)&&h.isFunction(n.entries)){const t={};return h.forEachEntry(n,(s,i)=>{e($u(s),i,t,0)}),t}return null}function Ju(n,e,t){if(h.isString(n))try{return(e||JSON.parse)(n),h.trim(n)}catch(s){if(s.name!=="SyntaxError")throw s}return(t||JSON.stringify)(n)}const is={transitional:jr,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",i=s.indexOf("application/json")>-1,r=h.isObject(e);if(r&&h.isHTMLForm(e)&&(e=new FormData(e)),h.isFormData(e))return i?JSON.stringify(Gr(e)):e;if(h.isArrayBuffer(e)||h.isBuffer(e)||h.isStream(e)||h.isFile(e)||h.isBlob(e)||h.isReadableStream(e))return e;if(h.isArrayBufferView(e))return e.buffer;if(h.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(r){if(s.indexOf("application/x-www-form-urlencoded")>-1)return qu(e,this.formSerializer).toString();if((a=h.isFileList(e))||s.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return Zt(a?{"files[]":e}:e,l&&new l,this.formSerializer)}}return r||i?(t.setContentType("application/json",!1),Ju(e)):e}],transformResponse:[function(e){const t=this.transitional||is.transitional,s=t&&t.forcedJSONParsing,i=this.responseType==="json";if(h.isResponse(e)||h.isReadableStream(e))return e;if(e&&h.isString(e)&&(s&&!this.responseType||i)){const o=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?w.from(a,w.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:J.classes.FormData,Blob:J.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};h.forEach(["delete","get","head","post","put","patch"],n=>{is.headers[n]={}});const rs=is,ju=h.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Gu=n=>{const e={};let t,s,i;return n&&n.split(`
`).forEach(function(o){i=o.indexOf(":"),t=o.substring(0,i).trim().toLowerCase(),s=o.substring(i+1).trim(),!(!t||e[t]&&ju[t])&&(t==="set-cookie"?e[t]?e[t].push(s):e[t]=[s]:e[t]=e[t]?e[t]+", "+s:s)}),e},ai=Symbol("internals");function st(n){return n&&String(n).trim().toLowerCase()}function xt(n){return n===!1||n==null?n:h.isArray(n)?n.map(xt):String(n)}function zu(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=t.exec(n);)e[s[1]]=s[2];return e}const Yu=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function yn(n,e,t,s,i){if(h.isFunction(s))return s.call(this,e,t);if(i&&(e=t),!!h.isString(e)){if(h.isString(s))return e.indexOf(s)!==-1;if(h.isRegExp(s))return s.test(e)}}function Xu(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}function Qu(n,e){const t=h.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(n,s+t,{value:function(i,r,o){return this[s].call(this,e,i,r,o)},configurable:!0})})}class en{constructor(e){e&&this.set(e)}set(e,t,s){const i=this;function r(a,l,u){const c=st(l);if(!c)throw new Error("header name must be a non-empty string");const d=h.findKey(i,c);(!d||i[d]===void 0||u===!0||u===void 0&&i[d]!==!1)&&(i[d||l]=xt(a))}const o=(a,l)=>h.forEach(a,(u,c)=>r(u,c,l));if(h.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(h.isString(e)&&(e=e.trim())&&!Yu(e))o(Gu(e),t);else if(h.isHeaders(e))for(const[a,l]of e.entries())r(l,a,s);else e!=null&&r(t,e,s);return this}get(e,t){if(e=st(e),e){const s=h.findKey(this,e);if(s){const i=this[s];if(!t)return i;if(t===!0)return zu(i);if(h.isFunction(t))return t.call(this,i,s);if(h.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=st(e),e){const s=h.findKey(this,e);return!!(s&&this[s]!==void 0&&(!t||yn(this,this[s],s,t)))}return!1}delete(e,t){const s=this;let i=!1;function r(o){if(o=st(o),o){const a=h.findKey(s,o);a&&(!t||yn(s,s[a],a,t))&&(delete s[a],i=!0)}}return h.isArray(e)?e.forEach(r):r(e),i}clear(e){const t=Object.keys(this);let s=t.length,i=!1;for(;s--;){const r=t[s];(!e||yn(this,this[r],r,e,!0))&&(delete this[r],i=!0)}return i}normalize(e){const t=this,s={};return h.forEach(this,(i,r)=>{const o=h.findKey(s,r);if(o){t[o]=xt(i),delete t[r];return}const a=e?Xu(r):String(r).trim();a!==r&&delete t[r],t[a]=xt(i),s[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return h.forEach(this,(s,i)=>{s!=null&&s!==!1&&(t[i]=e&&h.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const s=new this(e);return t.forEach(i=>s.set(i)),s}static accessor(e){const s=(this[ai]=this[ai]={accessors:{}}).accessors,i=this.prototype;function r(o){const a=st(o);s[a]||(Qu(i,o),s[a]=!0)}return h.isArray(e)?e.forEach(r):r(e),this}}en.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);h.reduceDescriptors(en.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(s){this[t]=s}}});h.freezeMethods(en);const X=en;function Tn(n,e){const t=this||rs,s=e||t,i=X.from(s.headers);let r=s.data;return h.forEach(n,function(a){r=a.call(t,r,i.normalize(),e?e.status:void 0)}),i.normalize(),r}function zr(n){return!!(n&&n.__CANCEL__)}function Xe(n,e,t){w.call(this,n??"canceled",w.ERR_CANCELED,e,t),this.name="CanceledError"}h.inherits(Xe,w,{__CANCEL__:!0});function Yr(n,e,t){const s=t.config.validateStatus;!t.status||!s||s(t.status)?n(t):e(new w("Request failed with status code "+t.status,[w.ERR_BAD_REQUEST,w.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Zu(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function ed(n,e){n=n||10;const t=new Array(n),s=new Array(n);let i=0,r=0,o;return e=e!==void 0?e:1e3,function(l){const u=Date.now(),c=s[r];o||(o=u),t[i]=l,s[i]=u;let d=r,f=0;for(;d!==i;)f+=t[d++],d=d%n;if(i=(i+1)%n,i===r&&(r=(r+1)%n),u-o<e)return;const _=c&&u-c;return _?Math.round(f*1e3/_):void 0}}function td(n,e){let t=0,s=1e3/e,i,r;const o=(u,c=Date.now())=>{t=c,i=null,r&&(clearTimeout(r),r=null),n.apply(null,u)};return[(...u)=>{const c=Date.now(),d=c-t;d>=s?o(u,c):(i=u,r||(r=setTimeout(()=>{r=null,o(i)},s-d)))},()=>i&&o(i)]}const qt=(n,e,t=3)=>{let s=0;const i=ed(50,250);return td(r=>{const o=r.loaded,a=r.lengthComputable?r.total:void 0,l=o-s,u=i(l),c=o<=a;s=o;const d={loaded:o,total:a,progress:a?o/a:void 0,bytes:l,rate:u||void 0,estimated:u&&a&&c?(a-o)/u:void 0,event:r,lengthComputable:a!=null,[e?"download":"upload"]:!0};n(d)},t)},ci=(n,e)=>{const t=n!=null;return[s=>e[0]({lengthComputable:t,total:n,loaded:s}),e[1]]},li=n=>(...e)=>h.asap(()=>n(...e)),nd=J.hasStandardBrowserEnv?function(){const e=J.navigator&&/(msie|trident)/i.test(J.navigator.userAgent),t=document.createElement("a");let s;function i(r){let o=r;return e&&(t.setAttribute("href",o),o=t.href),t.setAttribute("href",o),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return s=i(window.location.href),function(o){const a=h.isString(o)?i(o):o;return a.protocol===s.protocol&&a.host===s.host}}():function(){return function(){return!0}}(),sd=J.hasStandardBrowserEnv?{write(n,e,t,s,i,r){const o=[n+"="+encodeURIComponent(e)];h.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),h.isString(s)&&o.push("path="+s),h.isString(i)&&o.push("domain="+i),r===!0&&o.push("secure"),document.cookie=o.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function id(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function rd(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function Xr(n,e){return n&&!id(e)?rd(n,e):e}const ui=n=>n instanceof X?{...n}:n;function Ne(n,e){e=e||{};const t={};function s(u,c,d){return h.isPlainObject(u)&&h.isPlainObject(c)?h.merge.call({caseless:d},u,c):h.isPlainObject(c)?h.merge({},c):h.isArray(c)?c.slice():c}function i(u,c,d){if(h.isUndefined(c)){if(!h.isUndefined(u))return s(void 0,u,d)}else return s(u,c,d)}function r(u,c){if(!h.isUndefined(c))return s(void 0,c)}function o(u,c){if(h.isUndefined(c)){if(!h.isUndefined(u))return s(void 0,u)}else return s(void 0,c)}function a(u,c,d){if(d in e)return s(u,c);if(d in n)return s(void 0,u)}const l={url:r,method:r,data:r,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(u,c)=>i(ui(u),ui(c),!0)};return h.forEach(Object.keys(Object.assign({},n,e)),function(c){const d=l[c]||i,f=d(n[c],e[c],c);h.isUndefined(f)&&d!==a||(t[c]=f)}),t}const Qr=n=>{const e=Ne({},n);let{data:t,withXSRFToken:s,xsrfHeaderName:i,xsrfCookieName:r,headers:o,auth:a}=e;e.headers=o=X.from(o),e.url=Jr(Xr(e.baseURL,e.url),n.params,n.paramsSerializer),a&&o.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let l;if(h.isFormData(t)){if(J.hasStandardBrowserEnv||J.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((l=o.getContentType())!==!1){const[u,...c]=l?l.split(";").map(d=>d.trim()).filter(Boolean):[];o.setContentType([u||"multipart/form-data",...c].join("; "))}}if(J.hasStandardBrowserEnv&&(s&&h.isFunction(s)&&(s=s(e)),s||s!==!1&&nd(e.url))){const u=i&&r&&sd.read(r);u&&o.set(i,u)}return e},od=typeof XMLHttpRequest<"u",ad=od&&function(n){return new Promise(function(t,s){const i=Qr(n);let r=i.data;const o=X.from(i.headers).normalize();let{responseType:a,onUploadProgress:l,onDownloadProgress:u}=i,c,d,f,_,m;function T(){_&&_(),m&&m(),i.cancelToken&&i.cancelToken.unsubscribe(c),i.signal&&i.signal.removeEventListener("abort",c)}let p=new XMLHttpRequest;p.open(i.method.toUpperCase(),i.url,!0),p.timeout=i.timeout;function S(){if(!p)return;const v=X.from("getAllResponseHeaders"in p&&p.getAllResponseHeaders()),L={data:!a||a==="text"||a==="json"?p.responseText:p.response,status:p.status,statusText:p.statusText,headers:v,config:n,request:p};Yr(function(W){t(W),T()},function(W){s(W),T()},L),p=null}"onloadend"in p?p.onloadend=S:p.onreadystatechange=function(){!p||p.readyState!==4||p.status===0&&!(p.responseURL&&p.responseURL.indexOf("file:")===0)||setTimeout(S)},p.onabort=function(){p&&(s(new w("Request aborted",w.ECONNABORTED,n,p)),p=null)},p.onerror=function(){s(new w("Network Error",w.ERR_NETWORK,n,p)),p=null},p.ontimeout=function(){let R=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const L=i.transitional||jr;i.timeoutErrorMessage&&(R=i.timeoutErrorMessage),s(new w(R,L.clarifyTimeoutError?w.ETIMEDOUT:w.ECONNABORTED,n,p)),p=null},r===void 0&&o.setContentType(null),"setRequestHeader"in p&&h.forEach(o.toJSON(),function(R,L){p.setRequestHeader(L,R)}),h.isUndefined(i.withCredentials)||(p.withCredentials=!!i.withCredentials),a&&a!=="json"&&(p.responseType=i.responseType),u&&([f,m]=qt(u,!0),p.addEventListener("progress",f)),l&&p.upload&&([d,_]=qt(l),p.upload.addEventListener("progress",d),p.upload.addEventListener("loadend",_)),(i.cancelToken||i.signal)&&(c=v=>{p&&(s(!v||v.type?new Xe(null,n,p):v),p.abort(),p=null)},i.cancelToken&&i.cancelToken.subscribe(c),i.signal&&(i.signal.aborted?c():i.signal.addEventListener("abort",c)));const k=Zu(i.url);if(k&&J.protocols.indexOf(k)===-1){s(new w("Unsupported protocol "+k+":",w.ERR_BAD_REQUEST,n));return}p.send(r||null)})},cd=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let s=new AbortController,i;const r=function(u){if(!i){i=!0,a();const c=u instanceof Error?u:this.reason;s.abort(c instanceof w?c:new Xe(c instanceof Error?c.message:c))}};let o=e&&setTimeout(()=>{o=null,r(new w(`timeout ${e} of ms exceeded`,w.ETIMEDOUT))},e);const a=()=>{n&&(o&&clearTimeout(o),o=null,n.forEach(u=>{u.unsubscribe?u.unsubscribe(r):u.removeEventListener("abort",r)}),n=null)};n.forEach(u=>u.addEventListener("abort",r));const{signal:l}=s;return l.unsubscribe=()=>h.asap(a),l}},ld=cd,ud=function*(n,e){let t=n.byteLength;if(!e||t<e){yield n;return}let s=0,i;for(;s<t;)i=s+e,yield n.slice(s,i),s=i},dd=async function*(n,e){for await(const t of hd(n))yield*ud(t,e)},hd=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:s}=await e.read();if(t)break;yield s}}finally{await e.cancel()}},di=(n,e,t,s)=>{const i=dd(n,e);let r=0,o,a=l=>{o||(o=!0,s&&s(l))};return new ReadableStream({async pull(l){try{const{done:u,value:c}=await i.next();if(u){a(),l.close();return}let d=c.byteLength;if(t){let f=r+=d;t(f)}l.enqueue(new Uint8Array(c))}catch(u){throw a(u),u}},cancel(l){return a(l),i.return()}},{highWaterMark:2})},tn=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Zr=tn&&typeof ReadableStream=="function",fd=tn&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),eo=(n,...e)=>{try{return!!n(...e)}catch{return!1}},md=Zr&&eo(()=>{let n=!1;const e=new Request(J.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),hi=64*1024,Un=Zr&&eo(()=>h.isReadableStream(new Response("").body)),$t={stream:Un&&(n=>n.body)};tn&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!$t[e]&&($t[e]=h.isFunction(n[e])?t=>t[e]():(t,s)=>{throw new w(`Response type '${e}' is not supported`,w.ERR_NOT_SUPPORT,s)})})})(new Response);const pd=async n=>{if(n==null)return 0;if(h.isBlob(n))return n.size;if(h.isSpecCompliantForm(n))return(await new Request(J.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(h.isArrayBufferView(n)||h.isArrayBuffer(n))return n.byteLength;if(h.isURLSearchParams(n)&&(n=n+""),h.isString(n))return(await fd(n)).byteLength},gd=async(n,e)=>{const t=h.toFiniteNumber(n.getContentLength());return t??pd(e)},_d=tn&&(async n=>{let{url:e,method:t,data:s,signal:i,cancelToken:r,timeout:o,onDownloadProgress:a,onUploadProgress:l,responseType:u,headers:c,withCredentials:d="same-origin",fetchOptions:f}=Qr(n);u=u?(u+"").toLowerCase():"text";let _=ld([i,r&&r.toAbortSignal()],o),m;const T=_&&_.unsubscribe&&(()=>{_.unsubscribe()});let p;try{if(l&&md&&t!=="get"&&t!=="head"&&(p=await gd(c,s))!==0){let L=new Request(e,{method:"POST",body:s,duplex:"half"}),I;if(h.isFormData(s)&&(I=L.headers.get("content-type"))&&c.setContentType(I),L.body){const[W,B]=ci(p,qt(li(l)));s=di(L.body,hi,W,B)}}h.isString(d)||(d=d?"include":"omit");const S="credentials"in Request.prototype;m=new Request(e,{...f,signal:_,method:t.toUpperCase(),headers:c.normalize().toJSON(),body:s,duplex:"half",credentials:S?d:void 0});let k=await fetch(m);const v=Un&&(u==="stream"||u==="response");if(Un&&(a||v&&T)){const L={};["status","statusText","headers"].forEach(Re=>{L[Re]=k[Re]});const I=h.toFiniteNumber(k.headers.get("content-length")),[W,B]=a&&ci(I,qt(li(a),!0))||[];k=new Response(di(k.body,hi,W,()=>{B&&B(),T&&T()}),L)}u=u||"text";let R=await $t[h.findKey($t,u)||"text"](k,n);return!v&&T&&T(),await new Promise((L,I)=>{Yr(L,I,{data:R,headers:X.from(k.headers),status:k.status,statusText:k.statusText,config:n,request:m})})}catch(S){throw T&&T(),S&&S.name==="TypeError"&&/fetch/i.test(S.message)?Object.assign(new w("Network Error",w.ERR_NETWORK,n,m),{cause:S.cause||S}):w.from(S,S&&S.code,n,m)}}),Bn={http:Nu,xhr:ad,fetch:_d};h.forEach(Bn,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const fi=n=>`- ${n}`,yd=n=>h.isFunction(n)||n===null||n===!1,to={getAdapter:n=>{n=h.isArray(n)?n:[n];const{length:e}=n;let t,s;const i={};for(let r=0;r<e;r++){t=n[r];let o;if(s=t,!yd(t)&&(s=Bn[(o=String(t)).toLowerCase()],s===void 0))throw new w(`Unknown adapter '${o}'`);if(s)break;i[o||"#"+r]=s}if(!s){const r=Object.entries(i).map(([a,l])=>`adapter ${a} `+(l===!1?"is not supported by the environment":"is not available in the build"));let o=e?r.length>1?`since :
`+r.map(fi).join(`
`):" "+fi(r[0]):"as no adapter specified";throw new w("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return s},adapters:Bn};function En(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Xe(null,n)}function mi(n){return En(n),n.headers=X.from(n.headers),n.data=Tn.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),to.getAdapter(n.adapter||rs.adapter)(n).then(function(s){return En(n),s.data=Tn.call(n,n.transformResponse,s),s.headers=X.from(s.headers),s},function(s){return zr(s)||(En(n),s&&s.response&&(s.response.data=Tn.call(n,n.transformResponse,s.response),s.response.headers=X.from(s.response.headers))),Promise.reject(s)})}const no="1.7.7",os={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{os[n]=function(s){return typeof s===n||"a"+(e<1?"n ":" ")+n}});const pi={};os.transitional=function(e,t,s){function i(r,o){return"[Axios v"+no+"] Transitional option '"+r+"'"+o+(s?". "+s:"")}return(r,o,a)=>{if(e===!1)throw new w(i(o," has been removed"+(t?" in "+t:"")),w.ERR_DEPRECATED);return t&&!pi[o]&&(pi[o]=!0,console.warn(i(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(r,o,a):!0}};function Td(n,e,t){if(typeof n!="object")throw new w("options must be an object",w.ERR_BAD_OPTION_VALUE);const s=Object.keys(n);let i=s.length;for(;i-- >0;){const r=s[i],o=e[r];if(o){const a=n[r],l=a===void 0||o(a,r,n);if(l!==!0)throw new w("option "+r+" must be "+l,w.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new w("Unknown option "+r,w.ERR_BAD_OPTION)}}const Vn={assertOptions:Td,validators:os},me=Vn.validators;class Wt{constructor(e){this.defaults=e,this.interceptors={request:new oi,response:new oi}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let i;Error.captureStackTrace?Error.captureStackTrace(i={}):i=new Error;const r=i.stack?i.stack.replace(/^.+\n/,""):"";try{s.stack?r&&!String(s.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+r):s.stack=r}catch{}}throw s}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Ne(this.defaults,t);const{transitional:s,paramsSerializer:i,headers:r}=t;s!==void 0&&Vn.assertOptions(s,{silentJSONParsing:me.transitional(me.boolean),forcedJSONParsing:me.transitional(me.boolean),clarifyTimeoutError:me.transitional(me.boolean)},!1),i!=null&&(h.isFunction(i)?t.paramsSerializer={serialize:i}:Vn.assertOptions(i,{encode:me.function,serialize:me.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=r&&h.merge(r.common,r[t.method]);r&&h.forEach(["delete","get","head","post","put","patch","common"],m=>{delete r[m]}),t.headers=X.concat(o,r);const a=[];let l=!0;this.interceptors.request.forEach(function(T){typeof T.runWhen=="function"&&T.runWhen(t)===!1||(l=l&&T.synchronous,a.unshift(T.fulfilled,T.rejected))});const u=[];this.interceptors.response.forEach(function(T){u.push(T.fulfilled,T.rejected)});let c,d=0,f;if(!l){const m=[mi.bind(this),void 0];for(m.unshift.apply(m,a),m.push.apply(m,u),f=m.length,c=Promise.resolve(t);d<f;)c=c.then(m[d++],m[d++]);return c}f=a.length;let _=t;for(d=0;d<f;){const m=a[d++],T=a[d++];try{_=m(_)}catch(p){T.call(this,p);break}}try{c=mi.call(this,_)}catch(m){return Promise.reject(m)}for(d=0,f=u.length;d<f;)c=c.then(u[d++],u[d++]);return c}getUri(e){e=Ne(this.defaults,e);const t=Xr(e.baseURL,e.url);return Jr(t,e.params,e.paramsSerializer)}}h.forEach(["delete","get","head","options"],function(e){Wt.prototype[e]=function(t,s){return this.request(Ne(s||{},{method:e,url:t,data:(s||{}).data}))}});h.forEach(["post","put","patch"],function(e){function t(s){return function(r,o,a){return this.request(Ne(a||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:r,data:o}))}}Wt.prototype[e]=t(),Wt.prototype[e+"Form"]=t(!0)});const Ft=Wt;class as{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(r){t=r});const s=this;this.promise.then(i=>{if(!s._listeners)return;let r=s._listeners.length;for(;r-- >0;)s._listeners[r](i);s._listeners=null}),this.promise.then=i=>{let r;const o=new Promise(a=>{s.subscribe(a),r=a}).then(i);return o.cancel=function(){s.unsubscribe(r)},o},e(function(r,o,a){s.reason||(s.reason=new Xe(r,o,a),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=s=>{e.abort(s)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new as(function(i){e=i}),cancel:e}}}const Ed=as;function Sd(n){return function(t){return n.apply(null,t)}}function wd(n){return h.isObject(n)&&n.isAxiosError===!0}const Hn={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Hn).forEach(([n,e])=>{Hn[e]=n});const bd=Hn;function so(n){const e=new Ft(n),t=Mr(Ft.prototype.request,e);return h.extend(t,Ft.prototype,e,{allOwnKeys:!0}),h.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return so(Ne(n,i))},t}const V=so(rs);V.Axios=Ft;V.CanceledError=Xe;V.CancelToken=Ed;V.isCancel=zr;V.VERSION=no;V.toFormData=Zt;V.AxiosError=w;V.Cancel=V.CanceledError;V.all=function(e){return Promise.all(e)};V.spread=Sd;V.isAxiosError=wd;V.mergeConfig=Ne;V.AxiosHeaders=X;V.formToJSON=n=>Gr(h.isHTMLForm(n)?new FormData(n):n);V.getAdapter=to.getAdapter;V.HttpStatusCode=bd;V.default=V;const io=V,cs=new URLSearchParams(window.location.search);function pe(n,e){const t=cs.get(n);if(t==null||t===""){if(e===void 0)throw new Error("Missing required url query parameter (string): "+n);return A("Using default value for string url query parameter: "+n+"="+e),e}return t}function gi(n,e){const t=cs.get(n);if(t==null||t===""){if(e===void 0)throw new Error("Missing required boolean url query parameter (boolean): "+n);return A("Using default value for bool url query parameter: "+n+"="+e),e}return t.toLowerCase()!=="false"}function _i(n,e){const t=cs.get(n);if(t==null||t===""){if(e===void 0)throw new Error("Missing required integer url query parameter (integer): "+n);return A("Using default value for integer url query parameter: "+n+"="+e),e}try{return parseInt(t)}catch{throw new Error(`Error parsing integer url query parameter: ${n}=${t}`)}}const M={DEBUG_MODE:gi("DEBUG_MODE",!1),SEND_LOGS:gi("SEND_LOGS",!1),ROV_NAME:pe("ROV_NAME","Default-ROV"),ROV_CONTROL_PASSWORD:pe("ROV_CONTROL_PASSWORD",""),LIVEKIT_API_KEY:pe("LIVEKIT_API_KEY"),LIVEKIT_SECRET_KEY:pe("LIVEKIT_SECRET_KEY"),TWITCH_STREAM_KEY:pe("TWITCH_STREAM_KEY","None"),PYTHON_WEBSOCKET_PORT:_i("PYTHON_WEBSOCKET_PORT",0),AUTH_TOKEN_TIMEOUT:_i("AUTH_TOKEN_TIMEOUT",Wo),BLUEOS_APIS_ENDPOINT:pe("BLUEOS_APIS_ENDPOINT",""),LIVEKIT_CLOUD_ENDPOINT:pe("LIVEKIT_CLOUD_URL","https://rov-web.livekit.cloud"),LIVEKIT_LOCAL_ENDPOINT:pe("LIVEKIT_LOCAL_URL","http://localhost:7880")},kd="/commander/v1.0";async function yi(n){return io({method:"post",url:`${M.BLUEOS_APIS_ENDPOINT+kd}/shutdown`,timeout:5e3,withCredentials:!1,params:{shutdown_type:n,i_know_what_i_am_doing:!0}}).then(e=>e.data).then(e=>"Shutting Down... "+String(e)).catch(e=>{var s;if(e.code==="ECONNABORTED")return"Shutting Down... ";const t=`Could not execute shutdown: ${e.code} - ${e.message} - ${e.message??((s=e.response)==null?void 0:s.data)}.`;throw logWarn(t),new Error(t)})}class Rd{constructor(){E(this,"_twitchStreamKey");E(this,"_egressClient");E(this,"roomName");E(this,"streamEgressID")}init(e,t,s,i){this.roomName=t,this._twitchStreamKey=e,this._egressClient=new Pr("https://rov-web.livekit.cloud",s,i)}async listRunningEgress(){if(!this._egressClient)throw new Error("Egress client not initialized!");return await this._egressClient.listEgress({active:!0})}isAnotherEgressRunning(e){return e.filter(t=>!this.streamEgressID||t.egressId!=this.streamEgressID).length>0}getCurrentEgress(e){return e.find(t=>t.roomName==this.roomName)}async closeOtherEgresses(e){return this._egressClient?Promise.allSettled(e.filter(t=>!this.streamEgressID||t.egressId!==this.streamEgressID).map(async t=>!this._egressClient||!t.egressId?!1:(x("Closing egress: ",t),await this._egressClient.stopEgress(t.egressId)))):!1}async startStream(){if(!this._twitchStreamKey||!this._egressClient||!this.roomName)return P("startStream() err: Twitch stream key not set or twitchStream class not initilized!");let e=await le(()=>this.listRunningEgress()),t=this.getCurrentEgress(e);if(t!==void 0){x("Found current twitch egress: ",t),this.streamEgressID=t.egressId;return}else{for(;await this.isAnotherEgressRunning(e)==!0;){const r=await this.closeOtherEgresses(e);if(A("egressCloseStates",r),x("Another twitch stream is running, waiting 2 seconds to try again..."),await mt(2e3),e=await this.listRunningEgress(),t=this.getCurrentEgress(e),t!==void 0){x("Found current twitch egress: ",t),this.streamEgressID=t.egressId;return}}const i=new we({protocol:ur.RTMP,urls:["rtmp://live.twitch.tv/app/"+this._twitchStreamKey]});var s=await le(()=>{var r;return(r=this._egressClient)==null?void 0:r.startRoomCompositeEgress(this.roomName,i)});this.streamEgressID=s.egressId,A("Twitch stream started: ",s)}}async stopStream(){if(!this._egressClient)return P("stopStream() err: Twitch Stream not started!");const e=this.streamEgressID;if(this.streamEgressID=void 0,e){const i=await le(()=>{var r;return(r=this==null?void 0:this._egressClient)==null?void 0:r.stopEgress(e)});A("Twitch stream stopped: ",i)}const t=await le(()=>this.listRunningEgress()),s=this.getCurrentEgress(t);if(s){A("Egress still running: ",s);const i=await le(()=>{var r;return(r=this==null?void 0:this._egressClient)==null?void 0:r.stopEgress(s.egressId)});A("Twitch stream stopped: ",i)}this.streamEgressID=void 0}}const Jt=new Rd;let Sn=null,wn=!1,ro=!1,it=0,bn=1;function Cd(n,e){var t,s,i,r,o,a,l,u,c,d,f;if(e.Ping)return K.sendMessage(O.RovResponse.create({Pong:{Time:e.Ping.Time}}),!1,[n]),ne.sendMessage(Hl()),!0;if(e.SimplePeerSignal&&e.SimplePeerSignal.Message){const _=e.SimplePeerSignal.Message;return K.ingestSimplePeerSignalMsg(n,_),!0}else if(e.Move){if(Sn&&Sn!==n||!wn)return!1;ro||ne.sendMessage(ti());let _=(e.Move.VelocityX||0)*1e3,m=(e.Move.VelocityY||0)*1e3,T=(e.Move.VelocityZ||0)*500+500,p=(e.Move.AngularVelocityYaw||0)*500,S=e.Move.ButtonBitmask||0;return S&&console.log("Move btn Message bitmask: ",S),ne.sendMessage(Kl(_,m,T,p,S)),!0}else{if(e.ShutdownRov)return yi("poweroff").then(_=>{K.sendMessage(O.RovResponse.create({ExchangeId:e.ExchangeId,Done:{Message:_}}),!1,[])}).catch(_=>{K.sendMessage(O.RovResponse.create({ExchangeId:e.ExchangeId,Error:{Message:_.message}}),!1,[])}),!0;if(e.RebootRov)return yi("reboot").then(_=>{K.sendMessage(O.RovResponse.create({ExchangeId:e.ExchangeId,Done:{Message:_}}),!1,[])}).catch(_=>{K.sendMessage(O.RovResponse.create({ExchangeId:e.ExchangeId,Error:{Message:_.message}}),!1,[])}),!0;if(e.MoveClaw)return A("Setting servo ",it," of group ",bn," to ",.25),ne.sendMessage(ql(it,.25,bn)),it==7?(it=0,bn++):it++,!0;if(e.SetAutopilotMode)return ne.sendMessage(Vl(e.SetAutopilotMode.mode)),!0;if(e.Disarm)return ne.sendMessage(Ul()),wn=!1,!0;if(e.TakeControl)return Sn=n,K.sendMessage(O.RovResponse.create({PilotChanged:{PilotIdentity:n}}),!1,[]),wn=!0,ne.sendMessage(ti()),!0;if(e.SendRovLogs){const _={};return _[Ze.Console]=O.LogLevel.Debug,_[Ze.Debug]=O.LogLevel.Debug,_[Ze.Info]=O.LogLevel.Info,_[Ze.Warn]=O.LogLevel.Warning,_[Ze.Error]=O.LogLevel.Error,jt.sendQueuedLogs((m,T)=>{const p=O.RovResponse.create({LogMessage:{Level:_[m],Message:T}});return K.sendMessage(p,!0,[])}),!0}else if(e.SetLivestreamingEnabled)e.SetLivestreamingEnabled.Enabled?Jt.startStream():Jt.stopStream();else if(e.SetLivekitVideoOptions){const _=rt.videoCaptureDefaults,m=rt.publishDefaults,T=e.SetLivekitVideoOptions,p=T.BaseStream;if(!T.Enabled)return K.setLivekitVideoOptions(!1),!0;A("Got Livekit Video Options: ",T);const S=16/9,k={..._,resolution:{width:(p==null?void 0:p.Width)||Math.floor(((p==null?void 0:p.Height)||0)*S)||((t=_==null?void 0:_.resolution)==null?void 0:t.height)||1920,height:(p==null?void 0:p.Height)||Math.floor(((p==null?void 0:p.Width)||0)/S)||((s=_==null?void 0:_.resolution)==null?void 0:s.height)||1080,frameRate:(p==null?void 0:p.Fps)||((i=_==null?void 0:_.resolution)==null?void 0:i.frameRate)},facingMode:_==null?void 0:_.facingMode},v=T.SimulcastLayers?T.SimulcastLayers.map((I,W)=>{var Re,Es,Ss,ws;const B=m!=null&&m.videoSimulcastLayers?m==null?void 0:m.videoSimulcastLayers[W]:void 0;return{encoding:{maxBitrate:(p==null?void 0:p.MaxBitrate)??((Re=B==null?void 0:B.encoding)==null?void 0:Re.maxBitrate),maxFramerate:I.Fps||((Es=B==null?void 0:B.encoding)==null?void 0:Es.maxFramerate),priority:"high"},width:I.Width||(I.Height?I.Height*S:null)||(B==null?void 0:B.width)||((Ss=_==null?void 0:_.resolution)==null?void 0:Ss.width),height:I.Height||(I.Width?I.Width/S:null)||(B==null?void 0:B.height)||((ws=_==null?void 0:_.resolution)==null?void 0:ws.height)}}):m==null?void 0:m.videoSimulcastLayers,R=T.Codec?O.VideoCodec[T.Codec].toLowerCase():m==null?void 0:m.videoCodec,L={...m,videoCodec:R,videoEncoding:{maxBitrate:(p==null?void 0:p.MaxBitrate)??((r=m==null?void 0:m.videoEncoding)==null?void 0:r.maxBitrate)??0,maxFramerate:(p==null?void 0:p.Fps)||((o=m==null?void 0:m.videoEncoding)==null?void 0:o.maxFramerate),priority:(a=m==null?void 0:m.videoEncoding)==null?void 0:a.priority},backupCodec:T.AllowBackupCodec??(m==null?void 0:m.backupCodec),simulcast:T.SimulcastLayers?T.SimulcastLayers.length>0:m==null?void 0:m.simulcast,videoSimulcastLayers:v};return console.log("Setting Livekit Video Options: ",k,L),K.setLivekitVideoOptions(!0,k,L),!0}else if(e.SetSimplePeerVideoOptions){const _=rt.videoCaptureDefaults,m=rt.publishDefaults,T=e.SetSimplePeerVideoOptions,p=T.BaseStream;if(A("Got SimplePeer Video Options: ",T),!T.Enabled)return K.setSimplePeerVideoOptions(!1,n),!0;const S=16/9,k={..._,resolution:{width:Math.floor(((p==null?void 0:p.Height)||((l=_==null?void 0:_.resolution)==null?void 0:l.height)||0)*S),height:(p==null?void 0:p.Height)||((u=_==null?void 0:_.resolution)==null?void 0:u.height)||0,frameRate:(p==null?void 0:p.Fps)||((c=_==null?void 0:_.resolution)==null?void 0:c.frameRate)||60},facingMode:_==null?void 0:_.facingMode},R={videoCodec:T.Codec?O.VideoCodec[T.Codec].toLowerCase():m==null?void 0:m.videoCodec,videoEncoding:{maxBitrate:(p==null?void 0:p.MaxBitrate)||((d=m==null?void 0:m.videoEncoding)==null?void 0:d.maxBitrate)||0,maxFramerate:(p==null?void 0:p.Fps)||((f=m==null?void 0:m.videoEncoding)==null?void 0:f.maxFramerate)}};return K.setSimplePeerVideoOptions(!0,n,k,R),!0}else return P("Unknown Message Recived: ",e.toJSON()),!1}}function Ti(n,e){let t=new Uint8Array(e);if(!t||t.length===0)return;const s=O.RovAction.decode(t);if(Cd(n,s))return;s.BackendMetadata=s.BackendMetadata||new O.ActionBackendMetadata,s.BackendMetadata.FromUserId=n;const i=O.RovAction.encode(s).finish();Kt.isConnected&&Kt.sendMessage(i)}function Ad(n){if(!n||!n.message)return;const e=n.message;e.type&&e.type==="HEARTBEAT"&&(ro=!!(e.base_mode.bits&In.MAV_MODE_FLAG_SAFETY_ARMED))}let qe=[];function se(n){let e=[],t=(o,a=!0)=>(e.includes(o)||e.push(o),a&&o(n),()=>{e=e.filter(l=>l!=o)});function s(o){if(o===n&&(n===null||typeof n!="object"))return;let a=n;n=o;for(let l of e)l(n,a)}function i(){let o=qe[qe.length-1];return o&&t(o[0],!1),n}if(typeof n=="function")return vd(n);function r(){for(let o of e)o(n,n)}return{subscribe:t,set:s,get:i,refresh:r,update:o=>{typeof o=="function"&&s(o(n))}}}function vd(n){let e=se(null),t=[s];return s(),e;function s(){if(qe.includes(t))throw Error("Circular computation");qe.push(t);let i;try{i=n()}catch(r){throw qe.pop(),r}qe.pop(),e.set(i)}}var Kn={exports:{}},kn,Ei;function Id(){if(Ei)return kn;Ei=1;var n=1e3,e=n*60,t=e*60,s=t*24,i=s*7,r=s*365.25;kn=function(c,d){d=d||{};var f=typeof c;if(f==="string"&&c.length>0)return o(c);if(f==="number"&&isFinite(c))return d.long?l(c):a(c);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(c))};function o(c){if(c=String(c),!(c.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(c);if(d){var f=parseFloat(d[1]),_=(d[2]||"ms").toLowerCase();switch(_){case"years":case"year":case"yrs":case"yr":case"y":return f*r;case"weeks":case"week":case"w":return f*i;case"days":case"day":case"d":return f*s;case"hours":case"hour":case"hrs":case"hr":case"h":return f*t;case"minutes":case"minute":case"mins":case"min":case"m":return f*e;case"seconds":case"second":case"secs":case"sec":case"s":return f*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return f;default:return}}}}function a(c){var d=Math.abs(c);return d>=s?Math.round(c/s)+"d":d>=t?Math.round(c/t)+"h":d>=e?Math.round(c/e)+"m":d>=n?Math.round(c/n)+"s":c+"ms"}function l(c){var d=Math.abs(c);return d>=s?u(c,d,s,"day"):d>=t?u(c,d,t,"hour"):d>=e?u(c,d,e,"minute"):d>=n?u(c,d,n,"second"):c+" ms"}function u(c,d,f,_){var m=d>=f*1.5;return Math.round(c/f)+" "+_+(m?"s":"")}return kn}function Nd(n){t.debug=t,t.default=t,t.coerce=l,t.disable=r,t.enable=i,t.enabled=o,t.humanize=Id(),t.destroy=u,Object.keys(n).forEach(c=>{t[c]=n[c]}),t.names=[],t.skips=[],t.formatters={};function e(c){let d=0;for(let f=0;f<c.length;f++)d=(d<<5)-d+c.charCodeAt(f),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(c){let d,f=null,_,m;function T(...p){if(!T.enabled)return;const S=T,k=Number(new Date),v=k-(d||k);S.diff=v,S.prev=d,S.curr=k,d=k,p[0]=t.coerce(p[0]),typeof p[0]!="string"&&p.unshift("%O");let R=0;p[0]=p[0].replace(/%([a-zA-Z%])/g,(I,W)=>{if(I==="%%")return"%";R++;const B=t.formatters[W];if(typeof B=="function"){const Re=p[R];I=B.call(S,Re),p.splice(R,1),R--}return I}),t.formatArgs.call(S,p),(S.log||t.log).apply(S,p)}return T.namespace=c,T.useColors=t.useColors(),T.color=t.selectColor(c),T.extend=s,T.destroy=t.destroy,Object.defineProperty(T,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(_!==t.namespaces&&(_=t.namespaces,m=t.enabled(c)),m),set:p=>{f=p}}),typeof t.init=="function"&&t.init(T),T}function s(c,d){const f=t(this.namespace+(typeof d>"u"?":":d)+c);return f.log=this.log,f}function i(c){t.save(c),t.namespaces=c,t.names=[],t.skips=[];let d;const f=(typeof c=="string"?c:"").split(/[\s,]+/),_=f.length;for(d=0;d<_;d++)f[d]&&(c=f[d].replace(/\*/g,".*?"),c[0]==="-"?t.skips.push(new RegExp("^"+c.slice(1)+"$")):t.names.push(new RegExp("^"+c+"$")))}function r(){const c=[...t.names.map(a),...t.skips.map(a).map(d=>"-"+d)].join(",");return t.enable(""),c}function o(c){if(c[c.length-1]==="*")return!0;let d,f;for(d=0,f=t.skips.length;d<f;d++)if(t.skips[d].test(c))return!1;for(d=0,f=t.names.length;d<f;d++)if(t.names[d].test(c))return!0;return!1}function a(c){return c.toString().substring(2,c.toString().length-2).replace(/\.\*\?$/,"*")}function l(c){return c instanceof Error?c.stack||c.message:c}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var Od=Nd;(function(n,e){e.formatArgs=s,e.save=i,e.load=r,e.useColors=t,e.storage=o(),e.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let l;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(l=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(l[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;l.splice(1,0,u,"color: inherit");let c=0,d=0;l[0].replace(/%[a-zA-Z%]/g,f=>{f!=="%%"&&(c++,f==="%c"&&(d=c))}),l.splice(d,0,u)}e.log=console.debug||console.log||(()=>{});function i(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch{}}function r(){let l;try{l=e.storage.getItem("debug")}catch{}return!l&&typeof ye.process<"u"&&"env"in ye.process&&(l={}.DEBUG),l}function o(){try{return localStorage}catch{}}n.exports=Od(e);const{formatters:a}=n.exports;a.j=function(l){try{return JSON.stringify(l)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(Kn,Kn.exports);var Pd=Kn.exports;const Ld=Vi(Pd),ue=typeof window<"u"?window:self,qn=ue.RTCPeerConnection||ue.mozRTCPeerConnection||ue.webkitRTCPeerConnection,Md=ue.RTCSessionDescription||ue.mozRTCSessionDescription||ue.webkitRTCSessionDescription,Dd=ue.RTCIceCandidate||ue.mozRTCIceCandidate||ue.webkitRTCIceCandidate;var ls={exports:{}},$e=typeof Reflect=="object"?Reflect:null,Si=$e&&typeof $e.apply=="function"?$e.apply:function(e,t,s){return Function.prototype.apply.call(e,t,s)},Ut;$e&&typeof $e.ownKeys=="function"?Ut=$e.ownKeys:Object.getOwnPropertySymbols?Ut=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Ut=function(e){return Object.getOwnPropertyNames(e)};function xd(n){console&&console.warn&&console.warn(n)}var oo=Number.isNaN||function(e){return e!==e};function C(){C.init.call(this)}ls.exports=C;ls.exports.once=Vd;C.EventEmitter=C;C.prototype._events=void 0;C.prototype._eventsCount=0;C.prototype._maxListeners=void 0;var wi=10;function nn(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(C,"defaultMaxListeners",{enumerable:!0,get:function(){return wi},set:function(n){if(typeof n!="number"||n<0||oo(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");wi=n}});C.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};C.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||oo(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function ao(n){return n._maxListeners===void 0?C.defaultMaxListeners:n._maxListeners}C.prototype.getMaxListeners=function(){return ao(this)};C.prototype.emit=function(e){for(var t=[],s=1;s<arguments.length;s++)t.push(arguments[s]);var i=e==="error",r=this._events;if(r!==void 0)i=i&&r.error===void 0;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=r[e];if(l===void 0)return!1;if(typeof l=="function")Si(l,this,t);else for(var u=l.length,c=fo(l,u),s=0;s<u;++s)Si(c[s],this,t);return!0};function co(n,e,t,s){var i,r,o;if(nn(t),r=n._events,r===void 0?(r=n._events=Object.create(null),n._eventsCount=0):(r.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),r=n._events),o=r[e]),o===void 0)o=r[e]=t,++n._eventsCount;else if(typeof o=="function"?o=r[e]=s?[t,o]:[o,t]:s?o.unshift(t):o.push(t),i=ao(n),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=n,a.type=e,a.count=o.length,xd(a)}return n}C.prototype.addListener=function(e,t){return co(this,e,t,!1)};C.prototype.on=C.prototype.addListener;C.prototype.prependListener=function(e,t){return co(this,e,t,!0)};function Fd(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function lo(n,e,t){var s={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},i=Fd.bind(s);return i.listener=t,s.wrapFn=i,i}C.prototype.once=function(e,t){return nn(t),this.on(e,lo(this,e,t)),this};C.prototype.prependOnceListener=function(e,t){return nn(t),this.prependListener(e,lo(this,e,t)),this};C.prototype.removeListener=function(e,t){var s,i,r,o,a;if(nn(t),i=this._events,i===void 0)return this;if(s=i[e],s===void 0)return this;if(s===t||s.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,s.listener||t));else if(typeof s!="function"){for(r=-1,o=s.length-1;o>=0;o--)if(s[o]===t||s[o].listener===t){a=s[o].listener,r=o;break}if(r<0)return this;r===0?s.shift():Ud(s,r),s.length===1&&(i[e]=s[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};C.prototype.off=C.prototype.removeListener;C.prototype.removeAllListeners=function(e){var t,s,i;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[e]),this;if(arguments.length===0){var r=Object.keys(s),o;for(i=0;i<r.length;++i)o=r[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=s[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function uo(n,e,t){var s=n._events;if(s===void 0)return[];var i=s[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?Bd(i):fo(i,i.length)}C.prototype.listeners=function(e){return uo(this,e,!0)};C.prototype.rawListeners=function(e){return uo(this,e,!1)};C.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):ho.call(n,e)};C.prototype.listenerCount=ho;function ho(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}C.prototype.eventNames=function(){return this._eventsCount>0?Ut(this._events):[]};function fo(n,e){for(var t=new Array(e),s=0;s<e;++s)t[s]=n[s];return t}function Ud(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function Bd(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function Vd(n,e){return new Promise(function(t,s){function i(o){n.removeListener(e,r),s(o)}function r(){typeof n.removeListener=="function"&&n.removeListener("error",i),t([].slice.call(arguments))}mo(n,e,r,{once:!0}),e!=="error"&&Hd(n,i,{once:!0})})}function Hd(n,e,t){typeof n.on=="function"&&mo(n,"error",e,t)}function mo(n,e,t,s){if(typeof n.on=="function")s.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function i(r){s.once&&n.removeEventListener(e,i),t(r)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var Kd=ls.exports,qd=typeof queueMicrotask=="function"?queueMicrotask:n=>Promise.resolve().then(n),$d=class{constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return this.buffer[this.btm]===void 0}};const bi=$d;var Wd=class{constructor(e){this.hwm=e||16,this.head=new bi(this.hwm),this.tail=this.head,this.length=0}clear(){this.head=this.tail,this.head.clear(),this.length=0}push(e){if(this.length++,!this.head.push(e)){const t=this.head;this.head=t.next=new bi(2*this.head.buffer.length),this.head.push(e)}}shift(){this.length!==0&&this.length--;const e=this.tail.shift();if(e===void 0&&this.tail.next){const t=this.tail.next;return this.tail.next=null,this.tail=t,this.tail.shift()}return e}peek(){const e=this.tail.peek();return e===void 0&&this.tail.next?this.tail.next.peek():e}isEmpty(){return this.length===0}},po=class{constructor(e){this.decoder=new TextDecoder(e==="utf16le"?"utf16-le":e)}decode(e){return this.decoder.decode(e,{stream:!0})}flush(){return this.decoder.decode(new Uint8Array(0))}};const Jd=po,jd=po;var Gd=class{constructor(e="utf8"){switch(this.encoding=zd(e),this.encoding){case"utf8":this.decoder=new jd;break;case"utf16le":case"base64":throw new Error("Unsupported encoding: "+this.encoding);default:this.decoder=new Jd(this.encoding)}}push(e){return typeof e=="string"?e:this.decoder.decode(e)}write(e){return this.push(e)}end(e){let t="";return e&&(t=this.push(e)),t+=this.decoder.flush(),t}};function zd(n){switch(n=n.toLowerCase(),n){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return n;default:throw new Error("Unknown encoding: "+n)}}const{EventEmitter:Yd}=Kd,sn=new Error("Stream was destroyed"),Rn=new Error("Premature close"),go=qd,_o=Wd,Xd=Gd,D=(1<<29)-1,xe=1,us=2,Oe=4,lt=8,yo=D^xe,Qd=D^us,wt=16,ut=32,Qe=64,_e=128,bt=256,ds=512,Pe=1024,$n=2048,hs=4096,fs=8192,Q=16384,We=32768,rn=65536,Le=131072,To=bt|ds,Zd=wt|rn,eh=Qe|wt,th=hs|_e,ms=bt|Le,nh=D^wt,sh=D^Qe,ih=D^(Qe|rn),ki=D^rn,rh=D^bt,oh=D^(_e|fs),ah=D^Pe,Ri=D^To,Eo=D^We,ch=D^ut,So=D^Le,lh=D^ms,ke=1<<18,Ge=2<<18,kt=4<<18,Me=8<<18,Rt=16<<18,Fe=32<<18,Wn=64<<18,Je=128<<18,ps=256<<18,ze=512<<18,on=1024<<18,wo=D^(ke|ps),bo=D^kt,uh=D^ze,dh=D^Rt,hh=D^Me,ko=D^Je,fh=D^Ge,Ro=D^on,dt=wt|ke,Co=D^dt,gs=Q|Fe,de=Oe|lt|us,z=de|xe,Ao=de|gs,mh=bo&sh,_s=Je|We,ph=_s&Co,vo=z|ph,gh=z|Pe|Q,Ci=z|Q|_e,_h=z|Pe|_e,yh=z|hs|_e|fs,Th=z|wt|Pe|Q|rn|Le,Eh=de|Pe|Q,Sh=ut|z|We|Qe,wh=z|ze|Fe,bh=Me|Rt,Io=Me|ke,kh=Me|Rt|z|ke,Ai=z|ke|Me|on,Rh=kt|ke,Ch=ke|ps,Ah=z|ze|Io|Fe,vh=Rt|de|ze|Fe,Ih=Ge|z|Je|kt,vt=Symbol.asyncIterator||Symbol("asyncIterator");class No{constructor(e,{highWaterMark:t=16384,map:s=null,mapWritable:i,byteLength:r,byteLengthWritable:o}={}){this.stream=e,this.queue=new _o,this.highWaterMark=t,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=o||r||Fo,this.map=i||s,this.afterWrite=Dh.bind(this),this.afterUpdateNextTick=Uh.bind(this)}get ended(){return(this.stream._duplexState&Fe)!==0}push(e){return this.map!==null&&(e=this.map(e)),this.buffered+=this.byteLength(e),this.queue.push(e),this.buffered<this.highWaterMark?(this.stream._duplexState|=Me,!0):(this.stream._duplexState|=bh,!1)}shift(){const e=this.queue.shift();return this.buffered-=this.byteLength(e),this.buffered===0&&(this.stream._duplexState&=hh),e}end(e){typeof e=="function"?this.stream.once("finish",e):e!=null&&this.push(e),this.stream._duplexState=(this.stream._duplexState|ze)&bo}autoBatch(e,t){const s=[],i=this.stream;for(s.push(e);(i._duplexState&Ai)===Io;)s.push(i._writableState.shift());if(i._duplexState&z)return t(null);i._writev(s,t)}update(){const e=this.stream;e._duplexState|=Ge;do{for(;(e._duplexState&Ai)===Me;){const t=this.shift();e._duplexState|=Ch,e._write(t,this.afterWrite)}e._duplexState&Rh||this.updateNonPrimary()}while(this.continueUpdate()===!0);e._duplexState&=fh}updateNonPrimary(){const e=this.stream;if((e._duplexState&Ah)===ze){e._duplexState=(e._duplexState|ke)&uh,e._final(Mh.bind(this));return}if((e._duplexState&de)===Oe){e._duplexState&_s||(e._duplexState|=dt,e._destroy(Oo.bind(this)));return}(e._duplexState&vo)===xe&&(e._duplexState=(e._duplexState|dt)&yo,e._open(Po.bind(this)))}continueUpdate(){return this.stream._duplexState&Je?(this.stream._duplexState&=ko,!0):!1}updateCallback(){(this.stream._duplexState&Ih)===kt?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&Je||(this.stream._duplexState|=Je,this.stream._duplexState&Ge||go(this.afterUpdateNextTick))}}class Nh{constructor(e,{highWaterMark:t=16384,map:s=null,mapReadable:i,byteLength:r,byteLengthReadable:o}={}){this.stream=e,this.queue=new _o,this.highWaterMark=t===0?1:t,this.buffered=0,this.readAhead=t>0,this.error=null,this.pipeline=null,this.byteLength=o||r||Fo,this.map=i||s,this.pipeTo=null,this.afterRead=xh.bind(this),this.afterUpdateNextTick=Fh.bind(this)}get ended(){return(this.stream._duplexState&Q)!==0}pipe(e,t){if(this.pipeTo!==null)throw new Error("Can only pipe to one destination");if(typeof t!="function"&&(t=null),this.stream._duplexState|=ds,this.pipeTo=e,this.pipeline=new Ph(this.stream,e,t),t&&this.stream.on("error",vi),ft(e))e._writableState.pipeline=this.pipeline,t&&e.on("error",vi),e.on("finish",this.pipeline.finished.bind(this.pipeline));else{const s=this.pipeline.done.bind(this.pipeline,e),i=this.pipeline.done.bind(this.pipeline,e,null);e.on("error",s),e.on("close",i),e.on("finish",this.pipeline.finished.bind(this.pipeline))}e.on("drain",Lh.bind(this)),this.stream.emit("piping",e),e.emit("pipe",this.stream)}push(e){const t=this.stream;return e===null?(this.highWaterMark=0,t._duplexState=(t._duplexState|Pe)&ih,!1):this.map!==null&&(e=this.map(e),e===null)?(t._duplexState&=ki,this.buffered<this.highWaterMark):(this.buffered+=this.byteLength(e),this.queue.push(e),t._duplexState=(t._duplexState|_e)&ki,this.buffered<this.highWaterMark)}shift(){const e=this.queue.shift();return this.buffered-=this.byteLength(e),this.buffered===0&&(this.stream._duplexState&=oh),e}unshift(e){const t=[this.map!==null?this.map(e):e];for(;this.buffered>0;)t.push(this.shift());for(let s=0;s<t.length-1;s++){const i=t[s];this.buffered+=this.byteLength(i),this.queue.push(i)}this.push(t[t.length-1])}read(){const e=this.stream;if((e._duplexState&Ci)===_e){const t=this.shift();return this.pipeTo!==null&&this.pipeTo.write(t)===!1&&(e._duplexState&=Ri),e._duplexState&$n&&e.emit("data",t),t}return this.readAhead===!1&&(e._duplexState|=Le,this.updateNextTick()),null}drain(){const e=this.stream;for(;(e._duplexState&Ci)===_e&&e._duplexState&To;){const t=this.shift();this.pipeTo!==null&&this.pipeTo.write(t)===!1&&(e._duplexState&=Ri),e._duplexState&$n&&e.emit("data",t)}}update(){const e=this.stream;e._duplexState|=ut;do{for(this.drain();this.buffered<this.highWaterMark&&(e._duplexState&Th)===Le;)e._duplexState|=Zd,e._read(this.afterRead),this.drain();(e._duplexState&yh)===th&&(e._duplexState|=fs,e.emit("readable")),e._duplexState&eh||this.updateNonPrimary()}while(this.continueUpdate()===!0);e._duplexState&=ch}updateNonPrimary(){const e=this.stream;if((e._duplexState&_h)===Pe&&(e._duplexState=(e._duplexState|Q)&ah,e.emit("end"),(e._duplexState&Ao)===gs&&(e._duplexState|=Oe),this.pipeTo!==null&&this.pipeTo.end()),(e._duplexState&de)===Oe){e._duplexState&_s||(e._duplexState|=dt,e._destroy(Oo.bind(this)));return}(e._duplexState&vo)===xe&&(e._duplexState=(e._duplexState|dt)&yo,e._open(Po.bind(this)))}continueUpdate(){return this.stream._duplexState&We?(this.stream._duplexState&=Eo,!0):!1}updateCallback(){(this.stream._duplexState&Sh)===Qe?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&We||(this.stream._duplexState|=We,this.stream._duplexState&ut||go(this.afterUpdateNextTick))}}class Oh{constructor(e){this.data=null,this.afterTransform=Vh.bind(e),this.afterFinal=null}}class Ph{constructor(e,t,s){this.from=e,this.to=t,this.afterPipe=s,this.error=null,this.pipeToFinished=!1}finished(){this.pipeToFinished=!0}done(e,t){if(t&&(this.error=t),e===this.to&&(this.to=null,this.from!==null)){(!(this.from._duplexState&Q)||!this.pipeToFinished)&&this.from.destroy(this.error||new Error("Writable stream closed prematurely"));return}if(e===this.from&&(this.from=null,this.to!==null)){e._duplexState&Q||this.to.destroy(this.error||new Error("Readable stream closed before ending"));return}this.afterPipe!==null&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null}}function Lh(){this.stream._duplexState|=ds,this.updateCallback()}function Mh(n){const e=this.stream;n&&e.destroy(n),e._duplexState&de||(e._duplexState|=Fe,e.emit("finish")),(e._duplexState&Ao)===gs&&(e._duplexState|=Oe),e._duplexState&=wo,e._duplexState&Ge?this.updateNextTick():this.update()}function Oo(n){const e=this.stream;!n&&this.error!==sn&&(n=this.error),n&&e.emit("error",n),e._duplexState|=lt,e.emit("close");const t=e._readableState,s=e._writableState;if(t!==null&&t.pipeline!==null&&t.pipeline.done(e,n),s!==null){for(;s.drains!==null&&s.drains.length>0;)s.drains.shift().resolve(!1);s.pipeline!==null&&s.pipeline.done(e,n)}}function Dh(n){const e=this.stream;n&&e.destroy(n),e._duplexState&=wo,this.drains!==null&&Bh(this.drains),(e._duplexState&kh)===Rt&&(e._duplexState&=dh,(e._duplexState&Wn)===Wn&&e.emit("drain")),this.updateCallback()}function xh(n){n&&this.stream.destroy(n),this.stream._duplexState&=nh,this.readAhead===!1&&!(this.stream._duplexState&bt)&&(this.stream._duplexState&=So),this.updateCallback()}function Fh(){this.stream._duplexState&ut||(this.stream._duplexState&=Eo,this.update())}function Uh(){this.stream._duplexState&Ge||(this.stream._duplexState&=ko,this.update())}function Bh(n){for(let e=0;e<n.length;e++)--n[e].writes===0&&(n.shift().resolve(!0),e--)}function Po(n){const e=this.stream;n&&e.destroy(n),e._duplexState&Oe||(e._duplexState&gh||(e._duplexState|=Qe),e._duplexState&wh||(e._duplexState|=kt),e.emit("open")),e._duplexState&=Co,e._writableState!==null&&e._writableState.updateCallback(),e._readableState!==null&&e._readableState.updateCallback()}function Vh(n,e){e!=null&&this.push(e),this._writableState.afterWrite(n)}function Hh(n){this._readableState!==null&&(n==="data"&&(this._duplexState|=$n|ms,this._readableState.updateNextTick()),n==="readable"&&(this._duplexState|=hs,this._readableState.updateNextTick())),this._writableState!==null&&n==="drain"&&(this._duplexState|=Wn,this._writableState.updateNextTick())}class ys extends Yd{constructor(e){super(),this._duplexState=0,this._readableState=null,this._writableState=null,e&&(e.open&&(this._open=e.open),e.destroy&&(this._destroy=e.destroy),e.predestroy&&(this._predestroy=e.predestroy),e.signal&&e.signal.addEventListener("abort",Xh.bind(this))),this.on("newListener",Hh)}_open(e){e(null)}_destroy(e){e(null)}_predestroy(){}get readable(){return this._readableState!==null?!0:void 0}get writable(){return this._writableState!==null?!0:void 0}get destroyed(){return(this._duplexState&lt)!==0}get destroying(){return(this._duplexState&de)!==0}destroy(e){this._duplexState&de||(e||(e=sn),this._duplexState=(this._duplexState|Oe)&mh,this._readableState!==null&&(this._readableState.highWaterMark=0,this._readableState.error=e),this._writableState!==null&&(this._writableState.highWaterMark=0,this._writableState.error=e),this._duplexState|=us,this._predestroy(),this._duplexState&=Qd,this._readableState!==null&&this._readableState.updateNextTick(),this._writableState!==null&&this._writableState.updateNextTick())}}class ht extends ys{constructor(e){super(e),this._duplexState|=xe|Fe|Le,this._readableState=new Nh(this,e),e&&(this._readableState.readAhead===!1&&(this._duplexState&=So),e.read&&(this._read=e.read),e.eagerOpen&&this._readableState.updateNextTick(),e.encoding&&this.setEncoding(e.encoding))}setEncoding(e){const t=new Xd(e),s=this._readableState.map||Wh;return this._readableState.map=i,this;function i(r){const o=t.push(r);return o===""?null:s(o)}}_read(e){e(null)}pipe(e,t){return this._readableState.updateNextTick(),this._readableState.pipe(e,t),e}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(e){return this._readableState.updateNextTick(),this._readableState.push(e)}unshift(e){return this._readableState.updateNextTick(),this._readableState.unshift(e)}resume(){return this._duplexState|=ms,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=this._readableState.readAhead===!1?lh:rh,this}static _fromAsyncIterator(e,t){let s;const i=new ht({...t,read(o){e.next().then(r).then(o.bind(null,null)).catch(o)},predestroy(){s=e.return()},destroy(o){if(!s)return o(null);s.then(o.bind(null,null)).catch(o)}});return i;function r(o){o.done?i.push(null):i.push(o.value)}}static from(e,t){if(zh(e))return e;if(e[vt])return this._fromAsyncIterator(e[vt](),t);Array.isArray(e)||(e=e===void 0?[]:[e]);let s=0;return new ht({...t,read(i){this.push(s===e.length?null:e[s++]),i(null)}})}static isBackpressured(e){return(e._duplexState&Eh)!==0||e._readableState.buffered>=e._readableState.highWaterMark}static isPaused(e){return(e._duplexState&bt)===0}[vt](){const e=this;let t=null,s=null,i=null;return this.on("error",u=>{t=u}),this.on("readable",r),this.on("close",o),{[vt](){return this},next(){return new Promise(function(u,c){s=u,i=c;const d=e.read();d!==null?a(d):e._duplexState&lt&&a(null)})},return(){return l(null)},throw(u){return l(u)}};function r(){s!==null&&a(e.read())}function o(){s!==null&&a(null)}function a(u){i!==null&&(t?i(t):u===null&&!(e._duplexState&Q)?i(sn):s({value:u,done:u===null}),i=s=null)}function l(u){return e.destroy(u),new Promise((c,d)=>{if(e._duplexState&lt)return c({value:void 0,done:!0});e.once("close",function(){u?d(u):c({value:void 0,done:!0})})})}}}class Lo extends ys{constructor(e){super(e),this._duplexState|=xe|Q,this._writableState=new No(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final),e.eagerOpen&&this._writableState.updateNextTick())}cork(){this._duplexState|=on}uncork(){this._duplexState&=Ro,this._writableState.updateNextTick()}_writev(e,t){t(null)}_write(e,t){this._writableState.autoBatch(e,t)}_final(e){e(null)}static isBackpressured(e){return(e._duplexState&vh)!==0}static drained(e){if(e.destroyed)return Promise.resolve(!1);const t=e._writableState,i=(Qh(e)?Math.min(1,t.queue.length):t.queue.length)+(e._duplexState&ps?1:0);return i===0?Promise.resolve(!0):(t.drains===null&&(t.drains=[]),new Promise(r=>{t.drains.push({writes:i,resolve:r})}))}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}class Ts extends ht{constructor(e){super(e),this._duplexState=xe|this._duplexState&Le,this._writableState=new No(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final))}cork(){this._duplexState|=on}uncork(){this._duplexState&=Ro,this._writableState.updateNextTick()}_writev(e,t){t(null)}_write(e,t){this._writableState.autoBatch(e,t)}_final(e){e(null)}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}class Mo extends Ts{constructor(e){super(e),this._transformState=new Oh(this),e&&(e.transform&&(this._transform=e.transform),e.flush&&(this._flush=e.flush))}_write(e,t){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=e:this._transform(e,this._transformState.afterTransform)}_read(e){if(this._transformState.data!==null){const t=this._transformState.data;this._transformState.data=null,e(null),this._transform(t,this._transformState.afterTransform)}else e(null)}destroy(e){super.destroy(e),this._transformState.data!==null&&(this._transformState.data=null,this._transformState.afterTransform())}_transform(e,t){t(null,e)}_flush(e){e(null)}_final(e){this._transformState.afterFinal=e,this._flush(qh.bind(this))}}class Kh extends Mo{}function qh(n,e){const t=this._transformState.afterFinal;if(n)return t(n);e!=null&&this.push(e),this.push(null),t(null)}function $h(...n){return new Promise((e,t)=>Do(...n,s=>{if(s)return t(s);e()}))}function Do(n,...e){const t=Array.isArray(n)?[...n,...e]:[n,...e],s=t.length&&typeof t[t.length-1]=="function"?t.pop():null;if(t.length<2)throw new Error("Pipeline requires at least 2 streams");let i=t[0],r=null,o=null;for(let u=1;u<t.length;u++)r=t[u],ft(i)?i.pipe(r,l):(a(i,!0,u>1,l),i.pipe(r)),i=r;if(s){let u=!1;const c=ft(r)||!!(r._writableState&&r._writableState.autoDestroy);r.on("error",d=>{o===null&&(o=d)}),r.on("finish",()=>{u=!0,c||s(o)}),c&&r.on("close",()=>s(o||(u?null:Rn)))}return r;function a(u,c,d,f){u.on("error",f),u.on("close",_);function _(){if(c&&u._readableState&&!u._readableState.ended||d&&u._writableState&&!u._writableState.ended)return f(Rn)}}function l(u){if(!(!u||o)){o=u;for(const c of t)c.destroy(u)}}}function Wh(n){return n}function xo(n){return!!n._readableState||!!n._writableState}function ft(n){return typeof n._duplexState=="number"&&xo(n)}function Jh(n){return!!n._readableState&&n._readableState.ended}function jh(n){return!!n._writableState&&n._writableState.ended}function Gh(n,e={}){const t=n._readableState&&n._readableState.error||n._writableState&&n._writableState.error;return!e.all&&t===sn?null:t}function zh(n){return ft(n)&&n.readable}function Yh(n){return typeof n=="object"&&n!==null&&typeof n.byteLength=="number"}function Fo(n){return Yh(n)?n.byteLength:1024}function vi(){}function Xh(){this.destroy(new Error("Stream aborted."))}function Qh(n){return n._writev!==Lo.prototype._writev&&n._writev!==Ts.prototype._writev}var Zh={pipeline:Do,pipelinePromise:$h,isStream:xo,isStreamx:ft,isEnded:Jh,isFinished:jh,getStreamError:Gh,Stream:ys,Writable:Lo,Readable:ht,Duplex:Ts,Transform:Mo,PassThrough:Kh};function Ii(n,e){for(const t in e)Object.defineProperty(n,t,{value:e[t],enumerable:!0,configurable:!0});return n}function ef(n,e,t){if(!n||typeof n=="string")throw new TypeError("Please pass an Error to err-code");t||(t={}),typeof e=="object"&&(t=e,e=""),e&&(t.code=e);try{return Ii(n,t)}catch{t.message=n.message,t.stack=n.stack;const i=function(){};return i.prototype=Object.create(Object.getPrototypeOf(n)),Ii(new i,t)}}var tf=ef;const b=Vi(tf);/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wrting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const Ni="0123456789abcdef",Uo=[];for(let n=0;n<256;n++)Uo[n]=Ni[n>>4&15]+Ni[n&15];const Oi=n=>{const e=n.length;let t="",s=0;for(;s<e;)t+=Uo[n[s++]];return t};var Pi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",nf=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var It=0;It<Pi.length;It++)nf[Pi.charCodeAt(It)]=It;new TextDecoder;const sf=new TextEncoder,rf=n=>sf.encode(n),Li=typeof window<"u"?window:self,Jn=Li.crypto||Li.msCrypto||{};Jn.subtle||Jn.webkitSubtle;const Mi=n=>{const e=new Uint8Array(n);return Jn.getRandomValues(e)};/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const of=Ld("simple-peer"),Cn=64*1024,af=5*1e3,cf=5*1e3,lf=5*1e3;function Di(n){return n.replace(/a=ice-options:trickle\s\n/g,"")}function uf(n){console.warn(n)}class be extends Zh.Duplex{constructor(t){t=Object.assign({allowHalfOpen:!1},t);super(t);E(this,"_pc");if(this.__objectMode=!!t.objectMode,this._id=Oi(Mi(4)).slice(0,7),this._debug("new peer %o",t),this.channelName=t.initiator?t.channelName||Oi(Mi(20)):null,this.initiator=t.initiator||!1,this.channelConfig=t.channelConfig||be.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},be.config,t.config),this.offerOptions=t.offerOptions||{},this.answerOptions=t.answerOptions||{},this.sdpTransform=t.sdpTransform||(s=>s),this.streams=t.streams||(t.stream?[t.stream]:[]),this.trickle=t.trickle!==void 0?t.trickle:!0,this.allowHalfTrickle=t.allowHalfTrickle!==void 0?t.allowHalfTrickle:!1,this.iceCompleteTimeout=t.iceCompleteTimeout||af,this.iceRestartEnabled=t.iceRestartEnabled!==void 0?t.iceRestartEnabled:this.trickle===!0,this.iceFailureRecoveryTimeout=t.iceFailureRecoveryTimeout||lf,this._iceFailureRecoveryTimer=null,this._destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,!qn)throw b(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._isRestartingIce=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new qn(this.config)}catch(s){this.__destroy(b(s,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=s=>{this._onIceCandidate(s)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(s=>{this.__destroy(b(s,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=s=>{this._setupData(s)},this.streams&&this.streams.forEach(s=>{this.addStream(s)}),this._pc.ontrack=s=>{this._onTrack(s)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(t){if(!this._destroying){if(this.destroyed)throw b(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof t=="string")try{t=JSON.parse(t)}catch{t={}}this._debug("signal()"),t.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),t.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(t.transceiverRequest.kind,t.transceiverRequest.init)),t.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(t.candidate):this._pendingCandidates.push(t.candidate)),t.sdp&&this._pc.setRemoteDescription(new Md(t)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(s=>{this._addIceCandidate(s)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(s=>{this.__destroy(b(s,"ERR_SET_REMOTE_DESCRIPTION"))}),!t.sdp&&!t.candidate&&!t.renegotiate&&!t.transceiverRequest&&this.__destroy(b(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(t){const s=new Dd(t);this._pc.addIceCandidate(s).catch(i=>{!s.address||s.address.endsWith(".local")?uf("Ignoring unsupported ICE candidate."):this.__destroy(b(i,"ERR_ADD_ICE_CANDIDATE"))})}send(t){if(!this._destroying){if(this.destroyed)throw b(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(t)}}addTransceiver(t,s){if(!this._destroying){if(this.destroyed)throw b(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(t,s),this._needsNegotiation()}catch(i){this.__destroy(b(i,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:t,init:s}})}}addStream(t){if(!this._destroying){if(this.destroyed)throw b(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),t.getTracks().forEach(s=>{this.addTrack(s,t)})}}addTrack(t,s){if(this._destroying)return;if(this.destroyed)throw b(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const i=this._senderMap.get(t)||new Map;let r=i.get(s);if(!r)r=this._pc.addTrack(t,s),i.set(s,r),this._senderMap.set(t,i),this._needsNegotiation();else throw r.removed?b(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):b(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(t,s,i){if(this._destroying)return;if(this.destroyed)throw b(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const r=this._senderMap.get(t),o=r?r.get(i):null;if(!o)throw b(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");s&&this._senderMap.set(s,r),o.replaceTrack!=null?o.replaceTrack(s):this.__destroy(b(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(t,s){if(this._destroying)return;if(this.destroyed)throw b(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const i=this._senderMap.get(t),r=i?i.get(s):null;if(!r)throw b(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{r.removed=!0,this._pc.removeTrack(r)}catch(o){o.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(r):this.__destroy(b(o,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(t){if(!this._destroying){if(this.destroyed)throw b(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),t.getTracks().forEach(s=>{this.removeTrack(s,t)})}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,queueMicrotask(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this._destroying){if(this.destroyed)throw b(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}restartIce(){return this.initiator?this._isRestartingIce?(this._debug("Already restarting ice, ignoring restartIce()"),!1):(this._isNegotiating=!1,this._isRestartingIce=!0,this._pc.restartIce&&this._pc.restartIce(),this._needsNegotiation(),!0):(this._debug("restartIce() only works for the initiator"),!1)}_final(t){this._readableState.ended||this.push(null),t(null)}__destroy(t){this.end(),this._destroy(()=>{},t)}_destroy(t,s){this.destroyed||this._destroying||(this._destroying=!0,this._debug("destroying (error: %s)",s&&(s.message||s)),setTimeout(()=>{if(this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,s&&this.emit("error",s),t()},0))}_setupData(t){if(!t.channel)return this.__destroy(b(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=t.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=Cn),this.channelName=this._channel.label,this._channel.onmessage=i=>{this._onChannelMessage(i)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=i=>{const r=i.error instanceof Error?i.error:new Error(`Datachannel error: ${i.message} ${i.filename}:${i.lineno}:${i.colno}`);this.__destroy(b(r,"ERR_DATA_CHANNEL"))};let s=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(s&&this._onChannelClose(),s=!0):s=!1},cf)}_write(t,s){if(this.destroyed)return s(b(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(t)}catch(i){return this.__destroy(b(i,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>Cn?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=s):s(null)}else this._debug("write before connect"),this._chunk=t,this._cb=s}_onFinish(){if(this.destroyed)return;const t=()=>{setTimeout(()=>this.__destroy(),1e3)};this._connected?t():this.once("connect",t)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){if(this.destroyed)return;const t=Object.assign({},this.offerOptions);this._isRestartingIce&&(this.offerOptions.iceRestart=!0),this._pc.createOffer(t).then(s=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(s.sdp=Di(s.sdp)),s.sdp=this.sdpTransform(s.sdp);const i=()=>{if(this.destroyed)return;const a=this._pc.localDescription||s;this._debug("signal"),this.emit("signal",{type:a.type,sdp:a.sdp})},r=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?i():this.once("_iceComplete",i))},o=a=>{this.__destroy(b(a,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(s).then(r).catch(o)}).catch(s=>{this.__destroy(b(s,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(t=>{!t.mid&&t.sender.track&&!t.requested&&(t.requested=!0,this.addTransceiver(t.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(t=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(t.sdp=Di(t.sdp)),t.sdp=this.sdpTransform(t.sdp);const s=()=>{if(this.destroyed)return;const o=this._pc.localDescription||t;this._debug("signal"),this.emit("signal",{type:o.type,sdp:o.sdp}),this.initiator||this._requestMissingTransceivers()},i=()=>{this.destroyed||(this.trickle||this._iceComplete?s():this.once("_iceComplete",s))},r=o=>{this.__destroy(b(o,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(t).then(i).catch(r)}).catch(t=>{this.__destroy(b(t,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._destroying||(this._pc.connectionState==="failed"&&!this.iceRestartEnabled?this.__destroy(b(new Error("Connection failed."),"ERR_CONNECTION_FAILURE")):this._pc.connectionState==="failed"&&this.iceRestartEnabled?(this.initiator&&!this._isRestartingIce&&this.restartIce(),this._startIceFailureRecoveryTimeout()):this._pc.connectionState==="disconnected"&&this.iceRestartEnabled==="onDisconnect"&&this.initiator&&!this._isRestartingIce&&this.restartIce())}_onIceStateChange(){if(this.destroyed)return;const t=this._pc.iceConnectionState,s=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",t,s),this.emit("iceStateChange",t,s),(t==="connected"||t==="completed")&&(this._iceFailureRecoveryTimer&&(clearTimeout(this._iceFailureRecoveryTimer),this._iceFailureRecoveryTimer=null),this._isRestartingIce=!1,this._pcReady=!0,this._maybeReady()),t==="failed"&&this.iceRestartEnabled?(this.initiator&&!this._isRestartingIce&&this.restartIce(),this._startIceFailureRecoveryTimeout()):t==="disconnected"&&this.iceRestartEnabled==="onDisconnect"?this.initiator&&!this._isRestartingIce&&this.restartIce():t==="failed"&&!this.iceRestartEnabled&&this.__destroy(b(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),t==="closed"&&this.__destroy(b(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(t){const s=i=>(Object.prototype.toString.call(i.values)==="[object Array]"&&i.values.forEach(r=>{Object.assign(i,r)}),i);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(i=>{const r=[];i.forEach(o=>{r.push(s(o))}),t(null,r)},i=>t(i)):this._pc.getStats.length>0?this._pc.getStats(i=>{if(this.destroyed)return;const r=[];i.result().forEach(o=>{const a={};o.names().forEach(l=>{a[l]=o.stat(l)}),a.id=o.id,a.type=o.type,a.timestamp=o.timestamp,r.push(s(a))}),t(null,r)},i=>t(i)):t(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),(this._connected||this._connecting)&&!this._isRestartingIce||!this._pcReady||!this._channelReady)return;this._connecting=!0;const t=()=>{this.destroyed||this._destroying||this.getStats((s,i)=>{if(this.destroyed||this._destroying)return;s&&(i=[]);const r={},o={},a={};let l=!1;i.forEach(c=>{(c.type==="remotecandidate"||c.type==="remote-candidate")&&(r[c.id]=c),(c.type==="localcandidate"||c.type==="local-candidate")&&(o[c.id]=c),(c.type==="candidatepair"||c.type==="candidate-pair")&&(a[c.id]=c)});const u=c=>{l=!0;let d=o[c.localCandidateId];d&&(d.ip||d.address)?(this.localAddress=d.ip||d.address,this.localPort=Number(d.port)):d&&d.ipAddress?(this.localAddress=d.ipAddress,this.localPort=Number(d.portNumber)):typeof c.googLocalAddress=="string"&&(d=c.googLocalAddress.split(":"),this.localAddress=d[0],this.localPort=Number(d[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let f=r[c.remoteCandidateId];f&&(f.ip||f.address)?(this.remoteAddress=f.ip||f.address,this.remotePort=Number(f.port)):f&&f.ipAddress?(this.remoteAddress=f.ipAddress,this.remotePort=Number(f.portNumber)):typeof c.googRemoteAddress=="string"&&(f=c.googRemoteAddress.split(":"),this.remoteAddress=f[0],this.remotePort=Number(f[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(i.forEach(c=>{c.type==="transport"&&c.selectedCandidatePairId&&u(a[c.selectedCandidatePairId]),(c.type==="googCandidatePair"&&c.googActiveConnection==="true"||(c.type==="candidatepair"||c.type==="candidate-pair")&&c.selected)&&u(c)}),!l&&(!Object.keys(a).length||Object.keys(o).length)){setTimeout(t,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(d){return this.__destroy(b(d,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const c=this._cb;this._cb=null,c(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};t()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>Cn||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(t=>{this._pc.removeTrack(t),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(t){this.destroyed||(t.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:t.candidate.candidate,sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid}}):!t.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),t.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(t){if(this.destroyed)return;let s=t.data;s instanceof ArrayBuffer?s=new Uint8Array(s):this.__objectMode===!1&&(s=rf(s)),this.push(s)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const t=this._cb;this._cb=null,t(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.__destroy())}_onTrack(t){this.destroyed||t.streams.forEach(s=>{this._debug("on track"),this.emit("track",t.track,s),this._remoteTracks.push({track:t.track,stream:s}),!this._remoteStreams.some(i=>i.id===s.id)&&(this._remoteStreams.push(s),queueMicrotask(()=>{this._debug("on stream"),this.emit("stream",s)}))})}_debug(){const t=[].slice.call(arguments);t[0]="["+this._id+"] "+t[0],of.apply(null,t)}_startIceFailureRecoveryTimeout(){this.destroyed||this._iceFailureRecoveryTimer||(this._debug("started iceFailureRecovery timeout"),this._iceFailureRecoveryTimer=setTimeout(()=>{!this._iceComplete&&!(iceConnectionState==="connected"||iceConnectionState==="completed")&&(this._debug("iceFailureRecovery timeout completed"),this.destroy(makeError("Ice connection failed.","ERR_ICE_CONNECTION_FAILURE")))},this.iceFailureRecoveryTimeout))}}be.WEBRTC_SUPPORT=!!qn;be.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};be.channelConfig={};let An=0;class df{constructor(){E(this,"lastMsgRecivedTimestamp");E(this,"connectionState",se(q.init));E(this,"latestRecivedDataMessage",se(null));E(this,"outgoingSignalingMessages",se(null));E(this,"remoteVideoStreams",se(new Map));E(this,"_p",null);E(this,"_spConfig",null);E(this,"_incomingSignalQueue",[]);E(this,"_consecutiveSignalMsgsProcessed",0);E(this,"_msgSendQueue",[]);E(this,"_reconnectAttemptCount");E(this,"_shouldReconnect");E(this,"_initiator",!1);E(this,"_connectionId",-1);E(this,"_signalMsgSendCounter",0);E(this,"_signalMsgRecivedCounter",0);E(this,"_StatsGatherInterval")}setStreamsEnabled(e){this.remoteVideoStreams.update(t=>(t.forEach(s=>{s&&s.getTracks().forEach(i=>i.enabled=e)}),t))}start(e,t=!0,s=0){if(this._p&&this.stop(),this._shouldReconnect=t,this._spConfig=Object.assign({},e,be.config),P("SP starting with opts: ",this._spConfig),this._spConfig.initiator&&(this._connectionId=An+++Math.random()),this._signalMsgRecivedCounter=0,this._signalMsgSendCounter=0,this._p=new be(this._spConfig),!this._p)return $("Failed to create SimplePeer instance!");this._p._debug=(...i)=>ge("SIMPLEPEER DEBUG: "+i[0],...i.slice(1)),this._reconnectAttemptCount=s,this._initiator=this._spConfig.initiator||!1,this.connectionState.set(q.connecting),this._p.on("signal",i=>{if(this._connectionId===-1){$("SP sending signal message when connectionId is -1, this should not happen!");return}i=Object.assign({},i,{connId:this._connectionId,msgNum:this._signalMsgSendCounter}),this._signalMsgSendCounter++,ge("SP: signal out",i),this.outgoingSignalingMessages.set(JSON.stringify(i))}),this._p.on("connect",()=>{A("SP: Connected!"),this._reconnectAttemptCount=0,this.connectionState.set(q.connected)}),this._p.on("data",i=>{this.lastMsgRecivedTimestamp=Date.now(),this.latestRecivedDataMessage.set(i)}),this._p.on("stream",i=>{i.addEventListener,A("SP got video stream: ",i),this.remoteVideoStreams.update(r=>(r=new Map,r.set(i.id,i),r))}),this._p.on("iceStateChange",(i,r)=>{A(`SP: ICE State - connection: ${i}, gathering: ${r}`),i==="connected"||i==="completed"?this.setStreamsEnabled(!0):this.setStreamsEnabled(!1)}),this._p.on("close",()=>{this._initiator||this.resetConnectionStats(),P("SP connection closed")}),this._p.on("end",()=>{P("SP connection ended")}),this._p.on("pause",()=>{P("SP connection paused")}),this._p.on("error",i=>{$("SP error ",i),this.remoteVideoStreams.set(new Map),this._shouldReconnect=!1,clearInterval(this._StatsGatherInterval),this.connectionState.set(q.failed)}),this._processSignalMsgQueue()}stop(){var e,t;this.resetConnectionStats(),this.connectionState.set(q.disconnectedOk),this.remoteVideoStreams.set(new Map),this._shouldReconnect=!1,clearInterval(this._StatsGatherInterval),ge("SP Stop",this._connectionId,An,(e=this._p)==null?void 0:e.destroyed,(t=this._p)==null?void 0:t.destroying),this._p&&this._p.destroy(),this._p=null}async restart(e,t){var s,i;ge("SP Restart",this._reconnectAttemptCount,e,this._connectionId,An,(s=this._p)==null?void 0:s.destroyed,(i=this._p)==null?void 0:i.destroying),this._reconnectAttemptCount++,this.stop(),this._connectionId=e||-1,console.log("SP Restart2",this._spConfig),this.start(this._spConfig,this._shouldReconnect,this._reconnectAttemptCount),t&&this.ingestSignalingMsg(t)}resetConnectionStats(){this._signalMsgRecivedCounter=0,this._signalMsgSendCounter=0,this._consecutiveSignalMsgsProcessed=0}changeMediaStream(e){if(this._p)try{console.log("SP: changeMediaStream replacing track",e.getVideoTracks()[0].getSettings());const t=this._p.streams[0],s=t.getVideoTracks()[0];this._p.replaceTrack(s,e.getVideoTracks()[0],t)}catch(t){$("SP: changeMediaStream failed to replace track trying stream remove+add",t.message);for(const s of this._p.streams)this._p.removeStream(s);this._p.addStream(e)}}setCodecPreferences(e){var r,o,a;const t=((r=RTCRtpReceiver.getCapabilities("video"))==null?void 0:r.codecs)||[],s=this.sortCodecsByMimeTypes(t,e);if(A("SP: availReceiveCodecs",t,"sortedCodecs",s),!this._p)return;const i=((a=(o=this._p)==null?void 0:o._pc)==null?void 0:a.getTransceivers())||[];for(const l of i)l.setCodecPreferences(s);this._p.negotiate()}getCodecPreferences(){var t,s;if(!this._p)return;const e=((s=(t=this._p)==null?void 0:t._pc)==null?void 0:s.getTransceivers())||[];for(const i of e){const r=i.receiver.getParameters();if(r.codecs)return r.codecs.map(o=>o.mimeType)}}async getStats(){if(this._p)return await new Promise((e,t)=>{(!this._p||!this._p._pc)&&t("No active simplePeer instance found!"),this._p.getStats((s,i)=>{s&&t(s),e(i)})})}getPlayoutDelay(){var t,s;if(!this._p)return;const e=((s=(t=this._p)==null?void 0:t._pc)==null?void 0:s.getTransceivers())||[];for(const i of e){if(!i.receiver)continue;const r=i.receiver;if(r.playoutDelayHint)return r.playoutDelayHint;if(r.jitterBufferTarget)return r.jitterBufferTarget/1e3}return 0}setPlayoutDelay(e){var s,i;if(!this._p)return;const t=((i=(s=this._p)==null?void 0:s._pc)==null?void 0:i.getTransceivers())||[];for(const r of t){if(!r.receiver)continue;const o=r.receiver;console.log(o),o.playoutDelayHint!==void 0&&o.playoutDelayHint!==e&&(o.playoutDelayHint=e),o.jitterBufferTarget!==void 0&&o.jitterBufferTarget!==e&&(o.jitterBufferTarget=e*1e3)}}sortCodecsByMimeTypes(e,t){return e.sort((s,i)=>{const r=t.indexOf(s.mimeType.toLowerCase()),o=t.indexOf(i.mimeType.toLowerCase()),a=r>=0?r:Number.MAX_VALUE,l=o>=0?o:Number.MAX_VALUE;return a-l})}ingestSignalingMsg(e){try{const t=JSON.parse(e);if(t.msgNum===void 0||t.connId===void 0)return P("SP: Ignoring Invalid Signal Message (no connId or msgNum)!",t);if(t.connId!=this._connectionId&&(P("SP: Found Different connid, fastforwarding!",t.connId,this._connectionId),this._consecutiveSignalMsgsProcessed=0,this._connectionId=t.connId,this._incomingSignalQueue=[],this._spConfig&&!this._initiator))return this.restart(t.connId,e);A("SP: signal queued",t,t.msgNum,this._consecutiveSignalMsgsProcessed,t.connId,this._connectionId),this._incomingSignalQueue.push(t)}catch(t){P("SP: Failed to parse json signal message: ",e,t.message)}this._processSignalMsgQueue()}sendMessage(e){this._msgSendQueue.push(e),this._emptyMsgQueue()}_processSignalMsgQueue(){if(this._p){console.log("SP: processing signal queue",this._incomingSignalQueue.length-1,this._consecutiveSignalMsgsProcessed);for(let e=0;e<this._incomingSignalQueue.length;e++){if(console.log("SP: processing signal q msg",e,"/",this._incomingSignalQueue.length-1,this._consecutiveSignalMsgsProcessed),this._incomingSignalQueue.length===0)return;const t=this._incomingSignalQueue.findIndex(i=>(i==null?void 0:i.msgNum)===this._consecutiveSignalMsgsProcessed);if(t===-1)return;const s=this._incomingSignalQueue[t];A("SP: signal in",s,s.msgNum,this._consecutiveSignalMsgsProcessed,s.connId,this._connectionId),this._incomingSignalQueue.splice(t,1),e--,this._p.signal(s),this._consecutiveSignalMsgsProcessed++}}}_emptyMsgQueue(){if(!this._p||!this._p.connected)return!1;for(this._msgSendQueue.length;this._msgSendQueue.length>0;){const e=this._msgSendQueue.shift();try{this._p.send(e)}catch(t){$("failed to send message over simplePeer data channel: ",t.message),this._msgSendQueue.unshift(e)}}}}const H=x;class hf{constructor(){E(this,"config");E(this,"lastMsgRecivedTimestamp");E(this,"connectionState");E(this,"latestRecivedDataMessage");E(this,"participantConnectionEvents");E(this,"_rovRoomName");E(this,"_accessToken");E(this,"_reconnectAttemptCount",0);E(this,"_shouldReconnect");E(this,"_roomConn");this.config={},this._shouldReconnect=!0,this.connectionState=se(q.init),this.latestRecivedDataMessage=se(null),this.participantConnectionEvents=se(null)}async init(e){this.config=e,this._shouldReconnect=!0,this._roomConn=new Jo(e.roomConfig),this._roomConn.on(N.DCBufferStatusChanged,t=>{H("LK: DCBufferStatusChanged ",t)}).on(N.SignalConnected,async()=>{H(`LK: Signal connection established to ${this.config.hostUrl}`)}).on(N.Connected,async()=>{H(`LK: Connected to room: ${this._roomConn.name} via ${this.config.hostUrl}`),this.connectionState.set(q.connected)}).on(N.Disconnected,t=>{this.connectionState.set(q.disconnectedOk);let s=this._shouldReconnect&&!!this._roomConn;t===he.DUPLICATE_IDENTITY?(P("LK: disconnected from room - duplicate identity"),s=!1):t===he.CLIENT_INITIATED?(x("LK: disconnected from room - client initiated"),s=!1):t===he.PARTICIPANT_REMOVED?(x("LK: disconnected from room - participant removed"),s=!1):t===he.ROOM_DELETED?x("LK: disconnected from room - room deleted"):t===he.STATE_MISMATCH?x("LK: disconnected from room - state mismatch"):t===he.SERVER_SHUTDOWN?x("LK: disconnected from room - server shutdown"):t===he.JOIN_FAILURE?x("LK: disconnected from room - join failure"):t===he.UNKNOWN_REASON&&x("LK: disconnected from room - unknown reason"),s?this._reconnect():this.close()}).on(N.Reconnecting,()=>{H(`LK: Reconnecting to room ${this._roomConn.name} via ${this.config.hostUrl}`),this.connectionState.set(q.reconnecting)}).on(N.Reconnected,async()=>{H("LK: Successfully reconnected. server",await this._roomConn.engine.getConnectedServerAddress()),this.connectionState.set(q.connected)}).on(N.ParticipantMetadataChanged,t=>{H("LK: Participant Metadata Changed",t)}).on(N.ParticipantConnected,async t=>{H(`LK: Participant ${t.identity} (${t.sid}) connected`,t.metadata),this.participantConnectionEvents.set({id:t.identity,joined:!0}),t.on(jo.ConnectionQualityChanged,()=>{H("LK: ParticipantEvent.ConnectionQualityChanged",t.connectionQuality)})}).on(N.ParticipantDisconnected,t=>{H(`LK: Participant ${t.identity} (${t.sid}) disconnected`),this.participantConnectionEvents.set({id:t.identity,joined:!1})}).on(N.MediaDevicesError,t=>{const s=bs.getFailure(t);H("LK: Media device failure",s)}).on(N.ConnectionQualityChanged,(t,s)=>{H(`LK: connection quality for ${s?s.identity:"[no identity]"} changed to ${t}`)}).on(N.RoomMetadataChanged,t=>{try{H("LK: New metadata for room",JSON.parse(t))}catch{H("LK: New metadata for room (NOT VALID JSON)",t)}}).on(N.MediaDevicesChanged,()=>{H("LK: MediaDevicesChanged")}).on(N.LocalTrackUnpublished,(t,s)=>{H("LK: LocalTrackUnpublished",t.trackSid,"by participant",s.identity,"source",t.track?t.track.source:"[no track found]")}).on(N.LocalTrackPublished,(t,s)=>{H("LK: LocalVideoTrackPublished",t.trackSid,"by participant",s.identity,"source",t.track?t.track.source:"[no track found]")}).on(N.MediaDevicesError,t=>{const s=bs.getFailure(t);H("LK: media device failure",s)}).on(N.AudioPlaybackStatusChanged,()=>{H("LK: AudioPlaybackStatusChanged. canPlaybackAudio =",this._roomConn.canPlaybackAudio)})}async start(e,t){this._rovRoomName=e,this._accessToken=t,this._shouldReconnect=!0;const s=Date.now();x(`LK: Starting conn with ${e} via ${this.config.hostUrl} token = ${t}`);try{const i=setTimeout(()=>{x(`livekit connect timeout for ${this.config.hostUrl}. Reconnecting...`),this._reconnect()},16e3);await this._connect(),clearTimeout(i),x(`LK: Connected in ${Date.now()-s}ms ${this.config.hostUrl}`)}catch(i){x(`LK: Error connecting to ${this.config.hostUrl}. Reconnecting...`,i),this._reconnect()}}async sendMessage(e,t=!0,s=[]){if(!this._roomConn)return P("LK: Can't send message, room not connected");if(e.length==0)return P("LK: Can't send empty message");await this._roomConn.localParticipant.publishData(e,{reliable:t,destinationIdentities:s})}getParticipantSid(e){const t=[...this._roomConn.remoteParticipants.values()].find(s=>s.identity===e);return t?t.sid:null}getLivekitIdentitiy(){return this._roomConn?this._roomConn.localParticipant.identity:null}getRoomName(){return this._roomConn?this._roomConn.name:this._rovRoomName}async close(){this._shouldReconnect=!1,this._roomConn&&(A("LK: Closing Livekit Connection: ",this._rovRoomName,this.config.hostUrl),await this._roomConn.disconnect(!0))}async _connect(){await this._roomConn.connect(Hi(this.config.hostUrl),this._accessToken,this.config.roomConnectionConfig),A("LK: Connected to room",this._roomConn.name,this._roomConn)}async _reconnect(){try{await this._roomConn.disconnect(!0)}catch(e){$("LK: Error disconnecting from room",e)}if(this._shouldReconnect!=!1)if(this._reconnectAttemptCount<this.config.reconnectAttempts){const e=this._reconnectAttemptCount*800;this._reconnectAttemptCount++,await mt(e);try{await this._connect()}catch(t){throw $("LK: Error reconnecting to room",t),t}}else $("LK: Failed to reconnect after ",this._reconnectAttemptCount,"/",this.config.reconnectAttempts,"attempts"),this._fail()}_fail(){this._shouldReconnect=!1,this.connectionState.set(q.failed)}}const xi=1e3;let vn=0;class ff{constructor(e,t,s,i,r=null){E(this,"client");E(this,"egressClient");E(this,"roomName");E(this,"tokenEncryptionPassword");E(this,"apiKey");E(this,"secretKey");this.apiKey=e,this.secretKey=t,this.roomName=i,this.tokenEncryptionPassword=r,this.client=new vl(s,e,t),this.egressClient=new Pr(s,e,t)}getEgressClient(){return this.egressClient}async waitForRateLimit(){for(;Date.now()-vn<xi;)console.log("Waiting for rate limit...",Date.now()-vn),await mt(xi);vn=Date.now()}async deleteLivekitRoom(){try{return await this.client.deleteRoom(this.roomName)}catch(e){P("LK Admin: Failed to delete room: "+this.roomName,e)}}async createLivekitRoom(e,t){const s=await this._generateRoomMetadata(e,t);await this.waitForRateLimit();const i=await le(()=>this.client.createRoom({name:this.roomName,maxParticipants:8,metadata:s,syncStreams:!1,emptyTimeout:60,departureTimeout:30}));return A("LK Admin: Created room: "+this.roomName,i),i}async listLivekitRooms(){return await this.waitForRateLimit(),(await le(()=>this.client.listRooms())).filter(t=>t.numParticipants>0)}async updateRoomMetadata(e,t){const s=await this._generateRoomMetadata(e,t);await this.waitForRateLimit();try{return await le(()=>this.client.updateRoomMetadata(this.roomName,s))}catch(i){throw new Error("LK Admin: Failed to update metadata for room "+this.roomName+i.toString())}}async _generateRoomMetadata(e,t){let i=[],r;for(let a=0;a<3;a++){r=Qo(a);const l=await xl(this.apiKey,this.secretKey,this.roomName,r);if(this.tokenEncryptionPassword){const u=await Dl(l,this.tokenEncryptionPassword);i.push({userGivenIdentity:r,encrypted:!0,...u})}else i.push({userGivenIdentity:r,token:l,encrypted:!1})}return JSON.stringify({numParticipants:t,accessTokens:i})}}class mf extends hf{constructor(){super();E(this,"_livekitApiKey");E(this,"_livekitSecretKey");E(this,"_livekitAdmin");E(this,"camTrack");E(this,"videoStats",se([]));E(this,"_videoStatsIntervalId");E(this,"_videoPublishOptions");E(this,"_videoCaptureOptions")}async init(t){await super.init(t),this._roomConn.on(N.SignalConnected,()=>{this.isVideoActive()||this.enableCamera(!0),this._roomConn.metadata||this.createLivekitRoom()}).on(N.Reconnecting,()=>{this._roomConn.metadata||this.createLivekitRoom()}).on(N.Connected,()=>{this.isVideoActive()||this.enableCamera(!0),this.updateRoomMetadata()}).on(N.Reconnected,()=>{this.isVideoActive()||this.enableCamera(!0),this.updateRoomMetadata()}).on(N.DataReceived,(s,i)=>{if(!i)return P("LK: Ignoring received data message with no participant. This can happen when the message is sent before connection completes or if the message comes from the server: ",s);const r=i.identity;i.sid,this.lastMsgRecivedTimestamp=Date.now(),this.latestRecivedDataMessage.set({senderId:r,msg:s})}).on(N.TrackSubscribed,(s,i,r)=>{P("LK: Subscribed to track ",i.trackSid," from participant: ",r.identity," source: ",s.source," _THIS SHOULDNT HAPPEN on BACKEND_ ")}).on(N.TrackUnsubscribed,(s,i,r)=>{P("LK: Unsubscribed from track",i.trackSid," from participant: ",r.identity," _THIS SHOULDNT HAPPEN on BACKEND_ ")}).on(N.ParticipantConnected,()=>{this.updateRoomMetadata()})}async startRoom(t,s,i){this._rovRoomName=t,this._livekitApiKey=s,this._livekitSecretKey=i,this._livekitAdmin=this._livekitAdmin??new ff(s,i,this.config.hostUrl,t,M.ROV_CONTROL_PASSWORD),this.createLivekitRoom();const r=await Ml(s,i,t);await super.start(t,r)}async enableCamera(t,s,i){var r,o,a,l;if(!this._roomConn)throw new Error("LK: Can't enable camera, room not initialized");this._videoCaptureOptions=s||this._videoCaptureOptions||this.config.roomConfig.videoCaptureDefaults,this._videoPublishOptions=i||this._videoPublishOptions||this.config.roomConfig.publishDefaults;for(const[u,c]of this._roomConn.localParticipant.videoTrackPublications)x("LK: Unpublishing video track: ",u,c),c!=null&&c.videoTrack&&this._roomConn.localParticipant.unpublishTrack(c.videoTrack,!0);if(t)for(;;){try{if(this.connectionState.get()===q.failed)return P("LK: Can't enable camera, room connection failed");const u=await this._roomConn.localParticipant.createTracks({video:{resolution:this._videoCaptureOptions.resolution,facingMode:this._videoCaptureOptions.facingMode},audio:!1});console.log("LK: Created tracks: ",u);for(const c of u){const d=await this._roomConn.localParticipant.publishTrack(u[0],this._videoPublishOptions);d&&c.kind===Go.Kind.Video&&(this.camTrack=d)}if(this.camTrack)return A("LK: Camera enabled",t,this._videoCaptureOptions,this._videoPublishOptions)}catch(u){$(u.message)}await mt(1e3)}else(o=(r=this.camTrack)==null?void 0:r.videoTrack)==null||o.stop(),(l=(a=this.camTrack)==null?void 0:a.audioTrack)==null||l.stop(),this.camTrack=void 0,A("LK: Camera disabled",t)}isVideoActive(){if(!this.camTrack||!this.camTrack.videoTrack)return!1;let t=this._roomConn.localParticipant.videoTrackPublications.get(this.camTrack.trackSid);return console.log("LK: Video Publication: ",t," Enabled: ",t==null?void 0:t.isEnabled),t==null?void 0:t.isEnabled}async getVideoStats(){var o,a;if(!this.camTrack||!this.camTrack.videoTrack||this.connectionState.get()!=q.connected)return;const t=this.camTrack.videoTrack;let s=[{bitrate:t.currentBitrate,streamState:t.streamState,simulcasted:this.camTrack.simulcasted,codec:t.codec,dimensions:this.camTrack.dimensions},(a=(o=this.camTrack)==null?void 0:o.trackInfo)==null?void 0:a.toJson()];const i=await this.camTrack.videoTrack.getSenderStats();i&&(s=s.concat(i));const r=await this.camTrack.videoTrack.getRTCStatsReport();if(r)for(const l of r.values())s.push(l);return this.videoStats.set(s),s}getParticipantIds(){return[...this._roomConn.remoteParticipants.values()].map(t=>t.identity)}async close(){await super.close()}async _fail(){await super._fail()}async updateRoomMetadata(){if(!this._livekitAdmin)return P("LK: Can't update metadata tokens, livekit admin client not initialized");A("LK: Updating room metadata");const t=this.getParticipantIds().filter(s=>s!==this._rovRoomName);await this._livekitAdmin.updateRoomMetadata(t,t.length+1)}async createLivekitRoom(){if(!this._livekitAdmin)return P("LK: Can't create livekit room, livekit admin client not initialized");const t=this.getParticipantIds(),s=await this._livekitAdmin.createLivekitRoom(t,t.length+1);(!s.metadata||s.numParticipants!==t.length+1)&&await this.updateRoomMetadata()}}class pf{constructor(){E(this,"_cloudLivekitConnection",new mf);E(this,"_simplePeerConnections",new Map);E(this,"_simplePeerCameraStream",null);E(this,"_videoStatsCheckTimer",null);E(this,"simplePeerCameraOptions",se(Rs));this._cloudLivekitConnection.init({hostUrl:M.LIVEKIT_CLOUD_ENDPOINT,publishVideo:!0,reconnectAttempts:300,roomConnectionConfig:zo,roomConfig:rt,tokenEncryptionPassword:M.ROV_CONTROL_PASSWORD}),et(this._cloudLivekitConnection.latestRecivedDataMessage,e=>{if(!e)return;const{senderId:t,msg:s}=e;Ti(t,s)}),et(this._cloudLivekitConnection.connectionState,e=>{x("Cloud Conn State Changed: "+e),e==q.connected}),et(this._cloudLivekitConnection.participantConnectionEvents,e=>{x("Cloud Conn Participant Event: ",e)})}async start(e){this._cloudLivekitConnection.connectionState.get(),this._cloudLivekitConnection.connectionState.subscribe(t=>{(t===q.failed||t===q.init)&&(A("Creating & Starting Livekit Room: "+e.RovName),As(this._cloudLivekitConnection.startRoom,this._cloudLivekitConnection,10,1e3,1.3)(e.RovName,e.APIKey,e.SecretKey).catch(i=>{$(i),x("Too many errors: Triggering Page Reload"),window.location.reload()}))}),A("Connection Manager Started"),await Xo(()=>this._cloudLivekitConnection&&this._cloudLivekitConnection.connectionState&&this._cloudLivekitConnection.connectionState.get()===q.connected),this.onConnectedActions()}onConnectedActions(){this.sendVideoStatsUpdate(),this._videoStatsCheckTimer=setInterval(()=>{this.sendVideoStatsUpdate()},1e3)}subscribeToVideoStats(e){this._cloudLivekitConnection.videoStats.subscribe(e)}async sendVideoStatsUpdate(){var s,i,r,o,a,l,u,c,d,f,_,m,T,p,S,k,v;const e=await this._cloudLivekitConnection.getVideoStats().catch(R=>(P("LK: Error getting RTP video stats: ",R),[R]));this.sendMessage({LivekitVideoStats:{Enabled:!!this._cloudLivekitConnection.camTrack&&((s=this._cloudLivekitConnection._roomConn)==null?void 0:s.localParticipant.videoTrackPublications.size)>0,RtcSenderStatsJson:JSON.stringify(e),AllowBackupCodec:!!((i=this._cloudLivekitConnection._videoPublishOptions)!=null&&i.backupCodec),BaseStream:{Width:(o=(r=this._cloudLivekitConnection._videoCaptureOptions)==null?void 0:r.resolution)==null?void 0:o.width,Height:(l=(a=this._cloudLivekitConnection._videoCaptureOptions)==null?void 0:a.resolution)==null?void 0:l.height,Fps:(c=(u=this._cloudLivekitConnection._videoCaptureOptions)==null?void 0:u.resolution)==null?void 0:c.frameRate,MaxBitrate:(f=(d=this._cloudLivekitConnection._videoPublishOptions)==null?void 0:d.videoEncoding)==null?void 0:f.maxBitrate},Codec:O.VideoCodec[((m=(_=this._cloudLivekitConnection._videoPublishOptions)==null?void 0:_.videoCodec)==null?void 0:m.toUpperCase())||"unknown"],SimulcastLayers:((p=(T=this._cloudLivekitConnection._videoPublishOptions)==null?void 0:T.videoSimulcastLayers)==null?void 0:p.map(R=>{var L,I;return{Width:R.width,Height:R.height,MaxBitrate:(L=R.encoding)==null?void 0:L.maxBitrate,Fps:(I=R.encoding)==null?void 0:I.maxFramerate}}))||[]}},!1,[]);const t=this.simplePeerCameraOptions.get();for(const[R,L]of this._simplePeerConnections){const I=await L.getStats().catch(W=>(P("SP: Error getting rtc video stats for user "+R+":",W),[W]));this.sendMessage({SimplePeerVideoStats:{Enabled:!!L,RtcSenderStatsJson:JSON.stringify(I),BaseStream:{Width:Number((S=t.video)==null?void 0:S.width),Height:Number((k=t.video)==null?void 0:k.height),Fps:Number((v=t.video)==null?void 0:v.frameRate)}}},!1,[R])}}setLivekitVideoOptions(e,t,s){this._cloudLivekitConnection.enableCamera(e,t,s)}createSimplePeer(e,t){const s=this._simplePeerConnections.get(e);if(s)return P("SP: createSimplePeer() err - Connection already exists for user: "+e),s;const i=new df;return this._simplePeerConnections.set(e,i),t&&i.ingestSignalingMsg(t),et(i.latestRecivedDataMessage,r=>{r&&Ti(e,r)}),et(i.outgoingSignalingMessages,r=>{this.sendMessage({SimplePeerSignal:{Message:r}},!0,[e])}),i}async startSimplePeerConnection(e){this._simplePeerCameraStream||(this._simplePeerCameraStream=await As(navigator.mediaDevices.getUserMedia,navigator.mediaDevices,10,1e3,1.3)(this.simplePeerCameraOptions.get()));const t=this._simplePeerConnections.get(e);if(!t)throw new Error("SimplePeer Connection not created for user: "+e);await t.start(Object.assign({},ks,{initiator:!1,streams:[this._simplePeerCameraStream]}),!1)}async setSimplePeerVideoOptions(e,t,s,i){var r;if(e){console.log("Setting SimplePeer Video Options for "+t+":",s,i),this.simplePeerCameraOptions.update(l=>{var c,d,f;const u=l!=null&&l.video?l.video:Rs.video;return{...l,video:{...l.video,width:((c=s==null?void 0:s.resolution)==null?void 0:c.width)||u.width||1920,height:((d=s==null?void 0:s.resolution)==null?void 0:d.height)||u.height||1080,frameRate:((f=s==null?void 0:s.resolution)==null?void 0:f.frameRate)||u.frameRate||60}}});const o=await navigator.mediaDevices.getUserMedia(this.simplePeerCameraOptions.get());this._simplePeerCameraStream,this._simplePeerCameraStream=o;let a=this._simplePeerConnections.get(t);a?a.changeMediaStream(this._simplePeerCameraStream):(a=this.createSimplePeer(t),a.start(Object.assign({},ks,{initiator:!1,streams:[this._simplePeerCameraStream]}),!1))}else(r=this._simplePeerCameraStream)==null||r.getTracks().forEach(o=>o.stop()),this._simplePeerCameraStream=null}async ingestSimplePeerSignalMsg(e,t){const s=this._simplePeerConnections.get(e);s===void 0?(this.createSimplePeer(e,t),await this.startSimplePeerConnection(e)):s.ingestSignalingMsg(t)}async sendMessage(e,t,s){if(!e)return!1;if(this._cloudLivekitConnection.connectionState.get()!==q.connected)return M.DEBUG_MODE&&ge("LK: Message Not Sent, Livekit Not Connected"),!1;M.DEBUG_MODE&&ge("LK/SP: "+(s.length==0?"Broadcasting msg ":"Sending msg to ["+s.join(", ")+"]")+(t?"reliably":"unreliably")+":",O.RovResponse.create(e).toJSON()),e.BackendMetadata=O.ResponseBackendMetadata.create({});const i=O.RovResponse.encode(e).finish();return await this._cloudLivekitConnection.sendMessage(i,t,s),!0}async stop(){clearInterval(this._videoStatsCheckTimer),this._cloudLivekitConnection.close();for(const[e,t]of this._simplePeerConnections)t.stop()}}const K=new pf,gf="/system-information";async function _f(){return io({method:"get",url:`${M.BLUEOS_APIS_ENDPOINT+gf}/system`,timeout:1e4}).then(n=>n.data).catch(n=>{const e=`Could not fetch blueos system info: ${n.message}`;return P(e),e})}function yf(n){const e=[],t=n?n.map(s=>s.usage).reduce((s,i)=>s+i,0)/n.length:0;return t>90&&e.push(`Rov CPU is nearly maxed out: ${t}%`),{value:t,warnings:e}}function Tf(n){const e=n==null?void 0:n.find(a=>a.mount_point==="/");function t(a){const l=a?a.available_space_B/1073741824:0,u=a?a.total_space_B/2**30:0;return[u-l,u]}const[s,i]=t(e),r=100*s/i,o=r>95?[`Disk/SD Card is almost full: ${Math.round(s*10)/10}/${Math.round(s*10)/10}GB Used`]:[];return{value:r,warnings:o}}function Ef(n){var l,u,c,d;const e=[],t=((l=n==null?void 0:n.ram)==null?void 0:l.used_kB)??0,s=((u=n==null?void 0:n.ram)==null?void 0:u.total_kB)??0,i=100*t/s,r=((c=n==null?void 0:n.swap)==null?void 0:c.used_kB)??0,o=((d=n==null?void 0:n.swap)==null?void 0:d.total_kB)??0,a=100*r/o;return i>90&&e.push(`RAM is almost full (${t} / ${s})`),a>90&&e.push(`Linux SWAP space is almost full (${r} / ${o})`),{value:i,warnings:e}}function Sf(n){const e=n==null?void 0:n.find(i=>i.name==="CPU"),t=e?e.temperature:0,s=n?n.filter(i=>{const r=i.critical_temperature||1/0;return i.temperature>r}).map(i=>`Critical temperature reached in ${i.name}: ${i.temperature}C`):[];return{value:t,warnings:s}}Object.assign(window,{getLongTermStarterAccessToken:Fl});jt.defaultLogOrigin=Yo.ROV;M.SEND_LOGS&&(jt.sendLogsAllowed=!0);const Fi=document.getElementById("show_recent_logs_btn"),Ui=document.getElementById("recent_logs");Fi&&Ui&&Fi.addEventListener("click",()=>jt.printRecentLogs(Ui));K.start({RovName:M.ROV_NAME,APIKey:M.LIVEKIT_API_KEY,SecretKey:M.LIVEKIT_SECRET_KEY,LivekitCloudURL:M.LIVEKIT_CLOUD_ENDPOINT,LivekitLocalURL:M.LIVEKIT_LOCAL_ENDPOINT}).then(()=>{const n=document.getElementById("video_stats");K.subscribeToVideoStats(e=>{n&&(n.innerText=JSON.stringify(e,null,2))})});M.TWITCH_STREAM_KEY!=="None"&&Jt.init(M.TWITCH_STREAM_KEY,M.ROV_NAME,M.LIVEKIT_API_KEY,M.LIVEKIT_SECRET_KEY);M.PYTHON_WEBSOCKET_PORT!=0?Kt.start("ws://localhost:"+M.PYTHON_WEBSOCKET_PORT,n=>{if(n.length===0)return;const e=O.RovResponse.decode(n);if(!e.BackendMetadata)return $("No BackendMetadata in message from iROV",e.toJSON(),n);const t=e.BackendMetadata.TargetUserIds,i=e.BackendMetadata.TransportMethod==O.DataTransportMethod.LivekitReliable;K.sendMessage(e,i,t||[])}):A("No PYTHON_WEBSOCKET_PORT url parameter set, skipping python websocket!");if(M.BLUEOS_APIS_ENDPOINT){const n="("+Cs.join(")|(")+")";ne.start(Hi(M.BLUEOS_APIS_ENDPOINT)+":6040/ws/mavlink?filter="+n,e=>{if(!e.header||!e.message)return $("Mavlink message missing header or message body",e);Ad(e);const t=Bi(JSON.stringify(e)),s=O.RovResponse.create({Mavlink:{Message:t}});Cs.includes(e.message.type)&&K.sendMessage(s,!0,[])},()=>{ne.sendMessage(Bl(0,8e6))}),setInterval(()=>{_f().then(e=>{const t=Sf(e.temperature),s=yf(e.cpu),i=Ef(e.memory),r=Tf(e.disk),o=t.warnings.concat(s.warnings,i.warnings,r.warnings);M.DEBUG_MODE&&ge("/SysInfo cpuTemp",t,"cpuUsage",s,"memUsage",i,"diskUsage",r,o);const a=O.RovResponse.create({SystemMonitor:{CpuTemp:t.value,CpuUsage:s.value,MemoryUsage:i.value,DiskUsage:r.value,Warnings:o}});K.sendMessage(a,!0,[])})},5e3)}else A("No BLUEOS_APIS_ENDPOINT url parameter set, skipping mavlink & system info monitoring!");window.addEventListener("beforeunload",()=>{Jt.stopStream(),K.stop(),Kt.close(),ne.close()});
//# sourceMappingURL=internal-97c9b60b.js.map
