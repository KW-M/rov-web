var Pa=Object.defineProperty;var La=(t,e,n)=>e in t?Pa(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var T=(t,e,n)=>(La(t,typeof e!="symbol"?e+"":e,n),n);import{l as K,d as ge,g as qn,E as Pr,a as G,b as Ma,R as O,C as N,c as B,e as xa,D as ue,f as R,P as Fa,M as gs,h as Ua,i as J,j as Q,k as Ba,m as Ha,n as qa,o as _s,p as Ka,S as $a,r as U,L as Va,q as Wa,s as Ja,t as Kn,F as ja}from"./consts-db790f5a.js";let xe=[];function me(t){let e=[],n=(a,o=!0)=>(e.includes(a)||e.push(a),o&&a(t),()=>{e=e.filter(u=>u!=a)});function s(a){if(a===t&&(t===null||typeof t!="object"))return;let o=t;t=a;for(let u of e)u(t,o)}function r(){let a=xe[xe.length-1];return a&&n(a[0],!1),t}if(typeof t=="function")return Ga(t);function i(){for(let a of e)a(t,t)}return{subscribe:n,set:s,get:r,refresh:i,update:a=>{typeof a=="function"&&s(a(t))}}}function Ga(t){let e=me(null),n=[s];return s(),e;function s(){if(xe.includes(n))throw Error("Circular computation");xe.push(n);let r;try{r=t()}catch(i){throw xe.pop(),i}xe.pop(),e.set(r)}}function ct(t){return new Promise(e=>{setTimeout(()=>{e()},t)})}function za(t,e=0){return new Promise((n,s)=>{e!==0&&setTimeout(()=>{s()},e);const r=setInterval(()=>{t()&&(clearInterval(r),n())},100)})}function ys(t,e=null,n=5,s=1e3,r=2){return async function(...i){let a,o=0;for(;o<n;)try{return await t.apply(e,i)}catch(u){a=u,K("err:",a),await ct(s*Math.pow(r,o)),o++}throw new Error("asyncExpBackoff() func failed after "+o+" retries. Error: "+a)}}function Ye(t,e){let n=!1;return t.subscribe(r=>{if(n==!1){n=!0;return}e(r)})}function Lr(t,e=!1){return t.replace("http","ws")}function Ts(){const t=new Date().getTime()>>>0,e=typeof performance<"u"&&performance.now&&(performance.now()>>>0)*1e3||0,n=crypto.getRandomValues(new Uint8Array(1))[0]>>>0;return t*e*n}const Es=["Ancient","Dawn","Small","Broken","Red","Cold","Wild","Divine","Empty","Patient","Holy","Long","Wispy","White","Delicate","Bold","Billowing","Blue","Crimson","Aged","Misty","Snowy","Withered","Little","Frosty","Weathered","Nameless","Fragrant","Lively","Quiet","Purple","Proud","Dry","Bitter","Dark","Icy","Twilight","Wandering","Solitary","Morning","Lingering","Still","Late","Sparkling","Restless","Winter","Silent","Floral","Young","Green","Cool","Autumn","Falling","Spring","Summer","Polished","Hidden","Damp","Muddy","Black","Old","Rough"],Ss=["Pond","Snow","Glade","Hill","Voice","River","Sun","Dawn","Forest","Frog","Grass","Shadow","Dust","Water","Meadow","Moon","Thunder","Sun","Wildflower","Snowflake","Silence","Haze","Shape","Pine","Waterfall","Sound","Wood","Tree","Night","Flower","Dream","Cherry","Resonance","Firefly","Bush","Star","Darkness","Lake","Frost","Paper","Surf","Fog","Brook","Mountain","Field","Bird","Leaf","Sea","Water","Sky","Smoke","Sunset","Glitter","Dew","Butterfly","Wind","Fire","Rain","Morning","Feather","Cloud","Breeze","Violet","Wave","Droplet","Swamp","Village","Hut","Path","Book","Rain","Spell","Pig"];function ws(t,e=0){let n=Es.length>>>0,s=Ss.length>>>0,r=Math.max(n,s)>>>0,i=Math.max(1,(t+1)%r)>>>0,a=Math.max(1,(e+1)%r)>>>0,o=Es[(i+a)%n],u=Ss[i*a%s];return o+"-"+u}const $n=crypto,Mr=t=>t instanceof CryptoKey,Fe=new TextEncoder,Sn=new TextDecoder;function Ya(...t){const e=t.reduce((r,{length:i})=>r+i,0),n=new Uint8Array(e);let s=0;for(const r of t)n.set(r,s),s+=r.length;return n}const Xa=t=>{let e=t;typeof e=="string"&&(e=Fe.encode(e));const n=32768,s=[];for(let r=0;r<e.length;r+=n)s.push(String.fromCharCode.apply(null,e.subarray(r,r+n)));return btoa(s.join(""))},en=t=>Xa(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),Qa=t=>{const e=atob(t),n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n},Za=t=>{let e=t;e instanceof Uint8Array&&(e=Sn.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Qa(e)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class Vn extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var n;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(n=Error.captureStackTrace)==null||n.call(Error,this,this.constructor)}}class Ue extends Vn{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}}class Xe extends Vn{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}}class eo extends Vn{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}}function ne(t,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${t}`)}function St(t,e){return t.name===e}function tn(t){return parseInt(t.name.slice(4),10)}function to(t){switch(t){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function no(t,e){if(e.length&&!e.some(n=>t.usages.includes(n))){let n="CryptoKey does not support this operation, its usages must include ";if(e.length>2){const s=e.pop();n+=`one of ${e.join(", ")}, or ${s}.`}else e.length===2?n+=`one of ${e[0]} or ${e[1]}.`:n+=`${e[0]}.`;throw new TypeError(n)}}function so(t,e,...n){switch(e){case"HS256":case"HS384":case"HS512":{if(!St(t.algorithm,"HMAC"))throw ne("HMAC");const s=parseInt(e.slice(2),10);if(tn(t.algorithm.hash)!==s)throw ne(`SHA-${s}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!St(t.algorithm,"RSASSA-PKCS1-v1_5"))throw ne("RSASSA-PKCS1-v1_5");const s=parseInt(e.slice(2),10);if(tn(t.algorithm.hash)!==s)throw ne(`SHA-${s}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!St(t.algorithm,"RSA-PSS"))throw ne("RSA-PSS");const s=parseInt(e.slice(2),10);if(tn(t.algorithm.hash)!==s)throw ne(`SHA-${s}`,"algorithm.hash");break}case"EdDSA":{if(t.algorithm.name!=="Ed25519"&&t.algorithm.name!=="Ed448")throw ne("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!St(t.algorithm,"ECDSA"))throw ne("ECDSA");const s=to(e);if(t.algorithm.namedCurve!==s)throw ne(s,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}no(t,n)}function xr(t,e,...n){var s;if(n.length>2){const r=n.pop();t+=`one of type ${n.join(", ")}, or ${r}.`}else n.length===2?t+=`one of type ${n[0]} or ${n[1]}.`:t+=`of type ${n[0]}.`;return e==null?t+=` Received ${e}`:typeof e=="function"&&e.name?t+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&(s=e.constructor)!=null&&s.name&&(t+=` Received an instance of ${e.constructor.name}`),t}const bs=(t,...e)=>xr("Key must be ",t,...e);function Fr(t,e,...n){return xr(`Key for the ${t} algorithm must be `,e,...n)}const Ur=t=>Mr(t)?!0:(t==null?void 0:t[Symbol.toStringTag])==="KeyObject",Lt=["CryptoKey"],ro=(...t)=>{const e=t.filter(Boolean);if(e.length===0||e.length===1)return!0;let n;for(const s of e){const r=Object.keys(s);if(!n||n.size===0){n=new Set(r);continue}for(const i of r){if(n.has(i))return!1;n.add(i)}}return!0},io=ro;function ao(t){return typeof t=="object"&&t!==null}function oo(t){if(!ao(t)||Object.prototype.toString.call(t)!=="[object Object]")return!1;if(Object.getPrototypeOf(t)===null)return!0;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}const co=(t,e)=>{if(t.startsWith("RS")||t.startsWith("PS")){const{modulusLength:n}=e.algorithm;if(typeof n!="number"||n<2048)throw new TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)}};function uo(t){let e,n;switch(t.kty){case"RSA":{switch(t.alg){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${t.alg.slice(-3)}`},n=t.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${t.alg.slice(-3)}`},n=t.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(t.alg.slice(-3),10)||1}`},n=t.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new Ue('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(t.alg){case"ES256":e={name:"ECDSA",namedCurve:"P-256"},n=t.d?["sign"]:["verify"];break;case"ES384":e={name:"ECDSA",namedCurve:"P-384"},n=t.d?["sign"]:["verify"];break;case"ES512":e={name:"ECDSA",namedCurve:"P-521"},n=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:"ECDH",namedCurve:t.crv},n=t.d?["deriveBits"]:[];break;default:throw new Ue('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(t.alg){case"EdDSA":e={name:t.crv},n=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:t.crv},n=t.d?["deriveBits"]:[];break;default:throw new Ue('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new Ue('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:e,keyUsages:n}}const lo=async t=>{if(!t.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:e,keyUsages:n}=uo(t),s=[e,t.ext??!1,t.key_ops??n],r={...t};return delete r.alg,delete r.use,$n.subtle.importKey("jwk",r,...s)},fo=lo,Br=t=>Za(t);let nn,sn;const Hr=t=>(t==null?void 0:t[Symbol.toStringTag])==="KeyObject",qr=async(t,e,n,s)=>{let r=t.get(e);if(r!=null&&r[s])return r[s];const i=await fo({...n,alg:s});return r?r[s]=i:t.set(e,{[s]:i}),i},ho=(t,e)=>{if(Hr(t)){let n=t.export({format:"jwk"});return delete n.d,delete n.dp,delete n.dq,delete n.p,delete n.q,delete n.qi,n.k?Br(n.k):(sn||(sn=new WeakMap),qr(sn,t,n,e))}return t},mo=(t,e)=>{if(Hr(t)){let n=t.export({format:"jwk"});return n.k?Br(n.k):(nn||(nn=new WeakMap),qr(nn,t,n,e))}return t},ks={normalizePublicKey:ho,normalizePrivateKey:mo},Me=t=>t==null?void 0:t[Symbol.toStringTag],po=(t,e)=>{if(!(e instanceof Uint8Array)){if(!Ur(e))throw new TypeError(Fr(t,e,...Lt,"Uint8Array"));if(e.type!=="secret")throw new TypeError(`${Me(e)} instances for symmetric algorithms must be of type "secret"`)}},go=(t,e,n)=>{if(!Ur(e))throw new TypeError(Fr(t,e,...Lt));if(e.type==="secret")throw new TypeError(`${Me(e)} instances for asymmetric algorithms must not be of type "secret"`);if(n==="sign"&&e.type==="public")throw new TypeError(`${Me(e)} instances for asymmetric algorithm signing must be of type "private"`);if(n==="decrypt"&&e.type==="public")throw new TypeError(`${Me(e)} instances for asymmetric algorithm decryption must be of type "private"`);if(e.algorithm&&n==="verify"&&e.type==="private")throw new TypeError(`${Me(e)} instances for asymmetric algorithm verifying must be of type "public"`);if(e.algorithm&&n==="encrypt"&&e.type==="private")throw new TypeError(`${Me(e)} instances for asymmetric algorithm encryption must be of type "public"`)},_o=(t,e,n)=>{t.startsWith("HS")||t==="dir"||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?po(t,e):go(t,e,n)},yo=_o;function To(t,e,n,s,r){if(r.crit!==void 0&&(s==null?void 0:s.crit)===void 0)throw new t('"crit" (Critical) Header Parameter MUST be integrity protected');if(!s||s.crit===void 0)return new Set;if(!Array.isArray(s.crit)||s.crit.length===0||s.crit.some(a=>typeof a!="string"||a.length===0))throw new t('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let i;n!==void 0?i=new Map([...Object.entries(n),...e.entries()]):i=e;for(const a of s.crit){if(!i.has(a))throw new Ue(`Extension Header Parameter "${a}" is not recognized`);if(r[a]===void 0)throw new t(`Extension Header Parameter "${a}" is missing`);if(i.get(a)&&s[a]===void 0)throw new t(`Extension Header Parameter "${a}" MUST be integrity protected`)}return new Set(s.crit)}function Eo(t,e){const n=`SHA-${t.slice(-3)}`;switch(t){case"HS256":case"HS384":case"HS512":return{hash:n,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:n,name:"RSA-PSS",saltLength:t.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:n,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:n,name:"ECDSA",namedCurve:e.namedCurve};case"EdDSA":return{name:e.name};default:throw new Ue(`alg ${t} is not supported either by JOSE or your javascript runtime`)}}async function So(t,e,n){if(n==="sign"&&(e=await ks.normalizePrivateKey(e,t)),n==="verify"&&(e=await ks.normalizePublicKey(e,t)),Mr(e))return so(e,t,n),e;if(e instanceof Uint8Array){if(!t.startsWith("HS"))throw new TypeError(bs(e,...Lt));return $n.subtle.importKey("raw",e,{hash:`SHA-${t.slice(-3)}`,name:"HMAC"},!1,[n])}throw new TypeError(bs(e,...Lt,"Uint8Array"))}const be=t=>Math.floor(t.getTime()/1e3),Kr=60,$r=Kr*60,Wn=$r*24,wo=Wn*7,bo=Wn*365.25,ko=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,rn=t=>{const e=ko.exec(t);if(!e||e[4]&&e[1])throw new TypeError("Invalid time period format");const n=parseFloat(e[2]),s=e[3].toLowerCase();let r;switch(s){case"sec":case"secs":case"second":case"seconds":case"s":r=Math.round(n);break;case"minute":case"minutes":case"min":case"mins":case"m":r=Math.round(n*Kr);break;case"hour":case"hours":case"hr":case"hrs":case"h":r=Math.round(n*$r);break;case"day":case"days":case"d":r=Math.round(n*Wn);break;case"week":case"weeks":case"w":r=Math.round(n*wo);break;default:r=Math.round(n*bo);break}return e[1]==="-"||e[4]==="ago"?-r:r},Ro=async(t,e,n)=>{const s=await So(t,e,"sign");co(t,s);const r=await $n.subtle.sign(Eo(t,s.algorithm),s,n);return new Uint8Array(r)},Co=Ro;class Ao{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,n){if(!this._protectedHeader&&!this._unprotectedHeader)throw new Xe("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!io(this._protectedHeader,this._unprotectedHeader))throw new Xe("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const s={...this._protectedHeader,...this._unprotectedHeader},r=To(Xe,new Map([["b64",!0]]),n==null?void 0:n.crit,this._protectedHeader,s);let i=!0;if(r.has("b64")&&(i=this._protectedHeader.b64,typeof i!="boolean"))throw new Xe('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:a}=s;if(typeof a!="string"||!a)throw new Xe('JWS "alg" (Algorithm) Header Parameter missing or invalid');yo(a,e,"sign");let o=this._payload;i&&(o=Fe.encode(en(o)));let u;this._protectedHeader?u=Fe.encode(en(JSON.stringify(this._protectedHeader))):u=Fe.encode("");const l=Ya(u,Fe.encode("."),o),c=await Co(a,e,l),d={signature:en(c),payload:""};return i&&(d.payload=Sn.decode(o)),this._unprotectedHeader&&(d.header=this._unprotectedHeader),this._protectedHeader&&(d.protected=Sn.decode(u)),d}}class No{constructor(e){this._flattened=new Ao(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,n){const s=await this._flattened.sign(e,n);if(s.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${s.protected}.${s.payload}.${s.signature}`}}function ke(t,e){if(!Number.isFinite(e))throw new TypeError(`Invalid ${t} input`);return e}class Io{constructor(e={}){if(!oo(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return typeof e=="number"?this._payload={...this._payload,nbf:ke("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:ke("setNotBefore",be(e))}:this._payload={...this._payload,nbf:be(new Date)+rn(e)},this}setExpirationTime(e){return typeof e=="number"?this._payload={...this._payload,exp:ke("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:ke("setExpirationTime",be(e))}:this._payload={...this._payload,exp:be(new Date)+rn(e)},this}setIssuedAt(e){return typeof e>"u"?this._payload={...this._payload,iat:be(new Date)}:e instanceof Date?this._payload={...this._payload,iat:ke("setIssuedAt",be(e))}:typeof e=="string"?this._payload={...this._payload,iat:ke("setIssuedAt",be(new Date)+rn(e))}:this._payload={...this._payload,iat:ke("setIssuedAt",e)},this}}class Oo extends Io{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,n){var r;const s=new No(Fe.encode(JSON.stringify(this._payload)));if(s.setProtectedHeader(this._protectedHeader),Array.isArray((r=this._protectedHeader)==null?void 0:r.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new eo("JWTs MUST NOT use unencoded payload");return s.sign(e,n)}}function v(t,e){if(!t)throw new Error(e)}const vo=34028234663852886e22,Do=-34028234663852886e22,Po=4294967295,Lo=2147483647,Mo=-2147483648;function Rt(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>Lo||t<Mo)throw new Error("invalid int 32: "+t)}function wn(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>Po||t<0)throw new Error("invalid uint 32: "+t)}function Vr(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>vo||t<Do))throw new Error("invalid float 32: "+t)}const Wr=Symbol("@bufbuild/protobuf/enum-type");function xo(t){const e=t[Wr];return v(e,"missing enum type on enum object"),e}function Jr(t,e,n,s){t[Wr]=jr(e,n.map(r=>({no:r.no,name:r.name,localName:t[r.no]})))}function jr(t,e,n){const s=Object.create(null),r=Object.create(null),i=[];for(const a of e){const o=Gr(a);i.push(o),s[a.name]=o,r[a.no]=o}return{typeName:t,values:i,findName(a){return s[a]},findNumber(a){return r[a]}}}function Fo(t,e,n){const s={};for(const r of e){const i=Gr(r);s[i.localName]=i.no,s[i.no]=i.localName}return Jr(s,t,e),s}function Gr(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class zr{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const s=this.getType(),r=s.runtime.bin,i=r.makeReadOptions(n);return r.readMessage(this,i.readerFactory(e),e.byteLength,i),this}fromJson(e,n){const s=this.getType(),r=s.runtime.json,i=r.makeReadOptions(n);return r.readMessage(s,e,i,this),this}fromJsonString(e,n){let s;try{s=JSON.parse(e)}catch(r){throw new Error(`cannot decode ${this.getType().typeName} from JSON: ${r instanceof Error?r.message:String(r)}`)}return this.fromJson(s,n)}toBinary(e){const n=this.getType(),s=n.runtime.bin,r=s.makeWriteOptions(e),i=r.writerFactory();return s.writeMessage(this,i,r),i.finish()}toJson(e){const n=this.getType(),s=n.runtime.json,r=s.makeWriteOptions(e);return s.writeMessage(this,r)}toJsonString(e){var n;const s=this.toJson(e);return JSON.stringify(s,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function Uo(t,e,n,s){var r;const i=(r=s==null?void 0:s.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),a={[i]:function(o){t.util.initFields(this),t.util.initPartial(o,this)}}[i];return Object.setPrototypeOf(a.prototype,new zr),Object.assign(a,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(o,u){return new a().fromBinary(o,u)},fromJson(o,u){return new a().fromJson(o,u)},fromJsonString(o,u){return new a().fromJsonString(o,u)},equals(o,u){return t.util.equals(a,o,u)}}),a}function Bo(){let t=0,e=0;for(let s=0;s<28;s+=7){let r=this.buf[this.pos++];if(t|=(r&127)<<s,!(r&128))return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,!(n&128))return this.assertBounds(),[t,e];for(let s=3;s<=31;s+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<s,!(r&128))return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function an(t,e,n){for(let i=0;i<28;i=i+7){const a=t>>>i,o=!(!(a>>>7)&&e==0),u=(o?a|128:a)&255;if(n.push(u),!o)return}const s=t>>>28&15|(e&7)<<4,r=!!(e>>3);if(n.push((r?s|128:s)&255),!!r){for(let i=3;i<31;i=i+7){const a=e>>>i,o=!!(a>>>7),u=(o?a|128:a)&255;if(n.push(u),!o)return}n.push(e>>>31&1)}}const Ct=4294967296;function Rs(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let s=0,r=0;function i(a,o){const u=Number(t.slice(a,o));r*=n,s=s*n+u,s>=Ct&&(r=r+(s/Ct|0),s=s%Ct)}return i(-24,-18),i(-18,-12),i(-12,-6),i(-6),e?Xr(s,r):Jn(s,r)}function Ho(t,e){let n=Jn(t,e);const s=n.hi&2147483648;s&&(n=Xr(n.lo,n.hi));const r=Yr(n.lo,n.hi);return s?"-"+r:r}function Yr(t,e){if({lo:t,hi:e}=qo(t,e),e<=2097151)return String(Ct*e+t);const n=t&16777215,s=(t>>>24|e<<8)&16777215,r=e>>16&65535;let i=n+s*6777216+r*6710656,a=s+r*8147497,o=r*2;const u=1e7;return i>=u&&(a+=Math.floor(i/u),i%=u),a>=u&&(o+=Math.floor(a/u),a%=u),o.toString()+Cs(a)+Cs(i)}function qo(t,e){return{lo:t>>>0,hi:e>>>0}}function Jn(t,e){return{lo:t|0,hi:e|0}}function Xr(t,e){return e=~e,t?t=~t+1:e+=1,Jn(t,e)}const Cs=t=>{const e=String(t);return"0000000".slice(e.length)+e};function As(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function Ko(){let t=this.buf[this.pos++],e=t&127;if(!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,!(t&128))return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;t&128&&n<10;n++)t=this.buf[this.pos++];if(t&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function $o(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof ge.process!="object"||typeof ge.process.env!="object"||{}.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),i=BigInt("9223372036854775807"),a=BigInt("0"),o=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(u){const l=typeof u=="bigint"?u:BigInt(u);if(l>i||l<r)throw new Error(`int64 invalid: ${u}`);return l},uParse(u){const l=typeof u=="bigint"?u:BigInt(u);if(l>o||l<a)throw new Error(`uint64 invalid: ${u}`);return l},enc(u){return t.setBigInt64(0,this.parse(u),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(u){return t.setBigInt64(0,this.uParse(u),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(u,l){return t.setInt32(0,u,!0),t.setInt32(4,l,!0),t.getBigInt64(0,!0)},uDec(u,l){return t.setInt32(0,u,!0),t.setInt32(4,l,!0),t.getBigUint64(0,!0)}}}const n=r=>v(/^-?[0-9]+$/.test(r),`int64 invalid: ${r}`),s=r=>v(/^[0-9]+$/.test(r),`uint64 invalid: ${r}`);return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),s(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),n(r),Rs(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),s(r),Rs(r)},dec(r,i){return Ho(r,i)},uDec(r,i){return Yr(r,i)}}}const q=$o();var m;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(m||(m={}));var _e;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(_e||(_e={}));function le(t,e,n){if(e===n)return!0;if(t==m.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==n[s])return!1;return!0}switch(t){case m.UINT64:case m.FIXED64:case m.INT64:case m.SFIXED64:case m.SINT64:return e==n}return!1}function $e(t,e){switch(t){case m.BOOL:return!1;case m.UINT64:case m.FIXED64:case m.INT64:case m.SFIXED64:case m.SINT64:return e==0?q.zero:"0";case m.DOUBLE:case m.FLOAT:return 0;case m.BYTES:return new Uint8Array(0);case m.STRING:return"";default:return 0}}function Qr(t,e){switch(t){case m.BOOL:return e===!1;case m.STRING:return e==="";case m.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var D;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(D||(D={}));class Vo{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let n=new Uint8Array(e),s=0;for(let r=0;r<this.chunks.length;r++)n.set(this.chunks[r],s),s+=this.chunks[r].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(wn(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Rt(e),As(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){Vr(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){wn(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){Rt(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return Rt(e),e=(e<<1^e>>31)>>>0,As(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),s=new DataView(n.buffer),r=q.enc(e);return s.setInt32(0,r.lo,!0),s.setInt32(4,r.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),s=new DataView(n.buffer),r=q.uEnc(e);return s.setInt32(0,r.lo,!0),s.setInt32(4,r.hi,!0),this.raw(n)}int64(e){let n=q.enc(e);return an(n.lo,n.hi,this.buf),this}sint64(e){let n=q.enc(e),s=n.hi>>31,r=n.lo<<1^s,i=(n.hi<<1|n.lo>>>31)^s;return an(r,i,this.buf),this}uint64(e){let n=q.uEnc(e);return an(n.lo,n.hi,this.buf),this}}class Wo{constructor(e,n){this.varint64=Bo,this.uint32=Ko,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,s=e&7;if(n<=0||s<0||s>5)throw new Error("illegal tag: field no "+n+" wire type "+s);return[n,s]}skip(e,n){let s=this.pos;switch(e){case D.Varint:for(;this.buf[this.pos++]&128;);break;case D.Bit64:this.pos+=4;case D.Bit32:this.pos+=4;break;case D.LengthDelimited:let r=this.uint32();this.pos+=r;break;case D.StartGroup:for(;;){const[i,a]=this.tag();if(a===D.EndGroup){if(n!==void 0&&i!==n)throw new Error("invalid end group tag");break}this.skip(a,i)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(s,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return q.dec(...this.varint64())}uint64(){return q.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),s=-(e&1);return e=(e>>>1|(n&1)<<31)^s,n=n>>>1^s,q.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return q.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return q.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function Jo(t,e,n,s){let r;return{typeName:e,extendee:n,get field(){if(!r){const i=typeof s=="function"?s():s;i.name=e.split(".").pop(),i.jsonName=`[${e}]`,r=t.util.newFieldList([i]).list()[0]}return r},runtime:t}}function Zr(t){const e=t.field.localName,n=Object.create(null);return n[e]=jo(t),[n,()=>n[e]]}function jo(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return $e(e.T,e.L);case"message":const n=e.T,s=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(s):s;case"map":throw"map fields are not allowed to be extensions"}}function Go(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let ae="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Ht=[];for(let t=0;t<ae.length;t++)Ht[ae[t].charCodeAt(0)]=t;Ht["-".charCodeAt(0)]=ae.indexOf("+");Ht["_".charCodeAt(0)]=ae.indexOf("/");const ei={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),s=0,r=0,i,a=0;for(let o=0;o<t.length;o++){if(i=Ht[t.charCodeAt(o)],i===void 0)switch(t[o]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:a=i,r=1;break;case 1:n[s++]=a<<2|(i&48)>>4,a=i,r=2;break;case 2:n[s++]=(a&15)<<4|(i&60)>>2,a=i,r=3;break;case 3:n[s++]=(a&3)<<6|i,r=0;break}}if(r==1)throw Error("invalid base64 string.");return n.subarray(0,s)},enc(t){let e="",n=0,s,r=0;for(let i=0;i<t.length;i++)switch(s=t[i],n){case 0:e+=ae[s>>2],r=(s&3)<<4,n=1;break;case 1:e+=ae[r|s>>4],r=(s&15)<<2,n=2;break;case 2:e+=ae[r|s>>6],e+=ae[s&63],n=0;break}return n&&(e+=ae[r],e+="=",n==1&&(e+="=")),e}};function zo(t,e,n){ni(e,t);const s=e.runtime.bin.makeReadOptions(n),r=Go(t.getType().runtime.bin.listUnknownFields(t),e.field),[i,a]=Zr(e);for(const o of r)e.runtime.bin.readField(i,s.readerFactory(o.data),e.field,o.wireType,s);return a()}function Yo(t,e,n,s){ni(e,t);const r=e.runtime.bin.makeReadOptions(s),i=e.runtime.bin.makeWriteOptions(s);if(ti(t,e)){const l=t.getType().runtime.bin.listUnknownFields(t).filter(c=>c.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const c of l)t.getType().runtime.bin.onUnknownField(t,c.no,c.wireType,c.data)}const a=i.writerFactory();let o=e.field;!o.opt&&!o.repeated&&(o.kind=="enum"||o.kind=="scalar")&&(o=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(o,n,a,i);const u=r.readerFactory(a.finish());for(;u.pos<u.len;){const[l,c]=u.tag(),d=u.skip(c,l);t.getType().runtime.bin.onUnknownField(t,l,c,d)}}function ti(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(s=>s.no==e.field.no)}function ni(t,e){v(t.extendee.typeName==e.getType().typeName,`extension ${t.typeName} can only be applied to message ${t.extendee.typeName}`)}function si(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!Qr(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function Ns(t,e){const n=t.localName,s=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=s?t.T.values[0].no:void 0;break;case"scalar":e[n]=s?$e(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function Ce(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(zr.prototype).every(s=>s in t&&typeof t[s]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function ri(t,e){return Ce(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}m.DOUBLE,m.FLOAT,m.INT64,m.UINT64,m.INT32,m.UINT32,m.BOOL,m.STRING,m.BYTES;const Is={ignoreUnknownFields:!1},Os={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function Xo(t){return t?Object.assign(Object.assign({},Is),t):Is}function Qo(t){return t?Object.assign(Object.assign({},Os),t):Os}const Mt=Symbol(),At=Symbol();function Zo(){return{makeReadOptions:Xo,makeWriteOptions:Qo,readMessage(t,e,n,s){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error(`cannot decode message ${t.typeName} from JSON: ${Z(e)}`);s=s??new t;const r=new Map,i=n.typeRegistry;for(const[a,o]of Object.entries(e)){const u=t.fields.findJsonName(a);if(u){if(u.oneof){if(o===null&&u.kind=="scalar")continue;const l=r.get(u.oneof);if(l!==void 0)throw new Error(`cannot decode message ${t.typeName} from JSON: multiple keys for oneof "${u.oneof.name}" present: "${l}", "${a}"`);r.set(u.oneof,a)}vs(s,o,u,n,t)}else{let l=!1;if(i!=null&&i.findExtension&&a.startsWith("[")&&a.endsWith("]")){const c=i.findExtension(a.substring(1,a.length-1));if(c&&c.extendee.typeName==t.typeName){l=!0;const[d,h]=Zr(c);vs(d,o,c.field,n,c),Yo(s,c,h(),n)}}if(!l&&!n.ignoreUnknownFields)throw new Error(`cannot decode message ${t.typeName} from JSON: key "${a}" is unknown`)}}return s},writeMessage(t,e){const n=t.getType(),s={};let r;try{for(r of n.fields.byNumber()){if(!si(r,t)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!tc(r))continue}const a=r.oneof?t[r.oneof.localName].value:t[r.localName],o=Ds(r,a,e);o!==void 0&&(s[e.useProtoFieldName?r.name:r.jsonName]=o)}const i=e.typeRegistry;if(i!=null&&i.findExtensionFor)for(const a of n.runtime.bin.listUnknownFields(t)){const o=i.findExtensionFor(n.typeName,a.no);if(o&&ti(t,o)){const u=zo(t,o,e),l=Ds(o.field,u,e);l!==void 0&&(s[o.field.jsonName]=l)}}}catch(i){const a=r?`cannot encode field ${n.typeName}.${r.name} to JSON`:`cannot encode message ${n.typeName} to JSON`,o=i instanceof Error?i.message:String(i);throw new Error(a+(o.length>0?`: ${o}`:""))}return s},readScalar(t,e,n){return et(t,e,n??_e.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||Qr(t,e)))return Nt(t,e)},debug:Z}}function Z(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":`"${t.split('"').join('\\"')}"`;default:return String(t)}}function vs(t,e,n,s,r){let i=n.localName;if(n.repeated){if(v(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error(`cannot decode field ${r.typeName}.${n.name} from JSON: ${Z(e)}`);const a=t[i];for(const o of e){if(o===null)throw new Error(`cannot decode field ${r.typeName}.${n.name} from JSON: ${Z(o)}`);switch(n.kind){case"message":a.push(n.T.fromJson(o,s));break;case"enum":const u=on(n.T,o,s.ignoreUnknownFields,!0);u!==At&&a.push(u);break;case"scalar":try{a.push(et(n.T,o,n.L,!0))}catch(l){let c=`cannot decode field ${r.typeName}.${n.name} from JSON: ${Z(o)}`;throw l instanceof Error&&l.message.length>0&&(c+=`: ${l.message}`),new Error(c)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error(`cannot decode field ${r.typeName}.${n.name} from JSON: ${Z(e)}`);const a=t[i];for(const[o,u]of Object.entries(e)){if(u===null)throw new Error(`cannot decode field ${r.typeName}.${n.name} from JSON: map value null`);let l;try{l=ec(n.K,o)}catch(c){let d=`cannot decode map key for field ${r.typeName}.${n.name} from JSON: ${Z(e)}`;throw c instanceof Error&&c.message.length>0&&(d+=`: ${c.message}`),new Error(d)}switch(n.V.kind){case"message":a[l]=n.V.T.fromJson(u,s);break;case"enum":const c=on(n.V.T,u,s.ignoreUnknownFields,!0);c!==At&&(a[l]=c);break;case"scalar":try{a[l]=et(n.V.T,u,_e.BIGINT,!0)}catch(d){let h=`cannot decode map value for field ${r.typeName}.${n.name} from JSON: ${Z(e)}`;throw d instanceof Error&&d.message.length>0&&(h+=`: ${d.message}`),new Error(h)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:i},i="value"),n.kind){case"message":const a=n.T;if(e===null&&a.typeName!="google.protobuf.Value")return;let o=t[i];Ce(o)?o.fromJson(e,s):(t[i]=o=a.fromJson(e,s),a.fieldWrapper&&!n.oneof&&(t[i]=a.fieldWrapper.unwrapField(o)));break;case"enum":const u=on(n.T,e,s.ignoreUnknownFields,!1);switch(u){case Mt:Ns(n,t);break;case At:break;default:t[i]=u;break}break;case"scalar":try{const l=et(n.T,e,n.L,!1);switch(l){case Mt:Ns(n,t);break;default:t[i]=l;break}}catch(l){let c=`cannot decode field ${r.typeName}.${n.name} from JSON: ${Z(e)}`;throw l instanceof Error&&l.message.length>0&&(c+=`: ${l.message}`),new Error(c)}break}}function ec(t,e){if(t===m.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return et(t,e,_e.BIGINT,!0).toString()}function et(t,e,n,s){if(e===null)return s?$e(t,n):Mt;switch(t){case m.DOUBLE:case m.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return t==m.FLOAT&&Vr(r),r;case m.INT32:case m.FIXED32:case m.SFIXED32:case m.SINT32:case m.UINT32:let i;if(typeof e=="number"?i=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(i=Number(e)),i===void 0)break;return t==m.UINT32||t==m.FIXED32?wn(i):Rt(i),i;case m.INT64:case m.SFIXED64:case m.SINT64:if(typeof e!="number"&&typeof e!="string")break;const a=q.parse(e);return n?a.toString():a;case m.FIXED64:case m.UINT64:if(typeof e!="number"&&typeof e!="string")break;const o=q.uParse(e);return n?o.toString():o;case m.BOOL:if(typeof e!="boolean")break;return e;case m.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case m.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return ei.dec(e)}throw new Error}function on(t,e,n,s){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:s?t.values[0].no:Mt;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r!==void 0)return r.no;if(n)return At;break}throw new Error(`cannot decode enum ${t.typeName} from JSON: ${Z(e)}`)}function tc(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function Ds(t,e,n){if(t.kind=="map"){v(typeof e=="object"&&e!=null);const s={},r=Object.entries(e);switch(t.V.kind){case"scalar":for(const[a,o]of r)s[a.toString()]=Nt(t.V.T,o);break;case"message":for(const[a,o]of r)s[a.toString()]=o.toJson(n);break;case"enum":const i=t.V.T;for(const[a,o]of r)s[a.toString()]=cn(i,o,n.enumAsInteger);break}return n.emitDefaultValues||r.length>0?s:void 0}if(t.repeated){v(Array.isArray(e));const s=[];switch(t.kind){case"scalar":for(let r=0;r<e.length;r++)s.push(Nt(t.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)s.push(cn(t.T,e[r],n.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)s.push(e[r].toJson(n));break}return n.emitDefaultValues||s.length>0?s:void 0}switch(t.kind){case"scalar":return Nt(t.T,e);case"enum":return cn(t.T,e,n.enumAsInteger);case"message":return ri(t.T,e).toJson(n)}}function cn(t,e,n){var s;if(v(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const r=t.findNumber(e);return(s=r==null?void 0:r.name)!==null&&s!==void 0?s:e}function Nt(t,e){switch(t){case m.INT32:case m.SFIXED32:case m.SINT32:case m.FIXED32:case m.UINT32:return v(typeof e=="number"),e;case m.FLOAT:case m.DOUBLE:return v(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case m.STRING:return v(typeof e=="string"),e;case m.BOOL:return v(typeof e=="boolean"),e;case m.UINT64:case m.FIXED64:case m.INT64:case m.SFIXED64:case m.SINT64:return v(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case m.BYTES:return v(e instanceof Uint8Array),ei.enc(e)}}const Le=Symbol("@bufbuild/protobuf/unknown-fields"),Ps={readUnknownFields:!0,readerFactory:t=>new Wo(t)},Ls={writeUnknownFields:!0,writerFactory:()=>new Vo};function nc(t){return t?Object.assign(Object.assign({},Ps),t):Ps}function sc(t){return t?Object.assign(Object.assign({},Ls),t):Ls}function rc(){return{makeReadOptions:nc,makeWriteOptions:sc,listUnknownFields(t){var e;return(e=t[Le])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[Le]},writeUnknownFields(t,e){const s=t[Le];if(s)for(const r of s)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,s){const r=t;Array.isArray(r[Le])||(r[Le]=[]),r[Le].push({no:e,wireType:n,data:s})},readMessage(t,e,n,s,r){const i=t.getType(),a=r?e.len:e.pos+n;let o,u;for(;e.pos<a&&([o,u]=e.tag(),!(r===!0&&u==D.EndGroup));){const l=i.fields.find(o);if(!l){const c=e.skip(u,o);s.readUnknownFields&&this.onUnknownField(t,o,u,c);continue}Ms(t,e,l,u,s)}if(r&&(u!=D.EndGroup||o!==n))throw new Error("invalid end group tag")},readField:Ms,writeMessage(t,e,n){const s=t.getType();for(const r of s.fields.byNumber()){if(!si(r,t)){if(r.req)throw new Error(`cannot encode field ${s.typeName}.${r.name} to binary: required field not set`);continue}const i=r.oneof?t[r.oneof.localName].value:t[r.localName];xs(r,i,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,s){e!==void 0&&xs(t,e,n,s)}}}function Ms(t,e,n,s,r){let{repeated:i,localName:a}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=a&&delete t.value,t.case=a,a="value"),n.kind){case"scalar":case"enum":const o=n.kind=="enum"?m.INT32:n.T;let u=xt;if(n.kind=="scalar"&&n.L>0&&(u=ac),i){let h=t[a];if(s==D.LengthDelimited&&o!=m.STRING&&o!=m.BYTES){let g=e.uint32()+e.pos;for(;e.pos<g;)h.push(u(e,o))}else h.push(u(e,o))}else t[a]=u(e,o);break;case"message":const l=n.T;i?t[a].push(It(e,new l,r,n)):Ce(t[a])?It(e,t[a],r,n):(t[a]=It(e,new l,r,n),l.fieldWrapper&&!n.oneof&&!n.repeated&&(t[a]=l.fieldWrapper.unwrapField(t[a])));break;case"map":let[c,d]=ic(n,e,r);t[a][c]=d;break}}function It(t,e,n,s){const r=e.getType().runtime.bin,i=s==null?void 0:s.delimited;return r.readMessage(e,t,i?s.no:t.uint32(),n,i),e}function ic(t,e,n){const s=e.uint32(),r=e.pos+s;let i,a;for(;e.pos<r;){const[o]=e.tag();switch(o){case 1:i=xt(e,t.K);break;case 2:switch(t.V.kind){case"scalar":a=xt(e,t.V.T);break;case"enum":a=e.int32();break;case"message":a=It(e,new t.V.T,n,void 0);break}break}}if(i===void 0&&(i=$e(t.K,_e.BIGINT)),typeof i!="string"&&typeof i!="number"&&(i=i.toString()),a===void 0)switch(t.V.kind){case"scalar":a=$e(t.V.T,_e.BIGINT);break;case"enum":a=t.V.T.values[0].no;break;case"message":a=new t.V.T;break}return[i,a]}function ac(t,e){const n=xt(t,e);return typeof n=="bigint"?n.toString():n}function xt(t,e){switch(e){case m.STRING:return t.string();case m.BOOL:return t.bool();case m.DOUBLE:return t.double();case m.FLOAT:return t.float();case m.INT32:return t.int32();case m.INT64:return t.int64();case m.UINT64:return t.uint64();case m.FIXED64:return t.fixed64();case m.BYTES:return t.bytes();case m.FIXED32:return t.fixed32();case m.SFIXED32:return t.sfixed32();case m.SFIXED64:return t.sfixed64();case m.SINT64:return t.sint64();case m.UINT32:return t.uint32();case m.SINT32:return t.sint32()}}function xs(t,e,n,s){v(e!==void 0);const r=t.repeated;switch(t.kind){case"scalar":case"enum":let i=t.kind=="enum"?m.INT32:t.T;if(r)if(v(Array.isArray(e)),t.packed)cc(n,i,t.no,e);else for(const a of e)tt(n,i,t.no,a);else tt(n,i,t.no,e);break;case"message":if(r){v(Array.isArray(e));for(const a of e)Fs(n,s,t,a)}else Fs(n,s,t,e);break;case"map":v(typeof e=="object"&&e!=null);for(const[a,o]of Object.entries(e))oc(n,s,t,a,o);break}}function oc(t,e,n,s,r){t.tag(n.no,D.LengthDelimited),t.fork();let i=s;switch(n.K){case m.INT32:case m.FIXED32:case m.UINT32:case m.SFIXED32:case m.SINT32:i=Number.parseInt(s);break;case m.BOOL:v(s=="true"||s=="false"),i=s=="true";break}switch(tt(t,n.K,1,i),n.V.kind){case"scalar":tt(t,n.V.T,2,r);break;case"enum":tt(t,m.INT32,2,r);break;case"message":v(r!==void 0),t.tag(2,D.LengthDelimited).bytes(r.toBinary(e));break}t.join()}function Fs(t,e,n,s){const r=ri(n.T,s);n.delimited?t.tag(n.no,D.StartGroup).raw(r.toBinary(e)).tag(n.no,D.EndGroup):t.tag(n.no,D.LengthDelimited).bytes(r.toBinary(e))}function tt(t,e,n,s){v(s!==void 0);let[r,i]=ii(e);t.tag(n,r)[i](s)}function cc(t,e,n,s){if(!s.length)return;t.tag(n,D.LengthDelimited).fork();let[,r]=ii(e);for(let i=0;i<s.length;i++)t[r](s[i]);t.join()}function ii(t){let e=D.Varint;switch(t){case m.BYTES:case m.STRING:e=D.LengthDelimited;break;case m.DOUBLE:case m.FIXED64:case m.SFIXED64:e=D.Bit64;break;case m.FIXED32:case m.SFIXED32:case m.FLOAT:e=D.Bit32;break}const n=m[t].toLowerCase();return[e,n]}function uc(){return{setEnumType:Jr,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const s of n.fields.byMember()){const r=s.localName,i=e,a=t;if(a[r]!=null)switch(s.kind){case"oneof":const o=a[r].case;if(o===void 0)continue;const u=s.findField(o);let l=a[r].value;u&&u.kind=="message"&&!Ce(l,u.T)?l=new u.T(l):u&&u.kind==="scalar"&&u.T===m.BYTES&&(l=Qe(l)),i[r]={case:o,value:l};break;case"scalar":case"enum":let c=a[r];s.T===m.BYTES&&(c=s.repeated?c.map(Qe):Qe(c)),i[r]=c;break;case"map":switch(s.V.kind){case"scalar":case"enum":if(s.V.T===m.BYTES)for(const[E,g]of Object.entries(a[r]))i[r][E]=Qe(g);else Object.assign(i[r],a[r]);break;case"message":const h=s.V.T;for(const E of Object.keys(a[r])){let g=a[r][E];h.fieldWrapper||(g=new h(g)),i[r][E]=g}break}break;case"message":const d=s.T;if(s.repeated)i[r]=a[r].map(h=>Ce(h,d)?h:new d(h));else{const h=a[r];d.fieldWrapper?d.typeName==="google.protobuf.BytesValue"?i[r]=Qe(h):i[r]=h:i[r]=Ce(h,d)?h:new d(h)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(s=>{const r=e[s.localName],i=n[s.localName];if(s.repeated){if(r.length!==i.length)return!1;switch(s.kind){case"message":return r.every((a,o)=>s.T.equals(a,i[o]));case"scalar":return r.every((a,o)=>le(s.T,a,i[o]));case"enum":return r.every((a,o)=>le(m.INT32,a,i[o]))}throw new Error(`repeated cannot contain ${s.kind}`)}switch(s.kind){case"message":return s.T.equals(r,i);case"enum":return le(m.INT32,r,i);case"scalar":return le(s.T,r,i);case"oneof":if(r.case!==i.case)return!1;const a=s.findField(r.case);if(a===void 0)return!0;switch(a.kind){case"message":return a.T.equals(r.value,i.value);case"enum":return le(m.INT32,r.value,i.value);case"scalar":return le(a.T,r.value,i.value)}throw new Error(`oneof cannot contain ${a.kind}`);case"map":const o=Object.keys(r).concat(Object.keys(i));switch(s.V.kind){case"message":const u=s.V.T;return o.every(c=>u.equals(r[c],i[c]));case"enum":return o.every(c=>le(m.INT32,r[c],i[c]));case"scalar":const l=s.V.T;return o.every(c=>le(l,r[c],i[c]))}break}})},clone(t){const e=t.getType(),n=new e,s=n;for(const r of e.fields.byMember()){const i=t[r.localName];let a;if(r.repeated)a=i.map(wt);else if(r.kind=="map"){a=s[r.localName];for(const[o,u]of Object.entries(i))a[o]=wt(u)}else r.kind=="oneof"?a=r.findField(i.case)?{case:i.case,value:wt(i.value)}:{case:void 0}:a=wt(i);s[r.localName]=a}for(const r of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(s,r.no,r.wireType,r.data);return n}}}function wt(t){if(t===void 0)return t;if(Ce(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function Qe(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function lc(t,e,n){return{syntax:t,json:Zo(),bin:rc(),util:Object.assign(Object.assign({},uc()),{newFieldList:e,initFields:n}),makeMessageType(s,r,i){return Uo(this,s,r,i)},makeEnum:Fo,makeEnumType:jr,getEnumType:xo,makeExtension(s,r,i){return Jo(this,s,r,i)}}}class dc{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const s of this.list())n[s.jsonName]=n[s.name]=s;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const s of this.list())n[s.no]=s;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const s of this.list())s.oneof?s.oneof!==n&&(n=s.oneof,e.push(n)):e.push(s)}return this.members}}function ai(t,e){const n=oi(t);return e?n:_c(gc(n))}function fc(t){return ai(t,!1)}const hc=oi;function oi(t){let e=!1;const n=[];for(let s=0;s<t.length;s++){let r=t.charAt(s);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),n.push(r);break}}return n.join("")}const mc=new Set(["constructor","toString","toJSON","valueOf"]),pc=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),ci=t=>`${t}$`,gc=t=>pc.has(t)?ci(t):t,_c=t=>mc.has(t)?ci(t):t;class yc{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=fc(e)}addField(e){v(e.oneof===this,`field ${e.name} not one of ${this.name}`),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function Tc(t,e){var n,s,r,i,a,o;const u=[];let l;for(const c of typeof t=="function"?t():t){const d=c;if(d.localName=ai(c.name,c.oneof!==void 0),d.jsonName=(n=c.jsonName)!==null&&n!==void 0?n:hc(c.name),d.repeated=(s=c.repeated)!==null&&s!==void 0?s:!1,c.kind=="scalar"&&(d.L=(r=c.L)!==null&&r!==void 0?r:_e.BIGINT),d.delimited=(i=c.delimited)!==null&&i!==void 0?i:!1,d.req=(a=c.req)!==null&&a!==void 0?a:!1,d.opt=(o=c.opt)!==null&&o!==void 0?o:!1,c.packed===void 0&&(e?d.packed=c.kind=="enum"||c.kind=="scalar"&&c.T!=m.BYTES&&c.T!=m.STRING:d.packed=!1),c.oneof!==void 0){const h=typeof c.oneof=="string"?c.oneof:c.oneof.name;(!l||l.name!=h)&&(l=new yc(h)),d.oneof=l,l.addField(d)}u.push(d)}return u}const p=lc("proto3",t=>new dc(t,e=>Tc(e,!0)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,s=t;if(e.repeated){s[n]=[];continue}switch(e.kind){case"oneof":s[n]={case:void 0};break;case"enum":s[n]=0;break;case"map":s[n]={};break;case"scalar":s[n]=$e(e.T,e.L);break}}}),Ec=p.makeEnum("livekit.AudioCodec",[{no:0,name:"DEFAULT_AC"},{no:1,name:"OPUS"},{no:2,name:"AAC"}]),Sc=p.makeEnum("livekit.VideoCodec",[{no:0,name:"DEFAULT_VC"},{no:1,name:"H264_BASELINE"},{no:2,name:"H264_MAIN"},{no:3,name:"H264_HIGH"},{no:4,name:"VP8"}]),wc=p.makeEnum("livekit.ImageCodec",[{no:0,name:"IC_DEFAULT"},{no:1,name:"IC_JPEG"}]),bc=p.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Be=p.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),kc=p.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Rc=p.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"}]),Cc=p.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"}]),bn=p.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Ac,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:di}]),Ac=p.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),jn=p.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:p.getEnumType(Be),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),kn=p.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:p.getEnumType(Nc)},{no:4,name:"tracks",kind:"message",T:ui,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:jn},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:p.getEnumType(Ic)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:p.getEnumType(Rc)}]),Nc=p.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Ic=p.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),Oc=p.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),vc=p.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:li,repeated:!0}]),ui=p.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:p.getEnumType(bc)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:p.getEnumType(Be)},{no:10,name:"layers",kind:"message",T:li,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:vc,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:p.getEnumType(Oc)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:di},{no:19,name:"audio_features",kind:"enum",T:p.getEnumType(Cc),repeated:!0}]),li=p.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:p.getEnumType(kc)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]),Dc=p.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),Pc=p.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),di=p.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Lc=p.makeEnum("livekit.EncodedFileType",[{no:0,name:"DEFAULT_FILETYPE"},{no:1,name:"MP4"},{no:2,name:"OGG"}]),Mc=p.makeEnum("livekit.SegmentedFileProtocol",[{no:0,name:"DEFAULT_SEGMENTED_FILE_PROTOCOL"},{no:1,name:"HLS_PROTOCOL"}]),xc=p.makeEnum("livekit.SegmentedFileSuffix",[{no:0,name:"INDEX"},{no:1,name:"TIMESTAMP"}]),Fc=p.makeEnum("livekit.ImageFileSuffix",[{no:0,name:"IMAGE_SUFFIX_INDEX"},{no:1,name:"IMAGE_SUFFIX_TIMESTAMP"}]),fi=p.makeEnum("livekit.StreamProtocol",[{no:0,name:"DEFAULT_PROTOCOL"},{no:1,name:"RTMP"},{no:2,name:"SRT"}]),ut=p.makeEnum("livekit.EncodingOptionsPreset",[{no:0,name:"H264_720P_30"},{no:1,name:"H264_720P_60"},{no:2,name:"H264_1080P_30"},{no:3,name:"H264_1080P_60"},{no:4,name:"PORTRAIT_H264_720P_30"},{no:5,name:"PORTRAIT_H264_720P_60"},{no:6,name:"PORTRAIT_H264_1080P_30"},{no:7,name:"PORTRAIT_H264_1080P_60"}]),Uc=p.makeEnum("livekit.EgressStatus",[{no:0,name:"EGRESS_STARTING"},{no:1,name:"EGRESS_ACTIVE"},{no:2,name:"EGRESS_ENDING"},{no:3,name:"EGRESS_COMPLETE"},{no:4,name:"EGRESS_FAILED"},{no:5,name:"EGRESS_ABORTED"},{no:6,name:"EGRESS_LIMIT_REACHED"}]),Gn=p.makeMessageType("livekit.RoomCompositeEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"layout",kind:"scalar",T:9},{no:3,name:"audio_only",kind:"scalar",T:8},{no:4,name:"video_only",kind:"scalar",T:8},{no:5,name:"custom_base_url",kind:"scalar",T:9},{no:6,name:"file",kind:"message",T:ye,oneof:"output"},{no:7,name:"stream",kind:"message",T:Ee,oneof:"output"},{no:10,name:"segments",kind:"message",T:Te,oneof:"output"},{no:8,name:"preset",kind:"enum",T:p.getEnumType(ut),oneof:"options"},{no:9,name:"advanced",kind:"message",T:mt,oneof:"options"},{no:11,name:"file_outputs",kind:"message",T:ye,repeated:!0},{no:12,name:"stream_outputs",kind:"message",T:Ee,repeated:!0},{no:13,name:"segment_outputs",kind:"message",T:Te,repeated:!0},{no:14,name:"image_outputs",kind:"message",T:qt,repeated:!0}]),hi=p.makeMessageType("livekit.WebEgressRequest",()=>[{no:1,name:"url",kind:"scalar",T:9},{no:2,name:"audio_only",kind:"scalar",T:8},{no:3,name:"video_only",kind:"scalar",T:8},{no:12,name:"await_start_signal",kind:"scalar",T:8},{no:4,name:"file",kind:"message",T:ye,oneof:"output"},{no:5,name:"stream",kind:"message",T:Ee,oneof:"output"},{no:6,name:"segments",kind:"message",T:Te,oneof:"output"},{no:7,name:"preset",kind:"enum",T:p.getEnumType(ut),oneof:"options"},{no:8,name:"advanced",kind:"message",T:mt,oneof:"options"},{no:9,name:"file_outputs",kind:"message",T:ye,repeated:!0},{no:10,name:"stream_outputs",kind:"message",T:Ee,repeated:!0},{no:11,name:"segment_outputs",kind:"message",T:Te,repeated:!0},{no:13,name:"image_outputs",kind:"message",T:qt,repeated:!0}]),mi=p.makeMessageType("livekit.ParticipantEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"screen_share",kind:"scalar",T:8},{no:4,name:"preset",kind:"enum",T:p.getEnumType(ut),oneof:"options"},{no:5,name:"advanced",kind:"message",T:mt,oneof:"options"},{no:6,name:"file_outputs",kind:"message",T:ye,repeated:!0},{no:7,name:"stream_outputs",kind:"message",T:Ee,repeated:!0},{no:8,name:"segment_outputs",kind:"message",T:Te,repeated:!0},{no:9,name:"image_outputs",kind:"message",T:qt,repeated:!0}]),pi=p.makeMessageType("livekit.TrackCompositeEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"audio_track_id",kind:"scalar",T:9},{no:3,name:"video_track_id",kind:"scalar",T:9},{no:4,name:"file",kind:"message",T:ye,oneof:"output"},{no:5,name:"stream",kind:"message",T:Ee,oneof:"output"},{no:8,name:"segments",kind:"message",T:Te,oneof:"output"},{no:6,name:"preset",kind:"enum",T:p.getEnumType(ut),oneof:"options"},{no:7,name:"advanced",kind:"message",T:mt,oneof:"options"},{no:11,name:"file_outputs",kind:"message",T:ye,repeated:!0},{no:12,name:"stream_outputs",kind:"message",T:Ee,repeated:!0},{no:13,name:"segment_outputs",kind:"message",T:Te,repeated:!0},{no:14,name:"image_outputs",kind:"message",T:qt,repeated:!0}]),gi=p.makeMessageType("livekit.TrackEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"track_id",kind:"scalar",T:9},{no:3,name:"file",kind:"message",T:Bc,oneof:"output"},{no:4,name:"websocket_url",kind:"scalar",T:9,oneof:"output"}]),ye=p.makeMessageType("livekit.EncodedFileOutput",()=>[{no:1,name:"file_type",kind:"enum",T:p.getEnumType(Lc)},{no:2,name:"filepath",kind:"scalar",T:9},{no:6,name:"disable_manifest",kind:"scalar",T:8},{no:3,name:"s3",kind:"message",T:lt,oneof:"output"},{no:4,name:"gcp",kind:"message",T:dt,oneof:"output"},{no:5,name:"azure",kind:"message",T:ft,oneof:"output"},{no:7,name:"aliOSS",kind:"message",T:ht,oneof:"output"}]),Te=p.makeMessageType("livekit.SegmentedFileOutput",()=>[{no:1,name:"protocol",kind:"enum",T:p.getEnumType(Mc)},{no:2,name:"filename_prefix",kind:"scalar",T:9},{no:3,name:"playlist_name",kind:"scalar",T:9},{no:11,name:"live_playlist_name",kind:"scalar",T:9},{no:4,name:"segment_duration",kind:"scalar",T:13},{no:10,name:"filename_suffix",kind:"enum",T:p.getEnumType(xc)},{no:8,name:"disable_manifest",kind:"scalar",T:8},{no:5,name:"s3",kind:"message",T:lt,oneof:"output"},{no:6,name:"gcp",kind:"message",T:dt,oneof:"output"},{no:7,name:"azure",kind:"message",T:ft,oneof:"output"},{no:9,name:"aliOSS",kind:"message",T:ht,oneof:"output"}]),Bc=p.makeMessageType("livekit.DirectFileOutput",()=>[{no:1,name:"filepath",kind:"scalar",T:9},{no:5,name:"disable_manifest",kind:"scalar",T:8},{no:2,name:"s3",kind:"message",T:lt,oneof:"output"},{no:3,name:"gcp",kind:"message",T:dt,oneof:"output"},{no:4,name:"azure",kind:"message",T:ft,oneof:"output"},{no:6,name:"aliOSS",kind:"message",T:ht,oneof:"output"}]),qt=p.makeMessageType("livekit.ImageOutput",()=>[{no:1,name:"capture_interval",kind:"scalar",T:13},{no:2,name:"width",kind:"scalar",T:5},{no:3,name:"height",kind:"scalar",T:5},{no:4,name:"filename_prefix",kind:"scalar",T:9},{no:5,name:"filename_suffix",kind:"enum",T:p.getEnumType(Fc)},{no:6,name:"image_codec",kind:"enum",T:p.getEnumType(wc)},{no:7,name:"disable_manifest",kind:"scalar",T:8},{no:8,name:"s3",kind:"message",T:lt,oneof:"output"},{no:9,name:"gcp",kind:"message",T:dt,oneof:"output"},{no:10,name:"azure",kind:"message",T:ft,oneof:"output"},{no:11,name:"aliOSS",kind:"message",T:ht,oneof:"output"}]),lt=p.makeMessageType("livekit.S3Upload",()=>[{no:1,name:"access_key",kind:"scalar",T:9},{no:2,name:"secret",kind:"scalar",T:9},{no:11,name:"session_token",kind:"scalar",T:9},{no:3,name:"region",kind:"scalar",T:9},{no:4,name:"endpoint",kind:"scalar",T:9},{no:5,name:"bucket",kind:"scalar",T:9},{no:6,name:"force_path_style",kind:"scalar",T:8},{no:7,name:"metadata",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:8,name:"tagging",kind:"scalar",T:9},{no:9,name:"content_disposition",kind:"scalar",T:9},{no:10,name:"proxy",kind:"message",T:_i}]),dt=p.makeMessageType("livekit.GCPUpload",()=>[{no:1,name:"credentials",kind:"scalar",T:9},{no:2,name:"bucket",kind:"scalar",T:9},{no:3,name:"proxy",kind:"message",T:_i}]),ft=p.makeMessageType("livekit.AzureBlobUpload",()=>[{no:1,name:"account_name",kind:"scalar",T:9},{no:2,name:"account_key",kind:"scalar",T:9},{no:3,name:"container_name",kind:"scalar",T:9}]),ht=p.makeMessageType("livekit.AliOSSUpload",()=>[{no:1,name:"access_key",kind:"scalar",T:9},{no:2,name:"secret",kind:"scalar",T:9},{no:3,name:"region",kind:"scalar",T:9},{no:4,name:"endpoint",kind:"scalar",T:9},{no:5,name:"bucket",kind:"scalar",T:9}]),_i=p.makeMessageType("livekit.ProxyConfig",()=>[{no:1,name:"url",kind:"scalar",T:9},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"password",kind:"scalar",T:9}]),Ee=p.makeMessageType("livekit.StreamOutput",()=>[{no:1,name:"protocol",kind:"enum",T:p.getEnumType(fi)},{no:2,name:"urls",kind:"scalar",T:9,repeated:!0}]),mt=p.makeMessageType("livekit.EncodingOptions",()=>[{no:1,name:"width",kind:"scalar",T:5},{no:2,name:"height",kind:"scalar",T:5},{no:3,name:"depth",kind:"scalar",T:5},{no:4,name:"framerate",kind:"scalar",T:5},{no:5,name:"audio_codec",kind:"enum",T:p.getEnumType(Ec)},{no:6,name:"audio_bitrate",kind:"scalar",T:5},{no:11,name:"audio_quality",kind:"scalar",T:5},{no:7,name:"audio_frequency",kind:"scalar",T:5},{no:8,name:"video_codec",kind:"enum",T:p.getEnumType(Sc)},{no:9,name:"video_bitrate",kind:"scalar",T:5},{no:12,name:"video_quality",kind:"scalar",T:5},{no:10,name:"key_frame_interval",kind:"scalar",T:1}]),Hc=p.makeMessageType("livekit.UpdateLayoutRequest",()=>[{no:1,name:"egress_id",kind:"scalar",T:9},{no:2,name:"layout",kind:"scalar",T:9}]),qc=p.makeMessageType("livekit.UpdateStreamRequest",()=>[{no:1,name:"egress_id",kind:"scalar",T:9},{no:2,name:"add_output_urls",kind:"scalar",T:9,repeated:!0},{no:3,name:"remove_output_urls",kind:"scalar",T:9,repeated:!0}]),Kc=p.makeMessageType("livekit.ListEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"egress_id",kind:"scalar",T:9},{no:3,name:"active",kind:"scalar",T:8}]),$c=p.makeMessageType("livekit.ListEgressResponse",()=>[{no:1,name:"items",kind:"message",T:ie,repeated:!0}]),Vc=p.makeMessageType("livekit.StopEgressRequest",()=>[{no:1,name:"egress_id",kind:"scalar",T:9}]),ie=p.makeMessageType("livekit.EgressInfo",()=>[{no:1,name:"egress_id",kind:"scalar",T:9},{no:2,name:"room_id",kind:"scalar",T:9},{no:13,name:"room_name",kind:"scalar",T:9},{no:3,name:"status",kind:"enum",T:p.getEnumType(Uc)},{no:10,name:"started_at",kind:"scalar",T:3},{no:11,name:"ended_at",kind:"scalar",T:3},{no:18,name:"updated_at",kind:"scalar",T:3},{no:21,name:"details",kind:"scalar",T:9},{no:9,name:"error",kind:"scalar",T:9},{no:22,name:"error_code",kind:"scalar",T:5},{no:4,name:"room_composite",kind:"message",T:Gn,oneof:"request"},{no:14,name:"web",kind:"message",T:hi,oneof:"request"},{no:19,name:"participant",kind:"message",T:mi,oneof:"request"},{no:5,name:"track_composite",kind:"message",T:pi,oneof:"request"},{no:6,name:"track",kind:"message",T:gi,oneof:"request"},{no:7,name:"stream",kind:"message",T:Wc,oneof:"result"},{no:8,name:"file",kind:"message",T:Us,oneof:"result"},{no:12,name:"segments",kind:"message",T:Bs,oneof:"result"},{no:15,name:"stream_results",kind:"message",T:yi,repeated:!0},{no:16,name:"file_results",kind:"message",T:Us,repeated:!0},{no:17,name:"segment_results",kind:"message",T:Bs,repeated:!0},{no:20,name:"image_results",kind:"message",T:jc,repeated:!0}]),Wc=p.makeMessageType("livekit.StreamInfoList",()=>[{no:1,name:"info",kind:"message",T:yi,repeated:!0}]),yi=p.makeMessageType("livekit.StreamInfo",()=>[{no:1,name:"url",kind:"scalar",T:9},{no:2,name:"started_at",kind:"scalar",T:3},{no:3,name:"ended_at",kind:"scalar",T:3},{no:4,name:"duration",kind:"scalar",T:3},{no:5,name:"status",kind:"enum",T:p.getEnumType(Jc)},{no:6,name:"error",kind:"scalar",T:9}]),Jc=p.makeEnum("livekit.StreamInfo.Status",[{no:0,name:"ACTIVE"},{no:1,name:"FINISHED"},{no:2,name:"FAILED"}]),Us=p.makeMessageType("livekit.FileInfo",()=>[{no:1,name:"filename",kind:"scalar",T:9},{no:2,name:"started_at",kind:"scalar",T:3},{no:3,name:"ended_at",kind:"scalar",T:3},{no:6,name:"duration",kind:"scalar",T:3},{no:4,name:"size",kind:"scalar",T:3},{no:5,name:"location",kind:"scalar",T:9}]),Bs=p.makeMessageType("livekit.SegmentsInfo",()=>[{no:1,name:"playlist_name",kind:"scalar",T:9},{no:8,name:"live_playlist_name",kind:"scalar",T:9},{no:2,name:"duration",kind:"scalar",T:3},{no:3,name:"size",kind:"scalar",T:3},{no:4,name:"playlist_location",kind:"scalar",T:9},{no:9,name:"live_playlist_location",kind:"scalar",T:9},{no:5,name:"segment_count",kind:"scalar",T:3},{no:6,name:"started_at",kind:"scalar",T:3},{no:7,name:"ended_at",kind:"scalar",T:3}]),jc=p.makeMessageType("livekit.ImagesInfo",()=>[{no:4,name:"filename_prefix",kind:"scalar",T:9},{no:1,name:"image_count",kind:"scalar",T:3},{no:2,name:"started_at",kind:"scalar",T:3},{no:3,name:"ended_at",kind:"scalar",T:3}]),Gc=p.makeMessageType("livekit.AutoParticipantEgress",()=>[{no:1,name:"preset",kind:"enum",T:p.getEnumType(ut),oneof:"options"},{no:2,name:"advanced",kind:"message",T:mt,oneof:"options"},{no:3,name:"file_outputs",kind:"message",T:ye,repeated:!0},{no:4,name:"segment_outputs",kind:"message",T:Te,repeated:!0}]),zc=p.makeMessageType("livekit.AutoTrackEgress",()=>[{no:1,name:"filepath",kind:"scalar",T:9},{no:5,name:"disable_manifest",kind:"scalar",T:8},{no:2,name:"s3",kind:"message",T:lt,oneof:"output"},{no:3,name:"gcp",kind:"message",T:dt,oneof:"output"},{no:4,name:"azure",kind:"message",T:ft,oneof:"output"},{no:6,name:"aliOSS",kind:"message",T:ht,oneof:"output"}]),Yc=p.makeMessageType("livekit.RoomAgentDispatch",()=>[{no:1,name:"agent_name",kind:"scalar",T:9},{no:2,name:"metadata",kind:"scalar",T:9}]),Xc=p.makeMessageType("livekit.CreateRoomRequest",()=>[{no:1,name:"name",kind:"scalar",T:9},{no:12,name:"config_name",kind:"scalar",T:9},{no:2,name:"empty_timeout",kind:"scalar",T:13},{no:10,name:"departure_timeout",kind:"scalar",T:13},{no:3,name:"max_participants",kind:"scalar",T:13},{no:4,name:"node_id",kind:"scalar",T:9},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"egress",kind:"message",T:Qc},{no:11,name:"agent",kind:"message",T:Zc},{no:7,name:"min_playout_delay",kind:"scalar",T:13},{no:8,name:"max_playout_delay",kind:"scalar",T:13},{no:9,name:"sync_streams",kind:"scalar",T:8},{no:13,name:"replay_enabled",kind:"scalar",T:8}]),Qc=p.makeMessageType("livekit.RoomEgress",()=>[{no:1,name:"room",kind:"message",T:Gn},{no:3,name:"participant",kind:"message",T:Gc},{no:2,name:"tracks",kind:"message",T:zc}]),Zc=p.makeMessageType("livekit.RoomAgent",()=>[{no:1,name:"dispatches",kind:"message",T:Yc,repeated:!0}]),eu=p.makeMessageType("livekit.ListRoomsRequest",()=>[{no:1,name:"names",kind:"scalar",T:9,repeated:!0}]),tu=p.makeMessageType("livekit.ListRoomsResponse",()=>[{no:1,name:"rooms",kind:"message",T:bn,repeated:!0}]),nu=p.makeMessageType("livekit.DeleteRoomRequest",()=>[{no:1,name:"room",kind:"scalar",T:9}]),su=p.makeMessageType("livekit.ListParticipantsRequest",()=>[{no:1,name:"room",kind:"scalar",T:9}]),ru=p.makeMessageType("livekit.ListParticipantsResponse",()=>[{no:1,name:"participants",kind:"message",T:kn,repeated:!0}]),Hs=p.makeMessageType("livekit.RoomParticipantIdentity",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9}]),iu=p.makeMessageType("livekit.MuteRoomTrackRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"track_sid",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8}]),au=p.makeMessageType("livekit.MuteRoomTrackResponse",()=>[{no:1,name:"track",kind:"message",T:ui}]),ou=p.makeMessageType("livekit.UpdateParticipantRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"permission",kind:"message",T:jn},{no:5,name:"name",kind:"scalar",T:9},{no:6,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}]),cu=p.makeMessageType("livekit.UpdateSubscriptionsRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"subscribe",kind:"scalar",T:8},{no:5,name:"participant_tracks",kind:"message",T:Pc,repeated:!0}]),uu=p.makeMessageType("livekit.SendDataRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"data",kind:"scalar",T:12},{no:3,name:"kind",kind:"enum",T:p.getEnumType(Dc)},{no:4,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:5,name:"topic",kind:"scalar",T:9,opt:!0}]),lu=p.makeMessageType("livekit.UpdateRoomMetadataRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"metadata",kind:"scalar",T:9}]);function du(t){switch(t){case Be.CAMERA:return"camera";case Be.MICROPHONE:return"microphone";case Be.SCREEN_SHARE:return"screen_share";case Be.SCREEN_SHARE_AUDIO:return"screen_share_audio";default:throw new TypeError(`Cannot convert TrackSource ${t} to string`)}}function fu(t){var e;const n=Object.assign({},t);return Array.isArray((e=n.video)===null||e===void 0?void 0:e.canPublishSources)&&(n.video.canPublishSources=n.video.canPublishSources.map(du)),n}const hu="6h";class Kt{constructor(e,n,s){if(e||(e={}.LIVEKIT_API_KEY),n||(n={}.LIVEKIT_API_SECRET),!e||!n)throw Error("api-key and api-secret must be set");typeof document<"u"&&console.error(`You should not include your API secret in your web client bundle.

Your web client should request a token from your backend server which should then use the API secret to generate a token. See https://docs.livekit.io/client/connect/`),this.apiKey=e,this.apiSecret=n,this.grants={},this.identity=s==null?void 0:s.identity,this.ttl=(s==null?void 0:s.ttl)||hu,typeof this.ttl=="number"&&(this.ttl=`${this.ttl}s`),s!=null&&s.metadata&&(this.metadata=s.metadata),s!=null&&s.name&&(this.name=s.name)}addGrant(e){var n;this.grants.video=Object.assign(Object.assign({},(n=this.grants.video)!==null&&n!==void 0?n:{}),e)}set metadata(e){this.grants.metadata=e}set name(e){this.grants.name=e}get sha256(){return this.grants.sha256}set sha256(e){this.grants.sha256=e}async toJwt(){var e;const n=new TextEncoder().encode(this.apiSecret),s=new Oo(fu(this.grants)).setProtectedHeader({alg:"HS256"}).setIssuer(this.apiKey).setExpirationTime(this.ttl).setNotBefore(0);if(this.identity)s.setSubject(this.identity);else if(!((e=this.grants.video)===null||e===void 0)&&e.roomJoin)throw Error("identity is required for join but not set");return s.sign(n)}}class Ti{constructor(e,n,s){this.apiKey=e,this.secret=n,this.ttl=s||"10m"}async authHeader(e){const n=new Kt(this.apiKey,this.secret,{ttl:this.ttl});return n.addGrant(e),{Authorization:`Bearer ${await n.toJwt()}`}}}var zn={exports:{}};const Ei=t=>typeof t=="object"&&t!==null,Si=Symbol("skip"),qs=t=>Ei(t)&&!(t instanceof RegExp)&&!(t instanceof Error)&&!(t instanceof Date),Rn=(t,e,n,s=new WeakMap)=>{if(n={deep:!1,target:{},...n},s.has(t))return s.get(t);s.set(t,n.target);const{target:r}=n;delete n.target;const i=a=>a.map(o=>qs(o)?Rn(o,e,n,s):o);if(Array.isArray(t))return i(t);for(const[a,o]of Object.entries(t)){const u=e(a,o,t);if(u===Si)continue;let[l,c,{shouldRecurse:d=!0}={}]=u;l!=="__proto__"&&(n.deep&&d&&qs(c)&&(c=Array.isArray(c)?i(c):Rn(c,e,n,s)),r[l]=c)}return r};zn.exports=(t,e,n)=>{if(!Ei(t))throw new TypeError(`Expected an object, got \`${t}\` (${typeof t})`);return Rn(t,e,n)};zn.exports.mapObjectSkip=Si;var mu=zn.exports,Yn={exports:{}};const pu=/[\p{Lu}]/u,gu=/[\p{Ll}]/u,Ks=/^[\p{Lu}](?![\p{Lu}])/gu,wi=/([\p{Alpha}\p{N}_]|$)/u,bi=/[_.\- ]+/,_u=new RegExp("^"+bi.source),$s=new RegExp(bi.source+wi.source,"gu"),Vs=new RegExp("\\d+"+wi.source,"gu"),yu=(t,e,n)=>{let s=!1,r=!1,i=!1;for(let a=0;a<t.length;a++){const o=t[a];s&&pu.test(o)?(t=t.slice(0,a)+"-"+t.slice(a),s=!1,i=r,r=!0,a++):r&&i&&gu.test(o)?(t=t.slice(0,a-1)+"-"+t.slice(a-1),i=r,r=!1,s=!0):(s=e(o)===o&&n(o)!==o,i=r,r=n(o)===o&&e(o)!==o)}return t},Tu=(t,e)=>(Ks.lastIndex=0,t.replace(Ks,n=>e(n))),Eu=(t,e)=>($s.lastIndex=0,Vs.lastIndex=0,t.replace($s,(n,s)=>e(s)).replace(Vs,n=>e(n))),ki=(t,e)=>{if(!(typeof t=="string"||Array.isArray(t)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(t)?t=t.map(i=>i.trim()).filter(i=>i.length).join("-"):t=t.trim(),t.length===0)return"";const n=e.locale===!1?i=>i.toLowerCase():i=>i.toLocaleLowerCase(e.locale),s=e.locale===!1?i=>i.toUpperCase():i=>i.toLocaleUpperCase(e.locale);return t.length===1?e.pascalCase?s(t):n(t):(t!==n(t)&&(t=yu(t,n,s)),t=t.replace(_u,""),e.preserveConsecutiveUppercase?t=Tu(t,n):t=n(t),e.pascalCase&&(t=s(t.charAt(0))+t.slice(1)),Eu(t,s))};Yn.exports=ki;Yn.exports.default=ki;var Su=Yn.exports;class wu{constructor(e={}){if(!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");this.maxSize=e.maxSize,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_set(e,n){if(this.cache.set(e,n),this._size++,this._size>=this.maxSize){if(this._size=0,typeof this.onEviction=="function")for(const[s,r]of this.oldCache.entries())this.onEviction(s,r);this.oldCache=this.cache,this.cache=new Map}}get(e){if(this.cache.has(e))return this.cache.get(e);if(this.oldCache.has(e)){const n=this.oldCache.get(e);return this.oldCache.delete(e),this._set(e,n),n}}set(e,n){return this.cache.has(e)?this.cache.set(e,n):this._set(e,n),this}has(e){return this.cache.has(e)||this.oldCache.has(e)}peek(e){if(this.cache.has(e))return this.cache.get(e);if(this.oldCache.has(e))return this.oldCache.get(e)}delete(e){const n=this.cache.delete(e);return n&&this._size--,this.oldCache.delete(e)||n}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache)yield e;for(const e of this.oldCache){const[n]=e;this.cache.has(n)||(yield e)}}get size(){let e=0;for(const n of this.oldCache.keys())this.cache.has(n)||e++;return Math.min(this._size+e,this.maxSize)}}var bu=wu;const Ws=mu,ku=Su,Ru=bu,Cu=(t,e)=>t.some(n=>typeof n=="string"?n===e:(n.lastIndex=0,n.test(e))),un=new Ru({maxSize:1e5}),Js=t=>typeof t=="object"&&t!==null&&!(t instanceof RegExp)&&!(t instanceof Error)&&!(t instanceof Date),js=(t,e)=>{if(!Js(t))return t;e={deep:!1,pascalCase:!1,...e};const{exclude:n,pascalCase:s,stopPaths:r,deep:i}=e,a=new Set(r),o=u=>(l,c)=>{if(i&&Js(c)){const d=u===void 0?l:`${u}.${l}`;a.has(d)||(c=Ws(c,o(d)))}if(!(n&&Cu(n,l))){const d=s?`${l}_`:l;if(un.has(d))l=un.get(d);else{const h=ku(l,{pascalCase:s,locale:!1});l.length<100&&un.set(d,h),l=h}}return[l,c]};return Ws(t,o(void 0))};var Au=(t,e)=>Array.isArray(t)?Object.keys(t).map(n=>js(t[n],e)):js(t,e);const Nu=qn(Au),Iu="/twirp",Ri="livekit";class Ci{constructor(e,n,s){e.startsWith("ws")&&(e=e.replace("ws","http")),this.host=e,this.pkg=n,this.prefix=s||Iu}async request(e,n,s,r){const i=`${this.prefix}/${this.pkg}.${e}/${n}`,a=new URL(i,this.host),o=await fetch(a,{method:"POST",headers:Object.assign({"Content-Type":"application/json;charset=UTF-8"},r),body:JSON.stringify(s)});if(!o.ok)throw new Error(`Request failed with status ${o.status}: ${o.statusText}`);const u=await o.json();return Nu(u,{deep:!0})}}const se="Egress";class Ou extends Ti{constructor(e,n,s){super(n,s),this.rpc=new Ci(e,Ri)}async startRoomCompositeEgress(e,n,s,r,i,a,o){let u;if(s!==void 0)if(typeof s=="string")u=s;else{const w=s;u=w.layout,r=w.encodingOptions,i=w.audioOnly,a=w.videoOnly,o=w.customBaseUrl}u??(u=""),i??(i=!1),a??(a=!1),o??(o="");const{output:l,options:c,fileOutputs:d,streamOutputs:h,segmentOutputs:E,imageOutputs:g}=this.getOutputParams(n,r),y=new Gn({roomName:e,layout:u,audioOnly:i,videoOnly:a,customBaseUrl:o,output:l,options:c,fileOutputs:d,streamOutputs:h,segmentOutputs:E,imageOutputs:g}).toJson(),_=await this.rpc.request(se,"StartRoomCompositeEgress",y,await this.authHeader({roomRecord:!0}));return ie.fromJson(_,{ignoreUnknownFields:!0})}async startWebEgress(e,n,s){const r=(s==null?void 0:s.audioOnly)||!1,i=(s==null?void 0:s.videoOnly)||!1,a=(s==null?void 0:s.awaitStartSignal)||!1,{output:o,options:u,fileOutputs:l,streamOutputs:c,segmentOutputs:d,imageOutputs:h}=this.getOutputParams(n,s==null?void 0:s.encodingOptions),E=new hi({url:e,audioOnly:r,videoOnly:i,awaitStartSignal:a,output:o,options:u,fileOutputs:l,streamOutputs:c,segmentOutputs:d,imageOutputs:h}).toJson(),g=await this.rpc.request(se,"StartWebEgress",E,await this.authHeader({roomRecord:!0}));return ie.fromJson(g,{ignoreUnknownFields:!0})}async startParticipantEgress(e,n,s,r){const{options:i,fileOutputs:a,streamOutputs:o,segmentOutputs:u,imageOutputs:l}=this.getOutputParams(s,r==null?void 0:r.encodingOptions),c=new mi({roomName:e,identity:n,options:i,fileOutputs:a,streamOutputs:o,segmentOutputs:u,imageOutputs:l}).toJson(),d=await this.rpc.request(se,"StartParticipantEgress",c,this.authHeader({roomRecord:!0}));return ie.fromJson(d,{ignoreUnknownFields:!0})}async startTrackCompositeEgress(e,n,s,r,i){let a;if(s!==void 0)if(typeof s=="string")a=s;else{const y=s;a=y.audioTrackId,r=y.videoTrackId,i=y.encodingOptions}a??(a=""),r??(r="");const{output:o,options:u,fileOutputs:l,streamOutputs:c,segmentOutputs:d,imageOutputs:h}=this.getOutputParams(n,i),E=new pi({roomName:e,audioTrackId:a,videoTrackId:r,output:o,options:u,fileOutputs:l,streamOutputs:c,segmentOutputs:d,imageOutputs:h}).toJson(),g=await this.rpc.request(se,"StartTrackCompositeEgress",E,await this.authHeader({roomRecord:!0}));return ie.fromJson(g,{ignoreUnknownFields:!0})}isEncodedOutputs(e){return e.file!==void 0||e.stream!==void 0||e.segments!==void 0}isEncodedFileOutput(e){return e.filepath!==void 0||e.fileType!==void 0}isSegmentedFileOutput(e){return e.filenamePrefix!==void 0||e.playlistName!==void 0||e.filenameSuffix!==void 0}isStreamOutput(e){return e.protocol!==void 0||e.urls!==void 0}getOutputParams(e,n){let s,r,i,a,o,u,l;this.isEncodedOutputs(e)?(e.file!==void 0&&(r=[e.file]),e.stream!==void 0&&(a=[e.stream]),e.segments!==void 0&&(u=[e.segments]),e.images!==void 0&&(l=[e.images])):this.isEncodedFileOutput(e)?(s=e,r=[s]):this.isSegmentedFileOutput(e)?(o=e,u=[o]):this.isStreamOutput(e)&&(i=e,a=[i]);let c;s?c={case:"file",value:s}:i?c={case:"stream",value:i}:o&&(c={case:"segments",value:o});let d;return n&&(typeof n=="number"?d={case:"preset",value:n}:d={case:"advanced",value:n}),{output:c,options:d,fileOutputs:r,streamOutputs:a,segmentOutputs:u,imageOutputs:l}}async startTrackEgress(e,n,s){let r;typeof n=="string"?r={case:"websocketUrl",value:n}:r={case:"file",value:n};const i=new gi({roomName:e,trackId:s,output:r}).toJson(),a=await this.rpc.request(se,"StartTrackEgress",i,await this.authHeader({roomRecord:!0}));return ie.fromJson(a,{ignoreUnknownFields:!0})}async updateLayout(e,n){const s=await this.rpc.request(se,"UpdateLayout",new Hc({egressId:e,layout:n}).toJson(),await this.authHeader({roomRecord:!0}));return ie.fromJson(s,{ignoreUnknownFields:!0})}async updateStream(e,n,s){n??(n=[]),s??(s=[]);const r=await this.rpc.request(se,"UpdateStream",new qc({egressId:e,addOutputUrls:n,removeOutputUrls:s}).toJson(),await this.authHeader({roomRecord:!0}));return ie.fromJson(r,{ignoreUnknownFields:!0})}async listEgress(e){var n;let s={};typeof e=="string"?s.roomName=e:e!==void 0&&(s=e);const r=await this.rpc.request(se,"ListEgress",new Kc(s).toJson(),await this.authHeader({roomRecord:!0}));return(n=$c.fromJson(r,{ignoreUnknownFields:!0}).items)!==null&&n!==void 0?n:[]}async stopEgress(e){const n=await this.rpc.request(se,"StopEgress",new Vc({egressId:e}).toJson(),await this.authHeader({roomRecord:!0}));return ie.fromJson(n,{ignoreUnknownFields:!0})}}const j="RoomService";class vu extends Ti{constructor(e,n,s){super(n,s),this.rpc=new Ci(e,Ri)}async createRoom(e){const n=await this.rpc.request(j,"CreateRoom",new Xc(e).toJson(),await this.authHeader({roomCreate:!0}));return bn.fromJson(n,{ignoreUnknownFields:!0})}async listRooms(e){var n;const s=await this.rpc.request(j,"ListRooms",new eu({names:e??[]}).toJson(),await this.authHeader({roomList:!0}));return(n=tu.fromJson(s,{ignoreUnknownFields:!0}).rooms)!==null&&n!==void 0?n:[]}async deleteRoom(e){await this.rpc.request(j,"DeleteRoom",new nu({room:e}).toJson(),await this.authHeader({roomCreate:!0}))}async updateRoomMetadata(e,n){const s=await this.rpc.request(j,"UpdateRoomMetadata",new lu({room:e,metadata:n}).toJson(),await this.authHeader({roomAdmin:!0,room:e}));return bn.fromJson(s,{ignoreUnknownFields:!0})}async listParticipants(e){var n;const s=await this.rpc.request(j,"ListParticipants",new su({room:e}).toJson(),await this.authHeader({roomAdmin:!0,room:e}));return(n=ru.fromJson(s,{ignoreUnknownFields:!0}).participants)!==null&&n!==void 0?n:[]}async getParticipant(e,n){const s=await this.rpc.request(j,"GetParticipant",new Hs({room:e,identity:n}).toJson(),await this.authHeader({roomAdmin:!0,room:e}));return kn.fromJson(s,{ignoreUnknownFields:!0})}async removeParticipant(e,n){await this.rpc.request(j,"RemoveParticipant",new Hs({room:e,identity:n}).toJson(),await this.authHeader({roomAdmin:!0,room:e}))}async mutePublishedTrack(e,n,s,r){const i=new iu({room:e,identity:n,trackSid:s,muted:r}).toJson(),a=await this.rpc.request(j,"MutePublishedTrack",i,await this.authHeader({roomAdmin:!0,room:e}));return au.fromJson(a,{ignoreUnknownFields:!0}).track}async updateParticipant(e,n,s,r,i){const a=new ou({room:e,identity:n,metadata:s||"",name:i||""});r&&(a.permission=new jn(r));const o=await this.rpc.request(j,"UpdateParticipant",a.toJson(),await this.authHeader({roomAdmin:!0,room:e}));return kn.fromJson(o,{ignoreUnknownFields:!0})}async updateSubscriptions(e,n,s,r){const i=new cu({room:e,identity:n,trackSids:s,subscribe:r,participantTracks:[]}).toJson();await this.rpc.request(j,"UpdateSubscriptions",i,await this.authHeader({roomAdmin:!0,room:e}))}async sendData(e,n,s,r={}){const i=Array.isArray(r)?r:r.destinationSids,a=Array.isArray(r)?void 0:r.topic,o=new uu({room:e,data:n,kind:s,destinationSids:i??[],topic:a});!Array.isArray(r)&&r.destinationIdentities&&(o.destinationIdentities=r.destinationIdentities),await this.rpc.request(j,"SendData",o.toJson(),await this.authHeader({roomAdmin:!0,room:e}))}}const Du=16,Pu=12;function Lu(t){let e=new TextEncoder;return window.crypto.subtle.importKey("raw",e.encode(t),{name:"PBKDF2"},!1,["deriveBits","deriveKey"])}function Mu(t,e){return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:e,iterations:1e5,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async function xu(t,e){const n=window.crypto.getRandomValues(new Uint8Array(Du)),s=window.crypto.getRandomValues(new Uint8Array(Pu));let r=Pr(t),i=await Lu(e),a=await Mu(i,n);const o=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:s},a,r);return{salt:ln(new Uint8Array(n)),iv:ln(new Uint8Array(s)),encryptedText:ln(new Uint8Array(o))}}const re=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];function ln(t){let e="",n,s=t.length;for(n=2;n<s;n+=3)e+=re[t[n-2]>>2],e+=re[(t[n-2]&3)<<4|t[n-1]>>4],e+=re[(t[n-1]&15)<<2|t[n]>>6],e+=re[t[n]&63];return n===s+1&&(e+=re[t[n-2]>>2],e+=re[(t[n-2]&3)<<4],e+="=="),n===s&&(e+=re[t[n-2]>>2],e+=re[(t[n-2]&3)<<4|t[n-1]>>4],e+=re[(t[n-1]&15)<<2],e+="="),e}async function Fu(t,e,n){const s=new Kt(t,e,{identity:n,ttl:86400});return s.addGrant({room:n,roomJoin:!0,roomCreate:!0,roomAdmin:!0,roomList:!0,canPublish:!0,canSubscribe:!1,canPublishData:!0,canUpdateOwnMetadata:!0}),await s.toJwt()}async function Uu(t,e){const{encryptedText:n,iv:s,salt:r}=await xu(t,e);return r+"|"+s+"|"+n}async function Bu(t,e,n,s,r=null){const i=new Kt(t,e,{identity:s,name:s,ttl:21600});i.addGrant({room:n,roomList:!0,roomJoin:!0,canPublish:!1,canSubscribe:!0,canPublishData:!0,canUpdateOwnMetadata:!1});const a=await i.toJwt();return r&&r.length>0?(G("AuthToken before encryption for "+s,a),s+"|"+await Uu(Ma+a,r)):s+"|"+a}async function Hu(t,e){const n=new Kt(t,e,{identity:"lt",ttl:94608e5});return n.addGrant({roomList:!0,roomJoin:!1,canPublish:!1,canSubscribe:!1,canPublishData:!1,canUpdateOwnMetadata:!1}),await n.toJwt()}let Gs=1e3,zs=0;async function Ai(){const t=Date.now()-zs;for(;t<Gs;)await ct(Gs-t);zs=Date.now()}function qu(t,e,n){return new vu(t,e,n)}async function Ku(t,e,n=""){return await Ai(),await t.createRoom({name:e,maxParticipants:12,emptyTimeout:30,metadata:n})}async function $u(t,e,n){return await Ai(),await t.updateRoomMetadata(e,n)}async function Vu(t,e,n,s,r=null){const a=[];for(let o=0;o<10;o++){let u=ws(Ts());for(;s.includes(u);)u=ws(Ts());s.push(u);const l=await Bu(t,e,n,u,r);a.push(l)}return a}async function Wu(t,e,n,s,r,i=null){const a=JSON.stringify({accessTokens:await Vu(e,n,s,r,i)});await $u(t,s,a)}const M=R;class Ju{constructor(){T(this,"config");T(this,"lastMsgRecivedTimestamp");T(this,"connectionState");T(this,"latestRecivedDataMessage");T(this,"participantConnectionEvents");T(this,"_rovRoomName");T(this,"_accessToken");T(this,"_reconnectAttemptCount",0);T(this,"_shouldReconnect");T(this,"_roomConn");this.config={},this._shouldReconnect=!0,this.connectionState=me(N.init),this.latestRecivedDataMessage=me(null),this.participantConnectionEvents=me(null)}async init(e){this.config=e,this._shouldReconnect=!0,this._roomConn=new xa(e.roomConfig),this._roomConn.on(O.DCBufferStatusChanged,n=>{M("LK: DCBufferStatusChanged ",n)}).on(O.SignalConnected,async()=>{M(`LK: Signal connection established to ${this.config.hostUrl}`)}).on(O.Connected,async()=>{M(`LK: Connected to room: ${this._roomConn.name} via ${this.config.hostUrl}`),this.connectionState.set(N.connected)}).on(O.Disconnected,n=>{this.connectionState.set(N.disconnectedOk);let s=this._shouldReconnect&&!!this._roomConn;n===ue.DUPLICATE_IDENTITY?(K("LK: disconnected from room - duplicate identity"),s=!1):n===ue.CLIENT_INITIATED?(R("LK: disconnected from room - client initiated"),s=!1):n===ue.SERVER_SHUTDOWN?(R("LK: disconnected from room - server shutdown"),s=!1):n===ue.PARTICIPANT_REMOVED?(R("LK: disconnected from room - participant removed"),s=!1):n===ue.ROOM_DELETED?(R("LK: disconnected from room - room deleted"),s=!1):n===ue.STATE_MISMATCH?(R("LK: disconnected from room - state mismatch"),s=!1):n===ue.JOIN_FAILURE?R("LK: disconnected from room - join failure"):n===ue.UNKNOWN_REASON&&R("LK: disconnected from room - unknown reason"),s?this._reconnect():this.close()}).on(O.Reconnecting,()=>{M(`LK: Reconnecting to room ${this._roomConn.name} via ${this.config.hostUrl}`),this.connectionState.set(N.reconnecting)}).on(O.Reconnected,async()=>{M("LK: Successfully reconnected. server",await this._roomConn.engine.getConnectedServerAddress()),this.connectionState.set(N.connected)}).on(O.ParticipantMetadataChanged,n=>{M("LK: Participant Metadata Changed",n)}).on(O.ParticipantConnected,async n=>{M(`LK: Participant ${n.identity} (${n.sid}) connected`,n.metadata),this.participantConnectionEvents.set({id:n.identity,joined:!0}),n.on(Fa.ConnectionQualityChanged,()=>{M("LK: ParticipantEvent.ConnectionQualityChanged",n.connectionQuality)})}).on(O.ParticipantDisconnected,n=>{M(`LK: Participant ${n.identity} (${n.sid}) disconnected`),this.participantConnectionEvents.set({id:n.identity,joined:!1})}).on(O.MediaDevicesError,n=>{const s=gs.getFailure(n);M("LK: Media device failure",s)}).on(O.ConnectionQualityChanged,(n,s)=>{M(`LK: connection quality for ${s?s.identity:"[no identity]"} changed to ${n}`)}).on(O.RoomMetadataChanged,n=>{try{M("LK: New metadata for room",JSON.parse(n))}catch{M("LK: New metadata for room (NOT VALID JSON)",n)}}).on(O.MediaDevicesChanged,()=>{M("LK: MediaDevicesChanged")}).on(O.LocalTrackUnpublished,(n,s)=>{M("LK: LocalTrackUnpublished",n.trackSid,"by participant",s.identity,"source",n.track?n.track.source:"[no track found]")}).on(O.LocalTrackPublished,(n,s)=>{M("LK: LocalVideoTrackPublished",n.trackSid,"by participant",s.identity,"source",n.track?n.track.source:"[no track found]")}).on(O.MediaDevicesError,n=>{const s=gs.getFailure(n);M("LK: media device failure",s)}).on(O.AudioPlaybackStatusChanged,()=>{M("LK: AudioPlaybackStatusChanged. canPlaybackAudio =",this._roomConn.canPlaybackAudio)})}async start(e,n){this._rovRoomName=e,this._accessToken=n,this._shouldReconnect=!0;const s=Date.now();R(`LK: Starting conn with ${e} via ${this.config.hostUrl} token = ${n}`);try{const r=setTimeout(()=>{R(`livekit connect timeout for ${this.config.hostUrl}. Reconnecting...`),this._reconnect()},16e3);await this._connect(),clearTimeout(r),R(`LK: Connected in ${Date.now()-s}ms ${this.config.hostUrl}`)}catch(r){R(`LK: Error connecting to ${this.config.hostUrl}. Reconnecting...`,r),this._reconnect()}}async sendMessage(e,n=!0,s=[]){if(!this._roomConn||this._roomConn.state!==Ua.Connected||this.connectionState.get()!=N.connected)return K("LK: Can't send message, room not connected");s.length==0&&(s=[...this._roomConn.remoteParticipants.values()].map(i=>i.identity)),s.map(i=>{const a=this.getParticipantSid(i);return a||K("LK: SendMessge: No participant found for livekit identity: ",i),a||null}).filter(i=>i!=null).length!=0&&await this._roomConn.localParticipant.publishData(e,{reliable:n,destinationIdentities:s})}getParticipantSid(e){const n=[...this._roomConn.remoteParticipants.values()].find(s=>s.identity===e);return n?n.sid:null}getLivekitIdentitiy(){return this._roomConn?this._roomConn.localParticipant.identity:null}getRoomName(){return this._roomConn?this._roomConn.name:this._rovRoomName}async close(){this._shouldReconnect=!1,this._roomConn&&(J("LK: Closing Livekit Connection: ",this._rovRoomName,this.config.hostUrl),await this._roomConn.disconnect(!0))}async _connect(){await this._roomConn.connect(Lr(this.config.hostUrl),this._accessToken,this.config.roomConnectionConfig),J("LK: Connected to room",this._roomConn.name,this._roomConn)}async _reconnect(){try{await this._roomConn.disconnect(!0)}catch(e){B("LK: Error disconnecting from room",e)}if(this._shouldReconnect!=!1)if(this._reconnectAttemptCount<this.config.reconnectAttempts){const e=this._reconnectAttemptCount*800;this._reconnectAttemptCount++,await ct(e);try{await this._connect()}catch(n){throw B("LK: Error reconnecting to room",n),n}}else B("LK: Failed to reconnect after ",this._reconnectAttemptCount,"/",this.config.reconnectAttempts,"attempts"),this._fail()}_fail(){this._shouldReconnect=!1,this.connectionState.set(N.failed)}}class ju extends Ju{constructor(){super();T(this,"_livekitApiKey");T(this,"_livekitSecretKey");T(this,"_livekitAdmin");T(this,"camTrack")}async init(n){await super.init(n),this._roomConn.on(O.SignalConnected,async()=>{var s;(s=this.camTrack.videoTrack)==null||s.getSenderStats()}).on(O.DataReceived,async(s,r)=>{if(!r)return K("LK: Ignoring received data message with no participant. This can happen when the message is sent before connection completes or if the message comes from the server: ",s);const i=r.identity;r.sid,this.lastMsgRecivedTimestamp=Date.now(),this.latestRecivedDataMessage.set({senderId:i,msg:s})}).on(O.TrackSubscribed,(s,r,i)=>{K("LK: Subscribed to track ",r.trackSid," from participant: ",i.identity," source: ",s.source," _THIS SHOULDNT HAPPEN on BACKEND_ ")}).on(O.TrackUnsubscribed,(s,r,i)=>{K("LK: Unsubscribed from track",r.trackSid," from participant: ",i.identity," _THIS SHOULDNT HAPPEN on BACKEND_ ")}).on(O.ParticipantConnected,()=>{this.updateMetadataTokens()})}async updateMetadataTokens(){if(!this._livekitAdmin)return K("LK: Can't update metadata tokens, livekit admin client not initialized");const n=[...this._roomConn.remoteParticipants.values()].map(s=>s.identity);await Wu(this._livekitAdmin,this._livekitApiKey,this._livekitSecretKey,this._rovRoomName,n,this.config.tokenEncryptionPassword)}async startRoom(n,s,r){this._rovRoomName=n,this._livekitApiKey=s,this._livekitSecretKey=r,this._livekitAdmin=qu(this.config.hostUrl,s,r),await Ku(this._livekitAdmin,n);const i=await Fu(s,r,n);await super.start(n,i);let a=!1;const o=this.connectionState.subscribe(async u=>{if(u==N.connected&&!a){for(a=!0;;){try{await this.updateMetadataTokens();break}catch(l){B("LK: Error updating metadata tokens",l)}await ct(2e3)}o()}})}}Q.MAV_STATE_UNINIT+"",Q.MAV_STATE_BOOT+"",Q.MAV_STATE_CALIBRATING+"",Q.MAV_STATE_STANDBY+"",Q.MAV_STATE_ACTIVE+"",Q.MAV_STATE_CRITICAL+"",Q.MAV_STATE_EMERGENCY+"",Q.MAV_STATE_POWEROFF+"",Q.MAV_STATE_FLIGHT_TERMINATION+"";const Je=(t,e=0)=>({header:{system_id:255,component_id:240,sequence:e},message:t}),Ys=t=>Je({type:"COMMAND_LONG",command:{type:"MAV_CMD_COMPONENT_ARM_DISARM"},target_system:1,target_component:1,confirmation:0,param1:1,param2:0,param3:0,param4:0,param5:0,param6:0,param7:0}),Gu=t=>Je({type:"COMMAND_LONG",command:{type:"MAV_CMD_COMPONENT_ARM_DISARM"},target_system:1,target_component:1,confirmation:1,param1:0,param2:0,param3:0,param4:0,param5:0,param6:0,param7:0}),zu=(t=1,e=333333.34375)=>Je({type:"COMMAND_LONG",command:{type:"MAV_CMD_SET_MESSAGE_INTERVAL"},target_system:1,target_component:1,confirmation:1,param1:t,param2:e,param3:0,param4:0,param5:0,param6:0,param7:0}),Yu=t=>(t=t||19,Je({type:"COMMAND_LONG",command:{type:"MAV_CMD_DO_SET_MODE"},param1:1,param2:Number(t),param3:0,param4:0,param5:0,param6:0,param7:0,target_system:1,target_component:1,confirmation:1})),Xu=()=>Je({type:Ba.HEARTBEAT,custom_mode:0,mavtype:{type:Ha.MAV_TYPE_GCS},autopilot:{type:qa.MAV_AUTOPILOT_INVALID},base_mode:{bits:_s.MAV_MODE_FLAG_SAFETY_ARMED|_s.MAV_MODE_FLAG_MANUAL_INPUT_ENABLED},system_status:{type:Q.MAV_STATE_ACTIVE},mavlink_version:1,confirmation:0}),Qu=(t,e,n,s,r)=>Je({type:"MANUAL_CONTROL",x:Math.floor(t),y:Math.floor(e),z:Math.floor(n),r:Math.floor(s),buttons:r,target:1});class Ni{constructor(){T(this,"socket");T(this,"serverAddress");T(this,"msgReceivedFn");T(this,"onConnectedFn");T(this,"isRunning");T(this,"isConnected");T(this,"connectionTimerId");this.isConnected=!1,this.isRunning=!1,this.connectionTimerId=0,this.serverAddress=""}start(e,n){this.serverAddress=e,this.msgReceivedFn=n,this.isRunning=!0,this.connect()}stop(){this.isRunning=!1,this.socket&&this.socket.close()}connect(){R("Attempting to connect to websocket: "+this.serverAddress),this.socket=new WebSocket(this.serverAddress),this.socket.binaryType="arraybuffer";const e=setTimeout(()=>{B("WebSocket connection timed out after 10 seconds"),this.stop(),this.queueConnect()},1e4);this.socket.addEventListener("open",n=>{this.isConnected=!0,clearTimeout(e),this.onConnectedFn&&this.onConnectedFn()}),this.socket.addEventListener("close",n=>{R("WebSocket connection closed with code: ",n.code),this.isConnected=!1,this.isRunning&&this.queueConnect()}),this.socket.addEventListener("error",n=>{B("WebSocket error:",n),this.isConnected=!1,this.isRunning&&this.queueConnect()}),this.socket.addEventListener("message",n=>{if(!this.msgReceivedFn)return B("No msgReceivedFn defined for WebSocketRelay");if(typeof n.data=="string")this.msgReceivedFn(n.data);else if(n.data instanceof ArrayBuffer)this.msgReceivedFn(new Uint8Array(n.data));else throw n.data instanceof Blob?new Error("WebSocketRelay received Blob type, which is not supported!"):new Error("WebSocketRelay received unknown type")})}queueConnect(){clearTimeout(this.connectionTimerId),this.connectionTimerId=setTimeout(this.connect.bind(this),2e3)}getIsConnected(){return this.isConnected}sendMessage(e){if(this.socket){if(this.socket.readyState!=this.socket.OPEN){G("Can't send WebSocket msg: "+this.socket.readyState);return}this.socket.send(e)}}}const Cn=new Ni;class Zu{constructor(){T(this,"mavlinkWebsocket");T(this,"onMessage");this.mavlinkWebsocket=new Ni}start(e,n,s){this.onMessage=n,s&&(this.mavlinkWebsocket.onConnectedFn=s),this.mavlinkWebsocket.start(e,r=>{this.handleMessage(r)})}handleMessage(e){if(e.length===0)return;const n=e instanceof Uint8Array?Ka(e):e;try{if(n.startsWith("Ok"))return;const s=JSON.parse(n);this.onMessage(s)}catch(s){B("Failed to parse recived mavlink2rest json: "+n,s)}}sendMessage(e){this.mavlinkWebsocket.sendMessage(JSON.stringify(e))}}const he=new Zu;function Ii(t,e){return function(){return t.apply(e,arguments)}}const{toString:el}=Object.prototype,{getPrototypeOf:Xn}=Object,$t=(t=>e=>{const n=el.call(e);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),X=t=>(t=t.toLowerCase(),e=>$t(e)===t),Vt=t=>e=>typeof e===t,{isArray:je}=Array,nt=Vt("undefined");function tl(t){return t!==null&&!nt(t)&&t.constructor!==null&&!nt(t.constructor)&&$(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const Oi=X("ArrayBuffer");function nl(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&Oi(t.buffer),e}const sl=Vt("string"),$=Vt("function"),vi=Vt("number"),Wt=t=>t!==null&&typeof t=="object",rl=t=>t===!0||t===!1,Ot=t=>{if($t(t)!=="object")return!1;const e=Xn(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},il=X("Date"),al=X("File"),ol=X("Blob"),cl=X("FileList"),ul=t=>Wt(t)&&$(t.pipe),ll=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||$(t.append)&&((e=$t(t))==="formdata"||e==="object"&&$(t.toString)&&t.toString()==="[object FormData]"))},dl=X("URLSearchParams"),[fl,hl,ml,pl]=["ReadableStream","Request","Response","Headers"].map(X),gl=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function pt(t,e,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let s,r;if(typeof t!="object"&&(t=[t]),je(t))for(s=0,r=t.length;s<r;s++)e.call(null,t[s],s,t);else{const i=n?Object.getOwnPropertyNames(t):Object.keys(t),a=i.length;let o;for(s=0;s<a;s++)o=i[s],e.call(null,t[o],o,t)}}function Di(t,e){e=e.toLowerCase();const n=Object.keys(t);let s=n.length,r;for(;s-- >0;)if(r=n[s],e===r.toLowerCase())return r;return null}const Re=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:ge.global)(),Pi=t=>!nt(t)&&t!==Re;function An(){const{caseless:t}=Pi(this)&&this||{},e={},n=(s,r)=>{const i=t&&Di(e,r)||r;Ot(e[i])&&Ot(s)?e[i]=An(e[i],s):Ot(s)?e[i]=An({},s):je(s)?e[i]=s.slice():e[i]=s};for(let s=0,r=arguments.length;s<r;s++)arguments[s]&&pt(arguments[s],n);return e}const _l=(t,e,n,{allOwnKeys:s}={})=>(pt(e,(r,i)=>{n&&$(r)?t[i]=Ii(r,n):t[i]=r},{allOwnKeys:s}),t),yl=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Tl=(t,e,n,s)=>{t.prototype=Object.create(e.prototype,s),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},El=(t,e,n,s)=>{let r,i,a;const o={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),i=r.length;i-- >0;)a=r[i],(!s||s(a,t,e))&&!o[a]&&(e[a]=t[a],o[a]=!0);t=n!==!1&&Xn(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},Sl=(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const s=t.indexOf(e,n);return s!==-1&&s===n},wl=t=>{if(!t)return null;if(je(t))return t;let e=t.length;if(!vi(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},bl=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&Xn(Uint8Array)),kl=(t,e)=>{const s=(t&&t[Symbol.iterator]).call(t);let r;for(;(r=s.next())&&!r.done;){const i=r.value;e.call(t,i[0],i[1])}},Rl=(t,e)=>{let n;const s=[];for(;(n=t.exec(e))!==null;)s.push(n);return s},Cl=X("HTMLFormElement"),Al=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,s,r){return s.toUpperCase()+r}),Xs=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),Nl=X("RegExp"),Li=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),s={};pt(n,(r,i)=>{let a;(a=e(r,i,t))!==!1&&(s[i]=a||r)}),Object.defineProperties(t,s)},Il=t=>{Li(t,(e,n)=>{if($(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const s=t[n];if($(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},Ol=(t,e)=>{const n={},s=r=>{r.forEach(i=>{n[i]=!0})};return je(t)?s(t):s(String(t).split(e)),n},vl=()=>{},Dl=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,dn="abcdefghijklmnopqrstuvwxyz",Qs="0123456789",Mi={DIGIT:Qs,ALPHA:dn,ALPHA_DIGIT:dn+dn.toUpperCase()+Qs},Pl=(t=16,e=Mi.ALPHA_DIGIT)=>{let n="";const{length:s}=e;for(;t--;)n+=e[Math.random()*s|0];return n};function Ll(t){return!!(t&&$(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const Ml=t=>{const e=new Array(10),n=(s,r)=>{if(Wt(s)){if(e.indexOf(s)>=0)return;if(!("toJSON"in s)){e[r]=s;const i=je(s)?[]:{};return pt(s,(a,o)=>{const u=n(a,r+1);!nt(u)&&(i[o]=u)}),e[r]=void 0,i}}return s};return n(t,0)},xl=X("AsyncFunction"),Fl=t=>t&&(Wt(t)||$(t))&&$(t.then)&&$(t.catch),xi=((t,e)=>t?setImmediate:e?((n,s)=>(Re.addEventListener("message",({source:r,data:i})=>{r===Re&&i===n&&s.length&&s.shift()()},!1),r=>{s.push(r),Re.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",$(Re.postMessage)),Ul=typeof queueMicrotask<"u"?queueMicrotask.bind(Re):typeof ge.process<"u"&&ge.process.nextTick||xi,f={isArray:je,isArrayBuffer:Oi,isBuffer:tl,isFormData:ll,isArrayBufferView:nl,isString:sl,isNumber:vi,isBoolean:rl,isObject:Wt,isPlainObject:Ot,isReadableStream:fl,isRequest:hl,isResponse:ml,isHeaders:pl,isUndefined:nt,isDate:il,isFile:al,isBlob:ol,isRegExp:Nl,isFunction:$,isStream:ul,isURLSearchParams:dl,isTypedArray:bl,isFileList:cl,forEach:pt,merge:An,extend:_l,trim:gl,stripBOM:yl,inherits:Tl,toFlatObject:El,kindOf:$t,kindOfTest:X,endsWith:Sl,toArray:wl,forEachEntry:kl,matchAll:Rl,isHTMLForm:Cl,hasOwnProperty:Xs,hasOwnProp:Xs,reduceDescriptors:Li,freezeMethods:Il,toObjectSet:Ol,toCamelCase:Al,noop:vl,toFiniteNumber:Dl,findKey:Di,global:Re,isContextDefined:Pi,ALPHABET:Mi,generateString:Pl,isSpecCompliantForm:Ll,toJSONObject:Ml,isAsyncFn:xl,isThenable:Fl,setImmediate:xi,asap:Ul};function S(t,e,n,s,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),s&&(this.request=s),r&&(this.response=r,this.status=r.status?r.status:null)}f.inherits(S,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:f.toJSONObject(this.config),code:this.code,status:this.status}}});const Fi=S.prototype,Ui={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{Ui[t]={value:t}});Object.defineProperties(S,Ui);Object.defineProperty(Fi,"isAxiosError",{value:!0});S.from=(t,e,n,s,r,i)=>{const a=Object.create(Fi);return f.toFlatObject(t,a,function(u){return u!==Error.prototype},o=>o!=="isAxiosError"),S.call(a,t.message,e,n,s,r),a.cause=t,a.name=t.name,i&&Object.assign(a,i),a};const Bl=null;function Nn(t){return f.isPlainObject(t)||f.isArray(t)}function Bi(t){return f.endsWith(t,"[]")?t.slice(0,-2):t}function Zs(t,e,n){return t?t.concat(e).map(function(r,i){return r=Bi(r),!n&&i?"["+r+"]":r}).join(n?".":""):e}function Hl(t){return f.isArray(t)&&!t.some(Nn)}const ql=f.toFlatObject(f,{},null,function(e){return/^is[A-Z]/.test(e)});function Jt(t,e,n){if(!f.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,n=f.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,_){return!f.isUndefined(_[y])});const s=n.metaTokens,r=n.visitor||c,i=n.dots,a=n.indexes,u=(n.Blob||typeof Blob<"u"&&Blob)&&f.isSpecCompliantForm(e);if(!f.isFunction(r))throw new TypeError("visitor must be a function");function l(g){if(g===null)return"";if(f.isDate(g))return g.toISOString();if(!u&&f.isBlob(g))throw new S("Blob is not supported. Use a Buffer instead.");return f.isArrayBuffer(g)||f.isTypedArray(g)?u&&typeof Blob=="function"?new Blob([g]):ge.Buffer.from(g):g}function c(g,y,_){let w=g;if(g&&!_&&typeof g=="object"){if(f.endsWith(y,"{}"))y=s?y:y.slice(0,-2),g=JSON.stringify(g);else if(f.isArray(g)&&Hl(g)||(f.isFileList(g)||f.endsWith(y,"[]"))&&(w=f.toArray(g)))return y=Bi(y),w.forEach(function(P,F){!(f.isUndefined(P)||P===null)&&e.append(a===!0?Zs([y],F,i):a===null?y:y+"[]",l(P))}),!1}return Nn(g)?!0:(e.append(Zs(_,y,i),l(g)),!1)}const d=[],h=Object.assign(ql,{defaultVisitor:c,convertValue:l,isVisitable:Nn});function E(g,y){if(!f.isUndefined(g)){if(d.indexOf(g)!==-1)throw Error("Circular reference detected in "+y.join("."));d.push(g),f.forEach(g,function(w,C){(!(f.isUndefined(w)||w===null)&&r.call(e,w,f.isString(C)?C.trim():C,y,h))===!0&&E(w,y?y.concat(C):[C])}),d.pop()}}if(!f.isObject(t))throw new TypeError("data must be an object");return E(t),e}function er(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function Qn(t,e){this._pairs=[],t&&Jt(t,this,e)}const Hi=Qn.prototype;Hi.append=function(e,n){this._pairs.push([e,n])};Hi.toString=function(e){const n=e?function(s){return e.call(this,s,er)}:er;return this._pairs.map(function(r){return n(r[0])+"="+n(r[1])},"").join("&")};function Kl(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function qi(t,e,n){if(!e)return t;const s=n&&n.encode||Kl,r=n&&n.serialize;let i;if(r?i=r(e,n):i=f.isURLSearchParams(e)?e.toString():new Qn(e,n).toString(s),i){const a=t.indexOf("#");a!==-1&&(t=t.slice(0,a)),t+=(t.indexOf("?")===-1?"?":"&")+i}return t}class $l{constructor(){this.handlers=[]}use(e,n,s){return this.handlers.push({fulfilled:e,rejected:n,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){f.forEach(this.handlers,function(s){s!==null&&e(s)})}}const tr=$l,Ki={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Vl=typeof URLSearchParams<"u"?URLSearchParams:Qn,Wl=typeof FormData<"u"?FormData:null,Jl=typeof Blob<"u"?Blob:null,jl={isBrowser:!0,classes:{URLSearchParams:Vl,FormData:Wl,Blob:Jl},protocols:["http","https","file","blob","url","data"]},Zn=typeof window<"u"&&typeof document<"u",In=typeof navigator=="object"&&navigator||void 0,Gl=Zn&&(!In||["ReactNative","NativeScript","NS"].indexOf(In.product)<0),zl=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),Yl=Zn&&window.location.href||"http://localhost",Xl=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Zn,hasStandardBrowserEnv:Gl,hasStandardBrowserWebWorkerEnv:zl,navigator:In,origin:Yl},Symbol.toStringTag,{value:"Module"})),H={...Xl,...jl};function Ql(t,e){return Jt(t,new H.classes.URLSearchParams,Object.assign({visitor:function(n,s,r,i){return H.isNode&&f.isBuffer(n)?(this.append(s,n.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},e))}function Zl(t){return f.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function ed(t){const e={},n=Object.keys(t);let s;const r=n.length;let i;for(s=0;s<r;s++)i=n[s],e[i]=t[i];return e}function $i(t){function e(n,s,r,i){let a=n[i++];if(a==="__proto__")return!0;const o=Number.isFinite(+a),u=i>=n.length;return a=!a&&f.isArray(r)?r.length:a,u?(f.hasOwnProp(r,a)?r[a]=[r[a],s]:r[a]=s,!o):((!r[a]||!f.isObject(r[a]))&&(r[a]=[]),e(n,s,r[a],i)&&f.isArray(r[a])&&(r[a]=ed(r[a])),!o)}if(f.isFormData(t)&&f.isFunction(t.entries)){const n={};return f.forEachEntry(t,(s,r)=>{e(Zl(s),r,n,0)}),n}return null}function td(t,e,n){if(f.isString(t))try{return(e||JSON.parse)(t),f.trim(t)}catch(s){if(s.name!=="SyntaxError")throw s}return(n||JSON.stringify)(t)}const es={transitional:Ki,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const s=n.getContentType()||"",r=s.indexOf("application/json")>-1,i=f.isObject(e);if(i&&f.isHTMLForm(e)&&(e=new FormData(e)),f.isFormData(e))return r?JSON.stringify($i(e)):e;if(f.isArrayBuffer(e)||f.isBuffer(e)||f.isStream(e)||f.isFile(e)||f.isBlob(e)||f.isReadableStream(e))return e;if(f.isArrayBufferView(e))return e.buffer;if(f.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(i){if(s.indexOf("application/x-www-form-urlencoded")>-1)return Ql(e,this.formSerializer).toString();if((o=f.isFileList(e))||s.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return Jt(o?{"files[]":e}:e,u&&new u,this.formSerializer)}}return i||r?(n.setContentType("application/json",!1),td(e)):e}],transformResponse:[function(e){const n=this.transitional||es.transitional,s=n&&n.forcedJSONParsing,r=this.responseType==="json";if(f.isResponse(e)||f.isReadableStream(e))return e;if(e&&f.isString(e)&&(s&&!this.responseType||r)){const a=!(n&&n.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(o){if(a)throw o.name==="SyntaxError"?S.from(o,S.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:H.classes.FormData,Blob:H.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};f.forEach(["delete","get","head","post","put","patch"],t=>{es.headers[t]={}});const ts=es,nd=f.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),sd=t=>{const e={};let n,s,r;return t&&t.split(`
`).forEach(function(a){r=a.indexOf(":"),n=a.substring(0,r).trim().toLowerCase(),s=a.substring(r+1).trim(),!(!n||e[n]&&nd[n])&&(n==="set-cookie"?e[n]?e[n].push(s):e[n]=[s]:e[n]=e[n]?e[n]+", "+s:s)}),e},nr=Symbol("internals");function Ze(t){return t&&String(t).trim().toLowerCase()}function vt(t){return t===!1||t==null?t:f.isArray(t)?t.map(vt):String(t)}function rd(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=n.exec(t);)e[s[1]]=s[2];return e}const id=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function fn(t,e,n,s,r){if(f.isFunction(s))return s.call(this,e,n);if(r&&(e=n),!!f.isString(e)){if(f.isString(s))return e.indexOf(s)!==-1;if(f.isRegExp(s))return s.test(e)}}function ad(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,s)=>n.toUpperCase()+s)}function od(t,e){const n=f.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(t,s+n,{value:function(r,i,a){return this[s].call(this,e,r,i,a)},configurable:!0})})}class jt{constructor(e){e&&this.set(e)}set(e,n,s){const r=this;function i(o,u,l){const c=Ze(u);if(!c)throw new Error("header name must be a non-empty string");const d=f.findKey(r,c);(!d||r[d]===void 0||l===!0||l===void 0&&r[d]!==!1)&&(r[d||u]=vt(o))}const a=(o,u)=>f.forEach(o,(l,c)=>i(l,c,u));if(f.isPlainObject(e)||e instanceof this.constructor)a(e,n);else if(f.isString(e)&&(e=e.trim())&&!id(e))a(sd(e),n);else if(f.isHeaders(e))for(const[o,u]of e.entries())i(u,o,s);else e!=null&&i(n,e,s);return this}get(e,n){if(e=Ze(e),e){const s=f.findKey(this,e);if(s){const r=this[s];if(!n)return r;if(n===!0)return rd(r);if(f.isFunction(n))return n.call(this,r,s);if(f.isRegExp(n))return n.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=Ze(e),e){const s=f.findKey(this,e);return!!(s&&this[s]!==void 0&&(!n||fn(this,this[s],s,n)))}return!1}delete(e,n){const s=this;let r=!1;function i(a){if(a=Ze(a),a){const o=f.findKey(s,a);o&&(!n||fn(s,s[o],o,n))&&(delete s[o],r=!0)}}return f.isArray(e)?e.forEach(i):i(e),r}clear(e){const n=Object.keys(this);let s=n.length,r=!1;for(;s--;){const i=n[s];(!e||fn(this,this[i],i,e,!0))&&(delete this[i],r=!0)}return r}normalize(e){const n=this,s={};return f.forEach(this,(r,i)=>{const a=f.findKey(s,i);if(a){n[a]=vt(r),delete n[i];return}const o=e?ad(i):String(i).trim();o!==i&&delete n[i],n[o]=vt(r),s[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return f.forEach(this,(s,r)=>{s!=null&&s!==!1&&(n[r]=e&&f.isArray(s)?s.join(", "):s)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const s=new this(e);return n.forEach(r=>s.set(r)),s}static accessor(e){const s=(this[nr]=this[nr]={accessors:{}}).accessors,r=this.prototype;function i(a){const o=Ze(a);s[o]||(od(r,a),s[o]=!0)}return f.isArray(e)?e.forEach(i):i(e),this}}jt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);f.reduceDescriptors(jt.prototype,({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(s){this[n]=s}}});f.freezeMethods(jt);const z=jt;function hn(t,e){const n=this||ts,s=e||n,r=z.from(s.headers);let i=s.data;return f.forEach(t,function(o){i=o.call(n,i,r.normalize(),e?e.status:void 0)}),r.normalize(),i}function Vi(t){return!!(t&&t.__CANCEL__)}function Ge(t,e,n){S.call(this,t??"canceled",S.ERR_CANCELED,e,n),this.name="CanceledError"}f.inherits(Ge,S,{__CANCEL__:!0});function Wi(t,e,n){const s=n.config.validateStatus;!n.status||!s||s(n.status)?t(n):e(new S("Request failed with status code "+n.status,[S.ERR_BAD_REQUEST,S.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function cd(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function ud(t,e){t=t||10;const n=new Array(t),s=new Array(t);let r=0,i=0,a;return e=e!==void 0?e:1e3,function(u){const l=Date.now(),c=s[i];a||(a=l),n[r]=u,s[r]=l;let d=i,h=0;for(;d!==r;)h+=n[d++],d=d%t;if(r=(r+1)%t,r===i&&(i=(i+1)%t),l-a<e)return;const E=c&&l-c;return E?Math.round(h*1e3/E):void 0}}function ld(t,e){let n=0,s=1e3/e,r,i;const a=(l,c=Date.now())=>{n=c,r=null,i&&(clearTimeout(i),i=null),t.apply(null,l)};return[(...l)=>{const c=Date.now(),d=c-n;d>=s?a(l,c):(r=l,i||(i=setTimeout(()=>{i=null,a(r)},s-d)))},()=>r&&a(r)]}const Ft=(t,e,n=3)=>{let s=0;const r=ud(50,250);return ld(i=>{const a=i.loaded,o=i.lengthComputable?i.total:void 0,u=a-s,l=r(u),c=a<=o;s=a;const d={loaded:a,total:o,progress:o?a/o:void 0,bytes:u,rate:l||void 0,estimated:l&&o&&c?(o-a)/l:void 0,event:i,lengthComputable:o!=null,[e?"download":"upload"]:!0};t(d)},n)},sr=(t,e)=>{const n=t!=null;return[s=>e[0]({lengthComputable:n,total:t,loaded:s}),e[1]]},rr=t=>(...e)=>f.asap(()=>t(...e)),dd=H.hasStandardBrowserEnv?function(){const e=H.navigator&&/(msie|trident)/i.test(H.navigator.userAgent),n=document.createElement("a");let s;function r(i){let a=i;return e&&(n.setAttribute("href",a),a=n.href),n.setAttribute("href",a),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:n.pathname.charAt(0)==="/"?n.pathname:"/"+n.pathname}}return s=r(window.location.href),function(a){const o=f.isString(a)?r(a):a;return o.protocol===s.protocol&&o.host===s.host}}():function(){return function(){return!0}}(),fd=H.hasStandardBrowserEnv?{write(t,e,n,s,r,i){const a=[t+"="+encodeURIComponent(e)];f.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),f.isString(s)&&a.push("path="+s),f.isString(r)&&a.push("domain="+r),i===!0&&a.push("secure"),document.cookie=a.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function hd(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function md(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function Ji(t,e){return t&&!hd(e)?md(t,e):e}const ir=t=>t instanceof z?{...t}:t;function Ae(t,e){e=e||{};const n={};function s(l,c,d){return f.isPlainObject(l)&&f.isPlainObject(c)?f.merge.call({caseless:d},l,c):f.isPlainObject(c)?f.merge({},c):f.isArray(c)?c.slice():c}function r(l,c,d){if(f.isUndefined(c)){if(!f.isUndefined(l))return s(void 0,l,d)}else return s(l,c,d)}function i(l,c){if(!f.isUndefined(c))return s(void 0,c)}function a(l,c){if(f.isUndefined(c)){if(!f.isUndefined(l))return s(void 0,l)}else return s(void 0,c)}function o(l,c,d){if(d in e)return s(l,c);if(d in t)return s(void 0,l)}const u={url:i,method:i,data:i,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(l,c)=>r(ir(l),ir(c),!0)};return f.forEach(Object.keys(Object.assign({},t,e)),function(c){const d=u[c]||r,h=d(t[c],e[c],c);f.isUndefined(h)&&d!==o||(n[c]=h)}),n}const ji=t=>{const e=Ae({},t);let{data:n,withXSRFToken:s,xsrfHeaderName:r,xsrfCookieName:i,headers:a,auth:o}=e;e.headers=a=z.from(a),e.url=qi(Ji(e.baseURL,e.url),t.params,t.paramsSerializer),o&&a.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):"")));let u;if(f.isFormData(n)){if(H.hasStandardBrowserEnv||H.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if((u=a.getContentType())!==!1){const[l,...c]=u?u.split(";").map(d=>d.trim()).filter(Boolean):[];a.setContentType([l||"multipart/form-data",...c].join("; "))}}if(H.hasStandardBrowserEnv&&(s&&f.isFunction(s)&&(s=s(e)),s||s!==!1&&dd(e.url))){const l=r&&i&&fd.read(i);l&&a.set(r,l)}return e},pd=typeof XMLHttpRequest<"u",gd=pd&&function(t){return new Promise(function(n,s){const r=ji(t);let i=r.data;const a=z.from(r.headers).normalize();let{responseType:o,onUploadProgress:u,onDownloadProgress:l}=r,c,d,h,E,g;function y(){E&&E(),g&&g(),r.cancelToken&&r.cancelToken.unsubscribe(c),r.signal&&r.signal.removeEventListener("abort",c)}let _=new XMLHttpRequest;_.open(r.method.toUpperCase(),r.url,!0),_.timeout=r.timeout;function w(){if(!_)return;const P=z.from("getAllResponseHeaders"in _&&_.getAllResponseHeaders()),x={data:!o||o==="text"||o==="json"?_.responseText:_.response,status:_.status,statusText:_.statusText,headers:P,config:t,request:_};Wi(function(te){n(te),y()},function(te){s(te),y()},x),_=null}"onloadend"in _?_.onloadend=w:_.onreadystatechange=function(){!_||_.readyState!==4||_.status===0&&!(_.responseURL&&_.responseURL.indexOf("file:")===0)||setTimeout(w)},_.onabort=function(){_&&(s(new S("Request aborted",S.ECONNABORTED,t,_)),_=null)},_.onerror=function(){s(new S("Network Error",S.ERR_NETWORK,t,_)),_=null},_.ontimeout=function(){let F=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const x=r.transitional||Ki;r.timeoutErrorMessage&&(F=r.timeoutErrorMessage),s(new S(F,x.clarifyTimeoutError?S.ETIMEDOUT:S.ECONNABORTED,t,_)),_=null},i===void 0&&a.setContentType(null),"setRequestHeader"in _&&f.forEach(a.toJSON(),function(F,x){_.setRequestHeader(x,F)}),f.isUndefined(r.withCredentials)||(_.withCredentials=!!r.withCredentials),o&&o!=="json"&&(_.responseType=r.responseType),l&&([h,g]=Ft(l,!0),_.addEventListener("progress",h)),u&&_.upload&&([d,E]=Ft(u),_.upload.addEventListener("progress",d),_.upload.addEventListener("loadend",E)),(r.cancelToken||r.signal)&&(c=P=>{_&&(s(!P||P.type?new Ge(null,t,_):P),_.abort(),_=null)},r.cancelToken&&r.cancelToken.subscribe(c),r.signal&&(r.signal.aborted?c():r.signal.addEventListener("abort",c)));const C=cd(r.url);if(C&&H.protocols.indexOf(C)===-1){s(new S("Unsupported protocol "+C+":",S.ERR_BAD_REQUEST,t));return}_.send(i||null)})},_d=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let s=new AbortController,r;const i=function(l){if(!r){r=!0,o();const c=l instanceof Error?l:this.reason;s.abort(c instanceof S?c:new Ge(c instanceof Error?c.message:c))}};let a=e&&setTimeout(()=>{a=null,i(new S(`timeout ${e} of ms exceeded`,S.ETIMEDOUT))},e);const o=()=>{t&&(a&&clearTimeout(a),a=null,t.forEach(l=>{l.unsubscribe?l.unsubscribe(i):l.removeEventListener("abort",i)}),t=null)};t.forEach(l=>l.addEventListener("abort",i));const{signal:u}=s;return u.unsubscribe=()=>f.asap(o),u}},yd=_d,Td=function*(t,e){let n=t.byteLength;if(!e||n<e){yield t;return}let s=0,r;for(;s<n;)r=s+e,yield t.slice(s,r),s=r},Ed=async function*(t,e){for await(const n of Sd(t))yield*Td(n,e)},Sd=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:n,value:s}=await e.read();if(n)break;yield s}}finally{await e.cancel()}},ar=(t,e,n,s)=>{const r=Ed(t,e);let i=0,a,o=u=>{a||(a=!0,s&&s(u))};return new ReadableStream({async pull(u){try{const{done:l,value:c}=await r.next();if(l){o(),u.close();return}let d=c.byteLength;if(n){let h=i+=d;n(h)}u.enqueue(new Uint8Array(c))}catch(l){throw o(l),l}},cancel(u){return o(u),r.return()}},{highWaterMark:2})},Gt=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Gi=Gt&&typeof ReadableStream=="function",wd=Gt&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),zi=(t,...e)=>{try{return!!t(...e)}catch{return!1}},bd=Gi&&zi(()=>{let t=!1;const e=new Request(H.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),or=64*1024,On=Gi&&zi(()=>f.isReadableStream(new Response("").body)),Ut={stream:On&&(t=>t.body)};Gt&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Ut[e]&&(Ut[e]=f.isFunction(t[e])?n=>n[e]():(n,s)=>{throw new S(`Response type '${e}' is not supported`,S.ERR_NOT_SUPPORT,s)})})})(new Response);const kd=async t=>{if(t==null)return 0;if(f.isBlob(t))return t.size;if(f.isSpecCompliantForm(t))return(await new Request(H.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(f.isArrayBufferView(t)||f.isArrayBuffer(t))return t.byteLength;if(f.isURLSearchParams(t)&&(t=t+""),f.isString(t))return(await wd(t)).byteLength},Rd=async(t,e)=>{const n=f.toFiniteNumber(t.getContentLength());return n??kd(e)},Cd=Gt&&(async t=>{let{url:e,method:n,data:s,signal:r,cancelToken:i,timeout:a,onDownloadProgress:o,onUploadProgress:u,responseType:l,headers:c,withCredentials:d="same-origin",fetchOptions:h}=ji(t);l=l?(l+"").toLowerCase():"text";let E=yd([r,i&&i.toAbortSignal()],a),g;const y=E&&E.unsubscribe&&(()=>{E.unsubscribe()});let _;try{if(u&&bd&&n!=="get"&&n!=="head"&&(_=await Rd(c,s))!==0){let x=new Request(e,{method:"POST",body:s,duplex:"half"}),W;if(f.isFormData(s)&&(W=x.headers.get("content-type"))&&c.setContentType(W),x.body){const[te,we]=sr(_,Ft(rr(u)));s=ar(x.body,or,te,we)}}f.isString(d)||(d=d?"include":"omit");const w="credentials"in Request.prototype;g=new Request(e,{...h,signal:E,method:n.toUpperCase(),headers:c.normalize().toJSON(),body:s,duplex:"half",credentials:w?d:void 0});let C=await fetch(g);const P=On&&(l==="stream"||l==="response");if(On&&(o||P&&y)){const x={};["status","statusText","headers"].forEach(Et=>{x[Et]=C[Et]});const W=f.toFiniteNumber(C.headers.get("content-length")),[te,we]=o&&sr(W,Ft(rr(o),!0))||[];C=new Response(ar(C.body,or,te,()=>{we&&we(),y&&y()}),x)}l=l||"text";let F=await Ut[f.findKey(Ut,l)||"text"](C,t);return!P&&y&&y(),await new Promise((x,W)=>{Wi(x,W,{data:F,headers:z.from(C.headers),status:C.status,statusText:C.statusText,config:t,request:g})})}catch(w){throw y&&y(),w&&w.name==="TypeError"&&/fetch/i.test(w.message)?Object.assign(new S("Network Error",S.ERR_NETWORK,t,g),{cause:w.cause||w}):S.from(w,w&&w.code,t,g)}}),vn={http:Bl,xhr:gd,fetch:Cd};f.forEach(vn,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const cr=t=>`- ${t}`,Ad=t=>f.isFunction(t)||t===null||t===!1,Yi={getAdapter:t=>{t=f.isArray(t)?t:[t];const{length:e}=t;let n,s;const r={};for(let i=0;i<e;i++){n=t[i];let a;if(s=n,!Ad(n)&&(s=vn[(a=String(n)).toLowerCase()],s===void 0))throw new S(`Unknown adapter '${a}'`);if(s)break;r[a||"#"+i]=s}if(!s){const i=Object.entries(r).map(([o,u])=>`adapter ${o} `+(u===!1?"is not supported by the environment":"is not available in the build"));let a=e?i.length>1?`since :
`+i.map(cr).join(`
`):" "+cr(i[0]):"as no adapter specified";throw new S("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return s},adapters:vn};function mn(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Ge(null,t)}function ur(t){return mn(t),t.headers=z.from(t.headers),t.data=hn.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Yi.getAdapter(t.adapter||ts.adapter)(t).then(function(s){return mn(t),s.data=hn.call(t,t.transformResponse,s),s.headers=z.from(s.headers),s},function(s){return Vi(s)||(mn(t),s&&s.response&&(s.response.data=hn.call(t,t.transformResponse,s.response),s.response.headers=z.from(s.response.headers))),Promise.reject(s)})}const Xi="1.7.7",ns={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{ns[t]=function(s){return typeof s===t||"a"+(e<1?"n ":" ")+t}});const lr={};ns.transitional=function(e,n,s){function r(i,a){return"[Axios v"+Xi+"] Transitional option '"+i+"'"+a+(s?". "+s:"")}return(i,a,o)=>{if(e===!1)throw new S(r(a," has been removed"+(n?" in "+n:"")),S.ERR_DEPRECATED);return n&&!lr[a]&&(lr[a]=!0,console.warn(r(a," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(i,a,o):!0}};function Nd(t,e,n){if(typeof t!="object")throw new S("options must be an object",S.ERR_BAD_OPTION_VALUE);const s=Object.keys(t);let r=s.length;for(;r-- >0;){const i=s[r],a=e[i];if(a){const o=t[i],u=o===void 0||a(o,i,t);if(u!==!0)throw new S("option "+i+" must be "+u,S.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new S("Unknown option "+i,S.ERR_BAD_OPTION)}}const Dn={assertOptions:Nd,validators:ns},de=Dn.validators;class Bt{constructor(e){this.defaults=e,this.interceptors={request:new tr,response:new tr}}async request(e,n){try{return await this._request(e,n)}catch(s){if(s instanceof Error){let r;Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";try{s.stack?i&&!String(s.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+i):s.stack=i}catch{}}throw s}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=Ae(this.defaults,n);const{transitional:s,paramsSerializer:r,headers:i}=n;s!==void 0&&Dn.assertOptions(s,{silentJSONParsing:de.transitional(de.boolean),forcedJSONParsing:de.transitional(de.boolean),clarifyTimeoutError:de.transitional(de.boolean)},!1),r!=null&&(f.isFunction(r)?n.paramsSerializer={serialize:r}:Dn.assertOptions(r,{encode:de.function,serialize:de.function},!0)),n.method=(n.method||this.defaults.method||"get").toLowerCase();let a=i&&f.merge(i.common,i[n.method]);i&&f.forEach(["delete","get","head","post","put","patch","common"],g=>{delete i[g]}),n.headers=z.concat(a,i);const o=[];let u=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(n)===!1||(u=u&&y.synchronous,o.unshift(y.fulfilled,y.rejected))});const l=[];this.interceptors.response.forEach(function(y){l.push(y.fulfilled,y.rejected)});let c,d=0,h;if(!u){const g=[ur.bind(this),void 0];for(g.unshift.apply(g,o),g.push.apply(g,l),h=g.length,c=Promise.resolve(n);d<h;)c=c.then(g[d++],g[d++]);return c}h=o.length;let E=n;for(d=0;d<h;){const g=o[d++],y=o[d++];try{E=g(E)}catch(_){y.call(this,_);break}}try{c=ur.call(this,E)}catch(g){return Promise.reject(g)}for(d=0,h=l.length;d<h;)c=c.then(l[d++],l[d++]);return c}getUri(e){e=Ae(this.defaults,e);const n=Ji(e.baseURL,e.url);return qi(n,e.params,e.paramsSerializer)}}f.forEach(["delete","get","head","options"],function(e){Bt.prototype[e]=function(n,s){return this.request(Ae(s||{},{method:e,url:n,data:(s||{}).data}))}});f.forEach(["post","put","patch"],function(e){function n(s){return function(i,a,o){return this.request(Ae(o||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:i,data:a}))}}Bt.prototype[e]=n(),Bt.prototype[e+"Form"]=n(!0)});const Dt=Bt;class ss{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(i){n=i});const s=this;this.promise.then(r=>{if(!s._listeners)return;let i=s._listeners.length;for(;i-- >0;)s._listeners[i](r);s._listeners=null}),this.promise.then=r=>{let i;const a=new Promise(o=>{s.subscribe(o),i=o}).then(r);return a.cancel=function(){s.unsubscribe(i)},a},e(function(i,a,o){s.reason||(s.reason=new Ge(i,a,o),n(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=s=>{e.abort(s)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new ss(function(r){e=r}),cancel:e}}}const Id=ss;function Od(t){return function(n){return t.apply(null,n)}}function vd(t){return f.isObject(t)&&t.isAxiosError===!0}const Pn={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Pn).forEach(([t,e])=>{Pn[e]=t});const Dd=Pn;function Qi(t){const e=new Dt(t),n=Ii(Dt.prototype.request,e);return f.extend(n,Dt.prototype,e,{allOwnKeys:!0}),f.extend(n,e,null,{allOwnKeys:!0}),n.create=function(r){return Qi(Ae(t,r))},n}const L=Qi(ts);L.Axios=Dt;L.CanceledError=Ge;L.CancelToken=Id;L.isCancel=Vi;L.VERSION=Xi;L.toFormData=Jt;L.AxiosError=S;L.Cancel=L.CanceledError;L.all=function(e){return Promise.all(e)};L.spread=Od;L.isAxiosError=vd;L.mergeConfig=Ae;L.AxiosHeaders=z;L.formToJSON=t=>$i(f.isHTMLForm(t)?new FormData(t):t);L.getAdapter=Yi.getAdapter;L.HttpStatusCode=Dd;L.default=L;const Zi=L,rs=new URLSearchParams(window.location.search);function fe(t,e){const n=rs.get(t);if(n==null||n===""){if(e===void 0)throw new Error("Missing required url query parameter (string): "+t);return e}return n}function dr(t,e){const n=rs.get(t);if(n==null||n===""){if(e===void 0)throw new Error("Missing required boolean url query parameter (boolean): "+t);return e}return n.toLowerCase()!=="false"}function fr(t,e){const n=rs.get(t);if(n==null||n===""){if(e===void 0)throw new Error("Missing required integer url query parameter (integer): "+t);return e}try{return parseInt(n)}catch{throw new Error(`Error parsing integer url query parameter: ${t}=${n}`)}}const A={DEBUG_MODE:dr("DEBUG_MODE",!1),SEND_LOGS:dr("SEND_LOGS",!1),ROV_NAME:fe("ROV_NAME","Default-ROV"),ROV_CONTROL_PASSWORD:fe("ROV_CONTROL_PASSWORD"),LIVEKIT_API_KEY:fe("LIVEKIT_API_KEY"),LIVEKIT_SECRET_KEY:fe("LIVEKIT_SECRET_KEY"),TWITCH_STREAM_KEY:fe("TWITCH_STREAM_KEY","None"),PYTHON_WEBSOCKET_PORT:fr("PYTHON_WEBSOCKET_PORT",0),AUTH_TOKEN_TIMEOUT:fr("AUTH_TOKEN_TIMEOUT",$a),BLUEOS_APIS_ENDPOINT:fe("BLUEOS_APIS_ENDPOINT",""),LIVEKIT_CLOUD_ENDPOINT:fe("LIVEKIT_CLOUD_URL","https://rov-web.livekit.cloud"),LIVEKIT_LOCAL_ENDPOINT:fe("LIVEKIT_LOCAL_URL","http://localhost:7880")},Pd="/commander/v1.0";async function hr(t){return Zi({method:"post",url:`${A.BLUEOS_APIS_ENDPOINT+Pd}/shutdown`,timeout:5e3,withCredentials:!1,params:{shutdown_type:t,i_know_what_i_am_doing:!0}}).then(e=>e.data).then(e=>"Shutting Down... "+String(e)).catch(e=>{var s;if(e.code==="ECONNABORTED")return"Shutting Down... ";const n=`Could not execute shutdown: ${e.code} - ${e.message} - ${e.message??((s=e.response)==null?void 0:s.data)}.`;throw logWarn(n),new Error(n)})}let pn=null,gn=!1;function Ld(t,e){if(e.SimplepeerSignal&&e.SimplepeerSignal.Message)return ee.ingestSimplePeerSignallingMsg(t,e.SimplepeerSignal.Message),!0;if(e.Move){if(pn&&pn!==t||!gn)return!1;he.sendMessage(Ys());let n=(e.Move.VelocityX||0)*1e3,s=(e.Move.VelocityY||0)*1e3,r=(e.Move.VelocityZ||0)*500+500,i=(e.Move.AngularVelocityYaw||0)*500,a=e.Move.ButtonBitmask||0;return he.sendMessage(Qu(n,s,r,i,a)),!0}else{if(e.ShutdownRov)return hr("poweroff").then(n=>{ee.sendMessage(U.RovResponse.create({ExchangeId:e.ExchangeId,Done:{Message:n}}),!1,[])}).catch(n=>{ee.sendMessage(U.RovResponse.create({ExchangeId:e.ExchangeId,Error:{Message:n.message}}),!1,[])}),!0;if(e.RebootRov)hr("reboot");else return e.SetAutopilotMode?(he.sendMessage(Yu(e.SetAutopilotMode.mode)),!0):e.Disarm?(he.sendMessage(Gu()),gn=!1,!0):e.TakeControl?(pn=t,ee.sendMessage(U.RovResponse.create({DriverChanged:{DriverPeerId:t}}),!1,[]),gn=!0,he.sendMessage(Ys()),!0):e.Ping?(ee.sendMessage(U.RovResponse.create({Pong:{Time:e.Ping.Time}}),!1,[t]),he.sendMessage(Xu()),!0):(G("Unhandled Message Recived: ",e.toJSON()),!1)}}function mr(t,e){let n=new Uint8Array(e);if(!n||n.length===0)return;const s=U.RovAction.decode(n);if(Ld(t,s))return;s.BackendMetadata=s.BackendMetadata||new U.ActionBackendMetadata,s.BackendMetadata.FromUserId=t;const r=U.RovAction.encode(s).finish();Cn.isConnected&&Cn.sendMessage(r)}var Ln={exports:{}},_n,pr;function Md(){if(pr)return _n;pr=1;var t=1e3,e=t*60,n=e*60,s=n*24,r=s*7,i=s*365.25;_n=function(c,d){d=d||{};var h=typeof c;if(h==="string"&&c.length>0)return a(c);if(h==="number"&&isFinite(c))return d.long?u(c):o(c);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(c))};function a(c){if(c=String(c),!(c.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(c);if(d){var h=parseFloat(d[1]),E=(d[2]||"ms").toLowerCase();switch(E){case"years":case"year":case"yrs":case"yr":case"y":return h*i;case"weeks":case"week":case"w":return h*r;case"days":case"day":case"d":return h*s;case"hours":case"hour":case"hrs":case"hr":case"h":return h*n;case"minutes":case"minute":case"mins":case"min":case"m":return h*e;case"seconds":case"second":case"secs":case"sec":case"s":return h*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function o(c){var d=Math.abs(c);return d>=s?Math.round(c/s)+"d":d>=n?Math.round(c/n)+"h":d>=e?Math.round(c/e)+"m":d>=t?Math.round(c/t)+"s":c+"ms"}function u(c){var d=Math.abs(c);return d>=s?l(c,d,s,"day"):d>=n?l(c,d,n,"hour"):d>=e?l(c,d,e,"minute"):d>=t?l(c,d,t,"second"):c+" ms"}function l(c,d,h,E){var g=d>=h*1.5;return Math.round(c/h)+" "+E+(g?"s":"")}return _n}function xd(t){n.debug=n,n.default=n,n.coerce=u,n.disable=i,n.enable=r,n.enabled=a,n.humanize=Md(),n.destroy=l,Object.keys(t).forEach(c=>{n[c]=t[c]}),n.names=[],n.skips=[],n.formatters={};function e(c){let d=0;for(let h=0;h<c.length;h++)d=(d<<5)-d+c.charCodeAt(h),d|=0;return n.colors[Math.abs(d)%n.colors.length]}n.selectColor=e;function n(c){let d,h=null,E,g;function y(..._){if(!y.enabled)return;const w=y,C=Number(new Date),P=C-(d||C);w.diff=P,w.prev=d,w.curr=C,d=C,_[0]=n.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");let F=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,(W,te)=>{if(W==="%%")return"%";F++;const we=n.formatters[te];if(typeof we=="function"){const Et=_[F];W=we.call(w,Et),_.splice(F,1),F--}return W}),n.formatArgs.call(w,_),(w.log||n.log).apply(w,_)}return y.namespace=c,y.useColors=n.useColors(),y.color=n.selectColor(c),y.extend=s,y.destroy=n.destroy,Object.defineProperty(y,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(E!==n.namespaces&&(E=n.namespaces,g=n.enabled(c)),g),set:_=>{h=_}}),typeof n.init=="function"&&n.init(y),y}function s(c,d){const h=n(this.namespace+(typeof d>"u"?":":d)+c);return h.log=this.log,h}function r(c){n.save(c),n.namespaces=c,n.names=[],n.skips=[];let d;const h=(typeof c=="string"?c:"").split(/[\s,]+/),E=h.length;for(d=0;d<E;d++)h[d]&&(c=h[d].replace(/\*/g,".*?"),c[0]==="-"?n.skips.push(new RegExp("^"+c.slice(1)+"$")):n.names.push(new RegExp("^"+c+"$")))}function i(){const c=[...n.names.map(o),...n.skips.map(o).map(d=>"-"+d)].join(",");return n.enable(""),c}function a(c){if(c[c.length-1]==="*")return!0;let d,h;for(d=0,h=n.skips.length;d<h;d++)if(n.skips[d].test(c))return!1;for(d=0,h=n.names.length;d<h;d++)if(n.names[d].test(c))return!0;return!1}function o(c){return c.toString().substring(2,c.toString().length-2).replace(/\.\*\?$/,"*")}function u(c){return c instanceof Error?c.stack||c.message:c}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}var Fd=xd;(function(t,e){e.formatArgs=s,e.save=r,e.load=i,e.useColors=n,e.storage=a(),e.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let u;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(u=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(u[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const l="color: "+this.color;u.splice(1,0,l,"color: inherit");let c=0,d=0;u[0].replace(/%[a-zA-Z%]/g,h=>{h!=="%%"&&(c++,h==="%c"&&(d=c))}),u.splice(d,0,l)}e.log=console.debug||console.log||(()=>{});function r(u){try{u?e.storage.setItem("debug",u):e.storage.removeItem("debug")}catch{}}function i(){let u;try{u=e.storage.getItem("debug")}catch{}return!u&&typeof ge.process<"u"&&"env"in ge.process&&(u={}.DEBUG),u}function a(){try{return localStorage}catch{}}t.exports=Fd(e);const{formatters:o}=t.exports;o.j=function(u){try{return JSON.stringify(u)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}})(Ln,Ln.exports);var Ud=Ln.exports;const Bd=qn(Ud),oe=typeof window<"u"?window:self,Mn=oe.RTCPeerConnection||oe.mozRTCPeerConnection||oe.webkitRTCPeerConnection,Hd=oe.RTCSessionDescription||oe.mozRTCSessionDescription||oe.webkitRTCSessionDescription,qd=oe.RTCIceCandidate||oe.mozRTCIceCandidate||oe.webkitRTCIceCandidate;var is={exports:{}},He=typeof Reflect=="object"?Reflect:null,gr=He&&typeof He.apply=="function"?He.apply:function(e,n,s){return Function.prototype.apply.call(e,n,s)},Pt;He&&typeof He.ownKeys=="function"?Pt=He.ownKeys:Object.getOwnPropertySymbols?Pt=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Pt=function(e){return Object.getOwnPropertyNames(e)};function Kd(t){console&&console.warn&&console.warn(t)}var ea=Number.isNaN||function(e){return e!==e};function k(){k.init.call(this)}is.exports=k;is.exports.once=Jd;k.EventEmitter=k;k.prototype._events=void 0;k.prototype._eventsCount=0;k.prototype._maxListeners=void 0;var _r=10;function zt(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(k,"defaultMaxListeners",{enumerable:!0,get:function(){return _r},set:function(t){if(typeof t!="number"||t<0||ea(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");_r=t}});k.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};k.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||ea(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function ta(t){return t._maxListeners===void 0?k.defaultMaxListeners:t._maxListeners}k.prototype.getMaxListeners=function(){return ta(this)};k.prototype.emit=function(e){for(var n=[],s=1;s<arguments.length;s++)n.push(arguments[s]);var r=e==="error",i=this._events;if(i!==void 0)r=r&&i.error===void 0;else if(!r)return!1;if(r){var a;if(n.length>0&&(a=n[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var u=i[e];if(u===void 0)return!1;if(typeof u=="function")gr(u,this,n);else for(var l=u.length,c=aa(u,l),s=0;s<l;++s)gr(c[s],this,n);return!0};function na(t,e,n,s){var r,i,a;if(zt(n),i=t._events,i===void 0?(i=t._events=Object.create(null),t._eventsCount=0):(i.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),i=t._events),a=i[e]),a===void 0)a=i[e]=n,++t._eventsCount;else if(typeof a=="function"?a=i[e]=s?[n,a]:[a,n]:s?a.unshift(n):a.push(n),r=ta(t),r>0&&a.length>r&&!a.warned){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=t,o.type=e,o.count=a.length,Kd(o)}return t}k.prototype.addListener=function(e,n){return na(this,e,n,!1)};k.prototype.on=k.prototype.addListener;k.prototype.prependListener=function(e,n){return na(this,e,n,!0)};function $d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function sa(t,e,n){var s={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},r=$d.bind(s);return r.listener=n,s.wrapFn=r,r}k.prototype.once=function(e,n){return zt(n),this.on(e,sa(this,e,n)),this};k.prototype.prependOnceListener=function(e,n){return zt(n),this.prependListener(e,sa(this,e,n)),this};k.prototype.removeListener=function(e,n){var s,r,i,a,o;if(zt(n),r=this._events,r===void 0)return this;if(s=r[e],s===void 0)return this;if(s===n||s.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,s.listener||n));else if(typeof s!="function"){for(i=-1,a=s.length-1;a>=0;a--)if(s[a]===n||s[a].listener===n){o=s[a].listener,i=a;break}if(i<0)return this;i===0?s.shift():Vd(s,i),s.length===1&&(r[e]=s[0]),r.removeListener!==void 0&&this.emit("removeListener",e,o||n)}return this};k.prototype.off=k.prototype.removeListener;k.prototype.removeAllListeners=function(e){var n,s,r;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[e]),this;if(arguments.length===0){var i=Object.keys(s),a;for(r=0;r<i.length;++r)a=i[r],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=s[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(r=n.length-1;r>=0;r--)this.removeListener(e,n[r]);return this};function ra(t,e,n){var s=t._events;if(s===void 0)return[];var r=s[e];return r===void 0?[]:typeof r=="function"?n?[r.listener||r]:[r]:n?Wd(r):aa(r,r.length)}k.prototype.listeners=function(e){return ra(this,e,!0)};k.prototype.rawListeners=function(e){return ra(this,e,!1)};k.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):ia.call(t,e)};k.prototype.listenerCount=ia;function ia(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}k.prototype.eventNames=function(){return this._eventsCount>0?Pt(this._events):[]};function aa(t,e){for(var n=new Array(e),s=0;s<e;++s)n[s]=t[s];return n}function Vd(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function Wd(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function Jd(t,e){return new Promise(function(n,s){function r(a){t.removeListener(e,i),s(a)}function i(){typeof t.removeListener=="function"&&t.removeListener("error",r),n([].slice.call(arguments))}oa(t,e,i,{once:!0}),e!=="error"&&jd(t,r,{once:!0})})}function jd(t,e,n){typeof t.on=="function"&&oa(t,"error",e,n)}function oa(t,e,n,s){if(typeof t.on=="function")s.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function r(i){s.once&&t.removeEventListener(e,r),n(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var Gd=is.exports,zd=typeof queueMicrotask=="function"?queueMicrotask:t=>Promise.resolve().then(t),Yd=class{constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return this.buffer[this.btm]===void 0}};const yr=Yd;var Xd=class{constructor(e){this.hwm=e||16,this.head=new yr(this.hwm),this.tail=this.head,this.length=0}clear(){this.head=this.tail,this.head.clear(),this.length=0}push(e){if(this.length++,!this.head.push(e)){const n=this.head;this.head=n.next=new yr(2*this.head.buffer.length),this.head.push(e)}}shift(){this.length!==0&&this.length--;const e=this.tail.shift();if(e===void 0&&this.tail.next){const n=this.tail.next;return this.tail.next=null,this.tail=n,this.tail.shift()}return e}peek(){const e=this.tail.peek();return e===void 0&&this.tail.next?this.tail.next.peek():e}isEmpty(){return this.length===0}},ca=class{constructor(e){this.decoder=new TextDecoder(e==="utf16le"?"utf16-le":e)}decode(e){return this.decoder.decode(e,{stream:!0})}flush(){return this.decoder.decode(new Uint8Array(0))}};const Qd=ca,Zd=ca;var ef=class{constructor(e="utf8"){switch(this.encoding=tf(e),this.encoding){case"utf8":this.decoder=new Zd;break;case"utf16le":case"base64":throw new Error("Unsupported encoding: "+this.encoding);default:this.decoder=new Qd(this.encoding)}}push(e){return typeof e=="string"?e:this.decoder.decode(e)}write(e){return this.push(e)}end(e){let n="";return e&&(n=this.push(e)),n+=this.decoder.flush(),n}};function tf(t){switch(t=t.toLowerCase(),t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:throw new Error("Unknown encoding: "+t)}}const{EventEmitter:nf}=Gd,Yt=new Error("Stream was destroyed"),yn=new Error("Premature close"),ua=zd,la=Xd,sf=ef,I=(1<<29)-1,De=1,as=2,Ne=4,st=8,da=I^De,rf=I^as,gt=16,rt=32,ze=64,pe=128,_t=256,os=512,Ie=1024,xn=2048,cs=4096,us=8192,Y=16384,qe=32768,Xt=65536,Oe=131072,fa=_t|os,af=gt|Xt,of=ze|gt,cf=cs|pe,ls=_t|Oe,uf=I^gt,lf=I^ze,df=I^(ze|Xt),Tr=I^Xt,ff=I^_t,hf=I^(pe|us),mf=I^Ie,Er=I^fa,ha=I^qe,pf=I^rt,ma=I^Oe,gf=I^ls,Se=1<<18,Ve=2<<18,yt=4<<18,ve=8<<18,Tt=16<<18,Pe=32<<18,Fn=64<<18,Ke=128<<18,ds=256<<18,We=512<<18,Qt=1024<<18,pa=I^(Se|ds),ga=I^yt,_f=I^We,yf=I^Tt,Tf=I^ve,_a=I^Ke,Ef=I^Ve,ya=I^Qt,it=gt|Se,Ta=I^it,fs=Y|Pe,ce=Ne|st|as,V=ce|De,Ea=ce|fs,Sf=ga&lf,hs=Ke|qe,wf=hs&Ta,Sa=V|wf,bf=V|Ie|Y,Sr=V|Y|pe,kf=V|Ie|pe,Rf=V|cs|pe|us,Cf=V|gt|Ie|Y|Xt|Oe,Af=ce|Ie|Y,Nf=rt|V|qe|ze,If=V|We|Pe,Of=ve|Tt,wa=ve|Se,vf=ve|Tt|V|Se,wr=V|Se|ve|Qt,Df=yt|Se,Pf=Se|ds,Lf=V|We|wa|Pe,Mf=Tt|ce|We|Pe,xf=Ve|V|Ke|yt,bt=Symbol.asyncIterator||Symbol("asyncIterator");class ba{constructor(e,{highWaterMark:n=16384,map:s=null,mapWritable:r,byteLength:i,byteLengthWritable:a}={}){this.stream=e,this.queue=new la,this.highWaterMark=n,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=a||i||Oa,this.map=r||s,this.afterWrite=Kf.bind(this),this.afterUpdateNextTick=Wf.bind(this)}get ended(){return(this.stream._duplexState&Pe)!==0}push(e){return this.map!==null&&(e=this.map(e)),this.buffered+=this.byteLength(e),this.queue.push(e),this.buffered<this.highWaterMark?(this.stream._duplexState|=ve,!0):(this.stream._duplexState|=Of,!1)}shift(){const e=this.queue.shift();return this.buffered-=this.byteLength(e),this.buffered===0&&(this.stream._duplexState&=Tf),e}end(e){typeof e=="function"?this.stream.once("finish",e):e!=null&&this.push(e),this.stream._duplexState=(this.stream._duplexState|We)&ga}autoBatch(e,n){const s=[],r=this.stream;for(s.push(e);(r._duplexState&wr)===wa;)s.push(r._writableState.shift());if(r._duplexState&V)return n(null);r._writev(s,n)}update(){const e=this.stream;e._duplexState|=Ve;do{for(;(e._duplexState&wr)===ve;){const n=this.shift();e._duplexState|=Pf,e._write(n,this.afterWrite)}e._duplexState&Df||this.updateNonPrimary()}while(this.continueUpdate()===!0);e._duplexState&=Ef}updateNonPrimary(){const e=this.stream;if((e._duplexState&Lf)===We){e._duplexState=(e._duplexState|Se)&_f,e._final(qf.bind(this));return}if((e._duplexState&ce)===Ne){e._duplexState&hs||(e._duplexState|=it,e._destroy(ka.bind(this)));return}(e._duplexState&Sa)===De&&(e._duplexState=(e._duplexState|it)&da,e._open(Ra.bind(this)))}continueUpdate(){return this.stream._duplexState&Ke?(this.stream._duplexState&=_a,!0):!1}updateCallback(){(this.stream._duplexState&xf)===yt?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&Ke||(this.stream._duplexState|=Ke,this.stream._duplexState&Ve||ua(this.afterUpdateNextTick))}}class Ff{constructor(e,{highWaterMark:n=16384,map:s=null,mapReadable:r,byteLength:i,byteLengthReadable:a}={}){this.stream=e,this.queue=new la,this.highWaterMark=n===0?1:n,this.buffered=0,this.readAhead=n>0,this.error=null,this.pipeline=null,this.byteLength=a||i||Oa,this.map=r||s,this.pipeTo=null,this.afterRead=$f.bind(this),this.afterUpdateNextTick=Vf.bind(this)}get ended(){return(this.stream._duplexState&Y)!==0}pipe(e,n){if(this.pipeTo!==null)throw new Error("Can only pipe to one destination");if(typeof n!="function"&&(n=null),this.stream._duplexState|=os,this.pipeTo=e,this.pipeline=new Bf(this.stream,e,n),n&&this.stream.on("error",br),ot(e))e._writableState.pipeline=this.pipeline,n&&e.on("error",br),e.on("finish",this.pipeline.finished.bind(this.pipeline));else{const s=this.pipeline.done.bind(this.pipeline,e),r=this.pipeline.done.bind(this.pipeline,e,null);e.on("error",s),e.on("close",r),e.on("finish",this.pipeline.finished.bind(this.pipeline))}e.on("drain",Hf.bind(this)),this.stream.emit("piping",e),e.emit("pipe",this.stream)}push(e){const n=this.stream;return e===null?(this.highWaterMark=0,n._duplexState=(n._duplexState|Ie)&df,!1):this.map!==null&&(e=this.map(e),e===null)?(n._duplexState&=Tr,this.buffered<this.highWaterMark):(this.buffered+=this.byteLength(e),this.queue.push(e),n._duplexState=(n._duplexState|pe)&Tr,this.buffered<this.highWaterMark)}shift(){const e=this.queue.shift();return this.buffered-=this.byteLength(e),this.buffered===0&&(this.stream._duplexState&=hf),e}unshift(e){const n=[this.map!==null?this.map(e):e];for(;this.buffered>0;)n.push(this.shift());for(let s=0;s<n.length-1;s++){const r=n[s];this.buffered+=this.byteLength(r),this.queue.push(r)}this.push(n[n.length-1])}read(){const e=this.stream;if((e._duplexState&Sr)===pe){const n=this.shift();return this.pipeTo!==null&&this.pipeTo.write(n)===!1&&(e._duplexState&=Er),e._duplexState&xn&&e.emit("data",n),n}return this.readAhead===!1&&(e._duplexState|=Oe,this.updateNextTick()),null}drain(){const e=this.stream;for(;(e._duplexState&Sr)===pe&&e._duplexState&fa;){const n=this.shift();this.pipeTo!==null&&this.pipeTo.write(n)===!1&&(e._duplexState&=Er),e._duplexState&xn&&e.emit("data",n)}}update(){const e=this.stream;e._duplexState|=rt;do{for(this.drain();this.buffered<this.highWaterMark&&(e._duplexState&Cf)===Oe;)e._duplexState|=af,e._read(this.afterRead),this.drain();(e._duplexState&Rf)===cf&&(e._duplexState|=us,e.emit("readable")),e._duplexState&of||this.updateNonPrimary()}while(this.continueUpdate()===!0);e._duplexState&=pf}updateNonPrimary(){const e=this.stream;if((e._duplexState&kf)===Ie&&(e._duplexState=(e._duplexState|Y)&mf,e.emit("end"),(e._duplexState&Ea)===fs&&(e._duplexState|=Ne),this.pipeTo!==null&&this.pipeTo.end()),(e._duplexState&ce)===Ne){e._duplexState&hs||(e._duplexState|=it,e._destroy(ka.bind(this)));return}(e._duplexState&Sa)===De&&(e._duplexState=(e._duplexState|it)&da,e._open(Ra.bind(this)))}continueUpdate(){return this.stream._duplexState&qe?(this.stream._duplexState&=ha,!0):!1}updateCallback(){(this.stream._duplexState&Nf)===ze?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&qe||(this.stream._duplexState|=qe,this.stream._duplexState&rt||ua(this.afterUpdateNextTick))}}class Uf{constructor(e){this.data=null,this.afterTransform=jf.bind(e),this.afterFinal=null}}class Bf{constructor(e,n,s){this.from=e,this.to=n,this.afterPipe=s,this.error=null,this.pipeToFinished=!1}finished(){this.pipeToFinished=!0}done(e,n){if(n&&(this.error=n),e===this.to&&(this.to=null,this.from!==null)){(!(this.from._duplexState&Y)||!this.pipeToFinished)&&this.from.destroy(this.error||new Error("Writable stream closed prematurely"));return}if(e===this.from&&(this.from=null,this.to!==null)){e._duplexState&Y||this.to.destroy(this.error||new Error("Readable stream closed before ending"));return}this.afterPipe!==null&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null}}function Hf(){this.stream._duplexState|=os,this.updateCallback()}function qf(t){const e=this.stream;t&&e.destroy(t),e._duplexState&ce||(e._duplexState|=Pe,e.emit("finish")),(e._duplexState&Ea)===fs&&(e._duplexState|=Ne),e._duplexState&=pa,e._duplexState&Ve?this.updateNextTick():this.update()}function ka(t){const e=this.stream;!t&&this.error!==Yt&&(t=this.error),t&&e.emit("error",t),e._duplexState|=st,e.emit("close");const n=e._readableState,s=e._writableState;if(n!==null&&n.pipeline!==null&&n.pipeline.done(e,t),s!==null){for(;s.drains!==null&&s.drains.length>0;)s.drains.shift().resolve(!1);s.pipeline!==null&&s.pipeline.done(e,t)}}function Kf(t){const e=this.stream;t&&e.destroy(t),e._duplexState&=pa,this.drains!==null&&Jf(this.drains),(e._duplexState&vf)===Tt&&(e._duplexState&=yf,(e._duplexState&Fn)===Fn&&e.emit("drain")),this.updateCallback()}function $f(t){t&&this.stream.destroy(t),this.stream._duplexState&=uf,this.readAhead===!1&&!(this.stream._duplexState&_t)&&(this.stream._duplexState&=ma),this.updateCallback()}function Vf(){this.stream._duplexState&rt||(this.stream._duplexState&=ha,this.update())}function Wf(){this.stream._duplexState&Ve||(this.stream._duplexState&=_a,this.update())}function Jf(t){for(let e=0;e<t.length;e++)--t[e].writes===0&&(t.shift().resolve(!0),e--)}function Ra(t){const e=this.stream;t&&e.destroy(t),e._duplexState&Ne||(e._duplexState&bf||(e._duplexState|=ze),e._duplexState&If||(e._duplexState|=yt),e.emit("open")),e._duplexState&=Ta,e._writableState!==null&&e._writableState.updateCallback(),e._readableState!==null&&e._readableState.updateCallback()}function jf(t,e){e!=null&&this.push(e),this._writableState.afterWrite(t)}function Gf(t){this._readableState!==null&&(t==="data"&&(this._duplexState|=xn|ls,this._readableState.updateNextTick()),t==="readable"&&(this._duplexState|=cs,this._readableState.updateNextTick())),this._writableState!==null&&t==="drain"&&(this._duplexState|=Fn,this._writableState.updateNextTick())}class ms extends nf{constructor(e){super(),this._duplexState=0,this._readableState=null,this._writableState=null,e&&(e.open&&(this._open=e.open),e.destroy&&(this._destroy=e.destroy),e.predestroy&&(this._predestroy=e.predestroy),e.signal&&e.signal.addEventListener("abort",rh.bind(this))),this.on("newListener",Gf)}_open(e){e(null)}_destroy(e){e(null)}_predestroy(){}get readable(){return this._readableState!==null?!0:void 0}get writable(){return this._writableState!==null?!0:void 0}get destroyed(){return(this._duplexState&st)!==0}get destroying(){return(this._duplexState&ce)!==0}destroy(e){this._duplexState&ce||(e||(e=Yt),this._duplexState=(this._duplexState|Ne)&Sf,this._readableState!==null&&(this._readableState.highWaterMark=0,this._readableState.error=e),this._writableState!==null&&(this._writableState.highWaterMark=0,this._writableState.error=e),this._duplexState|=as,this._predestroy(),this._duplexState&=rf,this._readableState!==null&&this._readableState.updateNextTick(),this._writableState!==null&&this._writableState.updateNextTick())}}class at extends ms{constructor(e){super(e),this._duplexState|=De|Pe|Oe,this._readableState=new Ff(this,e),e&&(this._readableState.readAhead===!1&&(this._duplexState&=ma),e.read&&(this._read=e.read),e.eagerOpen&&this._readableState.updateNextTick(),e.encoding&&this.setEncoding(e.encoding))}setEncoding(e){const n=new sf(e),s=this._readableState.map||Qf;return this._readableState.map=r,this;function r(i){const a=n.push(i);return a===""?null:s(a)}}_read(e){e(null)}pipe(e,n){return this._readableState.updateNextTick(),this._readableState.pipe(e,n),e}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(e){return this._readableState.updateNextTick(),this._readableState.push(e)}unshift(e){return this._readableState.updateNextTick(),this._readableState.unshift(e)}resume(){return this._duplexState|=ls,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=this._readableState.readAhead===!1?gf:ff,this}static _fromAsyncIterator(e,n){let s;const r=new at({...n,read(a){e.next().then(i).then(a.bind(null,null)).catch(a)},predestroy(){s=e.return()},destroy(a){if(!s)return a(null);s.then(a.bind(null,null)).catch(a)}});return r;function i(a){a.done?r.push(null):r.push(a.value)}}static from(e,n){if(nh(e))return e;if(e[bt])return this._fromAsyncIterator(e[bt](),n);Array.isArray(e)||(e=e===void 0?[]:[e]);let s=0;return new at({...n,read(r){this.push(s===e.length?null:e[s++]),r(null)}})}static isBackpressured(e){return(e._duplexState&Af)!==0||e._readableState.buffered>=e._readableState.highWaterMark}static isPaused(e){return(e._duplexState&_t)===0}[bt](){const e=this;let n=null,s=null,r=null;return this.on("error",l=>{n=l}),this.on("readable",i),this.on("close",a),{[bt](){return this},next(){return new Promise(function(l,c){s=l,r=c;const d=e.read();d!==null?o(d):e._duplexState&st&&o(null)})},return(){return u(null)},throw(l){return u(l)}};function i(){s!==null&&o(e.read())}function a(){s!==null&&o(null)}function o(l){r!==null&&(n?r(n):l===null&&!(e._duplexState&Y)?r(Yt):s({value:l,done:l===null}),r=s=null)}function u(l){return e.destroy(l),new Promise((c,d)=>{if(e._duplexState&st)return c({value:void 0,done:!0});e.once("close",function(){l?d(l):c({value:void 0,done:!0})})})}}}class Ca extends ms{constructor(e){super(e),this._duplexState|=De|Y,this._writableState=new ba(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final),e.eagerOpen&&this._writableState.updateNextTick())}cork(){this._duplexState|=Qt}uncork(){this._duplexState&=ya,this._writableState.updateNextTick()}_writev(e,n){n(null)}_write(e,n){this._writableState.autoBatch(e,n)}_final(e){e(null)}static isBackpressured(e){return(e._duplexState&Mf)!==0}static drained(e){if(e.destroyed)return Promise.resolve(!1);const n=e._writableState,r=(ih(e)?Math.min(1,n.queue.length):n.queue.length)+(e._duplexState&ds?1:0);return r===0?Promise.resolve(!0):(n.drains===null&&(n.drains=[]),new Promise(i=>{n.drains.push({writes:r,resolve:i})}))}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}class ps extends at{constructor(e){super(e),this._duplexState=De|this._duplexState&Oe,this._writableState=new ba(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final))}cork(){this._duplexState|=Qt}uncork(){this._duplexState&=ya,this._writableState.updateNextTick()}_writev(e,n){n(null)}_write(e,n){this._writableState.autoBatch(e,n)}_final(e){e(null)}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}class Aa extends ps{constructor(e){super(e),this._transformState=new Uf(this),e&&(e.transform&&(this._transform=e.transform),e.flush&&(this._flush=e.flush))}_write(e,n){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=e:this._transform(e,this._transformState.afterTransform)}_read(e){if(this._transformState.data!==null){const n=this._transformState.data;this._transformState.data=null,e(null),this._transform(n,this._transformState.afterTransform)}else e(null)}destroy(e){super.destroy(e),this._transformState.data!==null&&(this._transformState.data=null,this._transformState.afterTransform())}_transform(e,n){n(null,e)}_flush(e){e(null)}_final(e){this._transformState.afterFinal=e,this._flush(Yf.bind(this))}}class zf extends Aa{}function Yf(t,e){const n=this._transformState.afterFinal;if(t)return n(t);e!=null&&this.push(e),this.push(null),n(null)}function Xf(...t){return new Promise((e,n)=>Na(...t,s=>{if(s)return n(s);e()}))}function Na(t,...e){const n=Array.isArray(t)?[...t,...e]:[t,...e],s=n.length&&typeof n[n.length-1]=="function"?n.pop():null;if(n.length<2)throw new Error("Pipeline requires at least 2 streams");let r=n[0],i=null,a=null;for(let l=1;l<n.length;l++)i=n[l],ot(r)?r.pipe(i,u):(o(r,!0,l>1,u),r.pipe(i)),r=i;if(s){let l=!1;const c=ot(i)||!!(i._writableState&&i._writableState.autoDestroy);i.on("error",d=>{a===null&&(a=d)}),i.on("finish",()=>{l=!0,c||s(a)}),c&&i.on("close",()=>s(a||(l?null:yn)))}return i;function o(l,c,d,h){l.on("error",h),l.on("close",E);function E(){if(c&&l._readableState&&!l._readableState.ended||d&&l._writableState&&!l._writableState.ended)return h(yn)}}function u(l){if(!(!l||a)){a=l;for(const c of n)c.destroy(l)}}}function Qf(t){return t}function Ia(t){return!!t._readableState||!!t._writableState}function ot(t){return typeof t._duplexState=="number"&&Ia(t)}function Zf(t){return!!t._readableState&&t._readableState.ended}function eh(t){return!!t._writableState&&t._writableState.ended}function th(t,e={}){const n=t._readableState&&t._readableState.error||t._writableState&&t._writableState.error;return!e.all&&n===Yt?null:n}function nh(t){return ot(t)&&t.readable}function sh(t){return typeof t=="object"&&t!==null&&typeof t.byteLength=="number"}function Oa(t){return sh(t)?t.byteLength:1024}function br(){}function rh(){this.destroy(new Error("Stream aborted."))}function ih(t){return t._writev!==Ca.prototype._writev&&t._writev!==ps.prototype._writev}var ah={pipeline:Na,pipelinePromise:Xf,isStream:Ia,isStreamx:ot,isEnded:Zf,isFinished:eh,getStreamError:th,Stream:ms,Writable:Ca,Readable:at,Duplex:ps,Transform:Aa,PassThrough:zf};function kr(t,e){for(const n in e)Object.defineProperty(t,n,{value:e[n],enumerable:!0,configurable:!0});return t}function oh(t,e,n){if(!t||typeof t=="string")throw new TypeError("Please pass an Error to err-code");n||(n={}),typeof e=="object"&&(n=e,e=""),e&&(n.code=e);try{return kr(t,n)}catch{n.message=t.message,n.stack=t.stack;const r=function(){};return r.prototype=Object.create(Object.getPrototypeOf(t)),kr(new r,n)}}var ch=oh;const b=qn(ch);/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wärting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const Rr="0123456789abcdef",va=[];for(let t=0;t<256;t++)va[t]=Rr[t>>4&15]+Rr[t&15];const Cr=t=>{const e=t.length;let n="",s=0;for(;s<e;)n+=va[t[s++]];return n};var Ar="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",uh=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var kt=0;kt<Ar.length;kt++)uh[Ar.charCodeAt(kt)]=kt;new TextDecoder;const lh=new TextEncoder,dh=t=>lh.encode(t),Nr=typeof window<"u"?window:self,Un=Nr.crypto||Nr.msCrypto||{};Un.subtle||Un.webkitSubtle;const Ir=t=>{const e=new Uint8Array(t);return Un.getRandomValues(e)};/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const fh=Bd("simple-peer"),Tn=64*1024,hh=5*1e3,mh=5*1e3;function Or(t){return t.replace(/a=ice-options:trickle\s\n/g,"")}function ph(t){console.warn(t)}let Zt=class Bn extends ah.Duplex{constructor(n){n=Object.assign({allowHalfOpen:!1},n);super(n);T(this,"_pc");if(this.__objectMode=!!n.objectMode,this._id=Cr(Ir(4)).slice(0,7),this._debug("new peer %o",n),this.channelName=n.initiator?n.channelName||Cr(Ir(20)):null,this.initiator=n.initiator||!1,this.channelConfig=n.channelConfig||Bn.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},Bn.config,n.config),this.offerOptions=n.offerOptions||{},this.answerOptions=n.answerOptions||{},this.sdpTransform=n.sdpTransform||(s=>s),this.trickle=n.trickle!==void 0?n.trickle:!0,this.allowHalfTrickle=n.allowHalfTrickle!==void 0?n.allowHalfTrickle:!1,this.iceCompleteTimeout=n.iceCompleteTimeout||hh,this._destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,!Mn)throw b(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new Mn(this.config)}catch(s){this.__destroy(b(s,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=s=>{this._onIceCandidate(s)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(s=>{this.__destroy(b(s,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=s=>{this._setupData(s)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(n){if(!this._destroying){if(this.destroyed)throw b(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof n=="string")try{n=JSON.parse(n)}catch{n={}}this._debug("signal()"),n.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),n.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(n.transceiverRequest.kind,n.transceiverRequest.init)),n.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(n.candidate):this._pendingCandidates.push(n.candidate)),n.sdp&&this._pc.setRemoteDescription(new Hd(n)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(s=>{this._addIceCandidate(s)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(s=>{this.__destroy(b(s,"ERR_SET_REMOTE_DESCRIPTION"))}),!n.sdp&&!n.candidate&&!n.renegotiate&&!n.transceiverRequest&&this.__destroy(b(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(n){const s=new qd(n);this._pc.addIceCandidate(s).catch(r=>{!s.address||s.address.endsWith(".local")?ph("Ignoring unsupported ICE candidate."):this.__destroy(b(r,"ERR_ADD_ICE_CANDIDATE"))})}send(n){if(!this._destroying){if(this.destroyed)throw b(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(n)}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,queueMicrotask(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this._destroying){if(this.destroyed)throw b(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}_final(n){this._readableState.ended||this.push(null),n(null)}__destroy(n){this.end(),this._destroy(()=>{},n)}_destroy(n,s){this.destroyed||this._destroying||(this._destroying=!0,this._debug("destroying (error: %s)",s&&(s.message||s)),setTimeout(()=>{if(this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,s&&this.emit("error",s),n()},0))}_setupData(n){if(!n.channel)return this.__destroy(b(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=n.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=Tn),this.channelName=this._channel.label,this._channel.onmessage=r=>{this._onChannelMessage(r)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=r=>{const i=r.error instanceof Error?r.error:new Error(`Datachannel error: ${r.message} ${r.filename}:${r.lineno}:${r.colno}`);this.__destroy(b(i,"ERR_DATA_CHANNEL"))};let s=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(s&&this._onChannelClose(),s=!0):s=!1},mh)}_write(n,s){if(this.destroyed)return s(b(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(n)}catch(r){return this.__destroy(b(r,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>Tn?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=s):s(null)}else this._debug("write before connect"),this._chunk=n,this._cb=s}_onFinish(){if(this.destroyed)return;const n=()=>{setTimeout(()=>this.__destroy(),1e3)};this._connected?n():this.once("connect",n)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(n=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(n.sdp=Or(n.sdp)),n.sdp=this.sdpTransform(n.sdp);const s=()=>{if(this.destroyed)return;const a=this._pc.localDescription||n;this._debug("signal"),this.emit("signal",{type:a.type,sdp:a.sdp})},r=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?s():this.once("_iceComplete",s))},i=a=>{this.__destroy(b(a,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(n).then(r).catch(i)}).catch(n=>{this.__destroy(b(n,"ERR_CREATE_OFFER"))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(n=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(n.sdp=Or(n.sdp)),n.sdp=this.sdpTransform(n.sdp);const s=()=>{var o;if(this.destroyed)return;const a=this._pc.localDescription||n;this._debug("signal"),this.emit("signal",{type:a.type,sdp:a.sdp}),this.initiator||(o=this._requestMissingTransceivers)==null||o.call(this)},r=()=>{this.destroyed||(this.trickle||this._iceComplete?s():this.once("_iceComplete",s))},i=a=>{this.__destroy(b(a,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(n).then(r).catch(i)}).catch(n=>{this.__destroy(b(n,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._destroying||this._pc.connectionState==="failed"&&this.__destroy(b(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const n=this._pc.iceConnectionState,s=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",n,s),this.emit("iceStateChange",n,s),(n==="connected"||n==="completed")&&(this._pcReady=!0,this._maybeReady()),n==="failed"&&this.__destroy(b(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),n==="closed"&&this.__destroy(b(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(n){const s=r=>(Object.prototype.toString.call(r.values)==="[object Array]"&&r.values.forEach(i=>{Object.assign(r,i)}),r);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(r=>{const i=[];r.forEach(a=>{i.push(s(a))}),n(null,i)},r=>n(r)):this._pc.getStats.length>0?this._pc.getStats(r=>{if(this.destroyed)return;const i=[];r.result().forEach(a=>{const o={};a.names().forEach(u=>{o[u]=a.stat(u)}),o.id=a.id,o.type=a.type,o.timestamp=a.timestamp,i.push(s(o))}),n(null,i)},r=>n(r)):n(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const n=()=>{this.destroyed||this._destroying||this.getStats((s,r)=>{if(this.destroyed||this._destroying)return;s&&(r=[]);const i={},a={},o={};let u=!1;r.forEach(c=>{(c.type==="remotecandidate"||c.type==="remote-candidate")&&(i[c.id]=c),(c.type==="localcandidate"||c.type==="local-candidate")&&(a[c.id]=c),(c.type==="candidatepair"||c.type==="candidate-pair")&&(o[c.id]=c)});const l=c=>{u=!0;let d=a[c.localCandidateId];d&&(d.ip||d.address)?(this.localAddress=d.ip||d.address,this.localPort=Number(d.port)):d&&d.ipAddress?(this.localAddress=d.ipAddress,this.localPort=Number(d.portNumber)):typeof c.googLocalAddress=="string"&&(d=c.googLocalAddress.split(":"),this.localAddress=d[0],this.localPort=Number(d[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let h=i[c.remoteCandidateId];h&&(h.ip||h.address)?(this.remoteAddress=h.ip||h.address,this.remotePort=Number(h.port)):h&&h.ipAddress?(this.remoteAddress=h.ipAddress,this.remotePort=Number(h.portNumber)):typeof c.googRemoteAddress=="string"&&(h=c.googRemoteAddress.split(":"),this.remoteAddress=h[0],this.remotePort=Number(h[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(r.forEach(c=>{c.type==="transport"&&c.selectedCandidatePairId&&l(o[c.selectedCandidatePairId]),(c.type==="googCandidatePair"&&c.googActiveConnection==="true"||(c.type==="candidatepair"||c.type==="candidate-pair")&&c.selected)&&l(c)}),!u&&(!Object.keys(o).length||Object.keys(a).length)){setTimeout(n,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(d){return this.__destroy(b(d,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const c=this._cb;this._cb=null,c(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};n()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>Tn||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(n=>{this._pc.removeTrack(n),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(n){this.destroyed||(n.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:n.candidate.candidate,sdpMLineIndex:n.candidate.sdpMLineIndex,sdpMid:n.candidate.sdpMid}}):!n.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),n.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(n){if(this.destroyed)return;let s=n.data;s instanceof ArrayBuffer?s=new Uint8Array(s):this.__objectMode===!1&&(s=dh(s)),this.push(s)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const n=this._cb;this._cb=null,n(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.__destroy())}_debug(){const n=[].slice.call(arguments);n[0]="["+this._id+"] "+n[0],fh.apply(null,n)}};Zt.WEBRTC_SUPPORT=!!Mn;Zt.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};Zt.channelConfig={};/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */class vr extends Zt{constructor(e={}){super(e),this._pc&&(this.streams=e.streams||(e.stream?[e.stream]:[]),this._senderMap=new Map,this.streams&&this.streams.forEach(n=>{this.addStream(n)}),this._pc.ontrack=n=>{this._onTrack(n)})}addTransceiver(e,n){if(!this._destroying){if(this.destroyed)throw b(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,n),this._needsNegotiation()}catch(s){this.__destroy(b(s,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:n}})}}addStream(e){if(!this._destroying){if(this.destroyed)throw b(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach(n=>{this.addTrack(n,e)})}}addTrack(e,n){if(this._destroying)return;if(this.destroyed)throw b(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const s=this._senderMap.get(e)||new Map;let r=s.get(n);if(!r)r=this._pc.addTrack(e,n),s.set(n,r),this._senderMap.set(e,s),this._needsNegotiation();else throw r.removed?b(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):b(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(e,n,s){if(this._destroying)return;if(this.destroyed)throw b(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const r=this._senderMap.get(e),i=r?r.get(s):null;if(!i)throw b(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");n&&this._senderMap.set(n,r),i.replaceTrack!=null?i.replaceTrack(n):this.__destroy(b(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,n){if(this._destroying)return;if(this.destroyed)throw b(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const s=this._senderMap.get(e),r=s?s.get(n):null;if(!r)throw b(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{r.removed=!0,this._pc.removeTrack(r)}catch(i){i.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(r):this.__destroy(b(i,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){if(!this._destroying){if(this.destroyed)throw b(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach(n=>{this.removeTrack(n,e)})}}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(e=>{!e.mid&&e.sender.track&&!e.requested&&(e.requested=!0,this.addTransceiver(e.sender.track.kind))})}_onTrack(e){this.destroyed||e.streams.forEach(n=>{this._debug("on track"),this.emit("track",e.track,n),this._remoteTracks.push({track:e.track,stream:n}),!this._remoteStreams.some(s=>s.id===n.id)&&(this._remoteStreams.push(n),queueMicrotask(()=>{this._debug("on stream"),this.emit("stream",n)}))})}}let En=0;class gh{constructor(){T(this,"lastMsgRecivedTimestamp");T(this,"connectionState",me(N.init));T(this,"latestRecivedDataMessage",me(null));T(this,"outgoingSignalingMessages",me(null));T(this,"remoteVideoStreams",me(new Map));T(this,"_p");T(this,"_spConfig",null);T(this,"_msgSendQueue",[]);T(this,"_reconnectAttemptCount");T(this,"_shouldReconnect");T(this,"_initiator",!1);T(this,"_connectionId",-1);T(this,"_signalMsgSendCounter",0);T(this,"_signalMsgRecivedCounter",0);T(this,"_StatsGatherInterval")}start(e,n=!0,s=0){this._shouldReconnect=n,this._spConfig=Object.assign({},e,vr.config),G("SP starting with opts: ",this._spConfig),this._spConfig.initiator&&(this._connectionId=En++),this._p=new vr(this._spConfig),this._p._debug=(...r)=>G("SIMPLEPEER DEBUG: "+r[0],...r.slice(1)),this._reconnectAttemptCount=s,this._initiator=this._spConfig.initiator||!1,this.connectionState.set(N.connecting),this._p.on("signal",r=>{if(this._signalMsgSendCounter++,this._connectionId===-1)return K("SP sending signal message when connectionId is null, this should not happen!");r=Object.assign({},r,{connId:this._connectionId,msgNum:this._signalMsgSendCounter}),G("SP signal out",r),this.outgoingSignalingMessages.set(JSON.stringify(r))}),this._p.on("connect",()=>{J("SP Connected"),this._emptyMsgQueue(),this._reconnectAttemptCount=0,this.connectionState.set(N.connected)}),this._p.on("data",r=>{this.lastMsgRecivedTimestamp=Date.now(),this.latestRecivedDataMessage.set(r)}),this._p.on("stream",r=>{J("SP got video stream: ",r),this.remoteVideoStreams.update(i=>(i.set(r.id,r),i))}),this._p.on("close",()=>{K("SP connection closed"),this.stop()}),this._p.on("error",r=>{this.resetConnectionStats(),B("SP error ",r),this.remoteVideoStreams.set(new Map),this._shouldReconnect=!1,clearInterval(this._StatsGatherInterval),this.connectionState.set(N.failed)})}resetConnectionStats(){this._connectionId=-1,this._signalMsgRecivedCounter=0,this._signalMsgSendCounter=0}stop(){var e,n;G("SP Stop",this._connectionId,En,(e=this._p)==null?void 0:e.destroyed,(n=this._p)==null?void 0:n.destroying),this.resetConnectionStats(),this.connectionState.set(N.disconnectedOk),this.remoteVideoStreams.set(new Map),this._shouldReconnect=!1,clearInterval(this._StatsGatherInterval),this._p&&this._p.destroy()}restart(e,n){var s,r;G("SP Restart",this._connectionId,En,(s=this._p)==null?void 0:s.destroyed,(r=this._p)==null?void 0:r.destroying),this.stop(),this._connectionId=e||-1,this.start(this._spConfig,this._shouldReconnect,this._reconnectAttemptCount),n&&this.ingestSignalingMsg(n)}ingestSignalingMsg(e){try{const n=JSON.parse(e);if(J("SP signal in",n,n.connId,this._connectionId),this._p.destroyed)return this.restart(n.connId,e);if(this._connectionId===-1)this._connectionId=n.connId;else if(n.connId<this._connectionId){R("SP Err Older Remote ConnId!",n.connId,"<",this._connectionId);return}else if(n.connId>this._connectionId){this._initiator?R("SP Err Newer Remote ConnId!",n.connId,">",this._connectionId):this.restart(n.connId,e);return}if(n.msgNum<=this._signalMsgRecivedCounter){R("SP Invalid MsgNum Order!",n.msgNum,"<=",this._signalMsgRecivedCounter);return}this._signalMsgRecivedCounter=n.msgNum,this._p.signal(n)}catch(n){K("failed to parse & ingest simplepeer signalling message: ",e,n.message)}}sendMessage(e){this._msgSendQueue.push(e),this._emptyMsgQueue()}_emptyMsgQueue(){if(!this._p||!this._p.connected)return!1;for(this._msgSendQueue.length;this._msgSendQueue.length>0;){const e=this._msgSendQueue.shift();try{this._p.send(e)}catch(n){B("failed to send message over simplepeer data channel: ",n.message),this._msgSendQueue.unshift(e)}}}}class _h{constructor(){T(this,"_twitchStreamKey");T(this,"_egressClient");T(this,"roomName");T(this,"streamEgressID")}init(e,n,s,r){this.roomName=n,this._twitchStreamKey=e,this._egressClient=new Ou("https://rov-web.livekit.cloud",s,r)}async listRunningEgress(){if(!this._egressClient)throw new Error("Egress client not initialized!");return await this._egressClient.listEgress({active:!0})}isAnotherEgressRunning(e){return e.filter(n=>!this.streamEgressID||n.egressId!=this.streamEgressID).length>0}getCurrentEgress(e){return e.find(n=>n.roomName==this.roomName)}async closeOtherEgresses(e){return this._egressClient?Promise.allSettled(e.filter(n=>!this.streamEgressID||n.egressId!==this.streamEgressID).map(async n=>!this._egressClient||!n.egressId?!1:(R("Closing egress: ",n),await this._egressClient.stopEgress(n.egressId)))):!1}async startStream(){if(!this._twitchStreamKey||!this._egressClient||!this.roomName)return K("startStream() err: Twitch stream key not set or twitchStream class not initilized!");let e=await this.listRunningEgress(),n=this.getCurrentEgress(e);if(n!==void 0){R("Found current twitch egress: ",n),this.streamEgressID=n.egressId;return}else{for(;await this.isAnotherEgressRunning(e)==!0;){const i=await this.closeOtherEgresses(e);if(J("egressCloseStates",i),R("Another twitch stream is running, waiting 2 seconds to try again..."),await ct(2e3),e=await this.listRunningEgress(),n=this.getCurrentEgress(e),n!==void 0){R("Found current twitch egress: ",n),this.streamEgressID=n.egressId;return}}const r=new Ee({protocol:fi.RTMP,urls:["rtmp://live.twitch.tv/app/"+this._twitchStreamKey]});var s=await this._egressClient.startRoomCompositeEgress(this.roomName,r);this.streamEgressID=s.egressId,J("Twitch stream started: ",s),e=await this.listRunningEgress(),R("Egress list: ",e)}}async stopStream(){if(!this.streamEgressID||!this._egressClient)return K("stopStream() err: Twitch Stream not started!");const e=await this._egressClient.stopEgress(this.streamEgressID);J("Twitch stream stopped: ",e)}}const Hn=new _h;class yh{constructor(){T(this,"_cloudLivekitConnection",new ju);T(this,"_simplePeerConnections",{});T(this,"_cameraMediaStream",null);this._cloudLivekitConnection.init({hostUrl:A.LIVEKIT_CLOUD_ENDPOINT,publishVideo:!0,reconnectAttempts:300,roomConnectionConfig:Va,roomConfig:Wa,tokenEncryptionPassword:A.ROV_CONTROL_PASSWORD}),Ye(this._cloudLivekitConnection.latestRecivedDataMessage,e=>{if(!e)return;const{senderId:n,msg:s}=e;mr(n,s)}),Ye(this._cloudLivekitConnection.connectionState,e=>{R("Cloud Conn State Changed: "+e),e==N.connected&&Hn.startStream()}),Ye(this._cloudLivekitConnection.participantConnectionEvents,e=>{R("Cloud Conn Participant Event: ",e)})}async cameraReady(e){this._cameraMediaStream=e,this._cloudLivekitConnection&&this._cloudLivekitConnection.connectionState.get()==N.connected&&this._cameraMediaStream&&await this._cloudLivekitConnection._roomConn.localParticipant.setCameraEnabled(!0)}async start(e){let n=this._cloudLivekitConnection.connectionState.get();e.LivekitCloudURL&&this._cloudLivekitConnection.connectionState.subscribe(s=>{s===N.failed||s===N.init?(J("Creating & Starting Livekit Room: "+e.RovName),ys(this._cloudLivekitConnection.startRoom,this._cloudLivekitConnection,10,1e3,1.3)(e.RovName,e.APIKey,e.SecretKey).catch(i=>{B(i),R("Too many errors: Triggering Page Reload"),window.location.reload()})):s===N.connected&&n!==N.init&&this._cloudLivekitConnection.updateMetadataTokens(),n=s}),ys(navigator.mediaDevices.getUserMedia,navigator.mediaDevices,10,1e3,1.3)({video:{width:1920,height:1080,frameRate:60,facingMode:"environment"},audio:!1}).then(this.cameraReady.bind(this)).catch(s=>{B(s),window.location.reload()}),J("Connection Manager Started"),await za(()=>this._cloudLivekitConnection&&this._cloudLivekitConnection.connectionState&&this._cloudLivekitConnection.connectionState.get()===N.connected)}async startSimplePeerConnection(e,n){this._simplePeerConnections[e]&&(this._simplePeerConnections[e].stop(),delete this._simplePeerConnections[e]);const s=new gh;Ye(s.latestRecivedDataMessage,r=>{r&&mr(e,r)}),Ye(s.outgoingSignalingMessages,r=>{this.sendMessage({SimplepeerSignal:{Message:r}},!0,[e])}),await s.start(Object.assign({},Ja,{initiator:!1,streams:[this._cameraMediaStream]}),!1),this._simplePeerConnections[e]=s,n&&s.ingestSignalingMsg(n)}async ingestSimplePeerSignallingMsg(e,n){const s=this._simplePeerConnections[e];s?[N.failed,N.disconnectedOk].includes(s.connectionState.get())?(R("SP: Reconnecting to "+e+" after signalling message received connectionState: "+s.connectionState.get()),await this.startSimplePeerConnection(e,n)):s.ingestSignalingMsg(n):await this.startSimplePeerConnection(e,n)}async _sendMessageViaLivekit(e,n,s){await this._cloudLivekitConnection.sendMessage(e,n,s)}async sendMessage(e,n,s){if(!e)return!1;if(this._cloudLivekitConnection.connectionState.get()!==N.connected)return A.DEBUG_MODE&&G("LK: Message Not Sent, Livekit Not Connected"),!1;A.DEBUG_MODE&&G("LK/SP: "+(s.length==0?"Broadcasting msg ":"Sending msg to ["+s.join(", ")+"]")+(n?"reliably":"unreliably")+":",e),e.BackendMetadata=new U.ResponseBackendMetadata({});const r=U.RovResponse.encode(e).finish(),i=s;return await this._cloudLivekitConnection.sendMessage(r,n,i),!0}}const ee=new yh,Th="/system-information";async function Eh(){return Zi({method:"get",url:`${A.BLUEOS_APIS_ENDPOINT+Th}/system`,timeout:1e4}).then(t=>t.data).catch(t=>{const e=`Could not fetch blueos system info: ${t.message}`;return logWarn(e),e})}function Sh(t){const e=[],n=t?t.map(s=>s.usage).reduce((s,r)=>s+r,0)/t.length:0;return n>90&&e.push(`Rov CPU is nearly maxed out: ${n}%`),{value:n,warnings:e}}function wh(t){const e=t==null?void 0:t.find(o=>o.mount_point==="/");function n(o){const u=o?o.available_space_B/1073741824:0,l=o?o.total_space_B/2**30:0;return[l-u,l]}const[s,r]=n(e),i=100*s/r,a=i>95?[`Disk/SD Card is almost full: ${Math.round(s*10)/10}/${Math.round(s*10)/10}GB Used`]:[];return{value:i,warnings:a}}function bh(t){var u,l,c,d;const e=[],n=((u=t==null?void 0:t.ram)==null?void 0:u.used_kB)??0,s=((l=t==null?void 0:t.ram)==null?void 0:l.total_kB)??0,r=100*n/s,i=((c=t==null?void 0:t.swap)==null?void 0:c.used_kB)??0,a=((d=t==null?void 0:t.swap)==null?void 0:d.total_kB)??0,o=100*i/a;return r>90&&e.push(`RAM is almost full (${n} / ${s})`),o>90&&e.push(`Linux SWAP space is almost full (${i} / ${a})`),{value:r,warnings:e}}function kh(t){const e=t==null?void 0:t.find(r=>r.name==="CPU"),n=e?e.temperature:0,s=t?t.filter(r=>{const i=r.critical_temperature||1/0;return r.temperature>i}).map(r=>`Critical temperature reached in ${r.name}: ${r.temperature}°C`):[];return{value:n,warnings:s}}Object.assign(window,{getLongTermStarterAccessToken:Hu});const Da=(t,e)=>new Promise(async n=>{try{const s=U.RovResponse.create({LogMessage:{Level:t,Message:JSON.stringify(e)}}),r=await ee.sendMessage(s,!0,[]);n(r)}catch(s){console.count("Failed to send log message"+JSON.stringify(s)),n(!1)}});A.SEND_LOGS&&Kn.enableSendLogs(Da);const Dr=document.getElementById("show_recent_logs_btn");Dr&&Dr.addEventListener("click",()=>Kn.printRecentLogs());ee.start({RovName:A.ROV_NAME,APIKey:A.LIVEKIT_API_KEY,SecretKey:A.LIVEKIT_SECRET_KEY,LivekitCloudURL:A.LIVEKIT_CLOUD_ENDPOINT,LivekitLocalURL:A.LIVEKIT_LOCAL_ENDPOINT}).then(()=>{A.SEND_LOGS&&Kn.sendQueuedLogs(Da)});R("URL_PARAMS",A.TWITCH_STREAM_KEY);A.TWITCH_STREAM_KEY!=="None"&&(Hn.init(A.TWITCH_STREAM_KEY,A.ROV_NAME,A.LIVEKIT_API_KEY,A.LIVEKIT_SECRET_KEY),window.addEventListener("beforeunload",()=>Hn.stopStream()));A.PYTHON_WEBSOCKET_PORT!=0?Cn.start("ws://localhost:"+A.PYTHON_WEBSOCKET_PORT,t=>{if(t.length===0)return;const e=U.RovResponse.decode(t);if(!e.BackendMetadata)return B("No BackendMetadata in message from iROV",e.toJSON(),t);const n=e.BackendMetadata.TargetUserIds,r=e.BackendMetadata.TransportMethod==U.DataTransportMethod.LivekitReliable;ee.sendMessage(e,r,n||[])}):J("No PYTHON_WEBSOCKET_PORT url parameter set, skipping python websocket!");A.BLUEOS_APIS_ENDPOINT?(he.start(Lr(A.BLUEOS_APIS_ENDPOINT)+":6040/ws/mavlink",t=>{if(!t.header||!t.message)return B("Mavlink message missing header or message body",t);const e=Pr(JSON.stringify(t)),n=U.RovResponse.create({Mavlink:{Message:e}});ja.includes(t.message.type)&&ee.sendMessage(n,!0,[])},()=>{he.sendMessage(zu(0,8e6))}),setInterval(()=>{Eh().then(t=>{const e=kh(t.temperature),n=Sh(t.cpu),s=bh(t.memory),r=wh(t.disk),i=e.warnings.concat(n.warnings,s.warnings,r.warnings);A.DEBUG_MODE&&G("/SysInfo cpuTemp",e,"cpuUsage",n,"memUsage",s,"diskUsage",r,i);const a=U.RovResponse.create({SystemMonitor:{CpuTemp:e.value,CpuUsage:n.value,MemoryUsage:s.value,DiskUsage:r.value,Warnings:i}});ee.sendMessage(a,!0,[])})},5e3)):J("No BLUEOS_APIS_ENDPOINT url parameter set, skipping mavlink & system info monitoring!");
//# sourceMappingURL=internal-604d48d5.js.map
