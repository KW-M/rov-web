var Wa=Object.defineProperty;var Ja=(n,e,t)=>e in n?Wa(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var A=(n,e,t)=>Ja(n,typeof e!="symbol"?e+"":e,t);import{l as K,M as _e,a as ja,b as Ga,c as za,d as ui,u as De,e as j,f as ie,g as Ee,D as Ya,h as Xa,p as Pt,i as B,S as Qa,E as As,R as li,A as Za,j as oe,m as Rn,L as ec,k as vt,C as Q,n as tc,o as nc,q as V,r as Pe,P as ic,s as hr,T as rc,t as sc,v as fr,w as mr,x as oc,y as ac,z as cc,F as pr}from"./logging-BgfmgmVV.js";function Kt(n){return new Promise(e=>{setTimeout(()=>{e()},n)})}function uc(n,e=0){return new Promise((t,i)=>{e!==0&&setTimeout(()=>{i()},e);const r=setInterval(()=>{n()&&(clearInterval(r),t())},100)})}function gr(n,e=null,t=5,i=1e3,r=2){return async function(...s){let o,l=0;for(;l<t;)try{return await n.apply(e,s)}catch(f){o=f,K("err:",o),await Kt(i*Math.pow(r,l)),l++}throw new Error("asyncExpBackoff() func failed after "+l+" retries. Error: "+o)}}function Ct(n,e){let t=!1;return n.subscribe(r=>{if(t==!1){t=!0;return}e(r)})}function Ns(n,e=!1){return n.replace("http","ws")}function lc(){const n=new Date().getTime()>>>0,e=typeof performance<"u"&&performance.now&&(performance.now()>>>0)*1e3||0,t=crypto.getRandomValues(new Uint8Array(1))[0]>>>0;return n*e*t}const _r=["Ancient","Dawn","Small","Broken","Red","Cold","Wild","Divine","Empty","Patient","Holy","Long","Wispy","White","Delicate","Bold","Billowing","Blue","Crimson","Aged","Misty","Snowy","Withered","Little","Frosty","Weathered","Nameless","Fragrant","Lively","Quiet","Purple","Proud","Dry","Bitter","Dark","Icy","Twilight","Wandering","Solitary","Morning","Lingering","Still","Late","Sparkling","Restless","Winter","Silent","Floral","Young","Green","Cool","Autumn","Falling","Spring","Summer","Polished","Hidden","Damp","Muddy","Black","Old","Rough"],yr=["Pond","Snow","Glade","Hill","Voice","River","Sun","Dawn","Forest","Frog","Grass","Shadow","Dust","Water","Meadow","Moon","Thunder","Sun","Wildflower","Snowflake","Silence","Haze","Shape","Pine","Waterfall","Sound","Wood","Tree","Night","Flower","Dream","Cherry","Resonance","Firefly","Bush","Star","Darkness","Lake","Frost","Paper","Surf","Fog","Brook","Mountain","Field","Bird","Leaf","Sea","Water","Sky","Smoke","Sunset","Glitter","Dew","Butterfly","Wind","Fire","Rain","Morning","Feather","Cloud","Breeze","Violet","Wave","Droplet","Swamp","Village","Hut","Path","Book","Rain","Spell","Pig"];function dc(n,e=0){let t=_r.length>>>0,i=yr.length>>>0,r=Math.max(t,i)>>>0,s=Math.max(1,(n+1)%r)>>>0,o=Math.max(1,(e+1)%r)>>>0,l=_r[(s+o)%t],f=yr[s*o%i];return l+"-"+f}_e.MAV_STATE_UNINIT+"",_e.MAV_STATE_BOOT+"",_e.MAV_STATE_CALIBRATING+"",_e.MAV_STATE_STANDBY+"",_e.MAV_STATE_ACTIVE+"",_e.MAV_STATE_CRITICAL+"",_e.MAV_STATE_EMERGENCY+"",_e.MAV_STATE_POWEROFF+"",_e.MAV_STATE_FLIGHT_TERMINATION+"";let hc=-1;const tt=(n,e=0)=>({header:{system_id:255,component_id:190,sequence:hc++%255},message:n}),fc=n=>tt({type:"COMMAND_LONG",command:{type:"MAV_CMD_COMPONENT_ARM_DISARM"},target_system:1,target_component:1,confirmation:0,param1:1,param2:0,param3:0,param4:0,param5:0,param6:0,param7:0}),mc=n=>tt({type:"COMMAND_LONG",command:{type:"MAV_CMD_COMPONENT_ARM_DISARM"},target_system:1,target_component:1,confirmation:1,param1:0,param2:0,param3:0,param4:0,param5:0,param6:0,param7:0}),pc=(n=1,e=333333.34375)=>tt({type:"COMMAND_LONG",command:{type:"MAV_CMD_SET_MESSAGE_INTERVAL"},target_system:1,target_component:1,confirmation:1,param1:n,param2:e,param3:0,param4:0,param5:0,param6:0,param7:0}),gc=n=>(n=n||19,tt({type:"COMMAND_LONG",command:{type:"MAV_CMD_DO_SET_MODE"},param1:1,param2:Number(n),param3:0,param4:0,param5:0,param6:0,param7:0,target_system:1,target_component:1,confirmation:1})),_c=()=>tt({type:ja.HEARTBEAT,custom_mode:0,mavtype:{type:Ga.MAV_TYPE_GCS},autopilot:{type:za.MAV_AUTOPILOT_INVALID},base_mode:{bits:ui.MAV_MODE_FLAG_SAFETY_ARMED|ui.MAV_MODE_FLAG_MANUAL_INPUT_ENABLED},system_status:{type:_e.MAV_STATE_ACTIVE},mavlink_version:3,confirmation:0}),yc=(n,e,t,i,r)=>tt({type:"MANUAL_CONTROL",x:Math.floor(n),y:Math.floor(e),z:Math.floor(t),r:Math.floor(i),buttons:r,target:1}),Ec=(n,e,t)=>{const i=Array(8).fill(0);return i[n]=e,tt({type:"SET_ACTUATOR_CONTROL_TARGET",group_mlx:t,controls:i,time_usec:De()*1e3,target_component:1,target_system:1})};class vs{constructor(){A(this,"socket");A(this,"serverAddress");A(this,"msgReceivedFn");A(this,"onConnectedFn");A(this,"isRunning");A(this,"isConnected");A(this,"connectionTimerId");this.isConnected=!1,this.isRunning=!1,this.connectionTimerId=0,this.serverAddress=""}start(e,t){this.serverAddress=e,this.msgReceivedFn=t,this.isRunning=!0,this.connect()}stop(){this.isRunning=!1,this.socket&&this.socket.close()}connect(){j("Attempting to connect to websocket: "+this.serverAddress),this.socket=new WebSocket(this.serverAddress),this.socket.binaryType="arraybuffer";const e=setTimeout(()=>{ie("WebSocket connection timed out after 10 seconds"),this.stop(),this.queueConnect()},1e4);this.socket.addEventListener("open",t=>{this.isConnected=!0,clearTimeout(e),this.onConnectedFn&&this.onConnectedFn()}),this.socket.addEventListener("close",t=>{j("WebSocket connection closed with code: ",t.code),this.isConnected=!1,this.isRunning&&this.queueConnect()}),this.socket.addEventListener("error",t=>{ie("WebSocket error:",t),this.isConnected=!1,this.isRunning&&this.queueConnect()}),this.socket.addEventListener("message",t=>{if(!this.msgReceivedFn)return ie("No msgReceivedFn defined for WebSocketRelay");if(typeof t.data=="string")this.msgReceivedFn(t.data);else if(t.data instanceof ArrayBuffer)this.msgReceivedFn(new Uint8Array(t.data));else throw t.data instanceof Blob?new Error("WebSocketRelay received Blob type, which is not supported!"):new Error("WebSocketRelay received unknown type")})}queueConnect(){clearTimeout(this.connectionTimerId),this.connectionTimerId=setTimeout(this.connect.bind(this),2e3)}getIsConnected(){return this.isConnected}sendMessage(e){if(this.socket){if(this.socket.readyState!=this.socket.OPEN){Ee("Can't send WebSocket msg: "+this.socket.readyState);return}this.socket.send(e)}}close(){this.socket&&this.socket.close()}}const yn=new vs;class Tc{constructor(){A(this,"mavlinkWebsocket");A(this,"onMessage");this.mavlinkWebsocket=new vs,this.onMessage=e=>{}}start(e,t,i){this.onMessage=t,i&&(this.mavlinkWebsocket.onConnectedFn=i),this.mavlinkWebsocket.start(e,r=>{this.handleMessage(r)})}handleMessage(e){if(e.length===0)return;const t=e instanceof Uint8Array?Ya(e):e;try{if(t.startsWith("Ok"))return;const i=JSON.parse(t);this.onMessage(i)}catch(i){ie("Failed to parse recived mavlink2rest json. msg='"+t+"'",i)}}sendMessage(e){this.mavlinkWebsocket.sendMessage(JSON.stringify(e))}close(){this.mavlinkWebsocket.close()}}const Ae=new Tc;function Os(n,e){return function(){return n.apply(e,arguments)}}const{toString:wc}=Object.prototype,{getPrototypeOf:vi}=Object,In=(n=>e=>{const t=wc.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),pe=n=>(n=n.toLowerCase(),e=>In(e)===n),An=n=>e=>typeof e===n,{isArray:wt}=Array,Lt=An("undefined");function Sc(n){return n!==null&&!Lt(n)&&n.constructor!==null&&!Lt(n.constructor)&&le(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const xs=pe("ArrayBuffer");function bc(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&xs(n.buffer),e}const kc=An("string"),le=An("function"),Ps=An("number"),Nn=n=>n!==null&&typeof n=="object",Cc=n=>n===!0||n===!1,ln=n=>{if(In(n)!=="object")return!1;const e=vi(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Rc=pe("Date"),Ic=pe("File"),Ac=pe("Blob"),Nc=pe("FileList"),vc=n=>Nn(n)&&le(n.pipe),Oc=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||le(n.append)&&((e=In(n))==="formdata"||e==="object"&&le(n.toString)&&n.toString()==="[object FormData]"))},xc=pe("URLSearchParams"),[Pc,Lc,Fc,Mc]=["ReadableStream","Request","Response","Headers"].map(pe),Dc=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Vt(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let i,r;if(typeof n!="object"&&(n=[n]),wt(n))for(i=0,r=n.length;i<r;i++)e.call(null,n[i],i,n);else{const s=t?Object.getOwnPropertyNames(n):Object.keys(n),o=s.length;let l;for(i=0;i<o;i++)l=s[i],e.call(null,n[l],l,n)}}function Ls(n,e){e=e.toLowerCase();const t=Object.keys(n);let i=t.length,r;for(;i-- >0;)if(r=t[i],e===r.toLowerCase())return r;return null}const je=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Xa,Fs=n=>!Lt(n)&&n!==je;function di(){const{caseless:n}=Fs(this)&&this||{},e={},t=(i,r)=>{const s=n&&Ls(e,r)||r;ln(e[s])&&ln(i)?e[s]=di(e[s],i):ln(i)?e[s]=di({},i):wt(i)?e[s]=i.slice():e[s]=i};for(let i=0,r=arguments.length;i<r;i++)arguments[i]&&Vt(arguments[i],t);return e}const Bc=(n,e,t,{allOwnKeys:i}={})=>(Vt(e,(r,s)=>{t&&le(r)?n[s]=Os(r,t):n[s]=r},{allOwnKeys:i}),n),Uc=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),Kc=(n,e,t,i)=>{n.prototype=Object.create(e.prototype,i),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},Vc=(n,e,t,i)=>{let r,s,o;const l={};if(e=e||{},n==null)return e;do{for(r=Object.getOwnPropertyNames(n),s=r.length;s-- >0;)o=r[s],(!i||i(o,n,e))&&!l[o]&&(e[o]=n[o],l[o]=!0);n=t!==!1&&vi(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},qc=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const i=n.indexOf(e,t);return i!==-1&&i===t},Hc=n=>{if(!n)return null;if(wt(n))return n;let e=n.length;if(!Ps(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},$c=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&vi(Uint8Array)),Wc=(n,e)=>{const i=(n&&n[Symbol.iterator]).call(n);let r;for(;(r=i.next())&&!r.done;){const s=r.value;e.call(n,s[0],s[1])}},Jc=(n,e)=>{let t;const i=[];for(;(t=n.exec(e))!==null;)i.push(t);return i},jc=pe("HTMLFormElement"),Gc=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,i,r){return i.toUpperCase()+r}),Er=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),zc=pe("RegExp"),Ms=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),i={};Vt(t,(r,s)=>{let o;(o=e(r,s,n))!==!1&&(i[s]=o||r)}),Object.defineProperties(n,i)},Yc=n=>{Ms(n,(e,t)=>{if(le(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const i=n[t];if(le(i)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Xc=(n,e)=>{const t={},i=r=>{r.forEach(s=>{t[s]=!0})};return wt(n)?i(n):i(String(n).split(e)),t},Qc=()=>{},Zc=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e,Hn="abcdefghijklmnopqrstuvwxyz",Tr="0123456789",Ds={DIGIT:Tr,ALPHA:Hn,ALPHA_DIGIT:Hn+Hn.toUpperCase()+Tr},eu=(n=16,e=Ds.ALPHA_DIGIT)=>{let t="";const{length:i}=e;for(;n--;)t+=e[Math.random()*i|0];return t};function tu(n){return!!(n&&le(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const nu=n=>{const e=new Array(10),t=(i,r)=>{if(Nn(i)){if(e.indexOf(i)>=0)return;if(!("toJSON"in i)){e[r]=i;const s=wt(i)?[]:{};return Vt(i,(o,l)=>{const f=t(o,r+1);!Lt(f)&&(s[l]=f)}),e[r]=void 0,s}}return i};return t(n,0)},iu=pe("AsyncFunction"),ru=n=>n&&(Nn(n)||le(n))&&le(n.then)&&le(n.catch),Bs=((n,e)=>n?setImmediate:e?((t,i)=>(je.addEventListener("message",({source:r,data:s})=>{r===je&&s===t&&i.length&&i.shift()()},!1),r=>{i.push(r),je.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",le(je.postMessage)),su=typeof queueMicrotask<"u"?queueMicrotask.bind(je):typeof Pt<"u"&&Pt.nextTick||Bs,E={isArray:wt,isArrayBuffer:xs,isBuffer:Sc,isFormData:Oc,isArrayBufferView:bc,isString:kc,isNumber:Ps,isBoolean:Cc,isObject:Nn,isPlainObject:ln,isReadableStream:Pc,isRequest:Lc,isResponse:Fc,isHeaders:Mc,isUndefined:Lt,isDate:Rc,isFile:Ic,isBlob:Ac,isRegExp:zc,isFunction:le,isStream:vc,isURLSearchParams:xc,isTypedArray:$c,isFileList:Nc,forEach:Vt,merge:di,extend:Bc,trim:Dc,stripBOM:Uc,inherits:Kc,toFlatObject:Vc,kindOf:In,kindOfTest:pe,endsWith:qc,toArray:Hc,forEachEntry:Wc,matchAll:Jc,isHTMLForm:jc,hasOwnProperty:Er,hasOwnProp:Er,reduceDescriptors:Ms,freezeMethods:Yc,toObjectSet:Xc,toCamelCase:Gc,noop:Qc,toFiniteNumber:Zc,findKey:Ls,global:je,isContextDefined:Fs,ALPHABET:Ds,generateString:eu,isSpecCompliantForm:tu,toJSONObject:nu,isAsyncFn:iu,isThenable:ru,setImmediate:Bs,asap:su};var Us={},vn={};vn.byteLength=cu;vn.toByteArray=lu;vn.fromByteArray=fu;var Te=[],he=[],ou=typeof Uint8Array<"u"?Uint8Array:Array,$n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var ot=0,au=$n.length;ot<au;++ot)Te[ot]=$n[ot],he[$n.charCodeAt(ot)]=ot;he[45]=62;he[95]=63;function Ks(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var i=t===e?0:4-t%4;return[t,i]}function cu(n){var e=Ks(n),t=e[0],i=e[1];return(t+i)*3/4-i}function uu(n,e,t){return(e+t)*3/4-t}function lu(n){var e,t=Ks(n),i=t[0],r=t[1],s=new ou(uu(n,i,r)),o=0,l=r>0?i-4:i,f;for(f=0;f<l;f+=4)e=he[n.charCodeAt(f)]<<18|he[n.charCodeAt(f+1)]<<12|he[n.charCodeAt(f+2)]<<6|he[n.charCodeAt(f+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return r===2&&(e=he[n.charCodeAt(f)]<<2|he[n.charCodeAt(f+1)]>>4,s[o++]=e&255),r===1&&(e=he[n.charCodeAt(f)]<<10|he[n.charCodeAt(f+1)]<<4|he[n.charCodeAt(f+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function du(n){return Te[n>>18&63]+Te[n>>12&63]+Te[n>>6&63]+Te[n&63]}function hu(n,e,t){for(var i,r=[],s=e;s<t;s+=3)i=(n[s]<<16&16711680)+(n[s+1]<<8&65280)+(n[s+2]&255),r.push(du(i));return r.join("")}function fu(n){for(var e,t=n.length,i=t%3,r=[],s=16383,o=0,l=t-i;o<l;o+=s)r.push(hu(n,o,o+s>l?l:o+s));return i===1?(e=n[t-1],r.push(Te[e>>2]+Te[e<<4&63]+"==")):i===2&&(e=(n[t-2]<<8)+n[t-1],r.push(Te[e>>10]+Te[e>>4&63]+Te[e<<2&63]+"=")),r.join("")}var Oi={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Oi.read=function(n,e,t,i,r){var s,o,l=r*8-i-1,f=(1<<l)-1,h=f>>1,u=-7,p=t?r-1:0,_=t?-1:1,I=n[e+p];for(p+=_,s=I&(1<<-u)-1,I>>=-u,u+=l;u>0;s=s*256+n[e+p],p+=_,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=i;u>0;o=o*256+n[e+p],p+=_,u-=8);if(s===0)s=1-h;else{if(s===f)return o?NaN:(I?-1:1)*(1/0);o=o+Math.pow(2,i),s=s-h}return(I?-1:1)*o*Math.pow(2,s-i)};Oi.write=function(n,e,t,i,r,s){var o,l,f,h=s*8-r-1,u=(1<<h)-1,p=u>>1,_=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,I=i?0:s-1,C=i?1:-1,w=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(f=Math.pow(2,-o))<1&&(o--,f*=2),o+p>=1?e+=_/f:e+=_*Math.pow(2,1-p),e*f>=2&&(o++,f/=2),o+p>=u?(l=0,o=u):o+p>=1?(l=(e*f-1)*Math.pow(2,r),o=o+p):(l=e*Math.pow(2,p-1)*Math.pow(2,r),o=0));r>=8;n[t+I]=l&255,I+=C,l/=256,r-=8);for(o=o<<r|l,h+=r;h>0;n[t+I]=o&255,I+=C,o/=256,h-=8);n[t+I-C]|=w*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(n){const e=vn,t=Oi,i=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=u,n.SlowBuffer=F,n.INSPECT_MAX_BYTES=50;const r=2147483647;n.kMaxLength=r;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:l}=globalThis;u.TYPED_ARRAY_SUPPORT=f(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function f(){try{const d=new s(1),a={foo:function(){return 42}};return Object.setPrototypeOf(a,s.prototype),Object.setPrototypeOf(d,a),d.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function h(d){if(d>r)throw new RangeError('The value "'+d+'" is invalid for option "size"');const a=new s(d);return Object.setPrototypeOf(a,u.prototype),a}function u(d,a,c){if(typeof d=="number"){if(typeof a=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return C(d)}return p(d,a,c)}u.poolSize=8192;function p(d,a,c){if(typeof d=="string")return w(d,a);if(o.isView(d))return N(d);if(d==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof d);if(ge(d,o)||d&&ge(d.buffer,o)||typeof l<"u"&&(ge(d,l)||d&&ge(d.buffer,l)))return R(d,a,c);if(typeof d=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const m=d.valueOf&&d.valueOf();if(m!=null&&m!==d)return u.from(m,a,c);const g=v(d);if(g)return g;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof d[Symbol.toPrimitive]=="function")return u.from(d[Symbol.toPrimitive]("string"),a,c);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof d)}u.from=function(d,a,c){return p(d,a,c)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function _(d){if(typeof d!="number")throw new TypeError('"size" argument must be of type number');if(d<0)throw new RangeError('The value "'+d+'" is invalid for option "size"')}function I(d,a,c){return _(d),d<=0?h(d):a!==void 0?typeof c=="string"?h(d).fill(a,c):h(d).fill(a):h(d)}u.alloc=function(d,a,c){return I(d,a,c)};function C(d){return _(d),h(d<0?0:L(d)|0)}u.allocUnsafe=function(d){return C(d)},u.allocUnsafeSlow=function(d){return C(d)};function w(d,a){if((typeof a!="string"||a==="")&&(a="utf8"),!u.isEncoding(a))throw new TypeError("Unknown encoding: "+a);const c=z(d,a)|0;let m=h(c);const g=m.write(d,a);return g!==c&&(m=m.slice(0,g)),m}function T(d){const a=d.length<0?0:L(d.length)|0,c=h(a);for(let m=0;m<a;m+=1)c[m]=d[m]&255;return c}function N(d){if(ge(d,s)){const a=new s(d);return R(a.buffer,a.byteOffset,a.byteLength)}return T(d)}function R(d,a,c){if(a<0||d.byteLength<a)throw new RangeError('"offset" is outside of buffer bounds');if(d.byteLength<a+(c||0))throw new RangeError('"length" is outside of buffer bounds');let m;return a===void 0&&c===void 0?m=new s(d):c===void 0?m=new s(d,a):m=new s(d,a,c),Object.setPrototypeOf(m,u.prototype),m}function v(d){if(u.isBuffer(d)){const a=L(d.length)|0,c=h(a);return c.length===0||d.copy(c,0,0,a),c}if(d.length!==void 0)return typeof d.length!="number"||qn(d.length)?h(0):T(d);if(d.type==="Buffer"&&Array.isArray(d.data))return T(d.data)}function L(d){if(d>=r)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r.toString(16)+" bytes");return d|0}function F(d){return+d!=d&&(d=0),u.alloc(+d)}u.isBuffer=function(a){return a!=null&&a._isBuffer===!0&&a!==u.prototype},u.compare=function(a,c){if(ge(a,s)&&(a=u.from(a,a.offset,a.byteLength)),ge(c,s)&&(c=u.from(c,c.offset,c.byteLength)),!u.isBuffer(a)||!u.isBuffer(c))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(a===c)return 0;let m=a.length,g=c.length;for(let y=0,S=Math.min(m,g);y<S;++y)if(a[y]!==c[y]){m=a[y],g=c[y];break}return m<g?-1:g<m?1:0},u.isEncoding=function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(a,c){if(!Array.isArray(a))throw new TypeError('"list" argument must be an Array of Buffers');if(a.length===0)return u.alloc(0);let m;if(c===void 0)for(c=0,m=0;m<a.length;++m)c+=a[m].length;const g=u.allocUnsafe(c);let y=0;for(m=0;m<a.length;++m){let S=a[m];if(ge(S,s))y+S.length>g.length?(u.isBuffer(S)||(S=u.from(S)),S.copy(g,y)):s.prototype.set.call(g,S,y);else if(u.isBuffer(S))S.copy(g,y);else throw new TypeError('"list" argument must be an Array of Buffers');y+=S.length}return g};function z(d,a){if(u.isBuffer(d))return d.length;if(o.isView(d)||ge(d,o))return d.byteLength;if(typeof d!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof d);const c=d.length,m=arguments.length>2&&arguments[2]===!0;if(!m&&c===0)return 0;let g=!1;for(;;)switch(a){case"ascii":case"latin1":case"binary":return c;case"utf8":case"utf-8":return Vn(d).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c*2;case"hex":return c>>>1;case"base64":return dr(d).length;default:if(g)return m?-1:Vn(d).length;a=(""+a).toLowerCase(),g=!0}}u.byteLength=z;function re(d,a,c){let m=!1;if((a===void 0||a<0)&&(a=0),a>this.length||((c===void 0||c>this.length)&&(c=this.length),c<=0)||(c>>>=0,a>>>=0,c<=a))return"";for(d||(d="utf8");;)switch(d){case"hex":return Ma(this,a,c);case"utf8":case"utf-8":return nr(this,a,c);case"ascii":return La(this,a,c);case"latin1":case"binary":return Fa(this,a,c);case"base64":return xa(this,a,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Da(this,a,c);default:if(m)throw new TypeError("Unknown encoding: "+d);d=(d+"").toLowerCase(),m=!0}}u.prototype._isBuffer=!0;function q(d,a,c){const m=d[a];d[a]=d[c],d[c]=m}u.prototype.swap16=function(){const a=this.length;if(a%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let c=0;c<a;c+=2)q(this,c,c+1);return this},u.prototype.swap32=function(){const a=this.length;if(a%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let c=0;c<a;c+=4)q(this,c,c+3),q(this,c+1,c+2);return this},u.prototype.swap64=function(){const a=this.length;if(a%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let c=0;c<a;c+=8)q(this,c,c+7),q(this,c+1,c+6),q(this,c+2,c+5),q(this,c+3,c+4);return this},u.prototype.toString=function(){const a=this.length;return a===0?"":arguments.length===0?nr(this,0,a):re.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(a){if(!u.isBuffer(a))throw new TypeError("Argument must be a Buffer");return this===a?!0:u.compare(this,a)===0},u.prototype.inspect=function(){let a="";const c=n.INSPECT_MAX_BYTES;return a=this.toString("hex",0,c).replace(/(.{2})/g,"$1 ").trim(),this.length>c&&(a+=" ... "),"<Buffer "+a+">"},i&&(u.prototype[i]=u.prototype.inspect),u.prototype.compare=function(a,c,m,g,y){if(ge(a,s)&&(a=u.from(a,a.offset,a.byteLength)),!u.isBuffer(a))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof a);if(c===void 0&&(c=0),m===void 0&&(m=a?a.length:0),g===void 0&&(g=0),y===void 0&&(y=this.length),c<0||m>a.length||g<0||y>this.length)throw new RangeError("out of range index");if(g>=y&&c>=m)return 0;if(g>=y)return-1;if(c>=m)return 1;if(c>>>=0,m>>>=0,g>>>=0,y>>>=0,this===a)return 0;let S=y-g,x=m-c;const W=Math.min(S,x),H=this.slice(g,y),J=a.slice(c,m);for(let D=0;D<W;++D)if(H[D]!==J[D]){S=H[D],x=J[D];break}return S<x?-1:x<S?1:0};function we(d,a,c,m,g){if(d.length===0)return-1;if(typeof c=="string"?(m=c,c=0):c>2147483647?c=2147483647:c<-2147483648&&(c=-2147483648),c=+c,qn(c)&&(c=g?0:d.length-1),c<0&&(c=d.length+c),c>=d.length){if(g)return-1;c=d.length-1}else if(c<0)if(g)c=0;else return-1;if(typeof a=="string"&&(a=u.from(a,m)),u.isBuffer(a))return a.length===0?-1:ne(d,a,c,m,g);if(typeof a=="number")return a=a&255,typeof s.prototype.indexOf=="function"?g?s.prototype.indexOf.call(d,a,c):s.prototype.lastIndexOf.call(d,a,c):ne(d,[a],c,m,g);throw new TypeError("val must be string, number or Buffer")}function ne(d,a,c,m,g){let y=1,S=d.length,x=a.length;if(m!==void 0&&(m=String(m).toLowerCase(),m==="ucs2"||m==="ucs-2"||m==="utf16le"||m==="utf-16le")){if(d.length<2||a.length<2)return-1;y=2,S/=2,x/=2,c/=2}function W(J,D){return y===1?J[D]:J.readUInt16BE(D*y)}let H;if(g){let J=-1;for(H=c;H<S;H++)if(W(d,H)===W(a,J===-1?0:H-J)){if(J===-1&&(J=H),H-J+1===x)return J*y}else J!==-1&&(H-=H-J),J=-1}else for(c+x>S&&(c=S-x),H=c;H>=0;H--){let J=!0;for(let D=0;D<x;D++)if(W(d,H+D)!==W(a,D)){J=!1;break}if(J)return H}return-1}u.prototype.includes=function(a,c,m){return this.indexOf(a,c,m)!==-1},u.prototype.indexOf=function(a,c,m){return we(this,a,c,m,!0)},u.prototype.lastIndexOf=function(a,c,m){return we(this,a,c,m,!1)};function en(d,a,c,m){c=Number(c)||0;const g=d.length-c;m?(m=Number(m),m>g&&(m=g)):m=g;const y=a.length;m>y/2&&(m=y/2);let S;for(S=0;S<m;++S){const x=parseInt(a.substr(S*2,2),16);if(qn(x))return S;d[c+S]=x}return S}function tn(d,a,c,m){return sn(Vn(a,d.length-c),d,c,m)}function nn(d,a,c,m){return sn(Va(a),d,c,m)}function rn(d,a,c,m){return sn(dr(a),d,c,m)}function Oa(d,a,c,m){return sn(qa(a,d.length-c),d,c,m)}u.prototype.write=function(a,c,m,g){if(c===void 0)g="utf8",m=this.length,c=0;else if(m===void 0&&typeof c=="string")g=c,m=this.length,c=0;else if(isFinite(c))c=c>>>0,isFinite(m)?(m=m>>>0,g===void 0&&(g="utf8")):(g=m,m=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const y=this.length-c;if((m===void 0||m>y)&&(m=y),a.length>0&&(m<0||c<0)||c>this.length)throw new RangeError("Attempt to write outside buffer bounds");g||(g="utf8");let S=!1;for(;;)switch(g){case"hex":return en(this,a,c,m);case"utf8":case"utf-8":return tn(this,a,c,m);case"ascii":case"latin1":case"binary":return nn(this,a,c,m);case"base64":return rn(this,a,c,m);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Oa(this,a,c,m);default:if(S)throw new TypeError("Unknown encoding: "+g);g=(""+g).toLowerCase(),S=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function xa(d,a,c){return a===0&&c===d.length?e.fromByteArray(d):e.fromByteArray(d.slice(a,c))}function nr(d,a,c){c=Math.min(d.length,c);const m=[];let g=a;for(;g<c;){const y=d[g];let S=null,x=y>239?4:y>223?3:y>191?2:1;if(g+x<=c){let W,H,J,D;switch(x){case 1:y<128&&(S=y);break;case 2:W=d[g+1],(W&192)===128&&(D=(y&31)<<6|W&63,D>127&&(S=D));break;case 3:W=d[g+1],H=d[g+2],(W&192)===128&&(H&192)===128&&(D=(y&15)<<12|(W&63)<<6|H&63,D>2047&&(D<55296||D>57343)&&(S=D));break;case 4:W=d[g+1],H=d[g+2],J=d[g+3],(W&192)===128&&(H&192)===128&&(J&192)===128&&(D=(y&15)<<18|(W&63)<<12|(H&63)<<6|J&63,D>65535&&D<1114112&&(S=D))}}S===null?(S=65533,x=1):S>65535&&(S-=65536,m.push(S>>>10&1023|55296),S=56320|S&1023),m.push(S),g+=x}return Pa(m)}const ir=4096;function Pa(d){const a=d.length;if(a<=ir)return String.fromCharCode.apply(String,d);let c="",m=0;for(;m<a;)c+=String.fromCharCode.apply(String,d.slice(m,m+=ir));return c}function La(d,a,c){let m="";c=Math.min(d.length,c);for(let g=a;g<c;++g)m+=String.fromCharCode(d[g]&127);return m}function Fa(d,a,c){let m="";c=Math.min(d.length,c);for(let g=a;g<c;++g)m+=String.fromCharCode(d[g]);return m}function Ma(d,a,c){const m=d.length;(!a||a<0)&&(a=0),(!c||c<0||c>m)&&(c=m);let g="";for(let y=a;y<c;++y)g+=Ha[d[y]];return g}function Da(d,a,c){const m=d.slice(a,c);let g="";for(let y=0;y<m.length-1;y+=2)g+=String.fromCharCode(m[y]+m[y+1]*256);return g}u.prototype.slice=function(a,c){const m=this.length;a=~~a,c=c===void 0?m:~~c,a<0?(a+=m,a<0&&(a=0)):a>m&&(a=m),c<0?(c+=m,c<0&&(c=0)):c>m&&(c=m),c<a&&(c=a);const g=this.subarray(a,c);return Object.setPrototypeOf(g,u.prototype),g};function Z(d,a,c){if(d%1!==0||d<0)throw new RangeError("offset is not uint");if(d+a>c)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(a,c,m){a=a>>>0,c=c>>>0,m||Z(a,c,this.length);let g=this[a],y=1,S=0;for(;++S<c&&(y*=256);)g+=this[a+S]*y;return g},u.prototype.readUintBE=u.prototype.readUIntBE=function(a,c,m){a=a>>>0,c=c>>>0,m||Z(a,c,this.length);let g=this[a+--c],y=1;for(;c>0&&(y*=256);)g+=this[a+--c]*y;return g},u.prototype.readUint8=u.prototype.readUInt8=function(a,c){return a=a>>>0,c||Z(a,1,this.length),this[a]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(a,c){return a=a>>>0,c||Z(a,2,this.length),this[a]|this[a+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(a,c){return a=a>>>0,c||Z(a,2,this.length),this[a]<<8|this[a+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(a,c){return a=a>>>0,c||Z(a,4,this.length),(this[a]|this[a+1]<<8|this[a+2]<<16)+this[a+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(a,c){return a=a>>>0,c||Z(a,4,this.length),this[a]*16777216+(this[a+1]<<16|this[a+2]<<8|this[a+3])},u.prototype.readBigUInt64LE=xe(function(a){a=a>>>0,st(a,"offset");const c=this[a],m=this[a+7];(c===void 0||m===void 0)&&kt(a,this.length-8);const g=c+this[++a]*2**8+this[++a]*2**16+this[++a]*2**24,y=this[++a]+this[++a]*2**8+this[++a]*2**16+m*2**24;return BigInt(g)+(BigInt(y)<<BigInt(32))}),u.prototype.readBigUInt64BE=xe(function(a){a=a>>>0,st(a,"offset");const c=this[a],m=this[a+7];(c===void 0||m===void 0)&&kt(a,this.length-8);const g=c*2**24+this[++a]*2**16+this[++a]*2**8+this[++a],y=this[++a]*2**24+this[++a]*2**16+this[++a]*2**8+m;return(BigInt(g)<<BigInt(32))+BigInt(y)}),u.prototype.readIntLE=function(a,c,m){a=a>>>0,c=c>>>0,m||Z(a,c,this.length);let g=this[a],y=1,S=0;for(;++S<c&&(y*=256);)g+=this[a+S]*y;return y*=128,g>=y&&(g-=Math.pow(2,8*c)),g},u.prototype.readIntBE=function(a,c,m){a=a>>>0,c=c>>>0,m||Z(a,c,this.length);let g=c,y=1,S=this[a+--g];for(;g>0&&(y*=256);)S+=this[a+--g]*y;return y*=128,S>=y&&(S-=Math.pow(2,8*c)),S},u.prototype.readInt8=function(a,c){return a=a>>>0,c||Z(a,1,this.length),this[a]&128?(255-this[a]+1)*-1:this[a]},u.prototype.readInt16LE=function(a,c){a=a>>>0,c||Z(a,2,this.length);const m=this[a]|this[a+1]<<8;return m&32768?m|4294901760:m},u.prototype.readInt16BE=function(a,c){a=a>>>0,c||Z(a,2,this.length);const m=this[a+1]|this[a]<<8;return m&32768?m|4294901760:m},u.prototype.readInt32LE=function(a,c){return a=a>>>0,c||Z(a,4,this.length),this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24},u.prototype.readInt32BE=function(a,c){return a=a>>>0,c||Z(a,4,this.length),this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]},u.prototype.readBigInt64LE=xe(function(a){a=a>>>0,st(a,"offset");const c=this[a],m=this[a+7];(c===void 0||m===void 0)&&kt(a,this.length-8);const g=this[a+4]+this[a+5]*2**8+this[a+6]*2**16+(m<<24);return(BigInt(g)<<BigInt(32))+BigInt(c+this[++a]*2**8+this[++a]*2**16+this[++a]*2**24)}),u.prototype.readBigInt64BE=xe(function(a){a=a>>>0,st(a,"offset");const c=this[a],m=this[a+7];(c===void 0||m===void 0)&&kt(a,this.length-8);const g=(c<<24)+this[++a]*2**16+this[++a]*2**8+this[++a];return(BigInt(g)<<BigInt(32))+BigInt(this[++a]*2**24+this[++a]*2**16+this[++a]*2**8+m)}),u.prototype.readFloatLE=function(a,c){return a=a>>>0,c||Z(a,4,this.length),t.read(this,a,!0,23,4)},u.prototype.readFloatBE=function(a,c){return a=a>>>0,c||Z(a,4,this.length),t.read(this,a,!1,23,4)},u.prototype.readDoubleLE=function(a,c){return a=a>>>0,c||Z(a,8,this.length),t.read(this,a,!0,52,8)},u.prototype.readDoubleBE=function(a,c){return a=a>>>0,c||Z(a,8,this.length),t.read(this,a,!1,52,8)};function se(d,a,c,m,g,y){if(!u.isBuffer(d))throw new TypeError('"buffer" argument must be a Buffer instance');if(a>g||a<y)throw new RangeError('"value" argument is out of bounds');if(c+m>d.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(a,c,m,g){if(a=+a,c=c>>>0,m=m>>>0,!g){const x=Math.pow(2,8*m)-1;se(this,a,c,m,x,0)}let y=1,S=0;for(this[c]=a&255;++S<m&&(y*=256);)this[c+S]=a/y&255;return c+m},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(a,c,m,g){if(a=+a,c=c>>>0,m=m>>>0,!g){const x=Math.pow(2,8*m)-1;se(this,a,c,m,x,0)}let y=m-1,S=1;for(this[c+y]=a&255;--y>=0&&(S*=256);)this[c+y]=a/S&255;return c+m},u.prototype.writeUint8=u.prototype.writeUInt8=function(a,c,m){return a=+a,c=c>>>0,m||se(this,a,c,1,255,0),this[c]=a&255,c+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(a,c,m){return a=+a,c=c>>>0,m||se(this,a,c,2,65535,0),this[c]=a&255,this[c+1]=a>>>8,c+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(a,c,m){return a=+a,c=c>>>0,m||se(this,a,c,2,65535,0),this[c]=a>>>8,this[c+1]=a&255,c+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(a,c,m){return a=+a,c=c>>>0,m||se(this,a,c,4,4294967295,0),this[c+3]=a>>>24,this[c+2]=a>>>16,this[c+1]=a>>>8,this[c]=a&255,c+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(a,c,m){return a=+a,c=c>>>0,m||se(this,a,c,4,4294967295,0),this[c]=a>>>24,this[c+1]=a>>>16,this[c+2]=a>>>8,this[c+3]=a&255,c+4};function rr(d,a,c,m,g){lr(a,m,g,d,c,7);let y=Number(a&BigInt(4294967295));d[c++]=y,y=y>>8,d[c++]=y,y=y>>8,d[c++]=y,y=y>>8,d[c++]=y;let S=Number(a>>BigInt(32)&BigInt(4294967295));return d[c++]=S,S=S>>8,d[c++]=S,S=S>>8,d[c++]=S,S=S>>8,d[c++]=S,c}function sr(d,a,c,m,g){lr(a,m,g,d,c,7);let y=Number(a&BigInt(4294967295));d[c+7]=y,y=y>>8,d[c+6]=y,y=y>>8,d[c+5]=y,y=y>>8,d[c+4]=y;let S=Number(a>>BigInt(32)&BigInt(4294967295));return d[c+3]=S,S=S>>8,d[c+2]=S,S=S>>8,d[c+1]=S,S=S>>8,d[c]=S,c+8}u.prototype.writeBigUInt64LE=xe(function(a,c=0){return rr(this,a,c,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=xe(function(a,c=0){return sr(this,a,c,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(a,c,m,g){if(a=+a,c=c>>>0,!g){const W=Math.pow(2,8*m-1);se(this,a,c,m,W-1,-W)}let y=0,S=1,x=0;for(this[c]=a&255;++y<m&&(S*=256);)a<0&&x===0&&this[c+y-1]!==0&&(x=1),this[c+y]=(a/S>>0)-x&255;return c+m},u.prototype.writeIntBE=function(a,c,m,g){if(a=+a,c=c>>>0,!g){const W=Math.pow(2,8*m-1);se(this,a,c,m,W-1,-W)}let y=m-1,S=1,x=0;for(this[c+y]=a&255;--y>=0&&(S*=256);)a<0&&x===0&&this[c+y+1]!==0&&(x=1),this[c+y]=(a/S>>0)-x&255;return c+m},u.prototype.writeInt8=function(a,c,m){return a=+a,c=c>>>0,m||se(this,a,c,1,127,-128),a<0&&(a=255+a+1),this[c]=a&255,c+1},u.prototype.writeInt16LE=function(a,c,m){return a=+a,c=c>>>0,m||se(this,a,c,2,32767,-32768),this[c]=a&255,this[c+1]=a>>>8,c+2},u.prototype.writeInt16BE=function(a,c,m){return a=+a,c=c>>>0,m||se(this,a,c,2,32767,-32768),this[c]=a>>>8,this[c+1]=a&255,c+2},u.prototype.writeInt32LE=function(a,c,m){return a=+a,c=c>>>0,m||se(this,a,c,4,2147483647,-2147483648),this[c]=a&255,this[c+1]=a>>>8,this[c+2]=a>>>16,this[c+3]=a>>>24,c+4},u.prototype.writeInt32BE=function(a,c,m){return a=+a,c=c>>>0,m||se(this,a,c,4,2147483647,-2147483648),a<0&&(a=4294967295+a+1),this[c]=a>>>24,this[c+1]=a>>>16,this[c+2]=a>>>8,this[c+3]=a&255,c+4},u.prototype.writeBigInt64LE=xe(function(a,c=0){return rr(this,a,c,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=xe(function(a,c=0){return sr(this,a,c,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function or(d,a,c,m,g,y){if(c+m>d.length)throw new RangeError("Index out of range");if(c<0)throw new RangeError("Index out of range")}function ar(d,a,c,m,g){return a=+a,c=c>>>0,g||or(d,a,c,4),t.write(d,a,c,m,23,4),c+4}u.prototype.writeFloatLE=function(a,c,m){return ar(this,a,c,!0,m)},u.prototype.writeFloatBE=function(a,c,m){return ar(this,a,c,!1,m)};function cr(d,a,c,m,g){return a=+a,c=c>>>0,g||or(d,a,c,8),t.write(d,a,c,m,52,8),c+8}u.prototype.writeDoubleLE=function(a,c,m){return cr(this,a,c,!0,m)},u.prototype.writeDoubleBE=function(a,c,m){return cr(this,a,c,!1,m)},u.prototype.copy=function(a,c,m,g){if(!u.isBuffer(a))throw new TypeError("argument should be a Buffer");if(m||(m=0),!g&&g!==0&&(g=this.length),c>=a.length&&(c=a.length),c||(c=0),g>0&&g<m&&(g=m),g===m||a.length===0||this.length===0)return 0;if(c<0)throw new RangeError("targetStart out of bounds");if(m<0||m>=this.length)throw new RangeError("Index out of range");if(g<0)throw new RangeError("sourceEnd out of bounds");g>this.length&&(g=this.length),a.length-c<g-m&&(g=a.length-c+m);const y=g-m;return this===a&&typeof s.prototype.copyWithin=="function"?this.copyWithin(c,m,g):s.prototype.set.call(a,this.subarray(m,g),c),y},u.prototype.fill=function(a,c,m,g){if(typeof a=="string"){if(typeof c=="string"?(g=c,c=0,m=this.length):typeof m=="string"&&(g=m,m=this.length),g!==void 0&&typeof g!="string")throw new TypeError("encoding must be a string");if(typeof g=="string"&&!u.isEncoding(g))throw new TypeError("Unknown encoding: "+g);if(a.length===1){const S=a.charCodeAt(0);(g==="utf8"&&S<128||g==="latin1")&&(a=S)}}else typeof a=="number"?a=a&255:typeof a=="boolean"&&(a=Number(a));if(c<0||this.length<c||this.length<m)throw new RangeError("Out of range index");if(m<=c)return this;c=c>>>0,m=m===void 0?this.length:m>>>0,a||(a=0);let y;if(typeof a=="number")for(y=c;y<m;++y)this[y]=a;else{const S=u.isBuffer(a)?a:u.from(a,g),x=S.length;if(x===0)throw new TypeError('The value "'+a+'" is invalid for argument "value"');for(y=0;y<m-c;++y)this[y+c]=S[y%x]}return this};const rt={};function Kn(d,a,c){rt[d]=class extends c{constructor(){super(),Object.defineProperty(this,"message",{value:a.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${d}]`,this.stack,delete this.name}get code(){return d}set code(g){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:g,writable:!0})}toString(){return`${this.name} [${d}]: ${this.message}`}}}Kn("ERR_BUFFER_OUT_OF_BOUNDS",function(d){return d?`${d} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Kn("ERR_INVALID_ARG_TYPE",function(d,a){return`The "${d}" argument must be of type number. Received type ${typeof a}`},TypeError),Kn("ERR_OUT_OF_RANGE",function(d,a,c){let m=`The value of "${d}" is out of range.`,g=c;return Number.isInteger(c)&&Math.abs(c)>2**32?g=ur(String(c)):typeof c=="bigint"&&(g=String(c),(c>BigInt(2)**BigInt(32)||c<-(BigInt(2)**BigInt(32)))&&(g=ur(g)),g+="n"),m+=` It must be ${a}. Received ${g}`,m},RangeError);function ur(d){let a="",c=d.length;const m=d[0]==="-"?1:0;for(;c>=m+4;c-=3)a=`_${d.slice(c-3,c)}${a}`;return`${d.slice(0,c)}${a}`}function Ba(d,a,c){st(a,"offset"),(d[a]===void 0||d[a+c]===void 0)&&kt(a,d.length-(c+1))}function lr(d,a,c,m,g,y){if(d>c||d<a){const S=typeof a=="bigint"?"n":"";let x;throw a===0||a===BigInt(0)?x=`>= 0${S} and < 2${S} ** ${(y+1)*8}${S}`:x=`>= -(2${S} ** ${(y+1)*8-1}${S}) and < 2 ** ${(y+1)*8-1}${S}`,new rt.ERR_OUT_OF_RANGE("value",x,d)}Ba(m,g,y)}function st(d,a){if(typeof d!="number")throw new rt.ERR_INVALID_ARG_TYPE(a,"number",d)}function kt(d,a,c){throw Math.floor(d)!==d?(st(d,c),new rt.ERR_OUT_OF_RANGE("offset","an integer",d)):a<0?new rt.ERR_BUFFER_OUT_OF_BOUNDS:new rt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${a}`,d)}const Ua=/[^+/0-9A-Za-z-_]/g;function Ka(d){if(d=d.split("=")[0],d=d.trim().replace(Ua,""),d.length<2)return"";for(;d.length%4!==0;)d=d+"=";return d}function Vn(d,a){a=a||1/0;let c;const m=d.length;let g=null;const y=[];for(let S=0;S<m;++S){if(c=d.charCodeAt(S),c>55295&&c<57344){if(!g){if(c>56319){(a-=3)>-1&&y.push(239,191,189);continue}else if(S+1===m){(a-=3)>-1&&y.push(239,191,189);continue}g=c;continue}if(c<56320){(a-=3)>-1&&y.push(239,191,189),g=c;continue}c=(g-55296<<10|c-56320)+65536}else g&&(a-=3)>-1&&y.push(239,191,189);if(g=null,c<128){if((a-=1)<0)break;y.push(c)}else if(c<2048){if((a-=2)<0)break;y.push(c>>6|192,c&63|128)}else if(c<65536){if((a-=3)<0)break;y.push(c>>12|224,c>>6&63|128,c&63|128)}else if(c<1114112){if((a-=4)<0)break;y.push(c>>18|240,c>>12&63|128,c>>6&63|128,c&63|128)}else throw new Error("Invalid code point")}return y}function Va(d){const a=[];for(let c=0;c<d.length;++c)a.push(d.charCodeAt(c)&255);return a}function qa(d,a){let c,m,g;const y=[];for(let S=0;S<d.length&&!((a-=2)<0);++S)c=d.charCodeAt(S),m=c>>8,g=c%256,y.push(g),y.push(m);return y}function dr(d){return e.toByteArray(Ka(d))}function sn(d,a,c,m){let g;for(g=0;g<m&&!(g+c>=a.length||g>=d.length);++g)a[g+c]=d[g];return g}function ge(d,a){return d instanceof a||d!=null&&d.constructor!=null&&d.constructor.name!=null&&d.constructor.name===a.name}function qn(d){return d!==d}const Ha=function(){const d="0123456789abcdef",a=new Array(256);for(let c=0;c<16;++c){const m=c*16;for(let g=0;g<16;++g)a[m+g]=d[c]+d[g]}return a}();function xe(d){return typeof BigInt>"u"?$a:d}function $a(){throw new Error("BigInt not supported")}})(Us);const mu=Us.Buffer;function O(n,e,t,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}E.inherits(O,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:E.toJSONObject(this.config),code:this.code,status:this.status}}});const Vs=O.prototype,qs={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{qs[n]={value:n}});Object.defineProperties(O,qs);Object.defineProperty(Vs,"isAxiosError",{value:!0});O.from=(n,e,t,i,r,s)=>{const o=Object.create(Vs);return E.toFlatObject(n,o,function(f){return f!==Error.prototype},l=>l!=="isAxiosError"),O.call(o,n.message,e,t,i,r),o.cause=n,o.name=n.name,s&&Object.assign(o,s),o};const pu=null;function hi(n){return E.isPlainObject(n)||E.isArray(n)}function Hs(n){return E.endsWith(n,"[]")?n.slice(0,-2):n}function wr(n,e,t){return n?n.concat(e).map(function(r,s){return r=Hs(r),!t&&s?"["+r+"]":r}).join(t?".":""):e}function gu(n){return E.isArray(n)&&!n.some(hi)}const _u=E.toFlatObject(E,{},null,function(e){return/^is[A-Z]/.test(e)});function On(n,e,t){if(!E.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=E.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(w,T){return!E.isUndefined(T[w])});const i=t.metaTokens,r=t.visitor||u,s=t.dots,o=t.indexes,f=(t.Blob||typeof Blob<"u"&&Blob)&&E.isSpecCompliantForm(e);if(!E.isFunction(r))throw new TypeError("visitor must be a function");function h(C){if(C===null)return"";if(E.isDate(C))return C.toISOString();if(!f&&E.isBlob(C))throw new O("Blob is not supported. Use a Buffer instead.");return E.isArrayBuffer(C)||E.isTypedArray(C)?f&&typeof Blob=="function"?new Blob([C]):mu.from(C):C}function u(C,w,T){let N=C;if(C&&!T&&typeof C=="object"){if(E.endsWith(w,"{}"))w=i?w:w.slice(0,-2),C=JSON.stringify(C);else if(E.isArray(C)&&gu(C)||(E.isFileList(C)||E.endsWith(w,"[]"))&&(N=E.toArray(C)))return w=Hs(w),N.forEach(function(v,L){!(E.isUndefined(v)||v===null)&&e.append(o===!0?wr([w],L,s):o===null?w:w+"[]",h(v))}),!1}return hi(C)?!0:(e.append(wr(T,w,s),h(C)),!1)}const p=[],_=Object.assign(_u,{defaultVisitor:u,convertValue:h,isVisitable:hi});function I(C,w){if(!E.isUndefined(C)){if(p.indexOf(C)!==-1)throw Error("Circular reference detected in "+w.join("."));p.push(C),E.forEach(C,function(N,R){(!(E.isUndefined(N)||N===null)&&r.call(e,N,E.isString(R)?R.trim():R,w,_))===!0&&I(N,w?w.concat(R):[R])}),p.pop()}}if(!E.isObject(n))throw new TypeError("data must be an object");return I(n),e}function Sr(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(i){return e[i]})}function xi(n,e){this._pairs=[],n&&On(n,this,e)}const $s=xi.prototype;$s.append=function(e,t){this._pairs.push([e,t])};$s.toString=function(e){const t=e?function(i){return e.call(this,i,Sr)}:Sr;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};function yu(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Ws(n,e,t){if(!e)return n;const i=t&&t.encode||yu,r=t&&t.serialize;let s;if(r?s=r(e,t):s=E.isURLSearchParams(e)?e.toString():new xi(e,t).toString(i),s){const o=n.indexOf("#");o!==-1&&(n=n.slice(0,o)),n+=(n.indexOf("?")===-1?"?":"&")+s}return n}class br{constructor(){this.handlers=[]}use(e,t,i){return this.handlers.push({fulfilled:e,rejected:t,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){E.forEach(this.handlers,function(i){i!==null&&e(i)})}}const Js={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Eu=typeof URLSearchParams<"u"?URLSearchParams:xi,Tu=typeof FormData<"u"?FormData:null,wu=typeof Blob<"u"?Blob:null,Su={isBrowser:!0,classes:{URLSearchParams:Eu,FormData:Tu,Blob:wu},protocols:["http","https","file","blob","url","data"]},Pi=typeof window<"u"&&typeof document<"u",fi=typeof navigator=="object"&&navigator||void 0,bu=Pi&&(!fi||["ReactNative","NativeScript","NS"].indexOf(fi.product)<0),ku=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Cu=Pi&&window.location.href||"http://localhost",Ru=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Pi,hasStandardBrowserEnv:bu,hasStandardBrowserWebWorkerEnv:ku,navigator:fi,origin:Cu},Symbol.toStringTag,{value:"Module"})),ae={...Ru,...Su};function Iu(n,e){return On(n,new ae.classes.URLSearchParams,Object.assign({visitor:function(t,i,r,s){return ae.isNode&&E.isBuffer(t)?(this.append(i,t.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function Au(n){return E.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Nu(n){const e={},t=Object.keys(n);let i;const r=t.length;let s;for(i=0;i<r;i++)s=t[i],e[s]=n[s];return e}function js(n){function e(t,i,r,s){let o=t[s++];if(o==="__proto__")return!0;const l=Number.isFinite(+o),f=s>=t.length;return o=!o&&E.isArray(r)?r.length:o,f?(E.hasOwnProp(r,o)?r[o]=[r[o],i]:r[o]=i,!l):((!r[o]||!E.isObject(r[o]))&&(r[o]=[]),e(t,i,r[o],s)&&E.isArray(r[o])&&(r[o]=Nu(r[o])),!l)}if(E.isFormData(n)&&E.isFunction(n.entries)){const t={};return E.forEachEntry(n,(i,r)=>{e(Au(i),r,t,0)}),t}return null}function vu(n,e,t){if(E.isString(n))try{return(e||JSON.parse)(n),E.trim(n)}catch(i){if(i.name!=="SyntaxError")throw i}return(0,JSON.stringify)(n)}const qt={transitional:Js,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const i=t.getContentType()||"",r=i.indexOf("application/json")>-1,s=E.isObject(e);if(s&&E.isHTMLForm(e)&&(e=new FormData(e)),E.isFormData(e))return r?JSON.stringify(js(e)):e;if(E.isArrayBuffer(e)||E.isBuffer(e)||E.isStream(e)||E.isFile(e)||E.isBlob(e)||E.isReadableStream(e))return e;if(E.isArrayBufferView(e))return e.buffer;if(E.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(s){if(i.indexOf("application/x-www-form-urlencoded")>-1)return Iu(e,this.formSerializer).toString();if((l=E.isFileList(e))||i.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return On(l?{"files[]":e}:e,f&&new f,this.formSerializer)}}return s||r?(t.setContentType("application/json",!1),vu(e)):e}],transformResponse:[function(e){const t=this.transitional||qt.transitional,i=t&&t.forcedJSONParsing,r=this.responseType==="json";if(E.isResponse(e)||E.isReadableStream(e))return e;if(e&&E.isString(e)&&(i&&!this.responseType||r)){const o=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(l){if(o)throw l.name==="SyntaxError"?O.from(l,O.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ae.classes.FormData,Blob:ae.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};E.forEach(["delete","get","head","post","put","patch"],n=>{qt.headers[n]={}});const Ou=E.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),xu=n=>{const e={};let t,i,r;return n&&n.split(`
`).forEach(function(o){r=o.indexOf(":"),t=o.substring(0,r).trim().toLowerCase(),i=o.substring(r+1).trim(),!(!t||e[t]&&Ou[t])&&(t==="set-cookie"?e[t]?e[t].push(i):e[t]=[i]:e[t]=e[t]?e[t]+", "+i:i)}),e},kr=Symbol("internals");function Rt(n){return n&&String(n).trim().toLowerCase()}function dn(n){return n===!1||n==null?n:E.isArray(n)?n.map(dn):String(n)}function Pu(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=t.exec(n);)e[i[1]]=i[2];return e}const Lu=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function Wn(n,e,t,i,r){if(E.isFunction(i))return i.call(this,e,t);if(r&&(e=t),!!E.isString(e)){if(E.isString(i))return e.indexOf(i)!==-1;if(E.isRegExp(i))return i.test(e)}}function Fu(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,i)=>t.toUpperCase()+i)}function Mu(n,e){const t=E.toCamelCase(" "+e);["get","set","has"].forEach(i=>{Object.defineProperty(n,i+t,{value:function(r,s,o){return this[i].call(this,e,r,s,o)},configurable:!0})})}class ce{constructor(e){e&&this.set(e)}set(e,t,i){const r=this;function s(l,f,h){const u=Rt(f);if(!u)throw new Error("header name must be a non-empty string");const p=E.findKey(r,u);(!p||r[p]===void 0||h===!0||h===void 0&&r[p]!==!1)&&(r[p||f]=dn(l))}const o=(l,f)=>E.forEach(l,(h,u)=>s(h,u,f));if(E.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(E.isString(e)&&(e=e.trim())&&!Lu(e))o(xu(e),t);else if(E.isHeaders(e))for(const[l,f]of e.entries())s(f,l,i);else e!=null&&s(t,e,i);return this}get(e,t){if(e=Rt(e),e){const i=E.findKey(this,e);if(i){const r=this[i];if(!t)return r;if(t===!0)return Pu(r);if(E.isFunction(t))return t.call(this,r,i);if(E.isRegExp(t))return t.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Rt(e),e){const i=E.findKey(this,e);return!!(i&&this[i]!==void 0&&(!t||Wn(this,this[i],i,t)))}return!1}delete(e,t){const i=this;let r=!1;function s(o){if(o=Rt(o),o){const l=E.findKey(i,o);l&&(!t||Wn(i,i[l],l,t))&&(delete i[l],r=!0)}}return E.isArray(e)?e.forEach(s):s(e),r}clear(e){const t=Object.keys(this);let i=t.length,r=!1;for(;i--;){const s=t[i];(!e||Wn(this,this[s],s,e,!0))&&(delete this[s],r=!0)}return r}normalize(e){const t=this,i={};return E.forEach(this,(r,s)=>{const o=E.findKey(i,s);if(o){t[o]=dn(r),delete t[s];return}const l=e?Fu(s):String(s).trim();l!==s&&delete t[s],t[l]=dn(r),i[l]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return E.forEach(this,(i,r)=>{i!=null&&i!==!1&&(t[r]=e&&E.isArray(i)?i.join(", "):i)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const i=new this(e);return t.forEach(r=>i.set(r)),i}static accessor(e){const i=(this[kr]=this[kr]={accessors:{}}).accessors,r=this.prototype;function s(o){const l=Rt(o);i[l]||(Mu(r,o),i[l]=!0)}return E.isArray(e)?e.forEach(s):s(e),this}}ce.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);E.reduceDescriptors(ce.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(i){this[t]=i}}});E.freezeMethods(ce);function Jn(n,e){const t=this||qt,i=e||t,r=ce.from(i.headers);let s=i.data;return E.forEach(n,function(l){s=l.call(t,s,r.normalize(),e?e.status:void 0)}),r.normalize(),s}function Gs(n){return!!(n&&n.__CANCEL__)}function St(n,e,t){O.call(this,n??"canceled",O.ERR_CANCELED,e,t),this.name="CanceledError"}E.inherits(St,O,{__CANCEL__:!0});function zs(n,e,t){const i=t.config.validateStatus;!t.status||!i||i(t.status)?n(t):e(new O("Request failed with status code "+t.status,[O.ERR_BAD_REQUEST,O.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Du(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function Bu(n,e){n=n||10;const t=new Array(n),i=new Array(n);let r=0,s=0,o;return e=e!==void 0?e:1e3,function(f){const h=Date.now(),u=i[s];o||(o=h),t[r]=f,i[r]=h;let p=s,_=0;for(;p!==r;)_+=t[p++],p=p%n;if(r=(r+1)%n,r===s&&(s=(s+1)%n),h-o<e)return;const I=u&&h-u;return I?Math.round(_*1e3/I):void 0}}function Uu(n,e){let t=0,i=1e3/e,r,s;const o=(h,u=Date.now())=>{t=u,r=null,s&&(clearTimeout(s),s=null),n.apply(null,h)};return[(...h)=>{const u=Date.now(),p=u-t;p>=i?o(h,u):(r=h,s||(s=setTimeout(()=>{s=null,o(r)},i-p)))},()=>r&&o(r)]}const En=(n,e,t=3)=>{let i=0;const r=Bu(50,250);return Uu(s=>{const o=s.loaded,l=s.lengthComputable?s.total:void 0,f=o-i,h=r(f),u=o<=l;i=o;const p={loaded:o,total:l,progress:l?o/l:void 0,bytes:f,rate:h||void 0,estimated:h&&l&&u?(l-o)/h:void 0,event:s,lengthComputable:l!=null,[e?"download":"upload"]:!0};n(p)},t)},Cr=(n,e)=>{const t=n!=null;return[i=>e[0]({lengthComputable:t,total:n,loaded:i}),e[1]]},Rr=n=>(...e)=>E.asap(()=>n(...e)),Ku=ae.hasStandardBrowserEnv?function(){const e=ae.navigator&&/(msie|trident)/i.test(ae.navigator.userAgent),t=document.createElement("a");let i;function r(s){let o=s;return e&&(t.setAttribute("href",o),o=t.href),t.setAttribute("href",o),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return i=r(window.location.href),function(o){const l=E.isString(o)?r(o):o;return l.protocol===i.protocol&&l.host===i.host}}():function(){return function(){return!0}}(),Vu=ae.hasStandardBrowserEnv?{write(n,e,t,i,r,s){const o=[n+"="+encodeURIComponent(e)];E.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),E.isString(i)&&o.push("path="+i),E.isString(r)&&o.push("domain="+r),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function qu(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function Hu(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function Ys(n,e){return n&&!qu(e)?Hu(n,e):e}const Ir=n=>n instanceof ce?{...n}:n;function Ye(n,e){e=e||{};const t={};function i(h,u,p){return E.isPlainObject(h)&&E.isPlainObject(u)?E.merge.call({caseless:p},h,u):E.isPlainObject(u)?E.merge({},u):E.isArray(u)?u.slice():u}function r(h,u,p){if(E.isUndefined(u)){if(!E.isUndefined(h))return i(void 0,h,p)}else return i(h,u,p)}function s(h,u){if(!E.isUndefined(u))return i(void 0,u)}function o(h,u){if(E.isUndefined(u)){if(!E.isUndefined(h))return i(void 0,h)}else return i(void 0,u)}function l(h,u,p){if(p in e)return i(h,u);if(p in n)return i(void 0,h)}const f={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:l,headers:(h,u)=>r(Ir(h),Ir(u),!0)};return E.forEach(Object.keys(Object.assign({},n,e)),function(u){const p=f[u]||r,_=p(n[u],e[u],u);E.isUndefined(_)&&p!==l||(t[u]=_)}),t}const Xs=n=>{const e=Ye({},n);let{data:t,withXSRFToken:i,xsrfHeaderName:r,xsrfCookieName:s,headers:o,auth:l}=e;e.headers=o=ce.from(o),e.url=Ws(Ys(e.baseURL,e.url),n.params,n.paramsSerializer),l&&o.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):"")));let f;if(E.isFormData(t)){if(ae.hasStandardBrowserEnv||ae.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((f=o.getContentType())!==!1){const[h,...u]=f?f.split(";").map(p=>p.trim()).filter(Boolean):[];o.setContentType([h||"multipart/form-data",...u].join("; "))}}if(ae.hasStandardBrowserEnv&&(i&&E.isFunction(i)&&(i=i(e)),i||i!==!1&&Ku(e.url))){const h=r&&s&&Vu.read(s);h&&o.set(r,h)}return e},$u=typeof XMLHttpRequest<"u",Wu=$u&&function(n){return new Promise(function(t,i){const r=Xs(n);let s=r.data;const o=ce.from(r.headers).normalize();let{responseType:l,onUploadProgress:f,onDownloadProgress:h}=r,u,p,_,I,C;function w(){I&&I(),C&&C(),r.cancelToken&&r.cancelToken.unsubscribe(u),r.signal&&r.signal.removeEventListener("abort",u)}let T=new XMLHttpRequest;T.open(r.method.toUpperCase(),r.url,!0),T.timeout=r.timeout;function N(){if(!T)return;const v=ce.from("getAllResponseHeaders"in T&&T.getAllResponseHeaders()),F={data:!l||l==="text"||l==="json"?T.responseText:T.response,status:T.status,statusText:T.statusText,headers:v,config:n,request:T};zs(function(re){t(re),w()},function(re){i(re),w()},F),T=null}"onloadend"in T?T.onloadend=N:T.onreadystatechange=function(){!T||T.readyState!==4||T.status===0&&!(T.responseURL&&T.responseURL.indexOf("file:")===0)||setTimeout(N)},T.onabort=function(){T&&(i(new O("Request aborted",O.ECONNABORTED,n,T)),T=null)},T.onerror=function(){i(new O("Network Error",O.ERR_NETWORK,n,T)),T=null},T.ontimeout=function(){let L=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const F=r.transitional||Js;r.timeoutErrorMessage&&(L=r.timeoutErrorMessage),i(new O(L,F.clarifyTimeoutError?O.ETIMEDOUT:O.ECONNABORTED,n,T)),T=null},s===void 0&&o.setContentType(null),"setRequestHeader"in T&&E.forEach(o.toJSON(),function(L,F){T.setRequestHeader(F,L)}),E.isUndefined(r.withCredentials)||(T.withCredentials=!!r.withCredentials),l&&l!=="json"&&(T.responseType=r.responseType),h&&([_,C]=En(h,!0),T.addEventListener("progress",_)),f&&T.upload&&([p,I]=En(f),T.upload.addEventListener("progress",p),T.upload.addEventListener("loadend",I)),(r.cancelToken||r.signal)&&(u=v=>{T&&(i(!v||v.type?new St(null,n,T):v),T.abort(),T=null)},r.cancelToken&&r.cancelToken.subscribe(u),r.signal&&(r.signal.aborted?u():r.signal.addEventListener("abort",u)));const R=Du(r.url);if(R&&ae.protocols.indexOf(R)===-1){i(new O("Unsupported protocol "+R+":",O.ERR_BAD_REQUEST,n));return}T.send(s||null)})},Ju=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let i=new AbortController,r;const s=function(h){if(!r){r=!0,l();const u=h instanceof Error?h:this.reason;i.abort(u instanceof O?u:new St(u instanceof Error?u.message:u))}};let o=e&&setTimeout(()=>{o=null,s(new O(`timeout ${e} of ms exceeded`,O.ETIMEDOUT))},e);const l=()=>{n&&(o&&clearTimeout(o),o=null,n.forEach(h=>{h.unsubscribe?h.unsubscribe(s):h.removeEventListener("abort",s)}),n=null)};n.forEach(h=>h.addEventListener("abort",s));const{signal:f}=i;return f.unsubscribe=()=>E.asap(l),f}},ju=function*(n,e){let t=n.byteLength;if(t<e){yield n;return}let i=0,r;for(;i<t;)r=i+e,yield n.slice(i,r),i=r},Gu=async function*(n,e){for await(const t of zu(n))yield*ju(t,e)},zu=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:i}=await e.read();if(t)break;yield i}}finally{await e.cancel()}},Ar=(n,e,t,i)=>{const r=Gu(n,e);let s=0,o,l=f=>{o||(o=!0,i&&i(f))};return new ReadableStream({async pull(f){try{const{done:h,value:u}=await r.next();if(h){l(),f.close();return}let p=u.byteLength;if(t){let _=s+=p;t(_)}f.enqueue(new Uint8Array(u))}catch(h){throw l(h),h}},cancel(f){return l(f),r.return()}},{highWaterMark:2})},xn=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Qs=xn&&typeof ReadableStream=="function",Yu=xn&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),Zs=(n,...e)=>{try{return!!n(...e)}catch{return!1}},Xu=Qs&&Zs(()=>{let n=!1;const e=new Request(ae.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),Nr=64*1024,mi=Qs&&Zs(()=>E.isReadableStream(new Response("").body)),Tn={stream:mi&&(n=>n.body)};xn&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Tn[e]&&(Tn[e]=E.isFunction(n[e])?t=>t[e]():(t,i)=>{throw new O(`Response type '${e}' is not supported`,O.ERR_NOT_SUPPORT,i)})})})(new Response);const Qu=async n=>{if(n==null)return 0;if(E.isBlob(n))return n.size;if(E.isSpecCompliantForm(n))return(await new Request(ae.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(E.isArrayBufferView(n)||E.isArrayBuffer(n))return n.byteLength;if(E.isURLSearchParams(n)&&(n=n+""),E.isString(n))return(await Yu(n)).byteLength},Zu=async(n,e)=>{const t=E.toFiniteNumber(n.getContentLength());return t??Qu(e)},el=xn&&(async n=>{let{url:e,method:t,data:i,signal:r,cancelToken:s,timeout:o,onDownloadProgress:l,onUploadProgress:f,responseType:h,headers:u,withCredentials:p="same-origin",fetchOptions:_}=Xs(n);h=h?(h+"").toLowerCase():"text";let I=Ju([r,s&&s.toAbortSignal()],o),C;const w=I&&I.unsubscribe&&(()=>{I.unsubscribe()});let T;try{if(f&&Xu&&t!=="get"&&t!=="head"&&(T=await Zu(u,i))!==0){let F=new Request(e,{method:"POST",body:i,duplex:"half"}),z;if(E.isFormData(i)&&(z=F.headers.get("content-type"))&&u.setContentType(z),F.body){const[re,q]=Cr(T,En(Rr(f)));i=Ar(F.body,Nr,re,q)}}E.isString(p)||(p=p?"include":"omit");const N="credentials"in Request.prototype;C=new Request(e,{..._,signal:I,method:t.toUpperCase(),headers:u.normalize().toJSON(),body:i,duplex:"half",credentials:N?p:void 0});let R=await fetch(C);const v=mi&&(h==="stream"||h==="response");if(mi&&(l||v&&w)){const F={};["status","statusText","headers"].forEach(we=>{F[we]=R[we]});const z=E.toFiniteNumber(R.headers.get("content-length")),[re,q]=l&&Cr(z,En(Rr(l),!0))||[];R=new Response(Ar(R.body,Nr,re,()=>{q&&q(),w&&w()}),F)}h=h||"text";let L=await Tn[E.findKey(Tn,h)||"text"](R,n);return!v&&w&&w(),await new Promise((F,z)=>{zs(F,z,{data:L,headers:ce.from(R.headers),status:R.status,statusText:R.statusText,config:n,request:C})})}catch(N){throw w&&w(),N&&N.name==="TypeError"&&/fetch/i.test(N.message)?Object.assign(new O("Network Error",O.ERR_NETWORK,n,C),{cause:N.cause||N}):O.from(N,N&&N.code,n,C)}}),pi={http:pu,xhr:Wu,fetch:el};E.forEach(pi,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const vr=n=>`- ${n}`,tl=n=>E.isFunction(n)||n===null||n===!1,eo={getAdapter:n=>{n=E.isArray(n)?n:[n];const{length:e}=n;let t,i;const r={};for(let s=0;s<e;s++){t=n[s];let o;if(i=t,!tl(t)&&(i=pi[(o=String(t)).toLowerCase()],i===void 0))throw new O(`Unknown adapter '${o}'`);if(i)break;r[o||"#"+s]=i}if(!i){const s=Object.entries(r).map(([l,f])=>`adapter ${l} `+(f===!1?"is not supported by the environment":"is not available in the build"));let o=e?s.length>1?`since :
`+s.map(vr).join(`
`):" "+vr(s[0]):"as no adapter specified";throw new O("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return i},adapters:pi};function jn(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new St(null,n)}function Or(n){return jn(n),n.headers=ce.from(n.headers),n.data=Jn.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),eo.getAdapter(n.adapter||qt.adapter)(n).then(function(i){return jn(n),i.data=Jn.call(n,n.transformResponse,i),i.headers=ce.from(i.headers),i},function(i){return Gs(i)||(jn(n),i&&i.response&&(i.response.data=Jn.call(n,n.transformResponse,i.response),i.response.headers=ce.from(i.response.headers))),Promise.reject(i)})}const to="1.7.7",Li={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{Li[n]=function(i){return typeof i===n||"a"+(e<1?"n ":" ")+n}});const xr={};Li.transitional=function(e,t,i){function r(s,o){return"[Axios v"+to+"] Transitional option '"+s+"'"+o+(i?". "+i:"")}return(s,o,l)=>{if(e===!1)throw new O(r(o," has been removed"+(t?" in "+t:"")),O.ERR_DEPRECATED);return t&&!xr[o]&&(xr[o]=!0,console.warn(r(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(s,o,l):!0}};function nl(n,e,t){if(typeof n!="object")throw new O("options must be an object",O.ERR_BAD_OPTION_VALUE);const i=Object.keys(n);let r=i.length;for(;r-- >0;){const s=i[r],o=e[s];if(o){const l=n[s],f=l===void 0||o(l,s,n);if(f!==!0)throw new O("option "+s+" must be "+f,O.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new O("Unknown option "+s,O.ERR_BAD_OPTION)}}const gi={assertOptions:nl,validators:Li},Le=gi.validators;class Ge{constructor(e){this.defaults=e,this.interceptors={request:new br,response:new br}}async request(e,t){try{return await this._request(e,t)}catch(i){if(i instanceof Error){let r;Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error;const s=r.stack?r.stack.replace(/^.+\n/,""):"";try{i.stack?s&&!String(i.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+s):i.stack=s}catch{}}throw i}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Ye(this.defaults,t);const{transitional:i,paramsSerializer:r,headers:s}=t;i!==void 0&&gi.assertOptions(i,{silentJSONParsing:Le.transitional(Le.boolean),forcedJSONParsing:Le.transitional(Le.boolean),clarifyTimeoutError:Le.transitional(Le.boolean)},!1),r!=null&&(E.isFunction(r)?t.paramsSerializer={serialize:r}:gi.assertOptions(r,{encode:Le.function,serialize:Le.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=s&&E.merge(s.common,s[t.method]);s&&E.forEach(["delete","get","head","post","put","patch","common"],C=>{delete s[C]}),t.headers=ce.concat(o,s);const l=[];let f=!0;this.interceptors.request.forEach(function(w){typeof w.runWhen=="function"&&w.runWhen(t)===!1||(f=f&&w.synchronous,l.unshift(w.fulfilled,w.rejected))});const h=[];this.interceptors.response.forEach(function(w){h.push(w.fulfilled,w.rejected)});let u,p=0,_;if(!f){const C=[Or.bind(this),void 0];for(C.unshift.apply(C,l),C.push.apply(C,h),_=C.length,u=Promise.resolve(t);p<_;)u=u.then(C[p++],C[p++]);return u}_=l.length;let I=t;for(p=0;p<_;){const C=l[p++],w=l[p++];try{I=C(I)}catch(T){w.call(this,T);break}}try{u=Or.call(this,I)}catch(C){return Promise.reject(C)}for(p=0,_=h.length;p<_;)u=u.then(h[p++],h[p++]);return u}getUri(e){e=Ye(this.defaults,e);const t=Ys(e.baseURL,e.url);return Ws(t,e.params,e.paramsSerializer)}}E.forEach(["delete","get","head","options"],function(e){Ge.prototype[e]=function(t,i){return this.request(Ye(i||{},{method:e,url:t,data:(i||{}).data}))}});E.forEach(["post","put","patch"],function(e){function t(i){return function(s,o,l){return this.request(Ye(l||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}Ge.prototype[e]=t(),Ge.prototype[e+"Form"]=t(!0)});class Fi{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(s){t=s});const i=this;this.promise.then(r=>{if(!i._listeners)return;let s=i._listeners.length;for(;s-- >0;)i._listeners[s](r);i._listeners=null}),this.promise.then=r=>{let s;const o=new Promise(l=>{i.subscribe(l),s=l}).then(r);return o.cancel=function(){i.unsubscribe(s)},o},e(function(s,o,l){i.reason||(i.reason=new St(s,o,l),t(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=i=>{e.abort(i)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new Fi(function(r){e=r}),cancel:e}}}function il(n){return function(t){return n.apply(null,t)}}function rl(n){return E.isObject(n)&&n.isAxiosError===!0}const _i={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(_i).forEach(([n,e])=>{_i[e]=n});function no(n){const e=new Ge(n),t=Os(Ge.prototype.request,e);return E.extend(t,Ge.prototype,e,{allOwnKeys:!0}),E.extend(t,e,null,{allOwnKeys:!0}),t.create=function(r){return no(Ye(n,r))},t}const X=no(qt);X.Axios=Ge;X.CanceledError=St;X.CancelToken=Fi;X.isCancel=Gs;X.VERSION=to;X.toFormData=On;X.AxiosError=O;X.Cancel=X.CanceledError;X.all=function(e){return Promise.all(e)};X.spread=il;X.isAxiosError=rl;X.mergeConfig=Ye;X.AxiosHeaders=ce;X.formToJSON=n=>js(E.isHTMLForm(n)?new FormData(n):n);X.getAdapter=eo.getAdapter;X.HttpStatusCode=_i;X.default=X;const Mi=new URLSearchParams(globalThis.window?window.location.search:"");function Fe(n,e){const t=Mi.get(n);if(t==null||t===""){if(e===void 0)throw new Error("Missing required url query parameter (string): "+n);return B("Using default value for string url query parameter: "+n+"="+e),e}return t}function Pr(n,e){const t=Mi.get(n);return t==null||t===""?(B("Using default value for bool url query parameter: "+n+"="+e),e):t.toLowerCase()!=="false"}function Lr(n,e){const t=Mi.get(n);if(t==null||t===""){if(e===void 0)throw new Error("Missing required integer url query parameter (integer): "+n);return B("Using default value for integer url query parameter: "+n+"="+e),e}try{return parseInt(t)}catch{throw new Error(`Error parsing integer url query parameter: ${n}=${t}`)}}const U={DEBUG_MODE:Pr("DEBUG_MODE",!1),SEND_LOGS:Pr("SEND_LOGS",!1),ROV_NAME:Fe("ROV_NAME","Default-ROV"),ROV_CONTROL_PASSWORD:Fe("ROV_CONTROL_PASSWORD",""),LIVEKIT_API_KEY:Fe("LIVEKIT_API_KEY"),LIVEKIT_SECRET_KEY:Fe("LIVEKIT_SECRET_KEY"),TWITCH_STREAM_KEY:Fe("TWITCH_STREAM_KEY","None"),PYTHON_WEBSOCKET_PORT:Lr("PYTHON_WEBSOCKET_PORT",0),AUTH_TOKEN_TIMEOUT:Lr("AUTH_TOKEN_TIMEOUT",Qa),BLUEOS_APIS_ENDPOINT:Fe("BLUEOS_APIS_ENDPOINT",""),LIVEKIT_CLOUD_ENDPOINT:Fe("LIVEKIT_CLOUD_URL","https://rov-web.livekit.cloud"),LIVEKIT_LOCAL_ENDPOINT:Fe("LIVEKIT_LOCAL_URL","http://localhost:7880")},sl="/commander/v1.0";async function Fr(n){return X({method:"post",url:`${U.BLUEOS_APIS_ENDPOINT+sl}/shutdown`,timeout:5e3,withCredentials:!1,params:{shutdown_type:n,i_know_what_i_am_doing:!0}}).then(e=>e.data).then(e=>"Shutting Down... "+String(e)).catch(e=>{var i;if(e.code==="ECONNABORTED")return"Shutting Down... ";const t=`Could not execute shutdown: ${e.code} - ${e.message} - ${e.message??((i=e.response)==null?void 0:i.data)}.`;throw logWarn(t),new Error(t)})}function G(n,e){if(!n)throw new Error(e)}const ol=34028234663852886e22,al=-34028234663852886e22,cl=4294967295,ul=2147483647,ll=-2147483648;function hn(n){if(typeof n!="number")throw new Error("invalid int 32: "+typeof n);if(!Number.isInteger(n)||n>ul||n<ll)throw new Error("invalid int 32: "+n)}function yi(n){if(typeof n!="number")throw new Error("invalid uint 32: "+typeof n);if(!Number.isInteger(n)||n>cl||n<0)throw new Error("invalid uint 32: "+n)}function io(n){if(typeof n!="number")throw new Error("invalid float 32: "+typeof n);if(Number.isFinite(n)&&(n>ol||n<al))throw new Error("invalid float 32: "+n)}const ro=Symbol("@bufbuild/protobuf/enum-type");function dl(n){const e=n[ro];return G(e,"missing enum type on enum object"),e}function so(n,e,t,i){n[ro]=oo(e,t.map(r=>({no:r.no,name:r.name,localName:n[r.no]})))}function oo(n,e,t){const i=Object.create(null),r=Object.create(null),s=[];for(const o of e){const l=ao(o);s.push(l),i[o.name]=l,r[o.no]=l}return{typeName:n,values:s,findName(o){return i[o]},findNumber(o){return r[o]}}}function hl(n,e,t){const i={};for(const r of e){const s=ao(r);i[s.localName]=s.no,i[s.no]=s.localName}return so(i,n,e),i}function ao(n){return"localName"in n?n:Object.assign(Object.assign({},n),{localName:n.name})}class co{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const i=this.getType(),r=i.runtime.bin,s=r.makeReadOptions(t);return r.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,t){const i=this.getType(),r=i.runtime.json,s=r.makeReadOptions(t);return r.readMessage(i,e,s,this),this}fromJsonString(e,t){let i;try{i=JSON.parse(e)}catch(r){throw new Error(`cannot decode ${this.getType().typeName} from JSON: ${r instanceof Error?r.message:String(r)}`)}return this.fromJson(i,t)}toBinary(e){const t=this.getType(),i=t.runtime.bin,r=i.makeWriteOptions(e),s=r.writerFactory();return i.writeMessage(this,s,r),s.finish()}toJson(e){const t=this.getType(),i=t.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var t;const i=this.toJson(e);return JSON.stringify(i,null,(t=e==null?void 0:e.prettySpaces)!==null&&t!==void 0?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function fl(n,e,t,i){var r;const s=(r=i==null?void 0:i.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),o={[s]:function(l){n.util.initFields(this),n.util.initPartial(l,this)}}[s];return Object.setPrototypeOf(o.prototype,new co),Object.assign(o,{runtime:n,typeName:e,fields:n.util.newFieldList(t),fromBinary(l,f){return new o().fromBinary(l,f)},fromJson(l,f){return new o().fromJson(l,f)},fromJsonString(l,f){return new o().fromJsonString(l,f)},equals(l,f){return n.util.equals(o,l,f)}}),o}function ml(){let n=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(n|=(r&127)<<i,!(r&128))return this.assertBounds(),[n,e]}let t=this.buf[this.pos++];if(n|=(t&15)<<28,e=(t&112)>>4,!(t&128))return this.assertBounds(),[n,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,!(r&128))return this.assertBounds(),[n,e]}throw new Error("invalid varint")}function Gn(n,e,t){for(let s=0;s<28;s=s+7){const o=n>>>s,l=!(!(o>>>7)&&e==0),f=(l?o|128:o)&255;if(t.push(f),!l)return}const i=n>>>28&15|(e&7)<<4,r=!!(e>>3);if(t.push((r?i|128:i)&255),!!r){for(let s=3;s<31;s=s+7){const o=e>>>s,l=!!(o>>>7),f=(l?o|128:o)&255;if(t.push(f),!l)return}t.push(e>>>31&1)}}const fn=4294967296;function Mr(n){const e=n[0]==="-";e&&(n=n.slice(1));const t=1e6;let i=0,r=0;function s(o,l){const f=Number(n.slice(o,l));r*=t,i=i*t+f,i>=fn&&(r=r+(i/fn|0),i=i%fn)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?lo(i,r):Di(i,r)}function pl(n,e){let t=Di(n,e);const i=t.hi&2147483648;i&&(t=lo(t.lo,t.hi));const r=uo(t.lo,t.hi);return i?"-"+r:r}function uo(n,e){if({lo:n,hi:e}=gl(n,e),e<=2097151)return String(fn*e+n);const t=n&16777215,i=(n>>>24|e<<8)&16777215,r=e>>16&65535;let s=t+i*6777216+r*6710656,o=i+r*8147497,l=r*2;const f=1e7;return s>=f&&(o+=Math.floor(s/f),s%=f),o>=f&&(l+=Math.floor(o/f),o%=f),l.toString()+Dr(o)+Dr(s)}function gl(n,e){return{lo:n>>>0,hi:e>>>0}}function Di(n,e){return{lo:n|0,hi:e|0}}function lo(n,e){return e=~e,n?n=~n+1:e+=1,Di(n,e)}const Dr=n=>{const e=String(n);return"0000000".slice(e.length)+e};function Br(n,e){if(n>=0){for(;n>127;)e.push(n&127|128),n=n>>>7;e.push(n)}else{for(let t=0;t<9;t++)e.push(n&127|128),n=n>>7;e.push(1)}}function _l(){let n=this.buf[this.pos++],e=n&127;if(!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<7,!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<14,!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<21,!(n&128))return this.assertBounds(),e;n=this.buf[this.pos++],e|=(n&15)<<28;for(let t=5;n&128&&t<10;t++)n=this.buf[this.pos++];if(n&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}var Ur={};function yl(){const n=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"&&(typeof Pt!="object"||typeof Ur!="object"||Ur.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),o=BigInt("0"),l=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(f){const h=typeof f=="bigint"?f:BigInt(f);if(h>s||h<r)throw new Error(`int64 invalid: ${f}`);return h},uParse(f){const h=typeof f=="bigint"?f:BigInt(f);if(h>l||h<o)throw new Error(`uint64 invalid: ${f}`);return h},enc(f){return n.setBigInt64(0,this.parse(f),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},uEnc(f){return n.setBigInt64(0,this.uParse(f),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},dec(f,h){return n.setInt32(0,f,!0),n.setInt32(4,h,!0),n.getBigInt64(0,!0)},uDec(f,h){return n.setInt32(0,f,!0),n.setInt32(4,h,!0),n.getBigUint64(0,!0)}}}const t=r=>G(/^-?[0-9]+$/.test(r),`int64 invalid: ${r}`),i=r=>G(/^[0-9]+$/.test(r),`uint64 invalid: ${r}`);return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),t(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),t(r),Mr(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),Mr(r)},dec(r,s){return pl(r,s)},uDec(r,s){return uo(r,s)}}}const ue=yl();var b;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(b||(b={}));var Ue;(function(n){n[n.BIGINT=0]="BIGINT",n[n.STRING=1]="STRING"})(Ue||(Ue={}));function Me(n,e,t){if(e===t)return!0;if(n==b.BYTES){if(!(e instanceof Uint8Array)||!(t instanceof Uint8Array)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}switch(n){case b.UINT64:case b.FIXED64:case b.INT64:case b.SFIXED64:case b.SINT64:return e==t}return!1}function yt(n,e){switch(n){case b.BOOL:return!1;case b.UINT64:case b.FIXED64:case b.INT64:case b.SFIXED64:case b.SINT64:return e==0?ue.zero:"0";case b.DOUBLE:case b.FLOAT:return 0;case b.BYTES:return new Uint8Array(0);case b.STRING:return"";default:return 0}}function ho(n,e){switch(n){case b.BOOL:return e===!1;case b.STRING:return e==="";case b.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var Y;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32"})(Y||(Y={}));class El{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let t=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)t.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(yi(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return hn(e),Br(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){io(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){yi(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){hn(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return hn(e),e=(e<<1^e>>31)>>>0,Br(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),r=ue.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),r=ue.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(t)}int64(e){let t=ue.enc(e);return Gn(t.lo,t.hi,this.buf),this}sint64(e){let t=ue.enc(e),i=t.hi>>31,r=t.lo<<1^i,s=(t.hi<<1|t.lo>>>31)^i;return Gn(r,s,this.buf),this}uint64(e){let t=ue.uEnc(e);return Gn(t.lo,t.hi,this.buf),this}}class Tl{constructor(e,t){this.varint64=ml,this.uint32=_l,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t??new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,i=e&7;if(t<=0||i<0||i>5)throw new Error("illegal tag: field no "+t+" wire type "+i);return[t,i]}skip(e,t){let i=this.pos;switch(e){case Y.Varint:for(;this.buf[this.pos++]&128;);break;case Y.Bit64:this.pos+=4;case Y.Bit32:this.pos+=4;break;case Y.LengthDelimited:let r=this.uint32();this.pos+=r;break;case Y.StartGroup:for(;;){const[s,o]=this.tag();if(o===Y.EndGroup){if(t!==void 0&&s!==t)throw new Error("invalid end group tag");break}this.skip(o,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return ue.dec(...this.varint64())}uint64(){return ue.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),i=-(e&1);return e=(e>>>1|(t&1)<<31)^i,t=t>>>1^i,ue.dec(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return ue.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return ue.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function wl(n,e,t,i){let r;return{typeName:e,extendee:t,get field(){if(!r){const s=typeof i=="function"?i():i;s.name=e.split(".").pop(),s.jsonName=`[${e}]`,r=n.util.newFieldList([s]).list()[0]}return r},runtime:n}}function fo(n){const e=n.field.localName,t=Object.create(null);return t[e]=Sl(n),[t,()=>t[e]]}function Sl(n){const e=n.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return yt(e.T,e.L);case"message":const t=e.T,i=new t;return t.fieldWrapper?t.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function bl(n,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let t=n.length-1;t>=0;--t)if(n[t].no==e.no)return[n[t]];return[]}return n.filter(t=>t.no===e.no)}let Re="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Pn=[];for(let n=0;n<Re.length;n++)Pn[Re[n].charCodeAt(0)]=n;Pn[45]=Re.indexOf("+");Pn[95]=Re.indexOf("/");const mo={dec(n){let e=n.length*3/4;n[n.length-2]=="="?e-=2:n[n.length-1]=="="&&(e-=1);let t=new Uint8Array(e),i=0,r=0,s,o=0;for(let l=0;l<n.length;l++){if(s=Pn[n.charCodeAt(l)],s===void 0)switch(n[l]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:o=s,r=1;break;case 1:t[i++]=o<<2|(s&48)>>4,o=s,r=2;break;case 2:t[i++]=(o&15)<<4|(s&60)>>2,o=s,r=3;break;case 3:t[i++]=(o&3)<<6|s,r=0;break}}if(r==1)throw Error("invalid base64 string.");return t.subarray(0,i)},enc(n){let e="",t=0,i,r=0;for(let s=0;s<n.length;s++)switch(i=n[s],t){case 0:e+=Re[i>>2],r=(i&3)<<4,t=1;break;case 1:e+=Re[r|i>>4],r=(i&15)<<2,t=2;break;case 2:e+=Re[r|i>>6],e+=Re[i&63],t=0;break}return t&&(e+=Re[r],e+="=",t==1&&(e+="=")),e}};function kl(n,e,t){go(e,n);const i=e.runtime.bin.makeReadOptions(t),r=bl(n.getType().runtime.bin.listUnknownFields(n),e.field),[s,o]=fo(e);for(const l of r)e.runtime.bin.readField(s,i.readerFactory(l.data),e.field,l.wireType,i);return o()}function Cl(n,e,t,i){go(e,n);const r=e.runtime.bin.makeReadOptions(i),s=e.runtime.bin.makeWriteOptions(i);if(po(n,e)){const h=n.getType().runtime.bin.listUnknownFields(n).filter(u=>u.no!=e.field.no);n.getType().runtime.bin.discardUnknownFields(n);for(const u of h)n.getType().runtime.bin.onUnknownField(n,u.no,u.wireType,u.data)}const o=s.writerFactory();let l=e.field;!l.opt&&!l.repeated&&(l.kind=="enum"||l.kind=="scalar")&&(l=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(l,t,o,s);const f=r.readerFactory(o.finish());for(;f.pos<f.len;){const[h,u]=f.tag(),p=f.skip(u,h);n.getType().runtime.bin.onUnknownField(n,h,u,p)}}function po(n,e){const t=n.getType();return e.extendee.typeName===t.typeName&&!!t.runtime.bin.listUnknownFields(n).find(i=>i.no==e.field.no)}function go(n,e){G(n.extendee.typeName==e.getType().typeName,`extension ${n.typeName} can only be applied to message ${n.extendee.typeName}`)}function _o(n,e){const t=n.localName;if(n.repeated)return e[t].length>0;if(n.oneof)return e[n.oneof.localName].case===t;switch(n.kind){case"enum":case"scalar":return n.opt||n.req?e[t]!==void 0:n.kind=="enum"?e[t]!==n.T.values[0].no:!ho(n.T,e[t]);case"message":return e[t]!==void 0;case"map":return Object.keys(e[t]).length>0}}function Kr(n,e){const t=n.localName,i=!n.opt&&!n.req;if(n.repeated)e[t]=[];else if(n.oneof)e[n.oneof.localName]={case:void 0};else switch(n.kind){case"map":e[t]={};break;case"enum":e[t]=i?n.T.values[0].no:void 0;break;case"scalar":e[t]=i?yt(n.T,n.L):void 0;break;case"message":e[t]=void 0;break}}function ze(n,e){if(n===null||typeof n!="object"||!Object.getOwnPropertyNames(co.prototype).every(i=>i in n&&typeof n[i]=="function"))return!1;const t=n.getType();return t===null||typeof t!="function"||!("typeName"in t)||typeof t.typeName!="string"?!1:e===void 0?!0:t.typeName==e.typeName}function yo(n,e){return ze(e)||!n.fieldWrapper?e:n.fieldWrapper.wrapField(e)}b.DOUBLE,b.FLOAT,b.INT64,b.UINT64,b.INT32,b.UINT32,b.BOOL,b.STRING,b.BYTES;const Vr={ignoreUnknownFields:!1},qr={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function Rl(n){return n?Object.assign(Object.assign({},Vr),n):Vr}function Il(n){return n?Object.assign(Object.assign({},qr),n):qr}const wn=Symbol(),mn=Symbol();function Al(){return{makeReadOptions:Rl,makeWriteOptions:Il,readMessage(n,e,t,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error(`cannot decode message ${n.typeName} from JSON: ${ye(e)}`);i=i??new n;const r=new Map,s=t.typeRegistry;for(const[o,l]of Object.entries(e)){const f=n.fields.findJsonName(o);if(f){if(f.oneof){if(l===null&&f.kind=="scalar")continue;const h=r.get(f.oneof);if(h!==void 0)throw new Error(`cannot decode message ${n.typeName} from JSON: multiple keys for oneof "${f.oneof.name}" present: "${h}", "${o}"`);r.set(f.oneof,o)}Hr(i,l,f,t,n)}else{let h=!1;if(s!=null&&s.findExtension&&o.startsWith("[")&&o.endsWith("]")){const u=s.findExtension(o.substring(1,o.length-1));if(u&&u.extendee.typeName==n.typeName){h=!0;const[p,_]=fo(u);Hr(p,l,u.field,t,u),Cl(i,u,_(),t)}}if(!h&&!t.ignoreUnknownFields)throw new Error(`cannot decode message ${n.typeName} from JSON: key "${o}" is unknown`)}}return i},writeMessage(n,e){const t=n.getType(),i={};let r;try{for(r of t.fields.byNumber()){if(!_o(r,n)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!vl(r))continue}const o=r.oneof?n[r.oneof.localName].value:n[r.localName],l=$r(r,o,e);l!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=l)}const s=e.typeRegistry;if(s!=null&&s.findExtensionFor)for(const o of t.runtime.bin.listUnknownFields(n)){const l=s.findExtensionFor(t.typeName,o.no);if(l&&po(n,l)){const f=kl(n,l,e),h=$r(l.field,f,e);h!==void 0&&(i[l.field.jsonName]=h)}}}catch(s){const o=r?`cannot encode field ${t.typeName}.${r.name} to JSON`:`cannot encode message ${t.typeName} to JSON`,l=s instanceof Error?s.message:String(s);throw new Error(o+(l.length>0?`: ${l}`:""))}return i},readScalar(n,e,t){return Ot(n,e,t??Ue.BIGINT,!0)},writeScalar(n,e,t){if(e!==void 0&&(t||ho(n,e)))return pn(n,e)},debug:ye}}function ye(n){if(n===null)return"null";switch(typeof n){case"object":return Array.isArray(n)?"array":"object";case"string":return n.length>100?"string":`"${n.split('"').join('\\"')}"`;default:return String(n)}}function Hr(n,e,t,i,r){let s=t.localName;if(t.repeated){if(G(t.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error(`cannot decode field ${r.typeName}.${t.name} from JSON: ${ye(e)}`);const o=n[s];for(const l of e){if(l===null)throw new Error(`cannot decode field ${r.typeName}.${t.name} from JSON: ${ye(l)}`);switch(t.kind){case"message":o.push(t.T.fromJson(l,i));break;case"enum":const f=zn(t.T,l,i.ignoreUnknownFields,!0);f!==mn&&o.push(f);break;case"scalar":try{o.push(Ot(t.T,l,t.L,!0))}catch(h){let u=`cannot decode field ${r.typeName}.${t.name} from JSON: ${ye(l)}`;throw h instanceof Error&&h.message.length>0&&(u+=`: ${h.message}`),new Error(u)}break}}}else if(t.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error(`cannot decode field ${r.typeName}.${t.name} from JSON: ${ye(e)}`);const o=n[s];for(const[l,f]of Object.entries(e)){if(f===null)throw new Error(`cannot decode field ${r.typeName}.${t.name} from JSON: map value null`);let h;try{h=Nl(t.K,l)}catch(u){let p=`cannot decode map key for field ${r.typeName}.${t.name} from JSON: ${ye(e)}`;throw u instanceof Error&&u.message.length>0&&(p+=`: ${u.message}`),new Error(p)}switch(t.V.kind){case"message":o[h]=t.V.T.fromJson(f,i);break;case"enum":const u=zn(t.V.T,f,i.ignoreUnknownFields,!0);u!==mn&&(o[h]=u);break;case"scalar":try{o[h]=Ot(t.V.T,f,Ue.BIGINT,!0)}catch(p){let _=`cannot decode map value for field ${r.typeName}.${t.name} from JSON: ${ye(e)}`;throw p instanceof Error&&p.message.length>0&&(_+=`: ${p.message}`),new Error(_)}break}}}else switch(t.oneof&&(n=n[t.oneof.localName]={case:s},s="value"),t.kind){case"message":const o=t.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let l=n[s];ze(l)?l.fromJson(e,i):(n[s]=l=o.fromJson(e,i),o.fieldWrapper&&!t.oneof&&(n[s]=o.fieldWrapper.unwrapField(l)));break;case"enum":const f=zn(t.T,e,i.ignoreUnknownFields,!1);switch(f){case wn:Kr(t,n);break;case mn:break;default:n[s]=f;break}break;case"scalar":try{const h=Ot(t.T,e,t.L,!1);switch(h){case wn:Kr(t,n);break;default:n[s]=h;break}}catch(h){let u=`cannot decode field ${r.typeName}.${t.name} from JSON: ${ye(e)}`;throw h instanceof Error&&h.message.length>0&&(u+=`: ${h.message}`),new Error(u)}break}}function Nl(n,e){if(n===b.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Ot(n,e,Ue.BIGINT,!0).toString()}function Ot(n,e,t,i){if(e===null)return i?yt(n,t):wn;switch(n){case b.DOUBLE:case b.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return n==b.FLOAT&&io(r),r;case b.INT32:case b.FIXED32:case b.SFIXED32:case b.SINT32:case b.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return n==b.UINT32||n==b.FIXED32?yi(s):hn(s),s;case b.INT64:case b.SFIXED64:case b.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=ue.parse(e);return t?o.toString():o;case b.FIXED64:case b.UINT64:if(typeof e!="number"&&typeof e!="string")break;const l=ue.uParse(e);return t?l.toString():l;case b.BOOL:if(typeof e!="boolean")break;return e;case b.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case b.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return mo.dec(e)}throw new Error}function zn(n,e,t,i){if(e===null)return n.typeName=="google.protobuf.NullValue"?0:i?n.values[0].no:wn;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=n.findName(e);if(r!==void 0)return r.no;if(t)return mn;break}throw new Error(`cannot decode enum ${n.typeName} from JSON: ${ye(e)}`)}function vl(n){return n.repeated||n.kind=="map"?!0:!(n.oneof||n.kind=="message"||n.opt||n.req)}function $r(n,e,t){if(n.kind=="map"){G(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(n.V.kind){case"scalar":for(const[o,l]of r)i[o.toString()]=pn(n.V.T,l);break;case"message":for(const[o,l]of r)i[o.toString()]=l.toJson(t);break;case"enum":const s=n.V.T;for(const[o,l]of r)i[o.toString()]=Yn(s,l,t.enumAsInteger);break}return t.emitDefaultValues||r.length>0?i:void 0}if(n.repeated){G(Array.isArray(e));const i=[];switch(n.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(pn(n.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(Yn(n.T,e[r],t.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(t));break}return t.emitDefaultValues||i.length>0?i:void 0}switch(n.kind){case"scalar":return pn(n.T,e);case"enum":return Yn(n.T,e,t.enumAsInteger);case"message":return yo(n.T,e).toJson(t)}}function Yn(n,e,t){var i;if(G(typeof e=="number"),n.typeName=="google.protobuf.NullValue")return null;if(t)return e;const r=n.findNumber(e);return(i=r==null?void 0:r.name)!==null&&i!==void 0?i:e}function pn(n,e){switch(n){case b.INT32:case b.SFIXED32:case b.SINT32:case b.FIXED32:case b.UINT32:return G(typeof e=="number"),e;case b.FLOAT:case b.DOUBLE:return G(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case b.STRING:return G(typeof e=="string"),e;case b.BOOL:return G(typeof e=="boolean"),e;case b.UINT64:case b.FIXED64:case b.INT64:case b.SFIXED64:case b.SINT64:return G(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case b.BYTES:return G(e instanceof Uint8Array),mo.enc(e)}}const at=Symbol("@bufbuild/protobuf/unknown-fields"),Wr={readUnknownFields:!0,readerFactory:n=>new Tl(n)},Jr={writeUnknownFields:!0,writerFactory:()=>new El};function Ol(n){return n?Object.assign(Object.assign({},Wr),n):Wr}function xl(n){return n?Object.assign(Object.assign({},Jr),n):Jr}function Pl(){return{makeReadOptions:Ol,makeWriteOptions:xl,listUnknownFields(n){var e;return(e=n[at])!==null&&e!==void 0?e:[]},discardUnknownFields(n){delete n[at]},writeUnknownFields(n,e){const i=n[at];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(n,e,t,i){const r=n;Array.isArray(r[at])||(r[at]=[]),r[at].push({no:e,wireType:t,data:i})},readMessage(n,e,t,i,r){const s=n.getType(),o=r?e.len:e.pos+t;let l,f;for(;e.pos<o&&([l,f]=e.tag(),!(r===!0&&f==Y.EndGroup));){const h=s.fields.find(l);if(!h){const u=e.skip(f,l);i.readUnknownFields&&this.onUnknownField(n,l,f,u);continue}jr(n,e,h,f,i)}if(r&&(f!=Y.EndGroup||l!==t))throw new Error("invalid end group tag")},readField:jr,writeMessage(n,e,t){const i=n.getType();for(const r of i.fields.byNumber()){if(!_o(r,n)){if(r.req)throw new Error(`cannot encode field ${i.typeName}.${r.name} to binary: required field not set`);continue}const s=r.oneof?n[r.oneof.localName].value:n[r.localName];Gr(r,s,e,t)}return t.writeUnknownFields&&this.writeUnknownFields(n,e),e},writeField(n,e,t,i){e!==void 0&&Gr(n,e,t,i)}}}function jr(n,e,t,i,r){let{repeated:s,localName:o}=t;switch(t.oneof&&(n=n[t.oneof.localName],n.case!=o&&delete n.value,n.case=o,o="value"),t.kind){case"scalar":case"enum":const l=t.kind=="enum"?b.INT32:t.T;let f=Sn;if(t.kind=="scalar"&&t.L>0&&(f=Fl),s){let _=n[o];if(i==Y.LengthDelimited&&l!=b.STRING&&l!=b.BYTES){let C=e.uint32()+e.pos;for(;e.pos<C;)_.push(f(e,l))}else _.push(f(e,l))}else n[o]=f(e,l);break;case"message":const h=t.T;s?n[o].push(gn(e,new h,r,t)):ze(n[o])?gn(e,n[o],r,t):(n[o]=gn(e,new h,r,t),h.fieldWrapper&&!t.oneof&&!t.repeated&&(n[o]=h.fieldWrapper.unwrapField(n[o])));break;case"map":let[u,p]=Ll(t,e,r);n[o][u]=p;break}}function gn(n,e,t,i){const r=e.getType().runtime.bin,s=i==null?void 0:i.delimited;return r.readMessage(e,n,s?i.no:n.uint32(),t,s),e}function Ll(n,e,t){const i=e.uint32(),r=e.pos+i;let s,o;for(;e.pos<r;){const[l]=e.tag();switch(l){case 1:s=Sn(e,n.K);break;case 2:switch(n.V.kind){case"scalar":o=Sn(e,n.V.T);break;case"enum":o=e.int32();break;case"message":o=gn(e,new n.V.T,t,void 0);break}break}}if(s===void 0&&(s=yt(n.K,Ue.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),o===void 0)switch(n.V.kind){case"scalar":o=yt(n.V.T,Ue.BIGINT);break;case"enum":o=n.V.T.values[0].no;break;case"message":o=new n.V.T;break}return[s,o]}function Fl(n,e){const t=Sn(n,e);return typeof t=="bigint"?t.toString():t}function Sn(n,e){switch(e){case b.STRING:return n.string();case b.BOOL:return n.bool();case b.DOUBLE:return n.double();case b.FLOAT:return n.float();case b.INT32:return n.int32();case b.INT64:return n.int64();case b.UINT64:return n.uint64();case b.FIXED64:return n.fixed64();case b.BYTES:return n.bytes();case b.FIXED32:return n.fixed32();case b.SFIXED32:return n.sfixed32();case b.SFIXED64:return n.sfixed64();case b.SINT64:return n.sint64();case b.UINT32:return n.uint32();case b.SINT32:return n.sint32()}}function Gr(n,e,t,i){G(e!==void 0);const r=n.repeated;switch(n.kind){case"scalar":case"enum":let s=n.kind=="enum"?b.INT32:n.T;if(r)if(G(Array.isArray(e)),n.packed)Dl(t,s,n.no,e);else for(const o of e)xt(t,s,n.no,o);else xt(t,s,n.no,e);break;case"message":if(r){G(Array.isArray(e));for(const o of e)zr(t,i,n,o)}else zr(t,i,n,e);break;case"map":G(typeof e=="object"&&e!=null);for(const[o,l]of Object.entries(e))Ml(t,i,n,o,l);break}}function Ml(n,e,t,i,r){n.tag(t.no,Y.LengthDelimited),n.fork();let s=i;switch(t.K){case b.INT32:case b.FIXED32:case b.UINT32:case b.SFIXED32:case b.SINT32:s=Number.parseInt(i);break;case b.BOOL:G(i=="true"||i=="false"),s=i=="true";break}switch(xt(n,t.K,1,s),t.V.kind){case"scalar":xt(n,t.V.T,2,r);break;case"enum":xt(n,b.INT32,2,r);break;case"message":G(r!==void 0),n.tag(2,Y.LengthDelimited).bytes(r.toBinary(e));break}n.join()}function zr(n,e,t,i){const r=yo(t.T,i);t.delimited?n.tag(t.no,Y.StartGroup).raw(r.toBinary(e)).tag(t.no,Y.EndGroup):n.tag(t.no,Y.LengthDelimited).bytes(r.toBinary(e))}function xt(n,e,t,i){G(i!==void 0);let[r,s]=Eo(e);n.tag(t,r)[s](i)}function Dl(n,e,t,i){if(!i.length)return;n.tag(t,Y.LengthDelimited).fork();let[,r]=Eo(e);for(let s=0;s<i.length;s++)n[r](i[s]);n.join()}function Eo(n){let e=Y.Varint;switch(n){case b.BYTES:case b.STRING:e=Y.LengthDelimited;break;case b.DOUBLE:case b.FIXED64:case b.SFIXED64:e=Y.Bit64;break;case b.FIXED32:case b.SFIXED32:case b.FLOAT:e=Y.Bit32;break}const t=b[n].toLowerCase();return[e,t]}function Bl(){return{setEnumType:so,initPartial(n,e){if(n===void 0)return;const t=e.getType();for(const i of t.fields.byMember()){const r=i.localName,s=e,o=n;if(o[r]!=null)switch(i.kind){case"oneof":const l=o[r].case;if(l===void 0)continue;const f=i.findField(l);let h=o[r].value;f&&f.kind=="message"&&!ze(h,f.T)?h=new f.T(h):f&&f.kind==="scalar"&&f.T===b.BYTES&&(h=It(h)),s[r]={case:l,value:h};break;case"scalar":case"enum":let u=o[r];i.T===b.BYTES&&(u=i.repeated?u.map(It):It(u)),s[r]=u;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===b.BYTES)for(const[I,C]of Object.entries(o[r]))s[r][I]=It(C);else Object.assign(s[r],o[r]);break;case"message":const _=i.V.T;for(const I of Object.keys(o[r])){let C=o[r][I];_.fieldWrapper||(C=new _(C)),s[r][I]=C}break}break;case"message":const p=i.T;if(i.repeated)s[r]=o[r].map(_=>ze(_,p)?_:new p(_));else{const _=o[r];p.fieldWrapper?p.typeName==="google.protobuf.BytesValue"?s[r]=It(_):s[r]=_:s[r]=ze(_,p)?_:new p(_)}break}}},equals(n,e,t){return e===t?!0:!e||!t?!1:n.fields.byMember().every(i=>{const r=e[i.localName],s=t[i.localName];if(i.repeated){if(r.length!==s.length)return!1;switch(i.kind){case"message":return r.every((o,l)=>i.T.equals(o,s[l]));case"scalar":return r.every((o,l)=>Me(i.T,o,s[l]));case"enum":return r.every((o,l)=>Me(b.INT32,o,s[l]))}throw new Error(`repeated cannot contain ${i.kind}`)}switch(i.kind){case"message":return i.T.equals(r,s);case"enum":return Me(b.INT32,r,s);case"scalar":return Me(i.T,r,s);case"oneof":if(r.case!==s.case)return!1;const o=i.findField(r.case);if(o===void 0)return!0;switch(o.kind){case"message":return o.T.equals(r.value,s.value);case"enum":return Me(b.INT32,r.value,s.value);case"scalar":return Me(o.T,r.value,s.value)}throw new Error(`oneof cannot contain ${o.kind}`);case"map":const l=Object.keys(r).concat(Object.keys(s));switch(i.V.kind){case"message":const f=i.V.T;return l.every(u=>f.equals(r[u],s[u]));case"enum":return l.every(u=>Me(b.INT32,r[u],s[u]));case"scalar":const h=i.V.T;return l.every(u=>Me(h,r[u],s[u]))}break}})},clone(n){const e=n.getType(),t=new e,i=t;for(const r of e.fields.byMember()){const s=n[r.localName];let o;if(r.repeated)o=s.map(on);else if(r.kind=="map"){o=i[r.localName];for(const[l,f]of Object.entries(s))o[l]=on(f)}else r.kind=="oneof"?o=r.findField(s.case)?{case:s.case,value:on(s.value)}:{case:void 0}:o=on(s);i[r.localName]=o}for(const r of e.runtime.bin.listUnknownFields(n))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return t}}}function on(n){if(n===void 0)return n;if(ze(n))return n.clone();if(n instanceof Uint8Array){const e=new Uint8Array(n.byteLength);return e.set(n),e}return n}function It(n){return n instanceof Uint8Array?n:new Uint8Array(n)}function Ul(n,e,t){return{syntax:n,json:Al(),bin:Pl(),util:Object.assign(Object.assign({},Bl()),{newFieldList:e,initFields:t}),makeMessageType(i,r,s){return fl(this,i,r,s)},makeEnum:hl,makeEnumType:oo,getEnumType:dl,makeExtension(i,r,s){return wl(this,i,r,s)}}}class Kl{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const t={};for(const i of this.list())t[i.jsonName]=t[i.name]=i;this.jsonNames=t}return this.jsonNames[e]}find(e){if(!this.numbers){const t={};for(const i of this.list())t[i.no]=i;this.numbers=t}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const i of this.list())i.oneof?i.oneof!==t&&(t=i.oneof,e.push(t)):e.push(i)}return this.members}}function To(n,e){const t=wo(n);return e?t:Jl(Wl(t))}function Vl(n){return To(n,!1)}const ql=wo;function wo(n){let e=!1;const t=[];for(let i=0;i<n.length;i++){let r=n.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":t.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),t.push(r);break}}return t.join("")}const Hl=new Set(["constructor","toString","toJSON","valueOf"]),$l=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),So=n=>`${n}$`,Wl=n=>$l.has(n)?So(n):n,Jl=n=>Hl.has(n)?So(n):n;class jl{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=Vl(e)}addField(e){G(e.oneof===this,`field ${e.name} not one of ${this.name}`),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let t=0;t<this.fields.length;t++)this._lookup[this.fields[t].localName]=this.fields[t]}return this._lookup[e]}}function Gl(n,e){var t,i,r,s,o,l;const f=[];let h;for(const u of typeof n=="function"?n():n){const p=u;if(p.localName=To(u.name,u.oneof!==void 0),p.jsonName=(t=u.jsonName)!==null&&t!==void 0?t:ql(u.name),p.repeated=(i=u.repeated)!==null&&i!==void 0?i:!1,u.kind=="scalar"&&(p.L=(r=u.L)!==null&&r!==void 0?r:Ue.BIGINT),p.delimited=(s=u.delimited)!==null&&s!==void 0?s:!1,p.req=(o=u.req)!==null&&o!==void 0?o:!1,p.opt=(l=u.opt)!==null&&l!==void 0?l:!1,u.packed===void 0&&(p.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=b.BYTES&&u.T!=b.STRING),u.oneof!==void 0){const _=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!h||h.name!=_)&&(h=new jl(_)),p.oneof=h,h.addField(p)}f.push(p)}return f}const k=Ul("proto3",n=>new Kl(n,e=>Gl(e)),n=>{for(const e of n.getType().fields.byMember()){if(e.opt)continue;const t=e.localName,i=n;if(e.repeated){i[t]=[];continue}switch(e.kind){case"oneof":i[t]={case:void 0};break;case"enum":i[t]=0;break;case"map":i[t]={};break;case"scalar":i[t]=yt(e.T,e.L);break}}}),zl=k.makeEnum("livekit.AudioCodec",[{no:0,name:"DEFAULT_AC"},{no:1,name:"OPUS"},{no:2,name:"AAC"}]),Yl=k.makeEnum("livekit.VideoCodec",[{no:0,name:"DEFAULT_VC"},{no:1,name:"H264_BASELINE"},{no:2,name:"H264_MAIN"},{no:3,name:"H264_HIGH"},{no:4,name:"VP8"}]),Xl=k.makeEnum("livekit.ImageCodec",[{no:0,name:"IC_DEFAULT"},{no:1,name:"IC_JPEG"}]),Ql=k.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),dt=k.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Zl=k.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),ed=k.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"}]),td=k.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"}]),Ei=k.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:nd,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:Co}]),nd=k.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),Bi=k.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:k.getEnumType(dt),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Ti=k.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:k.getEnumType(id)},{no:4,name:"tracks",kind:"message",T:bo,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:Bi},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:k.getEnumType(rd)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:k.getEnumType(ed)}]),id=k.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),rd=k.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),sd=k.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),od=k.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:ko,repeated:!0}]),bo=k.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:k.getEnumType(Ql)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:k.getEnumType(dt)},{no:10,name:"layers",kind:"message",T:ko,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:od,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:k.getEnumType(sd)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:Co},{no:19,name:"audio_features",kind:"enum",T:k.getEnumType(td),repeated:!0}]),ko=k.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:k.getEnumType(Zl)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]),ad=k.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),cd=k.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),Co=k.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),ud=k.makeEnum("livekit.EncodedFileType",[{no:0,name:"DEFAULT_FILETYPE"},{no:1,name:"MP4"},{no:2,name:"OGG"}]),ld=k.makeEnum("livekit.SegmentedFileProtocol",[{no:0,name:"DEFAULT_SEGMENTED_FILE_PROTOCOL"},{no:1,name:"HLS_PROTOCOL"}]),dd=k.makeEnum("livekit.SegmentedFileSuffix",[{no:0,name:"INDEX"},{no:1,name:"TIMESTAMP"}]),hd=k.makeEnum("livekit.ImageFileSuffix",[{no:0,name:"IMAGE_SUFFIX_INDEX"},{no:1,name:"IMAGE_SUFFIX_TIMESTAMP"}]),Ro=k.makeEnum("livekit.StreamProtocol",[{no:0,name:"DEFAULT_PROTOCOL"},{no:1,name:"RTMP"},{no:2,name:"SRT"}]),Ht=k.makeEnum("livekit.EncodingOptionsPreset",[{no:0,name:"H264_720P_30"},{no:1,name:"H264_720P_60"},{no:2,name:"H264_1080P_30"},{no:3,name:"H264_1080P_60"},{no:4,name:"PORTRAIT_H264_720P_30"},{no:5,name:"PORTRAIT_H264_720P_60"},{no:6,name:"PORTRAIT_H264_1080P_30"},{no:7,name:"PORTRAIT_H264_1080P_60"}]),fd=k.makeEnum("livekit.EgressStatus",[{no:0,name:"EGRESS_STARTING"},{no:1,name:"EGRESS_ACTIVE"},{no:2,name:"EGRESS_ENDING"},{no:3,name:"EGRESS_COMPLETE"},{no:4,name:"EGRESS_FAILED"},{no:5,name:"EGRESS_ABORTED"},{no:6,name:"EGRESS_LIMIT_REACHED"}]),Ui=k.makeMessageType("livekit.RoomCompositeEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"layout",kind:"scalar",T:9},{no:3,name:"audio_only",kind:"scalar",T:8},{no:4,name:"video_only",kind:"scalar",T:8},{no:5,name:"custom_base_url",kind:"scalar",T:9},{no:6,name:"file",kind:"message",T:Ke,oneof:"output"},{no:7,name:"stream",kind:"message",T:qe,oneof:"output"},{no:10,name:"segments",kind:"message",T:Ve,oneof:"output"},{no:8,name:"preset",kind:"enum",T:k.getEnumType(Ht),oneof:"options"},{no:9,name:"advanced",kind:"message",T:Gt,oneof:"options"},{no:11,name:"file_outputs",kind:"message",T:Ke,repeated:!0},{no:12,name:"stream_outputs",kind:"message",T:qe,repeated:!0},{no:13,name:"segment_outputs",kind:"message",T:Ve,repeated:!0},{no:14,name:"image_outputs",kind:"message",T:Ln,repeated:!0}]),Io=k.makeMessageType("livekit.WebEgressRequest",()=>[{no:1,name:"url",kind:"scalar",T:9},{no:2,name:"audio_only",kind:"scalar",T:8},{no:3,name:"video_only",kind:"scalar",T:8},{no:12,name:"await_start_signal",kind:"scalar",T:8},{no:4,name:"file",kind:"message",T:Ke,oneof:"output"},{no:5,name:"stream",kind:"message",T:qe,oneof:"output"},{no:6,name:"segments",kind:"message",T:Ve,oneof:"output"},{no:7,name:"preset",kind:"enum",T:k.getEnumType(Ht),oneof:"options"},{no:8,name:"advanced",kind:"message",T:Gt,oneof:"options"},{no:9,name:"file_outputs",kind:"message",T:Ke,repeated:!0},{no:10,name:"stream_outputs",kind:"message",T:qe,repeated:!0},{no:11,name:"segment_outputs",kind:"message",T:Ve,repeated:!0},{no:13,name:"image_outputs",kind:"message",T:Ln,repeated:!0}]),Ao=k.makeMessageType("livekit.ParticipantEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"screen_share",kind:"scalar",T:8},{no:4,name:"preset",kind:"enum",T:k.getEnumType(Ht),oneof:"options"},{no:5,name:"advanced",kind:"message",T:Gt,oneof:"options"},{no:6,name:"file_outputs",kind:"message",T:Ke,repeated:!0},{no:7,name:"stream_outputs",kind:"message",T:qe,repeated:!0},{no:8,name:"segment_outputs",kind:"message",T:Ve,repeated:!0},{no:9,name:"image_outputs",kind:"message",T:Ln,repeated:!0}]),No=k.makeMessageType("livekit.TrackCompositeEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"audio_track_id",kind:"scalar",T:9},{no:3,name:"video_track_id",kind:"scalar",T:9},{no:4,name:"file",kind:"message",T:Ke,oneof:"output"},{no:5,name:"stream",kind:"message",T:qe,oneof:"output"},{no:8,name:"segments",kind:"message",T:Ve,oneof:"output"},{no:6,name:"preset",kind:"enum",T:k.getEnumType(Ht),oneof:"options"},{no:7,name:"advanced",kind:"message",T:Gt,oneof:"options"},{no:11,name:"file_outputs",kind:"message",T:Ke,repeated:!0},{no:12,name:"stream_outputs",kind:"message",T:qe,repeated:!0},{no:13,name:"segment_outputs",kind:"message",T:Ve,repeated:!0},{no:14,name:"image_outputs",kind:"message",T:Ln,repeated:!0}]),vo=k.makeMessageType("livekit.TrackEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"track_id",kind:"scalar",T:9},{no:3,name:"file",kind:"message",T:md,oneof:"output"},{no:4,name:"websocket_url",kind:"scalar",T:9,oneof:"output"}]),Ke=k.makeMessageType("livekit.EncodedFileOutput",()=>[{no:1,name:"file_type",kind:"enum",T:k.getEnumType(ud)},{no:2,name:"filepath",kind:"scalar",T:9},{no:6,name:"disable_manifest",kind:"scalar",T:8},{no:3,name:"s3",kind:"message",T:$t,oneof:"output"},{no:4,name:"gcp",kind:"message",T:Wt,oneof:"output"},{no:5,name:"azure",kind:"message",T:Jt,oneof:"output"},{no:7,name:"aliOSS",kind:"message",T:jt,oneof:"output"}]),Ve=k.makeMessageType("livekit.SegmentedFileOutput",()=>[{no:1,name:"protocol",kind:"enum",T:k.getEnumType(ld)},{no:2,name:"filename_prefix",kind:"scalar",T:9},{no:3,name:"playlist_name",kind:"scalar",T:9},{no:11,name:"live_playlist_name",kind:"scalar",T:9},{no:4,name:"segment_duration",kind:"scalar",T:13},{no:10,name:"filename_suffix",kind:"enum",T:k.getEnumType(dd)},{no:8,name:"disable_manifest",kind:"scalar",T:8},{no:5,name:"s3",kind:"message",T:$t,oneof:"output"},{no:6,name:"gcp",kind:"message",T:Wt,oneof:"output"},{no:7,name:"azure",kind:"message",T:Jt,oneof:"output"},{no:9,name:"aliOSS",kind:"message",T:jt,oneof:"output"}]),md=k.makeMessageType("livekit.DirectFileOutput",()=>[{no:1,name:"filepath",kind:"scalar",T:9},{no:5,name:"disable_manifest",kind:"scalar",T:8},{no:2,name:"s3",kind:"message",T:$t,oneof:"output"},{no:3,name:"gcp",kind:"message",T:Wt,oneof:"output"},{no:4,name:"azure",kind:"message",T:Jt,oneof:"output"},{no:6,name:"aliOSS",kind:"message",T:jt,oneof:"output"}]),Ln=k.makeMessageType("livekit.ImageOutput",()=>[{no:1,name:"capture_interval",kind:"scalar",T:13},{no:2,name:"width",kind:"scalar",T:5},{no:3,name:"height",kind:"scalar",T:5},{no:4,name:"filename_prefix",kind:"scalar",T:9},{no:5,name:"filename_suffix",kind:"enum",T:k.getEnumType(hd)},{no:6,name:"image_codec",kind:"enum",T:k.getEnumType(Xl)},{no:7,name:"disable_manifest",kind:"scalar",T:8},{no:8,name:"s3",kind:"message",T:$t,oneof:"output"},{no:9,name:"gcp",kind:"message",T:Wt,oneof:"output"},{no:10,name:"azure",kind:"message",T:Jt,oneof:"output"},{no:11,name:"aliOSS",kind:"message",T:jt,oneof:"output"}]),$t=k.makeMessageType("livekit.S3Upload",()=>[{no:1,name:"access_key",kind:"scalar",T:9},{no:2,name:"secret",kind:"scalar",T:9},{no:11,name:"session_token",kind:"scalar",T:9},{no:3,name:"region",kind:"scalar",T:9},{no:4,name:"endpoint",kind:"scalar",T:9},{no:5,name:"bucket",kind:"scalar",T:9},{no:6,name:"force_path_style",kind:"scalar",T:8},{no:7,name:"metadata",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:8,name:"tagging",kind:"scalar",T:9},{no:9,name:"content_disposition",kind:"scalar",T:9},{no:10,name:"proxy",kind:"message",T:Oo}]),Wt=k.makeMessageType("livekit.GCPUpload",()=>[{no:1,name:"credentials",kind:"scalar",T:9},{no:2,name:"bucket",kind:"scalar",T:9},{no:3,name:"proxy",kind:"message",T:Oo}]),Jt=k.makeMessageType("livekit.AzureBlobUpload",()=>[{no:1,name:"account_name",kind:"scalar",T:9},{no:2,name:"account_key",kind:"scalar",T:9},{no:3,name:"container_name",kind:"scalar",T:9}]),jt=k.makeMessageType("livekit.AliOSSUpload",()=>[{no:1,name:"access_key",kind:"scalar",T:9},{no:2,name:"secret",kind:"scalar",T:9},{no:3,name:"region",kind:"scalar",T:9},{no:4,name:"endpoint",kind:"scalar",T:9},{no:5,name:"bucket",kind:"scalar",T:9}]),Oo=k.makeMessageType("livekit.ProxyConfig",()=>[{no:1,name:"url",kind:"scalar",T:9},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"password",kind:"scalar",T:9}]),qe=k.makeMessageType("livekit.StreamOutput",()=>[{no:1,name:"protocol",kind:"enum",T:k.getEnumType(Ro)},{no:2,name:"urls",kind:"scalar",T:9,repeated:!0}]),Gt=k.makeMessageType("livekit.EncodingOptions",()=>[{no:1,name:"width",kind:"scalar",T:5},{no:2,name:"height",kind:"scalar",T:5},{no:3,name:"depth",kind:"scalar",T:5},{no:4,name:"framerate",kind:"scalar",T:5},{no:5,name:"audio_codec",kind:"enum",T:k.getEnumType(zl)},{no:6,name:"audio_bitrate",kind:"scalar",T:5},{no:11,name:"audio_quality",kind:"scalar",T:5},{no:7,name:"audio_frequency",kind:"scalar",T:5},{no:8,name:"video_codec",kind:"enum",T:k.getEnumType(Yl)},{no:9,name:"video_bitrate",kind:"scalar",T:5},{no:12,name:"video_quality",kind:"scalar",T:5},{no:10,name:"key_frame_interval",kind:"scalar",T:1}]),pd=k.makeMessageType("livekit.UpdateLayoutRequest",()=>[{no:1,name:"egress_id",kind:"scalar",T:9},{no:2,name:"layout",kind:"scalar",T:9}]),gd=k.makeMessageType("livekit.UpdateStreamRequest",()=>[{no:1,name:"egress_id",kind:"scalar",T:9},{no:2,name:"add_output_urls",kind:"scalar",T:9,repeated:!0},{no:3,name:"remove_output_urls",kind:"scalar",T:9,repeated:!0}]),_d=k.makeMessageType("livekit.ListEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"egress_id",kind:"scalar",T:9},{no:3,name:"active",kind:"scalar",T:8}]),yd=k.makeMessageType("livekit.ListEgressResponse",()=>[{no:1,name:"items",kind:"message",T:Ce,repeated:!0}]),Ed=k.makeMessageType("livekit.StopEgressRequest",()=>[{no:1,name:"egress_id",kind:"scalar",T:9}]),Ce=k.makeMessageType("livekit.EgressInfo",()=>[{no:1,name:"egress_id",kind:"scalar",T:9},{no:2,name:"room_id",kind:"scalar",T:9},{no:13,name:"room_name",kind:"scalar",T:9},{no:3,name:"status",kind:"enum",T:k.getEnumType(fd)},{no:10,name:"started_at",kind:"scalar",T:3},{no:11,name:"ended_at",kind:"scalar",T:3},{no:18,name:"updated_at",kind:"scalar",T:3},{no:21,name:"details",kind:"scalar",T:9},{no:9,name:"error",kind:"scalar",T:9},{no:22,name:"error_code",kind:"scalar",T:5},{no:4,name:"room_composite",kind:"message",T:Ui,oneof:"request"},{no:14,name:"web",kind:"message",T:Io,oneof:"request"},{no:19,name:"participant",kind:"message",T:Ao,oneof:"request"},{no:5,name:"track_composite",kind:"message",T:No,oneof:"request"},{no:6,name:"track",kind:"message",T:vo,oneof:"request"},{no:7,name:"stream",kind:"message",T:Td,oneof:"result"},{no:8,name:"file",kind:"message",T:Yr,oneof:"result"},{no:12,name:"segments",kind:"message",T:Xr,oneof:"result"},{no:15,name:"stream_results",kind:"message",T:xo,repeated:!0},{no:16,name:"file_results",kind:"message",T:Yr,repeated:!0},{no:17,name:"segment_results",kind:"message",T:Xr,repeated:!0},{no:20,name:"image_results",kind:"message",T:Sd,repeated:!0}]),Td=k.makeMessageType("livekit.StreamInfoList",()=>[{no:1,name:"info",kind:"message",T:xo,repeated:!0}]),xo=k.makeMessageType("livekit.StreamInfo",()=>[{no:1,name:"url",kind:"scalar",T:9},{no:2,name:"started_at",kind:"scalar",T:3},{no:3,name:"ended_at",kind:"scalar",T:3},{no:4,name:"duration",kind:"scalar",T:3},{no:5,name:"status",kind:"enum",T:k.getEnumType(wd)},{no:6,name:"error",kind:"scalar",T:9}]),wd=k.makeEnum("livekit.StreamInfo.Status",[{no:0,name:"ACTIVE"},{no:1,name:"FINISHED"},{no:2,name:"FAILED"}]),Yr=k.makeMessageType("livekit.FileInfo",()=>[{no:1,name:"filename",kind:"scalar",T:9},{no:2,name:"started_at",kind:"scalar",T:3},{no:3,name:"ended_at",kind:"scalar",T:3},{no:6,name:"duration",kind:"scalar",T:3},{no:4,name:"size",kind:"scalar",T:3},{no:5,name:"location",kind:"scalar",T:9}]),Xr=k.makeMessageType("livekit.SegmentsInfo",()=>[{no:1,name:"playlist_name",kind:"scalar",T:9},{no:8,name:"live_playlist_name",kind:"scalar",T:9},{no:2,name:"duration",kind:"scalar",T:3},{no:3,name:"size",kind:"scalar",T:3},{no:4,name:"playlist_location",kind:"scalar",T:9},{no:9,name:"live_playlist_location",kind:"scalar",T:9},{no:5,name:"segment_count",kind:"scalar",T:3},{no:6,name:"started_at",kind:"scalar",T:3},{no:7,name:"ended_at",kind:"scalar",T:3}]),Sd=k.makeMessageType("livekit.ImagesInfo",()=>[{no:4,name:"filename_prefix",kind:"scalar",T:9},{no:1,name:"image_count",kind:"scalar",T:3},{no:2,name:"started_at",kind:"scalar",T:3},{no:3,name:"ended_at",kind:"scalar",T:3}]),bd=k.makeMessageType("livekit.AutoParticipantEgress",()=>[{no:1,name:"preset",kind:"enum",T:k.getEnumType(Ht),oneof:"options"},{no:2,name:"advanced",kind:"message",T:Gt,oneof:"options"},{no:3,name:"file_outputs",kind:"message",T:Ke,repeated:!0},{no:4,name:"segment_outputs",kind:"message",T:Ve,repeated:!0}]),kd=k.makeMessageType("livekit.AutoTrackEgress",()=>[{no:1,name:"filepath",kind:"scalar",T:9},{no:5,name:"disable_manifest",kind:"scalar",T:8},{no:2,name:"s3",kind:"message",T:$t,oneof:"output"},{no:3,name:"gcp",kind:"message",T:Wt,oneof:"output"},{no:4,name:"azure",kind:"message",T:Jt,oneof:"output"},{no:6,name:"aliOSS",kind:"message",T:jt,oneof:"output"}]),Cd=k.makeMessageType("livekit.RoomAgentDispatch",()=>[{no:1,name:"agent_name",kind:"scalar",T:9},{no:2,name:"metadata",kind:"scalar",T:9}]),Rd=k.makeMessageType("livekit.CreateRoomRequest",()=>[{no:1,name:"name",kind:"scalar",T:9},{no:12,name:"config_name",kind:"scalar",T:9},{no:2,name:"empty_timeout",kind:"scalar",T:13},{no:10,name:"departure_timeout",kind:"scalar",T:13},{no:3,name:"max_participants",kind:"scalar",T:13},{no:4,name:"node_id",kind:"scalar",T:9},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"egress",kind:"message",T:Id},{no:11,name:"agent",kind:"message",T:Ad},{no:7,name:"min_playout_delay",kind:"scalar",T:13},{no:8,name:"max_playout_delay",kind:"scalar",T:13},{no:9,name:"sync_streams",kind:"scalar",T:8},{no:13,name:"replay_enabled",kind:"scalar",T:8}]),Id=k.makeMessageType("livekit.RoomEgress",()=>[{no:1,name:"room",kind:"message",T:Ui},{no:3,name:"participant",kind:"message",T:bd},{no:2,name:"tracks",kind:"message",T:kd}]),Ad=k.makeMessageType("livekit.RoomAgent",()=>[{no:1,name:"dispatches",kind:"message",T:Cd,repeated:!0}]),Nd=k.makeMessageType("livekit.ListRoomsRequest",()=>[{no:1,name:"names",kind:"scalar",T:9,repeated:!0}]),vd=k.makeMessageType("livekit.ListRoomsResponse",()=>[{no:1,name:"rooms",kind:"message",T:Ei,repeated:!0}]),Od=k.makeMessageType("livekit.DeleteRoomRequest",()=>[{no:1,name:"room",kind:"scalar",T:9}]),xd=k.makeMessageType("livekit.ListParticipantsRequest",()=>[{no:1,name:"room",kind:"scalar",T:9}]),Pd=k.makeMessageType("livekit.ListParticipantsResponse",()=>[{no:1,name:"participants",kind:"message",T:Ti,repeated:!0}]),Qr=k.makeMessageType("livekit.RoomParticipantIdentity",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9}]),Ld=k.makeMessageType("livekit.MuteRoomTrackRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"track_sid",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8}]),Fd=k.makeMessageType("livekit.MuteRoomTrackResponse",()=>[{no:1,name:"track",kind:"message",T:bo}]),Md=k.makeMessageType("livekit.UpdateParticipantRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"permission",kind:"message",T:Bi},{no:5,name:"name",kind:"scalar",T:9},{no:6,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}]),Dd=k.makeMessageType("livekit.UpdateSubscriptionsRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"subscribe",kind:"scalar",T:8},{no:5,name:"participant_tracks",kind:"message",T:cd,repeated:!0}]),Bd=k.makeMessageType("livekit.SendDataRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"data",kind:"scalar",T:12},{no:3,name:"kind",kind:"enum",T:k.getEnumType(ad)},{no:4,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:5,name:"topic",kind:"scalar",T:9,opt:!0}]),Ud=k.makeMessageType("livekit.UpdateRoomMetadataRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"metadata",kind:"scalar",T:9}]),Ki=crypto,Po=n=>n instanceof CryptoKey,ht=new TextEncoder,wi=new TextDecoder;function Kd(...n){const e=n.reduce((r,{length:s})=>r+s,0),t=new Uint8Array(e);let i=0;for(const r of n)t.set(r,i),i+=r.length;return t}const Vd=n=>{let e=n;typeof e=="string"&&(e=ht.encode(e));const t=32768,i=[];for(let r=0;r<e.length;r+=t)i.push(String.fromCharCode.apply(null,e.subarray(r,r+t)));return btoa(i.join(""))},Xn=n=>Vd(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),qd=n=>{const e=atob(n),t=new Uint8Array(e.length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t},Vi=n=>{let e=n;e instanceof Uint8Array&&(e=wi.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return qd(e)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class qi extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(t=Error.captureStackTrace)==null||t.call(Error,this,this.constructor)}}class ft extends qi{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}}class At extends qi{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}}class Hd extends qi{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}}function Se(n,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${n}`)}function an(n,e){return n.name===e}function Qn(n){return parseInt(n.name.slice(4),10)}function $d(n){switch(n){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function Wd(n,e){if(e.length&&!e.some(t=>n.usages.includes(t))){let t="CryptoKey does not support this operation, its usages must include ";if(e.length>2){const i=e.pop();t+=`one of ${e.join(", ")}, or ${i}.`}else e.length===2?t+=`one of ${e[0]} or ${e[1]}.`:t+=`${e[0]}.`;throw new TypeError(t)}}function Jd(n,e,...t){switch(e){case"HS256":case"HS384":case"HS512":{if(!an(n.algorithm,"HMAC"))throw Se("HMAC");const i=parseInt(e.slice(2),10);if(Qn(n.algorithm.hash)!==i)throw Se(`SHA-${i}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!an(n.algorithm,"RSASSA-PKCS1-v1_5"))throw Se("RSASSA-PKCS1-v1_5");const i=parseInt(e.slice(2),10);if(Qn(n.algorithm.hash)!==i)throw Se(`SHA-${i}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!an(n.algorithm,"RSA-PSS"))throw Se("RSA-PSS");const i=parseInt(e.slice(2),10);if(Qn(n.algorithm.hash)!==i)throw Se(`SHA-${i}`,"algorithm.hash");break}case"EdDSA":{if(n.algorithm.name!=="Ed25519"&&n.algorithm.name!=="Ed448")throw Se("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!an(n.algorithm,"ECDSA"))throw Se("ECDSA");const i=$d(e);if(n.algorithm.namedCurve!==i)throw Se(i,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Wd(n,t)}function Lo(n,e,...t){var i;if(t=t.filter(Boolean),t.length>2){const r=t.pop();n+=`one of type ${t.join(", ")}, or ${r}.`}else t.length===2?n+=`one of type ${t[0]} or ${t[1]}.`:n+=`of type ${t[0]}.`;return e==null?n+=` Received ${e}`:typeof e=="function"&&e.name?n+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&(i=e.constructor)!=null&&i.name&&(n+=` Received an instance of ${e.constructor.name}`),n}const Zr=(n,...e)=>Lo("Key must be ",n,...e);function Fo(n,e,...t){return Lo(`Key for the ${n} algorithm must be `,e,...t)}const Mo=n=>Po(n)?!0:(n==null?void 0:n[Symbol.toStringTag])==="KeyObject",bn=["CryptoKey"],jd=(...n)=>{const e=n.filter(Boolean);if(e.length===0||e.length===1)return!0;let t;for(const i of e){const r=Object.keys(i);if(!t||t.size===0){t=new Set(r);continue}for(const s of r){if(t.has(s))return!1;t.add(s)}}return!0};function Gd(n){return typeof n=="object"&&n!==null}function Do(n){if(!Gd(n)||Object.prototype.toString.call(n)!=="[object Object]")return!1;if(Object.getPrototypeOf(n)===null)return!0;let e=n;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(n)===e}const zd=(n,e)=>{if(n.startsWith("RS")||n.startsWith("PS")){const{modulusLength:t}=e.algorithm;if(typeof t!="number"||t<2048)throw new TypeError(`${n} requires key modulusLength to be 2048 bits or larger`)}};function zt(n){return Do(n)&&typeof n.kty=="string"}function Yd(n){return n.kty!=="oct"&&typeof n.d=="string"}function Xd(n){return n.kty!=="oct"&&typeof n.d>"u"}function Qd(n){return zt(n)&&n.kty==="oct"&&typeof n.k=="string"}function Zd(n){let e,t;switch(n.kty){case"RSA":{switch(n.alg){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${n.alg.slice(-3)}`},t=n.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${n.alg.slice(-3)}`},t=n.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(n.alg.slice(-3),10)||1}`},t=n.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new ft('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(n.alg){case"ES256":e={name:"ECDSA",namedCurve:"P-256"},t=n.d?["sign"]:["verify"];break;case"ES384":e={name:"ECDSA",namedCurve:"P-384"},t=n.d?["sign"]:["verify"];break;case"ES512":e={name:"ECDSA",namedCurve:"P-521"},t=n.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:"ECDH",namedCurve:n.crv},t=n.d?["deriveBits"]:[];break;default:throw new ft('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(n.alg){case"EdDSA":e={name:n.crv},t=n.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:n.crv},t=n.d?["deriveBits"]:[];break;default:throw new ft('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new ft('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:e,keyUsages:t}}const eh=async n=>{if(!n.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:e,keyUsages:t}=Zd(n),i=[e,n.ext??!1,n.key_ops??t],r={...n};return delete r.alg,delete r.use,Ki.subtle.importKey("jwk",r,...i)},Bo=n=>Vi(n);let ct,ut;const Uo=n=>(n==null?void 0:n[Symbol.toStringTag])==="KeyObject",kn=async(n,e,t,i,r=!1)=>{let s=n.get(e);if(s!=null&&s[i])return s[i];const o=await eh({...t,alg:i});return r&&Object.freeze(e),s?s[i]=o:n.set(e,{[i]:o}),o},th=(n,e)=>{if(Uo(n)){let t=n.export({format:"jwk"});return delete t.d,delete t.dp,delete t.dq,delete t.p,delete t.q,delete t.qi,t.k?Bo(t.k):(ut||(ut=new WeakMap),kn(ut,n,t,e))}return zt(n)?n.k?Vi(n.k):(ut||(ut=new WeakMap),kn(ut,n,n,e,!0)):n},nh=(n,e)=>{if(Uo(n)){let t=n.export({format:"jwk"});return t.k?Bo(t.k):(ct||(ct=new WeakMap),kn(ct,n,t,e))}return zt(n)?n.k?Vi(n.k):(ct||(ct=new WeakMap),kn(ct,n,n,e,!0)):n},ih={normalizePublicKey:th,normalizePrivateKey:nh},lt=n=>n==null?void 0:n[Symbol.toStringTag],Si=(n,e,t)=>{var i,r;if(e.use!==void 0&&e.use!=="sig")throw new TypeError("Invalid key for this operation, when present its use must be sig");if(e.key_ops!==void 0&&((r=(i=e.key_ops).includes)==null?void 0:r.call(i,t))!==!0)throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${t}`);if(e.alg!==void 0&&e.alg!==n)throw new TypeError(`Invalid key for this operation, when present its alg must be ${n}`);return!0},rh=(n,e,t,i)=>{if(!(e instanceof Uint8Array)){if(i&&zt(e)){if(Qd(e)&&Si(n,e,t))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Mo(e))throw new TypeError(Fo(n,e,...bn,"Uint8Array",i?"JSON Web Key":null));if(e.type!=="secret")throw new TypeError(`${lt(e)} instances for symmetric algorithms must be of type "secret"`)}},sh=(n,e,t,i)=>{if(i&&zt(e))switch(t){case"sign":if(Yd(e)&&Si(n,e,t))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(Xd(e)&&Si(n,e,t))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!Mo(e))throw new TypeError(Fo(n,e,...bn,i?"JSON Web Key":null));if(e.type==="secret")throw new TypeError(`${lt(e)} instances for asymmetric algorithms must not be of type "secret"`);if(t==="sign"&&e.type==="public")throw new TypeError(`${lt(e)} instances for asymmetric algorithm signing must be of type "private"`);if(t==="decrypt"&&e.type==="public")throw new TypeError(`${lt(e)} instances for asymmetric algorithm decryption must be of type "private"`);if(e.algorithm&&t==="verify"&&e.type==="private")throw new TypeError(`${lt(e)} instances for asymmetric algorithm verifying must be of type "public"`);if(e.algorithm&&t==="encrypt"&&e.type==="private")throw new TypeError(`${lt(e)} instances for asymmetric algorithm encryption must be of type "public"`)};function Ko(n,e,t,i){e.startsWith("HS")||e==="dir"||e.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(e)?rh(e,t,i,n):sh(e,t,i,n)}Ko.bind(void 0,!1);const oh=Ko.bind(void 0,!0);function ah(n,e,t,i,r){if(r.crit!==void 0&&(i==null?void 0:i.crit)===void 0)throw new n('"crit" (Critical) Header Parameter MUST be integrity protected');if(!i||i.crit===void 0)return new Set;if(!Array.isArray(i.crit)||i.crit.length===0||i.crit.some(o=>typeof o!="string"||o.length===0))throw new n('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let s;t!==void 0?s=new Map([...Object.entries(t),...e.entries()]):s=e;for(const o of i.crit){if(!s.has(o))throw new ft(`Extension Header Parameter "${o}" is not recognized`);if(r[o]===void 0)throw new n(`Extension Header Parameter "${o}" is missing`);if(s.get(o)&&i[o]===void 0)throw new n(`Extension Header Parameter "${o}" MUST be integrity protected`)}return new Set(i.crit)}function ch(n,e){const t=`SHA-${n.slice(-3)}`;switch(n){case"HS256":case"HS384":case"HS512":return{hash:t,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:t,name:"RSA-PSS",saltLength:n.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:t,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:t,name:"ECDSA",namedCurve:e.namedCurve};case"EdDSA":return{name:e.name};default:throw new ft(`alg ${n} is not supported either by JOSE or your javascript runtime`)}}async function uh(n,e,t){if(e=await ih.normalizePrivateKey(e,n),Po(e))return Jd(e,n,t),e;if(e instanceof Uint8Array){if(!n.startsWith("HS"))throw new TypeError(Zr(e,...bn));return Ki.subtle.importKey("raw",e,{hash:`SHA-${n.slice(-3)}`,name:"HMAC"},!1,[t])}throw new TypeError(Zr(e,...bn,"Uint8Array","JSON Web Key"))}const We=n=>Math.floor(n.getTime()/1e3),Vo=60,qo=Vo*60,Hi=qo*24,lh=Hi*7,dh=Hi*365.25,hh=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,Zn=n=>{const e=hh.exec(n);if(!e||e[4]&&e[1])throw new TypeError("Invalid time period format");const t=parseFloat(e[2]),i=e[3].toLowerCase();let r;switch(i){case"sec":case"secs":case"second":case"seconds":case"s":r=Math.round(t);break;case"minute":case"minutes":case"min":case"mins":case"m":r=Math.round(t*Vo);break;case"hour":case"hours":case"hr":case"hrs":case"h":r=Math.round(t*qo);break;case"day":case"days":case"d":r=Math.round(t*Hi);break;case"week":case"weeks":case"w":r=Math.round(t*lh);break;default:r=Math.round(t*dh);break}return e[1]==="-"||e[4]==="ago"?-r:r},fh=async(n,e,t)=>{const i=await uh(n,e,"sign");zd(n,i);const r=await Ki.subtle.sign(ch(n,i.algorithm),i,t);return new Uint8Array(r)};class mh{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){if(!this._protectedHeader&&!this._unprotectedHeader)throw new At("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!jd(this._protectedHeader,this._unprotectedHeader))throw new At("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const i={...this._protectedHeader,...this._unprotectedHeader},r=ah(At,new Map([["b64",!0]]),t==null?void 0:t.crit,this._protectedHeader,i);let s=!0;if(r.has("b64")&&(s=this._protectedHeader.b64,typeof s!="boolean"))throw new At('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:o}=i;if(typeof o!="string"||!o)throw new At('JWS "alg" (Algorithm) Header Parameter missing or invalid');oh(o,e,"sign");let l=this._payload;s&&(l=ht.encode(Xn(l)));let f;this._protectedHeader?f=ht.encode(Xn(JSON.stringify(this._protectedHeader))):f=ht.encode("");const h=Kd(f,ht.encode("."),l),u=await fh(o,e,h),p={signature:Xn(u),payload:""};return s&&(p.payload=wi.decode(l)),this._unprotectedHeader&&(p.header=this._unprotectedHeader),this._protectedHeader&&(p.protected=wi.decode(f)),p}}class ph{constructor(e){this._flattened=new mh(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){const i=await this._flattened.sign(e,t);if(i.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${i.protected}.${i.payload}.${i.signature}`}}function Je(n,e){if(!Number.isFinite(e))throw new TypeError(`Invalid ${n} input`);return e}class gh{constructor(e={}){if(!Do(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return typeof e=="number"?this._payload={...this._payload,nbf:Je("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:Je("setNotBefore",We(e))}:this._payload={...this._payload,nbf:We(new Date)+Zn(e)},this}setExpirationTime(e){return typeof e=="number"?this._payload={...this._payload,exp:Je("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:Je("setExpirationTime",We(e))}:this._payload={...this._payload,exp:We(new Date)+Zn(e)},this}setIssuedAt(e){return typeof e>"u"?this._payload={...this._payload,iat:We(new Date)}:e instanceof Date?this._payload={...this._payload,iat:Je("setIssuedAt",We(e))}:typeof e=="string"?this._payload={...this._payload,iat:Je("setIssuedAt",We(new Date)+Zn(e))}:this._payload={...this._payload,iat:Je("setIssuedAt",e)},this}}class _h extends gh{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){var r;const i=new ph(ht.encode(JSON.stringify(this._payload)));if(i.setProtectedHeader(this._protectedHeader),Array.isArray((r=this._protectedHeader)==null?void 0:r.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new Hd("JWTs MUST NOT use unencoded payload");return i.sign(e,t)}}function yh(n){switch(n){case dt.CAMERA:return"camera";case dt.MICROPHONE:return"microphone";case dt.SCREEN_SHARE:return"screen_share";case dt.SCREEN_SHARE_AUDIO:return"screen_share_audio";default:throw new TypeError(`Cannot convert TrackSource ${n} to string`)}}function Eh(n){var e;const t=Object.assign({},n);return Array.isArray((e=t.video)===null||e===void 0?void 0:e.canPublishSources)&&(t.video.canPublishSources=t.video.canPublishSources.map(yh)),t}var es={};const Th="6h";class Ho{constructor(e,t,i){if(e||(e=es.LIVEKIT_API_KEY),t||(t=es.LIVEKIT_API_SECRET),!e||!t)throw Error("api-key and api-secret must be set");typeof document<"u"&&console.error(`You should not include your API secret in your web client bundle.

Your web client should request a token from your backend server which should then use the API secret to generate a token. See https://docs.livekit.io/client/connect/`),this.apiKey=e,this.apiSecret=t,this.grants={},this.identity=i==null?void 0:i.identity,this.ttl=(i==null?void 0:i.ttl)||Th,typeof this.ttl=="number"&&(this.ttl=`${this.ttl}s`),i!=null&&i.metadata&&(this.metadata=i.metadata),i!=null&&i.name&&(this.name=i.name)}addGrant(e){var t;this.grants.video=Object.assign(Object.assign({},(t=this.grants.video)!==null&&t!==void 0?t:{}),e)}addSIPGrant(e){var t;this.grants.sip=Object.assign(Object.assign({},(t=this.grants.sip)!==null&&t!==void 0?t:{}),e)}get name(){return this.grants.name}set name(e){this.grants.name=e}get metadata(){return this.grants.metadata}set metadata(e){this.grants.metadata=e}get attributes(){return this.grants.attributes}set attributes(e){this.grants.attributes=e}get kind(){return this.grants.kind}set kind(e){this.grants.kind=e}get sha256(){return this.grants.sha256}set sha256(e){this.grants.sha256=e}async toJwt(){var e;const t=new TextEncoder().encode(this.apiSecret),i=new _h(Eh(this.grants)).setProtectedHeader({alg:"HS256"}).setIssuer(this.apiKey).setExpirationTime(this.ttl).setNotBefore(0);if(this.identity)i.setSubject(this.identity);else if(!((e=this.grants.video)===null||e===void 0)&&e.roomJoin)throw Error("identity is required for join but not set");return i.sign(t)}}class $o{constructor(e,t,i){this.apiKey=e,this.secret=t,this.ttl=i||"10m"}async authHeader(e,t){const i=new Ho(this.apiKey,this.secret,{ttl:this.ttl});return i.addGrant(e),t&&i.addSIPGrant(t),{Authorization:`Bearer ${await i.toJwt()}`}}}const Wo=n=>typeof n=="object"&&n!==null,ts=n=>Wo(n)&&!(n instanceof RegExp)&&!(n instanceof Error)&&!(n instanceof Date),wh=Symbol("mapObjectSkip"),bi=(n,e,t,i=new WeakMap)=>{if(t={deep:!1,target:{},...t},i.has(n))return i.get(n);i.set(n,t.target);const{target:r}=t;delete t.target;const s=o=>o.map(l=>ts(l)?bi(l,e,t,i):l);if(Array.isArray(n))return s(n);for(const[o,l]of Object.entries(n)){const f=e(o,l,n);if(f===wh)continue;let[h,u,{shouldRecurse:p=!0}={}]=f;h!=="__proto__"&&(t.deep&&p&&ts(u)&&(u=Array.isArray(u)?s(u):bi(u,e,t,i)),r[h]=u)}return r};function ns(n,e,t){if(!Wo(n))throw new TypeError(`Expected an object, got \`${n}\` (${typeof n})`);return bi(n,e,t)}const Sh=/[\p{Lu}]/u,bh=/[\p{Ll}]/u,is=/^[\p{Lu}](?![\p{Lu}])/gu,Jo=/([\p{Alpha}\p{N}_]|$)/u,$i=/[_.\- ]+/,kh=new RegExp("^"+$i.source),rs=new RegExp($i.source+Jo.source,"gu"),ss=new RegExp("\\d+"+Jo.source,"gu"),Ch=(n,e,t,i)=>{let r=!1,s=!1,o=!1,l=!1;for(let f=0;f<n.length;f++){const h=n[f];l=f>2?n[f-3]==="-":!0,r&&Sh.test(h)?(n=n.slice(0,f)+"-"+n.slice(f),r=!1,o=s,s=!0,f++):s&&o&&bh.test(h)&&(!l||i)?(n=n.slice(0,f-1)+"-"+n.slice(f-1),o=s,s=!1,r=!0):(r=e(h)===h&&t(h)!==h,o=s,s=t(h)===h&&e(h)!==h)}return n},Rh=(n,e)=>(is.lastIndex=0,n.replaceAll(is,t=>e(t))),Ih=(n,e)=>(rs.lastIndex=0,ss.lastIndex=0,n.replaceAll(ss,(t,i,r)=>["_","-"].includes(n.charAt(r+t.length))?t:e(t)).replaceAll(rs,(t,i)=>e(i)));function Ah(n,e){if(!(typeof n=="string"||Array.isArray(n)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(n)?n=n.map(s=>s.trim()).filter(s=>s.length).join("-"):n=n.trim(),n.length===0)return"";const t=e.locale===!1?s=>s.toLowerCase():s=>s.toLocaleLowerCase(e.locale),i=e.locale===!1?s=>s.toUpperCase():s=>s.toLocaleUpperCase(e.locale);return n.length===1?$i.test(n)?"":e.pascalCase?i(n):t(n):(n!==t(n)&&(n=Ch(n,t,i,e.preserveConsecutiveUppercase)),n=n.replace(kh,""),n=e.preserveConsecutiveUppercase?Rh(n,t):t(n),e.pascalCase&&(n=i(n.charAt(0))+n.slice(1)),Ih(n,i))}class Nh extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[t,i]of e)this.onEviction(t,i.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const i=t.get(e);return this._getItemValue(e,i)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,i]=e;this.cache.has(t)||this._deleteIfExpired(t,i)===!1&&(yield e)}for(const e of this.cache){const[t,i]=e;this._deleteIfExpired(t,i)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:i=this.maxAge}={}){const r=typeof i=="number"&&i!==Number.POSITIVE_INFINITY?Date.now()+i:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:r}):this._set(e,{value:t,expiry:r}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],i=t.length-e;i<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(i>0&&this._emitEvictions(t.slice(0,i)),this.oldCache=new Map(t.slice(i)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,i]=e;this._deleteIfExpired(t,i)===!1&&(yield[t,i.value])}for(const e of this.oldCache){const[t,i]=e;this.cache.has(t)||this._deleteIfExpired(t,i)===!1&&(yield[t,i.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const i=e[t],[r,s]=i;this._deleteIfExpired(r,s)===!1&&(yield[r,s.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const i=e[t],[r,s]=i;this.cache.has(r)||this._deleteIfExpired(r,s)===!1&&(yield[r,s.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[i,r]of this.entriesAscending())e.call(t,r,i,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}const vh=(n,e)=>n.some(t=>typeof t=="string"?t===e:(t.lastIndex=0,t.test(e))),ei=new Nh({maxSize:1e5}),os=n=>typeof n=="object"&&n!==null&&!(n instanceof RegExp)&&!(n instanceof Error)&&!(n instanceof Date),as=(n,e={})=>{if(!os(n))return n;const{exclude:t,pascalCase:i=!1,stopPaths:r,deep:s=!1,preserveConsecutiveUppercase:o=!1}=e,l=new Set(r),f=h=>(u,p)=>{if(s&&os(p)){const _=h===void 0?u:`${h}.${u}`;l.has(_)||(p=ns(p,f(_)))}if(!(t&&vh(t,u))){const _=i?`${u}_`:u;if(ei.has(_))u=ei.get(_);else{const I=Ah(u,{pascalCase:i,locale:!1,preserveConsecutiveUppercase:o});u.length<100&&ei.set(_,I),u=I}}return[u,p]};return ns(n,f(void 0))};function Oh(n,e){return Array.isArray(n)?Object.keys(n).map(t=>as(n[t],e)):as(n,e)}const xh="/twirp",jo="livekit";class Go{constructor(e,t,i){e.startsWith("ws")&&(e=e.replace("ws","http")),this.host=e,this.pkg=t,this.prefix=i||xh}async request(e,t,i,r){const s=`${this.prefix}/${this.pkg}.${e}/${t}`,o=new URL(s,this.host),l=await fetch(o,{method:"POST",headers:Object.assign({"Content-Type":"application/json;charset=UTF-8"},r),body:JSON.stringify(i)});if(!l.ok)throw new Error(`Request failed with status ${l.status}: ${l.statusText}`);const f=await l.json();return Oh(f,{deep:!0})}}const be="Egress";class zo extends $o{constructor(e,t,i){super(t,i),this.rpc=new Go(e,jo)}async startRoomCompositeEgress(e,t,i,r,s,o,l){let f;if(i!==void 0)if(typeof i=="string")f=i;else{const N=i;f=N.layout,r=N.encodingOptions,s=N.audioOnly,o=N.videoOnly,l=N.customBaseUrl}f??(f=""),s??(s=!1),o??(o=!1),l??(l="");const{output:h,options:u,fileOutputs:p,streamOutputs:_,segmentOutputs:I,imageOutputs:C}=this.getOutputParams(t,r),w=new Ui({roomName:e,layout:f,audioOnly:s,videoOnly:o,customBaseUrl:l,output:h,options:u,fileOutputs:p,streamOutputs:_,segmentOutputs:I,imageOutputs:C}).toJson(),T=await this.rpc.request(be,"StartRoomCompositeEgress",w,await this.authHeader({roomRecord:!0}));return Ce.fromJson(T,{ignoreUnknownFields:!0})}async startWebEgress(e,t,i){const r=(i==null?void 0:i.audioOnly)||!1,s=(i==null?void 0:i.videoOnly)||!1,o=(i==null?void 0:i.awaitStartSignal)||!1,{output:l,options:f,fileOutputs:h,streamOutputs:u,segmentOutputs:p,imageOutputs:_}=this.getOutputParams(t,i==null?void 0:i.encodingOptions),I=new Io({url:e,audioOnly:r,videoOnly:s,awaitStartSignal:o,output:l,options:f,fileOutputs:h,streamOutputs:u,segmentOutputs:p,imageOutputs:_}).toJson(),C=await this.rpc.request(be,"StartWebEgress",I,await this.authHeader({roomRecord:!0}));return Ce.fromJson(C,{ignoreUnknownFields:!0})}async startParticipantEgress(e,t,i,r){const{options:s,fileOutputs:o,streamOutputs:l,segmentOutputs:f,imageOutputs:h}=this.getOutputParams(i,r==null?void 0:r.encodingOptions),u=new Ao({roomName:e,identity:t,options:s,fileOutputs:o,streamOutputs:l,segmentOutputs:f,imageOutputs:h}).toJson(),p=await this.rpc.request(be,"StartParticipantEgress",u,await this.authHeader({roomRecord:!0}));return Ce.fromJson(p,{ignoreUnknownFields:!0})}async startTrackCompositeEgress(e,t,i,r,s){let o;if(i!==void 0)if(typeof i=="string")o=i;else{const w=i;o=w.audioTrackId,r=w.videoTrackId,s=w.encodingOptions}o??(o=""),r??(r="");const{output:l,options:f,fileOutputs:h,streamOutputs:u,segmentOutputs:p,imageOutputs:_}=this.getOutputParams(t,s),I=new No({roomName:e,audioTrackId:o,videoTrackId:r,output:l,options:f,fileOutputs:h,streamOutputs:u,segmentOutputs:p,imageOutputs:_}).toJson(),C=await this.rpc.request(be,"StartTrackCompositeEgress",I,await this.authHeader({roomRecord:!0}));return Ce.fromJson(C,{ignoreUnknownFields:!0})}isEncodedOutputs(e){return e.file!==void 0||e.stream!==void 0||e.segments!==void 0}isEncodedFileOutput(e){return e.filepath!==void 0||e.fileType!==void 0}isSegmentedFileOutput(e){return e.filenamePrefix!==void 0||e.playlistName!==void 0||e.filenameSuffix!==void 0}isStreamOutput(e){return e.protocol!==void 0||e.urls!==void 0}getOutputParams(e,t){let i,r,s,o,l,f,h;this.isEncodedOutputs(e)?(e.file!==void 0&&(r=[e.file]),e.stream!==void 0&&(o=[e.stream]),e.segments!==void 0&&(f=[e.segments]),e.images!==void 0&&(h=[e.images])):this.isEncodedFileOutput(e)?(i=e,r=[i]):this.isSegmentedFileOutput(e)?(l=e,f=[l]):this.isStreamOutput(e)&&(s=e,o=[s]);let u;i?u={case:"file",value:i}:s?u={case:"stream",value:s}:l&&(u={case:"segments",value:l});let p;return t&&(typeof t=="number"?p={case:"preset",value:t}:p={case:"advanced",value:t}),{output:u,options:p,fileOutputs:r,streamOutputs:o,segmentOutputs:f,imageOutputs:h}}async startTrackEgress(e,t,i){let r;typeof t=="string"?r={case:"websocketUrl",value:t}:r={case:"file",value:t};const s=new vo({roomName:e,trackId:i,output:r}).toJson(),o=await this.rpc.request(be,"StartTrackEgress",s,await this.authHeader({roomRecord:!0}));return Ce.fromJson(o,{ignoreUnknownFields:!0})}async updateLayout(e,t){const i=await this.rpc.request(be,"UpdateLayout",new pd({egressId:e,layout:t}).toJson(),await this.authHeader({roomRecord:!0}));return Ce.fromJson(i,{ignoreUnknownFields:!0})}async updateStream(e,t,i){t??(t=[]),i??(i=[]);const r=await this.rpc.request(be,"UpdateStream",new gd({egressId:e,addOutputUrls:t,removeOutputUrls:i}).toJson(),await this.authHeader({roomRecord:!0}));return Ce.fromJson(r,{ignoreUnknownFields:!0})}async listEgress(e){var t;let i={};typeof e=="string"?i.roomName=e:e!==void 0&&(i=e);const r=await this.rpc.request(be,"ListEgress",new _d(i).toJson(),await this.authHeader({roomRecord:!0}));return(t=yd.fromJson(r,{ignoreUnknownFields:!0}).items)!==null&&t!==void 0?t:[]}async stopEgress(e){const t=await this.rpc.request(be,"StopEgress",new Ed({egressId:e}).toJson(),await this.authHeader({roomRecord:!0}));return Ce.fromJson(t,{ignoreUnknownFields:!0})}}const fe="RoomService";class Ph extends $o{constructor(e,t,i){super(t,i),this.rpc=new Go(e,jo)}async createRoom(e){const t=await this.rpc.request(fe,"CreateRoom",new Rd(e).toJson(),await this.authHeader({roomCreate:!0}));return Ei.fromJson(t,{ignoreUnknownFields:!0})}async listRooms(e){var t;const i=await this.rpc.request(fe,"ListRooms",new Nd({names:e??[]}).toJson(),await this.authHeader({roomList:!0}));return(t=vd.fromJson(i,{ignoreUnknownFields:!0}).rooms)!==null&&t!==void 0?t:[]}async deleteRoom(e){await this.rpc.request(fe,"DeleteRoom",new Od({room:e}).toJson(),await this.authHeader({roomCreate:!0}))}async updateRoomMetadata(e,t){const i=await this.rpc.request(fe,"UpdateRoomMetadata",new Ud({room:e,metadata:t}).toJson(),await this.authHeader({roomAdmin:!0,room:e}));return Ei.fromJson(i,{ignoreUnknownFields:!0})}async listParticipants(e){var t;const i=await this.rpc.request(fe,"ListParticipants",new xd({room:e}).toJson(),await this.authHeader({roomAdmin:!0,room:e}));return(t=Pd.fromJson(i,{ignoreUnknownFields:!0}).participants)!==null&&t!==void 0?t:[]}async getParticipant(e,t){const i=await this.rpc.request(fe,"GetParticipant",new Qr({room:e,identity:t}).toJson(),await this.authHeader({roomAdmin:!0,room:e}));return Ti.fromJson(i,{ignoreUnknownFields:!0})}async removeParticipant(e,t){await this.rpc.request(fe,"RemoveParticipant",new Qr({room:e,identity:t}).toJson(),await this.authHeader({roomAdmin:!0,room:e}))}async mutePublishedTrack(e,t,i,r){const s=new Ld({room:e,identity:t,trackSid:i,muted:r}).toJson(),o=await this.rpc.request(fe,"MutePublishedTrack",s,await this.authHeader({roomAdmin:!0,room:e}));return Fd.fromJson(o,{ignoreUnknownFields:!0}).track}async updateParticipant(e,t,i,r,s){const o=typeof i=="object",l=o?i==null?void 0:i.metadata:i,f=o?i.permission:r,h=o?i.name:s,u=o?i.attributes:{},p=new Md({room:e,identity:t,attributes:u,metadata:l,name:h});f&&(p.permission=new Bi(f));const _=await this.rpc.request(fe,"UpdateParticipant",p.toJson(),await this.authHeader({roomAdmin:!0,room:e}));return Ti.fromJson(_,{ignoreUnknownFields:!0})}async updateSubscriptions(e,t,i,r){const s=new Dd({room:e,identity:t,trackSids:i,subscribe:r,participantTracks:[]}).toJson();await this.rpc.request(fe,"UpdateSubscriptions",s,await this.authHeader({roomAdmin:!0,room:e}))}async sendData(e,t,i,r={}){const s=Array.isArray(r)?r:r.destinationSids,o=Array.isArray(r)?void 0:r.topic,l=new Bd({room:e,data:t,kind:i,destinationSids:s??[],topic:o});!Array.isArray(r)&&r.destinationIdentities&&(l.destinationIdentities=r.destinationIdentities),await this.rpc.request(fe,"SendData",l.toJson(),await this.authHeader({roomAdmin:!0,room:e}))}}const Lh=16,Fh=12;function Mh(n){let e=new TextEncoder;return window.crypto.subtle.importKey("raw",e.encode(n),{name:"PBKDF2"},!1,["deriveBits","deriveKey"])}function Dh(n,e){return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:e,iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async function Bh(n,e){const t=window.crypto.getRandomValues(new Uint8Array(Lh)),i=window.crypto.getRandomValues(new Uint8Array(Fh));let r=As(n),s=await Mh(e),o=await Dh(s,t);const l=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},o,r);return{salt:ti(new Uint8Array(t)),iv:ti(new Uint8Array(i)),encryptedText:ti(new Uint8Array(l))}}const ke=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];function ti(n){let e="",t,i=n.length;for(t=2;t<i;t+=3)e+=ke[n[t-2]>>2],e+=ke[(n[t-2]&3)<<4|n[t-1]>>4],e+=ke[(n[t-1]&15)<<2|n[t]>>6],e+=ke[n[t]&63];return t===i+1&&(e+=ke[n[t-2]>>2],e+=ke[(n[t-2]&3)<<4],e+="=="),t===i&&(e+=ke[n[t-2]>>2],e+=ke[(n[t-2]&3)<<4|n[t-1]>>4],e+=ke[(n[t-1]&15)<<2],e+="="),e}const Ie=n=>{const e=console.error;Object.assign(console,{error:(...i)=>{(!i[0]||!i[0].toString||!i[0].toString().includes("You should not include your API secret in your web client bundle"))&&e.apply(console,i)}});const t=n();return Object.assign(console,{error:e}),t},Fn=(n,e,t)=>Ie(()=>new Ho(n,e,t));async function Uh(n,e,t){const i=Fn(n,e,{identity:t,ttl:86400});return i.addGrant({room:t,roomJoin:!0,roomCreate:!0,roomAdmin:!0,roomList:!0,canPublish:!0,canSubscribe:!1,canPublishData:!0,canUpdateOwnMetadata:!0}),await i.toJwt()}async function Kh(n,e){const{encryptedText:t,iv:i,salt:r}=await Bh(n,e);return{salt:r,iv:i,token:t}}async function Vh(n,e,t,i){const r=Fn(n,e,{identity:i,name:i,ttl:21600});return r.addGrant({room:t,roomList:!0,roomJoin:!0,canPublish:!1,canSubscribe:!0,canPublishData:!0,canUpdateOwnMetadata:!1}),await r.toJwt()}async function qh(n,e){const t=Fn(n,e,{identity:"lt",ttl:94608e5});return t.addGrant({roomList:!0,roomJoin:!1,canPublish:!1,canSubscribe:!1,canPublishData:!1,canUpdateOwnMetadata:!1}),await t.toJwt()}async function Hh(n,e){const t=Fn(n,e,{identity:"lt",ttl:600});return t.addGrant({hidden:!1,room:"connection-test-room",roomList:!0,roomJoin:!0,roomRecord:!1,roomCreate:!1,roomAdmin:!1,canPublish:!1,canSubscribe:!1,canPublishData:!1,canUpdateOwnMetadata:!1}),await t.toJwt()}class $h{constructor(){A(this,"_twitchStreamKey");A(this,"_egressClient");A(this,"roomName");A(this,"streamEgressID")}init(e,t,i,r){this.roomName=t,this._twitchStreamKey=e,this._egressClient=new zo("https://rov-web.livekit.cloud",i,r)}async listRunningEgress(){if(!this._egressClient)throw new Error("Egress client not initialized!");return await this._egressClient.listEgress({active:!0})}isAnotherEgressRunning(e){return e.filter(t=>!this.streamEgressID||t.egressId!=this.streamEgressID).length>0}getCurrentEgress(e){return e.find(t=>t.roomName==this.roomName)}async closeOtherEgresses(e){return this._egressClient?Promise.allSettled(e.filter(t=>!this.streamEgressID||t.egressId!==this.streamEgressID).map(async t=>!this._egressClient||!t.egressId?!1:(j("Closing egress: ",t),await this._egressClient.stopEgress(t.egressId)))):!1}async startStream(){if(!this._twitchStreamKey||!this._egressClient||!this.roomName)return K("startStream() err: Twitch stream key not set or twitchStream class not initilized!");let e=await Ie(()=>this.listRunningEgress()),t=this.getCurrentEgress(e);if(t!==void 0){j("Found current twitch egress: ",t),this.streamEgressID=t.egressId;return}else{for(;await this.isAnotherEgressRunning(e)==!0;){const s=await this.closeOtherEgresses(e);if(B("egressCloseStates",s),j("Another twitch stream is running, waiting 2 seconds to try again..."),await Kt(2e3),e=await this.listRunningEgress(),t=this.getCurrentEgress(e),t!==void 0){j("Found current twitch egress: ",t),this.streamEgressID=t.egressId;return}}const i=new qe({protocol:Ro.RTMP,urls:["rtmp://live.twitch.tv/app/"+this._twitchStreamKey]});let r=await Ie(()=>{var s;return(s=this._egressClient)==null?void 0:s.startRoomCompositeEgress(this.roomName,i)});this.streamEgressID=r==null?void 0:r.egressId,B("Twitch stream started: ",r)}}async stopStream(){if(!this._egressClient)return K("stopStream() err: Twitch Stream not started!");const e=this.streamEgressID;if(this.streamEgressID=void 0,e){const r=await Ie(()=>{var s;return(s=this==null?void 0:this._egressClient)==null?void 0:s.stopEgress(e)});B("Twitch stream stopped: ",r)}const t=await Ie(()=>this.listRunningEgress()),i=this.getCurrentEgress(t);if(i){B("Egress still running: ",i);const r=await Ie(()=>{var s;return(s=this==null?void 0:this._egressClient)==null?void 0:s.stopEgress(i.egressId)});B("Twitch stream stopped: ",r)}this.streamEgressID=void 0}}const Cn=new $h;let ni=null,ki=!1,Yo=!1,Nt=0,ii=1;function ri(n,e=!0){ki=n,te.sendMessage(oe.create({body:{oneofKind:"arming",arming:{armed:n}}}),!0,[]),ki?Ae.sendMessage(fc()):Ae.sendMessage(mc())}function Wh(n,e){var r,s,o,l,f,h,u,p,_,I,C;const t=e.body,i=t.oneofKind;if(i==="ping")return te.sendMessage(oe.create({body:{oneofKind:"pong",pong:{time:t.ping.time}}}),!1,[n]),Ae.sendMessage(_c()),!0;if(i==="simplePeerSignal"){const w=t.simplePeerSignal.message;return te.ingestSimplePeerSignalMsg(n,w),!0}else if(i==="move"){if(ni&&ni!==n||!ki)return!1;Yo||ri(!0);let w=(t.move.velocityX||0)*1e3,T=(t.move.velocityY||0)*1e3,N=(t.move.velocityZ||0)*500+500,R=(t.move.angularVelocityYaw||0)*500,v=t.move.buttonBitmask||0;return Ae.sendMessage(yc(w,T,N,R,v)),!0}else{if(i==="shutdownRov")return Fr("poweroff").then(w=>{te.sendMessage(oe.create({exchangeId:e.exchangeId,body:{oneofKind:"done",done:{message:w}}}),!1,[])}).catch(w=>{te.sendMessage(oe.create({exchangeId:e.exchangeId,body:{oneofKind:"error",error:{message:w.message}}}),!1,[])}),!0;if(i==="rebootRov")return Fr("reboot").then(w=>{te.sendMessage(oe.create({exchangeId:e.exchangeId,body:{oneofKind:"done",done:{message:w}}}),!1,[])}).catch(w=>{te.sendMessage(oe.create({exchangeId:e.exchangeId,body:{oneofKind:"error",error:{message:w.message}}}),!1,[])}),!0;if(i==="moveClaw")return B("Setting servo ",Nt," of group ",ii," to ",.25),Ae.sendMessage(Ec(Nt,.25,ii)),Nt==7?(Nt=0,ii++):Nt++,!0;if(i==="setAutopilotMode")return Ae.sendMessage(gc(t.setAutopilotMode.mode)),!0;if(i==="disarm")return ri(!1),!0;if(i==="takeControl")return ni=n,te.sendMessage(oe.create({body:{oneofKind:"pilotChanged",pilotChanged:{pilotIdentity:n}}}),!1,[]),ri(!0),!0;if(i==="sendRovLogs")return Rn.sendQueuedLogs((w,T)=>te.sendMessage(oe.create({body:{oneofKind:"logMessage",logMessage:{level:w??ec.Debug,message:T}}}),!0,[])),!0;if(i==="setLivestreamingEnabled")t.setLivestreamingEnabled.enabled?Cn.startStream():Cn.stopStream();else if(i==="setLivekitVideoOptions"){const w=vt.videoCaptureDefaults,T=vt.publishDefaults,N=t.setLivekitVideoOptions,R=N.baseStream;if(!N.enabled)return te.setLivekitVideoOptions(!1),!0;B("Got Livekit Video Options: ",N);const v=16/9,L={...w,resolution:{width:(R==null?void 0:R.width)||Math.floor(((R==null?void 0:R.height)||0)*v)||((r=w==null?void 0:w.resolution)==null?void 0:r.width)||1920,height:(R==null?void 0:R.height)||Math.floor(((R==null?void 0:R.width)||0)/v)||((s=w==null?void 0:w.resolution)==null?void 0:s.height)||1080,frameRate:(R==null?void 0:R.fps)||((o=w==null?void 0:w.resolution)==null?void 0:o.frameRate)},facingMode:w==null?void 0:w.facingMode},F=N.simulcastLayers?N.simulcastLayers.map((q,we)=>{var en,tn,nn,rn;const ne=T!=null&&T.videoSimulcastLayers?T==null?void 0:T.videoSimulcastLayers[we]:void 0;return{encoding:{maxBitrate:q.maxBitrate??(R==null?void 0:R.maxBitrate)??((en=ne==null?void 0:ne.encoding)==null?void 0:en.maxBitrate)??99e9,maxFramerate:q.fps||((tn=ne==null?void 0:ne.encoding)==null?void 0:tn.maxFramerate),priority:"high"},width:q.width||(q.height?Math.floor(q.height*v):null)||(ne==null?void 0:ne.width)||((nn=w==null?void 0:w.resolution)==null?void 0:nn.width),height:q.height||(q.width?Math.floor(q.width/v):null)||(ne==null?void 0:ne.height)||((rn=w==null?void 0:w.resolution)==null?void 0:rn.height)}}):T==null?void 0:T.videoSimulcastLayers,z=N.codec!==null&&N.codec!==void 0?N.codec:T==null?void 0:T.videoCodec,re={...T,videoCodec:z,videoEncoding:{maxBitrate:(R==null?void 0:R.maxBitrate)??((l=T==null?void 0:T.videoEncoding)==null?void 0:l.maxBitrate)??99e9,maxFramerate:(R==null?void 0:R.fps)||((f=T==null?void 0:T.videoEncoding)==null?void 0:f.maxFramerate),priority:(h=T==null?void 0:T.videoEncoding)==null?void 0:h.priority},backupCodec:N.allowBackupCodec??(T==null?void 0:T.backupCodec),simulcast:N.simulcastLayers?N.simulcastLayers.length>0:T==null?void 0:T.simulcast,videoSimulcastLayers:F};return console.log("Setting Livekit Video Options: ",L,re),te.setLivekitVideoOptions(!0,L,re),!0}else if(i==="setSimplePeerVideoOptions"){const w=vt.videoCaptureDefaults,T=vt.publishDefaults,N=t.setSimplePeerVideoOptions,R=N.baseStream;if(B("Got SimplePeer Video Options: ",N),!N.enabled)return te.setSimplePeerVideoOptions(!1,n),!0;const v=16/9,L={...w,resolution:{width:Math.floor(((R==null?void 0:R.height)||((u=w==null?void 0:w.resolution)==null?void 0:u.height)||0)*v),height:(R==null?void 0:R.height)||((p=w==null?void 0:w.resolution)==null?void 0:p.height)||0,frameRate:(R==null?void 0:R.fps)||((_=w==null?void 0:w.resolution)==null?void 0:_.frameRate)||60},facingMode:w==null?void 0:w.facingMode},z={videoCodec:N.codec?N.codec:T==null?void 0:T.videoCodec,videoEncoding:{maxBitrate:(R==null?void 0:R.maxBitrate)||((I=T==null?void 0:T.videoEncoding)==null?void 0:I.maxBitrate)||0,maxFramerate:(R==null?void 0:R.fps)||((C=T==null?void 0:T.videoEncoding)==null?void 0:C.maxFramerate)}};return te.setSimplePeerVideoOptions(!0,n,L,z),!0}else return K("Unknown Message Recived: ",li.toJson(e)),!1}}function cs(n,e){let t=new Uint8Array(e);if(!t||t.length===0)return;const i=li.fromBinary(t);if(Wh(n,i))return;i.backendMetadata=i.backendMetadata||Za.create(),i.backendMetadata.fromUserId=n;const r=li.toBinary(i);yn.isConnected&&yn.sendMessage(r)}function Jh(n){if(!n||!n.message)return;const e=n.message;e.type&&e.type==="HEARTBEAT"&&(Yo=!!(e.base_mode.bits&ui.MAV_MODE_FLAG_SAFETY_ARMED))}let mt=[];function Ne(n){let e=[],t=(o,l=!0)=>(e.includes(o)||e.push(o),l&&o(n),()=>{e=e.filter(f=>f!=o)});function i(o){if(o===n&&(n===null||typeof n!="object"))return;let l=n;n=o;for(let f of e)f(n,l)}function r(){let o=mt[mt.length-1];return o&&t(o[0],!1),n}if(typeof n=="function")return jh(n);function s(){for(let o of e)o(n,n)}return{subscribe:t,set:i,get:r,refresh:s,update:o=>{typeof o=="function"&&i(o(n))}}}function jh(n){let e=Ne(null),t=[i];return i(),e;function i(){if(mt.includes(t))throw Error("Circular computation");mt.push(t);let r;try{r=n()}catch(s){throw mt.pop(),s}mt.pop(),e.set(r)}}function Xo(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ci={exports:{}},si,us;function Gh(){if(us)return si;us=1;var n=1e3,e=n*60,t=e*60,i=t*24,r=i*7,s=i*365.25;si=function(u,p){p=p||{};var _=typeof u;if(_==="string"&&u.length>0)return o(u);if(_==="number"&&isFinite(u))return p.long?f(u):l(u);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(u))};function o(u){if(u=String(u),!(u.length>100)){var p=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(p){var _=parseFloat(p[1]),I=(p[2]||"ms").toLowerCase();switch(I){case"years":case"year":case"yrs":case"yr":case"y":return _*s;case"weeks":case"week":case"w":return _*r;case"days":case"day":case"d":return _*i;case"hours":case"hour":case"hrs":case"hr":case"h":return _*t;case"minutes":case"minute":case"mins":case"min":case"m":return _*e;case"seconds":case"second":case"secs":case"sec":case"s":return _*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return _;default:return}}}}function l(u){var p=Math.abs(u);return p>=i?Math.round(u/i)+"d":p>=t?Math.round(u/t)+"h":p>=e?Math.round(u/e)+"m":p>=n?Math.round(u/n)+"s":u+"ms"}function f(u){var p=Math.abs(u);return p>=i?h(u,p,i,"day"):p>=t?h(u,p,t,"hour"):p>=e?h(u,p,e,"minute"):p>=n?h(u,p,n,"second"):u+" ms"}function h(u,p,_,I){var C=p>=_*1.5;return Math.round(u/_)+" "+I+(C?"s":"")}return si}function zh(n){t.debug=t,t.default=t,t.coerce=f,t.disable=s,t.enable=r,t.enabled=o,t.humanize=Gh(),t.destroy=h,Object.keys(n).forEach(u=>{t[u]=n[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let p=0;for(let _=0;_<u.length;_++)p=(p<<5)-p+u.charCodeAt(_),p|=0;return t.colors[Math.abs(p)%t.colors.length]}t.selectColor=e;function t(u){let p,_=null,I,C;function w(...T){if(!w.enabled)return;const N=w,R=Number(new Date),v=R-(p||R);N.diff=v,N.prev=p,N.curr=R,p=R,T[0]=t.coerce(T[0]),typeof T[0]!="string"&&T.unshift("%O");let L=0;T[0]=T[0].replace(/%([a-zA-Z%])/g,(z,re)=>{if(z==="%%")return"%";L++;const q=t.formatters[re];if(typeof q=="function"){const we=T[L];z=q.call(N,we),T.splice(L,1),L--}return z}),t.formatArgs.call(N,T),(N.log||t.log).apply(N,T)}return w.namespace=u,w.useColors=t.useColors(),w.color=t.selectColor(u),w.extend=i,w.destroy=t.destroy,Object.defineProperty(w,"enabled",{enumerable:!0,configurable:!1,get:()=>_!==null?_:(I!==t.namespaces&&(I=t.namespaces,C=t.enabled(u)),C),set:T=>{_=T}}),typeof t.init=="function"&&t.init(w),w}function i(u,p){const _=t(this.namespace+(typeof p>"u"?":":p)+u);return _.log=this.log,_}function r(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];let p;const _=(typeof u=="string"?u:"").split(/[\s,]+/),I=_.length;for(p=0;p<I;p++)_[p]&&(u=_[p].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.slice(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function s(){const u=[...t.names.map(l),...t.skips.map(l).map(p=>"-"+p)].join(",");return t.enable(""),u}function o(u){if(u[u.length-1]==="*")return!0;let p,_;for(p=0,_=t.skips.length;p<_;p++)if(t.skips[p].test(u))return!1;for(p=0,_=t.names.length;p<_;p++)if(t.names[p].test(u))return!0;return!1}function l(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function f(u){return u instanceof Error?u.stack||u.message:u}function h(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var Yh=zh;(function(n,e){var t={};e.formatArgs=r,e.save=s,e.load=o,e.useColors=i,e.storage=l(),e.destroy=(()=>{let h=!1;return()=>{h||(h=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function i(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let h;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(h=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(h[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(h){if(h[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+h[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;h.splice(1,0,u,"color: inherit");let p=0,_=0;h[0].replace(/%[a-zA-Z%]/g,I=>{I!=="%%"&&(p++,I==="%c"&&(_=p))}),h.splice(_,0,u)}e.log=console.debug||console.log||(()=>{});function s(h){try{h?e.storage.setItem("debug",h):e.storage.removeItem("debug")}catch{}}function o(){let h;try{h=e.storage.getItem("debug")}catch{}return!h&&typeof Pt<"u"&&"env"in Pt&&(h=t.DEBUG),h}function l(){try{return localStorage}catch{}}n.exports=Yh(e);const{formatters:f}=n.exports;f.j=function(h){try{return JSON.stringify(h)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(Ci,Ci.exports);var Xh=Ci.exports;const Qh=Xo(Xh),ve=typeof window<"u"?window:self,Ri=ve.RTCPeerConnection||ve.mozRTCPeerConnection||ve.webkitRTCPeerConnection,Zh=ve.RTCSessionDescription||ve.mozRTCSessionDescription||ve.webkitRTCSessionDescription,ef=ve.RTCIceCandidate||ve.mozRTCIceCandidate||ve.webkitRTCIceCandidate;var Wi={exports:{}},pt=typeof Reflect=="object"?Reflect:null,ls=pt&&typeof pt.apply=="function"?pt.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)},_n;pt&&typeof pt.ownKeys=="function"?_n=pt.ownKeys:Object.getOwnPropertySymbols?_n=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:_n=function(e){return Object.getOwnPropertyNames(e)};function tf(n){console&&console.warn&&console.warn(n)}var Qo=Number.isNaN||function(e){return e!==e};function M(){M.init.call(this)}Wi.exports=M;Wi.exports.once=of;M.EventEmitter=M;M.prototype._events=void 0;M.prototype._eventsCount=0;M.prototype._maxListeners=void 0;var ds=10;function Mn(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(M,"defaultMaxListeners",{enumerable:!0,get:function(){return ds},set:function(n){if(typeof n!="number"||n<0||Qo(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");ds=n}});M.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};M.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Qo(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Zo(n){return n._maxListeners===void 0?M.defaultMaxListeners:n._maxListeners}M.prototype.getMaxListeners=function(){return Zo(this)};M.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r=e==="error",s=this._events;if(s!==void 0)r=r&&s.error===void 0;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var l=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw l.context=o,l}var f=s[e];if(f===void 0)return!1;if(typeof f=="function")ls(f,this,t);else for(var h=f.length,u=ra(f,h),i=0;i<h;++i)ls(u[i],this,t);return!0};function ea(n,e,t,i){var r,s,o;if(Mn(t),s=n._events,s===void 0?(s=n._events=Object.create(null),n._eventsCount=0):(s.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),s=n._events),o=s[e]),o===void 0)o=s[e]=t,++n._eventsCount;else if(typeof o=="function"?o=s[e]=i?[t,o]:[o,t]:i?o.unshift(t):o.push(t),r=Zo(n),r>0&&o.length>r&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=n,l.type=e,l.count=o.length,tf(l)}return n}M.prototype.addListener=function(e,t){return ea(this,e,t,!1)};M.prototype.on=M.prototype.addListener;M.prototype.prependListener=function(e,t){return ea(this,e,t,!0)};function nf(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ta(n,e,t){var i={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},r=nf.bind(i);return r.listener=t,i.wrapFn=r,r}M.prototype.once=function(e,t){return Mn(t),this.on(e,ta(this,e,t)),this};M.prototype.prependOnceListener=function(e,t){return Mn(t),this.prependListener(e,ta(this,e,t)),this};M.prototype.removeListener=function(e,t){var i,r,s,o,l;if(Mn(t),r=this._events,r===void 0)return this;if(i=r[e],i===void 0)return this;if(i===t||i.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if(typeof i!="function"){for(s=-1,o=i.length-1;o>=0;o--)if(i[o]===t||i[o].listener===t){l=i[o].listener,s=o;break}if(s<0)return this;s===0?i.shift():rf(i,s),i.length===1&&(r[e]=i[0]),r.removeListener!==void 0&&this.emit("removeListener",e,l||t)}return this};M.prototype.off=M.prototype.removeListener;M.prototype.removeAllListeners=function(e){var t,i,r;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var s=Object.keys(i),o;for(r=0;r<s.length;++r)o=s[r],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=i[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this};function na(n,e,t){var i=n._events;if(i===void 0)return[];var r=i[e];return r===void 0?[]:typeof r=="function"?t?[r.listener||r]:[r]:t?sf(r):ra(r,r.length)}M.prototype.listeners=function(e){return na(this,e,!0)};M.prototype.rawListeners=function(e){return na(this,e,!1)};M.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):ia.call(n,e)};M.prototype.listenerCount=ia;function ia(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}M.prototype.eventNames=function(){return this._eventsCount>0?_n(this._events):[]};function ra(n,e){for(var t=new Array(e),i=0;i<e;++i)t[i]=n[i];return t}function rf(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function sf(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function of(n,e){return new Promise(function(t,i){function r(o){n.removeListener(e,s),i(o)}function s(){typeof n.removeListener=="function"&&n.removeListener("error",r),t([].slice.call(arguments))}sa(n,e,s,{once:!0}),e!=="error"&&af(n,r,{once:!0})})}function af(n,e,t){typeof n.on=="function"&&sa(n,"error",e,t)}function sa(n,e,t,i){if(typeof n.on=="function")i.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function r(s){i.once&&n.removeEventListener(e,r),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var cf=Wi.exports,uf=typeof queueMicrotask=="function"?queueMicrotask:n=>Promise.resolve().then(n),lf=class{constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return this.buffer[this.btm]===void 0}};const hs=lf;var df=class{constructor(e){this.hwm=e||16,this.head=new hs(this.hwm),this.tail=this.head,this.length=0}clear(){this.head=this.tail,this.head.clear(),this.length=0}push(e){if(this.length++,!this.head.push(e)){const t=this.head;this.head=t.next=new hs(2*this.head.buffer.length),this.head.push(e)}}shift(){this.length!==0&&this.length--;const e=this.tail.shift();if(e===void 0&&this.tail.next){const t=this.tail.next;return this.tail.next=null,this.tail=t,this.tail.shift()}return e}peek(){const e=this.tail.peek();return e===void 0&&this.tail.next?this.tail.next.peek():e}isEmpty(){return this.length===0}},oa=class{constructor(e){this.decoder=new TextDecoder(e==="utf16le"?"utf16-le":e)}decode(e){return this.decoder.decode(e,{stream:!0})}flush(){return this.decoder.decode(new Uint8Array(0))}};const hf=oa,ff=oa;var mf=class{constructor(e="utf8"){switch(this.encoding=pf(e),this.encoding){case"utf8":this.decoder=new ff;break;case"utf16le":case"base64":throw new Error("Unsupported encoding: "+this.encoding);default:this.decoder=new hf(this.encoding)}}push(e){return typeof e=="string"?e:this.decoder.decode(e)}write(e){return this.push(e)}end(e){let t="";return e&&(t=this.push(e)),t+=this.decoder.flush(),t}};function pf(n){switch(n=n.toLowerCase(),n){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return n;default:throw new Error("Unknown encoding: "+n)}}const{EventEmitter:gf}=cf,Dn=new Error("Stream was destroyed"),oi=new Error("Premature close"),aa=uf,ca=df,_f=mf,$=(1<<29)-1,nt=1,Ji=2,Xe=4,Ft=8,ua=$^nt,yf=$^Ji,Yt=16,Mt=32,bt=64,Be=128,Xt=256,ji=512,Qe=1024,Ii=2048,Gi=4096,zi=8192,me=16384,gt=32768,Bn=65536,Ze=131072,la=Xt|ji,Ef=Yt|Bn,Tf=bt|Yt,wf=Gi|Be,Yi=Xt|Ze,Sf=$^Yt,bf=$^bt,kf=$^(bt|Bn),fs=$^Bn,Cf=$^Xt,Rf=$^(Be|zi),If=$^Qe,ms=$^la,da=$^gt,Af=$^Mt,ha=$^Ze,Nf=$^Yi,$e=1<<18,Et=2<<18,Qt=4<<18,et=8<<18,Zt=16<<18,it=32<<18,Ai=64<<18,_t=128<<18,Xi=256<<18,Tt=512<<18,Un=1024<<18,fa=$^($e|Xi),ma=$^Qt,vf=$^Tt,Of=$^Zt,xf=$^et,pa=$^_t,Pf=$^Et,ga=$^Un,Dt=Yt|$e,_a=$^Dt,Qi=me|it,Oe=Xe|Ft|Ji,de=Oe|nt,ya=Oe|Qi,Lf=ma&bf,Zi=_t|gt,Ff=Zi&_a,Ea=de|Ff,Mf=de|Qe|me,ps=de|me|Be,Df=de|Qe|Be,Bf=de|Gi|Be|zi,Uf=de|Yt|Qe|me|Bn|Ze,Kf=Oe|Qe|me,Vf=Mt|de|gt|bt,qf=de|Tt|it,Hf=et|Zt,Ta=et|$e,$f=et|Zt|de|$e,gs=de|$e|et|Un,Wf=Qt|$e,Jf=$e|Xi,jf=de|Tt|Ta|it,Gf=Zt|Oe|Tt|it,zf=Et|de|_t|Qt,cn=Symbol.asyncIterator||Symbol("asyncIterator");class wa{constructor(e,{highWaterMark:t=16384,map:i=null,mapWritable:r,byteLength:s,byteLengthWritable:o}={}){this.stream=e,this.queue=new ca,this.highWaterMark=t,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=o||s||Aa,this.map=r||i,this.afterWrite=tm.bind(this),this.afterUpdateNextTick=rm.bind(this)}get ended(){return(this.stream._duplexState&it)!==0}push(e){return this.map!==null&&(e=this.map(e)),this.buffered+=this.byteLength(e),this.queue.push(e),this.buffered<this.highWaterMark?(this.stream._duplexState|=et,!0):(this.stream._duplexState|=Hf,!1)}shift(){const e=this.queue.shift();return this.buffered-=this.byteLength(e),this.buffered===0&&(this.stream._duplexState&=xf),e}end(e){typeof e=="function"?this.stream.once("finish",e):e!=null&&this.push(e),this.stream._duplexState=(this.stream._duplexState|Tt)&ma}autoBatch(e,t){const i=[],r=this.stream;for(i.push(e);(r._duplexState&gs)===Ta;)i.push(r._writableState.shift());if(r._duplexState&de)return t(null);r._writev(i,t)}update(){const e=this.stream;e._duplexState|=Et;do{for(;(e._duplexState&gs)===et;){const t=this.shift();e._duplexState|=Jf,e._write(t,this.afterWrite)}e._duplexState&Wf||this.updateNonPrimary()}while(this.continueUpdate()===!0);e._duplexState&=Pf}updateNonPrimary(){const e=this.stream;if((e._duplexState&jf)===Tt){e._duplexState=(e._duplexState|$e)&vf,e._final(em.bind(this));return}if((e._duplexState&Oe)===Xe){e._duplexState&Zi||(e._duplexState|=Dt,e._destroy(Sa.bind(this)));return}(e._duplexState&Ea)===nt&&(e._duplexState=(e._duplexState|Dt)&ua,e._open(ba.bind(this)))}continueUpdate(){return this.stream._duplexState&_t?(this.stream._duplexState&=pa,!0):!1}updateCallback(){(this.stream._duplexState&zf)===Qt?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&_t||(this.stream._duplexState|=_t,this.stream._duplexState&Et||aa(this.afterUpdateNextTick))}}class Yf{constructor(e,{highWaterMark:t=16384,map:i=null,mapReadable:r,byteLength:s,byteLengthReadable:o}={}){this.stream=e,this.queue=new ca,this.highWaterMark=t===0?1:t,this.buffered=0,this.readAhead=t>0,this.error=null,this.pipeline=null,this.byteLength=o||s||Aa,this.map=r||i,this.pipeTo=null,this.afterRead=nm.bind(this),this.afterUpdateNextTick=im.bind(this)}get ended(){return(this.stream._duplexState&me)!==0}pipe(e,t){if(this.pipeTo!==null)throw new Error("Can only pipe to one destination");if(typeof t!="function"&&(t=null),this.stream._duplexState|=ji,this.pipeTo=e,this.pipeline=new Qf(this.stream,e,t),t&&this.stream.on("error",_s),Ut(e))e._writableState.pipeline=this.pipeline,t&&e.on("error",_s),e.on("finish",this.pipeline.finished.bind(this.pipeline));else{const i=this.pipeline.done.bind(this.pipeline,e),r=this.pipeline.done.bind(this.pipeline,e,null);e.on("error",i),e.on("close",r),e.on("finish",this.pipeline.finished.bind(this.pipeline))}e.on("drain",Zf.bind(this)),this.stream.emit("piping",e),e.emit("pipe",this.stream)}push(e){const t=this.stream;return e===null?(this.highWaterMark=0,t._duplexState=(t._duplexState|Qe)&kf,!1):this.map!==null&&(e=this.map(e),e===null)?(t._duplexState&=fs,this.buffered<this.highWaterMark):(this.buffered+=this.byteLength(e),this.queue.push(e),t._duplexState=(t._duplexState|Be)&fs,this.buffered<this.highWaterMark)}shift(){const e=this.queue.shift();return this.buffered-=this.byteLength(e),this.buffered===0&&(this.stream._duplexState&=Rf),e}unshift(e){const t=[this.map!==null?this.map(e):e];for(;this.buffered>0;)t.push(this.shift());for(let i=0;i<t.length-1;i++){const r=t[i];this.buffered+=this.byteLength(r),this.queue.push(r)}this.push(t[t.length-1])}read(){const e=this.stream;if((e._duplexState&ps)===Be){const t=this.shift();return this.pipeTo!==null&&this.pipeTo.write(t)===!1&&(e._duplexState&=ms),e._duplexState&Ii&&e.emit("data",t),t}return this.readAhead===!1&&(e._duplexState|=Ze,this.updateNextTick()),null}drain(){const e=this.stream;for(;(e._duplexState&ps)===Be&&e._duplexState&la;){const t=this.shift();this.pipeTo!==null&&this.pipeTo.write(t)===!1&&(e._duplexState&=ms),e._duplexState&Ii&&e.emit("data",t)}}update(){const e=this.stream;e._duplexState|=Mt;do{for(this.drain();this.buffered<this.highWaterMark&&(e._duplexState&Uf)===Ze;)e._duplexState|=Ef,e._read(this.afterRead),this.drain();(e._duplexState&Bf)===wf&&(e._duplexState|=zi,e.emit("readable")),e._duplexState&Tf||this.updateNonPrimary()}while(this.continueUpdate()===!0);e._duplexState&=Af}updateNonPrimary(){const e=this.stream;if((e._duplexState&Df)===Qe&&(e._duplexState=(e._duplexState|me)&If,e.emit("end"),(e._duplexState&ya)===Qi&&(e._duplexState|=Xe),this.pipeTo!==null&&this.pipeTo.end()),(e._duplexState&Oe)===Xe){e._duplexState&Zi||(e._duplexState|=Dt,e._destroy(Sa.bind(this)));return}(e._duplexState&Ea)===nt&&(e._duplexState=(e._duplexState|Dt)&ua,e._open(ba.bind(this)))}continueUpdate(){return this.stream._duplexState&gt?(this.stream._duplexState&=da,!0):!1}updateCallback(){(this.stream._duplexState&Vf)===bt?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&gt||(this.stream._duplexState|=gt,this.stream._duplexState&Mt||aa(this.afterUpdateNextTick))}}class Xf{constructor(e){this.data=null,this.afterTransform=om.bind(e),this.afterFinal=null}}class Qf{constructor(e,t,i){this.from=e,this.to=t,this.afterPipe=i,this.error=null,this.pipeToFinished=!1}finished(){this.pipeToFinished=!0}done(e,t){if(t&&(this.error=t),e===this.to&&(this.to=null,this.from!==null)){(!(this.from._duplexState&me)||!this.pipeToFinished)&&this.from.destroy(this.error||new Error("Writable stream closed prematurely"));return}if(e===this.from&&(this.from=null,this.to!==null)){e._duplexState&me||this.to.destroy(this.error||new Error("Readable stream closed before ending"));return}this.afterPipe!==null&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null}}function Zf(){this.stream._duplexState|=ji,this.updateCallback()}function em(n){const e=this.stream;n&&e.destroy(n),e._duplexState&Oe||(e._duplexState|=it,e.emit("finish")),(e._duplexState&ya)===Qi&&(e._duplexState|=Xe),e._duplexState&=fa,e._duplexState&Et?this.updateNextTick():this.update()}function Sa(n){const e=this.stream;!n&&this.error!==Dn&&(n=this.error),n&&e.emit("error",n),e._duplexState|=Ft,e.emit("close");const t=e._readableState,i=e._writableState;if(t!==null&&t.pipeline!==null&&t.pipeline.done(e,n),i!==null){for(;i.drains!==null&&i.drains.length>0;)i.drains.shift().resolve(!1);i.pipeline!==null&&i.pipeline.done(e,n)}}function tm(n){const e=this.stream;n&&e.destroy(n),e._duplexState&=fa,this.drains!==null&&sm(this.drains),(e._duplexState&$f)===Zt&&(e._duplexState&=Of,(e._duplexState&Ai)===Ai&&e.emit("drain")),this.updateCallback()}function nm(n){n&&this.stream.destroy(n),this.stream._duplexState&=Sf,this.readAhead===!1&&!(this.stream._duplexState&Xt)&&(this.stream._duplexState&=ha),this.updateCallback()}function im(){this.stream._duplexState&Mt||(this.stream._duplexState&=da,this.update())}function rm(){this.stream._duplexState&Et||(this.stream._duplexState&=pa,this.update())}function sm(n){for(let e=0;e<n.length;e++)--n[e].writes===0&&(n.shift().resolve(!0),e--)}function ba(n){const e=this.stream;n&&e.destroy(n),e._duplexState&Xe||(e._duplexState&Mf||(e._duplexState|=bt),e._duplexState&qf||(e._duplexState|=Qt),e.emit("open")),e._duplexState&=_a,e._writableState!==null&&e._writableState.updateCallback(),e._readableState!==null&&e._readableState.updateCallback()}function om(n,e){e!=null&&this.push(e),this._writableState.afterWrite(n)}function am(n){this._readableState!==null&&(n==="data"&&(this._duplexState|=Ii|Yi,this._readableState.updateNextTick()),n==="readable"&&(this._duplexState|=Gi,this._readableState.updateNextTick())),this._writableState!==null&&n==="drain"&&(this._duplexState|=Ai,this._writableState.updateNextTick())}class er extends gf{constructor(e){super(),this._duplexState=0,this._readableState=null,this._writableState=null,e&&(e.open&&(this._open=e.open),e.destroy&&(this._destroy=e.destroy),e.predestroy&&(this._predestroy=e.predestroy),e.signal&&e.signal.addEventListener("abort",_m.bind(this))),this.on("newListener",am)}_open(e){e(null)}_destroy(e){e(null)}_predestroy(){}get readable(){return this._readableState!==null?!0:void 0}get writable(){return this._writableState!==null?!0:void 0}get destroyed(){return(this._duplexState&Ft)!==0}get destroying(){return(this._duplexState&Oe)!==0}destroy(e){this._duplexState&Oe||(e||(e=Dn),this._duplexState=(this._duplexState|Xe)&Lf,this._readableState!==null&&(this._readableState.highWaterMark=0,this._readableState.error=e),this._writableState!==null&&(this._writableState.highWaterMark=0,this._writableState.error=e),this._duplexState|=Ji,this._predestroy(),this._duplexState&=yf,this._readableState!==null&&this._readableState.updateNextTick(),this._writableState!==null&&this._writableState.updateNextTick())}}class Bt extends er{constructor(e){super(e),this._duplexState|=nt|it|Ze,this._readableState=new Yf(this,e),e&&(this._readableState.readAhead===!1&&(this._duplexState&=ha),e.read&&(this._read=e.read),e.eagerOpen&&this._readableState.updateNextTick(),e.encoding&&this.setEncoding(e.encoding))}setEncoding(e){const t=new _f(e),i=this._readableState.map||dm;return this._readableState.map=r,this;function r(s){const o=t.push(s);return o===""?null:i(o)}}_read(e){e(null)}pipe(e,t){return this._readableState.updateNextTick(),this._readableState.pipe(e,t),e}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(e){return this._readableState.updateNextTick(),this._readableState.push(e)}unshift(e){return this._readableState.updateNextTick(),this._readableState.unshift(e)}resume(){return this._duplexState|=Yi,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=this._readableState.readAhead===!1?Nf:Cf,this}static _fromAsyncIterator(e,t){let i;const r=new Bt({...t,read(o){e.next().then(s).then(o.bind(null,null)).catch(o)},predestroy(){i=e.return()},destroy(o){if(!i)return o(null);i.then(o.bind(null,null)).catch(o)}});return r;function s(o){o.done?r.push(null):r.push(o.value)}}static from(e,t){if(pm(e))return e;if(e[cn])return this._fromAsyncIterator(e[cn](),t);Array.isArray(e)||(e=e===void 0?[]:[e]);let i=0;return new Bt({...t,read(r){this.push(i===e.length?null:e[i++]),r(null)}})}static isBackpressured(e){return(e._duplexState&Kf)!==0||e._readableState.buffered>=e._readableState.highWaterMark}static isPaused(e){return(e._duplexState&Xt)===0}[cn](){const e=this;let t=null,i=null,r=null;return this.on("error",h=>{t=h}),this.on("readable",s),this.on("close",o),{[cn](){return this},next(){return new Promise(function(h,u){i=h,r=u;const p=e.read();p!==null?l(p):e._duplexState&Ft&&l(null)})},return(){return f(null)},throw(h){return f(h)}};function s(){i!==null&&l(e.read())}function o(){i!==null&&l(null)}function l(h){r!==null&&(t?r(t):h===null&&!(e._duplexState&me)?r(Dn):i({value:h,done:h===null}),r=i=null)}function f(h){return e.destroy(h),new Promise((u,p)=>{if(e._duplexState&Ft)return u({value:void 0,done:!0});e.once("close",function(){h?p(h):u({value:void 0,done:!0})})})}}}class ka extends er{constructor(e){super(e),this._duplexState|=nt|me,this._writableState=new wa(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final),e.eagerOpen&&this._writableState.updateNextTick())}cork(){this._duplexState|=Un}uncork(){this._duplexState&=ga,this._writableState.updateNextTick()}_writev(e,t){t(null)}_write(e,t){this._writableState.autoBatch(e,t)}_final(e){e(null)}static isBackpressured(e){return(e._duplexState&Gf)!==0}static drained(e){if(e.destroyed)return Promise.resolve(!1);const t=e._writableState,r=(ym(e)?Math.min(1,t.queue.length):t.queue.length)+(e._duplexState&Xi?1:0);return r===0?Promise.resolve(!0):(t.drains===null&&(t.drains=[]),new Promise(s=>{t.drains.push({writes:r,resolve:s})}))}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}class tr extends Bt{constructor(e){super(e),this._duplexState=nt|this._duplexState&Ze,this._writableState=new wa(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final))}cork(){this._duplexState|=Un}uncork(){this._duplexState&=ga,this._writableState.updateNextTick()}_writev(e,t){t(null)}_write(e,t){this._writableState.autoBatch(e,t)}_final(e){e(null)}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}class Ca extends tr{constructor(e){super(e),this._transformState=new Xf(this),e&&(e.transform&&(this._transform=e.transform),e.flush&&(this._flush=e.flush))}_write(e,t){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=e:this._transform(e,this._transformState.afterTransform)}_read(e){if(this._transformState.data!==null){const t=this._transformState.data;this._transformState.data=null,e(null),this._transform(t,this._transformState.afterTransform)}else e(null)}destroy(e){super.destroy(e),this._transformState.data!==null&&(this._transformState.data=null,this._transformState.afterTransform())}_transform(e,t){t(null,e)}_flush(e){e(null)}_final(e){this._transformState.afterFinal=e,this._flush(um.bind(this))}}class cm extends Ca{}function um(n,e){const t=this._transformState.afterFinal;if(n)return t(n);e!=null&&this.push(e),this.push(null),t(null)}function lm(...n){return new Promise((e,t)=>Ra(...n,i=>{if(i)return t(i);e()}))}function Ra(n,...e){const t=Array.isArray(n)?[...n,...e]:[n,...e],i=t.length&&typeof t[t.length-1]=="function"?t.pop():null;if(t.length<2)throw new Error("Pipeline requires at least 2 streams");let r=t[0],s=null,o=null;for(let h=1;h<t.length;h++)s=t[h],Ut(r)?r.pipe(s,f):(l(r,!0,h>1,f),r.pipe(s)),r=s;if(i){let h=!1;const u=Ut(s)||!!(s._writableState&&s._writableState.autoDestroy);s.on("error",p=>{o===null&&(o=p)}),s.on("finish",()=>{h=!0,u||i(o)}),u&&s.on("close",()=>i(o||(h?null:oi)))}return s;function l(h,u,p,_){h.on("error",_),h.on("close",I);function I(){if(h._readableState&&!h._readableState.ended||p&&h._writableState&&!h._writableState.ended)return _(oi)}}function f(h){if(!(!h||o)){o=h;for(const u of t)u.destroy(h)}}}function dm(n){return n}function Ia(n){return!!n._readableState||!!n._writableState}function Ut(n){return typeof n._duplexState=="number"&&Ia(n)}function hm(n){return!!n._readableState&&n._readableState.ended}function fm(n){return!!n._writableState&&n._writableState.ended}function mm(n,e={}){const t=n._readableState&&n._readableState.error||n._writableState&&n._writableState.error;return!e.all&&t===Dn?null:t}function pm(n){return Ut(n)&&n.readable}function gm(n){return typeof n=="object"&&n!==null&&typeof n.byteLength=="number"}function Aa(n){return gm(n)?n.byteLength:1024}function _s(){}function _m(){this.destroy(new Error("Stream aborted."))}function ym(n){return n._writev!==ka.prototype._writev&&n._writev!==tr.prototype._writev}var Em={pipeline:Ra,pipelinePromise:lm,isStream:Ia,isStreamx:Ut,isEnded:hm,isFinished:fm,getStreamError:mm,Stream:er,Writable:ka,Readable:Bt,Duplex:tr,Transform:Ca,PassThrough:cm};function ys(n,e){for(const t in e)Object.defineProperty(n,t,{value:e[t],enumerable:!0,configurable:!0});return n}function Tm(n,e,t){if(!n||typeof n=="string")throw new TypeError("Please pass an Error to err-code");t||(t={}),typeof e=="object"&&(t=e,e=""),e&&(t.code=e);try{return ys(n,t)}catch{t.message=n.message,t.stack=n.stack;const r=function(){};return r.prototype=Object.create(Object.getPrototypeOf(n)),ys(new r,t)}}var wm=Tm;const P=Xo(wm);/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wrting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const Es="0123456789abcdef",Na=[];for(let n=0;n<256;n++)Na[n]=Es[n>>4&15]+Es[n&15];const Ts=n=>{const e=n.length;let t="",i=0;for(;i<e;)t+=Na[n[i++]];return t};var ws="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Sm=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var un=0;un<ws.length;un++)Sm[ws.charCodeAt(un)]=un;new TextDecoder;const bm=new TextEncoder,km=n=>bm.encode(n),Ss=typeof window<"u"?window:self,Ni=Ss.crypto||Ss.msCrypto||{};Ni.subtle||Ni.webkitSubtle;const bs=n=>{const e=new Uint8Array(n);return Ni.getRandomValues(e)};/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const Cm=Qh("simple-peer"),ai=64*1024,Rm=5*1e3,Im=5*1e3,Am=5*1e3;function ks(n){return n.replace(/a=ice-options:trickle\s\n/g,"")}function Nm(n){console.warn(n)}class He extends Em.Duplex{constructor(t){t=Object.assign({allowHalfOpen:!1},t);super(t);A(this,"_pc");if(this.__objectMode=!!t.objectMode,this._id=Ts(bs(4)).slice(0,7),this._debug("new peer %o",t),this.channelName=t.initiator?t.channelName||Ts(bs(20)):null,this.initiator=t.initiator||!1,this.channelConfig=t.channelConfig||He.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},He.config,t.config),this.offerOptions=t.offerOptions||{},this.answerOptions=t.answerOptions||{},this.sdpTransform=t.sdpTransform||(i=>i),this.streams=t.streams||(t.stream?[t.stream]:[]),this.trickle=t.trickle!==void 0?t.trickle:!0,this.allowHalfTrickle=t.allowHalfTrickle!==void 0?t.allowHalfTrickle:!1,this.iceCompleteTimeout=t.iceCompleteTimeout||Rm,this.iceRestartEnabled=t.iceRestartEnabled??(this.trickle===!0?"onFailure":!1),this.iceFailureRecoveryTimeout=t.iceFailureRecoveryTimeout??Am,this._iceFailureRecoveryTimer=null,this._destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,!Ri)throw P(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._isRestartingIce=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new Ri(this.config)}catch(i){this.__destroy(P(i,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=i=>{this._onIceCandidate(i)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(i=>{this.__destroy(P(i,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=i=>{this._setupData(i)},this.streams&&this.streams.forEach(i=>{this.addStream(i)}),this._pc.ontrack=i=>{this._onTrack(i)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(t){if(!this._destroying){if(this.destroyed)throw P(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof t=="string")try{t=JSON.parse(t)}catch{t={}}this._debug("signal()"),t.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),t.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(t.transceiverRequest.kind,t.transceiverRequest.init)),t.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(t.candidate):this._pendingCandidates.push(t.candidate)),t.sdp&&this._pc.setRemoteDescription(new Zh(t)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(i=>{this._addIceCandidate(i)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(i=>{this.__destroy(P(i,"ERR_SET_REMOTE_DESCRIPTION"))}),!t.sdp&&!t.candidate&&!t.renegotiate&&!t.transceiverRequest&&this.__destroy(P(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(t){const i=new ef(t);this._pc.addIceCandidate(i).catch(r=>{!i.address||i.address.endsWith(".local")?Nm("Ignoring unsupported ICE candidate."):this.__destroy(P(r,"ERR_ADD_ICE_CANDIDATE"))})}send(t){if(!this._destroying){if(this.destroyed)throw P(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(t)}}addTransceiver(t,i){if(!this._destroying){if(this.destroyed)throw P(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(t,i),this._needsNegotiation()}catch(r){this.__destroy(P(r,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:t,init:i}})}}addStream(t){if(!this._destroying){if(this.destroyed)throw P(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),t.getTracks().forEach(i=>{this.addTrack(i,t)})}}addTrack(t,i){if(this._destroying)return;if(this.destroyed)throw P(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const r=this._senderMap.get(t)||new Map;let s=r.get(i);if(!s)s=this._pc.addTrack(t,i),r.set(i,s),this._senderMap.set(t,r),this._needsNegotiation();else throw s.removed?P(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):P(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(t,i,r){if(this._destroying)return;if(this.destroyed)throw P(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const s=this._senderMap.get(t),o=s?s.get(r):null;if(!o)throw P(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");i&&this._senderMap.set(i,s),o.replaceTrack!=null?o.replaceTrack(i):this.__destroy(P(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(t,i){if(this._destroying)return;if(this.destroyed)throw P(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const r=this._senderMap.get(t),s=r?r.get(i):null;if(!s)throw P(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{s.removed=!0,this._pc.removeTrack(s)}catch(o){o.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(s):this.__destroy(P(o,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(t){if(!this._destroying){if(this.destroyed)throw P(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),t.getTracks().forEach(i=>{this.removeTrack(i,t)})}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,queueMicrotask(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this._destroying){if(this.destroyed)throw P(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}restartIce(){return this.initiator?this._isRestartingIce?(this._debug("Already restarting ice, ignoring restartIce()"),!1):(this._iceComplete=!1,clearTimeout(this._iceCompleteTimer),this._iceCompleteTimer=null,this._isNegotiating=!1,this._isRestartingIce=!0,this._pc.restartIce&&this._pc.restartIce(),this._needsNegotiation(),!0):(this._debug("restartIce() only works for the initiator"),!1)}_final(t){this._readableState.ended||this.push(null),t(null)}__destroy(t){this.end(),this._destroy(()=>{},t)}_destroy(t,i){this.destroyed||this._destroying||(this._destroying=!0,this._debug("destroying (error: %s)",i&&(i.message||i)),setTimeout(()=>{if(this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,i&&this.emit("error",i),t()},0))}_setupData(t){if(!t.channel)return this.__destroy(P(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=t.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=ai),this.channelName=this._channel.label,this._channel.onmessage=r=>{this._onChannelMessage(r)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=r=>{const s=r.error instanceof Error?r.error:new Error(`Datachannel error: ${r.message} ${r.filename}:${r.lineno}:${r.colno}`);this.__destroy(P(s,"ERR_DATA_CHANNEL"))};let i=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(i&&this._onChannelClose(),i=!0):i=!1},Im)}_write(t,i){if(this.destroyed)return i(P(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(t)}catch(r){return this.__destroy(P(r,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>ai?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=i):i(null)}else this._debug("write before connect"),this._chunk=t,this._cb=i}_onFinish(){if(this.destroyed)return;const t=()=>{setTimeout(()=>this.__destroy(),1e3)};this._connected?t():this.once("connect",t)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){if(this.destroyed)return;const t=Object.assign({},this.offerOptions);this._isRestartingIce&&(this.offerOptions.iceRestart=!0),this._pc.createOffer(t).then(i=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(i.sdp=ks(i.sdp)),i.sdp=this.sdpTransform(i.sdp);const r=()=>{if(this.destroyed)return;const l=this._pc.localDescription||i;this._debug("signal"),this.emit("signal",{type:l.type,sdp:l.sdp})},s=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?r():this.once("_iceComplete",r))},o=l=>{this.__destroy(P(l,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(i).then(s).catch(o)}).catch(i=>{this.__destroy(P(i,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(t=>{!t.mid&&t.sender.track&&!t.requested&&(t.requested=!0,this.addTransceiver(t.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(t=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(t.sdp=ks(t.sdp)),t.sdp=this.sdpTransform(t.sdp);const i=()=>{if(this.destroyed)return;const o=this._pc.localDescription||t;this._debug("signal"),this.emit("signal",{type:o.type,sdp:o.sdp}),this.initiator||this._requestMissingTransceivers()},r=()=>{this.destroyed||(this.trickle||this._iceComplete?i():this.once("_iceComplete",i))},s=o=>{this.__destroy(P(o,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(t).then(r).catch(s)}).catch(t=>{this.__destroy(P(t,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){if(!(this.destroyed||this._destroying)){if(this._pc.connectionState==="failed")if(this.iceRestartEnabled||this._isRestartingIce)this._startIceFailureRecoveryTimeout();else return this.__destroy(P(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"));(this._pc.connectionState==="failed"&&this.iceRestartEnabled==="onFailure"||this._pc.connectionState==="disconnected"&&this.iceRestartEnabled==="onDisconnect")&&this.initiator&&!this._isRestartingIce&&this.restartIce()}}_onIceStateChange(){if(this.destroyed)return;const t=this._pc.iceConnectionState,i=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",t,i),this.emit("iceStateChange",t,i),i==="complete"&&(this._iceComplete=!0),(t==="connected"||t==="completed")&&(this._iceFailureRecoveryTimer&&(clearTimeout(this._iceFailureRecoveryTimer),this._iceFailureRecoveryTimer=null),this._iceComplete=!0,this._isRestartingIce=!1,this._pcReady=!0,this._maybeReady()),t==="closed"?this.__destroy(P(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED")):t==="failed"&&!this.iceRestartEnabled&&!this._isRestartingIce?this.__destroy(P(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")):t==="failed"&&(this.iceRestartEnabled||this._isRestartingIce)&&this._startIceFailureRecoveryTimeout(),(t==="failed"&&this.iceRestartEnabled==="onFailure"||t==="disconnected"&&this.iceRestartEnabled==="onDisconnect")&&this.initiator&&!this._isRestartingIce&&this.restartIce()}getStats(t){const i=r=>(Object.prototype.toString.call(r.values)==="[object Array]"&&r.values.forEach(s=>{Object.assign(r,s)}),r);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(r=>{const s=[];r.forEach(o=>{s.push(i(o))}),t(null,s)},r=>t(r)):this._pc.getStats.length>0?this._pc.getStats(r=>{if(this.destroyed)return;const s=[];r.result().forEach(o=>{const l={};o.names().forEach(f=>{l[f]=o.stat(f)}),l.id=o.id,l.type=o.type,l.timestamp=o.timestamp,s.push(i(l))}),t(null,s)},r=>t(r)):t(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),(this._connected||this._connecting)&&!this._isRestartingIce||!this._pcReady||!this._channelReady)return;this._connecting=!0;const t=()=>{this.destroyed||this._destroying||this.getStats((i,r)=>{if(this.destroyed||this._destroying)return;i&&(r=[]);const s={},o={},l={};let f=!1;r.forEach(u=>{(u.type==="remotecandidate"||u.type==="remote-candidate")&&(s[u.id]=u),(u.type==="localcandidate"||u.type==="local-candidate")&&(o[u.id]=u),(u.type==="candidatepair"||u.type==="candidate-pair")&&(l[u.id]=u)});const h=u=>{f=!0;let p=o[u.localCandidateId];p&&(p.ip||p.address)?(this.localAddress=p.ip||p.address,this.localPort=Number(p.port)):p&&p.ipAddress?(this.localAddress=p.ipAddress,this.localPort=Number(p.portNumber)):typeof u.googLocalAddress=="string"&&(p=u.googLocalAddress.split(":"),this.localAddress=p[0],this.localPort=Number(p[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let _=s[u.remoteCandidateId];_&&(_.ip||_.address)?(this.remoteAddress=_.ip||_.address,this.remotePort=Number(_.port)):_&&_.ipAddress?(this.remoteAddress=_.ipAddress,this.remotePort=Number(_.portNumber)):typeof u.googRemoteAddress=="string"&&(_=u.googRemoteAddress.split(":"),this.remoteAddress=_[0],this.remotePort=Number(_[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(r.forEach(u=>{u.type==="transport"&&u.selectedCandidatePairId&&h(l[u.selectedCandidatePairId]),(u.type==="googCandidatePair"&&u.googActiveConnection==="true"||(u.type==="candidatepair"||u.type==="candidate-pair")&&u.selected)&&h(u)}),!f&&(!Object.keys(l).length||Object.keys(o).length)){setTimeout(t,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(p){return this.__destroy(P(p,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const u=this._cb;this._cb=null,u(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};t()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>ai||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(t=>{this._pc.removeTrack(t),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(t){this.destroyed||(t.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:t.candidate.candidate,sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid}}):!t.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),t.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(t){if(this.destroyed)return;let i=t.data;i instanceof ArrayBuffer?i=new Uint8Array(i):this.__objectMode===!1&&(i=km(i)),this.push(i)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const t=this._cb;this._cb=null,t(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.__destroy())}_onTrack(t){this.destroyed||t.streams.forEach(i=>{this._debug("on track"),this.emit("track",t.track,i),this._remoteTracks.push({track:t.track,stream:i}),!this._remoteStreams.some(r=>r.id===i.id)&&(this._remoteStreams.push(i),queueMicrotask(()=>{this._debug("on stream"),this.emit("stream",i)}))})}_debug(){const t=[].slice.call(arguments);t[0]="["+this._id+"] "+t[0],Cm.apply(null,t)}_startIceFailureRecoveryTimeout(){this.destroyed||this._iceFailureRecoveryTimer||(this._debug("started iceFailureRecovery timeout"),this._iceComplete=!1,clearTimeout(this._iceCompleteTimer),this._iceCompleteTimer=null,this._iceFailureRecoveryTimer=setTimeout(()=>{const t=this._pc.iceConnectionState,i=this._pc.iceGatheringState;this._debug("checking iceFailureRecovery timeout",t,i,this._iceComplete),!(t==="connected"||t==="completed")&&(this._debug("iceFailureRecovery timeout completed - failed"),this.__destroy(P(new Error("Ice connection recovery failed."),"ERR_ICE_CONNECTION_FAILURE")))},this.iceFailureRecoveryTimeout))}}He.WEBRTC_SUPPORT=!!Ri;He.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};He.channelConfig={};class va{constructor(){A(this,"lastStats");A(this,"timestamp",0);A(this,"bytesSent",0);A(this,"bytesReceived",0);A(this,"selectedCandidatePairId","");this.lastStats={availableIncomingBitrate:0,availableOutgoingBitrate:0,bitrateReceive:0,bitrateSend:0,recieverStats:{},senderLayerStats:[],rtcStatsJson:"",selectedCandidatePairChanges:0,canidatePairState:"waiting",canidatePairNominated:!1,iceState:"new",dtlsState:"new",allStats:[]}}parse(e){var s;let t={...this.lastStats};if(t.senderLayerStats=[],t.recieverStats={},!e)return t.recieverStats.hung=!0,t;const i=t.allStats=Array.from(e.values?e.values():e),r=new Map;for(const o of i)if(o.type==="codec"){const{mimeType:f,sdpFmtpLine:h,id:u}=o,[p,_]=f.toLowerCase().split("/");r.set(u,{codec:_??"unknown",sdpFmtpLine:h})}for(const o of i){const l=o.type;if(l==="inbound-rtp"&&o.kind==="video"){let{frameWidth:f,frameHeight:h,framesPerSecond:u,estimatedPlayoutTimestamp:p,nackCount:_,pliCount:I,jitterBufferDelay:C,freezeCount:w,jitter:T,codecId:N}=o;_=_??0,I=I??0;const{codec:R,sdpFmtpLine:v}=r.get(N||"")||{codec:"unknown",sdpFmtpLine:""},L=Math.max(p?p-this.timestamp:0,C);t.recieverStats={...t.recieverStats,nackCount:_,pliCount:I,freezeCount:w,estimatedPlayoutDelay:L,jitterBufferDelay:C,jitter:T,frameWidth:f,frameHeight:h,framesPerSecond:Math.floor(u),videoCodec:R,videoSdpFmtpLine:v}}else if(l==="outbound-rtp"&&o.kind==="video"){let{retransmittedBytesSent:f,scalabilityMode:h,qualityLimitationResolutionChanges:u,encoderImplementation:p,powerEfficientEncoder:_,qualityLimitationReason:I,qualityLimitationDurations:C,totalPacketSendDelay:w,frameWidth:T,frameHeight:N,framesPerSecond:R,codecId:v}=o;const{codec:L,sdpFmtpLine:F}=r.get(v||"")||{codec:"unknown",sdpFmtpLine:""};(s=t.senderLayerStats)==null||s.push({qualityLimitationResolutionChanges:u,qualityLimitationReason:I,bandwidthLimitedQualityDurration:C.bandwidth,cpuLimitedQualityDurration:C.cpu,otherLimitedQualityDurration:C.other,noLimitedQualityDurration:C.none,encoderImplementation:p,powerEfficientEncoder:_,scalabilityMode:h,totalPacketSendDelay:w,retransmittedBytesSent:f,frameWidth:T,frameHeight:N,framesPerSecond:R,videoCodec:L,videoSdpFmtpLine:F})}else if(l==="candidate-pair"){const{availableOutgoingBitrate:f,availableIncomingBitrate:h,currentRoundTripTime:u,state:p,nominated:_}=o;if(_===!1)continue;t={...t,recieverStats:{...t.recieverStats,currentRoundTripTime:u},availableOutgoingBitrate:Math.floor(f??0),availableIncomingBitrate:Math.floor(h??0),canidatePairState:p,canidatePairNominated:_}}else if(l==="transport"){let{bytesReceived:f,bytesSent:h,selectedCandidatePairId:u,timestamp:p}=o;f=f??0,h=h??0,u=u??"",u!==this.selectedCandidatePairId&&(t.selectedCandidatePairChanges=(t.selectedCandidatePairChanges||0)+1,this.selectedCandidatePairId=u),p!=this.timestamp&&(t.bitrateReceive=Math.floor((f-this.bytesReceived)/(p-this.timestamp)*8e3),t.bitrateSend=Math.floor((h-this.bytesSent)/(p-this.timestamp)*8e3),t.recieverStats={...t.recieverStats,hung:t.bitrateReceive<=0},this.timestamp=p),this.bytesSent=h,this.bytesReceived=f}}return t.senderLayerStats=t.senderLayerStats?t.senderLayerStats.sort((o,l)=>(l.frameWidth||0)*(l.frameHeight||0)-(o.frameWidth||0)*(o.frameHeight||0)):[],this.lastStats=t,t}}class vm extends va{}let Om=0;class xm{constructor(){A(this,"lastMsgRecivedTimestamp");A(this,"connectionState",Ne(Q.init));A(this,"latestRecivedDataMessage",Ne(null));A(this,"outgoingSignalingMessages",Ne(null));A(this,"remoteVideoStreams",Ne(new Map));A(this,"_p",null);A(this,"_spConfig",null);A(this,"_incomingSignalQueue",[]);A(this,"_consecutiveSignalMsgsProcessed",0);A(this,"_msgSendQueue",[]);A(this,"_reconnectAttemptCount");A(this,"_shouldReconnect");A(this,"_initiator",!1);A(this,"_connectionId",-1);A(this,"_signalMsgSendCounter",0);A(this,"_signalMsgRecivedCounter",0);A(this,"_videoStatsParser",new va)}setStreamsEnabled(e){this.remoteVideoStreams.update(t=>(t.forEach(i=>{i&&i.getTracks().forEach(r=>r.enabled=e)}),t))}start(e,t=!0,i=0){if(this._p&&this.stop(),this._shouldReconnect=t,this._spConfig=Object.assign({},e,He.config),K("SP starting with opts: ",this._spConfig,Om++),this._spConfig.initiator&&(this._connectionId=tc()),this._signalMsgRecivedCounter=0,this._signalMsgSendCounter=0,this._p=new He(this._spConfig),!this._p)return ie("Failed to create SimplePeer instance!");this._p._debug=(...r)=>Ee("SIMPLEPEER DEBUG: "+r[0],...r.slice(1)),this._reconnectAttemptCount=i,this._initiator=this._spConfig.initiator||!1,this.connectionState.set(Q.connecting),this._p.on("signal",r=>{if(this._connectionId===-1){alert("SP sending signal message when connectionId is -1, this should not happen!");return}r=Object.assign({},r,{connId:this._connectionId,msgNum:this._signalMsgSendCounter}),this._signalMsgSendCounter++,Ee("SP: signal out",r),this.outgoingSignalingMessages.set(JSON.stringify(r))}),this._p.on("connect",()=>{B("SP: Connected!"),this._reconnectAttemptCount=0,this.connectionState.set(Q.connected)}),this._p.on("data",r=>{this.lastMsgRecivedTimestamp=De(),this.latestRecivedDataMessage.set(r)}),this._p.on("stream",r=>{r.addEventListener,B("SP got video stream: ",r),this.remoteVideoStreams.update(s=>(s=new Map,s.set(r.id,r),s))}),this._p.on("iceStateChange",(r,s)=>{B(`SP: ICE State - connection: ${r}, gathering: ${s}`),r==="connected"||r==="completed"?this.setStreamsEnabled(!0):this.setStreamsEnabled(!1)}),this._p.on("close",()=>{this._initiator||this.resetConnectionStats(),K("SP connection closed")}),this._p.on("end",()=>{K("SP connection ended")}),this._p.on("pause",()=>{K("SP connection paused")}),this._p.on("error",r=>{ie("SP error ",r),this.remoteVideoStreams.set(new Map),this._shouldReconnect=!1,this.connectionState.set(Q.failed)}),this._processSignalMsgQueue()}stop(){var e,t;this.resetConnectionStats(),this.connectionState.set(Q.disconnectedOk),this.remoteVideoStreams.set(new Map),this._shouldReconnect=!1,Ee("SP Stop",this._connectionId,(e=this._p)==null?void 0:e.destroyed,(t=this._p)==null?void 0:t.destroying),this._p&&this._p.destroy(),this._p=null}async restart(e,t){var i,r;Ee("SP Restart",this._reconnectAttemptCount,e,this._connectionId,(i=this._p)==null?void 0:i.destroyed,(r=this._p)==null?void 0:r.destroying),this._reconnectAttemptCount++,this.stop(),this._connectionId=e||-1,console.log("SP Restart2",this._spConfig),this.start(this._spConfig,this._shouldReconnect,this._reconnectAttemptCount),t&&this.ingestSignalingMsg(t)}resetConnectionStats(){this._signalMsgRecivedCounter=0,this._signalMsgSendCounter=0,this._consecutiveSignalMsgsProcessed=0}changeMediaStream(e){if(this._p)try{console.log("SP: changeMediaStream replacing track",e.getVideoTracks()[0].getSettings());const t=this._p.streams[0],i=t.getVideoTracks()[0];this._p.replaceTrack(i,e.getVideoTracks()[0],t)}catch(t){ie("SP: changeMediaStream failed to replace track trying stream remove+add",t.message);for(const i of this._p.streams)this._p.removeStream(i);this._p.addStream(e)}}setCodecPreferences(e){var s,o,l;const t=((s=RTCRtpReceiver.getCapabilities("video"))==null?void 0:s.codecs)||[],i=this.sortCodecsByMimeTypes(t,e);if(B("SP: availReceiveCodecs",t,"sortedCodecs",i),!this._p)return;const r=((l=(o=this._p)==null?void 0:o._pc)==null?void 0:l.getTransceivers())||[];for(const f of r)f.setCodecPreferences(i);this._p.negotiate()}getCodecPreferences(){var t,i;if(!this._p)return;const e=((i=(t=this._p)==null?void 0:t._pc)==null?void 0:i.getTransceivers())||[];for(const r of e){const s=r.receiver.getParameters();if(s.codecs)return s.codecs.map(o=>o.mimeType)}}async getStats(){if(!this._p)return;const e=await new Promise((t,i)=>{(!this._p||!this._p._pc)&&i("No active simplePeer instance found!"),this._p.getStats((r,s)=>{r&&i(r),t(s)})});return this._videoStatsParser.parse(e)}getPlayoutDelay(){var t,i;if(!this._p)return;const e=((i=(t=this._p)==null?void 0:t._pc)==null?void 0:i.getTransceivers())||[];for(const r of e){if(!r.receiver)continue;const s=r.receiver;if(s.playoutDelayHint)return s.playoutDelayHint;if(s.jitterBufferTarget)return s.jitterBufferTarget/1e3}return 0}setPlayoutDelay(e){var i,r;if(!this._p)return;const t=((r=(i=this._p)==null?void 0:i._pc)==null?void 0:r.getTransceivers())||[];for(const s of t){if(!s.receiver)continue;const o=s.receiver;o.playoutDelayHint!==void 0?o.playoutDelayHint!==e&&(Ee("SP: Setting playoutDelayHint to "+e),o.playoutDelayHint=e):o.jitterBufferTarget!==void 0&&o.jitterBufferTarget!==e&&(Ee("SP: Setting jitterBufferTarget to "+e),o.jitterBufferTarget=e*1e3)}}sortCodecsByMimeTypes(e,t){return e.sort((i,r)=>{const s=t.indexOf(i.mimeType.toLowerCase()),o=t.indexOf(r.mimeType.toLowerCase()),l=s>=0?s:Number.MAX_VALUE,f=o>=0?o:Number.MAX_VALUE;return l-f})}ingestSignalingMsg(e){try{const t=JSON.parse(e);if(t.msgNum===void 0||t.connId===void 0)return K("SP: Ignoring Invalid Signal Message (no connId or msgNum)!",t);if(t.connId>this._connectionId){if(K("SP: Found Newer connid, fastforwarding!",t.connId,this._connectionId),this._consecutiveSignalMsgsProcessed=0,this._connectionId=t.connId,this._incomingSignalQueue=[],this._spConfig&&!this._initiator)return this.restart(t.connId,e)}else if(t.connId<this._connectionId){K("SP: Ignoring Signal Message For Old connid (connId mismatch)!",t.connId,this._connectionId);return}B("SP: signal queued",t,t.msgNum,this._consecutiveSignalMsgsProcessed,t.connId,this._connectionId),this._incomingSignalQueue.push(t)}catch(t){K("SP: Failed to parse json signal message: ",e,t.message)}this._processSignalMsgQueue()}sendMessage(e){this._msgSendQueue.push(e),this._emptyMsgQueue()}_processSignalMsgQueue(){if(this._p){console.log("SP: processing signal queue",this._incomingSignalQueue.length-1,this._consecutiveSignalMsgsProcessed);for(let e=0;e<this._incomingSignalQueue.length;e++){if(console.log("SP: processing signal q msg",e,"/",this._incomingSignalQueue.length-1,this._consecutiveSignalMsgsProcessed),this._incomingSignalQueue.length===0)return;const t=this._incomingSignalQueue.findIndex(r=>(r==null?void 0:r.msgNum)===this._consecutiveSignalMsgsProcessed);if(t===-1)return;const i=this._incomingSignalQueue[t];B("SP: signal in",i,i.msgNum,this._consecutiveSignalMsgsProcessed,i.connId,this._connectionId),this._incomingSignalQueue.splice(t,1),e--,this._p.signal(i),this._consecutiveSignalMsgsProcessed++}}}_emptyMsgQueue(){if(!this._p||!this._p.connected)return!1;for(this._msgSendQueue.length;this._msgSendQueue.length>0;){const e=this._msgSendQueue.shift();try{this._p.send(e)}catch(t){ie("failed to send message over simplePeer data channel: ",t.message),this._msgSendQueue.unshift(e)}}}}const ee=j;class Pm{constructor(){A(this,"config");A(this,"lastMsgRecivedTimestamp");A(this,"connectionState");A(this,"latestRecivedDataMessage");A(this,"participantConnectionEvents");A(this,"_rovRoomName");A(this,"_accessToken");A(this,"_reconnectAttemptCount",0);A(this,"_shouldReconnect");A(this,"_roomConn");this.config={},this._shouldReconnect=!0,this.connectionState=Ne(Q.init),this.latestRecivedDataMessage=Ne(null),this.participantConnectionEvents=Ne(null)}async init(e){this.config=e,this._shouldReconnect=!0,this._roomConn=new nc(e.roomConfig),this._roomConn.on(V.DCBufferStatusChanged,t=>{ee("LK: DCBufferStatusChanged ",t)}).on(V.SignalConnected,async()=>{ee(`LK: Signal connection established to ${this.config.hostUrl}`)}).on(V.Connected,async()=>{ee(`LK: Connected to room: ${this._roomConn.name} via ${this.config.hostUrl}`),this.connectionState.set(Q.connected)}).on(V.Disconnected,t=>{this.connectionState.set(Q.disconnectedOk);let i=this._shouldReconnect&&!!this._roomConn;t===Pe.DUPLICATE_IDENTITY?(K("LK: disconnected from room - duplicate identity"),i=!1):t===Pe.CLIENT_INITIATED?(j("LK: disconnected from room - client initiated"),i=!1):t===Pe.PARTICIPANT_REMOVED?(j("LK: disconnected from room - participant removed"),i=!1):t===Pe.ROOM_DELETED?j("LK: disconnected from room - room deleted"):t===Pe.STATE_MISMATCH?j("LK: disconnected from room - state mismatch"):t===Pe.SERVER_SHUTDOWN?j("LK: disconnected from room - server shutdown"):t===Pe.JOIN_FAILURE?j("LK: disconnected from room - join failure"):t===Pe.UNKNOWN_REASON&&j("LK: disconnected from room - unknown reason"),i?this._reconnect():this.close()}).on(V.Reconnecting,()=>{ee(`LK: Reconnecting to room ${this._roomConn.name} via ${this.config.hostUrl}`),this.connectionState.set(Q.reconnecting)}).on(V.Reconnected,async()=>{ee("LK: Successfully reconnected. server",await this._roomConn.engine.getConnectedServerAddress()),this.connectionState.set(Q.connected)}).on(V.ParticipantMetadataChanged,t=>{ee("LK: Participant Metadata Changed",t)}).on(V.ParticipantConnected,async t=>{ee(`LK: Participant ${t.identity} (${t.sid}) connected`,t.metadata),this.participantConnectionEvents.set({id:t.identity,joined:!0}),t.on(ic.ConnectionQualityChanged,()=>{ee("LK: ParticipantEvent.ConnectionQualityChanged",t.connectionQuality)})}).on(V.ParticipantDisconnected,t=>{ee(`LK: Participant ${t.identity} (${t.sid}) disconnected`),this.participantConnectionEvents.set({id:t.identity,joined:!1})}).on(V.MediaDevicesError,t=>{const i=hr.getFailure(t);ee("LK: Media device failure",i)}).on(V.ConnectionQualityChanged,(t,i)=>{ee(`LK: connection quality for ${i?i.identity:"[no identity]"} changed to ${t}`)}).on(V.RoomMetadataChanged,t=>{try{ee("LK: New metadata for room",JSON.parse(t))}catch{ee("LK: New metadata for room (NOT VALID JSON)",t)}}).on(V.MediaDevicesChanged,()=>{ee("LK: MediaDevicesChanged")}).on(V.LocalTrackUnpublished,(t,i)=>{ee("LK: LocalTrackUnpublished",t.trackSid,"by participant",i.identity,"source",t.track?t.track.source:"[no track found]")}).on(V.LocalTrackPublished,(t,i)=>{ee("LK: LocalVideoTrackPublished",t.trackSid,"by participant",i.identity,"source",t.track?t.track.source:"[no track found]")}).on(V.MediaDevicesError,t=>{const i=hr.getFailure(t);ee("LK: media device failure",i)}).on(V.AudioPlaybackStatusChanged,()=>{ee("LK: AudioPlaybackStatusChanged. canPlaybackAudio =",this._roomConn.canPlaybackAudio)})}async start(e,t){this._rovRoomName=e,this._accessToken=t,this._shouldReconnect=!0;const i=De();j(`LK: Starting conn with ${e} via ${this.config.hostUrl} token = ${t}`);try{const r=setTimeout(()=>{j(`livekit connect timeout for ${this.config.hostUrl}. Reconnecting...`),this._reconnect()},16e3);await this._connect(),clearTimeout(r),j(`LK: Connected in ${De()-i}ms ${this.config.hostUrl}`)}catch(r){j(`LK: Error connecting to ${this.config.hostUrl}. Reconnecting...`,r),this._reconnect()}}async sendMessage(e,t=!0,i=[]){if(!this._roomConn)return K("LK: Can't send message, room not connected");if(e.length==0)return K("LK: Can't send empty message");await this._roomConn.localParticipant.publishData(e,{reliable:t,destinationIdentities:i})}getParticipantSid(e){const t=[...this._roomConn.remoteParticipants.values()].find(i=>i.identity===e);return t?t.sid:null}getLivekitIdentitiy(){return this._roomConn?this._roomConn.localParticipant.identity:null}getRoomName(){return this._roomConn?this._roomConn.name:this._rovRoomName}close(){this._shouldReconnect=!1,this.connectionState.set(Q.disconnectedOk),this._roomConn&&(B("LK: Closing Livekit Connection: ",this._rovRoomName,this.config.hostUrl),this._roomConn.disconnect(!0))}async _connect(){await this._roomConn.connect(Ns(this.config.hostUrl),this._accessToken,this.config.roomConnectionConfig),B("LK: Connected to room",this._roomConn.name,this._roomConn)}async _reconnect(){try{await this._roomConn.disconnect(!0)}catch(e){ie("LK: Error disconnecting from room",e)}if(this._shouldReconnect!=!1)if(this._reconnectAttemptCount<this.config.reconnectAttempts){const e=this._reconnectAttemptCount*800;this._reconnectAttemptCount++,await Kt(e);try{await this._connect()}catch(t){throw ie("LK: Error reconnecting to room",t),t}}else ie("LK: Failed to reconnect after ",this._reconnectAttemptCount,"/",this.config.reconnectAttempts,"attempts"),this._fail()}_fail(){this._shouldReconnect=!1,this.connectionState.set(Q.failed)}}const Cs=1e3;let ci=0;class Lm{constructor(e,t,i,r,s=null){A(this,"client");A(this,"egressClient");A(this,"roomName");A(this,"tokenEncryptionPassword");A(this,"apiKey");A(this,"secretKey");this.apiKey=e,this.secretKey=t,this.roomName=r,this.tokenEncryptionPassword=s,this.client=new Ph(i,e,t),this.egressClient=new zo(i,e,t)}getEgressClient(){return this.egressClient}async waitForRateLimit(){for(;De()-ci<Cs;)console.log("Waiting for rate limit...",De()-ci),await Kt(Cs);ci=De()}async deleteLivekitRoom(){try{return await this.client.deleteRoom(this.roomName)}catch(e){K("LK Admin: Failed to delete room: "+this.roomName,e)}}async createLivekitRoom(e,t){const i=await this._generateRoomMetadata(e,t);await this.waitForRateLimit();const r=await Ie(()=>this.client.createRoom({name:this.roomName,maxParticipants:8,metadata:i,syncStreams:!1,emptyTimeout:60,departureTimeout:30}));return B("LK Admin: Created room: "+this.roomName,r),r}async listLivekitRooms(){return await this.waitForRateLimit(),(await Ie(()=>this.client.listRooms())).filter(t=>t.numParticipants>0)}async updateRoomMetadata(e,t){const i=await this._generateRoomMetadata(e,t);await this.waitForRateLimit();try{return await Ie(()=>this.client.updateRoomMetadata(this.roomName,i))}catch(r){throw new Error("LK Admin: Failed to update metadata for room "+this.roomName+r.toString())}}async _generateRoomMetadata(e,t){let r=[],s;for(let l=0;l<3;l++){do s=dc(lc());while(e.includes(s));e.push(s);const f=await Vh(this.apiKey,this.secretKey,this.roomName,s);if(this.tokenEncryptionPassword){const h=await Kh(f,this.tokenEncryptionPassword);r.push({userGivenIdentity:s,encrypted:!0,...h})}else r.push({userGivenIdentity:s,token:f,encrypted:!1})}return JSON.stringify({numParticipants:t,accessTokens:r})}}class Fm extends Pm{constructor(){super();A(this,"_livekitApiKey");A(this,"_livekitSecretKey");A(this,"_livekitAdmin");A(this,"camTrack");A(this,"videoStatsParser",new vm);A(this,"_videoStatsIntervalId");A(this,"_videoPublishOptions");A(this,"_videoCaptureOptions")}async init(t){await super.init(t),this._roomConn.on(V.SignalConnected,()=>{this.isVideoActive()||this.enableCamera(!0),this._roomConn.metadata||this.createLivekitRoom()}).on(V.Reconnecting,()=>{this._roomConn.metadata||this.createLivekitRoom()}).on(V.Connected,()=>{this.isVideoActive()||this.enableCamera(!0),this.updateRoomMetadata()}).on(V.Reconnected,()=>{this.isVideoActive()||this.enableCamera(!0),this.updateRoomMetadata()}).on(V.DataReceived,(i,r)=>{if(!r)return K("LK: Ignoring received data message with no participant. This can happen when the message is sent before connection completes or if the message comes from the server: ",i);const s=r.identity;r.sid,this.lastMsgRecivedTimestamp=De(),this.latestRecivedDataMessage.set({senderId:s,msg:i})}).on(V.TrackSubscribed,(i,r,s)=>{K("LK: Subscribed to track ",r.trackSid," from participant: ",s.identity," source: ",i.source," _THIS SHOULDNT HAPPEN on BACKEND_ ")}).on(V.TrackUnsubscribed,(i,r,s)=>{K("LK: Unsubscribed from track",r.trackSid," from participant: ",s.identity," _THIS SHOULDNT HAPPEN on BACKEND_ ")}).on(V.ParticipantConnected,()=>{this.updateRoomMetadata()})}async startRoom(t,i,r){this._rovRoomName=t,this._livekitApiKey=i,this._livekitSecretKey=r,this._livekitAdmin=this._livekitAdmin??new Lm(i,r,this.config.hostUrl,t,U.ROV_CONTROL_PASSWORD),this.createLivekitRoom();const s=await Uh(i,r,t);await super.start(t,s)}async enableCamera(t,i,r){var s,o,l,f;if(!this._roomConn)throw new Error("LK: Can't enable camera, room not initialized");this._videoCaptureOptions=i||this._videoCaptureOptions||this.config.roomConfig.videoCaptureDefaults,this._videoPublishOptions=r||this._videoPublishOptions||this.config.roomConfig.publishDefaults;for(const[h,u]of this._roomConn.localParticipant.videoTrackPublications)j("LK: Unpublishing video track: ",h,u),u!=null&&u.videoTrack&&this._roomConn.localParticipant.unpublishTrack(u.videoTrack,!0);if(t)for(;;){try{if(this.connectionState.get()===Q.failed)return K("LK: Can't enable camera, room connection failed");const h=await this._roomConn.localParticipant.createTracks({video:{resolution:this._videoCaptureOptions.resolution,facingMode:this._videoCaptureOptions.facingMode},audio:!1});console.log("LK: Created tracks: ",h);for(const u of h){const p=await this._roomConn.localParticipant.publishTrack(h[0],this._videoPublishOptions);p&&u.kind===rc.Kind.Video&&(this.camTrack=p)}if(this.camTrack)return B("LK: Camera enabled",t,this._videoCaptureOptions,this._videoPublishOptions)}catch(h){ie(h.message)}await Kt(1e3)}else(o=(s=this.camTrack)==null?void 0:s.videoTrack)==null||o.stop(),(f=(l=this.camTrack)==null?void 0:l.audioTrack)==null||f.stop(),this.camTrack=void 0,B("LK: Camera disabled",t)}isVideoActive(){if(!this.camTrack||!this.camTrack.videoTrack)return!1;let t=this._roomConn.localParticipant.videoTrackPublications.get(this.camTrack.trackSid);return console.log("LK: Video Publication: ",t," Enabled: ",t==null?void 0:t.isEnabled),t==null?void 0:t.isEnabled}async getVideoStats(){for(const t of this._roomConn.localParticipant.videoTrackPublications.values()){if(!t||!t.videoTrack)continue;const i=await t.videoTrack.getRTCStatsReport();if(!i)continue;const r=this.videoStatsParser.parse(i);if(r)return r}}getParticipantIds(){return[...this._roomConn.remoteParticipants.values()].map(t=>t.identity)}async close(){await super.close()}async _fail(){await super._fail()}async updateRoomMetadata(){if(!this._livekitAdmin)return K("LK: Can't update metadata tokens, livekit admin client not initialized");B("LK: Updating room metadata");const t=this.getParticipantIds().filter(i=>i!==this._rovRoomName);await this._livekitAdmin.updateRoomMetadata(t,t.length+1)}async createLivekitRoom(){if(!this._livekitAdmin)return K("LK: Can't create livekit room, livekit admin client not initialized");const t=this.getParticipantIds(),i=await this._livekitAdmin.createLivekitRoom(t,t.length+1);(!i.metadata||i.numParticipants!==t.length+1)&&await this.updateRoomMetadata()}}class Mm{constructor(){A(this,"_cloudLivekitConnection",new Fm);A(this,"_simplePeerConnections",new Map);A(this,"_simplePeerCameraStream",null);A(this,"simplePeerCameraOptions",Ne(mr));A(this,"_videoStatsIntervalId",null);this._cloudLivekitConnection.init({hostUrl:U.LIVEKIT_CLOUD_ENDPOINT,publishVideo:!0,reconnectAttempts:300,roomConnectionConfig:sc,roomConfig:vt,tokenEncryptionPassword:U.ROV_CONTROL_PASSWORD}),Ct(this._cloudLivekitConnection.latestRecivedDataMessage,e=>{if(!e)return;const{senderId:t,msg:i}=e;cs(t,i)}),Ct(this._cloudLivekitConnection.connectionState,e=>{j("Cloud Conn State Changed: "+e),e==Q.connected}),Ct(this._cloudLivekitConnection.participantConnectionEvents,e=>{j("Cloud Conn Participant Event: ",e)})}async start(e){this._cloudLivekitConnection.connectionState.get(),this._cloudLivekitConnection.connectionState.subscribe(t=>{(t===Q.failed||t===Q.init)&&(B("Creating & Starting Livekit Room: "+e.RovName),gr(this._cloudLivekitConnection.startRoom,this._cloudLivekitConnection,10,1e3,1.3)(e.RovName,e.APIKey,e.SecretKey).catch(r=>{ie(r),j("Too many errors: Triggering Page Reload"),window.location.reload()}))}),B("Connection Manager Started"),await uc(()=>this._cloudLivekitConnection&&this._cloudLivekitConnection.connectionState&&this._cloudLivekitConnection.connectionState.get()===Q.connected),this.onConnectedActions()}onConnectedActions(){this.sendVideoStatsUpdate(),this._videoStatsIntervalId=setInterval(()=>{this.sendVideoStatsUpdate()},1e3)}async sendVideoStatsUpdate(){var i,r,s,o,l,f,h,u,p,_,I,C,w,T,N,R;const e=await this._cloudLivekitConnection.getVideoStats().catch(v=>(K("LK: Error getting RTP video stats: ",v),{allStats:[String(v)]}));if(!e)return;this.sendMessage({body:{oneofKind:"livekitVideoStats",livekitVideoStats:{enabled:!!this._cloudLivekitConnection.camTrack&&((i=this._cloudLivekitConnection._roomConn)==null?void 0:i.localParticipant.videoTrackPublications.size)>0,allowBackupCodec:!!((r=this._cloudLivekitConnection._videoPublishOptions)!=null&&r.backupCodec),baseStream:{width:((o=(s=this._cloudLivekitConnection._videoCaptureOptions)==null?void 0:s.resolution)==null?void 0:o.width)??0,height:((f=(l=this._cloudLivekitConnection._videoCaptureOptions)==null?void 0:l.resolution)==null?void 0:f.height)??0,fps:((u=(h=this._cloudLivekitConnection._videoCaptureOptions)==null?void 0:h.resolution)==null?void 0:u.frameRate)??0,maxBitrate:((_=(p=this._cloudLivekitConnection._videoPublishOptions)==null?void 0:p.videoEncoding)==null?void 0:_.maxBitrate)??0},codec:((I=this._cloudLivekitConnection._videoPublishOptions)==null?void 0:I.videoCodec)||"unknown",simulcastLayers:((w=(C=this._cloudLivekitConnection._videoPublishOptions)==null?void 0:C.videoSimulcastLayers)==null?void 0:w.map(v=>{var L,F;return{width:v.width,height:v.height,maxBitrate:((L=v.encoding)==null?void 0:L.maxBitrate)??0,fps:((F=v.encoding)==null?void 0:F.maxFramerate)??0}}))||[],stats:{...e}}}},!1,[]);const t=this.simplePeerCameraOptions.get();for(const[v,L]of this._simplePeerConnections){if(!L||L.connectionState.get()!==Q.connected)continue;const F=await L.getStats().catch(z=>(K("SP: Error getting rtc video stats for user "+v+":",z),null));F&&this.sendMessage({body:{oneofKind:"simplePeerVideoStats",simplePeerVideoStats:{enabled:!!L,codec:"h264",baseStream:{width:Number((T=t.video)==null?void 0:T.width),height:Number((N=t.video)==null?void 0:N.height),fps:Number((R=t.video)==null?void 0:R.frameRate),maxBitrate:0},stats:{...F}}}},!1,[v])}}setLivekitVideoOptions(e,t,i){this._cloudLivekitConnection.enableCamera(e,t,i)}createSimplePeer(e,t){const i=this._simplePeerConnections.get(e);if(i)return K("SP: createSimplePeer() err - Connection already exists for user: "+e),i;const r=new xm;return this._simplePeerConnections.set(e,r),t&&r.ingestSignalingMsg(t),Ct(r.latestRecivedDataMessage,s=>{s&&cs(e,s)}),Ct(r.outgoingSignalingMessages,s=>{this.sendMessage({body:{oneofKind:"simplePeerSignal",simplePeerSignal:{message:s??""}}},!0,[e])}),r}setPreviewVideoElement(e){const t=document.getElementById("preview_video");t&&(t.srcObject=e)}async startSimplePeerConnection(e){this._simplePeerCameraStream||(this._simplePeerCameraStream=await gr(navigator.mediaDevices.getUserMedia,navigator.mediaDevices,10,1e3,1.3)(this.simplePeerCameraOptions.get())),this.setPreviewVideoElement(this._simplePeerCameraStream);const t=this._simplePeerConnections.get(e);if(!t)throw new Error("SimplePeer Connection not created for user: "+e);await t.start(Object.assign({},fr,{initiator:!1,streams:[this._simplePeerCameraStream]}),!1)}async setSimplePeerVideoOptions(e,t,i,r){var s;if(e){console.log("Setting SimplePeer Video Options for "+t+":",i,r),this.simplePeerCameraOptions.update(f=>{var u,p,_;const h=f!=null&&f.video?f.video:mr.video;return{...f,video:{...f.video,width:((u=i==null?void 0:i.resolution)==null?void 0:u.width)||h.width||1920,height:((p=i==null?void 0:i.resolution)==null?void 0:p.height)||h.height||1080,frameRate:((_=i==null?void 0:i.resolution)==null?void 0:_.frameRate)||h.frameRate||60}}});const o=await navigator.mediaDevices.getUserMedia(this.simplePeerCameraOptions.get());this._simplePeerCameraStream,this._simplePeerCameraStream=o,this.setPreviewVideoElement(this._simplePeerCameraStream);let l=this._simplePeerConnections.get(t);l?l.changeMediaStream(this._simplePeerCameraStream):(l=this.createSimplePeer(t),l.start(Object.assign({},fr,{initiator:!1,streams:[this._simplePeerCameraStream]}),!1))}else(s=this._simplePeerCameraStream)==null||s.getTracks().forEach(o=>o.stop()),this._simplePeerCameraStream=null}async ingestSimplePeerSignalMsg(e,t){const i=this._simplePeerConnections.get(e);i===void 0?(this.createSimplePeer(e,t),await this.startSimplePeerConnection(e)):i.ingestSignalingMsg(t)}async sendMessage(e,t,i){if(!e)return!1;if(this._cloudLivekitConnection.connectionState.get()!==Q.connected)return U.DEBUG_MODE&&Ee("LK: Message Not Sent, Livekit Not Connected"),!1;U.DEBUG_MODE&&Ee("LK/SP: "+(i.length==0?"Broadcasting msg ":"Sending msg to ["+i.join(", ")+"]")+(t?"reliably":"unreliably")+":",oe.toJson(e)),e.backendMetadata=oc.create({});const r=oe.toBinary(e);return await this._cloudLivekitConnection.sendMessage(r,t,i),!0}async stop(){clearInterval(this._videoStatsIntervalId),this._cloudLivekitConnection.close();for(const e of this._simplePeerConnections.values())e.stop()}}const te=new Mm,Dm="/system-information";async function Bm(){return X({method:"get",url:`${U.BLUEOS_APIS_ENDPOINT+Dm}/system`,timeout:1e4}).then(n=>n.data).catch(n=>{const e=`Could not fetch blueos system info: ${n.message}`;return K(e),e})}function Um(n){const e=[],t=n?n.map(i=>i.usage).reduce((i,r)=>i+r,0)/n.length:0;return t>90&&e.push(`Rov CPU is nearly maxed out: ${t}%`),{value:t,warnings:e}}function Km(n){const e=n==null?void 0:n.find(l=>l.mount_point==="/");function t(l){const f=l?l.available_space_B/1073741824:0,h=l?l.total_space_B/2**30:0;return[h-f,h]}const[i,r]=t(e),s=100*i/r,o=s>95?[`Disk/SD Card is almost full: ${Math.round(i*10)/10}/${Math.round(i*10)/10}GB Used`]:[];return{value:s,warnings:o}}function Vm(n){var f,h,u,p;const e=[],t=((f=n==null?void 0:n.ram)==null?void 0:f.used_kB)??0,i=((h=n==null?void 0:n.ram)==null?void 0:h.total_kB)??0,r=100*t/i,s=((u=n==null?void 0:n.swap)==null?void 0:u.used_kB)??0,o=((p=n==null?void 0:n.swap)==null?void 0:p.total_kB)??0,l=100*s/o;return r>90&&e.push(`RAM is almost full (${t} / ${i})`),l>90&&e.push(`Linux SWAP space is almost full (${s} / ${o})`),{value:r,warnings:e}}function qm(n){const e=n==null?void 0:n.find(r=>r.name==="CPU"),t=e?e.temperature:0,i=n?n.filter(r=>{const s=r.critical_temperature||1/0;return r.temperature>s}).map(r=>`Critical temperature reached in ${r.name}: ${r.temperature}C`):[];return{value:t,warnings:i}}Rn.defaultLogOrigin=ac.ROV;U.SEND_LOGS&&(Rn.sendLogsAllowed=!0);const Rs=document.getElementById("show_recent_logs_btn"),Is=document.getElementById("recent_logs");Rs&&Is&&Rs.addEventListener("click",()=>Rn.printRecentLogs(Is));Object.assign(window,{getLongTermStarterAccessToken:()=>{qh(U.LIVEKIT_API_KEY,U.LIVEKIT_SECRET_KEY).then(n=>{console.log(n),document.write(n)}).catch(n=>{console.error(n),document.write((n.message||"")+" "+n.toString())})},getLongTermTestRoomAccessToken:()=>{Hh(U.LIVEKIT_API_KEY,U.LIVEKIT_SECRET_KEY).then(n=>{console.log(n),document.write(n)}).catch(n=>{console.error(n),document.write((n.message||"")+" "+n.toString())})}});te.start({RovName:U.ROV_NAME,APIKey:U.LIVEKIT_API_KEY,SecretKey:U.LIVEKIT_SECRET_KEY,LivekitCloudURL:U.LIVEKIT_CLOUD_ENDPOINT,LivekitLocalURL:U.LIVEKIT_LOCAL_ENDPOINT}).then(()=>{document.getElementById("video_stats")});U.TWITCH_STREAM_KEY!=="None"&&Cn.init(U.TWITCH_STREAM_KEY,U.ROV_NAME,U.LIVEKIT_API_KEY,U.LIVEKIT_SECRET_KEY);U.PYTHON_WEBSOCKET_PORT!=0?yn.start("ws://localhost:"+U.PYTHON_WEBSOCKET_PORT,n=>{if(n.length===0)return;const e=oe.fromBinary(n);if(!e.backendMetadata)return ie("No BackendMetadata in message from iROV",oe.toJson(e));const t=e.backendMetadata.targetUserIds,r=e.backendMetadata.transportMethod===cc.LivekitReliable;te.sendMessage(e,r,t||[])}):B("No PYTHON_WEBSOCKET_PORT url parameter set, skipping python websocket!");if(U.BLUEOS_APIS_ENDPOINT){const n="("+pr.join(")|(")+")";Ae.start(Ns(U.BLUEOS_APIS_ENDPOINT)+":6040/ws/mavlink?filter="+n,e=>{if(!e.header||!e.message)return ie("Mavlink message missing header or message body",e);Jh(e);const t=As(JSON.stringify(e)),i=oe.create({body:{oneofKind:"mavlink",mavlink:{message:t}}});pr.includes(e.message.type)&&te.sendMessage(i,!0,[])},()=>{Ae.sendMessage(pc(0,8e6))}),setInterval(()=>{Bm().then(e=>{const t=qm(e.temperature),i=Um(e.cpu),r=Vm(e.memory),s=Km(e.disk),o=t.warnings.concat(i.warnings,r.warnings,s.warnings);U.DEBUG_MODE&&Ee("/SysInfo cpuTemp",t,"cpuUsage",i,"memUsage",r,"diskUsage",s,o);const l=oe.create({body:{oneofKind:"systemMonitor",systemMonitor:{cpuTemp:t.value,cpuUsage:i.value,memoryUsage:r.value,diskUsage:s.value,warnings:o}}});te.sendMessage(l,!0,[])})},5e3)}else B("No BLUEOS_APIS_ENDPOINT url parameter set, skipping mavlink & system info monitoring!");window.addEventListener("beforeunload",()=>{Cn.stopStream(),te.stop(),yn.close(),Ae.close()});
//# sourceMappingURL=internal-Bnrke1r7.js.map
