var Ce=Object.defineProperty;var Oe=(a,t,o)=>t in a?Ce(a,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[t]=o;var q=(a,t,o)=>(Oe(a,typeof t!="symbol"?t+"":t,o),o);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&e(c)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();var commonjsGlobal$1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs$1(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var dist={},buffer={},base64Js={};base64Js.byteLength=byteLength;base64Js.toByteArray=toByteArray;base64Js.fromByteArray=fromByteArray;var lookup=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function getLens(a){var t=a.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var o=a.indexOf("=");o===-1&&(o=t);var e=o===t?0:4-o%4;return[o,e]}function byteLength(a){var t=getLens(a),o=t[0],e=t[1];return(o+e)*3/4-e}function _byteLength(a,t,o){return(t+o)*3/4-o}function toByteArray(a){var t,o=getLens(a),e=o[0],n=o[1],s=new Arr(_byteLength(a,e,n)),c=0,l=n>0?e-4:e,u;for(u=0;u<l;u+=4)t=revLookup[a.charCodeAt(u)]<<18|revLookup[a.charCodeAt(u+1)]<<12|revLookup[a.charCodeAt(u+2)]<<6|revLookup[a.charCodeAt(u+3)],s[c++]=t>>16&255,s[c++]=t>>8&255,s[c++]=t&255;return n===2&&(t=revLookup[a.charCodeAt(u)]<<2|revLookup[a.charCodeAt(u+1)]>>4,s[c++]=t&255),n===1&&(t=revLookup[a.charCodeAt(u)]<<10|revLookup[a.charCodeAt(u+1)]<<4|revLookup[a.charCodeAt(u+2)]>>2,s[c++]=t>>8&255,s[c++]=t&255),s}function tripletToBase64(a){return lookup[a>>18&63]+lookup[a>>12&63]+lookup[a>>6&63]+lookup[a&63]}function encodeChunk(a,t,o){for(var e,n=[],s=t;s<o;s+=3)e=(a[s]<<16&16711680)+(a[s+1]<<8&65280)+(a[s+2]&255),n.push(tripletToBase64(e));return n.join("")}function fromByteArray(a){for(var t,o=a.length,e=o%3,n=[],s=16383,c=0,l=o-e;c<l;c+=s)n.push(encodeChunk(a,c,c+s>l?l:c+s));return e===1?(t=a[o-1],n.push(lookup[t>>2]+lookup[t<<4&63]+"==")):e===2&&(t=(a[o-2]<<8)+a[o-1],n.push(lookup[t>>10]+lookup[t>>4&63]+lookup[t<<2&63]+"=")),n.join("")}var ieee754={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ieee754.read=function(a,t,o,e,n){var s,c,l=n*8-e-1,u=(1<<l)-1,d=u>>1,p=-7,g=o?n-1:0,y=o?-1:1,T=a[t+g];for(g+=y,s=T&(1<<-p)-1,T>>=-p,p+=l;p>0;s=s*256+a[t+g],g+=y,p-=8);for(c=s&(1<<-p)-1,s>>=-p,p+=e;p>0;c=c*256+a[t+g],g+=y,p-=8);if(s===0)s=1-d;else{if(s===u)return c?NaN:(T?-1:1)*(1/0);c=c+Math.pow(2,e),s=s-d}return(T?-1:1)*c*Math.pow(2,s-e)};ieee754.write=function(a,t,o,e,n,s){var c,l,u,d=s*8-n-1,p=(1<<d)-1,g=p>>1,y=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,T=e?0:s-1,b=e?1:-1,k=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(l=isNaN(t)?1:0,c=p):(c=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-c))<1&&(c--,u*=2),c+g>=1?t+=y/u:t+=y*Math.pow(2,1-g),t*u>=2&&(c++,u/=2),c+g>=p?(l=0,c=p):c+g>=1?(l=(t*u-1)*Math.pow(2,n),c=c+g):(l=t*Math.pow(2,g-1)*Math.pow(2,n),c=0));n>=8;a[o+T]=l&255,T+=b,l/=256,n-=8);for(c=c<<n|l,d+=n;d>0;a[o+T]=c&255,T+=b,c/=256,d-=8);a[o+T-b]|=k*128};/*!
* The buffer module from node.js, for the browser.
*
* @author   Feross Aboukhadijeh <https://feross.org>
* @license  MIT
*/(function(a){const t=base64Js,o=ieee754,e=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;a.Buffer=l,a.SlowBuffer=N,a.INSPECT_MAX_BYTES=50;const n=2147483647;a.kMaxLength=n,l.TYPED_ARRAY_SUPPORT=s(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const m=new Uint8Array(1),f={foo:function(){return 42}};return Object.setPrototypeOf(f,Uint8Array.prototype),Object.setPrototypeOf(m,f),m.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function c(m){if(m>n)throw new RangeError('The value "'+m+'" is invalid for option "size"');const f=new Uint8Array(m);return Object.setPrototypeOf(f,l.prototype),f}function l(m,f,h){if(typeof m=="number"){if(typeof f=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return g(m)}return u(m,f,h)}l.poolSize=8192;function u(m,f,h){if(typeof m=="string")return y(m,f);if(ArrayBuffer.isView(m))return b(m);if(m==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof m);if(G(m,ArrayBuffer)||m&&G(m.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(G(m,SharedArrayBuffer)||m&&G(m.buffer,SharedArrayBuffer)))return k(m,f,h);if(typeof m=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const v=m.valueOf&&m.valueOf();if(v!=null&&v!==m)return l.from(v,f,h);const S=O(m);if(S)return S;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof m[Symbol.toPrimitive]=="function")return l.from(m[Symbol.toPrimitive]("string"),f,h);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof m)}l.from=function(m,f,h){return u(m,f,h)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array);function d(m){if(typeof m!="number")throw new TypeError('"size" argument must be of type number');if(m<0)throw new RangeError('The value "'+m+'" is invalid for option "size"')}function p(m,f,h){return d(m),m<=0?c(m):f!==void 0?typeof h=="string"?c(m).fill(f,h):c(m).fill(f):c(m)}l.alloc=function(m,f,h){return p(m,f,h)};function g(m){return d(m),c(m<0?0:C(m)|0)}l.allocUnsafe=function(m){return g(m)},l.allocUnsafeSlow=function(m){return g(m)};function y(m,f){if((typeof f!="string"||f==="")&&(f="utf8"),!l.isEncoding(f))throw new TypeError("Unknown encoding: "+f);const h=x(m,f)|0;let v=c(h);const S=v.write(m,f);return S!==h&&(v=v.slice(0,S)),v}function T(m){const f=m.length<0?0:C(m.length)|0,h=c(f);for(let v=0;v<f;v+=1)h[v]=m[v]&255;return h}function b(m){if(G(m,Uint8Array)){const f=new Uint8Array(m);return k(f.buffer,f.byteOffset,f.byteLength)}return T(m)}function k(m,f,h){if(f<0||m.byteLength<f)throw new RangeError('"offset" is outside of buffer bounds');if(m.byteLength<f+(h||0))throw new RangeError('"length" is outside of buffer bounds');let v;return f===void 0&&h===void 0?v=new Uint8Array(m):h===void 0?v=new Uint8Array(m,f):v=new Uint8Array(m,f,h),Object.setPrototypeOf(v,l.prototype),v}function O(m){if(l.isBuffer(m)){const f=C(m.length)|0,h=c(f);return h.length===0||m.copy(h,0,0,f),h}if(m.length!==void 0)return typeof m.length!="number"||oe(m.length)?c(0):T(m);if(m.type==="Buffer"&&Array.isArray(m.data))return T(m.data)}function C(m){if(m>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return m|0}function N(m){return+m!=m&&(m=0),l.alloc(+m)}l.isBuffer=function(f){return f!=null&&f._isBuffer===!0&&f!==l.prototype},l.compare=function(f,h){if(G(f,Uint8Array)&&(f=l.from(f,f.offset,f.byteLength)),G(h,Uint8Array)&&(h=l.from(h,h.offset,h.byteLength)),!l.isBuffer(f)||!l.isBuffer(h))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(f===h)return 0;let v=f.length,S=h.length;for(let _=0,E=Math.min(v,S);_<E;++_)if(f[_]!==h[_]){v=f[_],S=h[_];break}return v<S?-1:S<v?1:0},l.isEncoding=function(f){switch(String(f).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(f,h){if(!Array.isArray(f))throw new TypeError('"list" argument must be an Array of Buffers');if(f.length===0)return l.alloc(0);let v;if(h===void 0)for(h=0,v=0;v<f.length;++v)h+=f[v].length;const S=l.allocUnsafe(h);let _=0;for(v=0;v<f.length;++v){let E=f[v];if(G(E,Uint8Array))_+E.length>S.length?(l.isBuffer(E)||(E=l.from(E)),E.copy(S,_)):Uint8Array.prototype.set.call(S,E,_);else if(l.isBuffer(E))E.copy(S,_);else throw new TypeError('"list" argument must be an Array of Buffers');_+=E.length}return S};function x(m,f){if(l.isBuffer(m))return m.length;if(ArrayBuffer.isView(m)||G(m,ArrayBuffer))return m.byteLength;if(typeof m!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof m);const h=m.length,v=arguments.length>2&&arguments[2]===!0;if(!v&&h===0)return 0;let S=!1;for(;;)switch(f){case"ascii":case"latin1":case"binary":return h;case"utf8":case"utf-8":return ie(m).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h*2;case"hex":return h>>>1;case"base64":return fe(m).length;default:if(S)return v?-1:ie(m).length;f=(""+f).toLowerCase(),S=!0}}l.byteLength=x;function U(m,f,h){let v=!1;if((f===void 0||f<0)&&(f=0),f>this.length||((h===void 0||h>this.length)&&(h=this.length),h<=0)||(h>>>=0,f>>>=0,h<=f))return"";for(m||(m="utf8");;)switch(m){case"hex":return ge(this,f,h);case"utf8":case"utf-8":return z(this,f,h);case"ascii":return pe(this,f,h);case"latin1":case"binary":return me(this,f,h);case"base64":return Y(this,f,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ve(this,f,h);default:if(v)throw new TypeError("Unknown encoding: "+m);m=(m+"").toLowerCase(),v=!0}}l.prototype._isBuffer=!0;function P(m,f,h){const v=m[f];m[f]=m[h],m[h]=v}l.prototype.swap16=function(){const f=this.length;if(f%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let h=0;h<f;h+=2)P(this,h,h+1);return this},l.prototype.swap32=function(){const f=this.length;if(f%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let h=0;h<f;h+=4)P(this,h,h+3),P(this,h+1,h+2);return this},l.prototype.swap64=function(){const f=this.length;if(f%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let h=0;h<f;h+=8)P(this,h,h+7),P(this,h+1,h+6),P(this,h+2,h+5),P(this,h+3,h+4);return this},l.prototype.toString=function(){const f=this.length;return f===0?"":arguments.length===0?z(this,0,f):U.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(f){if(!l.isBuffer(f))throw new TypeError("Argument must be a Buffer");return this===f?!0:l.compare(this,f)===0},l.prototype.inspect=function(){let f="";const h=a.INSPECT_MAX_BYTES;return f=this.toString("hex",0,h).replace(/(.{2})/g,"$1 ").trim(),this.length>h&&(f+=" ... "),"<Buffer "+f+">"},e&&(l.prototype[e]=l.prototype.inspect),l.prototype.compare=function(f,h,v,S,_){if(G(f,Uint8Array)&&(f=l.from(f,f.offset,f.byteLength)),!l.isBuffer(f))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof f);if(h===void 0&&(h=0),v===void 0&&(v=f?f.length:0),S===void 0&&(S=0),_===void 0&&(_=this.length),h<0||v>f.length||S<0||_>this.length)throw new RangeError("out of range index");if(S>=_&&h>=v)return 0;if(S>=_)return-1;if(h>=v)return 1;if(h>>>=0,v>>>=0,S>>>=0,_>>>=0,this===f)return 0;let E=_-S,w=v-h;const L=Math.min(E,w),D=this.slice(S,_),M=f.slice(h,v);for(let A=0;A<L;++A)if(D[A]!==M[A]){E=D[A],w=M[A];break}return E<w?-1:w<E?1:0};function F(m,f,h,v,S){if(m.length===0)return-1;if(typeof h=="string"?(v=h,h=0):h>2147483647?h=2147483647:h<-2147483648&&(h=-2147483648),h=+h,oe(h)&&(h=S?0:m.length-1),h<0&&(h=m.length+h),h>=m.length){if(S)return-1;h=m.length-1}else if(h<0)if(S)h=0;else return-1;if(typeof f=="string"&&(f=l.from(f,v)),l.isBuffer(f))return f.length===0?-1:j(m,f,h,v,S);if(typeof f=="number")return f=f&255,typeof Uint8Array.prototype.indexOf=="function"?S?Uint8Array.prototype.indexOf.call(m,f,h):Uint8Array.prototype.lastIndexOf.call(m,f,h):j(m,[f],h,v,S);throw new TypeError("val must be string, number or Buffer")}function j(m,f,h,v,S){let _=1,E=m.length,w=f.length;if(v!==void 0&&(v=String(v).toLowerCase(),v==="ucs2"||v==="ucs-2"||v==="utf16le"||v==="utf-16le")){if(m.length<2||f.length<2)return-1;_=2,E/=2,w/=2,h/=2}function L(M,A){return _===1?M[A]:M.readUInt16BE(A*_)}let D;if(S){let M=-1;for(D=h;D<E;D++)if(L(m,D)===L(f,M===-1?0:D-M)){if(M===-1&&(M=D),D-M+1===w)return M*_}else M!==-1&&(D-=D-M),M=-1}else for(h+w>E&&(h=E-w),D=h;D>=0;D--){let M=!0;for(let A=0;A<w;A++)if(L(m,D+A)!==L(f,A)){M=!1;break}if(M)return D}return-1}l.prototype.includes=function(f,h,v){return this.indexOf(f,h,v)!==-1},l.prototype.indexOf=function(f,h,v){return F(this,f,h,v,!0)},l.prototype.lastIndexOf=function(f,h,v){return F(this,f,h,v,!1)};function J(m,f,h,v){h=Number(h)||0;const S=m.length-h;v?(v=Number(v),v>S&&(v=S)):v=S;const _=f.length;v>_/2&&(v=_/2);let E;for(E=0;E<v;++E){const w=parseInt(f.substr(E*2,2),16);if(oe(w))return E;m[h+E]=w}return E}function W(m,f,h,v){return te(ie(f,m.length-h),m,h,v)}function Z(m,f,h,v){return te(_e(f),m,h,v)}function I(m,f,h,v){return te(fe(f),m,h,v)}function B(m,f,h,v){return te(be(f,m.length-h),m,h,v)}l.prototype.write=function(f,h,v,S){if(h===void 0)S="utf8",v=this.length,h=0;else if(v===void 0&&typeof h=="string")S=h,v=this.length,h=0;else if(isFinite(h))h=h>>>0,isFinite(v)?(v=v>>>0,S===void 0&&(S="utf8")):(S=v,v=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const _=this.length-h;if((v===void 0||v>_)&&(v=_),f.length>0&&(v<0||h<0)||h>this.length)throw new RangeError("Attempt to write outside buffer bounds");S||(S="utf8");let E=!1;for(;;)switch(S){case"hex":return J(this,f,h,v);case"utf8":case"utf-8":return W(this,f,h,v);case"ascii":case"latin1":case"binary":return Z(this,f,h,v);case"base64":return I(this,f,h,v);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,f,h,v);default:if(E)throw new TypeError("Unknown encoding: "+S);S=(""+S).toLowerCase(),E=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Y(m,f,h){return f===0&&h===m.length?t.fromByteArray(m):t.fromByteArray(m.slice(f,h))}function z(m,f,h){h=Math.min(m.length,h);const v=[];let S=f;for(;S<h;){const _=m[S];let E=null,w=_>239?4:_>223?3:_>191?2:1;if(S+w<=h){let L,D,M,A;switch(w){case 1:_<128&&(E=_);break;case 2:L=m[S+1],(L&192)===128&&(A=(_&31)<<6|L&63,A>127&&(E=A));break;case 3:L=m[S+1],D=m[S+2],(L&192)===128&&(D&192)===128&&(A=(_&15)<<12|(L&63)<<6|D&63,A>2047&&(A<55296||A>57343)&&(E=A));break;case 4:L=m[S+1],D=m[S+2],M=m[S+3],(L&192)===128&&(D&192)===128&&(M&192)===128&&(A=(_&15)<<18|(L&63)<<12|(D&63)<<6|M&63,A>65535&&A<1114112&&(E=A))}}E===null?(E=65533,w=1):E>65535&&(E-=65536,v.push(E>>>10&1023|55296),E=56320|E&1023),v.push(E),S+=w}return he(v)}const ee=4096;function he(m){const f=m.length;if(f<=ee)return String.fromCharCode.apply(String,m);let h="",v=0;for(;v<f;)h+=String.fromCharCode.apply(String,m.slice(v,v+=ee));return h}function pe(m,f,h){let v="";h=Math.min(m.length,h);for(let S=f;S<h;++S)v+=String.fromCharCode(m[S]&127);return v}function me(m,f,h){let v="";h=Math.min(m.length,h);for(let S=f;S<h;++S)v+=String.fromCharCode(m[S]);return v}function ge(m,f,h){const v=m.length;(!f||f<0)&&(f=0),(!h||h<0||h>v)&&(h=v);let S="";for(let _=f;_<h;++_)S+=Ee[m[_]];return S}function ve(m,f,h){const v=m.slice(f,h);let S="";for(let _=0;_<v.length-1;_+=2)S+=String.fromCharCode(v[_]+v[_+1]*256);return S}l.prototype.slice=function(f,h){const v=this.length;f=~~f,h=h===void 0?v:~~h,f<0?(f+=v,f<0&&(f=0)):f>v&&(f=v),h<0?(h+=v,h<0&&(h=0)):h>v&&(h=v),h<f&&(h=f);const S=this.subarray(f,h);return Object.setPrototypeOf(S,l.prototype),S};function $(m,f,h){if(m%1!==0||m<0)throw new RangeError("offset is not uint");if(m+f>h)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(f,h,v){f=f>>>0,h=h>>>0,v||$(f,h,this.length);let S=this[f],_=1,E=0;for(;++E<h&&(_*=256);)S+=this[f+E]*_;return S},l.prototype.readUintBE=l.prototype.readUIntBE=function(f,h,v){f=f>>>0,h=h>>>0,v||$(f,h,this.length);let S=this[f+--h],_=1;for(;h>0&&(_*=256);)S+=this[f+--h]*_;return S},l.prototype.readUint8=l.prototype.readUInt8=function(f,h){return f=f>>>0,h||$(f,1,this.length),this[f]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(f,h){return f=f>>>0,h||$(f,2,this.length),this[f]|this[f+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(f,h){return f=f>>>0,h||$(f,2,this.length),this[f]<<8|this[f+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(f,h){return f=f>>>0,h||$(f,4,this.length),(this[f]|this[f+1]<<8|this[f+2]<<16)+this[f+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(f,h){return f=f>>>0,h||$(f,4,this.length),this[f]*16777216+(this[f+1]<<16|this[f+2]<<8|this[f+3])},l.prototype.readBigUInt64LE=H(function(f){f=f>>>0,K(f,"offset");const h=this[f],v=this[f+7];(h===void 0||v===void 0)&&X(f,this.length-8);const S=h+this[++f]*2**8+this[++f]*2**16+this[++f]*2**24,_=this[++f]+this[++f]*2**8+this[++f]*2**16+v*2**24;return BigInt(S)+(BigInt(_)<<BigInt(32))}),l.prototype.readBigUInt64BE=H(function(f){f=f>>>0,K(f,"offset");const h=this[f],v=this[f+7];(h===void 0||v===void 0)&&X(f,this.length-8);const S=h*2**24+this[++f]*2**16+this[++f]*2**8+this[++f],_=this[++f]*2**24+this[++f]*2**16+this[++f]*2**8+v;return(BigInt(S)<<BigInt(32))+BigInt(_)}),l.prototype.readIntLE=function(f,h,v){f=f>>>0,h=h>>>0,v||$(f,h,this.length);let S=this[f],_=1,E=0;for(;++E<h&&(_*=256);)S+=this[f+E]*_;return _*=128,S>=_&&(S-=Math.pow(2,8*h)),S},l.prototype.readIntBE=function(f,h,v){f=f>>>0,h=h>>>0,v||$(f,h,this.length);let S=h,_=1,E=this[f+--S];for(;S>0&&(_*=256);)E+=this[f+--S]*_;return _*=128,E>=_&&(E-=Math.pow(2,8*h)),E},l.prototype.readInt8=function(f,h){return f=f>>>0,h||$(f,1,this.length),this[f]&128?(255-this[f]+1)*-1:this[f]},l.prototype.readInt16LE=function(f,h){f=f>>>0,h||$(f,2,this.length);const v=this[f]|this[f+1]<<8;return v&32768?v|4294901760:v},l.prototype.readInt16BE=function(f,h){f=f>>>0,h||$(f,2,this.length);const v=this[f+1]|this[f]<<8;return v&32768?v|4294901760:v},l.prototype.readInt32LE=function(f,h){return f=f>>>0,h||$(f,4,this.length),this[f]|this[f+1]<<8|this[f+2]<<16|this[f+3]<<24},l.prototype.readInt32BE=function(f,h){return f=f>>>0,h||$(f,4,this.length),this[f]<<24|this[f+1]<<16|this[f+2]<<8|this[f+3]},l.prototype.readBigInt64LE=H(function(f){f=f>>>0,K(f,"offset");const h=this[f],v=this[f+7];(h===void 0||v===void 0)&&X(f,this.length-8);const S=this[f+4]+this[f+5]*2**8+this[f+6]*2**16+(v<<24);return(BigInt(S)<<BigInt(32))+BigInt(h+this[++f]*2**8+this[++f]*2**16+this[++f]*2**24)}),l.prototype.readBigInt64BE=H(function(f){f=f>>>0,K(f,"offset");const h=this[f],v=this[f+7];(h===void 0||v===void 0)&&X(f,this.length-8);const S=(h<<24)+this[++f]*2**16+this[++f]*2**8+this[++f];return(BigInt(S)<<BigInt(32))+BigInt(this[++f]*2**24+this[++f]*2**16+this[++f]*2**8+v)}),l.prototype.readFloatLE=function(f,h){return f=f>>>0,h||$(f,4,this.length),o.read(this,f,!0,23,4)},l.prototype.readFloatBE=function(f,h){return f=f>>>0,h||$(f,4,this.length),o.read(this,f,!1,23,4)},l.prototype.readDoubleLE=function(f,h){return f=f>>>0,h||$(f,8,this.length),o.read(this,f,!0,52,8)},l.prototype.readDoubleBE=function(f,h){return f=f>>>0,h||$(f,8,this.length),o.read(this,f,!1,52,8)};function V(m,f,h,v,S,_){if(!l.isBuffer(m))throw new TypeError('"buffer" argument must be a Buffer instance');if(f>S||f<_)throw new RangeError('"value" argument is out of bounds');if(h+v>m.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(f,h,v,S){if(f=+f,h=h>>>0,v=v>>>0,!S){const w=Math.pow(2,8*v)-1;V(this,f,h,v,w,0)}let _=1,E=0;for(this[h]=f&255;++E<v&&(_*=256);)this[h+E]=f/_&255;return h+v},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(f,h,v,S){if(f=+f,h=h>>>0,v=v>>>0,!S){const w=Math.pow(2,8*v)-1;V(this,f,h,v,w,0)}let _=v-1,E=1;for(this[h+_]=f&255;--_>=0&&(E*=256);)this[h+_]=f/E&255;return h+v},l.prototype.writeUint8=l.prototype.writeUInt8=function(f,h,v){return f=+f,h=h>>>0,v||V(this,f,h,1,255,0),this[h]=f&255,h+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(f,h,v){return f=+f,h=h>>>0,v||V(this,f,h,2,65535,0),this[h]=f&255,this[h+1]=f>>>8,h+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(f,h,v){return f=+f,h=h>>>0,v||V(this,f,h,2,65535,0),this[h]=f>>>8,this[h+1]=f&255,h+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(f,h,v){return f=+f,h=h>>>0,v||V(this,f,h,4,4294967295,0),this[h+3]=f>>>24,this[h+2]=f>>>16,this[h+1]=f>>>8,this[h]=f&255,h+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(f,h,v){return f=+f,h=h>>>0,v||V(this,f,h,4,4294967295,0),this[h]=f>>>24,this[h+1]=f>>>16,this[h+2]=f>>>8,this[h+3]=f&255,h+4};function re(m,f,h,v,S){de(f,v,S,m,h,7);let _=Number(f&BigInt(4294967295));m[h++]=_,_=_>>8,m[h++]=_,_=_>>8,m[h++]=_,_=_>>8,m[h++]=_;let E=Number(f>>BigInt(32)&BigInt(4294967295));return m[h++]=E,E=E>>8,m[h++]=E,E=E>>8,m[h++]=E,E=E>>8,m[h++]=E,h}function ae(m,f,h,v,S){de(f,v,S,m,h,7);let _=Number(f&BigInt(4294967295));m[h+7]=_,_=_>>8,m[h+6]=_,_=_>>8,m[h+5]=_,_=_>>8,m[h+4]=_;let E=Number(f>>BigInt(32)&BigInt(4294967295));return m[h+3]=E,E=E>>8,m[h+2]=E,E=E>>8,m[h+1]=E,E=E>>8,m[h]=E,h+8}l.prototype.writeBigUInt64LE=H(function(f,h=0){return re(this,f,h,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=H(function(f,h=0){return ae(this,f,h,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(f,h,v,S){if(f=+f,h=h>>>0,!S){const L=Math.pow(2,8*v-1);V(this,f,h,v,L-1,-L)}let _=0,E=1,w=0;for(this[h]=f&255;++_<v&&(E*=256);)f<0&&w===0&&this[h+_-1]!==0&&(w=1),this[h+_]=(f/E>>0)-w&255;return h+v},l.prototype.writeIntBE=function(f,h,v,S){if(f=+f,h=h>>>0,!S){const L=Math.pow(2,8*v-1);V(this,f,h,v,L-1,-L)}let _=v-1,E=1,w=0;for(this[h+_]=f&255;--_>=0&&(E*=256);)f<0&&w===0&&this[h+_+1]!==0&&(w=1),this[h+_]=(f/E>>0)-w&255;return h+v},l.prototype.writeInt8=function(f,h,v){return f=+f,h=h>>>0,v||V(this,f,h,1,127,-128),f<0&&(f=255+f+1),this[h]=f&255,h+1},l.prototype.writeInt16LE=function(f,h,v){return f=+f,h=h>>>0,v||V(this,f,h,2,32767,-32768),this[h]=f&255,this[h+1]=f>>>8,h+2},l.prototype.writeInt16BE=function(f,h,v){return f=+f,h=h>>>0,v||V(this,f,h,2,32767,-32768),this[h]=f>>>8,this[h+1]=f&255,h+2},l.prototype.writeInt32LE=function(f,h,v){return f=+f,h=h>>>0,v||V(this,f,h,4,2147483647,-2147483648),this[h]=f&255,this[h+1]=f>>>8,this[h+2]=f>>>16,this[h+3]=f>>>24,h+4},l.prototype.writeInt32BE=function(f,h,v){return f=+f,h=h>>>0,v||V(this,f,h,4,2147483647,-2147483648),f<0&&(f=4294967295+f+1),this[h]=f>>>24,this[h+1]=f>>>16,this[h+2]=f>>>8,this[h+3]=f&255,h+4},l.prototype.writeBigInt64LE=H(function(f,h=0){return re(this,f,h,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=H(function(f,h=0){return ae(this,f,h,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function se(m,f,h,v,S,_){if(h+v>m.length)throw new RangeError("Index out of range");if(h<0)throw new RangeError("Index out of range")}function ce(m,f,h,v,S){return f=+f,h=h>>>0,S||se(m,f,h,4),o.write(m,f,h,v,23,4),h+4}l.prototype.writeFloatLE=function(f,h,v){return ce(this,f,h,!0,v)},l.prototype.writeFloatBE=function(f,h,v){return ce(this,f,h,!1,v)};function le(m,f,h,v,S){return f=+f,h=h>>>0,S||se(m,f,h,8),o.write(m,f,h,v,52,8),h+8}l.prototype.writeDoubleLE=function(f,h,v){return le(this,f,h,!0,v)},l.prototype.writeDoubleBE=function(f,h,v){return le(this,f,h,!1,v)},l.prototype.copy=function(f,h,v,S){if(!l.isBuffer(f))throw new TypeError("argument should be a Buffer");if(v||(v=0),!S&&S!==0&&(S=this.length),h>=f.length&&(h=f.length),h||(h=0),S>0&&S<v&&(S=v),S===v||f.length===0||this.length===0)return 0;if(h<0)throw new RangeError("targetStart out of bounds");if(v<0||v>=this.length)throw new RangeError("Index out of range");if(S<0)throw new RangeError("sourceEnd out of bounds");S>this.length&&(S=this.length),f.length-h<S-v&&(S=f.length-h+v);const _=S-v;return this===f&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(h,v,S):Uint8Array.prototype.set.call(f,this.subarray(v,S),h),_},l.prototype.fill=function(f,h,v,S){if(typeof f=="string"){if(typeof h=="string"?(S=h,h=0,v=this.length):typeof v=="string"&&(S=v,v=this.length),S!==void 0&&typeof S!="string")throw new TypeError("encoding must be a string");if(typeof S=="string"&&!l.isEncoding(S))throw new TypeError("Unknown encoding: "+S);if(f.length===1){const E=f.charCodeAt(0);(S==="utf8"&&E<128||S==="latin1")&&(f=E)}}else typeof f=="number"?f=f&255:typeof f=="boolean"&&(f=Number(f));if(h<0||this.length<h||this.length<v)throw new RangeError("Out of range index");if(v<=h)return this;h=h>>>0,v=v===void 0?this.length:v>>>0,f||(f=0);let _;if(typeof f=="number")for(_=h;_<v;++_)this[_]=f;else{const E=l.isBuffer(f)?f:l.from(f,S),w=E.length;if(w===0)throw new TypeError('The value "'+f+'" is invalid for argument "value"');for(_=0;_<v-h;++_)this[_+h]=E[_%w]}return this};const Q={};function ne(m,f,h){Q[m]=class extends h{constructor(){super(),Object.defineProperty(this,"message",{value:f.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${m}]`,this.stack,delete this.name}get code(){return m}set code(S){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:S,writable:!0})}toString(){return`${this.name} [${m}]: ${this.message}`}}}ne("ERR_BUFFER_OUT_OF_BOUNDS",function(m){return m?`${m} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ne("ERR_INVALID_ARG_TYPE",function(m,f){return`The "${m}" argument must be of type number. Received type ${typeof f}`},TypeError),ne("ERR_OUT_OF_RANGE",function(m,f,h){let v=`The value of "${m}" is out of range.`,S=h;return Number.isInteger(h)&&Math.abs(h)>2**32?S=ue(String(h)):typeof h=="bigint"&&(S=String(h),(h>BigInt(2)**BigInt(32)||h<-(BigInt(2)**BigInt(32)))&&(S=ue(S)),S+="n"),v+=` It must be ${f}. Received ${S}`,v},RangeError);function ue(m){let f="",h=m.length;const v=m[0]==="-"?1:0;for(;h>=v+4;h-=3)f=`_${m.slice(h-3,h)}${f}`;return`${m.slice(0,h)}${f}`}function ye(m,f,h){K(f,"offset"),(m[f]===void 0||m[f+h]===void 0)&&X(f,m.length-(h+1))}function de(m,f,h,v,S,_){if(m>h||m<f){const E=typeof f=="bigint"?"n":"";let w;throw _>3?f===0||f===BigInt(0)?w=`>= 0${E} and < 2${E} ** ${(_+1)*8}${E}`:w=`>= -(2${E} ** ${(_+1)*8-1}${E}) and < 2 ** ${(_+1)*8-1}${E}`:w=`>= ${f}${E} and <= ${h}${E}`,new Q.ERR_OUT_OF_RANGE("value",w,m)}ye(v,S,_)}function K(m,f){if(typeof m!="number")throw new Q.ERR_INVALID_ARG_TYPE(f,"number",m)}function X(m,f,h){throw Math.floor(m)!==m?(K(m,h),new Q.ERR_OUT_OF_RANGE(h||"offset","an integer",m)):f<0?new Q.ERR_BUFFER_OUT_OF_BOUNDS:new Q.ERR_OUT_OF_RANGE(h||"offset",`>= ${h?1:0} and <= ${f}`,m)}const Se=/[^+/0-9A-Za-z-_]/g;function Te(m){if(m=m.split("=")[0],m=m.trim().replace(Se,""),m.length<2)return"";for(;m.length%4!==0;)m=m+"=";return m}function ie(m,f){f=f||1/0;let h;const v=m.length;let S=null;const _=[];for(let E=0;E<v;++E){if(h=m.charCodeAt(E),h>55295&&h<57344){if(!S){if(h>56319){(f-=3)>-1&&_.push(239,191,189);continue}else if(E+1===v){(f-=3)>-1&&_.push(239,191,189);continue}S=h;continue}if(h<56320){(f-=3)>-1&&_.push(239,191,189),S=h;continue}h=(S-55296<<10|h-56320)+65536}else S&&(f-=3)>-1&&_.push(239,191,189);if(S=null,h<128){if((f-=1)<0)break;_.push(h)}else if(h<2048){if((f-=2)<0)break;_.push(h>>6|192,h&63|128)}else if(h<65536){if((f-=3)<0)break;_.push(h>>12|224,h>>6&63|128,h&63|128)}else if(h<1114112){if((f-=4)<0)break;_.push(h>>18|240,h>>12&63|128,h>>6&63|128,h&63|128)}else throw new Error("Invalid code point")}return _}function _e(m){const f=[];for(let h=0;h<m.length;++h)f.push(m.charCodeAt(h)&255);return f}function be(m,f){let h,v,S;const _=[];for(let E=0;E<m.length&&!((f-=2)<0);++E)h=m.charCodeAt(E),v=h>>8,S=h%256,_.push(S),_.push(v);return _}function fe(m){return t.toByteArray(Te(m))}function te(m,f,h,v){let S;for(S=0;S<v&&!(S+h>=f.length||S>=m.length);++S)f[S+h]=m[S];return S}function G(m,f){return m instanceof f||m!=null&&m.constructor!=null&&m.constructor.name!=null&&m.constructor.name===f.name}function oe(m){return m!==m}const Ee=function(){const m="0123456789abcdef",f=new Array(256);for(let h=0;h<16;++h){const v=h*16;for(let S=0;S<16;++S)f[v+S]=m[h]+m[S]}return f}();function H(m){return typeof BigInt>"u"?ke:m}function ke(){throw new Error("BigInt not supported")}})(buffer);var browser={exports:{}},process=browser.exports={},cachedSetTimeout,cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?cachedSetTimeout=setTimeout:cachedSetTimeout=defaultSetTimout}catch{cachedSetTimeout=defaultSetTimout}try{typeof clearTimeout=="function"?cachedClearTimeout=clearTimeout:cachedClearTimeout=defaultClearTimeout}catch{cachedClearTimeout=defaultClearTimeout}})();function runTimeout(a){if(cachedSetTimeout===setTimeout)return setTimeout(a,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(a,0);try{return cachedSetTimeout(a,0)}catch{try{return cachedSetTimeout.call(null,a,0)}catch{return cachedSetTimeout.call(this,a,0)}}}function runClearTimeout(a){if(cachedClearTimeout===clearTimeout)return clearTimeout(a);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(a);try{return cachedClearTimeout(a)}catch{try{return cachedClearTimeout.call(null,a)}catch{return cachedClearTimeout.call(this,a)}}}var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){!draining||!currentQueue||(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var a=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(a)}}process.nextTick=function(a){var t=new Array(arguments.length-1);if(arguments.length>1)for(var o=1;o<arguments.length;o++)t[o-1]=arguments[o];queue.push(new Item(a,t)),queue.length===1&&!draining&&runTimeout(drainQueue)};function Item(a,t){this.fun=a,this.array=t}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=!0;process.env={};process.argv=[];process.version="";process.versions={};function noop$1(){}process.on=noop$1;process.addListener=noop$1;process.once=noop$1;process.off=noop$1;process.removeListener=noop$1;process.removeAllListeners=noop$1;process.emit=noop$1;process.prependListener=noop$1;process.prependOnceListener=noop$1;process.listeners=function(a){return[]};process.binding=function(a){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(a){throw new Error("process.chdir is not supported")};process.umask=function(){return 0};var browserExports=browser.exports;(function(a){Object.defineProperty(a,Symbol.toStringTag,{value:"Module"});const t=buffer,o=browserExports,e=c=>c&&c.__esModule?c:{default:c},n=e(o),s=globalThis||void 0||self;Object.defineProperty(a,"Buffer",{enumerable:!0,get:()=>t.Buffer}),Object.defineProperty(a,"process",{enumerable:!0,get:()=>n.default}),a.global=s})(dist);function _mergeNamespaces(a,t){return t.forEach(function(o){o&&typeof o!="string"&&!Array.isArray(o)&&Object.keys(o).forEach(function(e){if(e!=="default"&&!(e in a)){var n=Object.getOwnPropertyDescriptor(o,e);Object.defineProperty(a,e,n.get?n:{enumerable:!0,get:function(){return o[e]}})}})}),Object.freeze(a)}function assert(a,t){if(!a)throw new Error(t)}const FLOAT32_MAX=34028234663852886e22,FLOAT32_MIN=-34028234663852886e22,UINT32_MAX=4294967295,INT32_MAX=2147483647,INT32_MIN=-2147483648;function assertInt32(a){if(typeof a!="number")throw new Error("invalid int 32: "+typeof a);if(!Number.isInteger(a)||a>INT32_MAX||a<INT32_MIN)throw new Error("invalid int 32: "+a)}function assertUInt32(a){if(typeof a!="number")throw new Error("invalid uint 32: "+typeof a);if(!Number.isInteger(a)||a>UINT32_MAX||a<0)throw new Error("invalid uint 32: "+a)}function assertFloat32(a){if(typeof a!="number")throw new Error("invalid float 32: "+typeof a);if(Number.isFinite(a)&&(a>FLOAT32_MAX||a<FLOAT32_MIN))throw new Error("invalid float 32: "+a)}const enumTypeSymbol=Symbol("@bufbuild/protobuf/enum-type");function getEnumType(a){const t=a[enumTypeSymbol];return assert(t,"missing enum type on enum object"),t}function setEnumType(a,t,o,e){a[enumTypeSymbol]=makeEnumType(t,o.map(n=>({no:n.no,name:n.name,localName:a[n.no]})))}function makeEnumType(a,t,o){const e=Object.create(null),n=Object.create(null),s=[];for(const c of t){const l=normalizeEnumValue(c);s.push(l),e[c.name]=l,n[c.no]=l}return{typeName:a,values:s,findName(c){return e[c]},findNumber(c){return n[c]}}}function makeEnum(a,t,o){const e={};for(const n of t){const s=normalizeEnumValue(n);e[s.localName]=s.no,e[s.no]=s.localName}return setEnumType(e,a,t),e}function normalizeEnumValue(a){return"localName"in a?a:Object.assign(Object.assign({},a),{localName:a.name})}class Message{equals(t){return this.getType().runtime.util.equals(this.getType(),this,t)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(t,o){const e=this.getType(),n=e.runtime.bin,s=n.makeReadOptions(o);return n.readMessage(this,s.readerFactory(t),t.byteLength,s),this}fromJson(t,o){const e=this.getType(),n=e.runtime.json,s=n.makeReadOptions(o);return n.readMessage(e,t,s,this),this}fromJsonString(t,o){let e;try{e=JSON.parse(t)}catch(n){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(n instanceof Error?n.message:String(n)))}return this.fromJson(e,o)}toBinary(t){const o=this.getType(),e=o.runtime.bin,n=e.makeWriteOptions(t),s=n.writerFactory();return e.writeMessage(this,s,n),s.finish()}toJson(t){const o=this.getType(),e=o.runtime.json,n=e.makeWriteOptions(t);return e.writeMessage(this,n)}toJsonString(t){var o;const e=this.toJson(t);return JSON.stringify(e,null,(o=t==null?void 0:t.prettySpaces)!==null&&o!==void 0?o:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function makeMessageType(a,t,o,e){var n;const s=(n=e==null?void 0:e.localName)!==null&&n!==void 0?n:t.substring(t.lastIndexOf(".")+1),c={[s]:function(l){a.util.initFields(this),a.util.initPartial(l,this)}}[s];return Object.setPrototypeOf(c.prototype,new Message),Object.assign(c,{runtime:a,typeName:t,fields:a.util.newFieldList(o),fromBinary(l,u){return new c().fromBinary(l,u)},fromJson(l,u){return new c().fromJson(l,u)},fromJsonString(l,u){return new c().fromJsonString(l,u)},equals(l,u){return a.util.equals(c,l,u)}}),c}function varint64read(){let a=0,t=0;for(let e=0;e<28;e+=7){let n=this.buf[this.pos++];if(a|=(n&127)<<e,!(n&128))return this.assertBounds(),[a,t]}let o=this.buf[this.pos++];if(a|=(o&15)<<28,t=(o&112)>>4,!(o&128))return this.assertBounds(),[a,t];for(let e=3;e<=31;e+=7){let n=this.buf[this.pos++];if(t|=(n&127)<<e,!(n&128))return this.assertBounds(),[a,t]}throw new Error("invalid varint")}function varint64write(a,t,o){for(let s=0;s<28;s=s+7){const c=a>>>s,l=!(!(c>>>7)&&t==0),u=(l?c|128:c)&255;if(o.push(u),!l)return}const e=a>>>28&15|(t&7)<<4,n=!!(t>>3);if(o.push((n?e|128:e)&255),!!n){for(let s=3;s<31;s=s+7){const c=t>>>s,l=!!(c>>>7),u=(l?c|128:c)&255;if(o.push(u),!l)return}o.push(t>>>31&1)}}const TWO_PWR_32_DBL=4294967296;function int64FromString(a){const t=a[0]==="-";t&&(a=a.slice(1));const o=1e6;let e=0,n=0;function s(c,l){const u=Number(a.slice(c,l));n*=o,e=e*o+u,e>=TWO_PWR_32_DBL&&(n=n+(e/TWO_PWR_32_DBL|0),e=e%TWO_PWR_32_DBL)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),t?negate(e,n):newBits(e,n)}function int64ToString(a,t){let o=newBits(a,t);const e=o.hi&2147483648;e&&(o=negate(o.lo,o.hi));const n=uInt64ToString(o.lo,o.hi);return e?"-"+n:n}function uInt64ToString(a,t){if({lo:a,hi:t}=toUnsigned(a,t),t<=2097151)return String(TWO_PWR_32_DBL*t+a);const o=a&16777215,e=(a>>>24|t<<8)&16777215,n=t>>16&65535;let s=o+e*6777216+n*6710656,c=e+n*8147497,l=n*2;const u=1e7;return s>=u&&(c+=Math.floor(s/u),s%=u),c>=u&&(l+=Math.floor(c/u),c%=u),l.toString()+decimalFrom1e7WithLeadingZeros(c)+decimalFrom1e7WithLeadingZeros(s)}function toUnsigned(a,t){return{lo:a>>>0,hi:t>>>0}}function newBits(a,t){return{lo:a|0,hi:t|0}}function negate(a,t){return t=~t,a?a=~a+1:t+=1,newBits(a,t)}const decimalFrom1e7WithLeadingZeros=a=>{const t=String(a);return"0000000".slice(t.length)+t};function varint32write(a,t){if(a>=0){for(;a>127;)t.push(a&127|128),a=a>>>7;t.push(a)}else{for(let o=0;o<9;o++)t.push(a&127|128),a=a>>7;t.push(1)}}function varint32read(){let a=this.buf[this.pos++],t=a&127;if(!(a&128))return this.assertBounds(),t;if(a=this.buf[this.pos++],t|=(a&127)<<7,!(a&128))return this.assertBounds(),t;if(a=this.buf[this.pos++],t|=(a&127)<<14,!(a&128))return this.assertBounds(),t;if(a=this.buf[this.pos++],t|=(a&127)<<21,!(a&128))return this.assertBounds(),t;a=this.buf[this.pos++],t|=(a&15)<<28;for(let o=5;a&128&&o<10;o++)a=this.buf[this.pos++];if(a&128)throw new Error("invalid varint");return this.assertBounds(),t>>>0}function makeInt64Support(){const a=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof a.getBigInt64=="function"&&typeof a.getBigUint64=="function"&&typeof a.setBigInt64=="function"&&typeof a.setBigUint64=="function"&&(typeof dist.process!="object"||typeof dist.process.env!="object"||{}.BUF_BIGINT_DISABLE!=="1")){const n=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),c=BigInt("0"),l=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(u){const d=typeof u=="bigint"?u:BigInt(u);if(d>s||d<n)throw new Error("int64 invalid: ".concat(u));return d},uParse(u){const d=typeof u=="bigint"?u:BigInt(u);if(d>l||d<c)throw new Error("uint64 invalid: ".concat(u));return d},enc(u){return a.setBigInt64(0,this.parse(u),!0),{lo:a.getInt32(0,!0),hi:a.getInt32(4,!0)}},uEnc(u){return a.setBigInt64(0,this.uParse(u),!0),{lo:a.getInt32(0,!0),hi:a.getInt32(4,!0)}},dec(u,d){return a.setInt32(0,u,!0),a.setInt32(4,d,!0),a.getBigInt64(0,!0)},uDec(u,d){return a.setInt32(0,u,!0),a.setInt32(4,d,!0),a.getBigUint64(0,!0)}}}const o=n=>assert(/^-?[0-9]+$/.test(n),"int64 invalid: ".concat(n)),e=n=>assert(/^[0-9]+$/.test(n),"uint64 invalid: ".concat(n));return{zero:"0",supported:!1,parse(n){return typeof n!="string"&&(n=n.toString()),o(n),n},uParse(n){return typeof n!="string"&&(n=n.toString()),e(n),n},enc(n){return typeof n!="string"&&(n=n.toString()),o(n),int64FromString(n)},uEnc(n){return typeof n!="string"&&(n=n.toString()),e(n),int64FromString(n)},dec(n,s){return int64ToString(n,s)},uDec(n,s){return uInt64ToString(n,s)}}}const protoInt64=makeInt64Support();var ScalarType;(function(a){a[a.DOUBLE=1]="DOUBLE",a[a.FLOAT=2]="FLOAT",a[a.INT64=3]="INT64",a[a.UINT64=4]="UINT64",a[a.INT32=5]="INT32",a[a.FIXED64=6]="FIXED64",a[a.FIXED32=7]="FIXED32",a[a.BOOL=8]="BOOL",a[a.STRING=9]="STRING",a[a.BYTES=12]="BYTES",a[a.UINT32=13]="UINT32",a[a.SFIXED32=15]="SFIXED32",a[a.SFIXED64=16]="SFIXED64",a[a.SINT32=17]="SINT32",a[a.SINT64=18]="SINT64"})(ScalarType||(ScalarType={}));var LongType;(function(a){a[a.BIGINT=0]="BIGINT",a[a.STRING=1]="STRING"})(LongType||(LongType={}));function scalarEquals(a,t,o){if(t===o)return!0;if(a==ScalarType.BYTES){if(!(t instanceof Uint8Array)||!(o instanceof Uint8Array)||t.length!==o.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==o[e])return!1;return!0}switch(a){case ScalarType.UINT64:case ScalarType.FIXED64:case ScalarType.INT64:case ScalarType.SFIXED64:case ScalarType.SINT64:return t==o}return!1}function scalarZeroValue(a,t){switch(a){case ScalarType.BOOL:return!1;case ScalarType.UINT64:case ScalarType.FIXED64:case ScalarType.INT64:case ScalarType.SFIXED64:case ScalarType.SINT64:return t==0?protoInt64.zero:"0";case ScalarType.DOUBLE:case ScalarType.FLOAT:return 0;case ScalarType.BYTES:return new Uint8Array(0);case ScalarType.STRING:return"";default:return 0}}function isScalarZeroValue(a,t){switch(a){case ScalarType.BOOL:return t===!1;case ScalarType.STRING:return t==="";case ScalarType.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return t==0}}var WireType;(function(a){a[a.Varint=0]="Varint",a[a.Bit64=1]="Bit64",a[a.LengthDelimited=2]="LengthDelimited",a[a.StartGroup=3]="StartGroup",a[a.EndGroup=4]="EndGroup",a[a.Bit32=5]="Bit32"})(WireType||(WireType={}));class BinaryWriter{constructor(t){this.stack=[],this.textEncoder=t??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let t=0;for(let n=0;n<this.chunks.length;n++)t+=this.chunks[n].length;let o=new Uint8Array(t),e=0;for(let n=0;n<this.chunks.length;n++)o.set(this.chunks[n],e),e+=this.chunks[n].length;return this.chunks=[],o}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let t=this.finish(),o=this.stack.pop();if(!o)throw new Error("invalid state, fork stack empty");return this.chunks=o.chunks,this.buf=o.buf,this.uint32(t.byteLength),this.raw(t)}tag(t,o){return this.uint32((t<<3|o)>>>0)}raw(t){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(t),this}uint32(t){for(assertUInt32(t);t>127;)this.buf.push(t&127|128),t=t>>>7;return this.buf.push(t),this}int32(t){return assertInt32(t),varint32write(t,this.buf),this}bool(t){return this.buf.push(t?1:0),this}bytes(t){return this.uint32(t.byteLength),this.raw(t)}string(t){let o=this.textEncoder.encode(t);return this.uint32(o.byteLength),this.raw(o)}float(t){assertFloat32(t);let o=new Uint8Array(4);return new DataView(o.buffer).setFloat32(0,t,!0),this.raw(o)}double(t){let o=new Uint8Array(8);return new DataView(o.buffer).setFloat64(0,t,!0),this.raw(o)}fixed32(t){assertUInt32(t);let o=new Uint8Array(4);return new DataView(o.buffer).setUint32(0,t,!0),this.raw(o)}sfixed32(t){assertInt32(t);let o=new Uint8Array(4);return new DataView(o.buffer).setInt32(0,t,!0),this.raw(o)}sint32(t){return assertInt32(t),t=(t<<1^t>>31)>>>0,varint32write(t,this.buf),this}sfixed64(t){let o=new Uint8Array(8),e=new DataView(o.buffer),n=protoInt64.enc(t);return e.setInt32(0,n.lo,!0),e.setInt32(4,n.hi,!0),this.raw(o)}fixed64(t){let o=new Uint8Array(8),e=new DataView(o.buffer),n=protoInt64.uEnc(t);return e.setInt32(0,n.lo,!0),e.setInt32(4,n.hi,!0),this.raw(o)}int64(t){let o=protoInt64.enc(t);return varint64write(o.lo,o.hi,this.buf),this}sint64(t){let o=protoInt64.enc(t),e=o.hi>>31,n=o.lo<<1^e,s=(o.hi<<1|o.lo>>>31)^e;return varint64write(n,s,this.buf),this}uint64(t){let o=protoInt64.uEnc(t);return varint64write(o.lo,o.hi,this.buf),this}}class BinaryReader{constructor(t,o){this.varint64=varint64read,this.uint32=varint32read,this.buf=t,this.len=t.length,this.pos=0,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.textDecoder=o??new TextDecoder}tag(){let t=this.uint32(),o=t>>>3,e=t&7;if(o<=0||e<0||e>5)throw new Error("illegal tag: field no "+o+" wire type "+e);return[o,e]}skip(t,o){let e=this.pos;switch(t){case WireType.Varint:for(;this.buf[this.pos++]&128;);break;case WireType.Bit64:this.pos+=4;case WireType.Bit32:this.pos+=4;break;case WireType.LengthDelimited:let n=this.uint32();this.pos+=n;break;case WireType.StartGroup:for(;;){const[s,c]=this.tag();if(c===WireType.EndGroup){if(o!==void 0&&s!==o)throw new Error("invalid end group tag");break}this.skip(c,s)}break;default:throw new Error("cant skip wire type "+t)}return this.assertBounds(),this.buf.subarray(e,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)}int64(){return protoInt64.dec(...this.varint64())}uint64(){return protoInt64.uDec(...this.varint64())}sint64(){let[t,o]=this.varint64(),e=-(t&1);return t=(t>>>1|(o&1)<<31)^e,o=o>>>1^e,protoInt64.dec(t,o)}bool(){let[t,o]=this.varint64();return t!==0||o!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return protoInt64.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return protoInt64.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let t=this.uint32(),o=this.pos;return this.pos+=t,this.assertBounds(),this.buf.subarray(o,o+t)}string(){return this.textDecoder.decode(this.bytes())}}function makeExtension(a,t,o,e){let n;return{typeName:t,extendee:o,get field(){if(!n){const s=typeof e=="function"?e():e;s.name=t.split(".").pop(),s.jsonName="[".concat(t,"]"),n=a.util.newFieldList([s]).list()[0]}return n},runtime:a}}function createExtensionContainer(a){const t=a.field.localName,o=Object.create(null);return o[t]=initExtensionField(a),[o,()=>o[t]]}function initExtensionField(a){const t=a.field;if(t.repeated)return[];if(t.default!==void 0)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return scalarZeroValue(t.T,t.L);case"message":const o=t.T,e=new o;return o.fieldWrapper?o.fieldWrapper.unwrapField(e):e;case"map":throw"map fields are not allowed to be extensions"}}function filterUnknownFields(a,t){if(!t.repeated&&(t.kind=="enum"||t.kind=="scalar")){for(let o=a.length-1;o>=0;--o)if(a[o].no==t.no)return[a[o]];return[]}return a.filter(o=>o.no===t.no)}let encTable="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),decTable=[];for(let a=0;a<encTable.length;a++)decTable[encTable[a].charCodeAt(0)]=a;decTable["-".charCodeAt(0)]=encTable.indexOf("+");decTable["_".charCodeAt(0)]=encTable.indexOf("/");const protoBase64={dec(a){let t=a.length*3/4;a[a.length-2]=="="?t-=2:a[a.length-1]=="="&&(t-=1);let o=new Uint8Array(t),e=0,n=0,s,c=0;for(let l=0;l<a.length;l++){if(s=decTable[a.charCodeAt(l)],s===void 0)switch(a[l]){case"=":n=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(n){case 0:c=s,n=1;break;case 1:o[e++]=c<<2|(s&48)>>4,c=s,n=2;break;case 2:o[e++]=(c&15)<<4|(s&60)>>2,c=s,n=3;break;case 3:o[e++]=(c&3)<<6|s,n=0;break}}if(n==1)throw Error("invalid base64 string.");return o.subarray(0,e)},enc(a){let t="",o=0,e,n=0;for(let s=0;s<a.length;s++)switch(e=a[s],o){case 0:t+=encTable[e>>2],n=(e&3)<<4,o=1;break;case 1:t+=encTable[n|e>>4],n=(e&15)<<2,o=2;break;case 2:t+=encTable[n|e>>6],t+=encTable[e&63],o=0;break}return o&&(t+=encTable[n],t+="=",o==1&&(t+="=")),t}};function getExtension(a,t,o){assertExtendee(t,a);const e=t.runtime.bin.makeReadOptions(o),n=filterUnknownFields(a.getType().runtime.bin.listUnknownFields(a),t.field),[s,c]=createExtensionContainer(t);for(const l of n)t.runtime.bin.readField(s,e.readerFactory(l.data),t.field,l.wireType,e);return c()}function setExtension(a,t,o,e){assertExtendee(t,a);const n=t.runtime.bin.makeReadOptions(e),s=t.runtime.bin.makeWriteOptions(e);if(hasExtension(a,t)){const d=a.getType().runtime.bin.listUnknownFields(a).filter(p=>p.no!=t.field.no);a.getType().runtime.bin.discardUnknownFields(a);for(const p of d)a.getType().runtime.bin.onUnknownField(a,p.no,p.wireType,p.data)}const c=s.writerFactory();let l=t.field;!l.opt&&!l.repeated&&(l.kind=="enum"||l.kind=="scalar")&&(l=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(l,o,c,s);const u=n.readerFactory(c.finish());for(;u.pos<u.len;){const[d,p]=u.tag(),g=u.skip(p,d);a.getType().runtime.bin.onUnknownField(a,d,p,g)}}function hasExtension(a,t){const o=a.getType();return t.extendee.typeName===o.typeName&&!!o.runtime.bin.listUnknownFields(a).find(e=>e.no==t.field.no)}function assertExtendee(a,t){assert(a.extendee.typeName==t.getType().typeName,"extension ".concat(a.typeName," can only be applied to message ").concat(a.extendee.typeName))}function isFieldSet(a,t){const o=a.localName;if(a.repeated)return t[o].length>0;if(a.oneof)return t[a.oneof.localName].case===o;switch(a.kind){case"enum":case"scalar":return a.opt||a.req?t[o]!==void 0:a.kind=="enum"?t[o]!==a.T.values[0].no:!isScalarZeroValue(a.T,t[o]);case"message":return t[o]!==void 0;case"map":return Object.keys(t[o]).length>0}}function clearField(a,t){const o=a.localName,e=!a.opt&&!a.req;if(a.repeated)t[o]=[];else if(a.oneof)t[a.oneof.localName]={case:void 0};else switch(a.kind){case"map":t[o]={};break;case"enum":t[o]=e?a.T.values[0].no:void 0;break;case"scalar":t[o]=e?scalarZeroValue(a.T,a.L):void 0;break;case"message":t[o]=void 0;break}}function isMessage(a,t){if(a===null||typeof a!="object"||!Object.getOwnPropertyNames(Message.prototype).every(e=>e in a&&typeof a[e]=="function"))return!1;const o=a.getType();return o===null||typeof o!="function"||!("typeName"in o)||typeof o.typeName!="string"?!1:t===void 0?!0:o.typeName==t.typeName}function wrapField(a,t){return isMessage(t)||!a.fieldWrapper?t:a.fieldWrapper.wrapField(t)}ScalarType.DOUBLE,ScalarType.FLOAT,ScalarType.INT64,ScalarType.UINT64,ScalarType.INT32,ScalarType.UINT32,ScalarType.BOOL,ScalarType.STRING,ScalarType.BYTES;const jsonReadDefaults={ignoreUnknownFields:!1},jsonWriteDefaults={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function makeReadOptions$1(a){return a?Object.assign(Object.assign({},jsonReadDefaults),a):jsonReadDefaults}function makeWriteOptions$1(a){return a?Object.assign(Object.assign({},jsonWriteDefaults),a):jsonWriteDefaults}const tokenNull=Symbol(),tokenIgnoredUnknownEnum=Symbol();function makeJsonFormat(){return{makeReadOptions:makeReadOptions$1,makeWriteOptions:makeWriteOptions$1,readMessage(a,t,o,e){if(t==null||Array.isArray(t)||typeof t!="object")throw new Error("cannot decode message ".concat(a.typeName," from JSON: ").concat(debugJsonValue(t)));e=e??new a;const n=new Map,s=o.typeRegistry;for(const[c,l]of Object.entries(t)){const u=a.fields.findJsonName(c);if(u){if(u.oneof){if(l===null&&u.kind=="scalar")continue;const d=n.get(u.oneof);if(d!==void 0)throw new Error("cannot decode message ".concat(a.typeName,' from JSON: multiple keys for oneof "').concat(u.oneof.name,'" present: "').concat(d,'", "').concat(c,'"'));n.set(u.oneof,c)}readField$1(e,l,u,o,a)}else{let d=!1;if(s!=null&&s.findExtension&&c.startsWith("[")&&c.endsWith("]")){const p=s.findExtension(c.substring(1,c.length-1));if(p&&p.extendee.typeName==a.typeName){d=!0;const[g,y]=createExtensionContainer(p);readField$1(g,l,p.field,o,p),setExtension(e,p,y(),o)}}if(!d&&!o.ignoreUnknownFields)throw new Error("cannot decode message ".concat(a.typeName,' from JSON: key "').concat(c,'" is unknown'))}}return e},writeMessage(a,t){const o=a.getType(),e={};let n;try{for(n of o.fields.byNumber()){if(!isFieldSet(n,a)){if(n.req)throw"required field not set";if(!t.emitDefaultValues||!canEmitFieldDefaultValue(n))continue}const c=n.oneof?a[n.oneof.localName].value:a[n.localName],l=writeField$1(n,c,t);l!==void 0&&(e[t.useProtoFieldName?n.name:n.jsonName]=l)}const s=t.typeRegistry;if(s!=null&&s.findExtensionFor)for(const c of o.runtime.bin.listUnknownFields(a)){const l=s.findExtensionFor(o.typeName,c.no);if(l&&hasExtension(a,l)){const u=getExtension(a,l,t),d=writeField$1(l.field,u,t);d!==void 0&&(e[l.field.jsonName]=d)}}}catch(s){const c=n?"cannot encode field ".concat(o.typeName,".").concat(n.name," to JSON"):"cannot encode message ".concat(o.typeName," to JSON"),l=s instanceof Error?s.message:String(s);throw new Error(c+(l.length>0?": ".concat(l):""))}return e},readScalar(a,t,o){return readScalar$1(a,t,o??LongType.BIGINT,!0)},writeScalar(a,t,o){if(t!==void 0&&(o||isScalarZeroValue(a,t)))return writeScalar$1(a,t)},debug:debugJsonValue}}function debugJsonValue(a){if(a===null)return"null";switch(typeof a){case"object":return Array.isArray(a)?"array":"object";case"string":return a.length>100?"string":'"'.concat(a.split('"').join('\\"'),'"');default:return String(a)}}function readField$1(a,t,o,e,n){let s=o.localName;if(o.repeated){if(assert(o.kind!="map"),t===null)return;if(!Array.isArray(t))throw new Error("cannot decode field ".concat(n.typeName,".").concat(o.name," from JSON: ").concat(debugJsonValue(t)));const c=a[s];for(const l of t){if(l===null)throw new Error("cannot decode field ".concat(n.typeName,".").concat(o.name," from JSON: ").concat(debugJsonValue(l)));switch(o.kind){case"message":c.push(o.T.fromJson(l,e));break;case"enum":const u=readEnum(o.T,l,e.ignoreUnknownFields,!0);u!==tokenIgnoredUnknownEnum&&c.push(u);break;case"scalar":try{c.push(readScalar$1(o.T,l,o.L,!0))}catch(d){let p="cannot decode field ".concat(n.typeName,".").concat(o.name," from JSON: ").concat(debugJsonValue(l));throw d instanceof Error&&d.message.length>0&&(p+=": ".concat(d.message)),new Error(p)}break}}}else if(o.kind=="map"){if(t===null)return;if(typeof t!="object"||Array.isArray(t))throw new Error("cannot decode field ".concat(n.typeName,".").concat(o.name," from JSON: ").concat(debugJsonValue(t)));const c=a[s];for(const[l,u]of Object.entries(t)){if(u===null)throw new Error("cannot decode field ".concat(n.typeName,".").concat(o.name," from JSON: map value null"));let d;try{d=readMapKey(o.K,l)}catch(p){let g="cannot decode map key for field ".concat(n.typeName,".").concat(o.name," from JSON: ").concat(debugJsonValue(t));throw p instanceof Error&&p.message.length>0&&(g+=": ".concat(p.message)),new Error(g)}switch(o.V.kind){case"message":c[d]=o.V.T.fromJson(u,e);break;case"enum":const p=readEnum(o.V.T,u,e.ignoreUnknownFields,!0);p!==tokenIgnoredUnknownEnum&&(c[d]=p);break;case"scalar":try{c[d]=readScalar$1(o.V.T,u,LongType.BIGINT,!0)}catch(g){let y="cannot decode map value for field ".concat(n.typeName,".").concat(o.name," from JSON: ").concat(debugJsonValue(t));throw g instanceof Error&&g.message.length>0&&(y+=": ".concat(g.message)),new Error(y)}break}}}else switch(o.oneof&&(a=a[o.oneof.localName]={case:s},s="value"),o.kind){case"message":const c=o.T;if(t===null&&c.typeName!="google.protobuf.Value")return;let l=a[s];isMessage(l)?l.fromJson(t,e):(a[s]=l=c.fromJson(t,e),c.fieldWrapper&&!o.oneof&&(a[s]=c.fieldWrapper.unwrapField(l)));break;case"enum":const u=readEnum(o.T,t,e.ignoreUnknownFields,!1);switch(u){case tokenNull:clearField(o,a);break;case tokenIgnoredUnknownEnum:break;default:a[s]=u;break}break;case"scalar":try{const d=readScalar$1(o.T,t,o.L,!1);switch(d){case tokenNull:clearField(o,a);break;default:a[s]=d;break}}catch(d){let p="cannot decode field ".concat(n.typeName,".").concat(o.name," from JSON: ").concat(debugJsonValue(t));throw d instanceof Error&&d.message.length>0&&(p+=": ".concat(d.message)),new Error(p)}break}}function readMapKey(a,t){if(a===ScalarType.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1;break}return readScalar$1(a,t,LongType.BIGINT,!0).toString()}function readScalar$1(a,t,o,e){if(t===null)return e?scalarZeroValue(a,o):tokenNull;switch(a){case ScalarType.DOUBLE:case ScalarType.FLOAT:if(t==="NaN")return Number.NaN;if(t==="Infinity")return Number.POSITIVE_INFINITY;if(t==="-Infinity")return Number.NEGATIVE_INFINITY;if(t===""||typeof t=="string"&&t.trim().length!==t.length||typeof t!="string"&&typeof t!="number")break;const n=Number(t);if(Number.isNaN(n)||!Number.isFinite(n))break;return a==ScalarType.FLOAT&&assertFloat32(n),n;case ScalarType.INT32:case ScalarType.FIXED32:case ScalarType.SFIXED32:case ScalarType.SINT32:case ScalarType.UINT32:let s;if(typeof t=="number"?s=t:typeof t=="string"&&t.length>0&&t.trim().length===t.length&&(s=Number(t)),s===void 0)break;return a==ScalarType.UINT32||a==ScalarType.FIXED32?assertUInt32(s):assertInt32(s),s;case ScalarType.INT64:case ScalarType.SFIXED64:case ScalarType.SINT64:if(typeof t!="number"&&typeof t!="string")break;const c=protoInt64.parse(t);return o?c.toString():c;case ScalarType.FIXED64:case ScalarType.UINT64:if(typeof t!="number"&&typeof t!="string")break;const l=protoInt64.uParse(t);return o?l.toString():l;case ScalarType.BOOL:if(typeof t!="boolean")break;return t;case ScalarType.STRING:if(typeof t!="string")break;try{encodeURIComponent(t)}catch{throw new Error("invalid UTF8")}return t;case ScalarType.BYTES:if(t==="")return new Uint8Array(0);if(typeof t!="string")break;return protoBase64.dec(t)}throw new Error}function readEnum(a,t,o,e){if(t===null)return a.typeName=="google.protobuf.NullValue"?0:e?a.values[0].no:tokenNull;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const n=a.findName(t);if(n!==void 0)return n.no;if(o)return tokenIgnoredUnknownEnum;break}throw new Error("cannot decode enum ".concat(a.typeName," from JSON: ").concat(debugJsonValue(t)))}function canEmitFieldDefaultValue(a){return a.repeated||a.kind=="map"?!0:!(a.oneof||a.kind=="message"||a.opt||a.req)}function writeField$1(a,t,o){if(a.kind=="map"){assert(typeof t=="object"&&t!=null);const e={},n=Object.entries(t);switch(a.V.kind){case"scalar":for(const[c,l]of n)e[c.toString()]=writeScalar$1(a.V.T,l);break;case"message":for(const[c,l]of n)e[c.toString()]=l.toJson(o);break;case"enum":const s=a.V.T;for(const[c,l]of n)e[c.toString()]=writeEnum(s,l,o.enumAsInteger);break}return o.emitDefaultValues||n.length>0?e:void 0}if(a.repeated){assert(Array.isArray(t));const e=[];switch(a.kind){case"scalar":for(let n=0;n<t.length;n++)e.push(writeScalar$1(a.T,t[n]));break;case"enum":for(let n=0;n<t.length;n++)e.push(writeEnum(a.T,t[n],o.enumAsInteger));break;case"message":for(let n=0;n<t.length;n++)e.push(t[n].toJson(o));break}return o.emitDefaultValues||e.length>0?e:void 0}switch(a.kind){case"scalar":return writeScalar$1(a.T,t);case"enum":return writeEnum(a.T,t,o.enumAsInteger);case"message":return wrapField(a.T,t).toJson(o)}}function writeEnum(a,t,o){var e;if(assert(typeof t=="number"),a.typeName=="google.protobuf.NullValue")return null;if(o)return t;const n=a.findNumber(t);return(e=n==null?void 0:n.name)!==null&&e!==void 0?e:t}function writeScalar$1(a,t){switch(a){case ScalarType.INT32:case ScalarType.SFIXED32:case ScalarType.SINT32:case ScalarType.FIXED32:case ScalarType.UINT32:return assert(typeof t=="number"),t;case ScalarType.FLOAT:case ScalarType.DOUBLE:return assert(typeof t=="number"),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case ScalarType.STRING:return assert(typeof t=="string"),t;case ScalarType.BOOL:return assert(typeof t=="boolean"),t;case ScalarType.UINT64:case ScalarType.FIXED64:case ScalarType.INT64:case ScalarType.SFIXED64:case ScalarType.SINT64:return assert(typeof t=="bigint"||typeof t=="string"||typeof t=="number"),t.toString();case ScalarType.BYTES:return assert(t instanceof Uint8Array),protoBase64.enc(t)}}const unknownFieldsSymbol=Symbol("@bufbuild/protobuf/unknown-fields"),readDefaults={readUnknownFields:!0,readerFactory:a=>new BinaryReader(a)},writeDefaults={writeUnknownFields:!0,writerFactory:()=>new BinaryWriter};function makeReadOptions(a){return a?Object.assign(Object.assign({},readDefaults),a):readDefaults}function makeWriteOptions(a){return a?Object.assign(Object.assign({},writeDefaults),a):writeDefaults}function makeBinaryFormat(){return{makeReadOptions,makeWriteOptions,listUnknownFields(a){var t;return(t=a[unknownFieldsSymbol])!==null&&t!==void 0?t:[]},discardUnknownFields(a){delete a[unknownFieldsSymbol]},writeUnknownFields(a,t){const e=a[unknownFieldsSymbol];if(e)for(const n of e)t.tag(n.no,n.wireType).raw(n.data)},onUnknownField(a,t,o,e){const n=a;Array.isArray(n[unknownFieldsSymbol])||(n[unknownFieldsSymbol]=[]),n[unknownFieldsSymbol].push({no:t,wireType:o,data:e})},readMessage(a,t,o,e,n){const s=a.getType(),c=n?t.len:t.pos+o;let l,u;for(;t.pos<c&&([l,u]=t.tag(),!(n===!0&&u==WireType.EndGroup));){const d=s.fields.find(l);if(!d){const p=t.skip(u,l);e.readUnknownFields&&this.onUnknownField(a,l,u,p);continue}readField(a,t,d,u,e)}if(n&&(u!=WireType.EndGroup||l!==o))throw new Error("invalid end group tag")},readField,writeMessage(a,t,o){const e=a.getType();for(const n of e.fields.byNumber()){if(!isFieldSet(n,a)){if(n.req)throw new Error("cannot encode field ".concat(e.typeName,".").concat(n.name," to binary: required field not set"));continue}const s=n.oneof?a[n.oneof.localName].value:a[n.localName];writeField(n,s,t,o)}return o.writeUnknownFields&&this.writeUnknownFields(a,t),t},writeField(a,t,o,e){t!==void 0&&writeField(a,t,o,e)}}}function readField(a,t,o,e,n){let{repeated:s,localName:c}=o;switch(o.oneof&&(a=a[o.oneof.localName],a.case!=c&&delete a.value,a.case=c,c="value"),o.kind){case"scalar":case"enum":const l=o.kind=="enum"?ScalarType.INT32:o.T;let u=readScalar;if(o.kind=="scalar"&&o.L>0&&(u=readScalarLTString),s){let y=a[c];if(e==WireType.LengthDelimited&&l!=ScalarType.STRING&&l!=ScalarType.BYTES){let b=t.uint32()+t.pos;for(;t.pos<b;)y.push(u(t,l))}else y.push(u(t,l))}else a[c]=u(t,l);break;case"message":const d=o.T;s?a[c].push(readMessageField(t,new d,n,o)):isMessage(a[c])?readMessageField(t,a[c],n,o):(a[c]=readMessageField(t,new d,n,o),d.fieldWrapper&&!o.oneof&&!o.repeated&&(a[c]=d.fieldWrapper.unwrapField(a[c])));break;case"map":let[p,g]=readMapEntry(o,t,n);a[c][p]=g;break}}function readMessageField(a,t,o,e){const n=t.getType().runtime.bin,s=e==null?void 0:e.delimited;return n.readMessage(t,a,s?e.no:a.uint32(),o,s),t}function readMapEntry(a,t,o){const e=t.uint32(),n=t.pos+e;let s,c;for(;t.pos<n;){const[l]=t.tag();switch(l){case 1:s=readScalar(t,a.K);break;case 2:switch(a.V.kind){case"scalar":c=readScalar(t,a.V.T);break;case"enum":c=t.int32();break;case"message":c=readMessageField(t,new a.V.T,o,void 0);break}break}}if(s===void 0&&(s=scalarZeroValue(a.K,LongType.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),c===void 0)switch(a.V.kind){case"scalar":c=scalarZeroValue(a.V.T,LongType.BIGINT);break;case"enum":c=a.V.T.values[0].no;break;case"message":c=new a.V.T;break}return[s,c]}function readScalarLTString(a,t){const o=readScalar(a,t);return typeof o=="bigint"?o.toString():o}function readScalar(a,t){switch(t){case ScalarType.STRING:return a.string();case ScalarType.BOOL:return a.bool();case ScalarType.DOUBLE:return a.double();case ScalarType.FLOAT:return a.float();case ScalarType.INT32:return a.int32();case ScalarType.INT64:return a.int64();case ScalarType.UINT64:return a.uint64();case ScalarType.FIXED64:return a.fixed64();case ScalarType.BYTES:return a.bytes();case ScalarType.FIXED32:return a.fixed32();case ScalarType.SFIXED32:return a.sfixed32();case ScalarType.SFIXED64:return a.sfixed64();case ScalarType.SINT64:return a.sint64();case ScalarType.UINT32:return a.uint32();case ScalarType.SINT32:return a.sint32()}}function writeField(a,t,o,e){assert(t!==void 0);const n=a.repeated;switch(a.kind){case"scalar":case"enum":let s=a.kind=="enum"?ScalarType.INT32:a.T;if(n)if(assert(Array.isArray(t)),a.packed)writePacked(o,s,a.no,t);else for(const c of t)writeScalar(o,s,a.no,c);else writeScalar(o,s,a.no,t);break;case"message":if(n){assert(Array.isArray(t));for(const c of t)writeMessageField(o,e,a,c)}else writeMessageField(o,e,a,t);break;case"map":assert(typeof t=="object"&&t!=null);for(const[c,l]of Object.entries(t))writeMapEntry(o,e,a,c,l);break}}function writeMapEntry(a,t,o,e,n){a.tag(o.no,WireType.LengthDelimited),a.fork();let s=e;switch(o.K){case ScalarType.INT32:case ScalarType.FIXED32:case ScalarType.UINT32:case ScalarType.SFIXED32:case ScalarType.SINT32:s=Number.parseInt(e);break;case ScalarType.BOOL:assert(e=="true"||e=="false"),s=e=="true";break}switch(writeScalar(a,o.K,1,s),o.V.kind){case"scalar":writeScalar(a,o.V.T,2,n);break;case"enum":writeScalar(a,ScalarType.INT32,2,n);break;case"message":assert(n!==void 0),a.tag(2,WireType.LengthDelimited).bytes(n.toBinary(t));break}a.join()}function writeMessageField(a,t,o,e){const n=wrapField(o.T,e);o.delimited?a.tag(o.no,WireType.StartGroup).raw(n.toBinary(t)).tag(o.no,WireType.EndGroup):a.tag(o.no,WireType.LengthDelimited).bytes(n.toBinary(t))}function writeScalar(a,t,o,e){assert(e!==void 0);let[n,s]=scalarTypeInfo(t);a.tag(o,n)[s](e)}function writePacked(a,t,o,e){if(!e.length)return;a.tag(o,WireType.LengthDelimited).fork();let[,n]=scalarTypeInfo(t);for(let s=0;s<e.length;s++)a[n](e[s]);a.join()}function scalarTypeInfo(a){let t=WireType.Varint;switch(a){case ScalarType.BYTES:case ScalarType.STRING:t=WireType.LengthDelimited;break;case ScalarType.DOUBLE:case ScalarType.FIXED64:case ScalarType.SFIXED64:t=WireType.Bit64;break;case ScalarType.FIXED32:case ScalarType.SFIXED32:case ScalarType.FLOAT:t=WireType.Bit32;break}const o=ScalarType[a].toLowerCase();return[t,o]}function makeUtilCommon(){return{setEnumType,initPartial(a,t){if(a===void 0)return;const o=t.getType();for(const e of o.fields.byMember()){const n=e.localName,s=t,c=a;if(c[n]!=null)switch(e.kind){case"oneof":const l=c[n].case;if(l===void 0)continue;const u=e.findField(l);let d=c[n].value;u&&u.kind=="message"&&!isMessage(d,u.T)?d=new u.T(d):u&&u.kind==="scalar"&&u.T===ScalarType.BYTES&&(d=toU8Arr(d)),s[n]={case:l,value:d};break;case"scalar":case"enum":let p=c[n];e.T===ScalarType.BYTES&&(p=e.repeated?p.map(toU8Arr):toU8Arr(p)),s[n]=p;break;case"map":switch(e.V.kind){case"scalar":case"enum":if(e.V.T===ScalarType.BYTES)for(const[T,b]of Object.entries(c[n]))s[n][T]=toU8Arr(b);else Object.assign(s[n],c[n]);break;case"message":const y=e.V.T;for(const T of Object.keys(c[n])){let b=c[n][T];y.fieldWrapper||(b=new y(b)),s[n][T]=b}break}break;case"message":const g=e.T;if(e.repeated)s[n]=c[n].map(y=>isMessage(y,g)?y:new g(y));else{const y=c[n];g.fieldWrapper?g.typeName==="google.protobuf.BytesValue"?s[n]=toU8Arr(y):s[n]=y:s[n]=isMessage(y,g)?y:new g(y)}break}}},equals(a,t,o){return t===o?!0:!t||!o?!1:a.fields.byMember().every(e=>{const n=t[e.localName],s=o[e.localName];if(e.repeated){if(n.length!==s.length)return!1;switch(e.kind){case"message":return n.every((c,l)=>e.T.equals(c,s[l]));case"scalar":return n.every((c,l)=>scalarEquals(e.T,c,s[l]));case"enum":return n.every((c,l)=>scalarEquals(ScalarType.INT32,c,s[l]))}throw new Error("repeated cannot contain ".concat(e.kind))}switch(e.kind){case"message":return e.T.equals(n,s);case"enum":return scalarEquals(ScalarType.INT32,n,s);case"scalar":return scalarEquals(e.T,n,s);case"oneof":if(n.case!==s.case)return!1;const c=e.findField(n.case);if(c===void 0)return!0;switch(c.kind){case"message":return c.T.equals(n.value,s.value);case"enum":return scalarEquals(ScalarType.INT32,n.value,s.value);case"scalar":return scalarEquals(c.T,n.value,s.value)}throw new Error("oneof cannot contain ".concat(c.kind));case"map":const l=Object.keys(n).concat(Object.keys(s));switch(e.V.kind){case"message":const u=e.V.T;return l.every(p=>u.equals(n[p],s[p]));case"enum":return l.every(p=>scalarEquals(ScalarType.INT32,n[p],s[p]));case"scalar":const d=e.V.T;return l.every(p=>scalarEquals(d,n[p],s[p]))}break}})},clone(a){const t=a.getType(),o=new t,e=o;for(const n of t.fields.byMember()){const s=a[n.localName];let c;if(n.repeated)c=s.map(cloneSingularField);else if(n.kind=="map"){c=e[n.localName];for(const[l,u]of Object.entries(s))c[l]=cloneSingularField(u)}else n.kind=="oneof"?c=n.findField(s.case)?{case:s.case,value:cloneSingularField(s.value)}:{case:void 0}:c=cloneSingularField(s);e[n.localName]=c}for(const n of t.runtime.bin.listUnknownFields(a))t.runtime.bin.onUnknownField(e,n.no,n.wireType,n.data);return o}}}function cloneSingularField(a){if(a===void 0)return a;if(isMessage(a))return a.clone();if(a instanceof Uint8Array){const t=new Uint8Array(a.byteLength);return t.set(a),t}return a}function toU8Arr(a){return a instanceof Uint8Array?a:new Uint8Array(a)}function makeProtoRuntime(a,t,o){return{syntax:a,json:makeJsonFormat(),bin:makeBinaryFormat(),util:Object.assign(Object.assign({},makeUtilCommon()),{newFieldList:t,initFields:o}),makeMessageType(e,n,s){return makeMessageType(this,e,n,s)},makeEnum,makeEnumType,getEnumType,makeExtension(e,n,s){return makeExtension(this,e,n,s)}}}class InternalFieldList{constructor(t,o){this._fields=t,this._normalizer=o}findJsonName(t){if(!this.jsonNames){const o={};for(const e of this.list())o[e.jsonName]=o[e.name]=e;this.jsonNames=o}return this.jsonNames[t]}find(t){if(!this.numbers){const o={};for(const e of this.list())o[e.no]=e;this.numbers=o}return this.numbers[t]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((t,o)=>t.no-o.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const t=this.members;let o;for(const e of this.list())e.oneof?e.oneof!==o&&(o=e.oneof,t.push(o)):t.push(e)}return this.members}}function localFieldName(a,t){const o=protoCamelCase(a);return t?o:safeObjectProperty(safeMessageProperty(o))}function localOneofName(a){return localFieldName(a,!1)}const fieldJsonName=protoCamelCase;function protoCamelCase(a){let t=!1;const o=[];for(let e=0;e<a.length;e++){let n=a.charAt(e);switch(n){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":o.push(n),t=!1;break;default:t&&(t=!1,n=n.toUpperCase()),o.push(n);break}}return o.join("")}const reservedObjectProperties=new Set(["constructor","toString","toJSON","valueOf"]),reservedMessageProperties=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),fallback=a=>"".concat(a,"$"),safeMessageProperty=a=>reservedMessageProperties.has(a)?fallback(a):a,safeObjectProperty=a=>reservedObjectProperties.has(a)?fallback(a):a;class InternalOneofInfo{constructor(t){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=t,this.localName=localOneofName(t)}addField(t){assert(t.oneof===this,"field ".concat(t.name," not one of ").concat(this.name)),this.fields.push(t)}findField(t){if(!this._lookup){this._lookup=Object.create(null);for(let o=0;o<this.fields.length;o++)this._lookup[this.fields[o].localName]=this.fields[o]}return this._lookup[t]}}function normalizeFieldInfos(a,t){var o,e,n,s,c,l;const u=[];let d;for(const p of typeof a=="function"?a():a){const g=p;if(g.localName=localFieldName(p.name,p.oneof!==void 0),g.jsonName=(o=p.jsonName)!==null&&o!==void 0?o:fieldJsonName(p.name),g.repeated=(e=p.repeated)!==null&&e!==void 0?e:!1,p.kind=="scalar"&&(g.L=(n=p.L)!==null&&n!==void 0?n:LongType.BIGINT),g.delimited=(s=p.delimited)!==null&&s!==void 0?s:!1,g.req=(c=p.req)!==null&&c!==void 0?c:!1,g.opt=(l=p.opt)!==null&&l!==void 0?l:!1,p.packed===void 0&&(g.packed=p.kind=="enum"||p.kind=="scalar"&&p.T!=ScalarType.BYTES&&p.T!=ScalarType.STRING),p.oneof!==void 0){const y=typeof p.oneof=="string"?p.oneof:p.oneof.name;(!d||d.name!=y)&&(d=new InternalOneofInfo(y)),g.oneof=d,d.addField(g)}u.push(g)}return u}const proto3=makeProtoRuntime("proto3",a=>new InternalFieldList(a,t=>normalizeFieldInfos(t)),a=>{for(const t of a.getType().fields.byMember()){if(t.opt)continue;const o=t.localName,e=a;if(t.repeated){e[o]=[];continue}switch(t.kind){case"oneof":e[o]={case:void 0};break;case"enum":e[o]=0;break;case"map":e[o]={};break;case"scalar":e[o]=scalarZeroValue(t.T,t.L);break}}}),MetricsBatch=proto3.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:2,name:"time_series",kind:"message",T:TimeSeriesMetric,repeated:!0},{no:3,name:"events",kind:"message",T:EventMetric,repeated:!0}]),TimeSeriesMetric=proto3.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp",kind:"scalar",T:3},{no:5,name:"end_timestamp",kind:"scalar",T:3},{no:6,name:"samples",kind:"message",T:MetricSample,repeated:!0}]),MetricSample=proto3.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"value",kind:"scalar",T:2}]),EventMetric=proto3.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp",kind:"scalar",T:3},{no:5,name:"end_timestamp",kind:"scalar",T:3,opt:!0},{no:6,name:"metadata",kind:"scalar",T:9}]),TrackType=proto3.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),TrackSource=proto3.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),VideoQuality$1=proto3.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),ConnectionQuality$1=proto3.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),ClientConfigSetting=proto3.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),DisconnectReason=proto3.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"}]),ReconnectReason=proto3.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),SubscriptionError=proto3.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),AudioTrackFeature=proto3.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"}]),Room$1=proto3.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Codec,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:TimedVersion}]),Codec=proto3.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),ParticipantPermission=proto3.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:proto3.getEnumType(TrackSource),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),ParticipantInfo=proto3.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:proto3.getEnumType(ParticipantInfo_State)},{no:4,name:"tracks",kind:"message",T:TrackInfo,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:ParticipantPermission},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:proto3.getEnumType(ParticipantInfo_Kind)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:proto3.getEnumType(DisconnectReason)}]),ParticipantInfo_State=proto3.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),ParticipantInfo_Kind=proto3.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),Encryption_Type=proto3.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),SimulcastCodecInfo=proto3.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:VideoLayer,repeated:!0}]),TrackInfo=proto3.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:proto3.getEnumType(TrackType)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:proto3.getEnumType(TrackSource)},{no:10,name:"layers",kind:"message",T:VideoLayer,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:SimulcastCodecInfo,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:proto3.getEnumType(Encryption_Type)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:TimedVersion},{no:19,name:"audio_features",kind:"enum",T:proto3.getEnumType(AudioTrackFeature),repeated:!0}]),VideoLayer=proto3.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:proto3.getEnumType(VideoQuality$1)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]),DataPacket=proto3.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:proto3.getEnumType(DataPacket_Kind)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:UserPacket,oneof:"value"},{no:3,name:"speaker",kind:"message",T:ActiveSpeakerUpdate,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:SipDTMF,oneof:"value"},{no:7,name:"transcription",kind:"message",T:Transcription,oneof:"value"},{no:8,name:"metrics",kind:"message",T:MetricsBatch,oneof:"value"}]),DataPacket_Kind=proto3.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),ActiveSpeakerUpdate=proto3.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:SpeakerInfo,repeated:!0}]),SpeakerInfo=proto3.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),UserPacket=proto3.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0}]),SipDTMF=proto3.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),Transcription=proto3.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:TranscriptionSegment,repeated:!0}]),TranscriptionSegment=proto3.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),ParticipantTracks=proto3.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),ServerInfo=proto3.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:proto3.getEnumType(ServerInfo_Edition)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),ServerInfo_Edition=proto3.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),ClientInfo=proto3.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:proto3.getEnumType(ClientInfo_SDK)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9}]),ClientInfo_SDK=proto3.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"}]),ClientConfiguration=proto3.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:VideoConfiguration},{no:2,name:"screen",kind:"message",T:VideoConfiguration},{no:3,name:"resume_connection",kind:"enum",T:proto3.getEnumType(ClientConfigSetting)},{no:4,name:"disabled_codecs",kind:"message",T:DisabledCodecs},{no:5,name:"force_relay",kind:"enum",T:proto3.getEnumType(ClientConfigSetting)}]),VideoConfiguration=proto3.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:proto3.getEnumType(ClientConfigSetting)}]),DisabledCodecs=proto3.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Codec,repeated:!0},{no:2,name:"publish",kind:"message",T:Codec,repeated:!0}]),TimedVersion=proto3.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),SignalTarget=proto3.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),StreamState=proto3.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),CandidateProtocol=proto3.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),SignalRequest=proto3.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:SessionDescription,oneof:"message"},{no:2,name:"answer",kind:"message",T:SessionDescription,oneof:"message"},{no:3,name:"trickle",kind:"message",T:TrickleRequest,oneof:"message"},{no:4,name:"add_track",kind:"message",T:AddTrackRequest,oneof:"message"},{no:5,name:"mute",kind:"message",T:MuteTrackRequest,oneof:"message"},{no:6,name:"subscription",kind:"message",T:UpdateSubscription,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:UpdateTrackSettings,oneof:"message"},{no:8,name:"leave",kind:"message",T:LeaveRequest,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:UpdateVideoLayers,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:SubscriptionPermission,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:SyncState,oneof:"message"},{no:13,name:"simulate",kind:"message",T:SimulateScenario,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:UpdateParticipantMetadata,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Ping,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:UpdateLocalAudioTrack,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:UpdateLocalVideoTrack,oneof:"message"}]),SignalResponse=proto3.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:JoinResponse,oneof:"message"},{no:2,name:"answer",kind:"message",T:SessionDescription,oneof:"message"},{no:3,name:"offer",kind:"message",T:SessionDescription,oneof:"message"},{no:4,name:"trickle",kind:"message",T:TrickleRequest,oneof:"message"},{no:5,name:"update",kind:"message",T:ParticipantUpdate,oneof:"message"},{no:6,name:"track_published",kind:"message",T:TrackPublishedResponse,oneof:"message"},{no:8,name:"leave",kind:"message",T:LeaveRequest,oneof:"message"},{no:9,name:"mute",kind:"message",T:MuteTrackRequest,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:SpeakersChanged,oneof:"message"},{no:11,name:"room_update",kind:"message",T:RoomUpdate,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:ConnectionQualityUpdate,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:StreamStateUpdate,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:SubscribedQualityUpdate,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:SubscriptionPermissionUpdate,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:TrackUnpublishedResponse,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:ReconnectResponse,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:Pong,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:SubscriptionResponse,oneof:"message"},{no:22,name:"request_response",kind:"message",T:RequestResponse,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:TrackSubscribed,oneof:"message"}]),SimulcastCodec=proto3.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),AddTrackRequest=proto3.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:proto3.getEnumType(TrackType)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:proto3.getEnumType(TrackSource)},{no:9,name:"layers",kind:"message",T:VideoLayer,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:SimulcastCodec,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:proto3.getEnumType(Encryption_Type)},{no:15,name:"stream",kind:"scalar",T:9}]),TrickleRequest=proto3.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:proto3.getEnumType(SignalTarget)},{no:3,name:"final",kind:"scalar",T:8}]),MuteTrackRequest=proto3.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),JoinResponse=proto3.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:Room$1},{no:2,name:"participant",kind:"message",T:ParticipantInfo},{no:3,name:"other_participants",kind:"message",T:ParticipantInfo,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:ICEServer,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:ClientConfiguration},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:ServerInfo},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Codec,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),ReconnectResponse=proto3.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:ICEServer,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:ClientConfiguration}]),TrackPublishedResponse=proto3.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:TrackInfo}]),TrackUnpublishedResponse=proto3.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),SessionDescription=proto3.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9}]),ParticipantUpdate=proto3.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:ParticipantInfo,repeated:!0}]),UpdateSubscription=proto3.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:ParticipantTracks,repeated:!0}]),UpdateTrackSettings=proto3.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:proto3.getEnumType(VideoQuality$1)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),UpdateLocalAudioTrack=proto3.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:proto3.getEnumType(AudioTrackFeature),repeated:!0}]),UpdateLocalVideoTrack=proto3.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),LeaveRequest=proto3.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:proto3.getEnumType(DisconnectReason)},{no:3,name:"action",kind:"enum",T:proto3.getEnumType(LeaveRequest_Action)},{no:4,name:"regions",kind:"message",T:RegionSettings}]),LeaveRequest_Action=proto3.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),UpdateVideoLayers=proto3.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:VideoLayer,repeated:!0}]),UpdateParticipantMetadata=proto3.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),ICEServer=proto3.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),SpeakersChanged=proto3.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:SpeakerInfo,repeated:!0}]),RoomUpdate=proto3.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:Room$1}]),ConnectionQualityInfo=proto3.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:proto3.getEnumType(ConnectionQuality$1)},{no:3,name:"score",kind:"scalar",T:2}]),ConnectionQualityUpdate=proto3.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:ConnectionQualityInfo,repeated:!0}]),StreamStateInfo=proto3.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:proto3.getEnumType(StreamState)}]),StreamStateUpdate=proto3.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:StreamStateInfo,repeated:!0}]),SubscribedQuality=proto3.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:proto3.getEnumType(VideoQuality$1)},{no:2,name:"enabled",kind:"scalar",T:8}]),SubscribedCodec=proto3.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:SubscribedQuality,repeated:!0}]),SubscribedQualityUpdate=proto3.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:SubscribedQuality,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:SubscribedCodec,repeated:!0}]),TrackPermission=proto3.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),SubscriptionPermission=proto3.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:TrackPermission,repeated:!0}]),SubscriptionPermissionUpdate=proto3.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),SyncState=proto3.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:SessionDescription},{no:2,name:"subscription",kind:"message",T:UpdateSubscription},{no:3,name:"publish_tracks",kind:"message",T:TrackPublishedResponse,repeated:!0},{no:4,name:"data_channels",kind:"message",T:DataChannelInfo,repeated:!0},{no:5,name:"offer",kind:"message",T:SessionDescription},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0}]),DataChannelInfo=proto3.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:proto3.getEnumType(SignalTarget)}]),SimulateScenario=proto3.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:proto3.getEnumType(CandidateProtocol),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),Ping=proto3.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),Pong=proto3.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),RegionSettings=proto3.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:RegionInfo,repeated:!0}]),RegionInfo=proto3.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),SubscriptionResponse=proto3.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:proto3.getEnumType(SubscriptionError)}]),RequestResponse=proto3.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:proto3.getEnumType(RequestResponse_Reason)},{no:3,name:"message",kind:"scalar",T:9}]),RequestResponse_Reason=proto3.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),TrackSubscribed=proto3.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof dist.global<"u"?dist.global:typeof self<"u"?self:{};function getDefaultExportFromCjs(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var loglevel={exports:{}};(function(a){(function(t,o){a.exports?a.exports=o():t.log=o()})(commonjsGlobal,function(){var t=function(){},o="undefined",e=typeof window!==o&&typeof window.navigator!==o&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"],s={},c=null;function l(k,O){var C=k[O];if(typeof C.bind=="function")return C.bind(k);try{return Function.prototype.bind.call(C,k)}catch{return function(){return Function.prototype.apply.apply(C,[k,arguments])}}}function u(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function d(k){return k==="debug"&&(k="log"),typeof console===o?!1:k==="trace"&&e?u:console[k]!==void 0?l(console,k):console.log!==void 0?l(console,"log"):t}function p(){for(var k=this.getLevel(),O=0;O<n.length;O++){var C=n[O];this[C]=O<k?t:this.methodFactory(C,k,this.name)}if(this.log=this.debug,typeof console===o&&k<this.levels.SILENT)return"No console available for logging"}function g(k){return function(){typeof console!==o&&(p.call(this),this[k].apply(this,arguments))}}function y(k,O,C){return d(k)||g.apply(this,arguments)}function T(k,O){var C=this,N,x,U,P="loglevel";typeof k=="string"?P+=":"+k:typeof k=="symbol"&&(P=void 0);function F(I){var B=(n[I]||"silent").toUpperCase();if(!(typeof window===o||!P)){try{window.localStorage[P]=B;return}catch{}try{window.document.cookie=encodeURIComponent(P)+"="+B+";"}catch{}}}function j(){var I;if(!(typeof window===o||!P)){try{I=window.localStorage[P]}catch{}if(typeof I===o)try{var B=window.document.cookie,Y=encodeURIComponent(P),z=B.indexOf(Y+"=");z!==-1&&(I=/^([^;]+)/.exec(B.slice(z+Y.length+1))[1])}catch{}return C.levels[I]===void 0&&(I=void 0),I}}function J(){if(!(typeof window===o||!P)){try{window.localStorage.removeItem(P)}catch{}try{window.document.cookie=encodeURIComponent(P)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function W(I){var B=I;if(typeof B=="string"&&C.levels[B.toUpperCase()]!==void 0&&(B=C.levels[B.toUpperCase()]),typeof B=="number"&&B>=0&&B<=C.levels.SILENT)return B;throw new TypeError("log.setLevel() called with invalid level: "+I)}C.name=k,C.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},C.methodFactory=O||y,C.getLevel=function(){return U??x??N},C.setLevel=function(I,B){return U=W(I),B!==!1&&F(U),p.call(C)},C.setDefaultLevel=function(I){x=W(I),j()||C.setLevel(I,!1)},C.resetLevel=function(){U=null,J(),p.call(C)},C.enableAll=function(I){C.setLevel(C.levels.TRACE,I)},C.disableAll=function(I){C.setLevel(C.levels.SILENT,I)},C.rebuild=function(){if(c!==C&&(N=W(c.getLevel())),p.call(C),c===C)for(var I in s)s[I].rebuild()},N=W(c?c.getLevel():"WARN");var Z=j();Z!=null&&(U=W(Z)),p.call(C)}c=new T,c.getLogger=function(O){if(typeof O!="symbol"&&typeof O!="string"||O==="")throw new TypeError("You must supply a name when creating a logger.");var C=s[O];return C||(C=s[O]=new T(O,c.methodFactory)),C};var b=typeof window!==o?window.log:void 0;return c.noConflict=function(){return typeof window!==o&&window.log===c&&(window.log=b),c},c.getLoggers=function(){return s},c.default=c,c})})(loglevel);var loglevelExports=loglevel.exports,LogLevel;(function(a){a[a.trace=0]="trace",a[a.debug=1]="debug",a[a.info=2]="info",a[a.warn=3]="warn",a[a.error=4]="error",a[a.silent=5]="silent"})(LogLevel||(LogLevel={}));var LoggerNames;(function(a){a.Default="livekit",a.Room="livekit-room",a.Participant="livekit-participant",a.Track="livekit-track",a.Publication="livekit-track-publication",a.Engine="livekit-engine",a.Signal="livekit-signal",a.PCManager="livekit-pc-manager",a.PCTransport="livekit-pc-transport",a.E2EE="lk-e2ee"})(LoggerNames||(LoggerNames={}));let livekitLogger=loglevelExports.getLogger("livekit");Object.values(LoggerNames).map(a=>loglevelExports.getLogger(a));livekitLogger.setDefaultLevel(LogLevel.info);function getLogger(a){const t=loglevelExports.getLogger(a);return t.setDefaultLevel(livekitLogger.getLevel()),t}const workerLogger=loglevelExports.getLogger("lk-e2ee"),maxRetryDelay=7e3,DEFAULT_RETRY_DELAYS_IN_MS=[0,300,2*2*300,3*3*300,4*4*300,maxRetryDelay,maxRetryDelay,maxRetryDelay,maxRetryDelay,maxRetryDelay];class DefaultReconnectPolicy{constructor(t){this._retryDelays=t!==void 0?[...t]:DEFAULT_RETRY_DELAYS_IN_MS}nextRetryDelayInMs(t){if(t.retryCount>=this._retryDelays.length)return null;const o=this._retryDelays[t.retryCount];return t.retryCount<=1?o:o+Math.random()*1e3}}function __awaiter(a,t,o,e){function n(s){return s instanceof o?s:new o(function(c){c(s)})}return new(o||(o=Promise))(function(s,c){function l(p){try{d(e.next(p))}catch(g){c(g)}}function u(p){try{d(e.throw(p))}catch(g){c(g)}}function d(p){p.done?s(p.value):n(p.value).then(l,u)}d((e=e.apply(a,t||[])).next())})}function __values(a){var t=typeof Symbol=="function"&&Symbol.iterator,o=t&&a[t],e=0;if(o)return o.call(a);if(a&&typeof a.length=="number")return{next:function(){return a&&e>=a.length&&(a=void 0),{value:a&&a[e++],done:!a}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function __asyncValues(a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=a[Symbol.asyncIterator],o;return t?t.call(a):(a=typeof __values=="function"?__values(a):a[Symbol.iterator](),o={},e("next"),e("throw"),e("return"),o[Symbol.asyncIterator]=function(){return this},o);function e(s){o[s]=a[s]&&function(c){return new Promise(function(l,u){c=a[s](c),n(l,u,c.done,c.value)})}}function n(s,c,l,u){Promise.resolve(u).then(function(d){s({value:d,done:l})},c)}}typeof SuppressedError=="function"&&SuppressedError;var events={exports:{}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function(t,o,e){return Function.prototype.apply.call(t,o,e)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:ReflectOwnKeys=function(t){return Object.getOwnPropertyNames(t)};function ProcessEmitWarning(a){console&&console.warn&&console.warn(a)}var NumberIsNaN=Number.isNaN||function(t){return t!==t};function EventEmitter$1(){EventEmitter$1.init.call(this)}events.exports=EventEmitter$1;events.exports.once=once;EventEmitter$1.EventEmitter=EventEmitter$1;EventEmitter$1.prototype._events=void 0;EventEmitter$1.prototype._eventsCount=0;EventEmitter$1.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(a){if(typeof a!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof a)}Object.defineProperty(EventEmitter$1,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(a){if(typeof a!="number"||a<0||NumberIsNaN(a))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+a+".");defaultMaxListeners=a}});EventEmitter$1.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter$1.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||NumberIsNaN(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function _getMaxListeners(a){return a._maxListeners===void 0?EventEmitter$1.defaultMaxListeners:a._maxListeners}EventEmitter$1.prototype.getMaxListeners=function(){return _getMaxListeners(this)};EventEmitter$1.prototype.emit=function(t){for(var o=[],e=1;e<arguments.length;e++)o.push(arguments[e]);var n=t==="error",s=this._events;if(s!==void 0)n=n&&s.error===void 0;else if(!n)return!1;if(n){var c;if(o.length>0&&(c=o[0]),c instanceof Error)throw c;var l=new Error("Unhandled error."+(c?" ("+c.message+")":""));throw l.context=c,l}var u=s[t];if(u===void 0)return!1;if(typeof u=="function")ReflectApply(u,this,o);else for(var d=u.length,p=arrayClone(u,d),e=0;e<d;++e)ReflectApply(p[e],this,o);return!0};function _addListener(a,t,o,e){var n,s,c;if(checkListener(o),s=a._events,s===void 0?(s=a._events=Object.create(null),a._eventsCount=0):(s.newListener!==void 0&&(a.emit("newListener",t,o.listener?o.listener:o),s=a._events),c=s[t]),c===void 0)c=s[t]=o,++a._eventsCount;else if(typeof c=="function"?c=s[t]=e?[o,c]:[c,o]:e?c.unshift(o):c.push(o),n=_getMaxListeners(a),n>0&&c.length>n&&!c.warned){c.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=a,l.type=t,l.count=c.length,ProcessEmitWarning(l)}return a}EventEmitter$1.prototype.addListener=function(t,o){return _addListener(this,t,o,!1)};EventEmitter$1.prototype.on=EventEmitter$1.prototype.addListener;EventEmitter$1.prototype.prependListener=function(t,o){return _addListener(this,t,o,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(a,t,o){var e={fired:!1,wrapFn:void 0,target:a,type:t,listener:o},n=onceWrapper.bind(e);return n.listener=o,e.wrapFn=n,n}EventEmitter$1.prototype.once=function(t,o){return checkListener(o),this.on(t,_onceWrap(this,t,o)),this};EventEmitter$1.prototype.prependOnceListener=function(t,o){return checkListener(o),this.prependListener(t,_onceWrap(this,t,o)),this};EventEmitter$1.prototype.removeListener=function(t,o){var e,n,s,c,l;if(checkListener(o),n=this._events,n===void 0)return this;if(e=n[t],e===void 0)return this;if(e===o||e.listener===o)--this._eventsCount===0?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,e.listener||o));else if(typeof e!="function"){for(s=-1,c=e.length-1;c>=0;c--)if(e[c]===o||e[c].listener===o){l=e[c].listener,s=c;break}if(s<0)return this;s===0?e.shift():spliceOne(e,s),e.length===1&&(n[t]=e[0]),n.removeListener!==void 0&&this.emit("removeListener",t,l||o)}return this};EventEmitter$1.prototype.off=EventEmitter$1.prototype.removeListener;EventEmitter$1.prototype.removeAllListeners=function(t){var o,e,n;if(e=this._events,e===void 0)return this;if(e.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):e[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete e[t]),this;if(arguments.length===0){var s=Object.keys(e),c;for(n=0;n<s.length;++n)c=s[n],c!=="removeListener"&&this.removeAllListeners(c);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(o=e[t],typeof o=="function")this.removeListener(t,o);else if(o!==void 0)for(n=o.length-1;n>=0;n--)this.removeListener(t,o[n]);return this};function _listeners(a,t,o){var e=a._events;if(e===void 0)return[];var n=e[t];return n===void 0?[]:typeof n=="function"?o?[n.listener||n]:[n]:o?unwrapListeners(n):arrayClone(n,n.length)}EventEmitter$1.prototype.listeners=function(t){return _listeners(this,t,!0)};EventEmitter$1.prototype.rawListeners=function(t){return _listeners(this,t,!1)};EventEmitter$1.listenerCount=function(a,t){return typeof a.listenerCount=="function"?a.listenerCount(t):listenerCount.call(a,t)};EventEmitter$1.prototype.listenerCount=listenerCount;function listenerCount(a){var t=this._events;if(t!==void 0){var o=t[a];if(typeof o=="function")return 1;if(o!==void 0)return o.length}return 0}EventEmitter$1.prototype.eventNames=function(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(a,t){for(var o=new Array(t),e=0;e<t;++e)o[e]=a[e];return o}function spliceOne(a,t){for(;t+1<a.length;t++)a[t]=a[t+1];a.pop()}function unwrapListeners(a){for(var t=new Array(a.length),o=0;o<t.length;++o)t[o]=a[o].listener||a[o];return t}function once(a,t){return new Promise(function(o,e){function n(c){a.removeListener(t,s),e(c)}function s(){typeof a.removeListener=="function"&&a.removeListener("error",n),o([].slice.call(arguments))}eventTargetAgnosticAddListener(a,t,s,{once:!0}),t!=="error"&&addErrorHandlerIfEventEmitter(a,n,{once:!0})})}function addErrorHandlerIfEventEmitter(a,t,o){typeof a.on=="function"&&eventTargetAgnosticAddListener(a,"error",t,o)}function eventTargetAgnosticAddListener(a,t,o,e){if(typeof a.on=="function")e.once?a.once(t,o):a.on(t,o);else if(typeof a.addEventListener=="function")a.addEventListener(t,function n(s){e.once&&a.removeEventListener(t,n),o(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof a)}var eventsExports=events.exports;let logDisabled_=!0,deprecationWarnings_=!0;function extractVersion(a,t,o){const e=a.match(t);return e&&e.length>=o&&parseInt(e[o],10)}function wrapPeerConnectionEvent(a,t,o){if(!a.RTCPeerConnection)return;const e=a.RTCPeerConnection.prototype,n=e.addEventListener;e.addEventListener=function(c,l){if(c!==t)return n.apply(this,arguments);const u=d=>{const p=o(d);p&&(l.handleEvent?l.handleEvent(p):l(p))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(l,u),n.apply(this,[c,u])};const s=e.removeEventListener;e.removeEventListener=function(c,l){if(c!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(l))return s.apply(this,arguments);const u=this._eventMap[t].get(l);return this._eventMap[t].delete(l),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[c,u])},Object.defineProperty(e,"on"+t,{get(){return this["_on"+t]},set(c){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),c&&this.addEventListener(t,this["_on"+t]=c)},enumerable:!0,configurable:!0})}function disableLog(a){return typeof a!="boolean"?new Error("Argument type: "+typeof a+". Please use a boolean."):(logDisabled_=a,a?"adapter.js logging disabled":"adapter.js logging enabled")}function disableWarnings(a){return typeof a!="boolean"?new Error("Argument type: "+typeof a+". Please use a boolean."):(deprecationWarnings_=!a,"adapter.js deprecation warnings "+(a?"disabled":"enabled"))}function log$1(){if(typeof window=="object"){if(logDisabled_)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function deprecated(a,t){deprecationWarnings_&&console.warn(a+" is deprecated, please use "+t+" instead.")}function detectBrowser(a){const t={browser:null,version:null};if(typeof a>"u"||!a.navigator||!a.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:o}=a;if(o.userAgentData&&o.userAgentData.brands){const e=o.userAgentData.brands.find(n=>n.brand==="Chromium");if(e)return{browser:"chrome",version:parseInt(e.version,10)}}if(o.mozGetUserMedia)t.browser="firefox",t.version=extractVersion(o.userAgent,/Firefox\/(\d+)\./,1);else if(o.webkitGetUserMedia||a.isSecureContext===!1&&a.webkitRTCPeerConnection)t.browser="chrome",t.version=extractVersion(o.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(a.RTCPeerConnection&&o.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=extractVersion(o.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=a.RTCRtpTransceiver&&"currentDirection"in a.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}function isObject(a){return Object.prototype.toString.call(a)==="[object Object]"}function compactObject(a){return isObject(a)?Object.keys(a).reduce(function(t,o){const e=isObject(a[o]),n=e?compactObject(a[o]):a[o],s=e&&!Object.keys(n).length;return n===void 0||s?t:Object.assign(t,{[o]:n})},{}):a}function walkStats(a,t,o){!t||o.has(t.id)||(o.set(t.id,t),Object.keys(t).forEach(e=>{e.endsWith("Id")?walkStats(a,a.get(t[e]),o):e.endsWith("Ids")&&t[e].forEach(n=>{walkStats(a,a.get(n),o)})}))}function filterStats(a,t,o){const e=o?"outbound-rtp":"inbound-rtp",n=new Map;if(t===null)return n;const s=[];return a.forEach(c=>{c.type==="track"&&c.trackIdentifier===t.id&&s.push(c)}),s.forEach(c=>{a.forEach(l=>{l.type===e&&l.trackId===c.id&&walkStats(a,l,n)})}),n}const logging=log$1;function shimGetUserMedia$2(a,t){const o=a&&a.navigator;if(!o.mediaDevices)return;const e=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const u={};return Object.keys(l).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const p=typeof l[d]=="object"?l[d]:{ideal:l[d]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);const g=function(y,T){return y?y+T.charAt(0).toUpperCase()+T.slice(1):T==="deviceId"?"sourceId":T};if(p.ideal!==void 0){u.optional=u.optional||[];let y={};typeof p.ideal=="number"?(y[g("min",d)]=p.ideal,u.optional.push(y),y={},y[g("max",d)]=p.ideal,u.optional.push(y)):(y[g("",d)]=p.ideal,u.optional.push(y))}p.exact!==void 0&&typeof p.exact!="number"?(u.mandatory=u.mandatory||{},u.mandatory[g("",d)]=p.exact):["min","max"].forEach(y=>{p[y]!==void 0&&(u.mandatory=u.mandatory||{},u.mandatory[g(y,d)]=p[y])})}),l.advanced&&(u.optional=(u.optional||[]).concat(l.advanced)),u},n=function(l,u){if(t.version>=61)return u(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const d=function(p,g,y){g in p&&!(y in p)&&(p[y]=p[g],delete p[g])};l=JSON.parse(JSON.stringify(l)),d(l.audio,"autoGainControl","googAutoGainControl"),d(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=e(l.audio)}if(l&&typeof l.video=="object"){let d=l.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const p=t.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&!(o.mediaDevices.getSupportedConstraints&&o.mediaDevices.getSupportedConstraints().facingMode&&!p)){delete l.video.facingMode;let g;if(d.exact==="environment"||d.ideal==="environment"?g=["back","rear"]:(d.exact==="user"||d.ideal==="user")&&(g=["front"]),g)return o.mediaDevices.enumerateDevices().then(y=>{y=y.filter(b=>b.kind==="videoinput");let T=y.find(b=>g.some(k=>b.label.toLowerCase().includes(k)));return!T&&y.length&&g.includes("back")&&(T=y[y.length-1]),T&&(l.video.deviceId=d.exact?{exact:T.deviceId}:{ideal:T.deviceId}),l.video=e(l.video),logging("chrome: "+JSON.stringify(l)),u(l)})}l.video=e(l.video)}return logging("chrome: "+JSON.stringify(l)),u(l)},s=function(l){return t.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},c=function(l,u,d){n(l,p=>{o.webkitGetUserMedia(p,u,g=>{d&&d(s(g))})})};if(o.getUserMedia=c.bind(o),o.mediaDevices.getUserMedia){const l=o.mediaDevices.getUserMedia.bind(o.mediaDevices);o.mediaDevices.getUserMedia=function(u){return n(u,d=>l(d).then(p=>{if(d.audio&&!p.getAudioTracks().length||d.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(g=>{g.stop()}),new DOMException("","NotFoundError");return p},p=>Promise.reject(s(p))))}}}function shimMediaStream(a){a.MediaStream=a.MediaStream||a.webkitMediaStream}function shimOnTrack$1(a){if(typeof a=="object"&&a.RTCPeerConnection&&!("ontrack"in a.RTCPeerConnection.prototype)){Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(o){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=o)},enumerable:!0,configurable:!0});const t=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=e=>{e.stream.addEventListener("addtrack",n=>{let s;a.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(l=>l.track&&l.track.id===n.track.id):s={track:n.track};const c=new Event("track");c.track=n.track,c.receiver=s,c.transceiver={receiver:s},c.streams=[e.stream],this.dispatchEvent(c)}),e.stream.getTracks().forEach(n=>{let s;a.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(l=>l.track&&l.track.id===n.id):s={track:n};const c=new Event("track");c.track=n,c.receiver=s,c.transceiver={receiver:s},c.streams=[e.stream],this.dispatchEvent(c)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else wrapPeerConnectionEvent(a,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function shimGetSendersWithDtmf(a){if(typeof a=="object"&&a.RTCPeerConnection&&!("getSenders"in a.RTCPeerConnection.prototype)&&"createDTMFSender"in a.RTCPeerConnection.prototype){const t=function(n,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=n.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:n}};if(!a.RTCPeerConnection.prototype.getSenders){a.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(l,u){let d=n.apply(this,arguments);return d||(d=t(this,l),this._senders.push(d)),d};const s=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(l){s.apply(this,arguments);const u=this._senders.indexOf(l);u!==-1&&this._senders.splice(u,1)}}const o=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],o.apply(this,[s]),s.getTracks().forEach(c=>{this._senders.push(t(this,c))})};const e=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],e.apply(this,[s]),s.getTracks().forEach(c=>{const l=this._senders.find(u=>u.track===c);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof a=="object"&&a.RTCPeerConnection&&"getSenders"in a.RTCPeerConnection.prototype&&"createDTMFSender"in a.RTCPeerConnection.prototype&&a.RTCRtpSender&&!("dtmf"in a.RTCRtpSender.prototype)){const t=a.RTCPeerConnection.prototype.getSenders;a.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(n=>n._pc=this),e},Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function shimSenderReceiverGetStats(a){if(!(typeof a=="object"&&a.RTCPeerConnection&&a.RTCRtpSender&&a.RTCRtpReceiver))return;if(!("getStats"in a.RTCRtpSender.prototype)){const o=a.RTCPeerConnection.prototype.getSenders;o&&(a.RTCPeerConnection.prototype.getSenders=function(){const s=o.apply(this,[]);return s.forEach(c=>c._pc=this),s});const e=a.RTCPeerConnection.prototype.addTrack;e&&(a.RTCPeerConnection.prototype.addTrack=function(){const s=e.apply(this,arguments);return s._pc=this,s}),a.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(c=>filterStats(c,s.track,!0))}}if(!("getStats"in a.RTCRtpReceiver.prototype)){const o=a.RTCPeerConnection.prototype.getReceivers;o&&(a.RTCPeerConnection.prototype.getReceivers=function(){const n=o.apply(this,[]);return n.forEach(s=>s._pc=this),n}),wrapPeerConnectionEvent(a,"track",e=>(e.receiver._pc=e.srcElement,e)),a.RTCRtpReceiver.prototype.getStats=function(){const n=this;return this._pc.getStats().then(s=>filterStats(s,n.track,!1))}}if(!("getStats"in a.RTCRtpSender.prototype&&"getStats"in a.RTCRtpReceiver.prototype))return;const t=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof a.MediaStreamTrack){const e=arguments[0];let n,s,c;return this.getSenders().forEach(l=>{l.track===e&&(n?c=!0:n=l)}),this.getReceivers().forEach(l=>(l.track===e&&(s?c=!0:s=l),l.track===e)),c||n&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function shimAddTrackRemoveTrackWithNative(a){a.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(c=>this._shimmedLocalStreams[c][0])};const t=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(c,l){if(!l)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const u=t.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(u)===-1&&this._shimmedLocalStreams[l.id].push(u):this._shimmedLocalStreams[l.id]=[l,u],u};const o=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(c){this._shimmedLocalStreams=this._shimmedLocalStreams||{},c.getTracks().forEach(d=>{if(this.getSenders().find(g=>g.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();o.apply(this,arguments);const u=this.getSenders().filter(d=>l.indexOf(d)===-1);this._shimmedLocalStreams[c.id]=[c].concat(u)};const e=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[c.id],e.apply(this,arguments)};const n=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},c&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const u=this._shimmedLocalStreams[l].indexOf(c);u!==-1&&this._shimmedLocalStreams[l].splice(u,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),n.apply(this,arguments)}}function shimAddTrackRemoveTrack(a,t){if(!a.RTCPeerConnection)return;if(a.RTCPeerConnection.prototype.addTrack&&t.version>=65)return shimAddTrackRemoveTrackWithNative(a);const o=a.RTCPeerConnection.prototype.getLocalStreams;a.RTCPeerConnection.prototype.getLocalStreams=function(){const p=o.apply(this);return this._reverseStreams=this._reverseStreams||{},p.map(g=>this._reverseStreams[g.id])};const e=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(p){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},p.getTracks().forEach(g=>{if(this.getSenders().find(T=>T.track===g))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[p.id]){const g=new a.MediaStream(p.getTracks());this._streams[p.id]=g,this._reverseStreams[g.id]=p,p=g}e.apply(this,[p])};const n=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(p){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[p.id]||p]),delete this._reverseStreams[this._streams[p.id]?this._streams[p.id].id:p.id],delete this._streams[p.id]},a.RTCPeerConnection.prototype.addTrack=function(p,g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const y=[].slice.call(arguments,1);if(y.length!==1||!y[0].getTracks().find(k=>k===p))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(k=>k.track===p))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const b=this._streams[g.id];if(b)b.addTrack(p),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const k=new a.MediaStream([p]);this._streams[g.id]=k,this._reverseStreams[k.id]=g,this.addStream(k)}return this.getSenders().find(k=>k.track===p)};function s(d,p){let g=p.sdp;return Object.keys(d._reverseStreams||[]).forEach(y=>{const T=d._reverseStreams[y],b=d._streams[T.id];g=g.replace(new RegExp(b.id,"g"),T.id)}),new RTCSessionDescription({type:p.type,sdp:g})}function c(d,p){let g=p.sdp;return Object.keys(d._reverseStreams||[]).forEach(y=>{const T=d._reverseStreams[y],b=d._streams[T.id];g=g.replace(new RegExp(T.id,"g"),b.id)}),new RTCSessionDescription({type:p.type,sdp:g})}["createOffer","createAnswer"].forEach(function(d){const p=a.RTCPeerConnection.prototype[d],g={[d](){const y=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[b=>{const k=s(this,b);y[0].apply(null,[k])},b=>{y[1]&&y[1].apply(null,b)},arguments[2]]):p.apply(this,arguments).then(b=>s(this,b))}};a.RTCPeerConnection.prototype[d]=g[d]});const l=a.RTCPeerConnection.prototype.setLocalDescription;a.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=c(this,arguments[0]),l.apply(this,arguments))};const u=Object.getOwnPropertyDescriptor(a.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(a.RTCPeerConnection.prototype,"localDescription",{get(){const d=u.get.apply(this);return d.type===""?d:s(this,d)}}),a.RTCPeerConnection.prototype.removeTrack=function(p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!p._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(p._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let y;Object.keys(this._streams).forEach(T=>{this._streams[T].getTracks().find(k=>p.track===k)&&(y=this._streams[T])}),y&&(y.getTracks().length===1?this.removeStream(this._reverseStreams[y.id]):y.removeTrack(p.track),this.dispatchEvent(new Event("negotiationneeded")))}}function shimPeerConnection$1(a,t){!a.RTCPeerConnection&&a.webkitRTCPeerConnection&&(a.RTCPeerConnection=a.webkitRTCPeerConnection),a.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const e=a.RTCPeerConnection.prototype[o],n={[o](){return arguments[0]=new(o==="addIceCandidate"?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),e.apply(this,arguments)}};a.RTCPeerConnection.prototype[o]=n[o]})}function fixNegotiationNeeded(a,t){wrapPeerConnectionEvent(a,"negotiationneeded",o=>{const e=o.target;if(!((t.version<72||e.getConfiguration&&e.getConfiguration().sdpSemantics==="plan-b")&&e.signalingState!=="stable"))return o})}var chromeShim=Object.freeze({__proto__:null,fixNegotiationNeeded,shimAddTrackRemoveTrack,shimAddTrackRemoveTrackWithNative,shimGetSendersWithDtmf,shimGetUserMedia:shimGetUserMedia$2,shimMediaStream,shimOnTrack:shimOnTrack$1,shimPeerConnection:shimPeerConnection$1,shimSenderReceiverGetStats});function shimGetUserMedia$1(a,t){const o=a&&a.navigator,e=a&&a.MediaStreamTrack;if(o.getUserMedia=function(n,s,c){deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),o.mediaDevices.getUserMedia(n).then(s,c)},!(t.version>55&&"autoGainControl"in o.mediaDevices.getSupportedConstraints())){const n=function(c,l,u){l in c&&!(u in c)&&(c[u]=c[l],delete c[l])},s=o.mediaDevices.getUserMedia.bind(o.mediaDevices);if(o.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),n(c.audio,"autoGainControl","mozAutoGainControl"),n(c.audio,"noiseSuppression","mozNoiseSuppression")),s(c)},e&&e.prototype.getSettings){const c=e.prototype.getSettings;e.prototype.getSettings=function(){const l=c.apply(this,arguments);return n(l,"mozAutoGainControl","autoGainControl"),n(l,"mozNoiseSuppression","noiseSuppression"),l}}if(e&&e.prototype.applyConstraints){const c=e.prototype.applyConstraints;e.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),n(l,"autoGainControl","mozAutoGainControl"),n(l,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[l])}}}}function shimGetDisplayMedia(a,t){a.navigator.mediaDevices&&"getDisplayMedia"in a.navigator.mediaDevices||a.navigator.mediaDevices&&(a.navigator.mediaDevices.getDisplayMedia=function(e){if(!(e&&e.video)){const n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return e.video===!0?e.video={mediaSource:t}:e.video.mediaSource=t,a.navigator.mediaDevices.getUserMedia(e)})}function shimOnTrack(a){typeof a=="object"&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent.prototype&&!("transceiver"in a.RTCTrackEvent.prototype)&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function shimPeerConnection(a,t){if(typeof a!="object"||!(a.RTCPeerConnection||a.mozRTCPeerConnection))return;!a.RTCPeerConnection&&a.mozRTCPeerConnection&&(a.RTCPeerConnection=a.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const s=a.RTCPeerConnection.prototype[n],c={[n](){return arguments[0]=new(n==="addIceCandidate"?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};a.RTCPeerConnection.prototype[n]=c[n]});const o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},e=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(){const[s,c,l]=arguments;return e.apply(this,[s||null]).then(u=>{if(t.version<53&&!c)try{u.forEach(d=>{d.type=o[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;u.forEach((p,g)=>{u.set(g,Object.assign({},p,{type:o[p.type]||p.type}))})}return u}).then(c,l)}}function shimSenderGetStats(a){if(!(typeof a=="object"&&a.RTCPeerConnection&&a.RTCRtpSender)||a.RTCRtpSender&&"getStats"in a.RTCRtpSender.prototype)return;const t=a.RTCPeerConnection.prototype.getSenders;t&&(a.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(s=>s._pc=this),n});const o=a.RTCPeerConnection.prototype.addTrack;o&&(a.RTCPeerConnection.prototype.addTrack=function(){const n=o.apply(this,arguments);return n._pc=this,n}),a.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function shimReceiverGetStats(a){if(!(typeof a=="object"&&a.RTCPeerConnection&&a.RTCRtpSender)||a.RTCRtpSender&&"getStats"in a.RTCRtpReceiver.prototype)return;const t=a.RTCPeerConnection.prototype.getReceivers;t&&(a.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(n=>n._pc=this),e}),wrapPeerConnectionEvent(a,"track",o=>(o.receiver._pc=o.srcElement,o)),a.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function shimRemoveStream(a){!a.RTCPeerConnection||"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(o){deprecated("removeStream","removeTrack"),this.getSenders().forEach(e=>{e.track&&o.getTracks().includes(e.track)&&this.removeTrack(e)})})}function shimRTCDataChannel(a){a.DataChannel&&!a.RTCDataChannel&&(a.RTCDataChannel=a.DataChannel)}function shimAddTransceiver(a){if(!(typeof a=="object"&&a.RTCPeerConnection))return;const t=a.RTCPeerConnection.prototype.addTransceiver;t&&(a.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;e===void 0&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach(c=>{if("rid"in c&&!/^[a-z0-9]{0,16}$/i.test(c.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in c&&!(parseFloat(c.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in c&&!(parseFloat(c.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=t.apply(this,arguments);if(n){const{sender:c}=s,l=c.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=e,c.sendEncodings=e,this.setParametersPromises.push(c.setParameters(l).then(()=>{delete c.sendEncodings}).catch(()=>{delete c.sendEncodings})))}return s})}function shimGetParameters(a){if(!(typeof a=="object"&&a.RTCRtpSender))return;const t=a.RTCRtpSender.prototype.getParameters;t&&(a.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function shimCreateOffer(a){if(!(typeof a=="object"&&a.RTCPeerConnection))return;const t=a.RTCPeerConnection.prototype.createOffer;a.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function shimCreateAnswer(a){if(!(typeof a=="object"&&a.RTCPeerConnection))return;const t=a.RTCPeerConnection.prototype.createAnswer;a.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var firefoxShim=Object.freeze({__proto__:null,shimAddTransceiver,shimCreateAnswer,shimCreateOffer,shimGetDisplayMedia,shimGetParameters,shimGetUserMedia:shimGetUserMedia$1,shimOnTrack,shimPeerConnection,shimRTCDataChannel,shimReceiverGetStats,shimRemoveStream,shimSenderGetStats});function shimLocalStreamsAPI(a){if(!(typeof a!="object"||!a.RTCPeerConnection)){if("getLocalStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in a.RTCPeerConnection.prototype)){const t=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(n=>t.call(this,n,e)),e.getVideoTracks().forEach(n=>t.call(this,n,e))},a.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,s=new Array(n>1?n-1:0),c=1;c<n;c++)s[c-1]=arguments[c];return s&&s.forEach(l=>{this._localStreams?this._localStreams.includes(l)||this._localStreams.push(l):this._localStreams=[l]}),t.apply(this,arguments)}}"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(o){this._localStreams||(this._localStreams=[]);const e=this._localStreams.indexOf(o);if(e===-1)return;this._localStreams.splice(e,1);const n=o.getTracks();this.getSenders().forEach(s=>{n.includes(s.track)&&this.removeTrack(s)})})}}function shimRemoteStreamsAPI(a){if(!(typeof a!="object"||!a.RTCPeerConnection)&&("getRemoteStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in a.RTCPeerConnection.prototype))){Object.defineProperty(a.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(o){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=o),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(n=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(n))return;this._remoteStreams.push(n);const s=new Event("addstream");s.stream=n,this.dispatchEvent(s)})})}});const t=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(s=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(s)>=0)return;e._remoteStreams.push(s);const c=new Event("addstream");c.stream=s,e.dispatchEvent(c)})}),t.apply(e,arguments)}}}function shimCallbacksAPI(a){if(typeof a!="object"||!a.RTCPeerConnection)return;const t=a.RTCPeerConnection.prototype,o=t.createOffer,e=t.createAnswer,n=t.setLocalDescription,s=t.setRemoteDescription,c=t.addIceCandidate;t.createOffer=function(d,p){const g=arguments.length>=2?arguments[2]:arguments[0],y=o.apply(this,[g]);return p?(y.then(d,p),Promise.resolve()):y},t.createAnswer=function(d,p){const g=arguments.length>=2?arguments[2]:arguments[0],y=e.apply(this,[g]);return p?(y.then(d,p),Promise.resolve()):y};let l=function(u,d,p){const g=n.apply(this,[u]);return p?(g.then(d,p),Promise.resolve()):g};t.setLocalDescription=l,l=function(u,d,p){const g=s.apply(this,[u]);return p?(g.then(d,p),Promise.resolve()):g},t.setRemoteDescription=l,l=function(u,d,p){const g=c.apply(this,[u]);return p?(g.then(d,p),Promise.resolve()):g},t.addIceCandidate=l}function shimGetUserMedia(a){const t=a&&a.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const o=t.mediaDevices,e=o.getUserMedia.bind(o);t.mediaDevices.getUserMedia=n=>e(shimConstraints(n))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(e,n,s){t.mediaDevices.getUserMedia(e).then(n,s)}).bind(t))}function shimConstraints(a){return a&&a.video!==void 0?Object.assign({},a,{video:compactObject(a.video)}):a}function shimRTCIceServerUrls(a){if(!a.RTCPeerConnection)return;const t=a.RTCPeerConnection;a.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const s=[];for(let c=0;c<e.iceServers.length;c++){let l=e.iceServers[c];l.urls===void 0&&l.url?(deprecated("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,s.push(l)):s.push(e.iceServers[c])}e.iceServers=s}return new t(e,n)},a.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function shimTrackEventTransceiver(a){typeof a=="object"&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent.prototype&&!("transceiver"in a.RTCTrackEvent.prototype)&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function shimCreateOfferLegacy(a){const t=a.RTCPeerConnection.prototype.createOffer;a.RTCPeerConnection.prototype.createOffer=function(e){if(e){typeof e.offerToReceiveAudio<"u"&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const n=this.getTransceivers().find(c=>c.receiver.track.kind==="audio");e.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):e.offerToReceiveAudio===!0&&!n&&this.addTransceiver("audio",{direction:"recvonly"}),typeof e.offerToReceiveVideo<"u"&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const s=this.getTransceivers().find(c=>c.receiver.track.kind==="video");e.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):e.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function shimAudioContext(a){typeof a!="object"||a.AudioContext||(a.AudioContext=a.webkitAudioContext)}var safariShim=Object.freeze({__proto__:null,shimAudioContext,shimCallbacksAPI,shimConstraints,shimCreateOfferLegacy,shimGetUserMedia,shimLocalStreamsAPI,shimRTCIceServerUrls,shimRemoteStreamsAPI,shimTrackEventTransceiver}),sdp$1={exports:{}};(function(a){const t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(o){return o.trim().split(`
`).map(e=>e.trim())},t.splitSections=function(o){return o.split(`
m=`).map((n,s)=>(s>0?"m="+n:n).trim()+`\r
`)},t.getDescription=function(o){const e=t.splitSections(o);return e&&e[0]},t.getMediaSections=function(o){const e=t.splitSections(o);return e.shift(),e},t.matchPrefix=function(o,e){return t.splitLines(o).filter(n=>n.indexOf(e)===0)},t.parseCandidate=function(o){let e;o.indexOf("a=candidate:")===0?e=o.substring(12).split(" "):e=o.substring(10).split(" ");const n={foundation:e[0],component:{1:"rtp",2:"rtcp"}[e[1]]||e[1],protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],address:e[4],port:parseInt(e[5],10),type:e[7]};for(let s=8;s<e.length;s+=2)switch(e[s]){case"raddr":n.relatedAddress=e[s+1];break;case"rport":n.relatedPort=parseInt(e[s+1],10);break;case"tcptype":n.tcpType=e[s+1];break;case"ufrag":n.ufrag=e[s+1],n.usernameFragment=e[s+1];break;default:n[e[s]]===void 0&&(n[e[s]]=e[s+1]);break}return n},t.writeCandidate=function(o){const e=[];e.push(o.foundation);const n=o.component;n==="rtp"?e.push(1):n==="rtcp"?e.push(2):e.push(n),e.push(o.protocol.toUpperCase()),e.push(o.priority),e.push(o.address||o.ip),e.push(o.port);const s=o.type;return e.push("typ"),e.push(s),s!=="host"&&o.relatedAddress&&o.relatedPort&&(e.push("raddr"),e.push(o.relatedAddress),e.push("rport"),e.push(o.relatedPort)),o.tcpType&&o.protocol.toLowerCase()==="tcp"&&(e.push("tcptype"),e.push(o.tcpType)),(o.usernameFragment||o.ufrag)&&(e.push("ufrag"),e.push(o.usernameFragment||o.ufrag)),"candidate:"+e.join(" ")},t.parseIceOptions=function(o){return o.substring(14).split(" ")},t.parseRtpMap=function(o){let e=o.substring(9).split(" ");const n={payloadType:parseInt(e.shift(),10)};return e=e[0].split("/"),n.name=e[0],n.clockRate=parseInt(e[1],10),n.channels=e.length===3?parseInt(e[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(o){let e=o.payloadType;o.preferredPayloadType!==void 0&&(e=o.preferredPayloadType);const n=o.channels||o.numChannels||1;return"a=rtpmap:"+e+" "+o.name+"/"+o.clockRate+(n!==1?"/"+n:"")+`\r
`},t.parseExtmap=function(o){const e=o.substring(9).split(" ");return{id:parseInt(e[0],10),direction:e[0].indexOf("/")>0?e[0].split("/")[1]:"sendrecv",uri:e[1],attributes:e.slice(2).join(" ")}},t.writeExtmap=function(o){return"a=extmap:"+(o.id||o.preferredId)+(o.direction&&o.direction!=="sendrecv"?"/"+o.direction:"")+" "+o.uri+(o.attributes?" "+o.attributes:"")+`\r
`},t.parseFmtp=function(o){const e={};let n;const s=o.substring(o.indexOf(" ")+1).split(";");for(let c=0;c<s.length;c++)n=s[c].trim().split("="),e[n[0].trim()]=n[1];return e},t.writeFmtp=function(o){let e="",n=o.payloadType;if(o.preferredPayloadType!==void 0&&(n=o.preferredPayloadType),o.parameters&&Object.keys(o.parameters).length){const s=[];Object.keys(o.parameters).forEach(c=>{o.parameters[c]!==void 0?s.push(c+"="+o.parameters[c]):s.push(c)}),e+="a=fmtp:"+n+" "+s.join(";")+`\r
`}return e},t.parseRtcpFb=function(o){const e=o.substring(o.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}},t.writeRtcpFb=function(o){let e="",n=o.payloadType;return o.preferredPayloadType!==void 0&&(n=o.preferredPayloadType),o.rtcpFeedback&&o.rtcpFeedback.length&&o.rtcpFeedback.forEach(s=>{e+="a=rtcp-fb:"+n+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),e},t.parseSsrcMedia=function(o){const e=o.indexOf(" "),n={ssrc:parseInt(o.substring(7,e),10)},s=o.indexOf(":",e);return s>-1?(n.attribute=o.substring(e+1,s),n.value=o.substring(s+1)):n.attribute=o.substring(e+1),n},t.parseSsrcGroup=function(o){const e=o.substring(13).split(" ");return{semantics:e.shift(),ssrcs:e.map(n=>parseInt(n,10))}},t.getMid=function(o){const e=t.matchPrefix(o,"a=mid:")[0];if(e)return e.substring(6)},t.parseFingerprint=function(o){const e=o.substring(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1].toUpperCase()}},t.getDtlsParameters=function(o,e){return{role:"auto",fingerprints:t.matchPrefix(o+e,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(o,e){let n="a=setup:"+e+`\r
`;return o.fingerprints.forEach(s=>{n+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),n},t.parseCryptoLine=function(o){const e=o.substring(9).split(" ");return{tag:parseInt(e[0],10),cryptoSuite:e[1],keyParams:e[2],sessionParams:e.slice(3)}},t.writeCryptoLine=function(o){return"a=crypto:"+o.tag+" "+o.cryptoSuite+" "+(typeof o.keyParams=="object"?t.writeCryptoKeyParams(o.keyParams):o.keyParams)+(o.sessionParams?" "+o.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(o){if(o.indexOf("inline:")!==0)return null;const e=o.substring(7).split("|");return{keyMethod:"inline",keySalt:e[0],lifeTime:e[1],mkiValue:e[2]?e[2].split(":")[0]:void 0,mkiLength:e[2]?e[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(o){return o.keyMethod+":"+o.keySalt+(o.lifeTime?"|"+o.lifeTime:"")+(o.mkiValue&&o.mkiLength?"|"+o.mkiValue+":"+o.mkiLength:"")},t.getCryptoParameters=function(o,e){return t.matchPrefix(o+e,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(o,e){const n=t.matchPrefix(o+e,"a=ice-ufrag:")[0],s=t.matchPrefix(o+e,"a=ice-pwd:")[0];return n&&s?{usernameFragment:n.substring(12),password:s.substring(10)}:null},t.writeIceParameters=function(o){let e="a=ice-ufrag:"+o.usernameFragment+`\r
a=ice-pwd:`+o.password+`\r
`;return o.iceLite&&(e+=`a=ice-lite\r
`),e},t.parseRtpParameters=function(o){const e={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=t.splitLines(o)[0].split(" ");e.profile=s[2];for(let l=3;l<s.length;l++){const u=s[l],d=t.matchPrefix(o,"a=rtpmap:"+u+" ")[0];if(d){const p=t.parseRtpMap(d),g=t.matchPrefix(o,"a=fmtp:"+u+" ");switch(p.parameters=g.length?t.parseFmtp(g[0]):{},p.rtcpFeedback=t.matchPrefix(o,"a=rtcp-fb:"+u+" ").map(t.parseRtcpFb),e.codecs.push(p),p.name.toUpperCase()){case"RED":case"ULPFEC":e.fecMechanisms.push(p.name.toUpperCase());break}}}t.matchPrefix(o,"a=extmap:").forEach(l=>{e.headerExtensions.push(t.parseExtmap(l))});const c=t.matchPrefix(o,"a=rtcp-fb:* ").map(t.parseRtcpFb);return e.codecs.forEach(l=>{c.forEach(u=>{l.rtcpFeedback.find(p=>p.type===u.type&&p.parameter===u.parameter)||l.rtcpFeedback.push(u)})}),e},t.writeRtpDescription=function(o,e){let n="";n+="m="+o+" ",n+=e.codecs.length>0?"9":"0",n+=" "+(e.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=e.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,e.codecs.forEach(c=>{n+=t.writeRtpMap(c),n+=t.writeFmtp(c),n+=t.writeRtcpFb(c)});let s=0;return e.codecs.forEach(c=>{c.maxptime>s&&(s=c.maxptime)}),s>0&&(n+="a=maxptime:"+s+`\r
`),e.headerExtensions&&e.headerExtensions.forEach(c=>{n+=t.writeExtmap(c)}),n},t.parseRtpEncodingParameters=function(o){const e=[],n=t.parseRtpParameters(o),s=n.fecMechanisms.indexOf("RED")!==-1,c=n.fecMechanisms.indexOf("ULPFEC")!==-1,l=t.matchPrefix(o,"a=ssrc:").map(y=>t.parseSsrcMedia(y)).filter(y=>y.attribute==="cname"),u=l.length>0&&l[0].ssrc;let d;const p=t.matchPrefix(o,"a=ssrc-group:FID").map(y=>y.substring(17).split(" ").map(b=>parseInt(b,10)));p.length>0&&p[0].length>1&&p[0][0]===u&&(d=p[0][1]),n.codecs.forEach(y=>{if(y.name.toUpperCase()==="RTX"&&y.parameters.apt){let T={ssrc:u,codecPayloadType:parseInt(y.parameters.apt,10)};u&&d&&(T.rtx={ssrc:d}),e.push(T),s&&(T=JSON.parse(JSON.stringify(T)),T.fec={ssrc:u,mechanism:c?"red+ulpfec":"red"},e.push(T))}}),e.length===0&&u&&e.push({ssrc:u});let g=t.matchPrefix(o,"b=");return g.length&&(g[0].indexOf("b=TIAS:")===0?g=parseInt(g[0].substring(7),10):g[0].indexOf("b=AS:")===0?g=parseInt(g[0].substring(5),10)*1e3*.95-50*40*8:g=void 0,e.forEach(y=>{y.maxBitrate=g})),e},t.parseRtcpParameters=function(o){const e={},n=t.matchPrefix(o,"a=ssrc:").map(l=>t.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];n&&(e.cname=n.value,e.ssrc=n.ssrc);const s=t.matchPrefix(o,"a=rtcp-rsize");e.reducedSize=s.length>0,e.compound=s.length===0;const c=t.matchPrefix(o,"a=rtcp-mux");return e.mux=c.length>0,e},t.writeRtcpParameters=function(o){let e="";return o.reducedSize&&(e+=`a=rtcp-rsize\r
`),o.mux&&(e+=`a=rtcp-mux\r
`),o.ssrc!==void 0&&o.cname&&(e+="a=ssrc:"+o.ssrc+" cname:"+o.cname+`\r
`),e},t.parseMsid=function(o){let e;const n=t.matchPrefix(o,"a=msid:");if(n.length===1)return e=n[0].substring(7).split(" "),{stream:e[0],track:e[1]};const s=t.matchPrefix(o,"a=ssrc:").map(c=>t.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");if(s.length>0)return e=s[0].value.split(" "),{stream:e[0],track:e[1]}},t.parseSctpDescription=function(o){const e=t.parseMLine(o),n=t.matchPrefix(o,"a=max-message-size:");let s;n.length>0&&(s=parseInt(n[0].substring(19),10)),isNaN(s)&&(s=65536);const c=t.matchPrefix(o,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substring(12),10),protocol:e.fmt,maxMessageSize:s};const l=t.matchPrefix(o,"a=sctpmap:");if(l.length>0){const u=l[0].substring(10).split(" ");return{port:parseInt(u[0],10),protocol:u[1],maxMessageSize:s}}},t.writeSctpDescription=function(o,e){let n=[];return o.protocol!=="DTLS/SCTP"?n=["m="+o.kind+" 9 "+o.protocol+" "+e.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+e.port+`\r
`]:n=["m="+o.kind+" 9 "+o.protocol+" "+e.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+e.port+" "+e.protocol+` 65535\r
`],e.maxMessageSize!==void 0&&n.push("a=max-message-size:"+e.maxMessageSize+`\r
`),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(o,e,n){let s;const c=e!==void 0?e:2;return o?s=o:s=t.generateSessionId(),`v=0\r
o=`+(n||"thisisadapterortc")+" "+s+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(o,e){const n=t.splitLines(o);for(let s=0;s<n.length;s++)switch(n[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[s].substring(2)}return e?t.getDirection(e):"sendrecv"},t.getKind=function(o){return t.splitLines(o)[0].split(" ")[0].substring(2)},t.isRejected=function(o){return o.split(" ",2)[1]==="0"},t.parseMLine=function(o){const n=t.splitLines(o)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(o){const n=t.matchPrefix(o,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(o){if(typeof o!="string"||o.length===0)return!1;const e=t.splitLines(o);for(let n=0;n<e.length;n++)if(e[n].length<2||e[n].charAt(1)!=="=")return!1;return!0},a.exports=t})(sdp$1);var sdpExports=sdp$1.exports,SDPUtils=getDefaultExportFromCjs(sdpExports),sdp=_mergeNamespaces({__proto__:null,default:SDPUtils},[sdpExports]);function shimRTCIceCandidate(a){if(!a.RTCIceCandidate||a.RTCIceCandidate&&"foundation"in a.RTCIceCandidate.prototype)return;const t=a.RTCIceCandidate;a.RTCIceCandidate=function(e){if(typeof e=="object"&&e.candidate&&e.candidate.indexOf("a=")===0&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const n=new t(e),s=SDPUtils.parseCandidate(e.candidate);for(const c in s)c in n||Object.defineProperty(n,c,{value:s[c]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},a.RTCIceCandidate.prototype=t.prototype,wrapPeerConnectionEvent(a,"icecandidate",o=>(o.candidate&&Object.defineProperty(o,"candidate",{value:new a.RTCIceCandidate(o.candidate),writable:"false"}),o))}function shimRTCIceCandidateRelayProtocol(a){!a.RTCIceCandidate||a.RTCIceCandidate&&"relayProtocol"in a.RTCIceCandidate.prototype||wrapPeerConnectionEvent(a,"icecandidate",t=>{if(t.candidate){const o=SDPUtils.parseCandidate(t.candidate.candidate);o.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[o.priority>>24])}return t})}function shimMaxMessageSize(a,t){if(!a.RTCPeerConnection)return;"sctp"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const o=function(l){if(!l||!l.sdp)return!1;const u=SDPUtils.splitSections(l.sdp);return u.shift(),u.some(d=>{const p=SDPUtils.parseMLine(d);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},e=function(l){const u=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(u===null||u.length<2)return-1;const d=parseInt(u[1],10);return d!==d?-1:d},n=function(l){let u=65536;return t.browser==="firefox"&&(t.version<57?l===-1?u=16384:u=2147483637:t.version<60?u=t.version===57?65535:65536:u=2147483637),u},s=function(l,u){let d=65536;t.browser==="firefox"&&t.version===57&&(d=65535);const p=SDPUtils.matchPrefix(l.sdp,"a=max-message-size:");return p.length>0?d=parseInt(p[0].substring(19),10):t.browser==="firefox"&&u!==-1&&(d=2147483637),d},c=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:u}=this.getConfiguration();u==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(o(arguments[0])){const u=e(arguments[0]),d=n(u),p=s(arguments[0],u);let g;d===0&&p===0?g=Number.POSITIVE_INFINITY:d===0||p===0?g=Math.max(d,p):g=Math.min(d,p);const y={};Object.defineProperty(y,"maxMessageSize",{get(){return g}}),this._sctp=y}return c.apply(this,arguments)}}function shimSendThrowTypeError(a){if(!(a.RTCPeerConnection&&"createDataChannel"in a.RTCPeerConnection.prototype))return;function t(e,n){const s=e.send;e.send=function(){const l=arguments[0],u=l.length||l.size||l.byteLength;if(e.readyState==="open"&&n.sctp&&u>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return s.apply(e,arguments)}}const o=a.RTCPeerConnection.prototype.createDataChannel;a.RTCPeerConnection.prototype.createDataChannel=function(){const n=o.apply(this,arguments);return t(n,this),n},wrapPeerConnectionEvent(a,"datachannel",e=>(t(e.channel,e.target),e))}function shimConnectionState(a){if(!a.RTCPeerConnection||"connectionState"in a.RTCPeerConnection.prototype)return;const t=a.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(o){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),o&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=o)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(o=>{const e=t[o];t[o]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=n=>{const s=n.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const c=new Event("connectionstatechange",n);s.dispatchEvent(c)}return n},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),e.apply(this,arguments)}})}function removeExtmapAllowMixed(a,t){if(!a.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const o=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=n.sdp.split(`
`).filter(c=>c.trim()!=="a=extmap-allow-mixed").join(`
`);a.RTCSessionDescription&&n instanceof a.RTCSessionDescription?arguments[0]=new a.RTCSessionDescription({type:n.type,sdp:s}):n.sdp=s}return o.apply(this,arguments)}}function shimAddIceCandidateNullOrEmpty(a,t){if(!(a.RTCPeerConnection&&a.RTCPeerConnection.prototype))return;const o=a.RTCPeerConnection.prototype.addIceCandidate;!o||o.length===0||(a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():o.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function shimParameterlessSetLocalDescription(a,t){if(!(a.RTCPeerConnection&&a.RTCPeerConnection.prototype))return;const o=a.RTCPeerConnection.prototype.setLocalDescription;!o||o.length===0||(a.RTCPeerConnection.prototype.setLocalDescription=function(){let n=arguments[0]||{};if(typeof n!="object"||n.type&&n.sdp)return o.apply(this,arguments);if(n={type:n.type,sdp:n.sdp},!n.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":n.type="offer";break;default:n.type="answer";break}return n.sdp||n.type!=="offer"&&n.type!=="answer"?o.apply(this,[n]):(n.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>o.apply(this,[c]))})}var commonShim=Object.freeze({__proto__:null,removeExtmapAllowMixed,shimAddIceCandidateNullOrEmpty,shimConnectionState,shimMaxMessageSize,shimParameterlessSetLocalDescription,shimRTCIceCandidate,shimRTCIceCandidateRelayProtocol,shimSendThrowTypeError});function adapterFactory(){let{window:a}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const o=log$1,e=detectBrowser(a),n={browserDetails:e,commonShim,extractVersion,disableLog,disableWarnings,sdp};switch(e.browser){case"chrome":if(!chromeShim||!shimPeerConnection$1||!t.shimChrome)return o("Chrome shim is not included in this adapter release."),n;if(e.version===null)return o("Chrome shim can not determine version, not shimming."),n;o("adapter.js shimming chrome."),n.browserShim=chromeShim,shimAddIceCandidateNullOrEmpty(a,e),shimParameterlessSetLocalDescription(a),shimGetUserMedia$2(a,e),shimMediaStream(a),shimPeerConnection$1(a,e),shimOnTrack$1(a),shimAddTrackRemoveTrack(a,e),shimGetSendersWithDtmf(a),shimSenderReceiverGetStats(a),fixNegotiationNeeded(a,e),shimRTCIceCandidate(a),shimRTCIceCandidateRelayProtocol(a),shimConnectionState(a),shimMaxMessageSize(a,e),shimSendThrowTypeError(a),removeExtmapAllowMixed(a,e);break;case"firefox":if(!firefoxShim||!shimPeerConnection||!t.shimFirefox)return o("Firefox shim is not included in this adapter release."),n;o("adapter.js shimming firefox."),n.browserShim=firefoxShim,shimAddIceCandidateNullOrEmpty(a,e),shimParameterlessSetLocalDescription(a),shimGetUserMedia$1(a,e),shimPeerConnection(a,e),shimOnTrack(a),shimRemoveStream(a),shimSenderGetStats(a),shimReceiverGetStats(a),shimRTCDataChannel(a),shimAddTransceiver(a),shimGetParameters(a),shimCreateOffer(a),shimCreateAnswer(a),shimRTCIceCandidate(a),shimConnectionState(a),shimMaxMessageSize(a,e),shimSendThrowTypeError(a);break;case"safari":if(!safariShim||!t.shimSafari)return o("Safari shim is not included in this adapter release."),n;o("adapter.js shimming safari."),n.browserShim=safariShim,shimAddIceCandidateNullOrEmpty(a,e),shimParameterlessSetLocalDescription(a),shimRTCIceServerUrls(a),shimCreateOfferLegacy(a),shimCallbacksAPI(a),shimLocalStreamsAPI(a),shimRemoteStreamsAPI(a),shimTrackEventTransceiver(a),shimGetUserMedia(a),shimAudioContext(a),shimRTCIceCandidate(a),shimRTCIceCandidateRelayProtocol(a),shimMaxMessageSize(a,e),shimSendThrowTypeError(a),removeExtmapAllowMixed(a,e);break;default:o("Unsupported browser!");break}return n}adapterFactory({window:typeof window>"u"?void 0:window});const DECRYPTION_FAILURE_TOLERANCE=10,E2EE_FLAG="lk_e2ee",SALT="LKFrameEncryptionKey",KEY_PROVIDER_DEFAULTS={sharedKey:!1,ratchetSalt:SALT,ratchetWindowSize:8,failureTolerance:DECRYPTION_FAILURE_TOLERANCE,keyringSize:16};var KeyProviderEvent;(function(a){a.SetKey="setKey",a.RatchetRequest="ratchetRequest",a.KeyRatcheted="keyRatcheted"})(KeyProviderEvent||(KeyProviderEvent={}));var KeyHandlerEvent;(function(a){a.KeyRatcheted="keyRatcheted"})(KeyHandlerEvent||(KeyHandlerEvent={}));var EncryptionEvent;(function(a){a.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",a.EncryptionError="encryptionError"})(EncryptionEvent||(EncryptionEvent={}));var CryptorEvent;(function(a){a.Error="cryptorError"})(CryptorEvent||(CryptorEvent={}));function isE2EESupported(){return isInsertableStreamSupported()||isScriptTransformSupported()}function isScriptTransformSupported(){return typeof window.RTCRtpScriptTransform<"u"}function isInsertableStreamSupported(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}class BaseKeyProvider extends eventsExports.EventEmitter{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(o,e)=>{livekitLogger.debug("key ratcheted event received",{material:o,keyIndex:e})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},KEY_PROVIDER_DEFAULTS),t),this.on(KeyProviderEvent.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(t,o,e){const n={key:t,participantIdentity:o,keyIndex:e};if(!this.options.sharedKey&&!o)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(o??"shared","-").concat(e??0),n),this.emit(KeyProviderEvent.SetKey,n)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(t,o){this.emit(KeyProviderEvent.RatchetRequest,t,o)}}class LivekitError extends Error{constructor(t,o){super(o||"an error has occured"),this.code=t}}class ConnectionError extends LivekitError{constructor(t,o,e){super(1,t),this.status=e,this.reason=o}}class DeviceUnsupportedError extends LivekitError{constructor(t){super(21,t??"device is unsupported")}}class TrackInvalidError extends LivekitError{constructor(t){super(20,t??"track is invalid")}}class UnsupportedServer extends LivekitError{constructor(t){super(10,t??"unsupported server")}}class UnexpectedConnectionState extends LivekitError{constructor(t){super(12,t??"unexpected connection state")}}class NegotiationError extends LivekitError{constructor(t){super(13,t??"unable to negotiate")}}class SignalRequestError extends LivekitError{constructor(t,o){super(15,t),this.reason=o}}var MediaDeviceFailure;(function(a){a.PermissionDenied="PermissionDenied",a.NotFound="NotFound",a.DeviceInUse="DeviceInUse",a.Other="Other"})(MediaDeviceFailure||(MediaDeviceFailure={}));(function(a){function t(o){if(o&&"name"in o)return o.name==="NotFoundError"||o.name==="DevicesNotFoundError"?a.NotFound:o.name==="NotAllowedError"||o.name==="PermissionDeniedError"?a.PermissionDenied:o.name==="NotReadableError"||o.name==="TrackStartError"?a.DeviceInUse:a.Other}a.getFailure=t})(MediaDeviceFailure||(MediaDeviceFailure={}));var CryptorErrorReason;(function(a){a[a.InvalidKey=0]="InvalidKey",a[a.MissingKey=1]="MissingKey",a[a.InternalError=2]="InternalError"})(CryptorErrorReason||(CryptorErrorReason={}));var RoomEvent;(function(a){a.Connected="connected",a.Reconnecting="reconnecting",a.SignalReconnecting="signalReconnecting",a.Reconnected="reconnected",a.Disconnected="disconnected",a.ConnectionStateChanged="connectionStateChanged",a.MediaDevicesChanged="mediaDevicesChanged",a.ParticipantConnected="participantConnected",a.ParticipantDisconnected="participantDisconnected",a.TrackPublished="trackPublished",a.TrackSubscribed="trackSubscribed",a.TrackSubscriptionFailed="trackSubscriptionFailed",a.TrackUnpublished="trackUnpublished",a.TrackUnsubscribed="trackUnsubscribed",a.TrackMuted="trackMuted",a.TrackUnmuted="trackUnmuted",a.LocalTrackPublished="localTrackPublished",a.LocalTrackUnpublished="localTrackUnpublished",a.LocalAudioSilenceDetected="localAudioSilenceDetected",a.ActiveSpeakersChanged="activeSpeakersChanged",a.ParticipantMetadataChanged="participantMetadataChanged",a.ParticipantNameChanged="participantNameChanged",a.ParticipantAttributesChanged="participantAttributesChanged",a.RoomMetadataChanged="roomMetadataChanged",a.DataReceived="dataReceived",a.SipDTMFReceived="sipDTMFReceived",a.TranscriptionReceived="transcriptionReceived",a.ConnectionQualityChanged="connectionQualityChanged",a.TrackStreamStateChanged="trackStreamStateChanged",a.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",a.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",a.AudioPlaybackStatusChanged="audioPlaybackChanged",a.VideoPlaybackStatusChanged="videoPlaybackChanged",a.MediaDevicesError="mediaDevicesError",a.ParticipantPermissionsChanged="participantPermissionsChanged",a.SignalConnected="signalConnected",a.RecordingStatusChanged="recordingStatusChanged",a.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",a.EncryptionError="encryptionError",a.DCBufferStatusChanged="dcBufferStatusChanged",a.ActiveDeviceChanged="activeDeviceChanged",a.LocalTrackSubscribed="localTrackSubscribed"})(RoomEvent||(RoomEvent={}));var ParticipantEvent;(function(a){a.TrackPublished="trackPublished",a.TrackSubscribed="trackSubscribed",a.TrackSubscriptionFailed="trackSubscriptionFailed",a.TrackUnpublished="trackUnpublished",a.TrackUnsubscribed="trackUnsubscribed",a.TrackMuted="trackMuted",a.TrackUnmuted="trackUnmuted",a.LocalTrackPublished="localTrackPublished",a.LocalTrackUnpublished="localTrackUnpublished",a.ParticipantMetadataChanged="participantMetadataChanged",a.ParticipantNameChanged="participantNameChanged",a.DataReceived="dataReceived",a.SipDTMFReceived="sipDTMFReceived",a.TranscriptionReceived="transcriptionReceived",a.IsSpeakingChanged="isSpeakingChanged",a.ConnectionQualityChanged="connectionQualityChanged",a.TrackStreamStateChanged="trackStreamStateChanged",a.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",a.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",a.MediaDevicesError="mediaDevicesError",a.AudioStreamAcquired="audioStreamAcquired",a.ParticipantPermissionsChanged="participantPermissionsChanged",a.PCTrackAdded="pcTrackAdded",a.AttributesChanged="attributesChanged",a.LocalTrackSubscribed="localTrackSubscribed"})(ParticipantEvent||(ParticipantEvent={}));var EngineEvent;(function(a){a.TransportsCreated="transportsCreated",a.Connected="connected",a.Disconnected="disconnected",a.Resuming="resuming",a.Resumed="resumed",a.Restarting="restarting",a.Restarted="restarted",a.SignalResumed="signalResumed",a.SignalRestarted="signalRestarted",a.Closing="closing",a.MediaTrackAdded="mediaTrackAdded",a.ActiveSpeakersUpdate="activeSpeakersUpdate",a.DataPacketReceived="dataPacketReceived",a.RTPVideoMapUpdate="rtpVideoMapUpdate",a.DCBufferStatusChanged="dcBufferStatusChanged",a.ParticipantUpdate="participantUpdate",a.RoomUpdate="roomUpdate",a.SpeakersChanged="speakersChanged",a.StreamStateChanged="streamStateChanged",a.ConnectionQualityUpdate="connectionQualityUpdate",a.SubscriptionError="subscriptionError",a.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",a.RemoteMute="remoteMute",a.SubscribedQualityUpdate="subscribedQualityUpdate",a.LocalTrackUnpublished="localTrackUnpublished",a.LocalTrackSubscribed="localTrackSubscribed",a.Offline="offline",a.SignalRequestResponse="signalRequestResponse"})(EngineEvent||(EngineEvent={}));var TrackEvent;(function(a){a.Message="message",a.Muted="muted",a.Unmuted="unmuted",a.Restarted="restarted",a.Ended="ended",a.Subscribed="subscribed",a.Unsubscribed="unsubscribed",a.UpdateSettings="updateSettings",a.UpdateSubscription="updateSubscription",a.AudioPlaybackStarted="audioPlaybackStarted",a.AudioPlaybackFailed="audioPlaybackFailed",a.AudioSilenceDetected="audioSilenceDetected",a.VisibilityChanged="visibilityChanged",a.VideoDimensionsChanged="videoDimensionsChanged",a.VideoPlaybackStarted="videoPlaybackStarted",a.VideoPlaybackFailed="videoPlaybackFailed",a.ElementAttached="elementAttached",a.ElementDetached="elementDetached",a.UpstreamPaused="upstreamPaused",a.UpstreamResumed="upstreamResumed",a.SubscriptionPermissionChanged="subscriptionPermissionChanged",a.SubscriptionStatusChanged="subscriptionStatusChanged",a.SubscriptionFailed="subscriptionFailed",a.TrackProcessorUpdate="trackProcessorUpdate",a.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",a.TranscriptionReceived="transcriptionReceived",a.TimeSyncUpdate="timeSyncUpdate"})(TrackEvent||(TrackEvent={}));function r(a,t,o){var e,n,s;t===void 0&&(t=50),o===void 0&&(o={});var c=(e=o.isImmediate)!=null&&e,l=(n=o.callback)!=null&&n,u=o.maxWait,d=Date.now(),p=[];function g(){if(u!==void 0){var T=Date.now()-d;if(T+t>=u)return u-T}return t}var y=function(){var T=[].slice.call(arguments),b=this;return new Promise(function(k,O){var C=c&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,d=Date.now(),!c){var x=a.apply(b,T);l&&l(x),p.forEach(function(U){return(0,U.resolve)(x)}),p=[]}},g()),C){var N=a.apply(b,T);return l&&l(N),k(N)}p.push({resolve:k,reject:O})})};return y.cancel=function(T){s!==void 0&&clearTimeout(s),p.forEach(function(b){return(0,b.reject)(T)}),p=[]},y}const commonVersionIdentifier=/version\/(\d+(\.?_?\d+)+)/i;let browserDetails;function getBrowser(a){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof a>"u"&&typeof navigator>"u")return;const o=(a??navigator.userAgent).toLowerCase();if(browserDetails===void 0||t){const e=browsersList.find(n=>{let{test:s}=n;return s.test(o)});browserDetails=e==null?void 0:e.describe(o)}return browserDetails}const browsersList=[{test:/firefox|iceweasel|fxios/i,describe(a){return{name:"Firefox",version:getMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,a),os:a.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:getOSVersion(a)}}},{test:/chrom|crios|crmo/i,describe(a){return{name:"Chrome",version:getMatch(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,a),os:a.toLowerCase().includes("crios")?"iOS":void 0,osVersion:getOSVersion(a)}}},{test:/safari|applewebkit/i,describe(a){return{name:"Safari",version:getMatch(commonVersionIdentifier,a),os:a.includes("mobile/")?"iOS":"macOS",osVersion:getOSVersion(a)}}}];function getMatch(a,t){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const e=t.match(a);return e&&e.length>=o&&e[o]||""}function getOSVersion(a){return a.includes("mac os")?getMatch(/\(.+?(\d+_\d+(:?_\d+)?)/,a,1).replace(/_/g,"."):void 0}var version$1="2.5.1";const version=version$1,protocolVersion=15;class CriticalTimers{}CriticalTimers.setTimeout=function(){return setTimeout(...arguments)};CriticalTimers.setInterval=function(){return setInterval(...arguments)};CriticalTimers.clearTimeout=function(){return clearTimeout(...arguments)};CriticalTimers.clearInterval=function(){return clearInterval(...arguments)};class VideoPreset{constructor(t,o,e,n,s){if(typeof t=="object")this.width=t.width,this.height=t.height,this.aspectRatio=t.aspectRatio,this.encoding={maxBitrate:t.maxBitrate,maxFramerate:t.maxFramerate,priority:t.priority};else if(o!==void 0&&e!==void 0)this.width=t,this.height=o,this.aspectRatio=t/o,this.encoding={maxBitrate:e,maxFramerate:n,priority:s};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const backupCodecs=["vp8","h264"],videoCodecs=["vp8","h264","vp9","av1"];function isBackupCodec(a){return!!backupCodecs.find(t=>t===a)}var AudioPresets;(function(a){a.telephone={maxBitrate:12e3},a.speech={maxBitrate:2e4},a.music={maxBitrate:32e3},a.musicStereo={maxBitrate:48e3},a.musicHighQuality={maxBitrate:64e3},a.musicHighQualityStereo={maxBitrate:96e3}})(AudioPresets||(AudioPresets={}));const VideoPresets={h90:new VideoPreset(160,90,9e4,20),h180:new VideoPreset(320,180,16e4,20),h216:new VideoPreset(384,216,18e4,20),h360:new VideoPreset(640,360,45e4,20),h540:new VideoPreset(960,540,8e5,25),h720:new VideoPreset(1280,720,17e5,30),h1080:new VideoPreset(1920,1080,3e6,30),h1440:new VideoPreset(2560,1440,5e6,30),h2160:new VideoPreset(3840,2160,8e6,30)},VideoPresets43={h120:new VideoPreset(160,120,7e4,20),h180:new VideoPreset(240,180,125e3,20),h240:new VideoPreset(320,240,14e4,20),h360:new VideoPreset(480,360,33e4,20),h480:new VideoPreset(640,480,5e5,20),h540:new VideoPreset(720,540,6e5,25),h720:new VideoPreset(960,720,13e5,30),h1080:new VideoPreset(1440,1080,23e5,30),h1440:new VideoPreset(1920,1440,38e5,30)},ScreenSharePresets={h360fps3:new VideoPreset(640,360,2e5,3,"medium"),h360fps15:new VideoPreset(640,360,4e5,15,"medium"),h720fps5:new VideoPreset(1280,720,8e5,5,"medium"),h720fps15:new VideoPreset(1280,720,15e5,15,"medium"),h720fps30:new VideoPreset(1280,720,2e6,30,"medium"),h1080fps15:new VideoPreset(1920,1080,25e5,15,"medium"),h1080fps30:new VideoPreset(1920,1080,5e6,30,"medium"),original:new VideoPreset(0,0,7e6,30,"medium")};function cloneDeep(a){if(!(typeof a>"u"))return typeof structuredClone=="function"?structuredClone(a):JSON.parse(JSON.stringify(a))}const BACKGROUND_REACTION_DELAY=5e3,recycledElements=[];var VideoQuality;(function(a){a[a.LOW=0]="LOW",a[a.MEDIUM=1]="MEDIUM",a[a.HIGH=2]="HIGH"})(VideoQuality||(VideoQuality={}));class Track extends eventsExports.EventEmitter{constructor(t,o){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var n;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=Track.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=livekitLogger,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),BACKGROUND_REACTION_DELAY):this.handleAppVisibilityChanged()},this.log=getLogger((n=e.loggerName)!==null&&n!==void 0?n:LoggerNames.Track),this.loggerContextCb=e.loggerContextCb,this.setMaxListeners(100),this.kind=o,this._mediaStreamTrack=t,this._mediaStreamID=t.id,this.source=Track.Source.Unknown}get logContext(){var t;return Object.assign(Object.assign({},(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this)),getLogContextFromTrack(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(t){let o="audio";this.kind===Track.Kind.Video&&(o="video"),this.attachedElements.length===0&&this.kind===Track.Kind.Video&&this.addAppVisibilityListener(),t||(o==="audio"&&(recycledElements.forEach(s=>{s.parentElement===null&&!t&&(t=s)}),t&&recycledElements.splice(recycledElements.indexOf(t),1)),t||(t=document.createElement(o))),this.attachedElements.includes(t)||this.attachedElements.push(t),attachToElement(this.mediaStreamTrack,t);const e=t.srcObject.getTracks(),n=e.some(s=>s.kind==="audio");return t.play().then(()=>{this.emit(n?TrackEvent.AudioPlaybackStarted:TrackEvent.VideoPlaybackStarted)}).catch(s=>{s.name==="NotAllowedError"?this.emit(n?TrackEvent.AudioPlaybackFailed:TrackEvent.VideoPlaybackFailed,s):s.name==="AbortError"?livekitLogger.debug("".concat(n?"audio":"video"," playback aborted, likely due to new play request")):livekitLogger.warn("could not playback ".concat(n?"audio":"video"),s),n&&t&&e.some(c=>c.kind==="video")&&s.name==="NotAllowedError"&&(t.muted=!0,t.play().catch(()=>{}))}),this.emit(TrackEvent.ElementAttached,t),t}detach(t){try{if(t){detachTrack(this.mediaStreamTrack,t);const e=this.attachedElements.indexOf(t);return e>=0&&(this.attachedElements.splice(e,1),this.recycleElement(t),this.emit(TrackEvent.ElementDetached,t)),t}const o=[];return this.attachedElements.forEach(e=>{detachTrack(this.mediaStreamTrack,e),o.push(e),this.recycleElement(e),this.emit(TrackEvent.ElementDetached,e)}),this.attachedElements=[],o}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(t){t.loggerName&&(this.log=getLogger(t.loggerName)),t.loggerContextCb&&(this.loggerContextCb=t.loggerContextCb)}recycleElement(t){if(t instanceof HTMLAudioElement){let o=!0;t.pause(),recycledElements.forEach(e=>{e.parentElement||(o=!1)}),o&&recycledElements.push(t)}}handleAppVisibilityChanged(){return __awaiter(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===Track.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(t=>t.play().catch(()=>{})),0)})}addAppVisibilityListener(){isWeb()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){isWeb()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function attachToElement(a,t){let o;t.srcObject instanceof MediaStream?o=t.srcObject:o=new MediaStream;let e;a.kind==="audio"?e=o.getAudioTracks():e=o.getVideoTracks(),e.includes(a)||(e.forEach(n=>{o.removeTrack(n)}),o.addTrack(a)),(!isSafari()||!(t instanceof HTMLVideoElement))&&(t.autoplay=!0),t.muted=o.getAudioTracks().length===0,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==o&&(t.srcObject=o,(isSafari()||isFireFox())&&t instanceof HTMLVideoElement&&setTimeout(()=>{t.srcObject=o,t.play().catch(()=>{})},0))}function detachTrack(a,t){if(t.srcObject instanceof MediaStream){const o=t.srcObject;o.removeTrack(a),o.getTracks().length>0?t.srcObject=o:t.srcObject=null}}(function(a){let t;(function(d){d.Audio="audio",d.Video="video",d.Unknown="unknown"})(t=a.Kind||(a.Kind={}));let o;(function(d){d.Camera="camera",d.Microphone="microphone",d.ScreenShare="screen_share",d.ScreenShareAudio="screen_share_audio",d.Unknown="unknown"})(o=a.Source||(a.Source={}));let e;(function(d){d.Active="active",d.Paused="paused",d.Unknown="unknown"})(e=a.StreamState||(a.StreamState={}));function n(d){switch(d){case t.Audio:return TrackType.AUDIO;case t.Video:return TrackType.VIDEO;default:return TrackType.DATA}}a.kindToProto=n;function s(d){switch(d){case TrackType.AUDIO:return t.Audio;case TrackType.VIDEO:return t.Video;default:return t.Unknown}}a.kindFromProto=s;function c(d){switch(d){case o.Camera:return TrackSource.CAMERA;case o.Microphone:return TrackSource.MICROPHONE;case o.ScreenShare:return TrackSource.SCREEN_SHARE;case o.ScreenShareAudio:return TrackSource.SCREEN_SHARE_AUDIO;default:return TrackSource.UNKNOWN}}a.sourceToProto=c;function l(d){switch(d){case TrackSource.CAMERA:return o.Camera;case TrackSource.MICROPHONE:return o.Microphone;case TrackSource.SCREEN_SHARE:return o.ScreenShare;case TrackSource.SCREEN_SHARE_AUDIO:return o.ScreenShareAudio;default:return o.Unknown}}a.sourceFromProto=l;function u(d){switch(d){case StreamState.ACTIVE:return e.Active;case StreamState.PAUSED:return e.Paused;default:return e.Unknown}}a.streamStateFromProto=u})(Track||(Track={}));function mergeDefaultOptions(a,t,o){var e;const n=(e=cloneDeep(a))!==null&&e!==void 0?e:{};return n.audio===!0&&(n.audio={}),n.video===!0&&(n.video={}),n.audio&&mergeObjectWithoutOverwriting(n.audio,t),n.video&&mergeObjectWithoutOverwriting(n.video,o),n}function mergeObjectWithoutOverwriting(a,t){return Object.keys(t).forEach(o=>{a[o]===void 0&&(a[o]=t[o])}),a}function constraintsForOptions(a){const t={};if(a.video)if(typeof a.video=="object"){const o={},e=o,n=a.video;Object.keys(n).forEach(s=>{switch(s){case"resolution":mergeObjectWithoutOverwriting(e,n.resolution);break;default:e[s]=n[s]}}),t.video=o}else t.video=a.video;else t.video=!1;return a.audio?typeof a.audio=="object"?t.audio=a.audio:t.audio=!0:t.audio=!1,t}function detectSilence(a){return __awaiter(this,arguments,void 0,function(t){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const e=getNewAudioContext();if(e){const n=e.createAnalyser();n.fftSize=2048;const s=n.frequencyBinCount,c=new Uint8Array(s);e.createMediaStreamSource(new MediaStream([t.mediaStreamTrack])).connect(n),yield sleep(o),n.getByteTimeDomainData(c);const u=c.some(d=>d!==128&&d!==0);return e.close(),!u}return!1}()})}function getNewAudioContext(){const a=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(a)return new a({latencyHint:"interactive"})}function sourceToKind(a){return a===Track.Source.Microphone?"audioinput":a===Track.Source.Camera?"videoinput":void 0}function screenCaptureToDisplayMediaStreamOptions(a){var t,o;let e=(t=a.video)!==null&&t!==void 0?t:!0;return a.resolution&&a.resolution.width>0&&a.resolution.height>0&&(e=typeof e=="boolean"?{}:e,isSafari()?e=Object.assign(Object.assign({},e),{width:{max:a.resolution.width},height:{max:a.resolution.height},frameRate:a.resolution.frameRate}):e=Object.assign(Object.assign({},e),{width:{ideal:a.resolution.width},height:{ideal:a.resolution.height},frameRate:a.resolution.frameRate})),{audio:(o=a.audio)!==null&&o!==void 0?o:!1,video:e,controller:a.controller,selfBrowserSurface:a.selfBrowserSurface,surfaceSwitching:a.surfaceSwitching,systemAudio:a.systemAudio,preferCurrentTab:a.preferCurrentTab}}function mimeTypeToVideoCodecString(a){const t=a.split("/")[1].toLowerCase();if(!videoCodecs.includes(t))throw Error("Video codec not supported: ".concat(t));return t}function getTrackPublicationInfo(a){const t=[];return a.forEach(o=>{o.track!==void 0&&t.push(new TrackPublishedResponse({cid:o.track.mediaStreamID,track:o.trackInfo}))}),t}function getLogContextFromTrack(a){return a instanceof Track?{trackID:a.sid,source:a.source,muted:a.isMuted,enabled:a.mediaStreamTrack.enabled,kind:a.kind,streamID:a.mediaStreamID,streamTrackID:a.mediaStreamTrack.id}:{trackID:a.trackSid,enabled:a.isEnabled,muted:a.isMuted,trackInfo:Object.assign({mimeType:a.mimeType,name:a.trackName,encrypted:a.isEncrypted,kind:a.kind,source:a.source},a.track?getLogContextFromTrack(a.track):{})}}function supportsSynchronizationSources(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function diffAttributes(a,t){var o;a===void 0&&(a={}),t===void 0&&(t={});const e=[...Object.keys(t),...Object.keys(a)],n={};for(const s of e)a[s]!==t[s]&&(n[s]=(o=t[s])!==null&&o!==void 0?o:"");return n}const separator="|",ddExtensionURI="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function unpackStreamId(a){const t=a.split(separator);return t.length>1?[t[0],a.substr(t[0].length+1)]:[a,""]}function sleep(a){return __awaiter(this,void 0,void 0,function*(){return new Promise(t=>CriticalTimers.setTimeout(t,a))})}function supportsTransceiver(){return"addTransceiver"in RTCPeerConnection.prototype}function supportsAddTrack(){return"addTrack"in RTCPeerConnection.prototype}function supportsAV1(){if(!("getCapabilities"in RTCRtpSender)||isSafari())return!1;const a=RTCRtpSender.getCapabilities("video");let t=!1;if(a){for(const o of a.codecs)if(o.mimeType==="video/AV1"){t=!0;break}}return t}function supportsVP9(){if(!("getCapabilities"in RTCRtpSender)||isFireFox())return!1;if(isSafari()){const o=getBrowser();if(o!=null&&o.version&&compareVersions(o.version,"16")<0)return!1}const a=RTCRtpSender.getCapabilities("video");let t=!1;if(a){for(const o of a.codecs)if(o.mimeType==="video/VP9"){t=!0;break}}return t}function isSVCCodec(a){return a==="av1"||a==="vp9"}function supportsSetSinkId(a){return document?(a||(a=document.createElement("audio")),"setSinkId"in a):!1}function isBrowserSupported(){return typeof RTCPeerConnection>"u"?!1:supportsTransceiver()||supportsAddTrack()}function isFireFox(){var a;return((a=getBrowser())===null||a===void 0?void 0:a.name)==="Firefox"}function isSafari(){var a;return((a=getBrowser())===null||a===void 0?void 0:a.name)==="Safari"}function isSafari17(){const a=getBrowser();return(a==null?void 0:a.name)==="Safari"&&a.version.startsWith("17.")}function isMobile(){var a,t;return isWeb()?(t=(a=navigator.userAgentData)===null||a===void 0?void 0:a.mobile)!==null&&t!==void 0?t:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function isE2EESimulcastSupported(){const a=getBrowser(),t="17.2";if(a)return a.name!=="Safari"&&a.os!=="iOS"||a.os==="iOS"&&a.osVersion&&compareVersions(t,a.osVersion)>=0?!0:a.name==="Safari"&&compareVersions(t,a.version)>=0}function isWeb(){return typeof document<"u"}function isReactNative(){return navigator.product=="ReactNative"}function isCloud(a){return a.hostname.endsWith(".livekit.cloud")||a.hostname.endsWith(".livekit.run")}function getLKReactNativeInfo(){if(dist.global&&dist.global.LiveKitReactNativeGlobal)return dist.global.LiveKitReactNativeGlobal}function getReactNativeOs(){if(!isReactNative())return;let a=getLKReactNativeInfo();if(a)return a.platform}function getDevicePixelRatio(){if(isWeb())return window.devicePixelRatio;if(isReactNative()){let a=getLKReactNativeInfo();if(a)return a.devicePixelRatio}return 1}function compareVersions(a,t){const o=a.split("."),e=t.split("."),n=Math.min(o.length,e.length);for(let s=0;s<n;++s){const c=parseInt(o[s],10),l=parseInt(e[s],10);if(c>l)return 1;if(c<l)return-1;if(s===n-1&&c===l)return 0}return a===""&&t!==""?-1:t===""?1:o.length==e.length?0:o.length<e.length?-1:1}function roDispatchCallback(a){for(const t of a)t.target.handleResize(t)}function ioDispatchCallback(a){for(const t of a)t.target.handleVisibilityChanged(t)}let resizeObserver=null;const getResizeObserver=()=>(resizeObserver||(resizeObserver=new ResizeObserver(roDispatchCallback)),resizeObserver);let intersectionObserver=null;const getIntersectionObserver=()=>(intersectionObserver||(intersectionObserver=new IntersectionObserver(ioDispatchCallback,{root:null,rootMargin:"0px"})),intersectionObserver);function getClientInfo(){var a;const t=new ClientInfo({sdk:ClientInfo_SDK.JS,protocol:protocolVersion,version});return isReactNative()&&(t.os=(a=getReactNativeOs())!==null&&a!==void 0?a:""),t}function createDummyVideoStreamTrack(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,e=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const n=document.createElement("canvas");n.width=a,n.height=t;const s=n.getContext("2d");s==null||s.fillRect(0,0,n.width,n.height),e&&s&&(s.beginPath(),s.arc(a/2,t/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const c=n.captureStream(),[l]=c.getTracks();if(!l)throw Error("Could not get empty media stream video track");return l.enabled=o,l}let emptyAudioStreamTrack;function getEmptyAudioStreamTrack(){if(!emptyAudioStreamTrack){const a=new AudioContext,t=a.createOscillator(),o=a.createGain();o.gain.setValueAtTime(0,0);const e=a.createMediaStreamDestination();if(t.connect(o),o.connect(e),t.start(),[emptyAudioStreamTrack]=e.stream.getAudioTracks(),!emptyAudioStreamTrack)throw Error("Could not get empty media stream audio track");emptyAudioStreamTrack.enabled=!1}return emptyAudioStreamTrack.clone()}class Future{constructor(t,o){this.onFinally=o,this.promise=new Promise((e,n)=>__awaiter(this,void 0,void 0,function*(){this.resolve=e,this.reject=n,t&&(yield t(e,n))})).finally(()=>{var e;return(e=this.onFinally)===null||e===void 0?void 0:e.call(this)})}}class Mutex{constructor(){this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let t;const o=new Promise(n=>t=()=>{this._locks-=1,n()}),e=this._locking.then(()=>t);return this._locking=this._locking.then(()=>o),e}}function isVideoCodec(a){return videoCodecs.includes(a)}function unwrapConstraint(a){if(typeof a=="string"||typeof a=="number")return a;if(Array.isArray(a))return a[0];if(a.exact)return Array.isArray(a.exact)?a.exact[0]:a.exact;if(a.ideal)return Array.isArray(a.ideal)?a.ideal[0]:a.ideal;throw Error("could not unwrap constraint")}function toWebsocketUrl(a){return a.startsWith("http")?a.replace(/^(http)/,"ws"):a}function toHttpUrl(a){return a.startsWith("ws")?a.replace(/^(ws)/,"http"):a}function extractTranscriptionSegments(a,t){return a.segments.map(o=>{let{id:e,text:n,language:s,startTime:c,endTime:l,final:u}=o;var d;const p=(d=t.get(e))!==null&&d!==void 0?d:Date.now(),g=Date.now();return u?t.delete(e):t.set(e,p),{id:e,text:n,startTime:Number.parseInt(c.toString()),endTime:Number.parseInt(l.toString()),final:u,language:s,firstReceivedTime:p,lastReceivedTime:g}})}const defaultId="default";class DeviceManager{static getInstance(){return this.instance===void 0&&(this.instance=new DeviceManager),this.instance}getDevices(t){return __awaiter(this,arguments,void 0,function(o){var e=this;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;if(((s=DeviceManager.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){livekitLogger.debug("awaiting getUserMedia promise");try{o?yield DeviceManager.userMediaPromiseMap.get(o):yield Promise.all(DeviceManager.userMediaPromiseMap.values())}catch{livekitLogger.warn("error waiting for media permissons")}}let c=yield navigator.mediaDevices.enumerateDevices();if(n&&!(isSafari()&&e.hasDeviceInUse(o))&&(c.filter(u=>u.kind===o).length===0||c.some(u=>{const d=u.label==="",p=o?u.kind===o:!0;return d&&p}))){const u={video:o!=="audioinput"&&o!=="audiooutput",audio:o!=="videoinput"},d=yield navigator.mediaDevices.getUserMedia(u);c=yield navigator.mediaDevices.enumerateDevices(),d.getTracks().forEach(p=>{p.stop()})}return o&&(c=c.filter(l=>l.kind===o)),c}()})}normalizeDeviceId(t,o,e){return __awaiter(this,void 0,void 0,function*(){if(o!==defaultId)return o;const n=yield this.getDevices(t),s=n.find(l=>l.deviceId===defaultId);if(!s){livekitLogger.warn("could not reliably determine default device");return}const c=n.find(l=>l.deviceId!==defaultId&&l.groupId===(e??s.groupId));if(!c){livekitLogger.warn("could not reliably determine default device");return}return c==null?void 0:c.deviceId})}hasDeviceInUse(t){return t?DeviceManager.userMediaPromiseMap.has(t):DeviceManager.userMediaPromiseMap.size>0}}DeviceManager.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];DeviceManager.userMediaPromiseMap=new Map;const defaultDimensionsTimeout=1e3;class LocalTrack extends Track{get sender(){return this._sender}set sender(t){this._sender=t}get constraints(){return this._constraints}constructor(t,o,e){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0;super(t,o,s),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=r(()=>__awaiter(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>__awaiter(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(TrackEvent.Ended,this)},this.reacquireTrack=!1,this.providedByUser=n,this.muteLock=new Mutex,this.pauseUpstreamLock=new Mutex,this.processorLock=new Mutex,this.restartLock=new Mutex,this.setMediaStreamTrack(t,!0),this._constraints=t.getConstraints(),e&&(this._constraints=e)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==Track.Kind.Video)return;const{width:t,height:o}=this._mediaStreamTrack.getSettings();if(t&&o)return{width:t,height:o}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var t,o;return(o=(t=this.processor)===null||t===void 0?void 0:t.processedTrack)!==null&&o!==void 0?o:this._mediaStreamTrack}setMediaStreamTrack(t,o){return __awaiter(this,void 0,void 0,function*(){if(t===this._mediaStreamTrack&&!o)return;this._mediaStreamTrack&&(this.attachedElements.forEach(n=>{detachTrack(this._mediaStreamTrack,n)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([t]),t&&(t.addEventListener("ended",this.handleEnded),t.addEventListener("mute",this.handleTrackMuteEvent),t.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=t.getConstraints());let e;if(this.processor&&t){const n=yield this.processorLock.lock();try{if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(attachToElement(t,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:t,kind:this.kind,element:this.processorElement}),e=this.processor.processedTrack}finally{n()}}this.sender&&(yield this.sender.replaceTrack(e??t)),!this.providedByUser&&this._mediaStreamTrack!==t&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=t,t&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(n=>{attachToElement(e??t,n)}))})}waitForDimensions(){return __awaiter(this,arguments,void 0,function(){var t=this;let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:defaultDimensionsTimeout;return function*(){var e;if(t.kind===Track.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((e=getBrowser())===null||e===void 0?void 0:e.os)==="iOS"&&(yield sleep(10));const n=Date.now();for(;Date.now()-n<o;){const s=t.dimensions;if(s)return s;yield sleep(50)}throw new TrackInvalidError("unable to get track dimensions after timeout")}()})}getDeviceId(){return __awaiter(this,void 0,void 0,function*(){if(this.source===Track.Source.ScreenShare)return;const{deviceId:t,groupId:o}=this._mediaStreamTrack.getSettings(),e=this.kind===Track.Kind.Audio?"audioinput":"videoinput";return DeviceManager.getInstance().normalizeDeviceId(e,t,o)})}mute(){return __awaiter(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return __awaiter(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(t,o){return __awaiter(this,void 0,void 0,function*(){if(!this.sender)throw new TrackInvalidError("unable to replace an unpublished track");let e,n;return typeof o=="boolean"?e=o:o!==void 0&&(e=o.userProvidedTrack,n=o.stopProcessor),this.providedByUser=e??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(t),n&&this.processor&&(yield this.stopProcessor()),this})}restart(t){return __awaiter(this,void 0,void 0,function*(){this.manuallyStopped=!1;const o=yield this.restartLock.lock();try{t||(t=this._constraints),this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:t}));const e={audio:!1,video:!1};this.kind===Track.Kind.Video?e.video=t:e.audio=t,this.attachedElements.forEach(c=>{detachTrack(this.mediaStreamTrack,c)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const s=(yield navigator.mediaDevices.getUserMedia(e)).getTracks()[0];return s.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(s),this._constraints=t,this.emit(TrackEvent.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{o()}})}setTrackMuted(t){this.log.debug("setting ".concat(this.kind," track ").concat(t?"muted":"unmuted"),this.logContext),!(this.isMuted===t&&this._mediaStreamTrack.enabled!==t)&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?TrackEvent.Muted:TrackEvent.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return __awaiter(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),isMobile()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var t;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(t=this.processor)===null||t===void 0||t.destroy(),this.processor=void 0}pauseUpstream(){return __awaiter(this,void 0,void 0,function*(){const t=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(TrackEvent.UpstreamPaused,this);const o=getBrowser();if((o==null?void 0:o.name)==="Safari"&&compareVersions(o.version,"12.0")<0)throw new DeviceUnsupportedError("pauseUpstream is not supported on Safari < 12.");yield this.sender.replaceTrack(null)}finally{t()}})}resumeUpstream(){return __awaiter(this,void 0,void 0,function*(){const t=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(TrackEvent.UpstreamResumed,this),yield this.sender.replaceTrack(this.mediaStreamTrack)}finally{t()}})}getRTCStatsReport(){return __awaiter(this,void 0,void 0,function*(){var t;return!((t=this.sender)===null||t===void 0)&&t.getStats?yield this.sender.getStats():void 0})}setProcessor(t){return __awaiter(this,arguments,void 0,function(o){var e=this;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;const c=yield e.processorLock.lock();try{e.log.debug("setting up processor",e.logContext);const l=document.createElement(e.kind),u={kind:e.kind,track:e._mediaStreamTrack,element:l,audioContext:e.audioContext};if(yield o.init(u),e.log.debug("processor initialized",e.logContext),e.processor&&(yield e.stopProcessor()),e.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(attachToElement(e._mediaStreamTrack,l),l.muted=!0,l.play().catch(d=>e.log.error("failed to play processor element",Object.assign(Object.assign({},e.logContext),{error:d}))),e.processor=o,e.processorElement=l,e.processor.processedTrack){for(const d of e.attachedElements)d!==e.processorElement&&n&&(detachTrack(e._mediaStreamTrack,d),attachToElement(e.processor.processedTrack,d));yield(s=e.sender)===null||s===void 0?void 0:s.replaceTrack(e.processor.processedTrack)}e.emit(TrackEvent.TrackProcessorUpdate,e.processor)}finally{c()}}()})}getProcessor(){return this.processor}stopProcessor(){return __awaiter(this,arguments,void 0,function(){var t=this;let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var e,n;t.processor&&(t.log.debug("stopping processor",t.logContext),(e=t.processor.processedTrack)===null||e===void 0||e.stop(),yield t.processor.destroy(),t.processor=void 0,o||((n=t.processorElement)===null||n===void 0||n.remove(),t.processorElement=void 0),yield t._mediaStreamTrack.applyConstraints(t._constraints),yield t.setMediaStreamTrack(t._mediaStreamTrack,!0),t.emit(TrackEvent.TrackProcessorUpdate))}()})}}class E2EEManager extends eventsExports.EventEmitter{constructor(t){super(),this.onWorkerMessage=o=>{var e,n;const{kind:s,data:c}=o.data;switch(s){case"error":livekitLogger.error(c.error.message),this.emit(EncryptionEvent.EncryptionError,c.error);break;case"initAck":c.enabled&&this.keyProvider.getKeys().forEach(l=>{this.postKey(l)});break;case"enable":if(this.encryptionEnabled!==c.enabled&&c.participantIdentity===((e=this.room)===null||e===void 0?void 0:e.localParticipant.identity))this.emit(EncryptionEvent.ParticipantEncryptionStatusChanged,c.enabled,this.room.localParticipant),this.encryptionEnabled=c.enabled;else if(c.participantIdentity){const l=(n=this.room)===null||n===void 0?void 0:n.getParticipantByIdentity(c.participantIdentity);if(!l)throw TypeError("couldn't set encryption status, participant not found".concat(c.participantIdentity));this.emit(EncryptionEvent.ParticipantEncryptionStatusChanged,c.enabled,l)}this.encryptionEnabled&&this.keyProvider.getKeys().forEach(l=>{this.postKey(l)});break;case"ratchetKey":this.keyProvider.emit(KeyProviderEvent.KeyRatcheted,c.material,c.keyIndex);break}},this.onWorkerError=o=>{livekitLogger.error("e2ee worker encountered an error:",{error:o.error}),this.emit(EncryptionEvent.EncryptionError,o.error)},this.keyProvider=t.keyProvider,this.worker=t.worker,this.encryptionEnabled=!1}setup(t){if(!isE2EESupported())throw new DeviceUnsupportedError("tried to setup end-to-end encryption on an unsupported browser");if(livekitLogger.info("setting up e2ee"),t!==this.room){this.room=t,this.setupEventListeners(t,this.keyProvider);const o={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:workerLogger.getLevel()}};this.worker&&(livekitLogger.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(o))}}setParticipantCryptorEnabled(t,o){livekitLogger.debug("set e2ee to ".concat(t," for participant ").concat(o)),this.postEnable(t,o)}setSifTrailer(t){!t||t.length===0?livekitLogger.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(t)}setupEngine(t){t.on(EngineEvent.RTPVideoMapUpdate,o=>{this.postRTPMap(o)})}setupEventListeners(t,o){t.on(RoomEvent.TrackPublished,(e,n)=>this.setParticipantCryptorEnabled(e.trackInfo.encryption!==Encryption_Type.NONE,n.identity)),t.on(RoomEvent.ConnectionStateChanged,e=>{e===ConnectionState.Connected&&t.remoteParticipants.forEach(n=>{n.trackPublications.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==Encryption_Type.NONE,n.identity)})})}).on(RoomEvent.TrackUnsubscribed,(e,n,s)=>{var c;const l={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:e.mediaStreamID}};(c=this.worker)===null||c===void 0||c.postMessage(l)}).on(RoomEvent.TrackSubscribed,(e,n,s)=>{this.setupE2EEReceiver(e,s.identity,n.trackInfo)}).on(RoomEvent.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity),o.getKeys().forEach(e=>{this.postKey(e)})}),t.localParticipant.on(ParticipantEvent.LocalTrackPublished,e=>__awaiter(this,void 0,void 0,function*(){this.setupE2EESender(e.track,e.track.sender)})),o.on(KeyProviderEvent.SetKey,e=>this.postKey(e)).on(KeyProviderEvent.RatchetRequest,(e,n)=>this.postRatchetRequest(e,n))}postRatchetRequest(t,o){if(!this.worker)throw Error("could not ratchet key, worker is missing");const e={kind:"ratchetRequest",data:{participantIdentity:t,keyIndex:o}};this.worker.postMessage(e)}postKey(t){let{key:o,participantIdentity:e,keyIndex:n}=t;var s;if(!this.worker)throw Error("could not set key, worker is missing");const c={kind:"setKey",data:{participantIdentity:e,isPublisher:e===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:o,keyIndex:n}};this.worker.postMessage(c)}postEnable(t,o){if(this.worker){const e={kind:"enable",data:{enabled:t,participantIdentity:o}};this.worker.postMessage(e)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(t){var o;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((o=this.room)===null||o===void 0)&&o.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const e={kind:"setRTPMap",data:{map:t,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(e)}postSifTrailer(t){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const o={kind:"setSifTrailer",data:{trailer:t}};this.worker.postMessage(o)}setupE2EEReceiver(t,o,e){if(t.receiver){if(!(e!=null&&e.mimeType)||e.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(t.receiver,t.mediaStreamID,o,t.kind==="video"?mimeTypeToVideoCodecString(e.mimeType):void 0)}}setupE2EESender(t,o){if(!(t instanceof LocalTrack)||!o){o||livekitLogger.warn("early return because sender is not ready");return}this.handleSender(o,t.mediaStreamID,void 0)}handleReceiver(t,o,e,n){return __awaiter(this,void 0,void 0,function*(){if(this.worker){if(isScriptTransformSupported()){const s={kind:"decode",participantIdentity:e,trackId:o,codec:n};t.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(E2EE_FLAG in t&&n){const u={kind:"updateCodec",data:{trackId:o,codec:n,participantIdentity:e}};this.worker.postMessage(u);return}let s=t.writableStream,c=t.readableStream;if(!s||!c){const u=t.createEncodedStreams();t.writableStream=u.writable,s=u.writable,t.readableStream=u.readable,c=u.readable}const l={kind:"decode",data:{readableStream:c,writableStream:s,trackId:o,codec:n,participantIdentity:e}};this.worker.postMessage(l,[c,s])}t[E2EE_FLAG]=!0}})}handleSender(t,o,e){var n;if(!(E2EE_FLAG in t||!this.worker)){if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(isScriptTransformSupported()){livekitLogger.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:o,codec:e};t.transform=new RTCRtpScriptTransform(this.worker,s)}else{livekitLogger.info("initialize encoded streams");const s=t.createEncodedStreams(),c={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:e,trackId:o,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(c,[s.readable,s.writable])}t[E2EE_FLAG]=!0}}}var QueueTaskStatus;(function(a){a[a.WAITING=0]="WAITING",a[a.RUNNING=1]="RUNNING",a[a.COMPLETED=2]="COMPLETED"})(QueueTaskStatus||(QueueTaskStatus={}));class AsyncQueue{constructor(){this.pendingTasks=new Map,this.taskMutex=new Mutex,this.nextTaskIndex=0}run(t){return __awaiter(this,void 0,void 0,function*(){const o={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:QueueTaskStatus.WAITING};this.pendingTasks.set(o.id,o);const e=yield this.taskMutex.lock();try{return o.executedAt=Date.now(),o.status=QueueTaskStatus.RUNNING,yield t()}finally{o.status=QueueTaskStatus.COMPLETED,this.pendingTasks.delete(o.id),e()}})}flush(){return __awaiter(this,void 0,void 0,function*(){return this.run(()=>__awaiter(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}const passThroughQueueSignals=["syncState","trickle","offer","answer","simulate","leave"];function canPassThroughQueue(a){const t=passThroughQueueSignals.indexOf(a.case)>=0;return livekitLogger.trace("request allowed to bypass queue:",{canPass:t,req:a}),t}var SignalConnectionState;(function(a){a[a.CONNECTING=0]="CONNECTING",a[a.CONNECTED=1]="CONNECTED",a[a.RECONNECTING=2]="RECONNECTING",a[a.DISCONNECTING=3]="DISCONNECTING",a[a.DISCONNECTED=4]="DISCONNECTED"})(SignalConnectionState||(SignalConnectionState={}));class SignalClient{get currentState(){return this.state}get isDisconnected(){return this.state===SignalConnectionState.DISCONNECTING||this.state===SignalConnectionState.DISCONNECTED}get isEstablishingConnection(){return this.state===SignalConnectionState.CONNECTING||this.state===SignalConnectionState.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var e;this.rtt=0,this.state=SignalConnectionState.DISCONNECTED,this.log=livekitLogger,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=getLogger((e=o.loggerName)!==null&&e!==void 0?e:LoggerNames.Signal),this.loggerContextCb=o.loggerContextCb,this.useJSON=t,this.requestQueue=new AsyncQueue,this.queuedRequests=[],this.closingLock=new Mutex,this.connectionLock=new Mutex,this.state=SignalConnectionState.DISCONNECTED}get logContext(){var t,o;return(o=(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this))!==null&&o!==void 0?o:{}}join(t,o,e,n){return __awaiter(this,void 0,void 0,function*(){return this.state=SignalConnectionState.CONNECTING,this.options=e,yield this.connect(t,o,e,n)})}reconnect(t,o,e,n){return __awaiter(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=SignalConnectionState.RECONNECTING,this.clearPingInterval(),yield this.connect(t,o,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:e,reconnectReason:n}))})}connect(t,o,e,n){this.connectOptions=e,t=toWebsocketUrl(t),t=t.replace(/\/$/,""),t+="/rtc";const s=getClientInfo(),c=createConnectionParams(o,s,e);return new Promise((l,u)=>__awaiter(this,void 0,void 0,function*(){const d=yield this.connectionLock.lock();try{const p=()=>__awaiter(this,void 0,void 0,function*(){this.close(),clearTimeout(g),u(new ConnectionError("room connection has been cancelled (signal)"))}),g=setTimeout(()=>{this.close(),u(new ConnectionError("room connection has timed out (signal)"))},e.websocketTimeout);n!=null&&n.aborted&&p(),n==null||n.addEventListener("abort",p),this.log.debug("connecting to ".concat(t+c),this.logContext),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(t+c),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(g)},this.ws.onerror=y=>__awaiter(this,void 0,void 0,function*(){if(this.state!==SignalConnectionState.CONNECTED){this.state=SignalConnectionState.DISCONNECTED,clearTimeout(g);try{const T=yield fetch("http".concat(t.substring(2),"/validate").concat(c));if(T.status.toFixed(0).startsWith("4")){const b=yield T.text();u(new ConnectionError(b,0,T.status))}else u(new ConnectionError("Internal error",2,T.status))}catch{u(new ConnectionError("server was not reachable",1))}return}this.handleWSError(y)}),this.ws.onmessage=y=>__awaiter(this,void 0,void 0,function*(){var T,b,k;let O;if(typeof y.data=="string"){const C=JSON.parse(y.data);O=SignalResponse.fromJson(C,{ignoreUnknownFields:!0})}else if(y.data instanceof ArrayBuffer)O=SignalResponse.fromBinary(new Uint8Array(y.data));else{this.log.error("could not decode websocket message: ".concat(typeof y.data),this.logContext);return}if(this.state!==SignalConnectionState.CONNECTED){let C=!1;if(((T=O.message)===null||T===void 0?void 0:T.case)==="join"?(this.state=SignalConnectionState.CONNECTED,n==null||n.removeEventListener("abort",p),this.pingTimeoutDuration=O.message.value.pingTimeout,this.pingIntervalDuration=O.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),l(O.message.value)):this.state===SignalConnectionState.RECONNECTING&&O.message.case!=="leave"?(this.state=SignalConnectionState.CONNECTED,n==null||n.removeEventListener("abort",p),this.startPingInterval(),((b=O.message)===null||b===void 0?void 0:b.case)==="reconnect"?l(O.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),l(void 0),C=!0)):this.isEstablishingConnection&&O.message.case==="leave"?u(new ConnectionError("Received leave request while trying to (re)connect",4)):e.reconnect||u(new ConnectionError("did not receive join response, got ".concat((k=O.message)===null||k===void 0?void 0:k.case," instead"))),!C)return}this.signalLatency&&(yield sleep(this.signalLatency)),this.handleSignalResponse(O)}),this.ws.onclose=y=>{this.isEstablishingConnection&&u(new ConnectionError("Websocket got closed during a (re)connection attempt")),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:y.reason,code:y.code,wasClean:y.wasClean,state:this.state})),this.handleOnClose(y.reason)}}finally{d()}}))}close(){return __awaiter(this,arguments,void 0,function(){var t=this;let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const e=yield t.closingLock.lock();try{if(t.clearPingInterval(),o&&(t.state=SignalConnectionState.DISCONNECTING),t.ws){t.ws.onmessage=null,t.ws.onopen=null,t.ws.onclose=null;const n=new Promise(s=>{t.ws?t.ws.onclose=()=>{s()}:s()});t.ws.readyState<t.ws.CLOSING&&(t.ws.close(),yield Promise.race([n,sleep(250)])),t.ws=void 0}}finally{o&&(t.state=SignalConnectionState.DISCONNECTED),e()}}()})}sendOffer(t){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:t.sdp})),this.sendRequest({case:"offer",value:toProtoSessionDescription(t)})}sendAnswer(t){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:t.sdp})),this.sendRequest({case:"answer",value:toProtoSessionDescription(t)})}sendIceCandidate(t,o){return this.log.trace("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:t})),this.sendRequest({case:"trickle",value:new TrickleRequest({candidateInit:JSON.stringify(t),target:o})})}sendMuteTrack(t,o){return this.sendRequest({case:"mute",value:new MuteTrackRequest({sid:t,muted:o})})}sendAddTrack(t){return this.sendRequest({case:"addTrack",value:t})}sendUpdateLocalMetadata(t,o){return __awaiter(this,arguments,void 0,function(e,n){var s=this;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const l=s.getNextRequestId();return yield s.sendRequest({case:"updateMetadata",value:new UpdateParticipantMetadata({requestId:l,metadata:e,name:n,attributes:c})}),l}()})}sendUpdateTrackSettings(t){this.sendRequest({case:"trackSetting",value:t})}sendUpdateSubscription(t){return this.sendRequest({case:"subscription",value:t})}sendSyncState(t){return this.sendRequest({case:"syncState",value:t})}sendUpdateVideoLayers(t,o){return this.sendRequest({case:"updateLayers",value:new UpdateVideoLayers({trackSid:t,layers:o})})}sendUpdateSubscriptionPermissions(t,o){return this.sendRequest({case:"subscriptionPermission",value:new SubscriptionPermission({allParticipants:t,trackPermissions:o})})}sendSimulateScenario(t){return this.sendRequest({case:"simulate",value:t})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:protoInt64.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Ping({timestamp:protoInt64.parse(Date.now()),rtt:protoInt64.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(t,o){return this.sendRequest({case:"updateAudioTrack",value:new UpdateLocalAudioTrack({trackSid:t,features:o})})}sendLeave(){return this.sendRequest({case:"leave",value:new LeaveRequest({reason:DisconnectReason.CLIENT_INITIATED,action:LeaveRequest_Action.DISCONNECT})})}sendRequest(t){return __awaiter(this,arguments,void 0,function(o){var e=this;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!n&&!canPassThroughQueue(o)&&e.state===SignalConnectionState.RECONNECTING){e.queuedRequests.push(()=>__awaiter(e,void 0,void 0,function*(){yield this.sendRequest(o,!0)}));return}if(n||(yield e.requestQueue.flush()),e.signalLatency&&(yield sleep(e.signalLatency)),!e.ws||e.ws.readyState!==e.ws.OPEN){e.log.error("cannot send signal request before connected, type: ".concat(o==null?void 0:o.case),e.logContext);return}const c=new SignalRequest({message:o});try{e.useJSON?e.ws.send(c.toJsonString()):e.ws.send(c.toBinary())}catch(l){e.log.error("error sending signal message",Object.assign(Object.assign({},e.logContext),{error:l}))}}()})}handleSignalResponse(t){var o,e;const n=t.message;if(n==null){this.log.debug("received unsupported message",this.logContext);return}let s=!1;if(n.case==="answer"){const c=fromProtoSessionDescription(n.value);this.onAnswer&&this.onAnswer(c)}else if(n.case==="offer"){const c=fromProtoSessionDescription(n.value);this.onOffer&&this.onOffer(c)}else if(n.case==="trickle"){const c=JSON.parse(n.value.candidateInit);this.onTrickle&&this.onTrickle(c,n.value.target)}else n.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((o=n.value.participants)!==null&&o!==void 0?o:[]):n.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(n.value):n.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((e=n.value.speakers)!==null&&e!==void 0?e:[]):n.case==="leave"?this.onLeave&&this.onLeave(n.value):n.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(n.value.sid,n.value.muted):n.case==="roomUpdate"?this.onRoomUpdate&&n.value.room&&this.onRoomUpdate(n.value.room):n.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(n.value):n.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(n.value):n.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(n.value):n.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(n.value):n.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(n.value):n.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(n.value):n.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(n.value):n.case==="pong"||(n.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(n.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):n.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(n.value):n.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(n.value.trackSid):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:n.case})));s||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const t=this.queuedRequests.shift();t&&this.requestQueue.run(t)}}handleOnClose(t){return __awaiter(this,void 0,void 0,function*(){if(this.state===SignalConnectionState.DISCONNECTED)return;const o=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(t),Object.assign(Object.assign({},this.logContext),{reason:t})),o&&o(t)})}handleWSError(t){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:t}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=CriticalTimers.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&CriticalTimers.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=CriticalTimers.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&CriticalTimers.clearInterval(this.pingInterval)}}function fromProtoSessionDescription(a){const t={type:"offer",sdp:a.sdp};switch(a.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=a.type;break}return t}function toProtoSessionDescription(a){return new SessionDescription({sdp:a.sdp,type:a.type})}function createConnectionParams(a,t,o){var e;const n=new URLSearchParams;return n.set("access_token",a),o.reconnect&&(n.set("reconnect","1"),o.sid&&n.set("sid",o.sid)),n.set("auto_subscribe",o.autoSubscribe?"1":"0"),n.set("sdk",isReactNative()?"reactnative":"js"),n.set("version",t.version),n.set("protocol",t.protocol.toString()),t.deviceModel&&n.set("device_model",t.deviceModel),t.os&&n.set("os",t.os),t.osVersion&&n.set("os_version",t.osVersion),t.browser&&n.set("browser",t.browser),t.browserVersion&&n.set("browser_version",t.browserVersion),o.adaptiveStream&&n.set("adaptive_stream","1"),o.reconnectReason&&n.set("reconnect_reason",o.reconnectReason.toString()),!((e=navigator.connection)===null||e===void 0)&&e.type&&n.set("network",navigator.connection.type),"?".concat(n.toString())}var parser$1={},grammar$2={exports:{}},grammar$1=grammar$2.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(a){return a.encoding?"rtpmap:%d %s/%s/%s":a.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(a){return a.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(a){return a.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(a){return"extmap:%d"+(a.direction?"/%s":"%v")+(a["encrypt-uri"]?" %s":"%v")+" %s"+(a.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(a){return a.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(a){var t="candidate:%s %d %s %d %s %d typ %s";return t+=a.raddr!=null?" raddr %s rport %d":"%v%v",t+=a.tcptype!=null?" tcptype %s":"%v",a.generation!=null&&(t+=" generation %d"),t+=a["network-id"]!=null?" network-id %d":"%v",t+=a["network-cost"]!=null?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(a){var t="ssrc:%d";return a.attribute!=null&&(t+=" %s",a.value!=null&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(a){return a.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(a){return a.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(a){return"imageattr:%s %s %s"+(a.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(a){return"simulcast:%s %s"+(a.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(a){return"ts-refclk:%s"+(a.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(a){var t="mediaclk:";return t+=a.id!=null?"id=%s %s":"%v%s",t+=a.mediaClockValue!=null?"=%s":"",t+=a.rateNumerator!=null?" rate=%s":"",t+=a.rateDenominator!=null?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(grammar$1).forEach(function(a){var t=grammar$1[a];t.forEach(function(o){o.reg||(o.reg=/(.*)/),o.format||(o.format="%s")})});var grammarExports=grammar$2.exports;(function(a){var t=function(l){return String(Number(l))===l?Number(l):l},o=function(l,u,d,p){if(p&&!d)u[p]=t(l[1]);else for(var g=0;g<d.length;g+=1)l[g+1]!=null&&(u[d[g]]=t(l[g+1]))},e=function(l,u,d){var p=l.name&&l.names;l.push&&!u[l.push]?u[l.push]=[]:p&&!u[l.name]&&(u[l.name]={});var g=l.push?{}:p?u[l.name]:u;o(d.match(l.reg),g,l.names,l.name),l.push&&u[l.push].push(g)},n=grammarExports,s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);a.parse=function(l){var u={},d=[],p=u;return l.split(/(\r\n|\r|\n)/).filter(s).forEach(function(g){var y=g[0],T=g.slice(2);y==="m"&&(d.push({rtp:[],fmtp:[]}),p=d[d.length-1]);for(var b=0;b<(n[y]||[]).length;b+=1){var k=n[y][b];if(k.reg.test(T))return e(k,p,T)}}),u.media=d,u};var c=function(l,u){var d=u.split(/=(.+)/,2);return d.length===2?l[d[0]]=t(d[1]):d.length===1&&u.length>1&&(l[d[0]]=void 0),l};a.parseParams=function(l){return l.split(/;\s?/).reduce(c,{})},a.parseFmtpConfig=a.parseParams,a.parsePayloads=function(l){return l.toString().split(" ").map(Number)},a.parseRemoteCandidates=function(l){for(var u=[],d=l.split(" ").map(t),p=0;p<d.length;p+=3)u.push({component:d[p],ip:d[p+1],port:d[p+2]});return u},a.parseImageAttributes=function(l){return l.split(" ").map(function(u){return u.substring(1,u.length-1).split(",").reduce(c,{})})},a.parseSimulcastStreamList=function(l){return l.split(";").map(function(u){return u.split(",").map(function(d){var p,g=!1;return d[0]!=="~"?p=t(d):(p=t(d.substring(1,d.length)),g=!0),{scid:p,paused:g}})})}})(parser$1);var grammar=grammarExports,formatRegExp=/%[sdv%]/g,format=function(a){var t=1,o=arguments,e=o.length;return a.replace(formatRegExp,function(n){if(t>=e)return n;var s=o[t];switch(t+=1,n){case"%%":return"%";case"%s":return String(s);case"%d":return Number(s);case"%v":return""}})},makeLine=function(a,t,o){var e=t.format instanceof Function?t.format(t.push?o:o[t.name]):t.format,n=[a+"="+e];if(t.names)for(var s=0;s<t.names.length;s+=1){var c=t.names[s];t.name?n.push(o[t.name][c]):n.push(o[t.names[s]])}else n.push(o[t.name]);return format.apply(null,n)},defaultOuterOrder=["v","o","s","i","u","e","p","c","b","t","r","z","a"],defaultInnerOrder=["i","c","b","a"],writer$1=function(a,t){t=t||{},a.version==null&&(a.version=0),a.name==null&&(a.name=" "),a.media.forEach(function(s){s.payloads==null&&(s.payloads="")});var o=t.outerOrder||defaultOuterOrder,e=t.innerOrder||defaultInnerOrder,n=[];return o.forEach(function(s){grammar[s].forEach(function(c){c.name in a&&a[c.name]!=null?n.push(makeLine(s,c,a)):c.push in a&&a[c.push]!=null&&a[c.push].forEach(function(l){n.push(makeLine(s,c,l))})})}),a.media.forEach(function(s){n.push(makeLine("m",grammar.m[0],s)),e.forEach(function(c){grammar[c].forEach(function(l){l.name in s&&s[l.name]!=null?n.push(makeLine(c,l,s)):l.push in s&&s[l.push]!=null&&s[l.push].forEach(function(u){n.push(makeLine(c,l,u))})})})}),n.join(`\r
`)+`\r
`},parser=parser$1,writer$2=writer$1,write=writer$2,parse=parser.parse;const startBitrateForSVC=.7,debounceInterval=20,PCEvents={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class PCTransport extends eventsExports.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(t){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var e;super(),this.log=livekitLogger,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=r(n=>__awaiter(this,void 0,void 0,function*(){this.emit(PCEvents.NegotiationStarted);try{yield this.createAndSendOffer()}catch(s){if(n)n(s);else throw s}}),debounceInterval),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=getLogger((e=o.loggerName)!==null&&e!==void 0?e:LoggerNames.PCTransport),this.loggerOptions=o,this.config=t,this._pc=this.createPC()}createPC(){const t=new RTCPeerConnection(this.config);return t.onicecandidate=o=>{var e;o.candidate&&((e=this.onIceCandidate)===null||e===void 0||e.call(this,o.candidate))},t.onicecandidateerror=o=>{var e;(e=this.onIceCandidateError)===null||e===void 0||e.call(this,o)},t.oniceconnectionstatechange=()=>{var o;(o=this.onIceConnectionStateChange)===null||o===void 0||o.call(this,t.iceConnectionState)},t.onsignalingstatechange=()=>{var o;(o=this.onSignalingStatechange)===null||o===void 0||o.call(this,t.signalingState)},t.onconnectionstatechange=()=>{var o;(o=this.onConnectionStateChange)===null||o===void 0||o.call(this,t.connectionState)},t.ondatachannel=o=>{var e;(e=this.onDataChannel)===null||e===void 0||e.call(this,o)},t.ontrack=o=>{var e;(e=this.onTrack)===null||e===void 0||e.call(this,o)},t}get logContext(){var t,o;return Object.assign({},(o=(t=this.loggerOptions).loggerContextCb)===null||o===void 0?void 0:o.call(t))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(t){return __awaiter(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(t);this.pendingCandidates.push(t)})}setRemoteDescription(t){return __awaiter(this,void 0,void 0,function*(){var o;let e;if(t.type==="offer"){let{stereoMids:n,nackMids:s}=extractStereoAndNackAudioFromOffer(t);this.remoteStereoMids=n,this.remoteNackMids=s}else if(t.type==="answer"){const n=parse((o=t.sdp)!==null&&o!==void 0?o:"");n.media.forEach(s=>{s.type==="audio"&&this.trackBitrates.some(c=>{if(!c.transceiver||s.mid!=c.transceiver.mid)return!1;let l=0;if(s.rtp.some(d=>d.codec.toUpperCase()===c.codec.toUpperCase()?(l=d.payload,!0):!1),l===0)return!0;let u=!1;for(const d of s.fmtp)if(d.payload===l){d.config=d.config.split(";").filter(p=>!p.includes("maxaveragebitrate")).join(";"),c.maxbr>0&&(d.config+=";maxaveragebitrate=".concat(c.maxbr*1e3)),u=!0;break}return u||c.maxbr>0&&s.fmtp.push({payload:l,config:"maxaveragebitrate=".concat(c.maxbr*1e3)}),!0})}),e=write(n)}yield this.setMungedSDP(t,e,!0),this.pendingCandidates.forEach(n=>{this.pc.addIceCandidate(n)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):t.type==="answer"&&(this.emit(PCEvents.NegotiationComplete),t.sdp&&parse(t.sdp).media.forEach(s=>{s.type==="video"&&this.emit(PCEvents.RTPVideoPayloadTypes,s.rtp)}))})}createAndSendOffer(t){return __awaiter(this,void 0,void 0,function*(){var o;if(this.onOffer===void 0)return;if(t!=null&&t.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const s=this._pc.remoteDescription;if(t!=null&&t.iceRestart&&s)yield this._pc.setRemoteDescription(s);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const e=yield this.pc.createOffer(t);this.log.debug("original offer",Object.assign({sdp:e.sdp},this.logContext));const n=parse((o=e.sdp)!==null&&o!==void 0?o:"");n.media.forEach(s=>{s.type==="audio"?ensureAudioNackAndStereo(s,[],[]):s.type==="video"&&this.trackBitrates.some(c=>{if(!s.msid||!c.cid||!s.msid.includes(c.cid))return!1;let l=0;if(s.rtp.some(d=>d.codec.toUpperCase()===c.codec.toUpperCase()?(l=d.payload,!0):!1),l===0||(isSVCCodec(c.codec)&&ensureVideoDDExtensionForSVC(s),c.codec!=="av1"))return!0;const u=Math.round(c.maxbr*startBitrateForSVC);for(const d of s.fmtp)if(d.payload===l){d.config.includes("x-google-start-bitrate")||(d.config+=";x-google-start-bitrate=".concat(u));break}return!0})}),yield this.setMungedSDP(e,write(n)),this.onOffer(e)})}createAndSetAnswer(){return __awaiter(this,void 0,void 0,function*(){var t;const o=yield this.pc.createAnswer(),e=parse((t=o.sdp)!==null&&t!==void 0?t:"");return e.media.forEach(n=>{n.type==="audio"&&ensureAudioNackAndStereo(n,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(o,write(e)),o})}createDataChannel(t,o){return this.pc.createDataChannel(t,o)}addTransceiver(t,o){return this.pc.addTransceiver(t,o)}addTrack(t){if(!this._pc)throw new UnexpectedConnectionState("PC closed, cannot add track");return this._pc.addTrack(t)}setTrackCodecBitrate(t){this.trackBitrates.push(t)}setConfiguration(t){var o;if(!this._pc)throw new UnexpectedConnectionState("PC closed, cannot configure");return(o=this._pc)===null||o===void 0?void 0:o.setConfiguration(t)}canRemoveTrack(){var t;return!!(!((t=this._pc)===null||t===void 0)&&t.removeTrack)}removeTrack(t){var o;return(o=this._pc)===null||o===void 0?void 0:o.removeTrack(t)}getConnectionState(){var t,o;return(o=(t=this._pc)===null||t===void 0?void 0:t.connectionState)!==null&&o!==void 0?o:"closed"}getICEConnectionState(){var t,o;return(o=(t=this._pc)===null||t===void 0?void 0:t.iceConnectionState)!==null&&o!==void 0?o:"closed"}getSignallingState(){var t,o;return(o=(t=this._pc)===null||t===void 0?void 0:t.signalingState)!==null&&o!==void 0?o:"closed"}getTransceivers(){var t,o;return(o=(t=this._pc)===null||t===void 0?void 0:t.getTransceivers())!==null&&o!==void 0?o:[]}getSenders(){var t,o;return(o=(t=this._pc)===null||t===void 0?void 0:t.getSenders())!==null&&o!==void 0?o:[]}getLocalDescription(){var t;return(t=this._pc)===null||t===void 0?void 0:t.localDescription}getRemoteDescription(){var t;return(t=this.pc)===null||t===void 0?void 0:t.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return __awaiter(this,void 0,void 0,function*(){var t;if(!this._pc)return;let o="";const e=new Map,n=new Map;if((yield this._pc.getStats()).forEach(l=>{switch(l.type){case"transport":o=l.selectedCandidatePairId;break;case"candidate-pair":o===""&&l.selected&&(o=l.id),e.set(l.id,l);break;case"remote-candidate":n.set(l.id,"".concat(l.address,":").concat(l.port));break}}),o==="")return;const c=(t=e.get(o))===null||t===void 0?void 0:t.remoteCandidateId;if(c!==void 0)return n.get(c)})}setMungedSDP(t,o,e){return __awaiter(this,void 0,void 0,function*(){if(o){const n=t.sdp;t.sdp=o;try{this.log.debug("setting munged ".concat(e?"remote":"local"," description"),this.logContext),e?yield this.pc.setRemoteDescription(t):yield this.pc.setLocalDescription(t);return}catch(s){this.log.warn("not able to set ".concat(t.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:o})),t.sdp=n}}try{e?yield this.pc.setRemoteDescription(t):yield this.pc.setLocalDescription(t)}catch(n){let s="unknown error";n instanceof Error?s=n.message:typeof n=="string"&&(s=n);const c={error:s,sdp:t.sdp};throw!e&&this.pc.remoteDescription&&(c.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(t.type),Object.assign(Object.assign({},this.logContext),{fields:c})),new NegotiationError(s)}})}}function ensureAudioNackAndStereo(a,t,o){let e=0;a.rtp.some(n=>n.codec==="opus"?(e=n.payload,!0):!1),e>0&&(a.rtcpFb||(a.rtcpFb=[]),o.includes(a.mid)&&!a.rtcpFb.some(n=>n.payload===e&&n.type==="nack")&&a.rtcpFb.push({payload:e,type:"nack"}),t.includes(a.mid)&&a.fmtp.some(n=>n.payload===e?(n.config.includes("stereo=1")||(n.config+=";stereo=1"),!0):!1))}function ensureVideoDDExtensionForSVC(a){var t,o;let e=0;((t=a.ext)===null||t===void 0?void 0:t.some(s=>s.uri===ddExtensionURI?!0:(s.value>e&&(e=s.value),!1)))||(o=a.ext)===null||o===void 0||o.push({value:e+1,uri:ddExtensionURI})}function extractStereoAndNackAudioFromOffer(a){var t;const o=[],e=[],n=parse((t=a.sdp)!==null&&t!==void 0?t:"");let s=0;return n.media.forEach(c=>{var l;c.type==="audio"&&(c.rtp.some(u=>u.codec==="opus"?(s=u.payload,!0):!1),!((l=c.rtcpFb)===null||l===void 0)&&l.some(u=>u.payload===s&&u.type==="nack")&&e.push(c.mid),c.fmtp.some(u=>u.payload===s?(u.config.includes("sprop-stereo=1")&&o.push(c.mid),!0):!1))}),{stereoMids:o,nackMids:e}}const defaultVideoCodec="vp8",publishDefaults={audioPreset:AudioPresets.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:ScreenSharePresets.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:defaultVideoCodec,backupCodec:!0},audioDefaults={autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0},videoDefaults={resolution:VideoPresets.h720.resolution},roomOptionDefaults={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new DefaultReconnectPolicy,disconnectOnPageLeave:!0,webAudioMix:!1},roomConnectOptionDefaults={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var PCTransportState;(function(a){a[a.NEW=0]="NEW",a[a.CONNECTING=1]="CONNECTING",a[a.CONNECTED=2]="CONNECTED",a[a.FAILED=3]="FAILED",a[a.CLOSING=4]="CLOSING",a[a.CLOSED=5]="CLOSED"})(PCTransportState||(PCTransportState={}));class PCTransportManager{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(t,o,e){var n;this.peerConnectionTimeout=roomConnectOptionDefaults.peerConnectionTimeout,this.log=livekitLogger,this.updateState=()=>{var s;const c=this.state,l=this.requiredTransports.map(u=>u.getConnectionState());l.every(u=>u==="connected")?this.state=PCTransportState.CONNECTED:l.some(u=>u==="failed")?this.state=PCTransportState.FAILED:l.some(u=>u==="connecting")?this.state=PCTransportState.CONNECTING:l.every(u=>u==="closed")?this.state=PCTransportState.CLOSED:l.some(u=>u==="closed")?this.state=PCTransportState.CLOSING:l.every(u=>u==="new")&&(this.state=PCTransportState.NEW),c!==this.state&&(this.log.debug("pc state change: from ".concat(PCTransportState[c]," to ").concat(PCTransportState[this.state]),this.logContext),(s=this.onStateChange)===null||s===void 0||s.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=getLogger((n=e.loggerName)!==null&&n!==void 0?n:LoggerNames.PCManager),this.loggerOptions=e,this.isPublisherConnectionRequired=!o,this.isSubscriberConnectionRequired=o,this.publisher=new PCTransport(t,e),this.subscriber=new PCTransport(t,e),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=s=>{var c;(c=this.onIceCandidate)===null||c===void 0||c.call(this,s,SignalTarget.PUBLISHER)},this.subscriber.onIceCandidate=s=>{var c;(c=this.onIceCandidate)===null||c===void 0||c.call(this,s,SignalTarget.SUBSCRIBER)},this.subscriber.onDataChannel=s=>{var c;(c=this.onDataChannel)===null||c===void 0||c.call(this,s)},this.subscriber.onTrack=s=>{var c;(c=this.onTrack)===null||c===void 0||c.call(this,s)},this.publisher.onOffer=s=>{var c;(c=this.onPublisherOffer)===null||c===void 0||c.call(this,s)},this.state=PCTransportState.NEW,this.connectionLock=new Mutex}get logContext(){var t,o;return Object.assign({},(o=(t=this.loggerOptions).loggerContextCb)===null||o===void 0?void 0:o.call(t))}requirePublisher(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=t,this.updateState()}requireSubscriber(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=t,this.updateState()}createAndSendPublisherOffer(t){return this.publisher.createAndSendOffer(t)}setPublisherAnswer(t){return this.publisher.setRemoteDescription(t)}removeTrack(t){return this.publisher.removeTrack(t)}close(){return __awaiter(this,void 0,void 0,function*(){if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const t=this.publisher;for(const o of t.getSenders())try{t.canRemoveTrack()&&t.removeTrack(o)}catch(e){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:e}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return __awaiter(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(t,o){return __awaiter(this,void 0,void 0,function*(){o===SignalTarget.PUBLISHER?yield this.publisher.addIceCandidate(t):yield this.subscriber.addIceCandidate(t)})}createSubscriberAnswerFromOffer(t){return __awaiter(this,void 0,void 0,function*(){return this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:t.type,sdp:t.sdp,signalingState:this.subscriber.getSignallingState().toString()})),yield this.subscriber.setRemoteDescription(t),yield this.subscriber.createAndSetAnswer()})}updateConfiguration(t,o){this.publisher.setConfiguration(t),this.subscriber.setConfiguration(t),o&&this.triggerIceRestart()}ensurePCTransportConnection(t,o){return __awaiter(this,void 0,void 0,function*(){var e;const n=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((e=this.requiredTransports)===null||e===void 0?void 0:e.map(s=>this.ensureTransportConnected(s,t,o)))}finally{n()}})}negotiate(t){return __awaiter(this,void 0,void 0,function*(){return new Promise((o,e)=>__awaiter(this,void 0,void 0,function*(){const n=setTimeout(()=>{e("negotiation timed out")},this.peerConnectionTimeout),s=()=>{clearTimeout(n),e("negotiation aborted")};t.signal.addEventListener("abort",s),this.publisher.once(PCEvents.NegotiationStarted,()=>{t.signal.aborted||this.publisher.once(PCEvents.NegotiationComplete,()=>{clearTimeout(n),o()})}),yield this.publisher.negotiate(c=>{clearTimeout(n),e(c)})}))})}addPublisherTransceiver(t,o){return this.publisher.addTransceiver(t,o)}addPublisherTrack(t){return this.publisher.addTrack(t)}createPublisherDataChannel(t,o){return this.publisher.createDataChannel(t,o)}getConnectedAddress(t){return t===SignalTarget.PUBLISHER?this.publisher.getConnectedAddress():t===SignalTarget.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const t=[];return this.isPublisherConnectionRequired&&t.push(this.publisher),this.isSubscriberConnectionRequired&&t.push(this.subscriber),t}ensureTransportConnected(t,o){return __awaiter(this,arguments,void 0,function(e,n){var s=this;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(e.getConnectionState()!=="connected")return new Promise((u,d)=>__awaiter(s,void 0,void 0,function*(){const p=()=>{this.log.warn("abort transport connection",this.logContext),CriticalTimers.clearTimeout(g),d(new ConnectionError("room connection has been cancelled",3))};n!=null&&n.signal.aborted&&p(),n==null||n.signal.addEventListener("abort",p);const g=CriticalTimers.setTimeout(()=>{n==null||n.signal.removeEventListener("abort",p),d(new ConnectionError("could not establish pc connection"))},c);for(;this.state!==PCTransportState.CONNECTED;)if(yield sleep(50),n!=null&&n.signal.aborted){d(new ConnectionError("room connection has been cancelled",3));return}CriticalTimers.clearTimeout(g),n==null||n.signal.removeEventListener("abort",p),u()}))}()})}}const monitorFrequency=2e3;function computeBitrate(a,t){if(!t)return 0;let o,e;return"bytesReceived"in a?(o=a.bytesReceived,e=t.bytesReceived):"bytesSent"in a&&(o=a.bytesSent,e=t.bytesSent),o===void 0||e===void 0||a.timestamp===void 0||t.timestamp===void 0?0:(o-e)*8*1e3/(a.timestamp-t.timestamp)}class LocalAudioTrack extends LocalTrack{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(t,o){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;super(t,Track.Kind.Audio,o,e,s),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>__awaiter(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let c;try{c=yield this.getSenderStats()}catch(l){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:l}));return}c&&this.prevStats&&(this._currentBitrate=computeBitrate(c,this.prevStats)),this.prevStats=c}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(TrackEvent.AudioTrackFeatureUpdate,this,AudioTrackFeature.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(TrackEvent.AudioTrackFeatureUpdate,this,AudioTrackFeature.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=n,this.checkForSilence()}setDeviceId(t){return __awaiter(this,void 0,void 0,function*(){return this._constraints.deviceId===t&&this._mediaStreamTrack.getSettings().deviceId===unwrapConstraint(t)?!0:(this._constraints.deviceId=t,this.isMuted||(yield this.restartTrack()),this.isMuted||unwrapConstraint(t)===this._mediaStreamTrack.getSettings().deviceId)})}mute(){const t=Object.create(null,{mute:{get:()=>super.mute}});return __awaiter(this,void 0,void 0,function*(){const o=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===Track.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield t.mute.call(this),this)}finally{o()}})}unmute(){const t=Object.create(null,{unmute:{get:()=>super.unmute}});return __awaiter(this,void 0,void 0,function*(){const o=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const e=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==unwrapConstraint(this._constraints.deviceId);return this.source===Track.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||e)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield t.unmute.call(this),this}finally{o()}})}restartTrack(t){return __awaiter(this,void 0,void 0,function*(){let o;if(t){const e=constraintsForOptions({audio:t});typeof e.audio!="boolean"&&(o=e.audio)}yield this.restart(o)})}restart(t){const o=Object.create(null,{restart:{get:()=>super.restart}});return __awaiter(this,void 0,void 0,function*(){const e=yield o.restart.call(this,t);return this.checkForSilence(),e})}startMonitor(){isWeb()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},monitorFrequency)))}setProcessor(t){return __awaiter(this,void 0,void 0,function*(){var o;const e=yield this.processorLock.lock();try{if(!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.stopProcessor());const n={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(t.name),this.logContext),yield t.init(n),this.processor=t,this.processor.processedTrack&&(yield(o=this.sender)===null||o===void 0?void 0:o.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(TrackEvent.TrackProcessorUpdate,this.processor)}finally{e()}})}setAudioContext(t){this.audioContext=t}getSenderStats(){return __awaiter(this,void 0,void 0,function*(){var t;if(!(!((t=this.sender)===null||t===void 0)&&t.getStats))return;const o=yield this.sender.getStats();let e;return o.forEach(n=>{n.type==="outbound-rtp"&&(e={type:"audio",streamId:n.id,packetsSent:n.packetsSent,packetsLost:n.packetsLost,bytesSent:n.bytesSent,timestamp:n.timestamp,roundTripTime:n.roundTripTime,jitter:n.jitter})}),e})}checkForSilence(){return __awaiter(this,void 0,void 0,function*(){const t=yield detectSilence(this);return t&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(TrackEvent.AudioSilenceDetected)),t})}}function mediaTrackToLocalTrack(a,t,o){switch(a.kind){case"audio":return new LocalAudioTrack(a,t,!1,void 0,o);case"video":return new LocalVideoTrack(a,t,!1,o);default:throw new TrackInvalidError("unsupported track type: ".concat(a.kind))}}const presets169=Object.values(VideoPresets),presets43=Object.values(VideoPresets43),presetsScreenShare=Object.values(ScreenSharePresets),defaultSimulcastPresets169=[VideoPresets.h180,VideoPresets.h360],defaultSimulcastPresets43=[VideoPresets43.h180,VideoPresets43.h360],computeDefaultScreenShareSimulcastPresets=a=>[{scaleResolutionDownBy:2,fps:a.encoding.maxFramerate}].map(o=>{var e,n;return new VideoPreset(Math.floor(a.width/o.scaleResolutionDownBy),Math.floor(a.height/o.scaleResolutionDownBy),Math.max(15e4,Math.floor(a.encoding.maxBitrate/(Math.pow(o.scaleResolutionDownBy,2)*(((e=a.encoding.maxFramerate)!==null&&e!==void 0?e:30)/((n=o.fps)!==null&&n!==void 0?n:30))))),o.fps,a.encoding.priority)}),videoRids=["q","h","f"];function computeVideoEncodings(a,t,o,e){var n,s;let c=e==null?void 0:e.videoEncoding;a&&(c=e==null?void 0:e.screenShareEncoding);const l=e==null?void 0:e.simulcast,u=e==null?void 0:e.scalabilityMode,d=e==null?void 0:e.videoCodec;if(!c&&!l&&!u||!t||!o)return[{}];c||(c=determineAppropriateEncoding(a,t,o,d),livekitLogger.debug("using video encoding",c));const p=new VideoPreset(t,o,c.maxBitrate,c.maxFramerate,c.priority);if(u&&isSVCCodec(d)){const T=new ScalabilityMode(u),b=[];if(T.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(u));const k=getBrowser();if(isSafari()||isReactNative()||(k==null?void 0:k.name)==="Chrome"&&compareVersions(k==null?void 0:k.version,"113")<0){const O=T.suffix=="h"?2:3;for(let C=0;C<T.spatial;C+=1)b.push({rid:videoRids[2-C],maxBitrate:c.maxBitrate/Math.pow(O,C),maxFramerate:p.encoding.maxFramerate});b[0].scalabilityMode=u}else b.push({maxBitrate:c.maxBitrate,maxFramerate:p.encoding.maxFramerate,scalabilityMode:u});return p.encoding.priority&&(b[0].priority=p.encoding.priority,b[0].networkPriority=p.encoding.priority),livekitLogger.debug("using svc encoding",{encodings:b}),b}if(!l)return[c];let g=[];a?g=(n=sortPresets(e==null?void 0:e.screenShareSimulcastLayers))!==null&&n!==void 0?n:defaultSimulcastLayers(a,p):g=(s=sortPresets(e==null?void 0:e.videoSimulcastLayers))!==null&&s!==void 0?s:defaultSimulcastLayers(a,p);let y;if(g.length>0){const T=g[0];g.length>1&&([,y]=g);const b=Math.max(t,o);if(b>=960&&y)return encodingsFromPresets(t,o,[T,y,p]);if(b>=480)return encodingsFromPresets(t,o,[T,p])}return encodingsFromPresets(t,o,[p])}function computeTrackBackupEncodings(a,t,o){var e,n,s,c;if(!o.backupCodec||o.backupCodec===!0||o.backupCodec.codec===o.videoCodec)return;t!==o.backupCodec.codec&&livekitLogger.warn("requested a different codec than specified as backup",{serverRequested:t,backup:o.backupCodec.codec}),o.videoCodec=t,o.videoEncoding=o.backupCodec.encoding;const l=a.mediaStreamTrack.getSettings(),u=(e=l.width)!==null&&e!==void 0?e:(n=a.dimensions)===null||n===void 0?void 0:n.width,d=(s=l.height)!==null&&s!==void 0?s:(c=a.dimensions)===null||c===void 0?void 0:c.height;return computeVideoEncodings(a.source===Track.Source.ScreenShare,u,d,o)}function determineAppropriateEncoding(a,t,o,e){const n=presetsForResolution(a,t,o);let{encoding:s}=n[0];const c=Math.max(t,o);for(let l=0;l<n.length;l+=1){const u=n[l];if(s=u.encoding,u.width>=c)break}if(e)switch(e){case"av1":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function presetsForResolution(a,t,o){if(a)return presetsScreenShare;const e=t>o?t/o:o/t;return Math.abs(e-16/9)<Math.abs(e-4/3)?presets169:presets43}function defaultSimulcastLayers(a,t){if(a)return computeDefaultScreenShareSimulcastPresets(t);const{width:o,height:e}=t,n=o>e?o/e:e/o;return Math.abs(n-16/9)<Math.abs(n-4/3)?defaultSimulcastPresets169:defaultSimulcastPresets43}function encodingsFromPresets(a,t,o){const e=[];if(o.forEach((n,s)=>{if(s>=videoRids.length)return;const c=Math.min(a,t),u={rid:videoRids[s],scaleResolutionDownBy:Math.max(1,c/Math.min(n.width,n.height)),maxBitrate:n.encoding.maxBitrate};n.encoding.maxFramerate&&(u.maxFramerate=n.encoding.maxFramerate);const d=isFireFox()||s===0;n.encoding.priority&&d&&(u.priority=n.encoding.priority,u.networkPriority=n.encoding.priority),e.push(u)}),isReactNative()&&getReactNativeOs()==="ios"){let n;e.forEach(c=>{n?c.maxFramerate&&c.maxFramerate>n&&(n=c.maxFramerate):n=c.maxFramerate});let s=!0;e.forEach(c=>{var l;c.maxFramerate!=n&&(s&&(s=!1,livekitLogger.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),livekitLogger.info('Setting framerate of encoding "'.concat((l=c.rid)!==null&&l!==void 0?l:"",'" to ').concat(n)),c.maxFramerate=n)})}return e}function sortPresets(a){if(a)return a.sort((t,o)=>{const{encoding:e}=t,{encoding:n}=o;return e.maxBitrate>n.maxBitrate?1:e.maxBitrate<n.maxBitrate?-1:e.maxBitrate===n.maxBitrate&&e.maxFramerate&&n.maxFramerate?e.maxFramerate>n.maxFramerate?1:-1:0})}class ScalabilityMode{constructor(t){const o=t.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!o)throw new Error("invalid scalability mode");if(this.spatial=parseInt(o[1]),this.temporal=parseInt(o[2]),o.length>3)switch(o[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=o[3]}}toString(){var t;return"L".concat(this.spatial,"T").concat(this.temporal).concat((t=this.suffix)!==null&&t!==void 0?t:"")}}function getDefaultDegradationPreference(a){return a.source===Track.Source.ScreenShare||a.constraints.height&&unwrapConstraint(a.constraints.height)>=1080?"maintain-resolution":"balanced"}const refreshSubscribedCodecAfterNewCodec=5e3;class LocalVideoTrack extends LocalTrack{get sender(){return this._sender}set sender(t){this._sender=t,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(t,o){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=arguments.length>3?arguments[3]:void 0;super(t,Track.Kind.Video,o,e,n),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.monitorSender=()=>__awaiter(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(l){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:l}));return}const c=new Map(s.map(l=>[l.rid,l]));if(this.prevStats){let l=0;c.forEach((u,d)=>{var p;const g=(p=this.prevStats)===null||p===void 0?void 0:p.get(d);l+=computeBitrate(u,g)}),this._currentBitrate=l}this.prevStats=c}),this.senderLock=new Mutex}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(t){var o;if(this.signalClient=t,!isWeb())return;const e=(o=this.sender)===null||o===void 0?void 0:o.getParameters();e&&(this.encodings=e.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},monitorFrequency))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(t=>{t.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const t=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return __awaiter(this,void 0,void 0,function*(){var o,e,n,s,c;yield t.pauseUpstream.call(this);try{for(var l=!0,u=__asyncValues(this.simulcastCodecs.values()),d;d=yield u.next(),o=d.done,!o;l=!0)s=d.value,l=!1,yield(c=s.sender)===null||c===void 0?void 0:c.replaceTrack(null)}catch(p){e={error:p}}finally{try{!l&&!o&&(n=u.return)&&(yield n.call(u))}finally{if(e)throw e.error}}})}resumeUpstream(){const t=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return __awaiter(this,void 0,void 0,function*(){var o,e,n,s,c;yield t.resumeUpstream.call(this);try{for(var l=!0,u=__asyncValues(this.simulcastCodecs.values()),d;d=yield u.next(),o=d.done,!o;l=!0){s=d.value,l=!1;const p=s;yield(c=p.sender)===null||c===void 0?void 0:c.replaceTrack(p.mediaStreamTrack)}}catch(p){e={error:p}}finally{try{!l&&!o&&(n=u.return)&&(yield n.call(u))}finally{if(e)throw e.error}}})}mute(){const t=Object.create(null,{mute:{get:()=>super.mute}});return __awaiter(this,void 0,void 0,function*(){const o=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===Track.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield t.mute.call(this),this)}finally{o()}})}unmute(){const t=Object.create(null,{unmute:{get:()=>super.unmute}});return __awaiter(this,void 0,void 0,function*(){const o=yield this.muteLock.lock();try{return this.isMuted?(this.source===Track.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield t.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{o()}})}setTrackMuted(t){super.setTrackMuted(t);for(const o of this.simulcastCodecs.values())o.mediaStreamTrack.enabled=!t}getSenderStats(){return __awaiter(this,void 0,void 0,function*(){var t;if(!(!((t=this.sender)===null||t===void 0)&&t.getStats))return[];const o=[],e=yield this.sender.getStats();return e.forEach(n=>{var s;if(n.type==="outbound-rtp"){const c={type:"video",streamId:n.id,frameHeight:n.frameHeight,frameWidth:n.frameWidth,framesPerSecond:n.framesPerSecond,framesSent:n.framesSent,firCount:n.firCount,pliCount:n.pliCount,nackCount:n.nackCount,packetsSent:n.packetsSent,bytesSent:n.bytesSent,qualityLimitationReason:n.qualityLimitationReason,qualityLimitationDurations:n.qualityLimitationDurations,qualityLimitationResolutionChanges:n.qualityLimitationResolutionChanges,rid:(s=n.rid)!==null&&s!==void 0?s:n.id,retransmittedPacketsSent:n.retransmittedPacketsSent,targetBitrate:n.targetBitrate,timestamp:n.timestamp},l=e.get(n.remoteId);l&&(c.jitter=l.jitter,c.packetsLost=l.packetsLost,c.roundTripTime=l.roundTripTime),o.push(c)}}),o.sort((n,s)=>{var c,l;return((c=s.frameWidth)!==null&&c!==void 0?c:0)-((l=n.frameWidth)!==null&&l!==void 0?l:0)}),o})}setPublishingQuality(t){const o=[];for(let e=VideoQuality.LOW;e<=VideoQuality.HIGH;e+=1)o.push(new SubscribedQuality({quality:e,enabled:e<=t}));this.log.debug("setting publishing quality. max quality ".concat(t),this.logContext),this.setPublishingLayers(o)}setDeviceId(t){return __awaiter(this,void 0,void 0,function*(){return this._constraints.deviceId===t&&this._mediaStreamTrack.getSettings().deviceId===unwrapConstraint(t)?!0:(this._constraints.deviceId=t,this.isMuted||(yield this.restartTrack()),this.isMuted||unwrapConstraint(t)===this._mediaStreamTrack.getSettings().deviceId)})}restartTrack(t){return __awaiter(this,void 0,void 0,function*(){var o,e,n,s;let c;if(t){const p=constraintsForOptions({video:t});typeof p.video!="boolean"&&(c=p.video)}yield this.restart(c);try{for(var l=!0,u=__asyncValues(this.simulcastCodecs.values()),d;d=yield u.next(),o=d.done,!o;l=!0){s=d.value,l=!1;const p=s;p.sender&&(p.mediaStreamTrack=this.mediaStreamTrack.clone(),yield p.sender.replaceTrack(p.mediaStreamTrack))}}catch(p){e={error:p}}finally{try{!l&&!o&&(n=u.return)&&(yield n.call(u))}finally{if(e)throw e.error}}})}setProcessor(t){const o=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return __awaiter(this,arguments,void 0,function(e){var n=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var c,l,u,d,p,g;if(yield o.setProcessor.call(n,e,s),!((p=n.processor)===null||p===void 0)&&p.processedTrack)try{for(var y=!0,T=__asyncValues(n.simulcastCodecs.values()),b;b=yield T.next(),c=b.done,!c;y=!0)d=b.value,y=!1,yield(g=d.sender)===null||g===void 0?void 0:g.replaceTrack(n.processor.processedTrack)}catch(k){l={error:k}}finally{try{!y&&!c&&(u=T.return)&&(yield u.call(T))}finally{if(l)throw l.error}}}()})}setDegradationPreference(t){return __awaiter(this,void 0,void 0,function*(){if(this.degradationPreference=t,this.sender)try{this.log.debug("setting degradationPreference to ".concat(t),this.logContext);const o=this.sender.getParameters();o.degradationPreference=t,this.sender.setParameters(o)}catch(o){this.log.warn("failed to set degradationPreference",Object.assign({error:o},this.logContext))}})}addSimulcastTrack(t,o){if(this.simulcastCodecs.has(t)){this.log.error("".concat(t," already added, skipping adding simulcast codec"),this.logContext);return}const e={codec:t,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:o};return this.simulcastCodecs.set(t,e),e}setSimulcastTrackSender(t,o){const e=this.simulcastCodecs.get(t);e&&(e.sender=o,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},refreshSubscribedCodecAfterNewCodec))}setPublishingCodecs(t){return __awaiter(this,void 0,void 0,function*(){var o,e,n,s,c,l,u;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:t,currentCodec:this.codec})),!this.codec&&t.length>0)return yield this.setPublishingLayers(t[0].qualities),[];this.subscribedCodecs=t;const d=[];try{for(o=!0,e=__asyncValues(t);n=yield e.next(),s=n.done,!s;o=!0){u=n.value,o=!1;const p=u;if(!this.codec||this.codec===p.codec)yield this.setPublishingLayers(p.qualities);else{const g=this.simulcastCodecs.get(p.codec);if(this.log.debug("try setPublishingCodec for ".concat(p.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:g})),!g||!g.sender){for(const y of p.qualities)if(y.enabled){d.push(p.codec);break}}else g.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(p.codec),this.logContext),yield setPublishingLayersForSender(g.sender,g.encodings,p.qualities,this.senderLock,this.log,this.logContext))}}}catch(p){c={error:p}}finally{try{!o&&!s&&(l=e.return)&&(yield l.call(e))}finally{if(c)throw c.error}}return d})}setPublishingLayers(t){return __awaiter(this,void 0,void 0,function*(){this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:t})),!(!this.sender||!this.encodings)&&(yield setPublishingLayersForSender(this.sender,this.encodings,t,this.senderLock,this.log,this.logContext))})}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return __awaiter(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),isMobile()&&this.isInBackground&&this.source===Track.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function setPublishingLayersForSender(a,t,o,e,n,s){return __awaiter(this,void 0,void 0,function*(){const c=yield e.lock();n.debug("setPublishingLayersForSender",Object.assign(Object.assign({},s),{sender:a,qualities:o,senderEncodings:t}));try{const l=a.getParameters(),{encodings:u}=l;if(!u)return;if(u.length!==t.length){n.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},s),{encodings:u,senderEncodings:t}));return}let d=!1;!1&&u[0].scalabilityMode||u.forEach((g,y)=>{var T;let b=(T=g.rid)!==null&&T!==void 0?T:"";b===""&&(b="q");const k=videoQualityForRid(b),O=o.find(C=>C.quality===k);O&&g.active!==O.enabled&&(d=!0,g.active=O.enabled,n.debug("setting layer ".concat(O.quality," to ").concat(g.active?"enabled":"disabled"),s),isFireFox()&&(O.enabled?(g.scaleResolutionDownBy=t[y].scaleResolutionDownBy,g.maxBitrate=t[y].maxBitrate,g.maxFrameRate=t[y].maxFrameRate):(g.scaleResolutionDownBy=4,g.maxBitrate=10,g.maxFrameRate=2)))}),d&&(l.encodings=u,n.debug("setting encodings",Object.assign(Object.assign({},s),{encodings:l.encodings})),yield a.setParameters(l))}finally{c()}})}function videoQualityForRid(a){switch(a){case"f":return VideoQuality.HIGH;case"h":return VideoQuality.MEDIUM;case"q":return VideoQuality.LOW;default:return VideoQuality.HIGH}}function videoLayersFromEncodings(a,t,o,e){if(!o)return[new VideoLayer({quality:VideoQuality.HIGH,width:a,height:t,bitrate:0,ssrc:0})];if(e){const n=o[0].scalabilityMode,s=new ScalabilityMode(n),c=[],l=s.suffix=="h"?1.5:2,u=s.suffix=="h"?2:3;for(let d=0;d<s.spatial;d+=1)c.push(new VideoLayer({quality:Math.min(VideoQuality.HIGH,s.spatial-1)-d,width:Math.ceil(a/Math.pow(l,d)),height:Math.ceil(t/Math.pow(l,d)),bitrate:o[0].maxBitrate?Math.ceil(o[0].maxBitrate/Math.pow(u,d)):0,ssrc:0}));return c}return o.map(n=>{var s,c,l;const u=(s=n.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let d=videoQualityForRid((c=n.rid)!==null&&c!==void 0?c:"");return new VideoLayer({quality:d,width:Math.ceil(a/u),height:Math.ceil(t/u),bitrate:(l=n.maxBitrate)!==null&&l!==void 0?l:0,ssrc:0})})}const lossyDataChannel="_lossy",reliableDataChannel="_reliable",minReconnectWait=2*1e3,leaveReconnect="leave-reconnect";var PCState;(function(a){a[a.New=0]="New",a[a.Connected=1]="Connected",a[a.Disconnected=2]="Disconnected",a[a.Reconnecting=3]="Reconnecting",a[a.Closed=4]="Closed"})(PCState||(PCState={}));class RTCEngine extends eventsExports.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(t){var o;super(),this.options=t,this.rtcConfig={},this.peerConnectionTimeout=roomConnectOptionDefaults.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.subscriberPrimary=!1,this.pcState=PCState.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=livekitLogger,this.handleDataChannel=e=>__awaiter(this,[e],void 0,function(n){var s=this;let{channel:c}=n;return function*(){if(c){if(c.label===reliableDataChannel)s.reliableDCSub=c;else if(c.label===lossyDataChannel)s.lossyDCSub=c;else return;s.log.debug("on data channel ".concat(c.id,", ").concat(c.label),s.logContext),c.onmessage=s.handleDataMessage}}()}),this.handleDataMessage=e=>__awaiter(this,void 0,void 0,function*(){var n,s;const c=yield this.dataProcessLock.lock();try{let l;if(e.data instanceof ArrayBuffer)l=e.data;else if(e.data instanceof Blob)l=yield e.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:e.data}));return}const u=DataPacket.fromBinary(new Uint8Array(l));((n=u.value)===null||n===void 0?void 0:n.case)==="speaker"?this.emit(EngineEvent.ActiveSpeakersUpdate,u.value.value.speakers):(((s=u.value)===null||s===void 0?void 0:s.case)==="user"&&applyUserDataCompat(u,u.value.value),this.emit(EngineEvent.DataPacketReceived,u))}finally{c()}}),this.handleDataError=e=>{const s=e.currentTarget.maxRetransmits===0?"lossy":"reliable";if(e instanceof ErrorEvent&&e.error){const{error:c}=e.error;this.log.error("DataChannel error on ".concat(s,": ").concat(e.message),Object.assign(Object.assign({},this.logContext),{error:c}))}else this.log.error("Unknown DataChannel error on ".concat(s),Object.assign(Object.assign({},this.logContext),{event:e}))},this.handleBufferedAmountLow=e=>{const s=e.currentTarget.maxRetransmits===0?DataPacket_Kind.LOSSY:DataPacket_Kind.RELIABLE;this.updateAndEmitDCBufferStatus(s)},this.handleDisconnect=(e,n)=>{if(this._isClosed)return;this.log.warn("".concat(e," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=u=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(u,"ms. giving up"),this.logContext),this.emit(EngineEvent.Disconnected),this.close()},c=Date.now()-this.reconnectStart;let l=this.getNextRetryDelay({elapsedMs:c,retryCount:this.reconnectAttempts});if(l===null){s(c);return}e===leaveReconnect&&(l=0),this.log.debug("reconnecting in ".concat(l,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=CriticalTimers.setTimeout(()=>this.attemptReconnect(n).finally(()=>this.reconnectTimeout=void 0),l)},this.waitForRestarted=()=>new Promise((e,n)=>{this.pcState===PCState.Connected&&e();const s=()=>{this.off(EngineEvent.Disconnected,c),e()},c=()=>{this.off(EngineEvent.Restarted,s),n()};this.once(EngineEvent.Restarted,s),this.once(EngineEvent.Disconnected,c)}),this.updateAndEmitDCBufferStatus=e=>{const n=this.isBufferStatusLow(e);typeof n<"u"&&n!==this.dcBufferStatus.get(e)&&(this.dcBufferStatus.set(e,n),this.emit(EngineEvent.DCBufferStatusChanged,n,e))},this.isBufferStatusLow=e=>{const n=this.dataChannelForKind(e);if(n)return n.bufferedAmount<=n.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===SignalConnectionState.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(ReconnectReason.RR_SIGNAL_DISCONNECTED))},this.log=getLogger((o=t.loggerName)!==null&&o!==void 0?o:LoggerNames.Engine),this.loggerOptions={loggerName:t.loggerName,loggerContextCb:()=>this.logContext},this.client=new SignalClient(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new Mutex,this.dataProcessLock=new Mutex,this.dcBufferStatus=new Map([[DataPacket_Kind.LOSSY,!0],[DataPacket_Kind.RELIABLE,!0]]),this.client.onParticipantUpdate=e=>this.emit(EngineEvent.ParticipantUpdate,e),this.client.onConnectionQuality=e=>this.emit(EngineEvent.ConnectionQualityUpdate,e),this.client.onRoomUpdate=e=>this.emit(EngineEvent.RoomUpdate,e),this.client.onSubscriptionError=e=>this.emit(EngineEvent.SubscriptionError,e),this.client.onSubscriptionPermissionUpdate=e=>this.emit(EngineEvent.SubscriptionPermissionUpdate,e),this.client.onSpeakersChanged=e=>this.emit(EngineEvent.SpeakersChanged,e),this.client.onStreamStateUpdate=e=>this.emit(EngineEvent.StreamStateChanged,e),this.client.onRequestResponse=e=>this.emit(EngineEvent.SignalRequestResponse,e)}get logContext(){var t,o,e,n,s,c,l,u;return{room:(o=(t=this.latestJoinResponse)===null||t===void 0?void 0:t.room)===null||o===void 0?void 0:o.name,roomID:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.sid,participant:(c=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||c===void 0?void 0:c.identity,pID:(u=(l=this.latestJoinResponse)===null||l===void 0?void 0:l.participant)===null||u===void 0?void 0:u.sid}}join(t,o,e,n){return __awaiter(this,void 0,void 0,function*(){this.url=t,this.token=o,this.signalOpts=e,this.maxJoinAttempts=e.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const s=yield this.client.join(t,o,e,n);return this._isClosed=!1,this.latestJoinResponse=s,this.subscriberPrimary=s.subscriberPrimary,this.pcManager||(yield this.configure(s)),(!this.subscriberPrimary||s.fastPublish)&&this.negotiate(),this.clientConfiguration=s.clientConfiguration,s}catch(s){if(s instanceof ConnectionError&&s.reason===1&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(t,o,e,n);throw s}})}close(){return __awaiter(this,void 0,void 0,function*(){const t=yield this.closingLock.lock();if(this.isClosed){t();return}try{this._isClosed=!0,this.emit(EngineEvent.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{t()}})}cleanupPeerConnections(){return __awaiter(this,void 0,void 0,function*(){var t;yield(t=this.pcManager)===null||t===void 0?void 0:t.close(),this.pcManager=void 0;const o=e=>{e&&(e.close(),e.onbufferedamountlow=null,e.onclose=null,e.onclosing=null,e.onerror=null,e.onmessage=null,e.onopen=null)};o(this.lossyDC),o(this.lossyDCSub),o(this.reliableDC),o(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0})}cleanupClient(){return __awaiter(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(t){if(this.pendingTrackResolvers[t.cid])throw new TrackInvalidError("a track with the same ID has already been published");return new Promise((o,e)=>{const n=setTimeout(()=>{delete this.pendingTrackResolvers[t.cid],e(new ConnectionError("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[t.cid]={resolve:s=>{clearTimeout(n),o(s)},reject:()=>{clearTimeout(n),e(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(t)})}removeTrack(t){if(t.track&&this.pendingTrackResolvers[t.track.id]){const{reject:o}=this.pendingTrackResolvers[t.track.id];o&&o(),delete this.pendingTrackResolvers[t.track.id]}try{return this.pcManager.removeTrack(t),!0}catch(o){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:o}))}return!1}updateMuteStatus(t,o){this.client.sendMuteTrack(t,o)}get dataSubscriberReadyState(){var t;return(t=this.reliableDCSub)===null||t===void 0?void 0:t.readyState}getConnectedServerAddress(){return __awaiter(this,void 0,void 0,function*(){var t;return(t=this.pcManager)===null||t===void 0?void 0:t.getConnectedAddress()})}setRegionUrlProvider(t){this.regionUrlProvider=t}configure(t){return __awaiter(this,void 0,void 0,function*(){var o,e;if(this.pcManager&&this.pcManager.currentState!==PCTransportState.NEW)return;this.participantSid=(o=t.participant)===null||o===void 0?void 0:o.sid;const n=this.makeRTCConfiguration(t);this.pcManager=new PCTransportManager(n,t.subscriberPrimary,this.loggerOptions),this.emit(EngineEvent.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(s,c)=>{this.client.sendIceCandidate(s,c)},this.pcManager.onPublisherOffer=s=>{this.client.sendOffer(s)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(s,c,l)=>__awaiter(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(s),this.logContext),["closed","disconnected","failed"].includes(c)&&(this.publisherConnectionPromise=void 0),s===PCTransportState.CONNECTED){const p=this.pcState===PCState.New;this.pcState=PCState.Connected,p&&this.emit(EngineEvent.Connected,t)}else s===PCTransportState.FAILED&&this.pcState===PCState.Connected&&(this.pcState=PCState.Disconnected,this.handleDisconnect("peerconnection failed",l==="failed"?ReconnectReason.RR_SUBSCRIBER_FAILED:ReconnectReason.RR_PUBLISHER_FAILED));const u=this.client.isDisconnected||this.client.currentState===SignalConnectionState.RECONNECTING,d=[PCTransportState.FAILED,PCTransportState.CLOSING,PCTransportState.CLOSED].includes(s);u&&d&&!this._isClosed&&this.emit(EngineEvent.Offline)}),this.pcManager.onTrack=s=>{this.emit(EngineEvent.MediaTrackAdded,s.track,s.streams[0],s.receiver)},supportOptionalDatachannel((e=t.serverInfo)===null||e===void 0?void 0:e.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=t=>__awaiter(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:t.type})),yield this.pcManager.setPublisherAnswer(t))}),this.client.onTrickle=(t,o)=>{this.pcManager&&(this.log.trace("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:t,target:o})),this.pcManager.addIceCandidate(t,o))},this.client.onOffer=t=>__awaiter(this,void 0,void 0,function*(){if(!this.pcManager)return;const o=yield this.pcManager.createSubscriberAnswerFromOffer(t);this.client.sendAnswer(o)}),this.client.onLocalTrackPublished=t=>{var o;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:t.cid,track:(o=t.track)===null||o===void 0?void 0:o.sid})),!this.pendingTrackResolvers[t.cid]){this.log.error("missing track resolver for ".concat(t.cid),Object.assign(Object.assign({},this.logContext),{cid:t.cid}));return}const{resolve:e}=this.pendingTrackResolvers[t.cid];delete this.pendingTrackResolvers[t.cid],e(t.track)},this.client.onLocalTrackUnpublished=t=>{this.emit(EngineEvent.LocalTrackUnpublished,t)},this.client.onLocalTrackSubscribed=t=>{this.emit(EngineEvent.LocalTrackSubscribed,t)},this.client.onTokenRefresh=t=>{this.token=t},this.client.onRemoteMuteChanged=(t,o)=>{this.emit(EngineEvent.RemoteMute,t,o)},this.client.onSubscribedQualityUpdate=t=>{this.emit(EngineEvent.SubscribedQualityUpdate,t)},this.client.onClose=()=>{this.handleDisconnect("signal",ReconnectReason.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=t=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:t==null?void 0:t.reason})),t.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(t.regions)),t.action){case LeaveRequest_Action.DISCONNECT:this.emit(EngineEvent.Disconnected,t==null?void 0:t.reason),this.close();break;case LeaveRequest_Action.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(leaveReconnect);break;case LeaveRequest_Action.RESUME:this.handleDisconnect(leaveReconnect)}}}makeRTCConfiguration(t){var o;const e=Object.assign({},this.rtcConfig);if(!((o=this.signalOpts)===null||o===void 0)&&o.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),e.encodedInsertableStreams=!0),t.iceServers&&!e.iceServers){const n=[];t.iceServers.forEach(s=>{const c={urls:s.urls};s.username&&(c.username=s.username),s.credential&&(c.credential=s.credential),n.push(c)}),e.iceServers=n}return t.clientConfiguration&&t.clientConfiguration.forceRelay===ClientConfigSetting.ENABLED&&(e.iceTransportPolicy="relay"),e.sdpSemantics="unified-plan",e.continualGatheringPolicy="gather_continually",e}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(lossyDataChannel,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(reliableDataChannel,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(t,o,e){return __awaiter(this,void 0,void 0,function*(){if(supportsTransceiver())return yield this.createTransceiverRTCRtpSender(t,o,e);if(supportsAddTrack())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(t.mediaStreamTrack);throw new UnexpectedConnectionState("Required webRTC APIs not supported on this device")})}createSimulcastSender(t,o,e,n){return __awaiter(this,void 0,void 0,function*(){if(supportsTransceiver())return this.createSimulcastTransceiverSender(t,o,e,n);if(supportsAddTrack())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(t.mediaStreamTrack);throw new UnexpectedConnectionState("Cannot stream on this device")})}createTransceiverRTCRtpSender(t,o,e){return __awaiter(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("publisher is closed");const n=[];t.mediaStream&&n.push(t.mediaStream),t instanceof LocalVideoTrack&&(t.codec=o.videoCodec);const s={direction:"sendonly",streams:n};return e&&(s.sendEncodings=e),(yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,s)).sender})}createSimulcastTransceiverSender(t,o,e,n){return __awaiter(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("publisher is closed");const s={direction:"sendonly"};n&&(s.sendEncodings=n);const c=yield this.pcManager.addPublisherTransceiver(o.mediaStreamTrack,s);if(e.videoCodec)return t.setSimulcastTrackSender(e.videoCodec,c.sender),c.sender})}createRTCRtpSender(t){return __awaiter(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("publisher is closed");return this.pcManager.addPublisherTrack(t)})}attemptReconnect(t){return __awaiter(this,void 0,void 0,function*(){var o,e,n;if(!this._isClosed){if(this.attemptingReconnect){livekitLogger.warn("already attempting reconnect, returning early",this.logContext);return}(((o=this.clientConfiguration)===null||o===void 0?void 0:o.resumeConnection)===ClientConfigSetting.DISABLED||((n=(e=this.pcManager)===null||e===void 0?void 0:e.currentState)!==null&&n!==void 0?n:PCTransportState.NEW)===PCTransportState.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(t),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let c=!0;s instanceof UnexpectedConnectionState?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),c=!1):s instanceof SignalReconnectError||(this.fullReconnectOnNext=!0),c?this.handleDisconnect("reconnect",ReconnectReason.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(EngineEvent.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(t){try{return this.reconnectPolicy.nextRetryDelayInMs(t)}catch(o){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:o}))}return null}restartConnection(t){return __awaiter(this,void 0,void 0,function*(){var o,e,n;try{if(!this.url||!this.token)throw new UnexpectedConnectionState("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(EngineEvent.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new SignalReconnectError;s=yield this.join(t??this.url,this.token,this.signalOpts)}catch(c){throw c instanceof ConnectionError&&c.reason===0?new UnexpectedConnectionState("could not reconnect, token might be expired"):new SignalReconnectError}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(EngineEvent.SignalRestarted,s),yield this.waitForPCReconnected(),this.client.currentState!==SignalConnectionState.CONNECTED)throw new SignalReconnectError("Signal connection got severed during reconnect");(o=this.regionUrlProvider)===null||o===void 0||o.resetAttempts(),this.emit(EngineEvent.Restarted)}catch(s){const c=yield(e=this.regionUrlProvider)===null||e===void 0?void 0:e.getNextBestRegionUrl();if(c){yield this.restartConnection(c);return}else throw(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),s}})}resumeConnection(t){return __awaiter(this,void 0,void 0,function*(){var o;if(!this.url||!this.token)throw new UnexpectedConnectionState("could not reconnect, url or token not saved");if(!this.pcManager)throw new UnexpectedConnectionState("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(EngineEvent.Resuming);let e;try{this.setupSignalClientCallbacks(),e=yield this.client.reconnect(this.url,this.token,this.participantSid,t)}catch(n){let s="";throw n instanceof Error&&(s=n.message,this.log.error(n.message,Object.assign(Object.assign({},this.logContext),{error:n}))),n instanceof ConnectionError&&n.reason===0?new UnexpectedConnectionState("could not reconnect, token might be expired"):n instanceof ConnectionError&&n.reason===4?n:new SignalReconnectError(s)}if(this.emit(EngineEvent.SignalResumed),e){const n=this.makeRTCConfiguration(e);this.pcManager.updateConfiguration(n)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==SignalConnectionState.CONNECTED)throw new SignalReconnectError("Signal connection got severed during reconnect");this.client.setReconnected(),((o=this.reliableDC)===null||o===void 0?void 0:o.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),this.emit(EngineEvent.Resumed)})}waitForPCInitialConnection(t,o){return __awaiter(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(o,t)})}waitForPCReconnected(){return __awaiter(this,void 0,void 0,function*(){this.pcState=PCState.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield sleep(minReconnectWait),!this.pcManager)throw new UnexpectedConnectionState("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=PCState.Connected}catch(t){throw this.pcState=PCState.Disconnected,new ConnectionError("could not establish PC connection, ".concat(t.message))}})}sendDataPacket(t,o){return __awaiter(this,void 0,void 0,function*(){const e=t.toBinary();yield this.ensurePublisherConnected(o);const n=this.dataChannelForKind(o);n&&n.send(e),this.updateAndEmitDCBufferStatus(o)})}ensureDataTransportConnected(t){return __awaiter(this,arguments,void 0,function(o){var e=this;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var s;if(!e.pcManager)throw new UnexpectedConnectionState("PC manager is closed");const c=n?e.pcManager.subscriber:e.pcManager.publisher,l=n?"Subscriber":"Publisher";if(!c)throw new ConnectionError("".concat(l," connection not set"));let u=!1;!n&&!e.dataChannelForKind(o,n)&&(e.createDataChannels(),u=!0),!u&&!n&&!e.pcManager.publisher.isICEConnected&&e.pcManager.publisher.getICEConnectionState()!=="checking"&&(u=!0),u&&e.negotiate();const d=e.dataChannelForKind(o,n);if((d==null?void 0:d.readyState)==="open")return;const p=new Date().getTime()+e.peerConnectionTimeout;for(;new Date().getTime()<p;){if(c.isICEConnected&&((s=e.dataChannelForKind(o,n))===null||s===void 0?void 0:s.readyState)==="open")return;yield sleep(50)}throw new ConnectionError("could not establish ".concat(l," connection, state: ").concat(c.getICEConnectionState()))}()})}ensurePublisherConnected(t){return __awaiter(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(t,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==PCTransportState.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return __awaiter(this,void 0,void 0,function*(){return new Promise((t,o)=>__awaiter(this,void 0,void 0,function*(){if(!this.pcManager){o(new NegotiationError("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const e=new AbortController,n=()=>{e.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),t()};this.isClosed&&o("cannot negotiate on closed engine"),this.on(EngineEvent.Closing,n),this.pcManager.publisher.once(PCEvents.RTPVideoPayloadTypes,s=>{const c=new Map;s.forEach(l=>{const u=l.codec.toLowerCase();isVideoCodec(u)&&c.set(l.payload,u)}),this.emit(EngineEvent.RTPVideoMapUpdate,c)});try{yield this.pcManager.negotiate(e),t()}catch(s){s instanceof NegotiationError&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",ReconnectReason.RR_UNKNOWN),o(s)}finally{this.off(EngineEvent.Closing,n)}}))})}dataChannelForKind(t,o){if(o){if(t===DataPacket_Kind.LOSSY)return this.lossyDCSub;if(t===DataPacket_Kind.RELIABLE)return this.reliableDCSub}else{if(t===DataPacket_Kind.LOSSY)return this.lossyDC;if(t===DataPacket_Kind.RELIABLE)return this.reliableDC}}sendSyncState(t,o){var e,n;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const s=this.pcManager.subscriber.getLocalDescription(),c=this.pcManager.subscriber.getRemoteDescription(),l=(n=(e=this.signalOpts)===null||e===void 0?void 0:e.autoSubscribe)!==null&&n!==void 0?n:!0,u=new Array,d=new Array;t.forEach(p=>{p.isDesired!==l&&u.push(p.trackSid),p.isEnabled||d.push(p.trackSid)}),this.client.sendSyncState(new SyncState({answer:s?toProtoSessionDescription({sdp:s.sdp,type:s.type}):void 0,offer:c?toProtoSessionDescription({sdp:c.sdp,type:c.type}):void 0,subscription:new UpdateSubscription({trackSids:u,subscribe:!l,participantTracks:[]}),publishTracks:getTrackPublicationInfo(o),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:d}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const t=[],o=(e,n)=>{(e==null?void 0:e.id)!==void 0&&e.id!==null&&t.push(new DataChannelInfo({label:e.label,id:e.id,target:n}))};return o(this.dataChannelForKind(DataPacket_Kind.LOSSY),SignalTarget.PUBLISHER),o(this.dataChannelForKind(DataPacket_Kind.RELIABLE),SignalTarget.PUBLISHER),o(this.dataChannelForKind(DataPacket_Kind.LOSSY,!0),SignalTarget.SUBSCRIBER),o(this.dataChannelForKind(DataPacket_Kind.RELIABLE,!0),SignalTarget.SUBSCRIBER),t}clearReconnectTimeout(){this.reconnectTimeout&&CriticalTimers.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){isWeb()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){isWeb()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class SignalReconnectError extends Error{}function supportOptionalDatachannel(a){return a!==void 0&&a>13}function applyUserDataCompat(a,t){const o=a.participantIdentity?a.participantIdentity:t.participantIdentity;a.participantIdentity=o,t.participantIdentity=o;const e=a.destinationIdentities.length!==0?a.destinationIdentities:t.destinationIdentities;a.destinationIdentities=e,t.destinationIdentities=e}class RegionUrlProvider{constructor(t,o){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(t),this.token=o}updateToken(t){this.token=t}isCloud(){return isCloud(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(t){return __awaiter(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(t));const o=this.regionSettings.regions.filter(e=>!this.attemptedRegions.find(n=>n.url===e.url));if(o.length>0){const e=o[0];return this.attemptedRegions.push(e),livekitLogger.debug("next region: ".concat(e.region)),e.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(t){return __awaiter(this,void 0,void 0,function*(){const o=yield fetch("".concat(getCloudConfigUrl(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:t});if(o.ok){const e=yield o.json();return this.lastUpdateAt=Date.now(),e}else throw new ConnectionError("Could not fetch region settings: ".concat(o.statusText),o.status===401?0:void 0,o.status)})}setServerReportedRegions(t){this.regionSettings=t,this.lastUpdateAt=Date.now()}}function getCloudConfigUrl(a){return"".concat(a.protocol.replace("ws","http"),"//").concat(a.host,"/settings")}class RemoteTrack extends Track{constructor(t,o,e,n,s){super(t,e,s),this.sid=o,this.receiver=n}setMuted(t){this.isMuted!==t&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?TrackEvent.Muted:TrackEvent.Unmuted,this))}setMediaStream(t){this.mediaStream=t;const o=e=>{e.track===this._mediaStreamTrack&&(t.removeEventListener("removetrack",o),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(TrackEvent.Ended,this))};t.addEventListener("removetrack",o)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return __awaiter(this,void 0,void 0,function*(){var t;return!((t=this.receiver)===null||t===void 0)&&t.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(t){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=t:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),monitorFrequency)),supportsSynchronizationSources()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const t=()=>{var o;this.timeSyncHandle=requestAnimationFrame(()=>t());const e=(o=this.receiver)===null||o===void 0?void 0:o.getSynchronizationSources()[0];if(e){const{timestamp:n,rtpTimestamp:s}=e;s&&this.rtpTimestamp!==s&&(this.emit(TrackEvent.TimeSyncUpdate,{timestamp:n,rtpTimestamp:s}),this.rtpTimestamp=s)}};t()}}class RemoteAudioTrack extends RemoteTrack{constructor(t,o,e,n,s,c){super(t,o,Track.Kind.Audio,e,c),this.monitorReceiver=()=>__awaiter(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const l=yield this.getReceiverStats();l&&this.prevStats&&this.receiver&&(this._currentBitrate=computeBitrate(l,this.prevStats)),this.prevStats=l}),this.audioContext=n,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(t){var o;for(const e of this.attachedElements)this.audioContext?(o=this.gainNode)===null||o===void 0||o.gain.setTargetAtTime(t,0,.1):e.volume=t;isReactNative()&&this._mediaStreamTrack._setVolume(t),this.elementVolume=t}getVolume(){if(this.elementVolume)return this.elementVolume;if(isReactNative())return 1;let t=0;return this.attachedElements.forEach(o=>{o.volume>t&&(t=o.volume)}),t}setSinkId(t){return __awaiter(this,void 0,void 0,function*(){this.sinkId=t,yield Promise.all(this.attachedElements.map(o=>{if(supportsSetSinkId(o))return o.setSinkId(t)}))})}attach(t){const o=this.attachedElements.length===0;return t?super.attach(t):t=super.attach(),this.sinkId&&supportsSetSinkId(t)&&t.setSinkId(this.sinkId),this.audioContext&&o&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,t),t.volume=0,t.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),t}detach(t){let o;return t?(o=super.detach(t),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(o=super.detach(),this.disconnectWebAudio()),o}setAudioContext(t){this.audioContext=t,t&&this.attachedElements.length>0?this.connectWebAudio(t,this.attachedElements[0]):t||this.disconnectWebAudio()}setWebAudioPlugins(t){this.webAudioPluginNodes=t,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(t,o){this.disconnectWebAudio(),this.sourceNode=t.createMediaStreamSource(o.srcObject);let e=this.sourceNode;this.webAudioPluginNodes.forEach(n=>{e.connect(n),e=n}),this.gainNode=t.createGain(),e.connect(this.gainNode),this.gainNode.connect(t.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),t.state!=="running"&&t.resume().then(()=>{t.state!=="running"&&this.emit(TrackEvent.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(n=>{this.emit(TrackEvent.AudioPlaybackFailed,n)})}disconnectWebAudio(){var t,o;(t=this.gainNode)===null||t===void 0||t.disconnect(),(o=this.sourceNode)===null||o===void 0||o.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return __awaiter(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const t=yield this.receiver.getStats();let o;return t.forEach(e=>{e.type==="inbound-rtp"&&(o={type:"audio",timestamp:e.timestamp,jitter:e.jitter,bytesReceived:e.bytesReceived,concealedSamples:e.concealedSamples,concealmentEvents:e.concealmentEvents,silentConcealedSamples:e.silentConcealedSamples,silentConcealmentEvents:e.silentConcealmentEvents,totalAudioEnergy:e.totalAudioEnergy,totalSamplesDuration:e.totalSamplesDuration})}),o})}}const REACTION_DELAY=100;class RemoteVideoTrack extends RemoteTrack{constructor(t,o,e,n,s){super(t,o,Track.Kind.Video,e,s),this.elementInfos=[],this.monitorReceiver=()=>__awaiter(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const c=yield this.getReceiverStats();c&&this.prevStats&&this.receiver&&(this._currentBitrate=computeBitrate(c,this.prevStats)),this.prevStats=c}),this.debouncedHandleResize=r(()=>{this.updateDimensions()},REACTION_DELAY),this.adaptiveStreamSettings=n}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(t){super.setMuted(t),this.attachedElements.forEach(o=>{t?detachTrack(this._mediaStreamTrack,o):attachToElement(this._mediaStreamTrack,o)})}attach(t){if(t?super.attach(t):t=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(o=>o.element===t)===void 0){const o=new HTMLElementInfo(t);this.observeElementInfo(o)}return t}observeElementInfo(t){this.adaptiveStreamSettings&&this.elementInfos.find(o=>o===t)===void 0?(t.handleResize=()=>{this.debouncedHandleResize()},t.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(t),t.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(t){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const o=this.elementInfos.filter(e=>e===t);for(const e of o)e.stopObserving();this.elementInfos=this.elementInfos.filter(e=>e!==t),this.updateVisibility(),this.debouncedHandleResize()}detach(t){let o=[];if(t)return this.stopObservingElement(t),super.detach(t);o=super.detach();for(const e of o)this.stopObservingElement(e);return o}getDecoderImplementation(){var t;return(t=this.prevStats)===null||t===void 0?void 0:t.decoderImplementation}getReceiverStats(){return __awaiter(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const t=yield this.receiver.getStats();let o,e="",n=new Map;return t.forEach(s=>{s.type==="inbound-rtp"?(e=s.codecId,o={type:"video",framesDecoded:s.framesDecoded,framesDropped:s.framesDropped,framesReceived:s.framesReceived,packetsReceived:s.packetsReceived,packetsLost:s.packetsLost,frameWidth:s.frameWidth,frameHeight:s.frameHeight,pliCount:s.pliCount,firCount:s.firCount,nackCount:s.nackCount,jitter:s.jitter,timestamp:s.timestamp,bytesReceived:s.bytesReceived,decoderImplementation:s.decoderImplementation}):s.type==="codec"&&n.set(s.id,s)}),o&&e!==""&&n.get(e)&&(o.mimeType=n.get(e).mimeType),o})}stopObservingElement(t){const o=this.elementInfos.filter(e=>e.element===t);for(const e of o)this.stopObservingElementInfo(e)}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return __awaiter(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var t,o;const e=this.elementInfos.reduce((l,u)=>Math.max(l,u.visibilityChangedAt||0),0),n=!((o=(t=this.adaptiveStreamSettings)===null||t===void 0?void 0:t.pauseVideoInBackground)!==null&&o!==void 0)||o?this.isInBackground:!1,s=this.elementInfos.some(l=>l.pictureInPicture),c=this.elementInfos.some(l=>l.visible)&&!n||s;if(this.lastVisible!==c){if(!c&&Date.now()-e<REACTION_DELAY){CriticalTimers.setTimeout(()=>{this.updateVisibility()},REACTION_DELAY);return}this.lastVisible=c,this.emit(TrackEvent.VisibilityChanged,c,this)}}updateDimensions(){var t,o;let e=0,n=0;const s=this.getPixelDensity();for(const c of this.elementInfos){const l=c.width()*s,u=c.height()*s;l+u>e+n&&(e=l,n=u)}((t=this.lastDimensions)===null||t===void 0?void 0:t.width)===e&&((o=this.lastDimensions)===null||o===void 0?void 0:o.height)===n||(this.lastDimensions={width:e,height:n},this.emit(TrackEvent.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var t;const o=(t=this.adaptiveStreamSettings)===null||t===void 0?void 0:t.pixelDensity;return o==="screen"?getDevicePixelRatio():o||(getDevicePixelRatio()>2?2:1)}}class HTMLElementInfo{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(t,o){this.onVisibilityChanged=e=>{var n;const{target:s,isIntersecting:c}=e;s===this.element&&(this.isIntersecting=c,this.visibilityChangedAt=Date.now(),(n=this.handleVisibilityChanged)===null||n===void 0||n.call(this))},this.onEnterPiP=()=>{var e;this.isPiP=!0,(e=this.handleVisibilityChanged)===null||e===void 0||e.call(this)},this.onLeavePiP=()=>{var e;this.isPiP=!1,(e=this.handleVisibilityChanged)===null||e===void 0||e.call(this)},this.element=t,this.isIntersecting=o??isElementInViewport(t),this.isPiP=isWeb()&&document.pictureInPictureElement===t,this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){this.isIntersecting=isElementInViewport(this.element),this.isPiP=document.pictureInPictureElement===this.element,this.element.handleResize=()=>{var t;(t=this.handleResize)===null||t===void 0||t.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,getIntersectionObserver().observe(this.element),getResizeObserver().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP)}stopObserving(){var t,o;(t=getIntersectionObserver())===null||t===void 0||t.unobserve(this.element),(o=getResizeObserver())===null||o===void 0||o.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP)}}function isElementInViewport(a){let t=a.offsetTop,o=a.offsetLeft;const e=a.offsetWidth,n=a.offsetHeight,{hidden:s}=a,{opacity:c,display:l}=getComputedStyle(a);for(;a.offsetParent;)a=a.offsetParent,t+=a.offsetTop,o+=a.offsetLeft;return t<window.pageYOffset+window.innerHeight&&o<window.pageXOffset+window.innerWidth&&t+n>window.pageYOffset&&o+e>window.pageXOffset&&!s&&(c!==""?parseFloat(c)>0:!0)&&l!=="none"}class TrackPublication extends eventsExports.EventEmitter{constructor(t,o,e,n){var s;super(),this.metadataMuted=!1,this.encryption=Encryption_Type.NONE,this.log=livekitLogger,this.handleMuted=()=>{this.emit(TrackEvent.Muted)},this.handleUnmuted=()=>{this.emit(TrackEvent.Unmuted)},this.log=getLogger((s=n==null?void 0:n.loggerName)!==null&&s!==void 0?s:LoggerNames.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=t,this.trackSid=o,this.trackName=e,this.source=Track.Source.Unknown}setTrack(t){this.track&&(this.track.off(TrackEvent.Muted,this.handleMuted),this.track.off(TrackEvent.Unmuted,this.handleUnmuted)),this.track=t,t&&(t.on(TrackEvent.Muted,this.handleMuted),t.on(TrackEvent.Unmuted,this.handleUnmuted))}get logContext(){var t;return Object.assign(Object.assign({},(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this)),getLogContextFromTrack(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==Encryption_Type.NONE}get audioTrack(){if(this.track instanceof LocalAudioTrack||this.track instanceof RemoteAudioTrack)return this.track}get videoTrack(){if(this.track instanceof LocalVideoTrack||this.track instanceof RemoteVideoTrack)return this.track}updateInfo(t){this.trackSid=t.sid,this.trackName=t.name,this.source=Track.sourceFromProto(t.source),this.mimeType=t.mimeType,this.kind===Track.Kind.Video&&t.width>0&&(this.dimensions={width:t.width,height:t.height},this.simulcasted=t.simulcast),this.encryption=t.encryption,this.trackInfo=t,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:t}))}}(function(a){(function(t){t.Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed"})(a.SubscriptionStatus||(a.SubscriptionStatus={})),function(t){t.Allowed="allowed",t.NotAllowed="not_allowed"}(a.PermissionStatus||(a.PermissionStatus={}))})(TrackPublication||(TrackPublication={}));class LocalTrackPublication extends TrackPublication{get isUpstreamPaused(){var t;return(t=this.track)===null||t===void 0?void 0:t.isUpstreamPaused}constructor(t,o,e,n){super(t,o.sid,o.name,n),this.track=void 0,this.handleTrackEnded=()=>{this.emit(TrackEvent.Ended)},this.updateInfo(o),this.setTrack(e)}setTrack(t){this.track&&this.track.off(TrackEvent.Ended,this.handleTrackEnded),super.setTrack(t),t&&t.on(TrackEvent.Ended,this.handleTrackEnded)}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}mute(){return __awaiter(this,void 0,void 0,function*(){var t;return(t=this.track)===null||t===void 0?void 0:t.mute()})}unmute(){return __awaiter(this,void 0,void 0,function*(){var t;return(t=this.track)===null||t===void 0?void 0:t.unmute()})}pauseUpstream(){return __awaiter(this,void 0,void 0,function*(){var t;yield(t=this.track)===null||t===void 0?void 0:t.pauseUpstream()})}resumeUpstream(){return __awaiter(this,void 0,void 0,function*(){var t;yield(t=this.track)===null||t===void 0?void 0:t.resumeUpstream()})}getTrackFeatures(){var t;if(this.track instanceof LocalAudioTrack){const o=this.track.mediaStreamTrack.getSettings(),e=new Set;return o.autoGainControl&&e.add(AudioTrackFeature.TF_AUTO_GAIN_CONTROL),o.echoCancellation&&e.add(AudioTrackFeature.TF_ECHO_CANCELLATION),o.noiseSuppression&&e.add(AudioTrackFeature.TF_NOISE_SUPPRESSION),o.channelCount&&o.channelCount>1&&e.add(AudioTrackFeature.TF_STEREO),!((t=this.options)===null||t===void 0)&&t.dtx||e.add(AudioTrackFeature.TF_STEREO),this.track.enhancedNoiseCancellation&&e.add(AudioTrackFeature.TF_ENHANCED_NOISE_CANCELLATION),Array.from(e.values())}else return[]}}var ConnectionQuality;(function(a){a.Excellent="excellent",a.Good="good",a.Poor="poor",a.Lost="lost",a.Unknown="unknown"})(ConnectionQuality||(ConnectionQuality={}));function qualityFromProto(a){switch(a){case ConnectionQuality$1.EXCELLENT:return ConnectionQuality.Excellent;case ConnectionQuality$1.GOOD:return ConnectionQuality.Good;case ConnectionQuality$1.POOR:return ConnectionQuality.Poor;case ConnectionQuality$1.LOST:return ConnectionQuality.Lost;default:return ConnectionQuality.Unknown}}class Participant extends eventsExports.EventEmitter{get logContext(){var t,o;return Object.assign({},(o=(t=this.loggerOptions)===null||t===void 0?void 0:t.loggerContextCb)===null||o===void 0?void 0:o.call(t))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(t=>t.isEncrypted)}get isAgent(){var t;return((t=this.permissions)===null||t===void 0?void 0:t.agent)||this.kind===ParticipantInfo_Kind.AGENT}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(t,o,e,n,s){let c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:ParticipantInfo_Kind.STANDARD;var l;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=ConnectionQuality.Unknown,this.log=livekitLogger,this.log=getLogger((l=s==null?void 0:s.loggerName)!==null&&l!==void 0?l:LoggerNames.Participant),this.loggerOptions=s,this.setMaxListeners(100),this.sid=t,this.identity=o,this.name=e,this.metadata=n,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=c,this._attributes={}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(t){for(const[,o]of this.trackPublications)if(o.source===t)return o}getTrackPublicationByName(t){for(const[,o]of this.trackPublications)if(o.trackName===t)return o}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var t;const o=this.getTrackPublication(Track.Source.Camera);return!(!((t=o==null?void 0:o.isMuted)!==null&&t!==void 0)||t)}get isMicrophoneEnabled(){var t;const o=this.getTrackPublication(Track.Source.Microphone);return!(!((t=o==null?void 0:o.isMuted)!==null&&t!==void 0)||t)}get isScreenShareEnabled(){return!!this.getTrackPublication(Track.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(t){return this.participantInfo&&this.participantInfo.sid===t.sid&&this.participantInfo.version>t.version?!1:(this.identity=t.identity,this.sid=t.sid,this._setName(t.name),this._setMetadata(t.metadata),this._setAttributes(t.attributes),t.permission&&this.setPermissions(t.permission),this.participantInfo=t,this.log.trace("update participant info",Object.assign(Object.assign({},this.logContext),{info:t})),!0)}_setMetadata(t){const o=this.metadata!==t,e=this.metadata;this.metadata=t,o&&this.emit(ParticipantEvent.ParticipantMetadataChanged,e)}_setName(t){const o=this.name!==t;this.name=t,o&&this.emit(ParticipantEvent.ParticipantNameChanged,t)}_setAttributes(t){const o=diffAttributes(t,this.attributes);this._attributes=t,Object.keys(o).length>0&&this.emit(ParticipantEvent.AttributesChanged,o)}setPermissions(t){var o,e,n,s,c;const l=this.permissions,u=t.canPublish!==((o=this.permissions)===null||o===void 0?void 0:o.canPublish)||t.canSubscribe!==((e=this.permissions)===null||e===void 0?void 0:e.canSubscribe)||t.canPublishData!==((n=this.permissions)===null||n===void 0?void 0:n.canPublishData)||t.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||t.recorder!==((c=this.permissions)===null||c===void 0?void 0:c.recorder)||t.canPublishSources.length!==this.permissions.canPublishSources.length||t.canPublishSources.some((d,p)=>{var g;return d!==((g=this.permissions)===null||g===void 0?void 0:g.canPublishSources[p])});return this.permissions=t,u&&this.emit(ParticipantEvent.ParticipantPermissionsChanged,l),u}setIsSpeaking(t){t!==this.isSpeaking&&(this.isSpeaking=t,t&&(this.lastSpokeAt=new Date),this.emit(ParticipantEvent.IsSpeakingChanged,t))}setConnectionQuality(t){const o=this._connectionQuality;this._connectionQuality=qualityFromProto(t),o!==this._connectionQuality&&this.emit(ParticipantEvent.ConnectionQualityChanged,this._connectionQuality)}setAudioContext(t){this.audioContext=t,this.audioTrackPublications.forEach(o=>(o.track instanceof RemoteAudioTrack||o.track instanceof LocalAudioTrack)&&o.track.setAudioContext(t))}addTrackPublication(t){t.on(TrackEvent.Muted,()=>{this.emit(ParticipantEvent.TrackMuted,t)}),t.on(TrackEvent.Unmuted,()=>{this.emit(ParticipantEvent.TrackUnmuted,t)});const o=t;switch(o.track&&(o.track.sid=t.trackSid),this.trackPublications.set(t.trackSid,t),t.kind){case Track.Kind.Audio:this.audioTrackPublications.set(t.trackSid,t);break;case Track.Kind.Video:this.videoTrackPublications.set(t.trackSid,t);break}}}function trackPermissionToProto(a){var t,o,e;if(!a.participantSid&&!a.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new TrackPermission({participantIdentity:(t=a.participantIdentity)!==null&&t!==void 0?t:"",participantSid:(o=a.participantSid)!==null&&o!==void 0?o:"",allTracks:(e=a.allowAll)!==null&&e!==void 0?e:!1,trackSids:a.allowedTrackSids||[]})}class LocalParticipant extends Participant{constructor(t,o,e,n){super(t,o,void 0,void 0,{loggerName:n.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Encryption_Type.NONE,this.enabledPublishVideoCodecs=[],this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Future)},this.handleReconnected=()=>{var s,c;(c=(s=this.reconnectFuture)===null||s===void 0?void 0:s.resolve)===null||c===void 0||c.call(s),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var s,c;this.reconnectFuture&&(this.reconnectFuture.promise.catch(l=>this.log.warn(l.message,this.logContext)),(c=(s=this.reconnectFuture)===null||s===void 0?void 0:s.reject)===null||c===void 0||c.call(s,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0)},this.handleSignalRequestResponse=s=>{const{requestId:c,reason:l,message:u}=s,d=this.pendingSignalRequests.get(c);d&&(l!==RequestResponse_Reason.OK&&d.reject(new SignalRequestError(u,l)),this.pendingSignalRequests.delete(c))},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(s=>trackPermissionToProto(s)))},this.onTrackUnmuted=s=>{this.onTrackMuted(s,s.isUpstreamPaused)},this.onTrackMuted=(s,c)=>{if(c===void 0&&(c=!0),!s.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(s)));return}this.engine.updateMuteStatus(s.sid,c)},this.onTrackUpstreamPaused=s=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(s))),this.onTrackMuted(s,!0)},this.onTrackUpstreamResumed=s=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(s))),this.onTrackMuted(s,s.isMuted)},this.onTrackFeatureUpdate=s=>{const c=this.audioTrackPublications.get(s.sid);if(!c){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(s.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(c.trackSid,c.getTrackFeatures())},this.handleSubscribedQualityUpdate=s=>__awaiter(this,void 0,void 0,function*(){var c,l,u,d,p,g;if(!(!((p=this.roomOptions)===null||p===void 0)&&p.dynacast))return;const y=this.videoTrackPublications.get(s.trackSid);if(!y){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:s.trackSid}));return}if(s.subscribedCodecs.length>0){if(!y.videoTrack)return;const O=yield y.videoTrack.setPublishingCodecs(s.subscribedCodecs);try{for(var T=!0,b=__asyncValues(O),k;k=yield b.next(),c=k.done,!c;T=!0){d=k.value,T=!1;const C=d;isBackupCodec(C)&&(this.log.debug("publish ".concat(C," for ").concat(y.videoTrack.sid),Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(y))),yield this.publishAdditionalCodecForTrack(y.videoTrack,C,y.options))}}catch(C){l={error:C}}finally{try{!T&&!c&&(u=b.return)&&(yield u.call(b))}finally{if(l)throw l.error}}}else s.subscribedQualities.length>0&&(yield(g=y.videoTrack)===null||g===void 0?void 0:g.setPublishingLayers(s.subscribedQualities))}),this.handleLocalTrackUnpublished=s=>{const c=this.trackPublications.get(s.trackSid);if(!c){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:s.trackSid}));return}this.unpublishTrack(c.track)},this.handleTrackEnded=s=>__awaiter(this,void 0,void 0,function*(){if(s.source===Track.Source.ScreenShare||s.source===Track.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(s))),this.unpublishTrack(s);else if(s.isUserProvided)yield s.mute();else if(s instanceof LocalAudioTrack||s instanceof LocalVideoTrack)try{if(isWeb())try{const c=yield navigator==null?void 0:navigator.permissions.query({name:s.source===Track.Source.Camera?"camera":"microphone"});if(c&&c.state==="denied")throw this.log.warn("user has revoked access to ".concat(s.source),Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(s))),c.onchange=()=>{c.state!=="denied"&&(s.isMuted||s.restartTrack(),c.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}s.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(s))),yield s.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(s))),yield s.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=e,this.roomOptions=n,this.setupEngine(e),this.activeDeviceMap=new Map,this.pendingSignalRequests=new Map}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Encryption_Type.NONE}getTrackPublication(t){const o=super.getTrackPublication(t);if(o)return o}getTrackPublicationByName(t){const o=super.getTrackPublicationByName(t);if(o)return o}setupEngine(t){this.engine=t,this.engine.on(EngineEvent.RemoteMute,(o,e)=>{const n=this.trackPublications.get(o);!n||!n.track||(e?n.mute():n.unmute())}),this.engine.on(EngineEvent.Connected,this.handleReconnected).on(EngineEvent.SignalRestarted,this.handleReconnected).on(EngineEvent.SignalResumed,this.handleReconnected).on(EngineEvent.Restarting,this.handleReconnecting).on(EngineEvent.Resuming,this.handleReconnecting).on(EngineEvent.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(EngineEvent.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(EngineEvent.Disconnected,this.handleDisconnected).on(EngineEvent.SignalRequestResponse,this.handleSignalRequestResponse)}setMetadata(t){return __awaiter(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:t})})}setName(t){return __awaiter(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:t})})}setAttributes(t){return __awaiter(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:t})})}requestMetadataUpdate(t){return __awaiter(this,arguments,void 0,function(o){var e=this;let{metadata:n,name:s,attributes:c}=o;return function*(){return new Promise((l,u)=>__awaiter(e,void 0,void 0,function*(){var d,p;try{let g=!1;const y=yield this.engine.client.sendUpdateLocalMetadata((d=n??this.metadata)!==null&&d!==void 0?d:"",(p=s??this.name)!==null&&p!==void 0?p:"",c),T=performance.now();for(this.pendingSignalRequests.set(y,{resolve:l,reject:b=>{u(b),g=!0},values:{name:s,metadata:n,attributes:c}});performance.now()-T<5e3&&!g;){if((!s||this.name===s)&&(!n||this.metadata===n)&&(!c||Object.entries(c).every(b=>{let[k,O]=b;return this.attributes[k]===O}))){this.pendingSignalRequests.delete(y),l();return}yield sleep(50)}u(new SignalRequestError("Request to update local metadata timed out","TimeoutError"))}catch(g){g instanceof Error&&u(g)}}))}()})}setCameraEnabled(t,o,e){return this.setTrackEnabled(Track.Source.Camera,t,o,e)}setMicrophoneEnabled(t,o,e){return this.setTrackEnabled(Track.Source.Microphone,t,o,e)}setScreenShareEnabled(t,o,e){return this.setTrackEnabled(Track.Source.ScreenShare,t,o,e)}setPermissions(t){const o=this.permissions,e=super.setPermissions(t);return e&&o&&this.emit(ParticipantEvent.ParticipantPermissionsChanged,o),e}setE2EEEnabled(t){return __awaiter(this,void 0,void 0,function*(){this.encryptionType=t?Encryption_Type.GCM:Encryption_Type.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(t,o,e,n){return __awaiter(this,void 0,void 0,function*(){var s,c;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:t,enabled:o}));let l=this.getTrackPublication(t);if(o)if(l)yield l.unmute();else{let u;if(this.pendingPublishing.has(t)){this.log.info("skipping duplicate published source",Object.assign(Object.assign({},this.logContext),{source:t}));return}this.pendingPublishing.add(t);try{switch(t){case Track.Source.Camera:u=yield this.createTracks({video:(s=e)!==null&&s!==void 0?s:!0});break;case Track.Source.Microphone:u=yield this.createTracks({audio:(c=e)!==null&&c!==void 0?c:!0});break;case Track.Source.ScreenShare:u=yield this.createScreenTracks(Object.assign({},e));break;default:throw new TrackInvalidError(t)}const d=[];for(const g of u)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(g))),d.push(this.publishTrack(g,n));[l]=yield Promise.all(d)}catch(d){throw u==null||u.forEach(p=>{p.stop()}),d instanceof Error&&!(d instanceof TrackInvalidError)&&this.emit(ParticipantEvent.MediaDevicesError,d),d}finally{this.pendingPublishing.delete(t)}}else if(l&&l.track)if(t===Track.Source.ScreenShare){l=yield this.unpublishTrack(l.track);const u=this.getTrackPublication(Track.Source.ScreenShareAudio);u&&u.track&&this.unpublishTrack(u.track)}else yield l.mute();return l})}enableCameraAndMicrophone(){return __awaiter(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(Track.Source.Camera)||this.pendingPublishing.has(Track.Source.Microphone))){this.pendingPublishing.add(Track.Source.Camera),this.pendingPublishing.add(Track.Source.Microphone);try{const t=yield this.createTracks({audio:!0,video:!0});yield Promise.all(t.map(o=>this.publishTrack(o)))}finally{this.pendingPublishing.delete(Track.Source.Camera),this.pendingPublishing.delete(Track.Source.Microphone)}}})}createTracks(t){return __awaiter(this,void 0,void 0,function*(){var o,e;const n=mergeDefaultOptions(t,(o=this.roomOptions)===null||o===void 0?void 0:o.audioCaptureDefaults,(e=this.roomOptions)===null||e===void 0?void 0:e.videoCaptureDefaults),s=constraintsForOptions(n);let c;try{c=yield navigator.mediaDevices.getUserMedia(s)}catch(l){throw l instanceof Error&&(s.audio&&(this.microphoneError=l),s.video&&(this.cameraError=l)),l}return s.audio&&(this.microphoneError=void 0,this.emit(ParticipantEvent.AudioStreamAcquired)),s.video&&(this.cameraError=void 0),Promise.all(c.getTracks().map(l=>__awaiter(this,void 0,void 0,function*(){const u=l.kind==="audio";let d=u?n.audio:n.video;(typeof d=="boolean"||!d)&&(d={});let p;const g=u?s.audio:s.video;typeof g!="boolean"&&(p=g);const y=mediaTrackToLocalTrack(l,p,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return y.kind===Track.Kind.Video?y.source=Track.Source.Camera:y.kind===Track.Kind.Audio&&(y.source=Track.Source.Microphone,y.setAudioContext(this.audioContext)),y.mediaStream=c,d.processor&&(y instanceof LocalAudioTrack?yield y.setProcessor(d.processor):yield y.setProcessor(d.processor)),y})))})}createScreenTracks(t){return __awaiter(this,void 0,void 0,function*(){if(t===void 0&&(t={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new DeviceUnsupportedError("getDisplayMedia not supported");t.resolution===void 0&&!isSafari17()&&(t.resolution=ScreenSharePresets.h1080fps30.resolution);const o=screenCaptureToDisplayMediaStreamOptions(t),e=yield navigator.mediaDevices.getDisplayMedia(o),n=e.getVideoTracks();if(n.length===0)throw new TrackInvalidError("no video track found");const s=new LocalVideoTrack(n[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=Track.Source.ScreenShare,t.contentHint&&(s.mediaStreamTrack.contentHint=t.contentHint);const c=[s];if(e.getAudioTracks().length>0){this.emit(ParticipantEvent.AudioStreamAcquired);const l=new LocalAudioTrack(e.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});l.source=Track.Source.ScreenShareAudio,c.push(l)}return c})}publishTrack(t,o){return __awaiter(this,void 0,void 0,function*(){var e,n,s,c;t instanceof LocalAudioTrack&&t.setAudioContext(this.audioContext),yield(e=this.reconnectFuture)===null||e===void 0?void 0:e.promise,t instanceof LocalTrack&&this.pendingPublishPromises.has(t)&&(yield this.pendingPublishPromises.get(t));let l;if(t instanceof MediaStreamTrack)l=t.getConstraints();else{l=t.constraints;let T;switch(t.source){case Track.Source.Microphone:T="audioinput";break;case Track.Source.Camera:T="videoinput"}T&&this.activeDeviceMap.has(T)&&(l=Object.assign(Object.assign({},l),{deviceId:this.activeDeviceMap.get(T)}))}if(t instanceof MediaStreamTrack)switch(t.kind){case"audio":t=new LocalAudioTrack(t,l,!0,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});break;case"video":t=new LocalVideoTrack(t,l,!0,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});break;default:throw new TrackInvalidError("unsupported MediaStreamTrack kind ".concat(t.kind))}else t.updateLoggerOptions({loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});let u;if(this.trackPublications.forEach(T=>{T.track&&T.track===t&&(u=T)}),u)return this.log.warn("track has already been published, skipping",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(u))),u;const d="channelCount"in t.mediaStreamTrack.getSettings()&&t.mediaStreamTrack.getSettings().channelCount===2||t.mediaStreamTrack.getConstraints().channelCount===2,p=(n=o==null?void 0:o.forceStereo)!==null&&n!==void 0?n:d;p&&(o||(o={}),o.dtx===void 0&&this.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(t))),o.red===void 0&&this.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(s=o.dtx)!==null&&s!==void 0||(o.dtx=!1),(c=o.red)!==null&&c!==void 0||(o.red=!1));const g=Object.assign(Object.assign({},this.roomOptions.publishDefaults),o);!isE2EESimulcastSupported()&&this.roomOptions.e2ee&&(this.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},this.logContext)),g.simulcast=!1),g.source&&(t.source=g.source);const y=this.publish(t,g,p);this.pendingPublishPromises.set(t,y);try{return yield y}catch(T){throw T}finally{this.pendingPublishPromises.delete(t)}})}publish(t,o,e){return __awaiter(this,void 0,void 0,function*(){var n,s,c,l,u,d,p,g,y,T;Array.from(this.trackPublications.values()).find(P=>t instanceof LocalTrack&&P.source===t.source)&&t.source!==Track.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(t.source),Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(t))),o.stopMicTrackOnMute&&t instanceof LocalAudioTrack&&(t.stopOnMute=!0),t.source===Track.Source.ScreenShare&&isFireFox()&&(o.simulcast=!1),o.videoCodec==="av1"&&!supportsAV1()&&(o.videoCodec=void 0),o.videoCodec==="vp9"&&!supportsVP9()&&(o.videoCodec=void 0),o.videoCodec===void 0&&(o.videoCodec=defaultVideoCodec),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(P=>o.videoCodec===mimeTypeToVideoCodecString(P.mime))||(o.videoCodec=mimeTypeToVideoCodecString(this.enabledPublishVideoCodecs[0].mime)));const k=o.videoCodec;t.on(TrackEvent.Muted,this.onTrackMuted),t.on(TrackEvent.Unmuted,this.onTrackUnmuted),t.on(TrackEvent.Ended,this.handleTrackEnded),t.on(TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),t.on(TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed),t.on(TrackEvent.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const O=new AddTrackRequest({cid:t.mediaStreamTrack.id,name:o.name,type:Track.kindToProto(t.kind),muted:t.isMuted,source:Track.sourceToProto(t.source),disableDtx:!(!((n=o.dtx)!==null&&n!==void 0)||n),encryption:this.encryptionType,stereo:e,disableRed:this.isE2EEEnabled||!(!((s=o.red)!==null&&s!==void 0)||s),stream:o==null?void 0:o.stream});let C;if(t.kind===Track.Kind.Video){let P={width:0,height:0};try{P=yield t.waitForDimensions()}catch{const j=(l=(c=this.roomOptions.videoCaptureDefaults)===null||c===void 0?void 0:c.resolution)!==null&&l!==void 0?l:VideoPresets.h720.resolution;P={width:j.width,height:j.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(t)),{dims:P}))}O.width=P.width,O.height=P.height,t instanceof LocalVideoTrack&&(isSVCCodec(k)&&(t.source===Track.Source.ScreenShare&&(o.scalabilityMode="L1T3","contentHint"in t.mediaStreamTrack&&(t.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(t))))),o.scalabilityMode=(u=o.scalabilityMode)!==null&&u!==void 0?u:"L3T3_KEY"),O.simulcastCodecs=[new SimulcastCodec({codec:k,cid:t.mediaStreamTrack.id})],o.backupCodec===!0&&(o.backupCodec={codec:defaultVideoCodec}),o.backupCodec&&k!==o.backupCodec.codec&&O.encryption===Encryption_Type.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),O.simulcastCodecs.push(new SimulcastCodec({codec:o.backupCodec.codec,cid:""})))),C=computeVideoEncodings(t.source===Track.Source.ScreenShare,O.width,O.height,o),O.layers=videoLayersFromEncodings(O.width,O.height,C,isSVCCodec(o.videoCodec))}else t.kind===Track.Kind.Audio&&(C=[{maxBitrate:(d=o.audioPreset)===null||d===void 0?void 0:d.maxBitrate,priority:(g=(p=o.audioPreset)===null||p===void 0?void 0:p.priority)!==null&&g!==void 0?g:"high",networkPriority:(T=(y=o.audioPreset)===null||y===void 0?void 0:y.priority)!==null&&T!==void 0?T:"high"}]);if(!this.engine||this.engine.isClosed)throw new UnexpectedConnectionState("cannot publish track when not connected");const N=()=>__awaiter(this,void 0,void 0,function*(){var P,F,j;if(!this.engine.pcManager)throw new UnexpectedConnectionState("pcManager is not ready");if(t.sender=yield this.engine.createSender(t,o,C),t instanceof LocalVideoTrack&&((P=o.degradationPreference)!==null&&P!==void 0||(o.degradationPreference=getDefaultDegradationPreference(t)),t.setDegradationPreference(o.degradationPreference)),C)if(isFireFox()&&t.kind===Track.Kind.Audio){let J;for(const W of this.engine.pcManager.publisher.getTransceivers())if(W.sender===t.sender){J=W;break}J&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:J,codec:"opus",maxbr:!((F=C[0])===null||F===void 0)&&F.maxBitrate?C[0].maxBitrate/1e3:0})}else t.codec&&isSVCCodec(t.codec)&&(!((j=C[0])===null||j===void 0)&&j.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:O.cid,codec:t.codec,maxbr:C[0].maxBitrate/1e3});yield this.engine.negotiate()});let x;if(this.enabledPublishVideoCodecs.length>0)x=(yield Promise.all([this.engine.addTrack(O),N()]))[0];else{x=yield this.engine.addTrack(O);let P;if(x.codecs.forEach(F=>{P===void 0&&(P=F.mimeType)}),P&&t.kind===Track.Kind.Video){const F=mimeTypeToVideoCodecString(P);F!==k&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(t)),{codec:F})),o.videoCodec=F,C=computeVideoEncodings(t.source===Track.Source.ScreenShare,O.width,O.height,o))}yield N()}const U=new LocalTrackPublication(t.kind,x,t,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return U.options=o,t.sid=x.sid,this.log.debug("publishing ".concat(t.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:C,trackInfo:x})),t instanceof LocalVideoTrack?t.startMonitor(this.engine.client):t instanceof LocalAudioTrack&&t.startMonitor(),this.addTrackPublication(U),this.emit(ParticipantEvent.LocalTrackPublished,U),U})}get isLocal(){return!0}publishAdditionalCodecForTrack(t,o,e){return __awaiter(this,void 0,void 0,function*(){var n;if(this.encryptionType!==Encryption_Type.NONE)return;let s;if(this.trackPublications.forEach(T=>{T.track&&T.track===t&&(s=T)}),!s)throw new TrackInvalidError("track is not published");if(!(t instanceof LocalVideoTrack))throw new TrackInvalidError("track is not a video track");const c=Object.assign(Object.assign({},(n=this.roomOptions)===null||n===void 0?void 0:n.publishDefaults),e),l=computeTrackBackupEncodings(t,o,c);if(!l){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(t)));return}const u=t.addSimulcastTrack(o,l);if(!u)return;const d=new AddTrackRequest({cid:u.mediaStreamTrack.id,type:Track.kindToProto(t.kind),muted:t.isMuted,source:Track.sourceToProto(t.source),sid:t.sid,simulcastCodecs:[{codec:c.videoCodec,cid:u.mediaStreamTrack.id}]});if(d.layers=videoLayersFromEncodings(d.width,d.height,l),!this.engine||this.engine.isClosed)throw new UnexpectedConnectionState("cannot publish track when not connected");const p=()=>__awaiter(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(t,u,c,l),yield this.engine.negotiate()}),y=(yield Promise.all([this.engine.addTrack(d),p()]))[0];this.log.debug("published ".concat(o," for track ").concat(t.sid),Object.assign(Object.assign({},this.logContext),{encodings:l,trackInfo:y}))})}unpublishTrack(t,o){return __awaiter(this,void 0,void 0,function*(){var e,n;if(t instanceof LocalTrack){const d=this.pendingPublishPromises.get(t);d&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(t))),yield d)}const s=this.getPublicationForTrack(t),c=s?getLogContextFromTrack(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),c)),!s||!s.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),c));return}t=s.track,t.off(TrackEvent.Muted,this.onTrackMuted),t.off(TrackEvent.Unmuted,this.onTrackUnmuted),t.off(TrackEvent.Ended,this.handleTrackEnded),t.off(TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),t.off(TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed),t.off(TrackEvent.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),o===void 0&&(o=(n=(e=this.roomOptions)===null||e===void 0?void 0:e.stopLocalTrackOnUnpublish)!==null&&n!==void 0?n:!0),o&&t.stop();let l=!1;const u=t.sender;if(t.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<PCTransportState.FAILED&&u)try{for(const d of this.engine.pcManager.publisher.getTransceivers())d.sender===u&&(d.direction="inactive",l=!0);if(this.engine.removeTrack(u)&&(l=!0),t instanceof LocalVideoTrack){for(const[,d]of t.simulcastCodecs)d.sender&&(this.engine.removeTrack(d.sender)&&(l=!0),d.sender=void 0);t.simulcastCodecs.clear()}}catch(d){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),c),{error:d}))}switch(this.trackPublications.delete(s.trackSid),s.kind){case Track.Kind.Audio:this.audioTrackPublications.delete(s.trackSid);break;case Track.Kind.Video:this.videoTrackPublications.delete(s.trackSid);break}return this.emit(ParticipantEvent.LocalTrackUnpublished,s),s.setTrack(void 0),l&&(yield this.engine.negotiate()),s})}unpublishTracks(t){return __awaiter(this,void 0,void 0,function*(){return(yield Promise.all(t.map(e=>this.unpublishTrack(e)))).filter(e=>e instanceof LocalTrackPublication)})}republishAllTracks(t){return __awaiter(this,arguments,void 0,function(o){var e=this;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){const s=[];e.trackPublications.forEach(c=>{c.track&&(o&&(c.options=Object.assign(Object.assign({},c.options),o)),s.push(c))}),yield Promise.all(s.map(c=>__awaiter(e,void 0,void 0,function*(){const l=c.track;yield this.unpublishTrack(l,!1),n&&!l.isMuted&&l.source!==Track.Source.ScreenShare&&l.source!==Track.Source.ScreenShareAudio&&(l instanceof LocalAudioTrack||l instanceof LocalVideoTrack)&&!l.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield l.restartTrack()),yield this.publishTrack(l,c.options)})))}()})}publishData(t){return __awaiter(this,arguments,void 0,function(o){var e=this;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const s=n.reliable?DataPacket_Kind.RELIABLE:DataPacket_Kind.LOSSY,c=n.destinationIdentities,l=n.topic,u=new DataPacket({kind:s,value:{case:"user",value:new UserPacket({participantIdentity:e.identity,payload:o,destinationIdentities:c,topic:l})}});yield e.engine.sendDataPacket(u,s)}()})}setTrackSubscriptionPermissions(t){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=o,this.allParticipantsAllowedToSubscribe=t,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}setEnabledPublishCodecs(t){this.enabledPublishVideoCodecs=t.filter(o=>o.mime.split("/")[0].toLowerCase()==="video")}updateInfo(t){return t.sid!==this.sid||!super.updateInfo(t)?!1:(t.tracks.forEach(o=>{var e,n;const s=this.trackPublications.get(o.sid);if(s){const c=s.isMuted||((n=(e=s.track)===null||e===void 0?void 0:e.isUpstreamPaused)!==null&&n!==void 0?n:!1);c!==o.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(s)),{mutedOnServer:c})),this.engine.client.sendMuteTrack(o.sid,c))}}),!0)}getPublicationForTrack(t){let o;return this.trackPublications.forEach(e=>{const n=e.track;n&&(t instanceof MediaStreamTrack?(n instanceof LocalAudioTrack||n instanceof LocalVideoTrack)&&n.mediaStreamTrack===t&&(o=e):t===n&&(o=e))}),o}}class RemoteTrackPublication extends TrackPublication{constructor(t,o,e,n){super(t,o.sid,o.name,n),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=VideoQuality.HIGH,this.handleEnded=s=>{this.setTrack(void 0),this.emit(TrackEvent.Ended,s)},this.handleVisibilityChange=s=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(s),this.logContext),this.disabled=!s,this.emitTrackUpdate()},this.handleVideoDimensionsChange=s=>{this.log.debug("adaptivestream video dimensions ".concat(s.width,"x").concat(s.height),this.logContext),this.videoDimensions=s,this.emitTrackUpdate()},this.subscribed=e,this.updateInfo(o)}setSubscribed(t){const o=this.subscriptionStatus,e=this.permissionStatus;this.subscribed=t,t&&(this.allowed=!0);const n=new UpdateSubscription({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new ParticipantTracks({participantSid:"",trackSids:[this.trackSid]})]});this.emit(TrackEvent.UpdateSubscription,n),this.emitSubscriptionUpdateIfChanged(o),this.emitPermissionUpdateIfChanged(e)}get subscriptionStatus(){return this.subscribed===!1?TrackPublication.SubscriptionStatus.Unsubscribed:super.isSubscribed?TrackPublication.SubscriptionStatus.Subscribed:TrackPublication.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?TrackPublication.PermissionStatus.Allowed:TrackPublication.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return!this.disabled}setEnabled(t){!this.isManualOperationAllowed()||this.disabled===!t||(this.disabled=!t,this.emitTrackUpdate())}setVideoQuality(t){!this.isManualOperationAllowed()||this.currentVideoQuality===t||(this.currentVideoQuality=t,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(t){var o,e;this.isManualOperationAllowed()&&(((o=this.videoDimensions)===null||o===void 0?void 0:o.width)===t.width&&((e=this.videoDimensions)===null||e===void 0?void 0:e.height)===t.height||(this.track instanceof RemoteVideoTrack&&(this.videoDimensions=t),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(t){this.isManualOperationAllowed()&&this.track instanceof RemoteVideoTrack&&this.fps!==t&&(this.fps=t,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(t){const o=this.subscriptionStatus,e=this.permissionStatus,n=this.track;n!==t&&(n&&(n.off(TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),n.off(TrackEvent.VisibilityChanged,this.handleVisibilityChange),n.off(TrackEvent.Ended,this.handleEnded),n.detach(),n.stopMonitor(),this.emit(TrackEvent.Unsubscribed,n)),super.setTrack(t),t&&(t.sid=this.trackSid,t.on(TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),t.on(TrackEvent.VisibilityChanged,this.handleVisibilityChange),t.on(TrackEvent.Ended,this.handleEnded),this.emit(TrackEvent.Subscribed,t)),this.emitPermissionUpdateIfChanged(e),this.emitSubscriptionUpdateIfChanged(o))}setAllowed(t){const o=this.subscriptionStatus,e=this.permissionStatus;this.allowed=t,this.emitPermissionUpdateIfChanged(e),this.emitSubscriptionUpdateIfChanged(o)}setSubscriptionError(t){this.emit(TrackEvent.SubscriptionFailed,t)}updateInfo(t){super.updateInfo(t);const o=this.metadataMuted;this.metadataMuted=t.muted,this.track?this.track.setMuted(t.muted):o!==t.muted&&this.emit(t.muted?TrackEvent.Muted:TrackEvent.Unmuted)}emitSubscriptionUpdateIfChanged(t){const o=this.subscriptionStatus;t!==o&&this.emit(TrackEvent.SubscriptionStatusChanged,o,t)}emitPermissionUpdateIfChanged(t){this.permissionStatus!==t&&this.emit(TrackEvent.SubscriptionPermissionChanged,this.permissionStatus,t)}isManualOperationAllowed(){return this.kind===Track.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return this.track instanceof RemoteVideoTrack&&this.track.isAdaptiveStream}emitTrackUpdate(){const t=new UpdateTrackSettings({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(t.width=Math.ceil(this.videoDimensions.width),t.height=Math.ceil(this.videoDimensions.height)):this.currentVideoQuality!==void 0?t.quality=this.currentVideoQuality:t.quality=VideoQuality.HIGH,this.emit(TrackEvent.UpdateSettings,t)}}class RemoteParticipant extends Participant{static fromParticipantInfo(t,o,e){return new RemoteParticipant(t,o.sid,o.identity,o.name,o.metadata,e,o.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(t,o,e,n,s,c){let l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:ParticipantInfo_Kind.STANDARD;super(o,e||"",n,s,c,l),this.signalClient=t,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(t){super.addTrackPublication(t),t.on(TrackEvent.UpdateSettings,o=>{this.log.debug("send update settings",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(t))),this.signalClient.sendUpdateTrackSettings(o)}),t.on(TrackEvent.UpdateSubscription,o=>{o.participantTracks.forEach(e=>{e.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(o)}),t.on(TrackEvent.SubscriptionPermissionChanged,o=>{this.emit(ParticipantEvent.TrackSubscriptionPermissionChanged,t,o)}),t.on(TrackEvent.SubscriptionStatusChanged,o=>{this.emit(ParticipantEvent.TrackSubscriptionStatusChanged,t,o)}),t.on(TrackEvent.Subscribed,o=>{this.emit(ParticipantEvent.TrackSubscribed,o,t)}),t.on(TrackEvent.Unsubscribed,o=>{this.emit(ParticipantEvent.TrackUnsubscribed,o,t)}),t.on(TrackEvent.SubscriptionFailed,o=>{this.emit(ParticipantEvent.TrackSubscriptionFailed,t.trackSid,o)})}getTrackPublication(t){const o=super.getTrackPublication(t);if(o)return o}getTrackPublicationByName(t){const o=super.getTrackPublicationByName(t);if(o)return o}setVolume(t){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Track.Source.Microphone;this.volumeMap.set(o,t);const e=this.getTrackPublication(o);e&&e.track&&e.track.setVolume(t)}getVolume(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Track.Source.Microphone;const o=this.getTrackPublication(t);return o&&o.track?o.track.getVolume():this.volumeMap.get(t)}addSubscribedMediaTrack(t,o,e,n,s,c){let l=this.getTrackPublicationBySid(o);if(l||o.startsWith("TR")||this.trackPublications.forEach(p=>{!l&&t.kind===p.kind.toString()&&(l=p)}),!l){if(c===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:o})),this.emit(ParticipantEvent.TrackSubscriptionFailed,o);return}c===void 0&&(c=20),setTimeout(()=>{this.addSubscribedMediaTrack(t,o,e,n,s,c-1)},150);return}if(t.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(l))),this.emit(ParticipantEvent.TrackSubscriptionFailed,o);return}const u=t.kind==="video";let d;return u?d=new RemoteVideoTrack(t,o,n,s):d=new RemoteAudioTrack(t,o,n,this.audioContext,this.audioOutput),d.source=l.source,d.isMuted=l.isMuted,d.setMediaStream(e),d.start(),l.setTrack(d),this.volumeMap.has(l.source)&&d instanceof RemoteAudioTrack&&d.setVolume(this.volumeMap.get(l.source)),l}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(t){return this.trackPublications.get(t)}updateInfo(t){if(!super.updateInfo(t))return!1;const o=new Map,e=new Map;return t.tracks.forEach(n=>{var s,c;let l=this.getTrackPublicationBySid(n.sid);if(l)l.updateInfo(n);else{const u=Track.kindFromProto(n.type);if(!u)return;l=new RemoteTrackPublication(u,n,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(c=this.loggerOptions)===null||c===void 0?void 0:c.loggerName}),l.updateInfo(n),e.set(n.sid,l);const d=Array.from(this.trackPublications.values()).find(p=>p.source===(l==null?void 0:l.source));d&&l.source!==Track.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(l.source),Object.assign(Object.assign({},this.logContext),{oldTrack:getLogContextFromTrack(d),newTrack:getLogContextFromTrack(l)})),this.addTrackPublication(l)}o.set(n.sid,l)}),this.trackPublications.forEach(n=>{o.has(n.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(n))),this.unpublishTrack(n.trackSid,!0))}),e.forEach(n=>{this.emit(ParticipantEvent.TrackPublished,n)}),!0}unpublishTrack(t,o){const e=this.trackPublications.get(t);if(!e)return;const{track:n}=e;switch(n&&(n.stop(),e.setTrack(void 0)),this.trackPublications.delete(t),e.kind){case Track.Kind.Audio:this.audioTrackPublications.delete(t);break;case Track.Kind.Video:this.videoTrackPublications.delete(t);break}o&&this.emit(ParticipantEvent.TrackUnpublished,e)}setAudioOutput(t){return __awaiter(this,void 0,void 0,function*(){this.audioOutput=t;const o=[];this.audioTrackPublications.forEach(e=>{var n;e.track instanceof RemoteAudioTrack&&o.push(e.track.setSinkId((n=t.deviceId)!==null&&n!==void 0?n:"default"))}),yield Promise.all(o)})}emit(t){for(var o=arguments.length,e=new Array(o>1?o-1:0),n=1;n<o;n++)e[n-1]=arguments[n];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:t,args:e})),super.emit(t,...e)}}var ConnectionState;(function(a){a.Disconnected="disconnected",a.Connecting="connecting",a.Connected="connected",a.Reconnecting="reconnecting",a.SignalReconnecting="signalReconnecting"})(ConnectionState||(ConnectionState={}));const connectionReconcileFrequency=4*1e3;class Room extends eventsExports.EventEmitter{constructor(t){var o,e,n;super(),o=this,this.state=ConnectionState.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=livekitLogger,this.bufferedEvents=[],this.isResuming=!1,this.connect=(s,c,l)=>__awaiter(this,void 0,void 0,function*(){var u;if(!isBrowserSupported())throw isReactNative()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const d=yield this.disconnectLock.lock();if(this.state===ConnectionState.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),d(),Promise.resolve();if(this.connectFuture)return d(),this.connectFuture.promise;this.setAndEmitConnectionState(ConnectionState.Connecting),((u=this.regionUrlProvider)===null||u===void 0?void 0:u.getServerUrl().toString())!==s&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),isCloud(new URL(s))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new RegionUrlProvider(s,c):this.regionUrlProvider.updateToken(c),this.regionUrlProvider.fetchRegionSettings().then(y=>{var T;(T=this.regionUrlProvider)===null||T===void 0||T.setServerReportedRegions(y)}).catch(y=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:y}))}));const p=(y,T,b)=>__awaiter(this,void 0,void 0,function*(){var k,O;this.abortController&&this.abortController.abort();const C=new AbortController;this.abortController=C,d==null||d();try{yield this.attemptConnection(b??s,c,l,C),this.abortController=void 0,y()}catch(N){if(this.regionUrlProvider&&N instanceof ConnectionError&&N.reason!==3&&N.reason!==0){let x=null;try{x=yield this.regionUrlProvider.getNextBestRegionUrl((k=this.abortController)===null||k===void 0?void 0:k.signal)}catch(U){if(U instanceof ConnectionError&&(U.status===401||U.reason===3)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),T(U);return}}x&&!(!((O=this.abortController)===null||O===void 0)&&O.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(N.message,". Retrying with another region: ").concat(x),this.logContext),this.recreateEngine(),yield p(y,T,x)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),T(N))}else this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),T(N)}}),g=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Future((y,T)=>{p(y,T,g)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(s,c,l,u,d,p)=>__awaiter(this,void 0,void 0,function*(){var g,y,T;const b=yield l.join(s,c,{autoSubscribe:u.autoSubscribe,adaptiveStream:typeof d.adaptiveStream=="object"?!0:d.adaptiveStream,maxRetries:u.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:u.websocketTimeout},p.signal);let k=b.serverInfo;if(k||(k={version:b.serverVersion,region:b.serverRegion}),this.log.debug("connected to Livekit Server ".concat(Object.entries(k).map(O=>{let[C,N]=O;return"".concat(C,": ").concat(N)}).join(", ")),{room:(g=b.room)===null||g===void 0?void 0:g.name,roomSid:(y=b.room)===null||y===void 0?void 0:y.sid,identity:(T=b.participant)===null||T===void 0?void 0:T.identity}),!b.serverVersion)throw new UnsupportedServer("unknown server version");return b.serverVersion==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),d.dynacast=!1),b}),this.applyJoinResponse=s=>{const c=s.participant;if(this.localParticipant.sid=c.sid,this.localParticipant.identity=c.identity,this.localParticipant.setEnabledPublishCodecs(s.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(s.sifTrailer)}catch(l){this.log.error(l instanceof Error?l.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:l}))}this.handleParticipantUpdates([c,...s.otherParticipants]),s.room&&this.handleRoomUpdate(s.room)},this.attemptConnection=(s,c,l,u)=>__awaiter(this,void 0,void 0,function*(){var d,p,g;this.state===ConnectionState.Reconnecting||this.isResuming||!((d=this.engine)===null||d===void 0)&&d.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((p=this.regionUrlProvider)===null||p===void 0)&&p.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},roomConnectOptionDefaults),l),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const y=yield this.connectSignal(s,c,this.engine,this.connOptions,this.options,u);this.applyJoinResponse(y),this.setupLocalParticipantEvents(),this.emit(RoomEvent.SignalConnected)}catch(y){yield this.engine.close(),this.recreateEngine();const T=new ConnectionError("could not establish signal connection");throw y instanceof Error&&(T.message="".concat(T.message,": ").concat(y.message)),y instanceof ConnectionError&&(T.reason=y.reason,T.status=y.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:y})),T}if(u.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new ConnectionError("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,u)}catch(y){throw yield this.engine.close(),this.recreateEngine(),y}isWeb()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),isWeb()&&(document.addEventListener("freeze",this.onPageLeave),(g=navigator.mediaDevices)===null||g===void 0||g.addEventListener("devicechange",this.handleDeviceChange)),this.setAndEmitConnectionState(ConnectionState.Connected),this.emit(RoomEvent.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];return __awaiter(o,[...c],void 0,function(){var u=this;let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var p,g,y,T;const b=yield u.disconnectLock.lock();try{if(u.state===ConnectionState.Disconnected){u.log.debug("already disconnected",u.logContext);return}u.log.info("disconnect from room",Object.assign({},u.logContext)),(u.state===ConnectionState.Connecting||u.state===ConnectionState.Reconnecting||u.isResuming)&&(u.log.warn("abort connection attempt",u.logContext),(p=u.abortController)===null||p===void 0||p.abort(),(y=(g=u.connectFuture)===null||g===void 0?void 0:g.reject)===null||y===void 0||y.call(g,new ConnectionError("Client initiated disconnect")),u.connectFuture=void 0),!((T=u.engine)===null||T===void 0)&&T.client.isDisconnected||(yield u.engine.client.sendLeave()),u.engine&&(yield u.engine.close()),u.handleDisconnect(d,DisconnectReason.CLIENT_INITIATED),u.engine=void 0}finally{b()}}()})},this.onPageLeave=()=>__awaiter(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>__awaiter(this,void 0,void 0,function*(){const s=[],c=getBrowser();if(c&&c.os==="iOS"){const l="livekit-dummy-audio-el";let u=document.getElementById(l);if(!u){u=document.createElement("audio"),u.id=l,u.autoplay=!0,u.hidden=!0;const d=getEmptyAudioStreamTrack();d.enabled=!0;const p=new MediaStream([d]);u.srcObject=p,document.addEventListener("visibilitychange",()=>{u&&(u.srcObject=document.hidden?null:p,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(u),this.once(RoomEvent.Disconnected,()=>{u==null||u.remove(),u=null})}s.push(u)}this.remoteParticipants.forEach(l=>{l.audioTrackPublications.forEach(u=>{u.track&&u.track.attachedElements.forEach(d=>{s.push(d)})})});try{yield Promise.all([this.acquireAudioContext(),...s.map(l=>(l.muted=!1,l.play()))]),this.handleAudioPlaybackStarted()}catch(l){throw this.handleAudioPlaybackFailed(l),l}}),this.startVideo=()=>__awaiter(this,void 0,void 0,function*(){const s=[];for(const c of this.remoteParticipants.values())c.videoTrackPublications.forEach(l=>{var u;(u=l.track)===null||u===void 0||u.attachedElements.forEach(d=>{s.includes(d)||s.push(d)})});yield Promise.all(s.map(c=>c.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(c=>{c.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const s of this.remoteParticipants.values())this.handleParticipantDisconnected(s.identity,s);this.setAndEmitConnectionState(ConnectionState.Reconnecting)&&this.emit(RoomEvent.Reconnecting)},this.handleSignalRestarted=s=>__awaiter(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(s.serverRegion),Object.assign(Object.assign({},this.logContext),{region:s.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(s);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(c){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:c}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:s.serverRegion}))}catch{return}this.setAndEmitConnectionState(ConnectionState.Connected),this.emit(RoomEvent.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=s=>{s.forEach(c=>{var l;if(c.identity===this.localParticipant.identity){this.localParticipant.updateInfo(c);return}c.identity===""&&(c.identity=(l=this.sidToIdentity.get(c.sid))!==null&&l!==void 0?l:"");let u=this.remoteParticipants.get(c.identity);c.state===ParticipantInfo_State.DISCONNECTED?this.handleParticipantDisconnected(c.identity,u):u=this.getOrCreateParticipant(c.identity,c)})},this.handleActiveSpeakersUpdate=s=>{const c=[],l={};s.forEach(u=>{if(l[u.sid]=!0,u.sid===this.localParticipant.sid)this.localParticipant.audioLevel=u.level,this.localParticipant.setIsSpeaking(!0),c.push(this.localParticipant);else{const d=this.getRemoteParticipantBySid(u.sid);d&&(d.audioLevel=u.level,d.setIsSpeaking(!0),c.push(d))}}),l[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(u=>{l[u.sid]||(u.audioLevel=0,u.setIsSpeaking(!1))}),this.activeSpeakers=c,this.emitWhenConnected(RoomEvent.ActiveSpeakersChanged,c)},this.handleSpeakersChanged=s=>{const c=new Map;this.activeSpeakers.forEach(u=>{const d=this.remoteParticipants.get(u.identity);d&&d.sid!==u.sid||c.set(u.sid,u)}),s.forEach(u=>{let d=this.getRemoteParticipantBySid(u.sid);u.sid===this.localParticipant.sid&&(d=this.localParticipant),d&&(d.audioLevel=u.level,d.setIsSpeaking(u.active),u.active?c.set(u.sid,d):c.delete(u.sid))});const l=Array.from(c.values());l.sort((u,d)=>d.audioLevel-u.audioLevel),this.activeSpeakers=l,this.emitWhenConnected(RoomEvent.ActiveSpeakersChanged,l)},this.handleStreamStateUpdate=s=>{s.streamStates.forEach(c=>{const l=this.getRemoteParticipantBySid(c.participantSid);if(!l)return;const u=l.getTrackPublicationBySid(c.trackSid);!u||!u.track||(u.track.streamState=Track.streamStateFromProto(c.state),l.emit(ParticipantEvent.TrackStreamStateChanged,u,u.track.streamState),this.emitWhenConnected(RoomEvent.TrackStreamStateChanged,u,u.track.streamState,l))})},this.handleSubscriptionPermissionUpdate=s=>{const c=this.getRemoteParticipantBySid(s.participantSid);if(!c)return;const l=c.getTrackPublicationBySid(s.trackSid);l&&l.setAllowed(s.allowed)},this.handleSubscriptionError=s=>{const c=Array.from(this.remoteParticipants.values()).find(u=>u.trackPublications.has(s.trackSid));if(!c)return;const l=c.getTrackPublicationBySid(s.trackSid);l&&l.setSubscriptionError(s.err)},this.handleDataPacket=s=>{const c=this.remoteParticipants.get(s.participantIdentity);s.value.case==="user"?this.handleUserPacket(c,s.value.value,s.kind):s.value.case==="transcription"?this.handleTranscription(c,s.value.value):s.value.case==="sipDtmf"&&this.handleSipDtmf(c,s.value.value)},this.handleUserPacket=(s,c,l)=>{this.emit(RoomEvent.DataReceived,c.payload,s,l,c.topic),s==null||s.emit(ParticipantEvent.DataReceived,c.payload,l)},this.handleSipDtmf=(s,c)=>{this.emit(RoomEvent.SipDTMFReceived,c,s),s==null||s.emit(ParticipantEvent.SipDTMFReceived,c)},this.bufferedSegments=new Map,this.handleTranscription=(s,c)=>{const l=c.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(c.transcribedParticipantIdentity),u=l==null?void 0:l.trackPublications.get(c.trackId),d=extractTranscriptionSegments(c,this.transcriptionReceivedTimes);u==null||u.emit(TrackEvent.TranscriptionReceived,d),l==null||l.emit(ParticipantEvent.TranscriptionReceived,d,u),this.emit(RoomEvent.TranscriptionReceived,d,l,u)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(RoomEvent.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=s=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:s})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(RoomEvent.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(RoomEvent.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(RoomEvent.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>__awaiter(this,void 0,void 0,function*(){this.emit(RoomEvent.MediaDevicesChanged)}),this.handleRoomUpdate=s=>{const c=this.roomInfo;this.roomInfo=s,c&&c.metadata!==s.metadata&&this.emitWhenConnected(RoomEvent.RoomMetadataChanged,s.metadata),(c==null?void 0:c.activeRecording)!==s.activeRecording&&this.emitWhenConnected(RoomEvent.RecordingStatusChanged,s.activeRecording)},this.handleConnectionQualityUpdate=s=>{s.updates.forEach(c=>{if(c.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(c.quality);return}const l=this.getRemoteParticipantBySid(c.participantSid);l&&l.setConnectionQuality(c.quality)})},this.onLocalParticipantMetadataChanged=s=>{this.emit(RoomEvent.ParticipantMetadataChanged,s,this.localParticipant)},this.onLocalParticipantNameChanged=s=>{this.emit(RoomEvent.ParticipantNameChanged,s,this.localParticipant)},this.onLocalAttributesChanged=s=>{this.emit(RoomEvent.ParticipantAttributesChanged,s,this.localParticipant)},this.onLocalTrackMuted=s=>{this.emit(RoomEvent.TrackMuted,s,this.localParticipant)},this.onLocalTrackUnmuted=s=>{this.emit(RoomEvent.TrackUnmuted,s,this.localParticipant)},this.onTrackProcessorUpdate=s=>{var c;(c=s==null?void 0:s.onPublish)===null||c===void 0||c.call(s,this)},this.onLocalTrackPublished=s=>__awaiter(this,void 0,void 0,function*(){var c,l,u,d,p;(c=s.track)===null||c===void 0||c.on(TrackEvent.TrackProcessorUpdate,this.onTrackProcessorUpdate),(d=(u=(l=s.track)===null||l===void 0?void 0:l.getProcessor())===null||u===void 0?void 0:u.onPublish)===null||d===void 0||d.call(u,this),this.emit(RoomEvent.LocalTrackPublished,s,this.localParticipant),s.track instanceof LocalAudioTrack&&(yield s.track.checkForSilence())&&this.emit(RoomEvent.LocalAudioSilenceDetected,s);const g=yield(p=s.track)===null||p===void 0?void 0:p.getDeviceId(),y=sourceToKind(s.source);y&&g&&g!==this.localParticipant.activeDeviceMap.get(y)&&(this.localParticipant.activeDeviceMap.set(y,g),this.emit(RoomEvent.ActiveDeviceChanged,y,g))}),this.onLocalTrackUnpublished=s=>{var c;(c=s.track)===null||c===void 0||c.off(TrackEvent.TrackProcessorUpdate,this.onTrackProcessorUpdate),this.emit(RoomEvent.LocalTrackUnpublished,s,this.localParticipant)},this.onLocalConnectionQualityChanged=s=>{this.emit(RoomEvent.ConnectionQualityChanged,s,this.localParticipant)},this.onMediaDevicesError=s=>{this.emit(RoomEvent.MediaDevicesError,s)},this.onLocalParticipantPermissionsChanged=s=>{this.emit(RoomEvent.ParticipantPermissionsChanged,s,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},roomOptionDefaults),t),this.log=getLogger((e=this.options.loggerName)!==null&&e!==void 0?e:LoggerNames.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},audioDefaults),t==null?void 0:t.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},videoDefaults),t==null?void 0:t.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},publishDefaults),t==null?void 0:t.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new Mutex,this.localParticipant=new LocalParticipant("","",this.engine,this.options),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",unwrapConstraint(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",unwrapConstraint(this.options.audioCaptureDefaults.deviceId)),!((n=this.options.audioOutput)===null||n===void 0)&&n.deviceId&&this.switchActiveDevice("audiooutput",unwrapConstraint(this.options.audioOutput.deviceId)).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),this.options.e2ee&&this.setupE2EE()}setE2EEEnabled(t){return __awaiter(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(t)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(t,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var t;this.options.e2ee&&(this.e2eeManager=new E2EEManager(this.options.e2ee),this.e2eeManager.on(EncryptionEvent.ParticipantEncryptionStatusChanged,(o,e)=>{e instanceof LocalParticipant&&(this.isE2EEEnabled=o),this.emit(RoomEvent.ParticipantEncryptionStatusChanged,o,e)}),this.e2eeManager.on(EncryptionEvent.EncryptionError,o=>this.emit(RoomEvent.EncryptionError,o)),(t=this.e2eeManager)===null||t===void 0||t.setup(this))}get logContext(){var t;return{room:this.name,roomID:(t=this.roomInfo)===null||t===void 0?void 0:t.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var t,o;return(o=(t=this.roomInfo)===null||t===void 0?void 0:t.activeRecording)!==null&&o!==void 0?o:!1}getSid(){return __awaiter(this,void 0,void 0,function*(){return this.state===ConnectionState.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((t,o)=>{const e=n=>{n.sid!==""&&(this.engine.off(EngineEvent.RoomUpdate,e),t(n.sid))};this.engine.on(EngineEvent.RoomUpdate,e),this.once(RoomEvent.Disconnected,()=>{this.engine.off(EngineEvent.RoomUpdate,e),o("Room disconnected before room server id was available")})})})}get name(){var t,o;return(o=(t=this.roomInfo)===null||t===void 0?void 0:t.name)!==null&&o!==void 0?o:""}get metadata(){var t;return(t=this.roomInfo)===null||t===void 0?void 0:t.metadata}get numParticipants(){var t,o;return(o=(t=this.roomInfo)===null||t===void 0?void 0:t.numParticipants)!==null&&o!==void 0?o:0}get numPublishers(){var t,o;return(o=(t=this.roomInfo)===null||t===void 0?void 0:t.numPublishers)!==null&&o!==void 0?o:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new RTCEngine(this.options),this.engine.on(EngineEvent.ParticipantUpdate,this.handleParticipantUpdates).on(EngineEvent.RoomUpdate,this.handleRoomUpdate).on(EngineEvent.SpeakersChanged,this.handleSpeakersChanged).on(EngineEvent.StreamStateChanged,this.handleStreamStateUpdate).on(EngineEvent.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(EngineEvent.SubscriptionError,this.handleSubscriptionError).on(EngineEvent.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(EngineEvent.MediaTrackAdded,(t,o,e)=>{this.onTrackAdded(t,o,e)}).on(EngineEvent.Disconnected,t=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,t)}).on(EngineEvent.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(EngineEvent.DataPacketReceived,this.handleDataPacket).on(EngineEvent.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(ConnectionState.SignalReconnecting)&&this.emit(RoomEvent.SignalReconnecting)}).on(EngineEvent.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(ConnectionState.Connected)&&this.emit(RoomEvent.Reconnected)}).on(EngineEvent.SignalResumed,()=>{this.bufferedEvents=[],(this.state===ConnectionState.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(EngineEvent.Restarting,this.handleRestarting).on(EngineEvent.SignalRestarted,this.handleSignalRestarted).on(EngineEvent.Offline,()=>{this.setAndEmitConnectionState(ConnectionState.Reconnecting)&&this.emit(RoomEvent.Reconnecting)}).on(EngineEvent.DCBufferStatusChanged,(t,o)=>{this.emit(RoomEvent.DCBufferStatusChanged,t,o)}).on(EngineEvent.LocalTrackSubscribed,t=>{const o=this.localParticipant.getTrackPublications().find(e=>{let{trackSid:n}=e;return n===t});if(!o){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(ParticipantEvent.LocalTrackSubscribed,o),this.emitWhenConnected(RoomEvent.LocalTrackSubscribed,o,this.localParticipant)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(t){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return DeviceManager.getInstance().getDevices(t,o)}prepareConnection(t,o){return __awaiter(this,void 0,void 0,function*(){if(this.state===ConnectionState.Disconnected){this.log.debug("prepareConnection to ".concat(t),this.logContext);try{if(isCloud(new URL(t))&&o){this.regionUrlProvider=new RegionUrlProvider(t,o);const e=yield this.regionUrlProvider.getNextBestRegionUrl();e&&this.state===ConnectionState.Disconnected&&(this.regionUrl=e,yield fetch(toHttpUrl(e),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(e),this.logContext))}else yield fetch(toHttpUrl(t),{method:"HEAD"})}catch(e){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:e}))}}})}getParticipantByIdentity(t){return this.localParticipant.identity===t?this.localParticipant:this.remoteParticipants.get(t)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(t,o){return __awaiter(this,void 0,void 0,function*(){let e=()=>{},n;switch(t){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":n=new SimulateScenario({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":n=new SimulateScenario({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":n=new SimulateScenario({scenario:{case:"serverLeave",value:!0}});break;case"migration":n=new SimulateScenario({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":e=()=>__awaiter(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),n=new SimulateScenario({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":e=()=>__awaiter(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),n=new SimulateScenario({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":n=new SimulateScenario({scenario:{case:"switchCandidateProtocol",value:t==="force-tls"?2:1}}),e=()=>__awaiter(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new LeaveRequest({reason:DisconnectReason.CLIENT_INITIATED,action:LeaveRequest_Action.RECONNECT}))});break;case"subscriber-bandwidth":if(o===void 0||typeof o!="number")throw new Error("subscriber-bandwidth requires a number as argument");n=new SimulateScenario({scenario:{case:"subscriberBandwidth",value:BigInt(o)}});break;case"leave-full-reconnect":n=new SimulateScenario({scenario:{case:"leaveRequestFullReconnect",value:!0}})}n&&(yield this.engine.client.sendSimulateScenario(n),yield e())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(t){return this.localParticipant.activeDeviceMap.get(t)}switchActiveDevice(t,o){return __awaiter(this,arguments,void 0,function(e,n){var s=this;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var l,u,d,p;let g=!1,y=!0;const T=c?{exact:n}:n;if(e==="audioinput"){const b=s.options.audioCaptureDefaults.deviceId;s.options.audioCaptureDefaults.deviceId=T,g=b!==T;const k=Array.from(s.localParticipant.audioTrackPublications.values()).filter(O=>O.source===Track.Source.Microphone);try{y=(yield Promise.all(k.map(O=>{var C;return(C=O.audioTrack)===null||C===void 0?void 0:C.setDeviceId(T)}))).every(O=>O===!0)}catch(O){throw s.options.audioCaptureDefaults.deviceId=b,O}}else if(e==="videoinput"){const b=s.options.videoCaptureDefaults.deviceId;s.options.videoCaptureDefaults.deviceId=T,g=b!==T;const k=Array.from(s.localParticipant.videoTrackPublications.values()).filter(O=>O.source===Track.Source.Camera);try{y=(yield Promise.all(k.map(O=>{var C;return(C=O.videoTrack)===null||C===void 0?void 0:C.setDeviceId(T)}))).every(O=>O===!0)}catch(O){throw s.options.videoCaptureDefaults.deviceId=b,O}}else if(e==="audiooutput"){if(!supportsSetSinkId()&&!s.options.webAudioMix||s.options.webAudioMix&&s.audioContext&&!("setSinkId"in s.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");s.options.webAudioMix&&(n=(l=yield DeviceManager.getInstance().normalizeDeviceId("audiooutput",n))!==null&&l!==void 0?l:""),(u=(p=s.options).audioOutput)!==null&&u!==void 0||(p.audioOutput={});const b=s.options.audioOutput.deviceId;s.options.audioOutput.deviceId=n,g=b!==T;try{s.options.webAudioMix&&((d=s.audioContext)===null||d===void 0||d.setSinkId(n)),yield Promise.all(Array.from(s.remoteParticipants.values()).map(k=>k.setAudioOutput({deviceId:n})))}catch(k){throw s.options.audioOutput.deviceId=b,k}}return g&&y&&(s.localParticipant.activeDeviceMap.set(e,n),s.emit(RoomEvent.ActiveDeviceChanged,e,n)),y}()})}setupLocalParticipantEvents(){this.localParticipant.on(ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(ParticipantEvent.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(ParticipantEvent.AttributesChanged,this.onLocalAttributesChanged).on(ParticipantEvent.TrackMuted,this.onLocalTrackMuted).on(ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).on(ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).on(ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).on(ParticipantEvent.AudioStreamAcquired,this.startAudio).on(ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var t;(t=this.engine)===null||t===void 0||t.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(t,o,e){if(this.state===ConnectionState.Connecting||this.state===ConnectionState.Reconnecting){const p=()=>{this.onTrackAdded(t,o,e),g()},g=()=>{this.off(RoomEvent.Reconnected,p),this.off(RoomEvent.Connected,p),this.off(RoomEvent.Disconnected,g)};this.once(RoomEvent.Reconnected,p),this.once(RoomEvent.Connected,p),this.once(RoomEvent.Disconnected,g);return}if(this.state===ConnectionState.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}const n=unpackStreamId(o.id),s=n[0];let c=n[1],l=t.id;if(c&&c.startsWith("TR")&&(l=c),s===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const u=Array.from(this.remoteParticipants.values()).find(p=>p.sid===s);if(!u){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);return}let d;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?d=this.options.adaptiveStream:d={}),u.addSubscribedMediaTrack(t,l,o,e,d)}handleDisconnect(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,o=arguments.length>1?arguments[1]:void 0;var e;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==ConnectionState.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(n=>{n.trackPublications.forEach(s=>{n.unpublishTrack(s.trackSid)})}),this.localParticipant.trackPublications.forEach(n=>{var s,c;n.track&&this.localParticipant.unpublishTrack(n.track,t),t&&((s=n.track)===null||s===void 0||s.detach(),(c=n.track)===null||c===void 0||c.stop())}),this.localParticipant.off(ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(ParticipantEvent.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(ParticipantEvent.AttributesChanged,this.onLocalAttributesChanged).off(ParticipantEvent.TrackMuted,this.onLocalTrackMuted).off(ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).off(ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).off(ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).off(ParticipantEvent.AudioStreamAcquired,this.startAudio).off(ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),isWeb()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(e=navigator.mediaDevices)===null||e===void 0||e.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(ConnectionState.Disconnected),this.emit(RoomEvent.Disconnected,o)}}}handleParticipantDisconnected(t,o){this.remoteParticipants.delete(t),o&&(o.trackPublications.forEach(e=>{o.unpublishTrack(e.trackSid,!0)}),this.emit(RoomEvent.ParticipantDisconnected,o))}acquireAudioContext(){return __awaiter(this,void 0,void 0,function*(){var t,o;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(t=getNewAudioContext())!==null&&t!==void 0?t:void 0),this.audioContext&&this.audioContext.state==="suspended")try{yield this.audioContext.resume()}catch(n){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:n}))}this.options.webAudioMix&&this.remoteParticipants.forEach(n=>n.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext);const e=((o=this.audioContext)===null||o===void 0?void 0:o.state)==="running";e!==this.canPlaybackAudio&&(this.audioEnabled=e,this.emit(RoomEvent.AudioPlaybackStatusChanged,e))})}createParticipant(t,o){var e;let n;return o?n=RemoteParticipant.fromParticipantInfo(this.engine.client,o,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):n=new RemoteParticipant(this.engine.client,"",t,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&n.setAudioContext(this.audioContext),!((e=this.options.audioOutput)===null||e===void 0)&&e.deviceId&&n.setAudioOutput(this.options.audioOutput).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),n}getOrCreateParticipant(t,o){if(this.remoteParticipants.has(t)){const n=this.remoteParticipants.get(t);return o&&n.updateInfo(o)&&this.sidToIdentity.set(o.sid,o.identity),n}const e=this.createParticipant(t,o);return this.remoteParticipants.set(t,e),this.sidToIdentity.set(o.sid,o.identity),this.emitWhenConnected(RoomEvent.ParticipantConnected,e),e.on(ParticipantEvent.TrackPublished,n=>{this.emitWhenConnected(RoomEvent.TrackPublished,n,e)}).on(ParticipantEvent.TrackSubscribed,(n,s)=>{n.kind===Track.Kind.Audio?(n.on(TrackEvent.AudioPlaybackStarted,this.handleAudioPlaybackStarted),n.on(TrackEvent.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):n.kind===Track.Kind.Video&&(n.on(TrackEvent.VideoPlaybackFailed,this.handleVideoPlaybackFailed),n.on(TrackEvent.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(RoomEvent.TrackSubscribed,n,s,e)}).on(ParticipantEvent.TrackUnpublished,n=>{this.emit(RoomEvent.TrackUnpublished,n,e)}).on(ParticipantEvent.TrackUnsubscribed,(n,s)=>{this.emit(RoomEvent.TrackUnsubscribed,n,s,e)}).on(ParticipantEvent.TrackSubscriptionFailed,n=>{this.emit(RoomEvent.TrackSubscriptionFailed,n,e)}).on(ParticipantEvent.TrackMuted,n=>{this.emitWhenConnected(RoomEvent.TrackMuted,n,e)}).on(ParticipantEvent.TrackUnmuted,n=>{this.emitWhenConnected(RoomEvent.TrackUnmuted,n,e)}).on(ParticipantEvent.ParticipantMetadataChanged,n=>{this.emitWhenConnected(RoomEvent.ParticipantMetadataChanged,n,e)}).on(ParticipantEvent.ParticipantNameChanged,n=>{this.emitWhenConnected(RoomEvent.ParticipantNameChanged,n,e)}).on(ParticipantEvent.AttributesChanged,n=>{this.emitWhenConnected(RoomEvent.ParticipantAttributesChanged,n,e)}).on(ParticipantEvent.ConnectionQualityChanged,n=>{this.emitWhenConnected(RoomEvent.ConnectionQualityChanged,n,e)}).on(ParticipantEvent.ParticipantPermissionsChanged,n=>{this.emitWhenConnected(RoomEvent.ParticipantPermissionsChanged,n,e)}).on(ParticipantEvent.TrackSubscriptionStatusChanged,(n,s)=>{this.emitWhenConnected(RoomEvent.TrackSubscriptionStatusChanged,n,s,e)}).on(ParticipantEvent.TrackSubscriptionFailed,(n,s)=>{this.emit(RoomEvent.TrackSubscriptionFailed,n,e,s)}).on(ParticipantEvent.TrackSubscriptionPermissionChanged,(n,s)=>{this.emitWhenConnected(RoomEvent.TrackSubscriptionPermissionChanged,n,s,e)}),o&&e.updateInfo(o),e}sendSyncState(){const t=Array.from(this.remoteParticipants.values()).reduce((e,n)=>(e.push(...n.getTrackPublications()),e),[]),o=this.localParticipant.getTrackPublications();this.engine.sendSyncState(t,o)}updateSubscriptions(){for(const t of this.remoteParticipants.values())for(const o of t.videoTrackPublications.values())o.isSubscribed&&o instanceof RemoteTrackPublication&&o.emitTrackUpdate()}getRemoteParticipantBySid(t){const o=this.sidToIdentity.get(t);if(o)return this.remoteParticipants.get(o)}registerConnectionReconcile(){this.clearConnectionReconcile();let t=0;this.connectionReconcileInterval=CriticalTimers.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(t++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:t,engine:{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}})),t>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,DisconnectReason.STATE_MISMATCH))):t=0},connectionReconcileFrequency)}clearConnectionReconcile(){this.connectionReconcileInterval&&CriticalTimers.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(t){return t===this.state?!1:(this.state=t,this.emit(RoomEvent.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(t=>{let[o,e]=t;this.emit(o,...e)}),this.bufferedEvents=[]}emitWhenConnected(t){for(var o=arguments.length,e=new Array(o>1?o-1:0),n=1;n<o;n++)e[n-1]=arguments[n];if(this.state===ConnectionState.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([t,e]);else if(this.state===ConnectionState.Connected)return this.emit(t,...e);return!1}simulateParticipants(t){return __awaiter(this,void 0,void 0,function*(){var o,e;const n=Object.assign({audio:!0,video:!0,useRealTracks:!1},t.publish),s=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},t.participants);if(this.handleDisconnect(),this.roomInfo=new Room$1({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:protoInt64.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new ParticipantInfo({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(RoomEvent.SignalConnected),this.emit(RoomEvent.Connected),this.setAndEmitConnectionState(ConnectionState.Connected),n.video){const c=new LocalTrackPublication(Track.Kind.Video,new TrackInfo({source:TrackSource.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO,name:"video-dummy"}),new LocalVideoTrack(n.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:createDummyVideoStreamTrack(160*((o=s.aspectRatios[0])!==null&&o!==void 0?o:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(c),this.localParticipant.emit(ParticipantEvent.LocalTrackPublished,c)}if(n.audio){const c=new LocalTrackPublication(Track.Kind.Audio,new TrackInfo({source:TrackSource.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO}),new LocalAudioTrack(n.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:getEmptyAudioStreamTrack(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(c),this.localParticipant.emit(ParticipantEvent.LocalTrackPublished,c)}for(let c=0;c<s.count-1;c+=1){let l=new ParticipantInfo({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(c),state:ParticipantInfo_State.ACTIVE,tracks:[],joinedAt:protoInt64.parse(Date.now())});const u=this.getOrCreateParticipant(l.identity,l);if(s.video){const d=createDummyVideoStreamTrack(160*((e=s.aspectRatios[c%s.aspectRatios.length])!==null&&e!==void 0?e:1),160,!1,!0),p=new TrackInfo({source:TrackSource.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO});u.addSubscribedMediaTrack(d,p.sid,new MediaStream([d]),new RTCRtpReceiver),l.tracks=[...l.tracks,p]}if(s.audio){const d=getEmptyAudioStreamTrack(),p=new TrackInfo({source:TrackSource.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO});u.addSubscribedMediaTrack(d,p.sid,new MediaStream([d]),new RTCRtpReceiver),l.tracks=[...l.tracks,p]}u.updateInfo(l)}})}emit(t){for(var o=arguments.length,e=new Array(o>1?o-1:0),n=1;n<o;n++)e[n-1]=arguments[n];if(t!==RoomEvent.ActiveSpeakersChanged){const s=mapArgs(e).filter(c=>c!==void 0);this.log.debug("room event ".concat(t),Object.assign(Object.assign({},this.logContext),{event:t,args:s}))}return super.emit(t,...e)}}function mapArgs(a){return a.map(t=>{if(t)return Array.isArray(t)?mapArgs(t):typeof t=="object"?"logContext"in t&&t.logContext:t})}var CheckStatus;(function(a){a[a.IDLE=0]="IDLE",a[a.RUNNING=1]="RUNNING",a[a.SKIPPED=2]="SKIPPED",a[a.SUCCESS=3]="SUCCESS",a[a.FAILED=4]="FAILED"})(CheckStatus||(CheckStatus={}));class Checker extends eventsExports.EventEmitter{constructor(t,o){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=CheckStatus.IDLE,this.logs=[],this.errorsAsWarnings=!1,this.url=t,this.token=o,this.name=this.constructor.name,this.room=new Room(e.roomOptions),this.connectOptions=e.connectOptions,e.errorsAsWarnings&&(this.errorsAsWarnings=e.errorsAsWarnings)}run(t){return __awaiter(this,void 0,void 0,function*(){if(this.status!==CheckStatus.IDLE)throw Error("check is running already");this.setStatus(CheckStatus.RUNNING);try{yield this.perform()}catch(o){o instanceof Error&&(this.errorsAsWarnings?this.appendWarning(o.message):this.appendError(o.message))}return yield this.disconnect(),yield new Promise(o=>setTimeout(o,500)),this.status!==CheckStatus.SKIPPED&&this.setStatus(this.isSuccess()?CheckStatus.SUCCESS:CheckStatus.FAILED),t&&t(),this.getInfo()})}isSuccess(){return!this.logs.some(t=>t.level==="error")}connect(){return __awaiter(this,void 0,void 0,function*(){return this.room.state===ConnectionState.Connected?this.room:(yield this.room.connect(this.url,this.token),this.room)})}disconnect(){return __awaiter(this,void 0,void 0,function*(){this.room&&this.room.state!==ConnectionState.Disconnected&&(yield this.room.disconnect(),yield new Promise(t=>setTimeout(t,500)))})}skip(){this.setStatus(CheckStatus.SKIPPED)}appendMessage(t){this.logs.push({level:"info",message:t}),this.emit("update",this.getInfo())}appendWarning(t){this.logs.push({level:"warning",message:t}),this.emit("update",this.getInfo())}appendError(t){this.logs.push({level:"error",message:t}),this.emit("update",this.getInfo())}setStatus(t){this.status=t,this.emit("update",this.getInfo())}get engine(){var t;return(t=this.room)===null||t===void 0?void 0:t.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}function createLocalTracks(a){return __awaiter(this,void 0,void 0,function*(){var t,o;a??(a={}),(t=a.audio)!==null&&t!==void 0||(a.audio=!0),(o=a.video)!==null&&o!==void 0||(a.video=!0);const e=mergeDefaultOptions(a,audioDefaults,videoDefaults),n=constraintsForOptions(e),s=navigator.mediaDevices.getUserMedia(n);a.audio&&(DeviceManager.userMediaPromiseMap.set("audioinput",s),s.catch(()=>DeviceManager.userMediaPromiseMap.delete("audioinput"))),a.video&&(DeviceManager.userMediaPromiseMap.set("videoinput",s),s.catch(()=>DeviceManager.userMediaPromiseMap.delete("videoinput")));const c=yield s;return Promise.all(c.getTracks().map(l=>__awaiter(this,void 0,void 0,function*(){const u=l.kind==="audio";let d=u?a.audio:a.video;(typeof d=="boolean"||!d)&&(d={});let p;const g=u?n.audio:n.video;typeof g!="boolean"&&(p=g),p?p.deviceId=l.getSettings().deviceId:p={deviceId:l.getSettings().deviceId};const y=mediaTrackToLocalTrack(l,p);return y.kind===Track.Kind.Video?y.source=Track.Source.Camera:y.kind===Track.Kind.Audio&&(y.source=Track.Source.Microphone),y.mediaStream=c,d.processor&&(y instanceof LocalAudioTrack?yield y.setProcessor(d.processor):y instanceof LocalVideoTrack&&(yield y.setProcessor(d.processor))),y})))})}function createLocalVideoTrack(a){return __awaiter(this,void 0,void 0,function*(){return(yield createLocalTracks({audio:!1,video:a}))[0]})}function createLocalAudioTrack(a){return __awaiter(this,void 0,void 0,function*(){return(yield createLocalTracks({audio:a,video:!1}))[0]})}class PublishAudioCheck extends Checker{get description(){return"Can publish audio"}perform(){return __awaiter(this,void 0,void 0,function*(){var t;const o=yield this.connect(),e=yield createLocalAudioTrack();o.localParticipant.publishTrack(e),yield new Promise(c=>setTimeout(c,3e3));const n=yield(t=e.sender)===null||t===void 0?void 0:t.getStats();if(!n)throw new Error("Could not get RTCStats");let s=0;if(n.forEach(c=>{c.type==="outbound-rtp"&&(c.kind==="audio"||!c.kind&&c.mediaType==="audio")&&(s=c.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," audio packets"))})}}class PublishVideoCheck extends Checker{get description(){return"Can publish video"}perform(){return __awaiter(this,void 0,void 0,function*(){var t;const o=yield this.connect(),e=yield createLocalVideoTrack();o.localParticipant.publishTrack(e),yield new Promise(c=>setTimeout(c,5e3));const n=yield(t=e.sender)===null||t===void 0?void 0:t.getStats();if(!n)throw new Error("Could not get RTCStats");let s=0;if(n.forEach(c=>{c.type==="outbound-rtp"&&(c.kind==="video"||!c.kind&&c.mediaType==="video")&&(s+=c.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}}class ReconnectCheck extends Checker{get description(){return"Resuming connection after interruption"}perform(){return __awaiter(this,void 0,void 0,function*(){var t;const o=yield this.connect();let e=!1,n=!1,s;const c=new Promise(d=>{setTimeout(d,5e3),s=d}),l=()=>{e=!0};o.on(RoomEvent.SignalReconnecting,l).on(RoomEvent.Reconnecting,l).on(RoomEvent.Reconnected,()=>{n=!0,s(!0)}),(t=o.engine.client.ws)===null||t===void 0||t.close();const u=o.engine.client.onClose;if(u&&u(""),yield c,e){if(!n||o.state!==ConnectionState.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class TURNCheck extends Checker{get description(){return"Can connect via TURN"}perform(){return __awaiter(this,void 0,void 0,function*(){var t,o;const e=new SignalClient,n=yield e.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let s=!1,c=!1,l=!1;for(let u of n.iceServers)for(let d of u.urls)d.startsWith("turn:")?(c=!0,l=!0):d.startsWith("turns:")&&(c=!0,l=!0,s=!0),d.startsWith("stun:")&&(l=!0);l?c&&!s&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield e.close(),!((o=(t=this.connectOptions)===null||t===void 0?void 0:t.rtcConfig)===null||o===void 0)&&o.iceServers||c?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(u=>setTimeout(u,0)))})}}class WebRTCCheck extends Checker{get description(){return"Establishing WebRTC connection"}perform(){return __awaiter(this,void 0,void 0,function*(){let t=!1,o=!1;this.room.on(RoomEvent.SignalConnected,()=>{const e=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(n,s)=>{if(n.candidate){const c=new RTCIceCandidate(n);let l="".concat(c.protocol," ").concat(c.address,":").concat(c.port," ").concat(c.type);c.address&&(isIPPrivate(c.address)?l+=" (private)":c.protocol==="tcp"&&c.tcpType==="passive"?(t=!0,l+=" (passive)"):c.protocol==="udp"&&(o=!0)),this.appendMessage(l)}e&&e(n,s)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=n=>{n instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(n.errorCode," ").concat(n.errorText," ").concat(n.url))})});try{yield this.connect(),livekitLogger.info("now the room is connected")}catch(e){throw this.appendWarning("ports need to be open on firewall in order to connect."),e}t||this.appendWarning("Server is not configured for ICE/TCP"),o||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function isIPPrivate(a){const t=a.split(".");if(t.length===4){if(t[0]==="10")return!0;if(t[0]==="192"&&t[1]==="168")return!0;if(t[0]==="172"){const o=parseInt(t[1],10);if(o>=16&&o<=31)return!0}}return!1}class WebSocketCheck extends Checker{get description(){return"Connecting to signal connection via WebSocket"}perform(){return __awaiter(this,void 0,void 0,function*(){var t,o,e;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let n=new SignalClient;const s=yield n.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((t=s.serverInfo)===null||t===void 0?void 0:t.edition)===ServerInfo_Edition.Cloud&&(!((o=s.serverInfo)===null||o===void 0)&&o.region)&&this.appendMessage("LiveKit Cloud: ".concat((e=s.serverInfo)===null||e===void 0?void 0:e.region)),yield n.close()})}}class ConnectionCheck extends eventsExports.EventEmitter{constructor(t,o){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=t,this.token=o,this.options=e}getNextCheckId(){const t=this.checkResults.size;return this.checkResults.set(t,{logs:[],status:CheckStatus.IDLE,name:"",description:""}),t}updateCheck(t,o){this.checkResults.set(t,o),this.emit("checkUpdate",t,o)}isSuccess(){return Array.from(this.checkResults.values()).every(t=>t.status!==CheckStatus.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(t){return __awaiter(this,void 0,void 0,function*(){const o=this.getNextCheckId(),e=new t(this.url,this.token,this.options),n=c=>{this.updateCheck(o,c)};e.on("update",n);const s=yield e.run();return e.off("update",n),s})}checkWebsocket(){return __awaiter(this,void 0,void 0,function*(){return this.createAndRunCheck(WebSocketCheck)})}checkWebRTC(){return __awaiter(this,void 0,void 0,function*(){return this.createAndRunCheck(WebRTCCheck)})}checkTURN(){return __awaiter(this,void 0,void 0,function*(){return this.createAndRunCheck(TURNCheck)})}checkReconnect(){return __awaiter(this,void 0,void 0,function*(){return this.createAndRunCheck(ReconnectCheck)})}checkPublishAudio(){return __awaiter(this,void 0,void 0,function*(){return this.createAndRunCheck(PublishAudioCheck)})}checkPublishVideo(){return __awaiter(this,void 0,void 0,function*(){return this.createAndRunCheck(PublishVideoCheck)})}}var MavAutopilot=(a=>(a.MAV_AUTOPILOT_GENERIC="MAV_AUTOPILOT_GENERIC",a.MAV_AUTOPILOT_RESERVED="MAV_AUTOPILOT_RESERVED",a.MAV_AUTOPILOT_SLUGS="MAV_AUTOPILOT_SLUGS",a.MAV_AUTOPILOT_ARDUPILOTMEGA="MAV_AUTOPILOT_ARDUPILOTMEGA",a.MAV_AUTOPILOT_OPENPILOT="MAV_AUTOPILOT_OPENPILOT",a.MAV_AUTOPILOT_GENERIC_WAYPOINTS_ONLY="MAV_AUTOPILOT_GENERIC_WAYPOINTS_ONLY",a.MAV_AUTOPILOT_GENERIC_WAYPOINTS_AND_SIMPLE_NAVIGATION_ONLY="MAV_AUTOPILOT_GENERIC_WAYPOINTS_AND_SIMPLE_NAVIGATION_ONLY",a.MAV_AUTOPILOT_GENERIC_MISSION_FULL="MAV_AUTOPILOT_GENERIC_MISSION_FULL",a.MAV_AUTOPILOT_INVALID="MAV_AUTOPILOT_INVALID",a.MAV_AUTOPILOT_PPZ="MAV_AUTOPILOT_PPZ",a.MAV_AUTOPILOT_UDB="MAV_AUTOPILOT_UDB",a.MAV_AUTOPILOT_FP="MAV_AUTOPILOT_FP",a.MAV_AUTOPILOT_PX4="MAV_AUTOPILOT_PX4",a.MAV_AUTOPILOT_SMACCMPILOT="MAV_AUTOPILOT_SMACCMPILOT",a.MAV_AUTOPILOT_AUTOQUAD="MAV_AUTOPILOT_AUTOQUAD",a.MAV_AUTOPILOT_ARMAZILA="MAV_AUTOPILOT_ARMAZILA",a.MAV_AUTOPILOT_AEROB="MAV_AUTOPILOT_AEROB",a.MAV_AUTOPILOT_ASLUAV="MAV_AUTOPILOT_ASLUAV",a.MAV_AUTOPILOT_SMARTAP="MAV_AUTOPILOT_SMARTAP",a.MAV_AUTOPILOT_AIRRAILS="MAV_AUTOPILOT_AIRRAILS",a))(MavAutopilot||{}),MavType=(a=>(a.MAV_TYPE_GENERIC="MAV_TYPE_GENERIC",a.MAV_TYPE_FIXED_WING="MAV_TYPE_FIXED_WING",a.MAV_TYPE_QUADROTOR="MAV_TYPE_QUADROTOR",a.MAV_TYPE_COAXIAL="MAV_TYPE_COAXIAL",a.MAV_TYPE_HELICOPTER="MAV_TYPE_HELICOPTER",a.MAV_TYPE_ANTENNA_TRACKER="MAV_TYPE_ANTENNA_TRACKER",a.MAV_TYPE_GCS="MAV_TYPE_GCS",a.MAV_TYPE_AIRSHIP="MAV_TYPE_AIRSHIP",a.MAV_TYPE_FREE_BALLOON="MAV_TYPE_FREE_BALLOON",a.MAV_TYPE_ROCKET="MAV_TYPE_ROCKET",a.MAV_TYPE_GROUND_ROVER="MAV_TYPE_GROUND_ROVER",a.MAV_TYPE_SURFACE_BOAT="MAV_TYPE_SURFACE_BOAT",a.MAV_TYPE_SUBMARINE="MAV_TYPE_SUBMARINE",a.MAV_TYPE_HEXAROTOR="MAV_TYPE_HEXAROTOR",a.MAV_TYPE_OCTOROTOR="MAV_TYPE_OCTOROTOR",a.MAV_TYPE_TRICOPTER="MAV_TYPE_TRICOPTER",a.MAV_TYPE_FLAPPING_WING="MAV_TYPE_FLAPPING_WING",a.MAV_TYPE_KITE="MAV_TYPE_KITE",a.MAV_TYPE_ONBOARD_CONTROLLER="MAV_TYPE_ONBOARD_CONTROLLER",a.MAV_TYPE_VTOL_DUOROTOR="MAV_TYPE_VTOL_DUOROTOR",a.MAV_TYPE_VTOL_QUADROTOR="MAV_TYPE_VTOL_QUADROTOR",a.MAV_TYPE_VTOL_TILTROTOR="MAV_TYPE_VTOL_TILTROTOR",a.MAV_TYPE_VTOL_RESERVED2="MAV_TYPE_VTOL_RESERVED2",a.MAV_TYPE_VTOL_RESERVED3="MAV_TYPE_VTOL_RESERVED3",a.MAV_TYPE_VTOL_RESERVED4="MAV_TYPE_VTOL_RESERVED4",a.MAV_TYPE_VTOL_RESERVED5="MAV_TYPE_VTOL_RESERVED5",a.MAV_TYPE_GIMBAL="MAV_TYPE_GIMBAL",a.MAV_TYPE_ADSB="MAV_TYPE_ADSB",a.MAV_TYPE_PARAFOIL="MAV_TYPE_PARAFOIL",a.MAV_TYPE_DODECAROTOR="MAV_TYPE_DODECAROTOR",a.MAV_TYPE_CAMERA="MAV_TYPE_CAMERA",a.MAV_TYPE_CHARGING_STATION="MAV_TYPE_CHARGING_STATION",a.MAV_TYPE_FLARM="MAV_TYPE_FLARM",a.MAV_TYPE_SERVO="MAV_TYPE_SERVO",a.MAV_TYPE_ODID="MAV_TYPE_ODID",a))(MavType||{}),MavModeFlag=(a=>(a[a.MAV_MODE_FLAG_SAFETY_ARMED=128]="MAV_MODE_FLAG_SAFETY_ARMED",a[a.MAV_MODE_FLAG_MANUAL_INPUT_ENABLED=64]="MAV_MODE_FLAG_MANUAL_INPUT_ENABLED",a[a.MAV_MODE_FLAG_HIL_ENABLED=32]="MAV_MODE_FLAG_HIL_ENABLED",a[a.MAV_MODE_FLAG_STABILIZE_ENABLED=16]="MAV_MODE_FLAG_STABILIZE_ENABLED",a[a.MAV_MODE_FLAG_GUIDED_ENABLED=8]="MAV_MODE_FLAG_GUIDED_ENABLED",a[a.MAV_MODE_FLAG_AUTO_ENABLED=4]="MAV_MODE_FLAG_AUTO_ENABLED",a[a.MAV_MODE_FLAG_TEST_ENABLED=2]="MAV_MODE_FLAG_TEST_ENABLED",a[a.MAV_MODE_FLAG_CUSTOM_MODE_ENABLED=1]="MAV_MODE_FLAG_CUSTOM_MODE_ENABLED",a))(MavModeFlag||{}),MavState=(a=>(a.MAV_STATE_UNINIT="MAV_STATE_UNINIT",a.MAV_STATE_BOOT="MAV_STATE_BOOT",a.MAV_STATE_CALIBRATING="MAV_STATE_CALIBRATING",a.MAV_STATE_STANDBY="MAV_STATE_STANDBY",a.MAV_STATE_ACTIVE="MAV_STATE_ACTIVE",a.MAV_STATE_CRITICAL="MAV_STATE_CRITICAL",a.MAV_STATE_EMERGENCY="MAV_STATE_EMERGENCY",a.MAV_STATE_POWEROFF="MAV_STATE_POWEROFF",a.MAV_STATE_FLIGHT_TERMINATION="MAV_STATE_FLIGHT_TERMINATION",a))(MavState||{}),MAVLinkType=(a=>(a.ACTUATOR_CONTROL_TARGET="ACTUATOR_CONTROL_TARGET",a.ACTUATOR_OUTPUT_STATUS="ACTUATOR_OUTPUT_STATUS",a.ADAP_TUNING="ADAP_TUNING",a.ADSB_VEHICLE="ADSB_VEHICLE",a.AHRS="AHRS",a.AHRS2="AHRS2",a.AHRS3="AHRS3",a.AIRSPEED_AUTOCAL="AIRSPEED_AUTOCAL",a.AIS_VESSEL="AIS_VESSEL",a.ALTITUDE="ALTITUDE",a.AOA_SSA="AOA_SSA",a.AP_ADC="AP_ADC",a.ATT_POS_MOCAP="ATT_POS_MOCAP",a.ATTITUDE="ATTITUDE",a.ATTITUDE_QUATERNION="ATTITUDE_QUATERNION",a.ATTITUDE_QUATERNION_COV="ATTITUDE_QUATERNION_COV",a.ATTITUDE_TARGET="ATTITUDE_TARGET",a.AUTH_KEY="AUTH_KEY",a.AUTOPILOT_STATE_FOR_GIMBAL_DEVICE="AUTOPILOT_STATE_FOR_GIMBAL_DEVICE",a.AUTOPILOT_VERSION="AUTOPILOT_VERSION",a.AUTOPILOT_VERSION_REQUEST="AUTOPILOT_VERSION_REQUEST",a.BATTERY_STATUS="BATTERY_STATUS",a.BATTERY2="BATTERY2",a.BUTTON_CHANGE="BUTTON_CHANGE",a.CAMERA_CAPTURE_STATUS="CAMERA_CAPTURE_STATUS",a.CAMERA_FEEDBACK="CAMERA_FEEDBACK",a.CAMERA_IMAGE_CAPTURED="CAMERA_IMAGE_CAPTURED",a.CAMERA_INFORMATION="CAMERA_INFORMATION",a.CAMERA_SETTINGS="CAMERA_SETTINGS",a.CAMERA_STATUS="CAMERA_STATUS",a.CAMERA_TRIGGER="CAMERA_TRIGGER",a.CELLULAR_CONFIG="CELLULAR_CONFIG",a.CELLULAR_STATUS="CELLULAR_STATUS",a.CHANGE_OPERATOR_CONTROL="CHANGE_OPERATOR_CONTROL",a.CHANGE_OPERATOR_CONTROL_ACK="CHANGE_OPERATOR_CONTROL_ACK",a.COLLISION="COLLISION",a.COMMAND_ACK="COMMAND_ACK",a.COMMAND_CANCEL="COMMAND_CANCEL",a.COMMAND_INT="COMMAND_INT",a.COMMAND_LONG="COMMAND_LONG",a.COMPASSMOT_STATUS="COMPASSMOT_STATUS",a.COMPONENT_INFORMATION="COMPONENT_INFORMATION",a.CONTROL_SYSTEM_STATE="CONTROL_SYSTEM_STATE",a.DATA_STREAM="DATA_STREAM",a.DATA_TRANSMISSION_HANDSHAKE="DATA_TRANSMISSION_HANDSHAKE",a.DATA16="DATA16",a.DATA32="DATA32",a.DATA64="DATA64",a.DATA96="DATA96",a.DEBUG="DEBUG",a.DEBUG_FLOAT_ARRAY="DEBUG_FLOAT_ARRAY",a.DEBUG_VECT="DEBUG_VECT",a.DEEPSTALL="DEEPSTALL",a.DEVICE_OP_READ="DEVICE_OP_READ",a.DEVICE_OP_READ_REPLY="DEVICE_OP_READ_REPLY",a.DEVICE_OP_WRITE="DEVICE_OP_WRITE",a.DEVICE_OP_WRITE_REPLY="DEVICE_OP_WRITE_REPLY",a.DIGICAM_CONFIGURE="DIGICAM_CONFIGURE",a.DIGICAM_CONTROL="DIGICAM_CONTROL",a.DISTANCE_SENSOR="DISTANCE_SENSOR",a.EFI_STATUS="EFI_STATUS",a.EKF_STATUS_REPORT="EKF_STATUS_REPORT",a.ENCAPSULATED_DATA="ENCAPSULATED_DATA",a.ESC_TELEMETRY_1_TO_4="ESC_TELEMETRY_1_TO_4",a.ESC_TELEMETRY_5_TO_8="ESC_TELEMETRY_5_TO_8",a.ESC_TELEMETRY_9_TO_12="ESC_TELEMETRY_9_TO_12",a.ESTIMATOR_STATUS="ESTIMATOR_STATUS",a.EXTENDED_SYS_STATE="EXTENDED_SYS_STATE",a.FENCE_FETCH_POINT="FENCE_FETCH_POINT",a.FENCE_POINT="FENCE_POINT",a.FENCE_STATUS="FENCE_STATUS",a.FILE_TRANSFER_PROTOCOL="FILE_TRANSFER_PROTOCOL",a.FLIGHT_INFORMATION="FLIGHT_INFORMATION",a.FOLLOW_TARGET="FOLLOW_TARGET",a.GENERATOR_STATUS="GENERATOR_STATUS",a.GIMBAL_CONTROL="GIMBAL_CONTROL",a.GIMBAL_DEVICE_ATTITUDE_STATUS="GIMBAL_DEVICE_ATTITUDE_STATUS",a.GIMBAL_DEVICE_INFORMATION="GIMBAL_DEVICE_INFORMATION",a.GIMBAL_DEVICE_SET_ATTITUDE="GIMBAL_DEVICE_SET_ATTITUDE",a.GIMBAL_MANAGER_INFORMATION="GIMBAL_MANAGER_INFORMATION",a.GIMBAL_MANAGER_SET_ATTITUDE="GIMBAL_MANAGER_SET_ATTITUDE",a.GIMBAL_MANAGER_SET_TILTPAN="GIMBAL_MANAGER_SET_TILTPAN",a.GIMBAL_MANAGER_STATUS="GIMBAL_MANAGER_STATUS",a.GIMBAL_REPORT="GIMBAL_REPORT",a.GIMBAL_TORQUE_CMD_REPORT="GIMBAL_TORQUE_CMD_REPORT",a.GLOBAL_POSITION_INT="GLOBAL_POSITION_INT",a.GLOBAL_POSITION_INT_COV="GLOBAL_POSITION_INT_COV",a.GLOBAL_VISION_POSITION_ESTIMATE="GLOBAL_VISION_POSITION_ESTIMATE",a.GOPRO_GET_REQUEST="GOPRO_GET_REQUEST",a.GOPRO_GET_RESPONSE="GOPRO_GET_RESPONSE",a.GOPRO_HEARTBEAT="GOPRO_HEARTBEAT",a.GOPRO_SET_REQUEST="GOPRO_SET_REQUEST",a.GOPRO_SET_RESPONSE="GOPRO_SET_RESPONSE",a.GPS_GLOBAL_ORIGIN="GPS_GLOBAL_ORIGIN",a.GPS_INJECT_DATA="GPS_INJECT_DATA",a.GPS_INPUT="GPS_INPUT",a.GPS_RAW_INT="GPS_RAW_INT",a.GPS_RTCM_DATA="GPS_RTCM_DATA",a.GPS_RTK="GPS_RTK",a.GPS_STATUS="GPS_STATUS",a.GPS2_RAW="GPS2_RAW",a.GPS2_RTK="GPS2_RTK",a.HEARTBEAT="HEARTBEAT",a.HIGH_LATENCY="HIGH_LATENCY",a.HIGH_LATENCY2="HIGH_LATENCY2",a.HIGHRES_IMU="HIGHRES_IMU",a.HIL_ACTUATOR_CONTROLS="HIL_ACTUATOR_CONTROLS",a.HIL_CONTROLS="HIL_CONTROLS",a.HIL_GPS="HIL_GPS",a.HIL_OPTICAL_FLOW="HIL_OPTICAL_FLOW",a.HIL_RC_INPUTS_RAW="HIL_RC_INPUTS_RAW",a.HIL_SENSOR="HIL_SENSOR",a.HIL_STATE="HIL_STATE",a.HIL_STATE_QUATERNION="HIL_STATE_QUATERNION",a.HOME_POSITION="HOME_POSITION",a.HWSTATUS="HWSTATUS",a.ISBD_LINK_STATUS="ISBD_LINK_STATUS",a.LANDING_TARGET="LANDING_TARGET",a.LED_CONTROL="LED_CONTROL",a.LIMITS_STATUS="LIMITS_STATUS",a.LINK_NODE_STATUS="LINK_NODE_STATUS",a.LOCAL_POSITION_NED="LOCAL_POSITION_NED",a.LOCAL_POSITION_NED_COV="LOCAL_POSITION_NED_COV",a.LOCAL_POSITION_NED_SYSTEM_GLOBAL_OFFSET="LOCAL_POSITION_NED_SYSTEM_GLOBAL_OFFSET",a.LOG_DATA="LOG_DATA",a.LOG_ENTRY="LOG_ENTRY",a.LOG_ERASE="LOG_ERASE",a.LOG_REQUEST_DATA="LOG_REQUEST_DATA",a.LOG_REQUEST_END="LOG_REQUEST_END",a.LOG_REQUEST_LIST="LOG_REQUEST_LIST",a.LOGGING_ACK="LOGGING_ACK",a.LOGGING_DATA="LOGGING_DATA",a.LOGGING_DATA_ACKED="LOGGING_DATA_ACKED",a.MAG_CAL_PROGRESS="MAG_CAL_PROGRESS",a.MAG_CAL_REPORT="MAG_CAL_REPORT",a.MANUAL_CONTROL="MANUAL_CONTROL",a.MANUAL_SETPOINT="MANUAL_SETPOINT",a.MEMINFO="MEMINFO",a.MEMORY_VECT="MEMORY_VECT",a.MESSAGE_INTERVAL="MESSAGE_INTERVAL",a.MISSION_ACK="MISSION_ACK",a.MISSION_CHANGED="MISSION_CHANGED",a.MISSION_CLEAR_ALL="MISSION_CLEAR_ALL",a.MISSION_COUNT="MISSION_COUNT",a.MISSION_CURRENT="MISSION_CURRENT",a.MISSION_ITEM="MISSION_ITEM",a.MISSION_ITEM_INT="MISSION_ITEM_INT",a.MISSION_ITEM_REACHED="MISSION_ITEM_REACHED",a.MISSION_REQUEST="MISSION_REQUEST",a.MISSION_REQUEST_INT="MISSION_REQUEST_INT",a.MISSION_REQUEST_LIST="MISSION_REQUEST_LIST",a.MISSION_REQUEST_PARTIAL_LIST="MISSION_REQUEST_PARTIAL_LIST",a.MISSION_SET_CURRENT="MISSION_SET_CURRENT",a.MISSION_WRITE_PARTIAL_LIST="MISSION_WRITE_PARTIAL_LIST",a.MOUNT_CONFIGURE="MOUNT_CONFIGURE",a.MOUNT_CONTROL="MOUNT_CONTROL",a.MOUNT_ORIENTATION="MOUNT_ORIENTATION",a.MOUNT_STATUS="MOUNT_STATUS",a.NAMED_VALUE_FLOAT="NAMED_VALUE_FLOAT",a.NAMED_VALUE_INT="NAMED_VALUE_INT",a.NAV_CONTROLLER_OUTPUT="NAV_CONTROLLER_OUTPUT",a.OBSTACLE_DISTANCE="OBSTACLE_DISTANCE",a.ODOMETRY="ODOMETRY",a.ONBOARD_COMPUTER_STATUS="ONBOARD_COMPUTER_STATUS",a.OPEN_DRONE_ID_AUTHENTICATION="OPEN_DRONE_ID_AUTHENTICATION",a.OPEN_DRONE_ID_BASIC_ID="OPEN_DRONE_ID_BASIC_ID",a.OPEN_DRONE_ID_LOCATION="OPEN_DRONE_ID_LOCATION",a.OPEN_DRONE_ID_MESSAGE_PACK="OPEN_DRONE_ID_MESSAGE_PACK",a.OPEN_DRONE_ID_OPERATOR_ID="OPEN_DRONE_ID_OPERATOR_ID",a.OPEN_DRONE_ID_SELF_ID="OPEN_DRONE_ID_SELF_ID",a.OPEN_DRONE_ID_SYSTEM="OPEN_DRONE_ID_SYSTEM",a.OPTICAL_FLOW="OPTICAL_FLOW",a.OPTICAL_FLOW_RAD="OPTICAL_FLOW_RAD",a.ORBIT_EXECUTION_STATUS="ORBIT_EXECUTION_STATUS",a.PARAM_EXT_ACK="PARAM_EXT_ACK",a.PARAM_EXT_REQUEST_LIST="PARAM_EXT_REQUEST_LIST",a.PARAM_EXT_REQUEST_READ="PARAM_EXT_REQUEST_READ",a.PARAM_EXT_SET="PARAM_EXT_SET",a.PARAM_EXT_VALUE="PARAM_EXT_VALUE",a.PARAM_MAP_RC="PARAM_MAP_RC",a.PARAM_REQUEST_LIST="PARAM_REQUEST_LIST",a.PARAM_REQUEST_READ="PARAM_REQUEST_READ",a.PARAM_SET="PARAM_SET",a.PARAM_VALUE="PARAM_VALUE",a.PID_TUNING="PID_TUNING",a.PING="PING",a.PLAY_TUNE="PLAY_TUNE",a.PLAY_TUNE_V2="PLAY_TUNE_V2",a.POSITION_TARGET_GLOBAL_INT="POSITION_TARGET_GLOBAL_INT",a.POSITION_TARGET_LOCAL_NED="POSITION_TARGET_LOCAL_NED",a.POWER_STATUS="POWER_STATUS",a.PROTOCOL_VERSION="PROTOCOL_VERSION",a.RADIO="RADIO",a.RADIO_STATUS="RADIO_STATUS",a.RALLY_FETCH_POINT="RALLY_FETCH_POINT",a.RALLY_POINT="RALLY_POINT",a.RANGEFINDER="RANGEFINDER",a.RAW_IMU="RAW_IMU",a.RAW_PRESSURE="RAW_PRESSURE",a.RAW_RPM="RAW_RPM",a.RC_CHANNELS="RC_CHANNELS",a.RC_CHANNELS_OVERRIDE="RC_CHANNELS_OVERRIDE",a.RC_CHANNELS_RAW="RC_CHANNELS_RAW",a.RC_CHANNELS_SCALED="RC_CHANNELS_SCALED",a.REMOTE_LOG_BLOCK_STATUS="REMOTE_LOG_BLOCK_STATUS",a.REMOTE_LOG_DATA_BLOCK="REMOTE_LOG_DATA_BLOCK",a.REQUEST_DATA_STREAM="REQUEST_DATA_STREAM",a.RESOURCE_REQUEST="RESOURCE_REQUEST",a.RPM="RPM",a.SAFETY_ALLOWED_AREA="SAFETY_ALLOWED_AREA",a.SAFETY_SET_ALLOWED_AREA="SAFETY_SET_ALLOWED_AREA",a.SCALED_IMU="SCALED_IMU",a.SCALED_IMU2="SCALED_IMU2",a.SCALED_IMU3="SCALED_IMU3",a.SCALED_PRESSURE="SCALED_PRESSURE",a.SCALED_PRESSURE2="SCALED_PRESSURE2",a.SCALED_PRESSURE3="SCALED_PRESSURE3",a.SENSOR_OFFSETS="SENSOR_OFFSETS",a.SERIAL_CONTROL="SERIAL_CONTROL",a.SERVO_OUTPUT_RAW="SERVO_OUTPUT_RAW",a.SET_ACTUATOR_CONTROL_TARGET="SET_ACTUATOR_CONTROL_TARGET",a.SET_ATTITUDE_TARGET="SET_ATTITUDE_TARGET",a.SET_GPS_GLOBAL_ORIGIN="SET_GPS_GLOBAL_ORIGIN",a.SET_HOME_POSITION="SET_HOME_POSITION",a.SET_MAG_OFFSETS="SET_MAG_OFFSETS",a.SET_MODE="SET_MODE",a.SET_POSITION_TARGET_GLOBAL_INT="SET_POSITION_TARGET_GLOBAL_INT",a.SET_POSITION_TARGET_LOCAL_NED="SET_POSITION_TARGET_LOCAL_NED",a.SETUP_SIGNING="SETUP_SIGNING",a.SIM_STATE="SIM_STATE",a.SIMSTATE="SIMSTATE",a.SMART_BATTERY_INFO="SMART_BATTERY_INFO",a.SMART_BATTERY_STATUS="SMART_BATTERY_STATUS",a.STATUSTEXT="STATUSTEXT",a.STORAGE_INFORMATION="STORAGE_INFORMATION",a.SUPPORTED_TUNES="SUPPORTED_TUNES",a.SYS_STATUS="SYS_STATUS",a.SYSTEM_TIME="SYSTEM_TIME",a.TERRAIN_CHECK="TERRAIN_CHECK",a.TERRAIN_DATA="TERRAIN_DATA",a.TERRAIN_REPORT="TERRAIN_REPORT",a.TERRAIN_REQUEST="TERRAIN_REQUEST",a.TIME_ESTIMATE_TO_TARGET="TIME_ESTIMATE_TO_TARGET",a.TIMESYNC="TIMESYNC",a.TRAJECTORY_REPRESENTATION_BEZIER="TRAJECTORY_REPRESENTATION_BEZIER",a.TRAJECTORY_REPRESENTATION_WAYPOINTS="TRAJECTORY_REPRESENTATION_WAYPOINTS",a.TUNNEL="TUNNEL",a.UAVCAN_NODE_INFO="UAVCAN_NODE_INFO",a.UAVCAN_NODE_STATUS="UAVCAN_NODE_STATUS",a.UTM_GLOBAL_POSITION="UTM_GLOBAL_POSITION",a.V2_EXTENSION="V2_EXTENSION",a.VFR_HUD="VFR_HUD",a.VIBRATION="VIBRATION",a.VICON_POSITION_ESTIMATE="VICON_POSITION_ESTIMATE",a.VIDEO_STREAM_INFORMATION="VIDEO_STREAM_INFORMATION",a.VIDEO_STREAM_STATUS="VIDEO_STREAM_STATUS",a.VISION_POSITION_DELTA="VISION_POSITION_DELTA",a.VISION_POSITION_ESTIMATE="VISION_POSITION_ESTIMATE",a.VISION_SPEED_ESTIMATE="VISION_SPEED_ESTIMATE",a.WHEEL_DISTANCE="WHEEL_DISTANCE",a.WIFI_CONFIG_AP="WIFI_CONFIG_AP",a.WIND="WIND",a.WIND_COV="WIND_COV",a))(MAVLinkType||{}),ConnectionStates=(a=>(a.init="Init",a.connecting="Connecting",a.connected="Connected",a.reconnecting="Reconnecting",a.disconnectedOk="Disconnected",a.failed="Failed",a))(ConnectionStates||{});const TE=new TextEncoder,ENCODE_TXT=a=>TE.encode(a),TD=new TextDecoder,DECODE_TXT=a=>TD.decode(a),SECONDS_IN_DAY=60*60*24,FRONTEND_HANDLED_MAVLINK_MESSAGE_TYPES=[MAVLinkType.HEARTBEAT,MAVLinkType.ATTITUDE,MAVLinkType.SYS_STATUS,MAVLinkType.STATUSTEXT,MAVLinkType.SCALED_PRESSURE,MAVLinkType.SCALED_PRESSURE2,MAVLinkType.SCALED_PRESSURE3],LIVEKIT_BACKEND_ROOM_CONNECTION_CONFIG={autoSubscribe:!1,maxRetries:2,peerConnectionTimeout:3e4},LIVEKIT_BACKEND_ROOM_CONFIG={reconnectPolicy:new DefaultReconnectPolicy,dynacast:!0,adaptiveStream:!1,stopLocalTrackOnUnpublish:!0,videoCaptureDefaults:{resolution:{width:1920,height:1080,frameRate:60},facingMode:"environment"},publishDefaults:{videoCodec:"vp9",videoEncoding:{maxBitrate:7e6,maxFramerate:60,priority:"high"},backupCodec:!0,simulcast:!1,degradationPreference:"maintain-resolution"}};new DefaultReconnectPolicy;const SIMPLEPEER_BASE_CONFIG={initiator:!0,trickle:!0,iceRestartEnabled:"onDisconnect",offerOptions:{offerToReceiveAudio:!1,offerToReceiveVideo:!1},config:{bundlePolicy:"balanced",iceTransportPolicy:"all"},iceCompleteTimeout:1e3},SIMPLEPEER_CAPTURE_CONFIG={video:{width:1920,height:1080,frameRate:60,facingMode:"environment"},audio:!1};var indexMinimal={},minimal$1={},aspromise=asPromise;function asPromise(a,t){for(var o=new Array(arguments.length-1),e=0,n=2,s=!0;n<arguments.length;)o[e++]=arguments[n++];return new Promise(function(l,u){o[e]=function(p){if(s)if(s=!1,p)u(p);else{for(var g=new Array(arguments.length-1),y=0;y<g.length;)g[y++]=arguments[y];l.apply(null,g)}};try{a.apply(t||null,o)}catch(d){s&&(s=!1,u(d))}})}var base64$1={};(function(a){var t=a;t.length=function(l){var u=l.length;if(!u)return 0;for(var d=0;--u%4>1&&l.charAt(u)==="=";)++d;return Math.ceil(l.length*3)/4-d};for(var o=new Array(64),e=new Array(123),n=0;n<64;)e[o[n]=n<26?n+65:n<52?n+71:n<62?n-4:n-59|43]=n++;t.encode=function(l,u,d){for(var p=null,g=[],y=0,T=0,b;u<d;){var k=l[u++];switch(T){case 0:g[y++]=o[k>>2],b=(k&3)<<4,T=1;break;case 1:g[y++]=o[b|k>>4],b=(k&15)<<2,T=2;break;case 2:g[y++]=o[b|k>>6],g[y++]=o[k&63],T=0;break}y>8191&&((p||(p=[])).push(String.fromCharCode.apply(String,g)),y=0)}return T&&(g[y++]=o[b],g[y++]=61,T===1&&(g[y++]=61)),p?(y&&p.push(String.fromCharCode.apply(String,g.slice(0,y))),p.join("")):String.fromCharCode.apply(String,g.slice(0,y))};var s="invalid encoding";t.decode=function(l,u,d){for(var p=d,g=0,y,T=0;T<l.length;){var b=l.charCodeAt(T++);if(b===61&&g>1)break;if((b=e[b])===void 0)throw Error(s);switch(g){case 0:y=b,g=1;break;case 1:u[d++]=y<<2|(b&48)>>4,y=b,g=2;break;case 2:u[d++]=(y&15)<<4|(b&60)>>2,y=b,g=3;break;case 3:u[d++]=(y&3)<<6|b,g=0;break}}if(g===1)throw Error(s);return d-p},t.test=function(l){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(l)}})(base64$1);var eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(t,o,e){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:o,ctx:e||this}),this};EventEmitter.prototype.off=function(t,o){if(t===void 0)this._listeners={};else if(o===void 0)this._listeners[t]=[];else for(var e=this._listeners[t],n=0;n<e.length;)e[n].fn===o?e.splice(n,1):++n;return this};EventEmitter.prototype.emit=function(t){var o=this._listeners[t];if(o){for(var e=[],n=1;n<arguments.length;)e.push(arguments[n++]);for(n=0;n<o.length;)o[n].fn.apply(o[n++].ctx,e)}return this};var float=factory(factory);function factory(a){return typeof Float32Array<"u"?function(){var t=new Float32Array([-0]),o=new Uint8Array(t.buffer),e=o[3]===128;function n(u,d,p){t[0]=u,d[p]=o[0],d[p+1]=o[1],d[p+2]=o[2],d[p+3]=o[3]}function s(u,d,p){t[0]=u,d[p]=o[3],d[p+1]=o[2],d[p+2]=o[1],d[p+3]=o[0]}a.writeFloatLE=e?n:s,a.writeFloatBE=e?s:n;function c(u,d){return o[0]=u[d],o[1]=u[d+1],o[2]=u[d+2],o[3]=u[d+3],t[0]}function l(u,d){return o[3]=u[d],o[2]=u[d+1],o[1]=u[d+2],o[0]=u[d+3],t[0]}a.readFloatLE=e?c:l,a.readFloatBE=e?l:c}():function(){function t(e,n,s,c){var l=n<0?1:0;if(l&&(n=-n),n===0)e(1/n>0?0:2147483648,s,c);else if(isNaN(n))e(2143289344,s,c);else if(n>34028234663852886e22)e((l<<31|2139095040)>>>0,s,c);else if(n<11754943508222875e-54)e((l<<31|Math.round(n/1401298464324817e-60))>>>0,s,c);else{var u=Math.floor(Math.log(n)/Math.LN2),d=Math.round(n*Math.pow(2,-u)*8388608)&8388607;e((l<<31|u+127<<23|d)>>>0,s,c)}}a.writeFloatLE=t.bind(null,writeUintLE),a.writeFloatBE=t.bind(null,writeUintBE);function o(e,n,s){var c=e(n,s),l=(c>>31)*2+1,u=c>>>23&255,d=c&8388607;return u===255?d?NaN:l*(1/0):u===0?l*1401298464324817e-60*d:l*Math.pow(2,u-150)*(d+8388608)}a.readFloatLE=o.bind(null,readUintLE),a.readFloatBE=o.bind(null,readUintBE)}(),typeof Float64Array<"u"?function(){var t=new Float64Array([-0]),o=new Uint8Array(t.buffer),e=o[7]===128;function n(u,d,p){t[0]=u,d[p]=o[0],d[p+1]=o[1],d[p+2]=o[2],d[p+3]=o[3],d[p+4]=o[4],d[p+5]=o[5],d[p+6]=o[6],d[p+7]=o[7]}function s(u,d,p){t[0]=u,d[p]=o[7],d[p+1]=o[6],d[p+2]=o[5],d[p+3]=o[4],d[p+4]=o[3],d[p+5]=o[2],d[p+6]=o[1],d[p+7]=o[0]}a.writeDoubleLE=e?n:s,a.writeDoubleBE=e?s:n;function c(u,d){return o[0]=u[d],o[1]=u[d+1],o[2]=u[d+2],o[3]=u[d+3],o[4]=u[d+4],o[5]=u[d+5],o[6]=u[d+6],o[7]=u[d+7],t[0]}function l(u,d){return o[7]=u[d],o[6]=u[d+1],o[5]=u[d+2],o[4]=u[d+3],o[3]=u[d+4],o[2]=u[d+5],o[1]=u[d+6],o[0]=u[d+7],t[0]}a.readDoubleLE=e?c:l,a.readDoubleBE=e?l:c}():function(){function t(e,n,s,c,l,u){var d=c<0?1:0;if(d&&(c=-c),c===0)e(0,l,u+n),e(1/c>0?0:2147483648,l,u+s);else if(isNaN(c))e(0,l,u+n),e(2146959360,l,u+s);else if(c>17976931348623157e292)e(0,l,u+n),e((d<<31|2146435072)>>>0,l,u+s);else{var p;if(c<22250738585072014e-324)p=c/5e-324,e(p>>>0,l,u+n),e((d<<31|p/4294967296)>>>0,l,u+s);else{var g=Math.floor(Math.log(c)/Math.LN2);g===1024&&(g=1023),p=c*Math.pow(2,-g),e(p*4503599627370496>>>0,l,u+n),e((d<<31|g+1023<<20|p*1048576&1048575)>>>0,l,u+s)}}}a.writeDoubleLE=t.bind(null,writeUintLE,0,4),a.writeDoubleBE=t.bind(null,writeUintBE,4,0);function o(e,n,s,c,l){var u=e(c,l+n),d=e(c,l+s),p=(d>>31)*2+1,g=d>>>20&2047,y=4294967296*(d&1048575)+u;return g===2047?y?NaN:p*(1/0):g===0?p*5e-324*y:p*Math.pow(2,g-1075)*(y+4503599627370496)}a.readDoubleLE=o.bind(null,readUintLE,0,4),a.readDoubleBE=o.bind(null,readUintBE,4,0)}(),a}function writeUintLE(a,t,o){t[o]=a&255,t[o+1]=a>>>8&255,t[o+2]=a>>>16&255,t[o+3]=a>>>24}function writeUintBE(a,t,o){t[o]=a>>>24,t[o+1]=a>>>16&255,t[o+2]=a>>>8&255,t[o+3]=a&255}function readUintLE(a,t){return(a[t]|a[t+1]<<8|a[t+2]<<16|a[t+3]<<24)>>>0}function readUintBE(a,t){return(a[t]<<24|a[t+1]<<16|a[t+2]<<8|a[t+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(a){}return null}var utf8$2={};(function(a){var t=a;t.length=function(e){for(var n=0,s=0,c=0;c<e.length;++c)s=e.charCodeAt(c),s<128?n+=1:s<2048?n+=2:(s&64512)===55296&&(e.charCodeAt(c+1)&64512)===56320?(++c,n+=4):n+=3;return n},t.read=function(e,n,s){var c=s-n;if(c<1)return"";for(var l=null,u=[],d=0,p;n<s;)p=e[n++],p<128?u[d++]=p:p>191&&p<224?u[d++]=(p&31)<<6|e[n++]&63:p>239&&p<365?(p=((p&7)<<18|(e[n++]&63)<<12|(e[n++]&63)<<6|e[n++]&63)-65536,u[d++]=55296+(p>>10),u[d++]=56320+(p&1023)):u[d++]=(p&15)<<12|(e[n++]&63)<<6|e[n++]&63,d>8191&&((l||(l=[])).push(String.fromCharCode.apply(String,u)),d=0);return l?(d&&l.push(String.fromCharCode.apply(String,u.slice(0,d))),l.join("")):String.fromCharCode.apply(String,u.slice(0,d))},t.write=function(e,n,s){for(var c=s,l,u,d=0;d<e.length;++d)l=e.charCodeAt(d),l<128?n[s++]=l:l<2048?(n[s++]=l>>6|192,n[s++]=l&63|128):(l&64512)===55296&&((u=e.charCodeAt(d+1))&64512)===56320?(l=65536+((l&1023)<<10)+(u&1023),++d,n[s++]=l>>18|240,n[s++]=l>>12&63|128,n[s++]=l>>6&63|128,n[s++]=l&63|128):(n[s++]=l>>12|224,n[s++]=l>>6&63|128,n[s++]=l&63|128);return s-c}})(utf8$2);var pool_1=pool;function pool(a,t,o){var e=o||8192,n=e>>>1,s=null,c=e;return function(u){if(u<1||u>n)return a(u);c+u>e&&(s=a(e),c=0);var d=t.call(s,c,c+=u);return c&7&&(c=(c|7)+1),d}}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=t;var a=requireMinimal();function t(s,c){this.lo=s>>>0,this.hi=c>>>0}var o=t.zero=new t(0,0);o.toNumber=function(){return 0},o.zzEncode=o.zzDecode=function(){return this},o.length=function(){return 1};var e=t.zeroHash="\0\0\0\0\0\0\0\0";t.fromNumber=function(c){if(c===0)return o;var l=c<0;l&&(c=-c);var u=c>>>0,d=(c-u)/4294967296>>>0;return l&&(d=~d>>>0,u=~u>>>0,++u>4294967295&&(u=0,++d>4294967295&&(d=0))),new t(u,d)},t.from=function(c){if(typeof c=="number")return t.fromNumber(c);if(a.isString(c))if(a.Long)c=a.Long.fromString(c);else return t.fromNumber(parseInt(c,10));return c.low||c.high?new t(c.low>>>0,c.high>>>0):o},t.prototype.toNumber=function(c){if(!c&&this.hi>>>31){var l=~this.lo+1>>>0,u=~this.hi>>>0;return l||(u=u+1>>>0),-(l+u*4294967296)}return this.lo+this.hi*4294967296},t.prototype.toLong=function(c){return a.Long?new a.Long(this.lo|0,this.hi|0,!!c):{low:this.lo|0,high:this.hi|0,unsigned:!!c}};var n=String.prototype.charCodeAt;return t.fromHash=function(c){return c===e?o:new t((n.call(c,0)|n.call(c,1)<<8|n.call(c,2)<<16|n.call(c,3)<<24)>>>0,(n.call(c,4)|n.call(c,5)<<8|n.call(c,6)<<16|n.call(c,7)<<24)>>>0)},t.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},t.prototype.zzEncode=function(){var c=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^c)>>>0,this.lo=(this.lo<<1^c)>>>0,this},t.prototype.zzDecode=function(){var c=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^c)>>>0,this.hi=(this.hi>>>1^c)>>>0,this},t.prototype.length=function(){var c=this.lo,l=(this.lo>>>28|this.hi<<4)>>>0,u=this.hi>>>24;return u===0?l===0?c<16384?c<128?1:2:c<2097152?3:4:l<16384?l<128?5:6:l<2097152?7:8:u<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(a){var t=a;t.asPromise=aspromise,t.base64=base64$1,t.EventEmitter=eventemitter,t.float=float,t.inquire=inquire_1,t.utf8=utf8$2,t.pool=pool_1,t.LongBits=requireLongbits(),t.isNode=!!(typeof commonjsGlobal$1<"u"&&commonjsGlobal$1&&commonjsGlobal$1.process&&commonjsGlobal$1.process.versions&&commonjsGlobal$1.process.versions.node),t.global=t.isNode&&commonjsGlobal$1||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal$1,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(s){return typeof s=="number"&&isFinite(s)&&Math.floor(s)===s},t.isString=function(s){return typeof s=="string"||s instanceof String},t.isObject=function(s){return s&&typeof s=="object"},t.isset=t.isSet=function(s,c){var l=s[c];return l!=null&&s.hasOwnProperty(c)?typeof l!="object"||(Array.isArray(l)?l.length:Object.keys(l).length)>0:!1},t.Buffer=function(){try{var n=t.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(s){return typeof s=="number"?t.Buffer?t._Buffer_allocUnsafe(s):new t.Array(s):t.Buffer?t._Buffer_from(s):typeof Uint8Array>"u"?s:new Uint8Array(s)},t.Array=typeof Uint8Array<"u"?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(s){return s?t.LongBits.from(s).toHash():t.LongBits.zeroHash},t.longFromHash=function(s,c){var l=t.LongBits.fromHash(s);return t.Long?t.Long.fromBits(l.lo,l.hi,c):l.toNumber(!!c)};function o(n,s,c){for(var l=Object.keys(s),u=0;u<l.length;++u)(n[l[u]]===void 0||!c)&&(n[l[u]]=s[l[u]]);return n}t.merge=o,t.lcFirst=function(s){return s.charAt(0).toLowerCase()+s.substring(1)};function e(n){function s(c,l){if(!(this instanceof s))return new s(c,l);Object.defineProperty(this,"message",{get:function(){return c}}),Error.captureStackTrace?Error.captureStackTrace(this,s):Object.defineProperty(this,"stack",{value:new Error().stack||""}),l&&o(this,l)}return s.prototype=Object.create(Error.prototype,{constructor:{value:s,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),s}t.newError=e,t.ProtocolError=e("ProtocolError"),t.oneOfGetter=function(s){for(var c={},l=0;l<s.length;++l)c[s[l]]=1;return function(){for(var u=Object.keys(this),d=u.length-1;d>-1;--d)if(c[u[d]]===1&&this[u[d]]!==void 0&&this[u[d]]!==null)return u[d]}},t.oneOfSetter=function(s){return function(c){for(var l=0;l<s.length;++l)s[l]!==c&&delete this[s[l]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var n=t.Buffer;if(!n){t._Buffer_from=t._Buffer_allocUnsafe=null;return}t._Buffer_from=n.from!==Uint8Array.from&&n.from||function(c,l){return new n(c,l)},t._Buffer_allocUnsafe=n.allocUnsafe||function(c){return new n(c)}}}(minimal$1)),minimal$1}var writer=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(a,t,o){this.fn=a,this.len=t,this.next=void 0,this.val=o}function noop(){}function State(a){this.head=a.head,this.tail=a.tail,this.len=a.len,this.next=a.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function a(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};Writer$1.create=create$1();Writer$1.alloc=function a(t){return new util$4.Array(t)};util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray));Writer$1.prototype._push=function a(t,o,e){return this.tail=this.tail.next=new Op(t,o,e),this.len+=o,this};function writeByte(a,t,o){t[o]=a&255}function writeVarint32(a,t,o){for(;a>127;)t[o++]=a&127|128,a>>>=7;t[o]=a}function VarintOp(a,t){this.len=a,this.next=void 0,this.val=t}VarintOp.prototype=Object.create(Op.prototype);VarintOp.prototype.fn=writeVarint32;Writer$1.prototype.uint32=function a(t){return this.len+=(this.tail=this.tail.next=new VarintOp((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this};Writer$1.prototype.int32=function a(t){return t<0?this._push(writeVarint64,10,LongBits$1.fromNumber(t)):this.uint32(t)};Writer$1.prototype.sint32=function a(t){return this.uint32((t<<1^t>>31)>>>0)};function writeVarint64(a,t,o){for(;a.hi;)t[o++]=a.lo&127|128,a.lo=(a.lo>>>7|a.hi<<25)>>>0,a.hi>>>=7;for(;a.lo>127;)t[o++]=a.lo&127|128,a.lo=a.lo>>>7;t[o++]=a.lo}Writer$1.prototype.uint64=function a(t){var o=LongBits$1.from(t);return this._push(writeVarint64,o.length(),o)};Writer$1.prototype.int64=Writer$1.prototype.uint64;Writer$1.prototype.sint64=function a(t){var o=LongBits$1.from(t).zzEncode();return this._push(writeVarint64,o.length(),o)};Writer$1.prototype.bool=function a(t){return this._push(writeByte,1,t?1:0)};function writeFixed32(a,t,o){t[o]=a&255,t[o+1]=a>>>8&255,t[o+2]=a>>>16&255,t[o+3]=a>>>24}Writer$1.prototype.fixed32=function a(t){return this._push(writeFixed32,4,t>>>0)};Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32;Writer$1.prototype.fixed64=function a(t){var o=LongBits$1.from(t);return this._push(writeFixed32,4,o.lo)._push(writeFixed32,4,o.hi)};Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64;Writer$1.prototype.float=function a(t){return this._push(util$4.float.writeFloatLE,4,t)};Writer$1.prototype.double=function a(t){return this._push(util$4.float.writeDoubleLE,8,t)};var writeBytes=util$4.Array.prototype.set?function a(t,o,e){o.set(t,e)}:function a(t,o,e){for(var n=0;n<t.length;++n)o[e+n]=t[n]};Writer$1.prototype.bytes=function a(t){var o=t.length>>>0;if(!o)return this._push(writeByte,1,0);if(util$4.isString(t)){var e=Writer$1.alloc(o=base64.length(t));base64.decode(t,e,0),t=e}return this.uint32(o)._push(writeBytes,o,t)};Writer$1.prototype.string=function a(t){var o=utf8$1.length(t);return o?this.uint32(o)._push(utf8$1.write,o,t):this._push(writeByte,1,0)};Writer$1.prototype.fork=function a(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this};Writer$1.prototype.reset=function a(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this};Writer$1.prototype.ldelim=function a(){var t=this.head,o=this.tail,e=this.len;return this.reset().uint32(e),e&&(this.tail.next=t.next,this.tail=o,this.len+=e),this};Writer$1.prototype.finish=function a(){for(var t=this.head.next,o=this.constructor.alloc(this.len),e=0;t;)t.fn(t.val,o,e),e+=t.len,t=t.next;return o};Writer$1._configure=function(a){BufferWriter$1=a,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&util$3.Buffer.prototype.set.name==="set"?function(t,o,e){o.set(t,e)}:function(t,o,e){if(t.copy)t.copy(o,e,0,t.length);else for(var n=0;n<t.length;)o[e++]=t[n++]}};BufferWriter.prototype.bytes=function a(t){util$3.isString(t)&&(t=util$3._Buffer_from(t,"base64"));var o=t.length>>>0;return this.uint32(o),o&&this._push(BufferWriter.writeBytesBuffer,o,t),this};function writeStringBuffer(a,t,o){a.length<40?util$3.utf8.write(a,t,o):t.utf8Write?t.utf8Write(a,o):t.write(a,o)}BufferWriter.prototype.string=function a(t){var o=util$3.Buffer.byteLength(t);return this.uint32(o),o&&this._push(writeStringBuffer,o,t),this};BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(a,t){return RangeError("index out of range: "+a.pos+" + "+(t||1)+" > "+a.len)}function Reader$1(a){this.buf=a,this.pos=0,this.len=a.length}var create_array=typeof Uint8Array<"u"?function a(t){if(t instanceof Uint8Array||Array.isArray(t))return new Reader$1(t);throw Error("illegal buffer")}:function a(t){if(Array.isArray(t))return new Reader$1(t);throw Error("illegal buffer")},create=function a(){return util$2.Buffer?function(o){return(Reader$1.create=function(n){return util$2.Buffer.isBuffer(n)?new BufferReader$1(n):create_array(n)})(o)}:create_array};Reader$1.create=create();Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice;Reader$1.prototype.uint32=function a(){var t=4294967295;return function(){if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return t}}();Reader$1.prototype.int32=function a(){return this.uint32()|0};Reader$1.prototype.sint32=function a(){var t=this.uint32();return t>>>1^-(t&1)|0};function readLongVarint(){var a=new LongBits(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(a.lo=(a.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return a;if(a.lo=(a.lo|(this.buf[this.pos]&127)<<28)>>>0,a.hi=(a.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return a;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(a.lo=(a.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return a}return a.lo=(a.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,a}if(this.len-this.pos>4){for(;t<5;++t)if(a.hi=(a.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return a}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(a.hi=(a.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return a}throw Error("invalid varint encoding")}Reader$1.prototype.bool=function a(){return this.uint32()!==0};function readFixed32_end(a,t){return(a[t-4]|a[t-3]<<8|a[t-2]<<16|a[t-1]<<24)>>>0}Reader$1.prototype.fixed32=function a(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)};Reader$1.prototype.sfixed32=function a(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)|0};function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.prototype.float=function a(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var t=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t};Reader$1.prototype.double=function a(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var t=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t};Reader$1.prototype.bytes=function a(){var t=this.uint32(),o=this.pos,e=this.pos+t;if(e>this.len)throw indexOutOfRange(this,t);if(this.pos+=t,Array.isArray(this.buf))return this.buf.slice(o,e);if(o===e){var n=util$2.Buffer;return n?n.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,o,e)};Reader$1.prototype.string=function a(){var t=this.bytes();return utf8.read(t,0,t.length)};Reader$1.prototype.skip=function a(t){if(typeof t=="number"){if(this.pos+t>this.len)throw indexOutOfRange(this,t);this.pos+=t}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this};Reader$1.prototype.skipType=function(a){switch(a){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(a=this.uint32()&7)!==4;)this.skipType(a);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+a+" at offset "+this.pos)}return this};Reader$1._configure=function(a){BufferReader$1=a,Reader$1.create=create(),BufferReader$1._configure();var t=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[t](!1)},uint64:function(){return readLongVarint.call(this)[t](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64.call(this)[t](!0)},sfixed64:function(){return readFixed64.call(this)[t](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(a){Reader.call(this,a)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)};BufferReader.prototype.string=function a(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))};BufferReader._configure();var rpc={},service=Service,util=requireMinimal();(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service;function Service(a,t,o){if(typeof a!="function")throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=a,this.requestDelimited=!!t,this.responseDelimited=!!o}Service.prototype.rpcCall=function a(t,o,e,n,s){if(!n)throw TypeError("request must be specified");var c=this;if(!s)return util.asPromise(a,c,t,o,e,n);if(!c.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return c.rpcImpl(t,o[c.requestDelimited?"encodeDelimited":"encode"](n).finish(),function(u,d){if(u)return c.emit("error",u,t),s(u);if(d===null){c.end(!0);return}if(!(d instanceof e))try{d=e[c.responseDelimited?"decodeDelimited":"decode"](d)}catch(p){return c.emit("error",p,t),s(p)}return c.emit("data",d,t),s(null,d)})}catch(l){c.emit("error",l,t),setTimeout(function(){s(l)},0);return}};Service.prototype.end=function a(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};(function(a){var t=a;t.Service=service})(rpc);var roots={};(function(a){var t=a;t.build="minimal",t.Writer=writer,t.BufferWriter=writer_buffer,t.Reader=reader,t.BufferReader=reader_buffer,t.util=requireMinimal(),t.rpc=rpc,t.roots=roots,t.configure=o;function o(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}o()})(indexMinimal);var minimal=indexMinimal;const $Reader=minimal.Reader,$Writer=minimal.Writer,$util=minimal.util,$root=minimal.roots.default||(minimal.roots.default={}),rov_actions_proto=$root.rov_actions_proto=(()=>{const a={};return a.LogLevel=function(){const t={},o=Object.create(t);return o[t[0]="Debug"]=0,o[t[1]="Info"]=1,o[t[2]="Warning"]=2,o[t[3]="Error"]=3,o[t[4]="Critical"]=4,o}(),a.SensorMeasurmentTypes=function(){const t={},o=Object.create(t);return o[t[0]="depth_meters"]=0,o[t[1]="water_temp_celsius"]=1,o[t[2]="pressure_mbar"]=2,o[t[3]="yaw_degrees"]=3,o[t[4]="pitch_degrees"]=4,o[t[5]="roll_degrees"]=5,o[t[6]="x_acceleration_m_s2"]=6,o[t[7]="y_acceleration_m_s2"]=7,o[t[8]="z_acceleration_m_s2"]=8,o[t[9]="battery_voltage"]=9,o[t[10]="battery_current_amps"]=10,o[t[11]="internal_temp_celsius"]=11,o}(),a.DataTransportMethod=function(){const t={},o=Object.create(t);return o[t[0]="LivekitReliable"]=0,o[t[1]="LivekitUnreliable"]=1,o[t[2]="DirectReliable"]=2,o[t[3]="DirectUnreliable"]=3,o}(),a.InternalWebpageEvent=function(){const t={},o=Object.create(t);return o[t[0]="Nothing"]=0,o[t[1]="RovConnected"]=1,o[t[2]="RovDisconnected"]=2,o[t[3]="UserConnected"]=3,o[t[4]="UserDisconnected"]=4,o}(),a.VideoSenderStats=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.encoderImplementation="",t.prototype.powerEfficientEncoder=!1,t.prototype.qualityLimitationReason="",t.prototype.cpuLimitedQualityDurration=0,t.prototype.bandwidthLimitedQualityDurration=0,t.prototype.otherLimitedQualityDurration=0,t.prototype.noLimitedQualityDurration=0,t.prototype.totalPacketSendDelay=0,t.prototype.retransmittedBytesSent=0,t.prototype.scalabilityMode="",t.prototype.qualityLimitationResolutionChanges=0,t.prototype.frameWidth=0,t.prototype.frameHeight=0,t.prototype.framesPerSecond=0,t.prototype.videoCodec="",t.prototype.videoSdpFmtpLine="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.encoderImplementation!=null&&Object.hasOwnProperty.call(e,"encoderImplementation")&&n.uint32(10).string(e.encoderImplementation),e.powerEfficientEncoder!=null&&Object.hasOwnProperty.call(e,"powerEfficientEncoder")&&n.uint32(16).bool(e.powerEfficientEncoder),e.qualityLimitationReason!=null&&Object.hasOwnProperty.call(e,"qualityLimitationReason")&&n.uint32(26).string(e.qualityLimitationReason),e.cpuLimitedQualityDurration!=null&&Object.hasOwnProperty.call(e,"cpuLimitedQualityDurration")&&n.uint32(37).float(e.cpuLimitedQualityDurration),e.bandwidthLimitedQualityDurration!=null&&Object.hasOwnProperty.call(e,"bandwidthLimitedQualityDurration")&&n.uint32(45).float(e.bandwidthLimitedQualityDurration),e.otherLimitedQualityDurration!=null&&Object.hasOwnProperty.call(e,"otherLimitedQualityDurration")&&n.uint32(53).float(e.otherLimitedQualityDurration),e.noLimitedQualityDurration!=null&&Object.hasOwnProperty.call(e,"noLimitedQualityDurration")&&n.uint32(61).float(e.noLimitedQualityDurration),e.totalPacketSendDelay!=null&&Object.hasOwnProperty.call(e,"totalPacketSendDelay")&&n.uint32(69).float(e.totalPacketSendDelay),e.retransmittedBytesSent!=null&&Object.hasOwnProperty.call(e,"retransmittedBytesSent")&&n.uint32(77).float(e.retransmittedBytesSent),e.scalabilityMode!=null&&Object.hasOwnProperty.call(e,"scalabilityMode")&&n.uint32(82).string(e.scalabilityMode),e.qualityLimitationResolutionChanges!=null&&Object.hasOwnProperty.call(e,"qualityLimitationResolutionChanges")&&n.uint32(88).uint32(e.qualityLimitationResolutionChanges),e.frameWidth!=null&&Object.hasOwnProperty.call(e,"frameWidth")&&n.uint32(96).int32(e.frameWidth),e.frameHeight!=null&&Object.hasOwnProperty.call(e,"frameHeight")&&n.uint32(104).int32(e.frameHeight),e.framesPerSecond!=null&&Object.hasOwnProperty.call(e,"framesPerSecond")&&n.uint32(112).int32(e.framesPerSecond),e.videoSdpFmtpLine!=null&&Object.hasOwnProperty.call(e,"videoSdpFmtpLine")&&n.uint32(122).string(e.videoSdpFmtpLine),e.videoCodec!=null&&Object.hasOwnProperty.call(e,"videoCodec")&&n.uint32(130).string(e.videoCodec),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.VideoSenderStats;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.encoderImplementation=e.string();break}case 2:{c.powerEfficientEncoder=e.bool();break}case 3:{c.qualityLimitationReason=e.string();break}case 4:{c.cpuLimitedQualityDurration=e.float();break}case 5:{c.bandwidthLimitedQualityDurration=e.float();break}case 6:{c.otherLimitedQualityDurration=e.float();break}case 7:{c.noLimitedQualityDurration=e.float();break}case 8:{c.totalPacketSendDelay=e.float();break}case 9:{c.retransmittedBytesSent=e.float();break}case 10:{c.scalabilityMode=e.string();break}case 11:{c.qualityLimitationResolutionChanges=e.uint32();break}case 12:{c.frameWidth=e.int32();break}case 13:{c.frameHeight=e.int32();break}case 14:{c.framesPerSecond=e.int32();break}case 16:{c.videoCodec=e.string();break}case 15:{c.videoSdpFmtpLine=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.encoderImplementation!=null&&e.hasOwnProperty("encoderImplementation")&&!$util.isString(e.encoderImplementation)?"encoderImplementation: string expected":e.powerEfficientEncoder!=null&&e.hasOwnProperty("powerEfficientEncoder")&&typeof e.powerEfficientEncoder!="boolean"?"powerEfficientEncoder: boolean expected":e.qualityLimitationReason!=null&&e.hasOwnProperty("qualityLimitationReason")&&!$util.isString(e.qualityLimitationReason)?"qualityLimitationReason: string expected":e.cpuLimitedQualityDurration!=null&&e.hasOwnProperty("cpuLimitedQualityDurration")&&typeof e.cpuLimitedQualityDurration!="number"?"cpuLimitedQualityDurration: number expected":e.bandwidthLimitedQualityDurration!=null&&e.hasOwnProperty("bandwidthLimitedQualityDurration")&&typeof e.bandwidthLimitedQualityDurration!="number"?"bandwidthLimitedQualityDurration: number expected":e.otherLimitedQualityDurration!=null&&e.hasOwnProperty("otherLimitedQualityDurration")&&typeof e.otherLimitedQualityDurration!="number"?"otherLimitedQualityDurration: number expected":e.noLimitedQualityDurration!=null&&e.hasOwnProperty("noLimitedQualityDurration")&&typeof e.noLimitedQualityDurration!="number"?"noLimitedQualityDurration: number expected":e.totalPacketSendDelay!=null&&e.hasOwnProperty("totalPacketSendDelay")&&typeof e.totalPacketSendDelay!="number"?"totalPacketSendDelay: number expected":e.retransmittedBytesSent!=null&&e.hasOwnProperty("retransmittedBytesSent")&&typeof e.retransmittedBytesSent!="number"?"retransmittedBytesSent: number expected":e.scalabilityMode!=null&&e.hasOwnProperty("scalabilityMode")&&!$util.isString(e.scalabilityMode)?"scalabilityMode: string expected":e.qualityLimitationResolutionChanges!=null&&e.hasOwnProperty("qualityLimitationResolutionChanges")&&!$util.isInteger(e.qualityLimitationResolutionChanges)?"qualityLimitationResolutionChanges: integer expected":e.frameWidth!=null&&e.hasOwnProperty("frameWidth")&&!$util.isInteger(e.frameWidth)?"frameWidth: integer expected":e.frameHeight!=null&&e.hasOwnProperty("frameHeight")&&!$util.isInteger(e.frameHeight)?"frameHeight: integer expected":e.framesPerSecond!=null&&e.hasOwnProperty("framesPerSecond")&&!$util.isInteger(e.framesPerSecond)?"framesPerSecond: integer expected":e.videoCodec!=null&&e.hasOwnProperty("videoCodec")&&!$util.isString(e.videoCodec)?"videoCodec: string expected":e.videoSdpFmtpLine!=null&&e.hasOwnProperty("videoSdpFmtpLine")&&!$util.isString(e.videoSdpFmtpLine)?"videoSdpFmtpLine: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.VideoSenderStats)return e;let n=new $root.rov_actions_proto.VideoSenderStats;return e.encoderImplementation!=null&&(n.encoderImplementation=String(e.encoderImplementation)),e.powerEfficientEncoder!=null&&(n.powerEfficientEncoder=!!e.powerEfficientEncoder),e.qualityLimitationReason!=null&&(n.qualityLimitationReason=String(e.qualityLimitationReason)),e.cpuLimitedQualityDurration!=null&&(n.cpuLimitedQualityDurration=Number(e.cpuLimitedQualityDurration)),e.bandwidthLimitedQualityDurration!=null&&(n.bandwidthLimitedQualityDurration=Number(e.bandwidthLimitedQualityDurration)),e.otherLimitedQualityDurration!=null&&(n.otherLimitedQualityDurration=Number(e.otherLimitedQualityDurration)),e.noLimitedQualityDurration!=null&&(n.noLimitedQualityDurration=Number(e.noLimitedQualityDurration)),e.totalPacketSendDelay!=null&&(n.totalPacketSendDelay=Number(e.totalPacketSendDelay)),e.retransmittedBytesSent!=null&&(n.retransmittedBytesSent=Number(e.retransmittedBytesSent)),e.scalabilityMode!=null&&(n.scalabilityMode=String(e.scalabilityMode)),e.qualityLimitationResolutionChanges!=null&&(n.qualityLimitationResolutionChanges=e.qualityLimitationResolutionChanges>>>0),e.frameWidth!=null&&(n.frameWidth=e.frameWidth|0),e.frameHeight!=null&&(n.frameHeight=e.frameHeight|0),e.framesPerSecond!=null&&(n.framesPerSecond=e.framesPerSecond|0),e.videoCodec!=null&&(n.videoCodec=String(e.videoCodec)),e.videoSdpFmtpLine!=null&&(n.videoSdpFmtpLine=String(e.videoSdpFmtpLine)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.encoderImplementation="",s.powerEfficientEncoder=!1,s.qualityLimitationReason="",s.cpuLimitedQualityDurration=0,s.bandwidthLimitedQualityDurration=0,s.otherLimitedQualityDurration=0,s.noLimitedQualityDurration=0,s.totalPacketSendDelay=0,s.retransmittedBytesSent=0,s.scalabilityMode="",s.qualityLimitationResolutionChanges=0,s.frameWidth=0,s.frameHeight=0,s.framesPerSecond=0,s.videoSdpFmtpLine="",s.videoCodec=""),e.encoderImplementation!=null&&e.hasOwnProperty("encoderImplementation")&&(s.encoderImplementation=e.encoderImplementation),e.powerEfficientEncoder!=null&&e.hasOwnProperty("powerEfficientEncoder")&&(s.powerEfficientEncoder=e.powerEfficientEncoder),e.qualityLimitationReason!=null&&e.hasOwnProperty("qualityLimitationReason")&&(s.qualityLimitationReason=e.qualityLimitationReason),e.cpuLimitedQualityDurration!=null&&e.hasOwnProperty("cpuLimitedQualityDurration")&&(s.cpuLimitedQualityDurration=n.json&&!isFinite(e.cpuLimitedQualityDurration)?String(e.cpuLimitedQualityDurration):e.cpuLimitedQualityDurration),e.bandwidthLimitedQualityDurration!=null&&e.hasOwnProperty("bandwidthLimitedQualityDurration")&&(s.bandwidthLimitedQualityDurration=n.json&&!isFinite(e.bandwidthLimitedQualityDurration)?String(e.bandwidthLimitedQualityDurration):e.bandwidthLimitedQualityDurration),e.otherLimitedQualityDurration!=null&&e.hasOwnProperty("otherLimitedQualityDurration")&&(s.otherLimitedQualityDurration=n.json&&!isFinite(e.otherLimitedQualityDurration)?String(e.otherLimitedQualityDurration):e.otherLimitedQualityDurration),e.noLimitedQualityDurration!=null&&e.hasOwnProperty("noLimitedQualityDurration")&&(s.noLimitedQualityDurration=n.json&&!isFinite(e.noLimitedQualityDurration)?String(e.noLimitedQualityDurration):e.noLimitedQualityDurration),e.totalPacketSendDelay!=null&&e.hasOwnProperty("totalPacketSendDelay")&&(s.totalPacketSendDelay=n.json&&!isFinite(e.totalPacketSendDelay)?String(e.totalPacketSendDelay):e.totalPacketSendDelay),e.retransmittedBytesSent!=null&&e.hasOwnProperty("retransmittedBytesSent")&&(s.retransmittedBytesSent=n.json&&!isFinite(e.retransmittedBytesSent)?String(e.retransmittedBytesSent):e.retransmittedBytesSent),e.scalabilityMode!=null&&e.hasOwnProperty("scalabilityMode")&&(s.scalabilityMode=e.scalabilityMode),e.qualityLimitationResolutionChanges!=null&&e.hasOwnProperty("qualityLimitationResolutionChanges")&&(s.qualityLimitationResolutionChanges=e.qualityLimitationResolutionChanges),e.frameWidth!=null&&e.hasOwnProperty("frameWidth")&&(s.frameWidth=e.frameWidth),e.frameHeight!=null&&e.hasOwnProperty("frameHeight")&&(s.frameHeight=e.frameHeight),e.framesPerSecond!=null&&e.hasOwnProperty("framesPerSecond")&&(s.framesPerSecond=e.framesPerSecond),e.videoSdpFmtpLine!=null&&e.hasOwnProperty("videoSdpFmtpLine")&&(s.videoSdpFmtpLine=e.videoSdpFmtpLine),e.videoCodec!=null&&e.hasOwnProperty("videoCodec")&&(s.videoCodec=e.videoCodec),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.VideoSenderStats"},t}(),a.VideoRecieverStats=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.hung=!1,t.prototype.frameWidth=0,t.prototype.frameHeight=0,t.prototype.framesPerSecond=0,t.prototype.currentRoundTripTime=0,t.prototype.jitterBufferDelay=0,t.prototype.jitter=0,t.prototype.nackCount=0,t.prototype.pliCount=0,t.prototype.freezeCount=0,t.prototype.totalFreezeTime=0,t.prototype.estimatedPlayoutDelay=0,t.prototype.videoCodec="",t.prototype.videoSdpFmtpLine="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.hung!=null&&Object.hasOwnProperty.call(e,"hung")&&n.uint32(8).bool(e.hung),e.frameWidth!=null&&Object.hasOwnProperty.call(e,"frameWidth")&&n.uint32(16).int32(e.frameWidth),e.frameHeight!=null&&Object.hasOwnProperty.call(e,"frameHeight")&&n.uint32(24).int32(e.frameHeight),e.framesPerSecond!=null&&Object.hasOwnProperty.call(e,"framesPerSecond")&&n.uint32(32).int32(e.framesPerSecond),e.currentRoundTripTime!=null&&Object.hasOwnProperty.call(e,"currentRoundTripTime")&&n.uint32(45).float(e.currentRoundTripTime),e.jitterBufferDelay!=null&&Object.hasOwnProperty.call(e,"jitterBufferDelay")&&n.uint32(53).float(e.jitterBufferDelay),e.jitter!=null&&Object.hasOwnProperty.call(e,"jitter")&&n.uint32(61).float(e.jitter),e.nackCount!=null&&Object.hasOwnProperty.call(e,"nackCount")&&n.uint32(64).uint32(e.nackCount),e.pliCount!=null&&Object.hasOwnProperty.call(e,"pliCount")&&n.uint32(72).uint32(e.pliCount),e.freezeCount!=null&&Object.hasOwnProperty.call(e,"freezeCount")&&n.uint32(80).uint32(e.freezeCount),e.totalFreezeTime!=null&&Object.hasOwnProperty.call(e,"totalFreezeTime")&&n.uint32(88).uint32(e.totalFreezeTime),e.estimatedPlayoutDelay!=null&&Object.hasOwnProperty.call(e,"estimatedPlayoutDelay")&&n.uint32(101).float(e.estimatedPlayoutDelay),e.videoCodec!=null&&Object.hasOwnProperty.call(e,"videoCodec")&&n.uint32(106).string(e.videoCodec),e.videoSdpFmtpLine!=null&&Object.hasOwnProperty.call(e,"videoSdpFmtpLine")&&n.uint32(114).string(e.videoSdpFmtpLine),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.VideoRecieverStats;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.hung=e.bool();break}case 2:{c.frameWidth=e.int32();break}case 3:{c.frameHeight=e.int32();break}case 4:{c.framesPerSecond=e.int32();break}case 5:{c.currentRoundTripTime=e.float();break}case 6:{c.jitterBufferDelay=e.float();break}case 7:{c.jitter=e.float();break}case 8:{c.nackCount=e.uint32();break}case 9:{c.pliCount=e.uint32();break}case 10:{c.freezeCount=e.uint32();break}case 11:{c.totalFreezeTime=e.uint32();break}case 12:{c.estimatedPlayoutDelay=e.float();break}case 13:{c.videoCodec=e.string();break}case 14:{c.videoSdpFmtpLine=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.hung!=null&&e.hasOwnProperty("hung")&&typeof e.hung!="boolean"?"hung: boolean expected":e.frameWidth!=null&&e.hasOwnProperty("frameWidth")&&!$util.isInteger(e.frameWidth)?"frameWidth: integer expected":e.frameHeight!=null&&e.hasOwnProperty("frameHeight")&&!$util.isInteger(e.frameHeight)?"frameHeight: integer expected":e.framesPerSecond!=null&&e.hasOwnProperty("framesPerSecond")&&!$util.isInteger(e.framesPerSecond)?"framesPerSecond: integer expected":e.currentRoundTripTime!=null&&e.hasOwnProperty("currentRoundTripTime")&&typeof e.currentRoundTripTime!="number"?"currentRoundTripTime: number expected":e.jitterBufferDelay!=null&&e.hasOwnProperty("jitterBufferDelay")&&typeof e.jitterBufferDelay!="number"?"jitterBufferDelay: number expected":e.jitter!=null&&e.hasOwnProperty("jitter")&&typeof e.jitter!="number"?"jitter: number expected":e.nackCount!=null&&e.hasOwnProperty("nackCount")&&!$util.isInteger(e.nackCount)?"nackCount: integer expected":e.pliCount!=null&&e.hasOwnProperty("pliCount")&&!$util.isInteger(e.pliCount)?"pliCount: integer expected":e.freezeCount!=null&&e.hasOwnProperty("freezeCount")&&!$util.isInteger(e.freezeCount)?"freezeCount: integer expected":e.totalFreezeTime!=null&&e.hasOwnProperty("totalFreezeTime")&&!$util.isInteger(e.totalFreezeTime)?"totalFreezeTime: integer expected":e.estimatedPlayoutDelay!=null&&e.hasOwnProperty("estimatedPlayoutDelay")&&typeof e.estimatedPlayoutDelay!="number"?"estimatedPlayoutDelay: number expected":e.videoCodec!=null&&e.hasOwnProperty("videoCodec")&&!$util.isString(e.videoCodec)?"videoCodec: string expected":e.videoSdpFmtpLine!=null&&e.hasOwnProperty("videoSdpFmtpLine")&&!$util.isString(e.videoSdpFmtpLine)?"videoSdpFmtpLine: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.VideoRecieverStats)return e;let n=new $root.rov_actions_proto.VideoRecieverStats;return e.hung!=null&&(n.hung=!!e.hung),e.frameWidth!=null&&(n.frameWidth=e.frameWidth|0),e.frameHeight!=null&&(n.frameHeight=e.frameHeight|0),e.framesPerSecond!=null&&(n.framesPerSecond=e.framesPerSecond|0),e.currentRoundTripTime!=null&&(n.currentRoundTripTime=Number(e.currentRoundTripTime)),e.jitterBufferDelay!=null&&(n.jitterBufferDelay=Number(e.jitterBufferDelay)),e.jitter!=null&&(n.jitter=Number(e.jitter)),e.nackCount!=null&&(n.nackCount=e.nackCount>>>0),e.pliCount!=null&&(n.pliCount=e.pliCount>>>0),e.freezeCount!=null&&(n.freezeCount=e.freezeCount>>>0),e.totalFreezeTime!=null&&(n.totalFreezeTime=e.totalFreezeTime>>>0),e.estimatedPlayoutDelay!=null&&(n.estimatedPlayoutDelay=Number(e.estimatedPlayoutDelay)),e.videoCodec!=null&&(n.videoCodec=String(e.videoCodec)),e.videoSdpFmtpLine!=null&&(n.videoSdpFmtpLine=String(e.videoSdpFmtpLine)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.hung=!1,s.frameWidth=0,s.frameHeight=0,s.framesPerSecond=0,s.currentRoundTripTime=0,s.jitterBufferDelay=0,s.jitter=0,s.nackCount=0,s.pliCount=0,s.freezeCount=0,s.totalFreezeTime=0,s.estimatedPlayoutDelay=0,s.videoCodec="",s.videoSdpFmtpLine=""),e.hung!=null&&e.hasOwnProperty("hung")&&(s.hung=e.hung),e.frameWidth!=null&&e.hasOwnProperty("frameWidth")&&(s.frameWidth=e.frameWidth),e.frameHeight!=null&&e.hasOwnProperty("frameHeight")&&(s.frameHeight=e.frameHeight),e.framesPerSecond!=null&&e.hasOwnProperty("framesPerSecond")&&(s.framesPerSecond=e.framesPerSecond),e.currentRoundTripTime!=null&&e.hasOwnProperty("currentRoundTripTime")&&(s.currentRoundTripTime=n.json&&!isFinite(e.currentRoundTripTime)?String(e.currentRoundTripTime):e.currentRoundTripTime),e.jitterBufferDelay!=null&&e.hasOwnProperty("jitterBufferDelay")&&(s.jitterBufferDelay=n.json&&!isFinite(e.jitterBufferDelay)?String(e.jitterBufferDelay):e.jitterBufferDelay),e.jitter!=null&&e.hasOwnProperty("jitter")&&(s.jitter=n.json&&!isFinite(e.jitter)?String(e.jitter):e.jitter),e.nackCount!=null&&e.hasOwnProperty("nackCount")&&(s.nackCount=e.nackCount),e.pliCount!=null&&e.hasOwnProperty("pliCount")&&(s.pliCount=e.pliCount),e.freezeCount!=null&&e.hasOwnProperty("freezeCount")&&(s.freezeCount=e.freezeCount),e.totalFreezeTime!=null&&e.hasOwnProperty("totalFreezeTime")&&(s.totalFreezeTime=e.totalFreezeTime),e.estimatedPlayoutDelay!=null&&e.hasOwnProperty("estimatedPlayoutDelay")&&(s.estimatedPlayoutDelay=n.json&&!isFinite(e.estimatedPlayoutDelay)?String(e.estimatedPlayoutDelay):e.estimatedPlayoutDelay),e.videoCodec!=null&&e.hasOwnProperty("videoCodec")&&(s.videoCodec=e.videoCodec),e.videoSdpFmtpLine!=null&&e.hasOwnProperty("videoSdpFmtpLine")&&(s.videoSdpFmtpLine=e.videoSdpFmtpLine),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.VideoRecieverStats"},t}(),a.VideoBaseStats=function(){function t(o){if(this.senderLayerStats=[],o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.bitrateReceive=0,t.prototype.bitrateSend=0,t.prototype.availableIncomingBitrate=0,t.prototype.availableOutgoingBitrate=0,t.prototype.senderLayerStats=$util.emptyArray,t.prototype.recieverStats=null,t.prototype.rtcStatsJson="",t.create=function(e){return new t(e)},t.encode=function(e,n){if(n||(n=$Writer.create()),e.bitrateReceive!=null&&Object.hasOwnProperty.call(e,"bitrateReceive")&&n.uint32(56).uint32(e.bitrateReceive),e.bitrateSend!=null&&Object.hasOwnProperty.call(e,"bitrateSend")&&n.uint32(64).uint32(e.bitrateSend),e.availableIncomingBitrate!=null&&Object.hasOwnProperty.call(e,"availableIncomingBitrate")&&n.uint32(72).uint32(e.availableIncomingBitrate),e.availableOutgoingBitrate!=null&&Object.hasOwnProperty.call(e,"availableOutgoingBitrate")&&n.uint32(80).uint32(e.availableOutgoingBitrate),e.senderLayerStats!=null&&e.senderLayerStats.length)for(let s=0;s<e.senderLayerStats.length;++s)$root.rov_actions_proto.VideoSenderStats.encode(e.senderLayerStats[s],n.uint32(90).fork()).ldelim();return e.recieverStats!=null&&Object.hasOwnProperty.call(e,"recieverStats")&&$root.rov_actions_proto.VideoRecieverStats.encode(e.recieverStats,n.uint32(98).fork()).ldelim(),e.rtcStatsJson!=null&&Object.hasOwnProperty.call(e,"rtcStatsJson")&&n.uint32(106).string(e.rtcStatsJson),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.VideoBaseStats;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 7:{c.bitrateReceive=e.uint32();break}case 8:{c.bitrateSend=e.uint32();break}case 9:{c.availableIncomingBitrate=e.uint32();break}case 10:{c.availableOutgoingBitrate=e.uint32();break}case 11:{c.senderLayerStats&&c.senderLayerStats.length||(c.senderLayerStats=[]),c.senderLayerStats.push($root.rov_actions_proto.VideoSenderStats.decode(e,e.uint32()));break}case 12:{c.recieverStats=$root.rov_actions_proto.VideoRecieverStats.decode(e,e.uint32());break}case 13:{c.rtcStatsJson=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.bitrateReceive!=null&&e.hasOwnProperty("bitrateReceive")&&!$util.isInteger(e.bitrateReceive))return"bitrateReceive: integer expected";if(e.bitrateSend!=null&&e.hasOwnProperty("bitrateSend")&&!$util.isInteger(e.bitrateSend))return"bitrateSend: integer expected";if(e.availableIncomingBitrate!=null&&e.hasOwnProperty("availableIncomingBitrate")&&!$util.isInteger(e.availableIncomingBitrate))return"availableIncomingBitrate: integer expected";if(e.availableOutgoingBitrate!=null&&e.hasOwnProperty("availableOutgoingBitrate")&&!$util.isInteger(e.availableOutgoingBitrate))return"availableOutgoingBitrate: integer expected";if(e.senderLayerStats!=null&&e.hasOwnProperty("senderLayerStats")){if(!Array.isArray(e.senderLayerStats))return"senderLayerStats: array expected";for(let n=0;n<e.senderLayerStats.length;++n){let s=$root.rov_actions_proto.VideoSenderStats.verify(e.senderLayerStats[n]);if(s)return"senderLayerStats."+s}}if(e.recieverStats!=null&&e.hasOwnProperty("recieverStats")){let n=$root.rov_actions_proto.VideoRecieverStats.verify(e.recieverStats);if(n)return"recieverStats."+n}return e.rtcStatsJson!=null&&e.hasOwnProperty("rtcStatsJson")&&!$util.isString(e.rtcStatsJson)?"rtcStatsJson: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.VideoBaseStats)return e;let n=new $root.rov_actions_proto.VideoBaseStats;if(e.bitrateReceive!=null&&(n.bitrateReceive=e.bitrateReceive>>>0),e.bitrateSend!=null&&(n.bitrateSend=e.bitrateSend>>>0),e.availableIncomingBitrate!=null&&(n.availableIncomingBitrate=e.availableIncomingBitrate>>>0),e.availableOutgoingBitrate!=null&&(n.availableOutgoingBitrate=e.availableOutgoingBitrate>>>0),e.senderLayerStats){if(!Array.isArray(e.senderLayerStats))throw TypeError(".rov_actions_proto.VideoBaseStats.senderLayerStats: array expected");n.senderLayerStats=[];for(let s=0;s<e.senderLayerStats.length;++s){if(typeof e.senderLayerStats[s]!="object")throw TypeError(".rov_actions_proto.VideoBaseStats.senderLayerStats: object expected");n.senderLayerStats[s]=$root.rov_actions_proto.VideoSenderStats.fromObject(e.senderLayerStats[s])}}if(e.recieverStats!=null){if(typeof e.recieverStats!="object")throw TypeError(".rov_actions_proto.VideoBaseStats.recieverStats: object expected");n.recieverStats=$root.rov_actions_proto.VideoRecieverStats.fromObject(e.recieverStats)}return e.rtcStatsJson!=null&&(n.rtcStatsJson=String(e.rtcStatsJson)),n},t.toObject=function(e,n){n||(n={});let s={};if((n.arrays||n.defaults)&&(s.senderLayerStats=[]),n.defaults&&(s.bitrateReceive=0,s.bitrateSend=0,s.availableIncomingBitrate=0,s.availableOutgoingBitrate=0,s.recieverStats=null,s.rtcStatsJson=""),e.bitrateReceive!=null&&e.hasOwnProperty("bitrateReceive")&&(s.bitrateReceive=e.bitrateReceive),e.bitrateSend!=null&&e.hasOwnProperty("bitrateSend")&&(s.bitrateSend=e.bitrateSend),e.availableIncomingBitrate!=null&&e.hasOwnProperty("availableIncomingBitrate")&&(s.availableIncomingBitrate=e.availableIncomingBitrate),e.availableOutgoingBitrate!=null&&e.hasOwnProperty("availableOutgoingBitrate")&&(s.availableOutgoingBitrate=e.availableOutgoingBitrate),e.senderLayerStats&&e.senderLayerStats.length){s.senderLayerStats=[];for(let c=0;c<e.senderLayerStats.length;++c)s.senderLayerStats[c]=$root.rov_actions_proto.VideoSenderStats.toObject(e.senderLayerStats[c],n)}return e.recieverStats!=null&&e.hasOwnProperty("recieverStats")&&(s.recieverStats=$root.rov_actions_proto.VideoRecieverStats.toObject(e.recieverStats,n)),e.rtcStatsJson!=null&&e.hasOwnProperty("rtcStatsJson")&&(s.rtcStatsJson=e.rtcStatsJson),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.VideoBaseStats"},t}(),a.VideoStreamOptions=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Height=0,t.prototype.Width=0,t.prototype.Fps=0,t.prototype.MaxBitrate=0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Height!=null&&Object.hasOwnProperty.call(e,"Height")&&n.uint32(8).uint32(e.Height),e.Width!=null&&Object.hasOwnProperty.call(e,"Width")&&n.uint32(16).uint32(e.Width),e.Fps!=null&&Object.hasOwnProperty.call(e,"Fps")&&n.uint32(24).uint32(e.Fps),e.MaxBitrate!=null&&Object.hasOwnProperty.call(e,"MaxBitrate")&&n.uint32(32).uint32(e.MaxBitrate),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.VideoStreamOptions;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.Height=e.uint32();break}case 2:{c.Width=e.uint32();break}case 3:{c.Fps=e.uint32();break}case 4:{c.MaxBitrate=e.uint32();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Height!=null&&e.hasOwnProperty("Height")&&!$util.isInteger(e.Height)?"Height: integer expected":e.Width!=null&&e.hasOwnProperty("Width")&&!$util.isInteger(e.Width)?"Width: integer expected":e.Fps!=null&&e.hasOwnProperty("Fps")&&!$util.isInteger(e.Fps)?"Fps: integer expected":e.MaxBitrate!=null&&e.hasOwnProperty("MaxBitrate")&&!$util.isInteger(e.MaxBitrate)?"MaxBitrate: integer expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.VideoStreamOptions)return e;let n=new $root.rov_actions_proto.VideoStreamOptions;return e.Height!=null&&(n.Height=e.Height>>>0),e.Width!=null&&(n.Width=e.Width>>>0),e.Fps!=null&&(n.Fps=e.Fps>>>0),e.MaxBitrate!=null&&(n.MaxBitrate=e.MaxBitrate>>>0),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.Height=0,s.Width=0,s.Fps=0,s.MaxBitrate=0),e.Height!=null&&e.hasOwnProperty("Height")&&(s.Height=e.Height),e.Width!=null&&e.hasOwnProperty("Width")&&(s.Width=e.Width),e.Fps!=null&&e.hasOwnProperty("Fps")&&(s.Fps=e.Fps),e.MaxBitrate!=null&&e.hasOwnProperty("MaxBitrate")&&(s.MaxBitrate=e.MaxBitrate),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.VideoStreamOptions"},t}(),a.SetLivekitVideoOptionsAction=function(){function t(o){if(this.SimulcastLayers=[],o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Enabled=!1,t.prototype.Codec="",t.prototype.AllowBackupCodec=!1,t.prototype.BaseStream=null,t.prototype.SimulcastLayers=$util.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,n){if(n||(n=$Writer.create()),e.Enabled!=null&&Object.hasOwnProperty.call(e,"Enabled")&&n.uint32(8).bool(e.Enabled),e.Codec!=null&&Object.hasOwnProperty.call(e,"Codec")&&n.uint32(18).string(e.Codec),e.AllowBackupCodec!=null&&Object.hasOwnProperty.call(e,"AllowBackupCodec")&&n.uint32(24).bool(e.AllowBackupCodec),e.BaseStream!=null&&Object.hasOwnProperty.call(e,"BaseStream")&&$root.rov_actions_proto.VideoStreamOptions.encode(e.BaseStream,n.uint32(34).fork()).ldelim(),e.SimulcastLayers!=null&&e.SimulcastLayers.length)for(let s=0;s<e.SimulcastLayers.length;++s)$root.rov_actions_proto.VideoStreamOptions.encode(e.SimulcastLayers[s],n.uint32(42).fork()).ldelim();return n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.SetLivekitVideoOptionsAction;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.Enabled=e.bool();break}case 2:{c.Codec=e.string();break}case 3:{c.AllowBackupCodec=e.bool();break}case 4:{c.BaseStream=$root.rov_actions_proto.VideoStreamOptions.decode(e,e.uint32());break}case 5:{c.SimulcastLayers&&c.SimulcastLayers.length||(c.SimulcastLayers=[]),c.SimulcastLayers.push($root.rov_actions_proto.VideoStreamOptions.decode(e,e.uint32()));break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.Enabled!=null&&e.hasOwnProperty("Enabled")&&typeof e.Enabled!="boolean")return"Enabled: boolean expected";if(e.Codec!=null&&e.hasOwnProperty("Codec")&&!$util.isString(e.Codec))return"Codec: string expected";if(e.AllowBackupCodec!=null&&e.hasOwnProperty("AllowBackupCodec")&&typeof e.AllowBackupCodec!="boolean")return"AllowBackupCodec: boolean expected";if(e.BaseStream!=null&&e.hasOwnProperty("BaseStream")){let n=$root.rov_actions_proto.VideoStreamOptions.verify(e.BaseStream);if(n)return"BaseStream."+n}if(e.SimulcastLayers!=null&&e.hasOwnProperty("SimulcastLayers")){if(!Array.isArray(e.SimulcastLayers))return"SimulcastLayers: array expected";for(let n=0;n<e.SimulcastLayers.length;++n){let s=$root.rov_actions_proto.VideoStreamOptions.verify(e.SimulcastLayers[n]);if(s)return"SimulcastLayers."+s}}return null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.SetLivekitVideoOptionsAction)return e;let n=new $root.rov_actions_proto.SetLivekitVideoOptionsAction;if(e.Enabled!=null&&(n.Enabled=!!e.Enabled),e.Codec!=null&&(n.Codec=String(e.Codec)),e.AllowBackupCodec!=null&&(n.AllowBackupCodec=!!e.AllowBackupCodec),e.BaseStream!=null){if(typeof e.BaseStream!="object")throw TypeError(".rov_actions_proto.SetLivekitVideoOptionsAction.BaseStream: object expected");n.BaseStream=$root.rov_actions_proto.VideoStreamOptions.fromObject(e.BaseStream)}if(e.SimulcastLayers){if(!Array.isArray(e.SimulcastLayers))throw TypeError(".rov_actions_proto.SetLivekitVideoOptionsAction.SimulcastLayers: array expected");n.SimulcastLayers=[];for(let s=0;s<e.SimulcastLayers.length;++s){if(typeof e.SimulcastLayers[s]!="object")throw TypeError(".rov_actions_proto.SetLivekitVideoOptionsAction.SimulcastLayers: object expected");n.SimulcastLayers[s]=$root.rov_actions_proto.VideoStreamOptions.fromObject(e.SimulcastLayers[s])}}return n},t.toObject=function(e,n){n||(n={});let s={};if((n.arrays||n.defaults)&&(s.SimulcastLayers=[]),n.defaults&&(s.Enabled=!1,s.Codec="",s.AllowBackupCodec=!1,s.BaseStream=null),e.Enabled!=null&&e.hasOwnProperty("Enabled")&&(s.Enabled=e.Enabled),e.Codec!=null&&e.hasOwnProperty("Codec")&&(s.Codec=e.Codec),e.AllowBackupCodec!=null&&e.hasOwnProperty("AllowBackupCodec")&&(s.AllowBackupCodec=e.AllowBackupCodec),e.BaseStream!=null&&e.hasOwnProperty("BaseStream")&&(s.BaseStream=$root.rov_actions_proto.VideoStreamOptions.toObject(e.BaseStream,n)),e.SimulcastLayers&&e.SimulcastLayers.length){s.SimulcastLayers=[];for(let c=0;c<e.SimulcastLayers.length;++c)s.SimulcastLayers[c]=$root.rov_actions_proto.VideoStreamOptions.toObject(e.SimulcastLayers[c],n)}return s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SetLivekitVideoOptionsAction"},t}(),a.SetSimplePeerVideoOptionsAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Enabled=!1,t.prototype.Bitrate=0,t.prototype.Codec="",t.prototype.BaseStream=null,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Enabled!=null&&Object.hasOwnProperty.call(e,"Enabled")&&n.uint32(8).bool(e.Enabled),e.Bitrate!=null&&Object.hasOwnProperty.call(e,"Bitrate")&&n.uint32(16).uint32(e.Bitrate),e.Codec!=null&&Object.hasOwnProperty.call(e,"Codec")&&n.uint32(26).string(e.Codec),e.BaseStream!=null&&Object.hasOwnProperty.call(e,"BaseStream")&&$root.rov_actions_proto.VideoStreamOptions.encode(e.BaseStream,n.uint32(34).fork()).ldelim(),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.SetSimplePeerVideoOptionsAction;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.Enabled=e.bool();break}case 2:{c.Bitrate=e.uint32();break}case 3:{c.Codec=e.string();break}case 4:{c.BaseStream=$root.rov_actions_proto.VideoStreamOptions.decode(e,e.uint32());break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.Enabled!=null&&e.hasOwnProperty("Enabled")&&typeof e.Enabled!="boolean")return"Enabled: boolean expected";if(e.Bitrate!=null&&e.hasOwnProperty("Bitrate")&&!$util.isInteger(e.Bitrate))return"Bitrate: integer expected";if(e.Codec!=null&&e.hasOwnProperty("Codec")&&!$util.isString(e.Codec))return"Codec: string expected";if(e.BaseStream!=null&&e.hasOwnProperty("BaseStream")){let n=$root.rov_actions_proto.VideoStreamOptions.verify(e.BaseStream);if(n)return"BaseStream."+n}return null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.SetSimplePeerVideoOptionsAction)return e;let n=new $root.rov_actions_proto.SetSimplePeerVideoOptionsAction;if(e.Enabled!=null&&(n.Enabled=!!e.Enabled),e.Bitrate!=null&&(n.Bitrate=e.Bitrate>>>0),e.Codec!=null&&(n.Codec=String(e.Codec)),e.BaseStream!=null){if(typeof e.BaseStream!="object")throw TypeError(".rov_actions_proto.SetSimplePeerVideoOptionsAction.BaseStream: object expected");n.BaseStream=$root.rov_actions_proto.VideoStreamOptions.fromObject(e.BaseStream)}return n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.Enabled=!1,s.Bitrate=0,s.Codec="",s.BaseStream=null),e.Enabled!=null&&e.hasOwnProperty("Enabled")&&(s.Enabled=e.Enabled),e.Bitrate!=null&&e.hasOwnProperty("Bitrate")&&(s.Bitrate=e.Bitrate),e.Codec!=null&&e.hasOwnProperty("Codec")&&(s.Codec=e.Codec),e.BaseStream!=null&&e.hasOwnProperty("BaseStream")&&(s.BaseStream=$root.rov_actions_proto.VideoStreamOptions.toObject(e.BaseStream,n)),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SetSimplePeerVideoOptionsAction"},t}(),a.PingAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Time=$util.Long?$util.Long.fromBits(0,0,!1):0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Time!=null&&Object.hasOwnProperty.call(e,"Time")&&n.uint32(8).int64(e.Time),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.PingAction;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.Time=e.int64();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Time!=null&&e.hasOwnProperty("Time")&&!$util.isInteger(e.Time)&&!(e.Time&&$util.isInteger(e.Time.low)&&$util.isInteger(e.Time.high))?"Time: integer|Long expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.PingAction)return e;let n=new $root.rov_actions_proto.PingAction;return e.Time!=null&&($util.Long?(n.Time=$util.Long.fromValue(e.Time)).unsigned=!1:typeof e.Time=="string"?n.Time=parseInt(e.Time,10):typeof e.Time=="number"?n.Time=e.Time:typeof e.Time=="object"&&(n.Time=new $util.LongBits(e.Time.low>>>0,e.Time.high>>>0).toNumber())),n},t.toObject=function(e,n){n||(n={});let s={};if(n.defaults)if($util.Long){let c=new $util.Long(0,0,!1);s.Time=n.longs===String?c.toString():n.longs===Number?c.toNumber():c}else s.Time=n.longs===String?"0":0;return e.Time!=null&&e.hasOwnProperty("Time")&&(typeof e.Time=="number"?s.Time=n.longs===String?String(e.Time):e.Time:s.Time=n.longs===String?$util.Long.prototype.toString.call(e.Time):n.longs===Number?new $util.LongBits(e.Time.low>>>0,e.Time.high>>>0).toNumber():e.Time),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.PingAction"},t}(),a.PasswordAttemptAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Password="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Password!=null&&Object.hasOwnProperty.call(e,"Password")&&n.uint32(10).string(e.Password),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.PasswordAttemptAction;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.Password=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Password!=null&&e.hasOwnProperty("Password")&&!$util.isString(e.Password)?"Password: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.PasswordAttemptAction)return e;let n=new $root.rov_actions_proto.PasswordAttemptAction;return e.Password!=null&&(n.Password=String(e.Password)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.Password=""),e.Password!=null&&e.hasOwnProperty("Password")&&(s.Password=e.Password),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.PasswordAttemptAction"},t}(),a.AuthTokenAttemptAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Token="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Token!=null&&Object.hasOwnProperty.call(e,"Token")&&n.uint32(10).string(e.Token),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.AuthTokenAttemptAction;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.Token=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Token!=null&&e.hasOwnProperty("Token")&&!$util.isString(e.Token)?"Token: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.AuthTokenAttemptAction)return e;let n=new $root.rov_actions_proto.AuthTokenAttemptAction;return e.Token!=null&&(n.Token=String(e.Token)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.Token=""),e.Token!=null&&e.hasOwnProperty("Token")&&(s.Token=e.Token),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.AuthTokenAttemptAction"},t}(),a.TakeControlAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.TakeControlAction;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.TakeControlAction?e:new $root.rov_actions_proto.TakeControlAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.TakeControlAction"},t}(),a.MoveAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.VelocityX=0,t.prototype.VelocityY=0,t.prototype.VelocityZ=0,t.prototype.AngularVelocityYaw=0,t.prototype.ButtonBitmask=0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.VelocityX!=null&&Object.hasOwnProperty.call(e,"VelocityX")&&n.uint32(13).float(e.VelocityX),e.VelocityY!=null&&Object.hasOwnProperty.call(e,"VelocityY")&&n.uint32(21).float(e.VelocityY),e.VelocityZ!=null&&Object.hasOwnProperty.call(e,"VelocityZ")&&n.uint32(29).float(e.VelocityZ),e.AngularVelocityYaw!=null&&Object.hasOwnProperty.call(e,"AngularVelocityYaw")&&n.uint32(37).float(e.AngularVelocityYaw),e.ButtonBitmask!=null&&Object.hasOwnProperty.call(e,"ButtonBitmask")&&n.uint32(40).int32(e.ButtonBitmask),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.MoveAction;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.VelocityX=e.float();break}case 2:{c.VelocityY=e.float();break}case 3:{c.VelocityZ=e.float();break}case 4:{c.AngularVelocityYaw=e.float();break}case 5:{c.ButtonBitmask=e.int32();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.VelocityX!=null&&e.hasOwnProperty("VelocityX")&&typeof e.VelocityX!="number"?"VelocityX: number expected":e.VelocityY!=null&&e.hasOwnProperty("VelocityY")&&typeof e.VelocityY!="number"?"VelocityY: number expected":e.VelocityZ!=null&&e.hasOwnProperty("VelocityZ")&&typeof e.VelocityZ!="number"?"VelocityZ: number expected":e.AngularVelocityYaw!=null&&e.hasOwnProperty("AngularVelocityYaw")&&typeof e.AngularVelocityYaw!="number"?"AngularVelocityYaw: number expected":e.ButtonBitmask!=null&&e.hasOwnProperty("ButtonBitmask")&&!$util.isInteger(e.ButtonBitmask)?"ButtonBitmask: integer expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.MoveAction)return e;let n=new $root.rov_actions_proto.MoveAction;return e.VelocityX!=null&&(n.VelocityX=Number(e.VelocityX)),e.VelocityY!=null&&(n.VelocityY=Number(e.VelocityY)),e.VelocityZ!=null&&(n.VelocityZ=Number(e.VelocityZ)),e.AngularVelocityYaw!=null&&(n.AngularVelocityYaw=Number(e.AngularVelocityYaw)),e.ButtonBitmask!=null&&(n.ButtonBitmask=e.ButtonBitmask|0),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.VelocityX=0,s.VelocityY=0,s.VelocityZ=0,s.AngularVelocityYaw=0,s.ButtonBitmask=0),e.VelocityX!=null&&e.hasOwnProperty("VelocityX")&&(s.VelocityX=n.json&&!isFinite(e.VelocityX)?String(e.VelocityX):e.VelocityX),e.VelocityY!=null&&e.hasOwnProperty("VelocityY")&&(s.VelocityY=n.json&&!isFinite(e.VelocityY)?String(e.VelocityY):e.VelocityY),e.VelocityZ!=null&&e.hasOwnProperty("VelocityZ")&&(s.VelocityZ=n.json&&!isFinite(e.VelocityZ)?String(e.VelocityZ):e.VelocityZ),e.AngularVelocityYaw!=null&&e.hasOwnProperty("AngularVelocityYaw")&&(s.AngularVelocityYaw=n.json&&!isFinite(e.AngularVelocityYaw)?String(e.AngularVelocityYaw):e.AngularVelocityYaw),e.ButtonBitmask!=null&&e.hasOwnProperty("ButtonBitmask")&&(s.ButtonBitmask=e.ButtonBitmask),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.MoveAction"},t}(),a.TakePhotoAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.TakePhotoAction;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.TakePhotoAction?e:new $root.rov_actions_proto.TakePhotoAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.TakePhotoAction"},t}(),a.StartVideoRecAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.StartVideoRecAction;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.StartVideoRecAction?e:new $root.rov_actions_proto.StartVideoRecAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.StartVideoRecAction"},t}(),a.StopVideoRecAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.StopVideoRecAction;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.StopVideoRecAction?e:new $root.rov_actions_proto.StopVideoRecAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.StopVideoRecAction"},t}(),a.ToggleLightsAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.ToggleLightsAction;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.ToggleLightsAction?e:new $root.rov_actions_proto.ToggleLightsAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.ToggleLightsAction"},t}(),a.ShutdownRovAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.ShutdownRovAction;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.ShutdownRovAction?e:new $root.rov_actions_proto.ShutdownRovAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.ShutdownRovAction"},t}(),a.RebootRovAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.RebootRovAction;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.RebootRovAction?e:new $root.rov_actions_proto.RebootRovAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.RebootRovAction"},t}(),a.EnableWifiAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.EnableWifiAction;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.EnableWifiAction?e:new $root.rov_actions_proto.EnableWifiAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.EnableWifiAction"},t}(),a.DisableWifiAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.DisableWifiAction;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.DisableWifiAction?e:new $root.rov_actions_proto.DisableWifiAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.DisableWifiAction"},t}(),a.RovStatusReportAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.RovStatusReportAction;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.RovStatusReportAction?e:new $root.rov_actions_proto.RovStatusReportAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.RovStatusReportAction"},t}(),a.RestartRovServicesAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.RestartRovServicesAction;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.RestartRovServicesAction?e:new $root.rov_actions_proto.RestartRovServicesAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.RestartRovServicesAction"},t}(),a.SendRovLogsAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.SendRovLogsAction;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.SendRovLogsAction?e:new $root.rov_actions_proto.SendRovLogsAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SendRovLogsAction"},t}(),a.RefreshAllSensorsAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.RefreshAllSensorsAction;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.RefreshAllSensorsAction?e:new $root.rov_actions_proto.RefreshAllSensorsAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.RefreshAllSensorsAction"},t}(),a.MoveClawAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Value=0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Value!=null&&Object.hasOwnProperty.call(e,"Value")&&n.uint32(13).float(e.Value),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.MoveClawAction;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.Value=e.float();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Value!=null&&e.hasOwnProperty("Value")&&typeof e.Value!="number"?"Value: number expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.MoveClawAction)return e;let n=new $root.rov_actions_proto.MoveClawAction;return e.Value!=null&&(n.Value=Number(e.Value)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.Value=0),e.Value!=null&&e.hasOwnProperty("Value")&&(s.Value=n.json&&!isFinite(e.Value)?String(e.Value):e.Value),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.MoveClawAction"},t}(),a.SimplePeerSignalAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Message="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Message!=null&&Object.hasOwnProperty.call(e,"Message")&&n.uint32(10).string(e.Message),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.SimplePeerSignalAction;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.Message=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Message!=null&&e.hasOwnProperty("Message")&&!$util.isString(e.Message)?"Message: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.SimplePeerSignalAction)return e;let n=new $root.rov_actions_proto.SimplePeerSignalAction;return e.Message!=null&&(n.Message=String(e.Message)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.Message=""),e.Message!=null&&e.hasOwnProperty("Message")&&(s.Message=e.Message),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SimplePeerSignalAction"},t}(),a.DisarmAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.DisarmAction;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.DisarmAction?e:new $root.rov_actions_proto.DisarmAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.DisarmAction"},t}(),a.SetAutopilotModeAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.mode=0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.mode!=null&&Object.hasOwnProperty.call(e,"mode")&&n.uint32(8).int32(e.mode),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.SetAutopilotModeAction;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.mode=e.int32();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.mode!=null&&e.hasOwnProperty("mode")&&!$util.isInteger(e.mode)?"mode: integer expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.SetAutopilotModeAction)return e;let n=new $root.rov_actions_proto.SetAutopilotModeAction;return e.mode!=null&&(n.mode=e.mode|0),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.mode=0),e.mode!=null&&e.hasOwnProperty("mode")&&(s.mode=e.mode),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SetAutopilotModeAction"},t}(),a.SetLivestreamingEnabledAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Enabled=!1,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Enabled!=null&&Object.hasOwnProperty.call(e,"Enabled")&&n.uint32(8).bool(e.Enabled),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.SetLivestreamingEnabledAction;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.Enabled=e.bool();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Enabled!=null&&e.hasOwnProperty("Enabled")&&typeof e.Enabled!="boolean"?"Enabled: boolean expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.SetLivestreamingEnabledAction)return e;let n=new $root.rov_actions_proto.SetLivestreamingEnabledAction;return e.Enabled!=null&&(n.Enabled=!!e.Enabled),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.Enabled=!1),e.Enabled!=null&&e.hasOwnProperty("Enabled")&&(s.Enabled=e.Enabled),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SetLivestreamingEnabledAction"},t}(),a.ActionBackendMetadata=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.FromUserId="",t.prototype.InternalWebpageEvt=0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.FromUserId!=null&&Object.hasOwnProperty.call(e,"FromUserId")&&n.uint32(10).string(e.FromUserId),e.InternalWebpageEvt!=null&&Object.hasOwnProperty.call(e,"InternalWebpageEvt")&&n.uint32(16).int32(e.InternalWebpageEvt),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.ActionBackendMetadata;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.FromUserId=e.string();break}case 2:{c.InternalWebpageEvt=e.int32();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.FromUserId!=null&&e.hasOwnProperty("FromUserId")&&!$util.isString(e.FromUserId))return"FromUserId: string expected";if(e.InternalWebpageEvt!=null&&e.hasOwnProperty("InternalWebpageEvt"))switch(e.InternalWebpageEvt){default:return"InternalWebpageEvt: enum value expected";case 0:case 1:case 2:case 3:case 4:break}return null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.ActionBackendMetadata)return e;let n=new $root.rov_actions_proto.ActionBackendMetadata;switch(e.FromUserId!=null&&(n.FromUserId=String(e.FromUserId)),e.InternalWebpageEvt){default:if(typeof e.InternalWebpageEvt=="number"){n.InternalWebpageEvt=e.InternalWebpageEvt;break}break;case"Nothing":case 0:n.InternalWebpageEvt=0;break;case"RovConnected":case 1:n.InternalWebpageEvt=1;break;case"RovDisconnected":case 2:n.InternalWebpageEvt=2;break;case"UserConnected":case 3:n.InternalWebpageEvt=3;break;case"UserDisconnected":case 4:n.InternalWebpageEvt=4;break}return n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.FromUserId="",s.InternalWebpageEvt=n.enums===String?"Nothing":0),e.FromUserId!=null&&e.hasOwnProperty("FromUserId")&&(s.FromUserId=e.FromUserId),e.InternalWebpageEvt!=null&&e.hasOwnProperty("InternalWebpageEvt")&&(s.InternalWebpageEvt=n.enums===String?$root.rov_actions_proto.InternalWebpageEvent[e.InternalWebpageEvt]===void 0?e.InternalWebpageEvt:$root.rov_actions_proto.InternalWebpageEvent[e.InternalWebpageEvt]:e.InternalWebpageEvt),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.ActionBackendMetadata"},t}(),a.RovAction=function(){function t(e){if(e)for(let n=Object.keys(e),s=0;s<n.length;++s)e[n[s]]!=null&&(this[n[s]]=e[n[s]])}t.prototype.BackendMetadata=null,t.prototype.ExchangeId=0,t.prototype.Ping=null,t.prototype.PasswordAttempt=null,t.prototype.AuthTokenAttempt=null,t.prototype.TakeControl=null,t.prototype.Move=null,t.prototype.TakePhoto=null,t.prototype.StartVideoRec=null,t.prototype.StopVideoRec=null,t.prototype.ToggleLights=null,t.prototype.ShutdownRov=null,t.prototype.RebootRov=null,t.prototype.EnableWifi=null,t.prototype.DisableWifi=null,t.prototype.RovStatusReport=null,t.prototype.RestartRovServices=null,t.prototype.SendRovLogs=null,t.prototype.RefreshAllSensors=null,t.prototype.MoveClaw=null,t.prototype.SimplePeerSignal=null,t.prototype.Disarm=null,t.prototype.SetAutopilotMode=null,t.prototype.SetLivekitVideoOptions=null,t.prototype.SetSimplePeerVideoOptions=null,t.prototype.SetLivestreamingEnabled=null;let o;return Object.defineProperty(t.prototype,"Body",{get:$util.oneOfGetter(o=["Ping","PasswordAttempt","AuthTokenAttempt","TakeControl","Move","TakePhoto","StartVideoRec","StopVideoRec","ToggleLights","ShutdownRov","RebootRov","EnableWifi","DisableWifi","RovStatusReport","RestartRovServices","SendRovLogs","RefreshAllSensors","MoveClaw","SimplePeerSignal","Disarm","SetAutopilotMode","SetLivekitVideoOptions","SetSimplePeerVideoOptions","SetLivestreamingEnabled"]),set:$util.oneOfSetter(o)}),t.create=function(n){return new t(n)},t.encode=function(n,s){return s||(s=$Writer.create()),n.BackendMetadata!=null&&Object.hasOwnProperty.call(n,"BackendMetadata")&&$root.rov_actions_proto.ActionBackendMetadata.encode(n.BackendMetadata,s.uint32(10).fork()).ldelim(),n.ExchangeId!=null&&Object.hasOwnProperty.call(n,"ExchangeId")&&s.uint32(16).int32(n.ExchangeId),n.Ping!=null&&Object.hasOwnProperty.call(n,"Ping")&&$root.rov_actions_proto.PingAction.encode(n.Ping,s.uint32(26).fork()).ldelim(),n.PasswordAttempt!=null&&Object.hasOwnProperty.call(n,"PasswordAttempt")&&$root.rov_actions_proto.PasswordAttemptAction.encode(n.PasswordAttempt,s.uint32(34).fork()).ldelim(),n.AuthTokenAttempt!=null&&Object.hasOwnProperty.call(n,"AuthTokenAttempt")&&$root.rov_actions_proto.AuthTokenAttemptAction.encode(n.AuthTokenAttempt,s.uint32(42).fork()).ldelim(),n.TakeControl!=null&&Object.hasOwnProperty.call(n,"TakeControl")&&$root.rov_actions_proto.TakeControlAction.encode(n.TakeControl,s.uint32(50).fork()).ldelim(),n.Move!=null&&Object.hasOwnProperty.call(n,"Move")&&$root.rov_actions_proto.MoveAction.encode(n.Move,s.uint32(58).fork()).ldelim(),n.TakePhoto!=null&&Object.hasOwnProperty.call(n,"TakePhoto")&&$root.rov_actions_proto.TakePhotoAction.encode(n.TakePhoto,s.uint32(74).fork()).ldelim(),n.StartVideoRec!=null&&Object.hasOwnProperty.call(n,"StartVideoRec")&&$root.rov_actions_proto.StartVideoRecAction.encode(n.StartVideoRec,s.uint32(82).fork()).ldelim(),n.StopVideoRec!=null&&Object.hasOwnProperty.call(n,"StopVideoRec")&&$root.rov_actions_proto.StopVideoRecAction.encode(n.StopVideoRec,s.uint32(90).fork()).ldelim(),n.ToggleLights!=null&&Object.hasOwnProperty.call(n,"ToggleLights")&&$root.rov_actions_proto.ToggleLightsAction.encode(n.ToggleLights,s.uint32(98).fork()).ldelim(),n.ShutdownRov!=null&&Object.hasOwnProperty.call(n,"ShutdownRov")&&$root.rov_actions_proto.ShutdownRovAction.encode(n.ShutdownRov,s.uint32(106).fork()).ldelim(),n.RebootRov!=null&&Object.hasOwnProperty.call(n,"RebootRov")&&$root.rov_actions_proto.RebootRovAction.encode(n.RebootRov,s.uint32(114).fork()).ldelim(),n.EnableWifi!=null&&Object.hasOwnProperty.call(n,"EnableWifi")&&$root.rov_actions_proto.EnableWifiAction.encode(n.EnableWifi,s.uint32(122).fork()).ldelim(),n.DisableWifi!=null&&Object.hasOwnProperty.call(n,"DisableWifi")&&$root.rov_actions_proto.DisableWifiAction.encode(n.DisableWifi,s.uint32(130).fork()).ldelim(),n.RovStatusReport!=null&&Object.hasOwnProperty.call(n,"RovStatusReport")&&$root.rov_actions_proto.RovStatusReportAction.encode(n.RovStatusReport,s.uint32(138).fork()).ldelim(),n.RestartRovServices!=null&&Object.hasOwnProperty.call(n,"RestartRovServices")&&$root.rov_actions_proto.RestartRovServicesAction.encode(n.RestartRovServices,s.uint32(146).fork()).ldelim(),n.SendRovLogs!=null&&Object.hasOwnProperty.call(n,"SendRovLogs")&&$root.rov_actions_proto.SendRovLogsAction.encode(n.SendRovLogs,s.uint32(154).fork()).ldelim(),n.RefreshAllSensors!=null&&Object.hasOwnProperty.call(n,"RefreshAllSensors")&&$root.rov_actions_proto.RefreshAllSensorsAction.encode(n.RefreshAllSensors,s.uint32(162).fork()).ldelim(),n.MoveClaw!=null&&Object.hasOwnProperty.call(n,"MoveClaw")&&$root.rov_actions_proto.MoveClawAction.encode(n.MoveClaw,s.uint32(170).fork()).ldelim(),n.SimplePeerSignal!=null&&Object.hasOwnProperty.call(n,"SimplePeerSignal")&&$root.rov_actions_proto.SimplePeerSignalAction.encode(n.SimplePeerSignal,s.uint32(178).fork()).ldelim(),n.Disarm!=null&&Object.hasOwnProperty.call(n,"Disarm")&&$root.rov_actions_proto.DisarmAction.encode(n.Disarm,s.uint32(186).fork()).ldelim(),n.SetAutopilotMode!=null&&Object.hasOwnProperty.call(n,"SetAutopilotMode")&&$root.rov_actions_proto.SetAutopilotModeAction.encode(n.SetAutopilotMode,s.uint32(194).fork()).ldelim(),n.SetLivekitVideoOptions!=null&&Object.hasOwnProperty.call(n,"SetLivekitVideoOptions")&&$root.rov_actions_proto.SetLivekitVideoOptionsAction.encode(n.SetLivekitVideoOptions,s.uint32(202).fork()).ldelim(),n.SetSimplePeerVideoOptions!=null&&Object.hasOwnProperty.call(n,"SetSimplePeerVideoOptions")&&$root.rov_actions_proto.SetSimplePeerVideoOptionsAction.encode(n.SetSimplePeerVideoOptions,s.uint32(210).fork()).ldelim(),n.SetLivestreamingEnabled!=null&&Object.hasOwnProperty.call(n,"SetLivestreamingEnabled")&&$root.rov_actions_proto.SetLivestreamingEnabledAction.encode(n.SetLivestreamingEnabled,s.uint32(218).fork()).ldelim(),s},t.encodeDelimited=function(n,s){return this.encode(n,s).ldelim()},t.decode=function(n,s){n instanceof $Reader||(n=$Reader.create(n));let c=s===void 0?n.len:n.pos+s,l=new $root.rov_actions_proto.RovAction;for(;n.pos<c;){let u=n.uint32();switch(u>>>3){case 1:{l.BackendMetadata=$root.rov_actions_proto.ActionBackendMetadata.decode(n,n.uint32());break}case 2:{l.ExchangeId=n.int32();break}case 3:{l.Ping=$root.rov_actions_proto.PingAction.decode(n,n.uint32());break}case 4:{l.PasswordAttempt=$root.rov_actions_proto.PasswordAttemptAction.decode(n,n.uint32());break}case 5:{l.AuthTokenAttempt=$root.rov_actions_proto.AuthTokenAttemptAction.decode(n,n.uint32());break}case 6:{l.TakeControl=$root.rov_actions_proto.TakeControlAction.decode(n,n.uint32());break}case 7:{l.Move=$root.rov_actions_proto.MoveAction.decode(n,n.uint32());break}case 9:{l.TakePhoto=$root.rov_actions_proto.TakePhotoAction.decode(n,n.uint32());break}case 10:{l.StartVideoRec=$root.rov_actions_proto.StartVideoRecAction.decode(n,n.uint32());break}case 11:{l.StopVideoRec=$root.rov_actions_proto.StopVideoRecAction.decode(n,n.uint32());break}case 12:{l.ToggleLights=$root.rov_actions_proto.ToggleLightsAction.decode(n,n.uint32());break}case 13:{l.ShutdownRov=$root.rov_actions_proto.ShutdownRovAction.decode(n,n.uint32());break}case 14:{l.RebootRov=$root.rov_actions_proto.RebootRovAction.decode(n,n.uint32());break}case 15:{l.EnableWifi=$root.rov_actions_proto.EnableWifiAction.decode(n,n.uint32());break}case 16:{l.DisableWifi=$root.rov_actions_proto.DisableWifiAction.decode(n,n.uint32());break}case 17:{l.RovStatusReport=$root.rov_actions_proto.RovStatusReportAction.decode(n,n.uint32());break}case 18:{l.RestartRovServices=$root.rov_actions_proto.RestartRovServicesAction.decode(n,n.uint32());break}case 19:{l.SendRovLogs=$root.rov_actions_proto.SendRovLogsAction.decode(n,n.uint32());break}case 20:{l.RefreshAllSensors=$root.rov_actions_proto.RefreshAllSensorsAction.decode(n,n.uint32());break}case 21:{l.MoveClaw=$root.rov_actions_proto.MoveClawAction.decode(n,n.uint32());break}case 22:{l.SimplePeerSignal=$root.rov_actions_proto.SimplePeerSignalAction.decode(n,n.uint32());break}case 23:{l.Disarm=$root.rov_actions_proto.DisarmAction.decode(n,n.uint32());break}case 24:{l.SetAutopilotMode=$root.rov_actions_proto.SetAutopilotModeAction.decode(n,n.uint32());break}case 25:{l.SetLivekitVideoOptions=$root.rov_actions_proto.SetLivekitVideoOptionsAction.decode(n,n.uint32());break}case 26:{l.SetSimplePeerVideoOptions=$root.rov_actions_proto.SetSimplePeerVideoOptionsAction.decode(n,n.uint32());break}case 27:{l.SetLivestreamingEnabled=$root.rov_actions_proto.SetLivestreamingEnabledAction.decode(n,n.uint32());break}default:n.skipType(u&7);break}}return l},t.decodeDelimited=function(n){return n instanceof $Reader||(n=new $Reader(n)),this.decode(n,n.uint32())},t.verify=function(n){if(typeof n!="object"||n===null)return"object expected";let s={};if(n.BackendMetadata!=null&&n.hasOwnProperty("BackendMetadata")){let c=$root.rov_actions_proto.ActionBackendMetadata.verify(n.BackendMetadata);if(c)return"BackendMetadata."+c}if(n.ExchangeId!=null&&n.hasOwnProperty("ExchangeId")&&!$util.isInteger(n.ExchangeId))return"ExchangeId: integer expected";if(n.Ping!=null&&n.hasOwnProperty("Ping")){s.Body=1;{let c=$root.rov_actions_proto.PingAction.verify(n.Ping);if(c)return"Ping."+c}}if(n.PasswordAttempt!=null&&n.hasOwnProperty("PasswordAttempt")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.PasswordAttemptAction.verify(n.PasswordAttempt);if(c)return"PasswordAttempt."+c}}if(n.AuthTokenAttempt!=null&&n.hasOwnProperty("AuthTokenAttempt")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.AuthTokenAttemptAction.verify(n.AuthTokenAttempt);if(c)return"AuthTokenAttempt."+c}}if(n.TakeControl!=null&&n.hasOwnProperty("TakeControl")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.TakeControlAction.verify(n.TakeControl);if(c)return"TakeControl."+c}}if(n.Move!=null&&n.hasOwnProperty("Move")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.MoveAction.verify(n.Move);if(c)return"Move."+c}}if(n.TakePhoto!=null&&n.hasOwnProperty("TakePhoto")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.TakePhotoAction.verify(n.TakePhoto);if(c)return"TakePhoto."+c}}if(n.StartVideoRec!=null&&n.hasOwnProperty("StartVideoRec")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.StartVideoRecAction.verify(n.StartVideoRec);if(c)return"StartVideoRec."+c}}if(n.StopVideoRec!=null&&n.hasOwnProperty("StopVideoRec")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.StopVideoRecAction.verify(n.StopVideoRec);if(c)return"StopVideoRec."+c}}if(n.ToggleLights!=null&&n.hasOwnProperty("ToggleLights")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.ToggleLightsAction.verify(n.ToggleLights);if(c)return"ToggleLights."+c}}if(n.ShutdownRov!=null&&n.hasOwnProperty("ShutdownRov")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.ShutdownRovAction.verify(n.ShutdownRov);if(c)return"ShutdownRov."+c}}if(n.RebootRov!=null&&n.hasOwnProperty("RebootRov")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.RebootRovAction.verify(n.RebootRov);if(c)return"RebootRov."+c}}if(n.EnableWifi!=null&&n.hasOwnProperty("EnableWifi")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.EnableWifiAction.verify(n.EnableWifi);if(c)return"EnableWifi."+c}}if(n.DisableWifi!=null&&n.hasOwnProperty("DisableWifi")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.DisableWifiAction.verify(n.DisableWifi);if(c)return"DisableWifi."+c}}if(n.RovStatusReport!=null&&n.hasOwnProperty("RovStatusReport")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.RovStatusReportAction.verify(n.RovStatusReport);if(c)return"RovStatusReport."+c}}if(n.RestartRovServices!=null&&n.hasOwnProperty("RestartRovServices")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.RestartRovServicesAction.verify(n.RestartRovServices);if(c)return"RestartRovServices."+c}}if(n.SendRovLogs!=null&&n.hasOwnProperty("SendRovLogs")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.SendRovLogsAction.verify(n.SendRovLogs);if(c)return"SendRovLogs."+c}}if(n.RefreshAllSensors!=null&&n.hasOwnProperty("RefreshAllSensors")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.RefreshAllSensorsAction.verify(n.RefreshAllSensors);if(c)return"RefreshAllSensors."+c}}if(n.MoveClaw!=null&&n.hasOwnProperty("MoveClaw")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.MoveClawAction.verify(n.MoveClaw);if(c)return"MoveClaw."+c}}if(n.SimplePeerSignal!=null&&n.hasOwnProperty("SimplePeerSignal")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.SimplePeerSignalAction.verify(n.SimplePeerSignal);if(c)return"SimplePeerSignal."+c}}if(n.Disarm!=null&&n.hasOwnProperty("Disarm")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.DisarmAction.verify(n.Disarm);if(c)return"Disarm."+c}}if(n.SetAutopilotMode!=null&&n.hasOwnProperty("SetAutopilotMode")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.SetAutopilotModeAction.verify(n.SetAutopilotMode);if(c)return"SetAutopilotMode."+c}}if(n.SetLivekitVideoOptions!=null&&n.hasOwnProperty("SetLivekitVideoOptions")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.SetLivekitVideoOptionsAction.verify(n.SetLivekitVideoOptions);if(c)return"SetLivekitVideoOptions."+c}}if(n.SetSimplePeerVideoOptions!=null&&n.hasOwnProperty("SetSimplePeerVideoOptions")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.SetSimplePeerVideoOptionsAction.verify(n.SetSimplePeerVideoOptions);if(c)return"SetSimplePeerVideoOptions."+c}}if(n.SetLivestreamingEnabled!=null&&n.hasOwnProperty("SetLivestreamingEnabled")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.SetLivestreamingEnabledAction.verify(n.SetLivestreamingEnabled);if(c)return"SetLivestreamingEnabled."+c}}return null},t.fromObject=function(n){if(n instanceof $root.rov_actions_proto.RovAction)return n;let s=new $root.rov_actions_proto.RovAction;if(n.BackendMetadata!=null){if(typeof n.BackendMetadata!="object")throw TypeError(".rov_actions_proto.RovAction.BackendMetadata: object expected");s.BackendMetadata=$root.rov_actions_proto.ActionBackendMetadata.fromObject(n.BackendMetadata)}if(n.ExchangeId!=null&&(s.ExchangeId=n.ExchangeId|0),n.Ping!=null){if(typeof n.Ping!="object")throw TypeError(".rov_actions_proto.RovAction.Ping: object expected");s.Ping=$root.rov_actions_proto.PingAction.fromObject(n.Ping)}if(n.PasswordAttempt!=null){if(typeof n.PasswordAttempt!="object")throw TypeError(".rov_actions_proto.RovAction.PasswordAttempt: object expected");s.PasswordAttempt=$root.rov_actions_proto.PasswordAttemptAction.fromObject(n.PasswordAttempt)}if(n.AuthTokenAttempt!=null){if(typeof n.AuthTokenAttempt!="object")throw TypeError(".rov_actions_proto.RovAction.AuthTokenAttempt: object expected");s.AuthTokenAttempt=$root.rov_actions_proto.AuthTokenAttemptAction.fromObject(n.AuthTokenAttempt)}if(n.TakeControl!=null){if(typeof n.TakeControl!="object")throw TypeError(".rov_actions_proto.RovAction.TakeControl: object expected");s.TakeControl=$root.rov_actions_proto.TakeControlAction.fromObject(n.TakeControl)}if(n.Move!=null){if(typeof n.Move!="object")throw TypeError(".rov_actions_proto.RovAction.Move: object expected");s.Move=$root.rov_actions_proto.MoveAction.fromObject(n.Move)}if(n.TakePhoto!=null){if(typeof n.TakePhoto!="object")throw TypeError(".rov_actions_proto.RovAction.TakePhoto: object expected");s.TakePhoto=$root.rov_actions_proto.TakePhotoAction.fromObject(n.TakePhoto)}if(n.StartVideoRec!=null){if(typeof n.StartVideoRec!="object")throw TypeError(".rov_actions_proto.RovAction.StartVideoRec: object expected");s.StartVideoRec=$root.rov_actions_proto.StartVideoRecAction.fromObject(n.StartVideoRec)}if(n.StopVideoRec!=null){if(typeof n.StopVideoRec!="object")throw TypeError(".rov_actions_proto.RovAction.StopVideoRec: object expected");s.StopVideoRec=$root.rov_actions_proto.StopVideoRecAction.fromObject(n.StopVideoRec)}if(n.ToggleLights!=null){if(typeof n.ToggleLights!="object")throw TypeError(".rov_actions_proto.RovAction.ToggleLights: object expected");s.ToggleLights=$root.rov_actions_proto.ToggleLightsAction.fromObject(n.ToggleLights)}if(n.ShutdownRov!=null){if(typeof n.ShutdownRov!="object")throw TypeError(".rov_actions_proto.RovAction.ShutdownRov: object expected");s.ShutdownRov=$root.rov_actions_proto.ShutdownRovAction.fromObject(n.ShutdownRov)}if(n.RebootRov!=null){if(typeof n.RebootRov!="object")throw TypeError(".rov_actions_proto.RovAction.RebootRov: object expected");s.RebootRov=$root.rov_actions_proto.RebootRovAction.fromObject(n.RebootRov)}if(n.EnableWifi!=null){if(typeof n.EnableWifi!="object")throw TypeError(".rov_actions_proto.RovAction.EnableWifi: object expected");s.EnableWifi=$root.rov_actions_proto.EnableWifiAction.fromObject(n.EnableWifi)}if(n.DisableWifi!=null){if(typeof n.DisableWifi!="object")throw TypeError(".rov_actions_proto.RovAction.DisableWifi: object expected");s.DisableWifi=$root.rov_actions_proto.DisableWifiAction.fromObject(n.DisableWifi)}if(n.RovStatusReport!=null){if(typeof n.RovStatusReport!="object")throw TypeError(".rov_actions_proto.RovAction.RovStatusReport: object expected");s.RovStatusReport=$root.rov_actions_proto.RovStatusReportAction.fromObject(n.RovStatusReport)}if(n.RestartRovServices!=null){if(typeof n.RestartRovServices!="object")throw TypeError(".rov_actions_proto.RovAction.RestartRovServices: object expected");s.RestartRovServices=$root.rov_actions_proto.RestartRovServicesAction.fromObject(n.RestartRovServices)}if(n.SendRovLogs!=null){if(typeof n.SendRovLogs!="object")throw TypeError(".rov_actions_proto.RovAction.SendRovLogs: object expected");s.SendRovLogs=$root.rov_actions_proto.SendRovLogsAction.fromObject(n.SendRovLogs)}if(n.RefreshAllSensors!=null){if(typeof n.RefreshAllSensors!="object")throw TypeError(".rov_actions_proto.RovAction.RefreshAllSensors: object expected");s.RefreshAllSensors=$root.rov_actions_proto.RefreshAllSensorsAction.fromObject(n.RefreshAllSensors)}if(n.MoveClaw!=null){if(typeof n.MoveClaw!="object")throw TypeError(".rov_actions_proto.RovAction.MoveClaw: object expected");s.MoveClaw=$root.rov_actions_proto.MoveClawAction.fromObject(n.MoveClaw)}if(n.SimplePeerSignal!=null){if(typeof n.SimplePeerSignal!="object")throw TypeError(".rov_actions_proto.RovAction.SimplePeerSignal: object expected");s.SimplePeerSignal=$root.rov_actions_proto.SimplePeerSignalAction.fromObject(n.SimplePeerSignal)}if(n.Disarm!=null){if(typeof n.Disarm!="object")throw TypeError(".rov_actions_proto.RovAction.Disarm: object expected");s.Disarm=$root.rov_actions_proto.DisarmAction.fromObject(n.Disarm)}if(n.SetAutopilotMode!=null){if(typeof n.SetAutopilotMode!="object")throw TypeError(".rov_actions_proto.RovAction.SetAutopilotMode: object expected");s.SetAutopilotMode=$root.rov_actions_proto.SetAutopilotModeAction.fromObject(n.SetAutopilotMode)}if(n.SetLivekitVideoOptions!=null){if(typeof n.SetLivekitVideoOptions!="object")throw TypeError(".rov_actions_proto.RovAction.SetLivekitVideoOptions: object expected");s.SetLivekitVideoOptions=$root.rov_actions_proto.SetLivekitVideoOptionsAction.fromObject(n.SetLivekitVideoOptions)}if(n.SetSimplePeerVideoOptions!=null){if(typeof n.SetSimplePeerVideoOptions!="object")throw TypeError(".rov_actions_proto.RovAction.SetSimplePeerVideoOptions: object expected");s.SetSimplePeerVideoOptions=$root.rov_actions_proto.SetSimplePeerVideoOptionsAction.fromObject(n.SetSimplePeerVideoOptions)}if(n.SetLivestreamingEnabled!=null){if(typeof n.SetLivestreamingEnabled!="object")throw TypeError(".rov_actions_proto.RovAction.SetLivestreamingEnabled: object expected");s.SetLivestreamingEnabled=$root.rov_actions_proto.SetLivestreamingEnabledAction.fromObject(n.SetLivestreamingEnabled)}return s},t.toObject=function(n,s){s||(s={});let c={};return s.defaults&&(c.BackendMetadata=null,c.ExchangeId=0),n.BackendMetadata!=null&&n.hasOwnProperty("BackendMetadata")&&(c.BackendMetadata=$root.rov_actions_proto.ActionBackendMetadata.toObject(n.BackendMetadata,s)),n.ExchangeId!=null&&n.hasOwnProperty("ExchangeId")&&(c.ExchangeId=n.ExchangeId),n.Ping!=null&&n.hasOwnProperty("Ping")&&(c.Ping=$root.rov_actions_proto.PingAction.toObject(n.Ping,s),s.oneofs&&(c.Body="Ping")),n.PasswordAttempt!=null&&n.hasOwnProperty("PasswordAttempt")&&(c.PasswordAttempt=$root.rov_actions_proto.PasswordAttemptAction.toObject(n.PasswordAttempt,s),s.oneofs&&(c.Body="PasswordAttempt")),n.AuthTokenAttempt!=null&&n.hasOwnProperty("AuthTokenAttempt")&&(c.AuthTokenAttempt=$root.rov_actions_proto.AuthTokenAttemptAction.toObject(n.AuthTokenAttempt,s),s.oneofs&&(c.Body="AuthTokenAttempt")),n.TakeControl!=null&&n.hasOwnProperty("TakeControl")&&(c.TakeControl=$root.rov_actions_proto.TakeControlAction.toObject(n.TakeControl,s),s.oneofs&&(c.Body="TakeControl")),n.Move!=null&&n.hasOwnProperty("Move")&&(c.Move=$root.rov_actions_proto.MoveAction.toObject(n.Move,s),s.oneofs&&(c.Body="Move")),n.TakePhoto!=null&&n.hasOwnProperty("TakePhoto")&&(c.TakePhoto=$root.rov_actions_proto.TakePhotoAction.toObject(n.TakePhoto,s),s.oneofs&&(c.Body="TakePhoto")),n.StartVideoRec!=null&&n.hasOwnProperty("StartVideoRec")&&(c.StartVideoRec=$root.rov_actions_proto.StartVideoRecAction.toObject(n.StartVideoRec,s),s.oneofs&&(c.Body="StartVideoRec")),n.StopVideoRec!=null&&n.hasOwnProperty("StopVideoRec")&&(c.StopVideoRec=$root.rov_actions_proto.StopVideoRecAction.toObject(n.StopVideoRec,s),s.oneofs&&(c.Body="StopVideoRec")),n.ToggleLights!=null&&n.hasOwnProperty("ToggleLights")&&(c.ToggleLights=$root.rov_actions_proto.ToggleLightsAction.toObject(n.ToggleLights,s),s.oneofs&&(c.Body="ToggleLights")),n.ShutdownRov!=null&&n.hasOwnProperty("ShutdownRov")&&(c.ShutdownRov=$root.rov_actions_proto.ShutdownRovAction.toObject(n.ShutdownRov,s),s.oneofs&&(c.Body="ShutdownRov")),n.RebootRov!=null&&n.hasOwnProperty("RebootRov")&&(c.RebootRov=$root.rov_actions_proto.RebootRovAction.toObject(n.RebootRov,s),s.oneofs&&(c.Body="RebootRov")),n.EnableWifi!=null&&n.hasOwnProperty("EnableWifi")&&(c.EnableWifi=$root.rov_actions_proto.EnableWifiAction.toObject(n.EnableWifi,s),s.oneofs&&(c.Body="EnableWifi")),n.DisableWifi!=null&&n.hasOwnProperty("DisableWifi")&&(c.DisableWifi=$root.rov_actions_proto.DisableWifiAction.toObject(n.DisableWifi,s),s.oneofs&&(c.Body="DisableWifi")),n.RovStatusReport!=null&&n.hasOwnProperty("RovStatusReport")&&(c.RovStatusReport=$root.rov_actions_proto.RovStatusReportAction.toObject(n.RovStatusReport,s),s.oneofs&&(c.Body="RovStatusReport")),n.RestartRovServices!=null&&n.hasOwnProperty("RestartRovServices")&&(c.RestartRovServices=$root.rov_actions_proto.RestartRovServicesAction.toObject(n.RestartRovServices,s),s.oneofs&&(c.Body="RestartRovServices")),n.SendRovLogs!=null&&n.hasOwnProperty("SendRovLogs")&&(c.SendRovLogs=$root.rov_actions_proto.SendRovLogsAction.toObject(n.SendRovLogs,s),s.oneofs&&(c.Body="SendRovLogs")),n.RefreshAllSensors!=null&&n.hasOwnProperty("RefreshAllSensors")&&(c.RefreshAllSensors=$root.rov_actions_proto.RefreshAllSensorsAction.toObject(n.RefreshAllSensors,s),s.oneofs&&(c.Body="RefreshAllSensors")),n.MoveClaw!=null&&n.hasOwnProperty("MoveClaw")&&(c.MoveClaw=$root.rov_actions_proto.MoveClawAction.toObject(n.MoveClaw,s),s.oneofs&&(c.Body="MoveClaw")),n.SimplePeerSignal!=null&&n.hasOwnProperty("SimplePeerSignal")&&(c.SimplePeerSignal=$root.rov_actions_proto.SimplePeerSignalAction.toObject(n.SimplePeerSignal,s),s.oneofs&&(c.Body="SimplePeerSignal")),n.Disarm!=null&&n.hasOwnProperty("Disarm")&&(c.Disarm=$root.rov_actions_proto.DisarmAction.toObject(n.Disarm,s),s.oneofs&&(c.Body="Disarm")),n.SetAutopilotMode!=null&&n.hasOwnProperty("SetAutopilotMode")&&(c.SetAutopilotMode=$root.rov_actions_proto.SetAutopilotModeAction.toObject(n.SetAutopilotMode,s),s.oneofs&&(c.Body="SetAutopilotMode")),n.SetLivekitVideoOptions!=null&&n.hasOwnProperty("SetLivekitVideoOptions")&&(c.SetLivekitVideoOptions=$root.rov_actions_proto.SetLivekitVideoOptionsAction.toObject(n.SetLivekitVideoOptions,s),s.oneofs&&(c.Body="SetLivekitVideoOptions")),n.SetSimplePeerVideoOptions!=null&&n.hasOwnProperty("SetSimplePeerVideoOptions")&&(c.SetSimplePeerVideoOptions=$root.rov_actions_proto.SetSimplePeerVideoOptionsAction.toObject(n.SetSimplePeerVideoOptions,s),s.oneofs&&(c.Body="SetSimplePeerVideoOptions")),n.SetLivestreamingEnabled!=null&&n.hasOwnProperty("SetLivestreamingEnabled")&&(c.SetLivestreamingEnabled=$root.rov_actions_proto.SetLivestreamingEnabledAction.toObject(n.SetLivestreamingEnabled,s),s.oneofs&&(c.Body="SetLivestreamingEnabled")),c},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(n){return n===void 0&&(n="type.googleapis.com"),n+"/rov_actions_proto.RovAction"},t}(),a.DoneResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Message="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Message!=null&&Object.hasOwnProperty.call(e,"Message")&&n.uint32(10).string(e.Message),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.DoneResponse;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.Message=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Message!=null&&e.hasOwnProperty("Message")&&!$util.isString(e.Message)?"Message: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.DoneResponse)return e;let n=new $root.rov_actions_proto.DoneResponse;return e.Message!=null&&(n.Message=String(e.Message)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.Message=""),e.Message!=null&&e.hasOwnProperty("Message")&&(s.Message=e.Message),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.DoneResponse"},t}(),a.ErrorResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Message="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Message!=null&&Object.hasOwnProperty.call(e,"Message")&&n.uint32(10).string(e.Message),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.ErrorResponse;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.Message=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Message!=null&&e.hasOwnProperty("Message")&&!$util.isString(e.Message)?"Message: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.ErrorResponse)return e;let n=new $root.rov_actions_proto.ErrorResponse;return e.Message!=null&&(n.Message=String(e.Message)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.Message=""),e.Message!=null&&e.hasOwnProperty("Message")&&(s.Message=e.Message),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.ErrorResponse"},t}(),a.PongResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Time=$util.Long?$util.Long.fromBits(0,0,!1):0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Time!=null&&Object.hasOwnProperty.call(e,"Time")&&n.uint32(8).int64(e.Time),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.PongResponse;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.Time=e.int64();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Time!=null&&e.hasOwnProperty("Time")&&!$util.isInteger(e.Time)&&!(e.Time&&$util.isInteger(e.Time.low)&&$util.isInteger(e.Time.high))?"Time: integer|Long expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.PongResponse)return e;let n=new $root.rov_actions_proto.PongResponse;return e.Time!=null&&($util.Long?(n.Time=$util.Long.fromValue(e.Time)).unsigned=!1:typeof e.Time=="string"?n.Time=parseInt(e.Time,10):typeof e.Time=="number"?n.Time=e.Time:typeof e.Time=="object"&&(n.Time=new $util.LongBits(e.Time.low>>>0,e.Time.high>>>0).toNumber())),n},t.toObject=function(e,n){n||(n={});let s={};if(n.defaults)if($util.Long){let c=new $util.Long(0,0,!1);s.Time=n.longs===String?c.toString():n.longs===Number?c.toNumber():c}else s.Time=n.longs===String?"0":0;return e.Time!=null&&e.hasOwnProperty("Time")&&(typeof e.Time=="number"?s.Time=n.longs===String?String(e.Time):e.Time:s.Time=n.longs===String?$util.Long.prototype.toString.call(e.Time):n.longs===Number?new $util.LongBits(e.Time.low>>>0,e.Time.high>>>0).toNumber():e.Time),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.PongResponse"},t}(),a.Measurement=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.MeasurementType=0,t.prototype.Value=0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.MeasurementType!=null&&Object.hasOwnProperty.call(e,"MeasurementType")&&n.uint32(8).int32(e.MeasurementType),e.Value!=null&&Object.hasOwnProperty.call(e,"Value")&&n.uint32(21).float(e.Value),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.Measurement;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.MeasurementType=e.int32();break}case 2:{c.Value=e.float();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.MeasurementType!=null&&e.hasOwnProperty("MeasurementType"))switch(e.MeasurementType){default:return"MeasurementType: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:break}return e.Value!=null&&e.hasOwnProperty("Value")&&typeof e.Value!="number"?"Value: number expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.Measurement)return e;let n=new $root.rov_actions_proto.Measurement;switch(e.MeasurementType){default:if(typeof e.MeasurementType=="number"){n.MeasurementType=e.MeasurementType;break}break;case"depth_meters":case 0:n.MeasurementType=0;break;case"water_temp_celsius":case 1:n.MeasurementType=1;break;case"pressure_mbar":case 2:n.MeasurementType=2;break;case"yaw_degrees":case 3:n.MeasurementType=3;break;case"pitch_degrees":case 4:n.MeasurementType=4;break;case"roll_degrees":case 5:n.MeasurementType=5;break;case"x_acceleration_m_s2":case 6:n.MeasurementType=6;break;case"y_acceleration_m_s2":case 7:n.MeasurementType=7;break;case"z_acceleration_m_s2":case 8:n.MeasurementType=8;break;case"battery_voltage":case 9:n.MeasurementType=9;break;case"battery_current_amps":case 10:n.MeasurementType=10;break;case"internal_temp_celsius":case 11:n.MeasurementType=11;break}return e.Value!=null&&(n.Value=Number(e.Value)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.MeasurementType=n.enums===String?"depth_meters":0,s.Value=0),e.MeasurementType!=null&&e.hasOwnProperty("MeasurementType")&&(s.MeasurementType=n.enums===String?$root.rov_actions_proto.SensorMeasurmentTypes[e.MeasurementType]===void 0?e.MeasurementType:$root.rov_actions_proto.SensorMeasurmentTypes[e.MeasurementType]:e.MeasurementType),e.Value!=null&&e.hasOwnProperty("Value")&&(s.Value=n.json&&!isFinite(e.Value)?String(e.Value):e.Value),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.Measurement"},t}(),a.SensorUpdatesResponse=function(){function t(o){if(this.MeasurementUpdates=[],o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.MeasurementUpdates=$util.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,n){if(n||(n=$Writer.create()),e.MeasurementUpdates!=null&&e.MeasurementUpdates.length)for(let s=0;s<e.MeasurementUpdates.length;++s)$root.rov_actions_proto.Measurement.encode(e.MeasurementUpdates[s],n.uint32(10).fork()).ldelim();return n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.SensorUpdatesResponse;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.MeasurementUpdates&&c.MeasurementUpdates.length||(c.MeasurementUpdates=[]),c.MeasurementUpdates.push($root.rov_actions_proto.Measurement.decode(e,e.uint32()));break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.MeasurementUpdates!=null&&e.hasOwnProperty("MeasurementUpdates")){if(!Array.isArray(e.MeasurementUpdates))return"MeasurementUpdates: array expected";for(let n=0;n<e.MeasurementUpdates.length;++n){let s=$root.rov_actions_proto.Measurement.verify(e.MeasurementUpdates[n]);if(s)return"MeasurementUpdates."+s}}return null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.SensorUpdatesResponse)return e;let n=new $root.rov_actions_proto.SensorUpdatesResponse;if(e.MeasurementUpdates){if(!Array.isArray(e.MeasurementUpdates))throw TypeError(".rov_actions_proto.SensorUpdatesResponse.MeasurementUpdates: array expected");n.MeasurementUpdates=[];for(let s=0;s<e.MeasurementUpdates.length;++s){if(typeof e.MeasurementUpdates[s]!="object")throw TypeError(".rov_actions_proto.SensorUpdatesResponse.MeasurementUpdates: object expected");n.MeasurementUpdates[s]=$root.rov_actions_proto.Measurement.fromObject(e.MeasurementUpdates[s])}}return n},t.toObject=function(e,n){n||(n={});let s={};if((n.arrays||n.defaults)&&(s.MeasurementUpdates=[]),e.MeasurementUpdates&&e.MeasurementUpdates.length){s.MeasurementUpdates=[];for(let c=0;c<e.MeasurementUpdates.length;++c)s.MeasurementUpdates[c]=$root.rov_actions_proto.Measurement.toObject(e.MeasurementUpdates[c],n)}return s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SensorUpdatesResponse"},t}(),a.PasswordRequiredResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.RovId="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.RovId!=null&&Object.hasOwnProperty.call(e,"RovId")&&n.uint32(10).string(e.RovId),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.PasswordRequiredResponse;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.RovId=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.RovId!=null&&e.hasOwnProperty("RovId")&&!$util.isString(e.RovId)?"RovId: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.PasswordRequiredResponse)return e;let n=new $root.rov_actions_proto.PasswordRequiredResponse;return e.RovId!=null&&(n.RovId=String(e.RovId)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.RovId=""),e.RovId!=null&&e.hasOwnProperty("RovId")&&(s.RovId=e.RovId),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.PasswordRequiredResponse"},t}(),a.PasswordAcceptedResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.AuthToken="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.AuthToken!=null&&Object.hasOwnProperty.call(e,"AuthToken")&&n.uint32(10).string(e.AuthToken),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.PasswordAcceptedResponse;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.AuthToken=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.AuthToken!=null&&e.hasOwnProperty("AuthToken")&&!$util.isString(e.AuthToken)?"AuthToken: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.PasswordAcceptedResponse)return e;let n=new $root.rov_actions_proto.PasswordAcceptedResponse;return e.AuthToken!=null&&(n.AuthToken=String(e.AuthToken)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.AuthToken=""),e.AuthToken!=null&&e.hasOwnProperty("AuthToken")&&(s.AuthToken=e.AuthToken),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.PasswordAcceptedResponse"},t}(),a.PasswordInvalidResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.PasswordInvalidResponse;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.PasswordInvalidResponse?e:new $root.rov_actions_proto.PasswordInvalidResponse},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.PasswordInvalidResponse"},t}(),a.PilotChangedResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.PilotIdentity="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.PilotIdentity!=null&&Object.hasOwnProperty.call(e,"PilotIdentity")&&n.uint32(10).string(e.PilotIdentity),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.PilotChangedResponse;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.PilotIdentity=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.PilotIdentity!=null&&e.hasOwnProperty("PilotIdentity")&&!$util.isString(e.PilotIdentity)?"PilotIdentity: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.PilotChangedResponse)return e;let n=new $root.rov_actions_proto.PilotChangedResponse;return e.PilotIdentity!=null&&(n.PilotIdentity=String(e.PilotIdentity)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.PilotIdentity=""),e.PilotIdentity!=null&&e.hasOwnProperty("PilotIdentity")&&(s.PilotIdentity=e.PilotIdentity),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.PilotChangedResponse"},t}(),a.ClientConnectedResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.ClientPeerId="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.ClientPeerId!=null&&Object.hasOwnProperty.call(e,"ClientPeerId")&&n.uint32(10).string(e.ClientPeerId),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.ClientConnectedResponse;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.ClientPeerId=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.ClientPeerId!=null&&e.hasOwnProperty("ClientPeerId")&&!$util.isString(e.ClientPeerId)?"ClientPeerId: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.ClientConnectedResponse)return e;let n=new $root.rov_actions_proto.ClientConnectedResponse;return e.ClientPeerId!=null&&(n.ClientPeerId=String(e.ClientPeerId)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.ClientPeerId=""),e.ClientPeerId!=null&&e.hasOwnProperty("ClientPeerId")&&(s.ClientPeerId=e.ClientPeerId),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.ClientConnectedResponse"},t}(),a.ClientDisconnectedResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.ClientPeerId="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.ClientPeerId!=null&&Object.hasOwnProperty.call(e,"ClientPeerId")&&n.uint32(10).string(e.ClientPeerId),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.ClientDisconnectedResponse;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.ClientPeerId=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.ClientPeerId!=null&&e.hasOwnProperty("ClientPeerId")&&!$util.isString(e.ClientPeerId)?"ClientPeerId: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.ClientDisconnectedResponse)return e;let n=new $root.rov_actions_proto.ClientDisconnectedResponse;return e.ClientPeerId!=null&&(n.ClientPeerId=String(e.ClientPeerId)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.ClientPeerId=""),e.ClientPeerId!=null&&e.hasOwnProperty("ClientPeerId")&&(s.ClientPeerId=e.ClientPeerId),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.ClientDisconnectedResponse"},t}(),a.HeartbeatResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Time=$util.Long?$util.Long.fromBits(0,0,!1):0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Time!=null&&Object.hasOwnProperty.call(e,"Time")&&n.uint32(8).int64(e.Time),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.HeartbeatResponse;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.Time=e.int64();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Time!=null&&e.hasOwnProperty("Time")&&!$util.isInteger(e.Time)&&!(e.Time&&$util.isInteger(e.Time.low)&&$util.isInteger(e.Time.high))?"Time: integer|Long expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.HeartbeatResponse)return e;let n=new $root.rov_actions_proto.HeartbeatResponse;return e.Time!=null&&($util.Long?(n.Time=$util.Long.fromValue(e.Time)).unsigned=!1:typeof e.Time=="string"?n.Time=parseInt(e.Time,10):typeof e.Time=="number"?n.Time=e.Time:typeof e.Time=="object"&&(n.Time=new $util.LongBits(e.Time.low>>>0,e.Time.high>>>0).toNumber())),n},t.toObject=function(e,n){n||(n={});let s={};if(n.defaults)if($util.Long){let c=new $util.Long(0,0,!1);s.Time=n.longs===String?c.toString():n.longs===Number?c.toNumber():c}else s.Time=n.longs===String?"0":0;return e.Time!=null&&e.hasOwnProperty("Time")&&(typeof e.Time=="number"?s.Time=n.longs===String?String(e.Time):e.Time:s.Time=n.longs===String?$util.Long.prototype.toString.call(e.Time):n.longs===Number?new $util.LongBits(e.Time.low>>>0,e.Time.high>>>0).toNumber():e.Time),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.HeartbeatResponse"},t}(),a.ContinuedOutputResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Message="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Message!=null&&Object.hasOwnProperty.call(e,"Message")&&n.uint32(10).string(e.Message),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.ContinuedOutputResponse;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.Message=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Message!=null&&e.hasOwnProperty("Message")&&!$util.isString(e.Message)?"Message: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.ContinuedOutputResponse)return e;let n=new $root.rov_actions_proto.ContinuedOutputResponse;return e.Message!=null&&(n.Message=String(e.Message)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.Message=""),e.Message!=null&&e.hasOwnProperty("Message")&&(s.Message=e.Message),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.ContinuedOutputResponse"},t}(),a.MavlinkResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Message=$util.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Message!=null&&Object.hasOwnProperty.call(e,"Message")&&n.uint32(10).bytes(e.Message),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.MavlinkResponse;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.Message=e.bytes();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Message!=null&&e.hasOwnProperty("Message")&&!(e.Message&&typeof e.Message.length=="number"||$util.isString(e.Message))?"Message: buffer expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.MavlinkResponse)return e;let n=new $root.rov_actions_proto.MavlinkResponse;return e.Message!=null&&(typeof e.Message=="string"?$util.base64.decode(e.Message,n.Message=$util.newBuffer($util.base64.length(e.Message)),0):e.Message.length>=0&&(n.Message=e.Message)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(n.bytes===String?s.Message="":(s.Message=[],n.bytes!==Array&&(s.Message=$util.newBuffer(s.Message)))),e.Message!=null&&e.hasOwnProperty("Message")&&(s.Message=n.bytes===String?$util.base64.encode(e.Message,0,e.Message.length):n.bytes===Array?Array.prototype.slice.call(e.Message):e.Message),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.MavlinkResponse"},t}(),a.SimplePeerSignalResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Message="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Message!=null&&Object.hasOwnProperty.call(e,"Message")&&n.uint32(10).string(e.Message),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.SimplePeerSignalResponse;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.Message=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Message!=null&&e.hasOwnProperty("Message")&&!$util.isString(e.Message)?"Message: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.SimplePeerSignalResponse)return e;let n=new $root.rov_actions_proto.SimplePeerSignalResponse;return e.Message!=null&&(n.Message=String(e.Message)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.Message=""),e.Message!=null&&e.hasOwnProperty("Message")&&(s.Message=e.Message),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SimplePeerSignalResponse"},t}(),a.SystemMonitorResponse=function(){function t(o){if(this.Warnings=[],o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.CpuTemp=0,t.prototype.CpuUsage=0,t.prototype.MemoryUsage=0,t.prototype.DiskUsage=0,t.prototype.Warnings=$util.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,n){if(n||(n=$Writer.create()),e.CpuTemp!=null&&Object.hasOwnProperty.call(e,"CpuTemp")&&n.uint32(13).float(e.CpuTemp),e.CpuUsage!=null&&Object.hasOwnProperty.call(e,"CpuUsage")&&n.uint32(21).float(e.CpuUsage),e.MemoryUsage!=null&&Object.hasOwnProperty.call(e,"MemoryUsage")&&n.uint32(29).float(e.MemoryUsage),e.DiskUsage!=null&&Object.hasOwnProperty.call(e,"DiskUsage")&&n.uint32(37).float(e.DiskUsage),e.Warnings!=null&&e.Warnings.length)for(let s=0;s<e.Warnings.length;++s)n.uint32(42).string(e.Warnings[s]);return n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.SystemMonitorResponse;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.CpuTemp=e.float();break}case 2:{c.CpuUsage=e.float();break}case 3:{c.MemoryUsage=e.float();break}case 4:{c.DiskUsage=e.float();break}case 5:{c.Warnings&&c.Warnings.length||(c.Warnings=[]),c.Warnings.push(e.string());break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.CpuTemp!=null&&e.hasOwnProperty("CpuTemp")&&typeof e.CpuTemp!="number")return"CpuTemp: number expected";if(e.CpuUsage!=null&&e.hasOwnProperty("CpuUsage")&&typeof e.CpuUsage!="number")return"CpuUsage: number expected";if(e.MemoryUsage!=null&&e.hasOwnProperty("MemoryUsage")&&typeof e.MemoryUsage!="number")return"MemoryUsage: number expected";if(e.DiskUsage!=null&&e.hasOwnProperty("DiskUsage")&&typeof e.DiskUsage!="number")return"DiskUsage: number expected";if(e.Warnings!=null&&e.hasOwnProperty("Warnings")){if(!Array.isArray(e.Warnings))return"Warnings: array expected";for(let n=0;n<e.Warnings.length;++n)if(!$util.isString(e.Warnings[n]))return"Warnings: string[] expected"}return null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.SystemMonitorResponse)return e;let n=new $root.rov_actions_proto.SystemMonitorResponse;if(e.CpuTemp!=null&&(n.CpuTemp=Number(e.CpuTemp)),e.CpuUsage!=null&&(n.CpuUsage=Number(e.CpuUsage)),e.MemoryUsage!=null&&(n.MemoryUsage=Number(e.MemoryUsage)),e.DiskUsage!=null&&(n.DiskUsage=Number(e.DiskUsage)),e.Warnings){if(!Array.isArray(e.Warnings))throw TypeError(".rov_actions_proto.SystemMonitorResponse.Warnings: array expected");n.Warnings=[];for(let s=0;s<e.Warnings.length;++s)n.Warnings[s]=String(e.Warnings[s])}return n},t.toObject=function(e,n){n||(n={});let s={};if((n.arrays||n.defaults)&&(s.Warnings=[]),n.defaults&&(s.CpuTemp=0,s.CpuUsage=0,s.MemoryUsage=0,s.DiskUsage=0),e.CpuTemp!=null&&e.hasOwnProperty("CpuTemp")&&(s.CpuTemp=n.json&&!isFinite(e.CpuTemp)?String(e.CpuTemp):e.CpuTemp),e.CpuUsage!=null&&e.hasOwnProperty("CpuUsage")&&(s.CpuUsage=n.json&&!isFinite(e.CpuUsage)?String(e.CpuUsage):e.CpuUsage),e.MemoryUsage!=null&&e.hasOwnProperty("MemoryUsage")&&(s.MemoryUsage=n.json&&!isFinite(e.MemoryUsage)?String(e.MemoryUsage):e.MemoryUsage),e.DiskUsage!=null&&e.hasOwnProperty("DiskUsage")&&(s.DiskUsage=n.json&&!isFinite(e.DiskUsage)?String(e.DiskUsage):e.DiskUsage),e.Warnings&&e.Warnings.length){s.Warnings=[];for(let c=0;c<e.Warnings.length;++c)s.Warnings[c]=e.Warnings[c]}return s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SystemMonitorResponse"},t}(),a.LogMessageResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Message="",t.prototype.Level=0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Message!=null&&Object.hasOwnProperty.call(e,"Message")&&n.uint32(10).string(e.Message),e.Level!=null&&Object.hasOwnProperty.call(e,"Level")&&n.uint32(16).int32(e.Level),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.LogMessageResponse;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.Message=e.string();break}case 2:{c.Level=e.int32();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.Message!=null&&e.hasOwnProperty("Message")&&!$util.isString(e.Message))return"Message: string expected";if(e.Level!=null&&e.hasOwnProperty("Level"))switch(e.Level){default:return"Level: enum value expected";case 0:case 1:case 2:case 3:case 4:break}return null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.LogMessageResponse)return e;let n=new $root.rov_actions_proto.LogMessageResponse;switch(e.Message!=null&&(n.Message=String(e.Message)),e.Level){default:if(typeof e.Level=="number"){n.Level=e.Level;break}break;case"Debug":case 0:n.Level=0;break;case"Info":case 1:n.Level=1;break;case"Warning":case 2:n.Level=2;break;case"Error":case 3:n.Level=3;break;case"Critical":case 4:n.Level=4;break}return n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.Message="",s.Level=n.enums===String?"Debug":0),e.Message!=null&&e.hasOwnProperty("Message")&&(s.Message=e.Message),e.Level!=null&&e.hasOwnProperty("Level")&&(s.Level=n.enums===String?$root.rov_actions_proto.LogLevel[e.Level]===void 0?e.Level:$root.rov_actions_proto.LogLevel[e.Level]:e.Level),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.LogMessageResponse"},t}(),a.LivekitVideoStatsResponse=function(){function t(o){if(this.simulcastLayers=[],o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.enabled=!1,t.prototype.codec="",t.prototype.allowBackupCodec=!1,t.prototype.baseStream=null,t.prototype.simulcastLayers=$util.emptyArray,t.prototype.stats=null,t.create=function(e){return new t(e)},t.encode=function(e,n){if(n||(n=$Writer.create()),e.enabled!=null&&Object.hasOwnProperty.call(e,"enabled")&&n.uint32(8).bool(e.enabled),e.codec!=null&&Object.hasOwnProperty.call(e,"codec")&&n.uint32(18).string(e.codec),e.allowBackupCodec!=null&&Object.hasOwnProperty.call(e,"allowBackupCodec")&&n.uint32(24).bool(e.allowBackupCodec),e.baseStream!=null&&Object.hasOwnProperty.call(e,"baseStream")&&$root.rov_actions_proto.VideoStreamOptions.encode(e.baseStream,n.uint32(34).fork()).ldelim(),e.simulcastLayers!=null&&e.simulcastLayers.length)for(let s=0;s<e.simulcastLayers.length;++s)$root.rov_actions_proto.VideoStreamOptions.encode(e.simulcastLayers[s],n.uint32(42).fork()).ldelim();return e.stats!=null&&Object.hasOwnProperty.call(e,"stats")&&$root.rov_actions_proto.VideoBaseStats.encode(e.stats,n.uint32(50).fork()).ldelim(),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.LivekitVideoStatsResponse;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.enabled=e.bool();break}case 2:{c.codec=e.string();break}case 3:{c.allowBackupCodec=e.bool();break}case 4:{c.baseStream=$root.rov_actions_proto.VideoStreamOptions.decode(e,e.uint32());break}case 5:{c.simulcastLayers&&c.simulcastLayers.length||(c.simulcastLayers=[]),c.simulcastLayers.push($root.rov_actions_proto.VideoStreamOptions.decode(e,e.uint32()));break}case 6:{c.stats=$root.rov_actions_proto.VideoBaseStats.decode(e,e.uint32());break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.enabled!=null&&e.hasOwnProperty("enabled")&&typeof e.enabled!="boolean")return"enabled: boolean expected";if(e.codec!=null&&e.hasOwnProperty("codec")&&!$util.isString(e.codec))return"codec: string expected";if(e.allowBackupCodec!=null&&e.hasOwnProperty("allowBackupCodec")&&typeof e.allowBackupCodec!="boolean")return"allowBackupCodec: boolean expected";if(e.baseStream!=null&&e.hasOwnProperty("baseStream")){let n=$root.rov_actions_proto.VideoStreamOptions.verify(e.baseStream);if(n)return"baseStream."+n}if(e.simulcastLayers!=null&&e.hasOwnProperty("simulcastLayers")){if(!Array.isArray(e.simulcastLayers))return"simulcastLayers: array expected";for(let n=0;n<e.simulcastLayers.length;++n){let s=$root.rov_actions_proto.VideoStreamOptions.verify(e.simulcastLayers[n]);if(s)return"simulcastLayers."+s}}if(e.stats!=null&&e.hasOwnProperty("stats")){let n=$root.rov_actions_proto.VideoBaseStats.verify(e.stats);if(n)return"stats."+n}return null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.LivekitVideoStatsResponse)return e;let n=new $root.rov_actions_proto.LivekitVideoStatsResponse;if(e.enabled!=null&&(n.enabled=!!e.enabled),e.codec!=null&&(n.codec=String(e.codec)),e.allowBackupCodec!=null&&(n.allowBackupCodec=!!e.allowBackupCodec),e.baseStream!=null){if(typeof e.baseStream!="object")throw TypeError(".rov_actions_proto.LivekitVideoStatsResponse.baseStream: object expected");n.baseStream=$root.rov_actions_proto.VideoStreamOptions.fromObject(e.baseStream)}if(e.simulcastLayers){if(!Array.isArray(e.simulcastLayers))throw TypeError(".rov_actions_proto.LivekitVideoStatsResponse.simulcastLayers: array expected");n.simulcastLayers=[];for(let s=0;s<e.simulcastLayers.length;++s){if(typeof e.simulcastLayers[s]!="object")throw TypeError(".rov_actions_proto.LivekitVideoStatsResponse.simulcastLayers: object expected");n.simulcastLayers[s]=$root.rov_actions_proto.VideoStreamOptions.fromObject(e.simulcastLayers[s])}}if(e.stats!=null){if(typeof e.stats!="object")throw TypeError(".rov_actions_proto.LivekitVideoStatsResponse.stats: object expected");n.stats=$root.rov_actions_proto.VideoBaseStats.fromObject(e.stats)}return n},t.toObject=function(e,n){n||(n={});let s={};if((n.arrays||n.defaults)&&(s.simulcastLayers=[]),n.defaults&&(s.enabled=!1,s.codec="",s.allowBackupCodec=!1,s.baseStream=null,s.stats=null),e.enabled!=null&&e.hasOwnProperty("enabled")&&(s.enabled=e.enabled),e.codec!=null&&e.hasOwnProperty("codec")&&(s.codec=e.codec),e.allowBackupCodec!=null&&e.hasOwnProperty("allowBackupCodec")&&(s.allowBackupCodec=e.allowBackupCodec),e.baseStream!=null&&e.hasOwnProperty("baseStream")&&(s.baseStream=$root.rov_actions_proto.VideoStreamOptions.toObject(e.baseStream,n)),e.simulcastLayers&&e.simulcastLayers.length){s.simulcastLayers=[];for(let c=0;c<e.simulcastLayers.length;++c)s.simulcastLayers[c]=$root.rov_actions_proto.VideoStreamOptions.toObject(e.simulcastLayers[c],n)}return e.stats!=null&&e.hasOwnProperty("stats")&&(s.stats=$root.rov_actions_proto.VideoBaseStats.toObject(e.stats,n)),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.LivekitVideoStatsResponse"},t}(),a.SimplePeerVideoStatsResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.enabled=!1,t.prototype.codec="",t.prototype.baseStream=null,t.prototype.stats=null,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.enabled!=null&&Object.hasOwnProperty.call(e,"enabled")&&n.uint32(8).bool(e.enabled),e.codec!=null&&Object.hasOwnProperty.call(e,"codec")&&n.uint32(18).string(e.codec),e.baseStream!=null&&Object.hasOwnProperty.call(e,"baseStream")&&$root.rov_actions_proto.VideoStreamOptions.encode(e.baseStream,n.uint32(26).fork()).ldelim(),e.stats!=null&&Object.hasOwnProperty.call(e,"stats")&&$root.rov_actions_proto.VideoBaseStats.encode(e.stats,n.uint32(34).fork()).ldelim(),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.SimplePeerVideoStatsResponse;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.enabled=e.bool();break}case 2:{c.codec=e.string();break}case 3:{c.baseStream=$root.rov_actions_proto.VideoStreamOptions.decode(e,e.uint32());break}case 4:{c.stats=$root.rov_actions_proto.VideoBaseStats.decode(e,e.uint32());break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.enabled!=null&&e.hasOwnProperty("enabled")&&typeof e.enabled!="boolean")return"enabled: boolean expected";if(e.codec!=null&&e.hasOwnProperty("codec")&&!$util.isString(e.codec))return"codec: string expected";if(e.baseStream!=null&&e.hasOwnProperty("baseStream")){let n=$root.rov_actions_proto.VideoStreamOptions.verify(e.baseStream);if(n)return"baseStream."+n}if(e.stats!=null&&e.hasOwnProperty("stats")){let n=$root.rov_actions_proto.VideoBaseStats.verify(e.stats);if(n)return"stats."+n}return null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.SimplePeerVideoStatsResponse)return e;let n=new $root.rov_actions_proto.SimplePeerVideoStatsResponse;if(e.enabled!=null&&(n.enabled=!!e.enabled),e.codec!=null&&(n.codec=String(e.codec)),e.baseStream!=null){if(typeof e.baseStream!="object")throw TypeError(".rov_actions_proto.SimplePeerVideoStatsResponse.baseStream: object expected");n.baseStream=$root.rov_actions_proto.VideoStreamOptions.fromObject(e.baseStream)}if(e.stats!=null){if(typeof e.stats!="object")throw TypeError(".rov_actions_proto.SimplePeerVideoStatsResponse.stats: object expected");n.stats=$root.rov_actions_proto.VideoBaseStats.fromObject(e.stats)}return n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.enabled=!1,s.codec="",s.baseStream=null,s.stats=null),e.enabled!=null&&e.hasOwnProperty("enabled")&&(s.enabled=e.enabled),e.codec!=null&&e.hasOwnProperty("codec")&&(s.codec=e.codec),e.baseStream!=null&&e.hasOwnProperty("baseStream")&&(s.baseStream=$root.rov_actions_proto.VideoStreamOptions.toObject(e.baseStream,n)),e.stats!=null&&e.hasOwnProperty("stats")&&(s.stats=$root.rov_actions_proto.VideoBaseStats.toObject(e.stats,n)),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SimplePeerVideoStatsResponse"},t}(),a.ResponseBackendMetadata=function(){function t(o){if(this.TargetUserIds=[],o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.TargetUserIds=$util.emptyArray,t.prototype.TransportMethod=0,t.create=function(e){return new t(e)},t.encode=function(e,n){if(n||(n=$Writer.create()),e.TargetUserIds!=null&&e.TargetUserIds.length)for(let s=0;s<e.TargetUserIds.length;++s)n.uint32(10).string(e.TargetUserIds[s]);return e.TransportMethod!=null&&Object.hasOwnProperty.call(e,"TransportMethod")&&n.uint32(16).int32(e.TransportMethod),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.ResponseBackendMetadata;for(;e.pos<s;){let l=e.uint32();switch(l>>>3){case 1:{c.TargetUserIds&&c.TargetUserIds.length||(c.TargetUserIds=[]),c.TargetUserIds.push(e.string());break}case 2:{c.TransportMethod=e.int32();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.TargetUserIds!=null&&e.hasOwnProperty("TargetUserIds")){if(!Array.isArray(e.TargetUserIds))return"TargetUserIds: array expected";for(let n=0;n<e.TargetUserIds.length;++n)if(!$util.isString(e.TargetUserIds[n]))return"TargetUserIds: string[] expected"}if(e.TransportMethod!=null&&e.hasOwnProperty("TransportMethod"))switch(e.TransportMethod){default:return"TransportMethod: enum value expected";case 0:case 1:case 2:case 3:break}return null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.ResponseBackendMetadata)return e;let n=new $root.rov_actions_proto.ResponseBackendMetadata;if(e.TargetUserIds){if(!Array.isArray(e.TargetUserIds))throw TypeError(".rov_actions_proto.ResponseBackendMetadata.TargetUserIds: array expected");n.TargetUserIds=[];for(let s=0;s<e.TargetUserIds.length;++s)n.TargetUserIds[s]=String(e.TargetUserIds[s])}switch(e.TransportMethod){default:if(typeof e.TransportMethod=="number"){n.TransportMethod=e.TransportMethod;break}break;case"LivekitReliable":case 0:n.TransportMethod=0;break;case"LivekitUnreliable":case 1:n.TransportMethod=1;break;case"DirectReliable":case 2:n.TransportMethod=2;break;case"DirectUnreliable":case 3:n.TransportMethod=3;break}return n},t.toObject=function(e,n){n||(n={});let s={};if((n.arrays||n.defaults)&&(s.TargetUserIds=[]),n.defaults&&(s.TransportMethod=n.enums===String?"LivekitReliable":0),e.TargetUserIds&&e.TargetUserIds.length){s.TargetUserIds=[];for(let c=0;c<e.TargetUserIds.length;++c)s.TargetUserIds[c]=e.TargetUserIds[c]}return e.TransportMethod!=null&&e.hasOwnProperty("TransportMethod")&&(s.TransportMethod=n.enums===String?$root.rov_actions_proto.DataTransportMethod[e.TransportMethod]===void 0?e.TransportMethod:$root.rov_actions_proto.DataTransportMethod[e.TransportMethod]:e.TransportMethod),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.ResponseBackendMetadata"},t}(),a.RovResponse=function(){function t(e){if(e)for(let n=Object.keys(e),s=0;s<n.length;++s)e[n[s]]!=null&&(this[n[s]]=e[n[s]])}t.prototype.BackendMetadata=null,t.prototype.ExchangeId=0,t.prototype.Done=null,t.prototype.Error=null,t.prototype.Pong=null,t.prototype.ContinuedOutput=null,t.prototype.SensorUpdates=null,t.prototype.PasswordRequired=null,t.prototype.PasswordAccepted=null,t.prototype.PasswordInvalid=null,t.prototype.PilotChanged=null,t.prototype.ClientConnected=null,t.prototype.ClientDisconnected=null,t.prototype.Heartbeat=null,t.prototype.Mavlink=null,t.prototype.SimplePeerSignal=null,t.prototype.SystemMonitor=null,t.prototype.LogMessage=null,t.prototype.LivekitVideoStats=null,t.prototype.SimplePeerVideoStats=null;let o;return Object.defineProperty(t.prototype,"Body",{get:$util.oneOfGetter(o=["Done","Error","Pong","ContinuedOutput","SensorUpdates","PasswordRequired","PasswordAccepted","PasswordInvalid","PilotChanged","ClientConnected","ClientDisconnected","Heartbeat","Mavlink","SimplePeerSignal","SystemMonitor","LogMessage","LivekitVideoStats","SimplePeerVideoStats"]),set:$util.oneOfSetter(o)}),t.create=function(n){return new t(n)},t.encode=function(n,s){return s||(s=$Writer.create()),n.BackendMetadata!=null&&Object.hasOwnProperty.call(n,"BackendMetadata")&&$root.rov_actions_proto.ResponseBackendMetadata.encode(n.BackendMetadata,s.uint32(10).fork()).ldelim(),n.ExchangeId!=null&&Object.hasOwnProperty.call(n,"ExchangeId")&&s.uint32(16).int32(n.ExchangeId),n.Done!=null&&Object.hasOwnProperty.call(n,"Done")&&$root.rov_actions_proto.DoneResponse.encode(n.Done,s.uint32(26).fork()).ldelim(),n.Error!=null&&Object.hasOwnProperty.call(n,"Error")&&$root.rov_actions_proto.ErrorResponse.encode(n.Error,s.uint32(34).fork()).ldelim(),n.Pong!=null&&Object.hasOwnProperty.call(n,"Pong")&&$root.rov_actions_proto.PongResponse.encode(n.Pong,s.uint32(42).fork()).ldelim(),n.ContinuedOutput!=null&&Object.hasOwnProperty.call(n,"ContinuedOutput")&&$root.rov_actions_proto.ContinuedOutputResponse.encode(n.ContinuedOutput,s.uint32(50).fork()).ldelim(),n.SensorUpdates!=null&&Object.hasOwnProperty.call(n,"SensorUpdates")&&$root.rov_actions_proto.SensorUpdatesResponse.encode(n.SensorUpdates,s.uint32(58).fork()).ldelim(),n.PasswordRequired!=null&&Object.hasOwnProperty.call(n,"PasswordRequired")&&$root.rov_actions_proto.PasswordRequiredResponse.encode(n.PasswordRequired,s.uint32(66).fork()).ldelim(),n.PasswordAccepted!=null&&Object.hasOwnProperty.call(n,"PasswordAccepted")&&$root.rov_actions_proto.PasswordAcceptedResponse.encode(n.PasswordAccepted,s.uint32(74).fork()).ldelim(),n.PasswordInvalid!=null&&Object.hasOwnProperty.call(n,"PasswordInvalid")&&$root.rov_actions_proto.PasswordInvalidResponse.encode(n.PasswordInvalid,s.uint32(82).fork()).ldelim(),n.PilotChanged!=null&&Object.hasOwnProperty.call(n,"PilotChanged")&&$root.rov_actions_proto.PilotChangedResponse.encode(n.PilotChanged,s.uint32(106).fork()).ldelim(),n.ClientConnected!=null&&Object.hasOwnProperty.call(n,"ClientConnected")&&$root.rov_actions_proto.ClientConnectedResponse.encode(n.ClientConnected,s.uint32(114).fork()).ldelim(),n.ClientDisconnected!=null&&Object.hasOwnProperty.call(n,"ClientDisconnected")&&$root.rov_actions_proto.ClientDisconnectedResponse.encode(n.ClientDisconnected,s.uint32(122).fork()).ldelim(),n.Heartbeat!=null&&Object.hasOwnProperty.call(n,"Heartbeat")&&$root.rov_actions_proto.HeartbeatResponse.encode(n.Heartbeat,s.uint32(130).fork()).ldelim(),n.Mavlink!=null&&Object.hasOwnProperty.call(n,"Mavlink")&&$root.rov_actions_proto.MavlinkResponse.encode(n.Mavlink,s.uint32(138).fork()).ldelim(),n.SimplePeerSignal!=null&&Object.hasOwnProperty.call(n,"SimplePeerSignal")&&$root.rov_actions_proto.SimplePeerSignalResponse.encode(n.SimplePeerSignal,s.uint32(146).fork()).ldelim(),n.SystemMonitor!=null&&Object.hasOwnProperty.call(n,"SystemMonitor")&&$root.rov_actions_proto.SystemMonitorResponse.encode(n.SystemMonitor,s.uint32(154).fork()).ldelim(),n.LogMessage!=null&&Object.hasOwnProperty.call(n,"LogMessage")&&$root.rov_actions_proto.LogMessageResponse.encode(n.LogMessage,s.uint32(162).fork()).ldelim(),n.LivekitVideoStats!=null&&Object.hasOwnProperty.call(n,"LivekitVideoStats")&&$root.rov_actions_proto.LivekitVideoStatsResponse.encode(n.LivekitVideoStats,s.uint32(170).fork()).ldelim(),n.SimplePeerVideoStats!=null&&Object.hasOwnProperty.call(n,"SimplePeerVideoStats")&&$root.rov_actions_proto.SimplePeerVideoStatsResponse.encode(n.SimplePeerVideoStats,s.uint32(178).fork()).ldelim(),s},t.encodeDelimited=function(n,s){return this.encode(n,s).ldelim()},t.decode=function(n,s){n instanceof $Reader||(n=$Reader.create(n));let c=s===void 0?n.len:n.pos+s,l=new $root.rov_actions_proto.RovResponse;for(;n.pos<c;){let u=n.uint32();switch(u>>>3){case 1:{l.BackendMetadata=$root.rov_actions_proto.ResponseBackendMetadata.decode(n,n.uint32());break}case 2:{l.ExchangeId=n.int32();break}case 3:{l.Done=$root.rov_actions_proto.DoneResponse.decode(n,n.uint32());break}case 4:{l.Error=$root.rov_actions_proto.ErrorResponse.decode(n,n.uint32());break}case 5:{l.Pong=$root.rov_actions_proto.PongResponse.decode(n,n.uint32());break}case 6:{l.ContinuedOutput=$root.rov_actions_proto.ContinuedOutputResponse.decode(n,n.uint32());break}case 7:{l.SensorUpdates=$root.rov_actions_proto.SensorUpdatesResponse.decode(n,n.uint32());break}case 8:{l.PasswordRequired=$root.rov_actions_proto.PasswordRequiredResponse.decode(n,n.uint32());break}case 9:{l.PasswordAccepted=$root.rov_actions_proto.PasswordAcceptedResponse.decode(n,n.uint32());break}case 10:{l.PasswordInvalid=$root.rov_actions_proto.PasswordInvalidResponse.decode(n,n.uint32());break}case 13:{l.PilotChanged=$root.rov_actions_proto.PilotChangedResponse.decode(n,n.uint32());break}case 14:{l.ClientConnected=$root.rov_actions_proto.ClientConnectedResponse.decode(n,n.uint32());break}case 15:{l.ClientDisconnected=$root.rov_actions_proto.ClientDisconnectedResponse.decode(n,n.uint32());break}case 16:{l.Heartbeat=$root.rov_actions_proto.HeartbeatResponse.decode(n,n.uint32());break}case 17:{l.Mavlink=$root.rov_actions_proto.MavlinkResponse.decode(n,n.uint32());break}case 18:{l.SimplePeerSignal=$root.rov_actions_proto.SimplePeerSignalResponse.decode(n,n.uint32());break}case 19:{l.SystemMonitor=$root.rov_actions_proto.SystemMonitorResponse.decode(n,n.uint32());break}case 20:{l.LogMessage=$root.rov_actions_proto.LogMessageResponse.decode(n,n.uint32());break}case 21:{l.LivekitVideoStats=$root.rov_actions_proto.LivekitVideoStatsResponse.decode(n,n.uint32());break}case 22:{l.SimplePeerVideoStats=$root.rov_actions_proto.SimplePeerVideoStatsResponse.decode(n,n.uint32());break}default:n.skipType(u&7);break}}return l},t.decodeDelimited=function(n){return n instanceof $Reader||(n=new $Reader(n)),this.decode(n,n.uint32())},t.verify=function(n){if(typeof n!="object"||n===null)return"object expected";let s={};if(n.BackendMetadata!=null&&n.hasOwnProperty("BackendMetadata")){let c=$root.rov_actions_proto.ResponseBackendMetadata.verify(n.BackendMetadata);if(c)return"BackendMetadata."+c}if(n.ExchangeId!=null&&n.hasOwnProperty("ExchangeId")&&!$util.isInteger(n.ExchangeId))return"ExchangeId: integer expected";if(n.Done!=null&&n.hasOwnProperty("Done")){s.Body=1;{let c=$root.rov_actions_proto.DoneResponse.verify(n.Done);if(c)return"Done."+c}}if(n.Error!=null&&n.hasOwnProperty("Error")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.ErrorResponse.verify(n.Error);if(c)return"Error."+c}}if(n.Pong!=null&&n.hasOwnProperty("Pong")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.PongResponse.verify(n.Pong);if(c)return"Pong."+c}}if(n.ContinuedOutput!=null&&n.hasOwnProperty("ContinuedOutput")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.ContinuedOutputResponse.verify(n.ContinuedOutput);if(c)return"ContinuedOutput."+c}}if(n.SensorUpdates!=null&&n.hasOwnProperty("SensorUpdates")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.SensorUpdatesResponse.verify(n.SensorUpdates);if(c)return"SensorUpdates."+c}}if(n.PasswordRequired!=null&&n.hasOwnProperty("PasswordRequired")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.PasswordRequiredResponse.verify(n.PasswordRequired);if(c)return"PasswordRequired."+c}}if(n.PasswordAccepted!=null&&n.hasOwnProperty("PasswordAccepted")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.PasswordAcceptedResponse.verify(n.PasswordAccepted);if(c)return"PasswordAccepted."+c}}if(n.PasswordInvalid!=null&&n.hasOwnProperty("PasswordInvalid")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.PasswordInvalidResponse.verify(n.PasswordInvalid);if(c)return"PasswordInvalid."+c}}if(n.PilotChanged!=null&&n.hasOwnProperty("PilotChanged")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.PilotChangedResponse.verify(n.PilotChanged);if(c)return"PilotChanged."+c}}if(n.ClientConnected!=null&&n.hasOwnProperty("ClientConnected")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.ClientConnectedResponse.verify(n.ClientConnected);if(c)return"ClientConnected."+c}}if(n.ClientDisconnected!=null&&n.hasOwnProperty("ClientDisconnected")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.ClientDisconnectedResponse.verify(n.ClientDisconnected);if(c)return"ClientDisconnected."+c}}if(n.Heartbeat!=null&&n.hasOwnProperty("Heartbeat")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.HeartbeatResponse.verify(n.Heartbeat);if(c)return"Heartbeat."+c}}if(n.Mavlink!=null&&n.hasOwnProperty("Mavlink")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.MavlinkResponse.verify(n.Mavlink);if(c)return"Mavlink."+c}}if(n.SimplePeerSignal!=null&&n.hasOwnProperty("SimplePeerSignal")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.SimplePeerSignalResponse.verify(n.SimplePeerSignal);if(c)return"SimplePeerSignal."+c}}if(n.SystemMonitor!=null&&n.hasOwnProperty("SystemMonitor")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.SystemMonitorResponse.verify(n.SystemMonitor);if(c)return"SystemMonitor."+c}}if(n.LogMessage!=null&&n.hasOwnProperty("LogMessage")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.LogMessageResponse.verify(n.LogMessage);if(c)return"LogMessage."+c}}if(n.LivekitVideoStats!=null&&n.hasOwnProperty("LivekitVideoStats")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.LivekitVideoStatsResponse.verify(n.LivekitVideoStats);if(c)return"LivekitVideoStats."+c}}if(n.SimplePeerVideoStats!=null&&n.hasOwnProperty("SimplePeerVideoStats")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let c=$root.rov_actions_proto.SimplePeerVideoStatsResponse.verify(n.SimplePeerVideoStats);if(c)return"SimplePeerVideoStats."+c}}return null},t.fromObject=function(n){if(n instanceof $root.rov_actions_proto.RovResponse)return n;let s=new $root.rov_actions_proto.RovResponse;if(n.BackendMetadata!=null){if(typeof n.BackendMetadata!="object")throw TypeError(".rov_actions_proto.RovResponse.BackendMetadata: object expected");s.BackendMetadata=$root.rov_actions_proto.ResponseBackendMetadata.fromObject(n.BackendMetadata)}if(n.ExchangeId!=null&&(s.ExchangeId=n.ExchangeId|0),n.Done!=null){if(typeof n.Done!="object")throw TypeError(".rov_actions_proto.RovResponse.Done: object expected");s.Done=$root.rov_actions_proto.DoneResponse.fromObject(n.Done)}if(n.Error!=null){if(typeof n.Error!="object")throw TypeError(".rov_actions_proto.RovResponse.Error: object expected");s.Error=$root.rov_actions_proto.ErrorResponse.fromObject(n.Error)}if(n.Pong!=null){if(typeof n.Pong!="object")throw TypeError(".rov_actions_proto.RovResponse.Pong: object expected");s.Pong=$root.rov_actions_proto.PongResponse.fromObject(n.Pong)}if(n.ContinuedOutput!=null){if(typeof n.ContinuedOutput!="object")throw TypeError(".rov_actions_proto.RovResponse.ContinuedOutput: object expected");s.ContinuedOutput=$root.rov_actions_proto.ContinuedOutputResponse.fromObject(n.ContinuedOutput)}if(n.SensorUpdates!=null){if(typeof n.SensorUpdates!="object")throw TypeError(".rov_actions_proto.RovResponse.SensorUpdates: object expected");s.SensorUpdates=$root.rov_actions_proto.SensorUpdatesResponse.fromObject(n.SensorUpdates)}if(n.PasswordRequired!=null){if(typeof n.PasswordRequired!="object")throw TypeError(".rov_actions_proto.RovResponse.PasswordRequired: object expected");s.PasswordRequired=$root.rov_actions_proto.PasswordRequiredResponse.fromObject(n.PasswordRequired)}if(n.PasswordAccepted!=null){if(typeof n.PasswordAccepted!="object")throw TypeError(".rov_actions_proto.RovResponse.PasswordAccepted: object expected");s.PasswordAccepted=$root.rov_actions_proto.PasswordAcceptedResponse.fromObject(n.PasswordAccepted)}if(n.PasswordInvalid!=null){if(typeof n.PasswordInvalid!="object")throw TypeError(".rov_actions_proto.RovResponse.PasswordInvalid: object expected");s.PasswordInvalid=$root.rov_actions_proto.PasswordInvalidResponse.fromObject(n.PasswordInvalid)}if(n.PilotChanged!=null){if(typeof n.PilotChanged!="object")throw TypeError(".rov_actions_proto.RovResponse.PilotChanged: object expected");s.PilotChanged=$root.rov_actions_proto.PilotChangedResponse.fromObject(n.PilotChanged)}if(n.ClientConnected!=null){if(typeof n.ClientConnected!="object")throw TypeError(".rov_actions_proto.RovResponse.ClientConnected: object expected");s.ClientConnected=$root.rov_actions_proto.ClientConnectedResponse.fromObject(n.ClientConnected)}if(n.ClientDisconnected!=null){if(typeof n.ClientDisconnected!="object")throw TypeError(".rov_actions_proto.RovResponse.ClientDisconnected: object expected");s.ClientDisconnected=$root.rov_actions_proto.ClientDisconnectedResponse.fromObject(n.ClientDisconnected)}if(n.Heartbeat!=null){if(typeof n.Heartbeat!="object")throw TypeError(".rov_actions_proto.RovResponse.Heartbeat: object expected");s.Heartbeat=$root.rov_actions_proto.HeartbeatResponse.fromObject(n.Heartbeat)}if(n.Mavlink!=null){if(typeof n.Mavlink!="object")throw TypeError(".rov_actions_proto.RovResponse.Mavlink: object expected");s.Mavlink=$root.rov_actions_proto.MavlinkResponse.fromObject(n.Mavlink)}if(n.SimplePeerSignal!=null){if(typeof n.SimplePeerSignal!="object")throw TypeError(".rov_actions_proto.RovResponse.SimplePeerSignal: object expected");s.SimplePeerSignal=$root.rov_actions_proto.SimplePeerSignalResponse.fromObject(n.SimplePeerSignal)}if(n.SystemMonitor!=null){if(typeof n.SystemMonitor!="object")throw TypeError(".rov_actions_proto.RovResponse.SystemMonitor: object expected");s.SystemMonitor=$root.rov_actions_proto.SystemMonitorResponse.fromObject(n.SystemMonitor)}if(n.LogMessage!=null){if(typeof n.LogMessage!="object")throw TypeError(".rov_actions_proto.RovResponse.LogMessage: object expected");s.LogMessage=$root.rov_actions_proto.LogMessageResponse.fromObject(n.LogMessage)}if(n.LivekitVideoStats!=null){if(typeof n.LivekitVideoStats!="object")throw TypeError(".rov_actions_proto.RovResponse.LivekitVideoStats: object expected");s.LivekitVideoStats=$root.rov_actions_proto.LivekitVideoStatsResponse.fromObject(n.LivekitVideoStats)}if(n.SimplePeerVideoStats!=null){if(typeof n.SimplePeerVideoStats!="object")throw TypeError(".rov_actions_proto.RovResponse.SimplePeerVideoStats: object expected");s.SimplePeerVideoStats=$root.rov_actions_proto.SimplePeerVideoStatsResponse.fromObject(n.SimplePeerVideoStats)}return s},t.toObject=function(n,s){s||(s={});let c={};return s.defaults&&(c.BackendMetadata=null,c.ExchangeId=0),n.BackendMetadata!=null&&n.hasOwnProperty("BackendMetadata")&&(c.BackendMetadata=$root.rov_actions_proto.ResponseBackendMetadata.toObject(n.BackendMetadata,s)),n.ExchangeId!=null&&n.hasOwnProperty("ExchangeId")&&(c.ExchangeId=n.ExchangeId),n.Done!=null&&n.hasOwnProperty("Done")&&(c.Done=$root.rov_actions_proto.DoneResponse.toObject(n.Done,s),s.oneofs&&(c.Body="Done")),n.Error!=null&&n.hasOwnProperty("Error")&&(c.Error=$root.rov_actions_proto.ErrorResponse.toObject(n.Error,s),s.oneofs&&(c.Body="Error")),n.Pong!=null&&n.hasOwnProperty("Pong")&&(c.Pong=$root.rov_actions_proto.PongResponse.toObject(n.Pong,s),s.oneofs&&(c.Body="Pong")),n.ContinuedOutput!=null&&n.hasOwnProperty("ContinuedOutput")&&(c.ContinuedOutput=$root.rov_actions_proto.ContinuedOutputResponse.toObject(n.ContinuedOutput,s),s.oneofs&&(c.Body="ContinuedOutput")),n.SensorUpdates!=null&&n.hasOwnProperty("SensorUpdates")&&(c.SensorUpdates=$root.rov_actions_proto.SensorUpdatesResponse.toObject(n.SensorUpdates,s),s.oneofs&&(c.Body="SensorUpdates")),n.PasswordRequired!=null&&n.hasOwnProperty("PasswordRequired")&&(c.PasswordRequired=$root.rov_actions_proto.PasswordRequiredResponse.toObject(n.PasswordRequired,s),s.oneofs&&(c.Body="PasswordRequired")),n.PasswordAccepted!=null&&n.hasOwnProperty("PasswordAccepted")&&(c.PasswordAccepted=$root.rov_actions_proto.PasswordAcceptedResponse.toObject(n.PasswordAccepted,s),s.oneofs&&(c.Body="PasswordAccepted")),n.PasswordInvalid!=null&&n.hasOwnProperty("PasswordInvalid")&&(c.PasswordInvalid=$root.rov_actions_proto.PasswordInvalidResponse.toObject(n.PasswordInvalid,s),s.oneofs&&(c.Body="PasswordInvalid")),n.PilotChanged!=null&&n.hasOwnProperty("PilotChanged")&&(c.PilotChanged=$root.rov_actions_proto.PilotChangedResponse.toObject(n.PilotChanged,s),s.oneofs&&(c.Body="PilotChanged")),n.ClientConnected!=null&&n.hasOwnProperty("ClientConnected")&&(c.ClientConnected=$root.rov_actions_proto.ClientConnectedResponse.toObject(n.ClientConnected,s),s.oneofs&&(c.Body="ClientConnected")),n.ClientDisconnected!=null&&n.hasOwnProperty("ClientDisconnected")&&(c.ClientDisconnected=$root.rov_actions_proto.ClientDisconnectedResponse.toObject(n.ClientDisconnected,s),s.oneofs&&(c.Body="ClientDisconnected")),n.Heartbeat!=null&&n.hasOwnProperty("Heartbeat")&&(c.Heartbeat=$root.rov_actions_proto.HeartbeatResponse.toObject(n.Heartbeat,s),s.oneofs&&(c.Body="Heartbeat")),n.Mavlink!=null&&n.hasOwnProperty("Mavlink")&&(c.Mavlink=$root.rov_actions_proto.MavlinkResponse.toObject(n.Mavlink,s),s.oneofs&&(c.Body="Mavlink")),n.SimplePeerSignal!=null&&n.hasOwnProperty("SimplePeerSignal")&&(c.SimplePeerSignal=$root.rov_actions_proto.SimplePeerSignalResponse.toObject(n.SimplePeerSignal,s),s.oneofs&&(c.Body="SimplePeerSignal")),n.SystemMonitor!=null&&n.hasOwnProperty("SystemMonitor")&&(c.SystemMonitor=$root.rov_actions_proto.SystemMonitorResponse.toObject(n.SystemMonitor,s),s.oneofs&&(c.Body="SystemMonitor")),n.LogMessage!=null&&n.hasOwnProperty("LogMessage")&&(c.LogMessage=$root.rov_actions_proto.LogMessageResponse.toObject(n.LogMessage,s),s.oneofs&&(c.Body="LogMessage")),n.LivekitVideoStats!=null&&n.hasOwnProperty("LivekitVideoStats")&&(c.LivekitVideoStats=$root.rov_actions_proto.LivekitVideoStatsResponse.toObject(n.LivekitVideoStats,s),s.oneofs&&(c.Body="LivekitVideoStats")),n.SimplePeerVideoStats!=null&&n.hasOwnProperty("SimplePeerVideoStats")&&(c.SimplePeerVideoStats=$root.rov_actions_proto.SimplePeerVideoStatsResponse.toObject(n.SimplePeerVideoStats,s),s.oneofs&&(c.Body="SimplePeerVideoStats")),c},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(n){return n===void 0&&(n="type.googleapis.com"),n+"/rov_actions_proto.RovResponse"},t}(),a})(),VITEBUILD_EXTRANIOUS_PATH="/@fs/Users/ky/Documents/Github/rov-web";var LogLevelConsole=(a=>(a[a.Info=rov_actions_proto.LogLevel.Info]="Info",a[a.Warn=rov_actions_proto.LogLevel.Warning]="Warn",a[a.Error=rov_actions_proto.LogLevel.Error]="Error",a[a.Debug=rov_actions_proto.LogLevel.Debug]="Debug",a[a.Console=4]="Console",a))(LogLevelConsole||{}),LogOrigin=(a=>(a[a.ROV=0]="ROV",a[a.PILOT=1]="PILOT",a))(LogOrigin||{});class Logger{constructor(t=1){q(this,"logsStore",[]);q(this,"sendLogsCallback");q(this,"rootURL");q(this,"sendLogsAllowed",!1);q(this,"sendLogsInterval");q(this,"rawConsole");q(this,"defaultLogOrigin");q(this,"svelteSubscribers",[]);const{log:o,debug:e,warn:n,error:s,info:c}=console;this.rawConsole={log:o,debug:e,warn:n,error:s,info:c},this.rootURL=window.location.protocol+"//"+window.location.host,this.defaultLogOrigin=t,console.log("Logger initialized",this.rootURL),window.addEventListener("error",l=>{if(!l)return;const u=[l.error?l.error:"",l.message,l.filename+":"+l.lineno+":"+l.colno];this.addLog(LogLevelConsole.Error,u,[],0,this.defaultLogOrigin)})}subscribe(t){this.svelteSubscribers.push(t),t()}sendLogs(t){this.sendQueuedLogs(t)}sendQueuedLogs(t){if(!this.sendLogsAllowed)return;const o=this.logsStore.filter(e=>!e.sentToRemote);return o.forEach(e=>{e.sentToRemote=!0}),Promise.allSettled(o.map(e=>{const n=mainLogr.logToJson(e);return t(e.level,n)})).then(e=>{const n=[];for(let s=0;s<e.length;s++){const c=e[s];c&&c.status=="fulfilled"&&c.value==!0?this.logsStore[s].sentToRemote=!0:(this.logsStore[s].sentToRemote=!1,n.push({log:this.logsStore[s],result:c}))}return n.length>0&&console.warn("Failed to send some logs.",n),n.length})}addLog(t,o,e=[],n=0,s=this.defaultLogOrigin,c=Date.now(),l=!1){if(!e){const p=new Error().stack;e=p?p.split(`
`).slice(3).map(g=>g.replace(this.rootURL,"").replace(VITEBUILD_EXTRANIOUS_PATH,"").trim().slice(3)):[]}let u=this.logsStore.length;for(;u>0&&this.logsStore[u-1].timestamp>c;)u--;const d={timestamp:c,level:t,args:o,trace:e,sentToRemote:l,kind:n,origin:s};this.logsStore.splice(u,0,d),this.svelteSubscribers.forEach(p=>p())}logAddLevelFlair(t){const o=t.args;return typeof o[0]!="string"?o.unshift("****"):o[0]="**** "+o[0],{...t,args:o}}printLog(t){if(t.trace&&t.trace.length>0){const o=t.args[0],e=t.args.slice(1);e.push(t.trace.join(`
`)),console.groupCollapsed("%c"+o,this._getLevelColor(t.level)),this._consoleLogAtLevel(t.level,e),console.groupEnd()}else typeof t.args[0]!="string"&&t.args.unshift("****"),t.args[0]="%c "+t.args[0],t.args.splice(1,0,this._getLevelColor(t.level)),this._consoleLogAtLevel(t.level,t.args)}consoleRecentLogs(t=100){console.clear(),console.groupCollapsed("Recent Logs");const o=Math.max(this.logsStore.length-t,0);for(let e=this.logsStore.length-1;e>o;e--){const n=this.logsStore[e];this.printLog(n)}console.groupEnd()}printRecentLogs(t,o=1e3){t.innerHTML="";const e=Math.max(this.logsStore.length-o,0);for(let n=this.logsStore.length-1;n>e;n--){const s=this.logsStore[n],[c,l]=this.logToText(s),u=document.createElement("div");u.innerHTML=`<details style="font-size: 1.1em; font-weight: bold; padding: 0.2em; ${this._getLevelColor(s.level)}"><summary><small>${s.timestamp} </small> <span>${c}</span></summary><pre>${l}</pre></details>`,t.appendChild(u)}}_makeJsonEncodable(t,o=0){if(o>5)return"Max recursion level reached";const e=typeof t;if(e==="string"||e==="number"||e==="boolean")return t;if(t===void 0)return"undefined";if(t===null)return null;if(t instanceof Error)return{instanceOf:e,name:t.name,errMessage:t.message,stack:t.stack,cause:t.cause};if(t instanceof Date)return t.toISOString();if(t instanceof Map){const n={};return t.forEach((s,c)=>{n[c]=this._makeJsonEncodable(s,o+1)}),{instanceof:e,value:n}}else if(t instanceof Set){let n=Array.from(t).map(s=>this._makeJsonEncodable(s,o+1));return{instanceof:e,value:n}}else{if(t instanceof Array||t instanceof Uint8Array||t instanceof Int8Array||t instanceof Uint16Array||t instanceof Int16Array||t instanceof Uint32Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array)return t.map(n=>this._makeJsonEncodable(n,o+1));if(t instanceof Object){const n={};for(const s in t)t.hasOwnProperty(s)&&(n[s]=this._makeJsonEncodable(t[s],o+1));return n}else try{return t.toString()}catch(n){return{instanceof:e,value:"Failed to stringify: "+n.message}}}}logToJson(t){const{timestamp:o,args:e,trace:n,origin:s,kind:c,level:l}=t;return JSON.stringify(this._makeJsonEncodable({level:l,timestamp:o,args:e,trace:n,origin:s,kind:c}))}logToText(t){let o="",e="",n=0;for(;n<t.args.length;n++){const s=t.args[n];try{if(s===null)o+=" null";else if(s===void 0)o+=" undefined";else if(s instanceof Error)o+=s.name+" "+s.message+" "+s.cause,e+=s.stack;else if(s instanceof Object){e+=`
`+JSON.stringify(s,null,2)+`
`;break}else o+=" "+s.toString()}catch(c){e+=" STRINGFAIL:"+typeof s+" ",console.error("Failed to stringify logs arg: "+c.message,typeof s,s)}}for(;n<t.args.length;n++){const s=t.args[n];try{s===null?e+=" null":s===void 0?e+=" undefined":s instanceof Error?e+=s.name+" "+s.message+" "+s.cause+`
`+s.stack:s instanceof Object?e+=`
`+JSON.stringify(s,null,2)+`
`:e+=" "+s.toString()}catch(c){e+=" STRINGFAIL:"+typeof s+" ",console.error("Failed to stringify logs arg: "+c.message,typeof s,s)}}return t.trace&&t.trace.length>0&&(e+=`
`+t.trace.join(`
`)),[o,e]}_consoleLogAtLevel(t,o,e=[]){t===LogLevelConsole.Debug?this.rawConsole.debug.apply(console,o):t===LogLevelConsole.Warn?this.rawConsole.warn.apply(console,o):t===LogLevelConsole.Error?this.rawConsole.error.apply(console,o):t===LogLevelConsole.Info&&this.rawConsole.info.apply(console,o)}_getLevelColor(t){if(t===LogLevelConsole.Debug)return"color: #008888";if(t===LogLevelConsole.Warn)return"color: #888800";if(t===LogLevelConsole.Error)return"color: #880000";if(t===LogLevelConsole.Info)return"color: #000088";if(t===4)return"color: #000000"}_getLevelIcon(t){if(t===LogLevelConsole.Debug)return"🐛";if(t===LogLevelConsole.Warn)return"🟨";if(t===LogLevelConsole.Error)return"🛑";if(t===LogLevelConsole.Info)return"ℹ️";if(t===4)return"ℹ️"}getLogs(){return this.logsStore}log(...t){this.rawConsole.log.apply(console,t),this.addLog(4,t)}logDebug(...t){this.rawConsole.debug.apply(console,t),this.addLog(LogLevelConsole.Debug,t)}logWarn(...t){this.rawConsole.warn.apply(console,t),this.addLog(LogLevelConsole.Warn,t)}logError(...t){this.rawConsole.error.apply(console,t),this.addLog(LogLevelConsole.Error,t)}logInfo(...t){this.rawConsole.info.apply(console,t),this.addLog(LogLevelConsole.Info,t)}}const mainLogr=new Logger,logDebug=mainLogr.logDebug.bind(mainLogr),logWarn=mainLogr.logWarn.bind(mainLogr),logError=mainLogr.logError.bind(mainLogr),logInfo=mainLogr.logInfo.bind(mainLogr),log=mainLogr.log.bind(mainLogr);export{ConnectionStates as C,DECODE_TXT as D,ENCODE_TXT as E,FRONTEND_HANDLED_MAVLINK_MESSAGE_TYPES as F,LogLevelConsole as L,MavState as M,ParticipantEvent as P,Room as R,SECONDS_IN_DAY as S,Track as T,MAVLinkType as a,MavType as b,MavAutopilot as c,MavModeFlag as d,log as e,logError as f,logDebug as g,dist as h,logInfo as i,LIVEKIT_BACKEND_ROOM_CONFIG as j,getDefaultExportFromCjs$1 as k,logWarn as l,mainLogr as m,RoomEvent as n,DisconnectReason as o,MediaDeviceFailure as p,LIVEKIT_BACKEND_ROOM_CONNECTION_CONFIG as q,rov_actions_proto as r,SIMPLEPEER_BASE_CONFIG as s,SIMPLEPEER_CAPTURE_CONFIG as t,LogOrigin as u};
//# sourceMappingURL=logging-e4d1f7e9.js.map
