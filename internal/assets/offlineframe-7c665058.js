import{D as f,e as a,E as g,l}from"./logging-5b632efc.js";var i=(e=>(e[e.openWebsocket=0]="openWebsocket",e[e.socketMsg=1]="socketMsg",e[e.outgoingHttpReq=2]="outgoingHttpReq",e[e.incomingHttpReq=3]="incomingHttpReq",e))(i||{});const w={},c={};let s;function y(e){s=e}function p(e){if(c[e])return c[e];const t=c[e]=new WebSocket(e);return t.binaryType="arraybuffer",t.addEventListener("message",n=>{let o=typeof n.data=="string"?g(n.data):n.data;const d=new Uint8Array(o);s&&s(g(JSON.stringify({type:i.socketMsg,body:new Array(...d),url:e})))}),t.addEventListener("error",n=>{l("ws err "+e,n)}),t.addEventListener("close",n=>{l("ws close "+e,n)}),t}function k(e,t){let n=c[e];n||(n=p(e)),n.readyState!==WebSocket.OPEN?(a("osending",f(t),n.readyState,WebSocket.OPEN),n.addEventListener("open",()=>n.send(t))):(a("sending"),n.send(t))}function m(e,t){if(w[e]!=null)return;(w[e]=fetch(e,t)).then(async o=>{a("fetch result",o);let d=new Uint8Array(await o.arrayBuffer());s&&s(g(JSON.stringify({type:i.outgoingHttpReq,result:o,body:new Array(...d),url:e})))}).catch(o=>{a("fetch err",o)})}function E(e){const t=JSON.parse(f(e));a("Received Proxy Message",t),t.type===i.openWebsocket?p(t.url):t.type===i.socketMsg?k(t.url,new Uint8Array(t.body)):t.type===i.incomingHttpReq&&m(t.url,JSON.parse(f(new Uint8Array(t.body))))}const r=document.createElement("iframe"),b=window.location.protocol.replace(":","")+"://"+window.location.host;r.src=b+"/frontend/index.html";r.setAttribute("sandbox","allow-scripts");r.onload=()=>{logInfo("iframe loaded")};document.body.appendChild(r);y(e=>{r.contentWindow.postMessage(e,b)});window.addEventListener("message",e=>{e.origin===b&&(log("Got message",e.data),E(e.data))});
//# sourceMappingURL=offlineframe-7c665058.js.map
