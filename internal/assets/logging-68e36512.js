var Ce=Object.defineProperty;var Re=(s,t,o)=>t in s?Ce(s,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[t]=o;var q=(s,t,o)=>(Re(s,typeof t!="symbol"?t+"":t,o),o);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&e(c)}).observe(document,{childList:!0,subtree:!0});function o(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function e(n){if(n.ep)return;n.ep=!0;const a=o(n);fetch(n.href,a)}})();var commonjsGlobal$1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs$1(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var dist={},buffer={},base64Js={};base64Js.byteLength=byteLength;base64Js.toByteArray=toByteArray;base64Js.fromByteArray=fromByteArray;var lookup=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function getLens(s){var t=s.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var o=s.indexOf("=");o===-1&&(o=t);var e=o===t?0:4-o%4;return[o,e]}function byteLength(s){var t=getLens(s),o=t[0],e=t[1];return(o+e)*3/4-e}function _byteLength(s,t,o){return(t+o)*3/4-o}function toByteArray(s){var t,o=getLens(s),e=o[0],n=o[1],a=new Arr(_byteLength(s,e,n)),c=0,l=n>0?e-4:e,u;for(u=0;u<l;u+=4)t=revLookup[s.charCodeAt(u)]<<18|revLookup[s.charCodeAt(u+1)]<<12|revLookup[s.charCodeAt(u+2)]<<6|revLookup[s.charCodeAt(u+3)],a[c++]=t>>16&255,a[c++]=t>>8&255,a[c++]=t&255;return n===2&&(t=revLookup[s.charCodeAt(u)]<<2|revLookup[s.charCodeAt(u+1)]>>4,a[c++]=t&255),n===1&&(t=revLookup[s.charCodeAt(u)]<<10|revLookup[s.charCodeAt(u+1)]<<4|revLookup[s.charCodeAt(u+2)]>>2,a[c++]=t>>8&255,a[c++]=t&255),a}function tripletToBase64(s){return lookup[s>>18&63]+lookup[s>>12&63]+lookup[s>>6&63]+lookup[s&63]}function encodeChunk(s,t,o){for(var e,n=[],a=t;a<o;a+=3)e=(s[a]<<16&16711680)+(s[a+1]<<8&65280)+(s[a+2]&255),n.push(tripletToBase64(e));return n.join("")}function fromByteArray(s){for(var t,o=s.length,e=o%3,n=[],a=16383,c=0,l=o-e;c<l;c+=a)n.push(encodeChunk(s,c,c+a>l?l:c+a));return e===1?(t=s[o-1],n.push(lookup[t>>2]+lookup[t<<4&63]+"==")):e===2&&(t=(s[o-2]<<8)+s[o-1],n.push(lookup[t>>10]+lookup[t>>4&63]+lookup[t<<2&63]+"=")),n.join("")}var ieee754={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ieee754.read=function(s,t,o,e,n){var a,c,l=n*8-e-1,u=(1<<l)-1,d=u>>1,p=-7,g=o?n-1:0,S=o?-1:1,y=s[t+g];for(g+=S,a=y&(1<<-p)-1,y>>=-p,p+=l;p>0;a=a*256+s[t+g],g+=S,p-=8);for(c=a&(1<<-p)-1,a>>=-p,p+=e;p>0;c=c*256+s[t+g],g+=S,p-=8);if(a===0)a=1-d;else{if(a===u)return c?NaN:(y?-1:1)*(1/0);c=c+Math.pow(2,e),a=a-d}return(y?-1:1)*c*Math.pow(2,a-e)};ieee754.write=function(s,t,o,e,n,a){var c,l,u,d=a*8-n-1,p=(1<<d)-1,g=p>>1,S=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,y=e?0:a-1,b=e?1:-1,k=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(l=isNaN(t)?1:0,c=p):(c=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-c))<1&&(c--,u*=2),c+g>=1?t+=S/u:t+=S*Math.pow(2,1-g),t*u>=2&&(c++,u/=2),c+g>=p?(l=0,c=p):c+g>=1?(l=(t*u-1)*Math.pow(2,n),c=c+g):(l=t*Math.pow(2,g-1)*Math.pow(2,n),c=0));n>=8;s[o+y]=l&255,y+=b,l/=256,n-=8);for(c=c<<n|l,d+=n;d>0;s[o+y]=c&255,y+=b,c/=256,d-=8);s[o+y-b]|=k*128};/*!
* The buffer module from node.js, for the browser.
*
* @author   Feross Aboukhadijeh <https://feross.org>
* @license  MIT
*/(function(s){const t=base64Js,o=ieee754,e=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;s.Buffer=l,s.SlowBuffer=N,s.INSPECT_MAX_BYTES=50;const n=2147483647;s.kMaxLength=n,l.TYPED_ARRAY_SUPPORT=a(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function a(){try{const m=new Uint8Array(1),f={foo:function(){return 42}};return Object.setPrototypeOf(f,Uint8Array.prototype),Object.setPrototypeOf(m,f),m.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function c(m){if(m>n)throw new RangeError('The value "'+m+'" is invalid for option "size"');const f=new Uint8Array(m);return Object.setPrototypeOf(f,l.prototype),f}function l(m,f,h){if(typeof m=="number"){if(typeof f=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return g(m)}return u(m,f,h)}l.poolSize=8192;function u(m,f,h){if(typeof m=="string")return S(m,f);if(ArrayBuffer.isView(m))return b(m);if(m==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof m);if(G(m,ArrayBuffer)||m&&G(m.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(G(m,SharedArrayBuffer)||m&&G(m.buffer,SharedArrayBuffer)))return k(m,f,h);if(typeof m=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const v=m.valueOf&&m.valueOf();if(v!=null&&v!==m)return l.from(v,f,h);const T=O(m);if(T)return T;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof m[Symbol.toPrimitive]=="function")return l.from(m[Symbol.toPrimitive]("string"),f,h);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof m)}l.from=function(m,f,h){return u(m,f,h)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array);function d(m){if(typeof m!="number")throw new TypeError('"size" argument must be of type number');if(m<0)throw new RangeError('The value "'+m+'" is invalid for option "size"')}function p(m,f,h){return d(m),m<=0?c(m):f!==void 0?typeof h=="string"?c(m).fill(f,h):c(m).fill(f):c(m)}l.alloc=function(m,f,h){return p(m,f,h)};function g(m){return d(m),c(m<0?0:C(m)|0)}l.allocUnsafe=function(m){return g(m)},l.allocUnsafeSlow=function(m){return g(m)};function S(m,f){if((typeof f!="string"||f==="")&&(f="utf8"),!l.isEncoding(f))throw new TypeError("Unknown encoding: "+f);const h=x(m,f)|0;let v=c(h);const T=v.write(m,f);return T!==h&&(v=v.slice(0,T)),v}function y(m){const f=m.length<0?0:C(m.length)|0,h=c(f);for(let v=0;v<f;v+=1)h[v]=m[v]&255;return h}function b(m){if(G(m,Uint8Array)){const f=new Uint8Array(m);return k(f.buffer,f.byteOffset,f.byteLength)}return y(m)}function k(m,f,h){if(f<0||m.byteLength<f)throw new RangeError('"offset" is outside of buffer bounds');if(m.byteLength<f+(h||0))throw new RangeError('"length" is outside of buffer bounds');let v;return f===void 0&&h===void 0?v=new Uint8Array(m):h===void 0?v=new Uint8Array(m,f):v=new Uint8Array(m,f,h),Object.setPrototypeOf(v,l.prototype),v}function O(m){if(l.isBuffer(m)){const f=C(m.length)|0,h=c(f);return h.length===0||m.copy(h,0,0,f),h}if(m.length!==void 0)return typeof m.length!="number"||oe(m.length)?c(0):y(m);if(m.type==="Buffer"&&Array.isArray(m.data))return y(m.data)}function C(m){if(m>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return m|0}function N(m){return+m!=m&&(m=0),l.alloc(+m)}l.isBuffer=function(f){return f!=null&&f._isBuffer===!0&&f!==l.prototype},l.compare=function(f,h){if(G(f,Uint8Array)&&(f=l.from(f,f.offset,f.byteLength)),G(h,Uint8Array)&&(h=l.from(h,h.offset,h.byteLength)),!l.isBuffer(f)||!l.isBuffer(h))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(f===h)return 0;let v=f.length,T=h.length;for(let _=0,E=Math.min(v,T);_<E;++_)if(f[_]!==h[_]){v=f[_],T=h[_];break}return v<T?-1:T<v?1:0},l.isEncoding=function(f){switch(String(f).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(f,h){if(!Array.isArray(f))throw new TypeError('"list" argument must be an Array of Buffers');if(f.length===0)return l.alloc(0);let v;if(h===void 0)for(h=0,v=0;v<f.length;++v)h+=f[v].length;const T=l.allocUnsafe(h);let _=0;for(v=0;v<f.length;++v){let E=f[v];if(G(E,Uint8Array))_+E.length>T.length?(l.isBuffer(E)||(E=l.from(E)),E.copy(T,_)):Uint8Array.prototype.set.call(T,E,_);else if(l.isBuffer(E))E.copy(T,_);else throw new TypeError('"list" argument must be an Array of Buffers');_+=E.length}return T};function x(m,f){if(l.isBuffer(m))return m.length;if(ArrayBuffer.isView(m)||G(m,ArrayBuffer))return m.byteLength;if(typeof m!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof m);const h=m.length,v=arguments.length>2&&arguments[2]===!0;if(!v&&h===0)return 0;let T=!1;for(;;)switch(f){case"ascii":case"latin1":case"binary":return h;case"utf8":case"utf-8":return ie(m).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h*2;case"hex":return h>>>1;case"base64":return fe(m).length;default:if(T)return v?-1:ie(m).length;f=(""+f).toLowerCase(),T=!0}}l.byteLength=x;function U(m,f,h){let v=!1;if((f===void 0||f<0)&&(f=0),f>this.length||((h===void 0||h>this.length)&&(h=this.length),h<=0)||(h>>>=0,f>>>=0,h<=f))return"";for(m||(m="utf8");;)switch(m){case"hex":return ge(this,f,h);case"utf8":case"utf-8":return z(this,f,h);case"ascii":return pe(this,f,h);case"latin1":case"binary":return me(this,f,h);case"base64":return Y(this,f,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ve(this,f,h);default:if(v)throw new TypeError("Unknown encoding: "+m);m=(m+"").toLowerCase(),v=!0}}l.prototype._isBuffer=!0;function P(m,f,h){const v=m[f];m[f]=m[h],m[h]=v}l.prototype.swap16=function(){const f=this.length;if(f%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let h=0;h<f;h+=2)P(this,h,h+1);return this},l.prototype.swap32=function(){const f=this.length;if(f%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let h=0;h<f;h+=4)P(this,h,h+3),P(this,h+1,h+2);return this},l.prototype.swap64=function(){const f=this.length;if(f%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let h=0;h<f;h+=8)P(this,h,h+7),P(this,h+1,h+6),P(this,h+2,h+5),P(this,h+3,h+4);return this},l.prototype.toString=function(){const f=this.length;return f===0?"":arguments.length===0?z(this,0,f):U.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(f){if(!l.isBuffer(f))throw new TypeError("Argument must be a Buffer");return this===f?!0:l.compare(this,f)===0},l.prototype.inspect=function(){let f="";const h=s.INSPECT_MAX_BYTES;return f=this.toString("hex",0,h).replace(/(.{2})/g,"$1 ").trim(),this.length>h&&(f+=" ... "),"<Buffer "+f+">"},e&&(l.prototype[e]=l.prototype.inspect),l.prototype.compare=function(f,h,v,T,_){if(G(f,Uint8Array)&&(f=l.from(f,f.offset,f.byteLength)),!l.isBuffer(f))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof f);if(h===void 0&&(h=0),v===void 0&&(v=f?f.length:0),T===void 0&&(T=0),_===void 0&&(_=this.length),h<0||v>f.length||T<0||_>this.length)throw new RangeError("out of range index");if(T>=_&&h>=v)return 0;if(T>=_)return-1;if(h>=v)return 1;if(h>>>=0,v>>>=0,T>>>=0,_>>>=0,this===f)return 0;let E=_-T,w=v-h;const L=Math.min(E,w),D=this.slice(T,_),M=f.slice(h,v);for(let A=0;A<L;++A)if(D[A]!==M[A]){E=D[A],w=M[A];break}return E<w?-1:w<E?1:0};function F(m,f,h,v,T){if(m.length===0)return-1;if(typeof h=="string"?(v=h,h=0):h>2147483647?h=2147483647:h<-2147483648&&(h=-2147483648),h=+h,oe(h)&&(h=T?0:m.length-1),h<0&&(h=m.length+h),h>=m.length){if(T)return-1;h=m.length-1}else if(h<0)if(T)h=0;else return-1;if(typeof f=="string"&&(f=l.from(f,v)),l.isBuffer(f))return f.length===0?-1:j(m,f,h,v,T);if(typeof f=="number")return f=f&255,typeof Uint8Array.prototype.indexOf=="function"?T?Uint8Array.prototype.indexOf.call(m,f,h):Uint8Array.prototype.lastIndexOf.call(m,f,h):j(m,[f],h,v,T);throw new TypeError("val must be string, number or Buffer")}function j(m,f,h,v,T){let _=1,E=m.length,w=f.length;if(v!==void 0&&(v=String(v).toLowerCase(),v==="ucs2"||v==="ucs-2"||v==="utf16le"||v==="utf-16le")){if(m.length<2||f.length<2)return-1;_=2,E/=2,w/=2,h/=2}function L(M,A){return _===1?M[A]:M.readUInt16BE(A*_)}let D;if(T){let M=-1;for(D=h;D<E;D++)if(L(m,D)===L(f,M===-1?0:D-M)){if(M===-1&&(M=D),D-M+1===w)return M*_}else M!==-1&&(D-=D-M),M=-1}else for(h+w>E&&(h=E-w),D=h;D>=0;D--){let M=!0;for(let A=0;A<w;A++)if(L(m,D+A)!==L(f,A)){M=!1;break}if(M)return D}return-1}l.prototype.includes=function(f,h,v){return this.indexOf(f,h,v)!==-1},l.prototype.indexOf=function(f,h,v){return F(this,f,h,v,!0)},l.prototype.lastIndexOf=function(f,h,v){return F(this,f,h,v,!1)};function H(m,f,h,v){h=Number(h)||0;const T=m.length-h;v?(v=Number(v),v>T&&(v=T)):v=T;const _=f.length;v>_/2&&(v=_/2);let E;for(E=0;E<v;++E){const w=parseInt(f.substr(E*2,2),16);if(oe(w))return E;m[h+E]=w}return E}function W(m,f,h,v){return te(ie(f,m.length-h),m,h,v)}function Z(m,f,h,v){return te(_e(f),m,h,v)}function I(m,f,h,v){return te(fe(f),m,h,v)}function B(m,f,h,v){return te(be(f,m.length-h),m,h,v)}l.prototype.write=function(f,h,v,T){if(h===void 0)T="utf8",v=this.length,h=0;else if(v===void 0&&typeof h=="string")T=h,v=this.length,h=0;else if(isFinite(h))h=h>>>0,isFinite(v)?(v=v>>>0,T===void 0&&(T="utf8")):(T=v,v=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const _=this.length-h;if((v===void 0||v>_)&&(v=_),f.length>0&&(v<0||h<0)||h>this.length)throw new RangeError("Attempt to write outside buffer bounds");T||(T="utf8");let E=!1;for(;;)switch(T){case"hex":return H(this,f,h,v);case"utf8":case"utf-8":return W(this,f,h,v);case"ascii":case"latin1":case"binary":return Z(this,f,h,v);case"base64":return I(this,f,h,v);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,f,h,v);default:if(E)throw new TypeError("Unknown encoding: "+T);T=(""+T).toLowerCase(),E=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Y(m,f,h){return f===0&&h===m.length?t.fromByteArray(m):t.fromByteArray(m.slice(f,h))}function z(m,f,h){h=Math.min(m.length,h);const v=[];let T=f;for(;T<h;){const _=m[T];let E=null,w=_>239?4:_>223?3:_>191?2:1;if(T+w<=h){let L,D,M,A;switch(w){case 1:_<128&&(E=_);break;case 2:L=m[T+1],(L&192)===128&&(A=(_&31)<<6|L&63,A>127&&(E=A));break;case 3:L=m[T+1],D=m[T+2],(L&192)===128&&(D&192)===128&&(A=(_&15)<<12|(L&63)<<6|D&63,A>2047&&(A<55296||A>57343)&&(E=A));break;case 4:L=m[T+1],D=m[T+2],M=m[T+3],(L&192)===128&&(D&192)===128&&(M&192)===128&&(A=(_&15)<<18|(L&63)<<12|(D&63)<<6|M&63,A>65535&&A<1114112&&(E=A))}}E===null?(E=65533,w=1):E>65535&&(E-=65536,v.push(E>>>10&1023|55296),E=56320|E&1023),v.push(E),T+=w}return he(v)}const ee=4096;function he(m){const f=m.length;if(f<=ee)return String.fromCharCode.apply(String,m);let h="",v=0;for(;v<f;)h+=String.fromCharCode.apply(String,m.slice(v,v+=ee));return h}function pe(m,f,h){let v="";h=Math.min(m.length,h);for(let T=f;T<h;++T)v+=String.fromCharCode(m[T]&127);return v}function me(m,f,h){let v="";h=Math.min(m.length,h);for(let T=f;T<h;++T)v+=String.fromCharCode(m[T]);return v}function ge(m,f,h){const v=m.length;(!f||f<0)&&(f=0),(!h||h<0||h>v)&&(h=v);let T="";for(let _=f;_<h;++_)T+=Ee[m[_]];return T}function ve(m,f,h){const v=m.slice(f,h);let T="";for(let _=0;_<v.length-1;_+=2)T+=String.fromCharCode(v[_]+v[_+1]*256);return T}l.prototype.slice=function(f,h){const v=this.length;f=~~f,h=h===void 0?v:~~h,f<0?(f+=v,f<0&&(f=0)):f>v&&(f=v),h<0?(h+=v,h<0&&(h=0)):h>v&&(h=v),h<f&&(h=f);const T=this.subarray(f,h);return Object.setPrototypeOf(T,l.prototype),T};function $(m,f,h){if(m%1!==0||m<0)throw new RangeError("offset is not uint");if(m+f>h)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(f,h,v){f=f>>>0,h=h>>>0,v||$(f,h,this.length);let T=this[f],_=1,E=0;for(;++E<h&&(_*=256);)T+=this[f+E]*_;return T},l.prototype.readUintBE=l.prototype.readUIntBE=function(f,h,v){f=f>>>0,h=h>>>0,v||$(f,h,this.length);let T=this[f+--h],_=1;for(;h>0&&(_*=256);)T+=this[f+--h]*_;return T},l.prototype.readUint8=l.prototype.readUInt8=function(f,h){return f=f>>>0,h||$(f,1,this.length),this[f]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(f,h){return f=f>>>0,h||$(f,2,this.length),this[f]|this[f+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(f,h){return f=f>>>0,h||$(f,2,this.length),this[f]<<8|this[f+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(f,h){return f=f>>>0,h||$(f,4,this.length),(this[f]|this[f+1]<<8|this[f+2]<<16)+this[f+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(f,h){return f=f>>>0,h||$(f,4,this.length),this[f]*16777216+(this[f+1]<<16|this[f+2]<<8|this[f+3])},l.prototype.readBigUInt64LE=J(function(f){f=f>>>0,Q(f,"offset");const h=this[f],v=this[f+7];(h===void 0||v===void 0)&&X(f,this.length-8);const T=h+this[++f]*2**8+this[++f]*2**16+this[++f]*2**24,_=this[++f]+this[++f]*2**8+this[++f]*2**16+v*2**24;return BigInt(T)+(BigInt(_)<<BigInt(32))}),l.prototype.readBigUInt64BE=J(function(f){f=f>>>0,Q(f,"offset");const h=this[f],v=this[f+7];(h===void 0||v===void 0)&&X(f,this.length-8);const T=h*2**24+this[++f]*2**16+this[++f]*2**8+this[++f],_=this[++f]*2**24+this[++f]*2**16+this[++f]*2**8+v;return(BigInt(T)<<BigInt(32))+BigInt(_)}),l.prototype.readIntLE=function(f,h,v){f=f>>>0,h=h>>>0,v||$(f,h,this.length);let T=this[f],_=1,E=0;for(;++E<h&&(_*=256);)T+=this[f+E]*_;return _*=128,T>=_&&(T-=Math.pow(2,8*h)),T},l.prototype.readIntBE=function(f,h,v){f=f>>>0,h=h>>>0,v||$(f,h,this.length);let T=h,_=1,E=this[f+--T];for(;T>0&&(_*=256);)E+=this[f+--T]*_;return _*=128,E>=_&&(E-=Math.pow(2,8*h)),E},l.prototype.readInt8=function(f,h){return f=f>>>0,h||$(f,1,this.length),this[f]&128?(255-this[f]+1)*-1:this[f]},l.prototype.readInt16LE=function(f,h){f=f>>>0,h||$(f,2,this.length);const v=this[f]|this[f+1]<<8;return v&32768?v|4294901760:v},l.prototype.readInt16BE=function(f,h){f=f>>>0,h||$(f,2,this.length);const v=this[f+1]|this[f]<<8;return v&32768?v|4294901760:v},l.prototype.readInt32LE=function(f,h){return f=f>>>0,h||$(f,4,this.length),this[f]|this[f+1]<<8|this[f+2]<<16|this[f+3]<<24},l.prototype.readInt32BE=function(f,h){return f=f>>>0,h||$(f,4,this.length),this[f]<<24|this[f+1]<<16|this[f+2]<<8|this[f+3]},l.prototype.readBigInt64LE=J(function(f){f=f>>>0,Q(f,"offset");const h=this[f],v=this[f+7];(h===void 0||v===void 0)&&X(f,this.length-8);const T=this[f+4]+this[f+5]*2**8+this[f+6]*2**16+(v<<24);return(BigInt(T)<<BigInt(32))+BigInt(h+this[++f]*2**8+this[++f]*2**16+this[++f]*2**24)}),l.prototype.readBigInt64BE=J(function(f){f=f>>>0,Q(f,"offset");const h=this[f],v=this[f+7];(h===void 0||v===void 0)&&X(f,this.length-8);const T=(h<<24)+this[++f]*2**16+this[++f]*2**8+this[++f];return(BigInt(T)<<BigInt(32))+BigInt(this[++f]*2**24+this[++f]*2**16+this[++f]*2**8+v)}),l.prototype.readFloatLE=function(f,h){return f=f>>>0,h||$(f,4,this.length),o.read(this,f,!0,23,4)},l.prototype.readFloatBE=function(f,h){return f=f>>>0,h||$(f,4,this.length),o.read(this,f,!1,23,4)},l.prototype.readDoubleLE=function(f,h){return f=f>>>0,h||$(f,8,this.length),o.read(this,f,!0,52,8)},l.prototype.readDoubleBE=function(f,h){return f=f>>>0,h||$(f,8,this.length),o.read(this,f,!1,52,8)};function V(m,f,h,v,T,_){if(!l.isBuffer(m))throw new TypeError('"buffer" argument must be a Buffer instance');if(f>T||f<_)throw new RangeError('"value" argument is out of bounds');if(h+v>m.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(f,h,v,T){if(f=+f,h=h>>>0,v=v>>>0,!T){const w=Math.pow(2,8*v)-1;V(this,f,h,v,w,0)}let _=1,E=0;for(this[h]=f&255;++E<v&&(_*=256);)this[h+E]=f/_&255;return h+v},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(f,h,v,T){if(f=+f,h=h>>>0,v=v>>>0,!T){const w=Math.pow(2,8*v)-1;V(this,f,h,v,w,0)}let _=v-1,E=1;for(this[h+_]=f&255;--_>=0&&(E*=256);)this[h+_]=f/E&255;return h+v},l.prototype.writeUint8=l.prototype.writeUInt8=function(f,h,v){return f=+f,h=h>>>0,v||V(this,f,h,1,255,0),this[h]=f&255,h+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(f,h,v){return f=+f,h=h>>>0,v||V(this,f,h,2,65535,0),this[h]=f&255,this[h+1]=f>>>8,h+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(f,h,v){return f=+f,h=h>>>0,v||V(this,f,h,2,65535,0),this[h]=f>>>8,this[h+1]=f&255,h+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(f,h,v){return f=+f,h=h>>>0,v||V(this,f,h,4,4294967295,0),this[h+3]=f>>>24,this[h+2]=f>>>16,this[h+1]=f>>>8,this[h]=f&255,h+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(f,h,v){return f=+f,h=h>>>0,v||V(this,f,h,4,4294967295,0),this[h]=f>>>24,this[h+1]=f>>>16,this[h+2]=f>>>8,this[h+3]=f&255,h+4};function re(m,f,h,v,T){de(f,v,T,m,h,7);let _=Number(f&BigInt(4294967295));m[h++]=_,_=_>>8,m[h++]=_,_=_>>8,m[h++]=_,_=_>>8,m[h++]=_;let E=Number(f>>BigInt(32)&BigInt(4294967295));return m[h++]=E,E=E>>8,m[h++]=E,E=E>>8,m[h++]=E,E=E>>8,m[h++]=E,h}function se(m,f,h,v,T){de(f,v,T,m,h,7);let _=Number(f&BigInt(4294967295));m[h+7]=_,_=_>>8,m[h+6]=_,_=_>>8,m[h+5]=_,_=_>>8,m[h+4]=_;let E=Number(f>>BigInt(32)&BigInt(4294967295));return m[h+3]=E,E=E>>8,m[h+2]=E,E=E>>8,m[h+1]=E,E=E>>8,m[h]=E,h+8}l.prototype.writeBigUInt64LE=J(function(f,h=0){return re(this,f,h,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=J(function(f,h=0){return se(this,f,h,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(f,h,v,T){if(f=+f,h=h>>>0,!T){const L=Math.pow(2,8*v-1);V(this,f,h,v,L-1,-L)}let _=0,E=1,w=0;for(this[h]=f&255;++_<v&&(E*=256);)f<0&&w===0&&this[h+_-1]!==0&&(w=1),this[h+_]=(f/E>>0)-w&255;return h+v},l.prototype.writeIntBE=function(f,h,v,T){if(f=+f,h=h>>>0,!T){const L=Math.pow(2,8*v-1);V(this,f,h,v,L-1,-L)}let _=v-1,E=1,w=0;for(this[h+_]=f&255;--_>=0&&(E*=256);)f<0&&w===0&&this[h+_+1]!==0&&(w=1),this[h+_]=(f/E>>0)-w&255;return h+v},l.prototype.writeInt8=function(f,h,v){return f=+f,h=h>>>0,v||V(this,f,h,1,127,-128),f<0&&(f=255+f+1),this[h]=f&255,h+1},l.prototype.writeInt16LE=function(f,h,v){return f=+f,h=h>>>0,v||V(this,f,h,2,32767,-32768),this[h]=f&255,this[h+1]=f>>>8,h+2},l.prototype.writeInt16BE=function(f,h,v){return f=+f,h=h>>>0,v||V(this,f,h,2,32767,-32768),this[h]=f>>>8,this[h+1]=f&255,h+2},l.prototype.writeInt32LE=function(f,h,v){return f=+f,h=h>>>0,v||V(this,f,h,4,2147483647,-2147483648),this[h]=f&255,this[h+1]=f>>>8,this[h+2]=f>>>16,this[h+3]=f>>>24,h+4},l.prototype.writeInt32BE=function(f,h,v){return f=+f,h=h>>>0,v||V(this,f,h,4,2147483647,-2147483648),f<0&&(f=4294967295+f+1),this[h]=f>>>24,this[h+1]=f>>>16,this[h+2]=f>>>8,this[h+3]=f&255,h+4},l.prototype.writeBigInt64LE=J(function(f,h=0){return re(this,f,h,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=J(function(f,h=0){return se(this,f,h,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function ae(m,f,h,v,T,_){if(h+v>m.length)throw new RangeError("Index out of range");if(h<0)throw new RangeError("Index out of range")}function ce(m,f,h,v,T){return f=+f,h=h>>>0,T||ae(m,f,h,4),o.write(m,f,h,v,23,4),h+4}l.prototype.writeFloatLE=function(f,h,v){return ce(this,f,h,!0,v)},l.prototype.writeFloatBE=function(f,h,v){return ce(this,f,h,!1,v)};function le(m,f,h,v,T){return f=+f,h=h>>>0,T||ae(m,f,h,8),o.write(m,f,h,v,52,8),h+8}l.prototype.writeDoubleLE=function(f,h,v){return le(this,f,h,!0,v)},l.prototype.writeDoubleBE=function(f,h,v){return le(this,f,h,!1,v)},l.prototype.copy=function(f,h,v,T){if(!l.isBuffer(f))throw new TypeError("argument should be a Buffer");if(v||(v=0),!T&&T!==0&&(T=this.length),h>=f.length&&(h=f.length),h||(h=0),T>0&&T<v&&(T=v),T===v||f.length===0||this.length===0)return 0;if(h<0)throw new RangeError("targetStart out of bounds");if(v<0||v>=this.length)throw new RangeError("Index out of range");if(T<0)throw new RangeError("sourceEnd out of bounds");T>this.length&&(T=this.length),f.length-h<T-v&&(T=f.length-h+v);const _=T-v;return this===f&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(h,v,T):Uint8Array.prototype.set.call(f,this.subarray(v,T),h),_},l.prototype.fill=function(f,h,v,T){if(typeof f=="string"){if(typeof h=="string"?(T=h,h=0,v=this.length):typeof v=="string"&&(T=v,v=this.length),T!==void 0&&typeof T!="string")throw new TypeError("encoding must be a string");if(typeof T=="string"&&!l.isEncoding(T))throw new TypeError("Unknown encoding: "+T);if(f.length===1){const E=f.charCodeAt(0);(T==="utf8"&&E<128||T==="latin1")&&(f=E)}}else typeof f=="number"?f=f&255:typeof f=="boolean"&&(f=Number(f));if(h<0||this.length<h||this.length<v)throw new RangeError("Out of range index");if(v<=h)return this;h=h>>>0,v=v===void 0?this.length:v>>>0,f||(f=0);let _;if(typeof f=="number")for(_=h;_<v;++_)this[_]=f;else{const E=l.isBuffer(f)?f:l.from(f,T),w=E.length;if(w===0)throw new TypeError('The value "'+f+'" is invalid for argument "value"');for(_=0;_<v-h;++_)this[_+h]=E[_%w]}return this};const K={};function ne(m,f,h){K[m]=class extends h{constructor(){super(),Object.defineProperty(this,"message",{value:f.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${m}]`,this.stack,delete this.name}get code(){return m}set code(T){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:T,writable:!0})}toString(){return`${this.name} [${m}]: ${this.message}`}}}ne("ERR_BUFFER_OUT_OF_BOUNDS",function(m){return m?`${m} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ne("ERR_INVALID_ARG_TYPE",function(m,f){return`The "${m}" argument must be of type number. Received type ${typeof f}`},TypeError),ne("ERR_OUT_OF_RANGE",function(m,f,h){let v=`The value of "${m}" is out of range.`,T=h;return Number.isInteger(h)&&Math.abs(h)>2**32?T=ue(String(h)):typeof h=="bigint"&&(T=String(h),(h>BigInt(2)**BigInt(32)||h<-(BigInt(2)**BigInt(32)))&&(T=ue(T)),T+="n"),v+=` It must be ${f}. Received ${T}`,v},RangeError);function ue(m){let f="",h=m.length;const v=m[0]==="-"?1:0;for(;h>=v+4;h-=3)f=`_${m.slice(h-3,h)}${f}`;return`${m.slice(0,h)}${f}`}function Se(m,f,h){Q(f,"offset"),(m[f]===void 0||m[f+h]===void 0)&&X(f,m.length-(h+1))}function de(m,f,h,v,T,_){if(m>h||m<f){const E=typeof f=="bigint"?"n":"";let w;throw _>3?f===0||f===BigInt(0)?w=`>= 0${E} and < 2${E} ** ${(_+1)*8}${E}`:w=`>= -(2${E} ** ${(_+1)*8-1}${E}) and < 2 ** ${(_+1)*8-1}${E}`:w=`>= ${f}${E} and <= ${h}${E}`,new K.ERR_OUT_OF_RANGE("value",w,m)}Se(v,T,_)}function Q(m,f){if(typeof m!="number")throw new K.ERR_INVALID_ARG_TYPE(f,"number",m)}function X(m,f,h){throw Math.floor(m)!==m?(Q(m,h),new K.ERR_OUT_OF_RANGE(h||"offset","an integer",m)):f<0?new K.ERR_BUFFER_OUT_OF_BOUNDS:new K.ERR_OUT_OF_RANGE(h||"offset",`>= ${h?1:0} and <= ${f}`,m)}const Te=/[^+/0-9A-Za-z-_]/g;function ye(m){if(m=m.split("=")[0],m=m.trim().replace(Te,""),m.length<2)return"";for(;m.length%4!==0;)m=m+"=";return m}function ie(m,f){f=f||1/0;let h;const v=m.length;let T=null;const _=[];for(let E=0;E<v;++E){if(h=m.charCodeAt(E),h>55295&&h<57344){if(!T){if(h>56319){(f-=3)>-1&&_.push(239,191,189);continue}else if(E+1===v){(f-=3)>-1&&_.push(239,191,189);continue}T=h;continue}if(h<56320){(f-=3)>-1&&_.push(239,191,189),T=h;continue}h=(T-55296<<10|h-56320)+65536}else T&&(f-=3)>-1&&_.push(239,191,189);if(T=null,h<128){if((f-=1)<0)break;_.push(h)}else if(h<2048){if((f-=2)<0)break;_.push(h>>6|192,h&63|128)}else if(h<65536){if((f-=3)<0)break;_.push(h>>12|224,h>>6&63|128,h&63|128)}else if(h<1114112){if((f-=4)<0)break;_.push(h>>18|240,h>>12&63|128,h>>6&63|128,h&63|128)}else throw new Error("Invalid code point")}return _}function _e(m){const f=[];for(let h=0;h<m.length;++h)f.push(m.charCodeAt(h)&255);return f}function be(m,f){let h,v,T;const _=[];for(let E=0;E<m.length&&!((f-=2)<0);++E)h=m.charCodeAt(E),v=h>>8,T=h%256,_.push(T),_.push(v);return _}function fe(m){return t.toByteArray(ye(m))}function te(m,f,h,v){let T;for(T=0;T<v&&!(T+h>=f.length||T>=m.length);++T)f[T+h]=m[T];return T}function G(m,f){return m instanceof f||m!=null&&m.constructor!=null&&m.constructor.name!=null&&m.constructor.name===f.name}function oe(m){return m!==m}const Ee=function(){const m="0123456789abcdef",f=new Array(256);for(let h=0;h<16;++h){const v=h*16;for(let T=0;T<16;++T)f[v+T]=m[h]+m[T]}return f}();function J(m){return typeof BigInt>"u"?ke:m}function ke(){throw new Error("BigInt not supported")}})(buffer);var browser={exports:{}},process=browser.exports={},cachedSetTimeout,cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?cachedSetTimeout=setTimeout:cachedSetTimeout=defaultSetTimout}catch{cachedSetTimeout=defaultSetTimout}try{typeof clearTimeout=="function"?cachedClearTimeout=clearTimeout:cachedClearTimeout=defaultClearTimeout}catch{cachedClearTimeout=defaultClearTimeout}})();function runTimeout(s){if(cachedSetTimeout===setTimeout)return setTimeout(s,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(s,0);try{return cachedSetTimeout(s,0)}catch{try{return cachedSetTimeout.call(null,s,0)}catch{return cachedSetTimeout.call(this,s,0)}}}function runClearTimeout(s){if(cachedClearTimeout===clearTimeout)return clearTimeout(s);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(s);try{return cachedClearTimeout(s)}catch{try{return cachedClearTimeout.call(null,s)}catch{return cachedClearTimeout.call(this,s)}}}var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){!draining||!currentQueue||(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var s=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(s)}}process.nextTick=function(s){var t=new Array(arguments.length-1);if(arguments.length>1)for(var o=1;o<arguments.length;o++)t[o-1]=arguments[o];queue.push(new Item(s,t)),queue.length===1&&!draining&&runTimeout(drainQueue)};function Item(s,t){this.fun=s,this.array=t}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=!0;process.env={};process.argv=[];process.version="";process.versions={};function noop$1(){}process.on=noop$1;process.addListener=noop$1;process.once=noop$1;process.off=noop$1;process.removeListener=noop$1;process.removeAllListeners=noop$1;process.emit=noop$1;process.prependListener=noop$1;process.prependOnceListener=noop$1;process.listeners=function(s){return[]};process.binding=function(s){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(s){throw new Error("process.chdir is not supported")};process.umask=function(){return 0};var browserExports=browser.exports;(function(s){Object.defineProperty(s,Symbol.toStringTag,{value:"Module"});const t=buffer,o=browserExports,e=c=>c&&c.__esModule?c:{default:c},n=e(o),a=globalThis||void 0||self;Object.defineProperty(s,"Buffer",{enumerable:!0,get:()=>t.Buffer}),Object.defineProperty(s,"process",{enumerable:!0,get:()=>n.default}),s.global=a})(dist);function _mergeNamespaces(s,t){return t.forEach(function(o){o&&typeof o!="string"&&!Array.isArray(o)&&Object.keys(o).forEach(function(e){if(e!=="default"&&!(e in s)){var n=Object.getOwnPropertyDescriptor(o,e);Object.defineProperty(s,e,n.get?n:{enumerable:!0,get:function(){return o[e]}})}})}),Object.freeze(s)}function assert(s,t){if(!s)throw new Error(t)}const FLOAT32_MAX=34028234663852886e22,FLOAT32_MIN=-34028234663852886e22,UINT32_MAX=4294967295,INT32_MAX=2147483647,INT32_MIN=-2147483648;function assertInt32(s){if(typeof s!="number")throw new Error("invalid int 32: "+typeof s);if(!Number.isInteger(s)||s>INT32_MAX||s<INT32_MIN)throw new Error("invalid int 32: "+s)}function assertUInt32(s){if(typeof s!="number")throw new Error("invalid uint 32: "+typeof s);if(!Number.isInteger(s)||s>UINT32_MAX||s<0)throw new Error("invalid uint 32: "+s)}function assertFloat32(s){if(typeof s!="number")throw new Error("invalid float 32: "+typeof s);if(Number.isFinite(s)&&(s>FLOAT32_MAX||s<FLOAT32_MIN))throw new Error("invalid float 32: "+s)}const enumTypeSymbol=Symbol("@bufbuild/protobuf/enum-type");function getEnumType(s){const t=s[enumTypeSymbol];return assert(t,"missing enum type on enum object"),t}function setEnumType(s,t,o,e){s[enumTypeSymbol]=makeEnumType(t,o.map(n=>({no:n.no,name:n.name,localName:s[n.no]})))}function makeEnumType(s,t,o){const e=Object.create(null),n=Object.create(null),a=[];for(const c of t){const l=normalizeEnumValue(c);a.push(l),e[c.name]=l,n[c.no]=l}return{typeName:s,values:a,findName(c){return e[c]},findNumber(c){return n[c]}}}function makeEnum(s,t,o){const e={};for(const n of t){const a=normalizeEnumValue(n);e[a.localName]=a.no,e[a.no]=a.localName}return setEnumType(e,s,t),e}function normalizeEnumValue(s){return"localName"in s?s:Object.assign(Object.assign({},s),{localName:s.name})}class Message{equals(t){return this.getType().runtime.util.equals(this.getType(),this,t)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(t,o){const e=this.getType(),n=e.runtime.bin,a=n.makeReadOptions(o);return n.readMessage(this,a.readerFactory(t),t.byteLength,a),this}fromJson(t,o){const e=this.getType(),n=e.runtime.json,a=n.makeReadOptions(o);return n.readMessage(e,t,a,this),this}fromJsonString(t,o){let e;try{e=JSON.parse(t)}catch(n){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(n instanceof Error?n.message:String(n)))}return this.fromJson(e,o)}toBinary(t){const o=this.getType(),e=o.runtime.bin,n=e.makeWriteOptions(t),a=n.writerFactory();return e.writeMessage(this,a,n),a.finish()}toJson(t){const o=this.getType(),e=o.runtime.json,n=e.makeWriteOptions(t);return e.writeMessage(this,n)}toJsonString(t){var o;const e=this.toJson(t);return JSON.stringify(e,null,(o=t==null?void 0:t.prettySpaces)!==null&&o!==void 0?o:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function makeMessageType(s,t,o,e){var n;const a=(n=e==null?void 0:e.localName)!==null&&n!==void 0?n:t.substring(t.lastIndexOf(".")+1),c={[a]:function(l){s.util.initFields(this),s.util.initPartial(l,this)}}[a];return Object.setPrototypeOf(c.prototype,new Message),Object.assign(c,{runtime:s,typeName:t,fields:s.util.newFieldList(o),fromBinary(l,u){return new c().fromBinary(l,u)},fromJson(l,u){return new c().fromJson(l,u)},fromJsonString(l,u){return new c().fromJsonString(l,u)},equals(l,u){return s.util.equals(c,l,u)}}),c}function varint64read(){let s=0,t=0;for(let e=0;e<28;e+=7){let n=this.buf[this.pos++];if(s|=(n&127)<<e,!(n&128))return this.assertBounds(),[s,t]}let o=this.buf[this.pos++];if(s|=(o&15)<<28,t=(o&112)>>4,!(o&128))return this.assertBounds(),[s,t];for(let e=3;e<=31;e+=7){let n=this.buf[this.pos++];if(t|=(n&127)<<e,!(n&128))return this.assertBounds(),[s,t]}throw new Error("invalid varint")}function varint64write(s,t,o){for(let a=0;a<28;a=a+7){const c=s>>>a,l=!(!(c>>>7)&&t==0),u=(l?c|128:c)&255;if(o.push(u),!l)return}const e=s>>>28&15|(t&7)<<4,n=!!(t>>3);if(o.push((n?e|128:e)&255),!!n){for(let a=3;a<31;a=a+7){const c=t>>>a,l=!!(c>>>7),u=(l?c|128:c)&255;if(o.push(u),!l)return}o.push(t>>>31&1)}}const TWO_PWR_32_DBL=4294967296;function int64FromString(s){const t=s[0]==="-";t&&(s=s.slice(1));const o=1e6;let e=0,n=0;function a(c,l){const u=Number(s.slice(c,l));n*=o,e=e*o+u,e>=TWO_PWR_32_DBL&&(n=n+(e/TWO_PWR_32_DBL|0),e=e%TWO_PWR_32_DBL)}return a(-24,-18),a(-18,-12),a(-12,-6),a(-6),t?negate(e,n):newBits(e,n)}function int64ToString(s,t){let o=newBits(s,t);const e=o.hi&2147483648;e&&(o=negate(o.lo,o.hi));const n=uInt64ToString(o.lo,o.hi);return e?"-"+n:n}function uInt64ToString(s,t){if({lo:s,hi:t}=toUnsigned(s,t),t<=2097151)return String(TWO_PWR_32_DBL*t+s);const o=s&16777215,e=(s>>>24|t<<8)&16777215,n=t>>16&65535;let a=o+e*6777216+n*6710656,c=e+n*8147497,l=n*2;const u=1e7;return a>=u&&(c+=Math.floor(a/u),a%=u),c>=u&&(l+=Math.floor(c/u),c%=u),l.toString()+decimalFrom1e7WithLeadingZeros(c)+decimalFrom1e7WithLeadingZeros(a)}function toUnsigned(s,t){return{lo:s>>>0,hi:t>>>0}}function newBits(s,t){return{lo:s|0,hi:t|0}}function negate(s,t){return t=~t,s?s=~s+1:t+=1,newBits(s,t)}const decimalFrom1e7WithLeadingZeros=s=>{const t=String(s);return"0000000".slice(t.length)+t};function varint32write(s,t){if(s>=0){for(;s>127;)t.push(s&127|128),s=s>>>7;t.push(s)}else{for(let o=0;o<9;o++)t.push(s&127|128),s=s>>7;t.push(1)}}function varint32read(){let s=this.buf[this.pos++],t=s&127;if(!(s&128))return this.assertBounds(),t;if(s=this.buf[this.pos++],t|=(s&127)<<7,!(s&128))return this.assertBounds(),t;if(s=this.buf[this.pos++],t|=(s&127)<<14,!(s&128))return this.assertBounds(),t;if(s=this.buf[this.pos++],t|=(s&127)<<21,!(s&128))return this.assertBounds(),t;s=this.buf[this.pos++],t|=(s&15)<<28;for(let o=5;s&128&&o<10;o++)s=this.buf[this.pos++];if(s&128)throw new Error("invalid varint");return this.assertBounds(),t>>>0}function makeInt64Support(){const s=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof s.getBigInt64=="function"&&typeof s.getBigUint64=="function"&&typeof s.setBigInt64=="function"&&typeof s.setBigUint64=="function"&&(typeof dist.process!="object"||typeof dist.process.env!="object"||{}.BUF_BIGINT_DISABLE!=="1")){const n=BigInt("-9223372036854775808"),a=BigInt("9223372036854775807"),c=BigInt("0"),l=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(u){const d=typeof u=="bigint"?u:BigInt(u);if(d>a||d<n)throw new Error("int64 invalid: ".concat(u));return d},uParse(u){const d=typeof u=="bigint"?u:BigInt(u);if(d>l||d<c)throw new Error("uint64 invalid: ".concat(u));return d},enc(u){return s.setBigInt64(0,this.parse(u),!0),{lo:s.getInt32(0,!0),hi:s.getInt32(4,!0)}},uEnc(u){return s.setBigInt64(0,this.uParse(u),!0),{lo:s.getInt32(0,!0),hi:s.getInt32(4,!0)}},dec(u,d){return s.setInt32(0,u,!0),s.setInt32(4,d,!0),s.getBigInt64(0,!0)},uDec(u,d){return s.setInt32(0,u,!0),s.setInt32(4,d,!0),s.getBigUint64(0,!0)}}}const o=n=>assert(/^-?[0-9]+$/.test(n),"int64 invalid: ".concat(n)),e=n=>assert(/^[0-9]+$/.test(n),"uint64 invalid: ".concat(n));return{zero:"0",supported:!1,parse(n){return typeof n!="string"&&(n=n.toString()),o(n),n},uParse(n){return typeof n!="string"&&(n=n.toString()),e(n),n},enc(n){return typeof n!="string"&&(n=n.toString()),o(n),int64FromString(n)},uEnc(n){return typeof n!="string"&&(n=n.toString()),e(n),int64FromString(n)},dec(n,a){return int64ToString(n,a)},uDec(n,a){return uInt64ToString(n,a)}}}const protoInt64=makeInt64Support();var ScalarType;(function(s){s[s.DOUBLE=1]="DOUBLE",s[s.FLOAT=2]="FLOAT",s[s.INT64=3]="INT64",s[s.UINT64=4]="UINT64",s[s.INT32=5]="INT32",s[s.FIXED64=6]="FIXED64",s[s.FIXED32=7]="FIXED32",s[s.BOOL=8]="BOOL",s[s.STRING=9]="STRING",s[s.BYTES=12]="BYTES",s[s.UINT32=13]="UINT32",s[s.SFIXED32=15]="SFIXED32",s[s.SFIXED64=16]="SFIXED64",s[s.SINT32=17]="SINT32",s[s.SINT64=18]="SINT64"})(ScalarType||(ScalarType={}));var LongType;(function(s){s[s.BIGINT=0]="BIGINT",s[s.STRING=1]="STRING"})(LongType||(LongType={}));function scalarEquals(s,t,o){if(t===o)return!0;if(s==ScalarType.BYTES){if(!(t instanceof Uint8Array)||!(o instanceof Uint8Array)||t.length!==o.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==o[e])return!1;return!0}switch(s){case ScalarType.UINT64:case ScalarType.FIXED64:case ScalarType.INT64:case ScalarType.SFIXED64:case ScalarType.SINT64:return t==o}return!1}function scalarZeroValue(s,t){switch(s){case ScalarType.BOOL:return!1;case ScalarType.UINT64:case ScalarType.FIXED64:case ScalarType.INT64:case ScalarType.SFIXED64:case ScalarType.SINT64:return t==0?protoInt64.zero:"0";case ScalarType.DOUBLE:case ScalarType.FLOAT:return 0;case ScalarType.BYTES:return new Uint8Array(0);case ScalarType.STRING:return"";default:return 0}}function isScalarZeroValue(s,t){switch(s){case ScalarType.BOOL:return t===!1;case ScalarType.STRING:return t==="";case ScalarType.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return t==0}}var WireType;(function(s){s[s.Varint=0]="Varint",s[s.Bit64=1]="Bit64",s[s.LengthDelimited=2]="LengthDelimited",s[s.StartGroup=3]="StartGroup",s[s.EndGroup=4]="EndGroup",s[s.Bit32=5]="Bit32"})(WireType||(WireType={}));class BinaryWriter{constructor(t){this.stack=[],this.textEncoder=t??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let t=0;for(let n=0;n<this.chunks.length;n++)t+=this.chunks[n].length;let o=new Uint8Array(t),e=0;for(let n=0;n<this.chunks.length;n++)o.set(this.chunks[n],e),e+=this.chunks[n].length;return this.chunks=[],o}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let t=this.finish(),o=this.stack.pop();if(!o)throw new Error("invalid state, fork stack empty");return this.chunks=o.chunks,this.buf=o.buf,this.uint32(t.byteLength),this.raw(t)}tag(t,o){return this.uint32((t<<3|o)>>>0)}raw(t){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(t),this}uint32(t){for(assertUInt32(t);t>127;)this.buf.push(t&127|128),t=t>>>7;return this.buf.push(t),this}int32(t){return assertInt32(t),varint32write(t,this.buf),this}bool(t){return this.buf.push(t?1:0),this}bytes(t){return this.uint32(t.byteLength),this.raw(t)}string(t){let o=this.textEncoder.encode(t);return this.uint32(o.byteLength),this.raw(o)}float(t){assertFloat32(t);let o=new Uint8Array(4);return new DataView(o.buffer).setFloat32(0,t,!0),this.raw(o)}double(t){let o=new Uint8Array(8);return new DataView(o.buffer).setFloat64(0,t,!0),this.raw(o)}fixed32(t){assertUInt32(t);let o=new Uint8Array(4);return new DataView(o.buffer).setUint32(0,t,!0),this.raw(o)}sfixed32(t){assertInt32(t);let o=new Uint8Array(4);return new DataView(o.buffer).setInt32(0,t,!0),this.raw(o)}sint32(t){return assertInt32(t),t=(t<<1^t>>31)>>>0,varint32write(t,this.buf),this}sfixed64(t){let o=new Uint8Array(8),e=new DataView(o.buffer),n=protoInt64.enc(t);return e.setInt32(0,n.lo,!0),e.setInt32(4,n.hi,!0),this.raw(o)}fixed64(t){let o=new Uint8Array(8),e=new DataView(o.buffer),n=protoInt64.uEnc(t);return e.setInt32(0,n.lo,!0),e.setInt32(4,n.hi,!0),this.raw(o)}int64(t){let o=protoInt64.enc(t);return varint64write(o.lo,o.hi,this.buf),this}sint64(t){let o=protoInt64.enc(t),e=o.hi>>31,n=o.lo<<1^e,a=(o.hi<<1|o.lo>>>31)^e;return varint64write(n,a,this.buf),this}uint64(t){let o=protoInt64.uEnc(t);return varint64write(o.lo,o.hi,this.buf),this}}class BinaryReader{constructor(t,o){this.varint64=varint64read,this.uint32=varint32read,this.buf=t,this.len=t.length,this.pos=0,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.textDecoder=o??new TextDecoder}tag(){let t=this.uint32(),o=t>>>3,e=t&7;if(o<=0||e<0||e>5)throw new Error("illegal tag: field no "+o+" wire type "+e);return[o,e]}skip(t,o){let e=this.pos;switch(t){case WireType.Varint:for(;this.buf[this.pos++]&128;);break;case WireType.Bit64:this.pos+=4;case WireType.Bit32:this.pos+=4;break;case WireType.LengthDelimited:let n=this.uint32();this.pos+=n;break;case WireType.StartGroup:for(;;){const[a,c]=this.tag();if(c===WireType.EndGroup){if(o!==void 0&&a!==o)throw new Error("invalid end group tag");break}this.skip(c,a)}break;default:throw new Error("cant skip wire type "+t)}return this.assertBounds(),this.buf.subarray(e,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)}int64(){return protoInt64.dec(...this.varint64())}uint64(){return protoInt64.uDec(...this.varint64())}sint64(){let[t,o]=this.varint64(),e=-(t&1);return t=(t>>>1|(o&1)<<31)^e,o=o>>>1^e,protoInt64.dec(t,o)}bool(){let[t,o]=this.varint64();return t!==0||o!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return protoInt64.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return protoInt64.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let t=this.uint32(),o=this.pos;return this.pos+=t,this.assertBounds(),this.buf.subarray(o,o+t)}string(){return this.textDecoder.decode(this.bytes())}}function makeExtension(s,t,o,e){let n;return{typeName:t,extendee:o,get field(){if(!n){const a=typeof e=="function"?e():e;a.name=t.split(".").pop(),a.jsonName="[".concat(t,"]"),n=s.util.newFieldList([a]).list()[0]}return n},runtime:s}}function createExtensionContainer(s){const t=s.field.localName,o=Object.create(null);return o[t]=initExtensionField(s),[o,()=>o[t]]}function initExtensionField(s){const t=s.field;if(t.repeated)return[];if(t.default!==void 0)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return scalarZeroValue(t.T,t.L);case"message":const o=t.T,e=new o;return o.fieldWrapper?o.fieldWrapper.unwrapField(e):e;case"map":throw"map fields are not allowed to be extensions"}}function filterUnknownFields(s,t){if(!t.repeated&&(t.kind=="enum"||t.kind=="scalar")){for(let o=s.length-1;o>=0;--o)if(s[o].no==t.no)return[s[o]];return[]}return s.filter(o=>o.no===t.no)}let encTable="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),decTable=[];for(let s=0;s<encTable.length;s++)decTable[encTable[s].charCodeAt(0)]=s;decTable["-".charCodeAt(0)]=encTable.indexOf("+");decTable["_".charCodeAt(0)]=encTable.indexOf("/");const protoBase64={dec(s){let t=s.length*3/4;s[s.length-2]=="="?t-=2:s[s.length-1]=="="&&(t-=1);let o=new Uint8Array(t),e=0,n=0,a,c=0;for(let l=0;l<s.length;l++){if(a=decTable[s.charCodeAt(l)],a===void 0)switch(s[l]){case"=":n=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(n){case 0:c=a,n=1;break;case 1:o[e++]=c<<2|(a&48)>>4,c=a,n=2;break;case 2:o[e++]=(c&15)<<4|(a&60)>>2,c=a,n=3;break;case 3:o[e++]=(c&3)<<6|a,n=0;break}}if(n==1)throw Error("invalid base64 string.");return o.subarray(0,e)},enc(s){let t="",o=0,e,n=0;for(let a=0;a<s.length;a++)switch(e=s[a],o){case 0:t+=encTable[e>>2],n=(e&3)<<4,o=1;break;case 1:t+=encTable[n|e>>4],n=(e&15)<<2,o=2;break;case 2:t+=encTable[n|e>>6],t+=encTable[e&63],o=0;break}return o&&(t+=encTable[n],t+="=",o==1&&(t+="=")),t}};function getExtension(s,t,o){assertExtendee(t,s);const e=t.runtime.bin.makeReadOptions(o),n=filterUnknownFields(s.getType().runtime.bin.listUnknownFields(s),t.field),[a,c]=createExtensionContainer(t);for(const l of n)t.runtime.bin.readField(a,e.readerFactory(l.data),t.field,l.wireType,e);return c()}function setExtension(s,t,o,e){assertExtendee(t,s);const n=t.runtime.bin.makeReadOptions(e),a=t.runtime.bin.makeWriteOptions(e);if(hasExtension(s,t)){const d=s.getType().runtime.bin.listUnknownFields(s).filter(p=>p.no!=t.field.no);s.getType().runtime.bin.discardUnknownFields(s);for(const p of d)s.getType().runtime.bin.onUnknownField(s,p.no,p.wireType,p.data)}const c=a.writerFactory();let l=t.field;!l.opt&&!l.repeated&&(l.kind=="enum"||l.kind=="scalar")&&(l=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(l,o,c,a);const u=n.readerFactory(c.finish());for(;u.pos<u.len;){const[d,p]=u.tag(),g=u.skip(p,d);s.getType().runtime.bin.onUnknownField(s,d,p,g)}}function hasExtension(s,t){const o=s.getType();return t.extendee.typeName===o.typeName&&!!o.runtime.bin.listUnknownFields(s).find(e=>e.no==t.field.no)}function assertExtendee(s,t){assert(s.extendee.typeName==t.getType().typeName,"extension ".concat(s.typeName," can only be applied to message ").concat(s.extendee.typeName))}function isFieldSet(s,t){const o=s.localName;if(s.repeated)return t[o].length>0;if(s.oneof)return t[s.oneof.localName].case===o;switch(s.kind){case"enum":case"scalar":return s.opt||s.req?t[o]!==void 0:s.kind=="enum"?t[o]!==s.T.values[0].no:!isScalarZeroValue(s.T,t[o]);case"message":return t[o]!==void 0;case"map":return Object.keys(t[o]).length>0}}function clearField(s,t){const o=s.localName,e=!s.opt&&!s.req;if(s.repeated)t[o]=[];else if(s.oneof)t[s.oneof.localName]={case:void 0};else switch(s.kind){case"map":t[o]={};break;case"enum":t[o]=e?s.T.values[0].no:void 0;break;case"scalar":t[o]=e?scalarZeroValue(s.T,s.L):void 0;break;case"message":t[o]=void 0;break}}function isMessage(s,t){if(s===null||typeof s!="object"||!Object.getOwnPropertyNames(Message.prototype).every(e=>e in s&&typeof s[e]=="function"))return!1;const o=s.getType();return o===null||typeof o!="function"||!("typeName"in o)||typeof o.typeName!="string"?!1:t===void 0?!0:o.typeName==t.typeName}function wrapField(s,t){return isMessage(t)||!s.fieldWrapper?t:s.fieldWrapper.wrapField(t)}ScalarType.DOUBLE,ScalarType.FLOAT,ScalarType.INT64,ScalarType.UINT64,ScalarType.INT32,ScalarType.UINT32,ScalarType.BOOL,ScalarType.STRING,ScalarType.BYTES;const jsonReadDefaults={ignoreUnknownFields:!1},jsonWriteDefaults={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function makeReadOptions$1(s){return s?Object.assign(Object.assign({},jsonReadDefaults),s):jsonReadDefaults}function makeWriteOptions$1(s){return s?Object.assign(Object.assign({},jsonWriteDefaults),s):jsonWriteDefaults}const tokenNull=Symbol(),tokenIgnoredUnknownEnum=Symbol();function makeJsonFormat(){return{makeReadOptions:makeReadOptions$1,makeWriteOptions:makeWriteOptions$1,readMessage(s,t,o,e){if(t==null||Array.isArray(t)||typeof t!="object")throw new Error("cannot decode message ".concat(s.typeName," from JSON: ").concat(debugJsonValue(t)));e=e??new s;const n=new Map,a=o.typeRegistry;for(const[c,l]of Object.entries(t)){const u=s.fields.findJsonName(c);if(u){if(u.oneof){if(l===null&&u.kind=="scalar")continue;const d=n.get(u.oneof);if(d!==void 0)throw new Error("cannot decode message ".concat(s.typeName,' from JSON: multiple keys for oneof "').concat(u.oneof.name,'" present: "').concat(d,'", "').concat(c,'"'));n.set(u.oneof,c)}readField$1(e,l,u,o,s)}else{let d=!1;if(a!=null&&a.findExtension&&c.startsWith("[")&&c.endsWith("]")){const p=a.findExtension(c.substring(1,c.length-1));if(p&&p.extendee.typeName==s.typeName){d=!0;const[g,S]=createExtensionContainer(p);readField$1(g,l,p.field,o,p),setExtension(e,p,S(),o)}}if(!d&&!o.ignoreUnknownFields)throw new Error("cannot decode message ".concat(s.typeName,' from JSON: key "').concat(c,'" is unknown'))}}return e},writeMessage(s,t){const o=s.getType(),e={};let n;try{for(n of o.fields.byNumber()){if(!isFieldSet(n,s)){if(n.req)throw"required field not set";if(!t.emitDefaultValues||!canEmitFieldDefaultValue(n))continue}const c=n.oneof?s[n.oneof.localName].value:s[n.localName],l=writeField$1(n,c,t);l!==void 0&&(e[t.useProtoFieldName?n.name:n.jsonName]=l)}const a=t.typeRegistry;if(a!=null&&a.findExtensionFor)for(const c of o.runtime.bin.listUnknownFields(s)){const l=a.findExtensionFor(o.typeName,c.no);if(l&&hasExtension(s,l)){const u=getExtension(s,l,t),d=writeField$1(l.field,u,t);d!==void 0&&(e[l.field.jsonName]=d)}}}catch(a){const c=n?"cannot encode field ".concat(o.typeName,".").concat(n.name," to JSON"):"cannot encode message ".concat(o.typeName," to JSON"),l=a instanceof Error?a.message:String(a);throw new Error(c+(l.length>0?": ".concat(l):""))}return e},readScalar(s,t,o){return readScalar$1(s,t,o??LongType.BIGINT,!0)},writeScalar(s,t,o){if(t!==void 0&&(o||isScalarZeroValue(s,t)))return writeScalar$1(s,t)},debug:debugJsonValue}}function debugJsonValue(s){if(s===null)return"null";switch(typeof s){case"object":return Array.isArray(s)?"array":"object";case"string":return s.length>100?"string":'"'.concat(s.split('"').join('\\"'),'"');default:return String(s)}}function readField$1(s,t,o,e,n){let a=o.localName;if(o.repeated){if(assert(o.kind!="map"),t===null)return;if(!Array.isArray(t))throw new Error("cannot decode field ".concat(n.typeName,".").concat(o.name," from JSON: ").concat(debugJsonValue(t)));const c=s[a];for(const l of t){if(l===null)throw new Error("cannot decode field ".concat(n.typeName,".").concat(o.name," from JSON: ").concat(debugJsonValue(l)));switch(o.kind){case"message":c.push(o.T.fromJson(l,e));break;case"enum":const u=readEnum(o.T,l,e.ignoreUnknownFields,!0);u!==tokenIgnoredUnknownEnum&&c.push(u);break;case"scalar":try{c.push(readScalar$1(o.T,l,o.L,!0))}catch(d){let p="cannot decode field ".concat(n.typeName,".").concat(o.name," from JSON: ").concat(debugJsonValue(l));throw d instanceof Error&&d.message.length>0&&(p+=": ".concat(d.message)),new Error(p)}break}}}else if(o.kind=="map"){if(t===null)return;if(typeof t!="object"||Array.isArray(t))throw new Error("cannot decode field ".concat(n.typeName,".").concat(o.name," from JSON: ").concat(debugJsonValue(t)));const c=s[a];for(const[l,u]of Object.entries(t)){if(u===null)throw new Error("cannot decode field ".concat(n.typeName,".").concat(o.name," from JSON: map value null"));let d;try{d=readMapKey(o.K,l)}catch(p){let g="cannot decode map key for field ".concat(n.typeName,".").concat(o.name," from JSON: ").concat(debugJsonValue(t));throw p instanceof Error&&p.message.length>0&&(g+=": ".concat(p.message)),new Error(g)}switch(o.V.kind){case"message":c[d]=o.V.T.fromJson(u,e);break;case"enum":const p=readEnum(o.V.T,u,e.ignoreUnknownFields,!0);p!==tokenIgnoredUnknownEnum&&(c[d]=p);break;case"scalar":try{c[d]=readScalar$1(o.V.T,u,LongType.BIGINT,!0)}catch(g){let S="cannot decode map value for field ".concat(n.typeName,".").concat(o.name," from JSON: ").concat(debugJsonValue(t));throw g instanceof Error&&g.message.length>0&&(S+=": ".concat(g.message)),new Error(S)}break}}}else switch(o.oneof&&(s=s[o.oneof.localName]={case:a},a="value"),o.kind){case"message":const c=o.T;if(t===null&&c.typeName!="google.protobuf.Value")return;let l=s[a];isMessage(l)?l.fromJson(t,e):(s[a]=l=c.fromJson(t,e),c.fieldWrapper&&!o.oneof&&(s[a]=c.fieldWrapper.unwrapField(l)));break;case"enum":const u=readEnum(o.T,t,e.ignoreUnknownFields,!1);switch(u){case tokenNull:clearField(o,s);break;case tokenIgnoredUnknownEnum:break;default:s[a]=u;break}break;case"scalar":try{const d=readScalar$1(o.T,t,o.L,!1);switch(d){case tokenNull:clearField(o,s);break;default:s[a]=d;break}}catch(d){let p="cannot decode field ".concat(n.typeName,".").concat(o.name," from JSON: ").concat(debugJsonValue(t));throw d instanceof Error&&d.message.length>0&&(p+=": ".concat(d.message)),new Error(p)}break}}function readMapKey(s,t){if(s===ScalarType.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1;break}return readScalar$1(s,t,LongType.BIGINT,!0).toString()}function readScalar$1(s,t,o,e){if(t===null)return e?scalarZeroValue(s,o):tokenNull;switch(s){case ScalarType.DOUBLE:case ScalarType.FLOAT:if(t==="NaN")return Number.NaN;if(t==="Infinity")return Number.POSITIVE_INFINITY;if(t==="-Infinity")return Number.NEGATIVE_INFINITY;if(t===""||typeof t=="string"&&t.trim().length!==t.length||typeof t!="string"&&typeof t!="number")break;const n=Number(t);if(Number.isNaN(n)||!Number.isFinite(n))break;return s==ScalarType.FLOAT&&assertFloat32(n),n;case ScalarType.INT32:case ScalarType.FIXED32:case ScalarType.SFIXED32:case ScalarType.SINT32:case ScalarType.UINT32:let a;if(typeof t=="number"?a=t:typeof t=="string"&&t.length>0&&t.trim().length===t.length&&(a=Number(t)),a===void 0)break;return s==ScalarType.UINT32||s==ScalarType.FIXED32?assertUInt32(a):assertInt32(a),a;case ScalarType.INT64:case ScalarType.SFIXED64:case ScalarType.SINT64:if(typeof t!="number"&&typeof t!="string")break;const c=protoInt64.parse(t);return o?c.toString():c;case ScalarType.FIXED64:case ScalarType.UINT64:if(typeof t!="number"&&typeof t!="string")break;const l=protoInt64.uParse(t);return o?l.toString():l;case ScalarType.BOOL:if(typeof t!="boolean")break;return t;case ScalarType.STRING:if(typeof t!="string")break;try{encodeURIComponent(t)}catch{throw new Error("invalid UTF8")}return t;case ScalarType.BYTES:if(t==="")return new Uint8Array(0);if(typeof t!="string")break;return protoBase64.dec(t)}throw new Error}function readEnum(s,t,o,e){if(t===null)return s.typeName=="google.protobuf.NullValue"?0:e?s.values[0].no:tokenNull;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const n=s.findName(t);if(n!==void 0)return n.no;if(o)return tokenIgnoredUnknownEnum;break}throw new Error("cannot decode enum ".concat(s.typeName," from JSON: ").concat(debugJsonValue(t)))}function canEmitFieldDefaultValue(s){return s.repeated||s.kind=="map"?!0:!(s.oneof||s.kind=="message"||s.opt||s.req)}function writeField$1(s,t,o){if(s.kind=="map"){assert(typeof t=="object"&&t!=null);const e={},n=Object.entries(t);switch(s.V.kind){case"scalar":for(const[c,l]of n)e[c.toString()]=writeScalar$1(s.V.T,l);break;case"message":for(const[c,l]of n)e[c.toString()]=l.toJson(o);break;case"enum":const a=s.V.T;for(const[c,l]of n)e[c.toString()]=writeEnum(a,l,o.enumAsInteger);break}return o.emitDefaultValues||n.length>0?e:void 0}if(s.repeated){assert(Array.isArray(t));const e=[];switch(s.kind){case"scalar":for(let n=0;n<t.length;n++)e.push(writeScalar$1(s.T,t[n]));break;case"enum":for(let n=0;n<t.length;n++)e.push(writeEnum(s.T,t[n],o.enumAsInteger));break;case"message":for(let n=0;n<t.length;n++)e.push(t[n].toJson(o));break}return o.emitDefaultValues||e.length>0?e:void 0}switch(s.kind){case"scalar":return writeScalar$1(s.T,t);case"enum":return writeEnum(s.T,t,o.enumAsInteger);case"message":return wrapField(s.T,t).toJson(o)}}function writeEnum(s,t,o){var e;if(assert(typeof t=="number"),s.typeName=="google.protobuf.NullValue")return null;if(o)return t;const n=s.findNumber(t);return(e=n==null?void 0:n.name)!==null&&e!==void 0?e:t}function writeScalar$1(s,t){switch(s){case ScalarType.INT32:case ScalarType.SFIXED32:case ScalarType.SINT32:case ScalarType.FIXED32:case ScalarType.UINT32:return assert(typeof t=="number"),t;case ScalarType.FLOAT:case ScalarType.DOUBLE:return assert(typeof t=="number"),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case ScalarType.STRING:return assert(typeof t=="string"),t;case ScalarType.BOOL:return assert(typeof t=="boolean"),t;case ScalarType.UINT64:case ScalarType.FIXED64:case ScalarType.INT64:case ScalarType.SFIXED64:case ScalarType.SINT64:return assert(typeof t=="bigint"||typeof t=="string"||typeof t=="number"),t.toString();case ScalarType.BYTES:return assert(t instanceof Uint8Array),protoBase64.enc(t)}}const unknownFieldsSymbol=Symbol("@bufbuild/protobuf/unknown-fields"),readDefaults={readUnknownFields:!0,readerFactory:s=>new BinaryReader(s)},writeDefaults={writeUnknownFields:!0,writerFactory:()=>new BinaryWriter};function makeReadOptions(s){return s?Object.assign(Object.assign({},readDefaults),s):readDefaults}function makeWriteOptions(s){return s?Object.assign(Object.assign({},writeDefaults),s):writeDefaults}function makeBinaryFormat(){return{makeReadOptions,makeWriteOptions,listUnknownFields(s){var t;return(t=s[unknownFieldsSymbol])!==null&&t!==void 0?t:[]},discardUnknownFields(s){delete s[unknownFieldsSymbol]},writeUnknownFields(s,t){const e=s[unknownFieldsSymbol];if(e)for(const n of e)t.tag(n.no,n.wireType).raw(n.data)},onUnknownField(s,t,o,e){const n=s;Array.isArray(n[unknownFieldsSymbol])||(n[unknownFieldsSymbol]=[]),n[unknownFieldsSymbol].push({no:t,wireType:o,data:e})},readMessage(s,t,o,e,n){const a=s.getType(),c=n?t.len:t.pos+o;let l,u;for(;t.pos<c&&([l,u]=t.tag(),!(n===!0&&u==WireType.EndGroup));){const d=a.fields.find(l);if(!d){const p=t.skip(u,l);e.readUnknownFields&&this.onUnknownField(s,l,u,p);continue}readField(s,t,d,u,e)}if(n&&(u!=WireType.EndGroup||l!==o))throw new Error("invalid end group tag")},readField,writeMessage(s,t,o){const e=s.getType();for(const n of e.fields.byNumber()){if(!isFieldSet(n,s)){if(n.req)throw new Error("cannot encode field ".concat(e.typeName,".").concat(n.name," to binary: required field not set"));continue}const a=n.oneof?s[n.oneof.localName].value:s[n.localName];writeField(n,a,t,o)}return o.writeUnknownFields&&this.writeUnknownFields(s,t),t},writeField(s,t,o,e){t!==void 0&&writeField(s,t,o,e)}}}function readField(s,t,o,e,n){let{repeated:a,localName:c}=o;switch(o.oneof&&(s=s[o.oneof.localName],s.case!=c&&delete s.value,s.case=c,c="value"),o.kind){case"scalar":case"enum":const l=o.kind=="enum"?ScalarType.INT32:o.T;let u=readScalar;if(o.kind=="scalar"&&o.L>0&&(u=readScalarLTString),a){let S=s[c];if(e==WireType.LengthDelimited&&l!=ScalarType.STRING&&l!=ScalarType.BYTES){let b=t.uint32()+t.pos;for(;t.pos<b;)S.push(u(t,l))}else S.push(u(t,l))}else s[c]=u(t,l);break;case"message":const d=o.T;a?s[c].push(readMessageField(t,new d,n,o)):isMessage(s[c])?readMessageField(t,s[c],n,o):(s[c]=readMessageField(t,new d,n,o),d.fieldWrapper&&!o.oneof&&!o.repeated&&(s[c]=d.fieldWrapper.unwrapField(s[c])));break;case"map":let[p,g]=readMapEntry(o,t,n);s[c][p]=g;break}}function readMessageField(s,t,o,e){const n=t.getType().runtime.bin,a=e==null?void 0:e.delimited;return n.readMessage(t,s,a?e.no:s.uint32(),o,a),t}function readMapEntry(s,t,o){const e=t.uint32(),n=t.pos+e;let a,c;for(;t.pos<n;){const[l]=t.tag();switch(l){case 1:a=readScalar(t,s.K);break;case 2:switch(s.V.kind){case"scalar":c=readScalar(t,s.V.T);break;case"enum":c=t.int32();break;case"message":c=readMessageField(t,new s.V.T,o,void 0);break}break}}if(a===void 0&&(a=scalarZeroValue(s.K,LongType.BIGINT)),typeof a!="string"&&typeof a!="number"&&(a=a.toString()),c===void 0)switch(s.V.kind){case"scalar":c=scalarZeroValue(s.V.T,LongType.BIGINT);break;case"enum":c=s.V.T.values[0].no;break;case"message":c=new s.V.T;break}return[a,c]}function readScalarLTString(s,t){const o=readScalar(s,t);return typeof o=="bigint"?o.toString():o}function readScalar(s,t){switch(t){case ScalarType.STRING:return s.string();case ScalarType.BOOL:return s.bool();case ScalarType.DOUBLE:return s.double();case ScalarType.FLOAT:return s.float();case ScalarType.INT32:return s.int32();case ScalarType.INT64:return s.int64();case ScalarType.UINT64:return s.uint64();case ScalarType.FIXED64:return s.fixed64();case ScalarType.BYTES:return s.bytes();case ScalarType.FIXED32:return s.fixed32();case ScalarType.SFIXED32:return s.sfixed32();case ScalarType.SFIXED64:return s.sfixed64();case ScalarType.SINT64:return s.sint64();case ScalarType.UINT32:return s.uint32();case ScalarType.SINT32:return s.sint32()}}function writeField(s,t,o,e){assert(t!==void 0);const n=s.repeated;switch(s.kind){case"scalar":case"enum":let a=s.kind=="enum"?ScalarType.INT32:s.T;if(n)if(assert(Array.isArray(t)),s.packed)writePacked(o,a,s.no,t);else for(const c of t)writeScalar(o,a,s.no,c);else writeScalar(o,a,s.no,t);break;case"message":if(n){assert(Array.isArray(t));for(const c of t)writeMessageField(o,e,s,c)}else writeMessageField(o,e,s,t);break;case"map":assert(typeof t=="object"&&t!=null);for(const[c,l]of Object.entries(t))writeMapEntry(o,e,s,c,l);break}}function writeMapEntry(s,t,o,e,n){s.tag(o.no,WireType.LengthDelimited),s.fork();let a=e;switch(o.K){case ScalarType.INT32:case ScalarType.FIXED32:case ScalarType.UINT32:case ScalarType.SFIXED32:case ScalarType.SINT32:a=Number.parseInt(e);break;case ScalarType.BOOL:assert(e=="true"||e=="false"),a=e=="true";break}switch(writeScalar(s,o.K,1,a),o.V.kind){case"scalar":writeScalar(s,o.V.T,2,n);break;case"enum":writeScalar(s,ScalarType.INT32,2,n);break;case"message":assert(n!==void 0),s.tag(2,WireType.LengthDelimited).bytes(n.toBinary(t));break}s.join()}function writeMessageField(s,t,o,e){const n=wrapField(o.T,e);o.delimited?s.tag(o.no,WireType.StartGroup).raw(n.toBinary(t)).tag(o.no,WireType.EndGroup):s.tag(o.no,WireType.LengthDelimited).bytes(n.toBinary(t))}function writeScalar(s,t,o,e){assert(e!==void 0);let[n,a]=scalarTypeInfo(t);s.tag(o,n)[a](e)}function writePacked(s,t,o,e){if(!e.length)return;s.tag(o,WireType.LengthDelimited).fork();let[,n]=scalarTypeInfo(t);for(let a=0;a<e.length;a++)s[n](e[a]);s.join()}function scalarTypeInfo(s){let t=WireType.Varint;switch(s){case ScalarType.BYTES:case ScalarType.STRING:t=WireType.LengthDelimited;break;case ScalarType.DOUBLE:case ScalarType.FIXED64:case ScalarType.SFIXED64:t=WireType.Bit64;break;case ScalarType.FIXED32:case ScalarType.SFIXED32:case ScalarType.FLOAT:t=WireType.Bit32;break}const o=ScalarType[s].toLowerCase();return[t,o]}function makeUtilCommon(){return{setEnumType,initPartial(s,t){if(s===void 0)return;const o=t.getType();for(const e of o.fields.byMember()){const n=e.localName,a=t,c=s;if(c[n]!=null)switch(e.kind){case"oneof":const l=c[n].case;if(l===void 0)continue;const u=e.findField(l);let d=c[n].value;u&&u.kind=="message"&&!isMessage(d,u.T)?d=new u.T(d):u&&u.kind==="scalar"&&u.T===ScalarType.BYTES&&(d=toU8Arr(d)),a[n]={case:l,value:d};break;case"scalar":case"enum":let p=c[n];e.T===ScalarType.BYTES&&(p=e.repeated?p.map(toU8Arr):toU8Arr(p)),a[n]=p;break;case"map":switch(e.V.kind){case"scalar":case"enum":if(e.V.T===ScalarType.BYTES)for(const[y,b]of Object.entries(c[n]))a[n][y]=toU8Arr(b);else Object.assign(a[n],c[n]);break;case"message":const S=e.V.T;for(const y of Object.keys(c[n])){let b=c[n][y];S.fieldWrapper||(b=new S(b)),a[n][y]=b}break}break;case"message":const g=e.T;if(e.repeated)a[n]=c[n].map(S=>isMessage(S,g)?S:new g(S));else{const S=c[n];g.fieldWrapper?g.typeName==="google.protobuf.BytesValue"?a[n]=toU8Arr(S):a[n]=S:a[n]=isMessage(S,g)?S:new g(S)}break}}},equals(s,t,o){return t===o?!0:!t||!o?!1:s.fields.byMember().every(e=>{const n=t[e.localName],a=o[e.localName];if(e.repeated){if(n.length!==a.length)return!1;switch(e.kind){case"message":return n.every((c,l)=>e.T.equals(c,a[l]));case"scalar":return n.every((c,l)=>scalarEquals(e.T,c,a[l]));case"enum":return n.every((c,l)=>scalarEquals(ScalarType.INT32,c,a[l]))}throw new Error("repeated cannot contain ".concat(e.kind))}switch(e.kind){case"message":return e.T.equals(n,a);case"enum":return scalarEquals(ScalarType.INT32,n,a);case"scalar":return scalarEquals(e.T,n,a);case"oneof":if(n.case!==a.case)return!1;const c=e.findField(n.case);if(c===void 0)return!0;switch(c.kind){case"message":return c.T.equals(n.value,a.value);case"enum":return scalarEquals(ScalarType.INT32,n.value,a.value);case"scalar":return scalarEquals(c.T,n.value,a.value)}throw new Error("oneof cannot contain ".concat(c.kind));case"map":const l=Object.keys(n).concat(Object.keys(a));switch(e.V.kind){case"message":const u=e.V.T;return l.every(p=>u.equals(n[p],a[p]));case"enum":return l.every(p=>scalarEquals(ScalarType.INT32,n[p],a[p]));case"scalar":const d=e.V.T;return l.every(p=>scalarEquals(d,n[p],a[p]))}break}})},clone(s){const t=s.getType(),o=new t,e=o;for(const n of t.fields.byMember()){const a=s[n.localName];let c;if(n.repeated)c=a.map(cloneSingularField);else if(n.kind=="map"){c=e[n.localName];for(const[l,u]of Object.entries(a))c[l]=cloneSingularField(u)}else n.kind=="oneof"?c=n.findField(a.case)?{case:a.case,value:cloneSingularField(a.value)}:{case:void 0}:c=cloneSingularField(a);e[n.localName]=c}for(const n of t.runtime.bin.listUnknownFields(s))t.runtime.bin.onUnknownField(e,n.no,n.wireType,n.data);return o}}}function cloneSingularField(s){if(s===void 0)return s;if(isMessage(s))return s.clone();if(s instanceof Uint8Array){const t=new Uint8Array(s.byteLength);return t.set(s),t}return s}function toU8Arr(s){return s instanceof Uint8Array?s:new Uint8Array(s)}function makeProtoRuntime(s,t,o){return{syntax:s,json:makeJsonFormat(),bin:makeBinaryFormat(),util:Object.assign(Object.assign({},makeUtilCommon()),{newFieldList:t,initFields:o}),makeMessageType(e,n,a){return makeMessageType(this,e,n,a)},makeEnum,makeEnumType,getEnumType,makeExtension(e,n,a){return makeExtension(this,e,n,a)}}}class InternalFieldList{constructor(t,o){this._fields=t,this._normalizer=o}findJsonName(t){if(!this.jsonNames){const o={};for(const e of this.list())o[e.jsonName]=o[e.name]=e;this.jsonNames=o}return this.jsonNames[t]}find(t){if(!this.numbers){const o={};for(const e of this.list())o[e.no]=e;this.numbers=o}return this.numbers[t]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((t,o)=>t.no-o.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const t=this.members;let o;for(const e of this.list())e.oneof?e.oneof!==o&&(o=e.oneof,t.push(o)):t.push(e)}return this.members}}function localFieldName(s,t){const o=protoCamelCase(s);return t?o:safeObjectProperty(safeMessageProperty(o))}function localOneofName(s){return localFieldName(s,!1)}const fieldJsonName=protoCamelCase;function protoCamelCase(s){let t=!1;const o=[];for(let e=0;e<s.length;e++){let n=s.charAt(e);switch(n){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":o.push(n),t=!1;break;default:t&&(t=!1,n=n.toUpperCase()),o.push(n);break}}return o.join("")}const reservedObjectProperties=new Set(["constructor","toString","toJSON","valueOf"]),reservedMessageProperties=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),fallback=s=>"".concat(s,"$"),safeMessageProperty=s=>reservedMessageProperties.has(s)?fallback(s):s,safeObjectProperty=s=>reservedObjectProperties.has(s)?fallback(s):s;class InternalOneofInfo{constructor(t){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=t,this.localName=localOneofName(t)}addField(t){assert(t.oneof===this,"field ".concat(t.name," not one of ").concat(this.name)),this.fields.push(t)}findField(t){if(!this._lookup){this._lookup=Object.create(null);for(let o=0;o<this.fields.length;o++)this._lookup[this.fields[o].localName]=this.fields[o]}return this._lookup[t]}}function normalizeFieldInfos(s,t){var o,e,n,a,c,l;const u=[];let d;for(const p of typeof s=="function"?s():s){const g=p;if(g.localName=localFieldName(p.name,p.oneof!==void 0),g.jsonName=(o=p.jsonName)!==null&&o!==void 0?o:fieldJsonName(p.name),g.repeated=(e=p.repeated)!==null&&e!==void 0?e:!1,p.kind=="scalar"&&(g.L=(n=p.L)!==null&&n!==void 0?n:LongType.BIGINT),g.delimited=(a=p.delimited)!==null&&a!==void 0?a:!1,g.req=(c=p.req)!==null&&c!==void 0?c:!1,g.opt=(l=p.opt)!==null&&l!==void 0?l:!1,p.packed===void 0&&(g.packed=p.kind=="enum"||p.kind=="scalar"&&p.T!=ScalarType.BYTES&&p.T!=ScalarType.STRING),p.oneof!==void 0){const S=typeof p.oneof=="string"?p.oneof:p.oneof.name;(!d||d.name!=S)&&(d=new InternalOneofInfo(S)),g.oneof=d,d.addField(g)}u.push(g)}return u}const proto3=makeProtoRuntime("proto3",s=>new InternalFieldList(s,t=>normalizeFieldInfos(t)),s=>{for(const t of s.getType().fields.byMember()){if(t.opt)continue;const o=t.localName,e=s;if(t.repeated){e[o]=[];continue}switch(t.kind){case"oneof":e[o]={case:void 0};break;case"enum":e[o]=0;break;case"map":e[o]={};break;case"scalar":e[o]=scalarZeroValue(t.T,t.L);break}}}),MetricsBatch=proto3.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:2,name:"time_series",kind:"message",T:TimeSeriesMetric,repeated:!0},{no:3,name:"events",kind:"message",T:EventMetric,repeated:!0}]),TimeSeriesMetric=proto3.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp",kind:"scalar",T:3},{no:5,name:"end_timestamp",kind:"scalar",T:3},{no:6,name:"samples",kind:"message",T:MetricSample,repeated:!0}]),MetricSample=proto3.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"value",kind:"scalar",T:2}]),EventMetric=proto3.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp",kind:"scalar",T:3},{no:5,name:"end_timestamp",kind:"scalar",T:3,opt:!0},{no:6,name:"metadata",kind:"scalar",T:9}]),TrackType=proto3.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),TrackSource=proto3.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),VideoQuality$1=proto3.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),ConnectionQuality$1=proto3.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),ClientConfigSetting=proto3.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),DisconnectReason=proto3.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"}]),ReconnectReason=proto3.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),SubscriptionError=proto3.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),AudioTrackFeature=proto3.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"}]),Room$1=proto3.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Codec,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:TimedVersion}]),Codec=proto3.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),ParticipantPermission=proto3.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:proto3.getEnumType(TrackSource),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),ParticipantInfo=proto3.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:proto3.getEnumType(ParticipantInfo_State)},{no:4,name:"tracks",kind:"message",T:TrackInfo,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:ParticipantPermission},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:proto3.getEnumType(ParticipantInfo_Kind)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:proto3.getEnumType(DisconnectReason)}]),ParticipantInfo_State=proto3.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),ParticipantInfo_Kind=proto3.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),Encryption_Type=proto3.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),SimulcastCodecInfo=proto3.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:VideoLayer,repeated:!0}]),TrackInfo=proto3.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:proto3.getEnumType(TrackType)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:proto3.getEnumType(TrackSource)},{no:10,name:"layers",kind:"message",T:VideoLayer,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:SimulcastCodecInfo,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:proto3.getEnumType(Encryption_Type)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:TimedVersion},{no:19,name:"audio_features",kind:"enum",T:proto3.getEnumType(AudioTrackFeature),repeated:!0}]),VideoLayer=proto3.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:proto3.getEnumType(VideoQuality$1)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]),DataPacket=proto3.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:proto3.getEnumType(DataPacket_Kind)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:UserPacket,oneof:"value"},{no:3,name:"speaker",kind:"message",T:ActiveSpeakerUpdate,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:SipDTMF,oneof:"value"},{no:7,name:"transcription",kind:"message",T:Transcription,oneof:"value"},{no:8,name:"metrics",kind:"message",T:MetricsBatch,oneof:"value"}]),DataPacket_Kind=proto3.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),ActiveSpeakerUpdate=proto3.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:SpeakerInfo,repeated:!0}]),SpeakerInfo=proto3.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),UserPacket=proto3.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0}]),SipDTMF=proto3.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),Transcription=proto3.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:TranscriptionSegment,repeated:!0}]),TranscriptionSegment=proto3.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),ParticipantTracks=proto3.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),ServerInfo=proto3.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:proto3.getEnumType(ServerInfo_Edition)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),ServerInfo_Edition=proto3.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),ClientInfo=proto3.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:proto3.getEnumType(ClientInfo_SDK)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9}]),ClientInfo_SDK=proto3.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"}]),ClientConfiguration=proto3.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:VideoConfiguration},{no:2,name:"screen",kind:"message",T:VideoConfiguration},{no:3,name:"resume_connection",kind:"enum",T:proto3.getEnumType(ClientConfigSetting)},{no:4,name:"disabled_codecs",kind:"message",T:DisabledCodecs},{no:5,name:"force_relay",kind:"enum",T:proto3.getEnumType(ClientConfigSetting)}]),VideoConfiguration=proto3.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:proto3.getEnumType(ClientConfigSetting)}]),DisabledCodecs=proto3.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Codec,repeated:!0},{no:2,name:"publish",kind:"message",T:Codec,repeated:!0}]),TimedVersion=proto3.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),SignalTarget=proto3.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),StreamState=proto3.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),CandidateProtocol=proto3.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),SignalRequest=proto3.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:SessionDescription,oneof:"message"},{no:2,name:"answer",kind:"message",T:SessionDescription,oneof:"message"},{no:3,name:"trickle",kind:"message",T:TrickleRequest,oneof:"message"},{no:4,name:"add_track",kind:"message",T:AddTrackRequest,oneof:"message"},{no:5,name:"mute",kind:"message",T:MuteTrackRequest,oneof:"message"},{no:6,name:"subscription",kind:"message",T:UpdateSubscription,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:UpdateTrackSettings,oneof:"message"},{no:8,name:"leave",kind:"message",T:LeaveRequest,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:UpdateVideoLayers,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:SubscriptionPermission,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:SyncState,oneof:"message"},{no:13,name:"simulate",kind:"message",T:SimulateScenario,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:UpdateParticipantMetadata,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Ping,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:UpdateLocalAudioTrack,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:UpdateLocalVideoTrack,oneof:"message"}]),SignalResponse=proto3.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:JoinResponse,oneof:"message"},{no:2,name:"answer",kind:"message",T:SessionDescription,oneof:"message"},{no:3,name:"offer",kind:"message",T:SessionDescription,oneof:"message"},{no:4,name:"trickle",kind:"message",T:TrickleRequest,oneof:"message"},{no:5,name:"update",kind:"message",T:ParticipantUpdate,oneof:"message"},{no:6,name:"track_published",kind:"message",T:TrackPublishedResponse,oneof:"message"},{no:8,name:"leave",kind:"message",T:LeaveRequest,oneof:"message"},{no:9,name:"mute",kind:"message",T:MuteTrackRequest,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:SpeakersChanged,oneof:"message"},{no:11,name:"room_update",kind:"message",T:RoomUpdate,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:ConnectionQualityUpdate,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:StreamStateUpdate,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:SubscribedQualityUpdate,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:SubscriptionPermissionUpdate,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:TrackUnpublishedResponse,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:ReconnectResponse,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:Pong,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:SubscriptionResponse,oneof:"message"},{no:22,name:"request_response",kind:"message",T:RequestResponse,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:TrackSubscribed,oneof:"message"}]),SimulcastCodec=proto3.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),AddTrackRequest=proto3.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:proto3.getEnumType(TrackType)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:proto3.getEnumType(TrackSource)},{no:9,name:"layers",kind:"message",T:VideoLayer,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:SimulcastCodec,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:proto3.getEnumType(Encryption_Type)},{no:15,name:"stream",kind:"scalar",T:9}]),TrickleRequest=proto3.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:proto3.getEnumType(SignalTarget)},{no:3,name:"final",kind:"scalar",T:8}]),MuteTrackRequest=proto3.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),JoinResponse=proto3.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:Room$1},{no:2,name:"participant",kind:"message",T:ParticipantInfo},{no:3,name:"other_participants",kind:"message",T:ParticipantInfo,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:ICEServer,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:ClientConfiguration},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:ServerInfo},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Codec,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),ReconnectResponse=proto3.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:ICEServer,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:ClientConfiguration}]),TrackPublishedResponse=proto3.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:TrackInfo}]),TrackUnpublishedResponse=proto3.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),SessionDescription=proto3.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9}]),ParticipantUpdate=proto3.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:ParticipantInfo,repeated:!0}]),UpdateSubscription=proto3.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:ParticipantTracks,repeated:!0}]),UpdateTrackSettings=proto3.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:proto3.getEnumType(VideoQuality$1)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),UpdateLocalAudioTrack=proto3.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:proto3.getEnumType(AudioTrackFeature),repeated:!0}]),UpdateLocalVideoTrack=proto3.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),LeaveRequest=proto3.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:proto3.getEnumType(DisconnectReason)},{no:3,name:"action",kind:"enum",T:proto3.getEnumType(LeaveRequest_Action)},{no:4,name:"regions",kind:"message",T:RegionSettings}]),LeaveRequest_Action=proto3.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),UpdateVideoLayers=proto3.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:VideoLayer,repeated:!0}]),UpdateParticipantMetadata=proto3.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),ICEServer=proto3.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),SpeakersChanged=proto3.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:SpeakerInfo,repeated:!0}]),RoomUpdate=proto3.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:Room$1}]),ConnectionQualityInfo=proto3.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:proto3.getEnumType(ConnectionQuality$1)},{no:3,name:"score",kind:"scalar",T:2}]),ConnectionQualityUpdate=proto3.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:ConnectionQualityInfo,repeated:!0}]),StreamStateInfo=proto3.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:proto3.getEnumType(StreamState)}]),StreamStateUpdate=proto3.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:StreamStateInfo,repeated:!0}]),SubscribedQuality=proto3.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:proto3.getEnumType(VideoQuality$1)},{no:2,name:"enabled",kind:"scalar",T:8}]),SubscribedCodec=proto3.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:SubscribedQuality,repeated:!0}]),SubscribedQualityUpdate=proto3.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:SubscribedQuality,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:SubscribedCodec,repeated:!0}]),TrackPermission=proto3.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),SubscriptionPermission=proto3.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:TrackPermission,repeated:!0}]),SubscriptionPermissionUpdate=proto3.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),SyncState=proto3.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:SessionDescription},{no:2,name:"subscription",kind:"message",T:UpdateSubscription},{no:3,name:"publish_tracks",kind:"message",T:TrackPublishedResponse,repeated:!0},{no:4,name:"data_channels",kind:"message",T:DataChannelInfo,repeated:!0},{no:5,name:"offer",kind:"message",T:SessionDescription},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0}]),DataChannelInfo=proto3.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:proto3.getEnumType(SignalTarget)}]),SimulateScenario=proto3.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:proto3.getEnumType(CandidateProtocol),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),Ping=proto3.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),Pong=proto3.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),RegionSettings=proto3.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:RegionInfo,repeated:!0}]),RegionInfo=proto3.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),SubscriptionResponse=proto3.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:proto3.getEnumType(SubscriptionError)}]),RequestResponse=proto3.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:proto3.getEnumType(RequestResponse_Reason)},{no:3,name:"message",kind:"scalar",T:9}]),RequestResponse_Reason=proto3.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),TrackSubscribed=proto3.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof dist.global<"u"?dist.global:typeof self<"u"?self:{};function getDefaultExportFromCjs(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var loglevel={exports:{}};(function(s){(function(t,o){s.exports?s.exports=o():t.log=o()})(commonjsGlobal,function(){var t=function(){},o="undefined",e=typeof window!==o&&typeof window.navigator!==o&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"],a={},c=null;function l(k,O){var C=k[O];if(typeof C.bind=="function")return C.bind(k);try{return Function.prototype.bind.call(C,k)}catch{return function(){return Function.prototype.apply.apply(C,[k,arguments])}}}function u(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function d(k){return k==="debug"&&(k="log"),typeof console===o?!1:k==="trace"&&e?u:console[k]!==void 0?l(console,k):console.log!==void 0?l(console,"log"):t}function p(){for(var k=this.getLevel(),O=0;O<n.length;O++){var C=n[O];this[C]=O<k?t:this.methodFactory(C,k,this.name)}if(this.log=this.debug,typeof console===o&&k<this.levels.SILENT)return"No console available for logging"}function g(k){return function(){typeof console!==o&&(p.call(this),this[k].apply(this,arguments))}}function S(k,O,C){return d(k)||g.apply(this,arguments)}function y(k,O){var C=this,N,x,U,P="loglevel";typeof k=="string"?P+=":"+k:typeof k=="symbol"&&(P=void 0);function F(I){var B=(n[I]||"silent").toUpperCase();if(!(typeof window===o||!P)){try{window.localStorage[P]=B;return}catch{}try{window.document.cookie=encodeURIComponent(P)+"="+B+";"}catch{}}}function j(){var I;if(!(typeof window===o||!P)){try{I=window.localStorage[P]}catch{}if(typeof I===o)try{var B=window.document.cookie,Y=encodeURIComponent(P),z=B.indexOf(Y+"=");z!==-1&&(I=/^([^;]+)/.exec(B.slice(z+Y.length+1))[1])}catch{}return C.levels[I]===void 0&&(I=void 0),I}}function H(){if(!(typeof window===o||!P)){try{window.localStorage.removeItem(P)}catch{}try{window.document.cookie=encodeURIComponent(P)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function W(I){var B=I;if(typeof B=="string"&&C.levels[B.toUpperCase()]!==void 0&&(B=C.levels[B.toUpperCase()]),typeof B=="number"&&B>=0&&B<=C.levels.SILENT)return B;throw new TypeError("log.setLevel() called with invalid level: "+I)}C.name=k,C.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},C.methodFactory=O||S,C.getLevel=function(){return U??x??N},C.setLevel=function(I,B){return U=W(I),B!==!1&&F(U),p.call(C)},C.setDefaultLevel=function(I){x=W(I),j()||C.setLevel(I,!1)},C.resetLevel=function(){U=null,H(),p.call(C)},C.enableAll=function(I){C.setLevel(C.levels.TRACE,I)},C.disableAll=function(I){C.setLevel(C.levels.SILENT,I)},C.rebuild=function(){if(c!==C&&(N=W(c.getLevel())),p.call(C),c===C)for(var I in a)a[I].rebuild()},N=W(c?c.getLevel():"WARN");var Z=j();Z!=null&&(U=W(Z)),p.call(C)}c=new y,c.getLogger=function(O){if(typeof O!="symbol"&&typeof O!="string"||O==="")throw new TypeError("You must supply a name when creating a logger.");var C=a[O];return C||(C=a[O]=new y(O,c.methodFactory)),C};var b=typeof window!==o?window.log:void 0;return c.noConflict=function(){return typeof window!==o&&window.log===c&&(window.log=b),c},c.getLoggers=function(){return a},c.default=c,c})})(loglevel);var loglevelExports=loglevel.exports,LogLevel;(function(s){s[s.trace=0]="trace",s[s.debug=1]="debug",s[s.info=2]="info",s[s.warn=3]="warn",s[s.error=4]="error",s[s.silent=5]="silent"})(LogLevel||(LogLevel={}));var LoggerNames;(function(s){s.Default="livekit",s.Room="livekit-room",s.Participant="livekit-participant",s.Track="livekit-track",s.Publication="livekit-track-publication",s.Engine="livekit-engine",s.Signal="livekit-signal",s.PCManager="livekit-pc-manager",s.PCTransport="livekit-pc-transport",s.E2EE="lk-e2ee"})(LoggerNames||(LoggerNames={}));let livekitLogger=loglevelExports.getLogger("livekit");Object.values(LoggerNames).map(s=>loglevelExports.getLogger(s));livekitLogger.setDefaultLevel(LogLevel.info);function getLogger(s){const t=loglevelExports.getLogger(s);return t.setDefaultLevel(livekitLogger.getLevel()),t}const workerLogger=loglevelExports.getLogger("lk-e2ee"),maxRetryDelay=7e3,DEFAULT_RETRY_DELAYS_IN_MS=[0,300,2*2*300,3*3*300,4*4*300,maxRetryDelay,maxRetryDelay,maxRetryDelay,maxRetryDelay,maxRetryDelay];class DefaultReconnectPolicy{constructor(t){this._retryDelays=t!==void 0?[...t]:DEFAULT_RETRY_DELAYS_IN_MS}nextRetryDelayInMs(t){if(t.retryCount>=this._retryDelays.length)return null;const o=this._retryDelays[t.retryCount];return t.retryCount<=1?o:o+Math.random()*1e3}}function __awaiter(s,t,o,e){function n(a){return a instanceof o?a:new o(function(c){c(a)})}return new(o||(o=Promise))(function(a,c){function l(p){try{d(e.next(p))}catch(g){c(g)}}function u(p){try{d(e.throw(p))}catch(g){c(g)}}function d(p){p.done?a(p.value):n(p.value).then(l,u)}d((e=e.apply(s,t||[])).next())})}function __values(s){var t=typeof Symbol=="function"&&Symbol.iterator,o=t&&s[t],e=0;if(o)return o.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&e>=s.length&&(s=void 0),{value:s&&s[e++],done:!s}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function __asyncValues(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=s[Symbol.asyncIterator],o;return t?t.call(s):(s=typeof __values=="function"?__values(s):s[Symbol.iterator](),o={},e("next"),e("throw"),e("return"),o[Symbol.asyncIterator]=function(){return this},o);function e(a){o[a]=s[a]&&function(c){return new Promise(function(l,u){c=s[a](c),n(l,u,c.done,c.value)})}}function n(a,c,l,u){Promise.resolve(u).then(function(d){a({value:d,done:l})},c)}}typeof SuppressedError=="function"&&SuppressedError;var events={exports:{}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function(t,o,e){return Function.prototype.apply.call(t,o,e)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:ReflectOwnKeys=function(t){return Object.getOwnPropertyNames(t)};function ProcessEmitWarning(s){console&&console.warn&&console.warn(s)}var NumberIsNaN=Number.isNaN||function(t){return t!==t};function EventEmitter$1(){EventEmitter$1.init.call(this)}events.exports=EventEmitter$1;events.exports.once=once;EventEmitter$1.EventEmitter=EventEmitter$1;EventEmitter$1.prototype._events=void 0;EventEmitter$1.prototype._eventsCount=0;EventEmitter$1.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(s){if(typeof s!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof s)}Object.defineProperty(EventEmitter$1,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(s){if(typeof s!="number"||s<0||NumberIsNaN(s))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+s+".");defaultMaxListeners=s}});EventEmitter$1.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter$1.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||NumberIsNaN(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function _getMaxListeners(s){return s._maxListeners===void 0?EventEmitter$1.defaultMaxListeners:s._maxListeners}EventEmitter$1.prototype.getMaxListeners=function(){return _getMaxListeners(this)};EventEmitter$1.prototype.emit=function(t){for(var o=[],e=1;e<arguments.length;e++)o.push(arguments[e]);var n=t==="error",a=this._events;if(a!==void 0)n=n&&a.error===void 0;else if(!n)return!1;if(n){var c;if(o.length>0&&(c=o[0]),c instanceof Error)throw c;var l=new Error("Unhandled error."+(c?" ("+c.message+")":""));throw l.context=c,l}var u=a[t];if(u===void 0)return!1;if(typeof u=="function")ReflectApply(u,this,o);else for(var d=u.length,p=arrayClone(u,d),e=0;e<d;++e)ReflectApply(p[e],this,o);return!0};function _addListener(s,t,o,e){var n,a,c;if(checkListener(o),a=s._events,a===void 0?(a=s._events=Object.create(null),s._eventsCount=0):(a.newListener!==void 0&&(s.emit("newListener",t,o.listener?o.listener:o),a=s._events),c=a[t]),c===void 0)c=a[t]=o,++s._eventsCount;else if(typeof c=="function"?c=a[t]=e?[o,c]:[c,o]:e?c.unshift(o):c.push(o),n=_getMaxListeners(s),n>0&&c.length>n&&!c.warned){c.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=s,l.type=t,l.count=c.length,ProcessEmitWarning(l)}return s}EventEmitter$1.prototype.addListener=function(t,o){return _addListener(this,t,o,!1)};EventEmitter$1.prototype.on=EventEmitter$1.prototype.addListener;EventEmitter$1.prototype.prependListener=function(t,o){return _addListener(this,t,o,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(s,t,o){var e={fired:!1,wrapFn:void 0,target:s,type:t,listener:o},n=onceWrapper.bind(e);return n.listener=o,e.wrapFn=n,n}EventEmitter$1.prototype.once=function(t,o){return checkListener(o),this.on(t,_onceWrap(this,t,o)),this};EventEmitter$1.prototype.prependOnceListener=function(t,o){return checkListener(o),this.prependListener(t,_onceWrap(this,t,o)),this};EventEmitter$1.prototype.removeListener=function(t,o){var e,n,a,c,l;if(checkListener(o),n=this._events,n===void 0)return this;if(e=n[t],e===void 0)return this;if(e===o||e.listener===o)--this._eventsCount===0?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,e.listener||o));else if(typeof e!="function"){for(a=-1,c=e.length-1;c>=0;c--)if(e[c]===o||e[c].listener===o){l=e[c].listener,a=c;break}if(a<0)return this;a===0?e.shift():spliceOne(e,a),e.length===1&&(n[t]=e[0]),n.removeListener!==void 0&&this.emit("removeListener",t,l||o)}return this};EventEmitter$1.prototype.off=EventEmitter$1.prototype.removeListener;EventEmitter$1.prototype.removeAllListeners=function(t){var o,e,n;if(e=this._events,e===void 0)return this;if(e.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):e[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete e[t]),this;if(arguments.length===0){var a=Object.keys(e),c;for(n=0;n<a.length;++n)c=a[n],c!=="removeListener"&&this.removeAllListeners(c);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(o=e[t],typeof o=="function")this.removeListener(t,o);else if(o!==void 0)for(n=o.length-1;n>=0;n--)this.removeListener(t,o[n]);return this};function _listeners(s,t,o){var e=s._events;if(e===void 0)return[];var n=e[t];return n===void 0?[]:typeof n=="function"?o?[n.listener||n]:[n]:o?unwrapListeners(n):arrayClone(n,n.length)}EventEmitter$1.prototype.listeners=function(t){return _listeners(this,t,!0)};EventEmitter$1.prototype.rawListeners=function(t){return _listeners(this,t,!1)};EventEmitter$1.listenerCount=function(s,t){return typeof s.listenerCount=="function"?s.listenerCount(t):listenerCount.call(s,t)};EventEmitter$1.prototype.listenerCount=listenerCount;function listenerCount(s){var t=this._events;if(t!==void 0){var o=t[s];if(typeof o=="function")return 1;if(o!==void 0)return o.length}return 0}EventEmitter$1.prototype.eventNames=function(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(s,t){for(var o=new Array(t),e=0;e<t;++e)o[e]=s[e];return o}function spliceOne(s,t){for(;t+1<s.length;t++)s[t]=s[t+1];s.pop()}function unwrapListeners(s){for(var t=new Array(s.length),o=0;o<t.length;++o)t[o]=s[o].listener||s[o];return t}function once(s,t){return new Promise(function(o,e){function n(c){s.removeListener(t,a),e(c)}function a(){typeof s.removeListener=="function"&&s.removeListener("error",n),o([].slice.call(arguments))}eventTargetAgnosticAddListener(s,t,a,{once:!0}),t!=="error"&&addErrorHandlerIfEventEmitter(s,n,{once:!0})})}function addErrorHandlerIfEventEmitter(s,t,o){typeof s.on=="function"&&eventTargetAgnosticAddListener(s,"error",t,o)}function eventTargetAgnosticAddListener(s,t,o,e){if(typeof s.on=="function")e.once?s.once(t,o):s.on(t,o);else if(typeof s.addEventListener=="function")s.addEventListener(t,function n(a){e.once&&s.removeEventListener(t,n),o(a)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof s)}var eventsExports=events.exports;let logDisabled_=!0,deprecationWarnings_=!0;function extractVersion(s,t,o){const e=s.match(t);return e&&e.length>=o&&parseInt(e[o],10)}function wrapPeerConnectionEvent(s,t,o){if(!s.RTCPeerConnection)return;const e=s.RTCPeerConnection.prototype,n=e.addEventListener;e.addEventListener=function(c,l){if(c!==t)return n.apply(this,arguments);const u=d=>{const p=o(d);p&&(l.handleEvent?l.handleEvent(p):l(p))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(l,u),n.apply(this,[c,u])};const a=e.removeEventListener;e.removeEventListener=function(c,l){if(c!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(l))return a.apply(this,arguments);const u=this._eventMap[t].get(l);return this._eventMap[t].delete(l),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[c,u])},Object.defineProperty(e,"on"+t,{get(){return this["_on"+t]},set(c){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),c&&this.addEventListener(t,this["_on"+t]=c)},enumerable:!0,configurable:!0})}function disableLog(s){return typeof s!="boolean"?new Error("Argument type: "+typeof s+". Please use a boolean."):(logDisabled_=s,s?"adapter.js logging disabled":"adapter.js logging enabled")}function disableWarnings(s){return typeof s!="boolean"?new Error("Argument type: "+typeof s+". Please use a boolean."):(deprecationWarnings_=!s,"adapter.js deprecation warnings "+(s?"disabled":"enabled"))}function log$1(){if(typeof window=="object"){if(logDisabled_)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function deprecated(s,t){deprecationWarnings_&&console.warn(s+" is deprecated, please use "+t+" instead.")}function detectBrowser(s){const t={browser:null,version:null};if(typeof s>"u"||!s.navigator||!s.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:o}=s;if(o.userAgentData&&o.userAgentData.brands){const e=o.userAgentData.brands.find(n=>n.brand==="Chromium");if(e)return{browser:"chrome",version:parseInt(e.version,10)}}if(o.mozGetUserMedia)t.browser="firefox",t.version=extractVersion(o.userAgent,/Firefox\/(\d+)\./,1);else if(o.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)t.browser="chrome",t.version=extractVersion(o.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(s.RTCPeerConnection&&o.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=extractVersion(o.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}function isObject(s){return Object.prototype.toString.call(s)==="[object Object]"}function compactObject(s){return isObject(s)?Object.keys(s).reduce(function(t,o){const e=isObject(s[o]),n=e?compactObject(s[o]):s[o],a=e&&!Object.keys(n).length;return n===void 0||a?t:Object.assign(t,{[o]:n})},{}):s}function walkStats(s,t,o){!t||o.has(t.id)||(o.set(t.id,t),Object.keys(t).forEach(e=>{e.endsWith("Id")?walkStats(s,s.get(t[e]),o):e.endsWith("Ids")&&t[e].forEach(n=>{walkStats(s,s.get(n),o)})}))}function filterStats(s,t,o){const e=o?"outbound-rtp":"inbound-rtp",n=new Map;if(t===null)return n;const a=[];return s.forEach(c=>{c.type==="track"&&c.trackIdentifier===t.id&&a.push(c)}),a.forEach(c=>{s.forEach(l=>{l.type===e&&l.trackId===c.id&&walkStats(s,l,n)})}),n}const logging=log$1;function shimGetUserMedia$2(s,t){const o=s&&s.navigator;if(!o.mediaDevices)return;const e=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const u={};return Object.keys(l).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const p=typeof l[d]=="object"?l[d]:{ideal:l[d]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);const g=function(S,y){return S?S+y.charAt(0).toUpperCase()+y.slice(1):y==="deviceId"?"sourceId":y};if(p.ideal!==void 0){u.optional=u.optional||[];let S={};typeof p.ideal=="number"?(S[g("min",d)]=p.ideal,u.optional.push(S),S={},S[g("max",d)]=p.ideal,u.optional.push(S)):(S[g("",d)]=p.ideal,u.optional.push(S))}p.exact!==void 0&&typeof p.exact!="number"?(u.mandatory=u.mandatory||{},u.mandatory[g("",d)]=p.exact):["min","max"].forEach(S=>{p[S]!==void 0&&(u.mandatory=u.mandatory||{},u.mandatory[g(S,d)]=p[S])})}),l.advanced&&(u.optional=(u.optional||[]).concat(l.advanced)),u},n=function(l,u){if(t.version>=61)return u(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const d=function(p,g,S){g in p&&!(S in p)&&(p[S]=p[g],delete p[g])};l=JSON.parse(JSON.stringify(l)),d(l.audio,"autoGainControl","googAutoGainControl"),d(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=e(l.audio)}if(l&&typeof l.video=="object"){let d=l.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const p=t.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&!(o.mediaDevices.getSupportedConstraints&&o.mediaDevices.getSupportedConstraints().facingMode&&!p)){delete l.video.facingMode;let g;if(d.exact==="environment"||d.ideal==="environment"?g=["back","rear"]:(d.exact==="user"||d.ideal==="user")&&(g=["front"]),g)return o.mediaDevices.enumerateDevices().then(S=>{S=S.filter(b=>b.kind==="videoinput");let y=S.find(b=>g.some(k=>b.label.toLowerCase().includes(k)));return!y&&S.length&&g.includes("back")&&(y=S[S.length-1]),y&&(l.video.deviceId=d.exact?{exact:y.deviceId}:{ideal:y.deviceId}),l.video=e(l.video),logging("chrome: "+JSON.stringify(l)),u(l)})}l.video=e(l.video)}return logging("chrome: "+JSON.stringify(l)),u(l)},a=function(l){return t.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},c=function(l,u,d){n(l,p=>{o.webkitGetUserMedia(p,u,g=>{d&&d(a(g))})})};if(o.getUserMedia=c.bind(o),o.mediaDevices.getUserMedia){const l=o.mediaDevices.getUserMedia.bind(o.mediaDevices);o.mediaDevices.getUserMedia=function(u){return n(u,d=>l(d).then(p=>{if(d.audio&&!p.getAudioTracks().length||d.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(g=>{g.stop()}),new DOMException("","NotFoundError");return p},p=>Promise.reject(a(p))))}}}function shimMediaStream(s){s.MediaStream=s.MediaStream||s.webkitMediaStream}function shimOnTrack$1(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("ontrack"in s.RTCPeerConnection.prototype)){Object.defineProperty(s.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(o){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=o)},enumerable:!0,configurable:!0});const t=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=e=>{e.stream.addEventListener("addtrack",n=>{let a;s.RTCPeerConnection.prototype.getReceivers?a=this.getReceivers().find(l=>l.track&&l.track.id===n.track.id):a={track:n.track};const c=new Event("track");c.track=n.track,c.receiver=a,c.transceiver={receiver:a},c.streams=[e.stream],this.dispatchEvent(c)}),e.stream.getTracks().forEach(n=>{let a;s.RTCPeerConnection.prototype.getReceivers?a=this.getReceivers().find(l=>l.track&&l.track.id===n.id):a={track:n};const c=new Event("track");c.track=n,c.receiver=a,c.transceiver={receiver:a},c.streams=[e.stream],this.dispatchEvent(c)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else wrapPeerConnectionEvent(s,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function shimGetSendersWithDtmf(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("getSenders"in s.RTCPeerConnection.prototype)&&"createDTMFSender"in s.RTCPeerConnection.prototype){const t=function(n,a){return{track:a,get dtmf(){return this._dtmf===void 0&&(a.kind==="audio"?this._dtmf=n.createDTMFSender(a):this._dtmf=null),this._dtmf},_pc:n}};if(!s.RTCPeerConnection.prototype.getSenders){s.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(l,u){let d=n.apply(this,arguments);return d||(d=t(this,l),this._senders.push(d)),d};const a=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(l){a.apply(this,arguments);const u=this._senders.indexOf(l);u!==-1&&this._senders.splice(u,1)}}const o=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(a){this._senders=this._senders||[],o.apply(this,[a]),a.getTracks().forEach(c=>{this._senders.push(t(this,c))})};const e=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(a){this._senders=this._senders||[],e.apply(this,[a]),a.getTracks().forEach(c=>{const l=this._senders.find(u=>u.track===c);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof s=="object"&&s.RTCPeerConnection&&"getSenders"in s.RTCPeerConnection.prototype&&"createDTMFSender"in s.RTCPeerConnection.prototype&&s.RTCRtpSender&&!("dtmf"in s.RTCRtpSender.prototype)){const t=s.RTCPeerConnection.prototype.getSenders;s.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(n=>n._pc=this),e},Object.defineProperty(s.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function shimSenderReceiverGetStats(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender&&s.RTCRtpReceiver))return;if(!("getStats"in s.RTCRtpSender.prototype)){const o=s.RTCPeerConnection.prototype.getSenders;o&&(s.RTCPeerConnection.prototype.getSenders=function(){const a=o.apply(this,[]);return a.forEach(c=>c._pc=this),a});const e=s.RTCPeerConnection.prototype.addTrack;e&&(s.RTCPeerConnection.prototype.addTrack=function(){const a=e.apply(this,arguments);return a._pc=this,a}),s.RTCRtpSender.prototype.getStats=function(){const a=this;return this._pc.getStats().then(c=>filterStats(c,a.track,!0))}}if(!("getStats"in s.RTCRtpReceiver.prototype)){const o=s.RTCPeerConnection.prototype.getReceivers;o&&(s.RTCPeerConnection.prototype.getReceivers=function(){const n=o.apply(this,[]);return n.forEach(a=>a._pc=this),n}),wrapPeerConnectionEvent(s,"track",e=>(e.receiver._pc=e.srcElement,e)),s.RTCRtpReceiver.prototype.getStats=function(){const n=this;return this._pc.getStats().then(a=>filterStats(a,n.track,!1))}}if(!("getStats"in s.RTCRtpSender.prototype&&"getStats"in s.RTCRtpReceiver.prototype))return;const t=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof s.MediaStreamTrack){const e=arguments[0];let n,a,c;return this.getSenders().forEach(l=>{l.track===e&&(n?c=!0:n=l)}),this.getReceivers().forEach(l=>(l.track===e&&(a?c=!0:a=l),l.track===e)),c||n&&a?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():a?a.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function shimAddTrackRemoveTrackWithNative(s){s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(c=>this._shimmedLocalStreams[c][0])};const t=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(c,l){if(!l)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const u=t.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(u)===-1&&this._shimmedLocalStreams[l.id].push(u):this._shimmedLocalStreams[l.id]=[l,u],u};const o=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(c){this._shimmedLocalStreams=this._shimmedLocalStreams||{},c.getTracks().forEach(d=>{if(this.getSenders().find(g=>g.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();o.apply(this,arguments);const u=this.getSenders().filter(d=>l.indexOf(d)===-1);this._shimmedLocalStreams[c.id]=[c].concat(u)};const e=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[c.id],e.apply(this,arguments)};const n=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},c&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const u=this._shimmedLocalStreams[l].indexOf(c);u!==-1&&this._shimmedLocalStreams[l].splice(u,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),n.apply(this,arguments)}}function shimAddTrackRemoveTrack(s,t){if(!s.RTCPeerConnection)return;if(s.RTCPeerConnection.prototype.addTrack&&t.version>=65)return shimAddTrackRemoveTrackWithNative(s);const o=s.RTCPeerConnection.prototype.getLocalStreams;s.RTCPeerConnection.prototype.getLocalStreams=function(){const p=o.apply(this);return this._reverseStreams=this._reverseStreams||{},p.map(g=>this._reverseStreams[g.id])};const e=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(p){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},p.getTracks().forEach(g=>{if(this.getSenders().find(y=>y.track===g))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[p.id]){const g=new s.MediaStream(p.getTracks());this._streams[p.id]=g,this._reverseStreams[g.id]=p,p=g}e.apply(this,[p])};const n=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(p){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[p.id]||p]),delete this._reverseStreams[this._streams[p.id]?this._streams[p.id].id:p.id],delete this._streams[p.id]},s.RTCPeerConnection.prototype.addTrack=function(p,g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const S=[].slice.call(arguments,1);if(S.length!==1||!S[0].getTracks().find(k=>k===p))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(k=>k.track===p))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const b=this._streams[g.id];if(b)b.addTrack(p),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const k=new s.MediaStream([p]);this._streams[g.id]=k,this._reverseStreams[k.id]=g,this.addStream(k)}return this.getSenders().find(k=>k.track===p)};function a(d,p){let g=p.sdp;return Object.keys(d._reverseStreams||[]).forEach(S=>{const y=d._reverseStreams[S],b=d._streams[y.id];g=g.replace(new RegExp(b.id,"g"),y.id)}),new RTCSessionDescription({type:p.type,sdp:g})}function c(d,p){let g=p.sdp;return Object.keys(d._reverseStreams||[]).forEach(S=>{const y=d._reverseStreams[S],b=d._streams[y.id];g=g.replace(new RegExp(y.id,"g"),b.id)}),new RTCSessionDescription({type:p.type,sdp:g})}["createOffer","createAnswer"].forEach(function(d){const p=s.RTCPeerConnection.prototype[d],g={[d](){const S=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[b=>{const k=a(this,b);S[0].apply(null,[k])},b=>{S[1]&&S[1].apply(null,b)},arguments[2]]):p.apply(this,arguments).then(b=>a(this,b))}};s.RTCPeerConnection.prototype[d]=g[d]});const l=s.RTCPeerConnection.prototype.setLocalDescription;s.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=c(this,arguments[0]),l.apply(this,arguments))};const u=Object.getOwnPropertyDescriptor(s.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(s.RTCPeerConnection.prototype,"localDescription",{get(){const d=u.get.apply(this);return d.type===""?d:a(this,d)}}),s.RTCPeerConnection.prototype.removeTrack=function(p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!p._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(p._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let S;Object.keys(this._streams).forEach(y=>{this._streams[y].getTracks().find(k=>p.track===k)&&(S=this._streams[y])}),S&&(S.getTracks().length===1?this.removeStream(this._reverseStreams[S.id]):S.removeTrack(p.track),this.dispatchEvent(new Event("negotiationneeded")))}}function shimPeerConnection$1(s,t){!s.RTCPeerConnection&&s.webkitRTCPeerConnection&&(s.RTCPeerConnection=s.webkitRTCPeerConnection),s.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const e=s.RTCPeerConnection.prototype[o],n={[o](){return arguments[0]=new(o==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),e.apply(this,arguments)}};s.RTCPeerConnection.prototype[o]=n[o]})}function fixNegotiationNeeded(s,t){wrapPeerConnectionEvent(s,"negotiationneeded",o=>{const e=o.target;if(!((t.version<72||e.getConfiguration&&e.getConfiguration().sdpSemantics==="plan-b")&&e.signalingState!=="stable"))return o})}var chromeShim=Object.freeze({__proto__:null,fixNegotiationNeeded,shimAddTrackRemoveTrack,shimAddTrackRemoveTrackWithNative,shimGetSendersWithDtmf,shimGetUserMedia:shimGetUserMedia$2,shimMediaStream,shimOnTrack:shimOnTrack$1,shimPeerConnection:shimPeerConnection$1,shimSenderReceiverGetStats});function shimGetUserMedia$1(s,t){const o=s&&s.navigator,e=s&&s.MediaStreamTrack;if(o.getUserMedia=function(n,a,c){deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),o.mediaDevices.getUserMedia(n).then(a,c)},!(t.version>55&&"autoGainControl"in o.mediaDevices.getSupportedConstraints())){const n=function(c,l,u){l in c&&!(u in c)&&(c[u]=c[l],delete c[l])},a=o.mediaDevices.getUserMedia.bind(o.mediaDevices);if(o.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),n(c.audio,"autoGainControl","mozAutoGainControl"),n(c.audio,"noiseSuppression","mozNoiseSuppression")),a(c)},e&&e.prototype.getSettings){const c=e.prototype.getSettings;e.prototype.getSettings=function(){const l=c.apply(this,arguments);return n(l,"mozAutoGainControl","autoGainControl"),n(l,"mozNoiseSuppression","noiseSuppression"),l}}if(e&&e.prototype.applyConstraints){const c=e.prototype.applyConstraints;e.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),n(l,"autoGainControl","mozAutoGainControl"),n(l,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[l])}}}}function shimGetDisplayMedia(s,t){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&(s.navigator.mediaDevices.getDisplayMedia=function(e){if(!(e&&e.video)){const n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return e.video===!0?e.video={mediaSource:t}:e.video.mediaSource=t,s.navigator.mediaDevices.getUserMedia(e)})}function shimOnTrack(s){typeof s=="object"&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function shimPeerConnection(s,t){if(typeof s!="object"||!(s.RTCPeerConnection||s.mozRTCPeerConnection))return;!s.RTCPeerConnection&&s.mozRTCPeerConnection&&(s.RTCPeerConnection=s.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const a=s.RTCPeerConnection.prototype[n],c={[n](){return arguments[0]=new(n==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};s.RTCPeerConnection.prototype[n]=c[n]});const o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},e=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[a,c,l]=arguments;return e.apply(this,[a||null]).then(u=>{if(t.version<53&&!c)try{u.forEach(d=>{d.type=o[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;u.forEach((p,g)=>{u.set(g,Object.assign({},p,{type:o[p.type]||p.type}))})}return u}).then(c,l)}}function shimSenderGetStats(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender)||s.RTCRtpSender&&"getStats"in s.RTCRtpSender.prototype)return;const t=s.RTCPeerConnection.prototype.getSenders;t&&(s.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(a=>a._pc=this),n});const o=s.RTCPeerConnection.prototype.addTrack;o&&(s.RTCPeerConnection.prototype.addTrack=function(){const n=o.apply(this,arguments);return n._pc=this,n}),s.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function shimReceiverGetStats(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender)||s.RTCRtpSender&&"getStats"in s.RTCRtpReceiver.prototype)return;const t=s.RTCPeerConnection.prototype.getReceivers;t&&(s.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(n=>n._pc=this),e}),wrapPeerConnectionEvent(s,"track",o=>(o.receiver._pc=o.srcElement,o)),s.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function shimRemoveStream(s){!s.RTCPeerConnection||"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(o){deprecated("removeStream","removeTrack"),this.getSenders().forEach(e=>{e.track&&o.getTracks().includes(e.track)&&this.removeTrack(e)})})}function shimRTCDataChannel(s){s.DataChannel&&!s.RTCDataChannel&&(s.RTCDataChannel=s.DataChannel)}function shimAddTransceiver(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const t=s.RTCPeerConnection.prototype.addTransceiver;t&&(s.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;e===void 0&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach(c=>{if("rid"in c&&!/^[a-z0-9]{0,16}$/i.test(c.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in c&&!(parseFloat(c.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in c&&!(parseFloat(c.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const a=t.apply(this,arguments);if(n){const{sender:c}=a,l=c.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=e,c.sendEncodings=e,this.setParametersPromises.push(c.setParameters(l).then(()=>{delete c.sendEncodings}).catch(()=>{delete c.sendEncodings})))}return a})}function shimGetParameters(s){if(!(typeof s=="object"&&s.RTCRtpSender))return;const t=s.RTCRtpSender.prototype.getParameters;t&&(s.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function shimCreateOffer(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const t=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function shimCreateAnswer(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const t=s.RTCPeerConnection.prototype.createAnswer;s.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var firefoxShim=Object.freeze({__proto__:null,shimAddTransceiver,shimCreateAnswer,shimCreateOffer,shimGetDisplayMedia,shimGetParameters,shimGetUserMedia:shimGetUserMedia$1,shimOnTrack,shimPeerConnection,shimRTCDataChannel,shimReceiverGetStats,shimRemoveStream,shimSenderGetStats});function shimLocalStreamsAPI(s){if(!(typeof s!="object"||!s.RTCPeerConnection)){if("getLocalStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in s.RTCPeerConnection.prototype)){const t=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(n=>t.call(this,n,e)),e.getVideoTracks().forEach(n=>t.call(this,n,e))},s.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,a=new Array(n>1?n-1:0),c=1;c<n;c++)a[c-1]=arguments[c];return a&&a.forEach(l=>{this._localStreams?this._localStreams.includes(l)||this._localStreams.push(l):this._localStreams=[l]}),t.apply(this,arguments)}}"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(o){this._localStreams||(this._localStreams=[]);const e=this._localStreams.indexOf(o);if(e===-1)return;this._localStreams.splice(e,1);const n=o.getTracks();this.getSenders().forEach(a=>{n.includes(a.track)&&this.removeTrack(a)})})}}function shimRemoteStreamsAPI(s){if(!(typeof s!="object"||!s.RTCPeerConnection)&&("getRemoteStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in s.RTCPeerConnection.prototype))){Object.defineProperty(s.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(o){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=o),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(n=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(n))return;this._remoteStreams.push(n);const a=new Event("addstream");a.stream=n,this.dispatchEvent(a)})})}});const t=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(a=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(a)>=0)return;e._remoteStreams.push(a);const c=new Event("addstream");c.stream=a,e.dispatchEvent(c)})}),t.apply(e,arguments)}}}function shimCallbacksAPI(s){if(typeof s!="object"||!s.RTCPeerConnection)return;const t=s.RTCPeerConnection.prototype,o=t.createOffer,e=t.createAnswer,n=t.setLocalDescription,a=t.setRemoteDescription,c=t.addIceCandidate;t.createOffer=function(d,p){const g=arguments.length>=2?arguments[2]:arguments[0],S=o.apply(this,[g]);return p?(S.then(d,p),Promise.resolve()):S},t.createAnswer=function(d,p){const g=arguments.length>=2?arguments[2]:arguments[0],S=e.apply(this,[g]);return p?(S.then(d,p),Promise.resolve()):S};let l=function(u,d,p){const g=n.apply(this,[u]);return p?(g.then(d,p),Promise.resolve()):g};t.setLocalDescription=l,l=function(u,d,p){const g=a.apply(this,[u]);return p?(g.then(d,p),Promise.resolve()):g},t.setRemoteDescription=l,l=function(u,d,p){const g=c.apply(this,[u]);return p?(g.then(d,p),Promise.resolve()):g},t.addIceCandidate=l}function shimGetUserMedia(s){const t=s&&s.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const o=t.mediaDevices,e=o.getUserMedia.bind(o);t.mediaDevices.getUserMedia=n=>e(shimConstraints(n))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(e,n,a){t.mediaDevices.getUserMedia(e).then(n,a)}).bind(t))}function shimConstraints(s){return s&&s.video!==void 0?Object.assign({},s,{video:compactObject(s.video)}):s}function shimRTCIceServerUrls(s){if(!s.RTCPeerConnection)return;const t=s.RTCPeerConnection;s.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const a=[];for(let c=0;c<e.iceServers.length;c++){let l=e.iceServers[c];l.urls===void 0&&l.url?(deprecated("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,a.push(l)):a.push(e.iceServers[c])}e.iceServers=a}return new t(e,n)},s.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(s.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function shimTrackEventTransceiver(s){typeof s=="object"&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function shimCreateOfferLegacy(s){const t=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(e){if(e){typeof e.offerToReceiveAudio<"u"&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const n=this.getTransceivers().find(c=>c.receiver.track.kind==="audio");e.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):e.offerToReceiveAudio===!0&&!n&&this.addTransceiver("audio",{direction:"recvonly"}),typeof e.offerToReceiveVideo<"u"&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const a=this.getTransceivers().find(c=>c.receiver.track.kind==="video");e.offerToReceiveVideo===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):e.offerToReceiveVideo===!0&&!a&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function shimAudioContext(s){typeof s!="object"||s.AudioContext||(s.AudioContext=s.webkitAudioContext)}var safariShim=Object.freeze({__proto__:null,shimAudioContext,shimCallbacksAPI,shimConstraints,shimCreateOfferLegacy,shimGetUserMedia,shimLocalStreamsAPI,shimRTCIceServerUrls,shimRemoteStreamsAPI,shimTrackEventTransceiver}),sdp$1={exports:{}};(function(s){const t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(o){return o.trim().split(`
`).map(e=>e.trim())},t.splitSections=function(o){return o.split(`
m=`).map((n,a)=>(a>0?"m="+n:n).trim()+`\r
`)},t.getDescription=function(o){const e=t.splitSections(o);return e&&e[0]},t.getMediaSections=function(o){const e=t.splitSections(o);return e.shift(),e},t.matchPrefix=function(o,e){return t.splitLines(o).filter(n=>n.indexOf(e)===0)},t.parseCandidate=function(o){let e;o.indexOf("a=candidate:")===0?e=o.substring(12).split(" "):e=o.substring(10).split(" ");const n={foundation:e[0],component:{1:"rtp",2:"rtcp"}[e[1]]||e[1],protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],address:e[4],port:parseInt(e[5],10),type:e[7]};for(let a=8;a<e.length;a+=2)switch(e[a]){case"raddr":n.relatedAddress=e[a+1];break;case"rport":n.relatedPort=parseInt(e[a+1],10);break;case"tcptype":n.tcpType=e[a+1];break;case"ufrag":n.ufrag=e[a+1],n.usernameFragment=e[a+1];break;default:n[e[a]]===void 0&&(n[e[a]]=e[a+1]);break}return n},t.writeCandidate=function(o){const e=[];e.push(o.foundation);const n=o.component;n==="rtp"?e.push(1):n==="rtcp"?e.push(2):e.push(n),e.push(o.protocol.toUpperCase()),e.push(o.priority),e.push(o.address||o.ip),e.push(o.port);const a=o.type;return e.push("typ"),e.push(a),a!=="host"&&o.relatedAddress&&o.relatedPort&&(e.push("raddr"),e.push(o.relatedAddress),e.push("rport"),e.push(o.relatedPort)),o.tcpType&&o.protocol.toLowerCase()==="tcp"&&(e.push("tcptype"),e.push(o.tcpType)),(o.usernameFragment||o.ufrag)&&(e.push("ufrag"),e.push(o.usernameFragment||o.ufrag)),"candidate:"+e.join(" ")},t.parseIceOptions=function(o){return o.substring(14).split(" ")},t.parseRtpMap=function(o){let e=o.substring(9).split(" ");const n={payloadType:parseInt(e.shift(),10)};return e=e[0].split("/"),n.name=e[0],n.clockRate=parseInt(e[1],10),n.channels=e.length===3?parseInt(e[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(o){let e=o.payloadType;o.preferredPayloadType!==void 0&&(e=o.preferredPayloadType);const n=o.channels||o.numChannels||1;return"a=rtpmap:"+e+" "+o.name+"/"+o.clockRate+(n!==1?"/"+n:"")+`\r
`},t.parseExtmap=function(o){const e=o.substring(9).split(" ");return{id:parseInt(e[0],10),direction:e[0].indexOf("/")>0?e[0].split("/")[1]:"sendrecv",uri:e[1],attributes:e.slice(2).join(" ")}},t.writeExtmap=function(o){return"a=extmap:"+(o.id||o.preferredId)+(o.direction&&o.direction!=="sendrecv"?"/"+o.direction:"")+" "+o.uri+(o.attributes?" "+o.attributes:"")+`\r
`},t.parseFmtp=function(o){const e={};let n;const a=o.substring(o.indexOf(" ")+1).split(";");for(let c=0;c<a.length;c++)n=a[c].trim().split("="),e[n[0].trim()]=n[1];return e},t.writeFmtp=function(o){let e="",n=o.payloadType;if(o.preferredPayloadType!==void 0&&(n=o.preferredPayloadType),o.parameters&&Object.keys(o.parameters).length){const a=[];Object.keys(o.parameters).forEach(c=>{o.parameters[c]!==void 0?a.push(c+"="+o.parameters[c]):a.push(c)}),e+="a=fmtp:"+n+" "+a.join(";")+`\r
`}return e},t.parseRtcpFb=function(o){const e=o.substring(o.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}},t.writeRtcpFb=function(o){let e="",n=o.payloadType;return o.preferredPayloadType!==void 0&&(n=o.preferredPayloadType),o.rtcpFeedback&&o.rtcpFeedback.length&&o.rtcpFeedback.forEach(a=>{e+="a=rtcp-fb:"+n+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+`\r
`}),e},t.parseSsrcMedia=function(o){const e=o.indexOf(" "),n={ssrc:parseInt(o.substring(7,e),10)},a=o.indexOf(":",e);return a>-1?(n.attribute=o.substring(e+1,a),n.value=o.substring(a+1)):n.attribute=o.substring(e+1),n},t.parseSsrcGroup=function(o){const e=o.substring(13).split(" ");return{semantics:e.shift(),ssrcs:e.map(n=>parseInt(n,10))}},t.getMid=function(o){const e=t.matchPrefix(o,"a=mid:")[0];if(e)return e.substring(6)},t.parseFingerprint=function(o){const e=o.substring(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1].toUpperCase()}},t.getDtlsParameters=function(o,e){return{role:"auto",fingerprints:t.matchPrefix(o+e,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(o,e){let n="a=setup:"+e+`\r
`;return o.fingerprints.forEach(a=>{n+="a=fingerprint:"+a.algorithm+" "+a.value+`\r
`}),n},t.parseCryptoLine=function(o){const e=o.substring(9).split(" ");return{tag:parseInt(e[0],10),cryptoSuite:e[1],keyParams:e[2],sessionParams:e.slice(3)}},t.writeCryptoLine=function(o){return"a=crypto:"+o.tag+" "+o.cryptoSuite+" "+(typeof o.keyParams=="object"?t.writeCryptoKeyParams(o.keyParams):o.keyParams)+(o.sessionParams?" "+o.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(o){if(o.indexOf("inline:")!==0)return null;const e=o.substring(7).split("|");return{keyMethod:"inline",keySalt:e[0],lifeTime:e[1],mkiValue:e[2]?e[2].split(":")[0]:void 0,mkiLength:e[2]?e[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(o){return o.keyMethod+":"+o.keySalt+(o.lifeTime?"|"+o.lifeTime:"")+(o.mkiValue&&o.mkiLength?"|"+o.mkiValue+":"+o.mkiLength:"")},t.getCryptoParameters=function(o,e){return t.matchPrefix(o+e,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(o,e){const n=t.matchPrefix(o+e,"a=ice-ufrag:")[0],a=t.matchPrefix(o+e,"a=ice-pwd:")[0];return n&&a?{usernameFragment:n.substring(12),password:a.substring(10)}:null},t.writeIceParameters=function(o){let e="a=ice-ufrag:"+o.usernameFragment+`\r
a=ice-pwd:`+o.password+`\r
`;return o.iceLite&&(e+=`a=ice-lite\r
`),e},t.parseRtpParameters=function(o){const e={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},a=t.splitLines(o)[0].split(" ");e.profile=a[2];for(let l=3;l<a.length;l++){const u=a[l],d=t.matchPrefix(o,"a=rtpmap:"+u+" ")[0];if(d){const p=t.parseRtpMap(d),g=t.matchPrefix(o,"a=fmtp:"+u+" ");switch(p.parameters=g.length?t.parseFmtp(g[0]):{},p.rtcpFeedback=t.matchPrefix(o,"a=rtcp-fb:"+u+" ").map(t.parseRtcpFb),e.codecs.push(p),p.name.toUpperCase()){case"RED":case"ULPFEC":e.fecMechanisms.push(p.name.toUpperCase());break}}}t.matchPrefix(o,"a=extmap:").forEach(l=>{e.headerExtensions.push(t.parseExtmap(l))});const c=t.matchPrefix(o,"a=rtcp-fb:* ").map(t.parseRtcpFb);return e.codecs.forEach(l=>{c.forEach(u=>{l.rtcpFeedback.find(p=>p.type===u.type&&p.parameter===u.parameter)||l.rtcpFeedback.push(u)})}),e},t.writeRtpDescription=function(o,e){let n="";n+="m="+o+" ",n+=e.codecs.length>0?"9":"0",n+=" "+(e.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=e.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,e.codecs.forEach(c=>{n+=t.writeRtpMap(c),n+=t.writeFmtp(c),n+=t.writeRtcpFb(c)});let a=0;return e.codecs.forEach(c=>{c.maxptime>a&&(a=c.maxptime)}),a>0&&(n+="a=maxptime:"+a+`\r
`),e.headerExtensions&&e.headerExtensions.forEach(c=>{n+=t.writeExtmap(c)}),n},t.parseRtpEncodingParameters=function(o){const e=[],n=t.parseRtpParameters(o),a=n.fecMechanisms.indexOf("RED")!==-1,c=n.fecMechanisms.indexOf("ULPFEC")!==-1,l=t.matchPrefix(o,"a=ssrc:").map(S=>t.parseSsrcMedia(S)).filter(S=>S.attribute==="cname"),u=l.length>0&&l[0].ssrc;let d;const p=t.matchPrefix(o,"a=ssrc-group:FID").map(S=>S.substring(17).split(" ").map(b=>parseInt(b,10)));p.length>0&&p[0].length>1&&p[0][0]===u&&(d=p[0][1]),n.codecs.forEach(S=>{if(S.name.toUpperCase()==="RTX"&&S.parameters.apt){let y={ssrc:u,codecPayloadType:parseInt(S.parameters.apt,10)};u&&d&&(y.rtx={ssrc:d}),e.push(y),a&&(y=JSON.parse(JSON.stringify(y)),y.fec={ssrc:u,mechanism:c?"red+ulpfec":"red"},e.push(y))}}),e.length===0&&u&&e.push({ssrc:u});let g=t.matchPrefix(o,"b=");return g.length&&(g[0].indexOf("b=TIAS:")===0?g=parseInt(g[0].substring(7),10):g[0].indexOf("b=AS:")===0?g=parseInt(g[0].substring(5),10)*1e3*.95-50*40*8:g=void 0,e.forEach(S=>{S.maxBitrate=g})),e},t.parseRtcpParameters=function(o){const e={},n=t.matchPrefix(o,"a=ssrc:").map(l=>t.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];n&&(e.cname=n.value,e.ssrc=n.ssrc);const a=t.matchPrefix(o,"a=rtcp-rsize");e.reducedSize=a.length>0,e.compound=a.length===0;const c=t.matchPrefix(o,"a=rtcp-mux");return e.mux=c.length>0,e},t.writeRtcpParameters=function(o){let e="";return o.reducedSize&&(e+=`a=rtcp-rsize\r
`),o.mux&&(e+=`a=rtcp-mux\r
`),o.ssrc!==void 0&&o.cname&&(e+="a=ssrc:"+o.ssrc+" cname:"+o.cname+`\r
`),e},t.parseMsid=function(o){let e;const n=t.matchPrefix(o,"a=msid:");if(n.length===1)return e=n[0].substring(7).split(" "),{stream:e[0],track:e[1]};const a=t.matchPrefix(o,"a=ssrc:").map(c=>t.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");if(a.length>0)return e=a[0].value.split(" "),{stream:e[0],track:e[1]}},t.parseSctpDescription=function(o){const e=t.parseMLine(o),n=t.matchPrefix(o,"a=max-message-size:");let a;n.length>0&&(a=parseInt(n[0].substring(19),10)),isNaN(a)&&(a=65536);const c=t.matchPrefix(o,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substring(12),10),protocol:e.fmt,maxMessageSize:a};const l=t.matchPrefix(o,"a=sctpmap:");if(l.length>0){const u=l[0].substring(10).split(" ");return{port:parseInt(u[0],10),protocol:u[1],maxMessageSize:a}}},t.writeSctpDescription=function(o,e){let n=[];return o.protocol!=="DTLS/SCTP"?n=["m="+o.kind+" 9 "+o.protocol+" "+e.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+e.port+`\r
`]:n=["m="+o.kind+" 9 "+o.protocol+" "+e.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+e.port+" "+e.protocol+` 65535\r
`],e.maxMessageSize!==void 0&&n.push("a=max-message-size:"+e.maxMessageSize+`\r
`),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(o,e,n){let a;const c=e!==void 0?e:2;return o?a=o:a=t.generateSessionId(),`v=0\r
o=`+(n||"thisisadapterortc")+" "+a+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(o,e){const n=t.splitLines(o);for(let a=0;a<n.length;a++)switch(n[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[a].substring(2)}return e?t.getDirection(e):"sendrecv"},t.getKind=function(o){return t.splitLines(o)[0].split(" ")[0].substring(2)},t.isRejected=function(o){return o.split(" ",2)[1]==="0"},t.parseMLine=function(o){const n=t.splitLines(o)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(o){const n=t.matchPrefix(o,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(o){if(typeof o!="string"||o.length===0)return!1;const e=t.splitLines(o);for(let n=0;n<e.length;n++)if(e[n].length<2||e[n].charAt(1)!=="=")return!1;return!0},s.exports=t})(sdp$1);var sdpExports=sdp$1.exports,SDPUtils=getDefaultExportFromCjs(sdpExports),sdp=_mergeNamespaces({__proto__:null,default:SDPUtils},[sdpExports]);function shimRTCIceCandidate(s){if(!s.RTCIceCandidate||s.RTCIceCandidate&&"foundation"in s.RTCIceCandidate.prototype)return;const t=s.RTCIceCandidate;s.RTCIceCandidate=function(e){if(typeof e=="object"&&e.candidate&&e.candidate.indexOf("a=")===0&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const n=new t(e),a=SDPUtils.parseCandidate(e.candidate);for(const c in a)c in n||Object.defineProperty(n,c,{value:a[c]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},s.RTCIceCandidate.prototype=t.prototype,wrapPeerConnectionEvent(s,"icecandidate",o=>(o.candidate&&Object.defineProperty(o,"candidate",{value:new s.RTCIceCandidate(o.candidate),writable:"false"}),o))}function shimRTCIceCandidateRelayProtocol(s){!s.RTCIceCandidate||s.RTCIceCandidate&&"relayProtocol"in s.RTCIceCandidate.prototype||wrapPeerConnectionEvent(s,"icecandidate",t=>{if(t.candidate){const o=SDPUtils.parseCandidate(t.candidate.candidate);o.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[o.priority>>24])}return t})}function shimMaxMessageSize(s,t){if(!s.RTCPeerConnection)return;"sctp"in s.RTCPeerConnection.prototype||Object.defineProperty(s.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const o=function(l){if(!l||!l.sdp)return!1;const u=SDPUtils.splitSections(l.sdp);return u.shift(),u.some(d=>{const p=SDPUtils.parseMLine(d);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},e=function(l){const u=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(u===null||u.length<2)return-1;const d=parseInt(u[1],10);return d!==d?-1:d},n=function(l){let u=65536;return t.browser==="firefox"&&(t.version<57?l===-1?u=16384:u=2147483637:t.version<60?u=t.version===57?65535:65536:u=2147483637),u},a=function(l,u){let d=65536;t.browser==="firefox"&&t.version===57&&(d=65535);const p=SDPUtils.matchPrefix(l.sdp,"a=max-message-size:");return p.length>0?d=parseInt(p[0].substring(19),10):t.browser==="firefox"&&u!==-1&&(d=2147483637),d},c=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:u}=this.getConfiguration();u==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(o(arguments[0])){const u=e(arguments[0]),d=n(u),p=a(arguments[0],u);let g;d===0&&p===0?g=Number.POSITIVE_INFINITY:d===0||p===0?g=Math.max(d,p):g=Math.min(d,p);const S={};Object.defineProperty(S,"maxMessageSize",{get(){return g}}),this._sctp=S}return c.apply(this,arguments)}}function shimSendThrowTypeError(s){if(!(s.RTCPeerConnection&&"createDataChannel"in s.RTCPeerConnection.prototype))return;function t(e,n){const a=e.send;e.send=function(){const l=arguments[0],u=l.length||l.size||l.byteLength;if(e.readyState==="open"&&n.sctp&&u>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return a.apply(e,arguments)}}const o=s.RTCPeerConnection.prototype.createDataChannel;s.RTCPeerConnection.prototype.createDataChannel=function(){const n=o.apply(this,arguments);return t(n,this),n},wrapPeerConnectionEvent(s,"datachannel",e=>(t(e.channel,e.target),e))}function shimConnectionState(s){if(!s.RTCPeerConnection||"connectionState"in s.RTCPeerConnection.prototype)return;const t=s.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(o){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),o&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=o)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(o=>{const e=t[o];t[o]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=n=>{const a=n.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;const c=new Event("connectionstatechange",n);a.dispatchEvent(c)}return n},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),e.apply(this,arguments)}})}function removeExtmapAllowMixed(s,t){if(!s.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const o=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const a=n.sdp.split(`
`).filter(c=>c.trim()!=="a=extmap-allow-mixed").join(`
`);s.RTCSessionDescription&&n instanceof s.RTCSessionDescription?arguments[0]=new s.RTCSessionDescription({type:n.type,sdp:a}):n.sdp=a}return o.apply(this,arguments)}}function shimAddIceCandidateNullOrEmpty(s,t){if(!(s.RTCPeerConnection&&s.RTCPeerConnection.prototype))return;const o=s.RTCPeerConnection.prototype.addIceCandidate;!o||o.length===0||(s.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():o.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function shimParameterlessSetLocalDescription(s,t){if(!(s.RTCPeerConnection&&s.RTCPeerConnection.prototype))return;const o=s.RTCPeerConnection.prototype.setLocalDescription;!o||o.length===0||(s.RTCPeerConnection.prototype.setLocalDescription=function(){let n=arguments[0]||{};if(typeof n!="object"||n.type&&n.sdp)return o.apply(this,arguments);if(n={type:n.type,sdp:n.sdp},!n.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":n.type="offer";break;default:n.type="answer";break}return n.sdp||n.type!=="offer"&&n.type!=="answer"?o.apply(this,[n]):(n.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>o.apply(this,[c]))})}var commonShim=Object.freeze({__proto__:null,removeExtmapAllowMixed,shimAddIceCandidateNullOrEmpty,shimConnectionState,shimMaxMessageSize,shimParameterlessSetLocalDescription,shimRTCIceCandidate,shimRTCIceCandidateRelayProtocol,shimSendThrowTypeError});function adapterFactory(){let{window:s}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const o=log$1,e=detectBrowser(s),n={browserDetails:e,commonShim,extractVersion,disableLog,disableWarnings,sdp};switch(e.browser){case"chrome":if(!chromeShim||!shimPeerConnection$1||!t.shimChrome)return o("Chrome shim is not included in this adapter release."),n;if(e.version===null)return o("Chrome shim can not determine version, not shimming."),n;o("adapter.js shimming chrome."),n.browserShim=chromeShim,shimAddIceCandidateNullOrEmpty(s,e),shimParameterlessSetLocalDescription(s),shimGetUserMedia$2(s,e),shimMediaStream(s),shimPeerConnection$1(s,e),shimOnTrack$1(s),shimAddTrackRemoveTrack(s,e),shimGetSendersWithDtmf(s),shimSenderReceiverGetStats(s),fixNegotiationNeeded(s,e),shimRTCIceCandidate(s),shimRTCIceCandidateRelayProtocol(s),shimConnectionState(s),shimMaxMessageSize(s,e),shimSendThrowTypeError(s),removeExtmapAllowMixed(s,e);break;case"firefox":if(!firefoxShim||!shimPeerConnection||!t.shimFirefox)return o("Firefox shim is not included in this adapter release."),n;o("adapter.js shimming firefox."),n.browserShim=firefoxShim,shimAddIceCandidateNullOrEmpty(s,e),shimParameterlessSetLocalDescription(s),shimGetUserMedia$1(s,e),shimPeerConnection(s,e),shimOnTrack(s),shimRemoveStream(s),shimSenderGetStats(s),shimReceiverGetStats(s),shimRTCDataChannel(s),shimAddTransceiver(s),shimGetParameters(s),shimCreateOffer(s),shimCreateAnswer(s),shimRTCIceCandidate(s),shimConnectionState(s),shimMaxMessageSize(s,e),shimSendThrowTypeError(s);break;case"safari":if(!safariShim||!t.shimSafari)return o("Safari shim is not included in this adapter release."),n;o("adapter.js shimming safari."),n.browserShim=safariShim,shimAddIceCandidateNullOrEmpty(s,e),shimParameterlessSetLocalDescription(s),shimRTCIceServerUrls(s),shimCreateOfferLegacy(s),shimCallbacksAPI(s),shimLocalStreamsAPI(s),shimRemoteStreamsAPI(s),shimTrackEventTransceiver(s),shimGetUserMedia(s),shimAudioContext(s),shimRTCIceCandidate(s),shimRTCIceCandidateRelayProtocol(s),shimMaxMessageSize(s,e),shimSendThrowTypeError(s),removeExtmapAllowMixed(s,e);break;default:o("Unsupported browser!");break}return n}adapterFactory({window:typeof window>"u"?void 0:window});const DECRYPTION_FAILURE_TOLERANCE=10,E2EE_FLAG="lk_e2ee",SALT="LKFrameEncryptionKey",KEY_PROVIDER_DEFAULTS={sharedKey:!1,ratchetSalt:SALT,ratchetWindowSize:8,failureTolerance:DECRYPTION_FAILURE_TOLERANCE,keyringSize:16};var KeyProviderEvent;(function(s){s.SetKey="setKey",s.RatchetRequest="ratchetRequest",s.KeyRatcheted="keyRatcheted"})(KeyProviderEvent||(KeyProviderEvent={}));var KeyHandlerEvent;(function(s){s.KeyRatcheted="keyRatcheted"})(KeyHandlerEvent||(KeyHandlerEvent={}));var EncryptionEvent;(function(s){s.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",s.EncryptionError="encryptionError"})(EncryptionEvent||(EncryptionEvent={}));var CryptorEvent;(function(s){s.Error="cryptorError"})(CryptorEvent||(CryptorEvent={}));function isE2EESupported(){return isInsertableStreamSupported()||isScriptTransformSupported()}function isScriptTransformSupported(){return typeof window.RTCRtpScriptTransform<"u"}function isInsertableStreamSupported(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}class BaseKeyProvider extends eventsExports.EventEmitter{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(o,e)=>{livekitLogger.debug("key ratcheted event received",{material:o,keyIndex:e})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},KEY_PROVIDER_DEFAULTS),t),this.on(KeyProviderEvent.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(t,o,e){const n={key:t,participantIdentity:o,keyIndex:e};if(!this.options.sharedKey&&!o)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(o??"shared","-").concat(e??0),n),this.emit(KeyProviderEvent.SetKey,n)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(t,o){this.emit(KeyProviderEvent.RatchetRequest,t,o)}}class LivekitError extends Error{constructor(t,o){super(o||"an error has occured"),this.code=t}}class ConnectionError extends LivekitError{constructor(t,o,e){super(1,t),this.status=e,this.reason=o}}class DeviceUnsupportedError extends LivekitError{constructor(t){super(21,t??"device is unsupported")}}class TrackInvalidError extends LivekitError{constructor(t){super(20,t??"track is invalid")}}class UnsupportedServer extends LivekitError{constructor(t){super(10,t??"unsupported server")}}class UnexpectedConnectionState extends LivekitError{constructor(t){super(12,t??"unexpected connection state")}}class NegotiationError extends LivekitError{constructor(t){super(13,t??"unable to negotiate")}}class SignalRequestError extends LivekitError{constructor(t,o){super(15,t),this.reason=o}}var MediaDeviceFailure;(function(s){s.PermissionDenied="PermissionDenied",s.NotFound="NotFound",s.DeviceInUse="DeviceInUse",s.Other="Other"})(MediaDeviceFailure||(MediaDeviceFailure={}));(function(s){function t(o){if(o&&"name"in o)return o.name==="NotFoundError"||o.name==="DevicesNotFoundError"?s.NotFound:o.name==="NotAllowedError"||o.name==="PermissionDeniedError"?s.PermissionDenied:o.name==="NotReadableError"||o.name==="TrackStartError"?s.DeviceInUse:s.Other}s.getFailure=t})(MediaDeviceFailure||(MediaDeviceFailure={}));var CryptorErrorReason;(function(s){s[s.InvalidKey=0]="InvalidKey",s[s.MissingKey=1]="MissingKey",s[s.InternalError=2]="InternalError"})(CryptorErrorReason||(CryptorErrorReason={}));var RoomEvent;(function(s){s.Connected="connected",s.Reconnecting="reconnecting",s.SignalReconnecting="signalReconnecting",s.Reconnected="reconnected",s.Disconnected="disconnected",s.ConnectionStateChanged="connectionStateChanged",s.MediaDevicesChanged="mediaDevicesChanged",s.ParticipantConnected="participantConnected",s.ParticipantDisconnected="participantDisconnected",s.TrackPublished="trackPublished",s.TrackSubscribed="trackSubscribed",s.TrackSubscriptionFailed="trackSubscriptionFailed",s.TrackUnpublished="trackUnpublished",s.TrackUnsubscribed="trackUnsubscribed",s.TrackMuted="trackMuted",s.TrackUnmuted="trackUnmuted",s.LocalTrackPublished="localTrackPublished",s.LocalTrackUnpublished="localTrackUnpublished",s.LocalAudioSilenceDetected="localAudioSilenceDetected",s.ActiveSpeakersChanged="activeSpeakersChanged",s.ParticipantMetadataChanged="participantMetadataChanged",s.ParticipantNameChanged="participantNameChanged",s.ParticipantAttributesChanged="participantAttributesChanged",s.RoomMetadataChanged="roomMetadataChanged",s.DataReceived="dataReceived",s.SipDTMFReceived="sipDTMFReceived",s.TranscriptionReceived="transcriptionReceived",s.ConnectionQualityChanged="connectionQualityChanged",s.TrackStreamStateChanged="trackStreamStateChanged",s.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",s.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",s.AudioPlaybackStatusChanged="audioPlaybackChanged",s.VideoPlaybackStatusChanged="videoPlaybackChanged",s.MediaDevicesError="mediaDevicesError",s.ParticipantPermissionsChanged="participantPermissionsChanged",s.SignalConnected="signalConnected",s.RecordingStatusChanged="recordingStatusChanged",s.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",s.EncryptionError="encryptionError",s.DCBufferStatusChanged="dcBufferStatusChanged",s.ActiveDeviceChanged="activeDeviceChanged",s.LocalTrackSubscribed="localTrackSubscribed"})(RoomEvent||(RoomEvent={}));var ParticipantEvent;(function(s){s.TrackPublished="trackPublished",s.TrackSubscribed="trackSubscribed",s.TrackSubscriptionFailed="trackSubscriptionFailed",s.TrackUnpublished="trackUnpublished",s.TrackUnsubscribed="trackUnsubscribed",s.TrackMuted="trackMuted",s.TrackUnmuted="trackUnmuted",s.LocalTrackPublished="localTrackPublished",s.LocalTrackUnpublished="localTrackUnpublished",s.ParticipantMetadataChanged="participantMetadataChanged",s.ParticipantNameChanged="participantNameChanged",s.DataReceived="dataReceived",s.SipDTMFReceived="sipDTMFReceived",s.TranscriptionReceived="transcriptionReceived",s.IsSpeakingChanged="isSpeakingChanged",s.ConnectionQualityChanged="connectionQualityChanged",s.TrackStreamStateChanged="trackStreamStateChanged",s.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",s.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",s.MediaDevicesError="mediaDevicesError",s.AudioStreamAcquired="audioStreamAcquired",s.ParticipantPermissionsChanged="participantPermissionsChanged",s.PCTrackAdded="pcTrackAdded",s.AttributesChanged="attributesChanged",s.LocalTrackSubscribed="localTrackSubscribed"})(ParticipantEvent||(ParticipantEvent={}));var EngineEvent;(function(s){s.TransportsCreated="transportsCreated",s.Connected="connected",s.Disconnected="disconnected",s.Resuming="resuming",s.Resumed="resumed",s.Restarting="restarting",s.Restarted="restarted",s.SignalResumed="signalResumed",s.SignalRestarted="signalRestarted",s.Closing="closing",s.MediaTrackAdded="mediaTrackAdded",s.ActiveSpeakersUpdate="activeSpeakersUpdate",s.DataPacketReceived="dataPacketReceived",s.RTPVideoMapUpdate="rtpVideoMapUpdate",s.DCBufferStatusChanged="dcBufferStatusChanged",s.ParticipantUpdate="participantUpdate",s.RoomUpdate="roomUpdate",s.SpeakersChanged="speakersChanged",s.StreamStateChanged="streamStateChanged",s.ConnectionQualityUpdate="connectionQualityUpdate",s.SubscriptionError="subscriptionError",s.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",s.RemoteMute="remoteMute",s.SubscribedQualityUpdate="subscribedQualityUpdate",s.LocalTrackUnpublished="localTrackUnpublished",s.LocalTrackSubscribed="localTrackSubscribed",s.Offline="offline",s.SignalRequestResponse="signalRequestResponse"})(EngineEvent||(EngineEvent={}));var TrackEvent;(function(s){s.Message="message",s.Muted="muted",s.Unmuted="unmuted",s.Restarted="restarted",s.Ended="ended",s.Subscribed="subscribed",s.Unsubscribed="unsubscribed",s.UpdateSettings="updateSettings",s.UpdateSubscription="updateSubscription",s.AudioPlaybackStarted="audioPlaybackStarted",s.AudioPlaybackFailed="audioPlaybackFailed",s.AudioSilenceDetected="audioSilenceDetected",s.VisibilityChanged="visibilityChanged",s.VideoDimensionsChanged="videoDimensionsChanged",s.VideoPlaybackStarted="videoPlaybackStarted",s.VideoPlaybackFailed="videoPlaybackFailed",s.ElementAttached="elementAttached",s.ElementDetached="elementDetached",s.UpstreamPaused="upstreamPaused",s.UpstreamResumed="upstreamResumed",s.SubscriptionPermissionChanged="subscriptionPermissionChanged",s.SubscriptionStatusChanged="subscriptionStatusChanged",s.SubscriptionFailed="subscriptionFailed",s.TrackProcessorUpdate="trackProcessorUpdate",s.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",s.TranscriptionReceived="transcriptionReceived",s.TimeSyncUpdate="timeSyncUpdate"})(TrackEvent||(TrackEvent={}));function r(s,t,o){var e,n,a;t===void 0&&(t=50),o===void 0&&(o={});var c=(e=o.isImmediate)!=null&&e,l=(n=o.callback)!=null&&n,u=o.maxWait,d=Date.now(),p=[];function g(){if(u!==void 0){var y=Date.now()-d;if(y+t>=u)return u-y}return t}var S=function(){var y=[].slice.call(arguments),b=this;return new Promise(function(k,O){var C=c&&a===void 0;if(a!==void 0&&clearTimeout(a),a=setTimeout(function(){if(a=void 0,d=Date.now(),!c){var x=s.apply(b,y);l&&l(x),p.forEach(function(U){return(0,U.resolve)(x)}),p=[]}},g()),C){var N=s.apply(b,y);return l&&l(N),k(N)}p.push({resolve:k,reject:O})})};return S.cancel=function(y){a!==void 0&&clearTimeout(a),p.forEach(function(b){return(0,b.reject)(y)}),p=[]},S}const commonVersionIdentifier=/version\/(\d+(\.?_?\d+)+)/i;let browserDetails;function getBrowser(s){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof s>"u"&&typeof navigator>"u")return;const o=(s??navigator.userAgent).toLowerCase();if(browserDetails===void 0||t){const e=browsersList.find(n=>{let{test:a}=n;return a.test(o)});browserDetails=e==null?void 0:e.describe(o)}return browserDetails}const browsersList=[{test:/firefox|iceweasel|fxios/i,describe(s){return{name:"Firefox",version:getMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,s),os:s.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:getOSVersion(s)}}},{test:/chrom|crios|crmo/i,describe(s){return{name:"Chrome",version:getMatch(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,s),os:s.toLowerCase().includes("crios")?"iOS":void 0,osVersion:getOSVersion(s)}}},{test:/safari|applewebkit/i,describe(s){return{name:"Safari",version:getMatch(commonVersionIdentifier,s),os:s.includes("mobile/")?"iOS":"macOS",osVersion:getOSVersion(s)}}}];function getMatch(s,t){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const e=t.match(s);return e&&e.length>=o&&e[o]||""}function getOSVersion(s){return s.includes("mac os")?getMatch(/\(.+?(\d+_\d+(:?_\d+)?)/,s,1).replace(/_/g,"."):void 0}var version$1="2.5.1";const version=version$1,protocolVersion=15;class CriticalTimers{}CriticalTimers.setTimeout=function(){return setTimeout(...arguments)};CriticalTimers.setInterval=function(){return setInterval(...arguments)};CriticalTimers.clearTimeout=function(){return clearTimeout(...arguments)};CriticalTimers.clearInterval=function(){return clearInterval(...arguments)};class VideoPreset{constructor(t,o,e,n,a){if(typeof t=="object")this.width=t.width,this.height=t.height,this.aspectRatio=t.aspectRatio,this.encoding={maxBitrate:t.maxBitrate,maxFramerate:t.maxFramerate,priority:t.priority};else if(o!==void 0&&e!==void 0)this.width=t,this.height=o,this.aspectRatio=t/o,this.encoding={maxBitrate:e,maxFramerate:n,priority:a};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const backupCodecs=["vp8","h264"],videoCodecs=["vp8","h264","vp9","av1"];function isBackupCodec(s){return!!backupCodecs.find(t=>t===s)}var AudioPresets;(function(s){s.telephone={maxBitrate:12e3},s.speech={maxBitrate:2e4},s.music={maxBitrate:32e3},s.musicStereo={maxBitrate:48e3},s.musicHighQuality={maxBitrate:64e3},s.musicHighQualityStereo={maxBitrate:96e3}})(AudioPresets||(AudioPresets={}));const VideoPresets={h90:new VideoPreset(160,90,9e4,20),h180:new VideoPreset(320,180,16e4,20),h216:new VideoPreset(384,216,18e4,20),h360:new VideoPreset(640,360,45e4,20),h540:new VideoPreset(960,540,8e5,25),h720:new VideoPreset(1280,720,17e5,30),h1080:new VideoPreset(1920,1080,3e6,30),h1440:new VideoPreset(2560,1440,5e6,30),h2160:new VideoPreset(3840,2160,8e6,30)},VideoPresets43={h120:new VideoPreset(160,120,7e4,20),h180:new VideoPreset(240,180,125e3,20),h240:new VideoPreset(320,240,14e4,20),h360:new VideoPreset(480,360,33e4,20),h480:new VideoPreset(640,480,5e5,20),h540:new VideoPreset(720,540,6e5,25),h720:new VideoPreset(960,720,13e5,30),h1080:new VideoPreset(1440,1080,23e5,30),h1440:new VideoPreset(1920,1440,38e5,30)},ScreenSharePresets={h360fps3:new VideoPreset(640,360,2e5,3,"medium"),h360fps15:new VideoPreset(640,360,4e5,15,"medium"),h720fps5:new VideoPreset(1280,720,8e5,5,"medium"),h720fps15:new VideoPreset(1280,720,15e5,15,"medium"),h720fps30:new VideoPreset(1280,720,2e6,30,"medium"),h1080fps15:new VideoPreset(1920,1080,25e5,15,"medium"),h1080fps30:new VideoPreset(1920,1080,5e6,30,"medium"),original:new VideoPreset(0,0,7e6,30,"medium")};function cloneDeep(s){if(!(typeof s>"u"))return typeof structuredClone=="function"?structuredClone(s):JSON.parse(JSON.stringify(s))}const BACKGROUND_REACTION_DELAY=5e3,recycledElements=[];var VideoQuality;(function(s){s[s.LOW=0]="LOW",s[s.MEDIUM=1]="MEDIUM",s[s.HIGH=2]="HIGH"})(VideoQuality||(VideoQuality={}));class Track extends eventsExports.EventEmitter{constructor(t,o){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var n;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=Track.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=livekitLogger,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),BACKGROUND_REACTION_DELAY):this.handleAppVisibilityChanged()},this.log=getLogger((n=e.loggerName)!==null&&n!==void 0?n:LoggerNames.Track),this.loggerContextCb=e.loggerContextCb,this.setMaxListeners(100),this.kind=o,this._mediaStreamTrack=t,this._mediaStreamID=t.id,this.source=Track.Source.Unknown}get logContext(){var t;return Object.assign(Object.assign({},(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this)),getLogContextFromTrack(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(t){let o="audio";this.kind===Track.Kind.Video&&(o="video"),this.attachedElements.length===0&&this.kind===Track.Kind.Video&&this.addAppVisibilityListener(),t||(o==="audio"&&(recycledElements.forEach(a=>{a.parentElement===null&&!t&&(t=a)}),t&&recycledElements.splice(recycledElements.indexOf(t),1)),t||(t=document.createElement(o))),this.attachedElements.includes(t)||this.attachedElements.push(t),attachToElement(this.mediaStreamTrack,t);const e=t.srcObject.getTracks(),n=e.some(a=>a.kind==="audio");return t.play().then(()=>{this.emit(n?TrackEvent.AudioPlaybackStarted:TrackEvent.VideoPlaybackStarted)}).catch(a=>{a.name==="NotAllowedError"?this.emit(n?TrackEvent.AudioPlaybackFailed:TrackEvent.VideoPlaybackFailed,a):a.name==="AbortError"?livekitLogger.debug("".concat(n?"audio":"video"," playback aborted, likely due to new play request")):livekitLogger.warn("could not playback ".concat(n?"audio":"video"),a),n&&t&&e.some(c=>c.kind==="video")&&a.name==="NotAllowedError"&&(t.muted=!0,t.play().catch(()=>{}))}),this.emit(TrackEvent.ElementAttached,t),t}detach(t){try{if(t){detachTrack(this.mediaStreamTrack,t);const e=this.attachedElements.indexOf(t);return e>=0&&(this.attachedElements.splice(e,1),this.recycleElement(t),this.emit(TrackEvent.ElementDetached,t)),t}const o=[];return this.attachedElements.forEach(e=>{detachTrack(this.mediaStreamTrack,e),o.push(e),this.recycleElement(e),this.emit(TrackEvent.ElementDetached,e)}),this.attachedElements=[],o}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(t){t.loggerName&&(this.log=getLogger(t.loggerName)),t.loggerContextCb&&(this.loggerContextCb=t.loggerContextCb)}recycleElement(t){if(t instanceof HTMLAudioElement){let o=!0;t.pause(),recycledElements.forEach(e=>{e.parentElement||(o=!1)}),o&&recycledElements.push(t)}}handleAppVisibilityChanged(){return __awaiter(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===Track.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(t=>t.play().catch(()=>{})),0)})}addAppVisibilityListener(){isWeb()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){isWeb()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function attachToElement(s,t){let o;t.srcObject instanceof MediaStream?o=t.srcObject:o=new MediaStream;let e;s.kind==="audio"?e=o.getAudioTracks():e=o.getVideoTracks(),e.includes(s)||(e.forEach(n=>{o.removeTrack(n)}),o.addTrack(s)),(!isSafari()||!(t instanceof HTMLVideoElement))&&(t.autoplay=!0),t.muted=o.getAudioTracks().length===0,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==o&&(t.srcObject=o,(isSafari()||isFireFox())&&t instanceof HTMLVideoElement&&setTimeout(()=>{t.srcObject=o,t.play().catch(()=>{})},0))}function detachTrack(s,t){if(t.srcObject instanceof MediaStream){const o=t.srcObject;o.removeTrack(s),o.getTracks().length>0?t.srcObject=o:t.srcObject=null}}(function(s){let t;(function(d){d.Audio="audio",d.Video="video",d.Unknown="unknown"})(t=s.Kind||(s.Kind={}));let o;(function(d){d.Camera="camera",d.Microphone="microphone",d.ScreenShare="screen_share",d.ScreenShareAudio="screen_share_audio",d.Unknown="unknown"})(o=s.Source||(s.Source={}));let e;(function(d){d.Active="active",d.Paused="paused",d.Unknown="unknown"})(e=s.StreamState||(s.StreamState={}));function n(d){switch(d){case t.Audio:return TrackType.AUDIO;case t.Video:return TrackType.VIDEO;default:return TrackType.DATA}}s.kindToProto=n;function a(d){switch(d){case TrackType.AUDIO:return t.Audio;case TrackType.VIDEO:return t.Video;default:return t.Unknown}}s.kindFromProto=a;function c(d){switch(d){case o.Camera:return TrackSource.CAMERA;case o.Microphone:return TrackSource.MICROPHONE;case o.ScreenShare:return TrackSource.SCREEN_SHARE;case o.ScreenShareAudio:return TrackSource.SCREEN_SHARE_AUDIO;default:return TrackSource.UNKNOWN}}s.sourceToProto=c;function l(d){switch(d){case TrackSource.CAMERA:return o.Camera;case TrackSource.MICROPHONE:return o.Microphone;case TrackSource.SCREEN_SHARE:return o.ScreenShare;case TrackSource.SCREEN_SHARE_AUDIO:return o.ScreenShareAudio;default:return o.Unknown}}s.sourceFromProto=l;function u(d){switch(d){case StreamState.ACTIVE:return e.Active;case StreamState.PAUSED:return e.Paused;default:return e.Unknown}}s.streamStateFromProto=u})(Track||(Track={}));function mergeDefaultOptions(s,t,o){var e;const n=(e=cloneDeep(s))!==null&&e!==void 0?e:{};return n.audio===!0&&(n.audio={}),n.video===!0&&(n.video={}),n.audio&&mergeObjectWithoutOverwriting(n.audio,t),n.video&&mergeObjectWithoutOverwriting(n.video,o),n}function mergeObjectWithoutOverwriting(s,t){return Object.keys(t).forEach(o=>{s[o]===void 0&&(s[o]=t[o])}),s}function constraintsForOptions(s){const t={};if(s.video)if(typeof s.video=="object"){const o={},e=o,n=s.video;Object.keys(n).forEach(a=>{switch(a){case"resolution":mergeObjectWithoutOverwriting(e,n.resolution);break;default:e[a]=n[a]}}),t.video=o}else t.video=s.video;else t.video=!1;return s.audio?typeof s.audio=="object"?t.audio=s.audio:t.audio=!0:t.audio=!1,t}function detectSilence(s){return __awaiter(this,arguments,void 0,function(t){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const e=getNewAudioContext();if(e){const n=e.createAnalyser();n.fftSize=2048;const a=n.frequencyBinCount,c=new Uint8Array(a);e.createMediaStreamSource(new MediaStream([t.mediaStreamTrack])).connect(n),yield sleep(o),n.getByteTimeDomainData(c);const u=c.some(d=>d!==128&&d!==0);return e.close(),!u}return!1}()})}function getNewAudioContext(){const s=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(s)return new s({latencyHint:"interactive"})}function sourceToKind(s){return s===Track.Source.Microphone?"audioinput":s===Track.Source.Camera?"videoinput":void 0}function screenCaptureToDisplayMediaStreamOptions(s){var t,o;let e=(t=s.video)!==null&&t!==void 0?t:!0;return s.resolution&&s.resolution.width>0&&s.resolution.height>0&&(e=typeof e=="boolean"?{}:e,isSafari()?e=Object.assign(Object.assign({},e),{width:{max:s.resolution.width},height:{max:s.resolution.height},frameRate:s.resolution.frameRate}):e=Object.assign(Object.assign({},e),{width:{ideal:s.resolution.width},height:{ideal:s.resolution.height},frameRate:s.resolution.frameRate})),{audio:(o=s.audio)!==null&&o!==void 0?o:!1,video:e,controller:s.controller,selfBrowserSurface:s.selfBrowserSurface,surfaceSwitching:s.surfaceSwitching,systemAudio:s.systemAudio,preferCurrentTab:s.preferCurrentTab}}function mimeTypeToVideoCodecString(s){const t=s.split("/")[1].toLowerCase();if(!videoCodecs.includes(t))throw Error("Video codec not supported: ".concat(t));return t}function getTrackPublicationInfo(s){const t=[];return s.forEach(o=>{o.track!==void 0&&t.push(new TrackPublishedResponse({cid:o.track.mediaStreamID,track:o.trackInfo}))}),t}function getLogContextFromTrack(s){return s instanceof Track?{trackID:s.sid,source:s.source,muted:s.isMuted,enabled:s.mediaStreamTrack.enabled,kind:s.kind,streamID:s.mediaStreamID,streamTrackID:s.mediaStreamTrack.id}:{trackID:s.trackSid,enabled:s.isEnabled,muted:s.isMuted,trackInfo:Object.assign({mimeType:s.mimeType,name:s.trackName,encrypted:s.isEncrypted,kind:s.kind,source:s.source},s.track?getLogContextFromTrack(s.track):{})}}function supportsSynchronizationSources(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function diffAttributes(s,t){var o;s===void 0&&(s={}),t===void 0&&(t={});const e=[...Object.keys(t),...Object.keys(s)],n={};for(const a of e)s[a]!==t[a]&&(n[a]=(o=t[a])!==null&&o!==void 0?o:"");return n}const separator="|",ddExtensionURI="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function unpackStreamId(s){const t=s.split(separator);return t.length>1?[t[0],s.substr(t[0].length+1)]:[s,""]}function sleep(s){return __awaiter(this,void 0,void 0,function*(){return new Promise(t=>CriticalTimers.setTimeout(t,s))})}function supportsTransceiver(){return"addTransceiver"in RTCPeerConnection.prototype}function supportsAddTrack(){return"addTrack"in RTCPeerConnection.prototype}function supportsAV1(){if(!("getCapabilities"in RTCRtpSender)||isSafari())return!1;const s=RTCRtpSender.getCapabilities("video");let t=!1;if(s){for(const o of s.codecs)if(o.mimeType==="video/AV1"){t=!0;break}}return t}function supportsVP9(){if(!("getCapabilities"in RTCRtpSender)||isFireFox())return!1;if(isSafari()){const o=getBrowser();if(o!=null&&o.version&&compareVersions(o.version,"16")<0)return!1}const s=RTCRtpSender.getCapabilities("video");let t=!1;if(s){for(const o of s.codecs)if(o.mimeType==="video/VP9"){t=!0;break}}return t}function isSVCCodec(s){return s==="av1"||s==="vp9"}function supportsSetSinkId(s){return document?(s||(s=document.createElement("audio")),"setSinkId"in s):!1}function isBrowserSupported(){return typeof RTCPeerConnection>"u"?!1:supportsTransceiver()||supportsAddTrack()}function isFireFox(){var s;return((s=getBrowser())===null||s===void 0?void 0:s.name)==="Firefox"}function isSafari(){var s;return((s=getBrowser())===null||s===void 0?void 0:s.name)==="Safari"}function isSafari17(){const s=getBrowser();return(s==null?void 0:s.name)==="Safari"&&s.version.startsWith("17.")}function isMobile(){var s,t;return isWeb()?(t=(s=navigator.userAgentData)===null||s===void 0?void 0:s.mobile)!==null&&t!==void 0?t:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function isE2EESimulcastSupported(){const s=getBrowser(),t="17.2";if(s)return s.name!=="Safari"&&s.os!=="iOS"||s.os==="iOS"&&s.osVersion&&compareVersions(t,s.osVersion)>=0?!0:s.name==="Safari"&&compareVersions(t,s.version)>=0}function isWeb(){return typeof document<"u"}function isReactNative(){return navigator.product=="ReactNative"}function isCloud(s){return s.hostname.endsWith(".livekit.cloud")||s.hostname.endsWith(".livekit.run")}function getLKReactNativeInfo(){if(dist.global&&dist.global.LiveKitReactNativeGlobal)return dist.global.LiveKitReactNativeGlobal}function getReactNativeOs(){if(!isReactNative())return;let s=getLKReactNativeInfo();if(s)return s.platform}function getDevicePixelRatio(){if(isWeb())return window.devicePixelRatio;if(isReactNative()){let s=getLKReactNativeInfo();if(s)return s.devicePixelRatio}return 1}function compareVersions(s,t){const o=s.split("."),e=t.split("."),n=Math.min(o.length,e.length);for(let a=0;a<n;++a){const c=parseInt(o[a],10),l=parseInt(e[a],10);if(c>l)return 1;if(c<l)return-1;if(a===n-1&&c===l)return 0}return s===""&&t!==""?-1:t===""?1:o.length==e.length?0:o.length<e.length?-1:1}function roDispatchCallback(s){for(const t of s)t.target.handleResize(t)}function ioDispatchCallback(s){for(const t of s)t.target.handleVisibilityChanged(t)}let resizeObserver=null;const getResizeObserver=()=>(resizeObserver||(resizeObserver=new ResizeObserver(roDispatchCallback)),resizeObserver);let intersectionObserver=null;const getIntersectionObserver=()=>(intersectionObserver||(intersectionObserver=new IntersectionObserver(ioDispatchCallback,{root:null,rootMargin:"0px"})),intersectionObserver);function getClientInfo(){var s;const t=new ClientInfo({sdk:ClientInfo_SDK.JS,protocol:protocolVersion,version});return isReactNative()&&(t.os=(s=getReactNativeOs())!==null&&s!==void 0?s:""),t}function createDummyVideoStreamTrack(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,e=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const n=document.createElement("canvas");n.width=s,n.height=t;const a=n.getContext("2d");a==null||a.fillRect(0,0,n.width,n.height),e&&a&&(a.beginPath(),a.arc(s/2,t/2,50,0,Math.PI*2,!0),a.closePath(),a.fillStyle="grey",a.fill());const c=n.captureStream(),[l]=c.getTracks();if(!l)throw Error("Could not get empty media stream video track");return l.enabled=o,l}let emptyAudioStreamTrack;function getEmptyAudioStreamTrack(){if(!emptyAudioStreamTrack){const s=new AudioContext,t=s.createOscillator(),o=s.createGain();o.gain.setValueAtTime(0,0);const e=s.createMediaStreamDestination();if(t.connect(o),o.connect(e),t.start(),[emptyAudioStreamTrack]=e.stream.getAudioTracks(),!emptyAudioStreamTrack)throw Error("Could not get empty media stream audio track");emptyAudioStreamTrack.enabled=!1}return emptyAudioStreamTrack.clone()}class Future{constructor(t,o){this.onFinally=o,this.promise=new Promise((e,n)=>__awaiter(this,void 0,void 0,function*(){this.resolve=e,this.reject=n,t&&(yield t(e,n))})).finally(()=>{var e;return(e=this.onFinally)===null||e===void 0?void 0:e.call(this)})}}class Mutex{constructor(){this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let t;const o=new Promise(n=>t=()=>{this._locks-=1,n()}),e=this._locking.then(()=>t);return this._locking=this._locking.then(()=>o),e}}function isVideoCodec(s){return videoCodecs.includes(s)}function unwrapConstraint(s){if(typeof s=="string"||typeof s=="number")return s;if(Array.isArray(s))return s[0];if(s.exact)return Array.isArray(s.exact)?s.exact[0]:s.exact;if(s.ideal)return Array.isArray(s.ideal)?s.ideal[0]:s.ideal;throw Error("could not unwrap constraint")}function toWebsocketUrl(s){return s.startsWith("http")?s.replace(/^(http)/,"ws"):s}function toHttpUrl(s){return s.startsWith("ws")?s.replace(/^(ws)/,"http"):s}function extractTranscriptionSegments(s,t){return s.segments.map(o=>{let{id:e,text:n,language:a,startTime:c,endTime:l,final:u}=o;var d;const p=(d=t.get(e))!==null&&d!==void 0?d:Date.now(),g=Date.now();return u?t.delete(e):t.set(e,p),{id:e,text:n,startTime:Number.parseInt(c.toString()),endTime:Number.parseInt(l.toString()),final:u,language:a,firstReceivedTime:p,lastReceivedTime:g}})}const defaultId="default";class DeviceManager{static getInstance(){return this.instance===void 0&&(this.instance=new DeviceManager),this.instance}getDevices(t){return __awaiter(this,arguments,void 0,function(o){var e=this;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var a;if(((a=DeviceManager.userMediaPromiseMap)===null||a===void 0?void 0:a.size)>0){livekitLogger.debug("awaiting getUserMedia promise");try{o?yield DeviceManager.userMediaPromiseMap.get(o):yield Promise.all(DeviceManager.userMediaPromiseMap.values())}catch{livekitLogger.warn("error waiting for media permissons")}}let c=yield navigator.mediaDevices.enumerateDevices();if(n&&!(isSafari()&&e.hasDeviceInUse(o))&&(c.filter(u=>u.kind===o).length===0||c.some(u=>{const d=u.label==="",p=o?u.kind===o:!0;return d&&p}))){const u={video:o!=="audioinput"&&o!=="audiooutput",audio:o!=="videoinput"},d=yield navigator.mediaDevices.getUserMedia(u);c=yield navigator.mediaDevices.enumerateDevices(),d.getTracks().forEach(p=>{p.stop()})}return o&&(c=c.filter(l=>l.kind===o)),c}()})}normalizeDeviceId(t,o,e){return __awaiter(this,void 0,void 0,function*(){if(o!==defaultId)return o;const n=yield this.getDevices(t),a=n.find(l=>l.deviceId===defaultId);if(!a){livekitLogger.warn("could not reliably determine default device");return}const c=n.find(l=>l.deviceId!==defaultId&&l.groupId===(e??a.groupId));if(!c){livekitLogger.warn("could not reliably determine default device");return}return c==null?void 0:c.deviceId})}hasDeviceInUse(t){return t?DeviceManager.userMediaPromiseMap.has(t):DeviceManager.userMediaPromiseMap.size>0}}DeviceManager.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];DeviceManager.userMediaPromiseMap=new Map;const defaultDimensionsTimeout=1e3;class LocalTrack extends Track{get sender(){return this._sender}set sender(t){this._sender=t}get constraints(){return this._constraints}constructor(t,o,e){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=arguments.length>4?arguments[4]:void 0;super(t,o,a),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=r(()=>__awaiter(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>__awaiter(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(TrackEvent.Ended,this)},this.reacquireTrack=!1,this.providedByUser=n,this.muteLock=new Mutex,this.pauseUpstreamLock=new Mutex,this.processorLock=new Mutex,this.restartLock=new Mutex,this.setMediaStreamTrack(t,!0),this._constraints=t.getConstraints(),e&&(this._constraints=e)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==Track.Kind.Video)return;const{width:t,height:o}=this._mediaStreamTrack.getSettings();if(t&&o)return{width:t,height:o}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var t,o;return(o=(t=this.processor)===null||t===void 0?void 0:t.processedTrack)!==null&&o!==void 0?o:this._mediaStreamTrack}setMediaStreamTrack(t,o){return __awaiter(this,void 0,void 0,function*(){if(t===this._mediaStreamTrack&&!o)return;this._mediaStreamTrack&&(this.attachedElements.forEach(n=>{detachTrack(this._mediaStreamTrack,n)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([t]),t&&(t.addEventListener("ended",this.handleEnded),t.addEventListener("mute",this.handleTrackMuteEvent),t.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=t.getConstraints());let e;if(this.processor&&t){const n=yield this.processorLock.lock();try{if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(attachToElement(t,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:t,kind:this.kind,element:this.processorElement}),e=this.processor.processedTrack}finally{n()}}this.sender&&(yield this.sender.replaceTrack(e??t)),!this.providedByUser&&this._mediaStreamTrack!==t&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=t,t&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(n=>{attachToElement(e??t,n)}))})}waitForDimensions(){return __awaiter(this,arguments,void 0,function(){var t=this;let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:defaultDimensionsTimeout;return function*(){var e;if(t.kind===Track.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((e=getBrowser())===null||e===void 0?void 0:e.os)==="iOS"&&(yield sleep(10));const n=Date.now();for(;Date.now()-n<o;){const a=t.dimensions;if(a)return a;yield sleep(50)}throw new TrackInvalidError("unable to get track dimensions after timeout")}()})}getDeviceId(){return __awaiter(this,void 0,void 0,function*(){if(this.source===Track.Source.ScreenShare)return;const{deviceId:t,groupId:o}=this._mediaStreamTrack.getSettings(),e=this.kind===Track.Kind.Audio?"audioinput":"videoinput";return DeviceManager.getInstance().normalizeDeviceId(e,t,o)})}mute(){return __awaiter(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return __awaiter(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(t,o){return __awaiter(this,void 0,void 0,function*(){if(!this.sender)throw new TrackInvalidError("unable to replace an unpublished track");let e,n;return typeof o=="boolean"?e=o:o!==void 0&&(e=o.userProvidedTrack,n=o.stopProcessor),this.providedByUser=e??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(t),n&&this.processor&&(yield this.stopProcessor()),this})}restart(t){return __awaiter(this,void 0,void 0,function*(){this.manuallyStopped=!1;const o=yield this.restartLock.lock();try{t||(t=this._constraints),this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:t}));const e={audio:!1,video:!1};this.kind===Track.Kind.Video?e.video=t:e.audio=t,this.attachedElements.forEach(c=>{detachTrack(this.mediaStreamTrack,c)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const a=(yield navigator.mediaDevices.getUserMedia(e)).getTracks()[0];return a.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(a),this._constraints=t,this.emit(TrackEvent.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{o()}})}setTrackMuted(t){this.log.debug("setting ".concat(this.kind," track ").concat(t?"muted":"unmuted"),this.logContext),!(this.isMuted===t&&this._mediaStreamTrack.enabled!==t)&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?TrackEvent.Muted:TrackEvent.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return __awaiter(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),isMobile()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var t;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(t=this.processor)===null||t===void 0||t.destroy(),this.processor=void 0}pauseUpstream(){return __awaiter(this,void 0,void 0,function*(){const t=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(TrackEvent.UpstreamPaused,this);const o=getBrowser();if((o==null?void 0:o.name)==="Safari"&&compareVersions(o.version,"12.0")<0)throw new DeviceUnsupportedError("pauseUpstream is not supported on Safari < 12.");yield this.sender.replaceTrack(null)}finally{t()}})}resumeUpstream(){return __awaiter(this,void 0,void 0,function*(){const t=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(TrackEvent.UpstreamResumed,this),yield this.sender.replaceTrack(this.mediaStreamTrack)}finally{t()}})}getRTCStatsReport(){return __awaiter(this,void 0,void 0,function*(){var t;return!((t=this.sender)===null||t===void 0)&&t.getStats?yield this.sender.getStats():void 0})}setProcessor(t){return __awaiter(this,arguments,void 0,function(o){var e=this;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var a;const c=yield e.processorLock.lock();try{e.log.debug("setting up processor",e.logContext);const l=document.createElement(e.kind),u={kind:e.kind,track:e._mediaStreamTrack,element:l,audioContext:e.audioContext};if(yield o.init(u),e.log.debug("processor initialized",e.logContext),e.processor&&(yield e.stopProcessor()),e.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(attachToElement(e._mediaStreamTrack,l),l.muted=!0,l.play().catch(d=>e.log.error("failed to play processor element",Object.assign(Object.assign({},e.logContext),{error:d}))),e.processor=o,e.processorElement=l,e.processor.processedTrack){for(const d of e.attachedElements)d!==e.processorElement&&n&&(detachTrack(e._mediaStreamTrack,d),attachToElement(e.processor.processedTrack,d));yield(a=e.sender)===null||a===void 0?void 0:a.replaceTrack(e.processor.processedTrack)}e.emit(TrackEvent.TrackProcessorUpdate,e.processor)}finally{c()}}()})}getProcessor(){return this.processor}stopProcessor(){return __awaiter(this,arguments,void 0,function(){var t=this;let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var e,n;t.processor&&(t.log.debug("stopping processor",t.logContext),(e=t.processor.processedTrack)===null||e===void 0||e.stop(),yield t.processor.destroy(),t.processor=void 0,o||((n=t.processorElement)===null||n===void 0||n.remove(),t.processorElement=void 0),yield t._mediaStreamTrack.applyConstraints(t._constraints),yield t.setMediaStreamTrack(t._mediaStreamTrack,!0),t.emit(TrackEvent.TrackProcessorUpdate))}()})}}class E2EEManager extends eventsExports.EventEmitter{constructor(t){super(),this.onWorkerMessage=o=>{var e,n;const{kind:a,data:c}=o.data;switch(a){case"error":livekitLogger.error(c.error.message),this.emit(EncryptionEvent.EncryptionError,c.error);break;case"initAck":c.enabled&&this.keyProvider.getKeys().forEach(l=>{this.postKey(l)});break;case"enable":if(this.encryptionEnabled!==c.enabled&&c.participantIdentity===((e=this.room)===null||e===void 0?void 0:e.localParticipant.identity))this.emit(EncryptionEvent.ParticipantEncryptionStatusChanged,c.enabled,this.room.localParticipant),this.encryptionEnabled=c.enabled;else if(c.participantIdentity){const l=(n=this.room)===null||n===void 0?void 0:n.getParticipantByIdentity(c.participantIdentity);if(!l)throw TypeError("couldn't set encryption status, participant not found".concat(c.participantIdentity));this.emit(EncryptionEvent.ParticipantEncryptionStatusChanged,c.enabled,l)}this.encryptionEnabled&&this.keyProvider.getKeys().forEach(l=>{this.postKey(l)});break;case"ratchetKey":this.keyProvider.emit(KeyProviderEvent.KeyRatcheted,c.material,c.keyIndex);break}},this.onWorkerError=o=>{livekitLogger.error("e2ee worker encountered an error:",{error:o.error}),this.emit(EncryptionEvent.EncryptionError,o.error)},this.keyProvider=t.keyProvider,this.worker=t.worker,this.encryptionEnabled=!1}setup(t){if(!isE2EESupported())throw new DeviceUnsupportedError("tried to setup end-to-end encryption on an unsupported browser");if(livekitLogger.info("setting up e2ee"),t!==this.room){this.room=t,this.setupEventListeners(t,this.keyProvider);const o={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:workerLogger.getLevel()}};this.worker&&(livekitLogger.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(o))}}setParticipantCryptorEnabled(t,o){livekitLogger.debug("set e2ee to ".concat(t," for participant ").concat(o)),this.postEnable(t,o)}setSifTrailer(t){!t||t.length===0?livekitLogger.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(t)}setupEngine(t){t.on(EngineEvent.RTPVideoMapUpdate,o=>{this.postRTPMap(o)})}setupEventListeners(t,o){t.on(RoomEvent.TrackPublished,(e,n)=>this.setParticipantCryptorEnabled(e.trackInfo.encryption!==Encryption_Type.NONE,n.identity)),t.on(RoomEvent.ConnectionStateChanged,e=>{e===ConnectionState.Connected&&t.remoteParticipants.forEach(n=>{n.trackPublications.forEach(a=>{this.setParticipantCryptorEnabled(a.trackInfo.encryption!==Encryption_Type.NONE,n.identity)})})}).on(RoomEvent.TrackUnsubscribed,(e,n,a)=>{var c;const l={kind:"removeTransform",data:{participantIdentity:a.identity,trackId:e.mediaStreamID}};(c=this.worker)===null||c===void 0||c.postMessage(l)}).on(RoomEvent.TrackSubscribed,(e,n,a)=>{this.setupE2EEReceiver(e,a.identity,n.trackInfo)}).on(RoomEvent.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity),o.getKeys().forEach(e=>{this.postKey(e)})}),t.localParticipant.on(ParticipantEvent.LocalTrackPublished,e=>__awaiter(this,void 0,void 0,function*(){this.setupE2EESender(e.track,e.track.sender)})),o.on(KeyProviderEvent.SetKey,e=>this.postKey(e)).on(KeyProviderEvent.RatchetRequest,(e,n)=>this.postRatchetRequest(e,n))}postRatchetRequest(t,o){if(!this.worker)throw Error("could not ratchet key, worker is missing");const e={kind:"ratchetRequest",data:{participantIdentity:t,keyIndex:o}};this.worker.postMessage(e)}postKey(t){let{key:o,participantIdentity:e,keyIndex:n}=t;var a;if(!this.worker)throw Error("could not set key, worker is missing");const c={kind:"setKey",data:{participantIdentity:e,isPublisher:e===((a=this.room)===null||a===void 0?void 0:a.localParticipant.identity),key:o,keyIndex:n}};this.worker.postMessage(c)}postEnable(t,o){if(this.worker){const e={kind:"enable",data:{enabled:t,participantIdentity:o}};this.worker.postMessage(e)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(t){var o;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((o=this.room)===null||o===void 0)&&o.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const e={kind:"setRTPMap",data:{map:t,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(e)}postSifTrailer(t){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const o={kind:"setSifTrailer",data:{trailer:t}};this.worker.postMessage(o)}setupE2EEReceiver(t,o,e){if(t.receiver){if(!(e!=null&&e.mimeType)||e.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(t.receiver,t.mediaStreamID,o,t.kind==="video"?mimeTypeToVideoCodecString(e.mimeType):void 0)}}setupE2EESender(t,o){if(!(t instanceof LocalTrack)||!o){o||livekitLogger.warn("early return because sender is not ready");return}this.handleSender(o,t.mediaStreamID,void 0)}handleReceiver(t,o,e,n){return __awaiter(this,void 0,void 0,function*(){if(this.worker){if(isScriptTransformSupported()){const a={kind:"decode",participantIdentity:e,trackId:o,codec:n};t.transform=new RTCRtpScriptTransform(this.worker,a)}else{if(E2EE_FLAG in t&&n){const u={kind:"updateCodec",data:{trackId:o,codec:n,participantIdentity:e}};this.worker.postMessage(u);return}let a=t.writableStream,c=t.readableStream;if(!a||!c){const u=t.createEncodedStreams();t.writableStream=u.writable,a=u.writable,t.readableStream=u.readable,c=u.readable}const l={kind:"decode",data:{readableStream:c,writableStream:a,trackId:o,codec:n,participantIdentity:e}};this.worker.postMessage(l,[c,a])}t[E2EE_FLAG]=!0}})}handleSender(t,o,e){var n;if(!(E2EE_FLAG in t||!this.worker)){if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(isScriptTransformSupported()){livekitLogger.info("initialize script transform");const a={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:o,codec:e};t.transform=new RTCRtpScriptTransform(this.worker,a)}else{livekitLogger.info("initialize encoded streams");const a=t.createEncodedStreams(),c={kind:"encode",data:{readableStream:a.readable,writableStream:a.writable,codec:e,trackId:o,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(c,[a.readable,a.writable])}t[E2EE_FLAG]=!0}}}var QueueTaskStatus;(function(s){s[s.WAITING=0]="WAITING",s[s.RUNNING=1]="RUNNING",s[s.COMPLETED=2]="COMPLETED"})(QueueTaskStatus||(QueueTaskStatus={}));class AsyncQueue{constructor(){this.pendingTasks=new Map,this.taskMutex=new Mutex,this.nextTaskIndex=0}run(t){return __awaiter(this,void 0,void 0,function*(){const o={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:QueueTaskStatus.WAITING};this.pendingTasks.set(o.id,o);const e=yield this.taskMutex.lock();try{return o.executedAt=Date.now(),o.status=QueueTaskStatus.RUNNING,yield t()}finally{o.status=QueueTaskStatus.COMPLETED,this.pendingTasks.delete(o.id),e()}})}flush(){return __awaiter(this,void 0,void 0,function*(){return this.run(()=>__awaiter(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}const passThroughQueueSignals=["syncState","trickle","offer","answer","simulate","leave"];function canPassThroughQueue(s){const t=passThroughQueueSignals.indexOf(s.case)>=0;return livekitLogger.trace("request allowed to bypass queue:",{canPass:t,req:s}),t}var SignalConnectionState;(function(s){s[s.CONNECTING=0]="CONNECTING",s[s.CONNECTED=1]="CONNECTED",s[s.RECONNECTING=2]="RECONNECTING",s[s.DISCONNECTING=3]="DISCONNECTING",s[s.DISCONNECTED=4]="DISCONNECTED"})(SignalConnectionState||(SignalConnectionState={}));class SignalClient{get currentState(){return this.state}get isDisconnected(){return this.state===SignalConnectionState.DISCONNECTING||this.state===SignalConnectionState.DISCONNECTED}get isEstablishingConnection(){return this.state===SignalConnectionState.CONNECTING||this.state===SignalConnectionState.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var e;this.rtt=0,this.state=SignalConnectionState.DISCONNECTED,this.log=livekitLogger,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=getLogger((e=o.loggerName)!==null&&e!==void 0?e:LoggerNames.Signal),this.loggerContextCb=o.loggerContextCb,this.useJSON=t,this.requestQueue=new AsyncQueue,this.queuedRequests=[],this.closingLock=new Mutex,this.connectionLock=new Mutex,this.state=SignalConnectionState.DISCONNECTED}get logContext(){var t,o;return(o=(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this))!==null&&o!==void 0?o:{}}join(t,o,e,n){return __awaiter(this,void 0,void 0,function*(){return this.state=SignalConnectionState.CONNECTING,this.options=e,yield this.connect(t,o,e,n)})}reconnect(t,o,e,n){return __awaiter(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=SignalConnectionState.RECONNECTING,this.clearPingInterval(),yield this.connect(t,o,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:e,reconnectReason:n}))})}connect(t,o,e,n){this.connectOptions=e,t=toWebsocketUrl(t),t=t.replace(/\/$/,""),t+="/rtc";const a=getClientInfo(),c=createConnectionParams(o,a,e);return new Promise((l,u)=>__awaiter(this,void 0,void 0,function*(){const d=yield this.connectionLock.lock();try{const p=()=>__awaiter(this,void 0,void 0,function*(){this.close(),clearTimeout(g),u(new ConnectionError("room connection has been cancelled (signal)"))}),g=setTimeout(()=>{this.close(),u(new ConnectionError("room connection has timed out (signal)"))},e.websocketTimeout);n!=null&&n.aborted&&p(),n==null||n.addEventListener("abort",p),this.log.debug("connecting to ".concat(t+c),this.logContext),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(t+c),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(g)},this.ws.onerror=S=>__awaiter(this,void 0,void 0,function*(){if(this.state!==SignalConnectionState.CONNECTED){this.state=SignalConnectionState.DISCONNECTED,clearTimeout(g);try{const y=yield fetch("http".concat(t.substring(2),"/validate").concat(c));if(y.status.toFixed(0).startsWith("4")){const b=yield y.text();u(new ConnectionError(b,0,y.status))}else u(new ConnectionError("Internal error",2,y.status))}catch{u(new ConnectionError("server was not reachable",1))}return}this.handleWSError(S)}),this.ws.onmessage=S=>__awaiter(this,void 0,void 0,function*(){var y,b,k;let O;if(typeof S.data=="string"){const C=JSON.parse(S.data);O=SignalResponse.fromJson(C,{ignoreUnknownFields:!0})}else if(S.data instanceof ArrayBuffer)O=SignalResponse.fromBinary(new Uint8Array(S.data));else{this.log.error("could not decode websocket message: ".concat(typeof S.data),this.logContext);return}if(this.state!==SignalConnectionState.CONNECTED){let C=!1;if(((y=O.message)===null||y===void 0?void 0:y.case)==="join"?(this.state=SignalConnectionState.CONNECTED,n==null||n.removeEventListener("abort",p),this.pingTimeoutDuration=O.message.value.pingTimeout,this.pingIntervalDuration=O.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),l(O.message.value)):this.state===SignalConnectionState.RECONNECTING&&O.message.case!=="leave"?(this.state=SignalConnectionState.CONNECTED,n==null||n.removeEventListener("abort",p),this.startPingInterval(),((b=O.message)===null||b===void 0?void 0:b.case)==="reconnect"?l(O.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),l(void 0),C=!0)):this.isEstablishingConnection&&O.message.case==="leave"?u(new ConnectionError("Received leave request while trying to (re)connect",4)):e.reconnect||u(new ConnectionError("did not receive join response, got ".concat((k=O.message)===null||k===void 0?void 0:k.case," instead"))),!C)return}this.signalLatency&&(yield sleep(this.signalLatency)),this.handleSignalResponse(O)}),this.ws.onclose=S=>{this.isEstablishingConnection&&u(new ConnectionError("Websocket got closed during a (re)connection attempt")),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:S.reason,code:S.code,wasClean:S.wasClean,state:this.state})),this.handleOnClose(S.reason)}}finally{d()}}))}close(){return __awaiter(this,arguments,void 0,function(){var t=this;let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const e=yield t.closingLock.lock();try{if(t.clearPingInterval(),o&&(t.state=SignalConnectionState.DISCONNECTING),t.ws){t.ws.onmessage=null,t.ws.onopen=null,t.ws.onclose=null;const n=new Promise(a=>{t.ws?t.ws.onclose=()=>{a()}:a()});t.ws.readyState<t.ws.CLOSING&&(t.ws.close(),yield Promise.race([n,sleep(250)])),t.ws=void 0}}finally{o&&(t.state=SignalConnectionState.DISCONNECTED),e()}}()})}sendOffer(t){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:t.sdp})),this.sendRequest({case:"offer",value:toProtoSessionDescription(t)})}sendAnswer(t){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:t.sdp})),this.sendRequest({case:"answer",value:toProtoSessionDescription(t)})}sendIceCandidate(t,o){return this.log.trace("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:t})),this.sendRequest({case:"trickle",value:new TrickleRequest({candidateInit:JSON.stringify(t),target:o})})}sendMuteTrack(t,o){return this.sendRequest({case:"mute",value:new MuteTrackRequest({sid:t,muted:o})})}sendAddTrack(t){return this.sendRequest({case:"addTrack",value:t})}sendUpdateLocalMetadata(t,o){return __awaiter(this,arguments,void 0,function(e,n){var a=this;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const l=a.getNextRequestId();return yield a.sendRequest({case:"updateMetadata",value:new UpdateParticipantMetadata({requestId:l,metadata:e,name:n,attributes:c})}),l}()})}sendUpdateTrackSettings(t){this.sendRequest({case:"trackSetting",value:t})}sendUpdateSubscription(t){return this.sendRequest({case:"subscription",value:t})}sendSyncState(t){return this.sendRequest({case:"syncState",value:t})}sendUpdateVideoLayers(t,o){return this.sendRequest({case:"updateLayers",value:new UpdateVideoLayers({trackSid:t,layers:o})})}sendUpdateSubscriptionPermissions(t,o){return this.sendRequest({case:"subscriptionPermission",value:new SubscriptionPermission({allParticipants:t,trackPermissions:o})})}sendSimulateScenario(t){return this.sendRequest({case:"simulate",value:t})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:protoInt64.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Ping({timestamp:protoInt64.parse(Date.now()),rtt:protoInt64.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(t,o){return this.sendRequest({case:"updateAudioTrack",value:new UpdateLocalAudioTrack({trackSid:t,features:o})})}sendLeave(){return this.sendRequest({case:"leave",value:new LeaveRequest({reason:DisconnectReason.CLIENT_INITIATED,action:LeaveRequest_Action.DISCONNECT})})}sendRequest(t){return __awaiter(this,arguments,void 0,function(o){var e=this;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!n&&!canPassThroughQueue(o)&&e.state===SignalConnectionState.RECONNECTING){e.queuedRequests.push(()=>__awaiter(e,void 0,void 0,function*(){yield this.sendRequest(o,!0)}));return}if(n||(yield e.requestQueue.flush()),e.signalLatency&&(yield sleep(e.signalLatency)),!e.ws||e.ws.readyState!==e.ws.OPEN){e.log.error("cannot send signal request before connected, type: ".concat(o==null?void 0:o.case),e.logContext);return}const c=new SignalRequest({message:o});try{e.useJSON?e.ws.send(c.toJsonString()):e.ws.send(c.toBinary())}catch(l){e.log.error("error sending signal message",Object.assign(Object.assign({},e.logContext),{error:l}))}}()})}handleSignalResponse(t){var o,e;const n=t.message;if(n==null){this.log.debug("received unsupported message",this.logContext);return}let a=!1;if(n.case==="answer"){const c=fromProtoSessionDescription(n.value);this.onAnswer&&this.onAnswer(c)}else if(n.case==="offer"){const c=fromProtoSessionDescription(n.value);this.onOffer&&this.onOffer(c)}else if(n.case==="trickle"){const c=JSON.parse(n.value.candidateInit);this.onTrickle&&this.onTrickle(c,n.value.target)}else n.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((o=n.value.participants)!==null&&o!==void 0?o:[]):n.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(n.value):n.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((e=n.value.speakers)!==null&&e!==void 0?e:[]):n.case==="leave"?this.onLeave&&this.onLeave(n.value):n.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(n.value.sid,n.value.muted):n.case==="roomUpdate"?this.onRoomUpdate&&n.value.room&&this.onRoomUpdate(n.value.room):n.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(n.value):n.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(n.value):n.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(n.value):n.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(n.value):n.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(n.value):n.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(n.value):n.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(n.value):n.case==="pong"||(n.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(n.value.lastPingTimestamp.toString()),this.resetPingTimeout(),a=!0):n.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(n.value):n.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(n.value.trackSid):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:n.case})));a||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const t=this.queuedRequests.shift();t&&this.requestQueue.run(t)}}handleOnClose(t){return __awaiter(this,void 0,void 0,function*(){if(this.state===SignalConnectionState.DISCONNECTED)return;const o=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(t),Object.assign(Object.assign({},this.logContext),{reason:t})),o&&o(t)})}handleWSError(t){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:t}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=CriticalTimers.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&CriticalTimers.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=CriticalTimers.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&CriticalTimers.clearInterval(this.pingInterval)}}function fromProtoSessionDescription(s){const t={type:"offer",sdp:s.sdp};switch(s.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=s.type;break}return t}function toProtoSessionDescription(s){return new SessionDescription({sdp:s.sdp,type:s.type})}function createConnectionParams(s,t,o){var e;const n=new URLSearchParams;return n.set("access_token",s),o.reconnect&&(n.set("reconnect","1"),o.sid&&n.set("sid",o.sid)),n.set("auto_subscribe",o.autoSubscribe?"1":"0"),n.set("sdk",isReactNative()?"reactnative":"js"),n.set("version",t.version),n.set("protocol",t.protocol.toString()),t.deviceModel&&n.set("device_model",t.deviceModel),t.os&&n.set("os",t.os),t.osVersion&&n.set("os_version",t.osVersion),t.browser&&n.set("browser",t.browser),t.browserVersion&&n.set("browser_version",t.browserVersion),o.adaptiveStream&&n.set("adaptive_stream","1"),o.reconnectReason&&n.set("reconnect_reason",o.reconnectReason.toString()),!((e=navigator.connection)===null||e===void 0)&&e.type&&n.set("network",navigator.connection.type),"?".concat(n.toString())}var parser$1={},grammar$2={exports:{}},grammar$1=grammar$2.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(s){return s.encoding?"rtpmap:%d %s/%s/%s":s.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(s){return s.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(s){return s.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(s){return"extmap:%d"+(s.direction?"/%s":"%v")+(s["encrypt-uri"]?" %s":"%v")+" %s"+(s.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(s){return s.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(s){var t="candidate:%s %d %s %d %s %d typ %s";return t+=s.raddr!=null?" raddr %s rport %d":"%v%v",t+=s.tcptype!=null?" tcptype %s":"%v",s.generation!=null&&(t+=" generation %d"),t+=s["network-id"]!=null?" network-id %d":"%v",t+=s["network-cost"]!=null?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(s){var t="ssrc:%d";return s.attribute!=null&&(t+=" %s",s.value!=null&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(s){return s.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(s){return s.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(s){return"imageattr:%s %s %s"+(s.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(s){return"simulcast:%s %s"+(s.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(s){return"ts-refclk:%s"+(s.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(s){var t="mediaclk:";return t+=s.id!=null?"id=%s %s":"%v%s",t+=s.mediaClockValue!=null?"=%s":"",t+=s.rateNumerator!=null?" rate=%s":"",t+=s.rateDenominator!=null?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(grammar$1).forEach(function(s){var t=grammar$1[s];t.forEach(function(o){o.reg||(o.reg=/(.*)/),o.format||(o.format="%s")})});var grammarExports=grammar$2.exports;(function(s){var t=function(l){return String(Number(l))===l?Number(l):l},o=function(l,u,d,p){if(p&&!d)u[p]=t(l[1]);else for(var g=0;g<d.length;g+=1)l[g+1]!=null&&(u[d[g]]=t(l[g+1]))},e=function(l,u,d){var p=l.name&&l.names;l.push&&!u[l.push]?u[l.push]=[]:p&&!u[l.name]&&(u[l.name]={});var g=l.push?{}:p?u[l.name]:u;o(d.match(l.reg),g,l.names,l.name),l.push&&u[l.push].push(g)},n=grammarExports,a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);s.parse=function(l){var u={},d=[],p=u;return l.split(/(\r\n|\r|\n)/).filter(a).forEach(function(g){var S=g[0],y=g.slice(2);S==="m"&&(d.push({rtp:[],fmtp:[]}),p=d[d.length-1]);for(var b=0;b<(n[S]||[]).length;b+=1){var k=n[S][b];if(k.reg.test(y))return e(k,p,y)}}),u.media=d,u};var c=function(l,u){var d=u.split(/=(.+)/,2);return d.length===2?l[d[0]]=t(d[1]):d.length===1&&u.length>1&&(l[d[0]]=void 0),l};s.parseParams=function(l){return l.split(/;\s?/).reduce(c,{})},s.parseFmtpConfig=s.parseParams,s.parsePayloads=function(l){return l.toString().split(" ").map(Number)},s.parseRemoteCandidates=function(l){for(var u=[],d=l.split(" ").map(t),p=0;p<d.length;p+=3)u.push({component:d[p],ip:d[p+1],port:d[p+2]});return u},s.parseImageAttributes=function(l){return l.split(" ").map(function(u){return u.substring(1,u.length-1).split(",").reduce(c,{})})},s.parseSimulcastStreamList=function(l){return l.split(";").map(function(u){return u.split(",").map(function(d){var p,g=!1;return d[0]!=="~"?p=t(d):(p=t(d.substring(1,d.length)),g=!0),{scid:p,paused:g}})})}})(parser$1);var grammar=grammarExports,formatRegExp=/%[sdv%]/g,format=function(s){var t=1,o=arguments,e=o.length;return s.replace(formatRegExp,function(n){if(t>=e)return n;var a=o[t];switch(t+=1,n){case"%%":return"%";case"%s":return String(a);case"%d":return Number(a);case"%v":return""}})},makeLine=function(s,t,o){var e=t.format instanceof Function?t.format(t.push?o:o[t.name]):t.format,n=[s+"="+e];if(t.names)for(var a=0;a<t.names.length;a+=1){var c=t.names[a];t.name?n.push(o[t.name][c]):n.push(o[t.names[a]])}else n.push(o[t.name]);return format.apply(null,n)},defaultOuterOrder=["v","o","s","i","u","e","p","c","b","t","r","z","a"],defaultInnerOrder=["i","c","b","a"],writer$1=function(s,t){t=t||{},s.version==null&&(s.version=0),s.name==null&&(s.name=" "),s.media.forEach(function(a){a.payloads==null&&(a.payloads="")});var o=t.outerOrder||defaultOuterOrder,e=t.innerOrder||defaultInnerOrder,n=[];return o.forEach(function(a){grammar[a].forEach(function(c){c.name in s&&s[c.name]!=null?n.push(makeLine(a,c,s)):c.push in s&&s[c.push]!=null&&s[c.push].forEach(function(l){n.push(makeLine(a,c,l))})})}),s.media.forEach(function(a){n.push(makeLine("m",grammar.m[0],a)),e.forEach(function(c){grammar[c].forEach(function(l){l.name in a&&a[l.name]!=null?n.push(makeLine(c,l,a)):l.push in a&&a[l.push]!=null&&a[l.push].forEach(function(u){n.push(makeLine(c,l,u))})})})}),n.join(`\r
`)+`\r
`},parser=parser$1,writer$2=writer$1,write=writer$2,parse=parser.parse;const startBitrateForSVC=.7,debounceInterval=20,PCEvents={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class PCTransport extends eventsExports.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(t){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var e;super(),this.log=livekitLogger,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=r(n=>__awaiter(this,void 0,void 0,function*(){this.emit(PCEvents.NegotiationStarted);try{yield this.createAndSendOffer()}catch(a){if(n)n(a);else throw a}}),debounceInterval),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=getLogger((e=o.loggerName)!==null&&e!==void 0?e:LoggerNames.PCTransport),this.loggerOptions=o,this.config=t,this._pc=this.createPC()}createPC(){const t=new RTCPeerConnection(this.config);return t.onicecandidate=o=>{var e;o.candidate&&((e=this.onIceCandidate)===null||e===void 0||e.call(this,o.candidate))},t.onicecandidateerror=o=>{var e;(e=this.onIceCandidateError)===null||e===void 0||e.call(this,o)},t.oniceconnectionstatechange=()=>{var o;(o=this.onIceConnectionStateChange)===null||o===void 0||o.call(this,t.iceConnectionState)},t.onsignalingstatechange=()=>{var o;(o=this.onSignalingStatechange)===null||o===void 0||o.call(this,t.signalingState)},t.onconnectionstatechange=()=>{var o;(o=this.onConnectionStateChange)===null||o===void 0||o.call(this,t.connectionState)},t.ondatachannel=o=>{var e;(e=this.onDataChannel)===null||e===void 0||e.call(this,o)},t.ontrack=o=>{var e;(e=this.onTrack)===null||e===void 0||e.call(this,o)},t}get logContext(){var t,o;return Object.assign({},(o=(t=this.loggerOptions).loggerContextCb)===null||o===void 0?void 0:o.call(t))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(t){return __awaiter(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(t);this.pendingCandidates.push(t)})}setRemoteDescription(t){return __awaiter(this,void 0,void 0,function*(){var o;let e;if(t.type==="offer"){let{stereoMids:n,nackMids:a}=extractStereoAndNackAudioFromOffer(t);this.remoteStereoMids=n,this.remoteNackMids=a}else if(t.type==="answer"){const n=parse((o=t.sdp)!==null&&o!==void 0?o:"");n.media.forEach(a=>{a.type==="audio"&&this.trackBitrates.some(c=>{if(!c.transceiver||a.mid!=c.transceiver.mid)return!1;let l=0;if(a.rtp.some(d=>d.codec.toUpperCase()===c.codec.toUpperCase()?(l=d.payload,!0):!1),l===0)return!0;let u=!1;for(const d of a.fmtp)if(d.payload===l){d.config=d.config.split(";").filter(p=>!p.includes("maxaveragebitrate")).join(";"),c.maxbr>0&&(d.config+=";maxaveragebitrate=".concat(c.maxbr*1e3)),u=!0;break}return u||c.maxbr>0&&a.fmtp.push({payload:l,config:"maxaveragebitrate=".concat(c.maxbr*1e3)}),!0})}),e=write(n)}yield this.setMungedSDP(t,e,!0),this.pendingCandidates.forEach(n=>{this.pc.addIceCandidate(n)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):t.type==="answer"&&(this.emit(PCEvents.NegotiationComplete),t.sdp&&parse(t.sdp).media.forEach(a=>{a.type==="video"&&this.emit(PCEvents.RTPVideoPayloadTypes,a.rtp)}))})}createAndSendOffer(t){return __awaiter(this,void 0,void 0,function*(){var o;if(this.onOffer===void 0)return;if(t!=null&&t.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const a=this._pc.remoteDescription;if(t!=null&&t.iceRestart&&a)yield this._pc.setRemoteDescription(a);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const e=yield this.pc.createOffer(t);this.log.debug("original offer",Object.assign({sdp:e.sdp},this.logContext));const n=parse((o=e.sdp)!==null&&o!==void 0?o:"");n.media.forEach(a=>{a.type==="audio"?ensureAudioNackAndStereo(a,[],[]):a.type==="video"&&this.trackBitrates.some(c=>{if(!a.msid||!c.cid||!a.msid.includes(c.cid))return!1;let l=0;if(a.rtp.some(d=>d.codec.toUpperCase()===c.codec.toUpperCase()?(l=d.payload,!0):!1),l===0||(isSVCCodec(c.codec)&&ensureVideoDDExtensionForSVC(a),c.codec!=="av1"))return!0;const u=Math.round(c.maxbr*startBitrateForSVC);for(const d of a.fmtp)if(d.payload===l){d.config.includes("x-google-start-bitrate")||(d.config+=";x-google-start-bitrate=".concat(u));break}return!0})}),yield this.setMungedSDP(e,write(n)),this.onOffer(e)})}createAndSetAnswer(){return __awaiter(this,void 0,void 0,function*(){var t;const o=yield this.pc.createAnswer(),e=parse((t=o.sdp)!==null&&t!==void 0?t:"");return e.media.forEach(n=>{n.type==="audio"&&ensureAudioNackAndStereo(n,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(o,write(e)),o})}createDataChannel(t,o){return this.pc.createDataChannel(t,o)}addTransceiver(t,o){return this.pc.addTransceiver(t,o)}addTrack(t){if(!this._pc)throw new UnexpectedConnectionState("PC closed, cannot add track");return this._pc.addTrack(t)}setTrackCodecBitrate(t){this.trackBitrates.push(t)}setConfiguration(t){var o;if(!this._pc)throw new UnexpectedConnectionState("PC closed, cannot configure");return(o=this._pc)===null||o===void 0?void 0:o.setConfiguration(t)}canRemoveTrack(){var t;return!!(!((t=this._pc)===null||t===void 0)&&t.removeTrack)}removeTrack(t){var o;return(o=this._pc)===null||o===void 0?void 0:o.removeTrack(t)}getConnectionState(){var t,o;return(o=(t=this._pc)===null||t===void 0?void 0:t.connectionState)!==null&&o!==void 0?o:"closed"}getICEConnectionState(){var t,o;return(o=(t=this._pc)===null||t===void 0?void 0:t.iceConnectionState)!==null&&o!==void 0?o:"closed"}getSignallingState(){var t,o;return(o=(t=this._pc)===null||t===void 0?void 0:t.signalingState)!==null&&o!==void 0?o:"closed"}getTransceivers(){var t,o;return(o=(t=this._pc)===null||t===void 0?void 0:t.getTransceivers())!==null&&o!==void 0?o:[]}getSenders(){var t,o;return(o=(t=this._pc)===null||t===void 0?void 0:t.getSenders())!==null&&o!==void 0?o:[]}getLocalDescription(){var t;return(t=this._pc)===null||t===void 0?void 0:t.localDescription}getRemoteDescription(){var t;return(t=this.pc)===null||t===void 0?void 0:t.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return __awaiter(this,void 0,void 0,function*(){var t;if(!this._pc)return;let o="";const e=new Map,n=new Map;if((yield this._pc.getStats()).forEach(l=>{switch(l.type){case"transport":o=l.selectedCandidatePairId;break;case"candidate-pair":o===""&&l.selected&&(o=l.id),e.set(l.id,l);break;case"remote-candidate":n.set(l.id,"".concat(l.address,":").concat(l.port));break}}),o==="")return;const c=(t=e.get(o))===null||t===void 0?void 0:t.remoteCandidateId;if(c!==void 0)return n.get(c)})}setMungedSDP(t,o,e){return __awaiter(this,void 0,void 0,function*(){if(o){const n=t.sdp;t.sdp=o;try{this.log.debug("setting munged ".concat(e?"remote":"local"," description"),this.logContext),e?yield this.pc.setRemoteDescription(t):yield this.pc.setLocalDescription(t);return}catch(a){this.log.warn("not able to set ".concat(t.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:a,sdp:o})),t.sdp=n}}try{e?yield this.pc.setRemoteDescription(t):yield this.pc.setLocalDescription(t)}catch(n){let a="unknown error";n instanceof Error?a=n.message:typeof n=="string"&&(a=n);const c={error:a,sdp:t.sdp};throw!e&&this.pc.remoteDescription&&(c.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(t.type),Object.assign(Object.assign({},this.logContext),{fields:c})),new NegotiationError(a)}})}}function ensureAudioNackAndStereo(s,t,o){let e=0;s.rtp.some(n=>n.codec==="opus"?(e=n.payload,!0):!1),e>0&&(s.rtcpFb||(s.rtcpFb=[]),o.includes(s.mid)&&!s.rtcpFb.some(n=>n.payload===e&&n.type==="nack")&&s.rtcpFb.push({payload:e,type:"nack"}),t.includes(s.mid)&&s.fmtp.some(n=>n.payload===e?(n.config.includes("stereo=1")||(n.config+=";stereo=1"),!0):!1))}function ensureVideoDDExtensionForSVC(s){var t,o;let e=0;((t=s.ext)===null||t===void 0?void 0:t.some(a=>a.uri===ddExtensionURI?!0:(a.value>e&&(e=a.value),!1)))||(o=s.ext)===null||o===void 0||o.push({value:e+1,uri:ddExtensionURI})}function extractStereoAndNackAudioFromOffer(s){var t;const o=[],e=[],n=parse((t=s.sdp)!==null&&t!==void 0?t:"");let a=0;return n.media.forEach(c=>{var l;c.type==="audio"&&(c.rtp.some(u=>u.codec==="opus"?(a=u.payload,!0):!1),!((l=c.rtcpFb)===null||l===void 0)&&l.some(u=>u.payload===a&&u.type==="nack")&&e.push(c.mid),c.fmtp.some(u=>u.payload===a?(u.config.includes("sprop-stereo=1")&&o.push(c.mid),!0):!1))}),{stereoMids:o,nackMids:e}}const defaultVideoCodec="vp8",publishDefaults={audioPreset:AudioPresets.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:ScreenSharePresets.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:defaultVideoCodec,backupCodec:!0},audioDefaults={autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0},videoDefaults={resolution:VideoPresets.h720.resolution},roomOptionDefaults={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new DefaultReconnectPolicy,disconnectOnPageLeave:!0,webAudioMix:!1},roomConnectOptionDefaults={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var PCTransportState;(function(s){s[s.NEW=0]="NEW",s[s.CONNECTING=1]="CONNECTING",s[s.CONNECTED=2]="CONNECTED",s[s.FAILED=3]="FAILED",s[s.CLOSING=4]="CLOSING",s[s.CLOSED=5]="CLOSED"})(PCTransportState||(PCTransportState={}));class PCTransportManager{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(t,o,e){var n;this.peerConnectionTimeout=roomConnectOptionDefaults.peerConnectionTimeout,this.log=livekitLogger,this.updateState=()=>{var a;const c=this.state,l=this.requiredTransports.map(u=>u.getConnectionState());l.every(u=>u==="connected")?this.state=PCTransportState.CONNECTED:l.some(u=>u==="failed")?this.state=PCTransportState.FAILED:l.some(u=>u==="connecting")?this.state=PCTransportState.CONNECTING:l.every(u=>u==="closed")?this.state=PCTransportState.CLOSED:l.some(u=>u==="closed")?this.state=PCTransportState.CLOSING:l.every(u=>u==="new")&&(this.state=PCTransportState.NEW),c!==this.state&&(this.log.debug("pc state change: from ".concat(PCTransportState[c]," to ").concat(PCTransportState[this.state]),this.logContext),(a=this.onStateChange)===null||a===void 0||a.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=getLogger((n=e.loggerName)!==null&&n!==void 0?n:LoggerNames.PCManager),this.loggerOptions=e,this.isPublisherConnectionRequired=!o,this.isSubscriberConnectionRequired=o,this.publisher=new PCTransport(t,e),this.subscriber=new PCTransport(t,e),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=a=>{var c;(c=this.onIceCandidate)===null||c===void 0||c.call(this,a,SignalTarget.PUBLISHER)},this.subscriber.onIceCandidate=a=>{var c;(c=this.onIceCandidate)===null||c===void 0||c.call(this,a,SignalTarget.SUBSCRIBER)},this.subscriber.onDataChannel=a=>{var c;(c=this.onDataChannel)===null||c===void 0||c.call(this,a)},this.subscriber.onTrack=a=>{var c;(c=this.onTrack)===null||c===void 0||c.call(this,a)},this.publisher.onOffer=a=>{var c;(c=this.onPublisherOffer)===null||c===void 0||c.call(this,a)},this.state=PCTransportState.NEW,this.connectionLock=new Mutex}get logContext(){var t,o;return Object.assign({},(o=(t=this.loggerOptions).loggerContextCb)===null||o===void 0?void 0:o.call(t))}requirePublisher(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=t,this.updateState()}requireSubscriber(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=t,this.updateState()}createAndSendPublisherOffer(t){return this.publisher.createAndSendOffer(t)}setPublisherAnswer(t){return this.publisher.setRemoteDescription(t)}removeTrack(t){return this.publisher.removeTrack(t)}close(){return __awaiter(this,void 0,void 0,function*(){if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const t=this.publisher;for(const o of t.getSenders())try{t.canRemoveTrack()&&t.removeTrack(o)}catch(e){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:e}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return __awaiter(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(t,o){return __awaiter(this,void 0,void 0,function*(){o===SignalTarget.PUBLISHER?yield this.publisher.addIceCandidate(t):yield this.subscriber.addIceCandidate(t)})}createSubscriberAnswerFromOffer(t){return __awaiter(this,void 0,void 0,function*(){return this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:t.type,sdp:t.sdp,signalingState:this.subscriber.getSignallingState().toString()})),yield this.subscriber.setRemoteDescription(t),yield this.subscriber.createAndSetAnswer()})}updateConfiguration(t,o){this.publisher.setConfiguration(t),this.subscriber.setConfiguration(t),o&&this.triggerIceRestart()}ensurePCTransportConnection(t,o){return __awaiter(this,void 0,void 0,function*(){var e;const n=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((e=this.requiredTransports)===null||e===void 0?void 0:e.map(a=>this.ensureTransportConnected(a,t,o)))}finally{n()}})}negotiate(t){return __awaiter(this,void 0,void 0,function*(){return new Promise((o,e)=>__awaiter(this,void 0,void 0,function*(){const n=setTimeout(()=>{e("negotiation timed out")},this.peerConnectionTimeout),a=()=>{clearTimeout(n),e("negotiation aborted")};t.signal.addEventListener("abort",a),this.publisher.once(PCEvents.NegotiationStarted,()=>{t.signal.aborted||this.publisher.once(PCEvents.NegotiationComplete,()=>{clearTimeout(n),o()})}),yield this.publisher.negotiate(c=>{clearTimeout(n),e(c)})}))})}addPublisherTransceiver(t,o){return this.publisher.addTransceiver(t,o)}addPublisherTrack(t){return this.publisher.addTrack(t)}createPublisherDataChannel(t,o){return this.publisher.createDataChannel(t,o)}getConnectedAddress(t){return t===SignalTarget.PUBLISHER?this.publisher.getConnectedAddress():t===SignalTarget.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const t=[];return this.isPublisherConnectionRequired&&t.push(this.publisher),this.isSubscriberConnectionRequired&&t.push(this.subscriber),t}ensureTransportConnected(t,o){return __awaiter(this,arguments,void 0,function(e,n){var a=this;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(e.getConnectionState()!=="connected")return new Promise((u,d)=>__awaiter(a,void 0,void 0,function*(){const p=()=>{this.log.warn("abort transport connection",this.logContext),CriticalTimers.clearTimeout(g),d(new ConnectionError("room connection has been cancelled",3))};n!=null&&n.signal.aborted&&p(),n==null||n.signal.addEventListener("abort",p);const g=CriticalTimers.setTimeout(()=>{n==null||n.signal.removeEventListener("abort",p),d(new ConnectionError("could not establish pc connection"))},c);for(;this.state!==PCTransportState.CONNECTED;)if(yield sleep(50),n!=null&&n.signal.aborted){d(new ConnectionError("room connection has been cancelled",3));return}CriticalTimers.clearTimeout(g),n==null||n.signal.removeEventListener("abort",p),u()}))}()})}}const monitorFrequency=2e3;function computeBitrate(s,t){if(!t)return 0;let o,e;return"bytesReceived"in s?(o=s.bytesReceived,e=t.bytesReceived):"bytesSent"in s&&(o=s.bytesSent,e=t.bytesSent),o===void 0||e===void 0||s.timestamp===void 0||t.timestamp===void 0?0:(o-e)*8*1e3/(s.timestamp-t.timestamp)}class LocalAudioTrack extends LocalTrack{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(t,o){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;super(t,Track.Kind.Audio,o,e,a),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>__awaiter(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let c;try{c=yield this.getSenderStats()}catch(l){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:l}));return}c&&this.prevStats&&(this._currentBitrate=computeBitrate(c,this.prevStats)),this.prevStats=c}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(TrackEvent.AudioTrackFeatureUpdate,this,AudioTrackFeature.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(TrackEvent.AudioTrackFeatureUpdate,this,AudioTrackFeature.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=n,this.checkForSilence()}setDeviceId(t){return __awaiter(this,void 0,void 0,function*(){return this._constraints.deviceId===t&&this._mediaStreamTrack.getSettings().deviceId===unwrapConstraint(t)?!0:(this._constraints.deviceId=t,this.isMuted||(yield this.restartTrack()),this.isMuted||unwrapConstraint(t)===this._mediaStreamTrack.getSettings().deviceId)})}mute(){const t=Object.create(null,{mute:{get:()=>super.mute}});return __awaiter(this,void 0,void 0,function*(){const o=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===Track.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield t.mute.call(this),this)}finally{o()}})}unmute(){const t=Object.create(null,{unmute:{get:()=>super.unmute}});return __awaiter(this,void 0,void 0,function*(){const o=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const e=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==unwrapConstraint(this._constraints.deviceId);return this.source===Track.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||e)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield t.unmute.call(this),this}finally{o()}})}restartTrack(t){return __awaiter(this,void 0,void 0,function*(){let o;if(t){const e=constraintsForOptions({audio:t});typeof e.audio!="boolean"&&(o=e.audio)}yield this.restart(o)})}restart(t){const o=Object.create(null,{restart:{get:()=>super.restart}});return __awaiter(this,void 0,void 0,function*(){const e=yield o.restart.call(this,t);return this.checkForSilence(),e})}startMonitor(){isWeb()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},monitorFrequency)))}setProcessor(t){return __awaiter(this,void 0,void 0,function*(){var o;const e=yield this.processorLock.lock();try{if(!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.stopProcessor());const n={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(t.name),this.logContext),yield t.init(n),this.processor=t,this.processor.processedTrack&&(yield(o=this.sender)===null||o===void 0?void 0:o.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(TrackEvent.TrackProcessorUpdate,this.processor)}finally{e()}})}setAudioContext(t){this.audioContext=t}getSenderStats(){return __awaiter(this,void 0,void 0,function*(){var t;if(!(!((t=this.sender)===null||t===void 0)&&t.getStats))return;const o=yield this.sender.getStats();let e;return o.forEach(n=>{n.type==="outbound-rtp"&&(e={type:"audio",streamId:n.id,packetsSent:n.packetsSent,packetsLost:n.packetsLost,bytesSent:n.bytesSent,timestamp:n.timestamp,roundTripTime:n.roundTripTime,jitter:n.jitter})}),e})}checkForSilence(){return __awaiter(this,void 0,void 0,function*(){const t=yield detectSilence(this);return t&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(TrackEvent.AudioSilenceDetected)),t})}}function mediaTrackToLocalTrack(s,t,o){switch(s.kind){case"audio":return new LocalAudioTrack(s,t,!1,void 0,o);case"video":return new LocalVideoTrack(s,t,!1,o);default:throw new TrackInvalidError("unsupported track type: ".concat(s.kind))}}const presets169=Object.values(VideoPresets),presets43=Object.values(VideoPresets43),presetsScreenShare=Object.values(ScreenSharePresets),defaultSimulcastPresets169=[VideoPresets.h180,VideoPresets.h360],defaultSimulcastPresets43=[VideoPresets43.h180,VideoPresets43.h360],computeDefaultScreenShareSimulcastPresets=s=>[{scaleResolutionDownBy:2,fps:s.encoding.maxFramerate}].map(o=>{var e,n;return new VideoPreset(Math.floor(s.width/o.scaleResolutionDownBy),Math.floor(s.height/o.scaleResolutionDownBy),Math.max(15e4,Math.floor(s.encoding.maxBitrate/(Math.pow(o.scaleResolutionDownBy,2)*(((e=s.encoding.maxFramerate)!==null&&e!==void 0?e:30)/((n=o.fps)!==null&&n!==void 0?n:30))))),o.fps,s.encoding.priority)}),videoRids=["q","h","f"];function computeVideoEncodings(s,t,o,e){var n,a;let c=e==null?void 0:e.videoEncoding;s&&(c=e==null?void 0:e.screenShareEncoding);const l=e==null?void 0:e.simulcast,u=e==null?void 0:e.scalabilityMode,d=e==null?void 0:e.videoCodec;if(!c&&!l&&!u||!t||!o)return[{}];c||(c=determineAppropriateEncoding(s,t,o,d),livekitLogger.debug("using video encoding",c));const p=new VideoPreset(t,o,c.maxBitrate,c.maxFramerate,c.priority);if(u&&isSVCCodec(d)){const y=new ScalabilityMode(u),b=[];if(y.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(u));const k=getBrowser();if(isSafari()||isReactNative()||(k==null?void 0:k.name)==="Chrome"&&compareVersions(k==null?void 0:k.version,"113")<0){const O=y.suffix=="h"?2:3;for(let C=0;C<y.spatial;C+=1)b.push({rid:videoRids[2-C],maxBitrate:c.maxBitrate/Math.pow(O,C),maxFramerate:p.encoding.maxFramerate});b[0].scalabilityMode=u}else b.push({maxBitrate:c.maxBitrate,maxFramerate:p.encoding.maxFramerate,scalabilityMode:u});return p.encoding.priority&&(b[0].priority=p.encoding.priority,b[0].networkPriority=p.encoding.priority),livekitLogger.debug("using svc encoding",{encodings:b}),b}if(!l)return[c];let g=[];s?g=(n=sortPresets(e==null?void 0:e.screenShareSimulcastLayers))!==null&&n!==void 0?n:defaultSimulcastLayers(s,p):g=(a=sortPresets(e==null?void 0:e.videoSimulcastLayers))!==null&&a!==void 0?a:defaultSimulcastLayers(s,p);let S;if(g.length>0){const y=g[0];g.length>1&&([,S]=g);const b=Math.max(t,o);if(b>=960&&S)return encodingsFromPresets(t,o,[y,S,p]);if(b>=480)return encodingsFromPresets(t,o,[y,p])}return encodingsFromPresets(t,o,[p])}function computeTrackBackupEncodings(s,t,o){var e,n,a,c;if(!o.backupCodec||o.backupCodec===!0||o.backupCodec.codec===o.videoCodec)return;t!==o.backupCodec.codec&&livekitLogger.warn("requested a different codec than specified as backup",{serverRequested:t,backup:o.backupCodec.codec}),o.videoCodec=t,o.videoEncoding=o.backupCodec.encoding;const l=s.mediaStreamTrack.getSettings(),u=(e=l.width)!==null&&e!==void 0?e:(n=s.dimensions)===null||n===void 0?void 0:n.width,d=(a=l.height)!==null&&a!==void 0?a:(c=s.dimensions)===null||c===void 0?void 0:c.height;return computeVideoEncodings(s.source===Track.Source.ScreenShare,u,d,o)}function determineAppropriateEncoding(s,t,o,e){const n=presetsForResolution(s,t,o);let{encoding:a}=n[0];const c=Math.max(t,o);for(let l=0;l<n.length;l+=1){const u=n[l];if(a=u.encoding,u.width>=c)break}if(e)switch(e){case"av1":a=Object.assign({},a),a.maxBitrate=a.maxBitrate*.7;break;case"vp9":a=Object.assign({},a),a.maxBitrate=a.maxBitrate*.85;break}return a}function presetsForResolution(s,t,o){if(s)return presetsScreenShare;const e=t>o?t/o:o/t;return Math.abs(e-16/9)<Math.abs(e-4/3)?presets169:presets43}function defaultSimulcastLayers(s,t){if(s)return computeDefaultScreenShareSimulcastPresets(t);const{width:o,height:e}=t,n=o>e?o/e:e/o;return Math.abs(n-16/9)<Math.abs(n-4/3)?defaultSimulcastPresets169:defaultSimulcastPresets43}function encodingsFromPresets(s,t,o){const e=[];if(o.forEach((n,a)=>{if(a>=videoRids.length)return;const c=Math.min(s,t),u={rid:videoRids[a],scaleResolutionDownBy:Math.max(1,c/Math.min(n.width,n.height)),maxBitrate:n.encoding.maxBitrate};n.encoding.maxFramerate&&(u.maxFramerate=n.encoding.maxFramerate);const d=isFireFox()||a===0;n.encoding.priority&&d&&(u.priority=n.encoding.priority,u.networkPriority=n.encoding.priority),e.push(u)}),isReactNative()&&getReactNativeOs()==="ios"){let n;e.forEach(c=>{n?c.maxFramerate&&c.maxFramerate>n&&(n=c.maxFramerate):n=c.maxFramerate});let a=!0;e.forEach(c=>{var l;c.maxFramerate!=n&&(a&&(a=!1,livekitLogger.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),livekitLogger.info('Setting framerate of encoding "'.concat((l=c.rid)!==null&&l!==void 0?l:"",'" to ').concat(n)),c.maxFramerate=n)})}return e}function sortPresets(s){if(s)return s.sort((t,o)=>{const{encoding:e}=t,{encoding:n}=o;return e.maxBitrate>n.maxBitrate?1:e.maxBitrate<n.maxBitrate?-1:e.maxBitrate===n.maxBitrate&&e.maxFramerate&&n.maxFramerate?e.maxFramerate>n.maxFramerate?1:-1:0})}class ScalabilityMode{constructor(t){const o=t.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!o)throw new Error("invalid scalability mode");if(this.spatial=parseInt(o[1]),this.temporal=parseInt(o[2]),o.length>3)switch(o[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=o[3]}}toString(){var t;return"L".concat(this.spatial,"T").concat(this.temporal).concat((t=this.suffix)!==null&&t!==void 0?t:"")}}function getDefaultDegradationPreference(s){return s.source===Track.Source.ScreenShare||s.constraints.height&&unwrapConstraint(s.constraints.height)>=1080?"maintain-resolution":"balanced"}const refreshSubscribedCodecAfterNewCodec=5e3;class LocalVideoTrack extends LocalTrack{get sender(){return this._sender}set sender(t){this._sender=t,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(t,o){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=arguments.length>3?arguments[3]:void 0;super(t,Track.Kind.Video,o,e,n),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.monitorSender=()=>__awaiter(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let a;try{a=yield this.getSenderStats()}catch(l){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:l}));return}const c=new Map(a.map(l=>[l.rid,l]));if(this.prevStats){let l=0;c.forEach((u,d)=>{var p;const g=(p=this.prevStats)===null||p===void 0?void 0:p.get(d);l+=computeBitrate(u,g)}),this._currentBitrate=l}this.prevStats=c}),this.senderLock=new Mutex}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(t){var o;if(this.signalClient=t,!isWeb())return;const e=(o=this.sender)===null||o===void 0?void 0:o.getParameters();e&&(this.encodings=e.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},monitorFrequency))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(t=>{t.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const t=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return __awaiter(this,void 0,void 0,function*(){var o,e,n,a,c;yield t.pauseUpstream.call(this);try{for(var l=!0,u=__asyncValues(this.simulcastCodecs.values()),d;d=yield u.next(),o=d.done,!o;l=!0)a=d.value,l=!1,yield(c=a.sender)===null||c===void 0?void 0:c.replaceTrack(null)}catch(p){e={error:p}}finally{try{!l&&!o&&(n=u.return)&&(yield n.call(u))}finally{if(e)throw e.error}}})}resumeUpstream(){const t=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return __awaiter(this,void 0,void 0,function*(){var o,e,n,a,c;yield t.resumeUpstream.call(this);try{for(var l=!0,u=__asyncValues(this.simulcastCodecs.values()),d;d=yield u.next(),o=d.done,!o;l=!0){a=d.value,l=!1;const p=a;yield(c=p.sender)===null||c===void 0?void 0:c.replaceTrack(p.mediaStreamTrack)}}catch(p){e={error:p}}finally{try{!l&&!o&&(n=u.return)&&(yield n.call(u))}finally{if(e)throw e.error}}})}mute(){const t=Object.create(null,{mute:{get:()=>super.mute}});return __awaiter(this,void 0,void 0,function*(){const o=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===Track.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield t.mute.call(this),this)}finally{o()}})}unmute(){const t=Object.create(null,{unmute:{get:()=>super.unmute}});return __awaiter(this,void 0,void 0,function*(){const o=yield this.muteLock.lock();try{return this.isMuted?(this.source===Track.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield t.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{o()}})}setTrackMuted(t){super.setTrackMuted(t);for(const o of this.simulcastCodecs.values())o.mediaStreamTrack.enabled=!t}getSenderStats(){return __awaiter(this,void 0,void 0,function*(){var t;if(!(!((t=this.sender)===null||t===void 0)&&t.getStats))return[];const o=[],e=yield this.sender.getStats();return e.forEach(n=>{var a;if(n.type==="outbound-rtp"){const c={type:"video",streamId:n.id,frameHeight:n.frameHeight,frameWidth:n.frameWidth,framesPerSecond:n.framesPerSecond,framesSent:n.framesSent,firCount:n.firCount,pliCount:n.pliCount,nackCount:n.nackCount,packetsSent:n.packetsSent,bytesSent:n.bytesSent,qualityLimitationReason:n.qualityLimitationReason,qualityLimitationDurations:n.qualityLimitationDurations,qualityLimitationResolutionChanges:n.qualityLimitationResolutionChanges,rid:(a=n.rid)!==null&&a!==void 0?a:n.id,retransmittedPacketsSent:n.retransmittedPacketsSent,targetBitrate:n.targetBitrate,timestamp:n.timestamp},l=e.get(n.remoteId);l&&(c.jitter=l.jitter,c.packetsLost=l.packetsLost,c.roundTripTime=l.roundTripTime),o.push(c)}}),o.sort((n,a)=>{var c,l;return((c=a.frameWidth)!==null&&c!==void 0?c:0)-((l=n.frameWidth)!==null&&l!==void 0?l:0)}),o})}setPublishingQuality(t){const o=[];for(let e=VideoQuality.LOW;e<=VideoQuality.HIGH;e+=1)o.push(new SubscribedQuality({quality:e,enabled:e<=t}));this.log.debug("setting publishing quality. max quality ".concat(t),this.logContext),this.setPublishingLayers(o)}setDeviceId(t){return __awaiter(this,void 0,void 0,function*(){return this._constraints.deviceId===t&&this._mediaStreamTrack.getSettings().deviceId===unwrapConstraint(t)?!0:(this._constraints.deviceId=t,this.isMuted||(yield this.restartTrack()),this.isMuted||unwrapConstraint(t)===this._mediaStreamTrack.getSettings().deviceId)})}restartTrack(t){return __awaiter(this,void 0,void 0,function*(){var o,e,n,a;let c;if(t){const p=constraintsForOptions({video:t});typeof p.video!="boolean"&&(c=p.video)}yield this.restart(c);try{for(var l=!0,u=__asyncValues(this.simulcastCodecs.values()),d;d=yield u.next(),o=d.done,!o;l=!0){a=d.value,l=!1;const p=a;p.sender&&(p.mediaStreamTrack=this.mediaStreamTrack.clone(),yield p.sender.replaceTrack(p.mediaStreamTrack))}}catch(p){e={error:p}}finally{try{!l&&!o&&(n=u.return)&&(yield n.call(u))}finally{if(e)throw e.error}}})}setProcessor(t){const o=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return __awaiter(this,arguments,void 0,function(e){var n=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var c,l,u,d,p,g;if(yield o.setProcessor.call(n,e,a),!((p=n.processor)===null||p===void 0)&&p.processedTrack)try{for(var S=!0,y=__asyncValues(n.simulcastCodecs.values()),b;b=yield y.next(),c=b.done,!c;S=!0)d=b.value,S=!1,yield(g=d.sender)===null||g===void 0?void 0:g.replaceTrack(n.processor.processedTrack)}catch(k){l={error:k}}finally{try{!S&&!c&&(u=y.return)&&(yield u.call(y))}finally{if(l)throw l.error}}}()})}setDegradationPreference(t){return __awaiter(this,void 0,void 0,function*(){if(this.degradationPreference=t,this.sender)try{this.log.debug("setting degradationPreference to ".concat(t),this.logContext);const o=this.sender.getParameters();o.degradationPreference=t,this.sender.setParameters(o)}catch(o){this.log.warn("failed to set degradationPreference",Object.assign({error:o},this.logContext))}})}addSimulcastTrack(t,o){if(this.simulcastCodecs.has(t)){this.log.error("".concat(t," already added, skipping adding simulcast codec"),this.logContext);return}const e={codec:t,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:o};return this.simulcastCodecs.set(t,e),e}setSimulcastTrackSender(t,o){const e=this.simulcastCodecs.get(t);e&&(e.sender=o,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},refreshSubscribedCodecAfterNewCodec))}setPublishingCodecs(t){return __awaiter(this,void 0,void 0,function*(){var o,e,n,a,c,l,u;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:t,currentCodec:this.codec})),!this.codec&&t.length>0)return yield this.setPublishingLayers(t[0].qualities),[];this.subscribedCodecs=t;const d=[];try{for(o=!0,e=__asyncValues(t);n=yield e.next(),a=n.done,!a;o=!0){u=n.value,o=!1;const p=u;if(!this.codec||this.codec===p.codec)yield this.setPublishingLayers(p.qualities);else{const g=this.simulcastCodecs.get(p.codec);if(this.log.debug("try setPublishingCodec for ".concat(p.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:g})),!g||!g.sender){for(const S of p.qualities)if(S.enabled){d.push(p.codec);break}}else g.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(p.codec),this.logContext),yield setPublishingLayersForSender(g.sender,g.encodings,p.qualities,this.senderLock,this.log,this.logContext))}}}catch(p){c={error:p}}finally{try{!o&&!a&&(l=e.return)&&(yield l.call(e))}finally{if(c)throw c.error}}return d})}setPublishingLayers(t){return __awaiter(this,void 0,void 0,function*(){this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:t})),!(!this.sender||!this.encodings)&&(yield setPublishingLayersForSender(this.sender,this.encodings,t,this.senderLock,this.log,this.logContext))})}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return __awaiter(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),isMobile()&&this.isInBackground&&this.source===Track.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function setPublishingLayersForSender(s,t,o,e,n,a){return __awaiter(this,void 0,void 0,function*(){const c=yield e.lock();n.debug("setPublishingLayersForSender",Object.assign(Object.assign({},a),{sender:s,qualities:o,senderEncodings:t}));try{const l=s.getParameters(),{encodings:u}=l;if(!u)return;if(u.length!==t.length){n.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},a),{encodings:u,senderEncodings:t}));return}let d=!1;!1&&u[0].scalabilityMode||u.forEach((g,S)=>{var y;let b=(y=g.rid)!==null&&y!==void 0?y:"";b===""&&(b="q");const k=videoQualityForRid(b),O=o.find(C=>C.quality===k);O&&g.active!==O.enabled&&(d=!0,g.active=O.enabled,n.debug("setting layer ".concat(O.quality," to ").concat(g.active?"enabled":"disabled"),a),isFireFox()&&(O.enabled?(g.scaleResolutionDownBy=t[S].scaleResolutionDownBy,g.maxBitrate=t[S].maxBitrate,g.maxFrameRate=t[S].maxFrameRate):(g.scaleResolutionDownBy=4,g.maxBitrate=10,g.maxFrameRate=2)))}),d&&(l.encodings=u,n.debug("setting encodings",Object.assign(Object.assign({},a),{encodings:l.encodings})),yield s.setParameters(l))}finally{c()}})}function videoQualityForRid(s){switch(s){case"f":return VideoQuality.HIGH;case"h":return VideoQuality.MEDIUM;case"q":return VideoQuality.LOW;default:return VideoQuality.HIGH}}function videoLayersFromEncodings(s,t,o,e){if(!o)return[new VideoLayer({quality:VideoQuality.HIGH,width:s,height:t,bitrate:0,ssrc:0})];if(e){const n=o[0].scalabilityMode,a=new ScalabilityMode(n),c=[],l=a.suffix=="h"?1.5:2,u=a.suffix=="h"?2:3;for(let d=0;d<a.spatial;d+=1)c.push(new VideoLayer({quality:Math.min(VideoQuality.HIGH,a.spatial-1)-d,width:Math.ceil(s/Math.pow(l,d)),height:Math.ceil(t/Math.pow(l,d)),bitrate:o[0].maxBitrate?Math.ceil(o[0].maxBitrate/Math.pow(u,d)):0,ssrc:0}));return c}return o.map(n=>{var a,c,l;const u=(a=n.scaleResolutionDownBy)!==null&&a!==void 0?a:1;let d=videoQualityForRid((c=n.rid)!==null&&c!==void 0?c:"");return new VideoLayer({quality:d,width:Math.ceil(s/u),height:Math.ceil(t/u),bitrate:(l=n.maxBitrate)!==null&&l!==void 0?l:0,ssrc:0})})}const lossyDataChannel="_lossy",reliableDataChannel="_reliable",minReconnectWait=2*1e3,leaveReconnect="leave-reconnect";var PCState;(function(s){s[s.New=0]="New",s[s.Connected=1]="Connected",s[s.Disconnected=2]="Disconnected",s[s.Reconnecting=3]="Reconnecting",s[s.Closed=4]="Closed"})(PCState||(PCState={}));class RTCEngine extends eventsExports.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(t){var o;super(),this.options=t,this.rtcConfig={},this.peerConnectionTimeout=roomConnectOptionDefaults.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.subscriberPrimary=!1,this.pcState=PCState.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=livekitLogger,this.handleDataChannel=e=>__awaiter(this,[e],void 0,function(n){var a=this;let{channel:c}=n;return function*(){if(c){if(c.label===reliableDataChannel)a.reliableDCSub=c;else if(c.label===lossyDataChannel)a.lossyDCSub=c;else return;a.log.debug("on data channel ".concat(c.id,", ").concat(c.label),a.logContext),c.onmessage=a.handleDataMessage}}()}),this.handleDataMessage=e=>__awaiter(this,void 0,void 0,function*(){var n,a;const c=yield this.dataProcessLock.lock();try{let l;if(e.data instanceof ArrayBuffer)l=e.data;else if(e.data instanceof Blob)l=yield e.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:e.data}));return}const u=DataPacket.fromBinary(new Uint8Array(l));((n=u.value)===null||n===void 0?void 0:n.case)==="speaker"?this.emit(EngineEvent.ActiveSpeakersUpdate,u.value.value.speakers):(((a=u.value)===null||a===void 0?void 0:a.case)==="user"&&applyUserDataCompat(u,u.value.value),this.emit(EngineEvent.DataPacketReceived,u))}finally{c()}}),this.handleDataError=e=>{const a=e.currentTarget.maxRetransmits===0?"lossy":"reliable";if(e instanceof ErrorEvent&&e.error){const{error:c}=e.error;this.log.error("DataChannel error on ".concat(a,": ").concat(e.message),Object.assign(Object.assign({},this.logContext),{error:c}))}else this.log.error("Unknown DataChannel error on ".concat(a),Object.assign(Object.assign({},this.logContext),{event:e}))},this.handleBufferedAmountLow=e=>{const a=e.currentTarget.maxRetransmits===0?DataPacket_Kind.LOSSY:DataPacket_Kind.RELIABLE;this.updateAndEmitDCBufferStatus(a)},this.handleDisconnect=(e,n)=>{if(this._isClosed)return;this.log.warn("".concat(e," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const a=u=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(u,"ms. giving up"),this.logContext),this.emit(EngineEvent.Disconnected),this.close()},c=Date.now()-this.reconnectStart;let l=this.getNextRetryDelay({elapsedMs:c,retryCount:this.reconnectAttempts});if(l===null){a(c);return}e===leaveReconnect&&(l=0),this.log.debug("reconnecting in ".concat(l,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=CriticalTimers.setTimeout(()=>this.attemptReconnect(n).finally(()=>this.reconnectTimeout=void 0),l)},this.waitForRestarted=()=>new Promise((e,n)=>{this.pcState===PCState.Connected&&e();const a=()=>{this.off(EngineEvent.Disconnected,c),e()},c=()=>{this.off(EngineEvent.Restarted,a),n()};this.once(EngineEvent.Restarted,a),this.once(EngineEvent.Disconnected,c)}),this.updateAndEmitDCBufferStatus=e=>{const n=this.isBufferStatusLow(e);typeof n<"u"&&n!==this.dcBufferStatus.get(e)&&(this.dcBufferStatus.set(e,n),this.emit(EngineEvent.DCBufferStatusChanged,n,e))},this.isBufferStatusLow=e=>{const n=this.dataChannelForKind(e);if(n)return n.bufferedAmount<=n.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===SignalConnectionState.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(ReconnectReason.RR_SIGNAL_DISCONNECTED))},this.log=getLogger((o=t.loggerName)!==null&&o!==void 0?o:LoggerNames.Engine),this.loggerOptions={loggerName:t.loggerName,loggerContextCb:()=>this.logContext},this.client=new SignalClient(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new Mutex,this.dataProcessLock=new Mutex,this.dcBufferStatus=new Map([[DataPacket_Kind.LOSSY,!0],[DataPacket_Kind.RELIABLE,!0]]),this.client.onParticipantUpdate=e=>this.emit(EngineEvent.ParticipantUpdate,e),this.client.onConnectionQuality=e=>this.emit(EngineEvent.ConnectionQualityUpdate,e),this.client.onRoomUpdate=e=>this.emit(EngineEvent.RoomUpdate,e),this.client.onSubscriptionError=e=>this.emit(EngineEvent.SubscriptionError,e),this.client.onSubscriptionPermissionUpdate=e=>this.emit(EngineEvent.SubscriptionPermissionUpdate,e),this.client.onSpeakersChanged=e=>this.emit(EngineEvent.SpeakersChanged,e),this.client.onStreamStateUpdate=e=>this.emit(EngineEvent.StreamStateChanged,e),this.client.onRequestResponse=e=>this.emit(EngineEvent.SignalRequestResponse,e)}get logContext(){var t,o,e,n,a,c,l,u;return{room:(o=(t=this.latestJoinResponse)===null||t===void 0?void 0:t.room)===null||o===void 0?void 0:o.name,roomID:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.sid,participant:(c=(a=this.latestJoinResponse)===null||a===void 0?void 0:a.participant)===null||c===void 0?void 0:c.identity,pID:(u=(l=this.latestJoinResponse)===null||l===void 0?void 0:l.participant)===null||u===void 0?void 0:u.sid}}join(t,o,e,n){return __awaiter(this,void 0,void 0,function*(){this.url=t,this.token=o,this.signalOpts=e,this.maxJoinAttempts=e.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const a=yield this.client.join(t,o,e,n);return this._isClosed=!1,this.latestJoinResponse=a,this.subscriberPrimary=a.subscriberPrimary,this.pcManager||(yield this.configure(a)),(!this.subscriberPrimary||a.fastPublish)&&this.negotiate(),this.clientConfiguration=a.clientConfiguration,a}catch(a){if(a instanceof ConnectionError&&a.reason===1&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(t,o,e,n);throw a}})}close(){return __awaiter(this,void 0,void 0,function*(){const t=yield this.closingLock.lock();if(this.isClosed){t();return}try{this._isClosed=!0,this.emit(EngineEvent.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{t()}})}cleanupPeerConnections(){return __awaiter(this,void 0,void 0,function*(){var t;yield(t=this.pcManager)===null||t===void 0?void 0:t.close(),this.pcManager=void 0;const o=e=>{e&&(e.close(),e.onbufferedamountlow=null,e.onclose=null,e.onclosing=null,e.onerror=null,e.onmessage=null,e.onopen=null)};o(this.lossyDC),o(this.lossyDCSub),o(this.reliableDC),o(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0})}cleanupClient(){return __awaiter(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(t){if(this.pendingTrackResolvers[t.cid])throw new TrackInvalidError("a track with the same ID has already been published");return new Promise((o,e)=>{const n=setTimeout(()=>{delete this.pendingTrackResolvers[t.cid],e(new ConnectionError("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[t.cid]={resolve:a=>{clearTimeout(n),o(a)},reject:()=>{clearTimeout(n),e(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(t)})}removeTrack(t){if(t.track&&this.pendingTrackResolvers[t.track.id]){const{reject:o}=this.pendingTrackResolvers[t.track.id];o&&o(),delete this.pendingTrackResolvers[t.track.id]}try{return this.pcManager.removeTrack(t),!0}catch(o){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:o}))}return!1}updateMuteStatus(t,o){this.client.sendMuteTrack(t,o)}get dataSubscriberReadyState(){var t;return(t=this.reliableDCSub)===null||t===void 0?void 0:t.readyState}getConnectedServerAddress(){return __awaiter(this,void 0,void 0,function*(){var t;return(t=this.pcManager)===null||t===void 0?void 0:t.getConnectedAddress()})}setRegionUrlProvider(t){this.regionUrlProvider=t}configure(t){return __awaiter(this,void 0,void 0,function*(){var o,e;if(this.pcManager&&this.pcManager.currentState!==PCTransportState.NEW)return;this.participantSid=(o=t.participant)===null||o===void 0?void 0:o.sid;const n=this.makeRTCConfiguration(t);this.pcManager=new PCTransportManager(n,t.subscriberPrimary,this.loggerOptions),this.emit(EngineEvent.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(a,c)=>{this.client.sendIceCandidate(a,c)},this.pcManager.onPublisherOffer=a=>{this.client.sendOffer(a)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(a,c,l)=>__awaiter(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(a),this.logContext),["closed","disconnected","failed"].includes(c)&&(this.publisherConnectionPromise=void 0),a===PCTransportState.CONNECTED){const p=this.pcState===PCState.New;this.pcState=PCState.Connected,p&&this.emit(EngineEvent.Connected,t)}else a===PCTransportState.FAILED&&this.pcState===PCState.Connected&&(this.pcState=PCState.Disconnected,this.handleDisconnect("peerconnection failed",l==="failed"?ReconnectReason.RR_SUBSCRIBER_FAILED:ReconnectReason.RR_PUBLISHER_FAILED));const u=this.client.isDisconnected||this.client.currentState===SignalConnectionState.RECONNECTING,d=[PCTransportState.FAILED,PCTransportState.CLOSING,PCTransportState.CLOSED].includes(a);u&&d&&!this._isClosed&&this.emit(EngineEvent.Offline)}),this.pcManager.onTrack=a=>{this.emit(EngineEvent.MediaTrackAdded,a.track,a.streams[0],a.receiver)},supportOptionalDatachannel((e=t.serverInfo)===null||e===void 0?void 0:e.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=t=>__awaiter(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:t.type})),yield this.pcManager.setPublisherAnswer(t))}),this.client.onTrickle=(t,o)=>{this.pcManager&&(this.log.trace("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:t,target:o})),this.pcManager.addIceCandidate(t,o))},this.client.onOffer=t=>__awaiter(this,void 0,void 0,function*(){if(!this.pcManager)return;const o=yield this.pcManager.createSubscriberAnswerFromOffer(t);this.client.sendAnswer(o)}),this.client.onLocalTrackPublished=t=>{var o;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:t.cid,track:(o=t.track)===null||o===void 0?void 0:o.sid})),!this.pendingTrackResolvers[t.cid]){this.log.error("missing track resolver for ".concat(t.cid),Object.assign(Object.assign({},this.logContext),{cid:t.cid}));return}const{resolve:e}=this.pendingTrackResolvers[t.cid];delete this.pendingTrackResolvers[t.cid],e(t.track)},this.client.onLocalTrackUnpublished=t=>{this.emit(EngineEvent.LocalTrackUnpublished,t)},this.client.onLocalTrackSubscribed=t=>{this.emit(EngineEvent.LocalTrackSubscribed,t)},this.client.onTokenRefresh=t=>{this.token=t},this.client.onRemoteMuteChanged=(t,o)=>{this.emit(EngineEvent.RemoteMute,t,o)},this.client.onSubscribedQualityUpdate=t=>{this.emit(EngineEvent.SubscribedQualityUpdate,t)},this.client.onClose=()=>{this.handleDisconnect("signal",ReconnectReason.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=t=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:t==null?void 0:t.reason})),t.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(t.regions)),t.action){case LeaveRequest_Action.DISCONNECT:this.emit(EngineEvent.Disconnected,t==null?void 0:t.reason),this.close();break;case LeaveRequest_Action.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(leaveReconnect);break;case LeaveRequest_Action.RESUME:this.handleDisconnect(leaveReconnect)}}}makeRTCConfiguration(t){var o;const e=Object.assign({},this.rtcConfig);if(!((o=this.signalOpts)===null||o===void 0)&&o.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),e.encodedInsertableStreams=!0),t.iceServers&&!e.iceServers){const n=[];t.iceServers.forEach(a=>{const c={urls:a.urls};a.username&&(c.username=a.username),a.credential&&(c.credential=a.credential),n.push(c)}),e.iceServers=n}return t.clientConfiguration&&t.clientConfiguration.forceRelay===ClientConfigSetting.ENABLED&&(e.iceTransportPolicy="relay"),e.sdpSemantics="unified-plan",e.continualGatheringPolicy="gather_continually",e}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(lossyDataChannel,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(reliableDataChannel,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(t,o,e){return __awaiter(this,void 0,void 0,function*(){if(supportsTransceiver())return yield this.createTransceiverRTCRtpSender(t,o,e);if(supportsAddTrack())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(t.mediaStreamTrack);throw new UnexpectedConnectionState("Required webRTC APIs not supported on this device")})}createSimulcastSender(t,o,e,n){return __awaiter(this,void 0,void 0,function*(){if(supportsTransceiver())return this.createSimulcastTransceiverSender(t,o,e,n);if(supportsAddTrack())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(t.mediaStreamTrack);throw new UnexpectedConnectionState("Cannot stream on this device")})}createTransceiverRTCRtpSender(t,o,e){return __awaiter(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("publisher is closed");const n=[];t.mediaStream&&n.push(t.mediaStream),t instanceof LocalVideoTrack&&(t.codec=o.videoCodec);const a={direction:"sendonly",streams:n};return e&&(a.sendEncodings=e),(yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,a)).sender})}createSimulcastTransceiverSender(t,o,e,n){return __awaiter(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("publisher is closed");const a={direction:"sendonly"};n&&(a.sendEncodings=n);const c=yield this.pcManager.addPublisherTransceiver(o.mediaStreamTrack,a);if(e.videoCodec)return t.setSimulcastTrackSender(e.videoCodec,c.sender),c.sender})}createRTCRtpSender(t){return __awaiter(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("publisher is closed");return this.pcManager.addPublisherTrack(t)})}attemptReconnect(t){return __awaiter(this,void 0,void 0,function*(){var o,e,n;if(!this._isClosed){if(this.attemptingReconnect){livekitLogger.warn("already attempting reconnect, returning early",this.logContext);return}(((o=this.clientConfiguration)===null||o===void 0?void 0:o.resumeConnection)===ClientConfigSetting.DISABLED||((n=(e=this.pcManager)===null||e===void 0?void 0:e.currentState)!==null&&n!==void 0?n:PCTransportState.NEW)===PCTransportState.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(t),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(a){this.reconnectAttempts+=1;let c=!0;a instanceof UnexpectedConnectionState?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:a})),c=!1):a instanceof SignalReconnectError||(this.fullReconnectOnNext=!0),c?this.handleDisconnect("reconnect",ReconnectReason.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(EngineEvent.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(t){try{return this.reconnectPolicy.nextRetryDelayInMs(t)}catch(o){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:o}))}return null}restartConnection(t){return __awaiter(this,void 0,void 0,function*(){var o,e,n;try{if(!this.url||!this.token)throw new UnexpectedConnectionState("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(EngineEvent.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let a;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new SignalReconnectError;a=yield this.join(t??this.url,this.token,this.signalOpts)}catch(c){throw c instanceof ConnectionError&&c.reason===0?new UnexpectedConnectionState("could not reconnect, token might be expired"):new SignalReconnectError}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(EngineEvent.SignalRestarted,a),yield this.waitForPCReconnected(),this.client.currentState!==SignalConnectionState.CONNECTED)throw new SignalReconnectError("Signal connection got severed during reconnect");(o=this.regionUrlProvider)===null||o===void 0||o.resetAttempts(),this.emit(EngineEvent.Restarted)}catch(a){const c=yield(e=this.regionUrlProvider)===null||e===void 0?void 0:e.getNextBestRegionUrl();if(c){yield this.restartConnection(c);return}else throw(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),a}})}resumeConnection(t){return __awaiter(this,void 0,void 0,function*(){var o;if(!this.url||!this.token)throw new UnexpectedConnectionState("could not reconnect, url or token not saved");if(!this.pcManager)throw new UnexpectedConnectionState("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(EngineEvent.Resuming);let e;try{this.setupSignalClientCallbacks(),e=yield this.client.reconnect(this.url,this.token,this.participantSid,t)}catch(n){let a="";throw n instanceof Error&&(a=n.message,this.log.error(n.message,Object.assign(Object.assign({},this.logContext),{error:n}))),n instanceof ConnectionError&&n.reason===0?new UnexpectedConnectionState("could not reconnect, token might be expired"):n instanceof ConnectionError&&n.reason===4?n:new SignalReconnectError(a)}if(this.emit(EngineEvent.SignalResumed),e){const n=this.makeRTCConfiguration(e);this.pcManager.updateConfiguration(n)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==SignalConnectionState.CONNECTED)throw new SignalReconnectError("Signal connection got severed during reconnect");this.client.setReconnected(),((o=this.reliableDC)===null||o===void 0?void 0:o.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),this.emit(EngineEvent.Resumed)})}waitForPCInitialConnection(t,o){return __awaiter(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(o,t)})}waitForPCReconnected(){return __awaiter(this,void 0,void 0,function*(){this.pcState=PCState.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield sleep(minReconnectWait),!this.pcManager)throw new UnexpectedConnectionState("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=PCState.Connected}catch(t){throw this.pcState=PCState.Disconnected,new ConnectionError("could not establish PC connection, ".concat(t.message))}})}sendDataPacket(t,o){return __awaiter(this,void 0,void 0,function*(){const e=t.toBinary();yield this.ensurePublisherConnected(o);const n=this.dataChannelForKind(o);n&&n.send(e),this.updateAndEmitDCBufferStatus(o)})}ensureDataTransportConnected(t){return __awaiter(this,arguments,void 0,function(o){var e=this;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var a;if(!e.pcManager)throw new UnexpectedConnectionState("PC manager is closed");const c=n?e.pcManager.subscriber:e.pcManager.publisher,l=n?"Subscriber":"Publisher";if(!c)throw new ConnectionError("".concat(l," connection not set"));let u=!1;!n&&!e.dataChannelForKind(o,n)&&(e.createDataChannels(),u=!0),!u&&!n&&!e.pcManager.publisher.isICEConnected&&e.pcManager.publisher.getICEConnectionState()!=="checking"&&(u=!0),u&&e.negotiate();const d=e.dataChannelForKind(o,n);if((d==null?void 0:d.readyState)==="open")return;const p=new Date().getTime()+e.peerConnectionTimeout;for(;new Date().getTime()<p;){if(c.isICEConnected&&((a=e.dataChannelForKind(o,n))===null||a===void 0?void 0:a.readyState)==="open")return;yield sleep(50)}throw new ConnectionError("could not establish ".concat(l," connection, state: ").concat(c.getICEConnectionState()))}()})}ensurePublisherConnected(t){return __awaiter(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(t,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==PCTransportState.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return __awaiter(this,void 0,void 0,function*(){return new Promise((t,o)=>__awaiter(this,void 0,void 0,function*(){if(!this.pcManager){o(new NegotiationError("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const e=new AbortController,n=()=>{e.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),t()};this.isClosed&&o("cannot negotiate on closed engine"),this.on(EngineEvent.Closing,n),this.pcManager.publisher.once(PCEvents.RTPVideoPayloadTypes,a=>{const c=new Map;a.forEach(l=>{const u=l.codec.toLowerCase();isVideoCodec(u)&&c.set(l.payload,u)}),this.emit(EngineEvent.RTPVideoMapUpdate,c)});try{yield this.pcManager.negotiate(e),t()}catch(a){a instanceof NegotiationError&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",ReconnectReason.RR_UNKNOWN),o(a)}finally{this.off(EngineEvent.Closing,n)}}))})}dataChannelForKind(t,o){if(o){if(t===DataPacket_Kind.LOSSY)return this.lossyDCSub;if(t===DataPacket_Kind.RELIABLE)return this.reliableDCSub}else{if(t===DataPacket_Kind.LOSSY)return this.lossyDC;if(t===DataPacket_Kind.RELIABLE)return this.reliableDC}}sendSyncState(t,o){var e,n;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const a=this.pcManager.subscriber.getLocalDescription(),c=this.pcManager.subscriber.getRemoteDescription(),l=(n=(e=this.signalOpts)===null||e===void 0?void 0:e.autoSubscribe)!==null&&n!==void 0?n:!0,u=new Array,d=new Array;t.forEach(p=>{p.isDesired!==l&&u.push(p.trackSid),p.isEnabled||d.push(p.trackSid)}),this.client.sendSyncState(new SyncState({answer:a?toProtoSessionDescription({sdp:a.sdp,type:a.type}):void 0,offer:c?toProtoSessionDescription({sdp:c.sdp,type:c.type}):void 0,subscription:new UpdateSubscription({trackSids:u,subscribe:!l,participantTracks:[]}),publishTracks:getTrackPublicationInfo(o),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:d}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const t=[],o=(e,n)=>{(e==null?void 0:e.id)!==void 0&&e.id!==null&&t.push(new DataChannelInfo({label:e.label,id:e.id,target:n}))};return o(this.dataChannelForKind(DataPacket_Kind.LOSSY),SignalTarget.PUBLISHER),o(this.dataChannelForKind(DataPacket_Kind.RELIABLE),SignalTarget.PUBLISHER),o(this.dataChannelForKind(DataPacket_Kind.LOSSY,!0),SignalTarget.SUBSCRIBER),o(this.dataChannelForKind(DataPacket_Kind.RELIABLE,!0),SignalTarget.SUBSCRIBER),t}clearReconnectTimeout(){this.reconnectTimeout&&CriticalTimers.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){isWeb()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){isWeb()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class SignalReconnectError extends Error{}function supportOptionalDatachannel(s){return s!==void 0&&s>13}function applyUserDataCompat(s,t){const o=s.participantIdentity?s.participantIdentity:t.participantIdentity;s.participantIdentity=o,t.participantIdentity=o;const e=s.destinationIdentities.length!==0?s.destinationIdentities:t.destinationIdentities;s.destinationIdentities=e,t.destinationIdentities=e}class RegionUrlProvider{constructor(t,o){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(t),this.token=o}updateToken(t){this.token=t}isCloud(){return isCloud(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(t){return __awaiter(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(t));const o=this.regionSettings.regions.filter(e=>!this.attemptedRegions.find(n=>n.url===e.url));if(o.length>0){const e=o[0];return this.attemptedRegions.push(e),livekitLogger.debug("next region: ".concat(e.region)),e.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(t){return __awaiter(this,void 0,void 0,function*(){const o=yield fetch("".concat(getCloudConfigUrl(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:t});if(o.ok){const e=yield o.json();return this.lastUpdateAt=Date.now(),e}else throw new ConnectionError("Could not fetch region settings: ".concat(o.statusText),o.status===401?0:void 0,o.status)})}setServerReportedRegions(t){this.regionSettings=t,this.lastUpdateAt=Date.now()}}function getCloudConfigUrl(s){return"".concat(s.protocol.replace("ws","http"),"//").concat(s.host,"/settings")}class RemoteTrack extends Track{constructor(t,o,e,n,a){super(t,e,a),this.sid=o,this.receiver=n}setMuted(t){this.isMuted!==t&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?TrackEvent.Muted:TrackEvent.Unmuted,this))}setMediaStream(t){this.mediaStream=t;const o=e=>{e.track===this._mediaStreamTrack&&(t.removeEventListener("removetrack",o),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(TrackEvent.Ended,this))};t.addEventListener("removetrack",o)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return __awaiter(this,void 0,void 0,function*(){var t;return!((t=this.receiver)===null||t===void 0)&&t.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(t){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=t:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),monitorFrequency)),supportsSynchronizationSources()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const t=()=>{var o;this.timeSyncHandle=requestAnimationFrame(()=>t());const e=(o=this.receiver)===null||o===void 0?void 0:o.getSynchronizationSources()[0];if(e){const{timestamp:n,rtpTimestamp:a}=e;a&&this.rtpTimestamp!==a&&(this.emit(TrackEvent.TimeSyncUpdate,{timestamp:n,rtpTimestamp:a}),this.rtpTimestamp=a)}};t()}}class RemoteAudioTrack extends RemoteTrack{constructor(t,o,e,n,a,c){super(t,o,Track.Kind.Audio,e,c),this.monitorReceiver=()=>__awaiter(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const l=yield this.getReceiverStats();l&&this.prevStats&&this.receiver&&(this._currentBitrate=computeBitrate(l,this.prevStats)),this.prevStats=l}),this.audioContext=n,this.webAudioPluginNodes=[],a&&(this.sinkId=a.deviceId)}setVolume(t){var o;for(const e of this.attachedElements)this.audioContext?(o=this.gainNode)===null||o===void 0||o.gain.setTargetAtTime(t,0,.1):e.volume=t;isReactNative()&&this._mediaStreamTrack._setVolume(t),this.elementVolume=t}getVolume(){if(this.elementVolume)return this.elementVolume;if(isReactNative())return 1;let t=0;return this.attachedElements.forEach(o=>{o.volume>t&&(t=o.volume)}),t}setSinkId(t){return __awaiter(this,void 0,void 0,function*(){this.sinkId=t,yield Promise.all(this.attachedElements.map(o=>{if(supportsSetSinkId(o))return o.setSinkId(t)}))})}attach(t){const o=this.attachedElements.length===0;return t?super.attach(t):t=super.attach(),this.sinkId&&supportsSetSinkId(t)&&t.setSinkId(this.sinkId),this.audioContext&&o&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,t),t.volume=0,t.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),t}detach(t){let o;return t?(o=super.detach(t),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(o=super.detach(),this.disconnectWebAudio()),o}setAudioContext(t){this.audioContext=t,t&&this.attachedElements.length>0?this.connectWebAudio(t,this.attachedElements[0]):t||this.disconnectWebAudio()}setWebAudioPlugins(t){this.webAudioPluginNodes=t,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(t,o){this.disconnectWebAudio(),this.sourceNode=t.createMediaStreamSource(o.srcObject);let e=this.sourceNode;this.webAudioPluginNodes.forEach(n=>{e.connect(n),e=n}),this.gainNode=t.createGain(),e.connect(this.gainNode),this.gainNode.connect(t.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),t.state!=="running"&&t.resume().then(()=>{t.state!=="running"&&this.emit(TrackEvent.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(n=>{this.emit(TrackEvent.AudioPlaybackFailed,n)})}disconnectWebAudio(){var t,o;(t=this.gainNode)===null||t===void 0||t.disconnect(),(o=this.sourceNode)===null||o===void 0||o.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return __awaiter(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const t=yield this.receiver.getStats();let o;return t.forEach(e=>{e.type==="inbound-rtp"&&(o={type:"audio",timestamp:e.timestamp,jitter:e.jitter,bytesReceived:e.bytesReceived,concealedSamples:e.concealedSamples,concealmentEvents:e.concealmentEvents,silentConcealedSamples:e.silentConcealedSamples,silentConcealmentEvents:e.silentConcealmentEvents,totalAudioEnergy:e.totalAudioEnergy,totalSamplesDuration:e.totalSamplesDuration})}),o})}}const REACTION_DELAY=100;class RemoteVideoTrack extends RemoteTrack{constructor(t,o,e,n,a){super(t,o,Track.Kind.Video,e,a),this.elementInfos=[],this.monitorReceiver=()=>__awaiter(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const c=yield this.getReceiverStats();c&&this.prevStats&&this.receiver&&(this._currentBitrate=computeBitrate(c,this.prevStats)),this.prevStats=c}),this.debouncedHandleResize=r(()=>{this.updateDimensions()},REACTION_DELAY),this.adaptiveStreamSettings=n}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(t){super.setMuted(t),this.attachedElements.forEach(o=>{t?detachTrack(this._mediaStreamTrack,o):attachToElement(this._mediaStreamTrack,o)})}attach(t){if(t?super.attach(t):t=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(o=>o.element===t)===void 0){const o=new HTMLElementInfo(t);this.observeElementInfo(o)}return t}observeElementInfo(t){this.adaptiveStreamSettings&&this.elementInfos.find(o=>o===t)===void 0?(t.handleResize=()=>{this.debouncedHandleResize()},t.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(t),t.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(t){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const o=this.elementInfos.filter(e=>e===t);for(const e of o)e.stopObserving();this.elementInfos=this.elementInfos.filter(e=>e!==t),this.updateVisibility(),this.debouncedHandleResize()}detach(t){let o=[];if(t)return this.stopObservingElement(t),super.detach(t);o=super.detach();for(const e of o)this.stopObservingElement(e);return o}getDecoderImplementation(){var t;return(t=this.prevStats)===null||t===void 0?void 0:t.decoderImplementation}getReceiverStats(){return __awaiter(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const t=yield this.receiver.getStats();let o,e="",n=new Map;return t.forEach(a=>{a.type==="inbound-rtp"?(e=a.codecId,o={type:"video",framesDecoded:a.framesDecoded,framesDropped:a.framesDropped,framesReceived:a.framesReceived,packetsReceived:a.packetsReceived,packetsLost:a.packetsLost,frameWidth:a.frameWidth,frameHeight:a.frameHeight,pliCount:a.pliCount,firCount:a.firCount,nackCount:a.nackCount,jitter:a.jitter,timestamp:a.timestamp,bytesReceived:a.bytesReceived,decoderImplementation:a.decoderImplementation}):a.type==="codec"&&n.set(a.id,a)}),o&&e!==""&&n.get(e)&&(o.mimeType=n.get(e).mimeType),o})}stopObservingElement(t){const o=this.elementInfos.filter(e=>e.element===t);for(const e of o)this.stopObservingElementInfo(e)}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return __awaiter(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var t,o;const e=this.elementInfos.reduce((l,u)=>Math.max(l,u.visibilityChangedAt||0),0),n=!((o=(t=this.adaptiveStreamSettings)===null||t===void 0?void 0:t.pauseVideoInBackground)!==null&&o!==void 0)||o?this.isInBackground:!1,a=this.elementInfos.some(l=>l.pictureInPicture),c=this.elementInfos.some(l=>l.visible)&&!n||a;if(this.lastVisible!==c){if(!c&&Date.now()-e<REACTION_DELAY){CriticalTimers.setTimeout(()=>{this.updateVisibility()},REACTION_DELAY);return}this.lastVisible=c,this.emit(TrackEvent.VisibilityChanged,c,this)}}updateDimensions(){var t,o;let e=0,n=0;const a=this.getPixelDensity();for(const c of this.elementInfos){const l=c.width()*a,u=c.height()*a;l+u>e+n&&(e=l,n=u)}((t=this.lastDimensions)===null||t===void 0?void 0:t.width)===e&&((o=this.lastDimensions)===null||o===void 0?void 0:o.height)===n||(this.lastDimensions={width:e,height:n},this.emit(TrackEvent.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var t;const o=(t=this.adaptiveStreamSettings)===null||t===void 0?void 0:t.pixelDensity;return o==="screen"?getDevicePixelRatio():o||(getDevicePixelRatio()>2?2:1)}}class HTMLElementInfo{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(t,o){this.onVisibilityChanged=e=>{var n;const{target:a,isIntersecting:c}=e;a===this.element&&(this.isIntersecting=c,this.visibilityChangedAt=Date.now(),(n=this.handleVisibilityChanged)===null||n===void 0||n.call(this))},this.onEnterPiP=()=>{var e;this.isPiP=!0,(e=this.handleVisibilityChanged)===null||e===void 0||e.call(this)},this.onLeavePiP=()=>{var e;this.isPiP=!1,(e=this.handleVisibilityChanged)===null||e===void 0||e.call(this)},this.element=t,this.isIntersecting=o??isElementInViewport(t),this.isPiP=isWeb()&&document.pictureInPictureElement===t,this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){this.isIntersecting=isElementInViewport(this.element),this.isPiP=document.pictureInPictureElement===this.element,this.element.handleResize=()=>{var t;(t=this.handleResize)===null||t===void 0||t.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,getIntersectionObserver().observe(this.element),getResizeObserver().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP)}stopObserving(){var t,o;(t=getIntersectionObserver())===null||t===void 0||t.unobserve(this.element),(o=getResizeObserver())===null||o===void 0||o.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP)}}function isElementInViewport(s){let t=s.offsetTop,o=s.offsetLeft;const e=s.offsetWidth,n=s.offsetHeight,{hidden:a}=s,{opacity:c,display:l}=getComputedStyle(s);for(;s.offsetParent;)s=s.offsetParent,t+=s.offsetTop,o+=s.offsetLeft;return t<window.pageYOffset+window.innerHeight&&o<window.pageXOffset+window.innerWidth&&t+n>window.pageYOffset&&o+e>window.pageXOffset&&!a&&(c!==""?parseFloat(c)>0:!0)&&l!=="none"}class TrackPublication extends eventsExports.EventEmitter{constructor(t,o,e,n){var a;super(),this.metadataMuted=!1,this.encryption=Encryption_Type.NONE,this.log=livekitLogger,this.handleMuted=()=>{this.emit(TrackEvent.Muted)},this.handleUnmuted=()=>{this.emit(TrackEvent.Unmuted)},this.log=getLogger((a=n==null?void 0:n.loggerName)!==null&&a!==void 0?a:LoggerNames.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=t,this.trackSid=o,this.trackName=e,this.source=Track.Source.Unknown}setTrack(t){this.track&&(this.track.off(TrackEvent.Muted,this.handleMuted),this.track.off(TrackEvent.Unmuted,this.handleUnmuted)),this.track=t,t&&(t.on(TrackEvent.Muted,this.handleMuted),t.on(TrackEvent.Unmuted,this.handleUnmuted))}get logContext(){var t;return Object.assign(Object.assign({},(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this)),getLogContextFromTrack(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==Encryption_Type.NONE}get audioTrack(){if(this.track instanceof LocalAudioTrack||this.track instanceof RemoteAudioTrack)return this.track}get videoTrack(){if(this.track instanceof LocalVideoTrack||this.track instanceof RemoteVideoTrack)return this.track}updateInfo(t){this.trackSid=t.sid,this.trackName=t.name,this.source=Track.sourceFromProto(t.source),this.mimeType=t.mimeType,this.kind===Track.Kind.Video&&t.width>0&&(this.dimensions={width:t.width,height:t.height},this.simulcasted=t.simulcast),this.encryption=t.encryption,this.trackInfo=t,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:t}))}}(function(s){(function(t){t.Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed"})(s.SubscriptionStatus||(s.SubscriptionStatus={})),function(t){t.Allowed="allowed",t.NotAllowed="not_allowed"}(s.PermissionStatus||(s.PermissionStatus={}))})(TrackPublication||(TrackPublication={}));class LocalTrackPublication extends TrackPublication{get isUpstreamPaused(){var t;return(t=this.track)===null||t===void 0?void 0:t.isUpstreamPaused}constructor(t,o,e,n){super(t,o.sid,o.name,n),this.track=void 0,this.handleTrackEnded=()=>{this.emit(TrackEvent.Ended)},this.updateInfo(o),this.setTrack(e)}setTrack(t){this.track&&this.track.off(TrackEvent.Ended,this.handleTrackEnded),super.setTrack(t),t&&t.on(TrackEvent.Ended,this.handleTrackEnded)}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}mute(){return __awaiter(this,void 0,void 0,function*(){var t;return(t=this.track)===null||t===void 0?void 0:t.mute()})}unmute(){return __awaiter(this,void 0,void 0,function*(){var t;return(t=this.track)===null||t===void 0?void 0:t.unmute()})}pauseUpstream(){return __awaiter(this,void 0,void 0,function*(){var t;yield(t=this.track)===null||t===void 0?void 0:t.pauseUpstream()})}resumeUpstream(){return __awaiter(this,void 0,void 0,function*(){var t;yield(t=this.track)===null||t===void 0?void 0:t.resumeUpstream()})}getTrackFeatures(){var t;if(this.track instanceof LocalAudioTrack){const o=this.track.mediaStreamTrack.getSettings(),e=new Set;return o.autoGainControl&&e.add(AudioTrackFeature.TF_AUTO_GAIN_CONTROL),o.echoCancellation&&e.add(AudioTrackFeature.TF_ECHO_CANCELLATION),o.noiseSuppression&&e.add(AudioTrackFeature.TF_NOISE_SUPPRESSION),o.channelCount&&o.channelCount>1&&e.add(AudioTrackFeature.TF_STEREO),!((t=this.options)===null||t===void 0)&&t.dtx||e.add(AudioTrackFeature.TF_STEREO),this.track.enhancedNoiseCancellation&&e.add(AudioTrackFeature.TF_ENHANCED_NOISE_CANCELLATION),Array.from(e.values())}else return[]}}var ConnectionQuality;(function(s){s.Excellent="excellent",s.Good="good",s.Poor="poor",s.Lost="lost",s.Unknown="unknown"})(ConnectionQuality||(ConnectionQuality={}));function qualityFromProto(s){switch(s){case ConnectionQuality$1.EXCELLENT:return ConnectionQuality.Excellent;case ConnectionQuality$1.GOOD:return ConnectionQuality.Good;case ConnectionQuality$1.POOR:return ConnectionQuality.Poor;case ConnectionQuality$1.LOST:return ConnectionQuality.Lost;default:return ConnectionQuality.Unknown}}class Participant extends eventsExports.EventEmitter{get logContext(){var t,o;return Object.assign({},(o=(t=this.loggerOptions)===null||t===void 0?void 0:t.loggerContextCb)===null||o===void 0?void 0:o.call(t))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(t=>t.isEncrypted)}get isAgent(){var t;return((t=this.permissions)===null||t===void 0?void 0:t.agent)||this.kind===ParticipantInfo_Kind.AGENT}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(t,o,e,n,a){let c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:ParticipantInfo_Kind.STANDARD;var l;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=ConnectionQuality.Unknown,this.log=livekitLogger,this.log=getLogger((l=a==null?void 0:a.loggerName)!==null&&l!==void 0?l:LoggerNames.Participant),this.loggerOptions=a,this.setMaxListeners(100),this.sid=t,this.identity=o,this.name=e,this.metadata=n,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=c,this._attributes={}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(t){for(const[,o]of this.trackPublications)if(o.source===t)return o}getTrackPublicationByName(t){for(const[,o]of this.trackPublications)if(o.trackName===t)return o}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var t;const o=this.getTrackPublication(Track.Source.Camera);return!(!((t=o==null?void 0:o.isMuted)!==null&&t!==void 0)||t)}get isMicrophoneEnabled(){var t;const o=this.getTrackPublication(Track.Source.Microphone);return!(!((t=o==null?void 0:o.isMuted)!==null&&t!==void 0)||t)}get isScreenShareEnabled(){return!!this.getTrackPublication(Track.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(t){return this.participantInfo&&this.participantInfo.sid===t.sid&&this.participantInfo.version>t.version?!1:(this.identity=t.identity,this.sid=t.sid,this._setName(t.name),this._setMetadata(t.metadata),this._setAttributes(t.attributes),t.permission&&this.setPermissions(t.permission),this.participantInfo=t,this.log.trace("update participant info",Object.assign(Object.assign({},this.logContext),{info:t})),!0)}_setMetadata(t){const o=this.metadata!==t,e=this.metadata;this.metadata=t,o&&this.emit(ParticipantEvent.ParticipantMetadataChanged,e)}_setName(t){const o=this.name!==t;this.name=t,o&&this.emit(ParticipantEvent.ParticipantNameChanged,t)}_setAttributes(t){const o=diffAttributes(t,this.attributes);this._attributes=t,Object.keys(o).length>0&&this.emit(ParticipantEvent.AttributesChanged,o)}setPermissions(t){var o,e,n,a,c;const l=this.permissions,u=t.canPublish!==((o=this.permissions)===null||o===void 0?void 0:o.canPublish)||t.canSubscribe!==((e=this.permissions)===null||e===void 0?void 0:e.canSubscribe)||t.canPublishData!==((n=this.permissions)===null||n===void 0?void 0:n.canPublishData)||t.hidden!==((a=this.permissions)===null||a===void 0?void 0:a.hidden)||t.recorder!==((c=this.permissions)===null||c===void 0?void 0:c.recorder)||t.canPublishSources.length!==this.permissions.canPublishSources.length||t.canPublishSources.some((d,p)=>{var g;return d!==((g=this.permissions)===null||g===void 0?void 0:g.canPublishSources[p])});return this.permissions=t,u&&this.emit(ParticipantEvent.ParticipantPermissionsChanged,l),u}setIsSpeaking(t){t!==this.isSpeaking&&(this.isSpeaking=t,t&&(this.lastSpokeAt=new Date),this.emit(ParticipantEvent.IsSpeakingChanged,t))}setConnectionQuality(t){const o=this._connectionQuality;this._connectionQuality=qualityFromProto(t),o!==this._connectionQuality&&this.emit(ParticipantEvent.ConnectionQualityChanged,this._connectionQuality)}setAudioContext(t){this.audioContext=t,this.audioTrackPublications.forEach(o=>(o.track instanceof RemoteAudioTrack||o.track instanceof LocalAudioTrack)&&o.track.setAudioContext(t))}addTrackPublication(t){t.on(TrackEvent.Muted,()=>{this.emit(ParticipantEvent.TrackMuted,t)}),t.on(TrackEvent.Unmuted,()=>{this.emit(ParticipantEvent.TrackUnmuted,t)});const o=t;switch(o.track&&(o.track.sid=t.trackSid),this.trackPublications.set(t.trackSid,t),t.kind){case Track.Kind.Audio:this.audioTrackPublications.set(t.trackSid,t);break;case Track.Kind.Video:this.videoTrackPublications.set(t.trackSid,t);break}}}function trackPermissionToProto(s){var t,o,e;if(!s.participantSid&&!s.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new TrackPermission({participantIdentity:(t=s.participantIdentity)!==null&&t!==void 0?t:"",participantSid:(o=s.participantSid)!==null&&o!==void 0?o:"",allTracks:(e=s.allowAll)!==null&&e!==void 0?e:!1,trackSids:s.allowedTrackSids||[]})}class LocalParticipant extends Participant{constructor(t,o,e,n){super(t,o,void 0,void 0,{loggerName:n.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Encryption_Type.NONE,this.enabledPublishVideoCodecs=[],this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Future)},this.handleReconnected=()=>{var a,c;(c=(a=this.reconnectFuture)===null||a===void 0?void 0:a.resolve)===null||c===void 0||c.call(a),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var a,c;this.reconnectFuture&&(this.reconnectFuture.promise.catch(l=>this.log.warn(l.message,this.logContext)),(c=(a=this.reconnectFuture)===null||a===void 0?void 0:a.reject)===null||c===void 0||c.call(a,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0)},this.handleSignalRequestResponse=a=>{const{requestId:c,reason:l,message:u}=a,d=this.pendingSignalRequests.get(c);d&&(l!==RequestResponse_Reason.OK&&d.reject(new SignalRequestError(u,l)),this.pendingSignalRequests.delete(c))},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(a=>trackPermissionToProto(a)))},this.onTrackUnmuted=a=>{this.onTrackMuted(a,a.isUpstreamPaused)},this.onTrackMuted=(a,c)=>{if(c===void 0&&(c=!0),!a.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(a)));return}this.engine.updateMuteStatus(a.sid,c)},this.onTrackUpstreamPaused=a=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(a))),this.onTrackMuted(a,!0)},this.onTrackUpstreamResumed=a=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(a))),this.onTrackMuted(a,a.isMuted)},this.onTrackFeatureUpdate=a=>{const c=this.audioTrackPublications.get(a.sid);if(!c){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(a.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(c.trackSid,c.getTrackFeatures())},this.handleSubscribedQualityUpdate=a=>__awaiter(this,void 0,void 0,function*(){var c,l,u,d,p,g;if(!(!((p=this.roomOptions)===null||p===void 0)&&p.dynacast))return;const S=this.videoTrackPublications.get(a.trackSid);if(!S){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}if(a.subscribedCodecs.length>0){if(!S.videoTrack)return;const O=yield S.videoTrack.setPublishingCodecs(a.subscribedCodecs);try{for(var y=!0,b=__asyncValues(O),k;k=yield b.next(),c=k.done,!c;y=!0){d=k.value,y=!1;const C=d;isBackupCodec(C)&&(this.log.debug("publish ".concat(C," for ").concat(S.videoTrack.sid),Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(S))),yield this.publishAdditionalCodecForTrack(S.videoTrack,C,S.options))}}catch(C){l={error:C}}finally{try{!y&&!c&&(u=b.return)&&(yield u.call(b))}finally{if(l)throw l.error}}}else a.subscribedQualities.length>0&&(yield(g=S.videoTrack)===null||g===void 0?void 0:g.setPublishingLayers(a.subscribedQualities))}),this.handleLocalTrackUnpublished=a=>{const c=this.trackPublications.get(a.trackSid);if(!c){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}this.unpublishTrack(c.track)},this.handleTrackEnded=a=>__awaiter(this,void 0,void 0,function*(){if(a.source===Track.Source.ScreenShare||a.source===Track.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(a))),this.unpublishTrack(a);else if(a.isUserProvided)yield a.mute();else if(a instanceof LocalAudioTrack||a instanceof LocalVideoTrack)try{if(isWeb())try{const c=yield navigator==null?void 0:navigator.permissions.query({name:a.source===Track.Source.Camera?"camera":"microphone"});if(c&&c.state==="denied")throw this.log.warn("user has revoked access to ".concat(a.source),Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(a))),c.onchange=()=>{c.state!=="denied"&&(a.isMuted||a.restartTrack(),c.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}a.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(a))),yield a.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(a))),yield a.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=e,this.roomOptions=n,this.setupEngine(e),this.activeDeviceMap=new Map,this.pendingSignalRequests=new Map}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Encryption_Type.NONE}getTrackPublication(t){const o=super.getTrackPublication(t);if(o)return o}getTrackPublicationByName(t){const o=super.getTrackPublicationByName(t);if(o)return o}setupEngine(t){this.engine=t,this.engine.on(EngineEvent.RemoteMute,(o,e)=>{const n=this.trackPublications.get(o);!n||!n.track||(e?n.mute():n.unmute())}),this.engine.on(EngineEvent.Connected,this.handleReconnected).on(EngineEvent.SignalRestarted,this.handleReconnected).on(EngineEvent.SignalResumed,this.handleReconnected).on(EngineEvent.Restarting,this.handleReconnecting).on(EngineEvent.Resuming,this.handleReconnecting).on(EngineEvent.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(EngineEvent.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(EngineEvent.Disconnected,this.handleDisconnected).on(EngineEvent.SignalRequestResponse,this.handleSignalRequestResponse)}setMetadata(t){return __awaiter(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:t})})}setName(t){return __awaiter(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:t})})}setAttributes(t){return __awaiter(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:t})})}requestMetadataUpdate(t){return __awaiter(this,arguments,void 0,function(o){var e=this;let{metadata:n,name:a,attributes:c}=o;return function*(){return new Promise((l,u)=>__awaiter(e,void 0,void 0,function*(){var d,p;try{let g=!1;const S=yield this.engine.client.sendUpdateLocalMetadata((d=n??this.metadata)!==null&&d!==void 0?d:"",(p=a??this.name)!==null&&p!==void 0?p:"",c),y=performance.now();for(this.pendingSignalRequests.set(S,{resolve:l,reject:b=>{u(b),g=!0},values:{name:a,metadata:n,attributes:c}});performance.now()-y<5e3&&!g;){if((!a||this.name===a)&&(!n||this.metadata===n)&&(!c||Object.entries(c).every(b=>{let[k,O]=b;return this.attributes[k]===O}))){this.pendingSignalRequests.delete(S),l();return}yield sleep(50)}u(new SignalRequestError("Request to update local metadata timed out","TimeoutError"))}catch(g){g instanceof Error&&u(g)}}))}()})}setCameraEnabled(t,o,e){return this.setTrackEnabled(Track.Source.Camera,t,o,e)}setMicrophoneEnabled(t,o,e){return this.setTrackEnabled(Track.Source.Microphone,t,o,e)}setScreenShareEnabled(t,o,e){return this.setTrackEnabled(Track.Source.ScreenShare,t,o,e)}setPermissions(t){const o=this.permissions,e=super.setPermissions(t);return e&&o&&this.emit(ParticipantEvent.ParticipantPermissionsChanged,o),e}setE2EEEnabled(t){return __awaiter(this,void 0,void 0,function*(){this.encryptionType=t?Encryption_Type.GCM:Encryption_Type.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(t,o,e,n){return __awaiter(this,void 0,void 0,function*(){var a,c;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:t,enabled:o}));let l=this.getTrackPublication(t);if(o)if(l)yield l.unmute();else{let u;if(this.pendingPublishing.has(t)){this.log.info("skipping duplicate published source",Object.assign(Object.assign({},this.logContext),{source:t}));return}this.pendingPublishing.add(t);try{switch(t){case Track.Source.Camera:u=yield this.createTracks({video:(a=e)!==null&&a!==void 0?a:!0});break;case Track.Source.Microphone:u=yield this.createTracks({audio:(c=e)!==null&&c!==void 0?c:!0});break;case Track.Source.ScreenShare:u=yield this.createScreenTracks(Object.assign({},e));break;default:throw new TrackInvalidError(t)}const d=[];for(const g of u)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(g))),d.push(this.publishTrack(g,n));[l]=yield Promise.all(d)}catch(d){throw u==null||u.forEach(p=>{p.stop()}),d instanceof Error&&!(d instanceof TrackInvalidError)&&this.emit(ParticipantEvent.MediaDevicesError,d),d}finally{this.pendingPublishing.delete(t)}}else if(l&&l.track)if(t===Track.Source.ScreenShare){l=yield this.unpublishTrack(l.track);const u=this.getTrackPublication(Track.Source.ScreenShareAudio);u&&u.track&&this.unpublishTrack(u.track)}else yield l.mute();return l})}enableCameraAndMicrophone(){return __awaiter(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(Track.Source.Camera)||this.pendingPublishing.has(Track.Source.Microphone))){this.pendingPublishing.add(Track.Source.Camera),this.pendingPublishing.add(Track.Source.Microphone);try{const t=yield this.createTracks({audio:!0,video:!0});yield Promise.all(t.map(o=>this.publishTrack(o)))}finally{this.pendingPublishing.delete(Track.Source.Camera),this.pendingPublishing.delete(Track.Source.Microphone)}}})}createTracks(t){return __awaiter(this,void 0,void 0,function*(){var o,e;const n=mergeDefaultOptions(t,(o=this.roomOptions)===null||o===void 0?void 0:o.audioCaptureDefaults,(e=this.roomOptions)===null||e===void 0?void 0:e.videoCaptureDefaults),a=constraintsForOptions(n);let c;try{c=yield navigator.mediaDevices.getUserMedia(a)}catch(l){throw l instanceof Error&&(a.audio&&(this.microphoneError=l),a.video&&(this.cameraError=l)),l}return a.audio&&(this.microphoneError=void 0,this.emit(ParticipantEvent.AudioStreamAcquired)),a.video&&(this.cameraError=void 0),Promise.all(c.getTracks().map(l=>__awaiter(this,void 0,void 0,function*(){const u=l.kind==="audio";let d=u?n.audio:n.video;(typeof d=="boolean"||!d)&&(d={});let p;const g=u?a.audio:a.video;typeof g!="boolean"&&(p=g);const S=mediaTrackToLocalTrack(l,p,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return S.kind===Track.Kind.Video?S.source=Track.Source.Camera:S.kind===Track.Kind.Audio&&(S.source=Track.Source.Microphone,S.setAudioContext(this.audioContext)),S.mediaStream=c,d.processor&&(S instanceof LocalAudioTrack?yield S.setProcessor(d.processor):yield S.setProcessor(d.processor)),S})))})}createScreenTracks(t){return __awaiter(this,void 0,void 0,function*(){if(t===void 0&&(t={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new DeviceUnsupportedError("getDisplayMedia not supported");t.resolution===void 0&&!isSafari17()&&(t.resolution=ScreenSharePresets.h1080fps30.resolution);const o=screenCaptureToDisplayMediaStreamOptions(t),e=yield navigator.mediaDevices.getDisplayMedia(o),n=e.getVideoTracks();if(n.length===0)throw new TrackInvalidError("no video track found");const a=new LocalVideoTrack(n[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=Track.Source.ScreenShare,t.contentHint&&(a.mediaStreamTrack.contentHint=t.contentHint);const c=[a];if(e.getAudioTracks().length>0){this.emit(ParticipantEvent.AudioStreamAcquired);const l=new LocalAudioTrack(e.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});l.source=Track.Source.ScreenShareAudio,c.push(l)}return c})}publishTrack(t,o){return __awaiter(this,void 0,void 0,function*(){var e,n,a,c;t instanceof LocalAudioTrack&&t.setAudioContext(this.audioContext),yield(e=this.reconnectFuture)===null||e===void 0?void 0:e.promise,t instanceof LocalTrack&&this.pendingPublishPromises.has(t)&&(yield this.pendingPublishPromises.get(t));let l;if(t instanceof MediaStreamTrack)l=t.getConstraints();else{l=t.constraints;let y;switch(t.source){case Track.Source.Microphone:y="audioinput";break;case Track.Source.Camera:y="videoinput"}y&&this.activeDeviceMap.has(y)&&(l=Object.assign(Object.assign({},l),{deviceId:this.activeDeviceMap.get(y)}))}if(t instanceof MediaStreamTrack)switch(t.kind){case"audio":t=new LocalAudioTrack(t,l,!0,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});break;case"video":t=new LocalVideoTrack(t,l,!0,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});break;default:throw new TrackInvalidError("unsupported MediaStreamTrack kind ".concat(t.kind))}else t.updateLoggerOptions({loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});let u;if(this.trackPublications.forEach(y=>{y.track&&y.track===t&&(u=y)}),u)return this.log.warn("track has already been published, skipping",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(u))),u;const d="channelCount"in t.mediaStreamTrack.getSettings()&&t.mediaStreamTrack.getSettings().channelCount===2||t.mediaStreamTrack.getConstraints().channelCount===2,p=(n=o==null?void 0:o.forceStereo)!==null&&n!==void 0?n:d;p&&(o||(o={}),o.dtx===void 0&&this.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(t))),o.red===void 0&&this.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(a=o.dtx)!==null&&a!==void 0||(o.dtx=!1),(c=o.red)!==null&&c!==void 0||(o.red=!1));const g=Object.assign(Object.assign({},this.roomOptions.publishDefaults),o);!isE2EESimulcastSupported()&&this.roomOptions.e2ee&&(this.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},this.logContext)),g.simulcast=!1),g.source&&(t.source=g.source);const S=this.publish(t,g,p);this.pendingPublishPromises.set(t,S);try{return yield S}catch(y){throw y}finally{this.pendingPublishPromises.delete(t)}})}publish(t,o,e){return __awaiter(this,void 0,void 0,function*(){var n,a,c,l,u,d,p,g,S,y;Array.from(this.trackPublications.values()).find(P=>t instanceof LocalTrack&&P.source===t.source)&&t.source!==Track.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(t.source),Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(t))),o.stopMicTrackOnMute&&t instanceof LocalAudioTrack&&(t.stopOnMute=!0),t.source===Track.Source.ScreenShare&&isFireFox()&&(o.simulcast=!1),o.videoCodec==="av1"&&!supportsAV1()&&(o.videoCodec=void 0),o.videoCodec==="vp9"&&!supportsVP9()&&(o.videoCodec=void 0),o.videoCodec===void 0&&(o.videoCodec=defaultVideoCodec),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(P=>o.videoCodec===mimeTypeToVideoCodecString(P.mime))||(o.videoCodec=mimeTypeToVideoCodecString(this.enabledPublishVideoCodecs[0].mime)));const k=o.videoCodec;t.on(TrackEvent.Muted,this.onTrackMuted),t.on(TrackEvent.Unmuted,this.onTrackUnmuted),t.on(TrackEvent.Ended,this.handleTrackEnded),t.on(TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),t.on(TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed),t.on(TrackEvent.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const O=new AddTrackRequest({cid:t.mediaStreamTrack.id,name:o.name,type:Track.kindToProto(t.kind),muted:t.isMuted,source:Track.sourceToProto(t.source),disableDtx:!(!((n=o.dtx)!==null&&n!==void 0)||n),encryption:this.encryptionType,stereo:e,disableRed:this.isE2EEEnabled||!(!((a=o.red)!==null&&a!==void 0)||a),stream:o==null?void 0:o.stream});let C;if(t.kind===Track.Kind.Video){let P={width:0,height:0};try{P=yield t.waitForDimensions()}catch{const j=(l=(c=this.roomOptions.videoCaptureDefaults)===null||c===void 0?void 0:c.resolution)!==null&&l!==void 0?l:VideoPresets.h720.resolution;P={width:j.width,height:j.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(t)),{dims:P}))}O.width=P.width,O.height=P.height,t instanceof LocalVideoTrack&&(isSVCCodec(k)&&(t.source===Track.Source.ScreenShare&&(o.scalabilityMode="L1T3","contentHint"in t.mediaStreamTrack&&(t.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(t))))),o.scalabilityMode=(u=o.scalabilityMode)!==null&&u!==void 0?u:"L3T3_KEY"),O.simulcastCodecs=[new SimulcastCodec({codec:k,cid:t.mediaStreamTrack.id})],o.backupCodec===!0&&(o.backupCodec={codec:defaultVideoCodec}),o.backupCodec&&k!==o.backupCodec.codec&&O.encryption===Encryption_Type.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),O.simulcastCodecs.push(new SimulcastCodec({codec:o.backupCodec.codec,cid:""})))),C=computeVideoEncodings(t.source===Track.Source.ScreenShare,O.width,O.height,o),O.layers=videoLayersFromEncodings(O.width,O.height,C,isSVCCodec(o.videoCodec))}else t.kind===Track.Kind.Audio&&(C=[{maxBitrate:(d=o.audioPreset)===null||d===void 0?void 0:d.maxBitrate,priority:(g=(p=o.audioPreset)===null||p===void 0?void 0:p.priority)!==null&&g!==void 0?g:"high",networkPriority:(y=(S=o.audioPreset)===null||S===void 0?void 0:S.priority)!==null&&y!==void 0?y:"high"}]);if(!this.engine||this.engine.isClosed)throw new UnexpectedConnectionState("cannot publish track when not connected");const N=()=>__awaiter(this,void 0,void 0,function*(){var P,F,j;if(!this.engine.pcManager)throw new UnexpectedConnectionState("pcManager is not ready");if(t.sender=yield this.engine.createSender(t,o,C),t instanceof LocalVideoTrack&&((P=o.degradationPreference)!==null&&P!==void 0||(o.degradationPreference=getDefaultDegradationPreference(t)),t.setDegradationPreference(o.degradationPreference)),C)if(isFireFox()&&t.kind===Track.Kind.Audio){let H;for(const W of this.engine.pcManager.publisher.getTransceivers())if(W.sender===t.sender){H=W;break}H&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:H,codec:"opus",maxbr:!((F=C[0])===null||F===void 0)&&F.maxBitrate?C[0].maxBitrate/1e3:0})}else t.codec&&isSVCCodec(t.codec)&&(!((j=C[0])===null||j===void 0)&&j.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:O.cid,codec:t.codec,maxbr:C[0].maxBitrate/1e3});yield this.engine.negotiate()});let x;if(this.enabledPublishVideoCodecs.length>0)x=(yield Promise.all([this.engine.addTrack(O),N()]))[0];else{x=yield this.engine.addTrack(O);let P;if(x.codecs.forEach(F=>{P===void 0&&(P=F.mimeType)}),P&&t.kind===Track.Kind.Video){const F=mimeTypeToVideoCodecString(P);F!==k&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(t)),{codec:F})),o.videoCodec=F,C=computeVideoEncodings(t.source===Track.Source.ScreenShare,O.width,O.height,o))}yield N()}const U=new LocalTrackPublication(t.kind,x,t,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return U.options=o,t.sid=x.sid,this.log.debug("publishing ".concat(t.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:C,trackInfo:x})),t instanceof LocalVideoTrack?t.startMonitor(this.engine.client):t instanceof LocalAudioTrack&&t.startMonitor(),this.addTrackPublication(U),this.emit(ParticipantEvent.LocalTrackPublished,U),U})}get isLocal(){return!0}publishAdditionalCodecForTrack(t,o,e){return __awaiter(this,void 0,void 0,function*(){var n;if(this.encryptionType!==Encryption_Type.NONE)return;let a;if(this.trackPublications.forEach(y=>{y.track&&y.track===t&&(a=y)}),!a)throw new TrackInvalidError("track is not published");if(!(t instanceof LocalVideoTrack))throw new TrackInvalidError("track is not a video track");const c=Object.assign(Object.assign({},(n=this.roomOptions)===null||n===void 0?void 0:n.publishDefaults),e),l=computeTrackBackupEncodings(t,o,c);if(!l){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(t)));return}const u=t.addSimulcastTrack(o,l);if(!u)return;const d=new AddTrackRequest({cid:u.mediaStreamTrack.id,type:Track.kindToProto(t.kind),muted:t.isMuted,source:Track.sourceToProto(t.source),sid:t.sid,simulcastCodecs:[{codec:c.videoCodec,cid:u.mediaStreamTrack.id}]});if(d.layers=videoLayersFromEncodings(d.width,d.height,l),!this.engine||this.engine.isClosed)throw new UnexpectedConnectionState("cannot publish track when not connected");const p=()=>__awaiter(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(t,u,c,l),yield this.engine.negotiate()}),S=(yield Promise.all([this.engine.addTrack(d),p()]))[0];this.log.debug("published ".concat(o," for track ").concat(t.sid),Object.assign(Object.assign({},this.logContext),{encodings:l,trackInfo:S}))})}unpublishTrack(t,o){return __awaiter(this,void 0,void 0,function*(){var e,n;if(t instanceof LocalTrack){const d=this.pendingPublishPromises.get(t);d&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(t))),yield d)}const a=this.getPublicationForTrack(t),c=a?getLogContextFromTrack(a):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),c)),!a||!a.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),c));return}t=a.track,t.off(TrackEvent.Muted,this.onTrackMuted),t.off(TrackEvent.Unmuted,this.onTrackUnmuted),t.off(TrackEvent.Ended,this.handleTrackEnded),t.off(TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),t.off(TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed),t.off(TrackEvent.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),o===void 0&&(o=(n=(e=this.roomOptions)===null||e===void 0?void 0:e.stopLocalTrackOnUnpublish)!==null&&n!==void 0?n:!0),o&&t.stop();let l=!1;const u=t.sender;if(t.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<PCTransportState.FAILED&&u)try{for(const d of this.engine.pcManager.publisher.getTransceivers())d.sender===u&&(d.direction="inactive",l=!0);if(this.engine.removeTrack(u)&&(l=!0),t instanceof LocalVideoTrack){for(const[,d]of t.simulcastCodecs)d.sender&&(this.engine.removeTrack(d.sender)&&(l=!0),d.sender=void 0);t.simulcastCodecs.clear()}}catch(d){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),c),{error:d}))}switch(this.trackPublications.delete(a.trackSid),a.kind){case Track.Kind.Audio:this.audioTrackPublications.delete(a.trackSid);break;case Track.Kind.Video:this.videoTrackPublications.delete(a.trackSid);break}return this.emit(ParticipantEvent.LocalTrackUnpublished,a),a.setTrack(void 0),l&&(yield this.engine.negotiate()),a})}unpublishTracks(t){return __awaiter(this,void 0,void 0,function*(){return(yield Promise.all(t.map(e=>this.unpublishTrack(e)))).filter(e=>e instanceof LocalTrackPublication)})}republishAllTracks(t){return __awaiter(this,arguments,void 0,function(o){var e=this;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){const a=[];e.trackPublications.forEach(c=>{c.track&&(o&&(c.options=Object.assign(Object.assign({},c.options),o)),a.push(c))}),yield Promise.all(a.map(c=>__awaiter(e,void 0,void 0,function*(){const l=c.track;yield this.unpublishTrack(l,!1),n&&!l.isMuted&&l.source!==Track.Source.ScreenShare&&l.source!==Track.Source.ScreenShareAudio&&(l instanceof LocalAudioTrack||l instanceof LocalVideoTrack)&&!l.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield l.restartTrack()),yield this.publishTrack(l,c.options)})))}()})}publishData(t){return __awaiter(this,arguments,void 0,function(o){var e=this;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const a=n.reliable?DataPacket_Kind.RELIABLE:DataPacket_Kind.LOSSY,c=n.destinationIdentities,l=n.topic,u=new DataPacket({kind:a,value:{case:"user",value:new UserPacket({participantIdentity:e.identity,payload:o,destinationIdentities:c,topic:l})}});yield e.engine.sendDataPacket(u,a)}()})}setTrackSubscriptionPermissions(t){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=o,this.allParticipantsAllowedToSubscribe=t,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}setEnabledPublishCodecs(t){this.enabledPublishVideoCodecs=t.filter(o=>o.mime.split("/")[0].toLowerCase()==="video")}updateInfo(t){return t.sid!==this.sid||!super.updateInfo(t)?!1:(t.tracks.forEach(o=>{var e,n;const a=this.trackPublications.get(o.sid);if(a){const c=a.isMuted||((n=(e=a.track)===null||e===void 0?void 0:e.isUpstreamPaused)!==null&&n!==void 0?n:!1);c!==o.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(a)),{mutedOnServer:c})),this.engine.client.sendMuteTrack(o.sid,c))}}),!0)}getPublicationForTrack(t){let o;return this.trackPublications.forEach(e=>{const n=e.track;n&&(t instanceof MediaStreamTrack?(n instanceof LocalAudioTrack||n instanceof LocalVideoTrack)&&n.mediaStreamTrack===t&&(o=e):t===n&&(o=e))}),o}}class RemoteTrackPublication extends TrackPublication{constructor(t,o,e,n){super(t,o.sid,o.name,n),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=VideoQuality.HIGH,this.handleEnded=a=>{this.setTrack(void 0),this.emit(TrackEvent.Ended,a)},this.handleVisibilityChange=a=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(a),this.logContext),this.disabled=!a,this.emitTrackUpdate()},this.handleVideoDimensionsChange=a=>{this.log.debug("adaptivestream video dimensions ".concat(a.width,"x").concat(a.height),this.logContext),this.videoDimensions=a,this.emitTrackUpdate()},this.subscribed=e,this.updateInfo(o)}setSubscribed(t){const o=this.subscriptionStatus,e=this.permissionStatus;this.subscribed=t,t&&(this.allowed=!0);const n=new UpdateSubscription({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new ParticipantTracks({participantSid:"",trackSids:[this.trackSid]})]});this.emit(TrackEvent.UpdateSubscription,n),this.emitSubscriptionUpdateIfChanged(o),this.emitPermissionUpdateIfChanged(e)}get subscriptionStatus(){return this.subscribed===!1?TrackPublication.SubscriptionStatus.Unsubscribed:super.isSubscribed?TrackPublication.SubscriptionStatus.Subscribed:TrackPublication.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?TrackPublication.PermissionStatus.Allowed:TrackPublication.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return!this.disabled}setEnabled(t){!this.isManualOperationAllowed()||this.disabled===!t||(this.disabled=!t,this.emitTrackUpdate())}setVideoQuality(t){!this.isManualOperationAllowed()||this.currentVideoQuality===t||(this.currentVideoQuality=t,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(t){var o,e;this.isManualOperationAllowed()&&(((o=this.videoDimensions)===null||o===void 0?void 0:o.width)===t.width&&((e=this.videoDimensions)===null||e===void 0?void 0:e.height)===t.height||(this.track instanceof RemoteVideoTrack&&(this.videoDimensions=t),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(t){this.isManualOperationAllowed()&&this.track instanceof RemoteVideoTrack&&this.fps!==t&&(this.fps=t,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(t){const o=this.subscriptionStatus,e=this.permissionStatus,n=this.track;n!==t&&(n&&(n.off(TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),n.off(TrackEvent.VisibilityChanged,this.handleVisibilityChange),n.off(TrackEvent.Ended,this.handleEnded),n.detach(),n.stopMonitor(),this.emit(TrackEvent.Unsubscribed,n)),super.setTrack(t),t&&(t.sid=this.trackSid,t.on(TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),t.on(TrackEvent.VisibilityChanged,this.handleVisibilityChange),t.on(TrackEvent.Ended,this.handleEnded),this.emit(TrackEvent.Subscribed,t)),this.emitPermissionUpdateIfChanged(e),this.emitSubscriptionUpdateIfChanged(o))}setAllowed(t){const o=this.subscriptionStatus,e=this.permissionStatus;this.allowed=t,this.emitPermissionUpdateIfChanged(e),this.emitSubscriptionUpdateIfChanged(o)}setSubscriptionError(t){this.emit(TrackEvent.SubscriptionFailed,t)}updateInfo(t){super.updateInfo(t);const o=this.metadataMuted;this.metadataMuted=t.muted,this.track?this.track.setMuted(t.muted):o!==t.muted&&this.emit(t.muted?TrackEvent.Muted:TrackEvent.Unmuted)}emitSubscriptionUpdateIfChanged(t){const o=this.subscriptionStatus;t!==o&&this.emit(TrackEvent.SubscriptionStatusChanged,o,t)}emitPermissionUpdateIfChanged(t){this.permissionStatus!==t&&this.emit(TrackEvent.SubscriptionPermissionChanged,this.permissionStatus,t)}isManualOperationAllowed(){return this.kind===Track.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return this.track instanceof RemoteVideoTrack&&this.track.isAdaptiveStream}emitTrackUpdate(){const t=new UpdateTrackSettings({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(t.width=Math.ceil(this.videoDimensions.width),t.height=Math.ceil(this.videoDimensions.height)):this.currentVideoQuality!==void 0?t.quality=this.currentVideoQuality:t.quality=VideoQuality.HIGH,this.emit(TrackEvent.UpdateSettings,t)}}class RemoteParticipant extends Participant{static fromParticipantInfo(t,o,e){return new RemoteParticipant(t,o.sid,o.identity,o.name,o.metadata,e,o.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(t,o,e,n,a,c){let l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:ParticipantInfo_Kind.STANDARD;super(o,e||"",n,a,c,l),this.signalClient=t,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(t){super.addTrackPublication(t),t.on(TrackEvent.UpdateSettings,o=>{this.log.debug("send update settings",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(t))),this.signalClient.sendUpdateTrackSettings(o)}),t.on(TrackEvent.UpdateSubscription,o=>{o.participantTracks.forEach(e=>{e.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(o)}),t.on(TrackEvent.SubscriptionPermissionChanged,o=>{this.emit(ParticipantEvent.TrackSubscriptionPermissionChanged,t,o)}),t.on(TrackEvent.SubscriptionStatusChanged,o=>{this.emit(ParticipantEvent.TrackSubscriptionStatusChanged,t,o)}),t.on(TrackEvent.Subscribed,o=>{this.emit(ParticipantEvent.TrackSubscribed,o,t)}),t.on(TrackEvent.Unsubscribed,o=>{this.emit(ParticipantEvent.TrackUnsubscribed,o,t)}),t.on(TrackEvent.SubscriptionFailed,o=>{this.emit(ParticipantEvent.TrackSubscriptionFailed,t.trackSid,o)})}getTrackPublication(t){const o=super.getTrackPublication(t);if(o)return o}getTrackPublicationByName(t){const o=super.getTrackPublicationByName(t);if(o)return o}setVolume(t){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Track.Source.Microphone;this.volumeMap.set(o,t);const e=this.getTrackPublication(o);e&&e.track&&e.track.setVolume(t)}getVolume(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Track.Source.Microphone;const o=this.getTrackPublication(t);return o&&o.track?o.track.getVolume():this.volumeMap.get(t)}addSubscribedMediaTrack(t,o,e,n,a,c){let l=this.getTrackPublicationBySid(o);if(l||o.startsWith("TR")||this.trackPublications.forEach(p=>{!l&&t.kind===p.kind.toString()&&(l=p)}),!l){if(c===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:o})),this.emit(ParticipantEvent.TrackSubscriptionFailed,o);return}c===void 0&&(c=20),setTimeout(()=>{this.addSubscribedMediaTrack(t,o,e,n,a,c-1)},150);return}if(t.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(l))),this.emit(ParticipantEvent.TrackSubscriptionFailed,o);return}const u=t.kind==="video";let d;return u?d=new RemoteVideoTrack(t,o,n,a):d=new RemoteAudioTrack(t,o,n,this.audioContext,this.audioOutput),d.source=l.source,d.isMuted=l.isMuted,d.setMediaStream(e),d.start(),l.setTrack(d),this.volumeMap.has(l.source)&&d instanceof RemoteAudioTrack&&d.setVolume(this.volumeMap.get(l.source)),l}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(t){return this.trackPublications.get(t)}updateInfo(t){if(!super.updateInfo(t))return!1;const o=new Map,e=new Map;return t.tracks.forEach(n=>{var a,c;let l=this.getTrackPublicationBySid(n.sid);if(l)l.updateInfo(n);else{const u=Track.kindFromProto(n.type);if(!u)return;l=new RemoteTrackPublication(u,n,(a=this.signalClient.connectOptions)===null||a===void 0?void 0:a.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(c=this.loggerOptions)===null||c===void 0?void 0:c.loggerName}),l.updateInfo(n),e.set(n.sid,l);const d=Array.from(this.trackPublications.values()).find(p=>p.source===(l==null?void 0:l.source));d&&l.source!==Track.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(l.source),Object.assign(Object.assign({},this.logContext),{oldTrack:getLogContextFromTrack(d),newTrack:getLogContextFromTrack(l)})),this.addTrackPublication(l)}o.set(n.sid,l)}),this.trackPublications.forEach(n=>{o.has(n.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(n))),this.unpublishTrack(n.trackSid,!0))}),e.forEach(n=>{this.emit(ParticipantEvent.TrackPublished,n)}),!0}unpublishTrack(t,o){const e=this.trackPublications.get(t);if(!e)return;const{track:n}=e;switch(n&&(n.stop(),e.setTrack(void 0)),this.trackPublications.delete(t),e.kind){case Track.Kind.Audio:this.audioTrackPublications.delete(t);break;case Track.Kind.Video:this.videoTrackPublications.delete(t);break}o&&this.emit(ParticipantEvent.TrackUnpublished,e)}setAudioOutput(t){return __awaiter(this,void 0,void 0,function*(){this.audioOutput=t;const o=[];this.audioTrackPublications.forEach(e=>{var n;e.track instanceof RemoteAudioTrack&&o.push(e.track.setSinkId((n=t.deviceId)!==null&&n!==void 0?n:"default"))}),yield Promise.all(o)})}emit(t){for(var o=arguments.length,e=new Array(o>1?o-1:0),n=1;n<o;n++)e[n-1]=arguments[n];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:t,args:e})),super.emit(t,...e)}}var ConnectionState;(function(s){s.Disconnected="disconnected",s.Connecting="connecting",s.Connected="connected",s.Reconnecting="reconnecting",s.SignalReconnecting="signalReconnecting"})(ConnectionState||(ConnectionState={}));const connectionReconcileFrequency=4*1e3;class Room extends eventsExports.EventEmitter{constructor(t){var o,e,n;super(),o=this,this.state=ConnectionState.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=livekitLogger,this.bufferedEvents=[],this.isResuming=!1,this.connect=(a,c,l)=>__awaiter(this,void 0,void 0,function*(){var u;if(!isBrowserSupported())throw isReactNative()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const d=yield this.disconnectLock.lock();if(this.state===ConnectionState.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),d(),Promise.resolve();if(this.connectFuture)return d(),this.connectFuture.promise;this.setAndEmitConnectionState(ConnectionState.Connecting),((u=this.regionUrlProvider)===null||u===void 0?void 0:u.getServerUrl().toString())!==a&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),isCloud(new URL(a))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new RegionUrlProvider(a,c):this.regionUrlProvider.updateToken(c),this.regionUrlProvider.fetchRegionSettings().then(S=>{var y;(y=this.regionUrlProvider)===null||y===void 0||y.setServerReportedRegions(S)}).catch(S=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:S}))}));const p=(S,y,b)=>__awaiter(this,void 0,void 0,function*(){var k,O;this.abortController&&this.abortController.abort();const C=new AbortController;this.abortController=C,d==null||d();try{yield this.attemptConnection(b??a,c,l,C),this.abortController=void 0,S()}catch(N){if(this.regionUrlProvider&&N instanceof ConnectionError&&N.reason!==3&&N.reason!==0){let x=null;try{x=yield this.regionUrlProvider.getNextBestRegionUrl((k=this.abortController)===null||k===void 0?void 0:k.signal)}catch(U){if(U instanceof ConnectionError&&(U.status===401||U.reason===3)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),y(U);return}}x&&!(!((O=this.abortController)===null||O===void 0)&&O.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(N.message,". Retrying with another region: ").concat(x),this.logContext),this.recreateEngine(),yield p(S,y,x)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),y(N))}else this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),y(N)}}),g=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Future((S,y)=>{p(S,y,g)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(a,c,l,u,d,p)=>__awaiter(this,void 0,void 0,function*(){var g,S,y;const b=yield l.join(a,c,{autoSubscribe:u.autoSubscribe,adaptiveStream:typeof d.adaptiveStream=="object"?!0:d.adaptiveStream,maxRetries:u.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:u.websocketTimeout},p.signal);let k=b.serverInfo;if(k||(k={version:b.serverVersion,region:b.serverRegion}),this.log.debug("connected to Livekit Server ".concat(Object.entries(k).map(O=>{let[C,N]=O;return"".concat(C,": ").concat(N)}).join(", ")),{room:(g=b.room)===null||g===void 0?void 0:g.name,roomSid:(S=b.room)===null||S===void 0?void 0:S.sid,identity:(y=b.participant)===null||y===void 0?void 0:y.identity}),!b.serverVersion)throw new UnsupportedServer("unknown server version");return b.serverVersion==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),d.dynacast=!1),b}),this.applyJoinResponse=a=>{const c=a.participant;if(this.localParticipant.sid=c.sid,this.localParticipant.identity=c.identity,this.localParticipant.setEnabledPublishCodecs(a.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(a.sifTrailer)}catch(l){this.log.error(l instanceof Error?l.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:l}))}this.handleParticipantUpdates([c,...a.otherParticipants]),a.room&&this.handleRoomUpdate(a.room)},this.attemptConnection=(a,c,l,u)=>__awaiter(this,void 0,void 0,function*(){var d,p,g;this.state===ConnectionState.Reconnecting||this.isResuming||!((d=this.engine)===null||d===void 0)&&d.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((p=this.regionUrlProvider)===null||p===void 0)&&p.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},roomConnectOptionDefaults),l),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const S=yield this.connectSignal(a,c,this.engine,this.connOptions,this.options,u);this.applyJoinResponse(S),this.setupLocalParticipantEvents(),this.emit(RoomEvent.SignalConnected)}catch(S){yield this.engine.close(),this.recreateEngine();const y=new ConnectionError("could not establish signal connection");throw S instanceof Error&&(y.message="".concat(y.message,": ").concat(S.message)),S instanceof ConnectionError&&(y.reason=S.reason,y.status=S.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:S})),y}if(u.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new ConnectionError("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,u)}catch(S){throw yield this.engine.close(),this.recreateEngine(),S}isWeb()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),isWeb()&&(document.addEventListener("freeze",this.onPageLeave),(g=navigator.mediaDevices)===null||g===void 0||g.addEventListener("devicechange",this.handleDeviceChange)),this.setAndEmitConnectionState(ConnectionState.Connected),this.emit(RoomEvent.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return __awaiter(o,[...c],void 0,function(){var u=this;let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var p,g,S,y;const b=yield u.disconnectLock.lock();try{if(u.state===ConnectionState.Disconnected){u.log.debug("already disconnected",u.logContext);return}u.log.info("disconnect from room",Object.assign({},u.logContext)),(u.state===ConnectionState.Connecting||u.state===ConnectionState.Reconnecting||u.isResuming)&&(u.log.warn("abort connection attempt",u.logContext),(p=u.abortController)===null||p===void 0||p.abort(),(S=(g=u.connectFuture)===null||g===void 0?void 0:g.reject)===null||S===void 0||S.call(g,new ConnectionError("Client initiated disconnect")),u.connectFuture=void 0),!((y=u.engine)===null||y===void 0)&&y.client.isDisconnected||(yield u.engine.client.sendLeave()),u.engine&&(yield u.engine.close()),u.handleDisconnect(d,DisconnectReason.CLIENT_INITIATED),u.engine=void 0}finally{b()}}()})},this.onPageLeave=()=>__awaiter(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>__awaiter(this,void 0,void 0,function*(){const a=[],c=getBrowser();if(c&&c.os==="iOS"){const l="livekit-dummy-audio-el";let u=document.getElementById(l);if(!u){u=document.createElement("audio"),u.id=l,u.autoplay=!0,u.hidden=!0;const d=getEmptyAudioStreamTrack();d.enabled=!0;const p=new MediaStream([d]);u.srcObject=p,document.addEventListener("visibilitychange",()=>{u&&(u.srcObject=document.hidden?null:p,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(u),this.once(RoomEvent.Disconnected,()=>{u==null||u.remove(),u=null})}a.push(u)}this.remoteParticipants.forEach(l=>{l.audioTrackPublications.forEach(u=>{u.track&&u.track.attachedElements.forEach(d=>{a.push(d)})})});try{yield Promise.all([this.acquireAudioContext(),...a.map(l=>(l.muted=!1,l.play()))]),this.handleAudioPlaybackStarted()}catch(l){throw this.handleAudioPlaybackFailed(l),l}}),this.startVideo=()=>__awaiter(this,void 0,void 0,function*(){const a=[];for(const c of this.remoteParticipants.values())c.videoTrackPublications.forEach(l=>{var u;(u=l.track)===null||u===void 0||u.attachedElements.forEach(d=>{a.includes(d)||a.push(d)})});yield Promise.all(a.map(c=>c.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(c=>{c.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const a of this.remoteParticipants.values())this.handleParticipantDisconnected(a.identity,a);this.setAndEmitConnectionState(ConnectionState.Reconnecting)&&this.emit(RoomEvent.Reconnecting)},this.handleSignalRestarted=a=>__awaiter(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(a.serverRegion),Object.assign(Object.assign({},this.logContext),{region:a.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(a);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(c){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:c}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:a.serverRegion}))}catch{return}this.setAndEmitConnectionState(ConnectionState.Connected),this.emit(RoomEvent.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=a=>{a.forEach(c=>{var l;if(c.identity===this.localParticipant.identity){this.localParticipant.updateInfo(c);return}c.identity===""&&(c.identity=(l=this.sidToIdentity.get(c.sid))!==null&&l!==void 0?l:"");let u=this.remoteParticipants.get(c.identity);c.state===ParticipantInfo_State.DISCONNECTED?this.handleParticipantDisconnected(c.identity,u):u=this.getOrCreateParticipant(c.identity,c)})},this.handleActiveSpeakersUpdate=a=>{const c=[],l={};a.forEach(u=>{if(l[u.sid]=!0,u.sid===this.localParticipant.sid)this.localParticipant.audioLevel=u.level,this.localParticipant.setIsSpeaking(!0),c.push(this.localParticipant);else{const d=this.getRemoteParticipantBySid(u.sid);d&&(d.audioLevel=u.level,d.setIsSpeaking(!0),c.push(d))}}),l[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(u=>{l[u.sid]||(u.audioLevel=0,u.setIsSpeaking(!1))}),this.activeSpeakers=c,this.emitWhenConnected(RoomEvent.ActiveSpeakersChanged,c)},this.handleSpeakersChanged=a=>{const c=new Map;this.activeSpeakers.forEach(u=>{const d=this.remoteParticipants.get(u.identity);d&&d.sid!==u.sid||c.set(u.sid,u)}),a.forEach(u=>{let d=this.getRemoteParticipantBySid(u.sid);u.sid===this.localParticipant.sid&&(d=this.localParticipant),d&&(d.audioLevel=u.level,d.setIsSpeaking(u.active),u.active?c.set(u.sid,d):c.delete(u.sid))});const l=Array.from(c.values());l.sort((u,d)=>d.audioLevel-u.audioLevel),this.activeSpeakers=l,this.emitWhenConnected(RoomEvent.ActiveSpeakersChanged,l)},this.handleStreamStateUpdate=a=>{a.streamStates.forEach(c=>{const l=this.getRemoteParticipantBySid(c.participantSid);if(!l)return;const u=l.getTrackPublicationBySid(c.trackSid);!u||!u.track||(u.track.streamState=Track.streamStateFromProto(c.state),l.emit(ParticipantEvent.TrackStreamStateChanged,u,u.track.streamState),this.emitWhenConnected(RoomEvent.TrackStreamStateChanged,u,u.track.streamState,l))})},this.handleSubscriptionPermissionUpdate=a=>{const c=this.getRemoteParticipantBySid(a.participantSid);if(!c)return;const l=c.getTrackPublicationBySid(a.trackSid);l&&l.setAllowed(a.allowed)},this.handleSubscriptionError=a=>{const c=Array.from(this.remoteParticipants.values()).find(u=>u.trackPublications.has(a.trackSid));if(!c)return;const l=c.getTrackPublicationBySid(a.trackSid);l&&l.setSubscriptionError(a.err)},this.handleDataPacket=a=>{const c=this.remoteParticipants.get(a.participantIdentity);a.value.case==="user"?this.handleUserPacket(c,a.value.value,a.kind):a.value.case==="transcription"?this.handleTranscription(c,a.value.value):a.value.case==="sipDtmf"&&this.handleSipDtmf(c,a.value.value)},this.handleUserPacket=(a,c,l)=>{this.emit(RoomEvent.DataReceived,c.payload,a,l,c.topic),a==null||a.emit(ParticipantEvent.DataReceived,c.payload,l)},this.handleSipDtmf=(a,c)=>{this.emit(RoomEvent.SipDTMFReceived,c,a),a==null||a.emit(ParticipantEvent.SipDTMFReceived,c)},this.bufferedSegments=new Map,this.handleTranscription=(a,c)=>{const l=c.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(c.transcribedParticipantIdentity),u=l==null?void 0:l.trackPublications.get(c.trackId),d=extractTranscriptionSegments(c,this.transcriptionReceivedTimes);u==null||u.emit(TrackEvent.TranscriptionReceived,d),l==null||l.emit(ParticipantEvent.TranscriptionReceived,d,u),this.emit(RoomEvent.TranscriptionReceived,d,l,u)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(RoomEvent.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=a=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:a})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(RoomEvent.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(RoomEvent.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(RoomEvent.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>__awaiter(this,void 0,void 0,function*(){this.emit(RoomEvent.MediaDevicesChanged)}),this.handleRoomUpdate=a=>{const c=this.roomInfo;this.roomInfo=a,c&&c.metadata!==a.metadata&&this.emitWhenConnected(RoomEvent.RoomMetadataChanged,a.metadata),(c==null?void 0:c.activeRecording)!==a.activeRecording&&this.emitWhenConnected(RoomEvent.RecordingStatusChanged,a.activeRecording)},this.handleConnectionQualityUpdate=a=>{a.updates.forEach(c=>{if(c.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(c.quality);return}const l=this.getRemoteParticipantBySid(c.participantSid);l&&l.setConnectionQuality(c.quality)})},this.onLocalParticipantMetadataChanged=a=>{this.emit(RoomEvent.ParticipantMetadataChanged,a,this.localParticipant)},this.onLocalParticipantNameChanged=a=>{this.emit(RoomEvent.ParticipantNameChanged,a,this.localParticipant)},this.onLocalAttributesChanged=a=>{this.emit(RoomEvent.ParticipantAttributesChanged,a,this.localParticipant)},this.onLocalTrackMuted=a=>{this.emit(RoomEvent.TrackMuted,a,this.localParticipant)},this.onLocalTrackUnmuted=a=>{this.emit(RoomEvent.TrackUnmuted,a,this.localParticipant)},this.onTrackProcessorUpdate=a=>{var c;(c=a==null?void 0:a.onPublish)===null||c===void 0||c.call(a,this)},this.onLocalTrackPublished=a=>__awaiter(this,void 0,void 0,function*(){var c,l,u,d,p;(c=a.track)===null||c===void 0||c.on(TrackEvent.TrackProcessorUpdate,this.onTrackProcessorUpdate),(d=(u=(l=a.track)===null||l===void 0?void 0:l.getProcessor())===null||u===void 0?void 0:u.onPublish)===null||d===void 0||d.call(u,this),this.emit(RoomEvent.LocalTrackPublished,a,this.localParticipant),a.track instanceof LocalAudioTrack&&(yield a.track.checkForSilence())&&this.emit(RoomEvent.LocalAudioSilenceDetected,a);const g=yield(p=a.track)===null||p===void 0?void 0:p.getDeviceId(),S=sourceToKind(a.source);S&&g&&g!==this.localParticipant.activeDeviceMap.get(S)&&(this.localParticipant.activeDeviceMap.set(S,g),this.emit(RoomEvent.ActiveDeviceChanged,S,g))}),this.onLocalTrackUnpublished=a=>{var c;(c=a.track)===null||c===void 0||c.off(TrackEvent.TrackProcessorUpdate,this.onTrackProcessorUpdate),this.emit(RoomEvent.LocalTrackUnpublished,a,this.localParticipant)},this.onLocalConnectionQualityChanged=a=>{this.emit(RoomEvent.ConnectionQualityChanged,a,this.localParticipant)},this.onMediaDevicesError=a=>{this.emit(RoomEvent.MediaDevicesError,a)},this.onLocalParticipantPermissionsChanged=a=>{this.emit(RoomEvent.ParticipantPermissionsChanged,a,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},roomOptionDefaults),t),this.log=getLogger((e=this.options.loggerName)!==null&&e!==void 0?e:LoggerNames.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},audioDefaults),t==null?void 0:t.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},videoDefaults),t==null?void 0:t.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},publishDefaults),t==null?void 0:t.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new Mutex,this.localParticipant=new LocalParticipant("","",this.engine,this.options),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",unwrapConstraint(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",unwrapConstraint(this.options.audioCaptureDefaults.deviceId)),!((n=this.options.audioOutput)===null||n===void 0)&&n.deviceId&&this.switchActiveDevice("audiooutput",unwrapConstraint(this.options.audioOutput.deviceId)).catch(a=>this.log.warn("Could not set audio output: ".concat(a.message),this.logContext)),this.options.e2ee&&this.setupE2EE()}setE2EEEnabled(t){return __awaiter(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(t)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(t,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var t;this.options.e2ee&&(this.e2eeManager=new E2EEManager(this.options.e2ee),this.e2eeManager.on(EncryptionEvent.ParticipantEncryptionStatusChanged,(o,e)=>{e instanceof LocalParticipant&&(this.isE2EEEnabled=o),this.emit(RoomEvent.ParticipantEncryptionStatusChanged,o,e)}),this.e2eeManager.on(EncryptionEvent.EncryptionError,o=>this.emit(RoomEvent.EncryptionError,o)),(t=this.e2eeManager)===null||t===void 0||t.setup(this))}get logContext(){var t;return{room:this.name,roomID:(t=this.roomInfo)===null||t===void 0?void 0:t.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var t,o;return(o=(t=this.roomInfo)===null||t===void 0?void 0:t.activeRecording)!==null&&o!==void 0?o:!1}getSid(){return __awaiter(this,void 0,void 0,function*(){return this.state===ConnectionState.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((t,o)=>{const e=n=>{n.sid!==""&&(this.engine.off(EngineEvent.RoomUpdate,e),t(n.sid))};this.engine.on(EngineEvent.RoomUpdate,e),this.once(RoomEvent.Disconnected,()=>{this.engine.off(EngineEvent.RoomUpdate,e),o("Room disconnected before room server id was available")})})})}get name(){var t,o;return(o=(t=this.roomInfo)===null||t===void 0?void 0:t.name)!==null&&o!==void 0?o:""}get metadata(){var t;return(t=this.roomInfo)===null||t===void 0?void 0:t.metadata}get numParticipants(){var t,o;return(o=(t=this.roomInfo)===null||t===void 0?void 0:t.numParticipants)!==null&&o!==void 0?o:0}get numPublishers(){var t,o;return(o=(t=this.roomInfo)===null||t===void 0?void 0:t.numPublishers)!==null&&o!==void 0?o:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new RTCEngine(this.options),this.engine.on(EngineEvent.ParticipantUpdate,this.handleParticipantUpdates).on(EngineEvent.RoomUpdate,this.handleRoomUpdate).on(EngineEvent.SpeakersChanged,this.handleSpeakersChanged).on(EngineEvent.StreamStateChanged,this.handleStreamStateUpdate).on(EngineEvent.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(EngineEvent.SubscriptionError,this.handleSubscriptionError).on(EngineEvent.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(EngineEvent.MediaTrackAdded,(t,o,e)=>{this.onTrackAdded(t,o,e)}).on(EngineEvent.Disconnected,t=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,t)}).on(EngineEvent.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(EngineEvent.DataPacketReceived,this.handleDataPacket).on(EngineEvent.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(ConnectionState.SignalReconnecting)&&this.emit(RoomEvent.SignalReconnecting)}).on(EngineEvent.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(ConnectionState.Connected)&&this.emit(RoomEvent.Reconnected)}).on(EngineEvent.SignalResumed,()=>{this.bufferedEvents=[],(this.state===ConnectionState.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(EngineEvent.Restarting,this.handleRestarting).on(EngineEvent.SignalRestarted,this.handleSignalRestarted).on(EngineEvent.Offline,()=>{this.setAndEmitConnectionState(ConnectionState.Reconnecting)&&this.emit(RoomEvent.Reconnecting)}).on(EngineEvent.DCBufferStatusChanged,(t,o)=>{this.emit(RoomEvent.DCBufferStatusChanged,t,o)}).on(EngineEvent.LocalTrackSubscribed,t=>{const o=this.localParticipant.getTrackPublications().find(e=>{let{trackSid:n}=e;return n===t});if(!o){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(ParticipantEvent.LocalTrackSubscribed,o),this.emitWhenConnected(RoomEvent.LocalTrackSubscribed,o,this.localParticipant)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(t){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return DeviceManager.getInstance().getDevices(t,o)}prepareConnection(t,o){return __awaiter(this,void 0,void 0,function*(){if(this.state===ConnectionState.Disconnected){this.log.debug("prepareConnection to ".concat(t),this.logContext);try{if(isCloud(new URL(t))&&o){this.regionUrlProvider=new RegionUrlProvider(t,o);const e=yield this.regionUrlProvider.getNextBestRegionUrl();e&&this.state===ConnectionState.Disconnected&&(this.regionUrl=e,yield fetch(toHttpUrl(e),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(e),this.logContext))}else yield fetch(toHttpUrl(t),{method:"HEAD"})}catch(e){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:e}))}}})}getParticipantByIdentity(t){return this.localParticipant.identity===t?this.localParticipant:this.remoteParticipants.get(t)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(t,o){return __awaiter(this,void 0,void 0,function*(){let e=()=>{},n;switch(t){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":n=new SimulateScenario({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":n=new SimulateScenario({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":n=new SimulateScenario({scenario:{case:"serverLeave",value:!0}});break;case"migration":n=new SimulateScenario({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":e=()=>__awaiter(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),n=new SimulateScenario({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":e=()=>__awaiter(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),n=new SimulateScenario({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":n=new SimulateScenario({scenario:{case:"switchCandidateProtocol",value:t==="force-tls"?2:1}}),e=()=>__awaiter(this,void 0,void 0,function*(){const a=this.engine.client.onLeave;a&&a(new LeaveRequest({reason:DisconnectReason.CLIENT_INITIATED,action:LeaveRequest_Action.RECONNECT}))});break;case"subscriber-bandwidth":if(o===void 0||typeof o!="number")throw new Error("subscriber-bandwidth requires a number as argument");n=new SimulateScenario({scenario:{case:"subscriberBandwidth",value:BigInt(o)}});break;case"leave-full-reconnect":n=new SimulateScenario({scenario:{case:"leaveRequestFullReconnect",value:!0}})}n&&(yield this.engine.client.sendSimulateScenario(n),yield e())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(t){return this.localParticipant.activeDeviceMap.get(t)}switchActiveDevice(t,o){return __awaiter(this,arguments,void 0,function(e,n){var a=this;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var l,u,d,p;let g=!1,S=!0;const y=c?{exact:n}:n;if(e==="audioinput"){const b=a.options.audioCaptureDefaults.deviceId;a.options.audioCaptureDefaults.deviceId=y,g=b!==y;const k=Array.from(a.localParticipant.audioTrackPublications.values()).filter(O=>O.source===Track.Source.Microphone);try{S=(yield Promise.all(k.map(O=>{var C;return(C=O.audioTrack)===null||C===void 0?void 0:C.setDeviceId(y)}))).every(O=>O===!0)}catch(O){throw a.options.audioCaptureDefaults.deviceId=b,O}}else if(e==="videoinput"){const b=a.options.videoCaptureDefaults.deviceId;a.options.videoCaptureDefaults.deviceId=y,g=b!==y;const k=Array.from(a.localParticipant.videoTrackPublications.values()).filter(O=>O.source===Track.Source.Camera);try{S=(yield Promise.all(k.map(O=>{var C;return(C=O.videoTrack)===null||C===void 0?void 0:C.setDeviceId(y)}))).every(O=>O===!0)}catch(O){throw a.options.videoCaptureDefaults.deviceId=b,O}}else if(e==="audiooutput"){if(!supportsSetSinkId()&&!a.options.webAudioMix||a.options.webAudioMix&&a.audioContext&&!("setSinkId"in a.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");a.options.webAudioMix&&(n=(l=yield DeviceManager.getInstance().normalizeDeviceId("audiooutput",n))!==null&&l!==void 0?l:""),(u=(p=a.options).audioOutput)!==null&&u!==void 0||(p.audioOutput={});const b=a.options.audioOutput.deviceId;a.options.audioOutput.deviceId=n,g=b!==y;try{a.options.webAudioMix&&((d=a.audioContext)===null||d===void 0||d.setSinkId(n)),yield Promise.all(Array.from(a.remoteParticipants.values()).map(k=>k.setAudioOutput({deviceId:n})))}catch(k){throw a.options.audioOutput.deviceId=b,k}}return g&&S&&(a.localParticipant.activeDeviceMap.set(e,n),a.emit(RoomEvent.ActiveDeviceChanged,e,n)),S}()})}setupLocalParticipantEvents(){this.localParticipant.on(ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(ParticipantEvent.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(ParticipantEvent.AttributesChanged,this.onLocalAttributesChanged).on(ParticipantEvent.TrackMuted,this.onLocalTrackMuted).on(ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).on(ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).on(ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).on(ParticipantEvent.AudioStreamAcquired,this.startAudio).on(ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var t;(t=this.engine)===null||t===void 0||t.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(t,o,e){if(this.state===ConnectionState.Connecting||this.state===ConnectionState.Reconnecting){const p=()=>{this.onTrackAdded(t,o,e),g()},g=()=>{this.off(RoomEvent.Reconnected,p),this.off(RoomEvent.Connected,p),this.off(RoomEvent.Disconnected,g)};this.once(RoomEvent.Reconnected,p),this.once(RoomEvent.Connected,p),this.once(RoomEvent.Disconnected,g);return}if(this.state===ConnectionState.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}const n=unpackStreamId(o.id),a=n[0];let c=n[1],l=t.id;if(c&&c.startsWith("TR")&&(l=c),a===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const u=Array.from(this.remoteParticipants.values()).find(p=>p.sid===a);if(!u){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(a),this.logContext);return}let d;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?d=this.options.adaptiveStream:d={}),u.addSubscribedMediaTrack(t,l,o,e,d)}handleDisconnect(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,o=arguments.length>1?arguments[1]:void 0;var e;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==ConnectionState.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(n=>{n.trackPublications.forEach(a=>{n.unpublishTrack(a.trackSid)})}),this.localParticipant.trackPublications.forEach(n=>{var a,c;n.track&&this.localParticipant.unpublishTrack(n.track,t),t&&((a=n.track)===null||a===void 0||a.detach(),(c=n.track)===null||c===void 0||c.stop())}),this.localParticipant.off(ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(ParticipantEvent.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(ParticipantEvent.AttributesChanged,this.onLocalAttributesChanged).off(ParticipantEvent.TrackMuted,this.onLocalTrackMuted).off(ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).off(ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).off(ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).off(ParticipantEvent.AudioStreamAcquired,this.startAudio).off(ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),isWeb()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(e=navigator.mediaDevices)===null||e===void 0||e.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(ConnectionState.Disconnected),this.emit(RoomEvent.Disconnected,o)}}}handleParticipantDisconnected(t,o){this.remoteParticipants.delete(t),o&&(o.trackPublications.forEach(e=>{o.unpublishTrack(e.trackSid,!0)}),this.emit(RoomEvent.ParticipantDisconnected,o))}acquireAudioContext(){return __awaiter(this,void 0,void 0,function*(){var t,o;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(t=getNewAudioContext())!==null&&t!==void 0?t:void 0),this.audioContext&&this.audioContext.state==="suspended")try{yield this.audioContext.resume()}catch(n){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:n}))}this.options.webAudioMix&&this.remoteParticipants.forEach(n=>n.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext);const e=((o=this.audioContext)===null||o===void 0?void 0:o.state)==="running";e!==this.canPlaybackAudio&&(this.audioEnabled=e,this.emit(RoomEvent.AudioPlaybackStatusChanged,e))})}createParticipant(t,o){var e;let n;return o?n=RemoteParticipant.fromParticipantInfo(this.engine.client,o,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):n=new RemoteParticipant(this.engine.client,"",t,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&n.setAudioContext(this.audioContext),!((e=this.options.audioOutput)===null||e===void 0)&&e.deviceId&&n.setAudioOutput(this.options.audioOutput).catch(a=>this.log.warn("Could not set audio output: ".concat(a.message),this.logContext)),n}getOrCreateParticipant(t,o){if(this.remoteParticipants.has(t)){const n=this.remoteParticipants.get(t);return o&&n.updateInfo(o)&&this.sidToIdentity.set(o.sid,o.identity),n}const e=this.createParticipant(t,o);return this.remoteParticipants.set(t,e),this.sidToIdentity.set(o.sid,o.identity),this.emitWhenConnected(RoomEvent.ParticipantConnected,e),e.on(ParticipantEvent.TrackPublished,n=>{this.emitWhenConnected(RoomEvent.TrackPublished,n,e)}).on(ParticipantEvent.TrackSubscribed,(n,a)=>{n.kind===Track.Kind.Audio?(n.on(TrackEvent.AudioPlaybackStarted,this.handleAudioPlaybackStarted),n.on(TrackEvent.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):n.kind===Track.Kind.Video&&(n.on(TrackEvent.VideoPlaybackFailed,this.handleVideoPlaybackFailed),n.on(TrackEvent.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(RoomEvent.TrackSubscribed,n,a,e)}).on(ParticipantEvent.TrackUnpublished,n=>{this.emit(RoomEvent.TrackUnpublished,n,e)}).on(ParticipantEvent.TrackUnsubscribed,(n,a)=>{this.emit(RoomEvent.TrackUnsubscribed,n,a,e)}).on(ParticipantEvent.TrackSubscriptionFailed,n=>{this.emit(RoomEvent.TrackSubscriptionFailed,n,e)}).on(ParticipantEvent.TrackMuted,n=>{this.emitWhenConnected(RoomEvent.TrackMuted,n,e)}).on(ParticipantEvent.TrackUnmuted,n=>{this.emitWhenConnected(RoomEvent.TrackUnmuted,n,e)}).on(ParticipantEvent.ParticipantMetadataChanged,n=>{this.emitWhenConnected(RoomEvent.ParticipantMetadataChanged,n,e)}).on(ParticipantEvent.ParticipantNameChanged,n=>{this.emitWhenConnected(RoomEvent.ParticipantNameChanged,n,e)}).on(ParticipantEvent.AttributesChanged,n=>{this.emitWhenConnected(RoomEvent.ParticipantAttributesChanged,n,e)}).on(ParticipantEvent.ConnectionQualityChanged,n=>{this.emitWhenConnected(RoomEvent.ConnectionQualityChanged,n,e)}).on(ParticipantEvent.ParticipantPermissionsChanged,n=>{this.emitWhenConnected(RoomEvent.ParticipantPermissionsChanged,n,e)}).on(ParticipantEvent.TrackSubscriptionStatusChanged,(n,a)=>{this.emitWhenConnected(RoomEvent.TrackSubscriptionStatusChanged,n,a,e)}).on(ParticipantEvent.TrackSubscriptionFailed,(n,a)=>{this.emit(RoomEvent.TrackSubscriptionFailed,n,e,a)}).on(ParticipantEvent.TrackSubscriptionPermissionChanged,(n,a)=>{this.emitWhenConnected(RoomEvent.TrackSubscriptionPermissionChanged,n,a,e)}),o&&e.updateInfo(o),e}sendSyncState(){const t=Array.from(this.remoteParticipants.values()).reduce((e,n)=>(e.push(...n.getTrackPublications()),e),[]),o=this.localParticipant.getTrackPublications();this.engine.sendSyncState(t,o)}updateSubscriptions(){for(const t of this.remoteParticipants.values())for(const o of t.videoTrackPublications.values())o.isSubscribed&&o instanceof RemoteTrackPublication&&o.emitTrackUpdate()}getRemoteParticipantBySid(t){const o=this.sidToIdentity.get(t);if(o)return this.remoteParticipants.get(o)}registerConnectionReconcile(){this.clearConnectionReconcile();let t=0;this.connectionReconcileInterval=CriticalTimers.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(t++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:t,engine:{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}})),t>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,DisconnectReason.STATE_MISMATCH))):t=0},connectionReconcileFrequency)}clearConnectionReconcile(){this.connectionReconcileInterval&&CriticalTimers.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(t){return t===this.state?!1:(this.state=t,this.emit(RoomEvent.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(t=>{let[o,e]=t;this.emit(o,...e)}),this.bufferedEvents=[]}emitWhenConnected(t){for(var o=arguments.length,e=new Array(o>1?o-1:0),n=1;n<o;n++)e[n-1]=arguments[n];if(this.state===ConnectionState.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([t,e]);else if(this.state===ConnectionState.Connected)return this.emit(t,...e);return!1}simulateParticipants(t){return __awaiter(this,void 0,void 0,function*(){var o,e;const n=Object.assign({audio:!0,video:!0,useRealTracks:!1},t.publish),a=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},t.participants);if(this.handleDisconnect(),this.roomInfo=new Room$1({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:protoInt64.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new ParticipantInfo({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(RoomEvent.SignalConnected),this.emit(RoomEvent.Connected),this.setAndEmitConnectionState(ConnectionState.Connected),n.video){const c=new LocalTrackPublication(Track.Kind.Video,new TrackInfo({source:TrackSource.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO,name:"video-dummy"}),new LocalVideoTrack(n.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:createDummyVideoStreamTrack(160*((o=a.aspectRatios[0])!==null&&o!==void 0?o:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(c),this.localParticipant.emit(ParticipantEvent.LocalTrackPublished,c)}if(n.audio){const c=new LocalTrackPublication(Track.Kind.Audio,new TrackInfo({source:TrackSource.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO}),new LocalAudioTrack(n.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:getEmptyAudioStreamTrack(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(c),this.localParticipant.emit(ParticipantEvent.LocalTrackPublished,c)}for(let c=0;c<a.count-1;c+=1){let l=new ParticipantInfo({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(c),state:ParticipantInfo_State.ACTIVE,tracks:[],joinedAt:protoInt64.parse(Date.now())});const u=this.getOrCreateParticipant(l.identity,l);if(a.video){const d=createDummyVideoStreamTrack(160*((e=a.aspectRatios[c%a.aspectRatios.length])!==null&&e!==void 0?e:1),160,!1,!0),p=new TrackInfo({source:TrackSource.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO});u.addSubscribedMediaTrack(d,p.sid,new MediaStream([d]),new RTCRtpReceiver),l.tracks=[...l.tracks,p]}if(a.audio){const d=getEmptyAudioStreamTrack(),p=new TrackInfo({source:TrackSource.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO});u.addSubscribedMediaTrack(d,p.sid,new MediaStream([d]),new RTCRtpReceiver),l.tracks=[...l.tracks,p]}u.updateInfo(l)}})}emit(t){for(var o=arguments.length,e=new Array(o>1?o-1:0),n=1;n<o;n++)e[n-1]=arguments[n];if(t!==RoomEvent.ActiveSpeakersChanged){const a=mapArgs(e).filter(c=>c!==void 0);this.log.debug("room event ".concat(t),Object.assign(Object.assign({},this.logContext),{event:t,args:a}))}return super.emit(t,...e)}}function mapArgs(s){return s.map(t=>{if(t)return Array.isArray(t)?mapArgs(t):typeof t=="object"?"logContext"in t&&t.logContext:t})}var CheckStatus;(function(s){s[s.IDLE=0]="IDLE",s[s.RUNNING=1]="RUNNING",s[s.SKIPPED=2]="SKIPPED",s[s.SUCCESS=3]="SUCCESS",s[s.FAILED=4]="FAILED"})(CheckStatus||(CheckStatus={}));class Checker extends eventsExports.EventEmitter{constructor(t,o){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=CheckStatus.IDLE,this.logs=[],this.errorsAsWarnings=!1,this.url=t,this.token=o,this.name=this.constructor.name,this.room=new Room(e.roomOptions),this.connectOptions=e.connectOptions,e.errorsAsWarnings&&(this.errorsAsWarnings=e.errorsAsWarnings)}run(t){return __awaiter(this,void 0,void 0,function*(){if(this.status!==CheckStatus.IDLE)throw Error("check is running already");this.setStatus(CheckStatus.RUNNING);try{yield this.perform()}catch(o){o instanceof Error&&(this.errorsAsWarnings?this.appendWarning(o.message):this.appendError(o.message))}return yield this.disconnect(),yield new Promise(o=>setTimeout(o,500)),this.status!==CheckStatus.SKIPPED&&this.setStatus(this.isSuccess()?CheckStatus.SUCCESS:CheckStatus.FAILED),t&&t(),this.getInfo()})}isSuccess(){return!this.logs.some(t=>t.level==="error")}connect(){return __awaiter(this,void 0,void 0,function*(){return this.room.state===ConnectionState.Connected?this.room:(yield this.room.connect(this.url,this.token),this.room)})}disconnect(){return __awaiter(this,void 0,void 0,function*(){this.room&&this.room.state!==ConnectionState.Disconnected&&(yield this.room.disconnect(),yield new Promise(t=>setTimeout(t,500)))})}skip(){this.setStatus(CheckStatus.SKIPPED)}appendMessage(t){this.logs.push({level:"info",message:t}),this.emit("update",this.getInfo())}appendWarning(t){this.logs.push({level:"warning",message:t}),this.emit("update",this.getInfo())}appendError(t){this.logs.push({level:"error",message:t}),this.emit("update",this.getInfo())}setStatus(t){this.status=t,this.emit("update",this.getInfo())}get engine(){var t;return(t=this.room)===null||t===void 0?void 0:t.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}function createLocalTracks(s){return __awaiter(this,void 0,void 0,function*(){var t,o;s??(s={}),(t=s.audio)!==null&&t!==void 0||(s.audio=!0),(o=s.video)!==null&&o!==void 0||(s.video=!0);const e=mergeDefaultOptions(s,audioDefaults,videoDefaults),n=constraintsForOptions(e),a=navigator.mediaDevices.getUserMedia(n);s.audio&&(DeviceManager.userMediaPromiseMap.set("audioinput",a),a.catch(()=>DeviceManager.userMediaPromiseMap.delete("audioinput"))),s.video&&(DeviceManager.userMediaPromiseMap.set("videoinput",a),a.catch(()=>DeviceManager.userMediaPromiseMap.delete("videoinput")));const c=yield a;return Promise.all(c.getTracks().map(l=>__awaiter(this,void 0,void 0,function*(){const u=l.kind==="audio";let d=u?s.audio:s.video;(typeof d=="boolean"||!d)&&(d={});let p;const g=u?n.audio:n.video;typeof g!="boolean"&&(p=g),p?p.deviceId=l.getSettings().deviceId:p={deviceId:l.getSettings().deviceId};const S=mediaTrackToLocalTrack(l,p);return S.kind===Track.Kind.Video?S.source=Track.Source.Camera:S.kind===Track.Kind.Audio&&(S.source=Track.Source.Microphone),S.mediaStream=c,d.processor&&(S instanceof LocalAudioTrack?yield S.setProcessor(d.processor):S instanceof LocalVideoTrack&&(yield S.setProcessor(d.processor))),S})))})}function createLocalVideoTrack(s){return __awaiter(this,void 0,void 0,function*(){return(yield createLocalTracks({audio:!1,video:s}))[0]})}function createLocalAudioTrack(s){return __awaiter(this,void 0,void 0,function*(){return(yield createLocalTracks({audio:s,video:!1}))[0]})}class PublishAudioCheck extends Checker{get description(){return"Can publish audio"}perform(){return __awaiter(this,void 0,void 0,function*(){var t;const o=yield this.connect(),e=yield createLocalAudioTrack();o.localParticipant.publishTrack(e),yield new Promise(c=>setTimeout(c,3e3));const n=yield(t=e.sender)===null||t===void 0?void 0:t.getStats();if(!n)throw new Error("Could not get RTCStats");let a=0;if(n.forEach(c=>{c.type==="outbound-rtp"&&(c.kind==="audio"||!c.kind&&c.mediaType==="audio")&&(a=c.packetsSent)}),a===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(a," audio packets"))})}}class PublishVideoCheck extends Checker{get description(){return"Can publish video"}perform(){return __awaiter(this,void 0,void 0,function*(){var t;const o=yield this.connect(),e=yield createLocalVideoTrack();o.localParticipant.publishTrack(e),yield new Promise(c=>setTimeout(c,5e3));const n=yield(t=e.sender)===null||t===void 0?void 0:t.getStats();if(!n)throw new Error("Could not get RTCStats");let a=0;if(n.forEach(c=>{c.type==="outbound-rtp"&&(c.kind==="video"||!c.kind&&c.mediaType==="video")&&(a+=c.packetsSent)}),a===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(a," video packets"))})}}class ReconnectCheck extends Checker{get description(){return"Resuming connection after interruption"}perform(){return __awaiter(this,void 0,void 0,function*(){var t;const o=yield this.connect();let e=!1,n=!1,a;const c=new Promise(d=>{setTimeout(d,5e3),a=d}),l=()=>{e=!0};o.on(RoomEvent.SignalReconnecting,l).on(RoomEvent.Reconnecting,l).on(RoomEvent.Reconnected,()=>{n=!0,a(!0)}),(t=o.engine.client.ws)===null||t===void 0||t.close();const u=o.engine.client.onClose;if(u&&u(""),yield c,e){if(!n||o.state!==ConnectionState.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class TURNCheck extends Checker{get description(){return"Can connect via TURN"}perform(){return __awaiter(this,void 0,void 0,function*(){var t,o;const e=new SignalClient,n=yield e.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let a=!1,c=!1,l=!1;for(let u of n.iceServers)for(let d of u.urls)d.startsWith("turn:")?(c=!0,l=!0):d.startsWith("turns:")&&(c=!0,l=!0,a=!0),d.startsWith("stun:")&&(l=!0);l?c&&!a&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield e.close(),!((o=(t=this.connectOptions)===null||t===void 0?void 0:t.rtcConfig)===null||o===void 0)&&o.iceServers||c?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(u=>setTimeout(u,0)))})}}class WebRTCCheck extends Checker{get description(){return"Establishing WebRTC connection"}perform(){return __awaiter(this,void 0,void 0,function*(){let t=!1,o=!1;this.room.on(RoomEvent.SignalConnected,()=>{const e=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(n,a)=>{if(n.candidate){const c=new RTCIceCandidate(n);let l="".concat(c.protocol," ").concat(c.address,":").concat(c.port," ").concat(c.type);c.address&&(isIPPrivate(c.address)?l+=" (private)":c.protocol==="tcp"&&c.tcpType==="passive"?(t=!0,l+=" (passive)"):c.protocol==="udp"&&(o=!0)),this.appendMessage(l)}e&&e(n,a)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=n=>{n instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(n.errorCode," ").concat(n.errorText," ").concat(n.url))})});try{yield this.connect(),livekitLogger.info("now the room is connected")}catch(e){throw this.appendWarning("ports need to be open on firewall in order to connect."),e}t||this.appendWarning("Server is not configured for ICE/TCP"),o||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function isIPPrivate(s){const t=s.split(".");if(t.length===4){if(t[0]==="10")return!0;if(t[0]==="192"&&t[1]==="168")return!0;if(t[0]==="172"){const o=parseInt(t[1],10);if(o>=16&&o<=31)return!0}}return!1}class WebSocketCheck extends Checker{get description(){return"Connecting to signal connection via WebSocket"}perform(){return __awaiter(this,void 0,void 0,function*(){var t,o,e;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let n=new SignalClient;const a=yield n.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(a.serverVersion,".")),((t=a.serverInfo)===null||t===void 0?void 0:t.edition)===ServerInfo_Edition.Cloud&&(!((o=a.serverInfo)===null||o===void 0)&&o.region)&&this.appendMessage("LiveKit Cloud: ".concat((e=a.serverInfo)===null||e===void 0?void 0:e.region)),yield n.close()})}}class ConnectionCheck extends eventsExports.EventEmitter{constructor(t,o){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=t,this.token=o,this.options=e}getNextCheckId(){const t=this.checkResults.size;return this.checkResults.set(t,{logs:[],status:CheckStatus.IDLE,name:"",description:""}),t}updateCheck(t,o){this.checkResults.set(t,o),this.emit("checkUpdate",t,o)}isSuccess(){return Array.from(this.checkResults.values()).every(t=>t.status!==CheckStatus.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(t){return __awaiter(this,void 0,void 0,function*(){const o=this.getNextCheckId(),e=new t(this.url,this.token,this.options),n=c=>{this.updateCheck(o,c)};e.on("update",n);const a=yield e.run();return e.off("update",n),a})}checkWebsocket(){return __awaiter(this,void 0,void 0,function*(){return this.createAndRunCheck(WebSocketCheck)})}checkWebRTC(){return __awaiter(this,void 0,void 0,function*(){return this.createAndRunCheck(WebRTCCheck)})}checkTURN(){return __awaiter(this,void 0,void 0,function*(){return this.createAndRunCheck(TURNCheck)})}checkReconnect(){return __awaiter(this,void 0,void 0,function*(){return this.createAndRunCheck(ReconnectCheck)})}checkPublishAudio(){return __awaiter(this,void 0,void 0,function*(){return this.createAndRunCheck(PublishAudioCheck)})}checkPublishVideo(){return __awaiter(this,void 0,void 0,function*(){return this.createAndRunCheck(PublishVideoCheck)})}}var MavAutopilot=(s=>(s.MAV_AUTOPILOT_GENERIC="MAV_AUTOPILOT_GENERIC",s.MAV_AUTOPILOT_RESERVED="MAV_AUTOPILOT_RESERVED",s.MAV_AUTOPILOT_SLUGS="MAV_AUTOPILOT_SLUGS",s.MAV_AUTOPILOT_ARDUPILOTMEGA="MAV_AUTOPILOT_ARDUPILOTMEGA",s.MAV_AUTOPILOT_OPENPILOT="MAV_AUTOPILOT_OPENPILOT",s.MAV_AUTOPILOT_GENERIC_WAYPOINTS_ONLY="MAV_AUTOPILOT_GENERIC_WAYPOINTS_ONLY",s.MAV_AUTOPILOT_GENERIC_WAYPOINTS_AND_SIMPLE_NAVIGATION_ONLY="MAV_AUTOPILOT_GENERIC_WAYPOINTS_AND_SIMPLE_NAVIGATION_ONLY",s.MAV_AUTOPILOT_GENERIC_MISSION_FULL="MAV_AUTOPILOT_GENERIC_MISSION_FULL",s.MAV_AUTOPILOT_INVALID="MAV_AUTOPILOT_INVALID",s.MAV_AUTOPILOT_PPZ="MAV_AUTOPILOT_PPZ",s.MAV_AUTOPILOT_UDB="MAV_AUTOPILOT_UDB",s.MAV_AUTOPILOT_FP="MAV_AUTOPILOT_FP",s.MAV_AUTOPILOT_PX4="MAV_AUTOPILOT_PX4",s.MAV_AUTOPILOT_SMACCMPILOT="MAV_AUTOPILOT_SMACCMPILOT",s.MAV_AUTOPILOT_AUTOQUAD="MAV_AUTOPILOT_AUTOQUAD",s.MAV_AUTOPILOT_ARMAZILA="MAV_AUTOPILOT_ARMAZILA",s.MAV_AUTOPILOT_AEROB="MAV_AUTOPILOT_AEROB",s.MAV_AUTOPILOT_ASLUAV="MAV_AUTOPILOT_ASLUAV",s.MAV_AUTOPILOT_SMARTAP="MAV_AUTOPILOT_SMARTAP",s.MAV_AUTOPILOT_AIRRAILS="MAV_AUTOPILOT_AIRRAILS",s))(MavAutopilot||{}),MavType=(s=>(s.MAV_TYPE_GENERIC="MAV_TYPE_GENERIC",s.MAV_TYPE_FIXED_WING="MAV_TYPE_FIXED_WING",s.MAV_TYPE_QUADROTOR="MAV_TYPE_QUADROTOR",s.MAV_TYPE_COAXIAL="MAV_TYPE_COAXIAL",s.MAV_TYPE_HELICOPTER="MAV_TYPE_HELICOPTER",s.MAV_TYPE_ANTENNA_TRACKER="MAV_TYPE_ANTENNA_TRACKER",s.MAV_TYPE_GCS="MAV_TYPE_GCS",s.MAV_TYPE_AIRSHIP="MAV_TYPE_AIRSHIP",s.MAV_TYPE_FREE_BALLOON="MAV_TYPE_FREE_BALLOON",s.MAV_TYPE_ROCKET="MAV_TYPE_ROCKET",s.MAV_TYPE_GROUND_ROVER="MAV_TYPE_GROUND_ROVER",s.MAV_TYPE_SURFACE_BOAT="MAV_TYPE_SURFACE_BOAT",s.MAV_TYPE_SUBMARINE="MAV_TYPE_SUBMARINE",s.MAV_TYPE_HEXAROTOR="MAV_TYPE_HEXAROTOR",s.MAV_TYPE_OCTOROTOR="MAV_TYPE_OCTOROTOR",s.MAV_TYPE_TRICOPTER="MAV_TYPE_TRICOPTER",s.MAV_TYPE_FLAPPING_WING="MAV_TYPE_FLAPPING_WING",s.MAV_TYPE_KITE="MAV_TYPE_KITE",s.MAV_TYPE_ONBOARD_CONTROLLER="MAV_TYPE_ONBOARD_CONTROLLER",s.MAV_TYPE_VTOL_DUOROTOR="MAV_TYPE_VTOL_DUOROTOR",s.MAV_TYPE_VTOL_QUADROTOR="MAV_TYPE_VTOL_QUADROTOR",s.MAV_TYPE_VTOL_TILTROTOR="MAV_TYPE_VTOL_TILTROTOR",s.MAV_TYPE_VTOL_RESERVED2="MAV_TYPE_VTOL_RESERVED2",s.MAV_TYPE_VTOL_RESERVED3="MAV_TYPE_VTOL_RESERVED3",s.MAV_TYPE_VTOL_RESERVED4="MAV_TYPE_VTOL_RESERVED4",s.MAV_TYPE_VTOL_RESERVED5="MAV_TYPE_VTOL_RESERVED5",s.MAV_TYPE_GIMBAL="MAV_TYPE_GIMBAL",s.MAV_TYPE_ADSB="MAV_TYPE_ADSB",s.MAV_TYPE_PARAFOIL="MAV_TYPE_PARAFOIL",s.MAV_TYPE_DODECAROTOR="MAV_TYPE_DODECAROTOR",s.MAV_TYPE_CAMERA="MAV_TYPE_CAMERA",s.MAV_TYPE_CHARGING_STATION="MAV_TYPE_CHARGING_STATION",s.MAV_TYPE_FLARM="MAV_TYPE_FLARM",s.MAV_TYPE_SERVO="MAV_TYPE_SERVO",s.MAV_TYPE_ODID="MAV_TYPE_ODID",s))(MavType||{}),MavModeFlag=(s=>(s[s.MAV_MODE_FLAG_SAFETY_ARMED=128]="MAV_MODE_FLAG_SAFETY_ARMED",s[s.MAV_MODE_FLAG_MANUAL_INPUT_ENABLED=64]="MAV_MODE_FLAG_MANUAL_INPUT_ENABLED",s[s.MAV_MODE_FLAG_HIL_ENABLED=32]="MAV_MODE_FLAG_HIL_ENABLED",s[s.MAV_MODE_FLAG_STABILIZE_ENABLED=16]="MAV_MODE_FLAG_STABILIZE_ENABLED",s[s.MAV_MODE_FLAG_GUIDED_ENABLED=8]="MAV_MODE_FLAG_GUIDED_ENABLED",s[s.MAV_MODE_FLAG_AUTO_ENABLED=4]="MAV_MODE_FLAG_AUTO_ENABLED",s[s.MAV_MODE_FLAG_TEST_ENABLED=2]="MAV_MODE_FLAG_TEST_ENABLED",s[s.MAV_MODE_FLAG_CUSTOM_MODE_ENABLED=1]="MAV_MODE_FLAG_CUSTOM_MODE_ENABLED",s))(MavModeFlag||{}),MavState=(s=>(s.MAV_STATE_UNINIT="MAV_STATE_UNINIT",s.MAV_STATE_BOOT="MAV_STATE_BOOT",s.MAV_STATE_CALIBRATING="MAV_STATE_CALIBRATING",s.MAV_STATE_STANDBY="MAV_STATE_STANDBY",s.MAV_STATE_ACTIVE="MAV_STATE_ACTIVE",s.MAV_STATE_CRITICAL="MAV_STATE_CRITICAL",s.MAV_STATE_EMERGENCY="MAV_STATE_EMERGENCY",s.MAV_STATE_POWEROFF="MAV_STATE_POWEROFF",s.MAV_STATE_FLIGHT_TERMINATION="MAV_STATE_FLIGHT_TERMINATION",s))(MavState||{}),MAVLinkType=(s=>(s.ACTUATOR_CONTROL_TARGET="ACTUATOR_CONTROL_TARGET",s.ACTUATOR_OUTPUT_STATUS="ACTUATOR_OUTPUT_STATUS",s.ADAP_TUNING="ADAP_TUNING",s.ADSB_VEHICLE="ADSB_VEHICLE",s.AHRS="AHRS",s.AHRS2="AHRS2",s.AHRS3="AHRS3",s.AIRSPEED_AUTOCAL="AIRSPEED_AUTOCAL",s.AIS_VESSEL="AIS_VESSEL",s.ALTITUDE="ALTITUDE",s.AOA_SSA="AOA_SSA",s.AP_ADC="AP_ADC",s.ATT_POS_MOCAP="ATT_POS_MOCAP",s.ATTITUDE="ATTITUDE",s.ATTITUDE_QUATERNION="ATTITUDE_QUATERNION",s.ATTITUDE_QUATERNION_COV="ATTITUDE_QUATERNION_COV",s.ATTITUDE_TARGET="ATTITUDE_TARGET",s.AUTH_KEY="AUTH_KEY",s.AUTOPILOT_STATE_FOR_GIMBAL_DEVICE="AUTOPILOT_STATE_FOR_GIMBAL_DEVICE",s.AUTOPILOT_VERSION="AUTOPILOT_VERSION",s.AUTOPILOT_VERSION_REQUEST="AUTOPILOT_VERSION_REQUEST",s.BATTERY_STATUS="BATTERY_STATUS",s.BATTERY2="BATTERY2",s.BUTTON_CHANGE="BUTTON_CHANGE",s.CAMERA_CAPTURE_STATUS="CAMERA_CAPTURE_STATUS",s.CAMERA_FEEDBACK="CAMERA_FEEDBACK",s.CAMERA_IMAGE_CAPTURED="CAMERA_IMAGE_CAPTURED",s.CAMERA_INFORMATION="CAMERA_INFORMATION",s.CAMERA_SETTINGS="CAMERA_SETTINGS",s.CAMERA_STATUS="CAMERA_STATUS",s.CAMERA_TRIGGER="CAMERA_TRIGGER",s.CELLULAR_CONFIG="CELLULAR_CONFIG",s.CELLULAR_STATUS="CELLULAR_STATUS",s.CHANGE_OPERATOR_CONTROL="CHANGE_OPERATOR_CONTROL",s.CHANGE_OPERATOR_CONTROL_ACK="CHANGE_OPERATOR_CONTROL_ACK",s.COLLISION="COLLISION",s.COMMAND_ACK="COMMAND_ACK",s.COMMAND_CANCEL="COMMAND_CANCEL",s.COMMAND_INT="COMMAND_INT",s.COMMAND_LONG="COMMAND_LONG",s.COMPASSMOT_STATUS="COMPASSMOT_STATUS",s.COMPONENT_INFORMATION="COMPONENT_INFORMATION",s.CONTROL_SYSTEM_STATE="CONTROL_SYSTEM_STATE",s.DATA_STREAM="DATA_STREAM",s.DATA_TRANSMISSION_HANDSHAKE="DATA_TRANSMISSION_HANDSHAKE",s.DATA16="DATA16",s.DATA32="DATA32",s.DATA64="DATA64",s.DATA96="DATA96",s.DEBUG="DEBUG",s.DEBUG_FLOAT_ARRAY="DEBUG_FLOAT_ARRAY",s.DEBUG_VECT="DEBUG_VECT",s.DEEPSTALL="DEEPSTALL",s.DEVICE_OP_READ="DEVICE_OP_READ",s.DEVICE_OP_READ_REPLY="DEVICE_OP_READ_REPLY",s.DEVICE_OP_WRITE="DEVICE_OP_WRITE",s.DEVICE_OP_WRITE_REPLY="DEVICE_OP_WRITE_REPLY",s.DIGICAM_CONFIGURE="DIGICAM_CONFIGURE",s.DIGICAM_CONTROL="DIGICAM_CONTROL",s.DISTANCE_SENSOR="DISTANCE_SENSOR",s.EFI_STATUS="EFI_STATUS",s.EKF_STATUS_REPORT="EKF_STATUS_REPORT",s.ENCAPSULATED_DATA="ENCAPSULATED_DATA",s.ESC_TELEMETRY_1_TO_4="ESC_TELEMETRY_1_TO_4",s.ESC_TELEMETRY_5_TO_8="ESC_TELEMETRY_5_TO_8",s.ESC_TELEMETRY_9_TO_12="ESC_TELEMETRY_9_TO_12",s.ESTIMATOR_STATUS="ESTIMATOR_STATUS",s.EXTENDED_SYS_STATE="EXTENDED_SYS_STATE",s.FENCE_FETCH_POINT="FENCE_FETCH_POINT",s.FENCE_POINT="FENCE_POINT",s.FENCE_STATUS="FENCE_STATUS",s.FILE_TRANSFER_PROTOCOL="FILE_TRANSFER_PROTOCOL",s.FLIGHT_INFORMATION="FLIGHT_INFORMATION",s.FOLLOW_TARGET="FOLLOW_TARGET",s.GENERATOR_STATUS="GENERATOR_STATUS",s.GIMBAL_CONTROL="GIMBAL_CONTROL",s.GIMBAL_DEVICE_ATTITUDE_STATUS="GIMBAL_DEVICE_ATTITUDE_STATUS",s.GIMBAL_DEVICE_INFORMATION="GIMBAL_DEVICE_INFORMATION",s.GIMBAL_DEVICE_SET_ATTITUDE="GIMBAL_DEVICE_SET_ATTITUDE",s.GIMBAL_MANAGER_INFORMATION="GIMBAL_MANAGER_INFORMATION",s.GIMBAL_MANAGER_SET_ATTITUDE="GIMBAL_MANAGER_SET_ATTITUDE",s.GIMBAL_MANAGER_SET_TILTPAN="GIMBAL_MANAGER_SET_TILTPAN",s.GIMBAL_MANAGER_STATUS="GIMBAL_MANAGER_STATUS",s.GIMBAL_REPORT="GIMBAL_REPORT",s.GIMBAL_TORQUE_CMD_REPORT="GIMBAL_TORQUE_CMD_REPORT",s.GLOBAL_POSITION_INT="GLOBAL_POSITION_INT",s.GLOBAL_POSITION_INT_COV="GLOBAL_POSITION_INT_COV",s.GLOBAL_VISION_POSITION_ESTIMATE="GLOBAL_VISION_POSITION_ESTIMATE",s.GOPRO_GET_REQUEST="GOPRO_GET_REQUEST",s.GOPRO_GET_RESPONSE="GOPRO_GET_RESPONSE",s.GOPRO_HEARTBEAT="GOPRO_HEARTBEAT",s.GOPRO_SET_REQUEST="GOPRO_SET_REQUEST",s.GOPRO_SET_RESPONSE="GOPRO_SET_RESPONSE",s.GPS_GLOBAL_ORIGIN="GPS_GLOBAL_ORIGIN",s.GPS_INJECT_DATA="GPS_INJECT_DATA",s.GPS_INPUT="GPS_INPUT",s.GPS_RAW_INT="GPS_RAW_INT",s.GPS_RTCM_DATA="GPS_RTCM_DATA",s.GPS_RTK="GPS_RTK",s.GPS_STATUS="GPS_STATUS",s.GPS2_RAW="GPS2_RAW",s.GPS2_RTK="GPS2_RTK",s.HEARTBEAT="HEARTBEAT",s.HIGH_LATENCY="HIGH_LATENCY",s.HIGH_LATENCY2="HIGH_LATENCY2",s.HIGHRES_IMU="HIGHRES_IMU",s.HIL_ACTUATOR_CONTROLS="HIL_ACTUATOR_CONTROLS",s.HIL_CONTROLS="HIL_CONTROLS",s.HIL_GPS="HIL_GPS",s.HIL_OPTICAL_FLOW="HIL_OPTICAL_FLOW",s.HIL_RC_INPUTS_RAW="HIL_RC_INPUTS_RAW",s.HIL_SENSOR="HIL_SENSOR",s.HIL_STATE="HIL_STATE",s.HIL_STATE_QUATERNION="HIL_STATE_QUATERNION",s.HOME_POSITION="HOME_POSITION",s.HWSTATUS="HWSTATUS",s.ISBD_LINK_STATUS="ISBD_LINK_STATUS",s.LANDING_TARGET="LANDING_TARGET",s.LED_CONTROL="LED_CONTROL",s.LIMITS_STATUS="LIMITS_STATUS",s.LINK_NODE_STATUS="LINK_NODE_STATUS",s.LOCAL_POSITION_NED="LOCAL_POSITION_NED",s.LOCAL_POSITION_NED_COV="LOCAL_POSITION_NED_COV",s.LOCAL_POSITION_NED_SYSTEM_GLOBAL_OFFSET="LOCAL_POSITION_NED_SYSTEM_GLOBAL_OFFSET",s.LOG_DATA="LOG_DATA",s.LOG_ENTRY="LOG_ENTRY",s.LOG_ERASE="LOG_ERASE",s.LOG_REQUEST_DATA="LOG_REQUEST_DATA",s.LOG_REQUEST_END="LOG_REQUEST_END",s.LOG_REQUEST_LIST="LOG_REQUEST_LIST",s.LOGGING_ACK="LOGGING_ACK",s.LOGGING_DATA="LOGGING_DATA",s.LOGGING_DATA_ACKED="LOGGING_DATA_ACKED",s.MAG_CAL_PROGRESS="MAG_CAL_PROGRESS",s.MAG_CAL_REPORT="MAG_CAL_REPORT",s.MANUAL_CONTROL="MANUAL_CONTROL",s.MANUAL_SETPOINT="MANUAL_SETPOINT",s.MEMINFO="MEMINFO",s.MEMORY_VECT="MEMORY_VECT",s.MESSAGE_INTERVAL="MESSAGE_INTERVAL",s.MISSION_ACK="MISSION_ACK",s.MISSION_CHANGED="MISSION_CHANGED",s.MISSION_CLEAR_ALL="MISSION_CLEAR_ALL",s.MISSION_COUNT="MISSION_COUNT",s.MISSION_CURRENT="MISSION_CURRENT",s.MISSION_ITEM="MISSION_ITEM",s.MISSION_ITEM_INT="MISSION_ITEM_INT",s.MISSION_ITEM_REACHED="MISSION_ITEM_REACHED",s.MISSION_REQUEST="MISSION_REQUEST",s.MISSION_REQUEST_INT="MISSION_REQUEST_INT",s.MISSION_REQUEST_LIST="MISSION_REQUEST_LIST",s.MISSION_REQUEST_PARTIAL_LIST="MISSION_REQUEST_PARTIAL_LIST",s.MISSION_SET_CURRENT="MISSION_SET_CURRENT",s.MISSION_WRITE_PARTIAL_LIST="MISSION_WRITE_PARTIAL_LIST",s.MOUNT_CONFIGURE="MOUNT_CONFIGURE",s.MOUNT_CONTROL="MOUNT_CONTROL",s.MOUNT_ORIENTATION="MOUNT_ORIENTATION",s.MOUNT_STATUS="MOUNT_STATUS",s.NAMED_VALUE_FLOAT="NAMED_VALUE_FLOAT",s.NAMED_VALUE_INT="NAMED_VALUE_INT",s.NAV_CONTROLLER_OUTPUT="NAV_CONTROLLER_OUTPUT",s.OBSTACLE_DISTANCE="OBSTACLE_DISTANCE",s.ODOMETRY="ODOMETRY",s.ONBOARD_COMPUTER_STATUS="ONBOARD_COMPUTER_STATUS",s.OPEN_DRONE_ID_AUTHENTICATION="OPEN_DRONE_ID_AUTHENTICATION",s.OPEN_DRONE_ID_BASIC_ID="OPEN_DRONE_ID_BASIC_ID",s.OPEN_DRONE_ID_LOCATION="OPEN_DRONE_ID_LOCATION",s.OPEN_DRONE_ID_MESSAGE_PACK="OPEN_DRONE_ID_MESSAGE_PACK",s.OPEN_DRONE_ID_OPERATOR_ID="OPEN_DRONE_ID_OPERATOR_ID",s.OPEN_DRONE_ID_SELF_ID="OPEN_DRONE_ID_SELF_ID",s.OPEN_DRONE_ID_SYSTEM="OPEN_DRONE_ID_SYSTEM",s.OPTICAL_FLOW="OPTICAL_FLOW",s.OPTICAL_FLOW_RAD="OPTICAL_FLOW_RAD",s.ORBIT_EXECUTION_STATUS="ORBIT_EXECUTION_STATUS",s.PARAM_EXT_ACK="PARAM_EXT_ACK",s.PARAM_EXT_REQUEST_LIST="PARAM_EXT_REQUEST_LIST",s.PARAM_EXT_REQUEST_READ="PARAM_EXT_REQUEST_READ",s.PARAM_EXT_SET="PARAM_EXT_SET",s.PARAM_EXT_VALUE="PARAM_EXT_VALUE",s.PARAM_MAP_RC="PARAM_MAP_RC",s.PARAM_REQUEST_LIST="PARAM_REQUEST_LIST",s.PARAM_REQUEST_READ="PARAM_REQUEST_READ",s.PARAM_SET="PARAM_SET",s.PARAM_VALUE="PARAM_VALUE",s.PID_TUNING="PID_TUNING",s.PING="PING",s.PLAY_TUNE="PLAY_TUNE",s.PLAY_TUNE_V2="PLAY_TUNE_V2",s.POSITION_TARGET_GLOBAL_INT="POSITION_TARGET_GLOBAL_INT",s.POSITION_TARGET_LOCAL_NED="POSITION_TARGET_LOCAL_NED",s.POWER_STATUS="POWER_STATUS",s.PROTOCOL_VERSION="PROTOCOL_VERSION",s.RADIO="RADIO",s.RADIO_STATUS="RADIO_STATUS",s.RALLY_FETCH_POINT="RALLY_FETCH_POINT",s.RALLY_POINT="RALLY_POINT",s.RANGEFINDER="RANGEFINDER",s.RAW_IMU="RAW_IMU",s.RAW_PRESSURE="RAW_PRESSURE",s.RAW_RPM="RAW_RPM",s.RC_CHANNELS="RC_CHANNELS",s.RC_CHANNELS_OVERRIDE="RC_CHANNELS_OVERRIDE",s.RC_CHANNELS_RAW="RC_CHANNELS_RAW",s.RC_CHANNELS_SCALED="RC_CHANNELS_SCALED",s.REMOTE_LOG_BLOCK_STATUS="REMOTE_LOG_BLOCK_STATUS",s.REMOTE_LOG_DATA_BLOCK="REMOTE_LOG_DATA_BLOCK",s.REQUEST_DATA_STREAM="REQUEST_DATA_STREAM",s.RESOURCE_REQUEST="RESOURCE_REQUEST",s.RPM="RPM",s.SAFETY_ALLOWED_AREA="SAFETY_ALLOWED_AREA",s.SAFETY_SET_ALLOWED_AREA="SAFETY_SET_ALLOWED_AREA",s.SCALED_IMU="SCALED_IMU",s.SCALED_IMU2="SCALED_IMU2",s.SCALED_IMU3="SCALED_IMU3",s.SCALED_PRESSURE="SCALED_PRESSURE",s.SCALED_PRESSURE2="SCALED_PRESSURE2",s.SCALED_PRESSURE3="SCALED_PRESSURE3",s.SENSOR_OFFSETS="SENSOR_OFFSETS",s.SERIAL_CONTROL="SERIAL_CONTROL",s.SERVO_OUTPUT_RAW="SERVO_OUTPUT_RAW",s.SET_ACTUATOR_CONTROL_TARGET="SET_ACTUATOR_CONTROL_TARGET",s.SET_ATTITUDE_TARGET="SET_ATTITUDE_TARGET",s.SET_GPS_GLOBAL_ORIGIN="SET_GPS_GLOBAL_ORIGIN",s.SET_HOME_POSITION="SET_HOME_POSITION",s.SET_MAG_OFFSETS="SET_MAG_OFFSETS",s.SET_MODE="SET_MODE",s.SET_POSITION_TARGET_GLOBAL_INT="SET_POSITION_TARGET_GLOBAL_INT",s.SET_POSITION_TARGET_LOCAL_NED="SET_POSITION_TARGET_LOCAL_NED",s.SETUP_SIGNING="SETUP_SIGNING",s.SIM_STATE="SIM_STATE",s.SIMSTATE="SIMSTATE",s.SMART_BATTERY_INFO="SMART_BATTERY_INFO",s.SMART_BATTERY_STATUS="SMART_BATTERY_STATUS",s.STATUSTEXT="STATUSTEXT",s.STORAGE_INFORMATION="STORAGE_INFORMATION",s.SUPPORTED_TUNES="SUPPORTED_TUNES",s.SYS_STATUS="SYS_STATUS",s.SYSTEM_TIME="SYSTEM_TIME",s.TERRAIN_CHECK="TERRAIN_CHECK",s.TERRAIN_DATA="TERRAIN_DATA",s.TERRAIN_REPORT="TERRAIN_REPORT",s.TERRAIN_REQUEST="TERRAIN_REQUEST",s.TIME_ESTIMATE_TO_TARGET="TIME_ESTIMATE_TO_TARGET",s.TIMESYNC="TIMESYNC",s.TRAJECTORY_REPRESENTATION_BEZIER="TRAJECTORY_REPRESENTATION_BEZIER",s.TRAJECTORY_REPRESENTATION_WAYPOINTS="TRAJECTORY_REPRESENTATION_WAYPOINTS",s.TUNNEL="TUNNEL",s.UAVCAN_NODE_INFO="UAVCAN_NODE_INFO",s.UAVCAN_NODE_STATUS="UAVCAN_NODE_STATUS",s.UTM_GLOBAL_POSITION="UTM_GLOBAL_POSITION",s.V2_EXTENSION="V2_EXTENSION",s.VFR_HUD="VFR_HUD",s.VIBRATION="VIBRATION",s.VICON_POSITION_ESTIMATE="VICON_POSITION_ESTIMATE",s.VIDEO_STREAM_INFORMATION="VIDEO_STREAM_INFORMATION",s.VIDEO_STREAM_STATUS="VIDEO_STREAM_STATUS",s.VISION_POSITION_DELTA="VISION_POSITION_DELTA",s.VISION_POSITION_ESTIMATE="VISION_POSITION_ESTIMATE",s.VISION_SPEED_ESTIMATE="VISION_SPEED_ESTIMATE",s.WHEEL_DISTANCE="WHEEL_DISTANCE",s.WIFI_CONFIG_AP="WIFI_CONFIG_AP",s.WIND="WIND",s.WIND_COV="WIND_COV",s))(MAVLinkType||{}),ConnectionStates=(s=>(s.init="Init",s.connecting="Connecting",s.connected="Connected",s.reconnecting="Reconnecting",s.disconnectedOk="Disconnected",s.failed="Failed",s))(ConnectionStates||{});const TE=new TextEncoder,ENCODE_TXT=s=>TE.encode(s),TD=new TextDecoder,DECODE_TXT=s=>TD.decode(s),SECONDS_IN_DAY=60*60*24,FRONTEND_HANDLED_MAVLINK_MESSAGE_TYPES=[MAVLinkType.HEARTBEAT,MAVLinkType.ATTITUDE,MAVLinkType.SYS_STATUS,MAVLinkType.STATUSTEXT,MAVLinkType.SCALED_PRESSURE,MAVLinkType.SCALED_PRESSURE2,MAVLinkType.SCALED_PRESSURE3],LIVEKIT_BACKEND_ROOM_CONNECTION_CONFIG={autoSubscribe:!1,maxRetries:2,peerConnectionTimeout:3e4},LIVEKIT_BACKEND_ROOM_CONFIG={reconnectPolicy:new DefaultReconnectPolicy,dynacast:!0,adaptiveStream:!1,stopLocalTrackOnUnpublish:!0,videoCaptureDefaults:{resolution:{width:1920,height:1080,frameRate:60},facingMode:"environment"},publishDefaults:{videoCodec:"vp9",videoEncoding:{maxBitrate:7e6,maxFramerate:60,priority:"high"},backupCodec:!0,simulcast:!1,degradationPreference:"maintain-resolution"}};new DefaultReconnectPolicy;const SIMPLEPEER_BASE_CONFIG={initiator:!0,trickle:!0,iceRestartEnabled:"onDisconnect",config:{bundlePolicy:"balanced",iceTransportPolicy:"all"},iceCompleteTimeout:1e3},SIMPLEPEER_CAPTURE_CONFIG={video:{width:1920,height:1080,frameRate:60,facingMode:"environment"},audio:!1};var indexMinimal={},minimal$1={},aspromise=asPromise;function asPromise(s,t){for(var o=new Array(arguments.length-1),e=0,n=2,a=!0;n<arguments.length;)o[e++]=arguments[n++];return new Promise(function(l,u){o[e]=function(p){if(a)if(a=!1,p)u(p);else{for(var g=new Array(arguments.length-1),S=0;S<g.length;)g[S++]=arguments[S];l.apply(null,g)}};try{s.apply(t||null,o)}catch(d){a&&(a=!1,u(d))}})}var base64$1={};(function(s){var t=s;t.length=function(l){var u=l.length;if(!u)return 0;for(var d=0;--u%4>1&&l.charAt(u)==="=";)++d;return Math.ceil(l.length*3)/4-d};for(var o=new Array(64),e=new Array(123),n=0;n<64;)e[o[n]=n<26?n+65:n<52?n+71:n<62?n-4:n-59|43]=n++;t.encode=function(l,u,d){for(var p=null,g=[],S=0,y=0,b;u<d;){var k=l[u++];switch(y){case 0:g[S++]=o[k>>2],b=(k&3)<<4,y=1;break;case 1:g[S++]=o[b|k>>4],b=(k&15)<<2,y=2;break;case 2:g[S++]=o[b|k>>6],g[S++]=o[k&63],y=0;break}S>8191&&((p||(p=[])).push(String.fromCharCode.apply(String,g)),S=0)}return y&&(g[S++]=o[b],g[S++]=61,y===1&&(g[S++]=61)),p?(S&&p.push(String.fromCharCode.apply(String,g.slice(0,S))),p.join("")):String.fromCharCode.apply(String,g.slice(0,S))};var a="invalid encoding";t.decode=function(l,u,d){for(var p=d,g=0,S,y=0;y<l.length;){var b=l.charCodeAt(y++);if(b===61&&g>1)break;if((b=e[b])===void 0)throw Error(a);switch(g){case 0:S=b,g=1;break;case 1:u[d++]=S<<2|(b&48)>>4,S=b,g=2;break;case 2:u[d++]=(S&15)<<4|(b&60)>>2,S=b,g=3;break;case 3:u[d++]=(S&3)<<6|b,g=0;break}}if(g===1)throw Error(a);return d-p},t.test=function(l){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(l)}})(base64$1);var eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(t,o,e){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:o,ctx:e||this}),this};EventEmitter.prototype.off=function(t,o){if(t===void 0)this._listeners={};else if(o===void 0)this._listeners[t]=[];else for(var e=this._listeners[t],n=0;n<e.length;)e[n].fn===o?e.splice(n,1):++n;return this};EventEmitter.prototype.emit=function(t){var o=this._listeners[t];if(o){for(var e=[],n=1;n<arguments.length;)e.push(arguments[n++]);for(n=0;n<o.length;)o[n].fn.apply(o[n++].ctx,e)}return this};var float=factory(factory);function factory(s){return typeof Float32Array<"u"?function(){var t=new Float32Array([-0]),o=new Uint8Array(t.buffer),e=o[3]===128;function n(u,d,p){t[0]=u,d[p]=o[0],d[p+1]=o[1],d[p+2]=o[2],d[p+3]=o[3]}function a(u,d,p){t[0]=u,d[p]=o[3],d[p+1]=o[2],d[p+2]=o[1],d[p+3]=o[0]}s.writeFloatLE=e?n:a,s.writeFloatBE=e?a:n;function c(u,d){return o[0]=u[d],o[1]=u[d+1],o[2]=u[d+2],o[3]=u[d+3],t[0]}function l(u,d){return o[3]=u[d],o[2]=u[d+1],o[1]=u[d+2],o[0]=u[d+3],t[0]}s.readFloatLE=e?c:l,s.readFloatBE=e?l:c}():function(){function t(e,n,a,c){var l=n<0?1:0;if(l&&(n=-n),n===0)e(1/n>0?0:2147483648,a,c);else if(isNaN(n))e(2143289344,a,c);else if(n>34028234663852886e22)e((l<<31|2139095040)>>>0,a,c);else if(n<11754943508222875e-54)e((l<<31|Math.round(n/1401298464324817e-60))>>>0,a,c);else{var u=Math.floor(Math.log(n)/Math.LN2),d=Math.round(n*Math.pow(2,-u)*8388608)&8388607;e((l<<31|u+127<<23|d)>>>0,a,c)}}s.writeFloatLE=t.bind(null,writeUintLE),s.writeFloatBE=t.bind(null,writeUintBE);function o(e,n,a){var c=e(n,a),l=(c>>31)*2+1,u=c>>>23&255,d=c&8388607;return u===255?d?NaN:l*(1/0):u===0?l*1401298464324817e-60*d:l*Math.pow(2,u-150)*(d+8388608)}s.readFloatLE=o.bind(null,readUintLE),s.readFloatBE=o.bind(null,readUintBE)}(),typeof Float64Array<"u"?function(){var t=new Float64Array([-0]),o=new Uint8Array(t.buffer),e=o[7]===128;function n(u,d,p){t[0]=u,d[p]=o[0],d[p+1]=o[1],d[p+2]=o[2],d[p+3]=o[3],d[p+4]=o[4],d[p+5]=o[5],d[p+6]=o[6],d[p+7]=o[7]}function a(u,d,p){t[0]=u,d[p]=o[7],d[p+1]=o[6],d[p+2]=o[5],d[p+3]=o[4],d[p+4]=o[3],d[p+5]=o[2],d[p+6]=o[1],d[p+7]=o[0]}s.writeDoubleLE=e?n:a,s.writeDoubleBE=e?a:n;function c(u,d){return o[0]=u[d],o[1]=u[d+1],o[2]=u[d+2],o[3]=u[d+3],o[4]=u[d+4],o[5]=u[d+5],o[6]=u[d+6],o[7]=u[d+7],t[0]}function l(u,d){return o[7]=u[d],o[6]=u[d+1],o[5]=u[d+2],o[4]=u[d+3],o[3]=u[d+4],o[2]=u[d+5],o[1]=u[d+6],o[0]=u[d+7],t[0]}s.readDoubleLE=e?c:l,s.readDoubleBE=e?l:c}():function(){function t(e,n,a,c,l,u){var d=c<0?1:0;if(d&&(c=-c),c===0)e(0,l,u+n),e(1/c>0?0:2147483648,l,u+a);else if(isNaN(c))e(0,l,u+n),e(2146959360,l,u+a);else if(c>17976931348623157e292)e(0,l,u+n),e((d<<31|2146435072)>>>0,l,u+a);else{var p;if(c<22250738585072014e-324)p=c/5e-324,e(p>>>0,l,u+n),e((d<<31|p/4294967296)>>>0,l,u+a);else{var g=Math.floor(Math.log(c)/Math.LN2);g===1024&&(g=1023),p=c*Math.pow(2,-g),e(p*4503599627370496>>>0,l,u+n),e((d<<31|g+1023<<20|p*1048576&1048575)>>>0,l,u+a)}}}s.writeDoubleLE=t.bind(null,writeUintLE,0,4),s.writeDoubleBE=t.bind(null,writeUintBE,4,0);function o(e,n,a,c,l){var u=e(c,l+n),d=e(c,l+a),p=(d>>31)*2+1,g=d>>>20&2047,S=4294967296*(d&1048575)+u;return g===2047?S?NaN:p*(1/0):g===0?p*5e-324*S:p*Math.pow(2,g-1075)*(S+4503599627370496)}s.readDoubleLE=o.bind(null,readUintLE,0,4),s.readDoubleBE=o.bind(null,readUintBE,4,0)}(),s}function writeUintLE(s,t,o){t[o]=s&255,t[o+1]=s>>>8&255,t[o+2]=s>>>16&255,t[o+3]=s>>>24}function writeUintBE(s,t,o){t[o]=s>>>24,t[o+1]=s>>>16&255,t[o+2]=s>>>8&255,t[o+3]=s&255}function readUintLE(s,t){return(s[t]|s[t+1]<<8|s[t+2]<<16|s[t+3]<<24)>>>0}function readUintBE(s,t){return(s[t]<<24|s[t+1]<<16|s[t+2]<<8|s[t+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(s){}return null}var utf8$2={};(function(s){var t=s;t.length=function(e){for(var n=0,a=0,c=0;c<e.length;++c)a=e.charCodeAt(c),a<128?n+=1:a<2048?n+=2:(a&64512)===55296&&(e.charCodeAt(c+1)&64512)===56320?(++c,n+=4):n+=3;return n},t.read=function(e,n,a){var c=a-n;if(c<1)return"";for(var l=null,u=[],d=0,p;n<a;)p=e[n++],p<128?u[d++]=p:p>191&&p<224?u[d++]=(p&31)<<6|e[n++]&63:p>239&&p<365?(p=((p&7)<<18|(e[n++]&63)<<12|(e[n++]&63)<<6|e[n++]&63)-65536,u[d++]=55296+(p>>10),u[d++]=56320+(p&1023)):u[d++]=(p&15)<<12|(e[n++]&63)<<6|e[n++]&63,d>8191&&((l||(l=[])).push(String.fromCharCode.apply(String,u)),d=0);return l?(d&&l.push(String.fromCharCode.apply(String,u.slice(0,d))),l.join("")):String.fromCharCode.apply(String,u.slice(0,d))},t.write=function(e,n,a){for(var c=a,l,u,d=0;d<e.length;++d)l=e.charCodeAt(d),l<128?n[a++]=l:l<2048?(n[a++]=l>>6|192,n[a++]=l&63|128):(l&64512)===55296&&((u=e.charCodeAt(d+1))&64512)===56320?(l=65536+((l&1023)<<10)+(u&1023),++d,n[a++]=l>>18|240,n[a++]=l>>12&63|128,n[a++]=l>>6&63|128,n[a++]=l&63|128):(n[a++]=l>>12|224,n[a++]=l>>6&63|128,n[a++]=l&63|128);return a-c}})(utf8$2);var pool_1=pool;function pool(s,t,o){var e=o||8192,n=e>>>1,a=null,c=e;return function(u){if(u<1||u>n)return s(u);c+u>e&&(a=s(e),c=0);var d=t.call(a,c,c+=u);return c&7&&(c=(c|7)+1),d}}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=t;var s=requireMinimal();function t(a,c){this.lo=a>>>0,this.hi=c>>>0}var o=t.zero=new t(0,0);o.toNumber=function(){return 0},o.zzEncode=o.zzDecode=function(){return this},o.length=function(){return 1};var e=t.zeroHash="\0\0\0\0\0\0\0\0";t.fromNumber=function(c){if(c===0)return o;var l=c<0;l&&(c=-c);var u=c>>>0,d=(c-u)/4294967296>>>0;return l&&(d=~d>>>0,u=~u>>>0,++u>4294967295&&(u=0,++d>4294967295&&(d=0))),new t(u,d)},t.from=function(c){if(typeof c=="number")return t.fromNumber(c);if(s.isString(c))if(s.Long)c=s.Long.fromString(c);else return t.fromNumber(parseInt(c,10));return c.low||c.high?new t(c.low>>>0,c.high>>>0):o},t.prototype.toNumber=function(c){if(!c&&this.hi>>>31){var l=~this.lo+1>>>0,u=~this.hi>>>0;return l||(u=u+1>>>0),-(l+u*4294967296)}return this.lo+this.hi*4294967296},t.prototype.toLong=function(c){return s.Long?new s.Long(this.lo|0,this.hi|0,!!c):{low:this.lo|0,high:this.hi|0,unsigned:!!c}};var n=String.prototype.charCodeAt;return t.fromHash=function(c){return c===e?o:new t((n.call(c,0)|n.call(c,1)<<8|n.call(c,2)<<16|n.call(c,3)<<24)>>>0,(n.call(c,4)|n.call(c,5)<<8|n.call(c,6)<<16|n.call(c,7)<<24)>>>0)},t.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},t.prototype.zzEncode=function(){var c=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^c)>>>0,this.lo=(this.lo<<1^c)>>>0,this},t.prototype.zzDecode=function(){var c=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^c)>>>0,this.hi=(this.hi>>>1^c)>>>0,this},t.prototype.length=function(){var c=this.lo,l=(this.lo>>>28|this.hi<<4)>>>0,u=this.hi>>>24;return u===0?l===0?c<16384?c<128?1:2:c<2097152?3:4:l<16384?l<128?5:6:l<2097152?7:8:u<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(s){var t=s;t.asPromise=aspromise,t.base64=base64$1,t.EventEmitter=eventemitter,t.float=float,t.inquire=inquire_1,t.utf8=utf8$2,t.pool=pool_1,t.LongBits=requireLongbits(),t.isNode=!!(typeof commonjsGlobal$1<"u"&&commonjsGlobal$1&&commonjsGlobal$1.process&&commonjsGlobal$1.process.versions&&commonjsGlobal$1.process.versions.node),t.global=t.isNode&&commonjsGlobal$1||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal$1,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(a){return typeof a=="number"&&isFinite(a)&&Math.floor(a)===a},t.isString=function(a){return typeof a=="string"||a instanceof String},t.isObject=function(a){return a&&typeof a=="object"},t.isset=t.isSet=function(a,c){var l=a[c];return l!=null&&a.hasOwnProperty(c)?typeof l!="object"||(Array.isArray(l)?l.length:Object.keys(l).length)>0:!1},t.Buffer=function(){try{var n=t.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(a){return typeof a=="number"?t.Buffer?t._Buffer_allocUnsafe(a):new t.Array(a):t.Buffer?t._Buffer_from(a):typeof Uint8Array>"u"?a:new Uint8Array(a)},t.Array=typeof Uint8Array<"u"?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(a){return a?t.LongBits.from(a).toHash():t.LongBits.zeroHash},t.longFromHash=function(a,c){var l=t.LongBits.fromHash(a);return t.Long?t.Long.fromBits(l.lo,l.hi,c):l.toNumber(!!c)};function o(n,a,c){for(var l=Object.keys(a),u=0;u<l.length;++u)(n[l[u]]===void 0||!c)&&(n[l[u]]=a[l[u]]);return n}t.merge=o,t.lcFirst=function(a){return a.charAt(0).toLowerCase()+a.substring(1)};function e(n){function a(c,l){if(!(this instanceof a))return new a(c,l);Object.defineProperty(this,"message",{get:function(){return c}}),Error.captureStackTrace?Error.captureStackTrace(this,a):Object.defineProperty(this,"stack",{value:new Error().stack||""}),l&&o(this,l)}return a.prototype=Object.create(Error.prototype,{constructor:{value:a,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),a}t.newError=e,t.ProtocolError=e("ProtocolError"),t.oneOfGetter=function(a){for(var c={},l=0;l<a.length;++l)c[a[l]]=1;return function(){for(var u=Object.keys(this),d=u.length-1;d>-1;--d)if(c[u[d]]===1&&this[u[d]]!==void 0&&this[u[d]]!==null)return u[d]}},t.oneOfSetter=function(a){return function(c){for(var l=0;l<a.length;++l)a[l]!==c&&delete this[a[l]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var n=t.Buffer;if(!n){t._Buffer_from=t._Buffer_allocUnsafe=null;return}t._Buffer_from=n.from!==Uint8Array.from&&n.from||function(c,l){return new n(c,l)},t._Buffer_allocUnsafe=n.allocUnsafe||function(c){return new n(c)}}}(minimal$1)),minimal$1}var writer=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(s,t,o){this.fn=s,this.len=t,this.next=void 0,this.val=o}function noop(){}function State(s){this.head=s.head,this.tail=s.tail,this.len=s.len,this.next=s.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function s(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};Writer$1.create=create$1();Writer$1.alloc=function s(t){return new util$4.Array(t)};util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray));Writer$1.prototype._push=function s(t,o,e){return this.tail=this.tail.next=new Op(t,o,e),this.len+=o,this};function writeByte(s,t,o){t[o]=s&255}function writeVarint32(s,t,o){for(;s>127;)t[o++]=s&127|128,s>>>=7;t[o]=s}function VarintOp(s,t){this.len=s,this.next=void 0,this.val=t}VarintOp.prototype=Object.create(Op.prototype);VarintOp.prototype.fn=writeVarint32;Writer$1.prototype.uint32=function s(t){return this.len+=(this.tail=this.tail.next=new VarintOp((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this};Writer$1.prototype.int32=function s(t){return t<0?this._push(writeVarint64,10,LongBits$1.fromNumber(t)):this.uint32(t)};Writer$1.prototype.sint32=function s(t){return this.uint32((t<<1^t>>31)>>>0)};function writeVarint64(s,t,o){for(;s.hi;)t[o++]=s.lo&127|128,s.lo=(s.lo>>>7|s.hi<<25)>>>0,s.hi>>>=7;for(;s.lo>127;)t[o++]=s.lo&127|128,s.lo=s.lo>>>7;t[o++]=s.lo}Writer$1.prototype.uint64=function s(t){var o=LongBits$1.from(t);return this._push(writeVarint64,o.length(),o)};Writer$1.prototype.int64=Writer$1.prototype.uint64;Writer$1.prototype.sint64=function s(t){var o=LongBits$1.from(t).zzEncode();return this._push(writeVarint64,o.length(),o)};Writer$1.prototype.bool=function s(t){return this._push(writeByte,1,t?1:0)};function writeFixed32(s,t,o){t[o]=s&255,t[o+1]=s>>>8&255,t[o+2]=s>>>16&255,t[o+3]=s>>>24}Writer$1.prototype.fixed32=function s(t){return this._push(writeFixed32,4,t>>>0)};Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32;Writer$1.prototype.fixed64=function s(t){var o=LongBits$1.from(t);return this._push(writeFixed32,4,o.lo)._push(writeFixed32,4,o.hi)};Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64;Writer$1.prototype.float=function s(t){return this._push(util$4.float.writeFloatLE,4,t)};Writer$1.prototype.double=function s(t){return this._push(util$4.float.writeDoubleLE,8,t)};var writeBytes=util$4.Array.prototype.set?function s(t,o,e){o.set(t,e)}:function s(t,o,e){for(var n=0;n<t.length;++n)o[e+n]=t[n]};Writer$1.prototype.bytes=function s(t){var o=t.length>>>0;if(!o)return this._push(writeByte,1,0);if(util$4.isString(t)){var e=Writer$1.alloc(o=base64.length(t));base64.decode(t,e,0),t=e}return this.uint32(o)._push(writeBytes,o,t)};Writer$1.prototype.string=function s(t){var o=utf8$1.length(t);return o?this.uint32(o)._push(utf8$1.write,o,t):this._push(writeByte,1,0)};Writer$1.prototype.fork=function s(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this};Writer$1.prototype.reset=function s(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this};Writer$1.prototype.ldelim=function s(){var t=this.head,o=this.tail,e=this.len;return this.reset().uint32(e),e&&(this.tail.next=t.next,this.tail=o,this.len+=e),this};Writer$1.prototype.finish=function s(){for(var t=this.head.next,o=this.constructor.alloc(this.len),e=0;t;)t.fn(t.val,o,e),e+=t.len,t=t.next;return o};Writer$1._configure=function(s){BufferWriter$1=s,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&util$3.Buffer.prototype.set.name==="set"?function(t,o,e){o.set(t,e)}:function(t,o,e){if(t.copy)t.copy(o,e,0,t.length);else for(var n=0;n<t.length;)o[e++]=t[n++]}};BufferWriter.prototype.bytes=function s(t){util$3.isString(t)&&(t=util$3._Buffer_from(t,"base64"));var o=t.length>>>0;return this.uint32(o),o&&this._push(BufferWriter.writeBytesBuffer,o,t),this};function writeStringBuffer(s,t,o){s.length<40?util$3.utf8.write(s,t,o):t.utf8Write?t.utf8Write(s,o):t.write(s,o)}BufferWriter.prototype.string=function s(t){var o=util$3.Buffer.byteLength(t);return this.uint32(o),o&&this._push(writeStringBuffer,o,t),this};BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(s,t){return RangeError("index out of range: "+s.pos+" + "+(t||1)+" > "+s.len)}function Reader$1(s){this.buf=s,this.pos=0,this.len=s.length}var create_array=typeof Uint8Array<"u"?function s(t){if(t instanceof Uint8Array||Array.isArray(t))return new Reader$1(t);throw Error("illegal buffer")}:function s(t){if(Array.isArray(t))return new Reader$1(t);throw Error("illegal buffer")},create=function s(){return util$2.Buffer?function(o){return(Reader$1.create=function(n){return util$2.Buffer.isBuffer(n)?new BufferReader$1(n):create_array(n)})(o)}:create_array};Reader$1.create=create();Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice;Reader$1.prototype.uint32=function s(){var t=4294967295;return function(){if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return t}}();Reader$1.prototype.int32=function s(){return this.uint32()|0};Reader$1.prototype.sint32=function s(){var t=this.uint32();return t>>>1^-(t&1)|0};function readLongVarint(){var s=new LongBits(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(s.lo=(s.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return s;if(s.lo=(s.lo|(this.buf[this.pos]&127)<<28)>>>0,s.hi=(s.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return s;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(s.lo=(s.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return s}return s.lo=(s.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,s}if(this.len-this.pos>4){for(;t<5;++t)if(s.hi=(s.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return s}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(s.hi=(s.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return s}throw Error("invalid varint encoding")}Reader$1.prototype.bool=function s(){return this.uint32()!==0};function readFixed32_end(s,t){return(s[t-4]|s[t-3]<<8|s[t-2]<<16|s[t-1]<<24)>>>0}Reader$1.prototype.fixed32=function s(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)};Reader$1.prototype.sfixed32=function s(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)|0};function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.prototype.float=function s(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var t=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t};Reader$1.prototype.double=function s(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var t=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t};Reader$1.prototype.bytes=function s(){var t=this.uint32(),o=this.pos,e=this.pos+t;if(e>this.len)throw indexOutOfRange(this,t);if(this.pos+=t,Array.isArray(this.buf))return this.buf.slice(o,e);if(o===e){var n=util$2.Buffer;return n?n.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,o,e)};Reader$1.prototype.string=function s(){var t=this.bytes();return utf8.read(t,0,t.length)};Reader$1.prototype.skip=function s(t){if(typeof t=="number"){if(this.pos+t>this.len)throw indexOutOfRange(this,t);this.pos+=t}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this};Reader$1.prototype.skipType=function(s){switch(s){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(s=this.uint32()&7)!==4;)this.skipType(s);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+s+" at offset "+this.pos)}return this};Reader$1._configure=function(s){BufferReader$1=s,Reader$1.create=create(),BufferReader$1._configure();var t=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[t](!1)},uint64:function(){return readLongVarint.call(this)[t](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64.call(this)[t](!0)},sfixed64:function(){return readFixed64.call(this)[t](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(s){Reader.call(this,s)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)};BufferReader.prototype.string=function s(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))};BufferReader._configure();var rpc={},service=Service,util=requireMinimal();(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service;function Service(s,t,o){if(typeof s!="function")throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=s,this.requestDelimited=!!t,this.responseDelimited=!!o}Service.prototype.rpcCall=function s(t,o,e,n,a){if(!n)throw TypeError("request must be specified");var c=this;if(!a)return util.asPromise(s,c,t,o,e,n);if(!c.rpcImpl){setTimeout(function(){a(Error("already ended"))},0);return}try{return c.rpcImpl(t,o[c.requestDelimited?"encodeDelimited":"encode"](n).finish(),function(u,d){if(u)return c.emit("error",u,t),a(u);if(d===null){c.end(!0);return}if(!(d instanceof e))try{d=e[c.responseDelimited?"decodeDelimited":"decode"](d)}catch(p){return c.emit("error",p,t),a(p)}return c.emit("data",d,t),a(null,d)})}catch(l){c.emit("error",l,t),setTimeout(function(){a(l)},0);return}};Service.prototype.end=function s(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};(function(s){var t=s;t.Service=service})(rpc);var roots={};(function(s){var t=s;t.build="minimal",t.Writer=writer,t.BufferWriter=writer_buffer,t.Reader=reader,t.BufferReader=reader_buffer,t.util=requireMinimal(),t.rpc=rpc,t.roots=roots,t.configure=o;function o(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}o()})(indexMinimal);var minimal=indexMinimal;const $Reader=minimal.Reader,$Writer=minimal.Writer,$util=minimal.util,$root=minimal.roots.default||(minimal.roots.default={}),rov_actions_proto=$root.rov_actions_proto=(()=>{const s={};return s.LogLevel=function(){const t={},o=Object.create(t);return o[t[0]="Debug"]=0,o[t[1]="Info"]=1,o[t[2]="Warning"]=2,o[t[3]="Error"]=3,o[t[4]="Critical"]=4,o}(),s.SensorMeasurmentTypes=function(){const t={},o=Object.create(t);return o[t[0]="depth_meters"]=0,o[t[1]="water_temp_celsius"]=1,o[t[2]="pressure_mbar"]=2,o[t[3]="yaw_degrees"]=3,o[t[4]="pitch_degrees"]=4,o[t[5]="roll_degrees"]=5,o[t[6]="x_acceleration_m_s2"]=6,o[t[7]="y_acceleration_m_s2"]=7,o[t[8]="z_acceleration_m_s2"]=8,o[t[9]="battery_voltage"]=9,o[t[10]="battery_current_amps"]=10,o[t[11]="internal_temp_celsius"]=11,o}(),s.DataTransportMethod=function(){const t={},o=Object.create(t);return o[t[0]="LivekitReliable"]=0,o[t[1]="LivekitUnreliable"]=1,o[t[2]="DirectReliable"]=2,o[t[3]="DirectUnreliable"]=3,o}(),s.InternalWebpageEvent=function(){const t={},o=Object.create(t);return o[t[0]="Nothing"]=0,o[t[1]="RovConnected"]=1,o[t[2]="RovDisconnected"]=2,o[t[3]="UserConnected"]=3,o[t[4]="UserDisconnected"]=4,o}(),s.VideoCodec=function(){const t={},o=Object.create(t);return o[t[0]="H264"]=0,o[t[1]="VP8"]=1,o[t[2]="VP9"]=2,o[t[3]="AV1"]=3,o}(),s.VideoStreamOptions=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Height=0,t.prototype.Width=0,t.prototype.Fps=0,t.prototype.MaxBitrate=0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Height!=null&&Object.hasOwnProperty.call(e,"Height")&&n.uint32(8).uint32(e.Height),e.Width!=null&&Object.hasOwnProperty.call(e,"Width")&&n.uint32(16).uint32(e.Width),e.Fps!=null&&Object.hasOwnProperty.call(e,"Fps")&&n.uint32(24).uint32(e.Fps),e.MaxBitrate!=null&&Object.hasOwnProperty.call(e,"MaxBitrate")&&n.uint32(32).uint32(e.MaxBitrate),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.VideoStreamOptions;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.Height=e.uint32();break}case 2:{c.Width=e.uint32();break}case 3:{c.Fps=e.uint32();break}case 4:{c.MaxBitrate=e.uint32();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Height!=null&&e.hasOwnProperty("Height")&&!$util.isInteger(e.Height)?"Height: integer expected":e.Width!=null&&e.hasOwnProperty("Width")&&!$util.isInteger(e.Width)?"Width: integer expected":e.Fps!=null&&e.hasOwnProperty("Fps")&&!$util.isInteger(e.Fps)?"Fps: integer expected":e.MaxBitrate!=null&&e.hasOwnProperty("MaxBitrate")&&!$util.isInteger(e.MaxBitrate)?"MaxBitrate: integer expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.VideoStreamOptions)return e;let n=new $root.rov_actions_proto.VideoStreamOptions;return e.Height!=null&&(n.Height=e.Height>>>0),e.Width!=null&&(n.Width=e.Width>>>0),e.Fps!=null&&(n.Fps=e.Fps>>>0),e.MaxBitrate!=null&&(n.MaxBitrate=e.MaxBitrate>>>0),n},t.toObject=function(e,n){n||(n={});let a={};return n.defaults&&(a.Height=0,a.Width=0,a.Fps=0,a.MaxBitrate=0),e.Height!=null&&e.hasOwnProperty("Height")&&(a.Height=e.Height),e.Width!=null&&e.hasOwnProperty("Width")&&(a.Width=e.Width),e.Fps!=null&&e.hasOwnProperty("Fps")&&(a.Fps=e.Fps),e.MaxBitrate!=null&&e.hasOwnProperty("MaxBitrate")&&(a.MaxBitrate=e.MaxBitrate),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.VideoStreamOptions"},t}(),s.SetLivekitVideoOptionsAction=function(){function t(o){if(this.SimulcastLayers=[],o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Enabled=!1,t.prototype.Codec=0,t.prototype.AllowBackupCodec=!1,t.prototype.BaseStream=null,t.prototype.SimulcastLayers=$util.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,n){if(n||(n=$Writer.create()),e.Enabled!=null&&Object.hasOwnProperty.call(e,"Enabled")&&n.uint32(8).bool(e.Enabled),e.Codec!=null&&Object.hasOwnProperty.call(e,"Codec")&&n.uint32(16).int32(e.Codec),e.AllowBackupCodec!=null&&Object.hasOwnProperty.call(e,"AllowBackupCodec")&&n.uint32(24).bool(e.AllowBackupCodec),e.BaseStream!=null&&Object.hasOwnProperty.call(e,"BaseStream")&&$root.rov_actions_proto.VideoStreamOptions.encode(e.BaseStream,n.uint32(34).fork()).ldelim(),e.SimulcastLayers!=null&&e.SimulcastLayers.length)for(let a=0;a<e.SimulcastLayers.length;++a)$root.rov_actions_proto.VideoStreamOptions.encode(e.SimulcastLayers[a],n.uint32(42).fork()).ldelim();return n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.SetLivekitVideoOptionsAction;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.Enabled=e.bool();break}case 2:{c.Codec=e.int32();break}case 3:{c.AllowBackupCodec=e.bool();break}case 4:{c.BaseStream=$root.rov_actions_proto.VideoStreamOptions.decode(e,e.uint32());break}case 5:{c.SimulcastLayers&&c.SimulcastLayers.length||(c.SimulcastLayers=[]),c.SimulcastLayers.push($root.rov_actions_proto.VideoStreamOptions.decode(e,e.uint32()));break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.Enabled!=null&&e.hasOwnProperty("Enabled")&&typeof e.Enabled!="boolean")return"Enabled: boolean expected";if(e.Codec!=null&&e.hasOwnProperty("Codec"))switch(e.Codec){default:return"Codec: enum value expected";case 0:case 1:case 2:case 3:break}if(e.AllowBackupCodec!=null&&e.hasOwnProperty("AllowBackupCodec")&&typeof e.AllowBackupCodec!="boolean")return"AllowBackupCodec: boolean expected";if(e.BaseStream!=null&&e.hasOwnProperty("BaseStream")){let n=$root.rov_actions_proto.VideoStreamOptions.verify(e.BaseStream);if(n)return"BaseStream."+n}if(e.SimulcastLayers!=null&&e.hasOwnProperty("SimulcastLayers")){if(!Array.isArray(e.SimulcastLayers))return"SimulcastLayers: array expected";for(let n=0;n<e.SimulcastLayers.length;++n){let a=$root.rov_actions_proto.VideoStreamOptions.verify(e.SimulcastLayers[n]);if(a)return"SimulcastLayers."+a}}return null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.SetLivekitVideoOptionsAction)return e;let n=new $root.rov_actions_proto.SetLivekitVideoOptionsAction;switch(e.Enabled!=null&&(n.Enabled=!!e.Enabled),e.Codec){default:if(typeof e.Codec=="number"){n.Codec=e.Codec;break}break;case"H264":case 0:n.Codec=0;break;case"VP8":case 1:n.Codec=1;break;case"VP9":case 2:n.Codec=2;break;case"AV1":case 3:n.Codec=3;break}if(e.AllowBackupCodec!=null&&(n.AllowBackupCodec=!!e.AllowBackupCodec),e.BaseStream!=null){if(typeof e.BaseStream!="object")throw TypeError(".rov_actions_proto.SetLivekitVideoOptionsAction.BaseStream: object expected");n.BaseStream=$root.rov_actions_proto.VideoStreamOptions.fromObject(e.BaseStream)}if(e.SimulcastLayers){if(!Array.isArray(e.SimulcastLayers))throw TypeError(".rov_actions_proto.SetLivekitVideoOptionsAction.SimulcastLayers: array expected");n.SimulcastLayers=[];for(let a=0;a<e.SimulcastLayers.length;++a){if(typeof e.SimulcastLayers[a]!="object")throw TypeError(".rov_actions_proto.SetLivekitVideoOptionsAction.SimulcastLayers: object expected");n.SimulcastLayers[a]=$root.rov_actions_proto.VideoStreamOptions.fromObject(e.SimulcastLayers[a])}}return n},t.toObject=function(e,n){n||(n={});let a={};if((n.arrays||n.defaults)&&(a.SimulcastLayers=[]),n.defaults&&(a.Enabled=!1,a.Codec=n.enums===String?"H264":0,a.AllowBackupCodec=!1,a.BaseStream=null),e.Enabled!=null&&e.hasOwnProperty("Enabled")&&(a.Enabled=e.Enabled),e.Codec!=null&&e.hasOwnProperty("Codec")&&(a.Codec=n.enums===String?$root.rov_actions_proto.VideoCodec[e.Codec]===void 0?e.Codec:$root.rov_actions_proto.VideoCodec[e.Codec]:e.Codec),e.AllowBackupCodec!=null&&e.hasOwnProperty("AllowBackupCodec")&&(a.AllowBackupCodec=e.AllowBackupCodec),e.BaseStream!=null&&e.hasOwnProperty("BaseStream")&&(a.BaseStream=$root.rov_actions_proto.VideoStreamOptions.toObject(e.BaseStream,n)),e.SimulcastLayers&&e.SimulcastLayers.length){a.SimulcastLayers=[];for(let c=0;c<e.SimulcastLayers.length;++c)a.SimulcastLayers[c]=$root.rov_actions_proto.VideoStreamOptions.toObject(e.SimulcastLayers[c],n)}return a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SetLivekitVideoOptionsAction"},t}(),s.SetSimplePeerVideoOptionsAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Enabled=!1,t.prototype.Bitrate=0,t.prototype.Codec=0,t.prototype.BaseStream=null,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Enabled!=null&&Object.hasOwnProperty.call(e,"Enabled")&&n.uint32(8).bool(e.Enabled),e.Bitrate!=null&&Object.hasOwnProperty.call(e,"Bitrate")&&n.uint32(16).uint32(e.Bitrate),e.Codec!=null&&Object.hasOwnProperty.call(e,"Codec")&&n.uint32(24).int32(e.Codec),e.BaseStream!=null&&Object.hasOwnProperty.call(e,"BaseStream")&&$root.rov_actions_proto.VideoStreamOptions.encode(e.BaseStream,n.uint32(34).fork()).ldelim(),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.SetSimplePeerVideoOptionsAction;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.Enabled=e.bool();break}case 2:{c.Bitrate=e.uint32();break}case 3:{c.Codec=e.int32();break}case 4:{c.BaseStream=$root.rov_actions_proto.VideoStreamOptions.decode(e,e.uint32());break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.Enabled!=null&&e.hasOwnProperty("Enabled")&&typeof e.Enabled!="boolean")return"Enabled: boolean expected";if(e.Bitrate!=null&&e.hasOwnProperty("Bitrate")&&!$util.isInteger(e.Bitrate))return"Bitrate: integer expected";if(e.Codec!=null&&e.hasOwnProperty("Codec"))switch(e.Codec){default:return"Codec: enum value expected";case 0:case 1:case 2:case 3:break}if(e.BaseStream!=null&&e.hasOwnProperty("BaseStream")){let n=$root.rov_actions_proto.VideoStreamOptions.verify(e.BaseStream);if(n)return"BaseStream."+n}return null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.SetSimplePeerVideoOptionsAction)return e;let n=new $root.rov_actions_proto.SetSimplePeerVideoOptionsAction;switch(e.Enabled!=null&&(n.Enabled=!!e.Enabled),e.Bitrate!=null&&(n.Bitrate=e.Bitrate>>>0),e.Codec){default:if(typeof e.Codec=="number"){n.Codec=e.Codec;break}break;case"H264":case 0:n.Codec=0;break;case"VP8":case 1:n.Codec=1;break;case"VP9":case 2:n.Codec=2;break;case"AV1":case 3:n.Codec=3;break}if(e.BaseStream!=null){if(typeof e.BaseStream!="object")throw TypeError(".rov_actions_proto.SetSimplePeerVideoOptionsAction.BaseStream: object expected");n.BaseStream=$root.rov_actions_proto.VideoStreamOptions.fromObject(e.BaseStream)}return n},t.toObject=function(e,n){n||(n={});let a={};return n.defaults&&(a.Enabled=!1,a.Bitrate=0,a.Codec=n.enums===String?"H264":0,a.BaseStream=null),e.Enabled!=null&&e.hasOwnProperty("Enabled")&&(a.Enabled=e.Enabled),e.Bitrate!=null&&e.hasOwnProperty("Bitrate")&&(a.Bitrate=e.Bitrate),e.Codec!=null&&e.hasOwnProperty("Codec")&&(a.Codec=n.enums===String?$root.rov_actions_proto.VideoCodec[e.Codec]===void 0?e.Codec:$root.rov_actions_proto.VideoCodec[e.Codec]:e.Codec),e.BaseStream!=null&&e.hasOwnProperty("BaseStream")&&(a.BaseStream=$root.rov_actions_proto.VideoStreamOptions.toObject(e.BaseStream,n)),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SetSimplePeerVideoOptionsAction"},t}(),s.PingAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Time=$util.Long?$util.Long.fromBits(0,0,!1):0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Time!=null&&Object.hasOwnProperty.call(e,"Time")&&n.uint32(8).int64(e.Time),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.PingAction;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.Time=e.int64();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Time!=null&&e.hasOwnProperty("Time")&&!$util.isInteger(e.Time)&&!(e.Time&&$util.isInteger(e.Time.low)&&$util.isInteger(e.Time.high))?"Time: integer|Long expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.PingAction)return e;let n=new $root.rov_actions_proto.PingAction;return e.Time!=null&&($util.Long?(n.Time=$util.Long.fromValue(e.Time)).unsigned=!1:typeof e.Time=="string"?n.Time=parseInt(e.Time,10):typeof e.Time=="number"?n.Time=e.Time:typeof e.Time=="object"&&(n.Time=new $util.LongBits(e.Time.low>>>0,e.Time.high>>>0).toNumber())),n},t.toObject=function(e,n){n||(n={});let a={};if(n.defaults)if($util.Long){let c=new $util.Long(0,0,!1);a.Time=n.longs===String?c.toString():n.longs===Number?c.toNumber():c}else a.Time=n.longs===String?"0":0;return e.Time!=null&&e.hasOwnProperty("Time")&&(typeof e.Time=="number"?a.Time=n.longs===String?String(e.Time):e.Time:a.Time=n.longs===String?$util.Long.prototype.toString.call(e.Time):n.longs===Number?new $util.LongBits(e.Time.low>>>0,e.Time.high>>>0).toNumber():e.Time),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.PingAction"},t}(),s.PasswordAttemptAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Password="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Password!=null&&Object.hasOwnProperty.call(e,"Password")&&n.uint32(10).string(e.Password),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.PasswordAttemptAction;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.Password=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Password!=null&&e.hasOwnProperty("Password")&&!$util.isString(e.Password)?"Password: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.PasswordAttemptAction)return e;let n=new $root.rov_actions_proto.PasswordAttemptAction;return e.Password!=null&&(n.Password=String(e.Password)),n},t.toObject=function(e,n){n||(n={});let a={};return n.defaults&&(a.Password=""),e.Password!=null&&e.hasOwnProperty("Password")&&(a.Password=e.Password),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.PasswordAttemptAction"},t}(),s.AuthTokenAttemptAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Token="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Token!=null&&Object.hasOwnProperty.call(e,"Token")&&n.uint32(10).string(e.Token),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.AuthTokenAttemptAction;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.Token=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Token!=null&&e.hasOwnProperty("Token")&&!$util.isString(e.Token)?"Token: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.AuthTokenAttemptAction)return e;let n=new $root.rov_actions_proto.AuthTokenAttemptAction;return e.Token!=null&&(n.Token=String(e.Token)),n},t.toObject=function(e,n){n||(n={});let a={};return n.defaults&&(a.Token=""),e.Token!=null&&e.hasOwnProperty("Token")&&(a.Token=e.Token),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.AuthTokenAttemptAction"},t}(),s.TakeControlAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.TakeControlAction;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.TakeControlAction?e:new $root.rov_actions_proto.TakeControlAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.TakeControlAction"},t}(),s.MoveAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.VelocityX=0,t.prototype.VelocityY=0,t.prototype.VelocityZ=0,t.prototype.AngularVelocityYaw=0,t.prototype.ButtonBitmask=0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.VelocityX!=null&&Object.hasOwnProperty.call(e,"VelocityX")&&n.uint32(13).float(e.VelocityX),e.VelocityY!=null&&Object.hasOwnProperty.call(e,"VelocityY")&&n.uint32(21).float(e.VelocityY),e.VelocityZ!=null&&Object.hasOwnProperty.call(e,"VelocityZ")&&n.uint32(29).float(e.VelocityZ),e.AngularVelocityYaw!=null&&Object.hasOwnProperty.call(e,"AngularVelocityYaw")&&n.uint32(37).float(e.AngularVelocityYaw),e.ButtonBitmask!=null&&Object.hasOwnProperty.call(e,"ButtonBitmask")&&n.uint32(40).int32(e.ButtonBitmask),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.MoveAction;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.VelocityX=e.float();break}case 2:{c.VelocityY=e.float();break}case 3:{c.VelocityZ=e.float();break}case 4:{c.AngularVelocityYaw=e.float();break}case 5:{c.ButtonBitmask=e.int32();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.VelocityX!=null&&e.hasOwnProperty("VelocityX")&&typeof e.VelocityX!="number"?"VelocityX: number expected":e.VelocityY!=null&&e.hasOwnProperty("VelocityY")&&typeof e.VelocityY!="number"?"VelocityY: number expected":e.VelocityZ!=null&&e.hasOwnProperty("VelocityZ")&&typeof e.VelocityZ!="number"?"VelocityZ: number expected":e.AngularVelocityYaw!=null&&e.hasOwnProperty("AngularVelocityYaw")&&typeof e.AngularVelocityYaw!="number"?"AngularVelocityYaw: number expected":e.ButtonBitmask!=null&&e.hasOwnProperty("ButtonBitmask")&&!$util.isInteger(e.ButtonBitmask)?"ButtonBitmask: integer expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.MoveAction)return e;let n=new $root.rov_actions_proto.MoveAction;return e.VelocityX!=null&&(n.VelocityX=Number(e.VelocityX)),e.VelocityY!=null&&(n.VelocityY=Number(e.VelocityY)),e.VelocityZ!=null&&(n.VelocityZ=Number(e.VelocityZ)),e.AngularVelocityYaw!=null&&(n.AngularVelocityYaw=Number(e.AngularVelocityYaw)),e.ButtonBitmask!=null&&(n.ButtonBitmask=e.ButtonBitmask|0),n},t.toObject=function(e,n){n||(n={});let a={};return n.defaults&&(a.VelocityX=0,a.VelocityY=0,a.VelocityZ=0,a.AngularVelocityYaw=0,a.ButtonBitmask=0),e.VelocityX!=null&&e.hasOwnProperty("VelocityX")&&(a.VelocityX=n.json&&!isFinite(e.VelocityX)?String(e.VelocityX):e.VelocityX),e.VelocityY!=null&&e.hasOwnProperty("VelocityY")&&(a.VelocityY=n.json&&!isFinite(e.VelocityY)?String(e.VelocityY):e.VelocityY),e.VelocityZ!=null&&e.hasOwnProperty("VelocityZ")&&(a.VelocityZ=n.json&&!isFinite(e.VelocityZ)?String(e.VelocityZ):e.VelocityZ),e.AngularVelocityYaw!=null&&e.hasOwnProperty("AngularVelocityYaw")&&(a.AngularVelocityYaw=n.json&&!isFinite(e.AngularVelocityYaw)?String(e.AngularVelocityYaw):e.AngularVelocityYaw),e.ButtonBitmask!=null&&e.hasOwnProperty("ButtonBitmask")&&(a.ButtonBitmask=e.ButtonBitmask),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.MoveAction"},t}(),s.TakePhotoAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.TakePhotoAction;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.TakePhotoAction?e:new $root.rov_actions_proto.TakePhotoAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.TakePhotoAction"},t}(),s.StartVideoRecAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.StartVideoRecAction;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.StartVideoRecAction?e:new $root.rov_actions_proto.StartVideoRecAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.StartVideoRecAction"},t}(),s.StopVideoRecAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.StopVideoRecAction;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.StopVideoRecAction?e:new $root.rov_actions_proto.StopVideoRecAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.StopVideoRecAction"},t}(),s.ToggleLightsAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.ToggleLightsAction;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.ToggleLightsAction?e:new $root.rov_actions_proto.ToggleLightsAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.ToggleLightsAction"},t}(),s.ShutdownRovAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.ShutdownRovAction;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.ShutdownRovAction?e:new $root.rov_actions_proto.ShutdownRovAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.ShutdownRovAction"},t}(),s.RebootRovAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.RebootRovAction;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.RebootRovAction?e:new $root.rov_actions_proto.RebootRovAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.RebootRovAction"},t}(),s.EnableWifiAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.EnableWifiAction;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.EnableWifiAction?e:new $root.rov_actions_proto.EnableWifiAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.EnableWifiAction"},t}(),s.DisableWifiAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.DisableWifiAction;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.DisableWifiAction?e:new $root.rov_actions_proto.DisableWifiAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.DisableWifiAction"},t}(),s.RovStatusReportAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.RovStatusReportAction;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.RovStatusReportAction?e:new $root.rov_actions_proto.RovStatusReportAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.RovStatusReportAction"},t}(),s.RestartRovServicesAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.RestartRovServicesAction;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.RestartRovServicesAction?e:new $root.rov_actions_proto.RestartRovServicesAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.RestartRovServicesAction"},t}(),s.SendRovLogsAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.SendRovLogsAction;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.SendRovLogsAction?e:new $root.rov_actions_proto.SendRovLogsAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SendRovLogsAction"},t}(),s.RefreshAllSensorsAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.RefreshAllSensorsAction;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.RefreshAllSensorsAction?e:new $root.rov_actions_proto.RefreshAllSensorsAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.RefreshAllSensorsAction"},t}(),s.MoveClawAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Value=0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Value!=null&&Object.hasOwnProperty.call(e,"Value")&&n.uint32(13).float(e.Value),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.MoveClawAction;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.Value=e.float();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Value!=null&&e.hasOwnProperty("Value")&&typeof e.Value!="number"?"Value: number expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.MoveClawAction)return e;let n=new $root.rov_actions_proto.MoveClawAction;return e.Value!=null&&(n.Value=Number(e.Value)),n},t.toObject=function(e,n){n||(n={});let a={};return n.defaults&&(a.Value=0),e.Value!=null&&e.hasOwnProperty("Value")&&(a.Value=n.json&&!isFinite(e.Value)?String(e.Value):e.Value),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.MoveClawAction"},t}(),s.SimplePeerSignalAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Message="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Message!=null&&Object.hasOwnProperty.call(e,"Message")&&n.uint32(10).string(e.Message),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.SimplePeerSignalAction;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.Message=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Message!=null&&e.hasOwnProperty("Message")&&!$util.isString(e.Message)?"Message: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.SimplePeerSignalAction)return e;let n=new $root.rov_actions_proto.SimplePeerSignalAction;return e.Message!=null&&(n.Message=String(e.Message)),n},t.toObject=function(e,n){n||(n={});let a={};return n.defaults&&(a.Message=""),e.Message!=null&&e.hasOwnProperty("Message")&&(a.Message=e.Message),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SimplePeerSignalAction"},t}(),s.DisarmAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.DisarmAction;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.DisarmAction?e:new $root.rov_actions_proto.DisarmAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.DisarmAction"},t}(),s.SetAutopilotModeAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.mode=0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.mode!=null&&Object.hasOwnProperty.call(e,"mode")&&n.uint32(8).int32(e.mode),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.SetAutopilotModeAction;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.mode=e.int32();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.mode!=null&&e.hasOwnProperty("mode")&&!$util.isInteger(e.mode)?"mode: integer expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.SetAutopilotModeAction)return e;let n=new $root.rov_actions_proto.SetAutopilotModeAction;return e.mode!=null&&(n.mode=e.mode|0),n},t.toObject=function(e,n){n||(n={});let a={};return n.defaults&&(a.mode=0),e.mode!=null&&e.hasOwnProperty("mode")&&(a.mode=e.mode),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SetAutopilotModeAction"},t}(),s.SetLivestreamingEnabledAction=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Enabled=!1,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Enabled!=null&&Object.hasOwnProperty.call(e,"Enabled")&&n.uint32(8).bool(e.Enabled),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.SetLivestreamingEnabledAction;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.Enabled=e.bool();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Enabled!=null&&e.hasOwnProperty("Enabled")&&typeof e.Enabled!="boolean"?"Enabled: boolean expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.SetLivestreamingEnabledAction)return e;let n=new $root.rov_actions_proto.SetLivestreamingEnabledAction;return e.Enabled!=null&&(n.Enabled=!!e.Enabled),n},t.toObject=function(e,n){n||(n={});let a={};return n.defaults&&(a.Enabled=!1),e.Enabled!=null&&e.hasOwnProperty("Enabled")&&(a.Enabled=e.Enabled),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SetLivestreamingEnabledAction"},t}(),s.ActionBackendMetadata=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.FromUserId="",t.prototype.InternalWebpageEvt=0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.FromUserId!=null&&Object.hasOwnProperty.call(e,"FromUserId")&&n.uint32(10).string(e.FromUserId),e.InternalWebpageEvt!=null&&Object.hasOwnProperty.call(e,"InternalWebpageEvt")&&n.uint32(16).int32(e.InternalWebpageEvt),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.ActionBackendMetadata;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.FromUserId=e.string();break}case 2:{c.InternalWebpageEvt=e.int32();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.FromUserId!=null&&e.hasOwnProperty("FromUserId")&&!$util.isString(e.FromUserId))return"FromUserId: string expected";if(e.InternalWebpageEvt!=null&&e.hasOwnProperty("InternalWebpageEvt"))switch(e.InternalWebpageEvt){default:return"InternalWebpageEvt: enum value expected";case 0:case 1:case 2:case 3:case 4:break}return null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.ActionBackendMetadata)return e;let n=new $root.rov_actions_proto.ActionBackendMetadata;switch(e.FromUserId!=null&&(n.FromUserId=String(e.FromUserId)),e.InternalWebpageEvt){default:if(typeof e.InternalWebpageEvt=="number"){n.InternalWebpageEvt=e.InternalWebpageEvt;break}break;case"Nothing":case 0:n.InternalWebpageEvt=0;break;case"RovConnected":case 1:n.InternalWebpageEvt=1;break;case"RovDisconnected":case 2:n.InternalWebpageEvt=2;break;case"UserConnected":case 3:n.InternalWebpageEvt=3;break;case"UserDisconnected":case 4:n.InternalWebpageEvt=4;break}return n},t.toObject=function(e,n){n||(n={});let a={};return n.defaults&&(a.FromUserId="",a.InternalWebpageEvt=n.enums===String?"Nothing":0),e.FromUserId!=null&&e.hasOwnProperty("FromUserId")&&(a.FromUserId=e.FromUserId),e.InternalWebpageEvt!=null&&e.hasOwnProperty("InternalWebpageEvt")&&(a.InternalWebpageEvt=n.enums===String?$root.rov_actions_proto.InternalWebpageEvent[e.InternalWebpageEvt]===void 0?e.InternalWebpageEvt:$root.rov_actions_proto.InternalWebpageEvent[e.InternalWebpageEvt]:e.InternalWebpageEvt),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.ActionBackendMetadata"},t}(),s.RovAction=function(){function t(e){if(e)for(let n=Object.keys(e),a=0;a<n.length;++a)e[n[a]]!=null&&(this[n[a]]=e[n[a]])}t.prototype.BackendMetadata=null,t.prototype.ExchangeId=0,t.prototype.Ping=null,t.prototype.PasswordAttempt=null,t.prototype.AuthTokenAttempt=null,t.prototype.TakeControl=null,t.prototype.Move=null,t.prototype.TakePhoto=null,t.prototype.StartVideoRec=null,t.prototype.StopVideoRec=null,t.prototype.ToggleLights=null,t.prototype.ShutdownRov=null,t.prototype.RebootRov=null,t.prototype.EnableWifi=null,t.prototype.DisableWifi=null,t.prototype.RovStatusReport=null,t.prototype.RestartRovServices=null,t.prototype.SendRovLogs=null,t.prototype.RefreshAllSensors=null,t.prototype.MoveClaw=null,t.prototype.SimplePeerSignal=null,t.prototype.Disarm=null,t.prototype.SetAutopilotMode=null,t.prototype.SetLivekitVideoOptions=null,t.prototype.SetSimplePeerVideoOptions=null,t.prototype.SetLivestreamingEnabled=null;let o;return Object.defineProperty(t.prototype,"Body",{get:$util.oneOfGetter(o=["Ping","PasswordAttempt","AuthTokenAttempt","TakeControl","Move","TakePhoto","StartVideoRec","StopVideoRec","ToggleLights","ShutdownRov","RebootRov","EnableWifi","DisableWifi","RovStatusReport","RestartRovServices","SendRovLogs","RefreshAllSensors","MoveClaw","SimplePeerSignal","Disarm","SetAutopilotMode","SetLivekitVideoOptions","SetSimplePeerVideoOptions","SetLivestreamingEnabled"]),set:$util.oneOfSetter(o)}),t.create=function(n){return new t(n)},t.encode=function(n,a){return a||(a=$Writer.create()),n.BackendMetadata!=null&&Object.hasOwnProperty.call(n,"BackendMetadata")&&$root.rov_actions_proto.ActionBackendMetadata.encode(n.BackendMetadata,a.uint32(10).fork()).ldelim(),n.ExchangeId!=null&&Object.hasOwnProperty.call(n,"ExchangeId")&&a.uint32(16).int32(n.ExchangeId),n.Ping!=null&&Object.hasOwnProperty.call(n,"Ping")&&$root.rov_actions_proto.PingAction.encode(n.Ping,a.uint32(26).fork()).ldelim(),n.PasswordAttempt!=null&&Object.hasOwnProperty.call(n,"PasswordAttempt")&&$root.rov_actions_proto.PasswordAttemptAction.encode(n.PasswordAttempt,a.uint32(34).fork()).ldelim(),n.AuthTokenAttempt!=null&&Object.hasOwnProperty.call(n,"AuthTokenAttempt")&&$root.rov_actions_proto.AuthTokenAttemptAction.encode(n.AuthTokenAttempt,a.uint32(42).fork()).ldelim(),n.TakeControl!=null&&Object.hasOwnProperty.call(n,"TakeControl")&&$root.rov_actions_proto.TakeControlAction.encode(n.TakeControl,a.uint32(50).fork()).ldelim(),n.Move!=null&&Object.hasOwnProperty.call(n,"Move")&&$root.rov_actions_proto.MoveAction.encode(n.Move,a.uint32(58).fork()).ldelim(),n.TakePhoto!=null&&Object.hasOwnProperty.call(n,"TakePhoto")&&$root.rov_actions_proto.TakePhotoAction.encode(n.TakePhoto,a.uint32(74).fork()).ldelim(),n.StartVideoRec!=null&&Object.hasOwnProperty.call(n,"StartVideoRec")&&$root.rov_actions_proto.StartVideoRecAction.encode(n.StartVideoRec,a.uint32(82).fork()).ldelim(),n.StopVideoRec!=null&&Object.hasOwnProperty.call(n,"StopVideoRec")&&$root.rov_actions_proto.StopVideoRecAction.encode(n.StopVideoRec,a.uint32(90).fork()).ldelim(),n.ToggleLights!=null&&Object.hasOwnProperty.call(n,"ToggleLights")&&$root.rov_actions_proto.ToggleLightsAction.encode(n.ToggleLights,a.uint32(98).fork()).ldelim(),n.ShutdownRov!=null&&Object.hasOwnProperty.call(n,"ShutdownRov")&&$root.rov_actions_proto.ShutdownRovAction.encode(n.ShutdownRov,a.uint32(106).fork()).ldelim(),n.RebootRov!=null&&Object.hasOwnProperty.call(n,"RebootRov")&&$root.rov_actions_proto.RebootRovAction.encode(n.RebootRov,a.uint32(114).fork()).ldelim(),n.EnableWifi!=null&&Object.hasOwnProperty.call(n,"EnableWifi")&&$root.rov_actions_proto.EnableWifiAction.encode(n.EnableWifi,a.uint32(122).fork()).ldelim(),n.DisableWifi!=null&&Object.hasOwnProperty.call(n,"DisableWifi")&&$root.rov_actions_proto.DisableWifiAction.encode(n.DisableWifi,a.uint32(130).fork()).ldelim(),n.RovStatusReport!=null&&Object.hasOwnProperty.call(n,"RovStatusReport")&&$root.rov_actions_proto.RovStatusReportAction.encode(n.RovStatusReport,a.uint32(138).fork()).ldelim(),n.RestartRovServices!=null&&Object.hasOwnProperty.call(n,"RestartRovServices")&&$root.rov_actions_proto.RestartRovServicesAction.encode(n.RestartRovServices,a.uint32(146).fork()).ldelim(),n.SendRovLogs!=null&&Object.hasOwnProperty.call(n,"SendRovLogs")&&$root.rov_actions_proto.SendRovLogsAction.encode(n.SendRovLogs,a.uint32(154).fork()).ldelim(),n.RefreshAllSensors!=null&&Object.hasOwnProperty.call(n,"RefreshAllSensors")&&$root.rov_actions_proto.RefreshAllSensorsAction.encode(n.RefreshAllSensors,a.uint32(162).fork()).ldelim(),n.MoveClaw!=null&&Object.hasOwnProperty.call(n,"MoveClaw")&&$root.rov_actions_proto.MoveClawAction.encode(n.MoveClaw,a.uint32(170).fork()).ldelim(),n.SimplePeerSignal!=null&&Object.hasOwnProperty.call(n,"SimplePeerSignal")&&$root.rov_actions_proto.SimplePeerSignalAction.encode(n.SimplePeerSignal,a.uint32(178).fork()).ldelim(),n.Disarm!=null&&Object.hasOwnProperty.call(n,"Disarm")&&$root.rov_actions_proto.DisarmAction.encode(n.Disarm,a.uint32(186).fork()).ldelim(),n.SetAutopilotMode!=null&&Object.hasOwnProperty.call(n,"SetAutopilotMode")&&$root.rov_actions_proto.SetAutopilotModeAction.encode(n.SetAutopilotMode,a.uint32(194).fork()).ldelim(),n.SetLivekitVideoOptions!=null&&Object.hasOwnProperty.call(n,"SetLivekitVideoOptions")&&$root.rov_actions_proto.SetLivekitVideoOptionsAction.encode(n.SetLivekitVideoOptions,a.uint32(202).fork()).ldelim(),n.SetSimplePeerVideoOptions!=null&&Object.hasOwnProperty.call(n,"SetSimplePeerVideoOptions")&&$root.rov_actions_proto.SetSimplePeerVideoOptionsAction.encode(n.SetSimplePeerVideoOptions,a.uint32(210).fork()).ldelim(),n.SetLivestreamingEnabled!=null&&Object.hasOwnProperty.call(n,"SetLivestreamingEnabled")&&$root.rov_actions_proto.SetLivestreamingEnabledAction.encode(n.SetLivestreamingEnabled,a.uint32(218).fork()).ldelim(),a},t.encodeDelimited=function(n,a){return this.encode(n,a).ldelim()},t.decode=function(n,a){n instanceof $Reader||(n=$Reader.create(n));let c=a===void 0?n.len:n.pos+a,l=new $root.rov_actions_proto.RovAction;for(;n.pos<c;){let u=n.uint32();switch(u>>>3){case 1:{l.BackendMetadata=$root.rov_actions_proto.ActionBackendMetadata.decode(n,n.uint32());break}case 2:{l.ExchangeId=n.int32();break}case 3:{l.Ping=$root.rov_actions_proto.PingAction.decode(n,n.uint32());break}case 4:{l.PasswordAttempt=$root.rov_actions_proto.PasswordAttemptAction.decode(n,n.uint32());break}case 5:{l.AuthTokenAttempt=$root.rov_actions_proto.AuthTokenAttemptAction.decode(n,n.uint32());break}case 6:{l.TakeControl=$root.rov_actions_proto.TakeControlAction.decode(n,n.uint32());break}case 7:{l.Move=$root.rov_actions_proto.MoveAction.decode(n,n.uint32());break}case 9:{l.TakePhoto=$root.rov_actions_proto.TakePhotoAction.decode(n,n.uint32());break}case 10:{l.StartVideoRec=$root.rov_actions_proto.StartVideoRecAction.decode(n,n.uint32());break}case 11:{l.StopVideoRec=$root.rov_actions_proto.StopVideoRecAction.decode(n,n.uint32());break}case 12:{l.ToggleLights=$root.rov_actions_proto.ToggleLightsAction.decode(n,n.uint32());break}case 13:{l.ShutdownRov=$root.rov_actions_proto.ShutdownRovAction.decode(n,n.uint32());break}case 14:{l.RebootRov=$root.rov_actions_proto.RebootRovAction.decode(n,n.uint32());break}case 15:{l.EnableWifi=$root.rov_actions_proto.EnableWifiAction.decode(n,n.uint32());break}case 16:{l.DisableWifi=$root.rov_actions_proto.DisableWifiAction.decode(n,n.uint32());break}case 17:{l.RovStatusReport=$root.rov_actions_proto.RovStatusReportAction.decode(n,n.uint32());break}case 18:{l.RestartRovServices=$root.rov_actions_proto.RestartRovServicesAction.decode(n,n.uint32());break}case 19:{l.SendRovLogs=$root.rov_actions_proto.SendRovLogsAction.decode(n,n.uint32());break}case 20:{l.RefreshAllSensors=$root.rov_actions_proto.RefreshAllSensorsAction.decode(n,n.uint32());break}case 21:{l.MoveClaw=$root.rov_actions_proto.MoveClawAction.decode(n,n.uint32());break}case 22:{l.SimplePeerSignal=$root.rov_actions_proto.SimplePeerSignalAction.decode(n,n.uint32());break}case 23:{l.Disarm=$root.rov_actions_proto.DisarmAction.decode(n,n.uint32());break}case 24:{l.SetAutopilotMode=$root.rov_actions_proto.SetAutopilotModeAction.decode(n,n.uint32());break}case 25:{l.SetLivekitVideoOptions=$root.rov_actions_proto.SetLivekitVideoOptionsAction.decode(n,n.uint32());break}case 26:{l.SetSimplePeerVideoOptions=$root.rov_actions_proto.SetSimplePeerVideoOptionsAction.decode(n,n.uint32());break}case 27:{l.SetLivestreamingEnabled=$root.rov_actions_proto.SetLivestreamingEnabledAction.decode(n,n.uint32());break}default:n.skipType(u&7);break}}return l},t.decodeDelimited=function(n){return n instanceof $Reader||(n=new $Reader(n)),this.decode(n,n.uint32())},t.verify=function(n){if(typeof n!="object"||n===null)return"object expected";let a={};if(n.BackendMetadata!=null&&n.hasOwnProperty("BackendMetadata")){let c=$root.rov_actions_proto.ActionBackendMetadata.verify(n.BackendMetadata);if(c)return"BackendMetadata."+c}if(n.ExchangeId!=null&&n.hasOwnProperty("ExchangeId")&&!$util.isInteger(n.ExchangeId))return"ExchangeId: integer expected";if(n.Ping!=null&&n.hasOwnProperty("Ping")){a.Body=1;{let c=$root.rov_actions_proto.PingAction.verify(n.Ping);if(c)return"Ping."+c}}if(n.PasswordAttempt!=null&&n.hasOwnProperty("PasswordAttempt")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.PasswordAttemptAction.verify(n.PasswordAttempt);if(c)return"PasswordAttempt."+c}}if(n.AuthTokenAttempt!=null&&n.hasOwnProperty("AuthTokenAttempt")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.AuthTokenAttemptAction.verify(n.AuthTokenAttempt);if(c)return"AuthTokenAttempt."+c}}if(n.TakeControl!=null&&n.hasOwnProperty("TakeControl")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.TakeControlAction.verify(n.TakeControl);if(c)return"TakeControl."+c}}if(n.Move!=null&&n.hasOwnProperty("Move")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.MoveAction.verify(n.Move);if(c)return"Move."+c}}if(n.TakePhoto!=null&&n.hasOwnProperty("TakePhoto")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.TakePhotoAction.verify(n.TakePhoto);if(c)return"TakePhoto."+c}}if(n.StartVideoRec!=null&&n.hasOwnProperty("StartVideoRec")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.StartVideoRecAction.verify(n.StartVideoRec);if(c)return"StartVideoRec."+c}}if(n.StopVideoRec!=null&&n.hasOwnProperty("StopVideoRec")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.StopVideoRecAction.verify(n.StopVideoRec);if(c)return"StopVideoRec."+c}}if(n.ToggleLights!=null&&n.hasOwnProperty("ToggleLights")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.ToggleLightsAction.verify(n.ToggleLights);if(c)return"ToggleLights."+c}}if(n.ShutdownRov!=null&&n.hasOwnProperty("ShutdownRov")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.ShutdownRovAction.verify(n.ShutdownRov);if(c)return"ShutdownRov."+c}}if(n.RebootRov!=null&&n.hasOwnProperty("RebootRov")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.RebootRovAction.verify(n.RebootRov);if(c)return"RebootRov."+c}}if(n.EnableWifi!=null&&n.hasOwnProperty("EnableWifi")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.EnableWifiAction.verify(n.EnableWifi);if(c)return"EnableWifi."+c}}if(n.DisableWifi!=null&&n.hasOwnProperty("DisableWifi")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.DisableWifiAction.verify(n.DisableWifi);if(c)return"DisableWifi."+c}}if(n.RovStatusReport!=null&&n.hasOwnProperty("RovStatusReport")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.RovStatusReportAction.verify(n.RovStatusReport);if(c)return"RovStatusReport."+c}}if(n.RestartRovServices!=null&&n.hasOwnProperty("RestartRovServices")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.RestartRovServicesAction.verify(n.RestartRovServices);if(c)return"RestartRovServices."+c}}if(n.SendRovLogs!=null&&n.hasOwnProperty("SendRovLogs")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.SendRovLogsAction.verify(n.SendRovLogs);if(c)return"SendRovLogs."+c}}if(n.RefreshAllSensors!=null&&n.hasOwnProperty("RefreshAllSensors")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.RefreshAllSensorsAction.verify(n.RefreshAllSensors);if(c)return"RefreshAllSensors."+c}}if(n.MoveClaw!=null&&n.hasOwnProperty("MoveClaw")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.MoveClawAction.verify(n.MoveClaw);if(c)return"MoveClaw."+c}}if(n.SimplePeerSignal!=null&&n.hasOwnProperty("SimplePeerSignal")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.SimplePeerSignalAction.verify(n.SimplePeerSignal);if(c)return"SimplePeerSignal."+c}}if(n.Disarm!=null&&n.hasOwnProperty("Disarm")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.DisarmAction.verify(n.Disarm);if(c)return"Disarm."+c}}if(n.SetAutopilotMode!=null&&n.hasOwnProperty("SetAutopilotMode")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.SetAutopilotModeAction.verify(n.SetAutopilotMode);if(c)return"SetAutopilotMode."+c}}if(n.SetLivekitVideoOptions!=null&&n.hasOwnProperty("SetLivekitVideoOptions")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.SetLivekitVideoOptionsAction.verify(n.SetLivekitVideoOptions);if(c)return"SetLivekitVideoOptions."+c}}if(n.SetSimplePeerVideoOptions!=null&&n.hasOwnProperty("SetSimplePeerVideoOptions")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.SetSimplePeerVideoOptionsAction.verify(n.SetSimplePeerVideoOptions);if(c)return"SetSimplePeerVideoOptions."+c}}if(n.SetLivestreamingEnabled!=null&&n.hasOwnProperty("SetLivestreamingEnabled")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.SetLivestreamingEnabledAction.verify(n.SetLivestreamingEnabled);if(c)return"SetLivestreamingEnabled."+c}}return null},t.fromObject=function(n){if(n instanceof $root.rov_actions_proto.RovAction)return n;let a=new $root.rov_actions_proto.RovAction;if(n.BackendMetadata!=null){if(typeof n.BackendMetadata!="object")throw TypeError(".rov_actions_proto.RovAction.BackendMetadata: object expected");a.BackendMetadata=$root.rov_actions_proto.ActionBackendMetadata.fromObject(n.BackendMetadata)}if(n.ExchangeId!=null&&(a.ExchangeId=n.ExchangeId|0),n.Ping!=null){if(typeof n.Ping!="object")throw TypeError(".rov_actions_proto.RovAction.Ping: object expected");a.Ping=$root.rov_actions_proto.PingAction.fromObject(n.Ping)}if(n.PasswordAttempt!=null){if(typeof n.PasswordAttempt!="object")throw TypeError(".rov_actions_proto.RovAction.PasswordAttempt: object expected");a.PasswordAttempt=$root.rov_actions_proto.PasswordAttemptAction.fromObject(n.PasswordAttempt)}if(n.AuthTokenAttempt!=null){if(typeof n.AuthTokenAttempt!="object")throw TypeError(".rov_actions_proto.RovAction.AuthTokenAttempt: object expected");a.AuthTokenAttempt=$root.rov_actions_proto.AuthTokenAttemptAction.fromObject(n.AuthTokenAttempt)}if(n.TakeControl!=null){if(typeof n.TakeControl!="object")throw TypeError(".rov_actions_proto.RovAction.TakeControl: object expected");a.TakeControl=$root.rov_actions_proto.TakeControlAction.fromObject(n.TakeControl)}if(n.Move!=null){if(typeof n.Move!="object")throw TypeError(".rov_actions_proto.RovAction.Move: object expected");a.Move=$root.rov_actions_proto.MoveAction.fromObject(n.Move)}if(n.TakePhoto!=null){if(typeof n.TakePhoto!="object")throw TypeError(".rov_actions_proto.RovAction.TakePhoto: object expected");a.TakePhoto=$root.rov_actions_proto.TakePhotoAction.fromObject(n.TakePhoto)}if(n.StartVideoRec!=null){if(typeof n.StartVideoRec!="object")throw TypeError(".rov_actions_proto.RovAction.StartVideoRec: object expected");a.StartVideoRec=$root.rov_actions_proto.StartVideoRecAction.fromObject(n.StartVideoRec)}if(n.StopVideoRec!=null){if(typeof n.StopVideoRec!="object")throw TypeError(".rov_actions_proto.RovAction.StopVideoRec: object expected");a.StopVideoRec=$root.rov_actions_proto.StopVideoRecAction.fromObject(n.StopVideoRec)}if(n.ToggleLights!=null){if(typeof n.ToggleLights!="object")throw TypeError(".rov_actions_proto.RovAction.ToggleLights: object expected");a.ToggleLights=$root.rov_actions_proto.ToggleLightsAction.fromObject(n.ToggleLights)}if(n.ShutdownRov!=null){if(typeof n.ShutdownRov!="object")throw TypeError(".rov_actions_proto.RovAction.ShutdownRov: object expected");a.ShutdownRov=$root.rov_actions_proto.ShutdownRovAction.fromObject(n.ShutdownRov)}if(n.RebootRov!=null){if(typeof n.RebootRov!="object")throw TypeError(".rov_actions_proto.RovAction.RebootRov: object expected");a.RebootRov=$root.rov_actions_proto.RebootRovAction.fromObject(n.RebootRov)}if(n.EnableWifi!=null){if(typeof n.EnableWifi!="object")throw TypeError(".rov_actions_proto.RovAction.EnableWifi: object expected");a.EnableWifi=$root.rov_actions_proto.EnableWifiAction.fromObject(n.EnableWifi)}if(n.DisableWifi!=null){if(typeof n.DisableWifi!="object")throw TypeError(".rov_actions_proto.RovAction.DisableWifi: object expected");a.DisableWifi=$root.rov_actions_proto.DisableWifiAction.fromObject(n.DisableWifi)}if(n.RovStatusReport!=null){if(typeof n.RovStatusReport!="object")throw TypeError(".rov_actions_proto.RovAction.RovStatusReport: object expected");a.RovStatusReport=$root.rov_actions_proto.RovStatusReportAction.fromObject(n.RovStatusReport)}if(n.RestartRovServices!=null){if(typeof n.RestartRovServices!="object")throw TypeError(".rov_actions_proto.RovAction.RestartRovServices: object expected");a.RestartRovServices=$root.rov_actions_proto.RestartRovServicesAction.fromObject(n.RestartRovServices)}if(n.SendRovLogs!=null){if(typeof n.SendRovLogs!="object")throw TypeError(".rov_actions_proto.RovAction.SendRovLogs: object expected");a.SendRovLogs=$root.rov_actions_proto.SendRovLogsAction.fromObject(n.SendRovLogs)}if(n.RefreshAllSensors!=null){if(typeof n.RefreshAllSensors!="object")throw TypeError(".rov_actions_proto.RovAction.RefreshAllSensors: object expected");a.RefreshAllSensors=$root.rov_actions_proto.RefreshAllSensorsAction.fromObject(n.RefreshAllSensors)}if(n.MoveClaw!=null){if(typeof n.MoveClaw!="object")throw TypeError(".rov_actions_proto.RovAction.MoveClaw: object expected");a.MoveClaw=$root.rov_actions_proto.MoveClawAction.fromObject(n.MoveClaw)}if(n.SimplePeerSignal!=null){if(typeof n.SimplePeerSignal!="object")throw TypeError(".rov_actions_proto.RovAction.SimplePeerSignal: object expected");a.SimplePeerSignal=$root.rov_actions_proto.SimplePeerSignalAction.fromObject(n.SimplePeerSignal)}if(n.Disarm!=null){if(typeof n.Disarm!="object")throw TypeError(".rov_actions_proto.RovAction.Disarm: object expected");a.Disarm=$root.rov_actions_proto.DisarmAction.fromObject(n.Disarm)}if(n.SetAutopilotMode!=null){if(typeof n.SetAutopilotMode!="object")throw TypeError(".rov_actions_proto.RovAction.SetAutopilotMode: object expected");a.SetAutopilotMode=$root.rov_actions_proto.SetAutopilotModeAction.fromObject(n.SetAutopilotMode)}if(n.SetLivekitVideoOptions!=null){if(typeof n.SetLivekitVideoOptions!="object")throw TypeError(".rov_actions_proto.RovAction.SetLivekitVideoOptions: object expected");a.SetLivekitVideoOptions=$root.rov_actions_proto.SetLivekitVideoOptionsAction.fromObject(n.SetLivekitVideoOptions)}if(n.SetSimplePeerVideoOptions!=null){if(typeof n.SetSimplePeerVideoOptions!="object")throw TypeError(".rov_actions_proto.RovAction.SetSimplePeerVideoOptions: object expected");a.SetSimplePeerVideoOptions=$root.rov_actions_proto.SetSimplePeerVideoOptionsAction.fromObject(n.SetSimplePeerVideoOptions)}if(n.SetLivestreamingEnabled!=null){if(typeof n.SetLivestreamingEnabled!="object")throw TypeError(".rov_actions_proto.RovAction.SetLivestreamingEnabled: object expected");a.SetLivestreamingEnabled=$root.rov_actions_proto.SetLivestreamingEnabledAction.fromObject(n.SetLivestreamingEnabled)}return a},t.toObject=function(n,a){a||(a={});let c={};return a.defaults&&(c.BackendMetadata=null,c.ExchangeId=0),n.BackendMetadata!=null&&n.hasOwnProperty("BackendMetadata")&&(c.BackendMetadata=$root.rov_actions_proto.ActionBackendMetadata.toObject(n.BackendMetadata,a)),n.ExchangeId!=null&&n.hasOwnProperty("ExchangeId")&&(c.ExchangeId=n.ExchangeId),n.Ping!=null&&n.hasOwnProperty("Ping")&&(c.Ping=$root.rov_actions_proto.PingAction.toObject(n.Ping,a),a.oneofs&&(c.Body="Ping")),n.PasswordAttempt!=null&&n.hasOwnProperty("PasswordAttempt")&&(c.PasswordAttempt=$root.rov_actions_proto.PasswordAttemptAction.toObject(n.PasswordAttempt,a),a.oneofs&&(c.Body="PasswordAttempt")),n.AuthTokenAttempt!=null&&n.hasOwnProperty("AuthTokenAttempt")&&(c.AuthTokenAttempt=$root.rov_actions_proto.AuthTokenAttemptAction.toObject(n.AuthTokenAttempt,a),a.oneofs&&(c.Body="AuthTokenAttempt")),n.TakeControl!=null&&n.hasOwnProperty("TakeControl")&&(c.TakeControl=$root.rov_actions_proto.TakeControlAction.toObject(n.TakeControl,a),a.oneofs&&(c.Body="TakeControl")),n.Move!=null&&n.hasOwnProperty("Move")&&(c.Move=$root.rov_actions_proto.MoveAction.toObject(n.Move,a),a.oneofs&&(c.Body="Move")),n.TakePhoto!=null&&n.hasOwnProperty("TakePhoto")&&(c.TakePhoto=$root.rov_actions_proto.TakePhotoAction.toObject(n.TakePhoto,a),a.oneofs&&(c.Body="TakePhoto")),n.StartVideoRec!=null&&n.hasOwnProperty("StartVideoRec")&&(c.StartVideoRec=$root.rov_actions_proto.StartVideoRecAction.toObject(n.StartVideoRec,a),a.oneofs&&(c.Body="StartVideoRec")),n.StopVideoRec!=null&&n.hasOwnProperty("StopVideoRec")&&(c.StopVideoRec=$root.rov_actions_proto.StopVideoRecAction.toObject(n.StopVideoRec,a),a.oneofs&&(c.Body="StopVideoRec")),n.ToggleLights!=null&&n.hasOwnProperty("ToggleLights")&&(c.ToggleLights=$root.rov_actions_proto.ToggleLightsAction.toObject(n.ToggleLights,a),a.oneofs&&(c.Body="ToggleLights")),n.ShutdownRov!=null&&n.hasOwnProperty("ShutdownRov")&&(c.ShutdownRov=$root.rov_actions_proto.ShutdownRovAction.toObject(n.ShutdownRov,a),a.oneofs&&(c.Body="ShutdownRov")),n.RebootRov!=null&&n.hasOwnProperty("RebootRov")&&(c.RebootRov=$root.rov_actions_proto.RebootRovAction.toObject(n.RebootRov,a),a.oneofs&&(c.Body="RebootRov")),n.EnableWifi!=null&&n.hasOwnProperty("EnableWifi")&&(c.EnableWifi=$root.rov_actions_proto.EnableWifiAction.toObject(n.EnableWifi,a),a.oneofs&&(c.Body="EnableWifi")),n.DisableWifi!=null&&n.hasOwnProperty("DisableWifi")&&(c.DisableWifi=$root.rov_actions_proto.DisableWifiAction.toObject(n.DisableWifi,a),a.oneofs&&(c.Body="DisableWifi")),n.RovStatusReport!=null&&n.hasOwnProperty("RovStatusReport")&&(c.RovStatusReport=$root.rov_actions_proto.RovStatusReportAction.toObject(n.RovStatusReport,a),a.oneofs&&(c.Body="RovStatusReport")),n.RestartRovServices!=null&&n.hasOwnProperty("RestartRovServices")&&(c.RestartRovServices=$root.rov_actions_proto.RestartRovServicesAction.toObject(n.RestartRovServices,a),a.oneofs&&(c.Body="RestartRovServices")),n.SendRovLogs!=null&&n.hasOwnProperty("SendRovLogs")&&(c.SendRovLogs=$root.rov_actions_proto.SendRovLogsAction.toObject(n.SendRovLogs,a),a.oneofs&&(c.Body="SendRovLogs")),n.RefreshAllSensors!=null&&n.hasOwnProperty("RefreshAllSensors")&&(c.RefreshAllSensors=$root.rov_actions_proto.RefreshAllSensorsAction.toObject(n.RefreshAllSensors,a),a.oneofs&&(c.Body="RefreshAllSensors")),n.MoveClaw!=null&&n.hasOwnProperty("MoveClaw")&&(c.MoveClaw=$root.rov_actions_proto.MoveClawAction.toObject(n.MoveClaw,a),a.oneofs&&(c.Body="MoveClaw")),n.SimplePeerSignal!=null&&n.hasOwnProperty("SimplePeerSignal")&&(c.SimplePeerSignal=$root.rov_actions_proto.SimplePeerSignalAction.toObject(n.SimplePeerSignal,a),a.oneofs&&(c.Body="SimplePeerSignal")),n.Disarm!=null&&n.hasOwnProperty("Disarm")&&(c.Disarm=$root.rov_actions_proto.DisarmAction.toObject(n.Disarm,a),a.oneofs&&(c.Body="Disarm")),n.SetAutopilotMode!=null&&n.hasOwnProperty("SetAutopilotMode")&&(c.SetAutopilotMode=$root.rov_actions_proto.SetAutopilotModeAction.toObject(n.SetAutopilotMode,a),a.oneofs&&(c.Body="SetAutopilotMode")),n.SetLivekitVideoOptions!=null&&n.hasOwnProperty("SetLivekitVideoOptions")&&(c.SetLivekitVideoOptions=$root.rov_actions_proto.SetLivekitVideoOptionsAction.toObject(n.SetLivekitVideoOptions,a),a.oneofs&&(c.Body="SetLivekitVideoOptions")),n.SetSimplePeerVideoOptions!=null&&n.hasOwnProperty("SetSimplePeerVideoOptions")&&(c.SetSimplePeerVideoOptions=$root.rov_actions_proto.SetSimplePeerVideoOptionsAction.toObject(n.SetSimplePeerVideoOptions,a),a.oneofs&&(c.Body="SetSimplePeerVideoOptions")),n.SetLivestreamingEnabled!=null&&n.hasOwnProperty("SetLivestreamingEnabled")&&(c.SetLivestreamingEnabled=$root.rov_actions_proto.SetLivestreamingEnabledAction.toObject(n.SetLivestreamingEnabled,a),a.oneofs&&(c.Body="SetLivestreamingEnabled")),c},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(n){return n===void 0&&(n="type.googleapis.com"),n+"/rov_actions_proto.RovAction"},t}(),s.DoneResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Message="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Message!=null&&Object.hasOwnProperty.call(e,"Message")&&n.uint32(10).string(e.Message),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.DoneResponse;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.Message=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Message!=null&&e.hasOwnProperty("Message")&&!$util.isString(e.Message)?"Message: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.DoneResponse)return e;let n=new $root.rov_actions_proto.DoneResponse;return e.Message!=null&&(n.Message=String(e.Message)),n},t.toObject=function(e,n){n||(n={});let a={};return n.defaults&&(a.Message=""),e.Message!=null&&e.hasOwnProperty("Message")&&(a.Message=e.Message),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.DoneResponse"},t}(),s.ErrorResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Message="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Message!=null&&Object.hasOwnProperty.call(e,"Message")&&n.uint32(10).string(e.Message),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.ErrorResponse;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.Message=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Message!=null&&e.hasOwnProperty("Message")&&!$util.isString(e.Message)?"Message: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.ErrorResponse)return e;let n=new $root.rov_actions_proto.ErrorResponse;return e.Message!=null&&(n.Message=String(e.Message)),n},t.toObject=function(e,n){n||(n={});let a={};return n.defaults&&(a.Message=""),e.Message!=null&&e.hasOwnProperty("Message")&&(a.Message=e.Message),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.ErrorResponse"},t}(),s.PongResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Time=$util.Long?$util.Long.fromBits(0,0,!1):0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Time!=null&&Object.hasOwnProperty.call(e,"Time")&&n.uint32(8).int64(e.Time),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.PongResponse;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.Time=e.int64();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Time!=null&&e.hasOwnProperty("Time")&&!$util.isInteger(e.Time)&&!(e.Time&&$util.isInteger(e.Time.low)&&$util.isInteger(e.Time.high))?"Time: integer|Long expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.PongResponse)return e;let n=new $root.rov_actions_proto.PongResponse;return e.Time!=null&&($util.Long?(n.Time=$util.Long.fromValue(e.Time)).unsigned=!1:typeof e.Time=="string"?n.Time=parseInt(e.Time,10):typeof e.Time=="number"?n.Time=e.Time:typeof e.Time=="object"&&(n.Time=new $util.LongBits(e.Time.low>>>0,e.Time.high>>>0).toNumber())),n},t.toObject=function(e,n){n||(n={});let a={};if(n.defaults)if($util.Long){let c=new $util.Long(0,0,!1);a.Time=n.longs===String?c.toString():n.longs===Number?c.toNumber():c}else a.Time=n.longs===String?"0":0;return e.Time!=null&&e.hasOwnProperty("Time")&&(typeof e.Time=="number"?a.Time=n.longs===String?String(e.Time):e.Time:a.Time=n.longs===String?$util.Long.prototype.toString.call(e.Time):n.longs===Number?new $util.LongBits(e.Time.low>>>0,e.Time.high>>>0).toNumber():e.Time),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.PongResponse"},t}(),s.Measurement=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.MeasurementType=0,t.prototype.Value=0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.MeasurementType!=null&&Object.hasOwnProperty.call(e,"MeasurementType")&&n.uint32(8).int32(e.MeasurementType),e.Value!=null&&Object.hasOwnProperty.call(e,"Value")&&n.uint32(21).float(e.Value),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.Measurement;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.MeasurementType=e.int32();break}case 2:{c.Value=e.float();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.MeasurementType!=null&&e.hasOwnProperty("MeasurementType"))switch(e.MeasurementType){default:return"MeasurementType: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:break}return e.Value!=null&&e.hasOwnProperty("Value")&&typeof e.Value!="number"?"Value: number expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.Measurement)return e;let n=new $root.rov_actions_proto.Measurement;switch(e.MeasurementType){default:if(typeof e.MeasurementType=="number"){n.MeasurementType=e.MeasurementType;break}break;case"depth_meters":case 0:n.MeasurementType=0;break;case"water_temp_celsius":case 1:n.MeasurementType=1;break;case"pressure_mbar":case 2:n.MeasurementType=2;break;case"yaw_degrees":case 3:n.MeasurementType=3;break;case"pitch_degrees":case 4:n.MeasurementType=4;break;case"roll_degrees":case 5:n.MeasurementType=5;break;case"x_acceleration_m_s2":case 6:n.MeasurementType=6;break;case"y_acceleration_m_s2":case 7:n.MeasurementType=7;break;case"z_acceleration_m_s2":case 8:n.MeasurementType=8;break;case"battery_voltage":case 9:n.MeasurementType=9;break;case"battery_current_amps":case 10:n.MeasurementType=10;break;case"internal_temp_celsius":case 11:n.MeasurementType=11;break}return e.Value!=null&&(n.Value=Number(e.Value)),n},t.toObject=function(e,n){n||(n={});let a={};return n.defaults&&(a.MeasurementType=n.enums===String?"depth_meters":0,a.Value=0),e.MeasurementType!=null&&e.hasOwnProperty("MeasurementType")&&(a.MeasurementType=n.enums===String?$root.rov_actions_proto.SensorMeasurmentTypes[e.MeasurementType]===void 0?e.MeasurementType:$root.rov_actions_proto.SensorMeasurmentTypes[e.MeasurementType]:e.MeasurementType),e.Value!=null&&e.hasOwnProperty("Value")&&(a.Value=n.json&&!isFinite(e.Value)?String(e.Value):e.Value),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.Measurement"},t}(),s.SensorUpdatesResponse=function(){function t(o){if(this.MeasurementUpdates=[],o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.MeasurementUpdates=$util.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,n){if(n||(n=$Writer.create()),e.MeasurementUpdates!=null&&e.MeasurementUpdates.length)for(let a=0;a<e.MeasurementUpdates.length;++a)$root.rov_actions_proto.Measurement.encode(e.MeasurementUpdates[a],n.uint32(10).fork()).ldelim();return n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.SensorUpdatesResponse;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.MeasurementUpdates&&c.MeasurementUpdates.length||(c.MeasurementUpdates=[]),c.MeasurementUpdates.push($root.rov_actions_proto.Measurement.decode(e,e.uint32()));break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.MeasurementUpdates!=null&&e.hasOwnProperty("MeasurementUpdates")){if(!Array.isArray(e.MeasurementUpdates))return"MeasurementUpdates: array expected";for(let n=0;n<e.MeasurementUpdates.length;++n){let a=$root.rov_actions_proto.Measurement.verify(e.MeasurementUpdates[n]);if(a)return"MeasurementUpdates."+a}}return null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.SensorUpdatesResponse)return e;let n=new $root.rov_actions_proto.SensorUpdatesResponse;if(e.MeasurementUpdates){if(!Array.isArray(e.MeasurementUpdates))throw TypeError(".rov_actions_proto.SensorUpdatesResponse.MeasurementUpdates: array expected");n.MeasurementUpdates=[];for(let a=0;a<e.MeasurementUpdates.length;++a){if(typeof e.MeasurementUpdates[a]!="object")throw TypeError(".rov_actions_proto.SensorUpdatesResponse.MeasurementUpdates: object expected");n.MeasurementUpdates[a]=$root.rov_actions_proto.Measurement.fromObject(e.MeasurementUpdates[a])}}return n},t.toObject=function(e,n){n||(n={});let a={};if((n.arrays||n.defaults)&&(a.MeasurementUpdates=[]),e.MeasurementUpdates&&e.MeasurementUpdates.length){a.MeasurementUpdates=[];for(let c=0;c<e.MeasurementUpdates.length;++c)a.MeasurementUpdates[c]=$root.rov_actions_proto.Measurement.toObject(e.MeasurementUpdates[c],n)}return a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SensorUpdatesResponse"},t}(),s.PasswordRequiredResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.RovId="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.RovId!=null&&Object.hasOwnProperty.call(e,"RovId")&&n.uint32(10).string(e.RovId),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.PasswordRequiredResponse;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.RovId=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.RovId!=null&&e.hasOwnProperty("RovId")&&!$util.isString(e.RovId)?"RovId: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.PasswordRequiredResponse)return e;let n=new $root.rov_actions_proto.PasswordRequiredResponse;return e.RovId!=null&&(n.RovId=String(e.RovId)),n},t.toObject=function(e,n){n||(n={});let a={};return n.defaults&&(a.RovId=""),e.RovId!=null&&e.hasOwnProperty("RovId")&&(a.RovId=e.RovId),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.PasswordRequiredResponse"},t}(),s.PasswordAcceptedResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.AuthToken="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.AuthToken!=null&&Object.hasOwnProperty.call(e,"AuthToken")&&n.uint32(10).string(e.AuthToken),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.PasswordAcceptedResponse;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.AuthToken=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.AuthToken!=null&&e.hasOwnProperty("AuthToken")&&!$util.isString(e.AuthToken)?"AuthToken: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.PasswordAcceptedResponse)return e;let n=new $root.rov_actions_proto.PasswordAcceptedResponse;return e.AuthToken!=null&&(n.AuthToken=String(e.AuthToken)),n},t.toObject=function(e,n){n||(n={});let a={};return n.defaults&&(a.AuthToken=""),e.AuthToken!=null&&e.hasOwnProperty("AuthToken")&&(a.AuthToken=e.AuthToken),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.PasswordAcceptedResponse"},t}(),s.PasswordInvalidResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.PasswordInvalidResponse;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.PasswordInvalidResponse?e:new $root.rov_actions_proto.PasswordInvalidResponse},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.PasswordInvalidResponse"},t}(),s.PilotChangedResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.PilotIdentity="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.PilotIdentity!=null&&Object.hasOwnProperty.call(e,"PilotIdentity")&&n.uint32(10).string(e.PilotIdentity),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.PilotChangedResponse;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.PilotIdentity=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.PilotIdentity!=null&&e.hasOwnProperty("PilotIdentity")&&!$util.isString(e.PilotIdentity)?"PilotIdentity: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.PilotChangedResponse)return e;let n=new $root.rov_actions_proto.PilotChangedResponse;return e.PilotIdentity!=null&&(n.PilotIdentity=String(e.PilotIdentity)),n},t.toObject=function(e,n){n||(n={});let a={};return n.defaults&&(a.PilotIdentity=""),e.PilotIdentity!=null&&e.hasOwnProperty("PilotIdentity")&&(a.PilotIdentity=e.PilotIdentity),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.PilotChangedResponse"},t}(),s.ClientConnectedResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.ClientPeerId="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.ClientPeerId!=null&&Object.hasOwnProperty.call(e,"ClientPeerId")&&n.uint32(10).string(e.ClientPeerId),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.ClientConnectedResponse;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.ClientPeerId=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.ClientPeerId!=null&&e.hasOwnProperty("ClientPeerId")&&!$util.isString(e.ClientPeerId)?"ClientPeerId: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.ClientConnectedResponse)return e;let n=new $root.rov_actions_proto.ClientConnectedResponse;return e.ClientPeerId!=null&&(n.ClientPeerId=String(e.ClientPeerId)),n},t.toObject=function(e,n){n||(n={});let a={};return n.defaults&&(a.ClientPeerId=""),e.ClientPeerId!=null&&e.hasOwnProperty("ClientPeerId")&&(a.ClientPeerId=e.ClientPeerId),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.ClientConnectedResponse"},t}(),s.ClientDisconnectedResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.ClientPeerId="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.ClientPeerId!=null&&Object.hasOwnProperty.call(e,"ClientPeerId")&&n.uint32(10).string(e.ClientPeerId),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.ClientDisconnectedResponse;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.ClientPeerId=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.ClientPeerId!=null&&e.hasOwnProperty("ClientPeerId")&&!$util.isString(e.ClientPeerId)?"ClientPeerId: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.ClientDisconnectedResponse)return e;let n=new $root.rov_actions_proto.ClientDisconnectedResponse;return e.ClientPeerId!=null&&(n.ClientPeerId=String(e.ClientPeerId)),n},t.toObject=function(e,n){n||(n={});let a={};return n.defaults&&(a.ClientPeerId=""),e.ClientPeerId!=null&&e.hasOwnProperty("ClientPeerId")&&(a.ClientPeerId=e.ClientPeerId),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.ClientDisconnectedResponse"},t}(),s.HeartbeatResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Time=$util.Long?$util.Long.fromBits(0,0,!1):0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Time!=null&&Object.hasOwnProperty.call(e,"Time")&&n.uint32(8).int64(e.Time),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.HeartbeatResponse;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.Time=e.int64();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Time!=null&&e.hasOwnProperty("Time")&&!$util.isInteger(e.Time)&&!(e.Time&&$util.isInteger(e.Time.low)&&$util.isInteger(e.Time.high))?"Time: integer|Long expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.HeartbeatResponse)return e;let n=new $root.rov_actions_proto.HeartbeatResponse;return e.Time!=null&&($util.Long?(n.Time=$util.Long.fromValue(e.Time)).unsigned=!1:typeof e.Time=="string"?n.Time=parseInt(e.Time,10):typeof e.Time=="number"?n.Time=e.Time:typeof e.Time=="object"&&(n.Time=new $util.LongBits(e.Time.low>>>0,e.Time.high>>>0).toNumber())),n},t.toObject=function(e,n){n||(n={});let a={};if(n.defaults)if($util.Long){let c=new $util.Long(0,0,!1);a.Time=n.longs===String?c.toString():n.longs===Number?c.toNumber():c}else a.Time=n.longs===String?"0":0;return e.Time!=null&&e.hasOwnProperty("Time")&&(typeof e.Time=="number"?a.Time=n.longs===String?String(e.Time):e.Time:a.Time=n.longs===String?$util.Long.prototype.toString.call(e.Time):n.longs===Number?new $util.LongBits(e.Time.low>>>0,e.Time.high>>>0).toNumber():e.Time),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.HeartbeatResponse"},t}(),s.ContinuedOutputResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Message="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Message!=null&&Object.hasOwnProperty.call(e,"Message")&&n.uint32(10).string(e.Message),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.ContinuedOutputResponse;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.Message=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Message!=null&&e.hasOwnProperty("Message")&&!$util.isString(e.Message)?"Message: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.ContinuedOutputResponse)return e;let n=new $root.rov_actions_proto.ContinuedOutputResponse;return e.Message!=null&&(n.Message=String(e.Message)),n},t.toObject=function(e,n){n||(n={});let a={};return n.defaults&&(a.Message=""),e.Message!=null&&e.hasOwnProperty("Message")&&(a.Message=e.Message),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.ContinuedOutputResponse"},t}(),s.MavlinkResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Message=$util.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Message!=null&&Object.hasOwnProperty.call(e,"Message")&&n.uint32(10).bytes(e.Message),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.MavlinkResponse;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.Message=e.bytes();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Message!=null&&e.hasOwnProperty("Message")&&!(e.Message&&typeof e.Message.length=="number"||$util.isString(e.Message))?"Message: buffer expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.MavlinkResponse)return e;let n=new $root.rov_actions_proto.MavlinkResponse;return e.Message!=null&&(typeof e.Message=="string"?$util.base64.decode(e.Message,n.Message=$util.newBuffer($util.base64.length(e.Message)),0):e.Message.length>=0&&(n.Message=e.Message)),n},t.toObject=function(e,n){n||(n={});let a={};return n.defaults&&(n.bytes===String?a.Message="":(a.Message=[],n.bytes!==Array&&(a.Message=$util.newBuffer(a.Message)))),e.Message!=null&&e.hasOwnProperty("Message")&&(a.Message=n.bytes===String?$util.base64.encode(e.Message,0,e.Message.length):n.bytes===Array?Array.prototype.slice.call(e.Message):e.Message),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.MavlinkResponse"},t}(),s.SimplePeerSignalResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Message="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Message!=null&&Object.hasOwnProperty.call(e,"Message")&&n.uint32(10).string(e.Message),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.SimplePeerSignalResponse;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.Message=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Message!=null&&e.hasOwnProperty("Message")&&!$util.isString(e.Message)?"Message: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.SimplePeerSignalResponse)return e;let n=new $root.rov_actions_proto.SimplePeerSignalResponse;return e.Message!=null&&(n.Message=String(e.Message)),n},t.toObject=function(e,n){n||(n={});let a={};return n.defaults&&(a.Message=""),e.Message!=null&&e.hasOwnProperty("Message")&&(a.Message=e.Message),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SimplePeerSignalResponse"},t}(),s.SystemMonitorResponse=function(){function t(o){if(this.Warnings=[],o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.CpuTemp=0,t.prototype.CpuUsage=0,t.prototype.MemoryUsage=0,t.prototype.DiskUsage=0,t.prototype.Warnings=$util.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,n){if(n||(n=$Writer.create()),e.CpuTemp!=null&&Object.hasOwnProperty.call(e,"CpuTemp")&&n.uint32(13).float(e.CpuTemp),e.CpuUsage!=null&&Object.hasOwnProperty.call(e,"CpuUsage")&&n.uint32(21).float(e.CpuUsage),e.MemoryUsage!=null&&Object.hasOwnProperty.call(e,"MemoryUsage")&&n.uint32(29).float(e.MemoryUsage),e.DiskUsage!=null&&Object.hasOwnProperty.call(e,"DiskUsage")&&n.uint32(37).float(e.DiskUsage),e.Warnings!=null&&e.Warnings.length)for(let a=0;a<e.Warnings.length;++a)n.uint32(42).string(e.Warnings[a]);return n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.SystemMonitorResponse;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.CpuTemp=e.float();break}case 2:{c.CpuUsage=e.float();break}case 3:{c.MemoryUsage=e.float();break}case 4:{c.DiskUsage=e.float();break}case 5:{c.Warnings&&c.Warnings.length||(c.Warnings=[]),c.Warnings.push(e.string());break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.CpuTemp!=null&&e.hasOwnProperty("CpuTemp")&&typeof e.CpuTemp!="number")return"CpuTemp: number expected";if(e.CpuUsage!=null&&e.hasOwnProperty("CpuUsage")&&typeof e.CpuUsage!="number")return"CpuUsage: number expected";if(e.MemoryUsage!=null&&e.hasOwnProperty("MemoryUsage")&&typeof e.MemoryUsage!="number")return"MemoryUsage: number expected";if(e.DiskUsage!=null&&e.hasOwnProperty("DiskUsage")&&typeof e.DiskUsage!="number")return"DiskUsage: number expected";if(e.Warnings!=null&&e.hasOwnProperty("Warnings")){if(!Array.isArray(e.Warnings))return"Warnings: array expected";for(let n=0;n<e.Warnings.length;++n)if(!$util.isString(e.Warnings[n]))return"Warnings: string[] expected"}return null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.SystemMonitorResponse)return e;let n=new $root.rov_actions_proto.SystemMonitorResponse;if(e.CpuTemp!=null&&(n.CpuTemp=Number(e.CpuTemp)),e.CpuUsage!=null&&(n.CpuUsage=Number(e.CpuUsage)),e.MemoryUsage!=null&&(n.MemoryUsage=Number(e.MemoryUsage)),e.DiskUsage!=null&&(n.DiskUsage=Number(e.DiskUsage)),e.Warnings){if(!Array.isArray(e.Warnings))throw TypeError(".rov_actions_proto.SystemMonitorResponse.Warnings: array expected");n.Warnings=[];for(let a=0;a<e.Warnings.length;++a)n.Warnings[a]=String(e.Warnings[a])}return n},t.toObject=function(e,n){n||(n={});let a={};if((n.arrays||n.defaults)&&(a.Warnings=[]),n.defaults&&(a.CpuTemp=0,a.CpuUsage=0,a.MemoryUsage=0,a.DiskUsage=0),e.CpuTemp!=null&&e.hasOwnProperty("CpuTemp")&&(a.CpuTemp=n.json&&!isFinite(e.CpuTemp)?String(e.CpuTemp):e.CpuTemp),e.CpuUsage!=null&&e.hasOwnProperty("CpuUsage")&&(a.CpuUsage=n.json&&!isFinite(e.CpuUsage)?String(e.CpuUsage):e.CpuUsage),e.MemoryUsage!=null&&e.hasOwnProperty("MemoryUsage")&&(a.MemoryUsage=n.json&&!isFinite(e.MemoryUsage)?String(e.MemoryUsage):e.MemoryUsage),e.DiskUsage!=null&&e.hasOwnProperty("DiskUsage")&&(a.DiskUsage=n.json&&!isFinite(e.DiskUsage)?String(e.DiskUsage):e.DiskUsage),e.Warnings&&e.Warnings.length){a.Warnings=[];for(let c=0;c<e.Warnings.length;++c)a.Warnings[c]=e.Warnings[c]}return a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SystemMonitorResponse"},t}(),s.LogMessageResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Message="",t.prototype.Level=0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Message!=null&&Object.hasOwnProperty.call(e,"Message")&&n.uint32(10).string(e.Message),e.Level!=null&&Object.hasOwnProperty.call(e,"Level")&&n.uint32(16).int32(e.Level),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.LogMessageResponse;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.Message=e.string();break}case 2:{c.Level=e.int32();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.Message!=null&&e.hasOwnProperty("Message")&&!$util.isString(e.Message))return"Message: string expected";if(e.Level!=null&&e.hasOwnProperty("Level"))switch(e.Level){default:return"Level: enum value expected";case 0:case 1:case 2:case 3:case 4:break}return null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.LogMessageResponse)return e;let n=new $root.rov_actions_proto.LogMessageResponse;switch(e.Message!=null&&(n.Message=String(e.Message)),e.Level){default:if(typeof e.Level=="number"){n.Level=e.Level;break}break;case"Debug":case 0:n.Level=0;break;case"Info":case 1:n.Level=1;break;case"Warning":case 2:n.Level=2;break;case"Error":case 3:n.Level=3;break;case"Critical":case 4:n.Level=4;break}return n},t.toObject=function(e,n){n||(n={});let a={};return n.defaults&&(a.Message="",a.Level=n.enums===String?"Debug":0),e.Message!=null&&e.hasOwnProperty("Message")&&(a.Message=e.Message),e.Level!=null&&e.hasOwnProperty("Level")&&(a.Level=n.enums===String?$root.rov_actions_proto.LogLevel[e.Level]===void 0?e.Level:$root.rov_actions_proto.LogLevel[e.Level]:e.Level),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.LogMessageResponse"},t}(),s.LivekitVideoStatsResponse=function(){function t(o){if(this.SimulcastLayers=[],o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Enabled=!1,t.prototype.Codec=0,t.prototype.AllowBackupCodec=!1,t.prototype.BaseStream=null,t.prototype.SimulcastLayers=$util.emptyArray,t.prototype.RtcSenderStatsJson="",t.create=function(e){return new t(e)},t.encode=function(e,n){if(n||(n=$Writer.create()),e.Enabled!=null&&Object.hasOwnProperty.call(e,"Enabled")&&n.uint32(8).bool(e.Enabled),e.Codec!=null&&Object.hasOwnProperty.call(e,"Codec")&&n.uint32(16).int32(e.Codec),e.AllowBackupCodec!=null&&Object.hasOwnProperty.call(e,"AllowBackupCodec")&&n.uint32(24).bool(e.AllowBackupCodec),e.BaseStream!=null&&Object.hasOwnProperty.call(e,"BaseStream")&&$root.rov_actions_proto.VideoStreamOptions.encode(e.BaseStream,n.uint32(34).fork()).ldelim(),e.SimulcastLayers!=null&&e.SimulcastLayers.length)for(let a=0;a<e.SimulcastLayers.length;++a)$root.rov_actions_proto.VideoStreamOptions.encode(e.SimulcastLayers[a],n.uint32(42).fork()).ldelim();return e.RtcSenderStatsJson!=null&&Object.hasOwnProperty.call(e,"RtcSenderStatsJson")&&n.uint32(50).string(e.RtcSenderStatsJson),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.LivekitVideoStatsResponse;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.Enabled=e.bool();break}case 2:{c.Codec=e.int32();break}case 3:{c.AllowBackupCodec=e.bool();break}case 4:{c.BaseStream=$root.rov_actions_proto.VideoStreamOptions.decode(e,e.uint32());break}case 5:{c.SimulcastLayers&&c.SimulcastLayers.length||(c.SimulcastLayers=[]),c.SimulcastLayers.push($root.rov_actions_proto.VideoStreamOptions.decode(e,e.uint32()));break}case 6:{c.RtcSenderStatsJson=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.Enabled!=null&&e.hasOwnProperty("Enabled")&&typeof e.Enabled!="boolean")return"Enabled: boolean expected";if(e.Codec!=null&&e.hasOwnProperty("Codec"))switch(e.Codec){default:return"Codec: enum value expected";case 0:case 1:case 2:case 3:break}if(e.AllowBackupCodec!=null&&e.hasOwnProperty("AllowBackupCodec")&&typeof e.AllowBackupCodec!="boolean")return"AllowBackupCodec: boolean expected";if(e.BaseStream!=null&&e.hasOwnProperty("BaseStream")){let n=$root.rov_actions_proto.VideoStreamOptions.verify(e.BaseStream);if(n)return"BaseStream."+n}if(e.SimulcastLayers!=null&&e.hasOwnProperty("SimulcastLayers")){if(!Array.isArray(e.SimulcastLayers))return"SimulcastLayers: array expected";for(let n=0;n<e.SimulcastLayers.length;++n){let a=$root.rov_actions_proto.VideoStreamOptions.verify(e.SimulcastLayers[n]);if(a)return"SimulcastLayers."+a}}return e.RtcSenderStatsJson!=null&&e.hasOwnProperty("RtcSenderStatsJson")&&!$util.isString(e.RtcSenderStatsJson)?"RtcSenderStatsJson: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.LivekitVideoStatsResponse)return e;let n=new $root.rov_actions_proto.LivekitVideoStatsResponse;switch(e.Enabled!=null&&(n.Enabled=!!e.Enabled),e.Codec){default:if(typeof e.Codec=="number"){n.Codec=e.Codec;break}break;case"H264":case 0:n.Codec=0;break;case"VP8":case 1:n.Codec=1;break;case"VP9":case 2:n.Codec=2;break;case"AV1":case 3:n.Codec=3;break}if(e.AllowBackupCodec!=null&&(n.AllowBackupCodec=!!e.AllowBackupCodec),e.BaseStream!=null){if(typeof e.BaseStream!="object")throw TypeError(".rov_actions_proto.LivekitVideoStatsResponse.BaseStream: object expected");n.BaseStream=$root.rov_actions_proto.VideoStreamOptions.fromObject(e.BaseStream)}if(e.SimulcastLayers){if(!Array.isArray(e.SimulcastLayers))throw TypeError(".rov_actions_proto.LivekitVideoStatsResponse.SimulcastLayers: array expected");n.SimulcastLayers=[];for(let a=0;a<e.SimulcastLayers.length;++a){if(typeof e.SimulcastLayers[a]!="object")throw TypeError(".rov_actions_proto.LivekitVideoStatsResponse.SimulcastLayers: object expected");n.SimulcastLayers[a]=$root.rov_actions_proto.VideoStreamOptions.fromObject(e.SimulcastLayers[a])}}return e.RtcSenderStatsJson!=null&&(n.RtcSenderStatsJson=String(e.RtcSenderStatsJson)),n},t.toObject=function(e,n){n||(n={});let a={};if((n.arrays||n.defaults)&&(a.SimulcastLayers=[]),n.defaults&&(a.Enabled=!1,a.Codec=n.enums===String?"H264":0,a.AllowBackupCodec=!1,a.BaseStream=null,a.RtcSenderStatsJson=""),e.Enabled!=null&&e.hasOwnProperty("Enabled")&&(a.Enabled=e.Enabled),e.Codec!=null&&e.hasOwnProperty("Codec")&&(a.Codec=n.enums===String?$root.rov_actions_proto.VideoCodec[e.Codec]===void 0?e.Codec:$root.rov_actions_proto.VideoCodec[e.Codec]:e.Codec),e.AllowBackupCodec!=null&&e.hasOwnProperty("AllowBackupCodec")&&(a.AllowBackupCodec=e.AllowBackupCodec),e.BaseStream!=null&&e.hasOwnProperty("BaseStream")&&(a.BaseStream=$root.rov_actions_proto.VideoStreamOptions.toObject(e.BaseStream,n)),e.SimulcastLayers&&e.SimulcastLayers.length){a.SimulcastLayers=[];for(let c=0;c<e.SimulcastLayers.length;++c)a.SimulcastLayers[c]=$root.rov_actions_proto.VideoStreamOptions.toObject(e.SimulcastLayers[c],n)}return e.RtcSenderStatsJson!=null&&e.hasOwnProperty("RtcSenderStatsJson")&&(a.RtcSenderStatsJson=e.RtcSenderStatsJson),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.LivekitVideoStatsResponse"},t}(),s.SimplePeerVideoStatsResponse=function(){function t(o){if(o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.Enabled=!1,t.prototype.Codec=0,t.prototype.BaseStream=null,t.prototype.RtcSenderStatsJson="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Enabled!=null&&Object.hasOwnProperty.call(e,"Enabled")&&n.uint32(8).bool(e.Enabled),e.Codec!=null&&Object.hasOwnProperty.call(e,"Codec")&&n.uint32(16).int32(e.Codec),e.BaseStream!=null&&Object.hasOwnProperty.call(e,"BaseStream")&&$root.rov_actions_proto.VideoStreamOptions.encode(e.BaseStream,n.uint32(26).fork()).ldelim(),e.RtcSenderStatsJson!=null&&Object.hasOwnProperty.call(e,"RtcSenderStatsJson")&&n.uint32(34).string(e.RtcSenderStatsJson),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.SimplePeerVideoStatsResponse;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.Enabled=e.bool();break}case 2:{c.Codec=e.int32();break}case 3:{c.BaseStream=$root.rov_actions_proto.VideoStreamOptions.decode(e,e.uint32());break}case 4:{c.RtcSenderStatsJson=e.string();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.Enabled!=null&&e.hasOwnProperty("Enabled")&&typeof e.Enabled!="boolean")return"Enabled: boolean expected";if(e.Codec!=null&&e.hasOwnProperty("Codec"))switch(e.Codec){default:return"Codec: enum value expected";case 0:case 1:case 2:case 3:break}if(e.BaseStream!=null&&e.hasOwnProperty("BaseStream")){let n=$root.rov_actions_proto.VideoStreamOptions.verify(e.BaseStream);if(n)return"BaseStream."+n}return e.RtcSenderStatsJson!=null&&e.hasOwnProperty("RtcSenderStatsJson")&&!$util.isString(e.RtcSenderStatsJson)?"RtcSenderStatsJson: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.SimplePeerVideoStatsResponse)return e;let n=new $root.rov_actions_proto.SimplePeerVideoStatsResponse;switch(e.Enabled!=null&&(n.Enabled=!!e.Enabled),e.Codec){default:if(typeof e.Codec=="number"){n.Codec=e.Codec;break}break;case"H264":case 0:n.Codec=0;break;case"VP8":case 1:n.Codec=1;break;case"VP9":case 2:n.Codec=2;break;case"AV1":case 3:n.Codec=3;break}if(e.BaseStream!=null){if(typeof e.BaseStream!="object")throw TypeError(".rov_actions_proto.SimplePeerVideoStatsResponse.BaseStream: object expected");n.BaseStream=$root.rov_actions_proto.VideoStreamOptions.fromObject(e.BaseStream)}return e.RtcSenderStatsJson!=null&&(n.RtcSenderStatsJson=String(e.RtcSenderStatsJson)),n},t.toObject=function(e,n){n||(n={});let a={};return n.defaults&&(a.Enabled=!1,a.Codec=n.enums===String?"H264":0,a.BaseStream=null,a.RtcSenderStatsJson=""),e.Enabled!=null&&e.hasOwnProperty("Enabled")&&(a.Enabled=e.Enabled),e.Codec!=null&&e.hasOwnProperty("Codec")&&(a.Codec=n.enums===String?$root.rov_actions_proto.VideoCodec[e.Codec]===void 0?e.Codec:$root.rov_actions_proto.VideoCodec[e.Codec]:e.Codec),e.BaseStream!=null&&e.hasOwnProperty("BaseStream")&&(a.BaseStream=$root.rov_actions_proto.VideoStreamOptions.toObject(e.BaseStream,n)),e.RtcSenderStatsJson!=null&&e.hasOwnProperty("RtcSenderStatsJson")&&(a.RtcSenderStatsJson=e.RtcSenderStatsJson),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SimplePeerVideoStatsResponse"},t}(),s.ResponseBackendMetadata=function(){function t(o){if(this.TargetUserIds=[],o)for(let e=Object.keys(o),n=0;n<e.length;++n)o[e[n]]!=null&&(this[e[n]]=o[e[n]])}return t.prototype.TargetUserIds=$util.emptyArray,t.prototype.TransportMethod=0,t.create=function(e){return new t(e)},t.encode=function(e,n){if(n||(n=$Writer.create()),e.TargetUserIds!=null&&e.TargetUserIds.length)for(let a=0;a<e.TargetUserIds.length;++a)n.uint32(10).string(e.TargetUserIds[a]);return e.TransportMethod!=null&&Object.hasOwnProperty.call(e,"TransportMethod")&&n.uint32(16).int32(e.TransportMethod),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let a=n===void 0?e.len:e.pos+n,c=new $root.rov_actions_proto.ResponseBackendMetadata;for(;e.pos<a;){let l=e.uint32();switch(l>>>3){case 1:{c.TargetUserIds&&c.TargetUserIds.length||(c.TargetUserIds=[]),c.TargetUserIds.push(e.string());break}case 2:{c.TransportMethod=e.int32();break}default:e.skipType(l&7);break}}return c},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.TargetUserIds!=null&&e.hasOwnProperty("TargetUserIds")){if(!Array.isArray(e.TargetUserIds))return"TargetUserIds: array expected";for(let n=0;n<e.TargetUserIds.length;++n)if(!$util.isString(e.TargetUserIds[n]))return"TargetUserIds: string[] expected"}if(e.TransportMethod!=null&&e.hasOwnProperty("TransportMethod"))switch(e.TransportMethod){default:return"TransportMethod: enum value expected";case 0:case 1:case 2:case 3:break}return null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.ResponseBackendMetadata)return e;let n=new $root.rov_actions_proto.ResponseBackendMetadata;if(e.TargetUserIds){if(!Array.isArray(e.TargetUserIds))throw TypeError(".rov_actions_proto.ResponseBackendMetadata.TargetUserIds: array expected");n.TargetUserIds=[];for(let a=0;a<e.TargetUserIds.length;++a)n.TargetUserIds[a]=String(e.TargetUserIds[a])}switch(e.TransportMethod){default:if(typeof e.TransportMethod=="number"){n.TransportMethod=e.TransportMethod;break}break;case"LivekitReliable":case 0:n.TransportMethod=0;break;case"LivekitUnreliable":case 1:n.TransportMethod=1;break;case"DirectReliable":case 2:n.TransportMethod=2;break;case"DirectUnreliable":case 3:n.TransportMethod=3;break}return n},t.toObject=function(e,n){n||(n={});let a={};if((n.arrays||n.defaults)&&(a.TargetUserIds=[]),n.defaults&&(a.TransportMethod=n.enums===String?"LivekitReliable":0),e.TargetUserIds&&e.TargetUserIds.length){a.TargetUserIds=[];for(let c=0;c<e.TargetUserIds.length;++c)a.TargetUserIds[c]=e.TargetUserIds[c]}return e.TransportMethod!=null&&e.hasOwnProperty("TransportMethod")&&(a.TransportMethod=n.enums===String?$root.rov_actions_proto.DataTransportMethod[e.TransportMethod]===void 0?e.TransportMethod:$root.rov_actions_proto.DataTransportMethod[e.TransportMethod]:e.TransportMethod),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.ResponseBackendMetadata"},t}(),s.RovResponse=function(){function t(e){if(e)for(let n=Object.keys(e),a=0;a<n.length;++a)e[n[a]]!=null&&(this[n[a]]=e[n[a]])}t.prototype.BackendMetadata=null,t.prototype.ExchangeId=0,t.prototype.Done=null,t.prototype.Error=null,t.prototype.Pong=null,t.prototype.ContinuedOutput=null,t.prototype.SensorUpdates=null,t.prototype.PasswordRequired=null,t.prototype.PasswordAccepted=null,t.prototype.PasswordInvalid=null,t.prototype.PilotChanged=null,t.prototype.ClientConnected=null,t.prototype.ClientDisconnected=null,t.prototype.Heartbeat=null,t.prototype.Mavlink=null,t.prototype.SimplePeerSignal=null,t.prototype.SystemMonitor=null,t.prototype.LogMessage=null,t.prototype.LivekitVideoStats=null,t.prototype.SimplePeerVideoStats=null;let o;return Object.defineProperty(t.prototype,"Body",{get:$util.oneOfGetter(o=["Done","Error","Pong","ContinuedOutput","SensorUpdates","PasswordRequired","PasswordAccepted","PasswordInvalid","PilotChanged","ClientConnected","ClientDisconnected","Heartbeat","Mavlink","SimplePeerSignal","SystemMonitor","LogMessage","LivekitVideoStats","SimplePeerVideoStats"]),set:$util.oneOfSetter(o)}),t.create=function(n){return new t(n)},t.encode=function(n,a){return a||(a=$Writer.create()),n.BackendMetadata!=null&&Object.hasOwnProperty.call(n,"BackendMetadata")&&$root.rov_actions_proto.ResponseBackendMetadata.encode(n.BackendMetadata,a.uint32(10).fork()).ldelim(),n.ExchangeId!=null&&Object.hasOwnProperty.call(n,"ExchangeId")&&a.uint32(16).int32(n.ExchangeId),n.Done!=null&&Object.hasOwnProperty.call(n,"Done")&&$root.rov_actions_proto.DoneResponse.encode(n.Done,a.uint32(26).fork()).ldelim(),n.Error!=null&&Object.hasOwnProperty.call(n,"Error")&&$root.rov_actions_proto.ErrorResponse.encode(n.Error,a.uint32(34).fork()).ldelim(),n.Pong!=null&&Object.hasOwnProperty.call(n,"Pong")&&$root.rov_actions_proto.PongResponse.encode(n.Pong,a.uint32(42).fork()).ldelim(),n.ContinuedOutput!=null&&Object.hasOwnProperty.call(n,"ContinuedOutput")&&$root.rov_actions_proto.ContinuedOutputResponse.encode(n.ContinuedOutput,a.uint32(50).fork()).ldelim(),n.SensorUpdates!=null&&Object.hasOwnProperty.call(n,"SensorUpdates")&&$root.rov_actions_proto.SensorUpdatesResponse.encode(n.SensorUpdates,a.uint32(58).fork()).ldelim(),n.PasswordRequired!=null&&Object.hasOwnProperty.call(n,"PasswordRequired")&&$root.rov_actions_proto.PasswordRequiredResponse.encode(n.PasswordRequired,a.uint32(66).fork()).ldelim(),n.PasswordAccepted!=null&&Object.hasOwnProperty.call(n,"PasswordAccepted")&&$root.rov_actions_proto.PasswordAcceptedResponse.encode(n.PasswordAccepted,a.uint32(74).fork()).ldelim(),n.PasswordInvalid!=null&&Object.hasOwnProperty.call(n,"PasswordInvalid")&&$root.rov_actions_proto.PasswordInvalidResponse.encode(n.PasswordInvalid,a.uint32(82).fork()).ldelim(),n.PilotChanged!=null&&Object.hasOwnProperty.call(n,"PilotChanged")&&$root.rov_actions_proto.PilotChangedResponse.encode(n.PilotChanged,a.uint32(106).fork()).ldelim(),n.ClientConnected!=null&&Object.hasOwnProperty.call(n,"ClientConnected")&&$root.rov_actions_proto.ClientConnectedResponse.encode(n.ClientConnected,a.uint32(114).fork()).ldelim(),n.ClientDisconnected!=null&&Object.hasOwnProperty.call(n,"ClientDisconnected")&&$root.rov_actions_proto.ClientDisconnectedResponse.encode(n.ClientDisconnected,a.uint32(122).fork()).ldelim(),n.Heartbeat!=null&&Object.hasOwnProperty.call(n,"Heartbeat")&&$root.rov_actions_proto.HeartbeatResponse.encode(n.Heartbeat,a.uint32(130).fork()).ldelim(),n.Mavlink!=null&&Object.hasOwnProperty.call(n,"Mavlink")&&$root.rov_actions_proto.MavlinkResponse.encode(n.Mavlink,a.uint32(138).fork()).ldelim(),n.SimplePeerSignal!=null&&Object.hasOwnProperty.call(n,"SimplePeerSignal")&&$root.rov_actions_proto.SimplePeerSignalResponse.encode(n.SimplePeerSignal,a.uint32(146).fork()).ldelim(),n.SystemMonitor!=null&&Object.hasOwnProperty.call(n,"SystemMonitor")&&$root.rov_actions_proto.SystemMonitorResponse.encode(n.SystemMonitor,a.uint32(154).fork()).ldelim(),n.LogMessage!=null&&Object.hasOwnProperty.call(n,"LogMessage")&&$root.rov_actions_proto.LogMessageResponse.encode(n.LogMessage,a.uint32(162).fork()).ldelim(),n.LivekitVideoStats!=null&&Object.hasOwnProperty.call(n,"LivekitVideoStats")&&$root.rov_actions_proto.LivekitVideoStatsResponse.encode(n.LivekitVideoStats,a.uint32(170).fork()).ldelim(),n.SimplePeerVideoStats!=null&&Object.hasOwnProperty.call(n,"SimplePeerVideoStats")&&$root.rov_actions_proto.SimplePeerVideoStatsResponse.encode(n.SimplePeerVideoStats,a.uint32(178).fork()).ldelim(),a},t.encodeDelimited=function(n,a){return this.encode(n,a).ldelim()},t.decode=function(n,a){n instanceof $Reader||(n=$Reader.create(n));let c=a===void 0?n.len:n.pos+a,l=new $root.rov_actions_proto.RovResponse;for(;n.pos<c;){let u=n.uint32();switch(u>>>3){case 1:{l.BackendMetadata=$root.rov_actions_proto.ResponseBackendMetadata.decode(n,n.uint32());break}case 2:{l.ExchangeId=n.int32();break}case 3:{l.Done=$root.rov_actions_proto.DoneResponse.decode(n,n.uint32());break}case 4:{l.Error=$root.rov_actions_proto.ErrorResponse.decode(n,n.uint32());break}case 5:{l.Pong=$root.rov_actions_proto.PongResponse.decode(n,n.uint32());break}case 6:{l.ContinuedOutput=$root.rov_actions_proto.ContinuedOutputResponse.decode(n,n.uint32());break}case 7:{l.SensorUpdates=$root.rov_actions_proto.SensorUpdatesResponse.decode(n,n.uint32());break}case 8:{l.PasswordRequired=$root.rov_actions_proto.PasswordRequiredResponse.decode(n,n.uint32());break}case 9:{l.PasswordAccepted=$root.rov_actions_proto.PasswordAcceptedResponse.decode(n,n.uint32());break}case 10:{l.PasswordInvalid=$root.rov_actions_proto.PasswordInvalidResponse.decode(n,n.uint32());break}case 13:{l.PilotChanged=$root.rov_actions_proto.PilotChangedResponse.decode(n,n.uint32());break}case 14:{l.ClientConnected=$root.rov_actions_proto.ClientConnectedResponse.decode(n,n.uint32());break}case 15:{l.ClientDisconnected=$root.rov_actions_proto.ClientDisconnectedResponse.decode(n,n.uint32());break}case 16:{l.Heartbeat=$root.rov_actions_proto.HeartbeatResponse.decode(n,n.uint32());break}case 17:{l.Mavlink=$root.rov_actions_proto.MavlinkResponse.decode(n,n.uint32());break}case 18:{l.SimplePeerSignal=$root.rov_actions_proto.SimplePeerSignalResponse.decode(n,n.uint32());break}case 19:{l.SystemMonitor=$root.rov_actions_proto.SystemMonitorResponse.decode(n,n.uint32());break}case 20:{l.LogMessage=$root.rov_actions_proto.LogMessageResponse.decode(n,n.uint32());break}case 21:{l.LivekitVideoStats=$root.rov_actions_proto.LivekitVideoStatsResponse.decode(n,n.uint32());break}case 22:{l.SimplePeerVideoStats=$root.rov_actions_proto.SimplePeerVideoStatsResponse.decode(n,n.uint32());break}default:n.skipType(u&7);break}}return l},t.decodeDelimited=function(n){return n instanceof $Reader||(n=new $Reader(n)),this.decode(n,n.uint32())},t.verify=function(n){if(typeof n!="object"||n===null)return"object expected";let a={};if(n.BackendMetadata!=null&&n.hasOwnProperty("BackendMetadata")){let c=$root.rov_actions_proto.ResponseBackendMetadata.verify(n.BackendMetadata);if(c)return"BackendMetadata."+c}if(n.ExchangeId!=null&&n.hasOwnProperty("ExchangeId")&&!$util.isInteger(n.ExchangeId))return"ExchangeId: integer expected";if(n.Done!=null&&n.hasOwnProperty("Done")){a.Body=1;{let c=$root.rov_actions_proto.DoneResponse.verify(n.Done);if(c)return"Done."+c}}if(n.Error!=null&&n.hasOwnProperty("Error")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.ErrorResponse.verify(n.Error);if(c)return"Error."+c}}if(n.Pong!=null&&n.hasOwnProperty("Pong")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.PongResponse.verify(n.Pong);if(c)return"Pong."+c}}if(n.ContinuedOutput!=null&&n.hasOwnProperty("ContinuedOutput")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.ContinuedOutputResponse.verify(n.ContinuedOutput);if(c)return"ContinuedOutput."+c}}if(n.SensorUpdates!=null&&n.hasOwnProperty("SensorUpdates")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.SensorUpdatesResponse.verify(n.SensorUpdates);if(c)return"SensorUpdates."+c}}if(n.PasswordRequired!=null&&n.hasOwnProperty("PasswordRequired")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.PasswordRequiredResponse.verify(n.PasswordRequired);if(c)return"PasswordRequired."+c}}if(n.PasswordAccepted!=null&&n.hasOwnProperty("PasswordAccepted")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.PasswordAcceptedResponse.verify(n.PasswordAccepted);if(c)return"PasswordAccepted."+c}}if(n.PasswordInvalid!=null&&n.hasOwnProperty("PasswordInvalid")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.PasswordInvalidResponse.verify(n.PasswordInvalid);if(c)return"PasswordInvalid."+c}}if(n.PilotChanged!=null&&n.hasOwnProperty("PilotChanged")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.PilotChangedResponse.verify(n.PilotChanged);if(c)return"PilotChanged."+c}}if(n.ClientConnected!=null&&n.hasOwnProperty("ClientConnected")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.ClientConnectedResponse.verify(n.ClientConnected);if(c)return"ClientConnected."+c}}if(n.ClientDisconnected!=null&&n.hasOwnProperty("ClientDisconnected")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.ClientDisconnectedResponse.verify(n.ClientDisconnected);if(c)return"ClientDisconnected."+c}}if(n.Heartbeat!=null&&n.hasOwnProperty("Heartbeat")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.HeartbeatResponse.verify(n.Heartbeat);if(c)return"Heartbeat."+c}}if(n.Mavlink!=null&&n.hasOwnProperty("Mavlink")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.MavlinkResponse.verify(n.Mavlink);if(c)return"Mavlink."+c}}if(n.SimplePeerSignal!=null&&n.hasOwnProperty("SimplePeerSignal")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.SimplePeerSignalResponse.verify(n.SimplePeerSignal);if(c)return"SimplePeerSignal."+c}}if(n.SystemMonitor!=null&&n.hasOwnProperty("SystemMonitor")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.SystemMonitorResponse.verify(n.SystemMonitor);if(c)return"SystemMonitor."+c}}if(n.LogMessage!=null&&n.hasOwnProperty("LogMessage")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.LogMessageResponse.verify(n.LogMessage);if(c)return"LogMessage."+c}}if(n.LivekitVideoStats!=null&&n.hasOwnProperty("LivekitVideoStats")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.LivekitVideoStatsResponse.verify(n.LivekitVideoStats);if(c)return"LivekitVideoStats."+c}}if(n.SimplePeerVideoStats!=null&&n.hasOwnProperty("SimplePeerVideoStats")){if(a.Body===1)return"Body: multiple values";a.Body=1;{let c=$root.rov_actions_proto.SimplePeerVideoStatsResponse.verify(n.SimplePeerVideoStats);if(c)return"SimplePeerVideoStats."+c}}return null},t.fromObject=function(n){if(n instanceof $root.rov_actions_proto.RovResponse)return n;let a=new $root.rov_actions_proto.RovResponse;if(n.BackendMetadata!=null){if(typeof n.BackendMetadata!="object")throw TypeError(".rov_actions_proto.RovResponse.BackendMetadata: object expected");a.BackendMetadata=$root.rov_actions_proto.ResponseBackendMetadata.fromObject(n.BackendMetadata)}if(n.ExchangeId!=null&&(a.ExchangeId=n.ExchangeId|0),n.Done!=null){if(typeof n.Done!="object")throw TypeError(".rov_actions_proto.RovResponse.Done: object expected");a.Done=$root.rov_actions_proto.DoneResponse.fromObject(n.Done)}if(n.Error!=null){if(typeof n.Error!="object")throw TypeError(".rov_actions_proto.RovResponse.Error: object expected");a.Error=$root.rov_actions_proto.ErrorResponse.fromObject(n.Error)}if(n.Pong!=null){if(typeof n.Pong!="object")throw TypeError(".rov_actions_proto.RovResponse.Pong: object expected");a.Pong=$root.rov_actions_proto.PongResponse.fromObject(n.Pong)}if(n.ContinuedOutput!=null){if(typeof n.ContinuedOutput!="object")throw TypeError(".rov_actions_proto.RovResponse.ContinuedOutput: object expected");a.ContinuedOutput=$root.rov_actions_proto.ContinuedOutputResponse.fromObject(n.ContinuedOutput)}if(n.SensorUpdates!=null){if(typeof n.SensorUpdates!="object")throw TypeError(".rov_actions_proto.RovResponse.SensorUpdates: object expected");a.SensorUpdates=$root.rov_actions_proto.SensorUpdatesResponse.fromObject(n.SensorUpdates)}if(n.PasswordRequired!=null){if(typeof n.PasswordRequired!="object")throw TypeError(".rov_actions_proto.RovResponse.PasswordRequired: object expected");a.PasswordRequired=$root.rov_actions_proto.PasswordRequiredResponse.fromObject(n.PasswordRequired)}if(n.PasswordAccepted!=null){if(typeof n.PasswordAccepted!="object")throw TypeError(".rov_actions_proto.RovResponse.PasswordAccepted: object expected");a.PasswordAccepted=$root.rov_actions_proto.PasswordAcceptedResponse.fromObject(n.PasswordAccepted)}if(n.PasswordInvalid!=null){if(typeof n.PasswordInvalid!="object")throw TypeError(".rov_actions_proto.RovResponse.PasswordInvalid: object expected");a.PasswordInvalid=$root.rov_actions_proto.PasswordInvalidResponse.fromObject(n.PasswordInvalid)}if(n.PilotChanged!=null){if(typeof n.PilotChanged!="object")throw TypeError(".rov_actions_proto.RovResponse.PilotChanged: object expected");a.PilotChanged=$root.rov_actions_proto.PilotChangedResponse.fromObject(n.PilotChanged)}if(n.ClientConnected!=null){if(typeof n.ClientConnected!="object")throw TypeError(".rov_actions_proto.RovResponse.ClientConnected: object expected");a.ClientConnected=$root.rov_actions_proto.ClientConnectedResponse.fromObject(n.ClientConnected)}if(n.ClientDisconnected!=null){if(typeof n.ClientDisconnected!="object")throw TypeError(".rov_actions_proto.RovResponse.ClientDisconnected: object expected");a.ClientDisconnected=$root.rov_actions_proto.ClientDisconnectedResponse.fromObject(n.ClientDisconnected)}if(n.Heartbeat!=null){if(typeof n.Heartbeat!="object")throw TypeError(".rov_actions_proto.RovResponse.Heartbeat: object expected");a.Heartbeat=$root.rov_actions_proto.HeartbeatResponse.fromObject(n.Heartbeat)}if(n.Mavlink!=null){if(typeof n.Mavlink!="object")throw TypeError(".rov_actions_proto.RovResponse.Mavlink: object expected");a.Mavlink=$root.rov_actions_proto.MavlinkResponse.fromObject(n.Mavlink)}if(n.SimplePeerSignal!=null){if(typeof n.SimplePeerSignal!="object")throw TypeError(".rov_actions_proto.RovResponse.SimplePeerSignal: object expected");a.SimplePeerSignal=$root.rov_actions_proto.SimplePeerSignalResponse.fromObject(n.SimplePeerSignal)}if(n.SystemMonitor!=null){if(typeof n.SystemMonitor!="object")throw TypeError(".rov_actions_proto.RovResponse.SystemMonitor: object expected");a.SystemMonitor=$root.rov_actions_proto.SystemMonitorResponse.fromObject(n.SystemMonitor)}if(n.LogMessage!=null){if(typeof n.LogMessage!="object")throw TypeError(".rov_actions_proto.RovResponse.LogMessage: object expected");a.LogMessage=$root.rov_actions_proto.LogMessageResponse.fromObject(n.LogMessage)}if(n.LivekitVideoStats!=null){if(typeof n.LivekitVideoStats!="object")throw TypeError(".rov_actions_proto.RovResponse.LivekitVideoStats: object expected");a.LivekitVideoStats=$root.rov_actions_proto.LivekitVideoStatsResponse.fromObject(n.LivekitVideoStats)}if(n.SimplePeerVideoStats!=null){if(typeof n.SimplePeerVideoStats!="object")throw TypeError(".rov_actions_proto.RovResponse.SimplePeerVideoStats: object expected");a.SimplePeerVideoStats=$root.rov_actions_proto.SimplePeerVideoStatsResponse.fromObject(n.SimplePeerVideoStats)}return a},t.toObject=function(n,a){a||(a={});let c={};return a.defaults&&(c.BackendMetadata=null,c.ExchangeId=0),n.BackendMetadata!=null&&n.hasOwnProperty("BackendMetadata")&&(c.BackendMetadata=$root.rov_actions_proto.ResponseBackendMetadata.toObject(n.BackendMetadata,a)),n.ExchangeId!=null&&n.hasOwnProperty("ExchangeId")&&(c.ExchangeId=n.ExchangeId),n.Done!=null&&n.hasOwnProperty("Done")&&(c.Done=$root.rov_actions_proto.DoneResponse.toObject(n.Done,a),a.oneofs&&(c.Body="Done")),n.Error!=null&&n.hasOwnProperty("Error")&&(c.Error=$root.rov_actions_proto.ErrorResponse.toObject(n.Error,a),a.oneofs&&(c.Body="Error")),n.Pong!=null&&n.hasOwnProperty("Pong")&&(c.Pong=$root.rov_actions_proto.PongResponse.toObject(n.Pong,a),a.oneofs&&(c.Body="Pong")),n.ContinuedOutput!=null&&n.hasOwnProperty("ContinuedOutput")&&(c.ContinuedOutput=$root.rov_actions_proto.ContinuedOutputResponse.toObject(n.ContinuedOutput,a),a.oneofs&&(c.Body="ContinuedOutput")),n.SensorUpdates!=null&&n.hasOwnProperty("SensorUpdates")&&(c.SensorUpdates=$root.rov_actions_proto.SensorUpdatesResponse.toObject(n.SensorUpdates,a),a.oneofs&&(c.Body="SensorUpdates")),n.PasswordRequired!=null&&n.hasOwnProperty("PasswordRequired")&&(c.PasswordRequired=$root.rov_actions_proto.PasswordRequiredResponse.toObject(n.PasswordRequired,a),a.oneofs&&(c.Body="PasswordRequired")),n.PasswordAccepted!=null&&n.hasOwnProperty("PasswordAccepted")&&(c.PasswordAccepted=$root.rov_actions_proto.PasswordAcceptedResponse.toObject(n.PasswordAccepted,a),a.oneofs&&(c.Body="PasswordAccepted")),n.PasswordInvalid!=null&&n.hasOwnProperty("PasswordInvalid")&&(c.PasswordInvalid=$root.rov_actions_proto.PasswordInvalidResponse.toObject(n.PasswordInvalid,a),a.oneofs&&(c.Body="PasswordInvalid")),n.PilotChanged!=null&&n.hasOwnProperty("PilotChanged")&&(c.PilotChanged=$root.rov_actions_proto.PilotChangedResponse.toObject(n.PilotChanged,a),a.oneofs&&(c.Body="PilotChanged")),n.ClientConnected!=null&&n.hasOwnProperty("ClientConnected")&&(c.ClientConnected=$root.rov_actions_proto.ClientConnectedResponse.toObject(n.ClientConnected,a),a.oneofs&&(c.Body="ClientConnected")),n.ClientDisconnected!=null&&n.hasOwnProperty("ClientDisconnected")&&(c.ClientDisconnected=$root.rov_actions_proto.ClientDisconnectedResponse.toObject(n.ClientDisconnected,a),a.oneofs&&(c.Body="ClientDisconnected")),n.Heartbeat!=null&&n.hasOwnProperty("Heartbeat")&&(c.Heartbeat=$root.rov_actions_proto.HeartbeatResponse.toObject(n.Heartbeat,a),a.oneofs&&(c.Body="Heartbeat")),n.Mavlink!=null&&n.hasOwnProperty("Mavlink")&&(c.Mavlink=$root.rov_actions_proto.MavlinkResponse.toObject(n.Mavlink,a),a.oneofs&&(c.Body="Mavlink")),n.SimplePeerSignal!=null&&n.hasOwnProperty("SimplePeerSignal")&&(c.SimplePeerSignal=$root.rov_actions_proto.SimplePeerSignalResponse.toObject(n.SimplePeerSignal,a),a.oneofs&&(c.Body="SimplePeerSignal")),n.SystemMonitor!=null&&n.hasOwnProperty("SystemMonitor")&&(c.SystemMonitor=$root.rov_actions_proto.SystemMonitorResponse.toObject(n.SystemMonitor,a),a.oneofs&&(c.Body="SystemMonitor")),n.LogMessage!=null&&n.hasOwnProperty("LogMessage")&&(c.LogMessage=$root.rov_actions_proto.LogMessageResponse.toObject(n.LogMessage,a),a.oneofs&&(c.Body="LogMessage")),n.LivekitVideoStats!=null&&n.hasOwnProperty("LivekitVideoStats")&&(c.LivekitVideoStats=$root.rov_actions_proto.LivekitVideoStatsResponse.toObject(n.LivekitVideoStats,a),a.oneofs&&(c.Body="LivekitVideoStats")),n.SimplePeerVideoStats!=null&&n.hasOwnProperty("SimplePeerVideoStats")&&(c.SimplePeerVideoStats=$root.rov_actions_proto.SimplePeerVideoStatsResponse.toObject(n.SimplePeerVideoStats,a),a.oneofs&&(c.Body="SimplePeerVideoStats")),c},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(n){return n===void 0&&(n="type.googleapis.com"),n+"/rov_actions_proto.RovResponse"},t}(),s})(),VITEBUILD_EXTRANIOUS_PATH="/@fs/Users/ky/Documents/Github/rov-web";var LogLevelConsole=(s=>(s[s.Info=rov_actions_proto.LogLevel.Info]="Info",s[s.Warn=rov_actions_proto.LogLevel.Warning]="Warn",s[s.Error=rov_actions_proto.LogLevel.Error]="Error",s[s.Debug=rov_actions_proto.LogLevel.Debug]="Debug",s[s.Console=4]="Console",s))(LogLevelConsole||{}),LogOrigin=(s=>(s[s.ROV=0]="ROV",s[s.PILOT=1]="PILOT",s))(LogOrigin||{});class Logger{constructor(t=1){q(this,"logsStore",[]);q(this,"sendLogsCallback");q(this,"rootURL");q(this,"sendLogsAllowed",!1);q(this,"sendLogsInterval");q(this,"rawConsole");q(this,"defaultLogOrigin");q(this,"svelteSubscribers",[]);const{log:o,debug:e,warn:n,error:a,info:c}=console;this.rawConsole={log:o,debug:e,warn:n,error:a,info:c},this.rootURL=window.location.protocol+"//"+window.location.host,this.defaultLogOrigin=t,console.log("Logger initialized",this.rootURL),window.addEventListener("error",l=>{if(!l)return;const u=[l.error?l.error:"",l.message,l.filename+":"+l.lineno+":"+l.colno];this.addLog(LogLevelConsole.Error,u,[],0,this.defaultLogOrigin)})}subscribe(t){this.svelteSubscribers.push(t),t()}sendLogs(t){this.sendQueuedLogs(t)}sendQueuedLogs(t){if(!this.sendLogsAllowed)return;const o=this.logsStore.filter(e=>!e.sentToRemote);return o.forEach(e=>{e.sentToRemote=!0}),Promise.allSettled(o.map(e=>{const n=mainLogr.logToJson(e);return t(e.level,n)})).then(e=>{const n=[];for(let a=0;a<e.length;a++){const c=e[a];c&&c.status=="fulfilled"&&c.value==!0?this.logsStore[a].sentToRemote=!0:(this.logsStore[a].sentToRemote=!1,n.push({log:this.logsStore[a],result:c}))}return n.length>0&&console.warn("Failed to send some logs.",n),n.length})}addLog(t,o,e=[],n=0,a=this.defaultLogOrigin,c=Date.now(),l=!1){if(!e){const p=new Error().stack;e=p?p.split(`
`).slice(3).map(g=>g.replace(this.rootURL,"").replace(VITEBUILD_EXTRANIOUS_PATH,"").trim().slice(3)):[]}let u=this.logsStore.length;for(;u>0&&this.logsStore[u-1].timestamp>c;)u--;const d={timestamp:c,level:t,args:o,trace:e,sentToRemote:l,kind:n,origin:a};this.logsStore.splice(u,0,d),this.svelteSubscribers.forEach(p=>p())}logAddLevelFlair(t){const o=t.args;return typeof o[0]!="string"?o.unshift("****"):o[0]="**** "+o[0],{...t,args:o}}printLog(t){if(t.trace&&t.trace.length>0){const o=t.args[0],e=t.args.slice(1);e.push(t.trace.join(`
`)),console.groupCollapsed("%c"+o,this._getLevelColor(t.level)),this._consoleLogAtLevel(t.level,e),console.groupEnd()}else typeof t.args[0]!="string"&&t.args.unshift("****"),t.args[0]="%c "+t.args[0],t.args.splice(1,0,this._getLevelColor(t.level)),this._consoleLogAtLevel(t.level,t.args)}consoleRecentLogs(t=100){console.clear(),console.groupCollapsed("Recent Logs");const o=Math.max(this.logsStore.length-t,0);for(let e=this.logsStore.length-1;e>o;e--){const n=this.logsStore[e];this.printLog(n)}console.groupEnd()}printRecentLogs(t,o=1e3){t.innerHTML="";const e=Math.max(this.logsStore.length-o,0);for(let n=this.logsStore.length-1;n>e;n--){const a=this.logsStore[n],[c,l]=this.logToText(a),u=document.createElement("div");u.innerHTML=`<details style="font-size: 1.1em; font-weight: bold; padding: 0.2em; ${this._getLevelColor(a.level)}"><summary><small>${a.timestamp} </small> <span>${c}</span></summary><pre>${l}</pre></details>`,t.appendChild(u)}}_makeJsonEncodable(t,o=0){if(o>5)return"Max recursion level reached";const e=typeof t;if(e==="string"||e==="number"||e==="boolean")return t;if(t===void 0)return"undefined";if(t===null)return null;if(t instanceof Error)return{instanceOf:e,name:t.name,errMessage:t.message,stack:t.stack,cause:t.cause};if(t instanceof Date)return t.toISOString();if(t instanceof Map){const n={};return t.forEach((a,c)=>{n[c]=this._makeJsonEncodable(a,o+1)}),{instanceof:e,value:n}}else if(t instanceof Set){let n=Array.from(t).map(a=>this._makeJsonEncodable(a,o+1));return{instanceof:e,value:n}}else{if(t instanceof Array||t instanceof Uint8Array||t instanceof Int8Array||t instanceof Uint16Array||t instanceof Int16Array||t instanceof Uint32Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array)return t.map(n=>this._makeJsonEncodable(n,o+1));if(t instanceof Object){const n={};for(const a in t)t.hasOwnProperty(a)&&(n[a]=this._makeJsonEncodable(t[a],o+1));return n}else try{return t.toString()}catch(n){return{instanceof:e,value:"Failed to stringify: "+n.message}}}}logToJson(t){const{timestamp:o,args:e,trace:n,origin:a,kind:c,level:l}=t;return JSON.stringify(this._makeJsonEncodable({level:l,timestamp:o,args:e,trace:n,origin:a,kind:c}))}logToText(t){let o="",e="",n=0;for(;n<t.args.length;n++){const a=t.args[n];try{if(a===null)o+=" null";else if(a===void 0)o+=" undefined";else if(a instanceof Error)o+=a.name+" "+a.message+" "+a.cause,e+=a.stack;else if(a instanceof Object){e+=`
`+JSON.stringify(a,null,2)+`
`;break}else o+=" "+a.toString()}catch(c){e+=" STRINGFAIL:"+typeof a+" ",console.error("Failed to stringify logs arg: "+c.message,typeof a,a)}}for(;n<t.args.length;n++){const a=t.args[n];try{a===null?e+=" null":a===void 0?e+=" undefined":a instanceof Error?e+=a.name+" "+a.message+" "+a.cause+`
`+a.stack:a instanceof Object?e+=`
`+JSON.stringify(a,null,2)+`
`:e+=" "+a.toString()}catch(c){e+=" STRINGFAIL:"+typeof a+" ",console.error("Failed to stringify logs arg: "+c.message,typeof a,a)}}return t.trace&&t.trace.length>0&&(e+=`
`+t.trace.join(`
`)),[o,e]}_consoleLogAtLevel(t,o,e=[]){t===LogLevelConsole.Debug?this.rawConsole.debug.apply(console,o):t===LogLevelConsole.Warn?this.rawConsole.warn.apply(console,o):t===LogLevelConsole.Error?this.rawConsole.error.apply(console,o):t===LogLevelConsole.Info&&this.rawConsole.info.apply(console,o)}_getLevelColor(t){if(t===LogLevelConsole.Debug)return"color: #008888";if(t===LogLevelConsole.Warn)return"color: #888800";if(t===LogLevelConsole.Error)return"color: #880000";if(t===LogLevelConsole.Info)return"color: #000088";if(t===4)return"color: #000000"}_getLevelIcon(t){if(t===LogLevelConsole.Debug)return"🐛";if(t===LogLevelConsole.Warn)return"🟨";if(t===LogLevelConsole.Error)return"🛑";if(t===LogLevelConsole.Info)return"ℹ️";if(t===4)return"ℹ️"}getLogs(){return this.logsStore}log(...t){this.rawConsole.log.apply(console,t),this.addLog(4,t)}logDebug(...t){this.rawConsole.debug.apply(console,t),this.addLog(LogLevelConsole.Debug,t)}logWarn(...t){this.rawConsole.warn.apply(console,t),this.addLog(LogLevelConsole.Warn,t)}logError(...t){this.rawConsole.error.apply(console,t),this.addLog(LogLevelConsole.Error,t)}logInfo(...t){this.rawConsole.info.apply(console,t),this.addLog(LogLevelConsole.Info,t)}}const mainLogr=new Logger,logDebug=mainLogr.logDebug.bind(mainLogr),logWarn=mainLogr.logWarn.bind(mainLogr),logError=mainLogr.logError.bind(mainLogr),logInfo=mainLogr.logInfo.bind(mainLogr),log=mainLogr.log.bind(mainLogr);export{ConnectionStates as C,DECODE_TXT as D,ENCODE_TXT as E,FRONTEND_HANDLED_MAVLINK_MESSAGE_TYPES as F,LogLevelConsole as L,MavState as M,ParticipantEvent as P,Room as R,SECONDS_IN_DAY as S,Track as T,MAVLinkType as a,MavType as b,MavAutopilot as c,dist as d,MavModeFlag as e,log as f,logError as g,logDebug as h,logInfo as i,LIVEKIT_BACKEND_ROOM_CONFIG as j,getDefaultExportFromCjs$1 as k,logWarn as l,mainLogr as m,RoomEvent as n,DisconnectReason as o,MediaDeviceFailure as p,LIVEKIT_BACKEND_ROOM_CONNECTION_CONFIG as q,rov_actions_proto as r,SIMPLEPEER_BASE_CONFIG as s,SIMPLEPEER_CAPTURE_CONFIG as t,LogOrigin as u};
//# sourceMappingURL=logging-68e36512.js.map
