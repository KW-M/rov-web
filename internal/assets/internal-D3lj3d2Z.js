var La=Object.defineProperty;var Ma=(n,e,t)=>e in n?La(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var I=(n,e,t)=>Ma(n,typeof e!="symbol"?e+"":e,t);import{l as U,S as bs,a as Da,b as F,M as we,c as Li,d as Ua,e as Ba,f as pi,u as Re,g as ue,h as se,i as H,D as Ka,j as Va,p as Bt,E as ks,R as gi,L as Mt,m as vn,k as ae,n as Ha,C as D,o as qa,q as $a,r as V,s as De,P as Wa,t as Rs,T as Ga,v as Ja,w as ja,x as pr,y as Ya,F as gr}from"./logging-D4Vz8BB9.js";const Mi=new URLSearchParams(globalThis.window?window.location.search:"");function Ue(n,e){const t=Mi.get(n);if(t==null||t===""){if(e===void 0)throw new Error("Missing required url query parameter (string): "+n);return U("Using default value for string url query parameter: "+n+"="+e),e}return t}function _r(n,e){const t=Mi.get(n);return t==null||t===""?(U("Using default value for bool url query parameter: "+n+"="+e),e):t.toLowerCase()!=="false"}function yr(n,e){const t=Mi.get(n);if(t==null||t===""){if(e===void 0)throw new Error("Missing required integer url query parameter (integer): "+n);return U("Using default value for integer url query parameter: "+n+"="+e),e}try{return parseInt(t)}catch{throw new Error(`Error parsing integer url query parameter: ${n}=${t}`)}}const $={DEBUG_MODE:_r("DEBUG_MODE",!1),SEND_LOGS:_r("SEND_LOGS",!1),ROV_NAME:Ue("ROV_NAME","Default-ROV"),ROV_CONTROL_PASSWORD:Ue("ROV_CONTROL_PASSWORD",""),LIVEKIT_API_KEY:Ue("LIVEKIT_API_KEY"),LIVEKIT_SECRET_KEY:Ue("LIVEKIT_SECRET_KEY"),TWITCH_STREAM_KEY:Ue("TWITCH_STREAM_KEY","None"),PYTHON_WEBSOCKET_PORT:yr("PYTHON_WEBSOCKET_PORT",0),AUTH_TOKEN_TIMEOUT:yr("AUTH_TOKEN_TIMEOUT",Da),BLUEOS_APIS_ENDPOINT:Ue("BLUEOS_APIS_ENDPOINT",""),LIVEKIT_CLOUD_ENDPOINT:Ue("LIVEKIT_CLOUD_URL","https://rov-web.livekit.cloud"),LIVEKIT_LOCAL_ENDPOINT:Ue("LIVEKIT_LOCAL_URL","http://localhost:7880")};Object.assign({},bs,{initiator:!1,offerOptions:{offerToReceiveAudio:!1,offerToReceiveVideo:!1}});const Er={video:{width:1920,height:1080,frameRate:60,facingMode:"environment"},audio:!1};function Gt(n){return new Promise(e=>{setTimeout(()=>{e()},n)})}function Tr(n){const e=n.fn,t=n.maxRetries??3,i=n.initialDelay??100,r=n.exponent??2;let s=!1;return{promise:new Promise(async function(o,l){let f,h=0;for(;h<t;)try{const u=await e();return s?l(null):o(u)}catch(u){if(F("err:",f=u),s)return u.message+=" - asyncExpBackoff() canceled",l(u);await Gt(i*Math.pow(r,h)),h++}f.message+=" - asyncExpBackoff() failed after "+h+" retries",l(f)}),cancel:()=>{s=!0}}}function ht(n,e){let t=!1,i=n.get();return n.subscribe(s=>{if(t==!1){t=!0,i=s;return}e(s,i),i=s})}function Cs(n,e=!1){return n.replace("http","ws")}function za(){const n=new Date().getTime()>>>0,e=typeof performance<"u"&&performance.now&&(performance.now()>>>0)*1e3||0,t=crypto.getRandomValues(new Uint8Array(1))[0]>>>0;return n*e*t}const wr=["Ancient","Dawn","Small","Broken","Red","Cold","Wild","Divine","Empty","Patient","Holy","Long","Wispy","White","Delicate","Bold","Billowing","Blue","Crimson","Aged","Misty","Snowy","Withered","Little","Frosty","Weathered","Nameless","Fragrant","Lively","Quiet","Purple","Proud","Dry","Bitter","Dark","Icy","Twilight","Wandering","Solitary","Morning","Lingering","Still","Late","Sparkling","Restless","Winter","Silent","Floral","Young","Green","Cool","Autumn","Falling","Spring","Summer","Polished","Hidden","Damp","Muddy","Black","Old","Rough"],Sr=["Pond","Snow","Glade","Hill","Voice","River","Sun","Dawn","Forest","Frog","Grass","Shadow","Dust","Water","Meadow","Moon","Thunder","Sun","Wildflower","Snowflake","Silence","Haze","Shape","Pine","Waterfall","Sound","Wood","Tree","Night","Flower","Dream","Cherry","Resonance","Firefly","Bush","Star","Darkness","Lake","Frost","Paper","Surf","Fog","Brook","Mountain","Field","Bird","Leaf","Sea","Water","Sky","Smoke","Sunset","Glitter","Dew","Butterfly","Wind","Fire","Rain","Morning","Feather","Cloud","Breeze","Violet","Wave","Droplet","Swamp","Village","Hut","Path","Book","Rain","Spell","Pig"];function Xa(n,e=0){let t=wr.length>>>0,i=Sr.length>>>0,r=Math.max(t,i)>>>0,s=Math.max(1,(n+1)%r)>>>0,o=Math.max(1,(e+1)%r)>>>0,l=wr[(s+o)%t],f=Sr[s*o%i];return l+"-"+f}const Is=n=>{for(const e in n)n[e]===void 0||typeof n[e]=="number"&&isNaN(n[e])?delete n[e]:typeof n[e]=="object"&&Is(n[e]);return n};we.MAV_STATE_UNINIT+"",we.MAV_STATE_BOOT+"",we.MAV_STATE_CALIBRATING+"",we.MAV_STATE_STANDBY+"",we.MAV_STATE_ACTIVE+"",we.MAV_STATE_CRITICAL+"",we.MAV_STATE_EMERGENCY+"",we.MAV_STATE_POWEROFF+"",we.MAV_STATE_FLIGHT_TERMINATION+"";let Qa=-1;const ot=(n,e=0)=>({header:{system_id:255,component_id:190,sequence:Qa++%255},message:n}),Za=n=>ot({type:"COMMAND_LONG",command:{type:"MAV_CMD_COMPONENT_ARM_DISARM"},target_system:1,target_component:1,confirmation:0,param1:1,param2:0,param3:0,param4:0,param5:0,param6:0,param7:0}),ec=n=>ot({type:"COMMAND_LONG",command:{type:"MAV_CMD_COMPONENT_ARM_DISARM"},target_system:1,target_component:1,confirmation:1,param1:0,param2:0,param3:0,param4:0,param5:0,param6:0,param7:0}),tc=(n=1,e=333333.34375)=>ot({type:"COMMAND_LONG",command:{type:"MAV_CMD_SET_MESSAGE_INTERVAL"},target_system:1,target_component:1,confirmation:1,param1:n,param2:e,param3:0,param4:0,param5:0,param6:0,param7:0}),nc=n=>(n=n||19,ot({type:Li.COMMAND_LONG,command:{type:"MAV_CMD_DO_SET_MODE"},param1:1,param2:Number(n),param3:0,param4:0,param5:0,param6:0,param7:0,target_system:1,target_component:1,confirmation:1})),ic=()=>ot({type:Li.HEARTBEAT,custom_mode:0,mavtype:{type:Ua.MAV_TYPE_GCS},autopilot:{type:Ba.MAV_AUTOPILOT_INVALID},base_mode:{bits:pi.MAV_MODE_FLAG_SAFETY_ARMED|pi.MAV_MODE_FLAG_MANUAL_INPUT_ENABLED},system_status:{type:we.MAV_STATE_ACTIVE},mavlink_version:3,confirmation:0}),br=(n,e,t,i,r)=>ot({type:Li.MANUAL_CONTROL,x:Math.floor(n),y:Math.floor(e),z:Math.floor(t),r:Math.floor(i),buttons:r,target:1}),rc=(n,e,t)=>{const i=Array(8).fill(0);return i[n]=e,ot({type:"SET_ACTUATOR_CONTROL_TARGET",group_mlx:t,controls:i,time_usec:Re()*1e3,target_component:1,target_system:1})};class As{constructor(){I(this,"socket");I(this,"serverAddress");I(this,"msgReceivedFn");I(this,"onConnectedFn");I(this,"isRunning");I(this,"isConnected");I(this,"connectionTimerId");this.isConnected=!1,this.isRunning=!1,this.connectionTimerId=0,this.serverAddress=""}start(e,t){this.serverAddress=e,this.msgReceivedFn=t,this.isRunning=!0,this.connect()}stop(){this.isRunning=!1,this.socket&&this.socket.close()}connect(){ue("Attempting to connect to websocket: "+this.serverAddress),this.socket=new WebSocket(this.serverAddress),this.socket.binaryType="arraybuffer";const e=setTimeout(()=>{se("WebSocket connection timed out after 10 seconds"),this.stop(),this.queueConnect()},1e4);this.socket.addEventListener("open",t=>{this.isConnected=!0,clearTimeout(e),this.onConnectedFn&&this.onConnectedFn()}),this.socket.addEventListener("close",t=>{ue("WebSocket connection closed with code: ",t.code),this.isConnected=!1,this.isRunning&&this.queueConnect()}),this.socket.addEventListener("error",t=>{se("WebSocket error:",t),this.isConnected=!1,this.isRunning&&this.queueConnect()}),this.socket.addEventListener("message",t=>{if(!this.msgReceivedFn)return se("No msgReceivedFn defined for WebSocketRelay");if(typeof t.data=="string")this.msgReceivedFn(t.data);else if(t.data instanceof ArrayBuffer)this.msgReceivedFn(new Uint8Array(t.data));else throw t.data instanceof Blob?new Error("WebSocketRelay received Blob type, which is not supported!"):new Error("WebSocketRelay received unknown type")})}queueConnect(){clearTimeout(this.connectionTimerId),this.connectionTimerId=setTimeout(this.connect.bind(this),2e3)}getIsConnected(){return this.isConnected}sendMessage(e){if(this.socket){if(this.socket.readyState!=this.socket.OPEN){H("Can't send WebSocket msg: "+this.socket.readyState);return}this.socket.send(e)}}close(){this.socket&&this.socket.close()}}const sc=new As;class oc{constructor(){I(this,"mavlinkWebsocket");I(this,"onMessage");this.mavlinkWebsocket=new As,this.onMessage=e=>{}}start(e,t,i){this.onMessage=t,i&&(this.mavlinkWebsocket.onConnectedFn=i),this.mavlinkWebsocket.start(e,r=>{this.handleMessage(r)})}handleMessage(e){if(e.length===0)return;const t=e instanceof Uint8Array?Ka(e):e;try{if(t.startsWith("Ok"))return;const i=JSON.parse(t);this.onMessage(i)}catch(i){se("Failed to parse recived mavlink2rest json. msg='"+t+"'",i)}}sendMessage(e){this.mavlinkWebsocket.sendMessage(JSON.stringify(e))}close(){this.mavlinkWebsocket.close()}}const be=new oc;function Ns(n,e){return function(){return n.apply(e,arguments)}}const{toString:ac}=Object.prototype,{getPrototypeOf:Di}=Object,On=(n=>e=>{const t=ac.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Ee=n=>(n=n.toLowerCase(),e=>On(e)===n),xn=n=>e=>typeof e===n,{isArray:At}=Array,Kt=xn("undefined");function cc(n){return n!==null&&!Kt(n)&&n.constructor!==null&&!Kt(n.constructor)&&fe(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const vs=Ee("ArrayBuffer");function uc(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&vs(n.buffer),e}const lc=xn("string"),fe=xn("function"),Os=xn("number"),Pn=n=>n!==null&&typeof n=="object",dc=n=>n===!0||n===!1,pn=n=>{if(On(n)!=="object")return!1;const e=Di(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},hc=Ee("Date"),fc=Ee("File"),mc=Ee("Blob"),pc=Ee("FileList"),gc=n=>Pn(n)&&fe(n.pipe),_c=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||fe(n.append)&&((e=On(n))==="formdata"||e==="object"&&fe(n.toString)&&n.toString()==="[object FormData]"))},yc=Ee("URLSearchParams"),[Ec,Tc,wc,Sc]=["ReadableStream","Request","Response","Headers"].map(Ee),bc=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Jt(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let i,r;if(typeof n!="object"&&(n=[n]),At(n))for(i=0,r=n.length;i<r;i++)e.call(null,n[i],i,n);else{const s=t?Object.getOwnPropertyNames(n):Object.keys(n),o=s.length;let l;for(i=0;i<o;i++)l=s[i],e.call(null,n[l],l,n)}}function xs(n,e){e=e.toLowerCase();const t=Object.keys(n);let i=t.length,r;for(;i-- >0;)if(r=t[i],e===r.toLowerCase())return r;return null}const Qe=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Va,Ps=n=>!Kt(n)&&n!==Qe;function _i(){const{caseless:n}=Ps(this)&&this||{},e={},t=(i,r)=>{const s=n&&xs(e,r)||r;pn(e[s])&&pn(i)?e[s]=_i(e[s],i):pn(i)?e[s]=_i({},i):At(i)?e[s]=i.slice():e[s]=i};for(let i=0,r=arguments.length;i<r;i++)arguments[i]&&Jt(arguments[i],t);return e}const kc=(n,e,t,{allOwnKeys:i}={})=>(Jt(e,(r,s)=>{t&&fe(r)?n[s]=Ns(r,t):n[s]=r},{allOwnKeys:i}),n),Rc=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),Cc=(n,e,t,i)=>{n.prototype=Object.create(e.prototype,i),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},Ic=(n,e,t,i)=>{let r,s,o;const l={};if(e=e||{},n==null)return e;do{for(r=Object.getOwnPropertyNames(n),s=r.length;s-- >0;)o=r[s],(!i||i(o,n,e))&&!l[o]&&(e[o]=n[o],l[o]=!0);n=t!==!1&&Di(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},Ac=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const i=n.indexOf(e,t);return i!==-1&&i===t},Nc=n=>{if(!n)return null;if(At(n))return n;let e=n.length;if(!Os(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},vc=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&Di(Uint8Array)),Oc=(n,e)=>{const i=(n&&n[Symbol.iterator]).call(n);let r;for(;(r=i.next())&&!r.done;){const s=r.value;e.call(n,s[0],s[1])}},xc=(n,e)=>{let t;const i=[];for(;(t=n.exec(e))!==null;)i.push(t);return i},Pc=Ee("HTMLFormElement"),Fc=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,i,r){return i.toUpperCase()+r}),kr=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),Lc=Ee("RegExp"),Fs=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),i={};Jt(t,(r,s)=>{let o;(o=e(r,s,n))!==!1&&(i[s]=o||r)}),Object.defineProperties(n,i)},Mc=n=>{Fs(n,(e,t)=>{if(fe(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const i=n[t];if(fe(i)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Dc=(n,e)=>{const t={},i=r=>{r.forEach(s=>{t[s]=!0})};return At(n)?i(n):i(String(n).split(e)),t},Uc=()=>{},Bc=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e,zn="abcdefghijklmnopqrstuvwxyz",Rr="0123456789",Ls={DIGIT:Rr,ALPHA:zn,ALPHA_DIGIT:zn+zn.toUpperCase()+Rr},Kc=(n=16,e=Ls.ALPHA_DIGIT)=>{let t="";const{length:i}=e;for(;n--;)t+=e[Math.random()*i|0];return t};function Vc(n){return!!(n&&fe(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const Hc=n=>{const e=new Array(10),t=(i,r)=>{if(Pn(i)){if(e.indexOf(i)>=0)return;if(!("toJSON"in i)){e[r]=i;const s=At(i)?[]:{};return Jt(i,(o,l)=>{const f=t(o,r+1);!Kt(f)&&(s[l]=f)}),e[r]=void 0,s}}return i};return t(n,0)},qc=Ee("AsyncFunction"),$c=n=>n&&(Pn(n)||fe(n))&&fe(n.then)&&fe(n.catch),Ms=((n,e)=>n?setImmediate:e?((t,i)=>(Qe.addEventListener("message",({source:r,data:s})=>{r===Qe&&s===t&&i.length&&i.shift()()},!1),r=>{i.push(r),Qe.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",fe(Qe.postMessage)),Wc=typeof queueMicrotask<"u"?queueMicrotask.bind(Qe):typeof Bt<"u"&&Bt.nextTick||Ms,E={isArray:At,isArrayBuffer:vs,isBuffer:cc,isFormData:_c,isArrayBufferView:uc,isString:lc,isNumber:Os,isBoolean:dc,isObject:Pn,isPlainObject:pn,isReadableStream:Ec,isRequest:Tc,isResponse:wc,isHeaders:Sc,isUndefined:Kt,isDate:hc,isFile:fc,isBlob:mc,isRegExp:Lc,isFunction:fe,isStream:gc,isURLSearchParams:yc,isTypedArray:vc,isFileList:pc,forEach:Jt,merge:_i,extend:kc,trim:bc,stripBOM:Rc,inherits:Cc,toFlatObject:Ic,kindOf:On,kindOfTest:Ee,endsWith:Ac,toArray:Nc,forEachEntry:Oc,matchAll:xc,isHTMLForm:Pc,hasOwnProperty:kr,hasOwnProp:kr,reduceDescriptors:Fs,freezeMethods:Mc,toObjectSet:Dc,toCamelCase:Fc,noop:Uc,toFiniteNumber:Bc,findKey:xs,global:Qe,isContextDefined:Ps,ALPHABET:Ls,generateString:Kc,isSpecCompliantForm:Vc,toJSONObject:Hc,isAsyncFn:qc,isThenable:$c,setImmediate:Ms,asap:Wc};var Ds={},Fn={};Fn.byteLength=jc;Fn.toByteArray=zc;Fn.fromByteArray=Zc;var ke=[],pe=[],Gc=typeof Uint8Array<"u"?Uint8Array:Array,Xn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var ft=0,Jc=Xn.length;ft<Jc;++ft)ke[ft]=Xn[ft],pe[Xn.charCodeAt(ft)]=ft;pe[45]=62;pe[95]=63;function Us(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var i=t===e?0:4-t%4;return[t,i]}function jc(n){var e=Us(n),t=e[0],i=e[1];return(t+i)*3/4-i}function Yc(n,e,t){return(e+t)*3/4-t}function zc(n){var e,t=Us(n),i=t[0],r=t[1],s=new Gc(Yc(n,i,r)),o=0,l=r>0?i-4:i,f;for(f=0;f<l;f+=4)e=pe[n.charCodeAt(f)]<<18|pe[n.charCodeAt(f+1)]<<12|pe[n.charCodeAt(f+2)]<<6|pe[n.charCodeAt(f+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return r===2&&(e=pe[n.charCodeAt(f)]<<2|pe[n.charCodeAt(f+1)]>>4,s[o++]=e&255),r===1&&(e=pe[n.charCodeAt(f)]<<10|pe[n.charCodeAt(f+1)]<<4|pe[n.charCodeAt(f+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function Xc(n){return ke[n>>18&63]+ke[n>>12&63]+ke[n>>6&63]+ke[n&63]}function Qc(n,e,t){for(var i,r=[],s=e;s<t;s+=3)i=(n[s]<<16&16711680)+(n[s+1]<<8&65280)+(n[s+2]&255),r.push(Xc(i));return r.join("")}function Zc(n){for(var e,t=n.length,i=t%3,r=[],s=16383,o=0,l=t-i;o<l;o+=s)r.push(Qc(n,o,o+s>l?l:o+s));return i===1?(e=n[t-1],r.push(ke[e>>2]+ke[e<<4&63]+"==")):i===2&&(e=(n[t-2]<<8)+n[t-1],r.push(ke[e>>10]+ke[e>>4&63]+ke[e<<2&63]+"=")),r.join("")}var Ui={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Ui.read=function(n,e,t,i,r){var s,o,l=r*8-i-1,f=(1<<l)-1,h=f>>1,u=-7,p=t?r-1:0,y=t?-1:1,k=n[e+p];for(p+=y,s=k&(1<<-u)-1,k>>=-u,u+=l;u>0;s=s*256+n[e+p],p+=y,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=i;u>0;o=o*256+n[e+p],p+=y,u-=8);if(s===0)s=1-h;else{if(s===f)return o?NaN:(k?-1:1)*(1/0);o=o+Math.pow(2,i),s=s-h}return(k?-1:1)*o*Math.pow(2,s-i)};Ui.write=function(n,e,t,i,r,s){var o,l,f,h=s*8-r-1,u=(1<<h)-1,p=u>>1,y=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,k=i?0:s-1,w=i?1:-1,C=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(f=Math.pow(2,-o))<1&&(o--,f*=2),o+p>=1?e+=y/f:e+=y*Math.pow(2,1-p),e*f>=2&&(o++,f/=2),o+p>=u?(l=0,o=u):o+p>=1?(l=(e*f-1)*Math.pow(2,r),o=o+p):(l=e*Math.pow(2,p-1)*Math.pow(2,r),o=0));r>=8;n[t+k]=l&255,k+=w,l/=256,r-=8);for(o=o<<r|l,h+=r;h>0;n[t+k]=o&255,k+=w,o/=256,h-=8);n[t+k-w]|=C*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(n){const e=Fn,t=Ui,i=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=u,n.SlowBuffer=v,n.INSPECT_MAX_BYTES=50;const r=2147483647;n.kMaxLength=r;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:l}=globalThis;u.TYPED_ARRAY_SUPPORT=f(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function f(){try{const d=new s(1),a={foo:function(){return 42}};return Object.setPrototypeOf(a,s.prototype),Object.setPrototypeOf(d,a),d.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function h(d){if(d>r)throw new RangeError('The value "'+d+'" is invalid for option "size"');const a=new s(d);return Object.setPrototypeOf(a,u.prototype),a}function u(d,a,c){if(typeof d=="number"){if(typeof a=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return w(d)}return p(d,a,c)}u.poolSize=8192;function p(d,a,c){if(typeof d=="string")return C(d,a);if(o.isView(d))return x(d);if(d==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof d);if(Te(d,o)||d&&Te(d.buffer,o)||typeof l<"u"&&(Te(d,l)||d&&Te(d.buffer,l)))return N(d,a,c);if(typeof d=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const m=d.valueOf&&d.valueOf();if(m!=null&&m!==d)return u.from(m,a,c);const g=A(d);if(g)return g;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof d[Symbol.toPrimitive]=="function")return u.from(d[Symbol.toPrimitive]("string"),a,c);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof d)}u.from=function(d,a,c){return p(d,a,c)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function y(d){if(typeof d!="number")throw new TypeError('"size" argument must be of type number');if(d<0)throw new RangeError('The value "'+d+'" is invalid for option "size"')}function k(d,a,c){return y(d),d<=0?h(d):a!==void 0?typeof c=="string"?h(d).fill(a,c):h(d).fill(a):h(d)}u.alloc=function(d,a,c){return k(d,a,c)};function w(d){return y(d),h(d<0?0:O(d)|0)}u.allocUnsafe=function(d){return w(d)},u.allocUnsafeSlow=function(d){return w(d)};function C(d,a){if((typeof a!="string"||a==="")&&(a="utf8"),!u.isEncoding(a))throw new TypeError("Unknown encoding: "+a);const c=q(d,a)|0;let m=h(c);const g=m.write(d,a);return g!==c&&(m=m.slice(0,g)),m}function R(d){const a=d.length<0?0:O(d.length)|0,c=h(a);for(let m=0;m<a;m+=1)c[m]=d[m]&255;return c}function x(d){if(Te(d,s)){const a=new s(d);return N(a.buffer,a.byteOffset,a.byteLength)}return R(d)}function N(d,a,c){if(a<0||d.byteLength<a)throw new RangeError('"offset" is outside of buffer bounds');if(d.byteLength<a+(c||0))throw new RangeError('"length" is outside of buffer bounds');let m;return a===void 0&&c===void 0?m=new s(d):c===void 0?m=new s(d,a):m=new s(d,a,c),Object.setPrototypeOf(m,u.prototype),m}function A(d){if(u.isBuffer(d)){const a=O(d.length)|0,c=h(a);return c.length===0||d.copy(c,0,0,a),c}if(d.length!==void 0)return typeof d.length!="number"||Yn(d.length)?h(0):R(d);if(d.type==="Buffer"&&Array.isArray(d.data))return R(d.data)}function O(d){if(d>=r)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r.toString(16)+" bytes");return d|0}function v(d){return+d!=d&&(d=0),u.alloc(+d)}u.isBuffer=function(a){return a!=null&&a._isBuffer===!0&&a!==u.prototype},u.compare=function(a,c){if(Te(a,s)&&(a=u.from(a,a.offset,a.byteLength)),Te(c,s)&&(c=u.from(c,c.offset,c.byteLength)),!u.isBuffer(a)||!u.isBuffer(c))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(a===c)return 0;let m=a.length,g=c.length;for(let _=0,T=Math.min(m,g);_<T;++_)if(a[_]!==c[_]){m=a[_],g=c[_];break}return m<g?-1:g<m?1:0},u.isEncoding=function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(a,c){if(!Array.isArray(a))throw new TypeError('"list" argument must be an Array of Buffers');if(a.length===0)return u.alloc(0);let m;if(c===void 0)for(c=0,m=0;m<a.length;++m)c+=a[m].length;const g=u.allocUnsafe(c);let _=0;for(m=0;m<a.length;++m){let T=a[m];if(Te(T,s))_+T.length>g.length?(u.isBuffer(T)||(T=u.from(T)),T.copy(g,_)):s.prototype.set.call(g,T,_);else if(u.isBuffer(T))T.copy(g,_);else throw new TypeError('"list" argument must be an Array of Buffers');_+=T.length}return g};function q(d,a){if(u.isBuffer(d))return d.length;if(o.isView(d)||Te(d,o))return d.byteLength;if(typeof d!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof d);const c=d.length,m=arguments.length>2&&arguments[2]===!0;if(!m&&c===0)return 0;let g=!1;for(;;)switch(a){case"ascii":case"latin1":case"binary":return c;case"utf8":case"utf-8":return jn(d).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c*2;case"hex":return c>>>1;case"base64":return mr(d).length;default:if(g)return m?-1:jn(d).length;a=(""+a).toLowerCase(),g=!0}}u.byteLength=q;function te(d,a,c){let m=!1;if((a===void 0||a<0)&&(a=0),a>this.length||((c===void 0||c>this.length)&&(c=this.length),c<=0)||(c>>>=0,a>>>=0,c<=a))return"";for(d||(d="utf8");;)switch(d){case"hex":return ut(this,a,c);case"utf8":case"utf-8":return Gn(this,a,c);case"ascii":return Ye(this,a,c);case"latin1":case"binary":return oe(this,a,c);case"base64":return Wn(this,a,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return un(this,a,c);default:if(m)throw new TypeError("Unknown encoding: "+d);d=(d+"").toLowerCase(),m=!0}}u.prototype._isBuffer=!0;function X(d,a,c){const m=d[a];d[a]=d[c],d[c]=m}u.prototype.swap16=function(){const a=this.length;if(a%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let c=0;c<a;c+=2)X(this,c,c+1);return this},u.prototype.swap32=function(){const a=this.length;if(a%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let c=0;c<a;c+=4)X(this,c,c+3),X(this,c+1,c+2);return this},u.prototype.swap64=function(){const a=this.length;if(a%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let c=0;c<a;c+=8)X(this,c,c+7),X(this,c+1,c+6),X(this,c+2,c+5),X(this,c+3,c+4);return this},u.prototype.toString=function(){const a=this.length;return a===0?"":arguments.length===0?Gn(this,0,a):te.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(a){if(!u.isBuffer(a))throw new TypeError("Argument must be a Buffer");return this===a?!0:u.compare(this,a)===0},u.prototype.inspect=function(){let a="";const c=n.INSPECT_MAX_BYTES;return a=this.toString("hex",0,c).replace(/(.{2})/g,"$1 ").trim(),this.length>c&&(a+=" ... "),"<Buffer "+a+">"},i&&(u.prototype[i]=u.prototype.inspect),u.prototype.compare=function(a,c,m,g,_){if(Te(a,s)&&(a=u.from(a,a.offset,a.byteLength)),!u.isBuffer(a))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof a);if(c===void 0&&(c=0),m===void 0&&(m=a?a.length:0),g===void 0&&(g=0),_===void 0&&(_=this.length),c<0||m>a.length||g<0||_>this.length)throw new RangeError("out of range index");if(g>=_&&c>=m)return 0;if(g>=_)return-1;if(c>=m)return 1;if(c>>>=0,m>>>=0,g>>>=0,_>>>=0,this===a)return 0;let T=_-g,L=m-c;const j=Math.min(T,L),W=this.slice(g,_),Y=a.slice(c,m);for(let K=0;K<j;++K)if(W[K]!==Y[K]){T=W[K],L=Y[K];break}return T<L?-1:L<T?1:0};function Ce(d,a,c,m,g){if(d.length===0)return-1;if(typeof c=="string"?(m=c,c=0):c>2147483647?c=2147483647:c<-2147483648&&(c=-2147483648),c=+c,Yn(c)&&(c=g?0:d.length-1),c<0&&(c=d.length+c),c>=d.length){if(g)return-1;c=d.length-1}else if(c<0)if(g)c=0;else return-1;if(typeof a=="string"&&(a=u.from(a,m)),u.isBuffer(a))return a.length===0?-1:an(d,a,c,m,g);if(typeof a=="number")return a=a&255,typeof s.prototype.indexOf=="function"?g?s.prototype.indexOf.call(d,a,c):s.prototype.lastIndexOf.call(d,a,c):an(d,[a],c,m,g);throw new TypeError("val must be string, number or Buffer")}function an(d,a,c,m,g){let _=1,T=d.length,L=a.length;if(m!==void 0&&(m=String(m).toLowerCase(),m==="ucs2"||m==="ucs-2"||m==="utf16le"||m==="utf-16le")){if(d.length<2||a.length<2)return-1;_=2,T/=2,L/=2,c/=2}function j(Y,K){return _===1?Y[K]:Y.readUInt16BE(K*_)}let W;if(g){let Y=-1;for(W=c;W<T;W++)if(j(d,W)===j(a,Y===-1?0:W-Y)){if(Y===-1&&(Y=W),W-Y+1===L)return Y*_}else Y!==-1&&(W-=W-Y),Y=-1}else for(c+L>T&&(c=T-L),W=c;W>=0;W--){let Y=!0;for(let K=0;K<L;K++)if(j(d,W+K)!==j(a,K)){Y=!1;break}if(Y)return W}return-1}u.prototype.includes=function(a,c,m){return this.indexOf(a,c,m)!==-1},u.prototype.indexOf=function(a,c,m){return Ce(this,a,c,m,!0)},u.prototype.lastIndexOf=function(a,c,m){return Ce(this,a,c,m,!1)};function ce(d,a,c,m){c=Number(c)||0;const g=d.length-c;m?(m=Number(m),m>g&&(m=g)):m=g;const _=a.length;m>_/2&&(m=_/2);let T;for(T=0;T<m;++T){const L=parseInt(a.substr(T*2,2),16);if(Yn(L))return T;d[c+T]=L}return T}function ge(d,a,c,m){return ln(jn(a,d.length-c),d,c,m)}function je(d,a,c,m){return ln(Oa(a),d,c,m)}function ie(d,a,c,m){return ln(mr(a),d,c,m)}function $n(d,a,c,m){return ln(xa(a,d.length-c),d,c,m)}u.prototype.write=function(a,c,m,g){if(c===void 0)g="utf8",m=this.length,c=0;else if(m===void 0&&typeof c=="string")g=c,m=this.length,c=0;else if(isFinite(c))c=c>>>0,isFinite(m)?(m=m>>>0,g===void 0&&(g="utf8")):(g=m,m=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const _=this.length-c;if((m===void 0||m>_)&&(m=_),a.length>0&&(m<0||c<0)||c>this.length)throw new RangeError("Attempt to write outside buffer bounds");g||(g="utf8");let T=!1;for(;;)switch(g){case"hex":return ce(this,a,c,m);case"utf8":case"utf-8":return ge(this,a,c,m);case"ascii":case"latin1":case"binary":return je(this,a,c,m);case"base64":return ie(this,a,c,m);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $n(this,a,c,m);default:if(T)throw new TypeError("Unknown encoding: "+g);g=(""+g).toLowerCase(),T=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Wn(d,a,c){return a===0&&c===d.length?e.fromByteArray(d):e.fromByteArray(d.slice(a,c))}function Gn(d,a,c){c=Math.min(d.length,c);const m=[];let g=a;for(;g<c;){const _=d[g];let T=null,L=_>239?4:_>223?3:_>191?2:1;if(g+L<=c){let j,W,Y,K;switch(L){case 1:_<128&&(T=_);break;case 2:j=d[g+1],(j&192)===128&&(K=(_&31)<<6|j&63,K>127&&(T=K));break;case 3:j=d[g+1],W=d[g+2],(j&192)===128&&(W&192)===128&&(K=(_&15)<<12|(j&63)<<6|W&63,K>2047&&(K<55296||K>57343)&&(T=K));break;case 4:j=d[g+1],W=d[g+2],Y=d[g+3],(j&192)===128&&(W&192)===128&&(Y&192)===128&&(K=(_&15)<<18|(j&63)<<12|(W&63)<<6|Y&63,K>65535&&K<1114112&&(T=K))}}T===null?(T=65533,L=1):T>65535&&(T-=65536,m.push(T>>>10&1023|55296),T=56320|T&1023),m.push(T),g+=L}return J(m)}const cn=4096;function J(d){const a=d.length;if(a<=cn)return String.fromCharCode.apply(String,d);let c="",m=0;for(;m<a;)c+=String.fromCharCode.apply(String,d.slice(m,m+=cn));return c}function Ye(d,a,c){let m="";c=Math.min(d.length,c);for(let g=a;g<c;++g)m+=String.fromCharCode(d[g]&127);return m}function oe(d,a,c){let m="";c=Math.min(d.length,c);for(let g=a;g<c;++g)m+=String.fromCharCode(d[g]);return m}function ut(d,a,c){const m=d.length;(!a||a<0)&&(a=0),(!c||c<0||c>m)&&(c=m);let g="";for(let _=a;_<c;++_)g+=Pa[d[_]];return g}function un(d,a,c){const m=d.slice(a,c);let g="";for(let _=0;_<m.length-1;_+=2)g+=String.fromCharCode(m[_]+m[_+1]*256);return g}u.prototype.slice=function(a,c){const m=this.length;a=~~a,c=c===void 0?m:~~c,a<0?(a+=m,a<0&&(a=0)):a>m&&(a=m),c<0?(c+=m,c<0&&(c=0)):c>m&&(c=m),c<a&&(c=a);const g=this.subarray(a,c);return Object.setPrototypeOf(g,u.prototype),g};function Q(d,a,c){if(d%1!==0||d<0)throw new RangeError("offset is not uint");if(d+a>c)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(a,c,m){a=a>>>0,c=c>>>0,m||Q(a,c,this.length);let g=this[a],_=1,T=0;for(;++T<c&&(_*=256);)g+=this[a+T]*_;return g},u.prototype.readUintBE=u.prototype.readUIntBE=function(a,c,m){a=a>>>0,c=c>>>0,m||Q(a,c,this.length);let g=this[a+--c],_=1;for(;c>0&&(_*=256);)g+=this[a+--c]*_;return g},u.prototype.readUint8=u.prototype.readUInt8=function(a,c){return a=a>>>0,c||Q(a,1,this.length),this[a]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(a,c){return a=a>>>0,c||Q(a,2,this.length),this[a]|this[a+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(a,c){return a=a>>>0,c||Q(a,2,this.length),this[a]<<8|this[a+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(a,c){return a=a>>>0,c||Q(a,4,this.length),(this[a]|this[a+1]<<8|this[a+2]<<16)+this[a+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(a,c){return a=a>>>0,c||Q(a,4,this.length),this[a]*16777216+(this[a+1]<<16|this[a+2]<<8|this[a+3])},u.prototype.readBigUInt64LE=Me(function(a){a=a>>>0,dt(a,"offset");const c=this[a],m=this[a+7];(c===void 0||m===void 0)&&Ot(a,this.length-8);const g=c+this[++a]*2**8+this[++a]*2**16+this[++a]*2**24,_=this[++a]+this[++a]*2**8+this[++a]*2**16+m*2**24;return BigInt(g)+(BigInt(_)<<BigInt(32))}),u.prototype.readBigUInt64BE=Me(function(a){a=a>>>0,dt(a,"offset");const c=this[a],m=this[a+7];(c===void 0||m===void 0)&&Ot(a,this.length-8);const g=c*2**24+this[++a]*2**16+this[++a]*2**8+this[++a],_=this[++a]*2**24+this[++a]*2**16+this[++a]*2**8+m;return(BigInt(g)<<BigInt(32))+BigInt(_)}),u.prototype.readIntLE=function(a,c,m){a=a>>>0,c=c>>>0,m||Q(a,c,this.length);let g=this[a],_=1,T=0;for(;++T<c&&(_*=256);)g+=this[a+T]*_;return _*=128,g>=_&&(g-=Math.pow(2,8*c)),g},u.prototype.readIntBE=function(a,c,m){a=a>>>0,c=c>>>0,m||Q(a,c,this.length);let g=c,_=1,T=this[a+--g];for(;g>0&&(_*=256);)T+=this[a+--g]*_;return _*=128,T>=_&&(T-=Math.pow(2,8*c)),T},u.prototype.readInt8=function(a,c){return a=a>>>0,c||Q(a,1,this.length),this[a]&128?(255-this[a]+1)*-1:this[a]},u.prototype.readInt16LE=function(a,c){a=a>>>0,c||Q(a,2,this.length);const m=this[a]|this[a+1]<<8;return m&32768?m|4294901760:m},u.prototype.readInt16BE=function(a,c){a=a>>>0,c||Q(a,2,this.length);const m=this[a+1]|this[a]<<8;return m&32768?m|4294901760:m},u.prototype.readInt32LE=function(a,c){return a=a>>>0,c||Q(a,4,this.length),this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24},u.prototype.readInt32BE=function(a,c){return a=a>>>0,c||Q(a,4,this.length),this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]},u.prototype.readBigInt64LE=Me(function(a){a=a>>>0,dt(a,"offset");const c=this[a],m=this[a+7];(c===void 0||m===void 0)&&Ot(a,this.length-8);const g=this[a+4]+this[a+5]*2**8+this[a+6]*2**16+(m<<24);return(BigInt(g)<<BigInt(32))+BigInt(c+this[++a]*2**8+this[++a]*2**16+this[++a]*2**24)}),u.prototype.readBigInt64BE=Me(function(a){a=a>>>0,dt(a,"offset");const c=this[a],m=this[a+7];(c===void 0||m===void 0)&&Ot(a,this.length-8);const g=(c<<24)+this[++a]*2**16+this[++a]*2**8+this[++a];return(BigInt(g)<<BigInt(32))+BigInt(this[++a]*2**24+this[++a]*2**16+this[++a]*2**8+m)}),u.prototype.readFloatLE=function(a,c){return a=a>>>0,c||Q(a,4,this.length),t.read(this,a,!0,23,4)},u.prototype.readFloatBE=function(a,c){return a=a>>>0,c||Q(a,4,this.length),t.read(this,a,!1,23,4)},u.prototype.readDoubleLE=function(a,c){return a=a>>>0,c||Q(a,8,this.length),t.read(this,a,!0,52,8)},u.prototype.readDoubleBE=function(a,c){return a=a>>>0,c||Q(a,8,this.length),t.read(this,a,!1,52,8)};function re(d,a,c,m,g,_){if(!u.isBuffer(d))throw new TypeError('"buffer" argument must be a Buffer instance');if(a>g||a<_)throw new RangeError('"value" argument is out of bounds');if(c+m>d.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(a,c,m,g){if(a=+a,c=c>>>0,m=m>>>0,!g){const L=Math.pow(2,8*m)-1;re(this,a,c,m,L,0)}let _=1,T=0;for(this[c]=a&255;++T<m&&(_*=256);)this[c+T]=a/_&255;return c+m},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(a,c,m,g){if(a=+a,c=c>>>0,m=m>>>0,!g){const L=Math.pow(2,8*m)-1;re(this,a,c,m,L,0)}let _=m-1,T=1;for(this[c+_]=a&255;--_>=0&&(T*=256);)this[c+_]=a/T&255;return c+m},u.prototype.writeUint8=u.prototype.writeUInt8=function(a,c,m){return a=+a,c=c>>>0,m||re(this,a,c,1,255,0),this[c]=a&255,c+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(a,c,m){return a=+a,c=c>>>0,m||re(this,a,c,2,65535,0),this[c]=a&255,this[c+1]=a>>>8,c+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(a,c,m){return a=+a,c=c>>>0,m||re(this,a,c,2,65535,0),this[c]=a>>>8,this[c+1]=a&255,c+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(a,c,m){return a=+a,c=c>>>0,m||re(this,a,c,4,4294967295,0),this[c+3]=a>>>24,this[c+2]=a>>>16,this[c+1]=a>>>8,this[c]=a&255,c+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(a,c,m){return a=+a,c=c>>>0,m||re(this,a,c,4,4294967295,0),this[c]=a>>>24,this[c+1]=a>>>16,this[c+2]=a>>>8,this[c+3]=a&255,c+4};function ar(d,a,c,m,g){fr(a,m,g,d,c,7);let _=Number(a&BigInt(4294967295));d[c++]=_,_=_>>8,d[c++]=_,_=_>>8,d[c++]=_,_=_>>8,d[c++]=_;let T=Number(a>>BigInt(32)&BigInt(4294967295));return d[c++]=T,T=T>>8,d[c++]=T,T=T>>8,d[c++]=T,T=T>>8,d[c++]=T,c}function cr(d,a,c,m,g){fr(a,m,g,d,c,7);let _=Number(a&BigInt(4294967295));d[c+7]=_,_=_>>8,d[c+6]=_,_=_>>8,d[c+5]=_,_=_>>8,d[c+4]=_;let T=Number(a>>BigInt(32)&BigInt(4294967295));return d[c+3]=T,T=T>>8,d[c+2]=T,T=T>>8,d[c+1]=T,T=T>>8,d[c]=T,c+8}u.prototype.writeBigUInt64LE=Me(function(a,c=0){return ar(this,a,c,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Me(function(a,c=0){return cr(this,a,c,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(a,c,m,g){if(a=+a,c=c>>>0,!g){const j=Math.pow(2,8*m-1);re(this,a,c,m,j-1,-j)}let _=0,T=1,L=0;for(this[c]=a&255;++_<m&&(T*=256);)a<0&&L===0&&this[c+_-1]!==0&&(L=1),this[c+_]=(a/T>>0)-L&255;return c+m},u.prototype.writeIntBE=function(a,c,m,g){if(a=+a,c=c>>>0,!g){const j=Math.pow(2,8*m-1);re(this,a,c,m,j-1,-j)}let _=m-1,T=1,L=0;for(this[c+_]=a&255;--_>=0&&(T*=256);)a<0&&L===0&&this[c+_+1]!==0&&(L=1),this[c+_]=(a/T>>0)-L&255;return c+m},u.prototype.writeInt8=function(a,c,m){return a=+a,c=c>>>0,m||re(this,a,c,1,127,-128),a<0&&(a=255+a+1),this[c]=a&255,c+1},u.prototype.writeInt16LE=function(a,c,m){return a=+a,c=c>>>0,m||re(this,a,c,2,32767,-32768),this[c]=a&255,this[c+1]=a>>>8,c+2},u.prototype.writeInt16BE=function(a,c,m){return a=+a,c=c>>>0,m||re(this,a,c,2,32767,-32768),this[c]=a>>>8,this[c+1]=a&255,c+2},u.prototype.writeInt32LE=function(a,c,m){return a=+a,c=c>>>0,m||re(this,a,c,4,2147483647,-2147483648),this[c]=a&255,this[c+1]=a>>>8,this[c+2]=a>>>16,this[c+3]=a>>>24,c+4},u.prototype.writeInt32BE=function(a,c,m){return a=+a,c=c>>>0,m||re(this,a,c,4,2147483647,-2147483648),a<0&&(a=4294967295+a+1),this[c]=a>>>24,this[c+1]=a>>>16,this[c+2]=a>>>8,this[c+3]=a&255,c+4},u.prototype.writeBigInt64LE=Me(function(a,c=0){return ar(this,a,c,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Me(function(a,c=0){return cr(this,a,c,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function ur(d,a,c,m,g,_){if(c+m>d.length)throw new RangeError("Index out of range");if(c<0)throw new RangeError("Index out of range")}function lr(d,a,c,m,g){return a=+a,c=c>>>0,g||ur(d,a,c,4),t.write(d,a,c,m,23,4),c+4}u.prototype.writeFloatLE=function(a,c,m){return lr(this,a,c,!0,m)},u.prototype.writeFloatBE=function(a,c,m){return lr(this,a,c,!1,m)};function dr(d,a,c,m,g){return a=+a,c=c>>>0,g||ur(d,a,c,8),t.write(d,a,c,m,52,8),c+8}u.prototype.writeDoubleLE=function(a,c,m){return dr(this,a,c,!0,m)},u.prototype.writeDoubleBE=function(a,c,m){return dr(this,a,c,!1,m)},u.prototype.copy=function(a,c,m,g){if(!u.isBuffer(a))throw new TypeError("argument should be a Buffer");if(m||(m=0),!g&&g!==0&&(g=this.length),c>=a.length&&(c=a.length),c||(c=0),g>0&&g<m&&(g=m),g===m||a.length===0||this.length===0)return 0;if(c<0)throw new RangeError("targetStart out of bounds");if(m<0||m>=this.length)throw new RangeError("Index out of range");if(g<0)throw new RangeError("sourceEnd out of bounds");g>this.length&&(g=this.length),a.length-c<g-m&&(g=a.length-c+m);const _=g-m;return this===a&&typeof s.prototype.copyWithin=="function"?this.copyWithin(c,m,g):s.prototype.set.call(a,this.subarray(m,g),c),_},u.prototype.fill=function(a,c,m,g){if(typeof a=="string"){if(typeof c=="string"?(g=c,c=0,m=this.length):typeof m=="string"&&(g=m,m=this.length),g!==void 0&&typeof g!="string")throw new TypeError("encoding must be a string");if(typeof g=="string"&&!u.isEncoding(g))throw new TypeError("Unknown encoding: "+g);if(a.length===1){const T=a.charCodeAt(0);(g==="utf8"&&T<128||g==="latin1")&&(a=T)}}else typeof a=="number"?a=a&255:typeof a=="boolean"&&(a=Number(a));if(c<0||this.length<c||this.length<m)throw new RangeError("Out of range index");if(m<=c)return this;c=c>>>0,m=m===void 0?this.length:m>>>0,a||(a=0);let _;if(typeof a=="number")for(_=c;_<m;++_)this[_]=a;else{const T=u.isBuffer(a)?a:u.from(a,g),L=T.length;if(L===0)throw new TypeError('The value "'+a+'" is invalid for argument "value"');for(_=0;_<m-c;++_)this[_+c]=T[_%L]}return this};const lt={};function Jn(d,a,c){lt[d]=class extends c{constructor(){super(),Object.defineProperty(this,"message",{value:a.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${d}]`,this.stack,delete this.name}get code(){return d}set code(g){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:g,writable:!0})}toString(){return`${this.name} [${d}]: ${this.message}`}}}Jn("ERR_BUFFER_OUT_OF_BOUNDS",function(d){return d?`${d} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Jn("ERR_INVALID_ARG_TYPE",function(d,a){return`The "${d}" argument must be of type number. Received type ${typeof a}`},TypeError),Jn("ERR_OUT_OF_RANGE",function(d,a,c){let m=`The value of "${d}" is out of range.`,g=c;return Number.isInteger(c)&&Math.abs(c)>2**32?g=hr(String(c)):typeof c=="bigint"&&(g=String(c),(c>BigInt(2)**BigInt(32)||c<-(BigInt(2)**BigInt(32)))&&(g=hr(g)),g+="n"),m+=` It must be ${a}. Received ${g}`,m},RangeError);function hr(d){let a="",c=d.length;const m=d[0]==="-"?1:0;for(;c>=m+4;c-=3)a=`_${d.slice(c-3,c)}${a}`;return`${d.slice(0,c)}${a}`}function Aa(d,a,c){dt(a,"offset"),(d[a]===void 0||d[a+c]===void 0)&&Ot(a,d.length-(c+1))}function fr(d,a,c,m,g,_){if(d>c||d<a){const T=typeof a=="bigint"?"n":"";let L;throw a===0||a===BigInt(0)?L=`>= 0${T} and < 2${T} ** ${(_+1)*8}${T}`:L=`>= -(2${T} ** ${(_+1)*8-1}${T}) and < 2 ** ${(_+1)*8-1}${T}`,new lt.ERR_OUT_OF_RANGE("value",L,d)}Aa(m,g,_)}function dt(d,a){if(typeof d!="number")throw new lt.ERR_INVALID_ARG_TYPE(a,"number",d)}function Ot(d,a,c){throw Math.floor(d)!==d?(dt(d,c),new lt.ERR_OUT_OF_RANGE("offset","an integer",d)):a<0?new lt.ERR_BUFFER_OUT_OF_BOUNDS:new lt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${a}`,d)}const Na=/[^+/0-9A-Za-z-_]/g;function va(d){if(d=d.split("=")[0],d=d.trim().replace(Na,""),d.length<2)return"";for(;d.length%4!==0;)d=d+"=";return d}function jn(d,a){a=a||1/0;let c;const m=d.length;let g=null;const _=[];for(let T=0;T<m;++T){if(c=d.charCodeAt(T),c>55295&&c<57344){if(!g){if(c>56319){(a-=3)>-1&&_.push(239,191,189);continue}else if(T+1===m){(a-=3)>-1&&_.push(239,191,189);continue}g=c;continue}if(c<56320){(a-=3)>-1&&_.push(239,191,189),g=c;continue}c=(g-55296<<10|c-56320)+65536}else g&&(a-=3)>-1&&_.push(239,191,189);if(g=null,c<128){if((a-=1)<0)break;_.push(c)}else if(c<2048){if((a-=2)<0)break;_.push(c>>6|192,c&63|128)}else if(c<65536){if((a-=3)<0)break;_.push(c>>12|224,c>>6&63|128,c&63|128)}else if(c<1114112){if((a-=4)<0)break;_.push(c>>18|240,c>>12&63|128,c>>6&63|128,c&63|128)}else throw new Error("Invalid code point")}return _}function Oa(d){const a=[];for(let c=0;c<d.length;++c)a.push(d.charCodeAt(c)&255);return a}function xa(d,a){let c,m,g;const _=[];for(let T=0;T<d.length&&!((a-=2)<0);++T)c=d.charCodeAt(T),m=c>>8,g=c%256,_.push(g),_.push(m);return _}function mr(d){return e.toByteArray(va(d))}function ln(d,a,c,m){let g;for(g=0;g<m&&!(g+c>=a.length||g>=d.length);++g)a[g+c]=d[g];return g}function Te(d,a){return d instanceof a||d!=null&&d.constructor!=null&&d.constructor.name!=null&&d.constructor.name===a.name}function Yn(d){return d!==d}const Pa=function(){const d="0123456789abcdef",a=new Array(256);for(let c=0;c<16;++c){const m=c*16;for(let g=0;g<16;++g)a[m+g]=d[c]+d[g]}return a}();function Me(d){return typeof BigInt>"u"?Fa:d}function Fa(){throw new Error("BigInt not supported")}})(Ds);const eu=Ds.Buffer;function P(n,e,t,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}E.inherits(P,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:E.toJSONObject(this.config),code:this.code,status:this.status}}});const Bs=P.prototype,Ks={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{Ks[n]={value:n}});Object.defineProperties(P,Ks);Object.defineProperty(Bs,"isAxiosError",{value:!0});P.from=(n,e,t,i,r,s)=>{const o=Object.create(Bs);return E.toFlatObject(n,o,function(f){return f!==Error.prototype},l=>l!=="isAxiosError"),P.call(o,n.message,e,t,i,r),o.cause=n,o.name=n.name,s&&Object.assign(o,s),o};const tu=null;function yi(n){return E.isPlainObject(n)||E.isArray(n)}function Vs(n){return E.endsWith(n,"[]")?n.slice(0,-2):n}function Cr(n,e,t){return n?n.concat(e).map(function(r,s){return r=Vs(r),!t&&s?"["+r+"]":r}).join(t?".":""):e}function nu(n){return E.isArray(n)&&!n.some(yi)}const iu=E.toFlatObject(E,{},null,function(e){return/^is[A-Z]/.test(e)});function Ln(n,e,t){if(!E.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=E.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(C,R){return!E.isUndefined(R[C])});const i=t.metaTokens,r=t.visitor||u,s=t.dots,o=t.indexes,f=(t.Blob||typeof Blob<"u"&&Blob)&&E.isSpecCompliantForm(e);if(!E.isFunction(r))throw new TypeError("visitor must be a function");function h(w){if(w===null)return"";if(E.isDate(w))return w.toISOString();if(!f&&E.isBlob(w))throw new P("Blob is not supported. Use a Buffer instead.");return E.isArrayBuffer(w)||E.isTypedArray(w)?f&&typeof Blob=="function"?new Blob([w]):eu.from(w):w}function u(w,C,R){let x=w;if(w&&!R&&typeof w=="object"){if(E.endsWith(C,"{}"))C=i?C:C.slice(0,-2),w=JSON.stringify(w);else if(E.isArray(w)&&nu(w)||(E.isFileList(w)||E.endsWith(C,"[]"))&&(x=E.toArray(w)))return C=Vs(C),x.forEach(function(A,O){!(E.isUndefined(A)||A===null)&&e.append(o===!0?Cr([C],O,s):o===null?C:C+"[]",h(A))}),!1}return yi(w)?!0:(e.append(Cr(R,C,s),h(w)),!1)}const p=[],y=Object.assign(iu,{defaultVisitor:u,convertValue:h,isVisitable:yi});function k(w,C){if(!E.isUndefined(w)){if(p.indexOf(w)!==-1)throw Error("Circular reference detected in "+C.join("."));p.push(w),E.forEach(w,function(x,N){(!(E.isUndefined(x)||x===null)&&r.call(e,x,E.isString(N)?N.trim():N,C,y))===!0&&k(x,C?C.concat(N):[N])}),p.pop()}}if(!E.isObject(n))throw new TypeError("data must be an object");return k(n),e}function Ir(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(i){return e[i]})}function Bi(n,e){this._pairs=[],n&&Ln(n,this,e)}const Hs=Bi.prototype;Hs.append=function(e,t){this._pairs.push([e,t])};Hs.toString=function(e){const t=e?function(i){return e.call(this,i,Ir)}:Ir;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};function ru(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function qs(n,e,t){if(!e)return n;const i=t&&t.encode||ru,r=t&&t.serialize;let s;if(r?s=r(e,t):s=E.isURLSearchParams(e)?e.toString():new Bi(e,t).toString(i),s){const o=n.indexOf("#");o!==-1&&(n=n.slice(0,o)),n+=(n.indexOf("?")===-1?"?":"&")+s}return n}class Ar{constructor(){this.handlers=[]}use(e,t,i){return this.handlers.push({fulfilled:e,rejected:t,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){E.forEach(this.handlers,function(i){i!==null&&e(i)})}}const $s={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},su=typeof URLSearchParams<"u"?URLSearchParams:Bi,ou=typeof FormData<"u"?FormData:null,au=typeof Blob<"u"?Blob:null,cu={isBrowser:!0,classes:{URLSearchParams:su,FormData:ou,Blob:au},protocols:["http","https","file","blob","url","data"]},Ki=typeof window<"u"&&typeof document<"u",Ei=typeof navigator=="object"&&navigator||void 0,uu=Ki&&(!Ei||["ReactNative","NativeScript","NS"].indexOf(Ei.product)<0),lu=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",du=Ki&&window.location.href||"http://localhost",hu=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ki,hasStandardBrowserEnv:uu,hasStandardBrowserWebWorkerEnv:lu,navigator:Ei,origin:du},Symbol.toStringTag,{value:"Module"})),le={...hu,...cu};function fu(n,e){return Ln(n,new le.classes.URLSearchParams,Object.assign({visitor:function(t,i,r,s){return le.isNode&&E.isBuffer(t)?(this.append(i,t.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function mu(n){return E.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function pu(n){const e={},t=Object.keys(n);let i;const r=t.length;let s;for(i=0;i<r;i++)s=t[i],e[s]=n[s];return e}function Ws(n){function e(t,i,r,s){let o=t[s++];if(o==="__proto__")return!0;const l=Number.isFinite(+o),f=s>=t.length;return o=!o&&E.isArray(r)?r.length:o,f?(E.hasOwnProp(r,o)?r[o]=[r[o],i]:r[o]=i,!l):((!r[o]||!E.isObject(r[o]))&&(r[o]=[]),e(t,i,r[o],s)&&E.isArray(r[o])&&(r[o]=pu(r[o])),!l)}if(E.isFormData(n)&&E.isFunction(n.entries)){const t={};return E.forEachEntry(n,(i,r)=>{e(mu(i),r,t,0)}),t}return null}function gu(n,e,t){if(E.isString(n))try{return(e||JSON.parse)(n),E.trim(n)}catch(i){if(i.name!=="SyntaxError")throw i}return(0,JSON.stringify)(n)}const jt={transitional:$s,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const i=t.getContentType()||"",r=i.indexOf("application/json")>-1,s=E.isObject(e);if(s&&E.isHTMLForm(e)&&(e=new FormData(e)),E.isFormData(e))return r?JSON.stringify(Ws(e)):e;if(E.isArrayBuffer(e)||E.isBuffer(e)||E.isStream(e)||E.isFile(e)||E.isBlob(e)||E.isReadableStream(e))return e;if(E.isArrayBufferView(e))return e.buffer;if(E.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(s){if(i.indexOf("application/x-www-form-urlencoded")>-1)return fu(e,this.formSerializer).toString();if((l=E.isFileList(e))||i.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return Ln(l?{"files[]":e}:e,f&&new f,this.formSerializer)}}return s||r?(t.setContentType("application/json",!1),gu(e)):e}],transformResponse:[function(e){const t=this.transitional||jt.transitional,i=t&&t.forcedJSONParsing,r=this.responseType==="json";if(E.isResponse(e)||E.isReadableStream(e))return e;if(e&&E.isString(e)&&(i&&!this.responseType||r)){const o=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(l){if(o)throw l.name==="SyntaxError"?P.from(l,P.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:le.classes.FormData,Blob:le.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};E.forEach(["delete","get","head","post","put","patch"],n=>{jt.headers[n]={}});const _u=E.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),yu=n=>{const e={};let t,i,r;return n&&n.split(`
`).forEach(function(o){r=o.indexOf(":"),t=o.substring(0,r).trim().toLowerCase(),i=o.substring(r+1).trim(),!(!t||e[t]&&_u[t])&&(t==="set-cookie"?e[t]?e[t].push(i):e[t]=[i]:e[t]=e[t]?e[t]+", "+i:i)}),e},Nr=Symbol("internals");function xt(n){return n&&String(n).trim().toLowerCase()}function gn(n){return n===!1||n==null?n:E.isArray(n)?n.map(gn):String(n)}function Eu(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=t.exec(n);)e[i[1]]=i[2];return e}const Tu=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function Qn(n,e,t,i,r){if(E.isFunction(i))return i.call(this,e,t);if(r&&(e=t),!!E.isString(e)){if(E.isString(i))return e.indexOf(i)!==-1;if(E.isRegExp(i))return i.test(e)}}function wu(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,i)=>t.toUpperCase()+i)}function Su(n,e){const t=E.toCamelCase(" "+e);["get","set","has"].forEach(i=>{Object.defineProperty(n,i+t,{value:function(r,s,o){return this[i].call(this,e,r,s,o)},configurable:!0})})}class de{constructor(e){e&&this.set(e)}set(e,t,i){const r=this;function s(l,f,h){const u=xt(f);if(!u)throw new Error("header name must be a non-empty string");const p=E.findKey(r,u);(!p||r[p]===void 0||h===!0||h===void 0&&r[p]!==!1)&&(r[p||f]=gn(l))}const o=(l,f)=>E.forEach(l,(h,u)=>s(h,u,f));if(E.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(E.isString(e)&&(e=e.trim())&&!Tu(e))o(yu(e),t);else if(E.isHeaders(e))for(const[l,f]of e.entries())s(f,l,i);else e!=null&&s(t,e,i);return this}get(e,t){if(e=xt(e),e){const i=E.findKey(this,e);if(i){const r=this[i];if(!t)return r;if(t===!0)return Eu(r);if(E.isFunction(t))return t.call(this,r,i);if(E.isRegExp(t))return t.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=xt(e),e){const i=E.findKey(this,e);return!!(i&&this[i]!==void 0&&(!t||Qn(this,this[i],i,t)))}return!1}delete(e,t){const i=this;let r=!1;function s(o){if(o=xt(o),o){const l=E.findKey(i,o);l&&(!t||Qn(i,i[l],l,t))&&(delete i[l],r=!0)}}return E.isArray(e)?e.forEach(s):s(e),r}clear(e){const t=Object.keys(this);let i=t.length,r=!1;for(;i--;){const s=t[i];(!e||Qn(this,this[s],s,e,!0))&&(delete this[s],r=!0)}return r}normalize(e){const t=this,i={};return E.forEach(this,(r,s)=>{const o=E.findKey(i,s);if(o){t[o]=gn(r),delete t[s];return}const l=e?wu(s):String(s).trim();l!==s&&delete t[s],t[l]=gn(r),i[l]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return E.forEach(this,(i,r)=>{i!=null&&i!==!1&&(t[r]=e&&E.isArray(i)?i.join(", "):i)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const i=new this(e);return t.forEach(r=>i.set(r)),i}static accessor(e){const i=(this[Nr]=this[Nr]={accessors:{}}).accessors,r=this.prototype;function s(o){const l=xt(o);i[l]||(Su(r,o),i[l]=!0)}return E.isArray(e)?e.forEach(s):s(e),this}}de.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);E.reduceDescriptors(de.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(i){this[t]=i}}});E.freezeMethods(de);function Zn(n,e){const t=this||jt,i=e||t,r=de.from(i.headers);let s=i.data;return E.forEach(n,function(l){s=l.call(t,s,r.normalize(),e?e.status:void 0)}),r.normalize(),s}function Gs(n){return!!(n&&n.__CANCEL__)}function Nt(n,e,t){P.call(this,n??"canceled",P.ERR_CANCELED,e,t),this.name="CanceledError"}E.inherits(Nt,P,{__CANCEL__:!0});function Js(n,e,t){const i=t.config.validateStatus;!t.status||!i||i(t.status)?n(t):e(new P("Request failed with status code "+t.status,[P.ERR_BAD_REQUEST,P.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function bu(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function ku(n,e){n=n||10;const t=new Array(n),i=new Array(n);let r=0,s=0,o;return e=e!==void 0?e:1e3,function(f){const h=Date.now(),u=i[s];o||(o=h),t[r]=f,i[r]=h;let p=s,y=0;for(;p!==r;)y+=t[p++],p=p%n;if(r=(r+1)%n,r===s&&(s=(s+1)%n),h-o<e)return;const k=u&&h-u;return k?Math.round(y*1e3/k):void 0}}function Ru(n,e){let t=0,i=1e3/e,r,s;const o=(h,u=Date.now())=>{t=u,r=null,s&&(clearTimeout(s),s=null),n.apply(null,h)};return[(...h)=>{const u=Date.now(),p=u-t;p>=i?o(h,u):(r=h,s||(s=setTimeout(()=>{s=null,o(r)},i-p)))},()=>r&&o(r)]}const bn=(n,e,t=3)=>{let i=0;const r=ku(50,250);return Ru(s=>{const o=s.loaded,l=s.lengthComputable?s.total:void 0,f=o-i,h=r(f),u=o<=l;i=o;const p={loaded:o,total:l,progress:l?o/l:void 0,bytes:f,rate:h||void 0,estimated:h&&l&&u?(l-o)/h:void 0,event:s,lengthComputable:l!=null,[e?"download":"upload"]:!0};n(p)},t)},vr=(n,e)=>{const t=n!=null;return[i=>e[0]({lengthComputable:t,total:n,loaded:i}),e[1]]},Or=n=>(...e)=>E.asap(()=>n(...e)),Cu=le.hasStandardBrowserEnv?function(){const e=le.navigator&&/(msie|trident)/i.test(le.navigator.userAgent),t=document.createElement("a");let i;function r(s){let o=s;return e&&(t.setAttribute("href",o),o=t.href),t.setAttribute("href",o),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return i=r(window.location.href),function(o){const l=E.isString(o)?r(o):o;return l.protocol===i.protocol&&l.host===i.host}}():function(){return function(){return!0}}(),Iu=le.hasStandardBrowserEnv?{write(n,e,t,i,r,s){const o=[n+"="+encodeURIComponent(e)];E.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),E.isString(i)&&o.push("path="+i),E.isString(r)&&o.push("domain="+r),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Au(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function Nu(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function js(n,e){return n&&!Au(e)?Nu(n,e):e}const xr=n=>n instanceof de?{...n}:n;function tt(n,e){e=e||{};const t={};function i(h,u,p){return E.isPlainObject(h)&&E.isPlainObject(u)?E.merge.call({caseless:p},h,u):E.isPlainObject(u)?E.merge({},u):E.isArray(u)?u.slice():u}function r(h,u,p){if(E.isUndefined(u)){if(!E.isUndefined(h))return i(void 0,h,p)}else return i(h,u,p)}function s(h,u){if(!E.isUndefined(u))return i(void 0,u)}function o(h,u){if(E.isUndefined(u)){if(!E.isUndefined(h))return i(void 0,h)}else return i(void 0,u)}function l(h,u,p){if(p in e)return i(h,u);if(p in n)return i(void 0,h)}const f={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:l,headers:(h,u)=>r(xr(h),xr(u),!0)};return E.forEach(Object.keys(Object.assign({},n,e)),function(u){const p=f[u]||r,y=p(n[u],e[u],u);E.isUndefined(y)&&p!==l||(t[u]=y)}),t}const Ys=n=>{const e=tt({},n);let{data:t,withXSRFToken:i,xsrfHeaderName:r,xsrfCookieName:s,headers:o,auth:l}=e;e.headers=o=de.from(o),e.url=qs(js(e.baseURL,e.url),n.params,n.paramsSerializer),l&&o.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):"")));let f;if(E.isFormData(t)){if(le.hasStandardBrowserEnv||le.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((f=o.getContentType())!==!1){const[h,...u]=f?f.split(";").map(p=>p.trim()).filter(Boolean):[];o.setContentType([h||"multipart/form-data",...u].join("; "))}}if(le.hasStandardBrowserEnv&&(i&&E.isFunction(i)&&(i=i(e)),i||i!==!1&&Cu(e.url))){const h=r&&s&&Iu.read(s);h&&o.set(r,h)}return e},vu=typeof XMLHttpRequest<"u",Ou=vu&&function(n){return new Promise(function(t,i){const r=Ys(n);let s=r.data;const o=de.from(r.headers).normalize();let{responseType:l,onUploadProgress:f,onDownloadProgress:h}=r,u,p,y,k,w;function C(){k&&k(),w&&w(),r.cancelToken&&r.cancelToken.unsubscribe(u),r.signal&&r.signal.removeEventListener("abort",u)}let R=new XMLHttpRequest;R.open(r.method.toUpperCase(),r.url,!0),R.timeout=r.timeout;function x(){if(!R)return;const A=de.from("getAllResponseHeaders"in R&&R.getAllResponseHeaders()),v={data:!l||l==="text"||l==="json"?R.responseText:R.response,status:R.status,statusText:R.statusText,headers:A,config:n,request:R};Js(function(te){t(te),C()},function(te){i(te),C()},v),R=null}"onloadend"in R?R.onloadend=x:R.onreadystatechange=function(){!R||R.readyState!==4||R.status===0&&!(R.responseURL&&R.responseURL.indexOf("file:")===0)||setTimeout(x)},R.onabort=function(){R&&(i(new P("Request aborted",P.ECONNABORTED,n,R)),R=null)},R.onerror=function(){i(new P("Network Error",P.ERR_NETWORK,n,R)),R=null},R.ontimeout=function(){let O=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const v=r.transitional||$s;r.timeoutErrorMessage&&(O=r.timeoutErrorMessage),i(new P(O,v.clarifyTimeoutError?P.ETIMEDOUT:P.ECONNABORTED,n,R)),R=null},s===void 0&&o.setContentType(null),"setRequestHeader"in R&&E.forEach(o.toJSON(),function(O,v){R.setRequestHeader(v,O)}),E.isUndefined(r.withCredentials)||(R.withCredentials=!!r.withCredentials),l&&l!=="json"&&(R.responseType=r.responseType),h&&([y,w]=bn(h,!0),R.addEventListener("progress",y)),f&&R.upload&&([p,k]=bn(f),R.upload.addEventListener("progress",p),R.upload.addEventListener("loadend",k)),(r.cancelToken||r.signal)&&(u=A=>{R&&(i(!A||A.type?new Nt(null,n,R):A),R.abort(),R=null)},r.cancelToken&&r.cancelToken.subscribe(u),r.signal&&(r.signal.aborted?u():r.signal.addEventListener("abort",u)));const N=bu(r.url);if(N&&le.protocols.indexOf(N)===-1){i(new P("Unsupported protocol "+N+":",P.ERR_BAD_REQUEST,n));return}R.send(s||null)})},xu=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let i=new AbortController,r;const s=function(h){if(!r){r=!0,l();const u=h instanceof Error?h:this.reason;i.abort(u instanceof P?u:new Nt(u instanceof Error?u.message:u))}};let o=e&&setTimeout(()=>{o=null,s(new P(`timeout ${e} of ms exceeded`,P.ETIMEDOUT))},e);const l=()=>{n&&(o&&clearTimeout(o),o=null,n.forEach(h=>{h.unsubscribe?h.unsubscribe(s):h.removeEventListener("abort",s)}),n=null)};n.forEach(h=>h.addEventListener("abort",s));const{signal:f}=i;return f.unsubscribe=()=>E.asap(l),f}},Pu=function*(n,e){let t=n.byteLength;if(t<e){yield n;return}let i=0,r;for(;i<t;)r=i+e,yield n.slice(i,r),i=r},Fu=async function*(n,e){for await(const t of Lu(n))yield*Pu(t,e)},Lu=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:i}=await e.read();if(t)break;yield i}}finally{await e.cancel()}},Pr=(n,e,t,i)=>{const r=Fu(n,e);let s=0,o,l=f=>{o||(o=!0,i&&i(f))};return new ReadableStream({async pull(f){try{const{done:h,value:u}=await r.next();if(h){l(),f.close();return}let p=u.byteLength;if(t){let y=s+=p;t(y)}f.enqueue(new Uint8Array(u))}catch(h){throw l(h),h}},cancel(f){return l(f),r.return()}},{highWaterMark:2})},Mn=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",zs=Mn&&typeof ReadableStream=="function",Mu=Mn&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),Xs=(n,...e)=>{try{return!!n(...e)}catch{return!1}},Du=zs&&Xs(()=>{let n=!1;const e=new Request(le.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),Fr=64*1024,Ti=zs&&Xs(()=>E.isReadableStream(new Response("").body)),kn={stream:Ti&&(n=>n.body)};Mn&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!kn[e]&&(kn[e]=E.isFunction(n[e])?t=>t[e]():(t,i)=>{throw new P(`Response type '${e}' is not supported`,P.ERR_NOT_SUPPORT,i)})})})(new Response);const Uu=async n=>{if(n==null)return 0;if(E.isBlob(n))return n.size;if(E.isSpecCompliantForm(n))return(await new Request(le.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(E.isArrayBufferView(n)||E.isArrayBuffer(n))return n.byteLength;if(E.isURLSearchParams(n)&&(n=n+""),E.isString(n))return(await Mu(n)).byteLength},Bu=async(n,e)=>{const t=E.toFiniteNumber(n.getContentLength());return t??Uu(e)},Ku=Mn&&(async n=>{let{url:e,method:t,data:i,signal:r,cancelToken:s,timeout:o,onDownloadProgress:l,onUploadProgress:f,responseType:h,headers:u,withCredentials:p="same-origin",fetchOptions:y}=Ys(n);h=h?(h+"").toLowerCase():"text";let k=xu([r,s&&s.toAbortSignal()],o),w;const C=k&&k.unsubscribe&&(()=>{k.unsubscribe()});let R;try{if(f&&Du&&t!=="get"&&t!=="head"&&(R=await Bu(u,i))!==0){let v=new Request(e,{method:"POST",body:i,duplex:"half"}),q;if(E.isFormData(i)&&(q=v.headers.get("content-type"))&&u.setContentType(q),v.body){const[te,X]=vr(R,bn(Or(f)));i=Pr(v.body,Fr,te,X)}}E.isString(p)||(p=p?"include":"omit");const x="credentials"in Request.prototype;w=new Request(e,{...y,signal:k,method:t.toUpperCase(),headers:u.normalize().toJSON(),body:i,duplex:"half",credentials:x?p:void 0});let N=await fetch(w);const A=Ti&&(h==="stream"||h==="response");if(Ti&&(l||A&&C)){const v={};["status","statusText","headers"].forEach(Ce=>{v[Ce]=N[Ce]});const q=E.toFiniteNumber(N.headers.get("content-length")),[te,X]=l&&vr(q,bn(Or(l),!0))||[];N=new Response(Pr(N.body,Fr,te,()=>{X&&X(),C&&C()}),v)}h=h||"text";let O=await kn[E.findKey(kn,h)||"text"](N,n);return!A&&C&&C(),await new Promise((v,q)=>{Js(v,q,{data:O,headers:de.from(N.headers),status:N.status,statusText:N.statusText,config:n,request:w})})}catch(x){throw C&&C(),x&&x.name==="TypeError"&&/fetch/i.test(x.message)?Object.assign(new P("Network Error",P.ERR_NETWORK,n,w),{cause:x.cause||x}):P.from(x,x&&x.code,n,w)}}),wi={http:tu,xhr:Ou,fetch:Ku};E.forEach(wi,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const Lr=n=>`- ${n}`,Vu=n=>E.isFunction(n)||n===null||n===!1,Qs={getAdapter:n=>{n=E.isArray(n)?n:[n];const{length:e}=n;let t,i;const r={};for(let s=0;s<e;s++){t=n[s];let o;if(i=t,!Vu(t)&&(i=wi[(o=String(t)).toLowerCase()],i===void 0))throw new P(`Unknown adapter '${o}'`);if(i)break;r[o||"#"+s]=i}if(!i){const s=Object.entries(r).map(([l,f])=>`adapter ${l} `+(f===!1?"is not supported by the environment":"is not available in the build"));let o=e?s.length>1?`since :
`+s.map(Lr).join(`
`):" "+Lr(s[0]):"as no adapter specified";throw new P("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return i},adapters:wi};function ei(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Nt(null,n)}function Mr(n){return ei(n),n.headers=de.from(n.headers),n.data=Zn.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Qs.getAdapter(n.adapter||jt.adapter)(n).then(function(i){return ei(n),i.data=Zn.call(n,n.transformResponse,i),i.headers=de.from(i.headers),i},function(i){return Gs(i)||(ei(n),i&&i.response&&(i.response.data=Zn.call(n,n.transformResponse,i.response),i.response.headers=de.from(i.response.headers))),Promise.reject(i)})}const Zs="1.7.7",Vi={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{Vi[n]=function(i){return typeof i===n||"a"+(e<1?"n ":" ")+n}});const Dr={};Vi.transitional=function(e,t,i){function r(s,o){return"[Axios v"+Zs+"] Transitional option '"+s+"'"+o+(i?". "+i:"")}return(s,o,l)=>{if(e===!1)throw new P(r(o," has been removed"+(t?" in "+t:"")),P.ERR_DEPRECATED);return t&&!Dr[o]&&(Dr[o]=!0,console.warn(r(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(s,o,l):!0}};function Hu(n,e,t){if(typeof n!="object")throw new P("options must be an object",P.ERR_BAD_OPTION_VALUE);const i=Object.keys(n);let r=i.length;for(;r-- >0;){const s=i[r],o=e[s];if(o){const l=n[s],f=l===void 0||o(l,s,n);if(f!==!0)throw new P("option "+s+" must be "+f,P.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new P("Unknown option "+s,P.ERR_BAD_OPTION)}}const Si={assertOptions:Hu,validators:Vi},Be=Si.validators;class Ze{constructor(e){this.defaults=e,this.interceptors={request:new Ar,response:new Ar}}async request(e,t){try{return await this._request(e,t)}catch(i){if(i instanceof Error){let r;Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error;const s=r.stack?r.stack.replace(/^.+\n/,""):"";try{i.stack?s&&!String(i.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+s):i.stack=s}catch{}}throw i}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=tt(this.defaults,t);const{transitional:i,paramsSerializer:r,headers:s}=t;i!==void 0&&Si.assertOptions(i,{silentJSONParsing:Be.transitional(Be.boolean),forcedJSONParsing:Be.transitional(Be.boolean),clarifyTimeoutError:Be.transitional(Be.boolean)},!1),r!=null&&(E.isFunction(r)?t.paramsSerializer={serialize:r}:Si.assertOptions(r,{encode:Be.function,serialize:Be.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=s&&E.merge(s.common,s[t.method]);s&&E.forEach(["delete","get","head","post","put","patch","common"],w=>{delete s[w]}),t.headers=de.concat(o,s);const l=[];let f=!0;this.interceptors.request.forEach(function(C){typeof C.runWhen=="function"&&C.runWhen(t)===!1||(f=f&&C.synchronous,l.unshift(C.fulfilled,C.rejected))});const h=[];this.interceptors.response.forEach(function(C){h.push(C.fulfilled,C.rejected)});let u,p=0,y;if(!f){const w=[Mr.bind(this),void 0];for(w.unshift.apply(w,l),w.push.apply(w,h),y=w.length,u=Promise.resolve(t);p<y;)u=u.then(w[p++],w[p++]);return u}y=l.length;let k=t;for(p=0;p<y;){const w=l[p++],C=l[p++];try{k=w(k)}catch(R){C.call(this,R);break}}try{u=Mr.call(this,k)}catch(w){return Promise.reject(w)}for(p=0,y=h.length;p<y;)u=u.then(h[p++],h[p++]);return u}getUri(e){e=tt(this.defaults,e);const t=js(e.baseURL,e.url);return qs(t,e.params,e.paramsSerializer)}}E.forEach(["delete","get","head","options"],function(e){Ze.prototype[e]=function(t,i){return this.request(tt(i||{},{method:e,url:t,data:(i||{}).data}))}});E.forEach(["post","put","patch"],function(e){function t(i){return function(s,o,l){return this.request(tt(l||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}Ze.prototype[e]=t(),Ze.prototype[e+"Form"]=t(!0)});class Hi{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(s){t=s});const i=this;this.promise.then(r=>{if(!i._listeners)return;let s=i._listeners.length;for(;s-- >0;)i._listeners[s](r);i._listeners=null}),this.promise.then=r=>{let s;const o=new Promise(l=>{i.subscribe(l),s=l}).then(r);return o.cancel=function(){i.unsubscribe(s)},o},e(function(s,o,l){i.reason||(i.reason=new Nt(s,o,l),t(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=i=>{e.abort(i)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new Hi(function(r){e=r}),cancel:e}}}function qu(n){return function(t){return n.apply(null,t)}}function $u(n){return E.isObject(n)&&n.isAxiosError===!0}const bi={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(bi).forEach(([n,e])=>{bi[e]=n});function eo(n){const e=new Ze(n),t=Ns(Ze.prototype.request,e);return E.extend(t,Ze.prototype,e,{allOwnKeys:!0}),E.extend(t,e,null,{allOwnKeys:!0}),t.create=function(r){return eo(tt(n,r))},t}const ee=eo(jt);ee.Axios=Ze;ee.CanceledError=Nt;ee.CancelToken=Hi;ee.isCancel=Gs;ee.VERSION=Zs;ee.toFormData=Ln;ee.AxiosError=P;ee.Cancel=ee.CanceledError;ee.all=function(e){return Promise.all(e)};ee.spread=qu;ee.isAxiosError=$u;ee.mergeConfig=tt;ee.AxiosHeaders=de;ee.formToJSON=n=>Ws(E.isHTMLForm(n)?new FormData(n):n);ee.getAdapter=Qs.getAdapter;ee.HttpStatusCode=bi;ee.default=ee;const Wu="/commander/v1.0";async function Ur(n){return ee({method:"post",url:`${$.BLUEOS_APIS_ENDPOINT+Wu}/shutdown`,timeout:5e3,withCredentials:!1,params:{shutdown_type:n,i_know_what_i_am_doing:!0}}).then(e=>e.data).then(e=>"Shutting Down... "+String(e)).catch(e=>{var i;if(e.code==="ECONNABORTED")return"Shutting Down... ";const t=`Could not execute shutdown: ${e.code} - ${e.message} - ${e.message??((i=e.response)==null?void 0:i.data)}.`;throw F(t),new Error(t)})}function z(n,e){if(!n)throw new Error(e)}const Gu=34028234663852886e22,Ju=-34028234663852886e22,ju=4294967295,Yu=2147483647,zu=-2147483648;function _n(n){if(typeof n!="number")throw new Error("invalid int 32: "+typeof n);if(!Number.isInteger(n)||n>Yu||n<zu)throw new Error("invalid int 32: "+n)}function ki(n){if(typeof n!="number")throw new Error("invalid uint 32: "+typeof n);if(!Number.isInteger(n)||n>ju||n<0)throw new Error("invalid uint 32: "+n)}function to(n){if(typeof n!="number")throw new Error("invalid float 32: "+typeof n);if(Number.isFinite(n)&&(n>Gu||n<Ju))throw new Error("invalid float 32: "+n)}const no=Symbol("@bufbuild/protobuf/enum-type");function Xu(n){const e=n[no];return z(e,"missing enum type on enum object"),e}function io(n,e,t,i){n[no]=ro(e,t.map(r=>({no:r.no,name:r.name,localName:n[r.no]})))}function ro(n,e,t){const i=Object.create(null),r=Object.create(null),s=[];for(const o of e){const l=so(o);s.push(l),i[o.name]=l,r[o.no]=l}return{typeName:n,values:s,findName(o){return i[o]},findNumber(o){return r[o]}}}function Qu(n,e,t){const i={};for(const r of e){const s=so(r);i[s.localName]=s.no,i[s.no]=s.localName}return io(i,n,e),i}function so(n){return"localName"in n?n:Object.assign(Object.assign({},n),{localName:n.name})}class oo{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const i=this.getType(),r=i.runtime.bin,s=r.makeReadOptions(t);return r.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,t){const i=this.getType(),r=i.runtime.json,s=r.makeReadOptions(t);return r.readMessage(i,e,s,this),this}fromJsonString(e,t){let i;try{i=JSON.parse(e)}catch(r){throw new Error(`cannot decode ${this.getType().typeName} from JSON: ${r instanceof Error?r.message:String(r)}`)}return this.fromJson(i,t)}toBinary(e){const t=this.getType(),i=t.runtime.bin,r=i.makeWriteOptions(e),s=r.writerFactory();return i.writeMessage(this,s,r),s.finish()}toJson(e){const t=this.getType(),i=t.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var t;const i=this.toJson(e);return JSON.stringify(i,null,(t=e==null?void 0:e.prettySpaces)!==null&&t!==void 0?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function Zu(n,e,t,i){var r;const s=(r=i==null?void 0:i.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),o={[s]:function(l){n.util.initFields(this),n.util.initPartial(l,this)}}[s];return Object.setPrototypeOf(o.prototype,new oo),Object.assign(o,{runtime:n,typeName:e,fields:n.util.newFieldList(t),fromBinary(l,f){return new o().fromBinary(l,f)},fromJson(l,f){return new o().fromJson(l,f)},fromJsonString(l,f){return new o().fromJsonString(l,f)},equals(l,f){return n.util.equals(o,l,f)}}),o}function el(){let n=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(n|=(r&127)<<i,!(r&128))return this.assertBounds(),[n,e]}let t=this.buf[this.pos++];if(n|=(t&15)<<28,e=(t&112)>>4,!(t&128))return this.assertBounds(),[n,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,!(r&128))return this.assertBounds(),[n,e]}throw new Error("invalid varint")}function ti(n,e,t){for(let s=0;s<28;s=s+7){const o=n>>>s,l=!(!(o>>>7)&&e==0),f=(l?o|128:o)&255;if(t.push(f),!l)return}const i=n>>>28&15|(e&7)<<4,r=!!(e>>3);if(t.push((r?i|128:i)&255),!!r){for(let s=3;s<31;s=s+7){const o=e>>>s,l=!!(o>>>7),f=(l?o|128:o)&255;if(t.push(f),!l)return}t.push(e>>>31&1)}}const yn=4294967296;function Br(n){const e=n[0]==="-";e&&(n=n.slice(1));const t=1e6;let i=0,r=0;function s(o,l){const f=Number(n.slice(o,l));r*=t,i=i*t+f,i>=yn&&(r=r+(i/yn|0),i=i%yn)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?co(i,r):qi(i,r)}function tl(n,e){let t=qi(n,e);const i=t.hi&2147483648;i&&(t=co(t.lo,t.hi));const r=ao(t.lo,t.hi);return i?"-"+r:r}function ao(n,e){if({lo:n,hi:e}=nl(n,e),e<=2097151)return String(yn*e+n);const t=n&16777215,i=(n>>>24|e<<8)&16777215,r=e>>16&65535;let s=t+i*6777216+r*6710656,o=i+r*8147497,l=r*2;const f=1e7;return s>=f&&(o+=Math.floor(s/f),s%=f),o>=f&&(l+=Math.floor(o/f),o%=f),l.toString()+Kr(o)+Kr(s)}function nl(n,e){return{lo:n>>>0,hi:e>>>0}}function qi(n,e){return{lo:n|0,hi:e|0}}function co(n,e){return e=~e,n?n=~n+1:e+=1,qi(n,e)}const Kr=n=>{const e=String(n);return"0000000".slice(e.length)+e};function Vr(n,e){if(n>=0){for(;n>127;)e.push(n&127|128),n=n>>>7;e.push(n)}else{for(let t=0;t<9;t++)e.push(n&127|128),n=n>>7;e.push(1)}}function il(){let n=this.buf[this.pos++],e=n&127;if(!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<7,!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<14,!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<21,!(n&128))return this.assertBounds(),e;n=this.buf[this.pos++],e|=(n&15)<<28;for(let t=5;n&128&&t<10;t++)n=this.buf[this.pos++];if(n&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}var Hr={};function rl(){const n=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"&&(typeof Bt!="object"||typeof Hr!="object"||Hr.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),o=BigInt("0"),l=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(f){const h=typeof f=="bigint"?f:BigInt(f);if(h>s||h<r)throw new Error(`int64 invalid: ${f}`);return h},uParse(f){const h=typeof f=="bigint"?f:BigInt(f);if(h>l||h<o)throw new Error(`uint64 invalid: ${f}`);return h},enc(f){return n.setBigInt64(0,this.parse(f),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},uEnc(f){return n.setBigInt64(0,this.uParse(f),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},dec(f,h){return n.setInt32(0,f,!0),n.setInt32(4,h,!0),n.getBigInt64(0,!0)},uDec(f,h){return n.setInt32(0,f,!0),n.setInt32(4,h,!0),n.getBigUint64(0,!0)}}}const t=r=>z(/^-?[0-9]+$/.test(r),`int64 invalid: ${r}`),i=r=>z(/^[0-9]+$/.test(r),`uint64 invalid: ${r}`);return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),t(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),t(r),Br(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),Br(r)},dec(r,s){return tl(r,s)},uDec(r,s){return ao(r,s)}}}const he=rl();var S;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(S||(S={}));var He;(function(n){n[n.BIGINT=0]="BIGINT",n[n.STRING=1]="STRING"})(He||(He={}));function Ke(n,e,t){if(e===t)return!0;if(n==S.BYTES){if(!(e instanceof Uint8Array)||!(t instanceof Uint8Array)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}switch(n){case S.UINT64:case S.FIXED64:case S.INT64:case S.SFIXED64:case S.SINT64:return e==t}return!1}function Rt(n,e){switch(n){case S.BOOL:return!1;case S.UINT64:case S.FIXED64:case S.INT64:case S.SFIXED64:case S.SINT64:return e==0?he.zero:"0";case S.DOUBLE:case S.FLOAT:return 0;case S.BYTES:return new Uint8Array(0);case S.STRING:return"";default:return 0}}function uo(n,e){switch(n){case S.BOOL:return e===!1;case S.STRING:return e==="";case S.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var Z;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32"})(Z||(Z={}));class sl{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let t=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)t.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(ki(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return _n(e),Vr(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){to(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){ki(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){_n(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return _n(e),e=(e<<1^e>>31)>>>0,Vr(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),r=he.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),r=he.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(t)}int64(e){let t=he.enc(e);return ti(t.lo,t.hi,this.buf),this}sint64(e){let t=he.enc(e),i=t.hi>>31,r=t.lo<<1^i,s=(t.hi<<1|t.lo>>>31)^i;return ti(r,s,this.buf),this}uint64(e){let t=he.uEnc(e);return ti(t.lo,t.hi,this.buf),this}}class ol{constructor(e,t){this.varint64=el,this.uint32=il,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t??new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,i=e&7;if(t<=0||i<0||i>5)throw new Error("illegal tag: field no "+t+" wire type "+i);return[t,i]}skip(e,t){let i=this.pos;switch(e){case Z.Varint:for(;this.buf[this.pos++]&128;);break;case Z.Bit64:this.pos+=4;case Z.Bit32:this.pos+=4;break;case Z.LengthDelimited:let r=this.uint32();this.pos+=r;break;case Z.StartGroup:for(;;){const[s,o]=this.tag();if(o===Z.EndGroup){if(t!==void 0&&s!==t)throw new Error("invalid end group tag");break}this.skip(o,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return he.dec(...this.varint64())}uint64(){return he.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),i=-(e&1);return e=(e>>>1|(t&1)<<31)^i,t=t>>>1^i,he.dec(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return he.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return he.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function al(n,e,t,i){let r;return{typeName:e,extendee:t,get field(){if(!r){const s=typeof i=="function"?i():i;s.name=e.split(".").pop(),s.jsonName=`[${e}]`,r=n.util.newFieldList([s]).list()[0]}return r},runtime:n}}function lo(n){const e=n.field.localName,t=Object.create(null);return t[e]=cl(n),[t,()=>t[e]]}function cl(n){const e=n.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Rt(e.T,e.L);case"message":const t=e.T,i=new t;return t.fieldWrapper?t.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function ul(n,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let t=n.length-1;t>=0;--t)if(n[t].no==e.no)return[n[t]];return[]}return n.filter(t=>t.no===e.no)}let Oe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Dn=[];for(let n=0;n<Oe.length;n++)Dn[Oe[n].charCodeAt(0)]=n;Dn[45]=Oe.indexOf("+");Dn[95]=Oe.indexOf("/");const ho={dec(n){let e=n.length*3/4;n[n.length-2]=="="?e-=2:n[n.length-1]=="="&&(e-=1);let t=new Uint8Array(e),i=0,r=0,s,o=0;for(let l=0;l<n.length;l++){if(s=Dn[n.charCodeAt(l)],s===void 0)switch(n[l]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:o=s,r=1;break;case 1:t[i++]=o<<2|(s&48)>>4,o=s,r=2;break;case 2:t[i++]=(o&15)<<4|(s&60)>>2,o=s,r=3;break;case 3:t[i++]=(o&3)<<6|s,r=0;break}}if(r==1)throw Error("invalid base64 string.");return t.subarray(0,i)},enc(n){let e="",t=0,i,r=0;for(let s=0;s<n.length;s++)switch(i=n[s],t){case 0:e+=Oe[i>>2],r=(i&3)<<4,t=1;break;case 1:e+=Oe[r|i>>4],r=(i&15)<<2,t=2;break;case 2:e+=Oe[r|i>>6],e+=Oe[i&63],t=0;break}return t&&(e+=Oe[r],e+="=",t==1&&(e+="=")),e}};function ll(n,e,t){mo(e,n);const i=e.runtime.bin.makeReadOptions(t),r=ul(n.getType().runtime.bin.listUnknownFields(n),e.field),[s,o]=lo(e);for(const l of r)e.runtime.bin.readField(s,i.readerFactory(l.data),e.field,l.wireType,i);return o()}function dl(n,e,t,i){mo(e,n);const r=e.runtime.bin.makeReadOptions(i),s=e.runtime.bin.makeWriteOptions(i);if(fo(n,e)){const h=n.getType().runtime.bin.listUnknownFields(n).filter(u=>u.no!=e.field.no);n.getType().runtime.bin.discardUnknownFields(n);for(const u of h)n.getType().runtime.bin.onUnknownField(n,u.no,u.wireType,u.data)}const o=s.writerFactory();let l=e.field;!l.opt&&!l.repeated&&(l.kind=="enum"||l.kind=="scalar")&&(l=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(l,t,o,s);const f=r.readerFactory(o.finish());for(;f.pos<f.len;){const[h,u]=f.tag(),p=f.skip(u,h);n.getType().runtime.bin.onUnknownField(n,h,u,p)}}function fo(n,e){const t=n.getType();return e.extendee.typeName===t.typeName&&!!t.runtime.bin.listUnknownFields(n).find(i=>i.no==e.field.no)}function mo(n,e){z(n.extendee.typeName==e.getType().typeName,`extension ${n.typeName} can only be applied to message ${n.extendee.typeName}`)}function po(n,e){const t=n.localName;if(n.repeated)return e[t].length>0;if(n.oneof)return e[n.oneof.localName].case===t;switch(n.kind){case"enum":case"scalar":return n.opt||n.req?e[t]!==void 0:n.kind=="enum"?e[t]!==n.T.values[0].no:!uo(n.T,e[t]);case"message":return e[t]!==void 0;case"map":return Object.keys(e[t]).length>0}}function qr(n,e){const t=n.localName,i=!n.opt&&!n.req;if(n.repeated)e[t]=[];else if(n.oneof)e[n.oneof.localName]={case:void 0};else switch(n.kind){case"map":e[t]={};break;case"enum":e[t]=i?n.T.values[0].no:void 0;break;case"scalar":e[t]=i?Rt(n.T,n.L):void 0;break;case"message":e[t]=void 0;break}}function et(n,e){if(n===null||typeof n!="object"||!Object.getOwnPropertyNames(oo.prototype).every(i=>i in n&&typeof n[i]=="function"))return!1;const t=n.getType();return t===null||typeof t!="function"||!("typeName"in t)||typeof t.typeName!="string"?!1:e===void 0?!0:t.typeName==e.typeName}function go(n,e){return et(e)||!n.fieldWrapper?e:n.fieldWrapper.wrapField(e)}S.DOUBLE,S.FLOAT,S.INT64,S.UINT64,S.INT32,S.UINT32,S.BOOL,S.STRING,S.BYTES;const $r={ignoreUnknownFields:!1},Wr={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function hl(n){return n?Object.assign(Object.assign({},$r),n):$r}function fl(n){return n?Object.assign(Object.assign({},Wr),n):Wr}const Rn=Symbol(),En=Symbol();function ml(){return{makeReadOptions:hl,makeWriteOptions:fl,readMessage(n,e,t,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error(`cannot decode message ${n.typeName} from JSON: ${Se(e)}`);i=i??new n;const r=new Map,s=t.typeRegistry;for(const[o,l]of Object.entries(e)){const f=n.fields.findJsonName(o);if(f){if(f.oneof){if(l===null&&f.kind=="scalar")continue;const h=r.get(f.oneof);if(h!==void 0)throw new Error(`cannot decode message ${n.typeName} from JSON: multiple keys for oneof "${f.oneof.name}" present: "${h}", "${o}"`);r.set(f.oneof,o)}Gr(i,l,f,t,n)}else{let h=!1;if(s!=null&&s.findExtension&&o.startsWith("[")&&o.endsWith("]")){const u=s.findExtension(o.substring(1,o.length-1));if(u&&u.extendee.typeName==n.typeName){h=!0;const[p,y]=lo(u);Gr(p,l,u.field,t,u),dl(i,u,y(),t)}}if(!h&&!t.ignoreUnknownFields)throw new Error(`cannot decode message ${n.typeName} from JSON: key "${o}" is unknown`)}}return i},writeMessage(n,e){const t=n.getType(),i={};let r;try{for(r of t.fields.byNumber()){if(!po(r,n)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!gl(r))continue}const o=r.oneof?n[r.oneof.localName].value:n[r.localName],l=Jr(r,o,e);l!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=l)}const s=e.typeRegistry;if(s!=null&&s.findExtensionFor)for(const o of t.runtime.bin.listUnknownFields(n)){const l=s.findExtensionFor(t.typeName,o.no);if(l&&fo(n,l)){const f=ll(n,l,e),h=Jr(l.field,f,e);h!==void 0&&(i[l.field.jsonName]=h)}}}catch(s){const o=r?`cannot encode field ${t.typeName}.${r.name} to JSON`:`cannot encode message ${t.typeName} to JSON`,l=s instanceof Error?s.message:String(s);throw new Error(o+(l.length>0?`: ${l}`:""))}return i},readScalar(n,e,t){return Dt(n,e,t??He.BIGINT,!0)},writeScalar(n,e,t){if(e!==void 0&&(t||uo(n,e)))return Tn(n,e)},debug:Se}}function Se(n){if(n===null)return"null";switch(typeof n){case"object":return Array.isArray(n)?"array":"object";case"string":return n.length>100?"string":`"${n.split('"').join('\\"')}"`;default:return String(n)}}function Gr(n,e,t,i,r){let s=t.localName;if(t.repeated){if(z(t.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error(`cannot decode field ${r.typeName}.${t.name} from JSON: ${Se(e)}`);const o=n[s];for(const l of e){if(l===null)throw new Error(`cannot decode field ${r.typeName}.${t.name} from JSON: ${Se(l)}`);switch(t.kind){case"message":o.push(t.T.fromJson(l,i));break;case"enum":const f=ni(t.T,l,i.ignoreUnknownFields,!0);f!==En&&o.push(f);break;case"scalar":try{o.push(Dt(t.T,l,t.L,!0))}catch(h){let u=`cannot decode field ${r.typeName}.${t.name} from JSON: ${Se(l)}`;throw h instanceof Error&&h.message.length>0&&(u+=`: ${h.message}`),new Error(u)}break}}}else if(t.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error(`cannot decode field ${r.typeName}.${t.name} from JSON: ${Se(e)}`);const o=n[s];for(const[l,f]of Object.entries(e)){if(f===null)throw new Error(`cannot decode field ${r.typeName}.${t.name} from JSON: map value null`);let h;try{h=pl(t.K,l)}catch(u){let p=`cannot decode map key for field ${r.typeName}.${t.name} from JSON: ${Se(e)}`;throw u instanceof Error&&u.message.length>0&&(p+=`: ${u.message}`),new Error(p)}switch(t.V.kind){case"message":o[h]=t.V.T.fromJson(f,i);break;case"enum":const u=ni(t.V.T,f,i.ignoreUnknownFields,!0);u!==En&&(o[h]=u);break;case"scalar":try{o[h]=Dt(t.V.T,f,He.BIGINT,!0)}catch(p){let y=`cannot decode map value for field ${r.typeName}.${t.name} from JSON: ${Se(e)}`;throw p instanceof Error&&p.message.length>0&&(y+=`: ${p.message}`),new Error(y)}break}}}else switch(t.oneof&&(n=n[t.oneof.localName]={case:s},s="value"),t.kind){case"message":const o=t.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let l=n[s];et(l)?l.fromJson(e,i):(n[s]=l=o.fromJson(e,i),o.fieldWrapper&&!t.oneof&&(n[s]=o.fieldWrapper.unwrapField(l)));break;case"enum":const f=ni(t.T,e,i.ignoreUnknownFields,!1);switch(f){case Rn:qr(t,n);break;case En:break;default:n[s]=f;break}break;case"scalar":try{const h=Dt(t.T,e,t.L,!1);switch(h){case Rn:qr(t,n);break;default:n[s]=h;break}}catch(h){let u=`cannot decode field ${r.typeName}.${t.name} from JSON: ${Se(e)}`;throw h instanceof Error&&h.message.length>0&&(u+=`: ${h.message}`),new Error(u)}break}}function pl(n,e){if(n===S.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Dt(n,e,He.BIGINT,!0).toString()}function Dt(n,e,t,i){if(e===null)return i?Rt(n,t):Rn;switch(n){case S.DOUBLE:case S.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return n==S.FLOAT&&to(r),r;case S.INT32:case S.FIXED32:case S.SFIXED32:case S.SINT32:case S.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return n==S.UINT32||n==S.FIXED32?ki(s):_n(s),s;case S.INT64:case S.SFIXED64:case S.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=he.parse(e);return t?o.toString():o;case S.FIXED64:case S.UINT64:if(typeof e!="number"&&typeof e!="string")break;const l=he.uParse(e);return t?l.toString():l;case S.BOOL:if(typeof e!="boolean")break;return e;case S.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case S.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return ho.dec(e)}throw new Error}function ni(n,e,t,i){if(e===null)return n.typeName=="google.protobuf.NullValue"?0:i?n.values[0].no:Rn;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=n.findName(e);if(r!==void 0)return r.no;if(t)return En;break}throw new Error(`cannot decode enum ${n.typeName} from JSON: ${Se(e)}`)}function gl(n){return n.repeated||n.kind=="map"?!0:!(n.oneof||n.kind=="message"||n.opt||n.req)}function Jr(n,e,t){if(n.kind=="map"){z(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(n.V.kind){case"scalar":for(const[o,l]of r)i[o.toString()]=Tn(n.V.T,l);break;case"message":for(const[o,l]of r)i[o.toString()]=l.toJson(t);break;case"enum":const s=n.V.T;for(const[o,l]of r)i[o.toString()]=ii(s,l,t.enumAsInteger);break}return t.emitDefaultValues||r.length>0?i:void 0}if(n.repeated){z(Array.isArray(e));const i=[];switch(n.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(Tn(n.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(ii(n.T,e[r],t.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(t));break}return t.emitDefaultValues||i.length>0?i:void 0}switch(n.kind){case"scalar":return Tn(n.T,e);case"enum":return ii(n.T,e,t.enumAsInteger);case"message":return go(n.T,e).toJson(t)}}function ii(n,e,t){var i;if(z(typeof e=="number"),n.typeName=="google.protobuf.NullValue")return null;if(t)return e;const r=n.findNumber(e);return(i=r==null?void 0:r.name)!==null&&i!==void 0?i:e}function Tn(n,e){switch(n){case S.INT32:case S.SFIXED32:case S.SINT32:case S.FIXED32:case S.UINT32:return z(typeof e=="number"),e;case S.FLOAT:case S.DOUBLE:return z(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case S.STRING:return z(typeof e=="string"),e;case S.BOOL:return z(typeof e=="boolean"),e;case S.UINT64:case S.FIXED64:case S.INT64:case S.SFIXED64:case S.SINT64:return z(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case S.BYTES:return z(e instanceof Uint8Array),ho.enc(e)}}const mt=Symbol("@bufbuild/protobuf/unknown-fields"),jr={readUnknownFields:!0,readerFactory:n=>new ol(n)},Yr={writeUnknownFields:!0,writerFactory:()=>new sl};function _l(n){return n?Object.assign(Object.assign({},jr),n):jr}function yl(n){return n?Object.assign(Object.assign({},Yr),n):Yr}function El(){return{makeReadOptions:_l,makeWriteOptions:yl,listUnknownFields(n){var e;return(e=n[mt])!==null&&e!==void 0?e:[]},discardUnknownFields(n){delete n[mt]},writeUnknownFields(n,e){const i=n[mt];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(n,e,t,i){const r=n;Array.isArray(r[mt])||(r[mt]=[]),r[mt].push({no:e,wireType:t,data:i})},readMessage(n,e,t,i,r){const s=n.getType(),o=r?e.len:e.pos+t;let l,f;for(;e.pos<o&&([l,f]=e.tag(),!(r===!0&&f==Z.EndGroup));){const h=s.fields.find(l);if(!h){const u=e.skip(f,l);i.readUnknownFields&&this.onUnknownField(n,l,f,u);continue}zr(n,e,h,f,i)}if(r&&(f!=Z.EndGroup||l!==t))throw new Error("invalid end group tag")},readField:zr,writeMessage(n,e,t){const i=n.getType();for(const r of i.fields.byNumber()){if(!po(r,n)){if(r.req)throw new Error(`cannot encode field ${i.typeName}.${r.name} to binary: required field not set`);continue}const s=r.oneof?n[r.oneof.localName].value:n[r.localName];Xr(r,s,e,t)}return t.writeUnknownFields&&this.writeUnknownFields(n,e),e},writeField(n,e,t,i){e!==void 0&&Xr(n,e,t,i)}}}function zr(n,e,t,i,r){let{repeated:s,localName:o}=t;switch(t.oneof&&(n=n[t.oneof.localName],n.case!=o&&delete n.value,n.case=o,o="value"),t.kind){case"scalar":case"enum":const l=t.kind=="enum"?S.INT32:t.T;let f=Cn;if(t.kind=="scalar"&&t.L>0&&(f=wl),s){let y=n[o];if(i==Z.LengthDelimited&&l!=S.STRING&&l!=S.BYTES){let w=e.uint32()+e.pos;for(;e.pos<w;)y.push(f(e,l))}else y.push(f(e,l))}else n[o]=f(e,l);break;case"message":const h=t.T;s?n[o].push(wn(e,new h,r,t)):et(n[o])?wn(e,n[o],r,t):(n[o]=wn(e,new h,r,t),h.fieldWrapper&&!t.oneof&&!t.repeated&&(n[o]=h.fieldWrapper.unwrapField(n[o])));break;case"map":let[u,p]=Tl(t,e,r);n[o][u]=p;break}}function wn(n,e,t,i){const r=e.getType().runtime.bin,s=i==null?void 0:i.delimited;return r.readMessage(e,n,s?i.no:n.uint32(),t,s),e}function Tl(n,e,t){const i=e.uint32(),r=e.pos+i;let s,o;for(;e.pos<r;){const[l]=e.tag();switch(l){case 1:s=Cn(e,n.K);break;case 2:switch(n.V.kind){case"scalar":o=Cn(e,n.V.T);break;case"enum":o=e.int32();break;case"message":o=wn(e,new n.V.T,t,void 0);break}break}}if(s===void 0&&(s=Rt(n.K,He.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),o===void 0)switch(n.V.kind){case"scalar":o=Rt(n.V.T,He.BIGINT);break;case"enum":o=n.V.T.values[0].no;break;case"message":o=new n.V.T;break}return[s,o]}function wl(n,e){const t=Cn(n,e);return typeof t=="bigint"?t.toString():t}function Cn(n,e){switch(e){case S.STRING:return n.string();case S.BOOL:return n.bool();case S.DOUBLE:return n.double();case S.FLOAT:return n.float();case S.INT32:return n.int32();case S.INT64:return n.int64();case S.UINT64:return n.uint64();case S.FIXED64:return n.fixed64();case S.BYTES:return n.bytes();case S.FIXED32:return n.fixed32();case S.SFIXED32:return n.sfixed32();case S.SFIXED64:return n.sfixed64();case S.SINT64:return n.sint64();case S.UINT32:return n.uint32();case S.SINT32:return n.sint32()}}function Xr(n,e,t,i){z(e!==void 0);const r=n.repeated;switch(n.kind){case"scalar":case"enum":let s=n.kind=="enum"?S.INT32:n.T;if(r)if(z(Array.isArray(e)),n.packed)bl(t,s,n.no,e);else for(const o of e)Ut(t,s,n.no,o);else Ut(t,s,n.no,e);break;case"message":if(r){z(Array.isArray(e));for(const o of e)Qr(t,i,n,o)}else Qr(t,i,n,e);break;case"map":z(typeof e=="object"&&e!=null);for(const[o,l]of Object.entries(e))Sl(t,i,n,o,l);break}}function Sl(n,e,t,i,r){n.tag(t.no,Z.LengthDelimited),n.fork();let s=i;switch(t.K){case S.INT32:case S.FIXED32:case S.UINT32:case S.SFIXED32:case S.SINT32:s=Number.parseInt(i);break;case S.BOOL:z(i=="true"||i=="false"),s=i=="true";break}switch(Ut(n,t.K,1,s),t.V.kind){case"scalar":Ut(n,t.V.T,2,r);break;case"enum":Ut(n,S.INT32,2,r);break;case"message":z(r!==void 0),n.tag(2,Z.LengthDelimited).bytes(r.toBinary(e));break}n.join()}function Qr(n,e,t,i){const r=go(t.T,i);t.delimited?n.tag(t.no,Z.StartGroup).raw(r.toBinary(e)).tag(t.no,Z.EndGroup):n.tag(t.no,Z.LengthDelimited).bytes(r.toBinary(e))}function Ut(n,e,t,i){z(i!==void 0);let[r,s]=_o(e);n.tag(t,r)[s](i)}function bl(n,e,t,i){if(!i.length)return;n.tag(t,Z.LengthDelimited).fork();let[,r]=_o(e);for(let s=0;s<i.length;s++)n[r](i[s]);n.join()}function _o(n){let e=Z.Varint;switch(n){case S.BYTES:case S.STRING:e=Z.LengthDelimited;break;case S.DOUBLE:case S.FIXED64:case S.SFIXED64:e=Z.Bit64;break;case S.FIXED32:case S.SFIXED32:case S.FLOAT:e=Z.Bit32;break}const t=S[n].toLowerCase();return[e,t]}function kl(){return{setEnumType:io,initPartial(n,e){if(n===void 0)return;const t=e.getType();for(const i of t.fields.byMember()){const r=i.localName,s=e,o=n;if(o[r]!=null)switch(i.kind){case"oneof":const l=o[r].case;if(l===void 0)continue;const f=i.findField(l);let h=o[r].value;f&&f.kind=="message"&&!et(h,f.T)?h=new f.T(h):f&&f.kind==="scalar"&&f.T===S.BYTES&&(h=Pt(h)),s[r]={case:l,value:h};break;case"scalar":case"enum":let u=o[r];i.T===S.BYTES&&(u=i.repeated?u.map(Pt):Pt(u)),s[r]=u;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===S.BYTES)for(const[k,w]of Object.entries(o[r]))s[r][k]=Pt(w);else Object.assign(s[r],o[r]);break;case"message":const y=i.V.T;for(const k of Object.keys(o[r])){let w=o[r][k];y.fieldWrapper||(w=new y(w)),s[r][k]=w}break}break;case"message":const p=i.T;if(i.repeated)s[r]=o[r].map(y=>et(y,p)?y:new p(y));else{const y=o[r];p.fieldWrapper?p.typeName==="google.protobuf.BytesValue"?s[r]=Pt(y):s[r]=y:s[r]=et(y,p)?y:new p(y)}break}}},equals(n,e,t){return e===t?!0:!e||!t?!1:n.fields.byMember().every(i=>{const r=e[i.localName],s=t[i.localName];if(i.repeated){if(r.length!==s.length)return!1;switch(i.kind){case"message":return r.every((o,l)=>i.T.equals(o,s[l]));case"scalar":return r.every((o,l)=>Ke(i.T,o,s[l]));case"enum":return r.every((o,l)=>Ke(S.INT32,o,s[l]))}throw new Error(`repeated cannot contain ${i.kind}`)}switch(i.kind){case"message":return i.T.equals(r,s);case"enum":return Ke(S.INT32,r,s);case"scalar":return Ke(i.T,r,s);case"oneof":if(r.case!==s.case)return!1;const o=i.findField(r.case);if(o===void 0)return!0;switch(o.kind){case"message":return o.T.equals(r.value,s.value);case"enum":return Ke(S.INT32,r.value,s.value);case"scalar":return Ke(o.T,r.value,s.value)}throw new Error(`oneof cannot contain ${o.kind}`);case"map":const l=Object.keys(r).concat(Object.keys(s));switch(i.V.kind){case"message":const f=i.V.T;return l.every(u=>f.equals(r[u],s[u]));case"enum":return l.every(u=>Ke(S.INT32,r[u],s[u]));case"scalar":const h=i.V.T;return l.every(u=>Ke(h,r[u],s[u]))}break}})},clone(n){const e=n.getType(),t=new e,i=t;for(const r of e.fields.byMember()){const s=n[r.localName];let o;if(r.repeated)o=s.map(dn);else if(r.kind=="map"){o=i[r.localName];for(const[l,f]of Object.entries(s))o[l]=dn(f)}else r.kind=="oneof"?o=r.findField(s.case)?{case:s.case,value:dn(s.value)}:{case:void 0}:o=dn(s);i[r.localName]=o}for(const r of e.runtime.bin.listUnknownFields(n))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return t}}}function dn(n){if(n===void 0)return n;if(et(n))return n.clone();if(n instanceof Uint8Array){const e=new Uint8Array(n.byteLength);return e.set(n),e}return n}function Pt(n){return n instanceof Uint8Array?n:new Uint8Array(n)}function Rl(n,e,t){return{syntax:n,json:ml(),bin:El(),util:Object.assign(Object.assign({},kl()),{newFieldList:e,initFields:t}),makeMessageType(i,r,s){return Zu(this,i,r,s)},makeEnum:Qu,makeEnumType:ro,getEnumType:Xu,makeExtension(i,r,s){return al(this,i,r,s)}}}class Cl{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const t={};for(const i of this.list())t[i.jsonName]=t[i.name]=i;this.jsonNames=t}return this.jsonNames[e]}find(e){if(!this.numbers){const t={};for(const i of this.list())t[i.no]=i;this.numbers=t}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const i of this.list())i.oneof?i.oneof!==t&&(t=i.oneof,e.push(t)):e.push(i)}return this.members}}function yo(n,e){const t=Eo(n);return e?t:xl(Ol(t))}function Il(n){return yo(n,!1)}const Al=Eo;function Eo(n){let e=!1;const t=[];for(let i=0;i<n.length;i++){let r=n.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":t.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),t.push(r);break}}return t.join("")}const Nl=new Set(["constructor","toString","toJSON","valueOf"]),vl=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),To=n=>`${n}$`,Ol=n=>vl.has(n)?To(n):n,xl=n=>Nl.has(n)?To(n):n;class Pl{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=Il(e)}addField(e){z(e.oneof===this,`field ${e.name} not one of ${this.name}`),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let t=0;t<this.fields.length;t++)this._lookup[this.fields[t].localName]=this.fields[t]}return this._lookup[e]}}function Fl(n,e){var t,i,r,s,o,l;const f=[];let h;for(const u of typeof n=="function"?n():n){const p=u;if(p.localName=yo(u.name,u.oneof!==void 0),p.jsonName=(t=u.jsonName)!==null&&t!==void 0?t:Al(u.name),p.repeated=(i=u.repeated)!==null&&i!==void 0?i:!1,u.kind=="scalar"&&(p.L=(r=u.L)!==null&&r!==void 0?r:He.BIGINT),p.delimited=(s=u.delimited)!==null&&s!==void 0?s:!1,p.req=(o=u.req)!==null&&o!==void 0?o:!1,p.opt=(l=u.opt)!==null&&l!==void 0?l:!1,u.packed===void 0&&(p.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=S.BYTES&&u.T!=S.STRING),u.oneof!==void 0){const y=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!h||h.name!=y)&&(h=new Pl(y)),p.oneof=h,h.addField(p)}f.push(p)}return f}const b=Rl("proto3",n=>new Cl(n,e=>Fl(e)),n=>{for(const e of n.getType().fields.byMember()){if(e.opt)continue;const t=e.localName,i=n;if(e.repeated){i[t]=[];continue}switch(e.kind){case"oneof":i[t]={case:void 0};break;case"enum":i[t]=0;break;case"map":i[t]={};break;case"scalar":i[t]=Rt(e.T,e.L);break}}}),Ll=b.makeEnum("livekit.AudioCodec",[{no:0,name:"DEFAULT_AC"},{no:1,name:"OPUS"},{no:2,name:"AAC"}]),Ml=b.makeEnum("livekit.VideoCodec",[{no:0,name:"DEFAULT_VC"},{no:1,name:"H264_BASELINE"},{no:2,name:"H264_MAIN"},{no:3,name:"H264_HIGH"},{no:4,name:"VP8"}]),Dl=b.makeEnum("livekit.ImageCodec",[{no:0,name:"IC_DEFAULT"},{no:1,name:"IC_JPEG"}]),Ul=b.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"REGRESSION"},{no:1,name:"SIMULCAST"}]),Bl=b.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),yt=b.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Kl=b.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Vl=b.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"}]),Hl=b.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"}]),Ri=b.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:ql,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:bo}]),ql=b.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),$i=b.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:b.getEnumType(yt),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Ci=b.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:b.getEnumType($l)},{no:4,name:"tracks",kind:"message",T:wo,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:$i},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:b.getEnumType(Wl)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:b.getEnumType(Vl)}]),$l=b.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Wl=b.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),Gl=b.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),Jl=b.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:So,repeated:!0}]),wo=b.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:b.getEnumType(Bl)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:b.getEnumType(yt)},{no:10,name:"layers",kind:"message",T:So,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:Jl,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:b.getEnumType(Gl)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:bo},{no:19,name:"audio_features",kind:"enum",T:b.getEnumType(Hl),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:b.getEnumType(Ul)}]),So=b.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:b.getEnumType(Kl)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]),jl=b.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),Yl=b.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),bo=b.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),zl=b.makeMessageType("livekit.RoomAgentDispatch",()=>[{no:1,name:"agent_name",kind:"scalar",T:9},{no:2,name:"metadata",kind:"scalar",T:9}]),Xl=b.makeEnum("livekit.EncodedFileType",[{no:0,name:"DEFAULT_FILETYPE"},{no:1,name:"MP4"},{no:2,name:"OGG"}]),Ql=b.makeEnum("livekit.SegmentedFileProtocol",[{no:0,name:"DEFAULT_SEGMENTED_FILE_PROTOCOL"},{no:1,name:"HLS_PROTOCOL"}]),Zl=b.makeEnum("livekit.SegmentedFileSuffix",[{no:0,name:"INDEX"},{no:1,name:"TIMESTAMP"}]),ed=b.makeEnum("livekit.ImageFileSuffix",[{no:0,name:"IMAGE_SUFFIX_INDEX"},{no:1,name:"IMAGE_SUFFIX_TIMESTAMP"}]),ko=b.makeEnum("livekit.StreamProtocol",[{no:0,name:"DEFAULT_PROTOCOL"},{no:1,name:"RTMP"},{no:2,name:"SRT"}]),td=b.makeEnum("livekit.AudioMixing",[{no:0,name:"DEFAULT_MIXING"},{no:1,name:"DUAL_CHANNEL_AGENT"},{no:2,name:"DUAL_CHANNEL_ALTERNATE"}]),Yt=b.makeEnum("livekit.EncodingOptionsPreset",[{no:0,name:"H264_720P_30"},{no:1,name:"H264_720P_60"},{no:2,name:"H264_1080P_30"},{no:3,name:"H264_1080P_60"},{no:4,name:"PORTRAIT_H264_720P_30"},{no:5,name:"PORTRAIT_H264_720P_60"},{no:6,name:"PORTRAIT_H264_1080P_30"},{no:7,name:"PORTRAIT_H264_1080P_60"}]),nd=b.makeEnum("livekit.EgressStatus",[{no:0,name:"EGRESS_STARTING"},{no:1,name:"EGRESS_ACTIVE"},{no:2,name:"EGRESS_ENDING"},{no:3,name:"EGRESS_COMPLETE"},{no:4,name:"EGRESS_FAILED"},{no:5,name:"EGRESS_ABORTED"},{no:6,name:"EGRESS_LIMIT_REACHED"}]),id=b.makeEnum("livekit.EgressSourceType",[{no:0,name:"EGRESS_SOURCE_TYPE_WEB",localName:"WEB"},{no:1,name:"EGRESS_SOURCE_TYPE_SDK",localName:"SDK"}]),Wi=b.makeMessageType("livekit.RoomCompositeEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"layout",kind:"scalar",T:9},{no:3,name:"audio_only",kind:"scalar",T:8},{no:15,name:"audio_mixing",kind:"enum",T:b.getEnumType(td)},{no:4,name:"video_only",kind:"scalar",T:8},{no:5,name:"custom_base_url",kind:"scalar",T:9},{no:6,name:"file",kind:"message",T:qe,oneof:"output"},{no:7,name:"stream",kind:"message",T:We,oneof:"output"},{no:10,name:"segments",kind:"message",T:$e,oneof:"output"},{no:8,name:"preset",kind:"enum",T:b.getEnumType(Yt),oneof:"options"},{no:9,name:"advanced",kind:"message",T:en,oneof:"options"},{no:11,name:"file_outputs",kind:"message",T:qe,repeated:!0},{no:12,name:"stream_outputs",kind:"message",T:We,repeated:!0},{no:13,name:"segment_outputs",kind:"message",T:$e,repeated:!0},{no:14,name:"image_outputs",kind:"message",T:Un,repeated:!0}]),Ro=b.makeMessageType("livekit.WebEgressRequest",()=>[{no:1,name:"url",kind:"scalar",T:9},{no:2,name:"audio_only",kind:"scalar",T:8},{no:3,name:"video_only",kind:"scalar",T:8},{no:12,name:"await_start_signal",kind:"scalar",T:8},{no:4,name:"file",kind:"message",T:qe,oneof:"output"},{no:5,name:"stream",kind:"message",T:We,oneof:"output"},{no:6,name:"segments",kind:"message",T:$e,oneof:"output"},{no:7,name:"preset",kind:"enum",T:b.getEnumType(Yt),oneof:"options"},{no:8,name:"advanced",kind:"message",T:en,oneof:"options"},{no:9,name:"file_outputs",kind:"message",T:qe,repeated:!0},{no:10,name:"stream_outputs",kind:"message",T:We,repeated:!0},{no:11,name:"segment_outputs",kind:"message",T:$e,repeated:!0},{no:13,name:"image_outputs",kind:"message",T:Un,repeated:!0}]),Co=b.makeMessageType("livekit.ParticipantEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"screen_share",kind:"scalar",T:8},{no:4,name:"preset",kind:"enum",T:b.getEnumType(Yt),oneof:"options"},{no:5,name:"advanced",kind:"message",T:en,oneof:"options"},{no:6,name:"file_outputs",kind:"message",T:qe,repeated:!0},{no:7,name:"stream_outputs",kind:"message",T:We,repeated:!0},{no:8,name:"segment_outputs",kind:"message",T:$e,repeated:!0},{no:9,name:"image_outputs",kind:"message",T:Un,repeated:!0}]),Io=b.makeMessageType("livekit.TrackCompositeEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"audio_track_id",kind:"scalar",T:9},{no:3,name:"video_track_id",kind:"scalar",T:9},{no:4,name:"file",kind:"message",T:qe,oneof:"output"},{no:5,name:"stream",kind:"message",T:We,oneof:"output"},{no:8,name:"segments",kind:"message",T:$e,oneof:"output"},{no:6,name:"preset",kind:"enum",T:b.getEnumType(Yt),oneof:"options"},{no:7,name:"advanced",kind:"message",T:en,oneof:"options"},{no:11,name:"file_outputs",kind:"message",T:qe,repeated:!0},{no:12,name:"stream_outputs",kind:"message",T:We,repeated:!0},{no:13,name:"segment_outputs",kind:"message",T:$e,repeated:!0},{no:14,name:"image_outputs",kind:"message",T:Un,repeated:!0}]),Ao=b.makeMessageType("livekit.TrackEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"track_id",kind:"scalar",T:9},{no:3,name:"file",kind:"message",T:rd,oneof:"output"},{no:4,name:"websocket_url",kind:"scalar",T:9,oneof:"output"}]),qe=b.makeMessageType("livekit.EncodedFileOutput",()=>[{no:1,name:"file_type",kind:"enum",T:b.getEnumType(Xl)},{no:2,name:"filepath",kind:"scalar",T:9},{no:6,name:"disable_manifest",kind:"scalar",T:8},{no:3,name:"s3",kind:"message",T:zt,oneof:"output"},{no:4,name:"gcp",kind:"message",T:Xt,oneof:"output"},{no:5,name:"azure",kind:"message",T:Qt,oneof:"output"},{no:7,name:"aliOSS",kind:"message",T:Zt,oneof:"output"}]),$e=b.makeMessageType("livekit.SegmentedFileOutput",()=>[{no:1,name:"protocol",kind:"enum",T:b.getEnumType(Ql)},{no:2,name:"filename_prefix",kind:"scalar",T:9},{no:3,name:"playlist_name",kind:"scalar",T:9},{no:11,name:"live_playlist_name",kind:"scalar",T:9},{no:4,name:"segment_duration",kind:"scalar",T:13},{no:10,name:"filename_suffix",kind:"enum",T:b.getEnumType(Zl)},{no:8,name:"disable_manifest",kind:"scalar",T:8},{no:5,name:"s3",kind:"message",T:zt,oneof:"output"},{no:6,name:"gcp",kind:"message",T:Xt,oneof:"output"},{no:7,name:"azure",kind:"message",T:Qt,oneof:"output"},{no:9,name:"aliOSS",kind:"message",T:Zt,oneof:"output"}]),rd=b.makeMessageType("livekit.DirectFileOutput",()=>[{no:1,name:"filepath",kind:"scalar",T:9},{no:5,name:"disable_manifest",kind:"scalar",T:8},{no:2,name:"s3",kind:"message",T:zt,oneof:"output"},{no:3,name:"gcp",kind:"message",T:Xt,oneof:"output"},{no:4,name:"azure",kind:"message",T:Qt,oneof:"output"},{no:6,name:"aliOSS",kind:"message",T:Zt,oneof:"output"}]),Un=b.makeMessageType("livekit.ImageOutput",()=>[{no:1,name:"capture_interval",kind:"scalar",T:13},{no:2,name:"width",kind:"scalar",T:5},{no:3,name:"height",kind:"scalar",T:5},{no:4,name:"filename_prefix",kind:"scalar",T:9},{no:5,name:"filename_suffix",kind:"enum",T:b.getEnumType(ed)},{no:6,name:"image_codec",kind:"enum",T:b.getEnumType(Dl)},{no:7,name:"disable_manifest",kind:"scalar",T:8},{no:8,name:"s3",kind:"message",T:zt,oneof:"output"},{no:9,name:"gcp",kind:"message",T:Xt,oneof:"output"},{no:10,name:"azure",kind:"message",T:Qt,oneof:"output"},{no:11,name:"aliOSS",kind:"message",T:Zt,oneof:"output"}]),zt=b.makeMessageType("livekit.S3Upload",()=>[{no:1,name:"access_key",kind:"scalar",T:9},{no:2,name:"secret",kind:"scalar",T:9},{no:11,name:"session_token",kind:"scalar",T:9},{no:3,name:"region",kind:"scalar",T:9},{no:4,name:"endpoint",kind:"scalar",T:9},{no:5,name:"bucket",kind:"scalar",T:9},{no:6,name:"force_path_style",kind:"scalar",T:8},{no:7,name:"metadata",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:8,name:"tagging",kind:"scalar",T:9},{no:9,name:"content_disposition",kind:"scalar",T:9},{no:10,name:"proxy",kind:"message",T:No}]),Xt=b.makeMessageType("livekit.GCPUpload",()=>[{no:1,name:"credentials",kind:"scalar",T:9},{no:2,name:"bucket",kind:"scalar",T:9},{no:3,name:"proxy",kind:"message",T:No}]),Qt=b.makeMessageType("livekit.AzureBlobUpload",()=>[{no:1,name:"account_name",kind:"scalar",T:9},{no:2,name:"account_key",kind:"scalar",T:9},{no:3,name:"container_name",kind:"scalar",T:9}]),Zt=b.makeMessageType("livekit.AliOSSUpload",()=>[{no:1,name:"access_key",kind:"scalar",T:9},{no:2,name:"secret",kind:"scalar",T:9},{no:3,name:"region",kind:"scalar",T:9},{no:4,name:"endpoint",kind:"scalar",T:9},{no:5,name:"bucket",kind:"scalar",T:9}]),No=b.makeMessageType("livekit.ProxyConfig",()=>[{no:1,name:"url",kind:"scalar",T:9},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"password",kind:"scalar",T:9}]),We=b.makeMessageType("livekit.StreamOutput",()=>[{no:1,name:"protocol",kind:"enum",T:b.getEnumType(ko)},{no:2,name:"urls",kind:"scalar",T:9,repeated:!0}]),en=b.makeMessageType("livekit.EncodingOptions",()=>[{no:1,name:"width",kind:"scalar",T:5},{no:2,name:"height",kind:"scalar",T:5},{no:3,name:"depth",kind:"scalar",T:5},{no:4,name:"framerate",kind:"scalar",T:5},{no:5,name:"audio_codec",kind:"enum",T:b.getEnumType(Ll)},{no:6,name:"audio_bitrate",kind:"scalar",T:5},{no:11,name:"audio_quality",kind:"scalar",T:5},{no:7,name:"audio_frequency",kind:"scalar",T:5},{no:8,name:"video_codec",kind:"enum",T:b.getEnumType(Ml)},{no:9,name:"video_bitrate",kind:"scalar",T:5},{no:12,name:"video_quality",kind:"scalar",T:5},{no:10,name:"key_frame_interval",kind:"scalar",T:1}]),sd=b.makeMessageType("livekit.UpdateLayoutRequest",()=>[{no:1,name:"egress_id",kind:"scalar",T:9},{no:2,name:"layout",kind:"scalar",T:9}]),od=b.makeMessageType("livekit.UpdateStreamRequest",()=>[{no:1,name:"egress_id",kind:"scalar",T:9},{no:2,name:"add_output_urls",kind:"scalar",T:9,repeated:!0},{no:3,name:"remove_output_urls",kind:"scalar",T:9,repeated:!0}]),ad=b.makeMessageType("livekit.ListEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"egress_id",kind:"scalar",T:9},{no:3,name:"active",kind:"scalar",T:8}]),cd=b.makeMessageType("livekit.ListEgressResponse",()=>[{no:1,name:"items",kind:"message",T:ve,repeated:!0}]),ud=b.makeMessageType("livekit.StopEgressRequest",()=>[{no:1,name:"egress_id",kind:"scalar",T:9}]),ve=b.makeMessageType("livekit.EgressInfo",()=>[{no:1,name:"egress_id",kind:"scalar",T:9},{no:2,name:"room_id",kind:"scalar",T:9},{no:13,name:"room_name",kind:"scalar",T:9},{no:26,name:"source_type",kind:"enum",T:b.getEnumType(id)},{no:3,name:"status",kind:"enum",T:b.getEnumType(nd)},{no:10,name:"started_at",kind:"scalar",T:3},{no:11,name:"ended_at",kind:"scalar",T:3},{no:18,name:"updated_at",kind:"scalar",T:3},{no:21,name:"details",kind:"scalar",T:9},{no:9,name:"error",kind:"scalar",T:9},{no:22,name:"error_code",kind:"scalar",T:5},{no:4,name:"room_composite",kind:"message",T:Wi,oneof:"request"},{no:14,name:"web",kind:"message",T:Ro,oneof:"request"},{no:19,name:"participant",kind:"message",T:Co,oneof:"request"},{no:5,name:"track_composite",kind:"message",T:Io,oneof:"request"},{no:6,name:"track",kind:"message",T:Ao,oneof:"request"},{no:7,name:"stream",kind:"message",T:ld,oneof:"result"},{no:8,name:"file",kind:"message",T:Zr,oneof:"result"},{no:12,name:"segments",kind:"message",T:es,oneof:"result"},{no:15,name:"stream_results",kind:"message",T:vo,repeated:!0},{no:16,name:"file_results",kind:"message",T:Zr,repeated:!0},{no:17,name:"segment_results",kind:"message",T:es,repeated:!0},{no:20,name:"image_results",kind:"message",T:hd,repeated:!0},{no:23,name:"manifest_location",kind:"scalar",T:9},{no:25,name:"backup_storage_used",kind:"scalar",T:8}]),ld=b.makeMessageType("livekit.StreamInfoList",()=>[{no:1,name:"info",kind:"message",T:vo,repeated:!0}]),vo=b.makeMessageType("livekit.StreamInfo",()=>[{no:1,name:"url",kind:"scalar",T:9},{no:2,name:"started_at",kind:"scalar",T:3},{no:3,name:"ended_at",kind:"scalar",T:3},{no:4,name:"duration",kind:"scalar",T:3},{no:5,name:"status",kind:"enum",T:b.getEnumType(dd)},{no:6,name:"error",kind:"scalar",T:9}]),dd=b.makeEnum("livekit.StreamInfo.Status",[{no:0,name:"ACTIVE"},{no:1,name:"FINISHED"},{no:2,name:"FAILED"}]),Zr=b.makeMessageType("livekit.FileInfo",()=>[{no:1,name:"filename",kind:"scalar",T:9},{no:2,name:"started_at",kind:"scalar",T:3},{no:3,name:"ended_at",kind:"scalar",T:3},{no:6,name:"duration",kind:"scalar",T:3},{no:4,name:"size",kind:"scalar",T:3},{no:5,name:"location",kind:"scalar",T:9}]),es=b.makeMessageType("livekit.SegmentsInfo",()=>[{no:1,name:"playlist_name",kind:"scalar",T:9},{no:8,name:"live_playlist_name",kind:"scalar",T:9},{no:2,name:"duration",kind:"scalar",T:3},{no:3,name:"size",kind:"scalar",T:3},{no:4,name:"playlist_location",kind:"scalar",T:9},{no:9,name:"live_playlist_location",kind:"scalar",T:9},{no:5,name:"segment_count",kind:"scalar",T:3},{no:6,name:"started_at",kind:"scalar",T:3},{no:7,name:"ended_at",kind:"scalar",T:3}]),hd=b.makeMessageType("livekit.ImagesInfo",()=>[{no:4,name:"filename_prefix",kind:"scalar",T:9},{no:1,name:"image_count",kind:"scalar",T:3},{no:2,name:"started_at",kind:"scalar",T:3},{no:3,name:"ended_at",kind:"scalar",T:3}]),fd=b.makeMessageType("livekit.AutoParticipantEgress",()=>[{no:1,name:"preset",kind:"enum",T:b.getEnumType(Yt),oneof:"options"},{no:2,name:"advanced",kind:"message",T:en,oneof:"options"},{no:3,name:"file_outputs",kind:"message",T:qe,repeated:!0},{no:4,name:"segment_outputs",kind:"message",T:$e,repeated:!0}]),md=b.makeMessageType("livekit.AutoTrackEgress",()=>[{no:1,name:"filepath",kind:"scalar",T:9},{no:5,name:"disable_manifest",kind:"scalar",T:8},{no:2,name:"s3",kind:"message",T:zt,oneof:"output"},{no:3,name:"gcp",kind:"message",T:Xt,oneof:"output"},{no:4,name:"azure",kind:"message",T:Qt,oneof:"output"},{no:6,name:"aliOSS",kind:"message",T:Zt,oneof:"output"}]),pd=b.makeMessageType("livekit.CreateRoomRequest",()=>[{no:1,name:"name",kind:"scalar",T:9},{no:12,name:"room_preset",kind:"scalar",T:9},{no:2,name:"empty_timeout",kind:"scalar",T:13},{no:10,name:"departure_timeout",kind:"scalar",T:13},{no:3,name:"max_participants",kind:"scalar",T:13},{no:4,name:"node_id",kind:"scalar",T:9},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"egress",kind:"message",T:gd},{no:7,name:"min_playout_delay",kind:"scalar",T:13},{no:8,name:"max_playout_delay",kind:"scalar",T:13},{no:9,name:"sync_streams",kind:"scalar",T:8},{no:13,name:"replay_enabled",kind:"scalar",T:8},{no:14,name:"agents",kind:"message",T:zl,repeated:!0}]),gd=b.makeMessageType("livekit.RoomEgress",()=>[{no:1,name:"room",kind:"message",T:Wi},{no:3,name:"participant",kind:"message",T:fd},{no:2,name:"tracks",kind:"message",T:md}]),_d=b.makeMessageType("livekit.ListRoomsRequest",()=>[{no:1,name:"names",kind:"scalar",T:9,repeated:!0}]),yd=b.makeMessageType("livekit.ListRoomsResponse",()=>[{no:1,name:"rooms",kind:"message",T:Ri,repeated:!0}]),Ed=b.makeMessageType("livekit.DeleteRoomRequest",()=>[{no:1,name:"room",kind:"scalar",T:9}]),Td=b.makeMessageType("livekit.ListParticipantsRequest",()=>[{no:1,name:"room",kind:"scalar",T:9}]),wd=b.makeMessageType("livekit.ListParticipantsResponse",()=>[{no:1,name:"participants",kind:"message",T:Ci,repeated:!0}]),ts=b.makeMessageType("livekit.RoomParticipantIdentity",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9}]),Sd=b.makeMessageType("livekit.MuteRoomTrackRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"track_sid",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8}]),bd=b.makeMessageType("livekit.MuteRoomTrackResponse",()=>[{no:1,name:"track",kind:"message",T:wo}]),kd=b.makeMessageType("livekit.UpdateParticipantRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"permission",kind:"message",T:$i},{no:5,name:"name",kind:"scalar",T:9},{no:6,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}]),Rd=b.makeMessageType("livekit.UpdateSubscriptionsRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"subscribe",kind:"scalar",T:8},{no:5,name:"participant_tracks",kind:"message",T:Yl,repeated:!0}]),Cd=b.makeMessageType("livekit.SendDataRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"data",kind:"scalar",T:12},{no:3,name:"kind",kind:"enum",T:b.getEnumType(jl)},{no:4,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:5,name:"topic",kind:"scalar",T:9,opt:!0},{no:7,name:"nonce",kind:"scalar",T:12}]),Id=b.makeMessageType("livekit.UpdateRoomMetadataRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"metadata",kind:"scalar",T:9}]),Gi=crypto,Oo=n=>n instanceof CryptoKey,Et=new TextEncoder,Ii=new TextDecoder;function Ad(...n){const e=n.reduce((r,{length:s})=>r+s,0),t=new Uint8Array(e);let i=0;for(const r of n)t.set(r,i),i+=r.length;return t}const Nd=n=>{let e=n;typeof e=="string"&&(e=Et.encode(e));const t=32768,i=[];for(let r=0;r<e.length;r+=t)i.push(String.fromCharCode.apply(null,e.subarray(r,r+t)));return btoa(i.join(""))},ri=n=>Nd(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),vd=n=>{const e=atob(n),t=new Uint8Array(e.length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t},Ji=n=>{let e=n;e instanceof Uint8Array&&(e=Ii.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return vd(e)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class ji extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(t=Error.captureStackTrace)==null||t.call(Error,this,this.constructor)}}class Tt extends ji{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}}class Ft extends ji{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}}class Od extends ji{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}}function Ie(n,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${n}`)}function hn(n,e){return n.name===e}function si(n){return parseInt(n.name.slice(4),10)}function xd(n){switch(n){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function Pd(n,e){if(e.length&&!e.some(t=>n.usages.includes(t))){let t="CryptoKey does not support this operation, its usages must include ";if(e.length>2){const i=e.pop();t+=`one of ${e.join(", ")}, or ${i}.`}else e.length===2?t+=`one of ${e[0]} or ${e[1]}.`:t+=`${e[0]}.`;throw new TypeError(t)}}function Fd(n,e,...t){switch(e){case"HS256":case"HS384":case"HS512":{if(!hn(n.algorithm,"HMAC"))throw Ie("HMAC");const i=parseInt(e.slice(2),10);if(si(n.algorithm.hash)!==i)throw Ie(`SHA-${i}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!hn(n.algorithm,"RSASSA-PKCS1-v1_5"))throw Ie("RSASSA-PKCS1-v1_5");const i=parseInt(e.slice(2),10);if(si(n.algorithm.hash)!==i)throw Ie(`SHA-${i}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!hn(n.algorithm,"RSA-PSS"))throw Ie("RSA-PSS");const i=parseInt(e.slice(2),10);if(si(n.algorithm.hash)!==i)throw Ie(`SHA-${i}`,"algorithm.hash");break}case"EdDSA":{if(n.algorithm.name!=="Ed25519"&&n.algorithm.name!=="Ed448")throw Ie("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!hn(n.algorithm,"ECDSA"))throw Ie("ECDSA");const i=xd(e);if(n.algorithm.namedCurve!==i)throw Ie(i,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Pd(n,t)}function xo(n,e,...t){var i;if(t=t.filter(Boolean),t.length>2){const r=t.pop();n+=`one of type ${t.join(", ")}, or ${r}.`}else t.length===2?n+=`one of type ${t[0]} or ${t[1]}.`:n+=`of type ${t[0]}.`;return e==null?n+=` Received ${e}`:typeof e=="function"&&e.name?n+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&(i=e.constructor)!=null&&i.name&&(n+=` Received an instance of ${e.constructor.name}`),n}const ns=(n,...e)=>xo("Key must be ",n,...e);function Po(n,e,...t){return xo(`Key for the ${n} algorithm must be `,e,...t)}const Fo=n=>Oo(n)?!0:(n==null?void 0:n[Symbol.toStringTag])==="KeyObject",In=["CryptoKey"],Ld=(...n)=>{const e=n.filter(Boolean);if(e.length===0||e.length===1)return!0;let t;for(const i of e){const r=Object.keys(i);if(!t||t.size===0){t=new Set(r);continue}for(const s of r){if(t.has(s))return!1;t.add(s)}}return!0};function Md(n){return typeof n=="object"&&n!==null}function Lo(n){if(!Md(n)||Object.prototype.toString.call(n)!=="[object Object]")return!1;if(Object.getPrototypeOf(n)===null)return!0;let e=n;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(n)===e}const Dd=(n,e)=>{if(n.startsWith("RS")||n.startsWith("PS")){const{modulusLength:t}=e.algorithm;if(typeof t!="number"||t<2048)throw new TypeError(`${n} requires key modulusLength to be 2048 bits or larger`)}};function tn(n){return Lo(n)&&typeof n.kty=="string"}function Ud(n){return n.kty!=="oct"&&typeof n.d=="string"}function Bd(n){return n.kty!=="oct"&&typeof n.d>"u"}function Kd(n){return tn(n)&&n.kty==="oct"&&typeof n.k=="string"}function Vd(n){let e,t;switch(n.kty){case"RSA":{switch(n.alg){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${n.alg.slice(-3)}`},t=n.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${n.alg.slice(-3)}`},t=n.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(n.alg.slice(-3),10)||1}`},t=n.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new Tt('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(n.alg){case"ES256":e={name:"ECDSA",namedCurve:"P-256"},t=n.d?["sign"]:["verify"];break;case"ES384":e={name:"ECDSA",namedCurve:"P-384"},t=n.d?["sign"]:["verify"];break;case"ES512":e={name:"ECDSA",namedCurve:"P-521"},t=n.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:"ECDH",namedCurve:n.crv},t=n.d?["deriveBits"]:[];break;default:throw new Tt('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(n.alg){case"EdDSA":e={name:n.crv},t=n.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:n.crv},t=n.d?["deriveBits"]:[];break;default:throw new Tt('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new Tt('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:e,keyUsages:t}}const Hd=async n=>{if(!n.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:e,keyUsages:t}=Vd(n),i=[e,n.ext??!1,n.key_ops??t],r={...n};return delete r.alg,delete r.use,Gi.subtle.importKey("jwk",r,...i)},Mo=n=>Ji(n);let pt,gt;const Do=n=>(n==null?void 0:n[Symbol.toStringTag])==="KeyObject",An=async(n,e,t,i,r=!1)=>{let s=n.get(e);if(s!=null&&s[i])return s[i];const o=await Hd({...t,alg:i});return r&&Object.freeze(e),s?s[i]=o:n.set(e,{[i]:o}),o},qd=(n,e)=>{if(Do(n)){let t=n.export({format:"jwk"});return delete t.d,delete t.dp,delete t.dq,delete t.p,delete t.q,delete t.qi,t.k?Mo(t.k):(gt||(gt=new WeakMap),An(gt,n,t,e))}return tn(n)?n.k?Ji(n.k):(gt||(gt=new WeakMap),An(gt,n,n,e,!0)):n},$d=(n,e)=>{if(Do(n)){let t=n.export({format:"jwk"});return t.k?Mo(t.k):(pt||(pt=new WeakMap),An(pt,n,t,e))}return tn(n)?n.k?Ji(n.k):(pt||(pt=new WeakMap),An(pt,n,n,e,!0)):n},Wd={normalizePublicKey:qd,normalizePrivateKey:$d},_t=n=>n==null?void 0:n[Symbol.toStringTag],Ai=(n,e,t)=>{var i,r;if(e.use!==void 0&&e.use!=="sig")throw new TypeError("Invalid key for this operation, when present its use must be sig");if(e.key_ops!==void 0&&((r=(i=e.key_ops).includes)==null?void 0:r.call(i,t))!==!0)throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${t}`);if(e.alg!==void 0&&e.alg!==n)throw new TypeError(`Invalid key for this operation, when present its alg must be ${n}`);return!0},Gd=(n,e,t,i)=>{if(!(e instanceof Uint8Array)){if(i&&tn(e)){if(Kd(e)&&Ai(n,e,t))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Fo(e))throw new TypeError(Po(n,e,...In,"Uint8Array",i?"JSON Web Key":null));if(e.type!=="secret")throw new TypeError(`${_t(e)} instances for symmetric algorithms must be of type "secret"`)}},Jd=(n,e,t,i)=>{if(i&&tn(e))switch(t){case"sign":if(Ud(e)&&Ai(n,e,t))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(Bd(e)&&Ai(n,e,t))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!Fo(e))throw new TypeError(Po(n,e,...In,i?"JSON Web Key":null));if(e.type==="secret")throw new TypeError(`${_t(e)} instances for asymmetric algorithms must not be of type "secret"`);if(t==="sign"&&e.type==="public")throw new TypeError(`${_t(e)} instances for asymmetric algorithm signing must be of type "private"`);if(t==="decrypt"&&e.type==="public")throw new TypeError(`${_t(e)} instances for asymmetric algorithm decryption must be of type "private"`);if(e.algorithm&&t==="verify"&&e.type==="private")throw new TypeError(`${_t(e)} instances for asymmetric algorithm verifying must be of type "public"`);if(e.algorithm&&t==="encrypt"&&e.type==="private")throw new TypeError(`${_t(e)} instances for asymmetric algorithm encryption must be of type "public"`)};function Uo(n,e,t,i){e.startsWith("HS")||e==="dir"||e.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(e)?Gd(e,t,i,n):Jd(e,t,i,n)}Uo.bind(void 0,!1);const jd=Uo.bind(void 0,!0);function Yd(n,e,t,i,r){if(r.crit!==void 0&&(i==null?void 0:i.crit)===void 0)throw new n('"crit" (Critical) Header Parameter MUST be integrity protected');if(!i||i.crit===void 0)return new Set;if(!Array.isArray(i.crit)||i.crit.length===0||i.crit.some(o=>typeof o!="string"||o.length===0))throw new n('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let s;t!==void 0?s=new Map([...Object.entries(t),...e.entries()]):s=e;for(const o of i.crit){if(!s.has(o))throw new Tt(`Extension Header Parameter "${o}" is not recognized`);if(r[o]===void 0)throw new n(`Extension Header Parameter "${o}" is missing`);if(s.get(o)&&i[o]===void 0)throw new n(`Extension Header Parameter "${o}" MUST be integrity protected`)}return new Set(i.crit)}function zd(n,e){const t=`SHA-${n.slice(-3)}`;switch(n){case"HS256":case"HS384":case"HS512":return{hash:t,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:t,name:"RSA-PSS",saltLength:n.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:t,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:t,name:"ECDSA",namedCurve:e.namedCurve};case"EdDSA":return{name:e.name};default:throw new Tt(`alg ${n} is not supported either by JOSE or your javascript runtime`)}}async function Xd(n,e,t){if(e=await Wd.normalizePrivateKey(e,n),Oo(e))return Fd(e,n,t),e;if(e instanceof Uint8Array){if(!n.startsWith("HS"))throw new TypeError(ns(e,...In));return Gi.subtle.importKey("raw",e,{hash:`SHA-${n.slice(-3)}`,name:"HMAC"},!1,[t])}throw new TypeError(ns(e,...In,"Uint8Array","JSON Web Key"))}const ze=n=>Math.floor(n.getTime()/1e3),Bo=60,Ko=Bo*60,Yi=Ko*24,Qd=Yi*7,Zd=Yi*365.25,eh=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,oi=n=>{const e=eh.exec(n);if(!e||e[4]&&e[1])throw new TypeError("Invalid time period format");const t=parseFloat(e[2]),i=e[3].toLowerCase();let r;switch(i){case"sec":case"secs":case"second":case"seconds":case"s":r=Math.round(t);break;case"minute":case"minutes":case"min":case"mins":case"m":r=Math.round(t*Bo);break;case"hour":case"hours":case"hr":case"hrs":case"h":r=Math.round(t*Ko);break;case"day":case"days":case"d":r=Math.round(t*Yi);break;case"week":case"weeks":case"w":r=Math.round(t*Qd);break;default:r=Math.round(t*Zd);break}return e[1]==="-"||e[4]==="ago"?-r:r},th=async(n,e,t)=>{const i=await Xd(n,e,"sign");Dd(n,i);const r=await Gi.subtle.sign(zd(n,i.algorithm),i,t);return new Uint8Array(r)};class nh{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){if(!this._protectedHeader&&!this._unprotectedHeader)throw new Ft("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!Ld(this._protectedHeader,this._unprotectedHeader))throw new Ft("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const i={...this._protectedHeader,...this._unprotectedHeader},r=Yd(Ft,new Map([["b64",!0]]),t==null?void 0:t.crit,this._protectedHeader,i);let s=!0;if(r.has("b64")&&(s=this._protectedHeader.b64,typeof s!="boolean"))throw new Ft('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:o}=i;if(typeof o!="string"||!o)throw new Ft('JWS "alg" (Algorithm) Header Parameter missing or invalid');jd(o,e,"sign");let l=this._payload;s&&(l=Et.encode(ri(l)));let f;this._protectedHeader?f=Et.encode(ri(JSON.stringify(this._protectedHeader))):f=Et.encode("");const h=Ad(f,Et.encode("."),l),u=await th(o,e,h),p={signature:ri(u),payload:""};return s&&(p.payload=Ii.decode(l)),this._unprotectedHeader&&(p.header=this._unprotectedHeader),this._protectedHeader&&(p.protected=Ii.decode(f)),p}}class ih{constructor(e){this._flattened=new nh(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){const i=await this._flattened.sign(e,t);if(i.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${i.protected}.${i.payload}.${i.signature}`}}function Xe(n,e){if(!Number.isFinite(e))throw new TypeError(`Invalid ${n} input`);return e}class rh{constructor(e={}){if(!Lo(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return typeof e=="number"?this._payload={...this._payload,nbf:Xe("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:Xe("setNotBefore",ze(e))}:this._payload={...this._payload,nbf:ze(new Date)+oi(e)},this}setExpirationTime(e){return typeof e=="number"?this._payload={...this._payload,exp:Xe("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:Xe("setExpirationTime",ze(e))}:this._payload={...this._payload,exp:ze(new Date)+oi(e)},this}setIssuedAt(e){return typeof e>"u"?this._payload={...this._payload,iat:ze(new Date)}:e instanceof Date?this._payload={...this._payload,iat:Xe("setIssuedAt",ze(e))}:typeof e=="string"?this._payload={...this._payload,iat:Xe("setIssuedAt",ze(new Date)+oi(e))}:this._payload={...this._payload,iat:Xe("setIssuedAt",e)},this}}class sh extends rh{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){var r;const i=new ih(Et.encode(JSON.stringify(this._payload)));if(i.setProtectedHeader(this._protectedHeader),Array.isArray((r=this._protectedHeader)==null?void 0:r.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new Od("JWTs MUST NOT use unencoded payload");return i.sign(e,t)}}function oh(n){switch(n){case yt.CAMERA:return"camera";case yt.MICROPHONE:return"microphone";case yt.SCREEN_SHARE:return"screen_share";case yt.SCREEN_SHARE_AUDIO:return"screen_share_audio";default:throw new TypeError(`Cannot convert TrackSource ${n} to string`)}}function ah(n){var e;const t={...n};return Array.isArray((e=t.video)==null?void 0:e.canPublishSources)&&(t.video.canPublishSources=t.video.canPublishSources.map(oh)),t}var is={};const ch="6h";class Vo{constructor(e,t,i){if(e||(e=is.LIVEKIT_API_KEY),t||(t=is.LIVEKIT_API_SECRET),!e||!t)throw Error("api-key and api-secret must be set");typeof document<"u"&&console.error(`You should not include your API secret in your web client bundle.

Your web client should request a token from your backend server which should then use the API secret to generate a token. See https://docs.livekit.io/client/connect/`),this.apiKey=e,this.apiSecret=t,this.grants={},this.identity=i==null?void 0:i.identity,this.ttl=(i==null?void 0:i.ttl)||ch,typeof this.ttl=="number"&&(this.ttl=`${this.ttl}s`),i!=null&&i.metadata&&(this.metadata=i.metadata),i!=null&&i.attributes&&(this.attributes=i.attributes),i!=null&&i.name&&(this.name=i.name)}addGrant(e){this.grants.video={...this.grants.video??{},...e}}addSIPGrant(e){this.grants.sip={...this.grants.sip??{},...e}}get name(){return this.grants.name}set name(e){this.grants.name=e}get metadata(){return this.grants.metadata}set metadata(e){this.grants.metadata=e}get attributes(){return this.grants.attributes}set attributes(e){this.grants.attributes=e}get kind(){return this.grants.kind}set kind(e){this.grants.kind=e}get sha256(){return this.grants.sha256}set sha256(e){this.grants.sha256=e}get roomPreset(){return this.grants.roomPreset}set roomPreset(e){this.grants.roomPreset=e}get roomConfig(){return this.grants.roomConfig}set roomConfig(e){this.grants.roomConfig=e}async toJwt(){var e;const t=new TextEncoder().encode(this.apiSecret),i=new sh(ah(this.grants)).setProtectedHeader({alg:"HS256"}).setIssuer(this.apiKey).setExpirationTime(this.ttl).setNotBefore(0);if(this.identity)i.setSubject(this.identity);else if((e=this.grants.video)!=null&&e.roomJoin)throw Error("identity is required for join but not set");return i.sign(t)}}class Ho{constructor(e,t,i){this.apiKey=e,this.secret=t,this.ttl=i||"10m"}async authHeader(e,t){const i=new Vo(this.apiKey,this.secret,{ttl:this.ttl});return e&&i.addGrant(e),t&&i.addSIPGrant(t),{Authorization:`Bearer ${await i.toJwt()}`}}}const uh="modulepreload",lh=function(n,e){return new URL(n,e).href},rs={},qo=function(e,t,i){let r=Promise.resolve();if(t&&t.length>0){const o=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),f=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));r=Promise.allSettled(t.map(h=>{if(h=lh(h,i),h in rs)return;rs[h]=!0;const u=h.endsWith(".css"),p=u?'[rel="stylesheet"]':"";if(!!i)for(let w=o.length-1;w>=0;w--){const C=o[w];if(C.href===h&&(!u||C.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${h}"]${p}`))return;const k=document.createElement("link");if(k.rel=u?"stylesheet":uh,u||(k.as="script"),k.crossOrigin="",k.href=h,f&&k.setAttribute("nonce",f),document.head.appendChild(k),u)return new Promise((w,C)=>{k.addEventListener("load",w),k.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${h}`)))})}))}function s(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return r.then(o=>{for(const l of o||[])l.status==="rejected"&&s(l.reason);return e().catch(s)})},dh="/twirp",$o="livekit";class hh extends Error{constructor(e,t,i,r){super(t),this.name=e,this.status=i,this.code=r}}class Wo{constructor(e,t,i){e.startsWith("ws")&&(e=e.replace("ws","http")),this.host=e,this.pkg=t,this.prefix=i||dh}async request(e,t,i,r){const s=`${this.prefix}/${this.pkg}.${e}/${t}`,o=new URL(s,this.host),l=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json;charset=UTF-8",...r},body:JSON.stringify(i)});if(!l.ok){const u=l.headers.get("content-type")==="application/json";let p="Unknown internal error",y;try{if(u){const k=await l.json();"msg"in k&&(p=k.msg),"code"in k&&(y=k.code)}else p=await l.text()}catch(k){console.debug("Error when trying to parse error message, using defaults",k)}throw new hh(l.statusText,p,l.status,y)}const f=await l.json();return(await qo(()=>import("./index-BLfCKlkn.js"),[],import.meta.url).then(u=>u.default))(f,{deep:!0})}}const Ae="Egress";class Go extends Ho{constructor(e,t,i){super(t,i),this.rpc=new Wo(e,$o)}async startRoomCompositeEgress(e,t,i,r,s,o,l){let f;if(i!==void 0)if(typeof i=="string")f=i;else{const x=i;f=x.layout,r=x.encodingOptions,s=x.audioOnly,o=x.videoOnly,l=x.customBaseUrl}f??(f=""),s??(s=!1),o??(o=!1),l??(l="");const{output:h,options:u,fileOutputs:p,streamOutputs:y,segmentOutputs:k,imageOutputs:w}=this.getOutputParams(t,r),C=new Wi({roomName:e,layout:f,audioOnly:s,videoOnly:o,customBaseUrl:l,output:h,options:u,fileOutputs:p,streamOutputs:y,segmentOutputs:k,imageOutputs:w}).toJson(),R=await this.rpc.request(Ae,"StartRoomCompositeEgress",C,await this.authHeader({roomRecord:!0}));return ve.fromJson(R,{ignoreUnknownFields:!0})}async startWebEgress(e,t,i){const r=(i==null?void 0:i.audioOnly)||!1,s=(i==null?void 0:i.videoOnly)||!1,o=(i==null?void 0:i.awaitStartSignal)||!1,{output:l,options:f,fileOutputs:h,streamOutputs:u,segmentOutputs:p,imageOutputs:y}=this.getOutputParams(t,i==null?void 0:i.encodingOptions),k=new Ro({url:e,audioOnly:r,videoOnly:s,awaitStartSignal:o,output:l,options:f,fileOutputs:h,streamOutputs:u,segmentOutputs:p,imageOutputs:y}).toJson(),w=await this.rpc.request(Ae,"StartWebEgress",k,await this.authHeader({roomRecord:!0}));return ve.fromJson(w,{ignoreUnknownFields:!0})}async startParticipantEgress(e,t,i,r){const{options:s,fileOutputs:o,streamOutputs:l,segmentOutputs:f,imageOutputs:h}=this.getOutputParams(i,r==null?void 0:r.encodingOptions),u=new Co({roomName:e,identity:t,screenShare:(r==null?void 0:r.screenShare)??!1,options:s,fileOutputs:o,streamOutputs:l,segmentOutputs:f,imageOutputs:h}).toJson(),p=await this.rpc.request(Ae,"StartParticipantEgress",u,await this.authHeader({roomRecord:!0}));return ve.fromJson(p,{ignoreUnknownFields:!0})}async startTrackCompositeEgress(e,t,i,r,s){let o;if(i!==void 0)if(typeof i=="string")o=i;else{const C=i;o=C.audioTrackId,r=C.videoTrackId,s=C.encodingOptions}o??(o=""),r??(r="");const{output:l,options:f,fileOutputs:h,streamOutputs:u,segmentOutputs:p,imageOutputs:y}=this.getOutputParams(t,s),k=new Io({roomName:e,audioTrackId:o,videoTrackId:r,output:l,options:f,fileOutputs:h,streamOutputs:u,segmentOutputs:p,imageOutputs:y}).toJson(),w=await this.rpc.request(Ae,"StartTrackCompositeEgress",k,await this.authHeader({roomRecord:!0}));return ve.fromJson(w,{ignoreUnknownFields:!0})}isEncodedOutputs(e){return e.file!==void 0||e.stream!==void 0||e.segments!==void 0||e.images!==void 0}isEncodedFileOutput(e){return e.filepath!==void 0||e.fileType!==void 0}isSegmentedFileOutput(e){return e.filenamePrefix!==void 0||e.playlistName!==void 0||e.filenameSuffix!==void 0}isStreamOutput(e){return e.protocol!==void 0||e.urls!==void 0}getOutputParams(e,t){let i,r,s,o,l,f,h;this.isEncodedOutputs(e)?(e.file!==void 0&&(r=[e.file]),e.stream!==void 0&&(o=[e.stream]),e.segments!==void 0&&(f=[e.segments]),e.images!==void 0&&(h=[e.images])):this.isEncodedFileOutput(e)?(i=e,r=[i]):this.isSegmentedFileOutput(e)?(l=e,f=[l]):this.isStreamOutput(e)&&(s=e,o=[s]);let u;i?u={case:"file",value:i}:s?u={case:"stream",value:s}:l&&(u={case:"segments",value:l});let p;return t&&(typeof t=="number"?p={case:"preset",value:t}:p={case:"advanced",value:t}),{output:u,options:p,fileOutputs:r,streamOutputs:o,segmentOutputs:f,imageOutputs:h}}async startTrackEgress(e,t,i){let r;typeof t=="string"?r={case:"websocketUrl",value:t}:r={case:"file",value:t};const s=new Ao({roomName:e,trackId:i,output:r}).toJson(),o=await this.rpc.request(Ae,"StartTrackEgress",s,await this.authHeader({roomRecord:!0}));return ve.fromJson(o,{ignoreUnknownFields:!0})}async updateLayout(e,t){const i=await this.rpc.request(Ae,"UpdateLayout",new sd({egressId:e,layout:t}).toJson(),await this.authHeader({roomRecord:!0}));return ve.fromJson(i,{ignoreUnknownFields:!0})}async updateStream(e,t,i){t??(t=[]),i??(i=[]);const r=await this.rpc.request(Ae,"UpdateStream",new od({egressId:e,addOutputUrls:t,removeOutputUrls:i}).toJson(),await this.authHeader({roomRecord:!0}));return ve.fromJson(r,{ignoreUnknownFields:!0})}async listEgress(e){let t={};typeof e=="string"?t.roomName=e:e!==void 0&&(t=e);const i=await this.rpc.request(Ae,"ListEgress",new ad(t).toJson(),await this.authHeader({roomRecord:!0}));return cd.fromJson(i,{ignoreUnknownFields:!0}).items??[]}async stopEgress(e){const t=await this.rpc.request(Ae,"StopEgress",new ud({egressId:e}).toJson(),await this.authHeader({roomRecord:!0}));return ve.fromJson(t,{ignoreUnknownFields:!0})}}async function fh(n=16){return globalThis.crypto?crypto.getRandomValues(new Uint8Array(n)):(await qo(()=>import("./__vite-browser-external-BIHI7g3E.js"),[],import.meta.url)).getRandomValues(new Uint8Array(n))}const _e="RoomService";class mh extends Ho{constructor(e,t,i){super(t,i),this.rpc=new Wo(e,$o)}async createRoom(e){const t=await this.rpc.request(_e,"CreateRoom",new pd(e).toJson(),await this.authHeader({roomCreate:!0}));return Ri.fromJson(t,{ignoreUnknownFields:!0})}async listRooms(e){const t=await this.rpc.request(_e,"ListRooms",new _d({names:e??[]}).toJson(),await this.authHeader({roomList:!0}));return yd.fromJson(t,{ignoreUnknownFields:!0}).rooms??[]}async deleteRoom(e){await this.rpc.request(_e,"DeleteRoom",new Ed({room:e}).toJson(),await this.authHeader({roomCreate:!0}))}async updateRoomMetadata(e,t){const i=await this.rpc.request(_e,"UpdateRoomMetadata",new Id({room:e,metadata:t}).toJson(),await this.authHeader({roomAdmin:!0,room:e}));return Ri.fromJson(i,{ignoreUnknownFields:!0})}async listParticipants(e){const t=await this.rpc.request(_e,"ListParticipants",new Td({room:e}).toJson(),await this.authHeader({roomAdmin:!0,room:e}));return wd.fromJson(t,{ignoreUnknownFields:!0}).participants??[]}async getParticipant(e,t){const i=await this.rpc.request(_e,"GetParticipant",new ts({room:e,identity:t}).toJson(),await this.authHeader({roomAdmin:!0,room:e}));return Ci.fromJson(i,{ignoreUnknownFields:!0})}async removeParticipant(e,t){await this.rpc.request(_e,"RemoveParticipant",new ts({room:e,identity:t}).toJson(),await this.authHeader({roomAdmin:!0,room:e}))}async mutePublishedTrack(e,t,i,r){const s=new Sd({room:e,identity:t,trackSid:i,muted:r}).toJson(),o=await this.rpc.request(_e,"MutePublishedTrack",s,await this.authHeader({roomAdmin:!0,room:e}));return bd.fromJson(o,{ignoreUnknownFields:!0}).track}async updateParticipant(e,t,i,r,s){const o=typeof i=="object",l=o?i==null?void 0:i.metadata:i,f=o?i.permission:r,h=o?i.name:s,u=o?i.attributes:{},p=new kd({room:e,identity:t,attributes:u,metadata:l,name:h});f&&(p.permission=new $i(f));const y=await this.rpc.request(_e,"UpdateParticipant",p.toJson(),await this.authHeader({roomAdmin:!0,room:e}));return Ci.fromJson(y,{ignoreUnknownFields:!0})}async updateSubscriptions(e,t,i,r){const s=new Rd({room:e,identity:t,trackSids:i,subscribe:r,participantTracks:[]}).toJson();await this.rpc.request(_e,"UpdateSubscriptions",s,await this.authHeader({roomAdmin:!0,room:e}))}async sendData(e,t,i,r={}){const s=Array.isArray(r)?r:r.destinationSids,o=Array.isArray(r)?void 0:r.topic,l=new Cd({room:e,data:t,kind:i,destinationSids:s??[],topic:o});!Array.isArray(r)&&r.destinationIdentities&&(l.destinationIdentities=r.destinationIdentities),l.nonce=await fh(16),await this.rpc.request(_e,"SendData",l.toJson(),await this.authHeader({roomAdmin:!0,room:e}))}}const ph=16,gh=12;function _h(n){let e=new TextEncoder;return window.crypto.subtle.importKey("raw",e.encode(n),{name:"PBKDF2"},!1,["deriveBits","deriveKey"])}function yh(n,e){return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:e,iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async function Eh(n,e){const t=window.crypto.getRandomValues(new Uint8Array(ph)),i=window.crypto.getRandomValues(new Uint8Array(gh));let r=ks(n),s=await _h(e),o=await yh(s,t);const l=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},o,r);return{salt:ai(new Uint8Array(t)),iv:ai(new Uint8Array(i)),encryptedText:ai(new Uint8Array(l))}}const Ne=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];function ai(n){let e="",t,i=n.length;for(t=2;t<i;t+=3)e+=Ne[n[t-2]>>2],e+=Ne[(n[t-2]&3)<<4|n[t-1]>>4],e+=Ne[(n[t-1]&15)<<2|n[t]>>6],e+=Ne[n[t]&63];return t===i+1&&(e+=Ne[n[t-2]>>2],e+=Ne[(n[t-2]&3)<<4],e+="=="),t===i&&(e+=Ne[n[t-2]>>2],e+=Ne[(n[t-2]&3)<<4|n[t-1]>>4],e+=Ne[(n[t-1]&15)<<2],e+="="),e}const xe=n=>{const e=console.error;Object.assign(console,{error:(...i)=>{(!i[0]||!i[0].toString||!i[0].toString().includes("You should not include your API secret in your web client bundle"))&&e.apply(console,i)}});const t=n();return Object.assign(console,{error:e}),t},Bn=(n,e,t)=>xe(()=>new Vo(n,e,t));async function Th(n,e,t){const i=Bn(n,e,{identity:t,ttl:86400});return i.addGrant({room:t,roomJoin:!0,roomCreate:!0,roomAdmin:!0,roomList:!0,canPublish:!0,canSubscribe:!1,canPublishData:!0,canUpdateOwnMetadata:!0}),await i.toJwt()}async function wh(n,e){const{encryptedText:t,iv:i,salt:r}=await Eh(n,e);return{salt:r,iv:i,token:t}}async function Sh(n,e,t,i){const r=Bn(n,e,{identity:i,name:i,ttl:21600});return r.addGrant({room:t,roomList:!0,roomJoin:!0,canPublish:!1,canSubscribe:!0,canPublishData:!0,canUpdateOwnMetadata:!1}),await r.toJwt()}async function bh(n,e){const t=Bn(n,e,{identity:"lt",ttl:94608e5});return t.addGrant({roomList:!0,roomJoin:!1,canPublish:!1,canSubscribe:!1,canPublishData:!1,canUpdateOwnMetadata:!1}),await t.toJwt()}async function kh(n,e){const t=Bn(n,e,{identity:"lt",ttl:600});return t.addGrant({hidden:!1,room:"connection-test-room",roomList:!0,roomJoin:!0,roomRecord:!1,roomCreate:!1,roomAdmin:!1,canPublish:!1,canSubscribe:!1,canPublishData:!1,canUpdateOwnMetadata:!1}),await t.toJwt()}class Rh{constructor(){I(this,"_twitchStreamKey");I(this,"_egressClient");I(this,"roomName");I(this,"streamEgressID")}init(e,t,i,r){this.roomName=t,this._twitchStreamKey=e,this._egressClient=new Go("https://rov-web.livekit.cloud",i,r)}async listRunningEgress(){if(!this._egressClient)throw new Error("Egress client not initialized!");return await this._egressClient.listEgress({active:!0})}isAnotherEgressRunning(e){return e.filter(t=>!this.streamEgressID||t.egressId!=this.streamEgressID).length>0}getCurrentEgress(e){return e.find(t=>t.roomName==this.roomName)}async closeOtherEgresses(e){return this._egressClient?Promise.allSettled(e.filter(t=>!this.streamEgressID||t.egressId!==this.streamEgressID).map(async t=>!this._egressClient||!t.egressId?!1:(ue("Closing egress: ",t),await this._egressClient.stopEgress(t.egressId)))):!1}async startStream(){if(!this._twitchStreamKey||!this._egressClient||!this.roomName)return F("startStream() err: Twitch stream key not set or twitchStream class not initilized!");let e=await xe(()=>this.listRunningEgress()),t=this.getCurrentEgress(e);if(t!==void 0){ue("Found current twitch egress: ",t),this.streamEgressID=t.egressId;return}else{for(;await this.isAnotherEgressRunning(e)==!0;){const s=await this.closeOtherEgresses(e);if(U("egressCloseStates",s),ue("Another twitch stream is running, waiting 2 seconds to try again..."),await Gt(2e3),e=await this.listRunningEgress(),t=this.getCurrentEgress(e),t!==void 0){ue("Found current twitch egress: ",t),this.streamEgressID=t.egressId;return}}const i=new We({protocol:ko.RTMP,urls:["rtmp://live.twitch.tv/app/"+this._twitchStreamKey]});let r=await xe(()=>{var s;return(s=this._egressClient)==null?void 0:s.startRoomCompositeEgress(this.roomName,i)});this.streamEgressID=r==null?void 0:r.egressId,U("Twitch stream started: ",r)}}async stopStream(){if(!this._egressClient)return F("stopStream() err: Twitch Stream not started!");const e=this.streamEgressID;if(this.streamEgressID=void 0,e){const r=await xe(()=>{var s;return(s=this==null?void 0:this._egressClient)==null?void 0:s.stopEgress(e)});U("Twitch stream stopped: ",r)}const t=await xe(()=>this.listRunningEgress()),i=this.getCurrentEgress(t);if(i){U("Egress still running: ",i);const r=await xe(()=>{var s;return(s=this==null?void 0:this._egressClient)==null?void 0:s.stopEgress(i.egressId)});U("Twitch stream stopped: ",r)}this.streamEgressID=void 0}}const Nn=new Rh;let ci=null,Ni=!1,Jo=!1,Lt=0,ui=1;function li(n,e=!0){Ni=n,ne.sendMessage(ae.create({body:{oneofKind:"arming",arming:{armed:n}}}),!0,[]),Ni?be.sendMessage(Za()):be.sendMessage(ec())}function Ch(n,e){var r,s,o,l,f,h,u,p,y,k,w;const t=e.body;switch(t.oneofKind){case"ping":return ne.sendMessage(ae.create({body:{oneofKind:"pong",pong:{time:t.ping.time}}}),!1,[n]),be.sendMessage(ic()),!0;case"simplePeerSignal":const C=t.simplePeerSignal.message;return console.log("Got signal from ",n," with signal: ",C),ne.ingestSimplePeerSignalMsg(n,C),!0;case"move":if(ci&&ci!==n)return!1;let R=t.move.buttonBitmask||0;if(Ni){Jo||li(!0);let J=(t.move.velocityX||0)*1e3,Ye=(t.move.velocityY||0)*1e3,oe=(t.move.velocityZ||0)*500+500,ut=(t.move.angularVelocityYaw||0)*500;return be.sendMessage(br(J,Ye,oe,ut,R)),!0}else return be.sendMessage(br(0,0,500,0,R)),!1;case"shutdownRov":return Ur("poweroff").then(J=>{ne.sendMessage(ae.create({exchangeId:e.exchangeId,body:{oneofKind:"done",done:{message:J}}}),!1,[])}).catch(J=>{ne.sendMessage(ae.create({exchangeId:e.exchangeId,body:{oneofKind:"error",error:{message:J.message}}}),!1,[])}),!0;case"rebootRov":return Ur("reboot").then(J=>{ne.sendMessage(ae.create({exchangeId:e.exchangeId,body:{oneofKind:"done",done:{message:J}}}),!1,[])}).catch(J=>{ne.sendMessage(ae.create({exchangeId:e.exchangeId,body:{oneofKind:"error",error:{message:J.message}}}),!1,[])}),!0;case"moveClaw":const x=.25;return U("Setting servo ",Lt," of group ",ui," to ",x),be.sendMessage(rc(Lt,x,ui)),Lt==7?(Lt=0,ui++):Lt++,!0;case"setAutopilotMode":return be.sendMessage(nc(t.setAutopilotMode.mode)),!0;case"disarm":return li(!1),!0;case"takeControl":return ci=n,ne.sendMessage(ae.create({body:{oneofKind:"pilotChanged",pilotChanged:{pilotIdentity:n}}}),!1,[]),li(!0),!0;case"sendRovLogs":return vn.sendQueuedLogs((J,Ye)=>ne.sendMessage(ae.create({body:{oneofKind:"logMessage",logMessage:{level:J??Ha.Debug,message:Ye}}}),!0,[])),!0;case"setLivestreamingEnabled":return t.setLivestreamingEnabled.enabled?Nn.startStream():Nn.stopStream(),!0;case"setLivekitVideoOptions":const N=Mt.videoCaptureDefaults,A=Mt.publishDefaults,O=t.setLivekitVideoOptions,v=O.baseStream;if(!O.enabled)return ne.setLivekitVideoOptions(!1),!0;U("Got Livekit Video Options: ",O);const q=16/9,te={...N,resolution:{width:(v==null?void 0:v.width)||Math.floor(((v==null?void 0:v.height)||0)*q)||((r=N==null?void 0:N.resolution)==null?void 0:r.width)||1920,height:(v==null?void 0:v.height)||Math.floor(((v==null?void 0:v.width)||0)/q)||((s=N==null?void 0:N.resolution)==null?void 0:s.height)||1080,frameRate:(v==null?void 0:v.fps)||((o=N==null?void 0:N.resolution)==null?void 0:o.frameRate)},facingMode:N==null?void 0:N.facingMode},X=O.simulcastLayers?O.simulcastLayers.map((J,Ye)=>{var ut,un,Q,re;const oe=A!=null&&A.videoSimulcastLayers?A==null?void 0:A.videoSimulcastLayers[Ye]:void 0;return{encoding:{maxBitrate:J.maxBitrate??(v==null?void 0:v.maxBitrate)??((ut=oe==null?void 0:oe.encoding)==null?void 0:ut.maxBitrate)??99e9,maxFramerate:J.fps||((un=oe==null?void 0:oe.encoding)==null?void 0:un.maxFramerate),priority:"high"},width:J.width||(J.height?Math.floor(J.height*q):null)||(oe==null?void 0:oe.width)||((Q=N==null?void 0:N.resolution)==null?void 0:Q.width),height:J.height||(J.width?Math.floor(J.width/q):null)||(oe==null?void 0:oe.height)||((re=N==null?void 0:N.resolution)==null?void 0:re.height)}}):A==null?void 0:A.videoSimulcastLayers,Ce=O.codec!==null&&O.codec!==void 0?O.codec:A==null?void 0:A.videoCodec,an={...A,videoCodec:Ce,videoEncoding:{maxBitrate:(v==null?void 0:v.maxBitrate)??((l=A==null?void 0:A.videoEncoding)==null?void 0:l.maxBitrate)??99e9,maxFramerate:(v==null?void 0:v.fps)||((f=A==null?void 0:A.videoEncoding)==null?void 0:f.maxFramerate),priority:(h=A==null?void 0:A.videoEncoding)==null?void 0:h.priority},backupCodec:O.allowBackupCodec??(A==null?void 0:A.backupCodec),simulcast:O.simulcastLayers?O.simulcastLayers.length>0:A==null?void 0:A.simulcast,videoSimulcastLayers:X};return ne.setLivekitVideoOptions(!0,te,an),!0;case"setSimplePeerVideoOptions":const ce=Mt.videoCaptureDefaults,ge=Mt.publishDefaults,je=t.setSimplePeerVideoOptions,ie=je.baseStream;if(U("Got SimplePeer Video Options: ",je),!je.enabled)return ne.setSimplePeerVideoOptions(!1,n),!0;const $n=16/9,Wn={...ce,resolution:{width:Math.floor(((ie==null?void 0:ie.height)||((u=ce==null?void 0:ce.resolution)==null?void 0:u.height)||0)*$n),height:(ie==null?void 0:ie.height)||((p=ce==null?void 0:ce.resolution)==null?void 0:p.height)||0,frameRate:(ie==null?void 0:ie.fps)||((y=ce==null?void 0:ce.resolution)==null?void 0:y.frameRate)||60},facingMode:ce==null?void 0:ce.facingMode},cn={videoCodec:je.codec?je.codec:ge==null?void 0:ge.videoCodec,videoEncoding:{maxBitrate:(ie==null?void 0:ie.maxBitrate)||((k=ge==null?void 0:ge.videoEncoding)==null?void 0:k.maxBitrate)||0,maxFramerate:(ie==null?void 0:ie.fps)||((w=ge==null?void 0:ge.videoEncoding)==null?void 0:w.maxFramerate)}};return ne.setSimplePeerVideoOptions(!0,n,Wn,cn),!0;default:return F("Unknown Message Recived: ",gi.toJson(e)),!1}}function ss(n,e){Ch(n,e)}function Ih(n){if(!n||!n.message)return;const e=n.message;e.type&&e.type==="HEARTBEAT"&&(Jo=!!(e.base_mode.bits&pi.MAV_MODE_FLAG_SAFETY_ARMED))}let wt=[];function Pe(n){let e=[],t=(o,l=!0)=>(e.includes(o)||e.push(o),l&&o(n),()=>{e=e.filter(f=>f!=o)});function i(o){if(o===n&&(n===null||typeof n!="object"))return;let l=n;n=o;for(let f of e)f(n,l)}function r(){let o=wt[wt.length-1];return o&&t(o[0],!1),n}if(typeof n=="function")return Ah(n);function s(){for(let o of e)o(n,n)}return{subscribe:t,set:i,get:r,refresh:s,update:o=>{typeof o=="function"&&i(o(n))}}}function Ah(n){let e=Pe(null),t=[i];return i(),e;function i(){if(wt.includes(t))throw Error("Circular computation");wt.push(t);let r;try{r=n()}catch(s){throw wt.pop(),s}wt.pop(),e.set(r)}}function jo(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var vi={exports:{}},di,os;function Nh(){if(os)return di;os=1;var n=1e3,e=n*60,t=e*60,i=t*24,r=i*7,s=i*365.25;di=function(u,p){p=p||{};var y=typeof u;if(y==="string"&&u.length>0)return o(u);if(y==="number"&&isFinite(u))return p.long?f(u):l(u);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(u))};function o(u){if(u=String(u),!(u.length>100)){var p=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(p){var y=parseFloat(p[1]),k=(p[2]||"ms").toLowerCase();switch(k){case"years":case"year":case"yrs":case"yr":case"y":return y*s;case"weeks":case"week":case"w":return y*r;case"days":case"day":case"d":return y*i;case"hours":case"hour":case"hrs":case"hr":case"h":return y*t;case"minutes":case"minute":case"mins":case"min":case"m":return y*e;case"seconds":case"second":case"secs":case"sec":case"s":return y*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return y;default:return}}}}function l(u){var p=Math.abs(u);return p>=i?Math.round(u/i)+"d":p>=t?Math.round(u/t)+"h":p>=e?Math.round(u/e)+"m":p>=n?Math.round(u/n)+"s":u+"ms"}function f(u){var p=Math.abs(u);return p>=i?h(u,p,i,"day"):p>=t?h(u,p,t,"hour"):p>=e?h(u,p,e,"minute"):p>=n?h(u,p,n,"second"):u+" ms"}function h(u,p,y,k){var w=p>=y*1.5;return Math.round(u/y)+" "+k+(w?"s":"")}return di}function vh(n){t.debug=t,t.default=t,t.coerce=f,t.disable=s,t.enable=r,t.enabled=o,t.humanize=Nh(),t.destroy=h,Object.keys(n).forEach(u=>{t[u]=n[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let p=0;for(let y=0;y<u.length;y++)p=(p<<5)-p+u.charCodeAt(y),p|=0;return t.colors[Math.abs(p)%t.colors.length]}t.selectColor=e;function t(u){let p,y=null,k,w;function C(...R){if(!C.enabled)return;const x=C,N=Number(new Date),A=N-(p||N);x.diff=A,x.prev=p,x.curr=N,p=N,R[0]=t.coerce(R[0]),typeof R[0]!="string"&&R.unshift("%O");let O=0;R[0]=R[0].replace(/%([a-zA-Z%])/g,(q,te)=>{if(q==="%%")return"%";O++;const X=t.formatters[te];if(typeof X=="function"){const Ce=R[O];q=X.call(x,Ce),R.splice(O,1),O--}return q}),t.formatArgs.call(x,R),(x.log||t.log).apply(x,R)}return C.namespace=u,C.useColors=t.useColors(),C.color=t.selectColor(u),C.extend=i,C.destroy=t.destroy,Object.defineProperty(C,"enabled",{enumerable:!0,configurable:!1,get:()=>y!==null?y:(k!==t.namespaces&&(k=t.namespaces,w=t.enabled(u)),w),set:R=>{y=R}}),typeof t.init=="function"&&t.init(C),C}function i(u,p){const y=t(this.namespace+(typeof p>"u"?":":p)+u);return y.log=this.log,y}function r(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];let p;const y=(typeof u=="string"?u:"").split(/[\s,]+/),k=y.length;for(p=0;p<k;p++)y[p]&&(u=y[p].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.slice(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function s(){const u=[...t.names.map(l),...t.skips.map(l).map(p=>"-"+p)].join(",");return t.enable(""),u}function o(u){if(u[u.length-1]==="*")return!0;let p,y;for(p=0,y=t.skips.length;p<y;p++)if(t.skips[p].test(u))return!1;for(p=0,y=t.names.length;p<y;p++)if(t.names[p].test(u))return!0;return!1}function l(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function f(u){return u instanceof Error?u.stack||u.message:u}function h(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var Oh=vh;(function(n,e){var t={};e.formatArgs=r,e.save=s,e.load=o,e.useColors=i,e.storage=l(),e.destroy=(()=>{let h=!1;return()=>{h||(h=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function i(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let h;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(h=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(h[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(h){if(h[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+h[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;h.splice(1,0,u,"color: inherit");let p=0,y=0;h[0].replace(/%[a-zA-Z%]/g,k=>{k!=="%%"&&(p++,k==="%c"&&(y=p))}),h.splice(y,0,u)}e.log=console.debug||console.log||(()=>{});function s(h){try{h?e.storage.setItem("debug",h):e.storage.removeItem("debug")}catch{}}function o(){let h;try{h=e.storage.getItem("debug")}catch{}return!h&&typeof Bt<"u"&&"env"in Bt&&(h=t.DEBUG),h}function l(){try{return localStorage}catch{}}n.exports=Oh(e);const{formatters:f}=n.exports;f.j=function(h){try{return JSON.stringify(h)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(vi,vi.exports);var xh=vi.exports;const Ph=jo(xh),Fe=typeof window<"u"?window:self,Oi=Fe.RTCPeerConnection||Fe.mozRTCPeerConnection||Fe.webkitRTCPeerConnection,Fh=Fe.RTCSessionDescription||Fe.mozRTCSessionDescription||Fe.webkitRTCSessionDescription,Lh=Fe.RTCIceCandidate||Fe.mozRTCIceCandidate||Fe.webkitRTCIceCandidate;var zi={exports:{}},St=typeof Reflect=="object"?Reflect:null,as=St&&typeof St.apply=="function"?St.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)},Sn;St&&typeof St.ownKeys=="function"?Sn=St.ownKeys:Object.getOwnPropertySymbols?Sn=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Sn=function(e){return Object.getOwnPropertyNames(e)};function Mh(n){console&&console.warn&&console.warn(n)}var Yo=Number.isNaN||function(e){return e!==e};function B(){B.init.call(this)}zi.exports=B;zi.exports.once=Kh;B.EventEmitter=B;B.prototype._events=void 0;B.prototype._eventsCount=0;B.prototype._maxListeners=void 0;var cs=10;function Kn(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(B,"defaultMaxListeners",{enumerable:!0,get:function(){return cs},set:function(n){if(typeof n!="number"||n<0||Yo(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");cs=n}});B.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};B.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Yo(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function zo(n){return n._maxListeners===void 0?B.defaultMaxListeners:n._maxListeners}B.prototype.getMaxListeners=function(){return zo(this)};B.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r=e==="error",s=this._events;if(s!==void 0)r=r&&s.error===void 0;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var l=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw l.context=o,l}var f=s[e];if(f===void 0)return!1;if(typeof f=="function")as(f,this,t);else for(var h=f.length,u=ta(f,h),i=0;i<h;++i)as(u[i],this,t);return!0};function Xo(n,e,t,i){var r,s,o;if(Kn(t),s=n._events,s===void 0?(s=n._events=Object.create(null),n._eventsCount=0):(s.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),s=n._events),o=s[e]),o===void 0)o=s[e]=t,++n._eventsCount;else if(typeof o=="function"?o=s[e]=i?[t,o]:[o,t]:i?o.unshift(t):o.push(t),r=zo(n),r>0&&o.length>r&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=n,l.type=e,l.count=o.length,Mh(l)}return n}B.prototype.addListener=function(e,t){return Xo(this,e,t,!1)};B.prototype.on=B.prototype.addListener;B.prototype.prependListener=function(e,t){return Xo(this,e,t,!0)};function Dh(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Qo(n,e,t){var i={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},r=Dh.bind(i);return r.listener=t,i.wrapFn=r,r}B.prototype.once=function(e,t){return Kn(t),this.on(e,Qo(this,e,t)),this};B.prototype.prependOnceListener=function(e,t){return Kn(t),this.prependListener(e,Qo(this,e,t)),this};B.prototype.removeListener=function(e,t){var i,r,s,o,l;if(Kn(t),r=this._events,r===void 0)return this;if(i=r[e],i===void 0)return this;if(i===t||i.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if(typeof i!="function"){for(s=-1,o=i.length-1;o>=0;o--)if(i[o]===t||i[o].listener===t){l=i[o].listener,s=o;break}if(s<0)return this;s===0?i.shift():Uh(i,s),i.length===1&&(r[e]=i[0]),r.removeListener!==void 0&&this.emit("removeListener",e,l||t)}return this};B.prototype.off=B.prototype.removeListener;B.prototype.removeAllListeners=function(e){var t,i,r;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var s=Object.keys(i),o;for(r=0;r<s.length;++r)o=s[r],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=i[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this};function Zo(n,e,t){var i=n._events;if(i===void 0)return[];var r=i[e];return r===void 0?[]:typeof r=="function"?t?[r.listener||r]:[r]:t?Bh(r):ta(r,r.length)}B.prototype.listeners=function(e){return Zo(this,e,!0)};B.prototype.rawListeners=function(e){return Zo(this,e,!1)};B.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):ea.call(n,e)};B.prototype.listenerCount=ea;function ea(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}B.prototype.eventNames=function(){return this._eventsCount>0?Sn(this._events):[]};function ta(n,e){for(var t=new Array(e),i=0;i<e;++i)t[i]=n[i];return t}function Uh(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function Bh(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function Kh(n,e){return new Promise(function(t,i){function r(o){n.removeListener(e,s),i(o)}function s(){typeof n.removeListener=="function"&&n.removeListener("error",r),t([].slice.call(arguments))}na(n,e,s,{once:!0}),e!=="error"&&Vh(n,r,{once:!0})})}function Vh(n,e,t){typeof n.on=="function"&&na(n,"error",e,t)}function na(n,e,t,i){if(typeof n.on=="function")i.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function r(s){i.once&&n.removeEventListener(e,r),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var Hh=zi.exports,qh=typeof queueMicrotask=="function"?queueMicrotask:n=>Promise.resolve().then(n),$h=class{constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return this.buffer[this.btm]===void 0}};const us=$h;var Wh=class{constructor(e){this.hwm=e||16,this.head=new us(this.hwm),this.tail=this.head,this.length=0}clear(){this.head=this.tail,this.head.clear(),this.length=0}push(e){if(this.length++,!this.head.push(e)){const t=this.head;this.head=t.next=new us(2*this.head.buffer.length),this.head.push(e)}}shift(){this.length!==0&&this.length--;const e=this.tail.shift();if(e===void 0&&this.tail.next){const t=this.tail.next;return this.tail.next=null,this.tail=t,this.tail.shift()}return e}peek(){const e=this.tail.peek();return e===void 0&&this.tail.next?this.tail.next.peek():e}isEmpty(){return this.length===0}},ia=class{constructor(e){this.decoder=new TextDecoder(e==="utf16le"?"utf16-le":e)}decode(e){return this.decoder.decode(e,{stream:!0})}flush(){return this.decoder.decode(new Uint8Array(0))}};const Gh=ia,Jh=ia;var jh=class{constructor(e="utf8"){switch(this.encoding=Yh(e),this.encoding){case"utf8":this.decoder=new Jh;break;case"utf16le":case"base64":throw new Error("Unsupported encoding: "+this.encoding);default:this.decoder=new Gh(this.encoding)}}push(e){return typeof e=="string"?e:this.decoder.decode(e)}write(e){return this.push(e)}end(e){let t="";return e&&(t=this.push(e)),t+=this.decoder.flush(),t}};function Yh(n){switch(n=n.toLowerCase(),n){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return n;default:throw new Error("Unknown encoding: "+n)}}const{EventEmitter:zh}=Hh,Vn=new Error("Stream was destroyed"),hi=new Error("Premature close"),ra=qh,sa=Wh,Xh=jh,G=(1<<29)-1,at=1,Xi=2,nt=4,Vt=8,oa=G^at,Qh=G^Xi,nn=16,Ht=32,vt=64,Ve=128,rn=256,Qi=512,it=1024,xi=2048,Zi=4096,er=8192,ye=16384,bt=32768,Hn=65536,rt=131072,aa=rn|Qi,Zh=nn|Hn,ef=vt|nn,tf=Zi|Ve,tr=rn|rt,nf=G^nn,rf=G^vt,sf=G^(vt|Hn),ls=G^Hn,of=G^rn,af=G^(Ve|er),cf=G^it,ds=G^aa,ca=G^bt,uf=G^Ht,ua=G^rt,lf=G^tr,Je=1<<18,Ct=2<<18,sn=4<<18,st=8<<18,on=16<<18,ct=32<<18,Pi=64<<18,kt=128<<18,nr=256<<18,It=512<<18,qn=1024<<18,la=G^(Je|nr),da=G^sn,df=G^It,hf=G^on,ff=G^st,ha=G^kt,mf=G^Ct,fa=G^qn,qt=nn|Je,ma=G^qt,ir=ye|ct,Le=nt|Vt|Xi,me=Le|at,pa=Le|ir,pf=da&rf,rr=kt|bt,gf=rr&ma,ga=me|gf,_f=me|it|ye,hs=me|ye|Ve,yf=me|it|Ve,Ef=me|Zi|Ve|er,Tf=me|nn|it|ye|Hn|rt,wf=Le|it|ye,Sf=Ht|me|bt|vt,bf=me|It|ct,kf=st|on,_a=st|Je,Rf=st|on|me|Je,fs=me|Je|st|qn,Cf=sn|Je,If=Je|nr,Af=me|It|_a|ct,Nf=on|Le|It|ct,vf=Ct|me|kt|sn,fn=Symbol.asyncIterator||Symbol("asyncIterator");class ya{constructor(e,{highWaterMark:t=16384,map:i=null,mapWritable:r,byteLength:s,byteLengthWritable:o}={}){this.stream=e,this.queue=new sa,this.highWaterMark=t,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=o||s||Ra,this.map=r||i,this.afterWrite=Mf.bind(this),this.afterUpdateNextTick=Bf.bind(this)}get ended(){return(this.stream._duplexState&ct)!==0}push(e){return this.map!==null&&(e=this.map(e)),this.buffered+=this.byteLength(e),this.queue.push(e),this.buffered<this.highWaterMark?(this.stream._duplexState|=st,!0):(this.stream._duplexState|=kf,!1)}shift(){const e=this.queue.shift();return this.buffered-=this.byteLength(e),this.buffered===0&&(this.stream._duplexState&=ff),e}end(e){typeof e=="function"?this.stream.once("finish",e):e!=null&&this.push(e),this.stream._duplexState=(this.stream._duplexState|It)&da}autoBatch(e,t){const i=[],r=this.stream;for(i.push(e);(r._duplexState&fs)===_a;)i.push(r._writableState.shift());if(r._duplexState&me)return t(null);r._writev(i,t)}update(){const e=this.stream;e._duplexState|=Ct;do{for(;(e._duplexState&fs)===st;){const t=this.shift();e._duplexState|=If,e._write(t,this.afterWrite)}e._duplexState&Cf||this.updateNonPrimary()}while(this.continueUpdate()===!0);e._duplexState&=mf}updateNonPrimary(){const e=this.stream;if((e._duplexState&Af)===It){e._duplexState=(e._duplexState|Je)&df,e._final(Lf.bind(this));return}if((e._duplexState&Le)===nt){e._duplexState&rr||(e._duplexState|=qt,e._destroy(Ea.bind(this)));return}(e._duplexState&ga)===at&&(e._duplexState=(e._duplexState|qt)&oa,e._open(Ta.bind(this)))}continueUpdate(){return this.stream._duplexState&kt?(this.stream._duplexState&=ha,!0):!1}updateCallback(){(this.stream._duplexState&vf)===sn?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&kt||(this.stream._duplexState|=kt,this.stream._duplexState&Ct||ra(this.afterUpdateNextTick))}}class Of{constructor(e,{highWaterMark:t=16384,map:i=null,mapReadable:r,byteLength:s,byteLengthReadable:o}={}){this.stream=e,this.queue=new sa,this.highWaterMark=t===0?1:t,this.buffered=0,this.readAhead=t>0,this.error=null,this.pipeline=null,this.byteLength=o||s||Ra,this.map=r||i,this.pipeTo=null,this.afterRead=Df.bind(this),this.afterUpdateNextTick=Uf.bind(this)}get ended(){return(this.stream._duplexState&ye)!==0}pipe(e,t){if(this.pipeTo!==null)throw new Error("Can only pipe to one destination");if(typeof t!="function"&&(t=null),this.stream._duplexState|=Qi,this.pipeTo=e,this.pipeline=new Pf(this.stream,e,t),t&&this.stream.on("error",ms),Wt(e))e._writableState.pipeline=this.pipeline,t&&e.on("error",ms),e.on("finish",this.pipeline.finished.bind(this.pipeline));else{const i=this.pipeline.done.bind(this.pipeline,e),r=this.pipeline.done.bind(this.pipeline,e,null);e.on("error",i),e.on("close",r),e.on("finish",this.pipeline.finished.bind(this.pipeline))}e.on("drain",Ff.bind(this)),this.stream.emit("piping",e),e.emit("pipe",this.stream)}push(e){const t=this.stream;return e===null?(this.highWaterMark=0,t._duplexState=(t._duplexState|it)&sf,!1):this.map!==null&&(e=this.map(e),e===null)?(t._duplexState&=ls,this.buffered<this.highWaterMark):(this.buffered+=this.byteLength(e),this.queue.push(e),t._duplexState=(t._duplexState|Ve)&ls,this.buffered<this.highWaterMark)}shift(){const e=this.queue.shift();return this.buffered-=this.byteLength(e),this.buffered===0&&(this.stream._duplexState&=af),e}unshift(e){const t=[this.map!==null?this.map(e):e];for(;this.buffered>0;)t.push(this.shift());for(let i=0;i<t.length-1;i++){const r=t[i];this.buffered+=this.byteLength(r),this.queue.push(r)}this.push(t[t.length-1])}read(){const e=this.stream;if((e._duplexState&hs)===Ve){const t=this.shift();return this.pipeTo!==null&&this.pipeTo.write(t)===!1&&(e._duplexState&=ds),e._duplexState&xi&&e.emit("data",t),t}return this.readAhead===!1&&(e._duplexState|=rt,this.updateNextTick()),null}drain(){const e=this.stream;for(;(e._duplexState&hs)===Ve&&e._duplexState&aa;){const t=this.shift();this.pipeTo!==null&&this.pipeTo.write(t)===!1&&(e._duplexState&=ds),e._duplexState&xi&&e.emit("data",t)}}update(){const e=this.stream;e._duplexState|=Ht;do{for(this.drain();this.buffered<this.highWaterMark&&(e._duplexState&Tf)===rt;)e._duplexState|=Zh,e._read(this.afterRead),this.drain();(e._duplexState&Ef)===tf&&(e._duplexState|=er,e.emit("readable")),e._duplexState&ef||this.updateNonPrimary()}while(this.continueUpdate()===!0);e._duplexState&=uf}updateNonPrimary(){const e=this.stream;if((e._duplexState&yf)===it&&(e._duplexState=(e._duplexState|ye)&cf,e.emit("end"),(e._duplexState&pa)===ir&&(e._duplexState|=nt),this.pipeTo!==null&&this.pipeTo.end()),(e._duplexState&Le)===nt){e._duplexState&rr||(e._duplexState|=qt,e._destroy(Ea.bind(this)));return}(e._duplexState&ga)===at&&(e._duplexState=(e._duplexState|qt)&oa,e._open(Ta.bind(this)))}continueUpdate(){return this.stream._duplexState&bt?(this.stream._duplexState&=ca,!0):!1}updateCallback(){(this.stream._duplexState&Sf)===vt?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&bt||(this.stream._duplexState|=bt,this.stream._duplexState&Ht||ra(this.afterUpdateNextTick))}}class xf{constructor(e){this.data=null,this.afterTransform=Vf.bind(e),this.afterFinal=null}}class Pf{constructor(e,t,i){this.from=e,this.to=t,this.afterPipe=i,this.error=null,this.pipeToFinished=!1}finished(){this.pipeToFinished=!0}done(e,t){if(t&&(this.error=t),e===this.to&&(this.to=null,this.from!==null)){(!(this.from._duplexState&ye)||!this.pipeToFinished)&&this.from.destroy(this.error||new Error("Writable stream closed prematurely"));return}if(e===this.from&&(this.from=null,this.to!==null)){e._duplexState&ye||this.to.destroy(this.error||new Error("Readable stream closed before ending"));return}this.afterPipe!==null&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null}}function Ff(){this.stream._duplexState|=Qi,this.updateCallback()}function Lf(n){const e=this.stream;n&&e.destroy(n),e._duplexState&Le||(e._duplexState|=ct,e.emit("finish")),(e._duplexState&pa)===ir&&(e._duplexState|=nt),e._duplexState&=la,e._duplexState&Ct?this.updateNextTick():this.update()}function Ea(n){const e=this.stream;!n&&this.error!==Vn&&(n=this.error),n&&e.emit("error",n),e._duplexState|=Vt,e.emit("close");const t=e._readableState,i=e._writableState;if(t!==null&&t.pipeline!==null&&t.pipeline.done(e,n),i!==null){for(;i.drains!==null&&i.drains.length>0;)i.drains.shift().resolve(!1);i.pipeline!==null&&i.pipeline.done(e,n)}}function Mf(n){const e=this.stream;n&&e.destroy(n),e._duplexState&=la,this.drains!==null&&Kf(this.drains),(e._duplexState&Rf)===on&&(e._duplexState&=hf,(e._duplexState&Pi)===Pi&&e.emit("drain")),this.updateCallback()}function Df(n){n&&this.stream.destroy(n),this.stream._duplexState&=nf,this.readAhead===!1&&!(this.stream._duplexState&rn)&&(this.stream._duplexState&=ua),this.updateCallback()}function Uf(){this.stream._duplexState&Ht||(this.stream._duplexState&=ca,this.update())}function Bf(){this.stream._duplexState&Ct||(this.stream._duplexState&=ha,this.update())}function Kf(n){for(let e=0;e<n.length;e++)--n[e].writes===0&&(n.shift().resolve(!0),e--)}function Ta(n){const e=this.stream;n&&e.destroy(n),e._duplexState&nt||(e._duplexState&_f||(e._duplexState|=vt),e._duplexState&bf||(e._duplexState|=sn),e.emit("open")),e._duplexState&=ma,e._writableState!==null&&e._writableState.updateCallback(),e._readableState!==null&&e._readableState.updateCallback()}function Vf(n,e){e!=null&&this.push(e),this._writableState.afterWrite(n)}function Hf(n){this._readableState!==null&&(n==="data"&&(this._duplexState|=xi|tr,this._readableState.updateNextTick()),n==="readable"&&(this._duplexState|=Zi,this._readableState.updateNextTick())),this._writableState!==null&&n==="drain"&&(this._duplexState|=Pi,this._writableState.updateNextTick())}class sr extends zh{constructor(e){super(),this._duplexState=0,this._readableState=null,this._writableState=null,e&&(e.open&&(this._open=e.open),e.destroy&&(this._destroy=e.destroy),e.predestroy&&(this._predestroy=e.predestroy),e.signal&&e.signal.addEventListener("abort",Qf.bind(this))),this.on("newListener",Hf)}_open(e){e(null)}_destroy(e){e(null)}_predestroy(){}get readable(){return this._readableState!==null?!0:void 0}get writable(){return this._writableState!==null?!0:void 0}get destroyed(){return(this._duplexState&Vt)!==0}get destroying(){return(this._duplexState&Le)!==0}destroy(e){this._duplexState&Le||(e||(e=Vn),this._duplexState=(this._duplexState|nt)&pf,this._readableState!==null&&(this._readableState.highWaterMark=0,this._readableState.error=e),this._writableState!==null&&(this._writableState.highWaterMark=0,this._writableState.error=e),this._duplexState|=Xi,this._predestroy(),this._duplexState&=Qh,this._readableState!==null&&this._readableState.updateNextTick(),this._writableState!==null&&this._writableState.updateNextTick())}}class $t extends sr{constructor(e){super(e),this._duplexState|=at|ct|rt,this._readableState=new Of(this,e),e&&(this._readableState.readAhead===!1&&(this._duplexState&=ua),e.read&&(this._read=e.read),e.eagerOpen&&this._readableState.updateNextTick(),e.encoding&&this.setEncoding(e.encoding))}setEncoding(e){const t=new Xh(e),i=this._readableState.map||Gf;return this._readableState.map=r,this;function r(s){const o=t.push(s);return o===""?null:i(o)}}_read(e){e(null)}pipe(e,t){return this._readableState.updateNextTick(),this._readableState.pipe(e,t),e}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(e){return this._readableState.updateNextTick(),this._readableState.push(e)}unshift(e){return this._readableState.updateNextTick(),this._readableState.unshift(e)}resume(){return this._duplexState|=tr,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=this._readableState.readAhead===!1?lf:of,this}static _fromAsyncIterator(e,t){let i;const r=new $t({...t,read(o){e.next().then(s).then(o.bind(null,null)).catch(o)},predestroy(){i=e.return()},destroy(o){if(!i)return o(null);i.then(o.bind(null,null)).catch(o)}});return r;function s(o){o.done?r.push(null):r.push(o.value)}}static from(e,t){if(zf(e))return e;if(e[fn])return this._fromAsyncIterator(e[fn](),t);Array.isArray(e)||(e=e===void 0?[]:[e]);let i=0;return new $t({...t,read(r){this.push(i===e.length?null:e[i++]),r(null)}})}static isBackpressured(e){return(e._duplexState&wf)!==0||e._readableState.buffered>=e._readableState.highWaterMark}static isPaused(e){return(e._duplexState&rn)===0}[fn](){const e=this;let t=null,i=null,r=null;return this.on("error",h=>{t=h}),this.on("readable",s),this.on("close",o),{[fn](){return this},next(){return new Promise(function(h,u){i=h,r=u;const p=e.read();p!==null?l(p):e._duplexState&Vt&&l(null)})},return(){return f(null)},throw(h){return f(h)}};function s(){i!==null&&l(e.read())}function o(){i!==null&&l(null)}function l(h){r!==null&&(t?r(t):h===null&&!(e._duplexState&ye)?r(Vn):i({value:h,done:h===null}),r=i=null)}function f(h){return e.destroy(h),new Promise((u,p)=>{if(e._duplexState&Vt)return u({value:void 0,done:!0});e.once("close",function(){h?p(h):u({value:void 0,done:!0})})})}}}class wa extends sr{constructor(e){super(e),this._duplexState|=at|ye,this._writableState=new ya(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final),e.eagerOpen&&this._writableState.updateNextTick())}cork(){this._duplexState|=qn}uncork(){this._duplexState&=fa,this._writableState.updateNextTick()}_writev(e,t){t(null)}_write(e,t){this._writableState.autoBatch(e,t)}_final(e){e(null)}static isBackpressured(e){return(e._duplexState&Nf)!==0}static drained(e){if(e.destroyed)return Promise.resolve(!1);const t=e._writableState,r=(Zf(e)?Math.min(1,t.queue.length):t.queue.length)+(e._duplexState&nr?1:0);return r===0?Promise.resolve(!0):(t.drains===null&&(t.drains=[]),new Promise(s=>{t.drains.push({writes:r,resolve:s})}))}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}class or extends $t{constructor(e){super(e),this._duplexState=at|this._duplexState&rt,this._writableState=new ya(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final))}cork(){this._duplexState|=qn}uncork(){this._duplexState&=fa,this._writableState.updateNextTick()}_writev(e,t){t(null)}_write(e,t){this._writableState.autoBatch(e,t)}_final(e){e(null)}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}class Sa extends or{constructor(e){super(e),this._transformState=new xf(this),e&&(e.transform&&(this._transform=e.transform),e.flush&&(this._flush=e.flush))}_write(e,t){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=e:this._transform(e,this._transformState.afterTransform)}_read(e){if(this._transformState.data!==null){const t=this._transformState.data;this._transformState.data=null,e(null),this._transform(t,this._transformState.afterTransform)}else e(null)}destroy(e){super.destroy(e),this._transformState.data!==null&&(this._transformState.data=null,this._transformState.afterTransform())}_transform(e,t){t(null,e)}_flush(e){e(null)}_final(e){this._transformState.afterFinal=e,this._flush($f.bind(this))}}class qf extends Sa{}function $f(n,e){const t=this._transformState.afterFinal;if(n)return t(n);e!=null&&this.push(e),this.push(null),t(null)}function Wf(...n){return new Promise((e,t)=>ba(...n,i=>{if(i)return t(i);e()}))}function ba(n,...e){const t=Array.isArray(n)?[...n,...e]:[n,...e],i=t.length&&typeof t[t.length-1]=="function"?t.pop():null;if(t.length<2)throw new Error("Pipeline requires at least 2 streams");let r=t[0],s=null,o=null;for(let h=1;h<t.length;h++)s=t[h],Wt(r)?r.pipe(s,f):(l(r,!0,h>1,f),r.pipe(s)),r=s;if(i){let h=!1;const u=Wt(s)||!!(s._writableState&&s._writableState.autoDestroy);s.on("error",p=>{o===null&&(o=p)}),s.on("finish",()=>{h=!0,u||i(o)}),u&&s.on("close",()=>i(o||(h?null:hi)))}return s;function l(h,u,p,y){h.on("error",y),h.on("close",k);function k(){if(h._readableState&&!h._readableState.ended||p&&h._writableState&&!h._writableState.ended)return y(hi)}}function f(h){if(!(!h||o)){o=h;for(const u of t)u.destroy(h)}}}function Gf(n){return n}function ka(n){return!!n._readableState||!!n._writableState}function Wt(n){return typeof n._duplexState=="number"&&ka(n)}function Jf(n){return!!n._readableState&&n._readableState.ended}function jf(n){return!!n._writableState&&n._writableState.ended}function Yf(n,e={}){const t=n._readableState&&n._readableState.error||n._writableState&&n._writableState.error;return!e.all&&t===Vn?null:t}function zf(n){return Wt(n)&&n.readable}function Xf(n){return typeof n=="object"&&n!==null&&typeof n.byteLength=="number"}function Ra(n){return Xf(n)?n.byteLength:1024}function ms(){}function Qf(){this.destroy(new Error("Stream aborted."))}function Zf(n){return n._writev!==wa.prototype._writev&&n._writev!==or.prototype._writev}var em={pipeline:ba,pipelinePromise:Wf,isStream:ka,isStreamx:Wt,isEnded:Jf,isFinished:jf,getStreamError:Yf,Stream:sr,Writable:wa,Readable:$t,Duplex:or,Transform:Sa,PassThrough:qf};function ps(n,e){for(const t in e)Object.defineProperty(n,t,{value:e[t],enumerable:!0,configurable:!0});return n}function tm(n,e,t){if(!n||typeof n=="string")throw new TypeError("Please pass an Error to err-code");t||(t={}),typeof e=="object"&&(t=e,e=""),e&&(t.code=e);try{return ps(n,t)}catch{t.message=n.message,t.stack=n.stack;const r=function(){};return r.prototype=Object.create(Object.getPrototypeOf(n)),ps(new r,t)}}var nm=tm;const M=jo(nm);/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wrting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const gs="0123456789abcdef",Ca=[];for(let n=0;n<256;n++)Ca[n]=gs[n>>4&15]+gs[n&15];const _s=n=>{const e=n.length;let t="",i=0;for(;i<e;)t+=Ca[n[i++]];return t};var ys="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",im=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var mn=0;mn<ys.length;mn++)im[ys.charCodeAt(mn)]=mn;new TextDecoder;const rm=new TextEncoder,sm=n=>rm.encode(n),Es=typeof window<"u"?window:self,Fi=Es.crypto||Es.msCrypto||{};Fi.subtle||Fi.webkitSubtle;const Ts=n=>{const e=new Uint8Array(n);return Fi.getRandomValues(e)};/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const om=Ph("simple-peer"),fi=64*1024,am=5*1e3,cm=5*1e3,um=5*1e3;function ws(n){return n.replace(/a=ice-options:trickle\s\n/g,"")}function lm(n){console.warn(n)}class Ge extends em.Duplex{constructor(t){t=Object.assign({allowHalfOpen:!1},t);super(t);I(this,"_pc");if(this.__objectMode=!!t.objectMode,this._id=_s(Ts(4)).slice(0,7),this._debug("new peer %o",t),this.channelName=t.initiator?t.channelName||_s(Ts(20)):null,this.initiator=t.initiator||!1,this.channelConfig=t.channelConfig||Ge.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},Ge.config,t.config),this.offerOptions=t.offerOptions||{},this.answerOptions=t.answerOptions||{},this.sdpTransform=t.sdpTransform||(i=>i),this.streams=t.streams||(t.stream?[t.stream]:[]),this.trickle=t.trickle!==void 0?t.trickle:!0,this.allowHalfTrickle=t.allowHalfTrickle!==void 0?t.allowHalfTrickle:!1,this.iceCompleteTimeout=t.iceCompleteTimeout||am,this.iceRestartEnabled=t.iceRestartEnabled??(this.trickle===!0&&!t.wrtc?"onFailure":!1),this.iceRestartEnabled===!0&&(this.iceRestartEnabled="onFailure"),this.iceFailureRecoveryTimeout=t.iceFailureRecoveryTimeout??um,this._iceFailureRecoveryTimer=null,this._destroying=!1,this._connected=!1,this._connecting=!1,this._connectedOnce=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,!Oi)throw M(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceGatheringComplete=!1,this._iceGatheringCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._isRestartingIce=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new Oi(this.config)}catch(i){this.__destroy(M(i,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=i=>{this._onIceCandidate(i)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(i=>{this.__destroy(M(i,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=i=>{this._setupData(i)},this.streams&&this.streams.forEach(i=>{this.addStream(i)}),this._pc.ontrack=i=>{this._onTrack(i)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(t){if(!this._destroying){if(this.destroyed)throw M(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof t=="string")try{t=JSON.parse(t)}catch{t={}}this._debug("signal()"),t.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),t.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(t.transceiverRequest.kind,t.transceiverRequest.init)),t.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(t.candidate):this._pendingCandidates.push(t.candidate)),t.sdp&&this._pc.setRemoteDescription(new Fh(t)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(i=>{this._addIceCandidate(i)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(i=>{this.__destroy(M(i,"ERR_SET_REMOTE_DESCRIPTION"))}),!t.sdp&&!t.candidate&&!t.renegotiate&&!t.transceiverRequest&&this.__destroy(M(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(t){const i=new Lh(t);this._pc.addIceCandidate(i).catch(r=>{!i.address||i.address.endsWith(".local")?lm("Ignoring unsupported ICE candidate."):this.__destroy(M(r,"ERR_ADD_ICE_CANDIDATE"))})}send(t){if(!this._destroying){if(this.destroyed)throw M(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(t)}}addTransceiver(t,i){if(!this._destroying){if(this.destroyed)throw M(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(t,i),this._needsNegotiation()}catch(r){this.__destroy(M(r,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:t,init:i}})}}addStream(t){if(!this._destroying){if(this.destroyed)throw M(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),t.getTracks().forEach(i=>{this.addTrack(i,t)})}}addTrack(t,i){if(this._destroying)return;if(this.destroyed)throw M(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const r=this._senderMap.get(t)||new Map;let s=r.get(i);if(!s)s=this._pc.addTrack(t,i),r.set(i,s),this._senderMap.set(t,r),this._needsNegotiation();else throw s.removed?M(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):M(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(t,i,r){if(this._destroying)return;if(this.destroyed)throw M(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const s=this._senderMap.get(t),o=s?s.get(r):null;if(!o)throw M(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");i&&this._senderMap.set(i,s),o.replaceTrack!=null?o.replaceTrack(i):this.__destroy(M(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(t,i){if(this._destroying)return;if(this.destroyed)throw M(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const r=this._senderMap.get(t),s=r?r.get(i):null;if(!s)throw M(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{s.removed=!0,this._pc.removeTrack(s)}catch(o){o.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(s):this.__destroy(M(o,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(t){if(!this._destroying){if(this.destroyed)throw M(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),t.getTracks().forEach(i=>{this.removeTrack(i,t)})}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,queueMicrotask(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this._destroying){if(this.destroyed)throw M(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}restartIce(){return this.destroyed||this._destroying?!1:this.initiator?this._isRestartingIce?(this._debug("Already restarting ice, ignoring restartIce()"),!1):(this._debug("Restarting ICE"),this._iceFailureRecoveryTimer!=null&&(clearTimeout(this._iceFailureRecoveryTimer),this._iceFailureRecoveryTimer=null,this._startIceFailureRecoveryTimeout()),this._iceGatheringComplete=!1,clearTimeout(this._iceGatheringCompleteTimer),this._iceGatheringCompleteTimer=null,this._isNegotiating=!1,this._isRestartingIce=!0,this._pc.restartIce&&this._pc.restartIce(),this._needsNegotiation(),!0):(this._debug("restartIce() only works for the initiator"),!1)}_startIceFailureRecoveryTimeout(){this.destroyed||this._destroying||this._iceFailureRecoveryTimer==null&&(this._debug("started iceFailureRecovery timeout"),this._iceGatheringComplete=!1,clearTimeout(this._iceGatheringCompleteTimer),this._iceGatheringCompleteTimer=null,this._iceFailureRecoveryTimer=setTimeout(()=>{const t=this._pc.iceConnectionState,i=this._pc.iceGatheringState;this._debug("checking iceFailureRecovery timeout",t,i,this._iceGatheringComplete),!(t==="connected"||t==="completed")&&(this._debug("iceFailureRecovery timeout completed - failed"),this.__destroy(M(new Error("Ice connection recovery failed."),"ERR_ICE_CONNECTION_FAILURE")))},this.iceFailureRecoveryTimeout))}_final(t){this._readableState.ended||this.push(null),t(null)}__destroy(t){this.end(),this._destroy(()=>{},t)}_destroy(t,i){this.destroyed||this._destroying||(this._destroying=!0,this._debug("destroying (error: %s)",i&&(i.message||i)),setTimeout(()=>{if(this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,i&&this.emit("error",i),t()},0))}_setupData(t){if(!t.channel)return this.__destroy(M(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=t.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=fi),this.channelName=this._channel.label,this._channel.onmessage=r=>{this._onChannelMessage(r)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=r=>{const s=r.error instanceof Error?r.error:new Error(`Datachannel error: ${r.message} ${r.filename}:${r.lineno}:${r.colno}`);this.__destroy(M(s,"ERR_DATA_CHANNEL"))};let i=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(i&&this._onChannelClose(),i=!0):i=!1},cm)}_write(t,i){if(this.destroyed)return i(M(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(t)}catch(r){return this.__destroy(M(r,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>fi?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=i):i(null)}else this._debug("write before connect"),this._chunk=t,this._cb=i}_onFinish(){if(this.destroyed)return;const t=()=>{setTimeout(()=>this.__destroy(),1e3)};this._connected?t():this.once("connect",t)}_startIceCompleteTimeout(){this.destroyed||this._iceGatheringCompleteTimer||(this._debug("started iceComplete timeout"),this._iceGatheringCompleteTimer=setTimeout(()=>{this._iceGatheringComplete||(this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this._onIceGatheringComplete())},this.iceCompleteTimeout))}_createOffer(){if(this.destroyed)return;const t=Object.assign({},this.offerOptions);this._isRestartingIce&&(this.offerOptions.iceRestart=!0),this._pc.createOffer(t).then(i=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(i.sdp=ws(i.sdp)),i.sdp=this.sdpTransform(i.sdp);const r=()=>{if(this.destroyed)return;const l=this._pc.localDescription||i;this._debug("signal"),this.emit("signal",{type:l.type,sdp:l.sdp})},s=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceGatheringComplete?r():this.once("_iceGatheringComplete",r))},o=l=>{this.__destroy(M(l,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(i).then(s).catch(o)}).catch(i=>{this.__destroy(M(i,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(t=>{!t.mid&&t.sender.track&&!t.requested&&(t.requested=!0,this.addTransceiver(t.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(t=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(t.sdp=ws(t.sdp)),t.sdp=this.sdpTransform(t.sdp);const i=()=>{if(this.destroyed)return;const o=this._pc.localDescription||t;this._debug("signal"),this.emit("signal",{type:o.type,sdp:o.sdp}),this.initiator||this._requestMissingTransceivers()},r=()=>{this.destroyed||(this.trickle||this._iceGatheringComplete?i():this.once("_iceGatheringComplete",i))},s=o=>{this.__destroy(M(o,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(t).then(r).catch(s)}).catch(t=>{this.__destroy(M(t,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){if(!(this.destroyed||this._destroying)){if(this._debug("_onConnectionStateChange "+this._pc.connectionState),this._pc.connectionState!=="connected"&&(this._connected=!1),this._pc.connectionState==="failed")if(this.iceRestartEnabled||this._isRestartingIce)this._startIceFailureRecoveryTimeout();else return this.__destroy(M(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"));(this._pc.connectionState==="failed"&&this.iceRestartEnabled==="onFailure"||this._pc.connectionState==="disconnected"&&this.iceRestartEnabled==="onDisconnect")&&this.initiator&&!this._isRestartingIce&&this.restartIce()}}_onIceStateChange(){if(this.destroyed)return;const t=this._pc.iceConnectionState,i=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",t,i),this.emit("iceStateChange",t,i),i==="complete"&&this._onIceGatheringComplete(),(t==="connected"||t==="completed")&&(this._iceFailureRecoveryTimer!=null&&(clearTimeout(this._iceFailureRecoveryTimer),this._iceFailureRecoveryTimer=null),this._pcReady=!0,this._isRestartingIce=!1,this._maybeReady()),t==="closed"?this.__destroy(M(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED")):t==="failed"&&!this.iceRestartEnabled&&!this._isRestartingIce?this.__destroy(M(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")):t==="failed"&&(this.iceRestartEnabled||this._isRestartingIce)&&this._startIceFailureRecoveryTimeout(),(t==="failed"&&this.iceRestartEnabled==="onFailure"||t==="disconnected"&&this.iceRestartEnabled==="onDisconnect")&&this.initiator&&!this._isRestartingIce&&this.restartIce()}_onIceGatheringComplete(){this._iceGatheringComplete||(this._debug("iceGatheringComplete"),this._iceGatheringComplete=!0,this.emit("_iceGatheringComplete"),clearTimeout(this._iceGatheringCompleteTimer),this._iceGatheringCompleteTimer=null)}getStats(t){const i=r=>(Object.prototype.toString.call(r.values)==="[object Array]"&&r.values.forEach(s=>{Object.assign(r,s)}),r);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(r=>{const s=[];r.forEach(o=>{s.push(i(o))}),t(null,s)},r=>t(r)):this._pc.getStats.length>0?this._pc.getStats(r=>{if(this.destroyed)return;const s=[];r.result().forEach(o=>{const l={};o.names().forEach(f=>{l[f]=o.stat(f)}),l.id=o.id,l.type=o.type,l.timestamp=o.timestamp,s.push(i(l))}),t(null,s)},r=>t(r)):t(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const t=()=>{this.destroyed||this._destroying||this.getStats((i,r)=>{if(this.destroyed||this._destroying)return;i&&(r=[]);const s={},o={},l={};let f=!1;r.forEach(u=>{(u.type==="remotecandidate"||u.type==="remote-candidate")&&(s[u.id]=u),(u.type==="localcandidate"||u.type==="local-candidate")&&(o[u.id]=u),(u.type==="candidatepair"||u.type==="candidate-pair")&&(l[u.id]=u)});const h=u=>{f=!0;let p=o[u.localCandidateId];p&&(p.ip||p.address)?(this.localAddress=p.ip||p.address,this.localPort=Number(p.port)):p&&p.ipAddress?(this.localAddress=p.ipAddress,this.localPort=Number(p.portNumber)):typeof u.googLocalAddress=="string"&&(p=u.googLocalAddress.split(":"),this.localAddress=p[0],this.localPort=Number(p[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let y=s[u.remoteCandidateId];y&&(y.ip||y.address)?(this.remoteAddress=y.ip||y.address,this.remotePort=Number(y.port)):y&&y.ipAddress?(this.remoteAddress=y.ipAddress,this.remotePort=Number(y.portNumber)):typeof u.googRemoteAddress=="string"&&(y=u.googRemoteAddress.split(":"),this.remoteAddress=y[0],this.remotePort=Number(y[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(r.forEach(u=>{u.type==="transport"&&u.selectedCandidatePairId&&h(l[u.selectedCandidatePairId]),(u.type==="googCandidatePair"&&u.googActiveConnection==="true"||(u.type==="candidatepair"||u.type==="candidate-pair")&&u.selected)&&h(u)}),!f&&(!Object.keys(l).length||Object.keys(o).length)){setTimeout(t,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(p){return this.__destroy(M(p,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const u=this._cb;this._cb=null,u(null)}this._connectedOnce?(this._debug("reconnect"),this.emit("reconnect")):(this._connectedOnce=!0,typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect"))})};t()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>fi||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(t=>{this._pc.removeTrack(t),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(t){this.destroyed||(t.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:t.candidate.candidate,sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid}}):!t.candidate&&!this._iceGatheringComplete&&this._onIceGatheringComplete(),t.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(t){if(this.destroyed)return;let i=t.data;i instanceof ArrayBuffer?i=new Uint8Array(i):this.__objectMode===!1&&(i=sm(i)),this.push(i)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const t=this._cb;this._cb=null,t(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.__destroy())}_onTrack(t){this.destroyed||t.streams.forEach(i=>{this._debug("on track"),this.emit("track",t.track,i),this._remoteTracks.push({track:t.track,stream:i}),!this._remoteStreams.some(r=>r.id===i.id)&&(this._remoteStreams.push(i),queueMicrotask(()=>{this._debug("on stream"),this.emit("stream",i)}))})}_debug(){const t=[].slice.call(arguments);t[0]="["+this._id+"] "+t[0],om.apply(null,t)}}Ge.WEBRTC_SUPPORT=!!Oi;Ge.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};Ge.channelConfig={};class Ia{constructor(){I(this,"lastStats");I(this,"timestamp",0);I(this,"bytesSent",0);I(this,"bytesReceived",0);I(this,"selectedCandidatePairId","");this.lastStats={availableIncomingBitrate:0,availableOutgoingBitrate:0,bitrateReceive:0,bitrateSend:0,recieverStats:{},senderLayerStats:[],rtcStatsJson:"",selectedCandidatePairChanges:0,canidatePairState:"waiting",canidatePairNominated:!1,iceState:"new",dtlsState:"new",allStats:[]}}parse(e){var s;let t={...this.lastStats};if(t.senderLayerStats=[],t.recieverStats={},!e)return t.recieverStats.hung=!0,t;const i=t.allStats=Array.from(e.values?e.values():e),r=new Map;for(const o of i)if(o.type==="codec"){const{mimeType:f,sdpFmtpLine:h,id:u}=o,[p,y]=f.toLowerCase().split("/");r.set(u,{codec:y??"unknown",sdpFmtpLine:h})}for(const o of i){const l=o.type;if(l==="inbound-rtp"&&o.kind==="video"){let{frameWidth:f,frameHeight:h,framesPerSecond:u,estimatedPlayoutTimestamp:p,nackCount:y,pliCount:k,jitterBufferDelay:w,freezeCount:C,jitter:R,codecId:x}=o;y=y??0,k=k??0;const{codec:N,sdpFmtpLine:A}=r.get(x||"")||{codec:"unknown",sdpFmtpLine:""},O=Math.max(p?p-this.timestamp:0,w);t.recieverStats={...t.recieverStats,nackCount:y,pliCount:k,freezeCount:C,estimatedPlayoutDelay:O,jitterBufferDelay:w,jitter:R,frameWidth:f,frameHeight:h,framesPerSecond:Math.floor(u),videoCodec:N,videoSdpFmtpLine:A}}else if(l==="outbound-rtp"&&o.kind==="video"){let{retransmittedBytesSent:f,scalabilityMode:h,qualityLimitationResolutionChanges:u,encoderImplementation:p,powerEfficientEncoder:y,qualityLimitationReason:k,qualityLimitationDurations:w,totalPacketSendDelay:C,frameWidth:R,frameHeight:x,framesPerSecond:N,codecId:A}=o;const{codec:O,sdpFmtpLine:v}=r.get(A||"")||{codec:"unknown",sdpFmtpLine:""};(s=t.senderLayerStats)==null||s.push({qualityLimitationResolutionChanges:u,qualityLimitationReason:k,bandwidthLimitedQualityDurration:w==null?void 0:w.bandwidth,cpuLimitedQualityDurration:w==null?void 0:w.cpu,otherLimitedQualityDurration:w==null?void 0:w.other,noLimitedQualityDurration:w==null?void 0:w.none,encoderImplementation:p,powerEfficientEncoder:y,scalabilityMode:h,totalPacketSendDelay:C,retransmittedBytesSent:f,frameWidth:Math.floor(R),frameHeight:Math.floor(x),framesPerSecond:Math.floor(N),videoCodec:O,videoSdpFmtpLine:v})}else if(l==="candidate-pair"){const{availableOutgoingBitrate:f,availableIncomingBitrate:h,currentRoundTripTime:u,state:p,nominated:y}=o;if(y===!1)continue;t={...t,recieverStats:{...t.recieverStats,currentRoundTripTime:u},availableOutgoingBitrate:Math.floor(f??0),availableIncomingBitrate:Math.floor(h??0),canidatePairState:p,canidatePairNominated:y}}else if(l==="transport"){let{bytesReceived:f,bytesSent:h,selectedCandidatePairId:u,timestamp:p}=o;f=f??0,h=h??0,u=u??"",u!==this.selectedCandidatePairId&&(t.selectedCandidatePairChanges=(t.selectedCandidatePairChanges||0)+1,this.selectedCandidatePairId=u),p!=this.timestamp&&(t.bitrateReceive=Math.floor((f-this.bytesReceived)/(p-this.timestamp)*8e3),t.bitrateSend=Math.floor((h-this.bytesSent)/(p-this.timestamp)*8e3),t.recieverStats={...t.recieverStats,hung:t.bitrateReceive<=0},this.timestamp=p),this.bytesSent=h,this.bytesReceived=f}}return t.senderLayerStats=t.senderLayerStats?t.senderLayerStats.sort((o,l)=>(l.frameWidth||0)*(l.frameHeight||0)-(o.frameWidth||0)*(o.frameHeight||0)):[],this.lastStats=t,Is(t)}}class dm extends Ia{}let hm=0;class fm{constructor(e,t=[]){I(this,"lastMsgRecivedTimestamp");I(this,"connectionState",Pe(D.init));I(this,"latestRecivedDataMessage",Pe(null));I(this,"outgoingSignalingMessages",Pe(null));I(this,"remoteVideoStreams",Pe(new Map));I(this,"_p",null);I(this,"_spConfig",null);I(this,"_incomingSignalQueue",[]);I(this,"_consecutiveSignalMsgsProcessed",0);I(this,"_msgSendQueue",[]);I(this,"_reconnectAttemptCount",0);I(this,"_shouldReconnect");I(this,"_stopping",!1);I(this,"_startComplete",!1);I(this,"_initiator",!1);I(this,"_connectionId",-1);I(this,"_signalMsgSendCounter",0);I(this,"_signalMsgRecivedCounter",0);I(this,"_lastSignalMsgRecivedTimestamp",0);I(this,"_videoStatsParser",new Ia);this._spConfig=Object.assign({},e,Ge.config,{streams:t})}setStreamsEnabled(e){this.remoteVideoStreams.get().size!==0&&this.remoteVideoStreams.update(t=>(t.forEach(i=>{i&&i.getTracks().forEach(r=>r.enabled=e)}),t))}resetVideoStreamMap(){let e=this.remoteVideoStreams.get();this.remoteVideoStreams.set(new Map),e.forEach(t=>{t&&t.getTracks().forEach(i=>i.stop())})}start(e=!0,t=0,i=[]){if(this._startComplete=!1,this._p&&this.stop(),this._stopping=!1,this._shouldReconnect=e,i.length!==0&&(this._spConfig.streams=i),F("SP: starting with opts: ",this._spConfig,hm++),this._spConfig.initiator&&(this._connectionId=qa()),this._signalMsgRecivedCounter=0,this._signalMsgSendCounter=0,this._p=new Ge(this._spConfig),!this._p)return se("Failed to create SimplePeer instance!");this._p._debug=(...r)=>H("SIMPLEPEER DEBUG: "+r[0],...r.slice(1)),this._reconnectAttemptCount=t,this._initiator=this._spConfig.initiator||!1,this.connectionState.set(D.connecting),this._p.on("signal",r=>{if(this._connectionId===-1){se("SP sending signal message when connectionId is -1, this should not happen!");return}r=Object.assign({},r,{connId:this._connectionId,msgNum:this._signalMsgSendCounter}),this._signalMsgSendCounter++,H("SP: signal out",r),this.outgoingSignalingMessages.set(JSON.stringify(r))}),this._p.on("connect",()=>{U("SP: Connected!"),this._reconnectAttemptCount=0,this.connectionState.set(D.connected),this._emptySendMsgQueue()}),this._p.on("data",r=>{this.lastMsgRecivedTimestamp=Re(),this.latestRecivedDataMessage.set(r)}),this._p.on("stream",r=>{r.addEventListener,U("SP got video stream: ",r),this.remoteVideoStreams.update(s=>(s=new Map,s.set(r.id,r),s))}),this._p.on("iceStateChange",(r,s)=>{U(`SP: ICE State - connection: ${r}, gathering: ${s}`),r==="connected"||r==="completed"?this.setStreamsEnabled(!0):this.setStreamsEnabled(!1)}),this._p.on("close",()=>{this._initiator||this.resetConnectionStats(),F("SP connection closed"),this.resetVideoStreamMap(),this._shouldReconnect||this.connectionState.set(D.disconnectedOk)}),this._p.on("end",()=>{this.resetVideoStreamMap(),U("SP: connection ended")}),this._p.on("pause",()=>{U("SP: connection paused")}),this._p.on("error",r=>{se("SP: ERROR ",r),this.resetVideoStreamMap(),this._shouldReconnect=!1,this.connectionState.set(D.failed)}),setTimeout(()=>{this._startComplete=!0,this._processSignalMsgQueue()},0)}stop(){var e,t;this._stopping=!0,this._startComplete=!1,this.resetConnectionStats(),this.connectionState.set(D.disconnectedOk),this._shouldReconnect=!1,F("SP: Stop",this._connectionId,(e=this._p)==null?void 0:e.destroyed,(t=this._p)==null?void 0:t.destroying),this._p&&this._p.destroy(),this._p=null}restartIce(){this._p&&this._p.restartIce()}async restart(e,t){var i,r;H("SP Restart",this._reconnectAttemptCount,e,this._connectionId,(i=this._p)==null?void 0:i.destroyed,(r=this._p)==null?void 0:r.destroying),this._reconnectAttemptCount++,this.stop(),this._connectionId=e||-1,await Gt(500*this._reconnectAttemptCount),H("SP Restart2",this._spConfig),this.start(this._shouldReconnect,this._reconnectAttemptCount),t&&this.ingestSignalingMsg(t)}checkAliveness(){if(this._initiator&&this._shouldReconnect&&!this._stopping&&this._lastSignalMsgRecivedTimestamp!==void 0&&!(this._lastSignalMsgRecivedTimestamp-Re()<2e3)){if(!this._p)return this.restart();if(this.connectionState.get()!==D.connected&&!this._p.isIceRestartInProgress())return this.restartIce()}}resetConnectionStats(){this._signalMsgRecivedCounter=0,this._signalMsgSendCounter=0,this._consecutiveSignalMsgsProcessed=0}changeMediaStream(e){if(!(!this._p||this._stopping===!0))try{H("SP: changeMediaStream replacing track",e.getVideoTracks()[0].getSettings());const t=this._p.streams[0],i=t.getVideoTracks()[0];this._p.replaceTrack(i,e.getVideoTracks()[0],t)}catch(t){se("SP: changeMediaStream failed to replace track trying stream remove+add",t.message);for(const i of this._p.streams)this._p.removeStream(i);this._p.addStream(e)}}setCodecPreferences(e){var s,o,l;const t=((s=RTCRtpReceiver.getCapabilities("video"))==null?void 0:s.codecs)||[],i=this.sortCodecsByMimeTypes(t,e);if(U("SP: availReceiveCodecs",t,"sortedCodecs",i),!this._p)return;const r=((l=(o=this._p)==null?void 0:o._pc)==null?void 0:l.getTransceivers())||[];for(const f of r)f.setCodecPreferences(i);this._p.negotiate()}getCodecPreferences(){var t,i;if(!this._p)return;const e=((i=(t=this._p)==null?void 0:t._pc)==null?void 0:i.getTransceivers())||[];for(const r of e){const s=r.receiver.getParameters();if(s.codecs)return s.codecs.map(o=>o.mimeType)}}async getStats(){if(!this._p||!this._p._pc)return;const e=await new Promise((t,i)=>{(!this._p||!this._p._pc)&&i("No active simplePeer instance found!"),this._p.getStats((r,s)=>{r&&i(r),t(s)})});return this._videoStatsParser.parse(e)}getPlayoutDelay(){var t,i;if(!this._p)return;const e=((i=(t=this._p)==null?void 0:t._pc)==null?void 0:i.getTransceivers())||[];for(const r of e){if(!r.receiver)continue;const s=r.receiver;if(s.playoutDelayHint)return s.playoutDelayHint;if(s.jitterBufferTarget)return s.jitterBufferTarget/1e3}return 0}setPlayoutDelay(e){var i,r;if(!this._p)return;const t=((r=(i=this._p)==null?void 0:i._pc)==null?void 0:r.getTransceivers())||[];for(const s of t){if(!s.receiver)continue;const o=s.receiver;o.playoutDelayHint!==void 0?o.playoutDelayHint!==e&&(H("SP: Setting playoutDelayHint to "+e),o.playoutDelayHint=e):o.jitterBufferTarget!==void 0&&o.jitterBufferTarget!==e&&(H("SP: Setting jitterBufferTarget to "+e),o.jitterBufferTarget=e*1e3)}}sortCodecsByMimeTypes(e,t){return e.sort((i,r)=>{const s=t.indexOf(i.mimeType.toLowerCase()),o=t.indexOf(r.mimeType.toLowerCase()),l=s>=0?s:Number.MAX_VALUE,f=o>=0?o:Number.MAX_VALUE;return l-f})}ingestSignalingMsg(e){this._lastSignalMsgRecivedTimestamp=Re();try{const t=JSON.parse(e);if(t.msgNum===void 0||t.connId===void 0)return F("SP: Ignoring Invalid Signal Message (no connId or msgNum)!",t);if(t.connId>this._connectionId){if(F("SP: Found Newer connid, fastforwarding!",t.connId,this._connectionId),this._consecutiveSignalMsgsProcessed=0,this._connectionId=t.connId,this._incomingSignalQueue=[],this._spConfig&&!this._initiator)return this.restart(t.connId,e)}else if(t.connId<this._connectionId){F("SP: Ignoring Signal Message For Old connid (connId mismatch)!",t.connId,this._connectionId);return}U("SP: signal queued",t,t.msgNum,this._consecutiveSignalMsgsProcessed,t.connId,this._connectionId),this._incomingSignalQueue.push(t)}catch(t){F("SP: Failed to parse json signal message: ",e,t.message)}this._processSignalMsgQueue()}sendMessage(e){this._msgSendQueue.push(e),this._emptySendMsgQueue()}_processSignalMsgQueue(){if(!(!this._p||this._stopping===!0||this._startComplete===!1))for(;this._incomingSignalQueue.length!=0;){const e=this._incomingSignalQueue.shift();U("SP: signal in",e,e.msgNum,this._consecutiveSignalMsgsProcessed,e.connId,this._connectionId),this._p.signal(e),this._consecutiveSignalMsgsProcessed++}}_emptySendMsgQueue(){if(!this._p||!this._p.connected)return!1;for(this._msgSendQueue.length;this._msgSendQueue.length>0;){const e=this._msgSendQueue.shift();try{this._p.send(e)}catch(t){se("failed to send message over simplePeer data channel: ",t.message),this._msgSendQueue.unshift(e)}}}}class mm{constructor(e=!0){I(this,"config");I(this,"lastMsgRecivedTimestamp");I(this,"connectionState");I(this,"latestRecivedDataMessage");I(this,"participantConnectionEvents");I(this,"_rovRoomName");I(this,"_accessToken");I(this,"_reconnectAttemptCount",0);I(this,"_shouldReconnect");I(this,"_roomConn");this.config={},this._shouldReconnect=e,this.connectionState=Pe(D.init),this.latestRecivedDataMessage=Pe(null),this.participantConnectionEvents=Pe(null)}async init(e){this.config=e,this._shouldReconnect=!0,this._roomConn=new $a(e.roomConfig),this._roomConn.on(V.DCBufferStatusChanged,(t,i)=>{t?F("LK: Data channel buffer is low: ",i):H("LK: Data channel buffer is normal: ",i)}).on(V.SignalConnected,async()=>{H(`LK: Signal connection established to ${this.config.hostUrl}`)}).on(V.Connected,async()=>{U(`LK: Connected to room: ${this._roomConn.name} via ${this.config.hostUrl}`),this.connectionState.set(D.connected)}).on(V.SignalReconnecting,()=>{this.connectionState.set(D.reconnecting)}).on(V.Disconnected,t=>{let i=this._shouldReconnect&&!!this._roomConn;t===De.DUPLICATE_IDENTITY?(F("LK: disconnected from room - duplicate identity"),i=!1):t===De.CLIENT_INITIATED?(F("LK: disconnected from room - client initiated"),i=!1):t===De.PARTICIPANT_REMOVED?(F("LK: disconnected from room - participant removed"),i=!1):t===De.ROOM_DELETED?F("LK: disconnected from room - room deleted"):t===De.STATE_MISMATCH?F("LK: disconnected from room - state mismatch"):t===De.SERVER_SHUTDOWN?F("LK: disconnected from room - server shutdown"):t===De.JOIN_FAILURE?F("LK: disconnected from room - join failure"):t===De.UNKNOWN_REASON&&F("LK: disconnected from room - unknown reason"),i?this._reconnect():(this.connectionState.set(D.disconnectedOk),this.close())}).on(V.Reconnecting,()=>{H(`LK: Reconnecting to room ${this._roomConn.name} via ${this.config.hostUrl}`),this.connectionState.set(D.reconnecting)}).on(V.Reconnected,async()=>{U("LK: Successfully reconnected. server=",await this._roomConn.engine.getConnectedServerAddress()),this.connectionState.set(D.connected)}).on(V.ParticipantMetadataChanged,t=>{H("LK: Participant Metadata Changed",t)}).on(V.ParticipantConnected,async t=>{U(`LK: Participant ${t.identity} (${t.sid}) connected`,t.metadata),this.participantConnectionEvents.set({id:t.identity,joined:!0}),t.on(Wa.ConnectionQualityChanged,()=>{H("LK: ParticipantEvent.ConnectionQualityChanged",t.connectionQuality)})}).on(V.ParticipantDisconnected,t=>{H(`LK: Participant ${t.identity} (${t.sid}) disconnected`),this.participantConnectionEvents.set({id:t.identity,joined:!1})}).on(V.MediaDevicesError,t=>{const i=Rs.getFailure(t);F("LK: Media device failure",i)}).on(V.ConnectionQualityChanged,(t,i)=>{H(`LK: connection quality for ${i?i.identity:"[no identity]"} changed to ${t}`)}).on(V.RoomMetadataChanged,t=>{try{H("LK: New metadata for room",JSON.parse(t))}catch{H("LK: New metadata for room (NOT VALID JSON)",t)}}).on(V.MediaDevicesChanged,()=>{H("LK: MediaDevicesChanged")}).on(V.LocalTrackUnpublished,(t,i)=>{H("LK: LocalTrackUnpublished",t.trackSid,"by participant",i.identity,"source",t.track?t.track.source:"[no track found]")}).on(V.LocalTrackPublished,(t,i)=>{H("LK: LocalVideoTrackPublished",t.trackSid,"by participant",i.identity,"source",t.track?t.track.source:"[no track found]")}).on(V.AudioPlaybackStatusChanged,()=>{H("LK: AudioPlaybackStatusChanged. canPlaybackAudio =",this._roomConn.canPlaybackAudio)})}async start(e,t){this._rovRoomName=e,this._accessToken=t,this._shouldReconnect=!0;const i=Re();ue(`LK: Starting conn with ${e} via ${this.config.hostUrl} token = ${t}`);try{const r=setTimeout(()=>{ue(`livekit connect timeout for ${this.config.hostUrl}. Reconnecting...`),this._reconnect()},16e3);await this._connect(),clearTimeout(r),ue(`LK: Connected in ${Re()-i}ms ${this.config.hostUrl}`)}catch(r){ue(`LK: Error connecting to ${this.config.hostUrl}. Reconnecting...`,r),this._reconnect()}}async sendMessage(e,t=!0,i=[]){if(!this._roomConn)return F("LK: Can't send message, room not connected");if(e.length==0)return F("LK: Can't send empty message");try{await this._roomConn.localParticipant.publishData(e,{reliable:t,destinationIdentities:i})}catch(r){se("LK: Error sending message",r)}}getParticipantSid(e){const t=[...this._roomConn.remoteParticipants.values()].find(i=>i.identity===e);return t?t.sid:null}getLivekitIdentitiy(){return this._roomConn?this._roomConn.localParticipant.identity:null}getRoomName(){return this._roomConn?this._roomConn.name:this._rovRoomName}close(){this._shouldReconnect=!1,this.connectionState.set(D.disconnectedOk),this._roomConn&&(F("LK: Closing Livekit Connection: ",this._rovRoomName,this.config.hostUrl),this._roomConn.disconnect(!0))}async _connect(){await this._roomConn.connect(Cs(this.config.hostUrl),this._accessToken,this.config.roomConnectionConfig),U("LK: Connected to room",this._roomConn.name,this._roomConn)}async _reconnect(){this.connectionState.set(D.reconnecting);try{await this._roomConn.disconnect(!0)}catch(e){se("LK: Error disconnecting from room",e)}if(this._shouldReconnect!=!1)if(this._reconnectAttemptCount<this.config.reconnectAttempts){const e=this._reconnectAttemptCount*800;this._reconnectAttemptCount++,await Gt(e);try{await this._connect()}catch(t){throw se("LK: Error reconnecting to room",t),t}}else se("LK: Failed to reconnect after ",this._reconnectAttemptCount,"/",this.config.reconnectAttempts,"attempts"),this._fail()}_fail(){this._shouldReconnect=!1,this.connectionState.set(D.failed)}}const Ss=1e3;let mi=0;class pm{constructor(e,t,i,r,s=null){I(this,"client");I(this,"egressClient");I(this,"roomName");I(this,"tokenEncryptionPassword");I(this,"apiKey");I(this,"secretKey");this.apiKey=e,this.secretKey=t,this.roomName=r,this.tokenEncryptionPassword=s,this.client=new mh(i,e,t),this.egressClient=new Go(i,e,t)}getEgressClient(){return this.egressClient}async waitForRateLimit(){for(;Re()-mi<Ss;)H("Waiting for rate limit...",Re()-mi),await Gt(Ss);mi=Re()}async deleteLivekitRoom(){try{return await this.client.deleteRoom(this.roomName)}catch(e){F("LK Admin: Failed to delete room: "+this.roomName,e)}}async createLivekitRoom(e,t){const i=await this._generateRoomMetadata(e,t);await this.waitForRateLimit();const r=await xe(()=>this.client.createRoom({name:this.roomName,maxParticipants:8,metadata:i,syncStreams:!1,emptyTimeout:60,departureTimeout:30}));return U("LK Admin: Created room: "+this.roomName,r),r}async listLivekitRooms(){return await this.waitForRateLimit(),(await xe(()=>this.client.listRooms())).filter(t=>t.numParticipants>0)}async updateRoomMetadata(e,t){const i=await this._generateRoomMetadata(e,t);await this.waitForRateLimit();try{return await xe(()=>this.client.updateRoomMetadata(this.roomName,i))}catch(r){throw new Error("LK Admin: Failed to update metadata for room "+this.roomName+r.toString())}}async _generateRoomMetadata(e,t){let r=[],s;for(let l=0;l<3;l++){do s=Xa(za());while(e.includes(s));e.push(s);const f=await Sh(this.apiKey,this.secretKey,this.roomName,s);if(this.tokenEncryptionPassword){const h=await wh(f,this.tokenEncryptionPassword);r.push({userGivenIdentity:s,encrypted:!0,...h})}else r.push({userGivenIdentity:s,token:f,encrypted:!1})}return JSON.stringify({numParticipants:t,accessTokens:r})}}class gm extends mm{constructor(){super();I(this,"_livekitApiKey");I(this,"_livekitSecretKey");I(this,"_livekitAdmin");I(this,"camTrack");I(this,"videoStatsParser",new dm);I(this,"_videoStatsIntervalId");I(this,"_videoPublishOptions");I(this,"_videoCaptureOptions")}async init(t){await super.init(t),this._roomConn.on(V.SignalConnected,()=>{this.isVideoActive()||this.enableCamera(),this._roomConn.metadata||this.createLivekitRoom()}).on(V.Reconnecting,()=>{this._roomConn.metadata||this.createLivekitRoom()}).on(V.Connected,()=>{this.isVideoActive()||this.enableCamera(),this.updateRoomMetadata()}).on(V.Reconnected,()=>{this.isVideoActive()||this.enableCamera(),this.updateRoomMetadata()}).on(V.ParticipantConnected,()=>{this.updateRoomMetadata()}).on(V.DataReceived,(i,r)=>{if(!r)return F("LK: Ignoring received data message with no participant. This can happen when the message is sent before connection completes or if the message comes from the server: ",i);const s=r==null?void 0:r.identity;this.lastMsgRecivedTimestamp=Re(),this.latestRecivedDataMessage.set({senderId:s,msgBytes:i})}).on(V.TrackSubscribed,(i,r,s)=>{F("LK: Subscribed to track ",r.trackSid," from participant: ",s.identity," source: ",i.source," _THIS SHOULDNT HAPPEN on BACKEND_ ")}).on(V.TrackUnsubscribed,(i,r,s)=>{F("LK: Unsubscribed from track",r.trackSid," from participant: ",s.identity," _THIS SHOULDNT HAPPEN on BACKEND_ ")}).on(V.MediaDevicesError,i=>{const r=Rs.getFailure(i);se("LK: Media device failure",r),this._reconnect()})}async startRoom(t,i,r){this._rovRoomName=t,this._livekitApiKey=i,this._livekitSecretKey=r,this._livekitAdmin=this._livekitAdmin??new pm(i,r,this.config.hostUrl,t,$.ROV_CONTROL_PASSWORD),this.createLivekitRoom();const s=await Th(i,r,t);await super.start(t,s)}async enableCamera(t,i){if(!this._roomConn)throw new Error("LK: Can't enable camera, room not initialized");this._videoCaptureOptions=t||this._videoCaptureOptions||this.config.roomConfig.videoCaptureDefaults,this._videoPublishOptions=i||this._videoPublishOptions||this.config.roomConfig.publishDefaults;const r=this._roomConn.localParticipant.getTrackPublication(Ga.Source.Camera);if(t&&r&&(ue("LK: Camera track restarting with options: ",t,i,r),r)){const s=r.videoTrack;i?(await this._roomConn.localParticipant.unpublishTrack(s,!1),await s.restartTrack(this._videoCaptureOptions),await s.restartTrack(this._videoCaptureOptions),await this._roomConn.localParticipant.publishTrack(s,this._videoPublishOptions)):(await s.restartTrack(this._videoCaptureOptions),await s.restartTrack(this._videoCaptureOptions))}await this._roomConn.localParticipant.setCameraEnabled(!0,this._videoCaptureOptions,this._videoPublishOptions)}async disableCamera(){this.camTrack&&(this.camTrack.videoTrack.stop(),this.camTrack.audioTrack.stop(),this.camTrack=void 0),await this._roomConn.localParticipant.setCameraEnabled(!1)}isVideoActive(){return this._roomConn.localParticipant.isCameraEnabled}async getVideoStats(){for(const t of this._roomConn.localParticipant.videoTrackPublications.values()){if(!t||!t.videoTrack)continue;const i=await t.videoTrack.getRTCStatsReport();if(!i)continue;const r=this.videoStatsParser.parse(i);if(r)return r}}getParticipantIds(){return[...this._roomConn.remoteParticipants.values()].map(t=>t.identity)}async updateRoomMetadata(){if(!this._livekitAdmin)return F("LK: Can't update metadata tokens, livekit admin client not initialized");U("LK: Updating room metadata");const t=this.getParticipantIds().filter(i=>i!==this._rovRoomName);await this._livekitAdmin.updateRoomMetadata(t,t.length+1)}async createLivekitRoom(){if(!this._livekitAdmin)return F("LK: Can't create livekit room, livekit admin client not initialized");const t=this.getParticipantIds(),i=await this._livekitAdmin.createLivekitRoom(t,t.length+1);(!i.metadata||i.numParticipants!==t.length+1)&&await this.updateRoomMetadata()}}class _m{constructor(){I(this,"_cloudLivekitConnection",new gm);I(this,"_simplePeerConnections",new Map);I(this,"_simplePeerCameraStream",null);I(this,"simplePeerCameraOptions",Pe(Er));I(this,"_cancelGetUserMedia",null);I(this,"_videoStatsIntervalId",null);I(this,"_debugVideoElement",null);this._cloudLivekitConnection.init({hostUrl:$.LIVEKIT_CLOUD_ENDPOINT,publishVideo:!0,reconnectAttempts:300,roomConnectionConfig:Ja,roomConfig:Mt,tokenEncryptionPassword:$.ROV_CONTROL_PASSWORD}),ht(this._cloudLivekitConnection.latestRecivedDataMessage,e=>{if(!e)return;const{senderId:t,msgBytes:i}=e;let r=new Uint8Array(i);if(!r||r.length===0)return;const s=gi.fromBinary(new Uint8Array(r));ss(t,s)}),ht(this._cloudLivekitConnection.participantConnectionEvents,e=>{ue("Cloud Conn Participant Event: ",e)})}onConnectedActions(){this.sendPeriodicVideoStats(),this.initSimplepeerCameraStream()}onReconnectedActions(){this.sendPeriodicVideoStats()}onDisconnectedActions(){}initSimplepeerCameraStream(){this._cancelGetUserMedia&&this._cancelGetUserMedia();const{promise:e,cancel:t}=Tr({fn:()=>navigator.mediaDevices.getUserMedia(this.simplePeerCameraOptions.get()),exponent:1.3,maxRetries:10,initialDelay:500});return this._cancelGetUserMedia=t,e.then(i=>{H("SP: Camera Stream Initialized: ",Object.assign({},i),i,i.active),this._debugVideoElement&&(this._debugVideoElement.srcObject=i),this._simplePeerCameraStream=i,this._cancelGetUserMedia=null,this._simplePeerConnections.forEach(r=>{r.changeMediaStream(i)})}).catch(i=>{se("Error getting separate camera stream for simplePeer: ",i),this._cancelGetUserMedia=null}),this._simplePeerCameraStream}async start(e){let t=!1;const i=()=>{if(t)return;t=!0,U("Creating & Starting Livekit Room: "+e.RovName);const{promise:r}=Tr({fn:()=>this._cloudLivekitConnection.startRoom(e.RovName,e.APIKey,e.SecretKey),exponent:1.3,maxRetries:10,initialDelay:1e3});r.then(()=>{U("Livekit Room Started: "+e.RovName),t=!1}).catch(s=>{se(s),ue("Too many room startup errors: Triggering Page Reload"),window.location.reload()})};i(),ht(this._cloudLivekitConnection.connectionState,(r,s)=>{r===D.failed||r===D.init||r===D.disconnectedOk?i():r===D.connected&&s===D.init?this.onConnectedActions():r===D.connected?this.onReconnectedActions():this.onDisconnectedActions()})}sendPeriodicVideoStats(){this.sendVideoStatsUpdate(),clearInterval(this._videoStatsIntervalId),this._videoStatsIntervalId=setInterval(()=>{var e;((e=this._simplePeerCameraStream)==null?void 0:e.active)!==!0&&this._cancelGetUserMedia===null&&this.initSimplepeerCameraStream(),this.sendVideoStatsUpdate(),this.sendMessage(ae.create({body:{oneofKind:"heartbeat",heartbeat:{}}}),!0,[])},1e3)}async sendVideoStatsUpdate(){var i,r,s,o,l,f,h,u,p,y,k,w,C,R,x,N,A;const e=await this._cloudLivekitConnection.getVideoStats().catch(O=>(F("LK: Error getting RTP video stats: ",O),{allStats:[String(O)]}));this.sendMessage(ae.create({body:{oneofKind:"livekitVideoStats",livekitVideoStats:ja.create({enabled:this._cloudLivekitConnection.isVideoActive()&&((i=this._cloudLivekitConnection._roomConn)==null?void 0:i.localParticipant.videoTrackPublications.size)>0,allowBackupCodec:!!((r=this._cloudLivekitConnection._videoPublishOptions)!=null&&r.backupCodec),baseStream:{width:((o=(s=this._cloudLivekitConnection._videoCaptureOptions)==null?void 0:s.resolution)==null?void 0:o.width)??0,height:((f=(l=this._cloudLivekitConnection._videoCaptureOptions)==null?void 0:l.resolution)==null?void 0:f.height)??0,fps:((u=(h=this._cloudLivekitConnection._videoCaptureOptions)==null?void 0:h.resolution)==null?void 0:u.frameRate)??0,maxBitrate:((y=(p=this._cloudLivekitConnection._videoPublishOptions)==null?void 0:p.videoEncoding)==null?void 0:y.maxBitrate)??0},codec:((k=this._cloudLivekitConnection._videoPublishOptions)==null?void 0:k.videoCodec)||"unknown",simulcastLayers:((C=(w=this._cloudLivekitConnection._videoPublishOptions)==null?void 0:w.videoSimulcastLayers)==null?void 0:C.map(O=>{var v,q;return{width:O.width,height:O.height,maxBitrate:((v=O.encoding)==null?void 0:v.maxBitrate)??0,fps:((q=O.encoding)==null?void 0:q.maxFramerate)??0}}))||[],stats:{...e}})}}),!1,[]).catch(O=>F("LK: Error sending video stats update: ",O));const t=this.simplePeerCameraOptions.get();for(const[O,v]of this._simplePeerConnections){if(!v||v.connectionState.get()!==D.connected)continue;const q=v&&![D.disconnectedOk,D.failed].includes(v.connectionState.get()),te=await v.getStats().catch(X=>(F("SP: Error getting rtc video stats for user "+O+":",X),{}));this.sendMessage(ae.create({body:{oneofKind:"simplePeerVideoStats",simplePeerVideoStats:pr.create({enabled:q,codec:((R=te==null?void 0:te.senderLayerStats[0])==null?void 0:R.videoCodec)||"unknown",baseStream:{width:Number((x=t.video)==null?void 0:x.width),height:Number((N=t.video)==null?void 0:N.height),fps:Number((A=t.video)==null?void 0:A.frameRate),maxBitrate:0},stats:{...te}})}}),!1,[O]).catch(X=>F("SP: Error sending video stats update to user "+O+":",X))}}setLivekitVideoOptions(e,t,i){e?this._cloudLivekitConnection.enableCamera(t,i):this._cloudLivekitConnection.disableCamera()}createSimplePeer(e,t){const i=this._simplePeerConnections.get(e);if(i)return F("SP: createSimplePeer() err - Connection already exists for user: "+e),i;const r=this._simplePeerCameraStream?[this._simplePeerCameraStream]:[],s=new fm(bs,r);return this._simplePeerConnections.set(e,s),t&&s.ingestSignalingMsg(t),ht(s.latestRecivedDataMessage,o=>{!o||o.length===0||ss(e,gi.fromBinary(new Uint8Array(o)))}),ht(s.outgoingSignalingMessages,o=>{this.sendMessage(ae.create({body:{oneofKind:"simplePeerSignal",simplePeerSignal:{message:o??""}}}),!0,[e])}),ht(s.connectionState,o=>{ue("SP: Connection State Changed for "+e+":",o),(o===D.disconnectedOk||o===D.failed)&&this.sendMessage(ae.create({body:{oneofKind:"simplePeerVideoStats",simplePeerVideoStats:pr.create({enabled:!1})}}),!1,[e]).catch(l=>F("SP: Error sending sp diabled update to user "+e+":",l))}),s}setDebugVideoElement(e){this._debugVideoElement=e,e&&(e.srcObject=this._simplePeerCameraStream||null)}async setSimplePeerVideoOptions(e,t,i,r){var s;if(e){this.simplePeerCameraOptions.update(l=>{var h,u,p;const f=l!=null&&l.video?l.video:Er.video;return{...l,video:{...l.video,width:((h=i==null?void 0:i.resolution)==null?void 0:h.width)||f.width||1920,height:((u=i==null?void 0:i.resolution)==null?void 0:u.height)||f.height||1080,frameRate:((p=i==null?void 0:i.resolution)==null?void 0:p.frameRate)||f.frameRate||60}}}),this.initSimplepeerCameraStream();let o=this._simplePeerConnections.get(t);o||(o=this.createSimplePeer(t))}else this._cancelGetUserMedia&&this._cancelGetUserMedia(),(s=this._simplePeerCameraStream)==null||s.getTracks().forEach(o=>o.stop()),this._simplePeerCameraStream=null}async ingestSimplePeerSignalMsg(e,t){const i=this._simplePeerConnections.get(e);i===void 0?this.createSimplePeer(e,t):i.ingestSignalingMsg(t)}async _sendMsgRaw(e,t,i){const r=ae.toBinary(e);return this._cloudLivekitConnection.connectionState.get()===D.connected?(await this._cloudLivekitConnection.sendMessage(r,t,i),$.DEBUG_MODE&&H("LK: SENT MSG: ",e,e.body.oneofKind,i),!0):($.DEBUG_MODE&&H("LK: Message Not Sent, Livekit Not Connected"),!1)}async sendMessage(e,t,i){return e?this._sendMsgRaw(e,t,i):!1}async stop(){clearInterval(this._videoStatsIntervalId),this._cloudLivekitConnection.close();for(const e of this._simplePeerConnections.values())e.stop()}}const ne=new _m,ym="/system-information";async function Em(){return ee({method:"get",url:`${$.BLUEOS_APIS_ENDPOINT+ym}/system`,timeout:1e4}).then(n=>n.data).catch(n=>{const e=`Could not fetch blueos system info: ${n.message}`;return F(e),e})}function Tm(n){const e=[],t=n?n.map(i=>i.usage).reduce((i,r)=>i+r,0)/n.length:0;return t>90&&e.push(`Rov CPU is nearly maxed out: ${t}%`),{value:t,warnings:e}}function wm(n){const e=n==null?void 0:n.find(l=>l.mount_point==="/");function t(l){const f=l?l.available_space_B/1073741824:0,h=l?l.total_space_B/2**30:0;return[h-f,h]}const[i,r]=t(e),s=100*i/r,o=s>95?[`Disk/SD Card is almost full: ${Math.round(i*10)/10}/${Math.round(i*10)/10}GB Used`]:[];return{value:s,warnings:o}}function Sm(n){var f,h,u,p;const e=[],t=((f=n==null?void 0:n.ram)==null?void 0:f.used_kB)??0,i=((h=n==null?void 0:n.ram)==null?void 0:h.total_kB)??0,r=100*t/i,s=((u=n==null?void 0:n.swap)==null?void 0:u.used_kB)??0,o=((p=n==null?void 0:n.swap)==null?void 0:p.total_kB)??0,l=100*s/o;return r>90&&e.push(`RAM is almost full (${t} / ${i})`),l>90&&e.push(`Linux SWAP space is almost full (${s} / ${o})`),{value:r,warnings:e}}function bm(n){const e=n==null?void 0:n.find(r=>r.name==="CPU"),t=e?e.temperature:0,i=n?n.filter(r=>{const s=r.critical_temperature||1/0;return r.temperature>s}).map(r=>`Critical temperature reached in ${r.name}: ${r.temperature}C`):[];return{value:t,warnings:i}}vn.defaultLogOrigin=Ya.ROV;$.SEND_LOGS&&(vn.sendLogsAllowed=!0);window.addEventListener("load",()=>{const n=document.getElementById("show_recent_logs_btn"),e=document.getElementById("recent_logs");n&&e&&n.addEventListener("click",()=>console.warn(vn.printRecentLogs(e)))});Object.assign(window,{getLongTermStarterAccessToken:()=>{bh($.LIVEKIT_API_KEY,$.LIVEKIT_SECRET_KEY).then(n=>{console.log(n),document.write(n)}).catch(n=>{console.error(n),document.write((n.message||"")+" "+n.toString())})},getLongTermTestRoomAccessToken:()=>{kh($.LIVEKIT_API_KEY,$.LIVEKIT_SECRET_KEY).then(n=>{console.log(n),document.write(n)}).catch(n=>{console.error(n),document.write((n.message||"")+" "+n.toString())})}});ne.start({RovName:$.ROV_NAME,APIKey:$.LIVEKIT_API_KEY,SecretKey:$.LIVEKIT_SECRET_KEY,LivekitCloudURL:$.LIVEKIT_CLOUD_ENDPOINT,LivekitLocalURL:$.LIVEKIT_LOCAL_ENDPOINT}).then(()=>{document.getElementById("video_stats")});$.TWITCH_STREAM_KEY!=="None"&&Nn.init($.TWITCH_STREAM_KEY,$.ROV_NAME,$.LIVEKIT_API_KEY,$.LIVEKIT_SECRET_KEY);if($.BLUEOS_APIS_ENDPOINT){const n="("+gr.join(")|(")+")";be.start(Cs($.BLUEOS_APIS_ENDPOINT)+":6040/ws/mavlink?filter="+n,e=>{if(!e.header||!e.message)return se("Mavlink message missing header or message body",e);Ih(e);const t=ks(JSON.stringify(e)),i=ae.create({body:{oneofKind:"mavlink",mavlink:{message:t}}});gr.includes(e.message.type)&&ne.sendMessage(i,!0,[])},()=>{be.sendMessage(tc(0,8e6))}),setInterval(()=>{Em().then(e=>{const t=bm(e.temperature),i=Tm(e.cpu),r=Sm(e.memory),s=wm(e.disk),o=t.warnings.concat(i.warnings,r.warnings,s.warnings);$.DEBUG_MODE&&H("/SysInfo cpuTemp",t,"cpuUsage",i,"memUsage",r,"diskUsage",s,o);const l=ae.create({body:{oneofKind:"systemMonitor",systemMonitor:{cpuTemp:t.value,cpuUsage:i.value,memoryUsage:r.value,diskUsage:s.value,warnings:o}}});ne.sendMessage(l,!0,[])})},5e3)}else U("No BLUEOS_APIS_ENDPOINT url parameter set, skipping mavlink & system info monitoring!");document.getElementById("show_video_preview_checkbox").addEventListener("change",n=>{if(n.target.checked){const t=document.getElementById("video_preview");ne.setDebugVideoElement(t),t.style.display="block",t.play()}else{const t=document.getElementById("video_preview");t.srcObject=null,t.style.display="none"}});window.addEventListener("beforeunload",()=>{Nn.stopStream(),ne.stop(),sc.close(),be.close()});
//# sourceMappingURL=internal-D3lj3d2Z.js.map
