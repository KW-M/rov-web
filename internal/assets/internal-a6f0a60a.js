var Ua=Object.defineProperty;var Ba=(n,e,t)=>e in n?Ua(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var E=(n,e,t)=>(Ba(n,typeof e!="symbol"?e+"":e,t),t);import{l as I,M as ee,a as Ha,b as Va,c as Ka,d as vn,e as x,f as $,g as se,D as qa,h as ye,i as v,S as $a,E as Ui,r as D,L as Ze,m as Jt,j as rt,k as Bi,C as K,R as Wa,n as O,o as fe,P as ja,p as ws,T as Ja,q as Ga,s as bs,t as ks,u as za,F as Rs}from"./logging-5b632efc.js";function mt(n){return new Promise(e=>{setTimeout(()=>{e()},n)})}function Ya(n,e=0){return new Promise((t,s)=>{e!==0&&setTimeout(()=>{s()},e);const i=setInterval(()=>{n()&&(clearInterval(i),t())},100)})}function Cs(n,e=null,t=5,s=1e3,i=2){return async function(...r){let a,o=0;for(;o<t;)try{return await n.apply(e,r)}catch(l){a=l,I("err:",a),await mt(s*Math.pow(i,o)),o++}throw new Error("asyncExpBackoff() func failed after "+o+" retries. Error: "+a)}}function et(n,e){let t=!1;return n.subscribe(i=>{if(t==!1){t=!0;return}e(i)})}function Hi(n,e=!1){return n.replace("http","ws")}const As=["Ancient","Dawn","Small","Broken","Red","Cold","Wild","Divine","Empty","Patient","Holy","Long","Wispy","White","Delicate","Bold","Billowing","Blue","Crimson","Aged","Misty","Snowy","Withered","Little","Frosty","Weathered","Nameless","Fragrant","Lively","Quiet","Purple","Proud","Dry","Bitter","Dark","Icy","Twilight","Wandering","Solitary","Morning","Lingering","Still","Late","Sparkling","Restless","Winter","Silent","Floral","Young","Green","Cool","Autumn","Falling","Spring","Summer","Polished","Hidden","Damp","Muddy","Black","Old","Rough"],vs=["Pond","Snow","Glade","Hill","Voice","River","Sun","Dawn","Forest","Frog","Grass","Shadow","Dust","Water","Meadow","Moon","Thunder","Sun","Wildflower","Snowflake","Silence","Haze","Shape","Pine","Waterfall","Sound","Wood","Tree","Night","Flower","Dream","Cherry","Resonance","Firefly","Bush","Star","Darkness","Lake","Frost","Paper","Surf","Fog","Brook","Mountain","Field","Bird","Leaf","Sea","Water","Sky","Smoke","Sunset","Glitter","Dew","Butterfly","Wind","Fire","Rain","Morning","Feather","Cloud","Breeze","Violet","Wave","Droplet","Swamp","Village","Hut","Path","Book","Rain","Spell","Pig"];function Xa(n,e=0){let t=As.length>>>0,s=vs.length>>>0,i=Math.max(t,s)>>>0,r=Math.max(1,(n+1)%i)>>>0,a=Math.max(1,(e+1)%i)>>>0,o=As[(r+a)%t],l=vs[r*a%s];return o+"-"+l}ee.MAV_STATE_UNINIT+"",ee.MAV_STATE_BOOT+"",ee.MAV_STATE_CALIBRATING+"",ee.MAV_STATE_STANDBY+"",ee.MAV_STATE_ACTIVE+"",ee.MAV_STATE_CRITICAL+"",ee.MAV_STATE_EMERGENCY+"",ee.MAV_STATE_POWEROFF+"",ee.MAV_STATE_FLIGHT_TERMINATION+"";let Qa=-1;const De=(n,e=0)=>({header:{system_id:255,component_id:190,sequence:Qa++%255},message:n}),Is=n=>De({type:"COMMAND_LONG",command:{type:"MAV_CMD_COMPONENT_ARM_DISARM"},target_system:1,target_component:1,confirmation:0,param1:1,param2:0,param3:0,param4:0,param5:0,param6:0,param7:0}),Za=n=>De({type:"COMMAND_LONG",command:{type:"MAV_CMD_COMPONENT_ARM_DISARM"},target_system:1,target_component:1,confirmation:1,param1:0,param2:0,param3:0,param4:0,param5:0,param6:0,param7:0}),eo=(n=1,e=333333.34375)=>De({type:"COMMAND_LONG",command:{type:"MAV_CMD_SET_MESSAGE_INTERVAL"},target_system:1,target_component:1,confirmation:1,param1:n,param2:e,param3:0,param4:0,param5:0,param6:0,param7:0}),to=n=>(n=n||19,De({type:"COMMAND_LONG",command:{type:"MAV_CMD_DO_SET_MODE"},param1:1,param2:Number(n),param3:0,param4:0,param5:0,param6:0,param7:0,target_system:1,target_component:1,confirmation:1})),no=()=>De({type:Ha.HEARTBEAT,custom_mode:0,mavtype:{type:Va.MAV_TYPE_GCS},autopilot:{type:Ka.MAV_AUTOPILOT_INVALID},base_mode:{bits:vn.MAV_MODE_FLAG_SAFETY_ARMED|vn.MAV_MODE_FLAG_MANUAL_INPUT_ENABLED},system_status:{type:ee.MAV_STATE_ACTIVE},mavlink_version:3,confirmation:0}),so=(n,e,t,s,i)=>De({type:"MANUAL_CONTROL",x:Math.floor(n),y:Math.floor(e),z:Math.floor(t),r:Math.floor(s),buttons:i,target:1}),io=(n,e,t)=>{const s=Array(8).fill(0);return s[n]=e,De({type:"SET_ACTUATOR_CONTROL_TARGET",group_mlx:t,controls:s,time_usec:Date.now()*1e3,target_component:1,target_system:1})};class Vi{constructor(){E(this,"socket");E(this,"serverAddress");E(this,"msgReceivedFn");E(this,"onConnectedFn");E(this,"isRunning");E(this,"isConnected");E(this,"connectionTimerId");this.isConnected=!1,this.isRunning=!1,this.connectionTimerId=0,this.serverAddress=""}start(e,t){this.serverAddress=e,this.msgReceivedFn=t,this.isRunning=!0,this.connect()}stop(){this.isRunning=!1,this.socket&&this.socket.close()}connect(){x("Attempting to connect to websocket: "+this.serverAddress),this.socket=new WebSocket(this.serverAddress),this.socket.binaryType="arraybuffer";const e=setTimeout(()=>{$("WebSocket connection timed out after 10 seconds"),this.stop(),this.queueConnect()},1e4);this.socket.addEventListener("open",t=>{this.isConnected=!0,clearTimeout(e),this.onConnectedFn&&this.onConnectedFn()}),this.socket.addEventListener("close",t=>{x("WebSocket connection closed with code: ",t.code),this.isConnected=!1,this.isRunning&&this.queueConnect()}),this.socket.addEventListener("error",t=>{$("WebSocket error:",t),this.isConnected=!1,this.isRunning&&this.queueConnect()}),this.socket.addEventListener("message",t=>{if(!this.msgReceivedFn)return $("No msgReceivedFn defined for WebSocketRelay");if(typeof t.data=="string")this.msgReceivedFn(t.data);else if(t.data instanceof ArrayBuffer)this.msgReceivedFn(new Uint8Array(t.data));else throw t.data instanceof Blob?new Error("WebSocketRelay received Blob type, which is not supported!"):new Error("WebSocketRelay received unknown type")})}queueConnect(){clearTimeout(this.connectionTimerId),this.connectionTimerId=setTimeout(this.connect.bind(this),2e3)}getIsConnected(){return this.isConnected}sendMessage(e){if(this.socket){if(this.socket.readyState!=this.socket.OPEN){se("Can't send WebSocket msg: "+this.socket.readyState);return}this.socket.send(e)}}close(){this.socket&&this.socket.close()}}const Bt=new Vi;class ro{constructor(){E(this,"mavlinkWebsocket");E(this,"onMessage");this.mavlinkWebsocket=new Vi}start(e,t,s){this.onMessage=t,s&&(this.mavlinkWebsocket.onConnectedFn=s),this.mavlinkWebsocket.start(e,i=>{this.handleMessage(i)})}handleMessage(e){if(e.length===0)return;const t=e instanceof Uint8Array?qa(e):e;try{if(t.startsWith("Ok"))return;const s=JSON.parse(t);this.onMessage(s)}catch(s){$("Failed to parse recived mavlink2rest json. msg='"+t+"'",s)}}sendMessage(e){this.mavlinkWebsocket.sendMessage(JSON.stringify(e))}close(){this.mavlinkWebsocket.close()}}const te=new ro;function Ki(n,e){return function(){return n.apply(e,arguments)}}const{toString:ao}=Object.prototype,{getPrototypeOf:jn}=Object,Gt=(n=>e=>{const t=ao.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Z=n=>(n=n.toLowerCase(),e=>Gt(e)===n),zt=n=>e=>typeof e===n,{isArray:Ye}=Array,ct=zt("undefined");function oo(n){return n!==null&&!ct(n)&&n.constructor!==null&&!ct(n.constructor)&&J(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const qi=Z("ArrayBuffer");function co(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&qi(n.buffer),e}const lo=zt("string"),J=zt("function"),$i=zt("number"),Yt=n=>n!==null&&typeof n=="object",uo=n=>n===!0||n===!1,Nt=n=>{if(Gt(n)!=="object")return!1;const e=jn(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},ho=Z("Date"),fo=Z("File"),mo=Z("Blob"),po=Z("FileList"),go=n=>Yt(n)&&J(n.pipe),_o=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||J(n.append)&&((e=Gt(n))==="formdata"||e==="object"&&J(n.toString)&&n.toString()==="[object FormData]"))},yo=Z("URLSearchParams"),[To,Eo,So,wo]=["ReadableStream","Request","Response","Headers"].map(Z),bo=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function pt(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let s,i;if(typeof n!="object"&&(n=[n]),Ye(n))for(s=0,i=n.length;s<i;s++)e.call(null,n[s],s,n);else{const r=t?Object.getOwnPropertyNames(n):Object.keys(n),a=r.length;let o;for(s=0;s<a;s++)o=r[s],e.call(null,n[o],o,n)}}function Wi(n,e){e=e.toLowerCase();const t=Object.keys(n);let s=t.length,i;for(;s-- >0;)if(i=t[s],e===i.toLowerCase())return i;return null}const ve=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:ye.global)(),ji=n=>!ct(n)&&n!==ve;function In(){const{caseless:n}=ji(this)&&this||{},e={},t=(s,i)=>{const r=n&&Wi(e,i)||i;Nt(e[r])&&Nt(s)?e[r]=In(e[r],s):Nt(s)?e[r]=In({},s):Ye(s)?e[r]=s.slice():e[r]=s};for(let s=0,i=arguments.length;s<i;s++)arguments[s]&&pt(arguments[s],t);return e}const ko=(n,e,t,{allOwnKeys:s}={})=>(pt(e,(i,r)=>{t&&J(i)?n[r]=Ki(i,t):n[r]=i},{allOwnKeys:s}),n),Ro=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),Co=(n,e,t,s)=>{n.prototype=Object.create(e.prototype,s),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},Ao=(n,e,t,s)=>{let i,r,a;const o={};if(e=e||{},n==null)return e;do{for(i=Object.getOwnPropertyNames(n),r=i.length;r-- >0;)a=i[r],(!s||s(a,n,e))&&!o[a]&&(e[a]=n[a],o[a]=!0);n=t!==!1&&jn(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},vo=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const s=n.indexOf(e,t);return s!==-1&&s===t},Io=n=>{if(!n)return null;if(Ye(n))return n;let e=n.length;if(!$i(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},No=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&jn(Uint8Array)),Oo=(n,e)=>{const s=(n&&n[Symbol.iterator]).call(n);let i;for(;(i=s.next())&&!i.done;){const r=i.value;e.call(n,r[0],r[1])}},Po=(n,e)=>{let t;const s=[];for(;(t=n.exec(e))!==null;)s.push(t);return s},Lo=Z("HTMLFormElement"),Mo=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,s,i){return s.toUpperCase()+i}),Ns=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),Do=Z("RegExp"),Ji=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),s={};pt(t,(i,r)=>{let a;(a=e(i,r,n))!==!1&&(s[r]=a||i)}),Object.defineProperties(n,s)},xo=n=>{Ji(n,(e,t)=>{if(J(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const s=n[t];if(J(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Fo=(n,e)=>{const t={},s=i=>{i.forEach(r=>{t[r]=!0})};return Ye(n)?s(n):s(String(n).split(e)),t},Uo=()=>{},Bo=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e,on="abcdefghijklmnopqrstuvwxyz",Os="0123456789",Gi={DIGIT:Os,ALPHA:on,ALPHA_DIGIT:on+on.toUpperCase()+Os},Ho=(n=16,e=Gi.ALPHA_DIGIT)=>{let t="";const{length:s}=e;for(;n--;)t+=e[Math.random()*s|0];return t};function Vo(n){return!!(n&&J(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const Ko=n=>{const e=new Array(10),t=(s,i)=>{if(Yt(s)){if(e.indexOf(s)>=0)return;if(!("toJSON"in s)){e[i]=s;const r=Ye(s)?[]:{};return pt(s,(a,o)=>{const l=t(a,i+1);!ct(l)&&(r[o]=l)}),e[i]=void 0,r}}return s};return t(n,0)},qo=Z("AsyncFunction"),$o=n=>n&&(Yt(n)||J(n))&&J(n.then)&&J(n.catch),zi=((n,e)=>n?setImmediate:e?((t,s)=>(ve.addEventListener("message",({source:i,data:r})=>{i===ve&&r===t&&s.length&&s.shift()()},!1),i=>{s.push(i),ve.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",J(ve.postMessage)),Wo=typeof queueMicrotask<"u"?queueMicrotask.bind(ve):typeof ye.process<"u"&&ye.process.nextTick||zi,f={isArray:Ye,isArrayBuffer:qi,isBuffer:oo,isFormData:_o,isArrayBufferView:co,isString:lo,isNumber:$i,isBoolean:uo,isObject:Yt,isPlainObject:Nt,isReadableStream:To,isRequest:Eo,isResponse:So,isHeaders:wo,isUndefined:ct,isDate:ho,isFile:fo,isBlob:mo,isRegExp:Do,isFunction:J,isStream:go,isURLSearchParams:yo,isTypedArray:No,isFileList:po,forEach:pt,merge:In,extend:ko,trim:bo,stripBOM:Ro,inherits:Co,toFlatObject:Ao,kindOf:Gt,kindOfTest:Z,endsWith:vo,toArray:Io,forEachEntry:Oo,matchAll:Po,isHTMLForm:Lo,hasOwnProperty:Ns,hasOwnProp:Ns,reduceDescriptors:Ji,freezeMethods:xo,toObjectSet:Fo,toCamelCase:Mo,noop:Uo,toFiniteNumber:Bo,findKey:Wi,global:ve,isContextDefined:ji,ALPHABET:Gi,generateString:Ho,isSpecCompliantForm:Vo,toJSONObject:Ko,isAsyncFn:qo,isThenable:$o,setImmediate:zi,asap:Wo};function w(n,e,t,s,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),s&&(this.request=s),i&&(this.response=i,this.status=i.status?i.status:null)}f.inherits(w,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:f.toJSONObject(this.config),code:this.code,status:this.status}}});const Yi=w.prototype,Xi={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{Xi[n]={value:n}});Object.defineProperties(w,Xi);Object.defineProperty(Yi,"isAxiosError",{value:!0});w.from=(n,e,t,s,i,r)=>{const a=Object.create(Yi);return f.toFlatObject(n,a,function(l){return l!==Error.prototype},o=>o!=="isAxiosError"),w.call(a,n.message,e,t,s,i),a.cause=n,a.name=n.name,r&&Object.assign(a,r),a};const jo=null;function Nn(n){return f.isPlainObject(n)||f.isArray(n)}function Qi(n){return f.endsWith(n,"[]")?n.slice(0,-2):n}function Ps(n,e,t){return n?n.concat(e).map(function(i,r){return i=Qi(i),!t&&r?"["+i+"]":i}).join(t?".":""):e}function Jo(n){return f.isArray(n)&&!n.some(Nn)}const Go=f.toFlatObject(f,{},null,function(e){return/^is[A-Z]/.test(e)});function Xt(n,e,t){if(!f.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=f.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(T,p){return!f.isUndefined(p[T])});const s=t.metaTokens,i=t.visitor||c,r=t.dots,a=t.indexes,l=(t.Blob||typeof Blob<"u"&&Blob)&&f.isSpecCompliantForm(e);if(!f.isFunction(i))throw new TypeError("visitor must be a function");function u(m){if(m===null)return"";if(f.isDate(m))return m.toISOString();if(!l&&f.isBlob(m))throw new w("Blob is not supported. Use a Buffer instead.");return f.isArrayBuffer(m)||f.isTypedArray(m)?l&&typeof Blob=="function"?new Blob([m]):ye.Buffer.from(m):m}function c(m,T,p){let S=m;if(m&&!p&&typeof m=="object"){if(f.endsWith(T,"{}"))T=s?T:T.slice(0,-2),m=JSON.stringify(m);else if(f.isArray(m)&&Jo(m)||(f.isFileList(m)||f.endsWith(T,"[]"))&&(S=f.toArray(m)))return T=Qi(T),S.forEach(function(b,C){!(f.isUndefined(b)||b===null)&&e.append(a===!0?Ps([T],C,r):a===null?T:T+"[]",u(b))}),!1}return Nn(m)?!0:(e.append(Ps(p,T,r),u(m)),!1)}const d=[],h=Object.assign(Go,{defaultVisitor:c,convertValue:u,isVisitable:Nn});function g(m,T){if(!f.isUndefined(m)){if(d.indexOf(m)!==-1)throw Error("Circular reference detected in "+T.join("."));d.push(m),f.forEach(m,function(S,k){(!(f.isUndefined(S)||S===null)&&i.call(e,S,f.isString(k)?k.trim():k,T,h))===!0&&g(S,T?T.concat(k):[k])}),d.pop()}}if(!f.isObject(n))throw new TypeError("data must be an object");return g(n),e}function Ls(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function Jn(n,e){this._pairs=[],n&&Xt(n,this,e)}const Zi=Jn.prototype;Zi.append=function(e,t){this._pairs.push([e,t])};Zi.toString=function(e){const t=e?function(s){return e.call(this,s,Ls)}:Ls;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function zo(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function er(n,e,t){if(!e)return n;const s=t&&t.encode||zo,i=t&&t.serialize;let r;if(i?r=i(e,t):r=f.isURLSearchParams(e)?e.toString():new Jn(e,t).toString(s),r){const a=n.indexOf("#");a!==-1&&(n=n.slice(0,a)),n+=(n.indexOf("?")===-1?"?":"&")+r}return n}class Yo{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){f.forEach(this.handlers,function(s){s!==null&&e(s)})}}const Ms=Yo,tr={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Xo=typeof URLSearchParams<"u"?URLSearchParams:Jn,Qo=typeof FormData<"u"?FormData:null,Zo=typeof Blob<"u"?Blob:null,ec={isBrowser:!0,classes:{URLSearchParams:Xo,FormData:Qo,Blob:Zo},protocols:["http","https","file","blob","url","data"]},Gn=typeof window<"u"&&typeof document<"u",On=typeof navigator=="object"&&navigator||void 0,tc=Gn&&(!On||["ReactNative","NativeScript","NS"].indexOf(On.product)<0),nc=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),sc=Gn&&window.location.href||"http://localhost",ic=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Gn,hasStandardBrowserEnv:tc,hasStandardBrowserWebWorkerEnv:nc,navigator:On,origin:sc},Symbol.toStringTag,{value:"Module"})),W={...ic,...ec};function rc(n,e){return Xt(n,new W.classes.URLSearchParams,Object.assign({visitor:function(t,s,i,r){return W.isNode&&f.isBuffer(t)?(this.append(s,t.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},e))}function ac(n){return f.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function oc(n){const e={},t=Object.keys(n);let s;const i=t.length;let r;for(s=0;s<i;s++)r=t[s],e[r]=n[r];return e}function nr(n){function e(t,s,i,r){let a=t[r++];if(a==="__proto__")return!0;const o=Number.isFinite(+a),l=r>=t.length;return a=!a&&f.isArray(i)?i.length:a,l?(f.hasOwnProp(i,a)?i[a]=[i[a],s]:i[a]=s,!o):((!i[a]||!f.isObject(i[a]))&&(i[a]=[]),e(t,s,i[a],r)&&f.isArray(i[a])&&(i[a]=oc(i[a])),!o)}if(f.isFormData(n)&&f.isFunction(n.entries)){const t={};return f.forEachEntry(n,(s,i)=>{e(ac(s),i,t,0)}),t}return null}function cc(n,e,t){if(f.isString(n))try{return(e||JSON.parse)(n),f.trim(n)}catch(s){if(s.name!=="SyntaxError")throw s}return(t||JSON.stringify)(n)}const zn={transitional:tr,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",i=s.indexOf("application/json")>-1,r=f.isObject(e);if(r&&f.isHTMLForm(e)&&(e=new FormData(e)),f.isFormData(e))return i?JSON.stringify(nr(e)):e;if(f.isArrayBuffer(e)||f.isBuffer(e)||f.isStream(e)||f.isFile(e)||f.isBlob(e)||f.isReadableStream(e))return e;if(f.isArrayBufferView(e))return e.buffer;if(f.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(r){if(s.indexOf("application/x-www-form-urlencoded")>-1)return rc(e,this.formSerializer).toString();if((o=f.isFileList(e))||s.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return Xt(o?{"files[]":e}:e,l&&new l,this.formSerializer)}}return r||i?(t.setContentType("application/json",!1),cc(e)):e}],transformResponse:[function(e){const t=this.transitional||zn.transitional,s=t&&t.forcedJSONParsing,i=this.responseType==="json";if(f.isResponse(e)||f.isReadableStream(e))return e;if(e&&f.isString(e)&&(s&&!this.responseType||i)){const a=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(o){if(a)throw o.name==="SyntaxError"?w.from(o,w.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:W.classes.FormData,Blob:W.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};f.forEach(["delete","get","head","post","put","patch"],n=>{zn.headers[n]={}});const Yn=zn,lc=f.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),uc=n=>{const e={};let t,s,i;return n&&n.split(`
`).forEach(function(a){i=a.indexOf(":"),t=a.substring(0,i).trim().toLowerCase(),s=a.substring(i+1).trim(),!(!t||e[t]&&lc[t])&&(t==="set-cookie"?e[t]?e[t].push(s):e[t]=[s]:e[t]=e[t]?e[t]+", "+s:s)}),e},Ds=Symbol("internals");function tt(n){return n&&String(n).trim().toLowerCase()}function Ot(n){return n===!1||n==null?n:f.isArray(n)?n.map(Ot):String(n)}function dc(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=t.exec(n);)e[s[1]]=s[2];return e}const hc=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function cn(n,e,t,s,i){if(f.isFunction(s))return s.call(this,e,t);if(i&&(e=t),!!f.isString(e)){if(f.isString(s))return e.indexOf(s)!==-1;if(f.isRegExp(s))return s.test(e)}}function fc(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}function mc(n,e){const t=f.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(n,s+t,{value:function(i,r,a){return this[s].call(this,e,i,r,a)},configurable:!0})})}class Qt{constructor(e){e&&this.set(e)}set(e,t,s){const i=this;function r(o,l,u){const c=tt(l);if(!c)throw new Error("header name must be a non-empty string");const d=f.findKey(i,c);(!d||i[d]===void 0||u===!0||u===void 0&&i[d]!==!1)&&(i[d||l]=Ot(o))}const a=(o,l)=>f.forEach(o,(u,c)=>r(u,c,l));if(f.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(f.isString(e)&&(e=e.trim())&&!hc(e))a(uc(e),t);else if(f.isHeaders(e))for(const[o,l]of e.entries())r(l,o,s);else e!=null&&r(t,e,s);return this}get(e,t){if(e=tt(e),e){const s=f.findKey(this,e);if(s){const i=this[s];if(!t)return i;if(t===!0)return dc(i);if(f.isFunction(t))return t.call(this,i,s);if(f.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=tt(e),e){const s=f.findKey(this,e);return!!(s&&this[s]!==void 0&&(!t||cn(this,this[s],s,t)))}return!1}delete(e,t){const s=this;let i=!1;function r(a){if(a=tt(a),a){const o=f.findKey(s,a);o&&(!t||cn(s,s[o],o,t))&&(delete s[o],i=!0)}}return f.isArray(e)?e.forEach(r):r(e),i}clear(e){const t=Object.keys(this);let s=t.length,i=!1;for(;s--;){const r=t[s];(!e||cn(this,this[r],r,e,!0))&&(delete this[r],i=!0)}return i}normalize(e){const t=this,s={};return f.forEach(this,(i,r)=>{const a=f.findKey(s,r);if(a){t[a]=Ot(i),delete t[r];return}const o=e?fc(r):String(r).trim();o!==r&&delete t[r],t[o]=Ot(i),s[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return f.forEach(this,(s,i)=>{s!=null&&s!==!1&&(t[i]=e&&f.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const s=new this(e);return t.forEach(i=>s.set(i)),s}static accessor(e){const s=(this[Ds]=this[Ds]={accessors:{}}).accessors,i=this.prototype;function r(a){const o=tt(a);s[o]||(mc(i,a),s[o]=!0)}return f.isArray(e)?e.forEach(r):r(e),this}}Qt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);f.reduceDescriptors(Qt.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(s){this[t]=s}}});f.freezeMethods(Qt);const X=Qt;function ln(n,e){const t=this||Yn,s=e||t,i=X.from(s.headers);let r=s.data;return f.forEach(n,function(o){r=o.call(t,r,i.normalize(),e?e.status:void 0)}),i.normalize(),r}function sr(n){return!!(n&&n.__CANCEL__)}function Xe(n,e,t){w.call(this,n??"canceled",w.ERR_CANCELED,e,t),this.name="CanceledError"}f.inherits(Xe,w,{__CANCEL__:!0});function ir(n,e,t){const s=t.config.validateStatus;!t.status||!s||s(t.status)?n(t):e(new w("Request failed with status code "+t.status,[w.ERR_BAD_REQUEST,w.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function pc(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function gc(n,e){n=n||10;const t=new Array(n),s=new Array(n);let i=0,r=0,a;return e=e!==void 0?e:1e3,function(l){const u=Date.now(),c=s[r];a||(a=u),t[i]=l,s[i]=u;let d=r,h=0;for(;d!==i;)h+=t[d++],d=d%n;if(i=(i+1)%n,i===r&&(r=(r+1)%n),u-a<e)return;const g=c&&u-c;return g?Math.round(h*1e3/g):void 0}}function _c(n,e){let t=0,s=1e3/e,i,r;const a=(u,c=Date.now())=>{t=c,i=null,r&&(clearTimeout(r),r=null),n.apply(null,u)};return[(...u)=>{const c=Date.now(),d=c-t;d>=s?a(u,c):(i=u,r||(r=setTimeout(()=>{r=null,a(i)},s-d)))},()=>i&&a(i)]}const Ht=(n,e,t=3)=>{let s=0;const i=gc(50,250);return _c(r=>{const a=r.loaded,o=r.lengthComputable?r.total:void 0,l=a-s,u=i(l),c=a<=o;s=a;const d={loaded:a,total:o,progress:o?a/o:void 0,bytes:l,rate:u||void 0,estimated:u&&o&&c?(o-a)/u:void 0,event:r,lengthComputable:o!=null,[e?"download":"upload"]:!0};n(d)},t)},xs=(n,e)=>{const t=n!=null;return[s=>e[0]({lengthComputable:t,total:n,loaded:s}),e[1]]},Fs=n=>(...e)=>f.asap(()=>n(...e)),yc=W.hasStandardBrowserEnv?function(){const e=W.navigator&&/(msie|trident)/i.test(W.navigator.userAgent),t=document.createElement("a");let s;function i(r){let a=r;return e&&(t.setAttribute("href",a),a=t.href),t.setAttribute("href",a),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return s=i(window.location.href),function(a){const o=f.isString(a)?i(a):a;return o.protocol===s.protocol&&o.host===s.host}}():function(){return function(){return!0}}(),Tc=W.hasStandardBrowserEnv?{write(n,e,t,s,i,r){const a=[n+"="+encodeURIComponent(e)];f.isNumber(t)&&a.push("expires="+new Date(t).toGMTString()),f.isString(s)&&a.push("path="+s),f.isString(i)&&a.push("domain="+i),r===!0&&a.push("secure"),document.cookie=a.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Ec(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function Sc(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function rr(n,e){return n&&!Ec(e)?Sc(n,e):e}const Us=n=>n instanceof X?{...n}:n;function Ne(n,e){e=e||{};const t={};function s(u,c,d){return f.isPlainObject(u)&&f.isPlainObject(c)?f.merge.call({caseless:d},u,c):f.isPlainObject(c)?f.merge({},c):f.isArray(c)?c.slice():c}function i(u,c,d){if(f.isUndefined(c)){if(!f.isUndefined(u))return s(void 0,u,d)}else return s(u,c,d)}function r(u,c){if(!f.isUndefined(c))return s(void 0,c)}function a(u,c){if(f.isUndefined(c)){if(!f.isUndefined(u))return s(void 0,u)}else return s(void 0,c)}function o(u,c,d){if(d in e)return s(u,c);if(d in n)return s(void 0,u)}const l={url:r,method:r,data:r,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(u,c)=>i(Us(u),Us(c),!0)};return f.forEach(Object.keys(Object.assign({},n,e)),function(c){const d=l[c]||i,h=d(n[c],e[c],c);f.isUndefined(h)&&d!==o||(t[c]=h)}),t}const ar=n=>{const e=Ne({},n);let{data:t,withXSRFToken:s,xsrfHeaderName:i,xsrfCookieName:r,headers:a,auth:o}=e;e.headers=a=X.from(a),e.url=er(rr(e.baseURL,e.url),n.params,n.paramsSerializer),o&&a.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):"")));let l;if(f.isFormData(t)){if(W.hasStandardBrowserEnv||W.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if((l=a.getContentType())!==!1){const[u,...c]=l?l.split(";").map(d=>d.trim()).filter(Boolean):[];a.setContentType([u||"multipart/form-data",...c].join("; "))}}if(W.hasStandardBrowserEnv&&(s&&f.isFunction(s)&&(s=s(e)),s||s!==!1&&yc(e.url))){const u=i&&r&&Tc.read(r);u&&a.set(i,u)}return e},wc=typeof XMLHttpRequest<"u",bc=wc&&function(n){return new Promise(function(t,s){const i=ar(n);let r=i.data;const a=X.from(i.headers).normalize();let{responseType:o,onUploadProgress:l,onDownloadProgress:u}=i,c,d,h,g,m;function T(){g&&g(),m&&m(),i.cancelToken&&i.cancelToken.unsubscribe(c),i.signal&&i.signal.removeEventListener("abort",c)}let p=new XMLHttpRequest;p.open(i.method.toUpperCase(),i.url,!0),p.timeout=i.timeout;function S(){if(!p)return;const b=X.from("getAllResponseHeaders"in p&&p.getAllResponseHeaders()),N={data:!o||o==="text"||o==="json"?p.responseText:p.response,status:p.status,statusText:p.statusText,headers:b,config:n,request:p};ir(function(z){t(z),T()},function(z){s(z),T()},N),p=null}"onloadend"in p?p.onloadend=S:p.onreadystatechange=function(){!p||p.readyState!==4||p.status===0&&!(p.responseURL&&p.responseURL.indexOf("file:")===0)||setTimeout(S)},p.onabort=function(){p&&(s(new w("Request aborted",w.ECONNABORTED,n,p)),p=null)},p.onerror=function(){s(new w("Network Error",w.ERR_NETWORK,n,p)),p=null},p.ontimeout=function(){let C=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const N=i.transitional||tr;i.timeoutErrorMessage&&(C=i.timeoutErrorMessage),s(new w(C,N.clarifyTimeoutError?w.ETIMEDOUT:w.ECONNABORTED,n,p)),p=null},r===void 0&&a.setContentType(null),"setRequestHeader"in p&&f.forEach(a.toJSON(),function(C,N){p.setRequestHeader(N,C)}),f.isUndefined(i.withCredentials)||(p.withCredentials=!!i.withCredentials),o&&o!=="json"&&(p.responseType=i.responseType),u&&([h,m]=Ht(u,!0),p.addEventListener("progress",h)),l&&p.upload&&([d,g]=Ht(l),p.upload.addEventListener("progress",d),p.upload.addEventListener("loadend",g)),(i.cancelToken||i.signal)&&(c=b=>{p&&(s(!b||b.type?new Xe(null,n,p):b),p.abort(),p=null)},i.cancelToken&&i.cancelToken.subscribe(c),i.signal&&(i.signal.aborted?c():i.signal.addEventListener("abort",c)));const k=pc(i.url);if(k&&W.protocols.indexOf(k)===-1){s(new w("Unsupported protocol "+k+":",w.ERR_BAD_REQUEST,n));return}p.send(r||null)})},kc=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let s=new AbortController,i;const r=function(u){if(!i){i=!0,o();const c=u instanceof Error?u:this.reason;s.abort(c instanceof w?c:new Xe(c instanceof Error?c.message:c))}};let a=e&&setTimeout(()=>{a=null,r(new w(`timeout ${e} of ms exceeded`,w.ETIMEDOUT))},e);const o=()=>{n&&(a&&clearTimeout(a),a=null,n.forEach(u=>{u.unsubscribe?u.unsubscribe(r):u.removeEventListener("abort",r)}),n=null)};n.forEach(u=>u.addEventListener("abort",r));const{signal:l}=s;return l.unsubscribe=()=>f.asap(o),l}},Rc=kc,Cc=function*(n,e){let t=n.byteLength;if(!e||t<e){yield n;return}let s=0,i;for(;s<t;)i=s+e,yield n.slice(s,i),s=i},Ac=async function*(n,e){for await(const t of vc(n))yield*Cc(t,e)},vc=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:s}=await e.read();if(t)break;yield s}}finally{await e.cancel()}},Bs=(n,e,t,s)=>{const i=Ac(n,e);let r=0,a,o=l=>{a||(a=!0,s&&s(l))};return new ReadableStream({async pull(l){try{const{done:u,value:c}=await i.next();if(u){o(),l.close();return}let d=c.byteLength;if(t){let h=r+=d;t(h)}l.enqueue(new Uint8Array(c))}catch(u){throw o(u),u}},cancel(l){return o(l),i.return()}},{highWaterMark:2})},Zt=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",or=Zt&&typeof ReadableStream=="function",Ic=Zt&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),cr=(n,...e)=>{try{return!!n(...e)}catch{return!1}},Nc=or&&cr(()=>{let n=!1;const e=new Request(W.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),Hs=64*1024,Pn=or&&cr(()=>f.isReadableStream(new Response("").body)),Vt={stream:Pn&&(n=>n.body)};Zt&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Vt[e]&&(Vt[e]=f.isFunction(n[e])?t=>t[e]():(t,s)=>{throw new w(`Response type '${e}' is not supported`,w.ERR_NOT_SUPPORT,s)})})})(new Response);const Oc=async n=>{if(n==null)return 0;if(f.isBlob(n))return n.size;if(f.isSpecCompliantForm(n))return(await new Request(W.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(f.isArrayBufferView(n)||f.isArrayBuffer(n))return n.byteLength;if(f.isURLSearchParams(n)&&(n=n+""),f.isString(n))return(await Ic(n)).byteLength},Pc=async(n,e)=>{const t=f.toFiniteNumber(n.getContentLength());return t??Oc(e)},Lc=Zt&&(async n=>{let{url:e,method:t,data:s,signal:i,cancelToken:r,timeout:a,onDownloadProgress:o,onUploadProgress:l,responseType:u,headers:c,withCredentials:d="same-origin",fetchOptions:h}=ar(n);u=u?(u+"").toLowerCase():"text";let g=Rc([i,r&&r.toAbortSignal()],a),m;const T=g&&g.unsubscribe&&(()=>{g.unsubscribe()});let p;try{if(l&&Nc&&t!=="get"&&t!=="head"&&(p=await Pc(c,s))!==0){let N=new Request(e,{method:"POST",body:s,duplex:"half"}),P;if(f.isFormData(s)&&(P=N.headers.get("content-type"))&&c.setContentType(P),N.body){const[z,B]=xs(p,Ht(Fs(l)));s=Bs(N.body,Hs,z,B)}}f.isString(d)||(d=d?"include":"omit");const S="credentials"in Request.prototype;m=new Request(e,{...h,signal:g,method:t.toUpperCase(),headers:c.normalize().toJSON(),body:s,duplex:"half",credentials:S?d:void 0});let k=await fetch(m);const b=Pn&&(u==="stream"||u==="response");if(Pn&&(o||b&&T)){const N={};["status","statusText","headers"].forEach(Re=>{N[Re]=k[Re]});const P=f.toFiniteNumber(k.headers.get("content-length")),[z,B]=o&&xs(P,Ht(Fs(o),!0))||[];k=new Response(Bs(k.body,Hs,z,()=>{B&&B(),T&&T()}),N)}u=u||"text";let C=await Vt[f.findKey(Vt,u)||"text"](k,n);return!b&&T&&T(),await new Promise((N,P)=>{ir(N,P,{data:C,headers:X.from(k.headers),status:k.status,statusText:k.statusText,config:n,request:m})})}catch(S){throw T&&T(),S&&S.name==="TypeError"&&/fetch/i.test(S.message)?Object.assign(new w("Network Error",w.ERR_NETWORK,n,m),{cause:S.cause||S}):w.from(S,S&&S.code,n,m)}}),Ln={http:jo,xhr:bc,fetch:Lc};f.forEach(Ln,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const Vs=n=>`- ${n}`,Mc=n=>f.isFunction(n)||n===null||n===!1,lr={getAdapter:n=>{n=f.isArray(n)?n:[n];const{length:e}=n;let t,s;const i={};for(let r=0;r<e;r++){t=n[r];let a;if(s=t,!Mc(t)&&(s=Ln[(a=String(t)).toLowerCase()],s===void 0))throw new w(`Unknown adapter '${a}'`);if(s)break;i[a||"#"+r]=s}if(!s){const r=Object.entries(i).map(([o,l])=>`adapter ${o} `+(l===!1?"is not supported by the environment":"is not available in the build"));let a=e?r.length>1?`since :
`+r.map(Vs).join(`
`):" "+Vs(r[0]):"as no adapter specified";throw new w("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return s},adapters:Ln};function un(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Xe(null,n)}function Ks(n){return un(n),n.headers=X.from(n.headers),n.data=ln.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),lr.getAdapter(n.adapter||Yn.adapter)(n).then(function(s){return un(n),s.data=ln.call(n,n.transformResponse,s),s.headers=X.from(s.headers),s},function(s){return sr(s)||(un(n),s&&s.response&&(s.response.data=ln.call(n,n.transformResponse,s.response),s.response.headers=X.from(s.response.headers))),Promise.reject(s)})}const ur="1.7.7",Xn={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{Xn[n]=function(s){return typeof s===n||"a"+(e<1?"n ":" ")+n}});const qs={};Xn.transitional=function(e,t,s){function i(r,a){return"[Axios v"+ur+"] Transitional option '"+r+"'"+a+(s?". "+s:"")}return(r,a,o)=>{if(e===!1)throw new w(i(a," has been removed"+(t?" in "+t:"")),w.ERR_DEPRECATED);return t&&!qs[a]&&(qs[a]=!0,console.warn(i(a," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(r,a,o):!0}};function Dc(n,e,t){if(typeof n!="object")throw new w("options must be an object",w.ERR_BAD_OPTION_VALUE);const s=Object.keys(n);let i=s.length;for(;i-- >0;){const r=s[i],a=e[r];if(a){const o=n[r],l=o===void 0||a(o,r,n);if(l!==!0)throw new w("option "+r+" must be "+l,w.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new w("Unknown option "+r,w.ERR_BAD_OPTION)}}const Mn={assertOptions:Dc,validators:Xn},me=Mn.validators;class Kt{constructor(e){this.defaults=e,this.interceptors={request:new Ms,response:new Ms}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let i;Error.captureStackTrace?Error.captureStackTrace(i={}):i=new Error;const r=i.stack?i.stack.replace(/^.+\n/,""):"";try{s.stack?r&&!String(s.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+r):s.stack=r}catch{}}throw s}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Ne(this.defaults,t);const{transitional:s,paramsSerializer:i,headers:r}=t;s!==void 0&&Mn.assertOptions(s,{silentJSONParsing:me.transitional(me.boolean),forcedJSONParsing:me.transitional(me.boolean),clarifyTimeoutError:me.transitional(me.boolean)},!1),i!=null&&(f.isFunction(i)?t.paramsSerializer={serialize:i}:Mn.assertOptions(i,{encode:me.function,serialize:me.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=r&&f.merge(r.common,r[t.method]);r&&f.forEach(["delete","get","head","post","put","patch","common"],m=>{delete r[m]}),t.headers=X.concat(a,r);const o=[];let l=!0;this.interceptors.request.forEach(function(T){typeof T.runWhen=="function"&&T.runWhen(t)===!1||(l=l&&T.synchronous,o.unshift(T.fulfilled,T.rejected))});const u=[];this.interceptors.response.forEach(function(T){u.push(T.fulfilled,T.rejected)});let c,d=0,h;if(!l){const m=[Ks.bind(this),void 0];for(m.unshift.apply(m,o),m.push.apply(m,u),h=m.length,c=Promise.resolve(t);d<h;)c=c.then(m[d++],m[d++]);return c}h=o.length;let g=t;for(d=0;d<h;){const m=o[d++],T=o[d++];try{g=m(g)}catch(p){T.call(this,p);break}}try{c=Ks.call(this,g)}catch(m){return Promise.reject(m)}for(d=0,h=u.length;d<h;)c=c.then(u[d++],u[d++]);return c}getUri(e){e=Ne(this.defaults,e);const t=rr(e.baseURL,e.url);return er(t,e.params,e.paramsSerializer)}}f.forEach(["delete","get","head","options"],function(e){Kt.prototype[e]=function(t,s){return this.request(Ne(s||{},{method:e,url:t,data:(s||{}).data}))}});f.forEach(["post","put","patch"],function(e){function t(s){return function(r,a,o){return this.request(Ne(o||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:r,data:a}))}}Kt.prototype[e]=t(),Kt.prototype[e+"Form"]=t(!0)});const Pt=Kt;class Qn{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(r){t=r});const s=this;this.promise.then(i=>{if(!s._listeners)return;let r=s._listeners.length;for(;r-- >0;)s._listeners[r](i);s._listeners=null}),this.promise.then=i=>{let r;const a=new Promise(o=>{s.subscribe(o),r=o}).then(i);return a.cancel=function(){s.unsubscribe(r)},a},e(function(r,a,o){s.reason||(s.reason=new Xe(r,a,o),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=s=>{e.abort(s)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new Qn(function(i){e=i}),cancel:e}}}const xc=Qn;function Fc(n){return function(t){return n.apply(null,t)}}function Uc(n){return f.isObject(n)&&n.isAxiosError===!0}const Dn={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Dn).forEach(([n,e])=>{Dn[e]=n});const Bc=Dn;function dr(n){const e=new Pt(n),t=Ki(Pt.prototype.request,e);return f.extend(t,Pt.prototype,e,{allOwnKeys:!0}),f.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return dr(Ne(n,i))},t}const H=dr(Yn);H.Axios=Pt;H.CanceledError=Xe;H.CancelToken=xc;H.isCancel=sr;H.VERSION=ur;H.toFormData=Xt;H.AxiosError=w;H.Cancel=H.CanceledError;H.all=function(e){return Promise.all(e)};H.spread=Fc;H.isAxiosError=Uc;H.mergeConfig=Ne;H.AxiosHeaders=X;H.formToJSON=n=>nr(f.isHTMLForm(n)?new FormData(n):n);H.getAdapter=lr.getAdapter;H.HttpStatusCode=Bc;H.default=H;const hr=H,Zn=new URLSearchParams(window.location.search);function pe(n,e){const t=Zn.get(n);if(t==null||t===""){if(e===void 0)throw new Error("Missing required url query parameter (string): "+n);return v("Using default value for string url query parameter: "+n+"="+e),e}return t}function $s(n,e){const t=Zn.get(n);if(t==null||t===""){if(e===void 0)throw new Error("Missing required boolean url query parameter (boolean): "+n);return v("Using default value for bool url query parameter: "+n+"="+e),e}return t.toLowerCase()!=="false"}function Ws(n,e){const t=Zn.get(n);if(t==null||t===""){if(e===void 0)throw new Error("Missing required integer url query parameter (integer): "+n);return v("Using default value for integer url query parameter: "+n+"="+e),e}try{return parseInt(t)}catch{throw new Error(`Error parsing integer url query parameter: ${n}=${t}`)}}const L={DEBUG_MODE:$s("DEBUG_MODE",!1),SEND_LOGS:$s("SEND_LOGS",!1),ROV_NAME:pe("ROV_NAME","Default-ROV"),ROV_CONTROL_PASSWORD:pe("ROV_CONTROL_PASSWORD",""),LIVEKIT_API_KEY:pe("LIVEKIT_API_KEY"),LIVEKIT_SECRET_KEY:pe("LIVEKIT_SECRET_KEY"),TWITCH_STREAM_KEY:pe("TWITCH_STREAM_KEY","None"),PYTHON_WEBSOCKET_PORT:Ws("PYTHON_WEBSOCKET_PORT",0),AUTH_TOKEN_TIMEOUT:Ws("AUTH_TOKEN_TIMEOUT",$a),BLUEOS_APIS_ENDPOINT:pe("BLUEOS_APIS_ENDPOINT",""),LIVEKIT_CLOUD_ENDPOINT:pe("LIVEKIT_CLOUD_URL","https://rov-web.livekit.cloud"),LIVEKIT_LOCAL_ENDPOINT:pe("LIVEKIT_LOCAL_URL","http://localhost:7880")},Hc="/commander/v1.0";async function js(n){return hr({method:"post",url:`${L.BLUEOS_APIS_ENDPOINT+Hc}/shutdown`,timeout:5e3,withCredentials:!1,params:{shutdown_type:n,i_know_what_i_am_doing:!0}}).then(e=>e.data).then(e=>"Shutting Down... "+String(e)).catch(e=>{var s;if(e.code==="ECONNABORTED")return"Shutting Down... ";const t=`Could not execute shutdown: ${e.code} - ${e.message} - ${e.message??((s=e.response)==null?void 0:s.data)}.`;throw logWarn(t),new Error(t)})}function F(n,e){if(!n)throw new Error(e)}const Vc=34028234663852886e22,Kc=-34028234663852886e22,qc=4294967295,$c=2147483647,Wc=-2147483648;function Lt(n){if(typeof n!="number")throw new Error("invalid int 32: "+typeof n);if(!Number.isInteger(n)||n>$c||n<Wc)throw new Error("invalid int 32: "+n)}function xn(n){if(typeof n!="number")throw new Error("invalid uint 32: "+typeof n);if(!Number.isInteger(n)||n>qc||n<0)throw new Error("invalid uint 32: "+n)}function fr(n){if(typeof n!="number")throw new Error("invalid float 32: "+typeof n);if(Number.isFinite(n)&&(n>Vc||n<Kc))throw new Error("invalid float 32: "+n)}const mr=Symbol("@bufbuild/protobuf/enum-type");function jc(n){const e=n[mr];return F(e,"missing enum type on enum object"),e}function pr(n,e,t,s){n[mr]=gr(e,t.map(i=>({no:i.no,name:i.name,localName:n[i.no]})))}function gr(n,e,t){const s=Object.create(null),i=Object.create(null),r=[];for(const a of e){const o=_r(a);r.push(o),s[a.name]=o,i[a.no]=o}return{typeName:n,values:r,findName(a){return s[a]},findNumber(a){return i[a]}}}function Jc(n,e,t){const s={};for(const i of e){const r=_r(i);s[r.localName]=r.no,s[r.no]=r.localName}return pr(s,n,e),s}function _r(n){return"localName"in n?n:Object.assign(Object.assign({},n),{localName:n.name})}class yr{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const s=this.getType(),i=s.runtime.bin,r=i.makeReadOptions(t);return i.readMessage(this,r.readerFactory(e),e.byteLength,r),this}fromJson(e,t){const s=this.getType(),i=s.runtime.json,r=i.makeReadOptions(t);return i.readMessage(s,e,r,this),this}fromJsonString(e,t){let s;try{s=JSON.parse(e)}catch(i){throw new Error(`cannot decode ${this.getType().typeName} from JSON: ${i instanceof Error?i.message:String(i)}`)}return this.fromJson(s,t)}toBinary(e){const t=this.getType(),s=t.runtime.bin,i=s.makeWriteOptions(e),r=i.writerFactory();return s.writeMessage(this,r,i),r.finish()}toJson(e){const t=this.getType(),s=t.runtime.json,i=s.makeWriteOptions(e);return s.writeMessage(this,i)}toJsonString(e){var t;const s=this.toJson(e);return JSON.stringify(s,null,(t=e==null?void 0:e.prettySpaces)!==null&&t!==void 0?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function Gc(n,e,t,s){var i;const r=(i=s==null?void 0:s.localName)!==null&&i!==void 0?i:e.substring(e.lastIndexOf(".")+1),a={[r]:function(o){n.util.initFields(this),n.util.initPartial(o,this)}}[r];return Object.setPrototypeOf(a.prototype,new yr),Object.assign(a,{runtime:n,typeName:e,fields:n.util.newFieldList(t),fromBinary(o,l){return new a().fromBinary(o,l)},fromJson(o,l){return new a().fromJson(o,l)},fromJsonString(o,l){return new a().fromJsonString(o,l)},equals(o,l){return n.util.equals(a,o,l)}}),a}function zc(){let n=0,e=0;for(let s=0;s<28;s+=7){let i=this.buf[this.pos++];if(n|=(i&127)<<s,!(i&128))return this.assertBounds(),[n,e]}let t=this.buf[this.pos++];if(n|=(t&15)<<28,e=(t&112)>>4,!(t&128))return this.assertBounds(),[n,e];for(let s=3;s<=31;s+=7){let i=this.buf[this.pos++];if(e|=(i&127)<<s,!(i&128))return this.assertBounds(),[n,e]}throw new Error("invalid varint")}function dn(n,e,t){for(let r=0;r<28;r=r+7){const a=n>>>r,o=!(!(a>>>7)&&e==0),l=(o?a|128:a)&255;if(t.push(l),!o)return}const s=n>>>28&15|(e&7)<<4,i=!!(e>>3);if(t.push((i?s|128:s)&255),!!i){for(let r=3;r<31;r=r+7){const a=e>>>r,o=!!(a>>>7),l=(o?a|128:a)&255;if(t.push(l),!o)return}t.push(e>>>31&1)}}const Mt=4294967296;function Js(n){const e=n[0]==="-";e&&(n=n.slice(1));const t=1e6;let s=0,i=0;function r(a,o){const l=Number(n.slice(a,o));i*=t,s=s*t+l,s>=Mt&&(i=i+(s/Mt|0),s=s%Mt)}return r(-24,-18),r(-18,-12),r(-12,-6),r(-6),e?Er(s,i):es(s,i)}function Yc(n,e){let t=es(n,e);const s=t.hi&2147483648;s&&(t=Er(t.lo,t.hi));const i=Tr(t.lo,t.hi);return s?"-"+i:i}function Tr(n,e){if({lo:n,hi:e}=Xc(n,e),e<=2097151)return String(Mt*e+n);const t=n&16777215,s=(n>>>24|e<<8)&16777215,i=e>>16&65535;let r=t+s*6777216+i*6710656,a=s+i*8147497,o=i*2;const l=1e7;return r>=l&&(a+=Math.floor(r/l),r%=l),a>=l&&(o+=Math.floor(a/l),a%=l),o.toString()+Gs(a)+Gs(r)}function Xc(n,e){return{lo:n>>>0,hi:e>>>0}}function es(n,e){return{lo:n|0,hi:e|0}}function Er(n,e){return e=~e,n?n=~n+1:e+=1,es(n,e)}const Gs=n=>{const e=String(n);return"0000000".slice(e.length)+e};function zs(n,e){if(n>=0){for(;n>127;)e.push(n&127|128),n=n>>>7;e.push(n)}else{for(let t=0;t<9;t++)e.push(n&127|128),n=n>>7;e.push(1)}}function Qc(){let n=this.buf[this.pos++],e=n&127;if(!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<7,!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<14,!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<21,!(n&128))return this.assertBounds(),e;n=this.buf[this.pos++],e|=(n&15)<<28;for(let t=5;n&128&&t<10;t++)n=this.buf[this.pos++];if(n&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function Zc(){const n=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"&&(typeof ye.process!="object"||typeof ye.process.env!="object"||{}.BUF_BIGINT_DISABLE!=="1")){const i=BigInt("-9223372036854775808"),r=BigInt("9223372036854775807"),a=BigInt("0"),o=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(l){const u=typeof l=="bigint"?l:BigInt(l);if(u>r||u<i)throw new Error(`int64 invalid: ${l}`);return u},uParse(l){const u=typeof l=="bigint"?l:BigInt(l);if(u>o||u<a)throw new Error(`uint64 invalid: ${l}`);return u},enc(l){return n.setBigInt64(0,this.parse(l),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},uEnc(l){return n.setBigInt64(0,this.uParse(l),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},dec(l,u){return n.setInt32(0,l,!0),n.setInt32(4,u,!0),n.getBigInt64(0,!0)},uDec(l,u){return n.setInt32(0,l,!0),n.setInt32(4,u,!0),n.getBigUint64(0,!0)}}}const t=i=>F(/^-?[0-9]+$/.test(i),`int64 invalid: ${i}`),s=i=>F(/^[0-9]+$/.test(i),`uint64 invalid: ${i}`);return{zero:"0",supported:!1,parse(i){return typeof i!="string"&&(i=i.toString()),t(i),i},uParse(i){return typeof i!="string"&&(i=i.toString()),s(i),i},enc(i){return typeof i!="string"&&(i=i.toString()),t(i),Js(i)},uEnc(i){return typeof i!="string"&&(i=i.toString()),s(i),Js(i)},dec(i,r){return Yc(i,r)},uDec(i,r){return Tr(i,r)}}}const j=Zc();var _;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(_||(_={}));var Te;(function(n){n[n.BIGINT=0]="BIGINT",n[n.STRING=1]="STRING"})(Te||(Te={}));function ge(n,e,t){if(e===t)return!0;if(n==_.BYTES){if(!(e instanceof Uint8Array)||!(t instanceof Uint8Array)||e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}switch(n){case _.UINT64:case _.FIXED64:case _.INT64:case _.SFIXED64:case _.SINT64:return e==t}return!1}function Je(n,e){switch(n){case _.BOOL:return!1;case _.UINT64:case _.FIXED64:case _.INT64:case _.SFIXED64:case _.SINT64:return e==0?j.zero:"0";case _.DOUBLE:case _.FLOAT:return 0;case _.BYTES:return new Uint8Array(0);case _.STRING:return"";default:return 0}}function Sr(n,e){switch(n){case _.BOOL:return e===!1;case _.STRING:return e==="";case _.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var U;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32"})(U||(U={}));class el{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let i=0;i<this.chunks.length;i++)e+=this.chunks[i].length;let t=new Uint8Array(e),s=0;for(let i=0;i<this.chunks.length;i++)t.set(this.chunks[i],s),s+=this.chunks[i].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(xn(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Lt(e),zs(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){fr(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){xn(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){Lt(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return Lt(e),e=(e<<1^e>>31)>>>0,zs(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),s=new DataView(t.buffer),i=j.enc(e);return s.setInt32(0,i.lo,!0),s.setInt32(4,i.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),s=new DataView(t.buffer),i=j.uEnc(e);return s.setInt32(0,i.lo,!0),s.setInt32(4,i.hi,!0),this.raw(t)}int64(e){let t=j.enc(e);return dn(t.lo,t.hi,this.buf),this}sint64(e){let t=j.enc(e),s=t.hi>>31,i=t.lo<<1^s,r=(t.hi<<1|t.lo>>>31)^s;return dn(i,r,this.buf),this}uint64(e){let t=j.uEnc(e);return dn(t.lo,t.hi,this.buf),this}}class tl{constructor(e,t){this.varint64=zc,this.uint32=Qc,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t??new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,s=e&7;if(t<=0||s<0||s>5)throw new Error("illegal tag: field no "+t+" wire type "+s);return[t,s]}skip(e,t){let s=this.pos;switch(e){case U.Varint:for(;this.buf[this.pos++]&128;);break;case U.Bit64:this.pos+=4;case U.Bit32:this.pos+=4;break;case U.LengthDelimited:let i=this.uint32();this.pos+=i;break;case U.StartGroup:for(;;){const[r,a]=this.tag();if(a===U.EndGroup){if(t!==void 0&&r!==t)throw new Error("invalid end group tag");break}this.skip(a,r)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(s,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return j.dec(...this.varint64())}uint64(){return j.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),s=-(e&1);return e=(e>>>1|(t&1)<<31)^s,t=t>>>1^s,j.dec(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return j.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return j.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function nl(n,e,t,s){let i;return{typeName:e,extendee:t,get field(){if(!i){const r=typeof s=="function"?s():s;r.name=e.split(".").pop(),r.jsonName=`[${e}]`,i=n.util.newFieldList([r]).list()[0]}return i},runtime:n}}function wr(n){const e=n.field.localName,t=Object.create(null);return t[e]=sl(n),[t,()=>t[e]]}function sl(n){const e=n.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Je(e.T,e.L);case"message":const t=e.T,s=new t;return t.fieldWrapper?t.fieldWrapper.unwrapField(s):s;case"map":throw"map fields are not allowed to be extensions"}}function il(n,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let t=n.length-1;t>=0;--t)if(n[t].no==e.no)return[n[t]];return[]}return n.filter(t=>t.no===e.no)}let ce="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),en=[];for(let n=0;n<ce.length;n++)en[ce[n].charCodeAt(0)]=n;en["-".charCodeAt(0)]=ce.indexOf("+");en["_".charCodeAt(0)]=ce.indexOf("/");const br={dec(n){let e=n.length*3/4;n[n.length-2]=="="?e-=2:n[n.length-1]=="="&&(e-=1);let t=new Uint8Array(e),s=0,i=0,r,a=0;for(let o=0;o<n.length;o++){if(r=en[n.charCodeAt(o)],r===void 0)switch(n[o]){case"=":i=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(i){case 0:a=r,i=1;break;case 1:t[s++]=a<<2|(r&48)>>4,a=r,i=2;break;case 2:t[s++]=(a&15)<<4|(r&60)>>2,a=r,i=3;break;case 3:t[s++]=(a&3)<<6|r,i=0;break}}if(i==1)throw Error("invalid base64 string.");return t.subarray(0,s)},enc(n){let e="",t=0,s,i=0;for(let r=0;r<n.length;r++)switch(s=n[r],t){case 0:e+=ce[s>>2],i=(s&3)<<4,t=1;break;case 1:e+=ce[i|s>>4],i=(s&15)<<2,t=2;break;case 2:e+=ce[i|s>>6],e+=ce[s&63],t=0;break}return t&&(e+=ce[i],e+="=",t==1&&(e+="=")),e}};function rl(n,e,t){Rr(e,n);const s=e.runtime.bin.makeReadOptions(t),i=il(n.getType().runtime.bin.listUnknownFields(n),e.field),[r,a]=wr(e);for(const o of i)e.runtime.bin.readField(r,s.readerFactory(o.data),e.field,o.wireType,s);return a()}function al(n,e,t,s){Rr(e,n);const i=e.runtime.bin.makeReadOptions(s),r=e.runtime.bin.makeWriteOptions(s);if(kr(n,e)){const u=n.getType().runtime.bin.listUnknownFields(n).filter(c=>c.no!=e.field.no);n.getType().runtime.bin.discardUnknownFields(n);for(const c of u)n.getType().runtime.bin.onUnknownField(n,c.no,c.wireType,c.data)}const a=r.writerFactory();let o=e.field;!o.opt&&!o.repeated&&(o.kind=="enum"||o.kind=="scalar")&&(o=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(o,t,a,r);const l=i.readerFactory(a.finish());for(;l.pos<l.len;){const[u,c]=l.tag(),d=l.skip(c,u);n.getType().runtime.bin.onUnknownField(n,u,c,d)}}function kr(n,e){const t=n.getType();return e.extendee.typeName===t.typeName&&!!t.runtime.bin.listUnknownFields(n).find(s=>s.no==e.field.no)}function Rr(n,e){F(n.extendee.typeName==e.getType().typeName,`extension ${n.typeName} can only be applied to message ${n.extendee.typeName}`)}function Cr(n,e){const t=n.localName;if(n.repeated)return e[t].length>0;if(n.oneof)return e[n.oneof.localName].case===t;switch(n.kind){case"enum":case"scalar":return n.opt||n.req?e[t]!==void 0:n.kind=="enum"?e[t]!==n.T.values[0].no:!Sr(n.T,e[t]);case"message":return e[t]!==void 0;case"map":return Object.keys(e[t]).length>0}}function Ys(n,e){const t=n.localName,s=!n.opt&&!n.req;if(n.repeated)e[t]=[];else if(n.oneof)e[n.oneof.localName]={case:void 0};else switch(n.kind){case"map":e[t]={};break;case"enum":e[t]=s?n.T.values[0].no:void 0;break;case"scalar":e[t]=s?Je(n.T,n.L):void 0;break;case"message":e[t]=void 0;break}}function Ie(n,e){if(n===null||typeof n!="object"||!Object.getOwnPropertyNames(yr.prototype).every(s=>s in n&&typeof n[s]=="function"))return!1;const t=n.getType();return t===null||typeof t!="function"||!("typeName"in t)||typeof t.typeName!="string"?!1:e===void 0?!0:t.typeName==e.typeName}function Ar(n,e){return Ie(e)||!n.fieldWrapper?e:n.fieldWrapper.wrapField(e)}_.DOUBLE,_.FLOAT,_.INT64,_.UINT64,_.INT32,_.UINT32,_.BOOL,_.STRING,_.BYTES;const Xs={ignoreUnknownFields:!1},Qs={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function ol(n){return n?Object.assign(Object.assign({},Xs),n):Xs}function cl(n){return n?Object.assign(Object.assign({},Qs),n):Qs}const qt=Symbol(),Dt=Symbol();function ll(){return{makeReadOptions:ol,makeWriteOptions:cl,readMessage(n,e,t,s){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error(`cannot decode message ${n.typeName} from JSON: ${ne(e)}`);s=s??new n;const i=new Map,r=t.typeRegistry;for(const[a,o]of Object.entries(e)){const l=n.fields.findJsonName(a);if(l){if(l.oneof){if(o===null&&l.kind=="scalar")continue;const u=i.get(l.oneof);if(u!==void 0)throw new Error(`cannot decode message ${n.typeName} from JSON: multiple keys for oneof "${l.oneof.name}" present: "${u}", "${a}"`);i.set(l.oneof,a)}Zs(s,o,l,t,n)}else{let u=!1;if(r!=null&&r.findExtension&&a.startsWith("[")&&a.endsWith("]")){const c=r.findExtension(a.substring(1,a.length-1));if(c&&c.extendee.typeName==n.typeName){u=!0;const[d,h]=wr(c);Zs(d,o,c.field,t,c),al(s,c,h(),t)}}if(!u&&!t.ignoreUnknownFields)throw new Error(`cannot decode message ${n.typeName} from JSON: key "${a}" is unknown`)}}return s},writeMessage(n,e){const t=n.getType(),s={};let i;try{for(i of t.fields.byNumber()){if(!Cr(i,n)){if(i.req)throw"required field not set";if(!e.emitDefaultValues||!dl(i))continue}const a=i.oneof?n[i.oneof.localName].value:n[i.localName],o=ei(i,a,e);o!==void 0&&(s[e.useProtoFieldName?i.name:i.jsonName]=o)}const r=e.typeRegistry;if(r!=null&&r.findExtensionFor)for(const a of t.runtime.bin.listUnknownFields(n)){const o=r.findExtensionFor(t.typeName,a.no);if(o&&kr(n,o)){const l=rl(n,o,e),u=ei(o.field,l,e);u!==void 0&&(s[o.field.jsonName]=u)}}}catch(r){const a=i?`cannot encode field ${t.typeName}.${i.name} to JSON`:`cannot encode message ${t.typeName} to JSON`,o=r instanceof Error?r.message:String(r);throw new Error(a+(o.length>0?`: ${o}`:""))}return s},readScalar(n,e,t){return at(n,e,t??Te.BIGINT,!0)},writeScalar(n,e,t){if(e!==void 0&&(t||Sr(n,e)))return xt(n,e)},debug:ne}}function ne(n){if(n===null)return"null";switch(typeof n){case"object":return Array.isArray(n)?"array":"object";case"string":return n.length>100?"string":`"${n.split('"').join('\\"')}"`;default:return String(n)}}function Zs(n,e,t,s,i){let r=t.localName;if(t.repeated){if(F(t.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error(`cannot decode field ${i.typeName}.${t.name} from JSON: ${ne(e)}`);const a=n[r];for(const o of e){if(o===null)throw new Error(`cannot decode field ${i.typeName}.${t.name} from JSON: ${ne(o)}`);switch(t.kind){case"message":a.push(t.T.fromJson(o,s));break;case"enum":const l=hn(t.T,o,s.ignoreUnknownFields,!0);l!==Dt&&a.push(l);break;case"scalar":try{a.push(at(t.T,o,t.L,!0))}catch(u){let c=`cannot decode field ${i.typeName}.${t.name} from JSON: ${ne(o)}`;throw u instanceof Error&&u.message.length>0&&(c+=`: ${u.message}`),new Error(c)}break}}}else if(t.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error(`cannot decode field ${i.typeName}.${t.name} from JSON: ${ne(e)}`);const a=n[r];for(const[o,l]of Object.entries(e)){if(l===null)throw new Error(`cannot decode field ${i.typeName}.${t.name} from JSON: map value null`);let u;try{u=ul(t.K,o)}catch(c){let d=`cannot decode map key for field ${i.typeName}.${t.name} from JSON: ${ne(e)}`;throw c instanceof Error&&c.message.length>0&&(d+=`: ${c.message}`),new Error(d)}switch(t.V.kind){case"message":a[u]=t.V.T.fromJson(l,s);break;case"enum":const c=hn(t.V.T,l,s.ignoreUnknownFields,!0);c!==Dt&&(a[u]=c);break;case"scalar":try{a[u]=at(t.V.T,l,Te.BIGINT,!0)}catch(d){let h=`cannot decode map value for field ${i.typeName}.${t.name} from JSON: ${ne(e)}`;throw d instanceof Error&&d.message.length>0&&(h+=`: ${d.message}`),new Error(h)}break}}}else switch(t.oneof&&(n=n[t.oneof.localName]={case:r},r="value"),t.kind){case"message":const a=t.T;if(e===null&&a.typeName!="google.protobuf.Value")return;let o=n[r];Ie(o)?o.fromJson(e,s):(n[r]=o=a.fromJson(e,s),a.fieldWrapper&&!t.oneof&&(n[r]=a.fieldWrapper.unwrapField(o)));break;case"enum":const l=hn(t.T,e,s.ignoreUnknownFields,!1);switch(l){case qt:Ys(t,n);break;case Dt:break;default:n[r]=l;break}break;case"scalar":try{const u=at(t.T,e,t.L,!1);switch(u){case qt:Ys(t,n);break;default:n[r]=u;break}}catch(u){let c=`cannot decode field ${i.typeName}.${t.name} from JSON: ${ne(e)}`;throw u instanceof Error&&u.message.length>0&&(c+=`: ${u.message}`),new Error(c)}break}}function ul(n,e){if(n===_.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return at(n,e,Te.BIGINT,!0).toString()}function at(n,e,t,s){if(e===null)return s?Je(n,t):qt;switch(n){case _.DOUBLE:case _.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const i=Number(e);if(Number.isNaN(i)||!Number.isFinite(i))break;return n==_.FLOAT&&fr(i),i;case _.INT32:case _.FIXED32:case _.SFIXED32:case _.SINT32:case _.UINT32:let r;if(typeof e=="number"?r=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(r=Number(e)),r===void 0)break;return n==_.UINT32||n==_.FIXED32?xn(r):Lt(r),r;case _.INT64:case _.SFIXED64:case _.SINT64:if(typeof e!="number"&&typeof e!="string")break;const a=j.parse(e);return t?a.toString():a;case _.FIXED64:case _.UINT64:if(typeof e!="number"&&typeof e!="string")break;const o=j.uParse(e);return t?o.toString():o;case _.BOOL:if(typeof e!="boolean")break;return e;case _.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case _.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return br.dec(e)}throw new Error}function hn(n,e,t,s){if(e===null)return n.typeName=="google.protobuf.NullValue"?0:s?n.values[0].no:qt;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const i=n.findName(e);if(i!==void 0)return i.no;if(t)return Dt;break}throw new Error(`cannot decode enum ${n.typeName} from JSON: ${ne(e)}`)}function dl(n){return n.repeated||n.kind=="map"?!0:!(n.oneof||n.kind=="message"||n.opt||n.req)}function ei(n,e,t){if(n.kind=="map"){F(typeof e=="object"&&e!=null);const s={},i=Object.entries(e);switch(n.V.kind){case"scalar":for(const[a,o]of i)s[a.toString()]=xt(n.V.T,o);break;case"message":for(const[a,o]of i)s[a.toString()]=o.toJson(t);break;case"enum":const r=n.V.T;for(const[a,o]of i)s[a.toString()]=fn(r,o,t.enumAsInteger);break}return t.emitDefaultValues||i.length>0?s:void 0}if(n.repeated){F(Array.isArray(e));const s=[];switch(n.kind){case"scalar":for(let i=0;i<e.length;i++)s.push(xt(n.T,e[i]));break;case"enum":for(let i=0;i<e.length;i++)s.push(fn(n.T,e[i],t.enumAsInteger));break;case"message":for(let i=0;i<e.length;i++)s.push(e[i].toJson(t));break}return t.emitDefaultValues||s.length>0?s:void 0}switch(n.kind){case"scalar":return xt(n.T,e);case"enum":return fn(n.T,e,t.enumAsInteger);case"message":return Ar(n.T,e).toJson(t)}}function fn(n,e,t){var s;if(F(typeof e=="number"),n.typeName=="google.protobuf.NullValue")return null;if(t)return e;const i=n.findNumber(e);return(s=i==null?void 0:i.name)!==null&&s!==void 0?s:e}function xt(n,e){switch(n){case _.INT32:case _.SFIXED32:case _.SINT32:case _.FIXED32:case _.UINT32:return F(typeof e=="number"),e;case _.FLOAT:case _.DOUBLE:return F(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case _.STRING:return F(typeof e=="string"),e;case _.BOOL:return F(typeof e=="boolean"),e;case _.UINT64:case _.FIXED64:case _.INT64:case _.SFIXED64:case _.SINT64:return F(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case _.BYTES:return F(e instanceof Uint8Array),br.enc(e)}}const Ue=Symbol("@bufbuild/protobuf/unknown-fields"),ti={readUnknownFields:!0,readerFactory:n=>new tl(n)},ni={writeUnknownFields:!0,writerFactory:()=>new el};function hl(n){return n?Object.assign(Object.assign({},ti),n):ti}function fl(n){return n?Object.assign(Object.assign({},ni),n):ni}function ml(){return{makeReadOptions:hl,makeWriteOptions:fl,listUnknownFields(n){var e;return(e=n[Ue])!==null&&e!==void 0?e:[]},discardUnknownFields(n){delete n[Ue]},writeUnknownFields(n,e){const s=n[Ue];if(s)for(const i of s)e.tag(i.no,i.wireType).raw(i.data)},onUnknownField(n,e,t,s){const i=n;Array.isArray(i[Ue])||(i[Ue]=[]),i[Ue].push({no:e,wireType:t,data:s})},readMessage(n,e,t,s,i){const r=n.getType(),a=i?e.len:e.pos+t;let o,l;for(;e.pos<a&&([o,l]=e.tag(),!(i===!0&&l==U.EndGroup));){const u=r.fields.find(o);if(!u){const c=e.skip(l,o);s.readUnknownFields&&this.onUnknownField(n,o,l,c);continue}si(n,e,u,l,s)}if(i&&(l!=U.EndGroup||o!==t))throw new Error("invalid end group tag")},readField:si,writeMessage(n,e,t){const s=n.getType();for(const i of s.fields.byNumber()){if(!Cr(i,n)){if(i.req)throw new Error(`cannot encode field ${s.typeName}.${i.name} to binary: required field not set`);continue}const r=i.oneof?n[i.oneof.localName].value:n[i.localName];ii(i,r,e,t)}return t.writeUnknownFields&&this.writeUnknownFields(n,e),e},writeField(n,e,t,s){e!==void 0&&ii(n,e,t,s)}}}function si(n,e,t,s,i){let{repeated:r,localName:a}=t;switch(t.oneof&&(n=n[t.oneof.localName],n.case!=a&&delete n.value,n.case=a,a="value"),t.kind){case"scalar":case"enum":const o=t.kind=="enum"?_.INT32:t.T;let l=$t;if(t.kind=="scalar"&&t.L>0&&(l=gl),r){let h=n[a];if(s==U.LengthDelimited&&o!=_.STRING&&o!=_.BYTES){let m=e.uint32()+e.pos;for(;e.pos<m;)h.push(l(e,o))}else h.push(l(e,o))}else n[a]=l(e,o);break;case"message":const u=t.T;r?n[a].push(Ft(e,new u,i,t)):Ie(n[a])?Ft(e,n[a],i,t):(n[a]=Ft(e,new u,i,t),u.fieldWrapper&&!t.oneof&&!t.repeated&&(n[a]=u.fieldWrapper.unwrapField(n[a])));break;case"map":let[c,d]=pl(t,e,i);n[a][c]=d;break}}function Ft(n,e,t,s){const i=e.getType().runtime.bin,r=s==null?void 0:s.delimited;return i.readMessage(e,n,r?s.no:n.uint32(),t,r),e}function pl(n,e,t){const s=e.uint32(),i=e.pos+s;let r,a;for(;e.pos<i;){const[o]=e.tag();switch(o){case 1:r=$t(e,n.K);break;case 2:switch(n.V.kind){case"scalar":a=$t(e,n.V.T);break;case"enum":a=e.int32();break;case"message":a=Ft(e,new n.V.T,t,void 0);break}break}}if(r===void 0&&(r=Je(n.K,Te.BIGINT)),typeof r!="string"&&typeof r!="number"&&(r=r.toString()),a===void 0)switch(n.V.kind){case"scalar":a=Je(n.V.T,Te.BIGINT);break;case"enum":a=n.V.T.values[0].no;break;case"message":a=new n.V.T;break}return[r,a]}function gl(n,e){const t=$t(n,e);return typeof t=="bigint"?t.toString():t}function $t(n,e){switch(e){case _.STRING:return n.string();case _.BOOL:return n.bool();case _.DOUBLE:return n.double();case _.FLOAT:return n.float();case _.INT32:return n.int32();case _.INT64:return n.int64();case _.UINT64:return n.uint64();case _.FIXED64:return n.fixed64();case _.BYTES:return n.bytes();case _.FIXED32:return n.fixed32();case _.SFIXED32:return n.sfixed32();case _.SFIXED64:return n.sfixed64();case _.SINT64:return n.sint64();case _.UINT32:return n.uint32();case _.SINT32:return n.sint32()}}function ii(n,e,t,s){F(e!==void 0);const i=n.repeated;switch(n.kind){case"scalar":case"enum":let r=n.kind=="enum"?_.INT32:n.T;if(i)if(F(Array.isArray(e)),n.packed)yl(t,r,n.no,e);else for(const a of e)ot(t,r,n.no,a);else ot(t,r,n.no,e);break;case"message":if(i){F(Array.isArray(e));for(const a of e)ri(t,s,n,a)}else ri(t,s,n,e);break;case"map":F(typeof e=="object"&&e!=null);for(const[a,o]of Object.entries(e))_l(t,s,n,a,o);break}}function _l(n,e,t,s,i){n.tag(t.no,U.LengthDelimited),n.fork();let r=s;switch(t.K){case _.INT32:case _.FIXED32:case _.UINT32:case _.SFIXED32:case _.SINT32:r=Number.parseInt(s);break;case _.BOOL:F(s=="true"||s=="false"),r=s=="true";break}switch(ot(n,t.K,1,r),t.V.kind){case"scalar":ot(n,t.V.T,2,i);break;case"enum":ot(n,_.INT32,2,i);break;case"message":F(i!==void 0),n.tag(2,U.LengthDelimited).bytes(i.toBinary(e));break}n.join()}function ri(n,e,t,s){const i=Ar(t.T,s);t.delimited?n.tag(t.no,U.StartGroup).raw(i.toBinary(e)).tag(t.no,U.EndGroup):n.tag(t.no,U.LengthDelimited).bytes(i.toBinary(e))}function ot(n,e,t,s){F(s!==void 0);let[i,r]=vr(e);n.tag(t,i)[r](s)}function yl(n,e,t,s){if(!s.length)return;n.tag(t,U.LengthDelimited).fork();let[,i]=vr(e);for(let r=0;r<s.length;r++)n[i](s[r]);n.join()}function vr(n){let e=U.Varint;switch(n){case _.BYTES:case _.STRING:e=U.LengthDelimited;break;case _.DOUBLE:case _.FIXED64:case _.SFIXED64:e=U.Bit64;break;case _.FIXED32:case _.SFIXED32:case _.FLOAT:e=U.Bit32;break}const t=_[n].toLowerCase();return[e,t]}function Tl(){return{setEnumType:pr,initPartial(n,e){if(n===void 0)return;const t=e.getType();for(const s of t.fields.byMember()){const i=s.localName,r=e,a=n;if(a[i]!=null)switch(s.kind){case"oneof":const o=a[i].case;if(o===void 0)continue;const l=s.findField(o);let u=a[i].value;l&&l.kind=="message"&&!Ie(u,l.T)?u=new l.T(u):l&&l.kind==="scalar"&&l.T===_.BYTES&&(u=nt(u)),r[i]={case:o,value:u};break;case"scalar":case"enum":let c=a[i];s.T===_.BYTES&&(c=s.repeated?c.map(nt):nt(c)),r[i]=c;break;case"map":switch(s.V.kind){case"scalar":case"enum":if(s.V.T===_.BYTES)for(const[g,m]of Object.entries(a[i]))r[i][g]=nt(m);else Object.assign(r[i],a[i]);break;case"message":const h=s.V.T;for(const g of Object.keys(a[i])){let m=a[i][g];h.fieldWrapper||(m=new h(m)),r[i][g]=m}break}break;case"message":const d=s.T;if(s.repeated)r[i]=a[i].map(h=>Ie(h,d)?h:new d(h));else{const h=a[i];d.fieldWrapper?d.typeName==="google.protobuf.BytesValue"?r[i]=nt(h):r[i]=h:r[i]=Ie(h,d)?h:new d(h)}break}}},equals(n,e,t){return e===t?!0:!e||!t?!1:n.fields.byMember().every(s=>{const i=e[s.localName],r=t[s.localName];if(s.repeated){if(i.length!==r.length)return!1;switch(s.kind){case"message":return i.every((a,o)=>s.T.equals(a,r[o]));case"scalar":return i.every((a,o)=>ge(s.T,a,r[o]));case"enum":return i.every((a,o)=>ge(_.INT32,a,r[o]))}throw new Error(`repeated cannot contain ${s.kind}`)}switch(s.kind){case"message":return s.T.equals(i,r);case"enum":return ge(_.INT32,i,r);case"scalar":return ge(s.T,i,r);case"oneof":if(i.case!==r.case)return!1;const a=s.findField(i.case);if(a===void 0)return!0;switch(a.kind){case"message":return a.T.equals(i.value,r.value);case"enum":return ge(_.INT32,i.value,r.value);case"scalar":return ge(a.T,i.value,r.value)}throw new Error(`oneof cannot contain ${a.kind}`);case"map":const o=Object.keys(i).concat(Object.keys(r));switch(s.V.kind){case"message":const l=s.V.T;return o.every(c=>l.equals(i[c],r[c]));case"enum":return o.every(c=>ge(_.INT32,i[c],r[c]));case"scalar":const u=s.V.T;return o.every(c=>ge(u,i[c],r[c]))}break}})},clone(n){const e=n.getType(),t=new e,s=t;for(const i of e.fields.byMember()){const r=n[i.localName];let a;if(i.repeated)a=r.map(Ct);else if(i.kind=="map"){a=s[i.localName];for(const[o,l]of Object.entries(r))a[o]=Ct(l)}else i.kind=="oneof"?a=i.findField(r.case)?{case:r.case,value:Ct(r.value)}:{case:void 0}:a=Ct(r);s[i.localName]=a}for(const i of e.runtime.bin.listUnknownFields(n))e.runtime.bin.onUnknownField(s,i.no,i.wireType,i.data);return t}}}function Ct(n){if(n===void 0)return n;if(Ie(n))return n.clone();if(n instanceof Uint8Array){const e=new Uint8Array(n.byteLength);return e.set(n),e}return n}function nt(n){return n instanceof Uint8Array?n:new Uint8Array(n)}function El(n,e,t){return{syntax:n,json:ll(),bin:ml(),util:Object.assign(Object.assign({},Tl()),{newFieldList:e,initFields:t}),makeMessageType(s,i,r){return Gc(this,s,i,r)},makeEnum:Jc,makeEnumType:gr,getEnumType:jc,makeExtension(s,i,r){return nl(this,s,i,r)}}}class Sl{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const t={};for(const s of this.list())t[s.jsonName]=t[s.name]=s;this.jsonNames=t}return this.jsonNames[e]}find(e){if(!this.numbers){const t={};for(const s of this.list())t[s.no]=s;this.numbers=t}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const s of this.list())s.oneof?s.oneof!==t&&(t=s.oneof,e.push(t)):e.push(s)}return this.members}}function Ir(n,e){const t=Nr(n);return e?t:Al(Cl(t))}function wl(n){return Ir(n,!1)}const bl=Nr;function Nr(n){let e=!1;const t=[];for(let s=0;s<n.length;s++){let i=n.charAt(s);switch(i){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":t.push(i),e=!1;break;default:e&&(e=!1,i=i.toUpperCase()),t.push(i);break}}return t.join("")}const kl=new Set(["constructor","toString","toJSON","valueOf"]),Rl=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Or=n=>`${n}$`,Cl=n=>Rl.has(n)?Or(n):n,Al=n=>kl.has(n)?Or(n):n;class vl{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=wl(e)}addField(e){F(e.oneof===this,`field ${e.name} not one of ${this.name}`),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let t=0;t<this.fields.length;t++)this._lookup[this.fields[t].localName]=this.fields[t]}return this._lookup[e]}}function Il(n,e){var t,s,i,r,a,o;const l=[];let u;for(const c of typeof n=="function"?n():n){const d=c;if(d.localName=Ir(c.name,c.oneof!==void 0),d.jsonName=(t=c.jsonName)!==null&&t!==void 0?t:bl(c.name),d.repeated=(s=c.repeated)!==null&&s!==void 0?s:!1,c.kind=="scalar"&&(d.L=(i=c.L)!==null&&i!==void 0?i:Te.BIGINT),d.delimited=(r=c.delimited)!==null&&r!==void 0?r:!1,d.req=(a=c.req)!==null&&a!==void 0?a:!1,d.opt=(o=c.opt)!==null&&o!==void 0?o:!1,c.packed===void 0&&(e?d.packed=c.kind=="enum"||c.kind=="scalar"&&c.T!=_.BYTES&&c.T!=_.STRING:d.packed=!1),c.oneof!==void 0){const h=typeof c.oneof=="string"?c.oneof:c.oneof.name;(!u||u.name!=h)&&(u=new vl(h)),d.oneof=u,u.addField(d)}l.push(d)}return l}const y=El("proto3",n=>new Sl(n,e=>Il(e,!0)),n=>{for(const e of n.getType().fields.byMember()){if(e.opt)continue;const t=e.localName,s=n;if(e.repeated){s[t]=[];continue}switch(e.kind){case"oneof":s[t]={case:void 0};break;case"enum":s[t]=0;break;case"map":s[t]={};break;case"scalar":s[t]=Je(e.T,e.L);break}}}),Nl=y.makeEnum("livekit.AudioCodec",[{no:0,name:"DEFAULT_AC"},{no:1,name:"OPUS"},{no:2,name:"AAC"}]),Ol=y.makeEnum("livekit.VideoCodec",[{no:0,name:"DEFAULT_VC"},{no:1,name:"H264_BASELINE"},{no:2,name:"H264_MAIN"},{no:3,name:"H264_HIGH"},{no:4,name:"VP8"}]),Pl=y.makeEnum("livekit.ImageCodec",[{no:0,name:"IC_DEFAULT"},{no:1,name:"IC_JPEG"}]),Ll=y.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),He=y.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Ml=y.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Dl=y.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"}]),xl=y.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"}]),Fn=y.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Fl,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:Mr}]),Fl=y.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),ts=y.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:y.getEnumType(He),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Un=y.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:y.getEnumType(Ul)},{no:4,name:"tracks",kind:"message",T:Pr,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:ts},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:y.getEnumType(Bl)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:y.getEnumType(Dl)}]),Ul=y.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Bl=y.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),Hl=y.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),Vl=y.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Lr,repeated:!0}]),Pr=y.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:y.getEnumType(Ll)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:y.getEnumType(He)},{no:10,name:"layers",kind:"message",T:Lr,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:Vl,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:y.getEnumType(Hl)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:Mr},{no:19,name:"audio_features",kind:"enum",T:y.getEnumType(xl),repeated:!0}]),Lr=y.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:y.getEnumType(Ml)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]),Kl=y.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),ql=y.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),Mr=y.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),$l=y.makeEnum("livekit.EncodedFileType",[{no:0,name:"DEFAULT_FILETYPE"},{no:1,name:"MP4"},{no:2,name:"OGG"}]),Wl=y.makeEnum("livekit.SegmentedFileProtocol",[{no:0,name:"DEFAULT_SEGMENTED_FILE_PROTOCOL"},{no:1,name:"HLS_PROTOCOL"}]),jl=y.makeEnum("livekit.SegmentedFileSuffix",[{no:0,name:"INDEX"},{no:1,name:"TIMESTAMP"}]),Jl=y.makeEnum("livekit.ImageFileSuffix",[{no:0,name:"IMAGE_SUFFIX_INDEX"},{no:1,name:"IMAGE_SUFFIX_TIMESTAMP"}]),Dr=y.makeEnum("livekit.StreamProtocol",[{no:0,name:"DEFAULT_PROTOCOL"},{no:1,name:"RTMP"},{no:2,name:"SRT"}]),gt=y.makeEnum("livekit.EncodingOptionsPreset",[{no:0,name:"H264_720P_30"},{no:1,name:"H264_720P_60"},{no:2,name:"H264_1080P_30"},{no:3,name:"H264_1080P_60"},{no:4,name:"PORTRAIT_H264_720P_30"},{no:5,name:"PORTRAIT_H264_720P_60"},{no:6,name:"PORTRAIT_H264_1080P_30"},{no:7,name:"PORTRAIT_H264_1080P_60"}]),Gl=y.makeEnum("livekit.EgressStatus",[{no:0,name:"EGRESS_STARTING"},{no:1,name:"EGRESS_ACTIVE"},{no:2,name:"EGRESS_ENDING"},{no:3,name:"EGRESS_COMPLETE"},{no:4,name:"EGRESS_FAILED"},{no:5,name:"EGRESS_ABORTED"},{no:6,name:"EGRESS_LIMIT_REACHED"}]),ns=y.makeMessageType("livekit.RoomCompositeEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"layout",kind:"scalar",T:9},{no:3,name:"audio_only",kind:"scalar",T:8},{no:4,name:"video_only",kind:"scalar",T:8},{no:5,name:"custom_base_url",kind:"scalar",T:9},{no:6,name:"file",kind:"message",T:Ee,oneof:"output"},{no:7,name:"stream",kind:"message",T:we,oneof:"output"},{no:10,name:"segments",kind:"message",T:Se,oneof:"output"},{no:8,name:"preset",kind:"enum",T:y.getEnumType(gt),oneof:"options"},{no:9,name:"advanced",kind:"message",T:St,oneof:"options"},{no:11,name:"file_outputs",kind:"message",T:Ee,repeated:!0},{no:12,name:"stream_outputs",kind:"message",T:we,repeated:!0},{no:13,name:"segment_outputs",kind:"message",T:Se,repeated:!0},{no:14,name:"image_outputs",kind:"message",T:tn,repeated:!0}]),xr=y.makeMessageType("livekit.WebEgressRequest",()=>[{no:1,name:"url",kind:"scalar",T:9},{no:2,name:"audio_only",kind:"scalar",T:8},{no:3,name:"video_only",kind:"scalar",T:8},{no:12,name:"await_start_signal",kind:"scalar",T:8},{no:4,name:"file",kind:"message",T:Ee,oneof:"output"},{no:5,name:"stream",kind:"message",T:we,oneof:"output"},{no:6,name:"segments",kind:"message",T:Se,oneof:"output"},{no:7,name:"preset",kind:"enum",T:y.getEnumType(gt),oneof:"options"},{no:8,name:"advanced",kind:"message",T:St,oneof:"options"},{no:9,name:"file_outputs",kind:"message",T:Ee,repeated:!0},{no:10,name:"stream_outputs",kind:"message",T:we,repeated:!0},{no:11,name:"segment_outputs",kind:"message",T:Se,repeated:!0},{no:13,name:"image_outputs",kind:"message",T:tn,repeated:!0}]),Fr=y.makeMessageType("livekit.ParticipantEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"screen_share",kind:"scalar",T:8},{no:4,name:"preset",kind:"enum",T:y.getEnumType(gt),oneof:"options"},{no:5,name:"advanced",kind:"message",T:St,oneof:"options"},{no:6,name:"file_outputs",kind:"message",T:Ee,repeated:!0},{no:7,name:"stream_outputs",kind:"message",T:we,repeated:!0},{no:8,name:"segment_outputs",kind:"message",T:Se,repeated:!0},{no:9,name:"image_outputs",kind:"message",T:tn,repeated:!0}]),Ur=y.makeMessageType("livekit.TrackCompositeEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"audio_track_id",kind:"scalar",T:9},{no:3,name:"video_track_id",kind:"scalar",T:9},{no:4,name:"file",kind:"message",T:Ee,oneof:"output"},{no:5,name:"stream",kind:"message",T:we,oneof:"output"},{no:8,name:"segments",kind:"message",T:Se,oneof:"output"},{no:6,name:"preset",kind:"enum",T:y.getEnumType(gt),oneof:"options"},{no:7,name:"advanced",kind:"message",T:St,oneof:"options"},{no:11,name:"file_outputs",kind:"message",T:Ee,repeated:!0},{no:12,name:"stream_outputs",kind:"message",T:we,repeated:!0},{no:13,name:"segment_outputs",kind:"message",T:Se,repeated:!0},{no:14,name:"image_outputs",kind:"message",T:tn,repeated:!0}]),Br=y.makeMessageType("livekit.TrackEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"track_id",kind:"scalar",T:9},{no:3,name:"file",kind:"message",T:zl,oneof:"output"},{no:4,name:"websocket_url",kind:"scalar",T:9,oneof:"output"}]),Ee=y.makeMessageType("livekit.EncodedFileOutput",()=>[{no:1,name:"file_type",kind:"enum",T:y.getEnumType($l)},{no:2,name:"filepath",kind:"scalar",T:9},{no:6,name:"disable_manifest",kind:"scalar",T:8},{no:3,name:"s3",kind:"message",T:_t,oneof:"output"},{no:4,name:"gcp",kind:"message",T:yt,oneof:"output"},{no:5,name:"azure",kind:"message",T:Tt,oneof:"output"},{no:7,name:"aliOSS",kind:"message",T:Et,oneof:"output"}]),Se=y.makeMessageType("livekit.SegmentedFileOutput",()=>[{no:1,name:"protocol",kind:"enum",T:y.getEnumType(Wl)},{no:2,name:"filename_prefix",kind:"scalar",T:9},{no:3,name:"playlist_name",kind:"scalar",T:9},{no:11,name:"live_playlist_name",kind:"scalar",T:9},{no:4,name:"segment_duration",kind:"scalar",T:13},{no:10,name:"filename_suffix",kind:"enum",T:y.getEnumType(jl)},{no:8,name:"disable_manifest",kind:"scalar",T:8},{no:5,name:"s3",kind:"message",T:_t,oneof:"output"},{no:6,name:"gcp",kind:"message",T:yt,oneof:"output"},{no:7,name:"azure",kind:"message",T:Tt,oneof:"output"},{no:9,name:"aliOSS",kind:"message",T:Et,oneof:"output"}]),zl=y.makeMessageType("livekit.DirectFileOutput",()=>[{no:1,name:"filepath",kind:"scalar",T:9},{no:5,name:"disable_manifest",kind:"scalar",T:8},{no:2,name:"s3",kind:"message",T:_t,oneof:"output"},{no:3,name:"gcp",kind:"message",T:yt,oneof:"output"},{no:4,name:"azure",kind:"message",T:Tt,oneof:"output"},{no:6,name:"aliOSS",kind:"message",T:Et,oneof:"output"}]),tn=y.makeMessageType("livekit.ImageOutput",()=>[{no:1,name:"capture_interval",kind:"scalar",T:13},{no:2,name:"width",kind:"scalar",T:5},{no:3,name:"height",kind:"scalar",T:5},{no:4,name:"filename_prefix",kind:"scalar",T:9},{no:5,name:"filename_suffix",kind:"enum",T:y.getEnumType(Jl)},{no:6,name:"image_codec",kind:"enum",T:y.getEnumType(Pl)},{no:7,name:"disable_manifest",kind:"scalar",T:8},{no:8,name:"s3",kind:"message",T:_t,oneof:"output"},{no:9,name:"gcp",kind:"message",T:yt,oneof:"output"},{no:10,name:"azure",kind:"message",T:Tt,oneof:"output"},{no:11,name:"aliOSS",kind:"message",T:Et,oneof:"output"}]),_t=y.makeMessageType("livekit.S3Upload",()=>[{no:1,name:"access_key",kind:"scalar",T:9},{no:2,name:"secret",kind:"scalar",T:9},{no:11,name:"session_token",kind:"scalar",T:9},{no:3,name:"region",kind:"scalar",T:9},{no:4,name:"endpoint",kind:"scalar",T:9},{no:5,name:"bucket",kind:"scalar",T:9},{no:6,name:"force_path_style",kind:"scalar",T:8},{no:7,name:"metadata",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:8,name:"tagging",kind:"scalar",T:9},{no:9,name:"content_disposition",kind:"scalar",T:9},{no:10,name:"proxy",kind:"message",T:Hr}]),yt=y.makeMessageType("livekit.GCPUpload",()=>[{no:1,name:"credentials",kind:"scalar",T:9},{no:2,name:"bucket",kind:"scalar",T:9},{no:3,name:"proxy",kind:"message",T:Hr}]),Tt=y.makeMessageType("livekit.AzureBlobUpload",()=>[{no:1,name:"account_name",kind:"scalar",T:9},{no:2,name:"account_key",kind:"scalar",T:9},{no:3,name:"container_name",kind:"scalar",T:9}]),Et=y.makeMessageType("livekit.AliOSSUpload",()=>[{no:1,name:"access_key",kind:"scalar",T:9},{no:2,name:"secret",kind:"scalar",T:9},{no:3,name:"region",kind:"scalar",T:9},{no:4,name:"endpoint",kind:"scalar",T:9},{no:5,name:"bucket",kind:"scalar",T:9}]),Hr=y.makeMessageType("livekit.ProxyConfig",()=>[{no:1,name:"url",kind:"scalar",T:9},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"password",kind:"scalar",T:9}]),we=y.makeMessageType("livekit.StreamOutput",()=>[{no:1,name:"protocol",kind:"enum",T:y.getEnumType(Dr)},{no:2,name:"urls",kind:"scalar",T:9,repeated:!0}]),St=y.makeMessageType("livekit.EncodingOptions",()=>[{no:1,name:"width",kind:"scalar",T:5},{no:2,name:"height",kind:"scalar",T:5},{no:3,name:"depth",kind:"scalar",T:5},{no:4,name:"framerate",kind:"scalar",T:5},{no:5,name:"audio_codec",kind:"enum",T:y.getEnumType(Nl)},{no:6,name:"audio_bitrate",kind:"scalar",T:5},{no:11,name:"audio_quality",kind:"scalar",T:5},{no:7,name:"audio_frequency",kind:"scalar",T:5},{no:8,name:"video_codec",kind:"enum",T:y.getEnumType(Ol)},{no:9,name:"video_bitrate",kind:"scalar",T:5},{no:12,name:"video_quality",kind:"scalar",T:5},{no:10,name:"key_frame_interval",kind:"scalar",T:1}]),Yl=y.makeMessageType("livekit.UpdateLayoutRequest",()=>[{no:1,name:"egress_id",kind:"scalar",T:9},{no:2,name:"layout",kind:"scalar",T:9}]),Xl=y.makeMessageType("livekit.UpdateStreamRequest",()=>[{no:1,name:"egress_id",kind:"scalar",T:9},{no:2,name:"add_output_urls",kind:"scalar",T:9,repeated:!0},{no:3,name:"remove_output_urls",kind:"scalar",T:9,repeated:!0}]),Ql=y.makeMessageType("livekit.ListEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"egress_id",kind:"scalar",T:9},{no:3,name:"active",kind:"scalar",T:8}]),Zl=y.makeMessageType("livekit.ListEgressResponse",()=>[{no:1,name:"items",kind:"message",T:oe,repeated:!0}]),eu=y.makeMessageType("livekit.StopEgressRequest",()=>[{no:1,name:"egress_id",kind:"scalar",T:9}]),oe=y.makeMessageType("livekit.EgressInfo",()=>[{no:1,name:"egress_id",kind:"scalar",T:9},{no:2,name:"room_id",kind:"scalar",T:9},{no:13,name:"room_name",kind:"scalar",T:9},{no:3,name:"status",kind:"enum",T:y.getEnumType(Gl)},{no:10,name:"started_at",kind:"scalar",T:3},{no:11,name:"ended_at",kind:"scalar",T:3},{no:18,name:"updated_at",kind:"scalar",T:3},{no:21,name:"details",kind:"scalar",T:9},{no:9,name:"error",kind:"scalar",T:9},{no:22,name:"error_code",kind:"scalar",T:5},{no:4,name:"room_composite",kind:"message",T:ns,oneof:"request"},{no:14,name:"web",kind:"message",T:xr,oneof:"request"},{no:19,name:"participant",kind:"message",T:Fr,oneof:"request"},{no:5,name:"track_composite",kind:"message",T:Ur,oneof:"request"},{no:6,name:"track",kind:"message",T:Br,oneof:"request"},{no:7,name:"stream",kind:"message",T:tu,oneof:"result"},{no:8,name:"file",kind:"message",T:ai,oneof:"result"},{no:12,name:"segments",kind:"message",T:oi,oneof:"result"},{no:15,name:"stream_results",kind:"message",T:Vr,repeated:!0},{no:16,name:"file_results",kind:"message",T:ai,repeated:!0},{no:17,name:"segment_results",kind:"message",T:oi,repeated:!0},{no:20,name:"image_results",kind:"message",T:su,repeated:!0}]),tu=y.makeMessageType("livekit.StreamInfoList",()=>[{no:1,name:"info",kind:"message",T:Vr,repeated:!0}]),Vr=y.makeMessageType("livekit.StreamInfo",()=>[{no:1,name:"url",kind:"scalar",T:9},{no:2,name:"started_at",kind:"scalar",T:3},{no:3,name:"ended_at",kind:"scalar",T:3},{no:4,name:"duration",kind:"scalar",T:3},{no:5,name:"status",kind:"enum",T:y.getEnumType(nu)},{no:6,name:"error",kind:"scalar",T:9}]),nu=y.makeEnum("livekit.StreamInfo.Status",[{no:0,name:"ACTIVE"},{no:1,name:"FINISHED"},{no:2,name:"FAILED"}]),ai=y.makeMessageType("livekit.FileInfo",()=>[{no:1,name:"filename",kind:"scalar",T:9},{no:2,name:"started_at",kind:"scalar",T:3},{no:3,name:"ended_at",kind:"scalar",T:3},{no:6,name:"duration",kind:"scalar",T:3},{no:4,name:"size",kind:"scalar",T:3},{no:5,name:"location",kind:"scalar",T:9}]),oi=y.makeMessageType("livekit.SegmentsInfo",()=>[{no:1,name:"playlist_name",kind:"scalar",T:9},{no:8,name:"live_playlist_name",kind:"scalar",T:9},{no:2,name:"duration",kind:"scalar",T:3},{no:3,name:"size",kind:"scalar",T:3},{no:4,name:"playlist_location",kind:"scalar",T:9},{no:9,name:"live_playlist_location",kind:"scalar",T:9},{no:5,name:"segment_count",kind:"scalar",T:3},{no:6,name:"started_at",kind:"scalar",T:3},{no:7,name:"ended_at",kind:"scalar",T:3}]),su=y.makeMessageType("livekit.ImagesInfo",()=>[{no:4,name:"filename_prefix",kind:"scalar",T:9},{no:1,name:"image_count",kind:"scalar",T:3},{no:2,name:"started_at",kind:"scalar",T:3},{no:3,name:"ended_at",kind:"scalar",T:3}]),iu=y.makeMessageType("livekit.AutoParticipantEgress",()=>[{no:1,name:"preset",kind:"enum",T:y.getEnumType(gt),oneof:"options"},{no:2,name:"advanced",kind:"message",T:St,oneof:"options"},{no:3,name:"file_outputs",kind:"message",T:Ee,repeated:!0},{no:4,name:"segment_outputs",kind:"message",T:Se,repeated:!0}]),ru=y.makeMessageType("livekit.AutoTrackEgress",()=>[{no:1,name:"filepath",kind:"scalar",T:9},{no:5,name:"disable_manifest",kind:"scalar",T:8},{no:2,name:"s3",kind:"message",T:_t,oneof:"output"},{no:3,name:"gcp",kind:"message",T:yt,oneof:"output"},{no:4,name:"azure",kind:"message",T:Tt,oneof:"output"},{no:6,name:"aliOSS",kind:"message",T:Et,oneof:"output"}]),au=y.makeMessageType("livekit.RoomAgentDispatch",()=>[{no:1,name:"agent_name",kind:"scalar",T:9},{no:2,name:"metadata",kind:"scalar",T:9}]),ou=y.makeMessageType("livekit.CreateRoomRequest",()=>[{no:1,name:"name",kind:"scalar",T:9},{no:12,name:"config_name",kind:"scalar",T:9},{no:2,name:"empty_timeout",kind:"scalar",T:13},{no:10,name:"departure_timeout",kind:"scalar",T:13},{no:3,name:"max_participants",kind:"scalar",T:13},{no:4,name:"node_id",kind:"scalar",T:9},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"egress",kind:"message",T:cu},{no:11,name:"agent",kind:"message",T:lu},{no:7,name:"min_playout_delay",kind:"scalar",T:13},{no:8,name:"max_playout_delay",kind:"scalar",T:13},{no:9,name:"sync_streams",kind:"scalar",T:8},{no:13,name:"replay_enabled",kind:"scalar",T:8}]),cu=y.makeMessageType("livekit.RoomEgress",()=>[{no:1,name:"room",kind:"message",T:ns},{no:3,name:"participant",kind:"message",T:iu},{no:2,name:"tracks",kind:"message",T:ru}]),lu=y.makeMessageType("livekit.RoomAgent",()=>[{no:1,name:"dispatches",kind:"message",T:au,repeated:!0}]),uu=y.makeMessageType("livekit.ListRoomsRequest",()=>[{no:1,name:"names",kind:"scalar",T:9,repeated:!0}]),du=y.makeMessageType("livekit.ListRoomsResponse",()=>[{no:1,name:"rooms",kind:"message",T:Fn,repeated:!0}]),hu=y.makeMessageType("livekit.DeleteRoomRequest",()=>[{no:1,name:"room",kind:"scalar",T:9}]),fu=y.makeMessageType("livekit.ListParticipantsRequest",()=>[{no:1,name:"room",kind:"scalar",T:9}]),mu=y.makeMessageType("livekit.ListParticipantsResponse",()=>[{no:1,name:"participants",kind:"message",T:Un,repeated:!0}]),ci=y.makeMessageType("livekit.RoomParticipantIdentity",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9}]),pu=y.makeMessageType("livekit.MuteRoomTrackRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"track_sid",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8}]),gu=y.makeMessageType("livekit.MuteRoomTrackResponse",()=>[{no:1,name:"track",kind:"message",T:Pr}]),_u=y.makeMessageType("livekit.UpdateParticipantRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"permission",kind:"message",T:ts},{no:5,name:"name",kind:"scalar",T:9},{no:6,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}]),yu=y.makeMessageType("livekit.UpdateSubscriptionsRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"subscribe",kind:"scalar",T:8},{no:5,name:"participant_tracks",kind:"message",T:ql,repeated:!0}]),Tu=y.makeMessageType("livekit.SendDataRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"data",kind:"scalar",T:12},{no:3,name:"kind",kind:"enum",T:y.getEnumType(Kl)},{no:4,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:5,name:"topic",kind:"scalar",T:9,opt:!0}]),Eu=y.makeMessageType("livekit.UpdateRoomMetadataRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"metadata",kind:"scalar",T:9}]),ss=crypto,Kr=n=>n instanceof CryptoKey,Ve=new TextEncoder,Bn=new TextDecoder;function Su(...n){const e=n.reduce((i,{length:r})=>i+r,0),t=new Uint8Array(e);let s=0;for(const i of n)t.set(i,s),s+=i.length;return t}const wu=n=>{let e=n;typeof e=="string"&&(e=Ve.encode(e));const t=32768,s=[];for(let i=0;i<e.length;i+=t)s.push(String.fromCharCode.apply(null,e.subarray(i,i+t)));return btoa(s.join(""))},mn=n=>wu(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),bu=n=>{const e=atob(n),t=new Uint8Array(e.length);for(let s=0;s<e.length;s++)t[s]=e.charCodeAt(s);return t},ku=n=>{let e=n;e instanceof Uint8Array&&(e=Bn.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return bu(e)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class is extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(t=Error.captureStackTrace)==null||t.call(Error,this,this.constructor)}}class Ke extends is{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}}class st extends is{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}}class Ru extends is{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}}function ie(n,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${n}`)}function At(n,e){return n.name===e}function pn(n){return parseInt(n.name.slice(4),10)}function Cu(n){switch(n){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function Au(n,e){if(e.length&&!e.some(t=>n.usages.includes(t))){let t="CryptoKey does not support this operation, its usages must include ";if(e.length>2){const s=e.pop();t+=`one of ${e.join(", ")}, or ${s}.`}else e.length===2?t+=`one of ${e[0]} or ${e[1]}.`:t+=`${e[0]}.`;throw new TypeError(t)}}function vu(n,e,...t){switch(e){case"HS256":case"HS384":case"HS512":{if(!At(n.algorithm,"HMAC"))throw ie("HMAC");const s=parseInt(e.slice(2),10);if(pn(n.algorithm.hash)!==s)throw ie(`SHA-${s}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!At(n.algorithm,"RSASSA-PKCS1-v1_5"))throw ie("RSASSA-PKCS1-v1_5");const s=parseInt(e.slice(2),10);if(pn(n.algorithm.hash)!==s)throw ie(`SHA-${s}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!At(n.algorithm,"RSA-PSS"))throw ie("RSA-PSS");const s=parseInt(e.slice(2),10);if(pn(n.algorithm.hash)!==s)throw ie(`SHA-${s}`,"algorithm.hash");break}case"EdDSA":{if(n.algorithm.name!=="Ed25519"&&n.algorithm.name!=="Ed448")throw ie("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!At(n.algorithm,"ECDSA"))throw ie("ECDSA");const s=Cu(e);if(n.algorithm.namedCurve!==s)throw ie(s,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Au(n,t)}function qr(n,e,...t){var s;if(t.length>2){const i=t.pop();n+=`one of type ${t.join(", ")}, or ${i}.`}else t.length===2?n+=`one of type ${t[0]} or ${t[1]}.`:n+=`of type ${t[0]}.`;return e==null?n+=` Received ${e}`:typeof e=="function"&&e.name?n+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&(s=e.constructor)!=null&&s.name&&(n+=` Received an instance of ${e.constructor.name}`),n}const li=(n,...e)=>qr("Key must be ",n,...e);function $r(n,e,...t){return qr(`Key for the ${n} algorithm must be `,e,...t)}const Wr=n=>Kr(n)?!0:(n==null?void 0:n[Symbol.toStringTag])==="KeyObject",Wt=["CryptoKey"],Iu=(...n)=>{const e=n.filter(Boolean);if(e.length===0||e.length===1)return!0;let t;for(const s of e){const i=Object.keys(s);if(!t||t.size===0){t=new Set(i);continue}for(const r of i){if(t.has(r))return!1;t.add(r)}}return!0},Nu=Iu;function Ou(n){return typeof n=="object"&&n!==null}function Pu(n){if(!Ou(n)||Object.prototype.toString.call(n)!=="[object Object]")return!1;if(Object.getPrototypeOf(n)===null)return!0;let e=n;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(n)===e}const Lu=(n,e)=>{if(n.startsWith("RS")||n.startsWith("PS")){const{modulusLength:t}=e.algorithm;if(typeof t!="number"||t<2048)throw new TypeError(`${n} requires key modulusLength to be 2048 bits or larger`)}};function Mu(n){let e,t;switch(n.kty){case"RSA":{switch(n.alg){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${n.alg.slice(-3)}`},t=n.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${n.alg.slice(-3)}`},t=n.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(n.alg.slice(-3),10)||1}`},t=n.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new Ke('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(n.alg){case"ES256":e={name:"ECDSA",namedCurve:"P-256"},t=n.d?["sign"]:["verify"];break;case"ES384":e={name:"ECDSA",namedCurve:"P-384"},t=n.d?["sign"]:["verify"];break;case"ES512":e={name:"ECDSA",namedCurve:"P-521"},t=n.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:"ECDH",namedCurve:n.crv},t=n.d?["deriveBits"]:[];break;default:throw new Ke('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(n.alg){case"EdDSA":e={name:n.crv},t=n.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:n.crv},t=n.d?["deriveBits"]:[];break;default:throw new Ke('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new Ke('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:e,keyUsages:t}}const Du=async n=>{if(!n.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:e,keyUsages:t}=Mu(n),s=[e,n.ext??!1,n.key_ops??t],i={...n};return delete i.alg,delete i.use,ss.subtle.importKey("jwk",i,...s)},xu=Du,jr=n=>ku(n);let gn,_n;const Jr=n=>(n==null?void 0:n[Symbol.toStringTag])==="KeyObject",Gr=async(n,e,t,s)=>{let i=n.get(e);if(i!=null&&i[s])return i[s];const r=await xu({...t,alg:s});return i?i[s]=r:n.set(e,{[s]:r}),r},Fu=(n,e)=>{if(Jr(n)){let t=n.export({format:"jwk"});return delete t.d,delete t.dp,delete t.dq,delete t.p,delete t.q,delete t.qi,t.k?jr(t.k):(_n||(_n=new WeakMap),Gr(_n,n,t,e))}return n},Uu=(n,e)=>{if(Jr(n)){let t=n.export({format:"jwk"});return t.k?jr(t.k):(gn||(gn=new WeakMap),Gr(gn,n,t,e))}return n},ui={normalizePublicKey:Fu,normalizePrivateKey:Uu},Be=n=>n==null?void 0:n[Symbol.toStringTag],Bu=(n,e)=>{if(!(e instanceof Uint8Array)){if(!Wr(e))throw new TypeError($r(n,e,...Wt,"Uint8Array"));if(e.type!=="secret")throw new TypeError(`${Be(e)} instances for symmetric algorithms must be of type "secret"`)}},Hu=(n,e,t)=>{if(!Wr(e))throw new TypeError($r(n,e,...Wt));if(e.type==="secret")throw new TypeError(`${Be(e)} instances for asymmetric algorithms must not be of type "secret"`);if(t==="sign"&&e.type==="public")throw new TypeError(`${Be(e)} instances for asymmetric algorithm signing must be of type "private"`);if(t==="decrypt"&&e.type==="public")throw new TypeError(`${Be(e)} instances for asymmetric algorithm decryption must be of type "private"`);if(e.algorithm&&t==="verify"&&e.type==="private")throw new TypeError(`${Be(e)} instances for asymmetric algorithm verifying must be of type "public"`);if(e.algorithm&&t==="encrypt"&&e.type==="private")throw new TypeError(`${Be(e)} instances for asymmetric algorithm encryption must be of type "public"`)},Vu=(n,e,t)=>{n.startsWith("HS")||n==="dir"||n.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(n)?Bu(n,e):Hu(n,e,t)},Ku=Vu;function qu(n,e,t,s,i){if(i.crit!==void 0&&(s==null?void 0:s.crit)===void 0)throw new n('"crit" (Critical) Header Parameter MUST be integrity protected');if(!s||s.crit===void 0)return new Set;if(!Array.isArray(s.crit)||s.crit.length===0||s.crit.some(a=>typeof a!="string"||a.length===0))throw new n('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let r;t!==void 0?r=new Map([...Object.entries(t),...e.entries()]):r=e;for(const a of s.crit){if(!r.has(a))throw new Ke(`Extension Header Parameter "${a}" is not recognized`);if(i[a]===void 0)throw new n(`Extension Header Parameter "${a}" is missing`);if(r.get(a)&&s[a]===void 0)throw new n(`Extension Header Parameter "${a}" MUST be integrity protected`)}return new Set(s.crit)}function $u(n,e){const t=`SHA-${n.slice(-3)}`;switch(n){case"HS256":case"HS384":case"HS512":return{hash:t,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:t,name:"RSA-PSS",saltLength:n.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:t,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:t,name:"ECDSA",namedCurve:e.namedCurve};case"EdDSA":return{name:e.name};default:throw new Ke(`alg ${n} is not supported either by JOSE or your javascript runtime`)}}async function Wu(n,e,t){if(t==="sign"&&(e=await ui.normalizePrivateKey(e,n)),t==="verify"&&(e=await ui.normalizePublicKey(e,n)),Kr(e))return vu(e,n,t),e;if(e instanceof Uint8Array){if(!n.startsWith("HS"))throw new TypeError(li(e,...Wt));return ss.subtle.importKey("raw",e,{hash:`SHA-${n.slice(-3)}`,name:"HMAC"},!1,[t])}throw new TypeError(li(e,...Wt,"Uint8Array"))}const Ce=n=>Math.floor(n.getTime()/1e3),zr=60,Yr=zr*60,rs=Yr*24,ju=rs*7,Ju=rs*365.25,Gu=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,yn=n=>{const e=Gu.exec(n);if(!e||e[4]&&e[1])throw new TypeError("Invalid time period format");const t=parseFloat(e[2]),s=e[3].toLowerCase();let i;switch(s){case"sec":case"secs":case"second":case"seconds":case"s":i=Math.round(t);break;case"minute":case"minutes":case"min":case"mins":case"m":i=Math.round(t*zr);break;case"hour":case"hours":case"hr":case"hrs":case"h":i=Math.round(t*Yr);break;case"day":case"days":case"d":i=Math.round(t*rs);break;case"week":case"weeks":case"w":i=Math.round(t*ju);break;default:i=Math.round(t*Ju);break}return e[1]==="-"||e[4]==="ago"?-i:i},zu=async(n,e,t)=>{const s=await Wu(n,e,"sign");Lu(n,s);const i=await ss.subtle.sign($u(n,s.algorithm),s,t);return new Uint8Array(i)},Yu=zu;class Xu{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){if(!this._protectedHeader&&!this._unprotectedHeader)throw new st("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!Nu(this._protectedHeader,this._unprotectedHeader))throw new st("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const s={...this._protectedHeader,...this._unprotectedHeader},i=qu(st,new Map([["b64",!0]]),t==null?void 0:t.crit,this._protectedHeader,s);let r=!0;if(i.has("b64")&&(r=this._protectedHeader.b64,typeof r!="boolean"))throw new st('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:a}=s;if(typeof a!="string"||!a)throw new st('JWS "alg" (Algorithm) Header Parameter missing or invalid');Ku(a,e,"sign");let o=this._payload;r&&(o=Ve.encode(mn(o)));let l;this._protectedHeader?l=Ve.encode(mn(JSON.stringify(this._protectedHeader))):l=Ve.encode("");const u=Su(l,Ve.encode("."),o),c=await Yu(a,e,u),d={signature:mn(c),payload:""};return r&&(d.payload=Bn.decode(o)),this._unprotectedHeader&&(d.header=this._unprotectedHeader),this._protectedHeader&&(d.protected=Bn.decode(l)),d}}class Qu{constructor(e){this._flattened=new Xu(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){const s=await this._flattened.sign(e,t);if(s.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${s.protected}.${s.payload}.${s.signature}`}}function Ae(n,e){if(!Number.isFinite(e))throw new TypeError(`Invalid ${n} input`);return e}class Zu{constructor(e={}){if(!Pu(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return typeof e=="number"?this._payload={...this._payload,nbf:Ae("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:Ae("setNotBefore",Ce(e))}:this._payload={...this._payload,nbf:Ce(new Date)+yn(e)},this}setExpirationTime(e){return typeof e=="number"?this._payload={...this._payload,exp:Ae("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:Ae("setExpirationTime",Ce(e))}:this._payload={...this._payload,exp:Ce(new Date)+yn(e)},this}setIssuedAt(e){return typeof e>"u"?this._payload={...this._payload,iat:Ce(new Date)}:e instanceof Date?this._payload={...this._payload,iat:Ae("setIssuedAt",Ce(e))}:typeof e=="string"?this._payload={...this._payload,iat:Ae("setIssuedAt",Ce(new Date)+yn(e))}:this._payload={...this._payload,iat:Ae("setIssuedAt",e)},this}}class ed extends Zu{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){var i;const s=new Qu(Ve.encode(JSON.stringify(this._payload)));if(s.setProtectedHeader(this._protectedHeader),Array.isArray((i=this._protectedHeader)==null?void 0:i.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new Ru("JWTs MUST NOT use unencoded payload");return s.sign(e,t)}}function td(n){switch(n){case He.CAMERA:return"camera";case He.MICROPHONE:return"microphone";case He.SCREEN_SHARE:return"screen_share";case He.SCREEN_SHARE_AUDIO:return"screen_share_audio";default:throw new TypeError(`Cannot convert TrackSource ${n} to string`)}}function nd(n){var e;const t=Object.assign({},n);return Array.isArray((e=t.video)===null||e===void 0?void 0:e.canPublishSources)&&(t.video.canPublishSources=t.video.canPublishSources.map(td)),t}const sd="6h";class Xr{constructor(e,t,s){if(e||(e={}.LIVEKIT_API_KEY),t||(t={}.LIVEKIT_API_SECRET),!e||!t)throw Error("api-key and api-secret must be set");typeof document<"u"&&console.error(`You should not include your API secret in your web client bundle.

Your web client should request a token from your backend server which should then use the API secret to generate a token. See https://docs.livekit.io/client/connect/`),this.apiKey=e,this.apiSecret=t,this.grants={},this.identity=s==null?void 0:s.identity,this.ttl=(s==null?void 0:s.ttl)||sd,typeof this.ttl=="number"&&(this.ttl=`${this.ttl}s`),s!=null&&s.metadata&&(this.metadata=s.metadata),s!=null&&s.name&&(this.name=s.name)}addGrant(e){var t;this.grants.video=Object.assign(Object.assign({},(t=this.grants.video)!==null&&t!==void 0?t:{}),e)}addSIPGrant(e){var t;this.grants.sip=Object.assign(Object.assign({},(t=this.grants.sip)!==null&&t!==void 0?t:{}),e)}get name(){return this.grants.name}set name(e){this.grants.name=e}get metadata(){return this.grants.metadata}set metadata(e){this.grants.metadata=e}get attributes(){return this.grants.attributes}set attributes(e){this.grants.attributes=e}get kind(){return this.grants.kind}set kind(e){this.grants.kind=e}get sha256(){return this.grants.sha256}set sha256(e){this.grants.sha256=e}async toJwt(){var e;const t=new TextEncoder().encode(this.apiSecret),s=new ed(nd(this.grants)).setProtectedHeader({alg:"HS256"}).setIssuer(this.apiKey).setExpirationTime(this.ttl).setNotBefore(0);if(this.identity)s.setSubject(this.identity);else if(!((e=this.grants.video)===null||e===void 0)&&e.roomJoin)throw Error("identity is required for join but not set");return s.sign(t)}}class Qr{constructor(e,t,s){this.apiKey=e,this.secret=t,this.ttl=s||"10m"}async authHeader(e,t){const s=new Xr(this.apiKey,this.secret,{ttl:this.ttl});return s.addGrant(e),t&&s.addSIPGrant(t),{Authorization:`Bearer ${await s.toJwt()}`}}}const Zr=n=>typeof n=="object"&&n!==null,di=n=>Zr(n)&&!(n instanceof RegExp)&&!(n instanceof Error)&&!(n instanceof Date),id=Symbol("mapObjectSkip"),Hn=(n,e,t,s=new WeakMap)=>{if(t={deep:!1,target:{},...t},s.has(n))return s.get(n);s.set(n,t.target);const{target:i}=t;delete t.target;const r=a=>a.map(o=>di(o)?Hn(o,e,t,s):o);if(Array.isArray(n))return r(n);for(const[a,o]of Object.entries(n)){const l=e(a,o,n);if(l===id)continue;let[u,c,{shouldRecurse:d=!0}={}]=l;u!=="__proto__"&&(t.deep&&d&&di(c)&&(c=Array.isArray(c)?r(c):Hn(c,e,t,s)),i[u]=c)}return i};function hi(n,e,t){if(!Zr(n))throw new TypeError(`Expected an object, got \`${n}\` (${typeof n})`);return Hn(n,e,t)}const rd=/[\p{Lu}]/u,ad=/[\p{Ll}]/u,fi=/^[\p{Lu}](?![\p{Lu}])/gu,ea=/([\p{Alpha}\p{N}_]|$)/u,as=/[_.\- ]+/,od=new RegExp("^"+as.source),mi=new RegExp(as.source+ea.source,"gu"),pi=new RegExp("\\d+"+ea.source,"gu"),cd=(n,e,t,s)=>{let i=!1,r=!1,a=!1,o=!1;for(let l=0;l<n.length;l++){const u=n[l];o=l>2?n[l-3]==="-":!0,i&&rd.test(u)?(n=n.slice(0,l)+"-"+n.slice(l),i=!1,a=r,r=!0,l++):r&&a&&ad.test(u)&&(!o||s)?(n=n.slice(0,l-1)+"-"+n.slice(l-1),a=r,r=!1,i=!0):(i=e(u)===u&&t(u)!==u,a=r,r=t(u)===u&&e(u)!==u)}return n},ld=(n,e)=>(fi.lastIndex=0,n.replaceAll(fi,t=>e(t))),ud=(n,e)=>(mi.lastIndex=0,pi.lastIndex=0,n.replaceAll(pi,(t,s,i)=>["_","-"].includes(n.charAt(i+t.length))?t:e(t)).replaceAll(mi,(t,s)=>e(s)));function dd(n,e){if(!(typeof n=="string"||Array.isArray(n)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(n)?n=n.map(r=>r.trim()).filter(r=>r.length).join("-"):n=n.trim(),n.length===0)return"";const t=e.locale===!1?r=>r.toLowerCase():r=>r.toLocaleLowerCase(e.locale),s=e.locale===!1?r=>r.toUpperCase():r=>r.toLocaleUpperCase(e.locale);return n.length===1?as.test(n)?"":e.pascalCase?s(n):t(n):(n!==t(n)&&(n=cd(n,t,s,e.preserveConsecutiveUppercase)),n=n.replace(od,""),n=e.preserveConsecutiveUppercase?ld(n,t):t(n),e.pascalCase&&(n=s(n.charAt(0))+n.slice(1)),ud(n,s))}class hd extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[t,s]of e)this.onEviction(t,s.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const s=t.get(e);return this._getItemValue(e,s)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,s]=e;this.cache.has(t)||this._deleteIfExpired(t,s)===!1&&(yield e)}for(const e of this.cache){const[t,s]=e;this._deleteIfExpired(t,s)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:s=this.maxAge}={}){const i=typeof s=="number"&&s!==Number.POSITIVE_INFINITY?Date.now()+s:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:i}):this._set(e,{value:t,expiry:i}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],s=t.length-e;s<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(s>0&&this._emitEvictions(t.slice(0,s)),this.oldCache=new Map(t.slice(s)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,s]=e;this._deleteIfExpired(t,s)===!1&&(yield[t,s.value])}for(const e of this.oldCache){const[t,s]=e;this.cache.has(t)||this._deleteIfExpired(t,s)===!1&&(yield[t,s.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const s=e[t],[i,r]=s;this._deleteIfExpired(i,r)===!1&&(yield[i,r.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const s=e[t],[i,r]=s;this.cache.has(i)||this._deleteIfExpired(i,r)===!1&&(yield[i,r.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[s,i]of this.entriesAscending())e.call(t,i,s,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}const fd=(n,e)=>n.some(t=>typeof t=="string"?t===e:(t.lastIndex=0,t.test(e))),Tn=new hd({maxSize:1e5}),gi=n=>typeof n=="object"&&n!==null&&!(n instanceof RegExp)&&!(n instanceof Error)&&!(n instanceof Date),_i=(n,e={})=>{if(!gi(n))return n;const{exclude:t,pascalCase:s=!1,stopPaths:i,deep:r=!1,preserveConsecutiveUppercase:a=!1}=e,o=new Set(i),l=u=>(c,d)=>{if(r&&gi(d)){const h=u===void 0?c:`${u}.${c}`;o.has(h)||(d=hi(d,l(h)))}if(!(t&&fd(t,c))){const h=s?`${c}_`:c;if(Tn.has(h))c=Tn.get(h);else{const g=dd(c,{pascalCase:s,locale:!1,preserveConsecutiveUppercase:a});c.length<100&&Tn.set(h,g),c=g}}return[c,d]};return hi(n,l(void 0))};function md(n,e){return Array.isArray(n)?Object.keys(n).map(t=>_i(n[t],e)):_i(n,e)}const pd="/twirp",ta="livekit";class na{constructor(e,t,s){e.startsWith("ws")&&(e=e.replace("ws","http")),this.host=e,this.pkg=t,this.prefix=s||pd}async request(e,t,s,i){const r=`${this.prefix}/${this.pkg}.${e}/${t}`,a=new URL(r,this.host),o=await fetch(a,{method:"POST",headers:Object.assign({"Content-Type":"application/json;charset=UTF-8"},i),body:JSON.stringify(s)});if(!o.ok)throw new Error(`Request failed with status ${o.status}: ${o.statusText}`);const l=await o.json();return md(l,{deep:!0})}}const re="Egress";class sa extends Qr{constructor(e,t,s){super(t,s),this.rpc=new na(e,ta)}async startRoomCompositeEgress(e,t,s,i,r,a,o){let l;if(s!==void 0)if(typeof s=="string")l=s;else{const S=s;l=S.layout,i=S.encodingOptions,r=S.audioOnly,a=S.videoOnly,o=S.customBaseUrl}l??(l=""),r??(r=!1),a??(a=!1),o??(o="");const{output:u,options:c,fileOutputs:d,streamOutputs:h,segmentOutputs:g,imageOutputs:m}=this.getOutputParams(t,i),T=new ns({roomName:e,layout:l,audioOnly:r,videoOnly:a,customBaseUrl:o,output:u,options:c,fileOutputs:d,streamOutputs:h,segmentOutputs:g,imageOutputs:m}).toJson(),p=await this.rpc.request(re,"StartRoomCompositeEgress",T,await this.authHeader({roomRecord:!0}));return oe.fromJson(p,{ignoreUnknownFields:!0})}async startWebEgress(e,t,s){const i=(s==null?void 0:s.audioOnly)||!1,r=(s==null?void 0:s.videoOnly)||!1,a=(s==null?void 0:s.awaitStartSignal)||!1,{output:o,options:l,fileOutputs:u,streamOutputs:c,segmentOutputs:d,imageOutputs:h}=this.getOutputParams(t,s==null?void 0:s.encodingOptions),g=new xr({url:e,audioOnly:i,videoOnly:r,awaitStartSignal:a,output:o,options:l,fileOutputs:u,streamOutputs:c,segmentOutputs:d,imageOutputs:h}).toJson(),m=await this.rpc.request(re,"StartWebEgress",g,await this.authHeader({roomRecord:!0}));return oe.fromJson(m,{ignoreUnknownFields:!0})}async startParticipantEgress(e,t,s,i){const{options:r,fileOutputs:a,streamOutputs:o,segmentOutputs:l,imageOutputs:u}=this.getOutputParams(s,i==null?void 0:i.encodingOptions),c=new Fr({roomName:e,identity:t,options:r,fileOutputs:a,streamOutputs:o,segmentOutputs:l,imageOutputs:u}).toJson(),d=await this.rpc.request(re,"StartParticipantEgress",c,await this.authHeader({roomRecord:!0}));return oe.fromJson(d,{ignoreUnknownFields:!0})}async startTrackCompositeEgress(e,t,s,i,r){let a;if(s!==void 0)if(typeof s=="string")a=s;else{const T=s;a=T.audioTrackId,i=T.videoTrackId,r=T.encodingOptions}a??(a=""),i??(i="");const{output:o,options:l,fileOutputs:u,streamOutputs:c,segmentOutputs:d,imageOutputs:h}=this.getOutputParams(t,r),g=new Ur({roomName:e,audioTrackId:a,videoTrackId:i,output:o,options:l,fileOutputs:u,streamOutputs:c,segmentOutputs:d,imageOutputs:h}).toJson(),m=await this.rpc.request(re,"StartTrackCompositeEgress",g,await this.authHeader({roomRecord:!0}));return oe.fromJson(m,{ignoreUnknownFields:!0})}isEncodedOutputs(e){return e.file!==void 0||e.stream!==void 0||e.segments!==void 0}isEncodedFileOutput(e){return e.filepath!==void 0||e.fileType!==void 0}isSegmentedFileOutput(e){return e.filenamePrefix!==void 0||e.playlistName!==void 0||e.filenameSuffix!==void 0}isStreamOutput(e){return e.protocol!==void 0||e.urls!==void 0}getOutputParams(e,t){let s,i,r,a,o,l,u;this.isEncodedOutputs(e)?(e.file!==void 0&&(i=[e.file]),e.stream!==void 0&&(a=[e.stream]),e.segments!==void 0&&(l=[e.segments]),e.images!==void 0&&(u=[e.images])):this.isEncodedFileOutput(e)?(s=e,i=[s]):this.isSegmentedFileOutput(e)?(o=e,l=[o]):this.isStreamOutput(e)&&(r=e,a=[r]);let c;s?c={case:"file",value:s}:r?c={case:"stream",value:r}:o&&(c={case:"segments",value:o});let d;return t&&(typeof t=="number"?d={case:"preset",value:t}:d={case:"advanced",value:t}),{output:c,options:d,fileOutputs:i,streamOutputs:a,segmentOutputs:l,imageOutputs:u}}async startTrackEgress(e,t,s){let i;typeof t=="string"?i={case:"websocketUrl",value:t}:i={case:"file",value:t};const r=new Br({roomName:e,trackId:s,output:i}).toJson(),a=await this.rpc.request(re,"StartTrackEgress",r,await this.authHeader({roomRecord:!0}));return oe.fromJson(a,{ignoreUnknownFields:!0})}async updateLayout(e,t){const s=await this.rpc.request(re,"UpdateLayout",new Yl({egressId:e,layout:t}).toJson(),await this.authHeader({roomRecord:!0}));return oe.fromJson(s,{ignoreUnknownFields:!0})}async updateStream(e,t,s){t??(t=[]),s??(s=[]);const i=await this.rpc.request(re,"UpdateStream",new Xl({egressId:e,addOutputUrls:t,removeOutputUrls:s}).toJson(),await this.authHeader({roomRecord:!0}));return oe.fromJson(i,{ignoreUnknownFields:!0})}async listEgress(e){var t;let s={};typeof e=="string"?s.roomName=e:e!==void 0&&(s=e);const i=await this.rpc.request(re,"ListEgress",new Ql(s).toJson(),await this.authHeader({roomRecord:!0}));return(t=Zl.fromJson(i,{ignoreUnknownFields:!0}).items)!==null&&t!==void 0?t:[]}async stopEgress(e){const t=await this.rpc.request(re,"StopEgress",new eu({egressId:e}).toJson(),await this.authHeader({roomRecord:!0}));return oe.fromJson(t,{ignoreUnknownFields:!0})}}const Y="RoomService";class gd extends Qr{constructor(e,t,s){super(t,s),this.rpc=new na(e,ta)}async createRoom(e){const t=await this.rpc.request(Y,"CreateRoom",new ou(e).toJson(),await this.authHeader({roomCreate:!0}));return Fn.fromJson(t,{ignoreUnknownFields:!0})}async listRooms(e){var t;const s=await this.rpc.request(Y,"ListRooms",new uu({names:e??[]}).toJson(),await this.authHeader({roomList:!0}));return(t=du.fromJson(s,{ignoreUnknownFields:!0}).rooms)!==null&&t!==void 0?t:[]}async deleteRoom(e){await this.rpc.request(Y,"DeleteRoom",new hu({room:e}).toJson(),await this.authHeader({roomCreate:!0}))}async updateRoomMetadata(e,t){const s=await this.rpc.request(Y,"UpdateRoomMetadata",new Eu({room:e,metadata:t}).toJson(),await this.authHeader({roomAdmin:!0,room:e}));return Fn.fromJson(s,{ignoreUnknownFields:!0})}async listParticipants(e){var t;const s=await this.rpc.request(Y,"ListParticipants",new fu({room:e}).toJson(),await this.authHeader({roomAdmin:!0,room:e}));return(t=mu.fromJson(s,{ignoreUnknownFields:!0}).participants)!==null&&t!==void 0?t:[]}async getParticipant(e,t){const s=await this.rpc.request(Y,"GetParticipant",new ci({room:e,identity:t}).toJson(),await this.authHeader({roomAdmin:!0,room:e}));return Un.fromJson(s,{ignoreUnknownFields:!0})}async removeParticipant(e,t){await this.rpc.request(Y,"RemoveParticipant",new ci({room:e,identity:t}).toJson(),await this.authHeader({roomAdmin:!0,room:e}))}async mutePublishedTrack(e,t,s,i){const r=new pu({room:e,identity:t,trackSid:s,muted:i}).toJson(),a=await this.rpc.request(Y,"MutePublishedTrack",r,await this.authHeader({roomAdmin:!0,room:e}));return gu.fromJson(a,{ignoreUnknownFields:!0}).track}async updateParticipant(e,t,s,i,r){const a=typeof s=="object",o=a?s==null?void 0:s.metadata:s,l=a?s.permission:i,u=a?s.name:r,c=a?s.attributes:{},d=new _u({room:e,identity:t,attributes:c,metadata:o,name:u});l&&(d.permission=new ts(l));const h=await this.rpc.request(Y,"UpdateParticipant",d.toJson(),await this.authHeader({roomAdmin:!0,room:e}));return Un.fromJson(h,{ignoreUnknownFields:!0})}async updateSubscriptions(e,t,s,i){const r=new yu({room:e,identity:t,trackSids:s,subscribe:i,participantTracks:[]}).toJson();await this.rpc.request(Y,"UpdateSubscriptions",r,await this.authHeader({roomAdmin:!0,room:e}))}async sendData(e,t,s,i={}){const r=Array.isArray(i)?i:i.destinationSids,a=Array.isArray(i)?void 0:i.topic,o=new Tu({room:e,data:t,kind:s,destinationSids:r??[],topic:a});!Array.isArray(i)&&i.destinationIdentities&&(o.destinationIdentities=i.destinationIdentities),await this.rpc.request(Y,"SendData",o.toJson(),await this.authHeader({roomAdmin:!0,room:e}))}}const _d=16,yd=12;function Td(n){let e=new TextEncoder;return window.crypto.subtle.importKey("raw",e.encode(n),{name:"PBKDF2"},!1,["deriveBits","deriveKey"])}function Ed(n,e){return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:e,iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async function Sd(n,e){const t=window.crypto.getRandomValues(new Uint8Array(_d)),s=window.crypto.getRandomValues(new Uint8Array(yd));let i=Ui(n),r=await Td(e),a=await Ed(r,t);const o=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:s},a,i);return{salt:En(new Uint8Array(t)),iv:En(new Uint8Array(s)),encryptedText:En(new Uint8Array(o))}}const ae=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];function En(n){let e="",t,s=n.length;for(t=2;t<s;t+=3)e+=ae[n[t-2]>>2],e+=ae[(n[t-2]&3)<<4|n[t-1]>>4],e+=ae[(n[t-1]&15)<<2|n[t]>>6],e+=ae[n[t]&63];return t===s+1&&(e+=ae[n[t-2]>>2],e+=ae[(n[t-2]&3)<<4],e+="=="),t===s&&(e+=ae[n[t-2]>>2],e+=ae[(n[t-2]&3)<<4|n[t-1]>>4],e+=ae[(n[t-1]&15)<<2],e+="="),e}const le=n=>{const e=console.error;Object.assign(console,{error:(...s)=>{(!s[0]||!s[0].toString||!s[0].toString().includes("You should not include your API secret in your web client bundle"))&&e.apply(console,s)}});const t=n();return Object.assign(console,{error:e}),t},os=(n,e,t)=>le(()=>new Xr(n,e,t));async function wd(n,e,t){const s=os(n,e,{identity:t,ttl:86400});return s.addGrant({room:t,roomJoin:!0,roomCreate:!0,roomAdmin:!0,roomList:!0,canPublish:!0,canSubscribe:!1,canPublishData:!0,canUpdateOwnMetadata:!0}),await s.toJwt()}async function bd(n,e){const{encryptedText:t,iv:s,salt:i}=await Sd(n,e);return{salt:i,iv:s,token:t}}async function kd(n,e,t,s){const i=os(n,e,{identity:s,name:s,ttl:21600});return i.addGrant({room:t,roomList:!0,roomJoin:!0,canPublish:!1,canSubscribe:!0,canPublishData:!0,canUpdateOwnMetadata:!1}),await i.toJwt()}async function Rd(n,e){const t=os(n,e,{identity:"lt",ttl:94608e5});return t.addGrant({roomList:!0,roomJoin:!1,canPublish:!1,canSubscribe:!1,canPublishData:!1,canUpdateOwnMetadata:!1}),await t.toJwt()}class Cd{constructor(){E(this,"_twitchStreamKey");E(this,"_egressClient");E(this,"roomName");E(this,"streamEgressID")}init(e,t,s,i){this.roomName=t,this._twitchStreamKey=e,this._egressClient=new sa("https://rov-web.livekit.cloud",s,i)}async listRunningEgress(){if(!this._egressClient)throw new Error("Egress client not initialized!");return await this._egressClient.listEgress({active:!0})}isAnotherEgressRunning(e){return e.filter(t=>!this.streamEgressID||t.egressId!=this.streamEgressID).length>0}getCurrentEgress(e){return e.find(t=>t.roomName==this.roomName)}async closeOtherEgresses(e){return this._egressClient?Promise.allSettled(e.filter(t=>!this.streamEgressID||t.egressId!==this.streamEgressID).map(async t=>!this._egressClient||!t.egressId?!1:(x("Closing egress: ",t),await this._egressClient.stopEgress(t.egressId)))):!1}async startStream(){if(!this._twitchStreamKey||!this._egressClient||!this.roomName)return I("startStream() err: Twitch stream key not set or twitchStream class not initilized!");let e=await le(()=>this.listRunningEgress()),t=this.getCurrentEgress(e);if(t!==void 0){x("Found current twitch egress: ",t),this.streamEgressID=t.egressId;return}else{for(;await this.isAnotherEgressRunning(e)==!0;){const r=await this.closeOtherEgresses(e);if(v("egressCloseStates",r),x("Another twitch stream is running, waiting 2 seconds to try again..."),await mt(2e3),e=await this.listRunningEgress(),t=this.getCurrentEgress(e),t!==void 0){x("Found current twitch egress: ",t),this.streamEgressID=t.egressId;return}}const i=new we({protocol:Dr.RTMP,urls:["rtmp://live.twitch.tv/app/"+this._twitchStreamKey]});var s=await le(()=>{var r;return(r=this._egressClient)==null?void 0:r.startRoomCompositeEgress(this.roomName,i)});this.streamEgressID=s.egressId,v("Twitch stream started: ",s)}}async stopStream(){if(!this._egressClient)return I("stopStream() err: Twitch Stream not started!");const e=this.streamEgressID;if(this.streamEgressID=void 0,e){const i=await le(()=>{var r;return(r=this==null?void 0:this._egressClient)==null?void 0:r.stopEgress(e)});v("Twitch stream stopped: ",i)}const t=await le(()=>this.listRunningEgress()),s=this.getCurrentEgress(t);if(s){v("Egress still running: ",s);const i=await le(()=>{var r;return(r=this==null?void 0:this._egressClient)==null?void 0:r.stopEgress(s.egressId)});v("Twitch stream stopped: ",i)}this.streamEgressID=void 0}}const jt=new Cd;let Sn=null,wn=!1,ia=!1,it=0,bn=1;function Ad(n,e){var t,s,i,r,a,o,l,u,c,d,h;if(e.Ping)return q.sendMessage(D.RovResponse.create({Pong:{Time:e.Ping.Time}}),!1,[n]),te.sendMessage(no()),!0;if(e.SimplePeerSignal&&e.SimplePeerSignal.Message){const g=e.SimplePeerSignal.Message;return q.ingestSimplePeerSignalMsg(n,g),!0}else if(e.Move){if(Sn&&Sn!==n||!wn)return!1;ia||te.sendMessage(Is());let g=(e.Move.VelocityX||0)*1e3,m=(e.Move.VelocityY||0)*1e3,T=(e.Move.VelocityZ||0)*500+500,p=(e.Move.AngularVelocityYaw||0)*500,S=e.Move.ButtonBitmask||0;return te.sendMessage(so(g,m,T,p,S)),!0}else{if(e.ShutdownRov)return js("poweroff").then(g=>{q.sendMessage(D.RovResponse.create({ExchangeId:e.ExchangeId,Done:{Message:g}}),!1,[])}).catch(g=>{q.sendMessage(D.RovResponse.create({ExchangeId:e.ExchangeId,Error:{Message:g.message}}),!1,[])}),!0;if(e.RebootRov)return js("reboot").then(g=>{q.sendMessage(D.RovResponse.create({ExchangeId:e.ExchangeId,Done:{Message:g}}),!1,[])}).catch(g=>{q.sendMessage(D.RovResponse.create({ExchangeId:e.ExchangeId,Error:{Message:g.message}}),!1,[])}),!0;if(e.MoveClaw)return v("Setting servo ",it," of group ",bn," to ",.25),te.sendMessage(io(it,.25,bn)),it==7?(it=0,bn++):it++,!0;if(e.SetAutopilotMode)return te.sendMessage(to(e.SetAutopilotMode.mode)),!0;if(e.Disarm)return te.sendMessage(Za()),wn=!1,!0;if(e.TakeControl)return Sn=n,q.sendMessage(D.RovResponse.create({PilotChanged:{PilotIdentity:n}}),!1,[]),wn=!0,te.sendMessage(Is()),!0;if(e.SendRovLogs){const g={};return g[Ze.Console]=D.LogLevel.Debug,g[Ze.Debug]=D.LogLevel.Debug,g[Ze.Info]=D.LogLevel.Info,g[Ze.Warn]=D.LogLevel.Warning,g[Ze.Error]=D.LogLevel.Error,Jt.sendQueuedLogs((m,T)=>{const p=D.RovResponse.create({LogMessage:{Level:g[m],Message:T}});return q.sendMessage(p,!0,[])}),!0}else if(e.SetLivestreamingEnabled)e.SetLivestreamingEnabled.Enabled?jt.startStream():jt.stopStream();else if(e.SetLivekitVideoOptions){const g=rt.videoCaptureDefaults,m=rt.publishDefaults,T=e.SetLivekitVideoOptions,p=T.BaseStream;if(!T.Enabled)return q.setLivekitVideoOptions(!1),!0;v("Got Livekit Video Options: ",T);const S=16/9,k={...g,resolution:{width:(p==null?void 0:p.Width)||Math.floor(((p==null?void 0:p.Height)||0)*S)||((t=g==null?void 0:g.resolution)==null?void 0:t.width)||1920,height:(p==null?void 0:p.Height)||Math.floor(((p==null?void 0:p.Width)||0)/S)||((s=g==null?void 0:g.resolution)==null?void 0:s.height)||1080,frameRate:(p==null?void 0:p.Fps)||((i=g==null?void 0:g.resolution)==null?void 0:i.frameRate)},facingMode:g==null?void 0:g.facingMode},b=T.SimulcastLayers?T.SimulcastLayers.map((P,z)=>{var Re,Ts,Es,Ss;const B=m!=null&&m.videoSimulcastLayers?m==null?void 0:m.videoSimulcastLayers[z]:void 0;return{encoding:{maxBitrate:P.MaxBitrate??(p==null?void 0:p.MaxBitrate)??((Re=B==null?void 0:B.encoding)==null?void 0:Re.maxBitrate)??99e9,maxFramerate:P.Fps||((Ts=B==null?void 0:B.encoding)==null?void 0:Ts.maxFramerate),priority:"high"},width:P.Width||(P.Height?Math.floor(P.Height*S):null)||(B==null?void 0:B.width)||((Es=g==null?void 0:g.resolution)==null?void 0:Es.width),height:P.Height||(P.Width?Math.floor(P.Width/S):null)||(B==null?void 0:B.height)||((Ss=g==null?void 0:g.resolution)==null?void 0:Ss.height)}}):m==null?void 0:m.videoSimulcastLayers,C=T.Codec!==null&&T.Codec!==void 0?T.Codec:m==null?void 0:m.videoCodec,N={...m,videoCodec:C,videoEncoding:{maxBitrate:(p==null?void 0:p.MaxBitrate)??((r=m==null?void 0:m.videoEncoding)==null?void 0:r.maxBitrate)??99e9,maxFramerate:(p==null?void 0:p.Fps)||((a=m==null?void 0:m.videoEncoding)==null?void 0:a.maxFramerate),priority:(o=m==null?void 0:m.videoEncoding)==null?void 0:o.priority},backupCodec:T.AllowBackupCodec??(m==null?void 0:m.backupCodec),simulcast:T.SimulcastLayers?T.SimulcastLayers.length>0:m==null?void 0:m.simulcast,videoSimulcastLayers:b};return console.log("Setting Livekit Video Options: ",k,N),q.setLivekitVideoOptions(!0,k,N),!0}else if(e.SetSimplePeerVideoOptions){const g=rt.videoCaptureDefaults,m=rt.publishDefaults,T=e.SetSimplePeerVideoOptions,p=T.BaseStream;if(v("Got SimplePeer Video Options: ",T),!T.Enabled)return q.setSimplePeerVideoOptions(!1,n),!0;const S=16/9,k={...g,resolution:{width:Math.floor(((p==null?void 0:p.Height)||((l=g==null?void 0:g.resolution)==null?void 0:l.height)||0)*S),height:(p==null?void 0:p.Height)||((u=g==null?void 0:g.resolution)==null?void 0:u.height)||0,frameRate:(p==null?void 0:p.Fps)||((c=g==null?void 0:g.resolution)==null?void 0:c.frameRate)||60},facingMode:g==null?void 0:g.facingMode},C={videoCodec:T.Codec?T.Codec:m==null?void 0:m.videoCodec,videoEncoding:{maxBitrate:(p==null?void 0:p.MaxBitrate)||((d=m==null?void 0:m.videoEncoding)==null?void 0:d.maxBitrate)||0,maxFramerate:(p==null?void 0:p.Fps)||((h=m==null?void 0:m.videoEncoding)==null?void 0:h.maxFramerate)}};return q.setSimplePeerVideoOptions(!0,n,k,C),!0}else return I("Unknown Message Recived: ",e.toJSON()),!1}}function yi(n,e){let t=new Uint8Array(e);if(!t||t.length===0)return;const s=D.RovAction.decode(t);if(Ad(n,s))return;s.BackendMetadata=s.BackendMetadata||new D.ActionBackendMetadata,s.BackendMetadata.FromUserId=n;const i=D.RovAction.encode(s).finish();Bt.isConnected&&Bt.sendMessage(i)}function vd(n){if(!n||!n.message)return;const e=n.message;e.type&&e.type==="HEARTBEAT"&&(ia=!!(e.base_mode.bits&vn.MAV_MODE_FLAG_SAFETY_ARMED))}let qe=[];function ue(n){let e=[],t=(a,o=!0)=>(e.includes(a)||e.push(a),o&&a(n),()=>{e=e.filter(l=>l!=a)});function s(a){if(a===n&&(n===null||typeof n!="object"))return;let o=n;n=a;for(let l of e)l(n,o)}function i(){let a=qe[qe.length-1];return a&&t(a[0],!1),n}if(typeof n=="function")return Id(n);function r(){for(let a of e)a(n,n)}return{subscribe:t,set:s,get:i,refresh:r,update:a=>{typeof a=="function"&&s(a(n))}}}function Id(n){let e=ue(null),t=[s];return s(),e;function s(){if(qe.includes(t))throw Error("Circular computation");qe.push(t);let i;try{i=n()}catch(r){throw qe.pop(),r}qe.pop(),e.set(i)}}var Vn={exports:{}},kn,Ti;function Nd(){if(Ti)return kn;Ti=1;var n=1e3,e=n*60,t=e*60,s=t*24,i=s*7,r=s*365.25;kn=function(c,d){d=d||{};var h=typeof c;if(h==="string"&&c.length>0)return a(c);if(h==="number"&&isFinite(c))return d.long?l(c):o(c);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(c))};function a(c){if(c=String(c),!(c.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(c);if(d){var h=parseFloat(d[1]),g=(d[2]||"ms").toLowerCase();switch(g){case"years":case"year":case"yrs":case"yr":case"y":return h*r;case"weeks":case"week":case"w":return h*i;case"days":case"day":case"d":return h*s;case"hours":case"hour":case"hrs":case"hr":case"h":return h*t;case"minutes":case"minute":case"mins":case"min":case"m":return h*e;case"seconds":case"second":case"secs":case"sec":case"s":return h*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function o(c){var d=Math.abs(c);return d>=s?Math.round(c/s)+"d":d>=t?Math.round(c/t)+"h":d>=e?Math.round(c/e)+"m":d>=n?Math.round(c/n)+"s":c+"ms"}function l(c){var d=Math.abs(c);return d>=s?u(c,d,s,"day"):d>=t?u(c,d,t,"hour"):d>=e?u(c,d,e,"minute"):d>=n?u(c,d,n,"second"):c+" ms"}function u(c,d,h,g){var m=d>=h*1.5;return Math.round(c/h)+" "+g+(m?"s":"")}return kn}function Od(n){t.debug=t,t.default=t,t.coerce=l,t.disable=r,t.enable=i,t.enabled=a,t.humanize=Nd(),t.destroy=u,Object.keys(n).forEach(c=>{t[c]=n[c]}),t.names=[],t.skips=[],t.formatters={};function e(c){let d=0;for(let h=0;h<c.length;h++)d=(d<<5)-d+c.charCodeAt(h),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(c){let d,h=null,g,m;function T(...p){if(!T.enabled)return;const S=T,k=Number(new Date),b=k-(d||k);S.diff=b,S.prev=d,S.curr=k,d=k,p[0]=t.coerce(p[0]),typeof p[0]!="string"&&p.unshift("%O");let C=0;p[0]=p[0].replace(/%([a-zA-Z%])/g,(P,z)=>{if(P==="%%")return"%";C++;const B=t.formatters[z];if(typeof B=="function"){const Re=p[C];P=B.call(S,Re),p.splice(C,1),C--}return P}),t.formatArgs.call(S,p),(S.log||t.log).apply(S,p)}return T.namespace=c,T.useColors=t.useColors(),T.color=t.selectColor(c),T.extend=s,T.destroy=t.destroy,Object.defineProperty(T,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(g!==t.namespaces&&(g=t.namespaces,m=t.enabled(c)),m),set:p=>{h=p}}),typeof t.init=="function"&&t.init(T),T}function s(c,d){const h=t(this.namespace+(typeof d>"u"?":":d)+c);return h.log=this.log,h}function i(c){t.save(c),t.namespaces=c,t.names=[],t.skips=[];let d;const h=(typeof c=="string"?c:"").split(/[\s,]+/),g=h.length;for(d=0;d<g;d++)h[d]&&(c=h[d].replace(/\*/g,".*?"),c[0]==="-"?t.skips.push(new RegExp("^"+c.slice(1)+"$")):t.names.push(new RegExp("^"+c+"$")))}function r(){const c=[...t.names.map(o),...t.skips.map(o).map(d=>"-"+d)].join(",");return t.enable(""),c}function a(c){if(c[c.length-1]==="*")return!0;let d,h;for(d=0,h=t.skips.length;d<h;d++)if(t.skips[d].test(c))return!1;for(d=0,h=t.names.length;d<h;d++)if(t.names[d].test(c))return!0;return!1}function o(c){return c.toString().substring(2,c.toString().length-2).replace(/\.\*\?$/,"*")}function l(c){return c instanceof Error?c.stack||c.message:c}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var Pd=Od;(function(n,e){e.formatArgs=s,e.save=i,e.load=r,e.useColors=t,e.storage=a(),e.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let l;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(l=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(l[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;l.splice(1,0,u,"color: inherit");let c=0,d=0;l[0].replace(/%[a-zA-Z%]/g,h=>{h!=="%%"&&(c++,h==="%c"&&(d=c))}),l.splice(d,0,u)}e.log=console.debug||console.log||(()=>{});function i(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch{}}function r(){let l;try{l=e.storage.getItem("debug")}catch{}return!l&&typeof ye.process<"u"&&"env"in ye.process&&(l={}.DEBUG),l}function a(){try{return localStorage}catch{}}n.exports=Pd(e);const{formatters:o}=n.exports;o.j=function(l){try{return JSON.stringify(l)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(Vn,Vn.exports);var Ld=Vn.exports;const Md=Bi(Ld),de=typeof window<"u"?window:self,Kn=de.RTCPeerConnection||de.mozRTCPeerConnection||de.webkitRTCPeerConnection,Dd=de.RTCSessionDescription||de.mozRTCSessionDescription||de.webkitRTCSessionDescription,xd=de.RTCIceCandidate||de.mozRTCIceCandidate||de.webkitRTCIceCandidate;var cs={exports:{}},$e=typeof Reflect=="object"?Reflect:null,Ei=$e&&typeof $e.apply=="function"?$e.apply:function(e,t,s){return Function.prototype.apply.call(e,t,s)},Ut;$e&&typeof $e.ownKeys=="function"?Ut=$e.ownKeys:Object.getOwnPropertySymbols?Ut=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Ut=function(e){return Object.getOwnPropertyNames(e)};function Fd(n){console&&console.warn&&console.warn(n)}var ra=Number.isNaN||function(e){return e!==e};function A(){A.init.call(this)}cs.exports=A;cs.exports.once=Vd;A.EventEmitter=A;A.prototype._events=void 0;A.prototype._eventsCount=0;A.prototype._maxListeners=void 0;var Si=10;function nn(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(A,"defaultMaxListeners",{enumerable:!0,get:function(){return Si},set:function(n){if(typeof n!="number"||n<0||ra(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");Si=n}});A.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};A.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||ra(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function aa(n){return n._maxListeners===void 0?A.defaultMaxListeners:n._maxListeners}A.prototype.getMaxListeners=function(){return aa(this)};A.prototype.emit=function(e){for(var t=[],s=1;s<arguments.length;s++)t.push(arguments[s]);var i=e==="error",r=this._events;if(r!==void 0)i=i&&r.error===void 0;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var l=r[e];if(l===void 0)return!1;if(typeof l=="function")Ei(l,this,t);else for(var u=l.length,c=da(l,u),s=0;s<u;++s)Ei(c[s],this,t);return!0};function oa(n,e,t,s){var i,r,a;if(nn(t),r=n._events,r===void 0?(r=n._events=Object.create(null),n._eventsCount=0):(r.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),r=n._events),a=r[e]),a===void 0)a=r[e]=t,++n._eventsCount;else if(typeof a=="function"?a=r[e]=s?[t,a]:[a,t]:s?a.unshift(t):a.push(t),i=aa(n),i>0&&a.length>i&&!a.warned){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=n,o.type=e,o.count=a.length,Fd(o)}return n}A.prototype.addListener=function(e,t){return oa(this,e,t,!1)};A.prototype.on=A.prototype.addListener;A.prototype.prependListener=function(e,t){return oa(this,e,t,!0)};function Ud(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ca(n,e,t){var s={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},i=Ud.bind(s);return i.listener=t,s.wrapFn=i,i}A.prototype.once=function(e,t){return nn(t),this.on(e,ca(this,e,t)),this};A.prototype.prependOnceListener=function(e,t){return nn(t),this.prependListener(e,ca(this,e,t)),this};A.prototype.removeListener=function(e,t){var s,i,r,a,o;if(nn(t),i=this._events,i===void 0)return this;if(s=i[e],s===void 0)return this;if(s===t||s.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,s.listener||t));else if(typeof s!="function"){for(r=-1,a=s.length-1;a>=0;a--)if(s[a]===t||s[a].listener===t){o=s[a].listener,r=a;break}if(r<0)return this;r===0?s.shift():Bd(s,r),s.length===1&&(i[e]=s[0]),i.removeListener!==void 0&&this.emit("removeListener",e,o||t)}return this};A.prototype.off=A.prototype.removeListener;A.prototype.removeAllListeners=function(e){var t,s,i;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[e]),this;if(arguments.length===0){var r=Object.keys(s),a;for(i=0;i<r.length;++i)a=r[i],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=s[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function la(n,e,t){var s=n._events;if(s===void 0)return[];var i=s[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?Hd(i):da(i,i.length)}A.prototype.listeners=function(e){return la(this,e,!0)};A.prototype.rawListeners=function(e){return la(this,e,!1)};A.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):ua.call(n,e)};A.prototype.listenerCount=ua;function ua(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}A.prototype.eventNames=function(){return this._eventsCount>0?Ut(this._events):[]};function da(n,e){for(var t=new Array(e),s=0;s<e;++s)t[s]=n[s];return t}function Bd(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function Hd(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function Vd(n,e){return new Promise(function(t,s){function i(a){n.removeListener(e,r),s(a)}function r(){typeof n.removeListener=="function"&&n.removeListener("error",i),t([].slice.call(arguments))}ha(n,e,r,{once:!0}),e!=="error"&&Kd(n,i,{once:!0})})}function Kd(n,e,t){typeof n.on=="function"&&ha(n,"error",e,t)}function ha(n,e,t,s){if(typeof n.on=="function")s.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function i(r){s.once&&n.removeEventListener(e,i),t(r)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var qd=cs.exports,$d=typeof queueMicrotask=="function"?queueMicrotask:n=>Promise.resolve().then(n),Wd=class{constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return this.buffer[this.btm]===void 0}};const wi=Wd;var jd=class{constructor(e){this.hwm=e||16,this.head=new wi(this.hwm),this.tail=this.head,this.length=0}clear(){this.head=this.tail,this.head.clear(),this.length=0}push(e){if(this.length++,!this.head.push(e)){const t=this.head;this.head=t.next=new wi(2*this.head.buffer.length),this.head.push(e)}}shift(){this.length!==0&&this.length--;const e=this.tail.shift();if(e===void 0&&this.tail.next){const t=this.tail.next;return this.tail.next=null,this.tail=t,this.tail.shift()}return e}peek(){const e=this.tail.peek();return e===void 0&&this.tail.next?this.tail.next.peek():e}isEmpty(){return this.length===0}},fa=class{constructor(e){this.decoder=new TextDecoder(e==="utf16le"?"utf16-le":e)}decode(e){return this.decoder.decode(e,{stream:!0})}flush(){return this.decoder.decode(new Uint8Array(0))}};const Jd=fa,Gd=fa;var zd=class{constructor(e="utf8"){switch(this.encoding=Yd(e),this.encoding){case"utf8":this.decoder=new Gd;break;case"utf16le":case"base64":throw new Error("Unsupported encoding: "+this.encoding);default:this.decoder=new Jd(this.encoding)}}push(e){return typeof e=="string"?e:this.decoder.decode(e)}write(e){return this.push(e)}end(e){let t="";return e&&(t=this.push(e)),t+=this.decoder.flush(),t}};function Yd(n){switch(n=n.toLowerCase(),n){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return n;default:throw new Error("Unknown encoding: "+n)}}const{EventEmitter:Xd}=qd,sn=new Error("Stream was destroyed"),Rn=new Error("Premature close"),ma=$d,pa=jd,Qd=zd,M=(1<<29)-1,xe=1,ls=2,Oe=4,lt=8,ga=M^xe,Zd=M^ls,wt=16,ut=32,Qe=64,_e=128,bt=256,us=512,Pe=1024,qn=2048,ds=4096,hs=8192,Q=16384,We=32768,rn=65536,Le=131072,_a=bt|us,eh=wt|rn,th=Qe|wt,nh=ds|_e,fs=bt|Le,sh=M^wt,ih=M^Qe,rh=M^(Qe|rn),bi=M^rn,ah=M^bt,oh=M^(_e|hs),ch=M^Pe,ki=M^_a,ya=M^We,lh=M^ut,Ta=M^Le,uh=M^fs,ke=1<<18,Ge=2<<18,kt=4<<18,Me=8<<18,Rt=16<<18,Fe=32<<18,$n=64<<18,je=128<<18,ms=256<<18,ze=512<<18,an=1024<<18,Ea=M^(ke|ms),Sa=M^kt,dh=M^ze,hh=M^Rt,fh=M^Me,wa=M^je,mh=M^Ge,ba=M^an,dt=wt|ke,ka=M^dt,ps=Q|Fe,he=Oe|lt|ls,G=he|xe,Ra=he|ps,ph=Sa&ih,gs=je|We,gh=gs&ka,Ca=G|gh,_h=G|Pe|Q,Ri=G|Q|_e,yh=G|Pe|_e,Th=G|ds|_e|hs,Eh=G|wt|Pe|Q|rn|Le,Sh=he|Pe|Q,wh=ut|G|We|Qe,bh=G|ze|Fe,kh=Me|Rt,Aa=Me|ke,Rh=Me|Rt|G|ke,Ci=G|ke|Me|an,Ch=kt|ke,Ah=ke|ms,vh=G|ze|Aa|Fe,Ih=Rt|he|ze|Fe,Nh=Ge|G|je|kt,vt=Symbol.asyncIterator||Symbol("asyncIterator");class va{constructor(e,{highWaterMark:t=16384,map:s=null,mapWritable:i,byteLength:r,byteLengthWritable:a}={}){this.stream=e,this.queue=new pa,this.highWaterMark=t,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=a||r||Da,this.map=i||s,this.afterWrite=xh.bind(this),this.afterUpdateNextTick=Bh.bind(this)}get ended(){return(this.stream._duplexState&Fe)!==0}push(e){return this.map!==null&&(e=this.map(e)),this.buffered+=this.byteLength(e),this.queue.push(e),this.buffered<this.highWaterMark?(this.stream._duplexState|=Me,!0):(this.stream._duplexState|=kh,!1)}shift(){const e=this.queue.shift();return this.buffered-=this.byteLength(e),this.buffered===0&&(this.stream._duplexState&=fh),e}end(e){typeof e=="function"?this.stream.once("finish",e):e!=null&&this.push(e),this.stream._duplexState=(this.stream._duplexState|ze)&Sa}autoBatch(e,t){const s=[],i=this.stream;for(s.push(e);(i._duplexState&Ci)===Aa;)s.push(i._writableState.shift());if(i._duplexState&G)return t(null);i._writev(s,t)}update(){const e=this.stream;e._duplexState|=Ge;do{for(;(e._duplexState&Ci)===Me;){const t=this.shift();e._duplexState|=Ah,e._write(t,this.afterWrite)}e._duplexState&Ch||this.updateNonPrimary()}while(this.continueUpdate()===!0);e._duplexState&=mh}updateNonPrimary(){const e=this.stream;if((e._duplexState&vh)===ze){e._duplexState=(e._duplexState|ke)&dh,e._final(Dh.bind(this));return}if((e._duplexState&he)===Oe){e._duplexState&gs||(e._duplexState|=dt,e._destroy(Ia.bind(this)));return}(e._duplexState&Ca)===xe&&(e._duplexState=(e._duplexState|dt)&ga,e._open(Na.bind(this)))}continueUpdate(){return this.stream._duplexState&je?(this.stream._duplexState&=wa,!0):!1}updateCallback(){(this.stream._duplexState&Nh)===kt?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&je||(this.stream._duplexState|=je,this.stream._duplexState&Ge||ma(this.afterUpdateNextTick))}}class Oh{constructor(e,{highWaterMark:t=16384,map:s=null,mapReadable:i,byteLength:r,byteLengthReadable:a}={}){this.stream=e,this.queue=new pa,this.highWaterMark=t===0?1:t,this.buffered=0,this.readAhead=t>0,this.error=null,this.pipeline=null,this.byteLength=a||r||Da,this.map=i||s,this.pipeTo=null,this.afterRead=Fh.bind(this),this.afterUpdateNextTick=Uh.bind(this)}get ended(){return(this.stream._duplexState&Q)!==0}pipe(e,t){if(this.pipeTo!==null)throw new Error("Can only pipe to one destination");if(typeof t!="function"&&(t=null),this.stream._duplexState|=us,this.pipeTo=e,this.pipeline=new Lh(this.stream,e,t),t&&this.stream.on("error",Ai),ft(e))e._writableState.pipeline=this.pipeline,t&&e.on("error",Ai),e.on("finish",this.pipeline.finished.bind(this.pipeline));else{const s=this.pipeline.done.bind(this.pipeline,e),i=this.pipeline.done.bind(this.pipeline,e,null);e.on("error",s),e.on("close",i),e.on("finish",this.pipeline.finished.bind(this.pipeline))}e.on("drain",Mh.bind(this)),this.stream.emit("piping",e),e.emit("pipe",this.stream)}push(e){const t=this.stream;return e===null?(this.highWaterMark=0,t._duplexState=(t._duplexState|Pe)&rh,!1):this.map!==null&&(e=this.map(e),e===null)?(t._duplexState&=bi,this.buffered<this.highWaterMark):(this.buffered+=this.byteLength(e),this.queue.push(e),t._duplexState=(t._duplexState|_e)&bi,this.buffered<this.highWaterMark)}shift(){const e=this.queue.shift();return this.buffered-=this.byteLength(e),this.buffered===0&&(this.stream._duplexState&=oh),e}unshift(e){const t=[this.map!==null?this.map(e):e];for(;this.buffered>0;)t.push(this.shift());for(let s=0;s<t.length-1;s++){const i=t[s];this.buffered+=this.byteLength(i),this.queue.push(i)}this.push(t[t.length-1])}read(){const e=this.stream;if((e._duplexState&Ri)===_e){const t=this.shift();return this.pipeTo!==null&&this.pipeTo.write(t)===!1&&(e._duplexState&=ki),e._duplexState&qn&&e.emit("data",t),t}return this.readAhead===!1&&(e._duplexState|=Le,this.updateNextTick()),null}drain(){const e=this.stream;for(;(e._duplexState&Ri)===_e&&e._duplexState&_a;){const t=this.shift();this.pipeTo!==null&&this.pipeTo.write(t)===!1&&(e._duplexState&=ki),e._duplexState&qn&&e.emit("data",t)}}update(){const e=this.stream;e._duplexState|=ut;do{for(this.drain();this.buffered<this.highWaterMark&&(e._duplexState&Eh)===Le;)e._duplexState|=eh,e._read(this.afterRead),this.drain();(e._duplexState&Th)===nh&&(e._duplexState|=hs,e.emit("readable")),e._duplexState&th||this.updateNonPrimary()}while(this.continueUpdate()===!0);e._duplexState&=lh}updateNonPrimary(){const e=this.stream;if((e._duplexState&yh)===Pe&&(e._duplexState=(e._duplexState|Q)&ch,e.emit("end"),(e._duplexState&Ra)===ps&&(e._duplexState|=Oe),this.pipeTo!==null&&this.pipeTo.end()),(e._duplexState&he)===Oe){e._duplexState&gs||(e._duplexState|=dt,e._destroy(Ia.bind(this)));return}(e._duplexState&Ca)===xe&&(e._duplexState=(e._duplexState|dt)&ga,e._open(Na.bind(this)))}continueUpdate(){return this.stream._duplexState&We?(this.stream._duplexState&=ya,!0):!1}updateCallback(){(this.stream._duplexState&wh)===Qe?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&We||(this.stream._duplexState|=We,this.stream._duplexState&ut||ma(this.afterUpdateNextTick))}}class Ph{constructor(e){this.data=null,this.afterTransform=Vh.bind(e),this.afterFinal=null}}class Lh{constructor(e,t,s){this.from=e,this.to=t,this.afterPipe=s,this.error=null,this.pipeToFinished=!1}finished(){this.pipeToFinished=!0}done(e,t){if(t&&(this.error=t),e===this.to&&(this.to=null,this.from!==null)){(!(this.from._duplexState&Q)||!this.pipeToFinished)&&this.from.destroy(this.error||new Error("Writable stream closed prematurely"));return}if(e===this.from&&(this.from=null,this.to!==null)){e._duplexState&Q||this.to.destroy(this.error||new Error("Readable stream closed before ending"));return}this.afterPipe!==null&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null}}function Mh(){this.stream._duplexState|=us,this.updateCallback()}function Dh(n){const e=this.stream;n&&e.destroy(n),e._duplexState&he||(e._duplexState|=Fe,e.emit("finish")),(e._duplexState&Ra)===ps&&(e._duplexState|=Oe),e._duplexState&=Ea,e._duplexState&Ge?this.updateNextTick():this.update()}function Ia(n){const e=this.stream;!n&&this.error!==sn&&(n=this.error),n&&e.emit("error",n),e._duplexState|=lt,e.emit("close");const t=e._readableState,s=e._writableState;if(t!==null&&t.pipeline!==null&&t.pipeline.done(e,n),s!==null){for(;s.drains!==null&&s.drains.length>0;)s.drains.shift().resolve(!1);s.pipeline!==null&&s.pipeline.done(e,n)}}function xh(n){const e=this.stream;n&&e.destroy(n),e._duplexState&=Ea,this.drains!==null&&Hh(this.drains),(e._duplexState&Rh)===Rt&&(e._duplexState&=hh,(e._duplexState&$n)===$n&&e.emit("drain")),this.updateCallback()}function Fh(n){n&&this.stream.destroy(n),this.stream._duplexState&=sh,this.readAhead===!1&&!(this.stream._duplexState&bt)&&(this.stream._duplexState&=Ta),this.updateCallback()}function Uh(){this.stream._duplexState&ut||(this.stream._duplexState&=ya,this.update())}function Bh(){this.stream._duplexState&Ge||(this.stream._duplexState&=wa,this.update())}function Hh(n){for(let e=0;e<n.length;e++)--n[e].writes===0&&(n.shift().resolve(!0),e--)}function Na(n){const e=this.stream;n&&e.destroy(n),e._duplexState&Oe||(e._duplexState&_h||(e._duplexState|=Qe),e._duplexState&bh||(e._duplexState|=kt),e.emit("open")),e._duplexState&=ka,e._writableState!==null&&e._writableState.updateCallback(),e._readableState!==null&&e._readableState.updateCallback()}function Vh(n,e){e!=null&&this.push(e),this._writableState.afterWrite(n)}function Kh(n){this._readableState!==null&&(n==="data"&&(this._duplexState|=qn|fs,this._readableState.updateNextTick()),n==="readable"&&(this._duplexState|=ds,this._readableState.updateNextTick())),this._writableState!==null&&n==="drain"&&(this._duplexState|=$n,this._writableState.updateNextTick())}class _s extends Xd{constructor(e){super(),this._duplexState=0,this._readableState=null,this._writableState=null,e&&(e.open&&(this._open=e.open),e.destroy&&(this._destroy=e.destroy),e.predestroy&&(this._predestroy=e.predestroy),e.signal&&e.signal.addEventListener("abort",Qh.bind(this))),this.on("newListener",Kh)}_open(e){e(null)}_destroy(e){e(null)}_predestroy(){}get readable(){return this._readableState!==null?!0:void 0}get writable(){return this._writableState!==null?!0:void 0}get destroyed(){return(this._duplexState&lt)!==0}get destroying(){return(this._duplexState&he)!==0}destroy(e){this._duplexState&he||(e||(e=sn),this._duplexState=(this._duplexState|Oe)&ph,this._readableState!==null&&(this._readableState.highWaterMark=0,this._readableState.error=e),this._writableState!==null&&(this._writableState.highWaterMark=0,this._writableState.error=e),this._duplexState|=ls,this._predestroy(),this._duplexState&=Zd,this._readableState!==null&&this._readableState.updateNextTick(),this._writableState!==null&&this._writableState.updateNextTick())}}class ht extends _s{constructor(e){super(e),this._duplexState|=xe|Fe|Le,this._readableState=new Oh(this,e),e&&(this._readableState.readAhead===!1&&(this._duplexState&=Ta),e.read&&(this._read=e.read),e.eagerOpen&&this._readableState.updateNextTick(),e.encoding&&this.setEncoding(e.encoding))}setEncoding(e){const t=new Qd(e),s=this._readableState.map||jh;return this._readableState.map=i,this;function i(r){const a=t.push(r);return a===""?null:s(a)}}_read(e){e(null)}pipe(e,t){return this._readableState.updateNextTick(),this._readableState.pipe(e,t),e}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(e){return this._readableState.updateNextTick(),this._readableState.push(e)}unshift(e){return this._readableState.updateNextTick(),this._readableState.unshift(e)}resume(){return this._duplexState|=fs,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=this._readableState.readAhead===!1?uh:ah,this}static _fromAsyncIterator(e,t){let s;const i=new ht({...t,read(a){e.next().then(r).then(a.bind(null,null)).catch(a)},predestroy(){s=e.return()},destroy(a){if(!s)return a(null);s.then(a.bind(null,null)).catch(a)}});return i;function r(a){a.done?i.push(null):i.push(a.value)}}static from(e,t){if(Yh(e))return e;if(e[vt])return this._fromAsyncIterator(e[vt](),t);Array.isArray(e)||(e=e===void 0?[]:[e]);let s=0;return new ht({...t,read(i){this.push(s===e.length?null:e[s++]),i(null)}})}static isBackpressured(e){return(e._duplexState&Sh)!==0||e._readableState.buffered>=e._readableState.highWaterMark}static isPaused(e){return(e._duplexState&bt)===0}[vt](){const e=this;let t=null,s=null,i=null;return this.on("error",u=>{t=u}),this.on("readable",r),this.on("close",a),{[vt](){return this},next(){return new Promise(function(u,c){s=u,i=c;const d=e.read();d!==null?o(d):e._duplexState&lt&&o(null)})},return(){return l(null)},throw(u){return l(u)}};function r(){s!==null&&o(e.read())}function a(){s!==null&&o(null)}function o(u){i!==null&&(t?i(t):u===null&&!(e._duplexState&Q)?i(sn):s({value:u,done:u===null}),i=s=null)}function l(u){return e.destroy(u),new Promise((c,d)=>{if(e._duplexState&lt)return c({value:void 0,done:!0});e.once("close",function(){u?d(u):c({value:void 0,done:!0})})})}}}class Oa extends _s{constructor(e){super(e),this._duplexState|=xe|Q,this._writableState=new va(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final),e.eagerOpen&&this._writableState.updateNextTick())}cork(){this._duplexState|=an}uncork(){this._duplexState&=ba,this._writableState.updateNextTick()}_writev(e,t){t(null)}_write(e,t){this._writableState.autoBatch(e,t)}_final(e){e(null)}static isBackpressured(e){return(e._duplexState&Ih)!==0}static drained(e){if(e.destroyed)return Promise.resolve(!1);const t=e._writableState,i=(Zh(e)?Math.min(1,t.queue.length):t.queue.length)+(e._duplexState&ms?1:0);return i===0?Promise.resolve(!0):(t.drains===null&&(t.drains=[]),new Promise(r=>{t.drains.push({writes:i,resolve:r})}))}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}class ys extends ht{constructor(e){super(e),this._duplexState=xe|this._duplexState&Le,this._writableState=new va(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final))}cork(){this._duplexState|=an}uncork(){this._duplexState&=ba,this._writableState.updateNextTick()}_writev(e,t){t(null)}_write(e,t){this._writableState.autoBatch(e,t)}_final(e){e(null)}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}class Pa extends ys{constructor(e){super(e),this._transformState=new Ph(this),e&&(e.transform&&(this._transform=e.transform),e.flush&&(this._flush=e.flush))}_write(e,t){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=e:this._transform(e,this._transformState.afterTransform)}_read(e){if(this._transformState.data!==null){const t=this._transformState.data;this._transformState.data=null,e(null),this._transform(t,this._transformState.afterTransform)}else e(null)}destroy(e){super.destroy(e),this._transformState.data!==null&&(this._transformState.data=null,this._transformState.afterTransform())}_transform(e,t){t(null,e)}_flush(e){e(null)}_final(e){this._transformState.afterFinal=e,this._flush($h.bind(this))}}class qh extends Pa{}function $h(n,e){const t=this._transformState.afterFinal;if(n)return t(n);e!=null&&this.push(e),this.push(null),t(null)}function Wh(...n){return new Promise((e,t)=>La(...n,s=>{if(s)return t(s);e()}))}function La(n,...e){const t=Array.isArray(n)?[...n,...e]:[n,...e],s=t.length&&typeof t[t.length-1]=="function"?t.pop():null;if(t.length<2)throw new Error("Pipeline requires at least 2 streams");let i=t[0],r=null,a=null;for(let u=1;u<t.length;u++)r=t[u],ft(i)?i.pipe(r,l):(o(i,!0,u>1,l),i.pipe(r)),i=r;if(s){let u=!1;const c=ft(r)||!!(r._writableState&&r._writableState.autoDestroy);r.on("error",d=>{a===null&&(a=d)}),r.on("finish",()=>{u=!0,c||s(a)}),c&&r.on("close",()=>s(a||(u?null:Rn)))}return r;function o(u,c,d,h){u.on("error",h),u.on("close",g);function g(){if(c&&u._readableState&&!u._readableState.ended||d&&u._writableState&&!u._writableState.ended)return h(Rn)}}function l(u){if(!(!u||a)){a=u;for(const c of t)c.destroy(u)}}}function jh(n){return n}function Ma(n){return!!n._readableState||!!n._writableState}function ft(n){return typeof n._duplexState=="number"&&Ma(n)}function Jh(n){return!!n._readableState&&n._readableState.ended}function Gh(n){return!!n._writableState&&n._writableState.ended}function zh(n,e={}){const t=n._readableState&&n._readableState.error||n._writableState&&n._writableState.error;return!e.all&&t===sn?null:t}function Yh(n){return ft(n)&&n.readable}function Xh(n){return typeof n=="object"&&n!==null&&typeof n.byteLength=="number"}function Da(n){return Xh(n)?n.byteLength:1024}function Ai(){}function Qh(){this.destroy(new Error("Stream aborted."))}function Zh(n){return n._writev!==Oa.prototype._writev&&n._writev!==ys.prototype._writev}var ef={pipeline:La,pipelinePromise:Wh,isStream:Ma,isStreamx:ft,isEnded:Jh,isFinished:Gh,getStreamError:zh,Stream:_s,Writable:Oa,Readable:ht,Duplex:ys,Transform:Pa,PassThrough:qh};function vi(n,e){for(const t in e)Object.defineProperty(n,t,{value:e[t],enumerable:!0,configurable:!0});return n}function tf(n,e,t){if(!n||typeof n=="string")throw new TypeError("Please pass an Error to err-code");t||(t={}),typeof e=="object"&&(t=e,e=""),e&&(t.code=e);try{return vi(n,t)}catch{t.message=n.message,t.stack=n.stack;const i=function(){};return i.prototype=Object.create(Object.getPrototypeOf(n)),vi(new i,t)}}var nf=tf;const R=Bi(nf);/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wärting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const Ii="0123456789abcdef",xa=[];for(let n=0;n<256;n++)xa[n]=Ii[n>>4&15]+Ii[n&15];const Ni=n=>{const e=n.length;let t="",s=0;for(;s<e;)t+=xa[n[s++]];return t};var Oi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",sf=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var It=0;It<Oi.length;It++)sf[Oi.charCodeAt(It)]=It;new TextDecoder;const rf=new TextEncoder,af=n=>rf.encode(n),Pi=typeof window<"u"?window:self,Wn=Pi.crypto||Pi.msCrypto||{};Wn.subtle||Wn.webkitSubtle;const Li=n=>{const e=new Uint8Array(n);return Wn.getRandomValues(e)};/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const of=Md("simple-peer"),Cn=64*1024,cf=5*1e3,lf=5*1e3,uf=5*1e3;function Mi(n){return n.replace(/a=ice-options:trickle\s\n/g,"")}function df(n){console.warn(n)}class be extends ef.Duplex{constructor(t){t=Object.assign({allowHalfOpen:!1},t);super(t);E(this,"_pc");if(this.__objectMode=!!t.objectMode,this._id=Ni(Li(4)).slice(0,7),this._debug("new peer %o",t),this.channelName=t.initiator?t.channelName||Ni(Li(20)):null,this.initiator=t.initiator||!1,this.channelConfig=t.channelConfig||be.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},be.config,t.config),this.offerOptions=t.offerOptions||{},this.answerOptions=t.answerOptions||{},this.sdpTransform=t.sdpTransform||(s=>s),this.streams=t.streams||(t.stream?[t.stream]:[]),this.trickle=t.trickle!==void 0?t.trickle:!0,this.allowHalfTrickle=t.allowHalfTrickle!==void 0?t.allowHalfTrickle:!1,this.iceCompleteTimeout=t.iceCompleteTimeout||cf,this.iceRestartEnabled=t.iceRestartEnabled!==void 0?t.iceRestartEnabled:this.trickle===!0,this.iceFailureRecoveryTimeout=t.iceFailureRecoveryTimeout||uf,this._iceFailureRecoveryTimer=null,this._destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,!Kn)throw R(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._isRestartingIce=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new Kn(this.config)}catch(s){this.__destroy(R(s,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=s=>{this._onIceCandidate(s)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(s=>{this.__destroy(R(s,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=s=>{this._setupData(s)},this.streams&&this.streams.forEach(s=>{this.addStream(s)}),this._pc.ontrack=s=>{this._onTrack(s)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(t){if(!this._destroying){if(this.destroyed)throw R(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof t=="string")try{t=JSON.parse(t)}catch{t={}}this._debug("signal()"),t.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),t.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(t.transceiverRequest.kind,t.transceiverRequest.init)),t.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(t.candidate):this._pendingCandidates.push(t.candidate)),t.sdp&&this._pc.setRemoteDescription(new Dd(t)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(s=>{this._addIceCandidate(s)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(s=>{this.__destroy(R(s,"ERR_SET_REMOTE_DESCRIPTION"))}),!t.sdp&&!t.candidate&&!t.renegotiate&&!t.transceiverRequest&&this.__destroy(R(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(t){const s=new xd(t);this._pc.addIceCandidate(s).catch(i=>{!s.address||s.address.endsWith(".local")?df("Ignoring unsupported ICE candidate."):this.__destroy(R(i,"ERR_ADD_ICE_CANDIDATE"))})}send(t){if(!this._destroying){if(this.destroyed)throw R(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(t)}}addTransceiver(t,s){if(!this._destroying){if(this.destroyed)throw R(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(t,s),this._needsNegotiation()}catch(i){this.__destroy(R(i,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:t,init:s}})}}addStream(t){if(!this._destroying){if(this.destroyed)throw R(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),t.getTracks().forEach(s=>{this.addTrack(s,t)})}}addTrack(t,s){if(this._destroying)return;if(this.destroyed)throw R(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const i=this._senderMap.get(t)||new Map;let r=i.get(s);if(!r)r=this._pc.addTrack(t,s),i.set(s,r),this._senderMap.set(t,i),this._needsNegotiation();else throw r.removed?R(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):R(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(t,s,i){if(this._destroying)return;if(this.destroyed)throw R(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const r=this._senderMap.get(t),a=r?r.get(i):null;if(!a)throw R(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");s&&this._senderMap.set(s,r),a.replaceTrack!=null?a.replaceTrack(s):this.__destroy(R(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(t,s){if(this._destroying)return;if(this.destroyed)throw R(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const i=this._senderMap.get(t),r=i?i.get(s):null;if(!r)throw R(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{r.removed=!0,this._pc.removeTrack(r)}catch(a){a.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(r):this.__destroy(R(a,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(t){if(!this._destroying){if(this.destroyed)throw R(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),t.getTracks().forEach(s=>{this.removeTrack(s,t)})}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,queueMicrotask(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this._destroying){if(this.destroyed)throw R(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}restartIce(){return this.initiator?this._isRestartingIce?(this._debug("Already restarting ice, ignoring restartIce()"),!1):(this._isNegotiating=!1,this._isRestartingIce=!0,this._pc.restartIce&&this._pc.restartIce(),this._needsNegotiation(),!0):(this._debug("restartIce() only works for the initiator"),!1)}_final(t){this._readableState.ended||this.push(null),t(null)}__destroy(t){this.end(),this._destroy(()=>{},t)}_destroy(t,s){this.destroyed||this._destroying||(this._destroying=!0,this._debug("destroying (error: %s)",s&&(s.message||s)),setTimeout(()=>{if(this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,s&&this.emit("error",s),t()},0))}_setupData(t){if(!t.channel)return this.__destroy(R(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=t.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=Cn),this.channelName=this._channel.label,this._channel.onmessage=i=>{this._onChannelMessage(i)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=i=>{const r=i.error instanceof Error?i.error:new Error(`Datachannel error: ${i.message} ${i.filename}:${i.lineno}:${i.colno}`);this.__destroy(R(r,"ERR_DATA_CHANNEL"))};let s=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(s&&this._onChannelClose(),s=!0):s=!1},lf)}_write(t,s){if(this.destroyed)return s(R(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(t)}catch(i){return this.__destroy(R(i,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>Cn?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=s):s(null)}else this._debug("write before connect"),this._chunk=t,this._cb=s}_onFinish(){if(this.destroyed)return;const t=()=>{setTimeout(()=>this.__destroy(),1e3)};this._connected?t():this.once("connect",t)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){if(this.destroyed)return;const t=Object.assign({},this.offerOptions);this._isRestartingIce&&(this.offerOptions.iceRestart=!0),this._pc.createOffer(t).then(s=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(s.sdp=Mi(s.sdp)),s.sdp=this.sdpTransform(s.sdp);const i=()=>{if(this.destroyed)return;const o=this._pc.localDescription||s;this._debug("signal"),this.emit("signal",{type:o.type,sdp:o.sdp})},r=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?i():this.once("_iceComplete",i))},a=o=>{this.__destroy(R(o,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(s).then(r).catch(a)}).catch(s=>{this.__destroy(R(s,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(t=>{!t.mid&&t.sender.track&&!t.requested&&(t.requested=!0,this.addTransceiver(t.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(t=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(t.sdp=Mi(t.sdp)),t.sdp=this.sdpTransform(t.sdp);const s=()=>{if(this.destroyed)return;const a=this._pc.localDescription||t;this._debug("signal"),this.emit("signal",{type:a.type,sdp:a.sdp}),this.initiator||this._requestMissingTransceivers()},i=()=>{this.destroyed||(this.trickle||this._iceComplete?s():this.once("_iceComplete",s))},r=a=>{this.__destroy(R(a,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(t).then(i).catch(r)}).catch(t=>{this.__destroy(R(t,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._destroying||(this._pc.connectionState==="failed"&&!this.iceRestartEnabled?this.__destroy(R(new Error("Connection failed."),"ERR_CONNECTION_FAILURE")):this._pc.connectionState==="failed"&&this.iceRestartEnabled?(this.initiator&&!this._isRestartingIce&&this.restartIce(),this._startIceFailureRecoveryTimeout()):this._pc.connectionState==="disconnected"&&this.iceRestartEnabled==="onDisconnect"&&this.initiator&&!this._isRestartingIce&&this.restartIce())}_onIceStateChange(){if(this.destroyed)return;const t=this._pc.iceConnectionState,s=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",t,s),this.emit("iceStateChange",t,s),(t==="connected"||t==="completed")&&(this._iceFailureRecoveryTimer&&(clearTimeout(this._iceFailureRecoveryTimer),this._iceFailureRecoveryTimer=null),this._isRestartingIce=!1,this._pcReady=!0,this._maybeReady()),t==="failed"&&this.iceRestartEnabled?(this.initiator&&!this._isRestartingIce&&this.restartIce(),this._startIceFailureRecoveryTimeout()):t==="disconnected"&&this.iceRestartEnabled==="onDisconnect"?this.initiator&&!this._isRestartingIce&&this.restartIce():t==="failed"&&!this.iceRestartEnabled&&this.__destroy(R(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),t==="closed"&&this.__destroy(R(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(t){const s=i=>(Object.prototype.toString.call(i.values)==="[object Array]"&&i.values.forEach(r=>{Object.assign(i,r)}),i);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(i=>{const r=[];i.forEach(a=>{r.push(s(a))}),t(null,r)},i=>t(i)):this._pc.getStats.length>0?this._pc.getStats(i=>{if(this.destroyed)return;const r=[];i.result().forEach(a=>{const o={};a.names().forEach(l=>{o[l]=a.stat(l)}),o.id=a.id,o.type=a.type,o.timestamp=a.timestamp,r.push(s(o))}),t(null,r)},i=>t(i)):t(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),(this._connected||this._connecting)&&!this._isRestartingIce||!this._pcReady||!this._channelReady)return;this._connecting=!0;const t=()=>{this.destroyed||this._destroying||this.getStats((s,i)=>{if(this.destroyed||this._destroying)return;s&&(i=[]);const r={},a={},o={};let l=!1;i.forEach(c=>{(c.type==="remotecandidate"||c.type==="remote-candidate")&&(r[c.id]=c),(c.type==="localcandidate"||c.type==="local-candidate")&&(a[c.id]=c),(c.type==="candidatepair"||c.type==="candidate-pair")&&(o[c.id]=c)});const u=c=>{l=!0;let d=a[c.localCandidateId];d&&(d.ip||d.address)?(this.localAddress=d.ip||d.address,this.localPort=Number(d.port)):d&&d.ipAddress?(this.localAddress=d.ipAddress,this.localPort=Number(d.portNumber)):typeof c.googLocalAddress=="string"&&(d=c.googLocalAddress.split(":"),this.localAddress=d[0],this.localPort=Number(d[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let h=r[c.remoteCandidateId];h&&(h.ip||h.address)?(this.remoteAddress=h.ip||h.address,this.remotePort=Number(h.port)):h&&h.ipAddress?(this.remoteAddress=h.ipAddress,this.remotePort=Number(h.portNumber)):typeof c.googRemoteAddress=="string"&&(h=c.googRemoteAddress.split(":"),this.remoteAddress=h[0],this.remotePort=Number(h[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(i.forEach(c=>{c.type==="transport"&&c.selectedCandidatePairId&&u(o[c.selectedCandidatePairId]),(c.type==="googCandidatePair"&&c.googActiveConnection==="true"||(c.type==="candidatepair"||c.type==="candidate-pair")&&c.selected)&&u(c)}),!l&&(!Object.keys(o).length||Object.keys(a).length)){setTimeout(t,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(d){return this.__destroy(R(d,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const c=this._cb;this._cb=null,c(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};t()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>Cn||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(t=>{this._pc.removeTrack(t),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(t){this.destroyed||(t.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:t.candidate.candidate,sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid}}):!t.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),t.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(t){if(this.destroyed)return;let s=t.data;s instanceof ArrayBuffer?s=new Uint8Array(s):this.__objectMode===!1&&(s=af(s)),this.push(s)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const t=this._cb;this._cb=null,t(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.__destroy())}_onTrack(t){this.destroyed||t.streams.forEach(s=>{this._debug("on track"),this.emit("track",t.track,s),this._remoteTracks.push({track:t.track,stream:s}),!this._remoteStreams.some(i=>i.id===s.id)&&(this._remoteStreams.push(s),queueMicrotask(()=>{this._debug("on stream"),this.emit("stream",s)}))})}_debug(){const t=[].slice.call(arguments);t[0]="["+this._id+"] "+t[0],of.apply(null,t)}_startIceFailureRecoveryTimeout(){this.destroyed||this._iceFailureRecoveryTimer||(this._debug("started iceFailureRecovery timeout"),this._iceFailureRecoveryTimer=setTimeout(()=>{!this._iceComplete&&!(iceConnectionState==="connected"||iceConnectionState==="completed")&&(this._debug("iceFailureRecovery timeout completed"),this.destroy(makeError("Ice connection failed.","ERR_ICE_CONNECTION_FAILURE")))},this.iceFailureRecoveryTimeout))}}be.WEBRTC_SUPPORT=!!Kn;be.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};be.channelConfig={};class Fa{constructor(){E(this,"lastStats");E(this,"timestamp");E(this,"bytesSent");E(this,"bytesReceived");E(this,"selectedCandidatePairId");this.lastStats={availableIncomingBitrate:0,availableOutgoingBitrate:0,bitrateReceive:0,bitrateSend:0,recieverStats:{},senderLayerStats:[],rtcStatsJson:"",selectedCandidatePairChanges:0,canidatePairState:"waiting",canidatePairNominated:!1,iceState:"new",dtlsState:"new",allStats:[]}}parse(e){var r;let t={...this.lastStats};if(t.senderLayerStats=[],t.recieverStats={},!e)return t.recieverStats.hung=!0,t;const s=t.allStats=Array.from(e.values?e.values():e),i=new Map;for(const a of s)if(a.type==="codec"){const{mimeType:l,sdpFmtpLine:u,id:c}=a,[d,h]=l.toLowerCase().split("/");i.set(c,{codec:h??"unknown",sdpFmtpLine:u})}for(const a of s){const o=a.type;if(o==="inbound-rtp"&&a.kind==="video"){let{frameWidth:l,frameHeight:u,framesPerSecond:c,estimatedPlayoutTimestamp:d,nackCount:h,pliCount:g,jitterBufferDelay:m,freezeCount:T,jitter:p,codecId:S}=a;h=h??0,g=g??0;const{codec:k,sdpFmtpLine:b}=i.get(S||"")||{codec:"unknown",sdpFmtpLine:""},C=Math.max(d?d-this.timestamp:0,m);t.recieverStats={...t.recieverStats,nackCount:h,pliCount:g,freezeCount:T,estimatedPlayoutDelay:C,jitterBufferDelay:m,jitter:p,frameWidth:l,frameHeight:u,framesPerSecond:c,videoCodec:k,videoSdpFmtpLine:b}}else if(o==="outbound-rtp"&&a.kind==="video"){let{retransmittedBytesSent:l,scalabilityMode:u,qualityLimitationResolutionChanges:c,encoderImplementation:d,powerEfficientEncoder:h,qualityLimitationReason:g,qualityLimitationDurations:m,totalPacketSendDelay:T,frameWidth:p,frameHeight:S,framesPerSecond:k,codecId:b}=a;const{codec:C,sdpFmtpLine:N}=i.get(b||"")||{codec:"unknown",sdpFmtpLine:""};(r=t.senderLayerStats)==null||r.push({qualityLimitationResolutionChanges:c,qualityLimitationReason:g,bandwidthLimitedQualityDurration:m.bandwidth,cpuLimitedQualityDurration:m.cpu,otherLimitedQualityDurration:m.other,noLimitedQualityDurration:m.none,encoderImplementation:d,powerEfficientEncoder:h,scalabilityMode:u,totalPacketSendDelay:T,retransmittedBytesSent:l,frameWidth:p,frameHeight:S,framesPerSecond:k,videoCodec:C,videoSdpFmtpLine:N})}else if(o==="candidate-pair"){const{availableOutgoingBitrate:l,availableIncomingBitrate:u,currentRoundTripTime:c,state:d,nominated:h}=a;if(h===!1)continue;t={...t,recieverStats:{...t.recieverStats,currentRoundTripTime:c},availableOutgoingBitrate:l,availableIncomingBitrate:u,canidatePairState:d,canidatePairNominated:h}}else if(o==="transport"){let{bytesReceived:l,bytesSent:u,dtlsState:c,selectedCandidatePairId:d,timestamp:h}=a;l=l??0,u=u??0,d=d??"",d!==this.selectedCandidatePairId&&(t.selectedCandidatePairChanges=(t.selectedCandidatePairChanges||0)+1,this.selectedCandidatePairId=d),h!=this.timestamp&&(t.bitrateReceive=(l-this.bytesReceived)/(h-this.timestamp)*8e3,t.bitrateSend=(u-this.bytesSent)/(h-this.timestamp)*8e3,t.recieverStats={...t.recieverStats,hung:t.bitrateReceive<=0},this.timestamp=h),this.bytesSent=u,this.bytesReceived=l}}return t.senderLayerStats=t.senderLayerStats?t.senderLayerStats.sort((a,o)=>(o.frameWidth||0)*(o.frameHeight||0)-(a.frameWidth||0)*(a.frameHeight||0)):[],this.lastStats=t,t}}class hf extends Fa{}let ff=0;class mf{constructor(){E(this,"lastMsgRecivedTimestamp");E(this,"connectionState",ue(K.init));E(this,"latestRecivedDataMessage",ue(null));E(this,"outgoingSignalingMessages",ue(null));E(this,"remoteVideoStreams",ue(new Map));E(this,"_p",null);E(this,"_spConfig",null);E(this,"_incomingSignalQueue",[]);E(this,"_consecutiveSignalMsgsProcessed",0);E(this,"_msgSendQueue",[]);E(this,"_reconnectAttemptCount");E(this,"_shouldReconnect");E(this,"_initiator",!1);E(this,"_connectionId",-1);E(this,"_signalMsgSendCounter",0);E(this,"_signalMsgRecivedCounter",0);E(this,"_videoStatsParser",new Fa)}setStreamsEnabled(e){this.remoteVideoStreams.update(t=>(t.forEach(s=>{s&&s.getTracks().forEach(i=>i.enabled=e)}),t))}start(e,t=!0,s=0){if(this._p&&this.stop(),this._shouldReconnect=t,this._spConfig=Object.assign({},e,be.config),I("SP starting with opts: ",this._spConfig,ff++),this._spConfig.initiator&&(this._connectionId=Date.now()),this._signalMsgRecivedCounter=0,this._signalMsgSendCounter=0,this._p=new be(this._spConfig),!this._p)return $("Failed to create SimplePeer instance!");this._p._debug=(...i)=>se("SIMPLEPEER DEBUG: "+i[0],...i.slice(1)),this._reconnectAttemptCount=s,this._initiator=this._spConfig.initiator||!1,this.connectionState.set(K.connecting),this._p.on("signal",i=>{if(this._connectionId===-1){alert("SP sending signal message when connectionId is -1, this should not happen!");return}i=Object.assign({},i,{connId:this._connectionId,msgNum:this._signalMsgSendCounter}),this._signalMsgSendCounter++,se("SP: signal out",i),this.outgoingSignalingMessages.set(JSON.stringify(i))}),this._p.on("connect",()=>{v("SP: Connected!"),this._reconnectAttemptCount=0,this.connectionState.set(K.connected)}),this._p.on("data",i=>{this.lastMsgRecivedTimestamp=Date.now(),this.latestRecivedDataMessage.set(i)}),this._p.on("stream",i=>{i.addEventListener,v("SP got video stream: ",i),this.remoteVideoStreams.update(r=>(r=new Map,r.set(i.id,i),r))}),this._p.on("iceStateChange",(i,r)=>{v(`SP: ICE State - connection: ${i}, gathering: ${r}`),i==="connected"||i==="completed"?this.setStreamsEnabled(!0):this.setStreamsEnabled(!1)}),this._p.on("close",()=>{this._initiator||this.resetConnectionStats(),I("SP connection closed")}),this._p.on("end",()=>{I("SP connection ended")}),this._p.on("pause",()=>{I("SP connection paused")}),this._p.on("error",i=>{$("SP error ",i),this.remoteVideoStreams.set(new Map),this._shouldReconnect=!1,this.connectionState.set(K.failed)}),this._processSignalMsgQueue()}stop(){var e,t;this.resetConnectionStats(),this.connectionState.set(K.disconnectedOk),this.remoteVideoStreams.set(new Map),this._shouldReconnect=!1,se("SP Stop",this._connectionId,(e=this._p)==null?void 0:e.destroyed,(t=this._p)==null?void 0:t.destroying),this._p&&this._p.destroy(),this._p=null}async restart(e,t){var s,i;se("SP Restart",this._reconnectAttemptCount,e,this._connectionId,(s=this._p)==null?void 0:s.destroyed,(i=this._p)==null?void 0:i.destroying),this._reconnectAttemptCount++,this.stop(),this._connectionId=e||-1,console.log("SP Restart2",this._spConfig),this.start(this._spConfig,this._shouldReconnect,this._reconnectAttemptCount),t&&this.ingestSignalingMsg(t)}resetConnectionStats(){this._signalMsgRecivedCounter=0,this._signalMsgSendCounter=0,this._consecutiveSignalMsgsProcessed=0}changeMediaStream(e){if(this._p)try{console.log("SP: changeMediaStream replacing track",e.getVideoTracks()[0].getSettings());const t=this._p.streams[0],s=t.getVideoTracks()[0];this._p.replaceTrack(s,e.getVideoTracks()[0],t)}catch(t){$("SP: changeMediaStream failed to replace track trying stream remove+add",t.message);for(const s of this._p.streams)this._p.removeStream(s);this._p.addStream(e)}}setCodecPreferences(e){var r,a,o;const t=((r=RTCRtpReceiver.getCapabilities("video"))==null?void 0:r.codecs)||[],s=this.sortCodecsByMimeTypes(t,e);if(v("SP: availReceiveCodecs",t,"sortedCodecs",s),!this._p)return;const i=((o=(a=this._p)==null?void 0:a._pc)==null?void 0:o.getTransceivers())||[];for(const l of i)l.setCodecPreferences(s);this._p.negotiate()}getCodecPreferences(){var t,s;if(!this._p)return;const e=((s=(t=this._p)==null?void 0:t._pc)==null?void 0:s.getTransceivers())||[];for(const i of e){const r=i.receiver.getParameters();if(r.codecs)return r.codecs.map(a=>a.mimeType)}}async getStats(){if(!this._p)return;const e=await new Promise((t,s)=>{(!this._p||!this._p._pc)&&s("No active simplePeer instance found!"),this._p.getStats((i,r)=>{i&&s(i),t(r)})});return this._videoStatsParser.parse(e)}getPlayoutDelay(){var t,s;if(!this._p)return;const e=((s=(t=this._p)==null?void 0:t._pc)==null?void 0:s.getTransceivers())||[];for(const i of e){if(!i.receiver)continue;const r=i.receiver;if(r.playoutDelayHint)return r.playoutDelayHint;if(r.jitterBufferTarget)return r.jitterBufferTarget/1e3}return 0}setPlayoutDelay(e){var s,i;if(!this._p)return;const t=((i=(s=this._p)==null?void 0:s._pc)==null?void 0:i.getTransceivers())||[];for(const r of t){if(!r.receiver)continue;const a=r.receiver;a.playoutDelayHint!==void 0?a.playoutDelayHint!==e&&(se("SP: Setting playoutDelayHint to "+e),a.playoutDelayHint=e):a.jitterBufferTarget!==void 0&&a.jitterBufferTarget!==e&&(se("SP: Setting jitterBufferTarget to "+e),a.jitterBufferTarget=e*1e3)}}sortCodecsByMimeTypes(e,t){return e.sort((s,i)=>{const r=t.indexOf(s.mimeType.toLowerCase()),a=t.indexOf(i.mimeType.toLowerCase()),o=r>=0?r:Number.MAX_VALUE,l=a>=0?a:Number.MAX_VALUE;return o-l})}ingestSignalingMsg(e){try{const t=JSON.parse(e);if(t.msgNum===void 0||t.connId===void 0)return I("SP: Ignoring Invalid Signal Message (no connId or msgNum)!",t);if(t.connId>this._connectionId){if(I("SP: Found Newer connid, fastforwarding!",t.connId,this._connectionId),this._consecutiveSignalMsgsProcessed=0,this._connectionId=t.connId,this._incomingSignalQueue=[],this._spConfig&&!this._initiator)return this.restart(t.connId,e)}else if(t.connId<this._connectionId){I("SP: Ignoring Signal Message For Old connid (connId mismatch)!",t.connId,this._connectionId);return}v("SP: signal queued",t,t.msgNum,this._consecutiveSignalMsgsProcessed,t.connId,this._connectionId),this._incomingSignalQueue.push(t)}catch(t){I("SP: Failed to parse json signal message: ",e,t.message)}this._processSignalMsgQueue()}sendMessage(e){this._msgSendQueue.push(e),this._emptyMsgQueue()}_processSignalMsgQueue(){if(this._p){console.log("SP: processing signal queue",this._incomingSignalQueue.length-1,this._consecutiveSignalMsgsProcessed);for(let e=0;e<this._incomingSignalQueue.length;e++){if(console.log("SP: processing signal q msg",e,"/",this._incomingSignalQueue.length-1,this._consecutiveSignalMsgsProcessed),this._incomingSignalQueue.length===0)return;const t=this._incomingSignalQueue.findIndex(i=>(i==null?void 0:i.msgNum)===this._consecutiveSignalMsgsProcessed);if(t===-1)return;const s=this._incomingSignalQueue[t];v("SP: signal in",s,s.msgNum,this._consecutiveSignalMsgsProcessed,s.connId,this._connectionId),this._incomingSignalQueue.splice(t,1),e--,this._p.signal(s),this._consecutiveSignalMsgsProcessed++}}}_emptyMsgQueue(){if(!this._p||!this._p.connected)return!1;for(this._msgSendQueue.length;this._msgSendQueue.length>0;){const e=this._msgSendQueue.shift();try{this._p.send(e)}catch(t){$("failed to send message over simplePeer data channel: ",t.message),this._msgSendQueue.unshift(e)}}}}const V=x;class pf{constructor(){E(this,"config");E(this,"lastMsgRecivedTimestamp");E(this,"connectionState");E(this,"latestRecivedDataMessage");E(this,"participantConnectionEvents");E(this,"_rovRoomName");E(this,"_accessToken");E(this,"_reconnectAttemptCount",0);E(this,"_shouldReconnect");E(this,"_roomConn");this.config={},this._shouldReconnect=!0,this.connectionState=ue(K.init),this.latestRecivedDataMessage=ue(null),this.participantConnectionEvents=ue(null)}async init(e){this.config=e,this._shouldReconnect=!0,this._roomConn=new Wa(e.roomConfig),this._roomConn.on(O.DCBufferStatusChanged,t=>{V("LK: DCBufferStatusChanged ",t)}).on(O.SignalConnected,async()=>{V(`LK: Signal connection established to ${this.config.hostUrl}`)}).on(O.Connected,async()=>{V(`LK: Connected to room: ${this._roomConn.name} via ${this.config.hostUrl}`),this.connectionState.set(K.connected)}).on(O.Disconnected,t=>{this.connectionState.set(K.disconnectedOk);let s=this._shouldReconnect&&!!this._roomConn;t===fe.DUPLICATE_IDENTITY?(I("LK: disconnected from room - duplicate identity"),s=!1):t===fe.CLIENT_INITIATED?(x("LK: disconnected from room - client initiated"),s=!1):t===fe.PARTICIPANT_REMOVED?(x("LK: disconnected from room - participant removed"),s=!1):t===fe.ROOM_DELETED?x("LK: disconnected from room - room deleted"):t===fe.STATE_MISMATCH?x("LK: disconnected from room - state mismatch"):t===fe.SERVER_SHUTDOWN?x("LK: disconnected from room - server shutdown"):t===fe.JOIN_FAILURE?x("LK: disconnected from room - join failure"):t===fe.UNKNOWN_REASON&&x("LK: disconnected from room - unknown reason"),s?this._reconnect():this.close()}).on(O.Reconnecting,()=>{V(`LK: Reconnecting to room ${this._roomConn.name} via ${this.config.hostUrl}`),this.connectionState.set(K.reconnecting)}).on(O.Reconnected,async()=>{V("LK: Successfully reconnected. server",await this._roomConn.engine.getConnectedServerAddress()),this.connectionState.set(K.connected)}).on(O.ParticipantMetadataChanged,t=>{V("LK: Participant Metadata Changed",t)}).on(O.ParticipantConnected,async t=>{V(`LK: Participant ${t.identity} (${t.sid}) connected`,t.metadata),this.participantConnectionEvents.set({id:t.identity,joined:!0}),t.on(ja.ConnectionQualityChanged,()=>{V("LK: ParticipantEvent.ConnectionQualityChanged",t.connectionQuality)})}).on(O.ParticipantDisconnected,t=>{V(`LK: Participant ${t.identity} (${t.sid}) disconnected`),this.participantConnectionEvents.set({id:t.identity,joined:!1})}).on(O.MediaDevicesError,t=>{const s=ws.getFailure(t);V("LK: Media device failure",s)}).on(O.ConnectionQualityChanged,(t,s)=>{V(`LK: connection quality for ${s?s.identity:"[no identity]"} changed to ${t}`)}).on(O.RoomMetadataChanged,t=>{try{V("LK: New metadata for room",JSON.parse(t))}catch{V("LK: New metadata for room (NOT VALID JSON)",t)}}).on(O.MediaDevicesChanged,()=>{V("LK: MediaDevicesChanged")}).on(O.LocalTrackUnpublished,(t,s)=>{V("LK: LocalTrackUnpublished",t.trackSid,"by participant",s.identity,"source",t.track?t.track.source:"[no track found]")}).on(O.LocalTrackPublished,(t,s)=>{V("LK: LocalVideoTrackPublished",t.trackSid,"by participant",s.identity,"source",t.track?t.track.source:"[no track found]")}).on(O.MediaDevicesError,t=>{const s=ws.getFailure(t);V("LK: media device failure",s)}).on(O.AudioPlaybackStatusChanged,()=>{V("LK: AudioPlaybackStatusChanged. canPlaybackAudio =",this._roomConn.canPlaybackAudio)})}async start(e,t){this._rovRoomName=e,this._accessToken=t,this._shouldReconnect=!0;const s=Date.now();x(`LK: Starting conn with ${e} via ${this.config.hostUrl} token = ${t}`);try{const i=setTimeout(()=>{x(`livekit connect timeout for ${this.config.hostUrl}. Reconnecting...`),this._reconnect()},16e3);await this._connect(),clearTimeout(i),x(`LK: Connected in ${Date.now()-s}ms ${this.config.hostUrl}`)}catch(i){x(`LK: Error connecting to ${this.config.hostUrl}. Reconnecting...`,i),this._reconnect()}}async sendMessage(e,t=!0,s=[]){if(!this._roomConn)return I("LK: Can't send message, room not connected");if(e.length==0)return I("LK: Can't send empty message");await this._roomConn.localParticipant.publishData(e,{reliable:t,destinationIdentities:s})}getParticipantSid(e){const t=[...this._roomConn.remoteParticipants.values()].find(s=>s.identity===e);return t?t.sid:null}getLivekitIdentitiy(){return this._roomConn?this._roomConn.localParticipant.identity:null}getRoomName(){return this._roomConn?this._roomConn.name:this._rovRoomName}async close(){this._shouldReconnect=!1,this._roomConn&&(v("LK: Closing Livekit Connection: ",this._rovRoomName,this.config.hostUrl),await this._roomConn.disconnect(!0))}async _connect(){await this._roomConn.connect(Hi(this.config.hostUrl),this._accessToken,this.config.roomConnectionConfig),v("LK: Connected to room",this._roomConn.name,this._roomConn)}async _reconnect(){try{await this._roomConn.disconnect(!0)}catch(e){$("LK: Error disconnecting from room",e)}if(this._shouldReconnect!=!1)if(this._reconnectAttemptCount<this.config.reconnectAttempts){const e=this._reconnectAttemptCount*800;this._reconnectAttemptCount++,await mt(e);try{await this._connect()}catch(t){throw $("LK: Error reconnecting to room",t),t}}else $("LK: Failed to reconnect after ",this._reconnectAttemptCount,"/",this.config.reconnectAttempts,"attempts"),this._fail()}_fail(){this._shouldReconnect=!1,this.connectionState.set(K.failed)}}const Di=1e3;let An=0;class gf{constructor(e,t,s,i,r=null){E(this,"client");E(this,"egressClient");E(this,"roomName");E(this,"tokenEncryptionPassword");E(this,"apiKey");E(this,"secretKey");this.apiKey=e,this.secretKey=t,this.roomName=i,this.tokenEncryptionPassword=r,this.client=new gd(s,e,t),this.egressClient=new sa(s,e,t)}getEgressClient(){return this.egressClient}async waitForRateLimit(){for(;Date.now()-An<Di;)console.log("Waiting for rate limit...",Date.now()-An),await mt(Di);An=Date.now()}async deleteLivekitRoom(){try{return await this.client.deleteRoom(this.roomName)}catch(e){I("LK Admin: Failed to delete room: "+this.roomName,e)}}async createLivekitRoom(e,t){const s=await this._generateRoomMetadata(e,t);await this.waitForRateLimit();const i=await le(()=>this.client.createRoom({name:this.roomName,maxParticipants:8,metadata:s,syncStreams:!1,emptyTimeout:60,departureTimeout:30}));return v("LK Admin: Created room: "+this.roomName,i),i}async listLivekitRooms(){return await this.waitForRateLimit(),(await le(()=>this.client.listRooms())).filter(t=>t.numParticipants>0)}async updateRoomMetadata(e,t){const s=await this._generateRoomMetadata(e,t);await this.waitForRateLimit();try{return await le(()=>this.client.updateRoomMetadata(this.roomName,s))}catch(i){throw new Error("LK Admin: Failed to update metadata for room "+this.roomName+i.toString())}}async _generateRoomMetadata(e,t){let i=[],r;for(let o=0;o<3;o++){r=Xa(o);const l=await kd(this.apiKey,this.secretKey,this.roomName,r);if(this.tokenEncryptionPassword){const u=await bd(l,this.tokenEncryptionPassword);i.push({userGivenIdentity:r,encrypted:!0,...u})}else i.push({userGivenIdentity:r,token:l,encrypted:!1})}return JSON.stringify({numParticipants:t,accessTokens:i})}}class _f extends pf{constructor(){super();E(this,"_livekitApiKey");E(this,"_livekitSecretKey");E(this,"_livekitAdmin");E(this,"camTrack");E(this,"videoStatsParser",new hf);E(this,"_videoStatsIntervalId");E(this,"_videoPublishOptions");E(this,"_videoCaptureOptions")}async init(t){await super.init(t),this._roomConn.on(O.SignalConnected,()=>{this.isVideoActive()||this.enableCamera(!0),this._roomConn.metadata||this.createLivekitRoom()}).on(O.Reconnecting,()=>{this._roomConn.metadata||this.createLivekitRoom()}).on(O.Connected,()=>{this.isVideoActive()||this.enableCamera(!0),this.updateRoomMetadata()}).on(O.Reconnected,()=>{this.isVideoActive()||this.enableCamera(!0),this.updateRoomMetadata()}).on(O.DataReceived,(s,i)=>{if(!i)return I("LK: Ignoring received data message with no participant. This can happen when the message is sent before connection completes or if the message comes from the server: ",s);const r=i.identity;i.sid,this.lastMsgRecivedTimestamp=Date.now(),this.latestRecivedDataMessage.set({senderId:r,msg:s})}).on(O.TrackSubscribed,(s,i,r)=>{I("LK: Subscribed to track ",i.trackSid," from participant: ",r.identity," source: ",s.source," _THIS SHOULDNT HAPPEN on BACKEND_ ")}).on(O.TrackUnsubscribed,(s,i,r)=>{I("LK: Unsubscribed from track",i.trackSid," from participant: ",r.identity," _THIS SHOULDNT HAPPEN on BACKEND_ ")}).on(O.ParticipantConnected,()=>{this.updateRoomMetadata()})}async startRoom(t,s,i){this._rovRoomName=t,this._livekitApiKey=s,this._livekitSecretKey=i,this._livekitAdmin=this._livekitAdmin??new gf(s,i,this.config.hostUrl,t,L.ROV_CONTROL_PASSWORD),this.createLivekitRoom();const r=await wd(s,i,t);await super.start(t,r)}async enableCamera(t,s,i){var r,a,o,l;if(!this._roomConn)throw new Error("LK: Can't enable camera, room not initialized");this._videoCaptureOptions=s||this._videoCaptureOptions||this.config.roomConfig.videoCaptureDefaults,this._videoPublishOptions=i||this._videoPublishOptions||this.config.roomConfig.publishDefaults;for(const[u,c]of this._roomConn.localParticipant.videoTrackPublications)x("LK: Unpublishing video track: ",u,c),c!=null&&c.videoTrack&&this._roomConn.localParticipant.unpublishTrack(c.videoTrack,!0);if(t)for(;;){try{if(this.connectionState.get()===K.failed)return I("LK: Can't enable camera, room connection failed");const u=await this._roomConn.localParticipant.createTracks({video:{resolution:this._videoCaptureOptions.resolution,facingMode:this._videoCaptureOptions.facingMode},audio:!1});console.log("LK: Created tracks: ",u);for(const c of u){const d=await this._roomConn.localParticipant.publishTrack(u[0],this._videoPublishOptions);d&&c.kind===Ja.Kind.Video&&(this.camTrack=d)}if(this.camTrack)return v("LK: Camera enabled",t,this._videoCaptureOptions,this._videoPublishOptions)}catch(u){$(u.message)}await mt(1e3)}else(a=(r=this.camTrack)==null?void 0:r.videoTrack)==null||a.stop(),(l=(o=this.camTrack)==null?void 0:o.audioTrack)==null||l.stop(),this.camTrack=void 0,v("LK: Camera disabled",t)}isVideoActive(){if(!this.camTrack||!this.camTrack.videoTrack)return!1;let t=this._roomConn.localParticipant.videoTrackPublications.get(this.camTrack.trackSid);return console.log("LK: Video Publication: ",t," Enabled: ",t==null?void 0:t.isEnabled),t==null?void 0:t.isEnabled}async getVideoStats(){for(const t of this._roomConn.localParticipant.videoTrackPublications.values()){if(!t||!t.videoTrack)continue;const s=await t.videoTrack.getRTCStatsReport();if(!s)continue;const i=this.videoStatsParser.parse(s);if(i)return i}}getParticipantIds(){return[...this._roomConn.remoteParticipants.values()].map(t=>t.identity)}async close(){await super.close()}async _fail(){await super._fail()}async updateRoomMetadata(){if(!this._livekitAdmin)return I("LK: Can't update metadata tokens, livekit admin client not initialized");v("LK: Updating room metadata");const t=this.getParticipantIds().filter(s=>s!==this._rovRoomName);await this._livekitAdmin.updateRoomMetadata(t,t.length+1)}async createLivekitRoom(){if(!this._livekitAdmin)return I("LK: Can't create livekit room, livekit admin client not initialized");const t=this.getParticipantIds(),s=await this._livekitAdmin.createLivekitRoom(t,t.length+1);(!s.metadata||s.numParticipants!==t.length+1)&&await this.updateRoomMetadata()}}class yf{constructor(){E(this,"_cloudLivekitConnection",new _f);E(this,"_simplePeerConnections",new Map);E(this,"_simplePeerCameraStream",null);E(this,"simplePeerCameraOptions",ue(ks));E(this,"_videoStatsIntervalId");this._cloudLivekitConnection.init({hostUrl:L.LIVEKIT_CLOUD_ENDPOINT,publishVideo:!0,reconnectAttempts:300,roomConnectionConfig:Ga,roomConfig:rt,tokenEncryptionPassword:L.ROV_CONTROL_PASSWORD}),et(this._cloudLivekitConnection.latestRecivedDataMessage,e=>{if(!e)return;const{senderId:t,msg:s}=e;yi(t,s)}),et(this._cloudLivekitConnection.connectionState,e=>{x("Cloud Conn State Changed: "+e),e==K.connected}),et(this._cloudLivekitConnection.participantConnectionEvents,e=>{x("Cloud Conn Participant Event: ",e)})}async start(e){this._cloudLivekitConnection.connectionState.get(),this._cloudLivekitConnection.connectionState.subscribe(t=>{(t===K.failed||t===K.init)&&(v("Creating & Starting Livekit Room: "+e.RovName),Cs(this._cloudLivekitConnection.startRoom,this._cloudLivekitConnection,10,1e3,1.3)(e.RovName,e.APIKey,e.SecretKey).catch(i=>{$(i),x("Too many errors: Triggering Page Reload"),window.location.reload()}))}),v("Connection Manager Started"),await Ya(()=>this._cloudLivekitConnection&&this._cloudLivekitConnection.connectionState&&this._cloudLivekitConnection.connectionState.get()===K.connected),this.onConnectedActions()}onConnectedActions(){this.sendVideoStatsUpdate(),this._videoStatsIntervalId=setInterval(()=>{this.sendVideoStatsUpdate()},1e3)}async sendVideoStatsUpdate(){var s,i,r,a,o,l,u,c,d,h,g,m,T,p,S,k;const e=await this._cloudLivekitConnection.getVideoStats().catch(b=>(I("LK: Error getting RTP video stats: ",b),{allStats:[String(b)]}));this.sendMessage({LivekitVideoStats:{enabled:!!this._cloudLivekitConnection.camTrack&&((s=this._cloudLivekitConnection._roomConn)==null?void 0:s.localParticipant.videoTrackPublications.size)>0,allowBackupCodec:!!((i=this._cloudLivekitConnection._videoPublishOptions)!=null&&i.backupCodec),baseStream:{Width:(a=(r=this._cloudLivekitConnection._videoCaptureOptions)==null?void 0:r.resolution)==null?void 0:a.width,Height:(l=(o=this._cloudLivekitConnection._videoCaptureOptions)==null?void 0:o.resolution)==null?void 0:l.height,Fps:(c=(u=this._cloudLivekitConnection._videoCaptureOptions)==null?void 0:u.resolution)==null?void 0:c.frameRate,MaxBitrate:(h=(d=this._cloudLivekitConnection._videoPublishOptions)==null?void 0:d.videoEncoding)==null?void 0:h.maxBitrate},codec:((g=this._cloudLivekitConnection._videoPublishOptions)==null?void 0:g.videoCodec)||"unknown",simulcastLayers:((T=(m=this._cloudLivekitConnection._videoPublishOptions)==null?void 0:m.videoSimulcastLayers)==null?void 0:T.map(b=>{var C,N;return{Width:b.width,Height:b.height,MaxBitrate:(C=b.encoding)==null?void 0:C.maxBitrate,Fps:(N=b.encoding)==null?void 0:N.maxFramerate}}))||[],stats:{...e}}},!1,[]);const t=this.simplePeerCameraOptions.get();for(const[b,C]of this._simplePeerConnections){if(!C||C.connectionState.get()!==K.connected)continue;const N=await C.getStats().catch(P=>(I("SP: Error getting rtc video stats for user "+b+":",P),{allStats:[String(P)]}));this.sendMessage({SimplePeerVideoStats:{enabled:!!C,baseStream:{Width:Number((p=t.video)==null?void 0:p.width),Height:Number((S=t.video)==null?void 0:S.height),Fps:Number((k=t.video)==null?void 0:k.frameRate)},stats:{...N}}},!1,[b])}}setLivekitVideoOptions(e,t,s){this._cloudLivekitConnection.enableCamera(e,t,s)}createSimplePeer(e,t){const s=this._simplePeerConnections.get(e);if(s)return I("SP: createSimplePeer() err - Connection already exists for user: "+e),s;const i=new mf;return this._simplePeerConnections.set(e,i),t&&i.ingestSignalingMsg(t),et(i.latestRecivedDataMessage,r=>{r&&yi(e,r)}),et(i.outgoingSignalingMessages,r=>{this.sendMessage({SimplePeerSignal:{Message:r}},!0,[e])}),i}setPreviewVideoElement(e){const t=document.getElementById("preview_video");t&&(t.srcObject=e)}async startSimplePeerConnection(e){this._simplePeerCameraStream||(this._simplePeerCameraStream=await Cs(navigator.mediaDevices.getUserMedia,navigator.mediaDevices,10,1e3,1.3)(this.simplePeerCameraOptions.get())),this.setPreviewVideoElement(this._simplePeerCameraStream);const t=this._simplePeerConnections.get(e);if(!t)throw new Error("SimplePeer Connection not created for user: "+e);await t.start(Object.assign({},bs,{initiator:!1,streams:[this._simplePeerCameraStream]}),!1)}async setSimplePeerVideoOptions(e,t,s,i){var r;if(e){console.log("Setting SimplePeer Video Options for "+t+":",s,i),this.simplePeerCameraOptions.update(l=>{var c,d,h;const u=l!=null&&l.video?l.video:ks.video;return{...l,video:{...l.video,width:((c=s==null?void 0:s.resolution)==null?void 0:c.width)||u.width||1920,height:((d=s==null?void 0:s.resolution)==null?void 0:d.height)||u.height||1080,frameRate:((h=s==null?void 0:s.resolution)==null?void 0:h.frameRate)||u.frameRate||60}}});const a=await navigator.mediaDevices.getUserMedia(this.simplePeerCameraOptions.get());this._simplePeerCameraStream,this._simplePeerCameraStream=a,this.setPreviewVideoElement(this._simplePeerCameraStream);let o=this._simplePeerConnections.get(t);o?o.changeMediaStream(this._simplePeerCameraStream):(o=this.createSimplePeer(t),o.start(Object.assign({},bs,{initiator:!1,streams:[this._simplePeerCameraStream]}),!1))}else(r=this._simplePeerCameraStream)==null||r.getTracks().forEach(a=>a.stop()),this._simplePeerCameraStream=null}async ingestSimplePeerSignalMsg(e,t){const s=this._simplePeerConnections.get(e);s===void 0?(this.createSimplePeer(e,t),await this.startSimplePeerConnection(e)):s.ingestSignalingMsg(t)}async sendMessage(e,t,s){if(!e)return!1;if(this._cloudLivekitConnection.connectionState.get()!==K.connected)return L.DEBUG_MODE&&se("LK: Message Not Sent, Livekit Not Connected"),!1;L.DEBUG_MODE&&se("LK/SP: "+(s.length==0?"Broadcasting msg ":"Sending msg to ["+s.join(", ")+"]")+(t?"reliably":"unreliably")+":",D.RovResponse.create(e).toJSON()),e.BackendMetadata=D.ResponseBackendMetadata.create({});const i=D.RovResponse.encode(e).finish();return await this._cloudLivekitConnection.sendMessage(i,t,s),!0}async stop(){clearInterval(this._videoStatsIntervalId),this._cloudLivekitConnection.close();for(const[e,t]of this._simplePeerConnections)t.stop()}}const q=new yf,Tf="/system-information";async function Ef(){return hr({method:"get",url:`${L.BLUEOS_APIS_ENDPOINT+Tf}/system`,timeout:1e4}).then(n=>n.data).catch(n=>{const e=`Could not fetch blueos system info: ${n.message}`;return I(e),e})}function Sf(n){const e=[],t=n?n.map(s=>s.usage).reduce((s,i)=>s+i,0)/n.length:0;return t>90&&e.push(`Rov CPU is nearly maxed out: ${t}%`),{value:t,warnings:e}}function wf(n){const e=n==null?void 0:n.find(o=>o.mount_point==="/");function t(o){const l=o?o.available_space_B/1073741824:0,u=o?o.total_space_B/2**30:0;return[u-l,u]}const[s,i]=t(e),r=100*s/i,a=r>95?[`Disk/SD Card is almost full: ${Math.round(s*10)/10}/${Math.round(s*10)/10}GB Used`]:[];return{value:r,warnings:a}}function bf(n){var l,u,c,d;const e=[],t=((l=n==null?void 0:n.ram)==null?void 0:l.used_kB)??0,s=((u=n==null?void 0:n.ram)==null?void 0:u.total_kB)??0,i=100*t/s,r=((c=n==null?void 0:n.swap)==null?void 0:c.used_kB)??0,a=((d=n==null?void 0:n.swap)==null?void 0:d.total_kB)??0,o=100*r/a;return i>90&&e.push(`RAM is almost full (${t} / ${s})`),o>90&&e.push(`Linux SWAP space is almost full (${r} / ${a})`),{value:i,warnings:e}}function kf(n){const e=n==null?void 0:n.find(i=>i.name==="CPU"),t=e?e.temperature:0,s=n?n.filter(i=>{const r=i.critical_temperature||1/0;return i.temperature>r}).map(i=>`Critical temperature reached in ${i.name}: ${i.temperature}°C`):[];return{value:t,warnings:s}}Object.assign(window,{getLongTermStarterAccessToken:Rd});Jt.defaultLogOrigin=za.ROV;L.SEND_LOGS&&(Jt.sendLogsAllowed=!0);const xi=document.getElementById("show_recent_logs_btn"),Fi=document.getElementById("recent_logs");xi&&Fi&&xi.addEventListener("click",()=>Jt.printRecentLogs(Fi));q.start({RovName:L.ROV_NAME,APIKey:L.LIVEKIT_API_KEY,SecretKey:L.LIVEKIT_SECRET_KEY,LivekitCloudURL:L.LIVEKIT_CLOUD_ENDPOINT,LivekitLocalURL:L.LIVEKIT_LOCAL_ENDPOINT}).then(()=>{document.getElementById("video_stats")});L.TWITCH_STREAM_KEY!=="None"&&jt.init(L.TWITCH_STREAM_KEY,L.ROV_NAME,L.LIVEKIT_API_KEY,L.LIVEKIT_SECRET_KEY);L.PYTHON_WEBSOCKET_PORT!=0?Bt.start("ws://localhost:"+L.PYTHON_WEBSOCKET_PORT,n=>{if(n.length===0)return;const e=D.RovResponse.decode(n);if(!e.BackendMetadata)return $("No BackendMetadata in message from iROV",e.toJSON(),n);const t=e.BackendMetadata.TargetUserIds,i=e.BackendMetadata.TransportMethod==D.DataTransportMethod.LivekitReliable;q.sendMessage(e,i,t||[])}):v("No PYTHON_WEBSOCKET_PORT url parameter set, skipping python websocket!");if(L.BLUEOS_APIS_ENDPOINT){const n="("+Rs.join(")|(")+")";te.start(Hi(L.BLUEOS_APIS_ENDPOINT)+":6040/ws/mavlink?filter="+n,e=>{if(!e.header||!e.message)return $("Mavlink message missing header or message body",e);vd(e);const t=Ui(JSON.stringify(e)),s=D.RovResponse.create({Mavlink:{Message:t}});Rs.includes(e.message.type)&&q.sendMessage(s,!0,[])},()=>{te.sendMessage(eo(0,8e6))}),setInterval(()=>{Ef().then(e=>{const t=kf(e.temperature),s=Sf(e.cpu),i=bf(e.memory),r=wf(e.disk),a=t.warnings.concat(s.warnings,i.warnings,r.warnings);L.DEBUG_MODE&&se("/SysInfo cpuTemp",t,"cpuUsage",s,"memUsage",i,"diskUsage",r,a);const o=D.RovResponse.create({SystemMonitor:{CpuTemp:t.value,CpuUsage:s.value,MemoryUsage:i.value,DiskUsage:r.value,Warnings:a}});q.sendMessage(o,!0,[])})},5e3)}else v("No BLUEOS_APIS_ENDPOINT url parameter set, skipping mavlink & system info monitoring!");window.addEventListener("beforeunload",()=>{jt.stopStream(),q.stop(),Bt.close(),te.close()});
//# sourceMappingURL=internal-a6f0a60a.js.map
