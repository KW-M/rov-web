var q=Object.defineProperty;var H=(o,t,i)=>t in o?q(o,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[t]=i;var D=(o,t,i)=>(H(o,typeof t!="symbol"?t+"":t,i),i);import{_ as dist,$ as get_store_value}from"./scheduler.b49bd52b.js";import"./RadioSelectGrid.1c44be4f.js";import"./index.eaa2bd3e.js";import{w as writable}from"./index.3ee1224b.js";var commonjsGlobal$1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs$1(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}const storePopup=writable(void 0);function focusTrap(o,t){const i='a[href]:not([tabindex="-1"]), button:not([tabindex="-1"]), input:not([tabindex="-1"]), textarea:not([tabindex="-1"]), select:not([tabindex="-1"]), details:not([tabindex="-1"]), [tabindex]:not([tabindex="-1"])';let e,n;function s(p){p.shiftKey&&p.code==="Tab"&&(p.preventDefault(),n.focus())}function a(p){!p.shiftKey&&p.code==="Tab"&&(p.preventDefault(),e.focus())}const c=p=>p.filter(m=>m.tabIndex>=0).sort((m,g)=>m.tabIndex===0&&g.tabIndex>0?1:m.tabIndex>0&&g.tabIndex===0?-1:m.tabIndex-g.tabIndex),l=p=>{const m=[...o.querySelectorAll("[data-focusindex]")];return!m||m.length===0?p:m.sort((g,v)=>+g.dataset.focusindex-+v.dataset.focusindex)[0]||p},u=p=>{if(t===!1)return;const m=c(Array.from(o.querySelectorAll(i)));m.length&&(e=m[0],n=m[m.length-1],p||l(e).focus(),e.addEventListener("keydown",s),n.addEventListener("keydown",a))};u(!1);function d(){e&&e.removeEventListener("keydown",s),n&&n.removeEventListener("keydown",a)}const f=(p,m)=>(p.length&&(d(),u(!0)),m),h=new MutationObserver(f);return h.observe(o,{childList:!0,subtree:!0}),{update(p){t=p,p?u(!1):d()},destroy(){d(),h.disconnect()}}}let computedTracker=[];function nStore(o){let t=[],i=(a,c=!0)=>(t.includes(a)||t.push(a),c&&a(o),()=>{t=t.filter(l=>l!=a)});function e(a){if(a===o&&(o===null||typeof o!="object"))return;let c=o;o=a;for(let l of t)l(o,c)}function n(){let a=computedTracker[computedTracker.length-1];return a&&i(a[0],!1),o}if(typeof o=="function")return computed(o);function s(){for(let a of t)a(o,o)}return{subscribe:i,set:e,get:n,refresh:s,update:a=>{typeof a=="function"&&e(a(o))}}}function computed(o){let t=nStore(null),i=[e];return e(),t;function e(){if(computedTracker.includes(i))throw Error("Circular computation");computedTracker.push(i);let n;try{n=o()}catch(s){throw computedTracker.pop(),s}computedTracker.pop(),t.set(n)}}var VideoSource=(o=>(o.None="",o.Livekit="LK",o.Simplepeer="SP",o))(VideoSource||{});const debugPageModeActive=nStore(!1),fullscreenOpen=nStore(!1),sidebarExpanded=nStore(!1),tutorialModeActive=nStore(!1),throttleGain=nStore(50);nStore(!1);const isRovDriver=nStore(!1);nStore("No Peer Id");const currentVideoSource=nStore(""),rovDrivingVector=nStore({VelocityX:0,VelocityY:0,VelocityZ:0,AngularVelocityYaw:0,ButtonBitmask:0});var indexMinimal={},minimal$1={},aspromise,hasRequiredAspromise;function requireAspromise(){if(hasRequiredAspromise)return aspromise;hasRequiredAspromise=1,aspromise=o;function o(t,i){for(var e=new Array(arguments.length-1),n=0,s=2,a=!0;s<arguments.length;)e[n++]=arguments[s++];return new Promise(function(l,u){e[n]=function(f){if(a)if(a=!1,f)u(f);else{for(var h=new Array(arguments.length-1),p=0;p<h.length;)h[p++]=arguments[p];l.apply(null,h)}};try{t.apply(i||null,e)}catch(d){a&&(a=!1,u(d))}})}return aspromise}var base64$1={},hasRequiredBase64;function requireBase64(){return hasRequiredBase64||(hasRequiredBase64=1,function(o){var t=o;t.length=function(c){var l=c.length;if(!l)return 0;for(var u=0;--l%4>1&&c.charAt(l)==="=";)++u;return Math.ceil(c.length*3)/4-u};for(var i=new Array(64),e=new Array(123),n=0;n<64;)e[i[n]=n<26?n+65:n<52?n+71:n<62?n-4:n-59|43]=n++;t.encode=function(c,l,u){for(var d=null,f=[],h=0,p=0,m;l<u;){var g=c[l++];switch(p){case 0:f[h++]=i[g>>2],m=(g&3)<<4,p=1;break;case 1:f[h++]=i[m|g>>4],m=(g&15)<<2,p=2;break;case 2:f[h++]=i[m|g>>6],f[h++]=i[g&63],p=0;break}h>8191&&((d||(d=[])).push(String.fromCharCode.apply(String,f)),h=0)}return p&&(f[h++]=i[m],f[h++]=61,p===1&&(f[h++]=61)),d?(h&&d.push(String.fromCharCode.apply(String,f.slice(0,h))),d.join("")):String.fromCharCode.apply(String,f.slice(0,h))};var s="invalid encoding";t.decode=function(c,l,u){for(var d=u,f=0,h,p=0;p<c.length;){var m=c.charCodeAt(p++);if(m===61&&f>1)break;if((m=e[m])===void 0)throw Error(s);switch(f){case 0:h=m,f=1;break;case 1:l[u++]=h<<2|(m&48)>>4,h=m,f=2;break;case 2:l[u++]=(h&15)<<4|(m&60)>>2,h=m,f=3;break;case 3:l[u++]=(h&3)<<6|m,f=0;break}}if(f===1)throw Error(s);return u-d},t.test=function(c){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(c)}}(base64$1)),base64$1}var eventemitter,hasRequiredEventemitter;function requireEventemitter(){if(hasRequiredEventemitter)return eventemitter;hasRequiredEventemitter=1,eventemitter=o;function o(){this._listeners={}}return o.prototype.on=function(i,e,n){return(this._listeners[i]||(this._listeners[i]=[])).push({fn:e,ctx:n||this}),this},o.prototype.off=function(i,e){if(i===void 0)this._listeners={};else if(e===void 0)this._listeners[i]=[];else for(var n=this._listeners[i],s=0;s<n.length;)n[s].fn===e?n.splice(s,1):++s;return this},o.prototype.emit=function(i){var e=this._listeners[i];if(e){for(var n=[],s=1;s<arguments.length;)n.push(arguments[s++]);for(s=0;s<e.length;)e[s].fn.apply(e[s++].ctx,n)}return this},eventemitter}var float,hasRequiredFloat;function requireFloat(){if(hasRequiredFloat)return float;hasRequiredFloat=1,float=o(o);function o(s){return typeof Float32Array<"u"?function(){var a=new Float32Array([-0]),c=new Uint8Array(a.buffer),l=c[3]===128;function u(p,m,g){a[0]=p,m[g]=c[0],m[g+1]=c[1],m[g+2]=c[2],m[g+3]=c[3]}function d(p,m,g){a[0]=p,m[g]=c[3],m[g+1]=c[2],m[g+2]=c[1],m[g+3]=c[0]}s.writeFloatLE=l?u:d,s.writeFloatBE=l?d:u;function f(p,m){return c[0]=p[m],c[1]=p[m+1],c[2]=p[m+2],c[3]=p[m+3],a[0]}function h(p,m){return c[3]=p[m],c[2]=p[m+1],c[1]=p[m+2],c[0]=p[m+3],a[0]}s.readFloatLE=l?f:h,s.readFloatBE=l?h:f}():function(){function a(l,u,d,f){var h=u<0?1:0;if(h&&(u=-u),u===0)l(1/u>0?0:2147483648,d,f);else if(isNaN(u))l(2143289344,d,f);else if(u>34028234663852886e22)l((h<<31|2139095040)>>>0,d,f);else if(u<11754943508222875e-54)l((h<<31|Math.round(u/1401298464324817e-60))>>>0,d,f);else{var p=Math.floor(Math.log(u)/Math.LN2),m=Math.round(u*Math.pow(2,-p)*8388608)&8388607;l((h<<31|p+127<<23|m)>>>0,d,f)}}s.writeFloatLE=a.bind(null,t),s.writeFloatBE=a.bind(null,i);function c(l,u,d){var f=l(u,d),h=(f>>31)*2+1,p=f>>>23&255,m=f&8388607;return p===255?m?NaN:h*(1/0):p===0?h*1401298464324817e-60*m:h*Math.pow(2,p-150)*(m+8388608)}s.readFloatLE=c.bind(null,e),s.readFloatBE=c.bind(null,n)}(),typeof Float64Array<"u"?function(){var a=new Float64Array([-0]),c=new Uint8Array(a.buffer),l=c[7]===128;function u(p,m,g){a[0]=p,m[g]=c[0],m[g+1]=c[1],m[g+2]=c[2],m[g+3]=c[3],m[g+4]=c[4],m[g+5]=c[5],m[g+6]=c[6],m[g+7]=c[7]}function d(p,m,g){a[0]=p,m[g]=c[7],m[g+1]=c[6],m[g+2]=c[5],m[g+3]=c[4],m[g+4]=c[3],m[g+5]=c[2],m[g+6]=c[1],m[g+7]=c[0]}s.writeDoubleLE=l?u:d,s.writeDoubleBE=l?d:u;function f(p,m){return c[0]=p[m],c[1]=p[m+1],c[2]=p[m+2],c[3]=p[m+3],c[4]=p[m+4],c[5]=p[m+5],c[6]=p[m+6],c[7]=p[m+7],a[0]}function h(p,m){return c[7]=p[m],c[6]=p[m+1],c[5]=p[m+2],c[4]=p[m+3],c[3]=p[m+4],c[2]=p[m+5],c[1]=p[m+6],c[0]=p[m+7],a[0]}s.readDoubleLE=l?f:h,s.readDoubleBE=l?h:f}():function(){function a(l,u,d,f,h,p){var m=f<0?1:0;if(m&&(f=-f),f===0)l(0,h,p+u),l(1/f>0?0:2147483648,h,p+d);else if(isNaN(f))l(0,h,p+u),l(2146959360,h,p+d);else if(f>17976931348623157e292)l(0,h,p+u),l((m<<31|2146435072)>>>0,h,p+d);else{var g;if(f<22250738585072014e-324)g=f/5e-324,l(g>>>0,h,p+u),l((m<<31|g/4294967296)>>>0,h,p+d);else{var v=Math.floor(Math.log(f)/Math.LN2);v===1024&&(v=1023),g=f*Math.pow(2,-v),l(g*4503599627370496>>>0,h,p+u),l((m<<31|v+1023<<20|g*1048576&1048575)>>>0,h,p+d)}}}s.writeDoubleLE=a.bind(null,t,0,4),s.writeDoubleBE=a.bind(null,i,4,0);function c(l,u,d,f,h){var p=l(f,h+u),m=l(f,h+d),g=(m>>31)*2+1,v=m>>>20&2047,T=4294967296*(m&1048575)+p;return v===2047?T?NaN:g*(1/0):v===0?g*5e-324*T:g*Math.pow(2,v-1075)*(T+4503599627370496)}s.readDoubleLE=c.bind(null,e,0,4),s.readDoubleBE=c.bind(null,n,4,0)}(),s}function t(s,a,c){a[c]=s&255,a[c+1]=s>>>8&255,a[c+2]=s>>>16&255,a[c+3]=s>>>24}function i(s,a,c){a[c]=s>>>24,a[c+1]=s>>>16&255,a[c+2]=s>>>8&255,a[c+3]=s&255}function e(s,a){return(s[a]|s[a+1]<<8|s[a+2]<<16|s[a+3]<<24)>>>0}function n(s,a){return(s[a]<<24|s[a+1]<<16|s[a+2]<<8|s[a+3])>>>0}return float}var inquire_1,hasRequiredInquire;function requireInquire(){if(hasRequiredInquire)return inquire_1;hasRequiredInquire=1,inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(o){}return null}return inquire_1}var utf8$2={},hasRequiredUtf8;function requireUtf8(){return hasRequiredUtf8||(hasRequiredUtf8=1,function(o){var t=o;t.length=function(e){for(var n=0,s=0,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?n+=1:s<2048?n+=2:(s&64512)===55296&&(e.charCodeAt(a+1)&64512)===56320?(++a,n+=4):n+=3;return n},t.read=function(e,n,s){var a=s-n;if(a<1)return"";for(var c=null,l=[],u=0,d;n<s;)d=e[n++],d<128?l[u++]=d:d>191&&d<224?l[u++]=(d&31)<<6|e[n++]&63:d>239&&d<365?(d=((d&7)<<18|(e[n++]&63)<<12|(e[n++]&63)<<6|e[n++]&63)-65536,l[u++]=55296+(d>>10),l[u++]=56320+(d&1023)):l[u++]=(d&15)<<12|(e[n++]&63)<<6|e[n++]&63,u>8191&&((c||(c=[])).push(String.fromCharCode.apply(String,l)),u=0);return c?(u&&c.push(String.fromCharCode.apply(String,l.slice(0,u))),c.join("")):String.fromCharCode.apply(String,l.slice(0,u))},t.write=function(e,n,s){for(var a=s,c,l,u=0;u<e.length;++u)c=e.charCodeAt(u),c<128?n[s++]=c:c<2048?(n[s++]=c>>6|192,n[s++]=c&63|128):(c&64512)===55296&&((l=e.charCodeAt(u+1))&64512)===56320?(c=65536+((c&1023)<<10)+(l&1023),++u,n[s++]=c>>18|240,n[s++]=c>>12&63|128,n[s++]=c>>6&63|128,n[s++]=c&63|128):(n[s++]=c>>12|224,n[s++]=c>>6&63|128,n[s++]=c&63|128);return s-a}}(utf8$2)),utf8$2}var pool_1,hasRequiredPool;function requirePool(){if(hasRequiredPool)return pool_1;hasRequiredPool=1,pool_1=o;function o(t,i,e){var n=e||8192,s=n>>>1,a=null,c=n;return function(u){if(u<1||u>s)return t(u);c+u>n&&(a=t(n),c=0);var d=i.call(a,c,c+=u);return c&7&&(c=(c|7)+1),d}}return pool_1}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=t;var o=requireMinimal();function t(s,a){this.lo=s>>>0,this.hi=a>>>0}var i=t.zero=new t(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var e=t.zeroHash="\0\0\0\0\0\0\0\0";t.fromNumber=function(a){if(a===0)return i;var c=a<0;c&&(a=-a);var l=a>>>0,u=(a-l)/4294967296>>>0;return c&&(u=~u>>>0,l=~l>>>0,++l>4294967295&&(l=0,++u>4294967295&&(u=0))),new t(l,u)},t.from=function(a){if(typeof a=="number")return t.fromNumber(a);if(o.isString(a))if(o.Long)a=o.Long.fromString(a);else return t.fromNumber(parseInt(a,10));return a.low||a.high?new t(a.low>>>0,a.high>>>0):i},t.prototype.toNumber=function(a){if(!a&&this.hi>>>31){var c=~this.lo+1>>>0,l=~this.hi>>>0;return c||(l=l+1>>>0),-(c+l*4294967296)}return this.lo+this.hi*4294967296},t.prototype.toLong=function(a){return o.Long?new o.Long(this.lo|0,this.hi|0,!!a):{low:this.lo|0,high:this.hi|0,unsigned:!!a}};var n=String.prototype.charCodeAt;return t.fromHash=function(a){return a===e?i:new t((n.call(a,0)|n.call(a,1)<<8|n.call(a,2)<<16|n.call(a,3)<<24)>>>0,(n.call(a,4)|n.call(a,5)<<8|n.call(a,6)<<16|n.call(a,7)<<24)>>>0)},t.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},t.prototype.zzEncode=function(){var a=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^a)>>>0,this.lo=(this.lo<<1^a)>>>0,this},t.prototype.zzDecode=function(){var a=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^a)>>>0,this.hi=(this.hi>>>1^a)>>>0,this},t.prototype.length=function(){var a=this.lo,c=(this.lo>>>28|this.hi<<4)>>>0,l=this.hi>>>24;return l===0?c===0?a<16384?a<128?1:2:a<2097152?3:4:c<16384?c<128?5:6:c<2097152?7:8:l<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(o){var t=o;t.asPromise=requireAspromise(),t.base64=requireBase64(),t.EventEmitter=requireEventemitter(),t.float=requireFloat(),t.inquire=requireInquire(),t.utf8=requireUtf8(),t.pool=requirePool(),t.LongBits=requireLongbits(),t.isNode=!!(typeof commonjsGlobal$1<"u"&&commonjsGlobal$1&&commonjsGlobal$1.process&&commonjsGlobal$1.process.versions&&commonjsGlobal$1.process.versions.node),t.global=t.isNode&&commonjsGlobal$1||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal$1,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(s){return typeof s=="number"&&isFinite(s)&&Math.floor(s)===s},t.isString=function(s){return typeof s=="string"||s instanceof String},t.isObject=function(s){return s&&typeof s=="object"},t.isset=t.isSet=function(s,a){var c=s[a];return c!=null&&s.hasOwnProperty(a)?typeof c!="object"||(Array.isArray(c)?c.length:Object.keys(c).length)>0:!1},t.Buffer=function(){try{var n=t.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(s){return typeof s=="number"?t.Buffer?t._Buffer_allocUnsafe(s):new t.Array(s):t.Buffer?t._Buffer_from(s):typeof Uint8Array>"u"?s:new Uint8Array(s)},t.Array=typeof Uint8Array<"u"?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(s){return s?t.LongBits.from(s).toHash():t.LongBits.zeroHash},t.longFromHash=function(s,a){var c=t.LongBits.fromHash(s);return t.Long?t.Long.fromBits(c.lo,c.hi,a):c.toNumber(!!a)};function i(n,s,a){for(var c=Object.keys(s),l=0;l<c.length;++l)(n[c[l]]===void 0||!a)&&(n[c[l]]=s[c[l]]);return n}t.merge=i,t.lcFirst=function(s){return s.charAt(0).toLowerCase()+s.substring(1)};function e(n){function s(a,c){if(!(this instanceof s))return new s(a,c);Object.defineProperty(this,"message",{get:function(){return a}}),Error.captureStackTrace?Error.captureStackTrace(this,s):Object.defineProperty(this,"stack",{value:new Error().stack||""}),c&&i(this,c)}return s.prototype=Object.create(Error.prototype,{constructor:{value:s,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),s}t.newError=e,t.ProtocolError=e("ProtocolError"),t.oneOfGetter=function(s){for(var a={},c=0;c<s.length;++c)a[s[c]]=1;return function(){for(var l=Object.keys(this),u=l.length-1;u>-1;--u)if(a[l[u]]===1&&this[l[u]]!==void 0&&this[l[u]]!==null)return l[u]}},t.oneOfSetter=function(s){return function(a){for(var c=0;c<s.length;++c)s[c]!==a&&delete this[s[c]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var n=t.Buffer;if(!n){t._Buffer_from=t._Buffer_allocUnsafe=null;return}t._Buffer_from=n.from!==Uint8Array.from&&n.from||function(a,c){return new n(a,c)},t._Buffer_allocUnsafe=n.allocUnsafe||function(a){return new n(a)}}}(minimal$1)),minimal$1}var writer$2=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(o,t,i){this.fn=o,this.len=t,this.next=void 0,this.val=i}function noop(){}function State(o){this.head=o.head,this.tail=o.tail,this.len=o.len,this.next=o.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function o(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};Writer$1.create=create$1();Writer$1.alloc=function o(t){return new util$4.Array(t)};util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray));Writer$1.prototype._push=function o(t,i,e){return this.tail=this.tail.next=new Op(t,i,e),this.len+=i,this};function writeByte(o,t,i){t[i]=o&255}function writeVarint32(o,t,i){for(;o>127;)t[i++]=o&127|128,o>>>=7;t[i]=o}function VarintOp(o,t){this.len=o,this.next=void 0,this.val=t}VarintOp.prototype=Object.create(Op.prototype);VarintOp.prototype.fn=writeVarint32;Writer$1.prototype.uint32=function o(t){return this.len+=(this.tail=this.tail.next=new VarintOp((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this};Writer$1.prototype.int32=function o(t){return t<0?this._push(writeVarint64,10,LongBits$1.fromNumber(t)):this.uint32(t)};Writer$1.prototype.sint32=function o(t){return this.uint32((t<<1^t>>31)>>>0)};function writeVarint64(o,t,i){for(;o.hi;)t[i++]=o.lo&127|128,o.lo=(o.lo>>>7|o.hi<<25)>>>0,o.hi>>>=7;for(;o.lo>127;)t[i++]=o.lo&127|128,o.lo=o.lo>>>7;t[i++]=o.lo}Writer$1.prototype.uint64=function o(t){var i=LongBits$1.from(t);return this._push(writeVarint64,i.length(),i)};Writer$1.prototype.int64=Writer$1.prototype.uint64;Writer$1.prototype.sint64=function o(t){var i=LongBits$1.from(t).zzEncode();return this._push(writeVarint64,i.length(),i)};Writer$1.prototype.bool=function o(t){return this._push(writeByte,1,t?1:0)};function writeFixed32(o,t,i){t[i]=o&255,t[i+1]=o>>>8&255,t[i+2]=o>>>16&255,t[i+3]=o>>>24}Writer$1.prototype.fixed32=function o(t){return this._push(writeFixed32,4,t>>>0)};Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32;Writer$1.prototype.fixed64=function o(t){var i=LongBits$1.from(t);return this._push(writeFixed32,4,i.lo)._push(writeFixed32,4,i.hi)};Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64;Writer$1.prototype.float=function o(t){return this._push(util$4.float.writeFloatLE,4,t)};Writer$1.prototype.double=function o(t){return this._push(util$4.float.writeDoubleLE,8,t)};var writeBytes=util$4.Array.prototype.set?function o(t,i,e){i.set(t,e)}:function o(t,i,e){for(var n=0;n<t.length;++n)i[e+n]=t[n]};Writer$1.prototype.bytes=function o(t){var i=t.length>>>0;if(!i)return this._push(writeByte,1,0);if(util$4.isString(t)){var e=Writer$1.alloc(i=base64.length(t));base64.decode(t,e,0),t=e}return this.uint32(i)._push(writeBytes,i,t)};Writer$1.prototype.string=function o(t){var i=utf8$1.length(t);return i?this.uint32(i)._push(utf8$1.write,i,t):this._push(writeByte,1,0)};Writer$1.prototype.fork=function o(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this};Writer$1.prototype.reset=function o(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this};Writer$1.prototype.ldelim=function o(){var t=this.head,i=this.tail,e=this.len;return this.reset().uint32(e),e&&(this.tail.next=t.next,this.tail=i,this.len+=e),this};Writer$1.prototype.finish=function o(){for(var t=this.head.next,i=this.constructor.alloc(this.len),e=0;t;)t.fn(t.val,i,e),e+=t.len,t=t.next;return i};Writer$1._configure=function(o){BufferWriter$1=o,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer$2;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&util$3.Buffer.prototype.set.name==="set"?function(t,i,e){i.set(t,e)}:function(t,i,e){if(t.copy)t.copy(i,e,0,t.length);else for(var n=0;n<t.length;)i[e++]=t[n++]}};BufferWriter.prototype.bytes=function o(t){util$3.isString(t)&&(t=util$3._Buffer_from(t,"base64"));var i=t.length>>>0;return this.uint32(i),i&&this._push(BufferWriter.writeBytesBuffer,i,t),this};function writeStringBuffer(o,t,i){o.length<40?util$3.utf8.write(o,t,i):t.utf8Write?t.utf8Write(o,i):t.write(o,i)}BufferWriter.prototype.string=function o(t){var i=util$3.Buffer.byteLength(t);return this.uint32(i),i&&this._push(writeStringBuffer,i,t),this};BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(o,t){return RangeError("index out of range: "+o.pos+" + "+(t||1)+" > "+o.len)}function Reader$1(o){this.buf=o,this.pos=0,this.len=o.length}var create_array=typeof Uint8Array<"u"?function o(t){if(t instanceof Uint8Array||Array.isArray(t))return new Reader$1(t);throw Error("illegal buffer")}:function o(t){if(Array.isArray(t))return new Reader$1(t);throw Error("illegal buffer")},create=function o(){return util$2.Buffer?function(i){return(Reader$1.create=function(n){return util$2.Buffer.isBuffer(n)?new BufferReader$1(n):create_array(n)})(i)}:create_array};Reader$1.create=create();Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice;Reader$1.prototype.uint32=function o(){var t=4294967295;return function(){if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return t}}();Reader$1.prototype.int32=function o(){return this.uint32()|0};Reader$1.prototype.sint32=function o(){var t=this.uint32();return t>>>1^-(t&1)|0};function readLongVarint(){var o=new LongBits(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(o.lo=(o.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return o;if(o.lo=(o.lo|(this.buf[this.pos]&127)<<28)>>>0,o.hi=(o.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return o;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(o.lo=(o.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return o}return o.lo=(o.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,o}if(this.len-this.pos>4){for(;t<5;++t)if(o.hi=(o.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return o}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(o.hi=(o.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return o}throw Error("invalid varint encoding")}Reader$1.prototype.bool=function o(){return this.uint32()!==0};function readFixed32_end(o,t){return(o[t-4]|o[t-3]<<8|o[t-2]<<16|o[t-1]<<24)>>>0}Reader$1.prototype.fixed32=function o(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)};Reader$1.prototype.sfixed32=function o(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)|0};function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.prototype.float=function o(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var t=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t};Reader$1.prototype.double=function o(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var t=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t};Reader$1.prototype.bytes=function o(){var t=this.uint32(),i=this.pos,e=this.pos+t;if(e>this.len)throw indexOutOfRange(this,t);if(this.pos+=t,Array.isArray(this.buf))return this.buf.slice(i,e);if(i===e){var n=util$2.Buffer;return n?n.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,i,e)};Reader$1.prototype.string=function o(){var t=this.bytes();return utf8.read(t,0,t.length)};Reader$1.prototype.skip=function o(t){if(typeof t=="number"){if(this.pos+t>this.len)throw indexOutOfRange(this,t);this.pos+=t}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this};Reader$1.prototype.skipType=function(o){switch(o){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(o=this.uint32()&7)!==4;)this.skipType(o);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+o+" at offset "+this.pos)}return this};Reader$1._configure=function(o){BufferReader$1=o,Reader$1.create=create(),BufferReader$1._configure();var t=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[t](!1)},uint64:function(){return readLongVarint.call(this)[t](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64.call(this)[t](!0)},sfixed64:function(){return readFixed64.call(this)[t](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(o){Reader.call(this,o)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)};BufferReader.prototype.string=function o(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))};BufferReader._configure();var rpc={},service=Service,util=requireMinimal();(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service;function Service(o,t,i){if(typeof o!="function")throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=o,this.requestDelimited=!!t,this.responseDelimited=!!i}Service.prototype.rpcCall=function o(t,i,e,n,s){if(!n)throw TypeError("request must be specified");var a=this;if(!s)return util.asPromise(o,a,t,i,e,n);if(!a.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return a.rpcImpl(t,i[a.requestDelimited?"encodeDelimited":"encode"](n).finish(),function(l,u){if(l)return a.emit("error",l,t),s(l);if(u===null){a.end(!0);return}if(!(u instanceof e))try{u=e[a.responseDelimited?"decodeDelimited":"decode"](u)}catch(d){return a.emit("error",d,t),s(d)}return a.emit("data",u,t),s(null,u)})}catch(c){a.emit("error",c,t),setTimeout(function(){s(c)},0);return}};Service.prototype.end=function o(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};(function(o){var t=o;t.Service=service})(rpc);var roots={};(function(o){var t=o;t.build="minimal",t.Writer=writer$2,t.BufferWriter=writer_buffer,t.Reader=reader,t.BufferReader=reader_buffer,t.util=requireMinimal(),t.rpc=rpc,t.roots=roots,t.configure=i;function i(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}i()})(indexMinimal);var minimal=indexMinimal;const $Reader=minimal.Reader,$Writer=minimal.Writer,$util=minimal.util,$root=minimal.roots.default||(minimal.roots.default={}),rov_actions_proto=$root.rov_actions_proto=(()=>{const o={};return o.LogLevel=function(){const t={},i=Object.create(t);return i[t[0]="Debug"]=0,i[t[1]="Info"]=1,i[t[2]="Warning"]=2,i[t[3]="Error"]=3,i[t[4]="Critical"]=4,i}(),o.SensorMeasurmentTypes=function(){const t={},i=Object.create(t);return i[t[0]="depth_meters"]=0,i[t[1]="water_temp_celsius"]=1,i[t[2]="pressure_mbar"]=2,i[t[3]="yaw_degrees"]=3,i[t[4]="pitch_degrees"]=4,i[t[5]="roll_degrees"]=5,i[t[6]="x_acceleration_m_s2"]=6,i[t[7]="y_acceleration_m_s2"]=7,i[t[8]="z_acceleration_m_s2"]=8,i[t[9]="battery_voltage"]=9,i[t[10]="battery_current_amps"]=10,i[t[11]="internal_temp_celsius"]=11,i}(),o.Measurement=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.MeasurementType=0,t.prototype.Value=0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.MeasurementType!=null&&Object.hasOwnProperty.call(e,"MeasurementType")&&n.uint32(8).int32(e.MeasurementType),e.Value!=null&&Object.hasOwnProperty.call(e,"Value")&&n.uint32(21).float(e.Value),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.Measurement;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.MeasurementType=e.int32();break}case 2:{a.Value=e.float();break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.MeasurementType!=null&&e.hasOwnProperty("MeasurementType"))switch(e.MeasurementType){default:return"MeasurementType: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:break}return e.Value!=null&&e.hasOwnProperty("Value")&&typeof e.Value!="number"?"Value: number expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.Measurement)return e;let n=new $root.rov_actions_proto.Measurement;switch(e.MeasurementType){default:if(typeof e.MeasurementType=="number"){n.MeasurementType=e.MeasurementType;break}break;case"depth_meters":case 0:n.MeasurementType=0;break;case"water_temp_celsius":case 1:n.MeasurementType=1;break;case"pressure_mbar":case 2:n.MeasurementType=2;break;case"yaw_degrees":case 3:n.MeasurementType=3;break;case"pitch_degrees":case 4:n.MeasurementType=4;break;case"roll_degrees":case 5:n.MeasurementType=5;break;case"x_acceleration_m_s2":case 6:n.MeasurementType=6;break;case"y_acceleration_m_s2":case 7:n.MeasurementType=7;break;case"z_acceleration_m_s2":case 8:n.MeasurementType=8;break;case"battery_voltage":case 9:n.MeasurementType=9;break;case"battery_current_amps":case 10:n.MeasurementType=10;break;case"internal_temp_celsius":case 11:n.MeasurementType=11;break}return e.Value!=null&&(n.Value=Number(e.Value)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.MeasurementType=n.enums===String?"depth_meters":0,s.Value=0),e.MeasurementType!=null&&e.hasOwnProperty("MeasurementType")&&(s.MeasurementType=n.enums===String?$root.rov_actions_proto.SensorMeasurmentTypes[e.MeasurementType]===void 0?e.MeasurementType:$root.rov_actions_proto.SensorMeasurmentTypes[e.MeasurementType]:e.MeasurementType),e.Value!=null&&e.hasOwnProperty("Value")&&(s.Value=n.json&&!isFinite(e.Value)?String(e.Value):e.Value),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.Measurement"},t}(),o.DataTransportMethod=function(){const t={},i=Object.create(t);return i[t[0]="LivekitReliable"]=0,i[t[1]="LivekitUnreliable"]=1,i[t[3]="DirectUnreliable"]=3,i}(),o.InternalWebpageEvent=function(){const t={},i=Object.create(t);return i[t[0]="Nothing"]=0,i[t[1]="RovConnected"]=1,i[t[2]="RovDisconnected"]=2,i[t[3]="UserConnected"]=3,i[t[4]="UserDisconnected"]=4,i}(),o.PingAction=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.Time=$util.Long?$util.Long.fromBits(0,0,!1):0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Time!=null&&Object.hasOwnProperty.call(e,"Time")&&n.uint32(8).int64(e.Time),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.PingAction;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.Time=e.int64();break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Time!=null&&e.hasOwnProperty("Time")&&!$util.isInteger(e.Time)&&!(e.Time&&$util.isInteger(e.Time.low)&&$util.isInteger(e.Time.high))?"Time: integer|Long expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.PingAction)return e;let n=new $root.rov_actions_proto.PingAction;return e.Time!=null&&($util.Long?(n.Time=$util.Long.fromValue(e.Time)).unsigned=!1:typeof e.Time=="string"?n.Time=parseInt(e.Time,10):typeof e.Time=="number"?n.Time=e.Time:typeof e.Time=="object"&&(n.Time=new $util.LongBits(e.Time.low>>>0,e.Time.high>>>0).toNumber())),n},t.toObject=function(e,n){n||(n={});let s={};if(n.defaults)if($util.Long){let a=new $util.Long(0,0,!1);s.Time=n.longs===String?a.toString():n.longs===Number?a.toNumber():a}else s.Time=n.longs===String?"0":0;return e.Time!=null&&e.hasOwnProperty("Time")&&(typeof e.Time=="number"?s.Time=n.longs===String?String(e.Time):e.Time:s.Time=n.longs===String?$util.Long.prototype.toString.call(e.Time):n.longs===Number?new $util.LongBits(e.Time.low>>>0,e.Time.high>>>0).toNumber():e.Time),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.PingAction"},t}(),o.PasswordAttemptAction=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.Password="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Password!=null&&Object.hasOwnProperty.call(e,"Password")&&n.uint32(10).string(e.Password),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.PasswordAttemptAction;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.Password=e.string();break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Password!=null&&e.hasOwnProperty("Password")&&!$util.isString(e.Password)?"Password: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.PasswordAttemptAction)return e;let n=new $root.rov_actions_proto.PasswordAttemptAction;return e.Password!=null&&(n.Password=String(e.Password)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.Password=""),e.Password!=null&&e.hasOwnProperty("Password")&&(s.Password=e.Password),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.PasswordAttemptAction"},t}(),o.AuthTokenAttemptAction=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.Token="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Token!=null&&Object.hasOwnProperty.call(e,"Token")&&n.uint32(10).string(e.Token),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.AuthTokenAttemptAction;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.Token=e.string();break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Token!=null&&e.hasOwnProperty("Token")&&!$util.isString(e.Token)?"Token: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.AuthTokenAttemptAction)return e;let n=new $root.rov_actions_proto.AuthTokenAttemptAction;return e.Token!=null&&(n.Token=String(e.Token)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.Token=""),e.Token!=null&&e.hasOwnProperty("Token")&&(s.Token=e.Token),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.AuthTokenAttemptAction"},t}(),o.TakeControlAction=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.TakeControlAction;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.TakeControlAction?e:new $root.rov_actions_proto.TakeControlAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.TakeControlAction"},t}(),o.MoveAction=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.VelocityX=0,t.prototype.VelocityY=0,t.prototype.VelocityZ=0,t.prototype.AngularVelocityYaw=0,t.prototype.ButtonBitmask=0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.VelocityX!=null&&Object.hasOwnProperty.call(e,"VelocityX")&&n.uint32(13).float(e.VelocityX),e.VelocityY!=null&&Object.hasOwnProperty.call(e,"VelocityY")&&n.uint32(21).float(e.VelocityY),e.VelocityZ!=null&&Object.hasOwnProperty.call(e,"VelocityZ")&&n.uint32(29).float(e.VelocityZ),e.AngularVelocityYaw!=null&&Object.hasOwnProperty.call(e,"AngularVelocityYaw")&&n.uint32(37).float(e.AngularVelocityYaw),e.ButtonBitmask!=null&&Object.hasOwnProperty.call(e,"ButtonBitmask")&&n.uint32(40).int32(e.ButtonBitmask),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.MoveAction;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.VelocityX=e.float();break}case 2:{a.VelocityY=e.float();break}case 3:{a.VelocityZ=e.float();break}case 4:{a.AngularVelocityYaw=e.float();break}case 5:{a.ButtonBitmask=e.int32();break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.VelocityX!=null&&e.hasOwnProperty("VelocityX")&&typeof e.VelocityX!="number"?"VelocityX: number expected":e.VelocityY!=null&&e.hasOwnProperty("VelocityY")&&typeof e.VelocityY!="number"?"VelocityY: number expected":e.VelocityZ!=null&&e.hasOwnProperty("VelocityZ")&&typeof e.VelocityZ!="number"?"VelocityZ: number expected":e.AngularVelocityYaw!=null&&e.hasOwnProperty("AngularVelocityYaw")&&typeof e.AngularVelocityYaw!="number"?"AngularVelocityYaw: number expected":e.ButtonBitmask!=null&&e.hasOwnProperty("ButtonBitmask")&&!$util.isInteger(e.ButtonBitmask)?"ButtonBitmask: integer expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.MoveAction)return e;let n=new $root.rov_actions_proto.MoveAction;return e.VelocityX!=null&&(n.VelocityX=Number(e.VelocityX)),e.VelocityY!=null&&(n.VelocityY=Number(e.VelocityY)),e.VelocityZ!=null&&(n.VelocityZ=Number(e.VelocityZ)),e.AngularVelocityYaw!=null&&(n.AngularVelocityYaw=Number(e.AngularVelocityYaw)),e.ButtonBitmask!=null&&(n.ButtonBitmask=e.ButtonBitmask|0),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.VelocityX=0,s.VelocityY=0,s.VelocityZ=0,s.AngularVelocityYaw=0,s.ButtonBitmask=0),e.VelocityX!=null&&e.hasOwnProperty("VelocityX")&&(s.VelocityX=n.json&&!isFinite(e.VelocityX)?String(e.VelocityX):e.VelocityX),e.VelocityY!=null&&e.hasOwnProperty("VelocityY")&&(s.VelocityY=n.json&&!isFinite(e.VelocityY)?String(e.VelocityY):e.VelocityY),e.VelocityZ!=null&&e.hasOwnProperty("VelocityZ")&&(s.VelocityZ=n.json&&!isFinite(e.VelocityZ)?String(e.VelocityZ):e.VelocityZ),e.AngularVelocityYaw!=null&&e.hasOwnProperty("AngularVelocityYaw")&&(s.AngularVelocityYaw=n.json&&!isFinite(e.AngularVelocityYaw)?String(e.AngularVelocityYaw):e.AngularVelocityYaw),e.ButtonBitmask!=null&&e.hasOwnProperty("ButtonBitmask")&&(s.ButtonBitmask=e.ButtonBitmask),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.MoveAction"},t}(),o.BeginVideoStreamAction=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.BeginVideoStreamAction;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.BeginVideoStreamAction?e:new $root.rov_actions_proto.BeginVideoStreamAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.BeginVideoStreamAction"},t}(),o.TakePhotoAction=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.TakePhotoAction;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.TakePhotoAction?e:new $root.rov_actions_proto.TakePhotoAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.TakePhotoAction"},t}(),o.StartVideoRecAction=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.StartVideoRecAction;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.StartVideoRecAction?e:new $root.rov_actions_proto.StartVideoRecAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.StartVideoRecAction"},t}(),o.StopVideoRecAction=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.StopVideoRecAction;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.StopVideoRecAction?e:new $root.rov_actions_proto.StopVideoRecAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.StopVideoRecAction"},t}(),o.ToogleLightsAction=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.ToogleLightsAction;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.ToogleLightsAction?e:new $root.rov_actions_proto.ToogleLightsAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.ToogleLightsAction"},t}(),o.ShutdownRovAction=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.ShutdownRovAction;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.ShutdownRovAction?e:new $root.rov_actions_proto.ShutdownRovAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.ShutdownRovAction"},t}(),o.RebootRovAction=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.RebootRovAction;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.RebootRovAction?e:new $root.rov_actions_proto.RebootRovAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.RebootRovAction"},t}(),o.EnableWifiAction=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.EnableWifiAction;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.EnableWifiAction?e:new $root.rov_actions_proto.EnableWifiAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.EnableWifiAction"},t}(),o.DisableWifiAction=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.DisableWifiAction;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.DisableWifiAction?e:new $root.rov_actions_proto.DisableWifiAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.DisableWifiAction"},t}(),o.RovStatusReportAction=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.RovStatusReportAction;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.RovStatusReportAction?e:new $root.rov_actions_proto.RovStatusReportAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.RovStatusReportAction"},t}(),o.RestartRovServicesAction=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.RestartRovServicesAction;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.RestartRovServicesAction?e:new $root.rov_actions_proto.RestartRovServicesAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.RestartRovServicesAction"},t}(),o.RovLogsAction=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.RovLogsAction;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.RovLogsAction?e:new $root.rov_actions_proto.RovLogsAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.RovLogsAction"},t}(),o.RefreshAllSensorsAction=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.RefreshAllSensorsAction;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.RefreshAllSensorsAction?e:new $root.rov_actions_proto.RefreshAllSensorsAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.RefreshAllSensorsAction"},t}(),o.MavlinkAction=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.Message=$util.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Message!=null&&Object.hasOwnProperty.call(e,"Message")&&n.uint32(10).bytes(e.Message),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.MavlinkAction;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.Message=e.bytes();break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Message!=null&&e.hasOwnProperty("Message")&&!(e.Message&&typeof e.Message.length=="number"||$util.isString(e.Message))?"Message: buffer expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.MavlinkAction)return e;let n=new $root.rov_actions_proto.MavlinkAction;return e.Message!=null&&(typeof e.Message=="string"?$util.base64.decode(e.Message,n.Message=$util.newBuffer($util.base64.length(e.Message)),0):e.Message.length>=0&&(n.Message=e.Message)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(n.bytes===String?s.Message="":(s.Message=[],n.bytes!==Array&&(s.Message=$util.newBuffer(s.Message)))),e.Message!=null&&e.hasOwnProperty("Message")&&(s.Message=n.bytes===String?$util.base64.encode(e.Message,0,e.Message.length):n.bytes===Array?Array.prototype.slice.call(e.Message):e.Message),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.MavlinkAction"},t}(),o.SimplepeerSignalAction=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.Message="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Message!=null&&Object.hasOwnProperty.call(e,"Message")&&n.uint32(10).string(e.Message),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.SimplepeerSignalAction;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.Message=e.string();break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Message!=null&&e.hasOwnProperty("Message")&&!$util.isString(e.Message)?"Message: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.SimplepeerSignalAction)return e;let n=new $root.rov_actions_proto.SimplepeerSignalAction;return e.Message!=null&&(n.Message=String(e.Message)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.Message=""),e.Message!=null&&e.hasOwnProperty("Message")&&(s.Message=e.Message),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SimplepeerSignalAction"},t}(),o.DisarmAction=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.DisarmAction;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.DisarmAction?e:new $root.rov_actions_proto.DisarmAction},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.DisarmAction"},t}(),o.SetAutopilotModeAction=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.mode=0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.mode!=null&&Object.hasOwnProperty.call(e,"mode")&&n.uint32(8).int32(e.mode),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.SetAutopilotModeAction;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.mode=e.int32();break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.mode!=null&&e.hasOwnProperty("mode")&&!$util.isInteger(e.mode)?"mode: integer expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.SetAutopilotModeAction)return e;let n=new $root.rov_actions_proto.SetAutopilotModeAction;return e.mode!=null&&(n.mode=e.mode|0),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.mode=0),e.mode!=null&&e.hasOwnProperty("mode")&&(s.mode=e.mode),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SetAutopilotModeAction"},t}(),o.ActionBackendMetadata=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.FromUserId="",t.prototype.InternalWebpageEvt=0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.FromUserId!=null&&Object.hasOwnProperty.call(e,"FromUserId")&&n.uint32(10).string(e.FromUserId),e.InternalWebpageEvt!=null&&Object.hasOwnProperty.call(e,"InternalWebpageEvt")&&n.uint32(16).int32(e.InternalWebpageEvt),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.ActionBackendMetadata;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.FromUserId=e.string();break}case 2:{a.InternalWebpageEvt=e.int32();break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.FromUserId!=null&&e.hasOwnProperty("FromUserId")&&!$util.isString(e.FromUserId))return"FromUserId: string expected";if(e.InternalWebpageEvt!=null&&e.hasOwnProperty("InternalWebpageEvt"))switch(e.InternalWebpageEvt){default:return"InternalWebpageEvt: enum value expected";case 0:case 1:case 2:case 3:case 4:break}return null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.ActionBackendMetadata)return e;let n=new $root.rov_actions_proto.ActionBackendMetadata;switch(e.FromUserId!=null&&(n.FromUserId=String(e.FromUserId)),e.InternalWebpageEvt){default:if(typeof e.InternalWebpageEvt=="number"){n.InternalWebpageEvt=e.InternalWebpageEvt;break}break;case"Nothing":case 0:n.InternalWebpageEvt=0;break;case"RovConnected":case 1:n.InternalWebpageEvt=1;break;case"RovDisconnected":case 2:n.InternalWebpageEvt=2;break;case"UserConnected":case 3:n.InternalWebpageEvt=3;break;case"UserDisconnected":case 4:n.InternalWebpageEvt=4;break}return n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.FromUserId="",s.InternalWebpageEvt=n.enums===String?"Nothing":0),e.FromUserId!=null&&e.hasOwnProperty("FromUserId")&&(s.FromUserId=e.FromUserId),e.InternalWebpageEvt!=null&&e.hasOwnProperty("InternalWebpageEvt")&&(s.InternalWebpageEvt=n.enums===String?$root.rov_actions_proto.InternalWebpageEvent[e.InternalWebpageEvt]===void 0?e.InternalWebpageEvt:$root.rov_actions_proto.InternalWebpageEvent[e.InternalWebpageEvt]:e.InternalWebpageEvt),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.ActionBackendMetadata"},t}(),o.RovAction=function(){function t(e){if(e)for(let n=Object.keys(e),s=0;s<n.length;++s)e[n[s]]!=null&&(this[n[s]]=e[n[s]])}t.prototype.BackendMetadata=null,t.prototype.ExchangeId=0,t.prototype.Ping=null,t.prototype.PasswordAttempt=null,t.prototype.AuthTokenAttempt=null,t.prototype.TakeControl=null,t.prototype.Move=null,t.prototype.BeginVideoStream=null,t.prototype.TakePhoto=null,t.prototype.StartVideoRec=null,t.prototype.StopVideoRec=null,t.prototype.ToogleLights=null,t.prototype.ShutdownRov=null,t.prototype.RebootRov=null,t.prototype.EnableWifi=null,t.prototype.DisableWifi=null,t.prototype.RovStatusReport=null,t.prototype.RestartRovServices=null,t.prototype.RovLogs=null,t.prototype.RefreshAllSensors=null,t.prototype.Mavlink=null,t.prototype.SimplepeerSignal=null,t.prototype.Disarm=null,t.prototype.SetAutopilotMode=null;let i;return Object.defineProperty(t.prototype,"Body",{get:$util.oneOfGetter(i=["Ping","PasswordAttempt","AuthTokenAttempt","TakeControl","Move","BeginVideoStream","TakePhoto","StartVideoRec","StopVideoRec","ToogleLights","ShutdownRov","RebootRov","EnableWifi","DisableWifi","RovStatusReport","RestartRovServices","RovLogs","RefreshAllSensors","Mavlink","SimplepeerSignal","Disarm","SetAutopilotMode"]),set:$util.oneOfSetter(i)}),t.create=function(n){return new t(n)},t.encode=function(n,s){return s||(s=$Writer.create()),n.BackendMetadata!=null&&Object.hasOwnProperty.call(n,"BackendMetadata")&&$root.rov_actions_proto.ActionBackendMetadata.encode(n.BackendMetadata,s.uint32(10).fork()).ldelim(),n.ExchangeId!=null&&Object.hasOwnProperty.call(n,"ExchangeId")&&s.uint32(16).int32(n.ExchangeId),n.Ping!=null&&Object.hasOwnProperty.call(n,"Ping")&&$root.rov_actions_proto.PingAction.encode(n.Ping,s.uint32(26).fork()).ldelim(),n.PasswordAttempt!=null&&Object.hasOwnProperty.call(n,"PasswordAttempt")&&$root.rov_actions_proto.PasswordAttemptAction.encode(n.PasswordAttempt,s.uint32(34).fork()).ldelim(),n.AuthTokenAttempt!=null&&Object.hasOwnProperty.call(n,"AuthTokenAttempt")&&$root.rov_actions_proto.AuthTokenAttemptAction.encode(n.AuthTokenAttempt,s.uint32(42).fork()).ldelim(),n.TakeControl!=null&&Object.hasOwnProperty.call(n,"TakeControl")&&$root.rov_actions_proto.TakeControlAction.encode(n.TakeControl,s.uint32(50).fork()).ldelim(),n.Move!=null&&Object.hasOwnProperty.call(n,"Move")&&$root.rov_actions_proto.MoveAction.encode(n.Move,s.uint32(58).fork()).ldelim(),n.BeginVideoStream!=null&&Object.hasOwnProperty.call(n,"BeginVideoStream")&&$root.rov_actions_proto.BeginVideoStreamAction.encode(n.BeginVideoStream,s.uint32(66).fork()).ldelim(),n.TakePhoto!=null&&Object.hasOwnProperty.call(n,"TakePhoto")&&$root.rov_actions_proto.TakePhotoAction.encode(n.TakePhoto,s.uint32(74).fork()).ldelim(),n.StartVideoRec!=null&&Object.hasOwnProperty.call(n,"StartVideoRec")&&$root.rov_actions_proto.StartVideoRecAction.encode(n.StartVideoRec,s.uint32(82).fork()).ldelim(),n.StopVideoRec!=null&&Object.hasOwnProperty.call(n,"StopVideoRec")&&$root.rov_actions_proto.StopVideoRecAction.encode(n.StopVideoRec,s.uint32(90).fork()).ldelim(),n.ToogleLights!=null&&Object.hasOwnProperty.call(n,"ToogleLights")&&$root.rov_actions_proto.ToogleLightsAction.encode(n.ToogleLights,s.uint32(98).fork()).ldelim(),n.ShutdownRov!=null&&Object.hasOwnProperty.call(n,"ShutdownRov")&&$root.rov_actions_proto.ShutdownRovAction.encode(n.ShutdownRov,s.uint32(106).fork()).ldelim(),n.RebootRov!=null&&Object.hasOwnProperty.call(n,"RebootRov")&&$root.rov_actions_proto.RebootRovAction.encode(n.RebootRov,s.uint32(114).fork()).ldelim(),n.EnableWifi!=null&&Object.hasOwnProperty.call(n,"EnableWifi")&&$root.rov_actions_proto.EnableWifiAction.encode(n.EnableWifi,s.uint32(122).fork()).ldelim(),n.DisableWifi!=null&&Object.hasOwnProperty.call(n,"DisableWifi")&&$root.rov_actions_proto.DisableWifiAction.encode(n.DisableWifi,s.uint32(130).fork()).ldelim(),n.RovStatusReport!=null&&Object.hasOwnProperty.call(n,"RovStatusReport")&&$root.rov_actions_proto.RovStatusReportAction.encode(n.RovStatusReport,s.uint32(138).fork()).ldelim(),n.RestartRovServices!=null&&Object.hasOwnProperty.call(n,"RestartRovServices")&&$root.rov_actions_proto.RestartRovServicesAction.encode(n.RestartRovServices,s.uint32(146).fork()).ldelim(),n.RovLogs!=null&&Object.hasOwnProperty.call(n,"RovLogs")&&$root.rov_actions_proto.RovLogsAction.encode(n.RovLogs,s.uint32(154).fork()).ldelim(),n.RefreshAllSensors!=null&&Object.hasOwnProperty.call(n,"RefreshAllSensors")&&$root.rov_actions_proto.RefreshAllSensorsAction.encode(n.RefreshAllSensors,s.uint32(162).fork()).ldelim(),n.Mavlink!=null&&Object.hasOwnProperty.call(n,"Mavlink")&&$root.rov_actions_proto.MavlinkAction.encode(n.Mavlink,s.uint32(170).fork()).ldelim(),n.SimplepeerSignal!=null&&Object.hasOwnProperty.call(n,"SimplepeerSignal")&&$root.rov_actions_proto.SimplepeerSignalAction.encode(n.SimplepeerSignal,s.uint32(178).fork()).ldelim(),n.Disarm!=null&&Object.hasOwnProperty.call(n,"Disarm")&&$root.rov_actions_proto.DisarmAction.encode(n.Disarm,s.uint32(186).fork()).ldelim(),n.SetAutopilotMode!=null&&Object.hasOwnProperty.call(n,"SetAutopilotMode")&&$root.rov_actions_proto.SetAutopilotModeAction.encode(n.SetAutopilotMode,s.uint32(194).fork()).ldelim(),s},t.encodeDelimited=function(n,s){return this.encode(n,s).ldelim()},t.decode=function(n,s){n instanceof $Reader||(n=$Reader.create(n));let a=s===void 0?n.len:n.pos+s,c=new $root.rov_actions_proto.RovAction;for(;n.pos<a;){let l=n.uint32();switch(l>>>3){case 1:{c.BackendMetadata=$root.rov_actions_proto.ActionBackendMetadata.decode(n,n.uint32());break}case 2:{c.ExchangeId=n.int32();break}case 3:{c.Ping=$root.rov_actions_proto.PingAction.decode(n,n.uint32());break}case 4:{c.PasswordAttempt=$root.rov_actions_proto.PasswordAttemptAction.decode(n,n.uint32());break}case 5:{c.AuthTokenAttempt=$root.rov_actions_proto.AuthTokenAttemptAction.decode(n,n.uint32());break}case 6:{c.TakeControl=$root.rov_actions_proto.TakeControlAction.decode(n,n.uint32());break}case 7:{c.Move=$root.rov_actions_proto.MoveAction.decode(n,n.uint32());break}case 8:{c.BeginVideoStream=$root.rov_actions_proto.BeginVideoStreamAction.decode(n,n.uint32());break}case 9:{c.TakePhoto=$root.rov_actions_proto.TakePhotoAction.decode(n,n.uint32());break}case 10:{c.StartVideoRec=$root.rov_actions_proto.StartVideoRecAction.decode(n,n.uint32());break}case 11:{c.StopVideoRec=$root.rov_actions_proto.StopVideoRecAction.decode(n,n.uint32());break}case 12:{c.ToogleLights=$root.rov_actions_proto.ToogleLightsAction.decode(n,n.uint32());break}case 13:{c.ShutdownRov=$root.rov_actions_proto.ShutdownRovAction.decode(n,n.uint32());break}case 14:{c.RebootRov=$root.rov_actions_proto.RebootRovAction.decode(n,n.uint32());break}case 15:{c.EnableWifi=$root.rov_actions_proto.EnableWifiAction.decode(n,n.uint32());break}case 16:{c.DisableWifi=$root.rov_actions_proto.DisableWifiAction.decode(n,n.uint32());break}case 17:{c.RovStatusReport=$root.rov_actions_proto.RovStatusReportAction.decode(n,n.uint32());break}case 18:{c.RestartRovServices=$root.rov_actions_proto.RestartRovServicesAction.decode(n,n.uint32());break}case 19:{c.RovLogs=$root.rov_actions_proto.RovLogsAction.decode(n,n.uint32());break}case 20:{c.RefreshAllSensors=$root.rov_actions_proto.RefreshAllSensorsAction.decode(n,n.uint32());break}case 21:{c.Mavlink=$root.rov_actions_proto.MavlinkAction.decode(n,n.uint32());break}case 22:{c.SimplepeerSignal=$root.rov_actions_proto.SimplepeerSignalAction.decode(n,n.uint32());break}case 23:{c.Disarm=$root.rov_actions_proto.DisarmAction.decode(n,n.uint32());break}case 24:{c.SetAutopilotMode=$root.rov_actions_proto.SetAutopilotModeAction.decode(n,n.uint32());break}default:n.skipType(l&7);break}}return c},t.decodeDelimited=function(n){return n instanceof $Reader||(n=new $Reader(n)),this.decode(n,n.uint32())},t.verify=function(n){if(typeof n!="object"||n===null)return"object expected";let s={};if(n.BackendMetadata!=null&&n.hasOwnProperty("BackendMetadata")){let a=$root.rov_actions_proto.ActionBackendMetadata.verify(n.BackendMetadata);if(a)return"BackendMetadata."+a}if(n.ExchangeId!=null&&n.hasOwnProperty("ExchangeId")&&!$util.isInteger(n.ExchangeId))return"ExchangeId: integer expected";if(n.Ping!=null&&n.hasOwnProperty("Ping")){s.Body=1;{let a=$root.rov_actions_proto.PingAction.verify(n.Ping);if(a)return"Ping."+a}}if(n.PasswordAttempt!=null&&n.hasOwnProperty("PasswordAttempt")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.PasswordAttemptAction.verify(n.PasswordAttempt);if(a)return"PasswordAttempt."+a}}if(n.AuthTokenAttempt!=null&&n.hasOwnProperty("AuthTokenAttempt")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.AuthTokenAttemptAction.verify(n.AuthTokenAttempt);if(a)return"AuthTokenAttempt."+a}}if(n.TakeControl!=null&&n.hasOwnProperty("TakeControl")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.TakeControlAction.verify(n.TakeControl);if(a)return"TakeControl."+a}}if(n.Move!=null&&n.hasOwnProperty("Move")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.MoveAction.verify(n.Move);if(a)return"Move."+a}}if(n.BeginVideoStream!=null&&n.hasOwnProperty("BeginVideoStream")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.BeginVideoStreamAction.verify(n.BeginVideoStream);if(a)return"BeginVideoStream."+a}}if(n.TakePhoto!=null&&n.hasOwnProperty("TakePhoto")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.TakePhotoAction.verify(n.TakePhoto);if(a)return"TakePhoto."+a}}if(n.StartVideoRec!=null&&n.hasOwnProperty("StartVideoRec")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.StartVideoRecAction.verify(n.StartVideoRec);if(a)return"StartVideoRec."+a}}if(n.StopVideoRec!=null&&n.hasOwnProperty("StopVideoRec")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.StopVideoRecAction.verify(n.StopVideoRec);if(a)return"StopVideoRec."+a}}if(n.ToogleLights!=null&&n.hasOwnProperty("ToogleLights")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.ToogleLightsAction.verify(n.ToogleLights);if(a)return"ToogleLights."+a}}if(n.ShutdownRov!=null&&n.hasOwnProperty("ShutdownRov")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.ShutdownRovAction.verify(n.ShutdownRov);if(a)return"ShutdownRov."+a}}if(n.RebootRov!=null&&n.hasOwnProperty("RebootRov")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.RebootRovAction.verify(n.RebootRov);if(a)return"RebootRov."+a}}if(n.EnableWifi!=null&&n.hasOwnProperty("EnableWifi")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.EnableWifiAction.verify(n.EnableWifi);if(a)return"EnableWifi."+a}}if(n.DisableWifi!=null&&n.hasOwnProperty("DisableWifi")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.DisableWifiAction.verify(n.DisableWifi);if(a)return"DisableWifi."+a}}if(n.RovStatusReport!=null&&n.hasOwnProperty("RovStatusReport")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.RovStatusReportAction.verify(n.RovStatusReport);if(a)return"RovStatusReport."+a}}if(n.RestartRovServices!=null&&n.hasOwnProperty("RestartRovServices")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.RestartRovServicesAction.verify(n.RestartRovServices);if(a)return"RestartRovServices."+a}}if(n.RovLogs!=null&&n.hasOwnProperty("RovLogs")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.RovLogsAction.verify(n.RovLogs);if(a)return"RovLogs."+a}}if(n.RefreshAllSensors!=null&&n.hasOwnProperty("RefreshAllSensors")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.RefreshAllSensorsAction.verify(n.RefreshAllSensors);if(a)return"RefreshAllSensors."+a}}if(n.Mavlink!=null&&n.hasOwnProperty("Mavlink")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.MavlinkAction.verify(n.Mavlink);if(a)return"Mavlink."+a}}if(n.SimplepeerSignal!=null&&n.hasOwnProperty("SimplepeerSignal")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.SimplepeerSignalAction.verify(n.SimplepeerSignal);if(a)return"SimplepeerSignal."+a}}if(n.Disarm!=null&&n.hasOwnProperty("Disarm")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.DisarmAction.verify(n.Disarm);if(a)return"Disarm."+a}}if(n.SetAutopilotMode!=null&&n.hasOwnProperty("SetAutopilotMode")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.SetAutopilotModeAction.verify(n.SetAutopilotMode);if(a)return"SetAutopilotMode."+a}}return null},t.fromObject=function(n){if(n instanceof $root.rov_actions_proto.RovAction)return n;let s=new $root.rov_actions_proto.RovAction;if(n.BackendMetadata!=null){if(typeof n.BackendMetadata!="object")throw TypeError(".rov_actions_proto.RovAction.BackendMetadata: object expected");s.BackendMetadata=$root.rov_actions_proto.ActionBackendMetadata.fromObject(n.BackendMetadata)}if(n.ExchangeId!=null&&(s.ExchangeId=n.ExchangeId|0),n.Ping!=null){if(typeof n.Ping!="object")throw TypeError(".rov_actions_proto.RovAction.Ping: object expected");s.Ping=$root.rov_actions_proto.PingAction.fromObject(n.Ping)}if(n.PasswordAttempt!=null){if(typeof n.PasswordAttempt!="object")throw TypeError(".rov_actions_proto.RovAction.PasswordAttempt: object expected");s.PasswordAttempt=$root.rov_actions_proto.PasswordAttemptAction.fromObject(n.PasswordAttempt)}if(n.AuthTokenAttempt!=null){if(typeof n.AuthTokenAttempt!="object")throw TypeError(".rov_actions_proto.RovAction.AuthTokenAttempt: object expected");s.AuthTokenAttempt=$root.rov_actions_proto.AuthTokenAttemptAction.fromObject(n.AuthTokenAttempt)}if(n.TakeControl!=null){if(typeof n.TakeControl!="object")throw TypeError(".rov_actions_proto.RovAction.TakeControl: object expected");s.TakeControl=$root.rov_actions_proto.TakeControlAction.fromObject(n.TakeControl)}if(n.Move!=null){if(typeof n.Move!="object")throw TypeError(".rov_actions_proto.RovAction.Move: object expected");s.Move=$root.rov_actions_proto.MoveAction.fromObject(n.Move)}if(n.BeginVideoStream!=null){if(typeof n.BeginVideoStream!="object")throw TypeError(".rov_actions_proto.RovAction.BeginVideoStream: object expected");s.BeginVideoStream=$root.rov_actions_proto.BeginVideoStreamAction.fromObject(n.BeginVideoStream)}if(n.TakePhoto!=null){if(typeof n.TakePhoto!="object")throw TypeError(".rov_actions_proto.RovAction.TakePhoto: object expected");s.TakePhoto=$root.rov_actions_proto.TakePhotoAction.fromObject(n.TakePhoto)}if(n.StartVideoRec!=null){if(typeof n.StartVideoRec!="object")throw TypeError(".rov_actions_proto.RovAction.StartVideoRec: object expected");s.StartVideoRec=$root.rov_actions_proto.StartVideoRecAction.fromObject(n.StartVideoRec)}if(n.StopVideoRec!=null){if(typeof n.StopVideoRec!="object")throw TypeError(".rov_actions_proto.RovAction.StopVideoRec: object expected");s.StopVideoRec=$root.rov_actions_proto.StopVideoRecAction.fromObject(n.StopVideoRec)}if(n.ToogleLights!=null){if(typeof n.ToogleLights!="object")throw TypeError(".rov_actions_proto.RovAction.ToogleLights: object expected");s.ToogleLights=$root.rov_actions_proto.ToogleLightsAction.fromObject(n.ToogleLights)}if(n.ShutdownRov!=null){if(typeof n.ShutdownRov!="object")throw TypeError(".rov_actions_proto.RovAction.ShutdownRov: object expected");s.ShutdownRov=$root.rov_actions_proto.ShutdownRovAction.fromObject(n.ShutdownRov)}if(n.RebootRov!=null){if(typeof n.RebootRov!="object")throw TypeError(".rov_actions_proto.RovAction.RebootRov: object expected");s.RebootRov=$root.rov_actions_proto.RebootRovAction.fromObject(n.RebootRov)}if(n.EnableWifi!=null){if(typeof n.EnableWifi!="object")throw TypeError(".rov_actions_proto.RovAction.EnableWifi: object expected");s.EnableWifi=$root.rov_actions_proto.EnableWifiAction.fromObject(n.EnableWifi)}if(n.DisableWifi!=null){if(typeof n.DisableWifi!="object")throw TypeError(".rov_actions_proto.RovAction.DisableWifi: object expected");s.DisableWifi=$root.rov_actions_proto.DisableWifiAction.fromObject(n.DisableWifi)}if(n.RovStatusReport!=null){if(typeof n.RovStatusReport!="object")throw TypeError(".rov_actions_proto.RovAction.RovStatusReport: object expected");s.RovStatusReport=$root.rov_actions_proto.RovStatusReportAction.fromObject(n.RovStatusReport)}if(n.RestartRovServices!=null){if(typeof n.RestartRovServices!="object")throw TypeError(".rov_actions_proto.RovAction.RestartRovServices: object expected");s.RestartRovServices=$root.rov_actions_proto.RestartRovServicesAction.fromObject(n.RestartRovServices)}if(n.RovLogs!=null){if(typeof n.RovLogs!="object")throw TypeError(".rov_actions_proto.RovAction.RovLogs: object expected");s.RovLogs=$root.rov_actions_proto.RovLogsAction.fromObject(n.RovLogs)}if(n.RefreshAllSensors!=null){if(typeof n.RefreshAllSensors!="object")throw TypeError(".rov_actions_proto.RovAction.RefreshAllSensors: object expected");s.RefreshAllSensors=$root.rov_actions_proto.RefreshAllSensorsAction.fromObject(n.RefreshAllSensors)}if(n.Mavlink!=null){if(typeof n.Mavlink!="object")throw TypeError(".rov_actions_proto.RovAction.Mavlink: object expected");s.Mavlink=$root.rov_actions_proto.MavlinkAction.fromObject(n.Mavlink)}if(n.SimplepeerSignal!=null){if(typeof n.SimplepeerSignal!="object")throw TypeError(".rov_actions_proto.RovAction.SimplepeerSignal: object expected");s.SimplepeerSignal=$root.rov_actions_proto.SimplepeerSignalAction.fromObject(n.SimplepeerSignal)}if(n.Disarm!=null){if(typeof n.Disarm!="object")throw TypeError(".rov_actions_proto.RovAction.Disarm: object expected");s.Disarm=$root.rov_actions_proto.DisarmAction.fromObject(n.Disarm)}if(n.SetAutopilotMode!=null){if(typeof n.SetAutopilotMode!="object")throw TypeError(".rov_actions_proto.RovAction.SetAutopilotMode: object expected");s.SetAutopilotMode=$root.rov_actions_proto.SetAutopilotModeAction.fromObject(n.SetAutopilotMode)}return s},t.toObject=function(n,s){s||(s={});let a={};return s.defaults&&(a.BackendMetadata=null,a.ExchangeId=0),n.BackendMetadata!=null&&n.hasOwnProperty("BackendMetadata")&&(a.BackendMetadata=$root.rov_actions_proto.ActionBackendMetadata.toObject(n.BackendMetadata,s)),n.ExchangeId!=null&&n.hasOwnProperty("ExchangeId")&&(a.ExchangeId=n.ExchangeId),n.Ping!=null&&n.hasOwnProperty("Ping")&&(a.Ping=$root.rov_actions_proto.PingAction.toObject(n.Ping,s),s.oneofs&&(a.Body="Ping")),n.PasswordAttempt!=null&&n.hasOwnProperty("PasswordAttempt")&&(a.PasswordAttempt=$root.rov_actions_proto.PasswordAttemptAction.toObject(n.PasswordAttempt,s),s.oneofs&&(a.Body="PasswordAttempt")),n.AuthTokenAttempt!=null&&n.hasOwnProperty("AuthTokenAttempt")&&(a.AuthTokenAttempt=$root.rov_actions_proto.AuthTokenAttemptAction.toObject(n.AuthTokenAttempt,s),s.oneofs&&(a.Body="AuthTokenAttempt")),n.TakeControl!=null&&n.hasOwnProperty("TakeControl")&&(a.TakeControl=$root.rov_actions_proto.TakeControlAction.toObject(n.TakeControl,s),s.oneofs&&(a.Body="TakeControl")),n.Move!=null&&n.hasOwnProperty("Move")&&(a.Move=$root.rov_actions_proto.MoveAction.toObject(n.Move,s),s.oneofs&&(a.Body="Move")),n.BeginVideoStream!=null&&n.hasOwnProperty("BeginVideoStream")&&(a.BeginVideoStream=$root.rov_actions_proto.BeginVideoStreamAction.toObject(n.BeginVideoStream,s),s.oneofs&&(a.Body="BeginVideoStream")),n.TakePhoto!=null&&n.hasOwnProperty("TakePhoto")&&(a.TakePhoto=$root.rov_actions_proto.TakePhotoAction.toObject(n.TakePhoto,s),s.oneofs&&(a.Body="TakePhoto")),n.StartVideoRec!=null&&n.hasOwnProperty("StartVideoRec")&&(a.StartVideoRec=$root.rov_actions_proto.StartVideoRecAction.toObject(n.StartVideoRec,s),s.oneofs&&(a.Body="StartVideoRec")),n.StopVideoRec!=null&&n.hasOwnProperty("StopVideoRec")&&(a.StopVideoRec=$root.rov_actions_proto.StopVideoRecAction.toObject(n.StopVideoRec,s),s.oneofs&&(a.Body="StopVideoRec")),n.ToogleLights!=null&&n.hasOwnProperty("ToogleLights")&&(a.ToogleLights=$root.rov_actions_proto.ToogleLightsAction.toObject(n.ToogleLights,s),s.oneofs&&(a.Body="ToogleLights")),n.ShutdownRov!=null&&n.hasOwnProperty("ShutdownRov")&&(a.ShutdownRov=$root.rov_actions_proto.ShutdownRovAction.toObject(n.ShutdownRov,s),s.oneofs&&(a.Body="ShutdownRov")),n.RebootRov!=null&&n.hasOwnProperty("RebootRov")&&(a.RebootRov=$root.rov_actions_proto.RebootRovAction.toObject(n.RebootRov,s),s.oneofs&&(a.Body="RebootRov")),n.EnableWifi!=null&&n.hasOwnProperty("EnableWifi")&&(a.EnableWifi=$root.rov_actions_proto.EnableWifiAction.toObject(n.EnableWifi,s),s.oneofs&&(a.Body="EnableWifi")),n.DisableWifi!=null&&n.hasOwnProperty("DisableWifi")&&(a.DisableWifi=$root.rov_actions_proto.DisableWifiAction.toObject(n.DisableWifi,s),s.oneofs&&(a.Body="DisableWifi")),n.RovStatusReport!=null&&n.hasOwnProperty("RovStatusReport")&&(a.RovStatusReport=$root.rov_actions_proto.RovStatusReportAction.toObject(n.RovStatusReport,s),s.oneofs&&(a.Body="RovStatusReport")),n.RestartRovServices!=null&&n.hasOwnProperty("RestartRovServices")&&(a.RestartRovServices=$root.rov_actions_proto.RestartRovServicesAction.toObject(n.RestartRovServices,s),s.oneofs&&(a.Body="RestartRovServices")),n.RovLogs!=null&&n.hasOwnProperty("RovLogs")&&(a.RovLogs=$root.rov_actions_proto.RovLogsAction.toObject(n.RovLogs,s),s.oneofs&&(a.Body="RovLogs")),n.RefreshAllSensors!=null&&n.hasOwnProperty("RefreshAllSensors")&&(a.RefreshAllSensors=$root.rov_actions_proto.RefreshAllSensorsAction.toObject(n.RefreshAllSensors,s),s.oneofs&&(a.Body="RefreshAllSensors")),n.Mavlink!=null&&n.hasOwnProperty("Mavlink")&&(a.Mavlink=$root.rov_actions_proto.MavlinkAction.toObject(n.Mavlink,s),s.oneofs&&(a.Body="Mavlink")),n.SimplepeerSignal!=null&&n.hasOwnProperty("SimplepeerSignal")&&(a.SimplepeerSignal=$root.rov_actions_proto.SimplepeerSignalAction.toObject(n.SimplepeerSignal,s),s.oneofs&&(a.Body="SimplepeerSignal")),n.Disarm!=null&&n.hasOwnProperty("Disarm")&&(a.Disarm=$root.rov_actions_proto.DisarmAction.toObject(n.Disarm,s),s.oneofs&&(a.Body="Disarm")),n.SetAutopilotMode!=null&&n.hasOwnProperty("SetAutopilotMode")&&(a.SetAutopilotMode=$root.rov_actions_proto.SetAutopilotModeAction.toObject(n.SetAutopilotMode,s),s.oneofs&&(a.Body="SetAutopilotMode")),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(n){return n===void 0&&(n="type.googleapis.com"),n+"/rov_actions_proto.RovAction"},t}(),o.DoneResponse=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.Message="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Message!=null&&Object.hasOwnProperty.call(e,"Message")&&n.uint32(10).string(e.Message),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.DoneResponse;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.Message=e.string();break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Message!=null&&e.hasOwnProperty("Message")&&!$util.isString(e.Message)?"Message: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.DoneResponse)return e;let n=new $root.rov_actions_proto.DoneResponse;return e.Message!=null&&(n.Message=String(e.Message)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.Message=""),e.Message!=null&&e.hasOwnProperty("Message")&&(s.Message=e.Message),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.DoneResponse"},t}(),o.ErrorResponse=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.Message="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Message!=null&&Object.hasOwnProperty.call(e,"Message")&&n.uint32(10).string(e.Message),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.ErrorResponse;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.Message=e.string();break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Message!=null&&e.hasOwnProperty("Message")&&!$util.isString(e.Message)?"Message: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.ErrorResponse)return e;let n=new $root.rov_actions_proto.ErrorResponse;return e.Message!=null&&(n.Message=String(e.Message)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.Message=""),e.Message!=null&&e.hasOwnProperty("Message")&&(s.Message=e.Message),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.ErrorResponse"},t}(),o.PongResponse=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.Time=$util.Long?$util.Long.fromBits(0,0,!1):0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Time!=null&&Object.hasOwnProperty.call(e,"Time")&&n.uint32(8).int64(e.Time),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.PongResponse;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.Time=e.int64();break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Time!=null&&e.hasOwnProperty("Time")&&!$util.isInteger(e.Time)&&!(e.Time&&$util.isInteger(e.Time.low)&&$util.isInteger(e.Time.high))?"Time: integer|Long expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.PongResponse)return e;let n=new $root.rov_actions_proto.PongResponse;return e.Time!=null&&($util.Long?(n.Time=$util.Long.fromValue(e.Time)).unsigned=!1:typeof e.Time=="string"?n.Time=parseInt(e.Time,10):typeof e.Time=="number"?n.Time=e.Time:typeof e.Time=="object"&&(n.Time=new $util.LongBits(e.Time.low>>>0,e.Time.high>>>0).toNumber())),n},t.toObject=function(e,n){n||(n={});let s={};if(n.defaults)if($util.Long){let a=new $util.Long(0,0,!1);s.Time=n.longs===String?a.toString():n.longs===Number?a.toNumber():a}else s.Time=n.longs===String?"0":0;return e.Time!=null&&e.hasOwnProperty("Time")&&(typeof e.Time=="number"?s.Time=n.longs===String?String(e.Time):e.Time:s.Time=n.longs===String?$util.Long.prototype.toString.call(e.Time):n.longs===Number?new $util.LongBits(e.Time.low>>>0,e.Time.high>>>0).toNumber():e.Time),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.PongResponse"},t}(),o.SensorUpdatesResponse=function(){function t(i){if(this.MeasurementUpdates=[],i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.MeasurementUpdates=$util.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,n){if(n||(n=$Writer.create()),e.MeasurementUpdates!=null&&e.MeasurementUpdates.length)for(let s=0;s<e.MeasurementUpdates.length;++s)$root.rov_actions_proto.Measurement.encode(e.MeasurementUpdates[s],n.uint32(10).fork()).ldelim();return n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.SensorUpdatesResponse;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.MeasurementUpdates&&a.MeasurementUpdates.length||(a.MeasurementUpdates=[]),a.MeasurementUpdates.push($root.rov_actions_proto.Measurement.decode(e,e.uint32()));break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.MeasurementUpdates!=null&&e.hasOwnProperty("MeasurementUpdates")){if(!Array.isArray(e.MeasurementUpdates))return"MeasurementUpdates: array expected";for(let n=0;n<e.MeasurementUpdates.length;++n){let s=$root.rov_actions_proto.Measurement.verify(e.MeasurementUpdates[n]);if(s)return"MeasurementUpdates."+s}}return null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.SensorUpdatesResponse)return e;let n=new $root.rov_actions_proto.SensorUpdatesResponse;if(e.MeasurementUpdates){if(!Array.isArray(e.MeasurementUpdates))throw TypeError(".rov_actions_proto.SensorUpdatesResponse.MeasurementUpdates: array expected");n.MeasurementUpdates=[];for(let s=0;s<e.MeasurementUpdates.length;++s){if(typeof e.MeasurementUpdates[s]!="object")throw TypeError(".rov_actions_proto.SensorUpdatesResponse.MeasurementUpdates: object expected");n.MeasurementUpdates[s]=$root.rov_actions_proto.Measurement.fromObject(e.MeasurementUpdates[s])}}return n},t.toObject=function(e,n){n||(n={});let s={};if((n.arrays||n.defaults)&&(s.MeasurementUpdates=[]),e.MeasurementUpdates&&e.MeasurementUpdates.length){s.MeasurementUpdates=[];for(let a=0;a<e.MeasurementUpdates.length;++a)s.MeasurementUpdates[a]=$root.rov_actions_proto.Measurement.toObject(e.MeasurementUpdates[a],n)}return s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SensorUpdatesResponse"},t}(),o.PasswordRequiredResponse=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.RovId="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.RovId!=null&&Object.hasOwnProperty.call(e,"RovId")&&n.uint32(10).string(e.RovId),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.PasswordRequiredResponse;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.RovId=e.string();break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.RovId!=null&&e.hasOwnProperty("RovId")&&!$util.isString(e.RovId)?"RovId: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.PasswordRequiredResponse)return e;let n=new $root.rov_actions_proto.PasswordRequiredResponse;return e.RovId!=null&&(n.RovId=String(e.RovId)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.RovId=""),e.RovId!=null&&e.hasOwnProperty("RovId")&&(s.RovId=e.RovId),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.PasswordRequiredResponse"},t}(),o.PasswordAcceptedResponse=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.AuthToken="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.AuthToken!=null&&Object.hasOwnProperty.call(e,"AuthToken")&&n.uint32(10).string(e.AuthToken),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.PasswordAcceptedResponse;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.AuthToken=e.string();break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.AuthToken!=null&&e.hasOwnProperty("AuthToken")&&!$util.isString(e.AuthToken)?"AuthToken: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.PasswordAcceptedResponse)return e;let n=new $root.rov_actions_proto.PasswordAcceptedResponse;return e.AuthToken!=null&&(n.AuthToken=String(e.AuthToken)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.AuthToken=""),e.AuthToken!=null&&e.hasOwnProperty("AuthToken")&&(s.AuthToken=e.AuthToken),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.PasswordAcceptedResponse"},t}(),o.PasswordInvalidResponse=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.PasswordInvalidResponse;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":null},t.fromObject=function(e){return e instanceof $root.rov_actions_proto.PasswordInvalidResponse?e:new $root.rov_actions_proto.PasswordInvalidResponse},t.toObject=function(){return{}},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.PasswordInvalidResponse"},t}(),o.DriverChangedResponse=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.DriverPeerId="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.DriverPeerId!=null&&Object.hasOwnProperty.call(e,"DriverPeerId")&&n.uint32(10).string(e.DriverPeerId),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.DriverChangedResponse;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.DriverPeerId=e.string();break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.DriverPeerId!=null&&e.hasOwnProperty("DriverPeerId")&&!$util.isString(e.DriverPeerId)?"DriverPeerId: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.DriverChangedResponse)return e;let n=new $root.rov_actions_proto.DriverChangedResponse;return e.DriverPeerId!=null&&(n.DriverPeerId=String(e.DriverPeerId)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.DriverPeerId=""),e.DriverPeerId!=null&&e.hasOwnProperty("DriverPeerId")&&(s.DriverPeerId=e.DriverPeerId),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.DriverChangedResponse"},t}(),o.ClientConnectedResponse=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.ClientPeerId="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.ClientPeerId!=null&&Object.hasOwnProperty.call(e,"ClientPeerId")&&n.uint32(10).string(e.ClientPeerId),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.ClientConnectedResponse;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.ClientPeerId=e.string();break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.ClientPeerId!=null&&e.hasOwnProperty("ClientPeerId")&&!$util.isString(e.ClientPeerId)?"ClientPeerId: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.ClientConnectedResponse)return e;let n=new $root.rov_actions_proto.ClientConnectedResponse;return e.ClientPeerId!=null&&(n.ClientPeerId=String(e.ClientPeerId)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.ClientPeerId=""),e.ClientPeerId!=null&&e.hasOwnProperty("ClientPeerId")&&(s.ClientPeerId=e.ClientPeerId),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.ClientConnectedResponse"},t}(),o.ClientDisconnectedResponse=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.ClientPeerId="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.ClientPeerId!=null&&Object.hasOwnProperty.call(e,"ClientPeerId")&&n.uint32(10).string(e.ClientPeerId),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.ClientDisconnectedResponse;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.ClientPeerId=e.string();break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.ClientPeerId!=null&&e.hasOwnProperty("ClientPeerId")&&!$util.isString(e.ClientPeerId)?"ClientPeerId: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.ClientDisconnectedResponse)return e;let n=new $root.rov_actions_proto.ClientDisconnectedResponse;return e.ClientPeerId!=null&&(n.ClientPeerId=String(e.ClientPeerId)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.ClientPeerId=""),e.ClientPeerId!=null&&e.hasOwnProperty("ClientPeerId")&&(s.ClientPeerId=e.ClientPeerId),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.ClientDisconnectedResponse"},t}(),o.HeartbeatResponse=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.Time=$util.Long?$util.Long.fromBits(0,0,!1):0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Time!=null&&Object.hasOwnProperty.call(e,"Time")&&n.uint32(8).int64(e.Time),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.HeartbeatResponse;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.Time=e.int64();break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Time!=null&&e.hasOwnProperty("Time")&&!$util.isInteger(e.Time)&&!(e.Time&&$util.isInteger(e.Time.low)&&$util.isInteger(e.Time.high))?"Time: integer|Long expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.HeartbeatResponse)return e;let n=new $root.rov_actions_proto.HeartbeatResponse;return e.Time!=null&&($util.Long?(n.Time=$util.Long.fromValue(e.Time)).unsigned=!1:typeof e.Time=="string"?n.Time=parseInt(e.Time,10):typeof e.Time=="number"?n.Time=e.Time:typeof e.Time=="object"&&(n.Time=new $util.LongBits(e.Time.low>>>0,e.Time.high>>>0).toNumber())),n},t.toObject=function(e,n){n||(n={});let s={};if(n.defaults)if($util.Long){let a=new $util.Long(0,0,!1);s.Time=n.longs===String?a.toString():n.longs===Number?a.toNumber():a}else s.Time=n.longs===String?"0":0;return e.Time!=null&&e.hasOwnProperty("Time")&&(typeof e.Time=="number"?s.Time=n.longs===String?String(e.Time):e.Time:s.Time=n.longs===String?$util.Long.prototype.toString.call(e.Time):n.longs===Number?new $util.LongBits(e.Time.low>>>0,e.Time.high>>>0).toNumber():e.Time),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.HeartbeatResponse"},t}(),o.ContinuedOutputResponse=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.Message="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Message!=null&&Object.hasOwnProperty.call(e,"Message")&&n.uint32(10).string(e.Message),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.ContinuedOutputResponse;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.Message=e.string();break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Message!=null&&e.hasOwnProperty("Message")&&!$util.isString(e.Message)?"Message: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.ContinuedOutputResponse)return e;let n=new $root.rov_actions_proto.ContinuedOutputResponse;return e.Message!=null&&(n.Message=String(e.Message)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.Message=""),e.Message!=null&&e.hasOwnProperty("Message")&&(s.Message=e.Message),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.ContinuedOutputResponse"},t}(),o.MavlinkResponse=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.Message=$util.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Message!=null&&Object.hasOwnProperty.call(e,"Message")&&n.uint32(10).bytes(e.Message),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.MavlinkResponse;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.Message=e.bytes();break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Message!=null&&e.hasOwnProperty("Message")&&!(e.Message&&typeof e.Message.length=="number"||$util.isString(e.Message))?"Message: buffer expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.MavlinkResponse)return e;let n=new $root.rov_actions_proto.MavlinkResponse;return e.Message!=null&&(typeof e.Message=="string"?$util.base64.decode(e.Message,n.Message=$util.newBuffer($util.base64.length(e.Message)),0):e.Message.length>=0&&(n.Message=e.Message)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(n.bytes===String?s.Message="":(s.Message=[],n.bytes!==Array&&(s.Message=$util.newBuffer(s.Message)))),e.Message!=null&&e.hasOwnProperty("Message")&&(s.Message=n.bytes===String?$util.base64.encode(e.Message,0,e.Message.length):n.bytes===Array?Array.prototype.slice.call(e.Message):e.Message),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.MavlinkResponse"},t}(),o.SimplepeerSignalResponse=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.Message="",t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Message!=null&&Object.hasOwnProperty.call(e,"Message")&&n.uint32(10).string(e.Message),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.SimplepeerSignalResponse;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.Message=e.string();break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return typeof e!="object"||e===null?"object expected":e.Message!=null&&e.hasOwnProperty("Message")&&!$util.isString(e.Message)?"Message: string expected":null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.SimplepeerSignalResponse)return e;let n=new $root.rov_actions_proto.SimplepeerSignalResponse;return e.Message!=null&&(n.Message=String(e.Message)),n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.Message=""),e.Message!=null&&e.hasOwnProperty("Message")&&(s.Message=e.Message),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SimplepeerSignalResponse"},t}(),o.SystemMonitorResponse=function(){function t(i){if(this.Warnings=[],i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.CpuTemp=0,t.prototype.CpuUsage=0,t.prototype.MemoryUsage=0,t.prototype.DiskUsage=0,t.prototype.Warnings=$util.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,n){if(n||(n=$Writer.create()),e.CpuTemp!=null&&Object.hasOwnProperty.call(e,"CpuTemp")&&n.uint32(13).float(e.CpuTemp),e.CpuUsage!=null&&Object.hasOwnProperty.call(e,"CpuUsage")&&n.uint32(21).float(e.CpuUsage),e.MemoryUsage!=null&&Object.hasOwnProperty.call(e,"MemoryUsage")&&n.uint32(29).float(e.MemoryUsage),e.DiskUsage!=null&&Object.hasOwnProperty.call(e,"DiskUsage")&&n.uint32(37).float(e.DiskUsage),e.Warnings!=null&&e.Warnings.length)for(let s=0;s<e.Warnings.length;++s)n.uint32(42).string(e.Warnings[s]);return n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.SystemMonitorResponse;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.CpuTemp=e.float();break}case 2:{a.CpuUsage=e.float();break}case 3:{a.MemoryUsage=e.float();break}case 4:{a.DiskUsage=e.float();break}case 5:{a.Warnings&&a.Warnings.length||(a.Warnings=[]),a.Warnings.push(e.string());break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.CpuTemp!=null&&e.hasOwnProperty("CpuTemp")&&typeof e.CpuTemp!="number")return"CpuTemp: number expected";if(e.CpuUsage!=null&&e.hasOwnProperty("CpuUsage")&&typeof e.CpuUsage!="number")return"CpuUsage: number expected";if(e.MemoryUsage!=null&&e.hasOwnProperty("MemoryUsage")&&typeof e.MemoryUsage!="number")return"MemoryUsage: number expected";if(e.DiskUsage!=null&&e.hasOwnProperty("DiskUsage")&&typeof e.DiskUsage!="number")return"DiskUsage: number expected";if(e.Warnings!=null&&e.hasOwnProperty("Warnings")){if(!Array.isArray(e.Warnings))return"Warnings: array expected";for(let n=0;n<e.Warnings.length;++n)if(!$util.isString(e.Warnings[n]))return"Warnings: string[] expected"}return null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.SystemMonitorResponse)return e;let n=new $root.rov_actions_proto.SystemMonitorResponse;if(e.CpuTemp!=null&&(n.CpuTemp=Number(e.CpuTemp)),e.CpuUsage!=null&&(n.CpuUsage=Number(e.CpuUsage)),e.MemoryUsage!=null&&(n.MemoryUsage=Number(e.MemoryUsage)),e.DiskUsage!=null&&(n.DiskUsage=Number(e.DiskUsage)),e.Warnings){if(!Array.isArray(e.Warnings))throw TypeError(".rov_actions_proto.SystemMonitorResponse.Warnings: array expected");n.Warnings=[];for(let s=0;s<e.Warnings.length;++s)n.Warnings[s]=String(e.Warnings[s])}return n},t.toObject=function(e,n){n||(n={});let s={};if((n.arrays||n.defaults)&&(s.Warnings=[]),n.defaults&&(s.CpuTemp=0,s.CpuUsage=0,s.MemoryUsage=0,s.DiskUsage=0),e.CpuTemp!=null&&e.hasOwnProperty("CpuTemp")&&(s.CpuTemp=n.json&&!isFinite(e.CpuTemp)?String(e.CpuTemp):e.CpuTemp),e.CpuUsage!=null&&e.hasOwnProperty("CpuUsage")&&(s.CpuUsage=n.json&&!isFinite(e.CpuUsage)?String(e.CpuUsage):e.CpuUsage),e.MemoryUsage!=null&&e.hasOwnProperty("MemoryUsage")&&(s.MemoryUsage=n.json&&!isFinite(e.MemoryUsage)?String(e.MemoryUsage):e.MemoryUsage),e.DiskUsage!=null&&e.hasOwnProperty("DiskUsage")&&(s.DiskUsage=n.json&&!isFinite(e.DiskUsage)?String(e.DiskUsage):e.DiskUsage),e.Warnings&&e.Warnings.length){s.Warnings=[];for(let a=0;a<e.Warnings.length;++a)s.Warnings[a]=e.Warnings[a]}return s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.SystemMonitorResponse"},t}(),o.LogMessageResponse=function(){function t(i){if(i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.Message="",t.prototype.Level=0,t.create=function(e){return new t(e)},t.encode=function(e,n){return n||(n=$Writer.create()),e.Message!=null&&Object.hasOwnProperty.call(e,"Message")&&n.uint32(10).string(e.Message),e.Level!=null&&Object.hasOwnProperty.call(e,"Level")&&n.uint32(16).int32(e.Level),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.LogMessageResponse;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.Message=e.string();break}case 2:{a.Level=e.int32();break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.Message!=null&&e.hasOwnProperty("Message")&&!$util.isString(e.Message))return"Message: string expected";if(e.Level!=null&&e.hasOwnProperty("Level"))switch(e.Level){default:return"Level: enum value expected";case 0:case 1:case 2:case 3:case 4:break}return null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.LogMessageResponse)return e;let n=new $root.rov_actions_proto.LogMessageResponse;switch(e.Message!=null&&(n.Message=String(e.Message)),e.Level){default:if(typeof e.Level=="number"){n.Level=e.Level;break}break;case"Debug":case 0:n.Level=0;break;case"Info":case 1:n.Level=1;break;case"Warning":case 2:n.Level=2;break;case"Error":case 3:n.Level=3;break;case"Critical":case 4:n.Level=4;break}return n},t.toObject=function(e,n){n||(n={});let s={};return n.defaults&&(s.Message="",s.Level=n.enums===String?"Debug":0),e.Message!=null&&e.hasOwnProperty("Message")&&(s.Message=e.Message),e.Level!=null&&e.hasOwnProperty("Level")&&(s.Level=n.enums===String?$root.rov_actions_proto.LogLevel[e.Level]===void 0?e.Level:$root.rov_actions_proto.LogLevel[e.Level]:e.Level),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.LogMessageResponse"},t}(),o.ResponseBackendMetadata=function(){function t(i){if(this.TargetUserIds=[],i)for(let e=Object.keys(i),n=0;n<e.length;++n)i[e[n]]!=null&&(this[e[n]]=i[e[n]])}return t.prototype.TargetUserIds=$util.emptyArray,t.prototype.TransportMethod=0,t.create=function(e){return new t(e)},t.encode=function(e,n){if(n||(n=$Writer.create()),e.TargetUserIds!=null&&e.TargetUserIds.length)for(let s=0;s<e.TargetUserIds.length;++s)n.uint32(10).string(e.TargetUserIds[s]);return e.TransportMethod!=null&&Object.hasOwnProperty.call(e,"TransportMethod")&&n.uint32(16).int32(e.TransportMethod),n},t.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},t.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));let s=n===void 0?e.len:e.pos+n,a=new $root.rov_actions_proto.ResponseBackendMetadata;for(;e.pos<s;){let c=e.uint32();switch(c>>>3){case 1:{a.TargetUserIds&&a.TargetUserIds.length||(a.TargetUserIds=[]),a.TargetUserIds.push(e.string());break}case 2:{a.TransportMethod=e.int32();break}default:e.skipType(c&7);break}}return a},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.TargetUserIds!=null&&e.hasOwnProperty("TargetUserIds")){if(!Array.isArray(e.TargetUserIds))return"TargetUserIds: array expected";for(let n=0;n<e.TargetUserIds.length;++n)if(!$util.isString(e.TargetUserIds[n]))return"TargetUserIds: string[] expected"}if(e.TransportMethod!=null&&e.hasOwnProperty("TransportMethod"))switch(e.TransportMethod){default:return"TransportMethod: enum value expected";case 0:case 1:case 3:break}return null},t.fromObject=function(e){if(e instanceof $root.rov_actions_proto.ResponseBackendMetadata)return e;let n=new $root.rov_actions_proto.ResponseBackendMetadata;if(e.TargetUserIds){if(!Array.isArray(e.TargetUserIds))throw TypeError(".rov_actions_proto.ResponseBackendMetadata.TargetUserIds: array expected");n.TargetUserIds=[];for(let s=0;s<e.TargetUserIds.length;++s)n.TargetUserIds[s]=String(e.TargetUserIds[s])}switch(e.TransportMethod){default:if(typeof e.TransportMethod=="number"){n.TransportMethod=e.TransportMethod;break}break;case"LivekitReliable":case 0:n.TransportMethod=0;break;case"LivekitUnreliable":case 1:n.TransportMethod=1;break;case"DirectUnreliable":case 3:n.TransportMethod=3;break}return n},t.toObject=function(e,n){n||(n={});let s={};if((n.arrays||n.defaults)&&(s.TargetUserIds=[]),n.defaults&&(s.TransportMethod=n.enums===String?"LivekitReliable":0),e.TargetUserIds&&e.TargetUserIds.length){s.TargetUserIds=[];for(let a=0;a<e.TargetUserIds.length;++a)s.TargetUserIds[a]=e.TargetUserIds[a]}return e.TransportMethod!=null&&e.hasOwnProperty("TransportMethod")&&(s.TransportMethod=n.enums===String?$root.rov_actions_proto.DataTransportMethod[e.TransportMethod]===void 0?e.TransportMethod:$root.rov_actions_proto.DataTransportMethod[e.TransportMethod]:e.TransportMethod),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/rov_actions_proto.ResponseBackendMetadata"},t}(),o.RovResponse=function(){function t(e){if(e)for(let n=Object.keys(e),s=0;s<n.length;++s)e[n[s]]!=null&&(this[n[s]]=e[n[s]])}t.prototype.BackendMetadata=null,t.prototype.ExchangeId=0,t.prototype.Done=null,t.prototype.Error=null,t.prototype.Pong=null,t.prototype.ContinuedOutput=null,t.prototype.SensorUpdates=null,t.prototype.PasswordRequired=null,t.prototype.PasswordAccepted=null,t.prototype.PasswordInvalid=null,t.prototype.DriverChanged=null,t.prototype.ClientConnected=null,t.prototype.ClientDisconnected=null,t.prototype.Heartbeat=null,t.prototype.Mavlink=null,t.prototype.SimplepeerSignal=null,t.prototype.SystemMonitor=null,t.prototype.LogMessage=null;let i;return Object.defineProperty(t.prototype,"Body",{get:$util.oneOfGetter(i=["Done","Error","Pong","ContinuedOutput","SensorUpdates","PasswordRequired","PasswordAccepted","PasswordInvalid","DriverChanged","ClientConnected","ClientDisconnected","Heartbeat","Mavlink","SimplepeerSignal","SystemMonitor","LogMessage"]),set:$util.oneOfSetter(i)}),t.create=function(n){return new t(n)},t.encode=function(n,s){return s||(s=$Writer.create()),n.BackendMetadata!=null&&Object.hasOwnProperty.call(n,"BackendMetadata")&&$root.rov_actions_proto.ResponseBackendMetadata.encode(n.BackendMetadata,s.uint32(10).fork()).ldelim(),n.ExchangeId!=null&&Object.hasOwnProperty.call(n,"ExchangeId")&&s.uint32(16).int32(n.ExchangeId),n.Done!=null&&Object.hasOwnProperty.call(n,"Done")&&$root.rov_actions_proto.DoneResponse.encode(n.Done,s.uint32(26).fork()).ldelim(),n.Error!=null&&Object.hasOwnProperty.call(n,"Error")&&$root.rov_actions_proto.ErrorResponse.encode(n.Error,s.uint32(34).fork()).ldelim(),n.Pong!=null&&Object.hasOwnProperty.call(n,"Pong")&&$root.rov_actions_proto.PongResponse.encode(n.Pong,s.uint32(42).fork()).ldelim(),n.ContinuedOutput!=null&&Object.hasOwnProperty.call(n,"ContinuedOutput")&&$root.rov_actions_proto.ContinuedOutputResponse.encode(n.ContinuedOutput,s.uint32(50).fork()).ldelim(),n.SensorUpdates!=null&&Object.hasOwnProperty.call(n,"SensorUpdates")&&$root.rov_actions_proto.SensorUpdatesResponse.encode(n.SensorUpdates,s.uint32(58).fork()).ldelim(),n.PasswordRequired!=null&&Object.hasOwnProperty.call(n,"PasswordRequired")&&$root.rov_actions_proto.PasswordRequiredResponse.encode(n.PasswordRequired,s.uint32(66).fork()).ldelim(),n.PasswordAccepted!=null&&Object.hasOwnProperty.call(n,"PasswordAccepted")&&$root.rov_actions_proto.PasswordAcceptedResponse.encode(n.PasswordAccepted,s.uint32(74).fork()).ldelim(),n.PasswordInvalid!=null&&Object.hasOwnProperty.call(n,"PasswordInvalid")&&$root.rov_actions_proto.PasswordInvalidResponse.encode(n.PasswordInvalid,s.uint32(82).fork()).ldelim(),n.DriverChanged!=null&&Object.hasOwnProperty.call(n,"DriverChanged")&&$root.rov_actions_proto.DriverChangedResponse.encode(n.DriverChanged,s.uint32(106).fork()).ldelim(),n.ClientConnected!=null&&Object.hasOwnProperty.call(n,"ClientConnected")&&$root.rov_actions_proto.ClientConnectedResponse.encode(n.ClientConnected,s.uint32(114).fork()).ldelim(),n.ClientDisconnected!=null&&Object.hasOwnProperty.call(n,"ClientDisconnected")&&$root.rov_actions_proto.ClientDisconnectedResponse.encode(n.ClientDisconnected,s.uint32(122).fork()).ldelim(),n.Heartbeat!=null&&Object.hasOwnProperty.call(n,"Heartbeat")&&$root.rov_actions_proto.HeartbeatResponse.encode(n.Heartbeat,s.uint32(130).fork()).ldelim(),n.Mavlink!=null&&Object.hasOwnProperty.call(n,"Mavlink")&&$root.rov_actions_proto.MavlinkResponse.encode(n.Mavlink,s.uint32(138).fork()).ldelim(),n.SimplepeerSignal!=null&&Object.hasOwnProperty.call(n,"SimplepeerSignal")&&$root.rov_actions_proto.SimplepeerSignalResponse.encode(n.SimplepeerSignal,s.uint32(146).fork()).ldelim(),n.SystemMonitor!=null&&Object.hasOwnProperty.call(n,"SystemMonitor")&&$root.rov_actions_proto.SystemMonitorResponse.encode(n.SystemMonitor,s.uint32(154).fork()).ldelim(),n.LogMessage!=null&&Object.hasOwnProperty.call(n,"LogMessage")&&$root.rov_actions_proto.LogMessageResponse.encode(n.LogMessage,s.uint32(162).fork()).ldelim(),s},t.encodeDelimited=function(n,s){return this.encode(n,s).ldelim()},t.decode=function(n,s){n instanceof $Reader||(n=$Reader.create(n));let a=s===void 0?n.len:n.pos+s,c=new $root.rov_actions_proto.RovResponse;for(;n.pos<a;){let l=n.uint32();switch(l>>>3){case 1:{c.BackendMetadata=$root.rov_actions_proto.ResponseBackendMetadata.decode(n,n.uint32());break}case 2:{c.ExchangeId=n.int32();break}case 3:{c.Done=$root.rov_actions_proto.DoneResponse.decode(n,n.uint32());break}case 4:{c.Error=$root.rov_actions_proto.ErrorResponse.decode(n,n.uint32());break}case 5:{c.Pong=$root.rov_actions_proto.PongResponse.decode(n,n.uint32());break}case 6:{c.ContinuedOutput=$root.rov_actions_proto.ContinuedOutputResponse.decode(n,n.uint32());break}case 7:{c.SensorUpdates=$root.rov_actions_proto.SensorUpdatesResponse.decode(n,n.uint32());break}case 8:{c.PasswordRequired=$root.rov_actions_proto.PasswordRequiredResponse.decode(n,n.uint32());break}case 9:{c.PasswordAccepted=$root.rov_actions_proto.PasswordAcceptedResponse.decode(n,n.uint32());break}case 10:{c.PasswordInvalid=$root.rov_actions_proto.PasswordInvalidResponse.decode(n,n.uint32());break}case 13:{c.DriverChanged=$root.rov_actions_proto.DriverChangedResponse.decode(n,n.uint32());break}case 14:{c.ClientConnected=$root.rov_actions_proto.ClientConnectedResponse.decode(n,n.uint32());break}case 15:{c.ClientDisconnected=$root.rov_actions_proto.ClientDisconnectedResponse.decode(n,n.uint32());break}case 16:{c.Heartbeat=$root.rov_actions_proto.HeartbeatResponse.decode(n,n.uint32());break}case 17:{c.Mavlink=$root.rov_actions_proto.MavlinkResponse.decode(n,n.uint32());break}case 18:{c.SimplepeerSignal=$root.rov_actions_proto.SimplepeerSignalResponse.decode(n,n.uint32());break}case 19:{c.SystemMonitor=$root.rov_actions_proto.SystemMonitorResponse.decode(n,n.uint32());break}case 20:{c.LogMessage=$root.rov_actions_proto.LogMessageResponse.decode(n,n.uint32());break}default:n.skipType(l&7);break}}return c},t.decodeDelimited=function(n){return n instanceof $Reader||(n=new $Reader(n)),this.decode(n,n.uint32())},t.verify=function(n){if(typeof n!="object"||n===null)return"object expected";let s={};if(n.BackendMetadata!=null&&n.hasOwnProperty("BackendMetadata")){let a=$root.rov_actions_proto.ResponseBackendMetadata.verify(n.BackendMetadata);if(a)return"BackendMetadata."+a}if(n.ExchangeId!=null&&n.hasOwnProperty("ExchangeId")&&!$util.isInteger(n.ExchangeId))return"ExchangeId: integer expected";if(n.Done!=null&&n.hasOwnProperty("Done")){s.Body=1;{let a=$root.rov_actions_proto.DoneResponse.verify(n.Done);if(a)return"Done."+a}}if(n.Error!=null&&n.hasOwnProperty("Error")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.ErrorResponse.verify(n.Error);if(a)return"Error."+a}}if(n.Pong!=null&&n.hasOwnProperty("Pong")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.PongResponse.verify(n.Pong);if(a)return"Pong."+a}}if(n.ContinuedOutput!=null&&n.hasOwnProperty("ContinuedOutput")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.ContinuedOutputResponse.verify(n.ContinuedOutput);if(a)return"ContinuedOutput."+a}}if(n.SensorUpdates!=null&&n.hasOwnProperty("SensorUpdates")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.SensorUpdatesResponse.verify(n.SensorUpdates);if(a)return"SensorUpdates."+a}}if(n.PasswordRequired!=null&&n.hasOwnProperty("PasswordRequired")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.PasswordRequiredResponse.verify(n.PasswordRequired);if(a)return"PasswordRequired."+a}}if(n.PasswordAccepted!=null&&n.hasOwnProperty("PasswordAccepted")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.PasswordAcceptedResponse.verify(n.PasswordAccepted);if(a)return"PasswordAccepted."+a}}if(n.PasswordInvalid!=null&&n.hasOwnProperty("PasswordInvalid")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.PasswordInvalidResponse.verify(n.PasswordInvalid);if(a)return"PasswordInvalid."+a}}if(n.DriverChanged!=null&&n.hasOwnProperty("DriverChanged")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.DriverChangedResponse.verify(n.DriverChanged);if(a)return"DriverChanged."+a}}if(n.ClientConnected!=null&&n.hasOwnProperty("ClientConnected")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.ClientConnectedResponse.verify(n.ClientConnected);if(a)return"ClientConnected."+a}}if(n.ClientDisconnected!=null&&n.hasOwnProperty("ClientDisconnected")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.ClientDisconnectedResponse.verify(n.ClientDisconnected);if(a)return"ClientDisconnected."+a}}if(n.Heartbeat!=null&&n.hasOwnProperty("Heartbeat")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.HeartbeatResponse.verify(n.Heartbeat);if(a)return"Heartbeat."+a}}if(n.Mavlink!=null&&n.hasOwnProperty("Mavlink")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.MavlinkResponse.verify(n.Mavlink);if(a)return"Mavlink."+a}}if(n.SimplepeerSignal!=null&&n.hasOwnProperty("SimplepeerSignal")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.SimplepeerSignalResponse.verify(n.SimplepeerSignal);if(a)return"SimplepeerSignal."+a}}if(n.SystemMonitor!=null&&n.hasOwnProperty("SystemMonitor")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.SystemMonitorResponse.verify(n.SystemMonitor);if(a)return"SystemMonitor."+a}}if(n.LogMessage!=null&&n.hasOwnProperty("LogMessage")){if(s.Body===1)return"Body: multiple values";s.Body=1;{let a=$root.rov_actions_proto.LogMessageResponse.verify(n.LogMessage);if(a)return"LogMessage."+a}}return null},t.fromObject=function(n){if(n instanceof $root.rov_actions_proto.RovResponse)return n;let s=new $root.rov_actions_proto.RovResponse;if(n.BackendMetadata!=null){if(typeof n.BackendMetadata!="object")throw TypeError(".rov_actions_proto.RovResponse.BackendMetadata: object expected");s.BackendMetadata=$root.rov_actions_proto.ResponseBackendMetadata.fromObject(n.BackendMetadata)}if(n.ExchangeId!=null&&(s.ExchangeId=n.ExchangeId|0),n.Done!=null){if(typeof n.Done!="object")throw TypeError(".rov_actions_proto.RovResponse.Done: object expected");s.Done=$root.rov_actions_proto.DoneResponse.fromObject(n.Done)}if(n.Error!=null){if(typeof n.Error!="object")throw TypeError(".rov_actions_proto.RovResponse.Error: object expected");s.Error=$root.rov_actions_proto.ErrorResponse.fromObject(n.Error)}if(n.Pong!=null){if(typeof n.Pong!="object")throw TypeError(".rov_actions_proto.RovResponse.Pong: object expected");s.Pong=$root.rov_actions_proto.PongResponse.fromObject(n.Pong)}if(n.ContinuedOutput!=null){if(typeof n.ContinuedOutput!="object")throw TypeError(".rov_actions_proto.RovResponse.ContinuedOutput: object expected");s.ContinuedOutput=$root.rov_actions_proto.ContinuedOutputResponse.fromObject(n.ContinuedOutput)}if(n.SensorUpdates!=null){if(typeof n.SensorUpdates!="object")throw TypeError(".rov_actions_proto.RovResponse.SensorUpdates: object expected");s.SensorUpdates=$root.rov_actions_proto.SensorUpdatesResponse.fromObject(n.SensorUpdates)}if(n.PasswordRequired!=null){if(typeof n.PasswordRequired!="object")throw TypeError(".rov_actions_proto.RovResponse.PasswordRequired: object expected");s.PasswordRequired=$root.rov_actions_proto.PasswordRequiredResponse.fromObject(n.PasswordRequired)}if(n.PasswordAccepted!=null){if(typeof n.PasswordAccepted!="object")throw TypeError(".rov_actions_proto.RovResponse.PasswordAccepted: object expected");s.PasswordAccepted=$root.rov_actions_proto.PasswordAcceptedResponse.fromObject(n.PasswordAccepted)}if(n.PasswordInvalid!=null){if(typeof n.PasswordInvalid!="object")throw TypeError(".rov_actions_proto.RovResponse.PasswordInvalid: object expected");s.PasswordInvalid=$root.rov_actions_proto.PasswordInvalidResponse.fromObject(n.PasswordInvalid)}if(n.DriverChanged!=null){if(typeof n.DriverChanged!="object")throw TypeError(".rov_actions_proto.RovResponse.DriverChanged: object expected");s.DriverChanged=$root.rov_actions_proto.DriverChangedResponse.fromObject(n.DriverChanged)}if(n.ClientConnected!=null){if(typeof n.ClientConnected!="object")throw TypeError(".rov_actions_proto.RovResponse.ClientConnected: object expected");s.ClientConnected=$root.rov_actions_proto.ClientConnectedResponse.fromObject(n.ClientConnected)}if(n.ClientDisconnected!=null){if(typeof n.ClientDisconnected!="object")throw TypeError(".rov_actions_proto.RovResponse.ClientDisconnected: object expected");s.ClientDisconnected=$root.rov_actions_proto.ClientDisconnectedResponse.fromObject(n.ClientDisconnected)}if(n.Heartbeat!=null){if(typeof n.Heartbeat!="object")throw TypeError(".rov_actions_proto.RovResponse.Heartbeat: object expected");s.Heartbeat=$root.rov_actions_proto.HeartbeatResponse.fromObject(n.Heartbeat)}if(n.Mavlink!=null){if(typeof n.Mavlink!="object")throw TypeError(".rov_actions_proto.RovResponse.Mavlink: object expected");s.Mavlink=$root.rov_actions_proto.MavlinkResponse.fromObject(n.Mavlink)}if(n.SimplepeerSignal!=null){if(typeof n.SimplepeerSignal!="object")throw TypeError(".rov_actions_proto.RovResponse.SimplepeerSignal: object expected");s.SimplepeerSignal=$root.rov_actions_proto.SimplepeerSignalResponse.fromObject(n.SimplepeerSignal)}if(n.SystemMonitor!=null){if(typeof n.SystemMonitor!="object")throw TypeError(".rov_actions_proto.RovResponse.SystemMonitor: object expected");s.SystemMonitor=$root.rov_actions_proto.SystemMonitorResponse.fromObject(n.SystemMonitor)}if(n.LogMessage!=null){if(typeof n.LogMessage!="object")throw TypeError(".rov_actions_proto.RovResponse.LogMessage: object expected");s.LogMessage=$root.rov_actions_proto.LogMessageResponse.fromObject(n.LogMessage)}return s},t.toObject=function(n,s){s||(s={});let a={};return s.defaults&&(a.BackendMetadata=null,a.ExchangeId=0),n.BackendMetadata!=null&&n.hasOwnProperty("BackendMetadata")&&(a.BackendMetadata=$root.rov_actions_proto.ResponseBackendMetadata.toObject(n.BackendMetadata,s)),n.ExchangeId!=null&&n.hasOwnProperty("ExchangeId")&&(a.ExchangeId=n.ExchangeId),n.Done!=null&&n.hasOwnProperty("Done")&&(a.Done=$root.rov_actions_proto.DoneResponse.toObject(n.Done,s),s.oneofs&&(a.Body="Done")),n.Error!=null&&n.hasOwnProperty("Error")&&(a.Error=$root.rov_actions_proto.ErrorResponse.toObject(n.Error,s),s.oneofs&&(a.Body="Error")),n.Pong!=null&&n.hasOwnProperty("Pong")&&(a.Pong=$root.rov_actions_proto.PongResponse.toObject(n.Pong,s),s.oneofs&&(a.Body="Pong")),n.ContinuedOutput!=null&&n.hasOwnProperty("ContinuedOutput")&&(a.ContinuedOutput=$root.rov_actions_proto.ContinuedOutputResponse.toObject(n.ContinuedOutput,s),s.oneofs&&(a.Body="ContinuedOutput")),n.SensorUpdates!=null&&n.hasOwnProperty("SensorUpdates")&&(a.SensorUpdates=$root.rov_actions_proto.SensorUpdatesResponse.toObject(n.SensorUpdates,s),s.oneofs&&(a.Body="SensorUpdates")),n.PasswordRequired!=null&&n.hasOwnProperty("PasswordRequired")&&(a.PasswordRequired=$root.rov_actions_proto.PasswordRequiredResponse.toObject(n.PasswordRequired,s),s.oneofs&&(a.Body="PasswordRequired")),n.PasswordAccepted!=null&&n.hasOwnProperty("PasswordAccepted")&&(a.PasswordAccepted=$root.rov_actions_proto.PasswordAcceptedResponse.toObject(n.PasswordAccepted,s),s.oneofs&&(a.Body="PasswordAccepted")),n.PasswordInvalid!=null&&n.hasOwnProperty("PasswordInvalid")&&(a.PasswordInvalid=$root.rov_actions_proto.PasswordInvalidResponse.toObject(n.PasswordInvalid,s),s.oneofs&&(a.Body="PasswordInvalid")),n.DriverChanged!=null&&n.hasOwnProperty("DriverChanged")&&(a.DriverChanged=$root.rov_actions_proto.DriverChangedResponse.toObject(n.DriverChanged,s),s.oneofs&&(a.Body="DriverChanged")),n.ClientConnected!=null&&n.hasOwnProperty("ClientConnected")&&(a.ClientConnected=$root.rov_actions_proto.ClientConnectedResponse.toObject(n.ClientConnected,s),s.oneofs&&(a.Body="ClientConnected")),n.ClientDisconnected!=null&&n.hasOwnProperty("ClientDisconnected")&&(a.ClientDisconnected=$root.rov_actions_proto.ClientDisconnectedResponse.toObject(n.ClientDisconnected,s),s.oneofs&&(a.Body="ClientDisconnected")),n.Heartbeat!=null&&n.hasOwnProperty("Heartbeat")&&(a.Heartbeat=$root.rov_actions_proto.HeartbeatResponse.toObject(n.Heartbeat,s),s.oneofs&&(a.Body="Heartbeat")),n.Mavlink!=null&&n.hasOwnProperty("Mavlink")&&(a.Mavlink=$root.rov_actions_proto.MavlinkResponse.toObject(n.Mavlink,s),s.oneofs&&(a.Body="Mavlink")),n.SimplepeerSignal!=null&&n.hasOwnProperty("SimplepeerSignal")&&(a.SimplepeerSignal=$root.rov_actions_proto.SimplepeerSignalResponse.toObject(n.SimplepeerSignal,s),s.oneofs&&(a.Body="SimplepeerSignal")),n.SystemMonitor!=null&&n.hasOwnProperty("SystemMonitor")&&(a.SystemMonitor=$root.rov_actions_proto.SystemMonitorResponse.toObject(n.SystemMonitor,s),s.oneofs&&(a.Body="SystemMonitor")),n.LogMessage!=null&&n.hasOwnProperty("LogMessage")&&(a.LogMessage=$root.rov_actions_proto.LogMessageResponse.toObject(n.LogMessage,s),s.oneofs&&(a.Body="LogMessage")),a},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},t.getTypeUrl=function(n){return n===void 0&&(n="type.googleapis.com"),n+"/rov_actions_proto.RovResponse"},t}(),o})(),VITEBUILD_EXTRANIOUS_PATH="/@fs/Users/ky/Documents/Github/rov-web";var LogLevelConsole=(o=>(o[o.Info=rov_actions_proto.LogLevel.Info]="Info",o[o.Warn=rov_actions_proto.LogLevel.Warning]="Warn",o[o.Error=rov_actions_proto.LogLevel.Error]="Error",o[o.Debug=rov_actions_proto.LogLevel.Debug]="Debug",o[o.Console=4]="Console",o))(LogLevelConsole||{});class Logger{constructor(t=1){D(this,"logsStore",[]);D(this,"sendLogsCallback");D(this,"rootURL");D(this,"sendLogsInterval");D(this,"rawConsole");D(this,"defaultLogOrigin");D(this,"svelteSubscribers",[]);const{log:i,debug:e,warn:n,error:s,info:a}=console;this.rawConsole={log:i,debug:e,warn:n,error:s,info:a},this.rootURL=window.location.protocol+"//"+window.location.host,this.defaultLogOrigin=t,console.log("Logger initialized",this.rootURL)}subscribe(t){this.svelteSubscribers.push(t),t()}enableSendLogs(t){this.sendLogsCallback=t,window.addEventListener("error",i=>{const e=[i.error?i.error:"",i.message,i.filename+":"+i.lineno+":"+i.colno];i.error&&t(LogLevelConsole.Error,e).then(n=>{n||this.addLog(LogLevelConsole.Error,e)})}),this.sendLogsInterval=setInterval(()=>{this.sendQueuedLogs(t)},1e3)}sendQueuedLogs(t){const i=this.logsStore.filter(e=>!e.sentToRemote);i.forEach(e=>{e.sentToRemote=!0}),Promise.allSettled(i.map(e=>t(e.level,e.args,e.trace))).then(e=>{for(let n=0;n<e.length;n++){const s=e[n];s&&s.status=="fulfilled"&&s.value==!0?this.logsStore[n].sentToRemote=!0:(this.logsStore[n].sentToRemote=!1,console.log("Failed to send log result",s))}})}addLog(t,i,e=[],n=0,s=this.defaultLogOrigin,a=performance.now(),c=!1){if(!e){const d=new Error().stack;e=d?d.split(`
`).slice(3).map(f=>f.replace(this.rootURL,"").replace(VITEBUILD_EXTRANIOUS_PATH,"").trim().slice(3)):[]}let l=this.logsStore.length;for(;l>0&&this.logsStore[l-1].timestamp>a;)l--;const u={timestamp:a,level:t,args:i,trace:e,sentToRemote:c,kind:n,origin:s};this.logsStore.splice(l,0,u),this.svelteSubscribers.forEach(d=>d())}logAddLevelFlair(t){const i=t.args;return typeof i[0]!="string"?i.unshift("****"):i[0]="**** "+i[0],{...t,args:i}}printLog(t){if(t.trace&&t.trace.length>0){const i=t.args[0],e=t.args.slice(1);e.push(t.trace.join(`
`)),console.groupCollapsed("%c"+i,this._getLevelColor(t.level)),this._consoleLogAtLevel(t.level,e),console.groupEnd()}else typeof t.args[0]!="string"&&t.args.unshift("****"),t.args[0]="%c "+t.args[0],t.args.splice(1,0,this._getLevelColor(t.level)),this._consoleLogAtLevel(t.level,t.args)}printRecentLogs(t=100){console.clear(),console.groupCollapsed("Recent Logs");const i=Math.max(this.logsStore.length-t,0);for(let e=this.logsStore.length-1;e>i;e--){const n=this.logsStore[e];this.printLog(n)}console.groupEnd()}_consoleLogAtLevel(t,i,e=[]){t===LogLevelConsole.Debug?this.rawConsole.debug.apply(console,i):t===LogLevelConsole.Warn?this.rawConsole.warn.apply(console,i):t===LogLevelConsole.Error?this.rawConsole.error.apply(console,i):t===LogLevelConsole.Info&&this.rawConsole.info.apply(console,i)}_getLevelColor(t){if(t===LogLevelConsole.Debug)return"color: #008888";if(t===LogLevelConsole.Warn)return"color: #888800";if(t===LogLevelConsole.Error)return"color: #880000";if(t===LogLevelConsole.Info)return"color: #000088";if(t===4)return"color: #000000"}_getLevelIcon(t){if(t===LogLevelConsole.Debug)return"";if(t===LogLevelConsole.Warn)return"";if(t===LogLevelConsole.Error)return"";if(t===LogLevelConsole.Info)return"";if(t===4)return""}getLogs(){return this.logsStore}log(...t){this.rawConsole.log.apply(console,t),this.addLog(4,t)}logDebug(...t){this.rawConsole.debug.apply(console,t),this.addLog(LogLevelConsole.Debug,t)}logWarn(...t){this.rawConsole.warn.apply(console,t),this.addLog(LogLevelConsole.Warn,t)}logError(...t){this.rawConsole.error.apply(console,t),this.addLog(LogLevelConsole.Error,t)}logInfo(...t){this.rawConsole.info.apply(console,t),this.addLog(LogLevelConsole.Info,t)}}const mainLogr=new Logger,logDebug=mainLogr.logDebug.bind(mainLogr),logWarn=mainLogr.logWarn.bind(mainLogr),logError=mainLogr.logError.bind(mainLogr),logInfo=mainLogr.logInfo.bind(mainLogr),log$1=mainLogr.log.bind(mainLogr);function _mergeNamespaces(o,t){return t.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(e){if(e!=="default"&&!(e in o)){var n=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(o,e,n.get?n:{enumerable:!0,get:function(){return i[e]}})}})}),Object.freeze(o)}function assert(o,t){if(!o)throw new Error(t)}const FLOAT32_MAX=34028234663852886e22,FLOAT32_MIN=-34028234663852886e22,UINT32_MAX=4294967295,INT32_MAX=2147483647,INT32_MIN=-2147483648;function assertInt32(o){if(typeof o!="number")throw new Error("invalid int 32: "+typeof o);if(!Number.isInteger(o)||o>INT32_MAX||o<INT32_MIN)throw new Error("invalid int 32: "+o)}function assertUInt32(o){if(typeof o!="number")throw new Error("invalid uint 32: "+typeof o);if(!Number.isInteger(o)||o>UINT32_MAX||o<0)throw new Error("invalid uint 32: "+o)}function assertFloat32(o){if(typeof o!="number")throw new Error("invalid float 32: "+typeof o);if(Number.isFinite(o)&&(o>FLOAT32_MAX||o<FLOAT32_MIN))throw new Error("invalid float 32: "+o)}const enumTypeSymbol=Symbol("@bufbuild/protobuf/enum-type");function getEnumType(o){const t=o[enumTypeSymbol];return assert(t,"missing enum type on enum object"),t}function setEnumType(o,t,i,e){o[enumTypeSymbol]=makeEnumType(t,i.map(n=>({no:n.no,name:n.name,localName:o[n.no]})))}function makeEnumType(o,t,i){const e=Object.create(null),n=Object.create(null),s=[];for(const a of t){const c=normalizeEnumValue(a);s.push(c),e[a.name]=c,n[a.no]=c}return{typeName:o,values:s,findName(a){return e[a]},findNumber(a){return n[a]}}}function makeEnum(o,t,i){const e={};for(const n of t){const s=normalizeEnumValue(n);e[s.localName]=s.no,e[s.no]=s.localName}return setEnumType(e,o,t),e}function normalizeEnumValue(o){return"localName"in o?o:Object.assign(Object.assign({},o),{localName:o.name})}class Message{equals(t){return this.getType().runtime.util.equals(this.getType(),this,t)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(t,i){const e=this.getType(),n=e.runtime.bin,s=n.makeReadOptions(i);return n.readMessage(this,s.readerFactory(t),t.byteLength,s),this}fromJson(t,i){const e=this.getType(),n=e.runtime.json,s=n.makeReadOptions(i);return n.readMessage(e,t,s,this),this}fromJsonString(t,i){let e;try{e=JSON.parse(t)}catch(n){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(n instanceof Error?n.message:String(n)))}return this.fromJson(e,i)}toBinary(t){const i=this.getType(),e=i.runtime.bin,n=e.makeWriteOptions(t),s=n.writerFactory();return e.writeMessage(this,s,n),s.finish()}toJson(t){const i=this.getType(),e=i.runtime.json,n=e.makeWriteOptions(t);return e.writeMessage(this,n)}toJsonString(t){var i;const e=this.toJson(t);return JSON.stringify(e,null,(i=t==null?void 0:t.prettySpaces)!==null&&i!==void 0?i:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function makeMessageType(o,t,i,e){var n;const s=(n=e==null?void 0:e.localName)!==null&&n!==void 0?n:t.substring(t.lastIndexOf(".")+1),a={[s]:function(c){o.util.initFields(this),o.util.initPartial(c,this)}}[s];return Object.setPrototypeOf(a.prototype,new Message),Object.assign(a,{runtime:o,typeName:t,fields:o.util.newFieldList(i),fromBinary(c,l){return new a().fromBinary(c,l)},fromJson(c,l){return new a().fromJson(c,l)},fromJsonString(c,l){return new a().fromJsonString(c,l)},equals(c,l){return o.util.equals(a,c,l)}}),a}function varint64read(){let o=0,t=0;for(let e=0;e<28;e+=7){let n=this.buf[this.pos++];if(o|=(n&127)<<e,!(n&128))return this.assertBounds(),[o,t]}let i=this.buf[this.pos++];if(o|=(i&15)<<28,t=(i&112)>>4,!(i&128))return this.assertBounds(),[o,t];for(let e=3;e<=31;e+=7){let n=this.buf[this.pos++];if(t|=(n&127)<<e,!(n&128))return this.assertBounds(),[o,t]}throw new Error("invalid varint")}function varint64write(o,t,i){for(let s=0;s<28;s=s+7){const a=o>>>s,c=!(!(a>>>7)&&t==0),l=(c?a|128:a)&255;if(i.push(l),!c)return}const e=o>>>28&15|(t&7)<<4,n=!!(t>>3);if(i.push((n?e|128:e)&255),!!n){for(let s=3;s<31;s=s+7){const a=t>>>s,c=!!(a>>>7),l=(c?a|128:a)&255;if(i.push(l),!c)return}i.push(t>>>31&1)}}const TWO_PWR_32_DBL=4294967296;function int64FromString(o){const t=o[0]==="-";t&&(o=o.slice(1));const i=1e6;let e=0,n=0;function s(a,c){const l=Number(o.slice(a,c));n*=i,e=e*i+l,e>=TWO_PWR_32_DBL&&(n=n+(e/TWO_PWR_32_DBL|0),e=e%TWO_PWR_32_DBL)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),t?negate(e,n):newBits(e,n)}function int64ToString(o,t){let i=newBits(o,t);const e=i.hi&2147483648;e&&(i=negate(i.lo,i.hi));const n=uInt64ToString(i.lo,i.hi);return e?"-"+n:n}function uInt64ToString(o,t){if({lo:o,hi:t}=toUnsigned(o,t),t<=2097151)return String(TWO_PWR_32_DBL*t+o);const i=o&16777215,e=(o>>>24|t<<8)&16777215,n=t>>16&65535;let s=i+e*6777216+n*6710656,a=e+n*8147497,c=n*2;const l=1e7;return s>=l&&(a+=Math.floor(s/l),s%=l),a>=l&&(c+=Math.floor(a/l),a%=l),c.toString()+decimalFrom1e7WithLeadingZeros(a)+decimalFrom1e7WithLeadingZeros(s)}function toUnsigned(o,t){return{lo:o>>>0,hi:t>>>0}}function newBits(o,t){return{lo:o|0,hi:t|0}}function negate(o,t){return t=~t,o?o=~o+1:t+=1,newBits(o,t)}const decimalFrom1e7WithLeadingZeros=o=>{const t=String(o);return"0000000".slice(t.length)+t};function varint32write(o,t){if(o>=0){for(;o>127;)t.push(o&127|128),o=o>>>7;t.push(o)}else{for(let i=0;i<9;i++)t.push(o&127|128),o=o>>7;t.push(1)}}function varint32read(){let o=this.buf[this.pos++],t=o&127;if(!(o&128))return this.assertBounds(),t;if(o=this.buf[this.pos++],t|=(o&127)<<7,!(o&128))return this.assertBounds(),t;if(o=this.buf[this.pos++],t|=(o&127)<<14,!(o&128))return this.assertBounds(),t;if(o=this.buf[this.pos++],t|=(o&127)<<21,!(o&128))return this.assertBounds(),t;o=this.buf[this.pos++],t|=(o&15)<<28;for(let i=5;o&128&&i<10;i++)o=this.buf[this.pos++];if(o&128)throw new Error("invalid varint");return this.assertBounds(),t>>>0}function makeInt64Support(){const o=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof o.getBigInt64=="function"&&typeof o.getBigUint64=="function"&&typeof o.setBigInt64=="function"&&typeof o.setBigUint64=="function"&&(typeof dist.process!="object"||typeof dist.process.env!="object"||{}.BUF_BIGINT_DISABLE!=="1")){const n=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),a=BigInt("0"),c=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(l){const u=typeof l=="bigint"?l:BigInt(l);if(u>s||u<n)throw new Error("int64 invalid: ".concat(l));return u},uParse(l){const u=typeof l=="bigint"?l:BigInt(l);if(u>c||u<a)throw new Error("uint64 invalid: ".concat(l));return u},enc(l){return o.setBigInt64(0,this.parse(l),!0),{lo:o.getInt32(0,!0),hi:o.getInt32(4,!0)}},uEnc(l){return o.setBigInt64(0,this.uParse(l),!0),{lo:o.getInt32(0,!0),hi:o.getInt32(4,!0)}},dec(l,u){return o.setInt32(0,l,!0),o.setInt32(4,u,!0),o.getBigInt64(0,!0)},uDec(l,u){return o.setInt32(0,l,!0),o.setInt32(4,u,!0),o.getBigUint64(0,!0)}}}const i=n=>assert(/^-?[0-9]+$/.test(n),"int64 invalid: ".concat(n)),e=n=>assert(/^[0-9]+$/.test(n),"uint64 invalid: ".concat(n));return{zero:"0",supported:!1,parse(n){return typeof n!="string"&&(n=n.toString()),i(n),n},uParse(n){return typeof n!="string"&&(n=n.toString()),e(n),n},enc(n){return typeof n!="string"&&(n=n.toString()),i(n),int64FromString(n)},uEnc(n){return typeof n!="string"&&(n=n.toString()),e(n),int64FromString(n)},dec(n,s){return int64ToString(n,s)},uDec(n,s){return uInt64ToString(n,s)}}}const protoInt64=makeInt64Support();var ScalarType;(function(o){o[o.DOUBLE=1]="DOUBLE",o[o.FLOAT=2]="FLOAT",o[o.INT64=3]="INT64",o[o.UINT64=4]="UINT64",o[o.INT32=5]="INT32",o[o.FIXED64=6]="FIXED64",o[o.FIXED32=7]="FIXED32",o[o.BOOL=8]="BOOL",o[o.STRING=9]="STRING",o[o.BYTES=12]="BYTES",o[o.UINT32=13]="UINT32",o[o.SFIXED32=15]="SFIXED32",o[o.SFIXED64=16]="SFIXED64",o[o.SINT32=17]="SINT32",o[o.SINT64=18]="SINT64"})(ScalarType||(ScalarType={}));var LongType;(function(o){o[o.BIGINT=0]="BIGINT",o[o.STRING=1]="STRING"})(LongType||(LongType={}));function scalarEquals(o,t,i){if(t===i)return!0;if(o==ScalarType.BYTES){if(!(t instanceof Uint8Array)||!(i instanceof Uint8Array)||t.length!==i.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==i[e])return!1;return!0}switch(o){case ScalarType.UINT64:case ScalarType.FIXED64:case ScalarType.INT64:case ScalarType.SFIXED64:case ScalarType.SINT64:return t==i}return!1}function scalarZeroValue(o,t){switch(o){case ScalarType.BOOL:return!1;case ScalarType.UINT64:case ScalarType.FIXED64:case ScalarType.INT64:case ScalarType.SFIXED64:case ScalarType.SINT64:return t==0?protoInt64.zero:"0";case ScalarType.DOUBLE:case ScalarType.FLOAT:return 0;case ScalarType.BYTES:return new Uint8Array(0);case ScalarType.STRING:return"";default:return 0}}function isScalarZeroValue(o,t){switch(o){case ScalarType.BOOL:return t===!1;case ScalarType.STRING:return t==="";case ScalarType.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return t==0}}var WireType;(function(o){o[o.Varint=0]="Varint",o[o.Bit64=1]="Bit64",o[o.LengthDelimited=2]="LengthDelimited",o[o.StartGroup=3]="StartGroup",o[o.EndGroup=4]="EndGroup",o[o.Bit32=5]="Bit32"})(WireType||(WireType={}));class BinaryWriter{constructor(t){this.stack=[],this.textEncoder=t??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let t=0;for(let n=0;n<this.chunks.length;n++)t+=this.chunks[n].length;let i=new Uint8Array(t),e=0;for(let n=0;n<this.chunks.length;n++)i.set(this.chunks[n],e),e+=this.chunks[n].length;return this.chunks=[],i}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let t=this.finish(),i=this.stack.pop();if(!i)throw new Error("invalid state, fork stack empty");return this.chunks=i.chunks,this.buf=i.buf,this.uint32(t.byteLength),this.raw(t)}tag(t,i){return this.uint32((t<<3|i)>>>0)}raw(t){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(t),this}uint32(t){for(assertUInt32(t);t>127;)this.buf.push(t&127|128),t=t>>>7;return this.buf.push(t),this}int32(t){return assertInt32(t),varint32write(t,this.buf),this}bool(t){return this.buf.push(t?1:0),this}bytes(t){return this.uint32(t.byteLength),this.raw(t)}string(t){let i=this.textEncoder.encode(t);return this.uint32(i.byteLength),this.raw(i)}float(t){assertFloat32(t);let i=new Uint8Array(4);return new DataView(i.buffer).setFloat32(0,t,!0),this.raw(i)}double(t){let i=new Uint8Array(8);return new DataView(i.buffer).setFloat64(0,t,!0),this.raw(i)}fixed32(t){assertUInt32(t);let i=new Uint8Array(4);return new DataView(i.buffer).setUint32(0,t,!0),this.raw(i)}sfixed32(t){assertInt32(t);let i=new Uint8Array(4);return new DataView(i.buffer).setInt32(0,t,!0),this.raw(i)}sint32(t){return assertInt32(t),t=(t<<1^t>>31)>>>0,varint32write(t,this.buf),this}sfixed64(t){let i=new Uint8Array(8),e=new DataView(i.buffer),n=protoInt64.enc(t);return e.setInt32(0,n.lo,!0),e.setInt32(4,n.hi,!0),this.raw(i)}fixed64(t){let i=new Uint8Array(8),e=new DataView(i.buffer),n=protoInt64.uEnc(t);return e.setInt32(0,n.lo,!0),e.setInt32(4,n.hi,!0),this.raw(i)}int64(t){let i=protoInt64.enc(t);return varint64write(i.lo,i.hi,this.buf),this}sint64(t){let i=protoInt64.enc(t),e=i.hi>>31,n=i.lo<<1^e,s=(i.hi<<1|i.lo>>>31)^e;return varint64write(n,s,this.buf),this}uint64(t){let i=protoInt64.uEnc(t);return varint64write(i.lo,i.hi,this.buf),this}}class BinaryReader{constructor(t,i){this.varint64=varint64read,this.uint32=varint32read,this.buf=t,this.len=t.length,this.pos=0,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.textDecoder=i??new TextDecoder}tag(){let t=this.uint32(),i=t>>>3,e=t&7;if(i<=0||e<0||e>5)throw new Error("illegal tag: field no "+i+" wire type "+e);return[i,e]}skip(t,i){let e=this.pos;switch(t){case WireType.Varint:for(;this.buf[this.pos++]&128;);break;case WireType.Bit64:this.pos+=4;case WireType.Bit32:this.pos+=4;break;case WireType.LengthDelimited:let n=this.uint32();this.pos+=n;break;case WireType.StartGroup:for(;;){const[s,a]=this.tag();if(a===WireType.EndGroup){if(i!==void 0&&s!==i)throw new Error("invalid end group tag");break}this.skip(a,s)}break;default:throw new Error("cant skip wire type "+t)}return this.assertBounds(),this.buf.subarray(e,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)}int64(){return protoInt64.dec(...this.varint64())}uint64(){return protoInt64.uDec(...this.varint64())}sint64(){let[t,i]=this.varint64(),e=-(t&1);return t=(t>>>1|(i&1)<<31)^e,i=i>>>1^e,protoInt64.dec(t,i)}bool(){let[t,i]=this.varint64();return t!==0||i!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return protoInt64.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return protoInt64.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let t=this.uint32(),i=this.pos;return this.pos+=t,this.assertBounds(),this.buf.subarray(i,i+t)}string(){return this.textDecoder.decode(this.bytes())}}function makeExtension(o,t,i,e){let n;return{typeName:t,extendee:i,get field(){if(!n){const s=typeof e=="function"?e():e;s.name=t.split(".").pop(),s.jsonName="[".concat(t,"]"),n=o.util.newFieldList([s]).list()[0]}return n},runtime:o}}function createExtensionContainer(o){const t=o.field.localName,i=Object.create(null);return i[t]=initExtensionField(o),[i,()=>i[t]]}function initExtensionField(o){const t=o.field;if(t.repeated)return[];if(t.default!==void 0)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return scalarZeroValue(t.T,t.L);case"message":const i=t.T,e=new i;return i.fieldWrapper?i.fieldWrapper.unwrapField(e):e;case"map":throw"map fields are not allowed to be extensions"}}function filterUnknownFields(o,t){if(!t.repeated&&(t.kind=="enum"||t.kind=="scalar")){for(let i=o.length-1;i>=0;--i)if(o[i].no==t.no)return[o[i]];return[]}return o.filter(i=>i.no===t.no)}let encTable="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),decTable=[];for(let o=0;o<encTable.length;o++)decTable[encTable[o].charCodeAt(0)]=o;decTable["-".charCodeAt(0)]=encTable.indexOf("+");decTable["_".charCodeAt(0)]=encTable.indexOf("/");const protoBase64={dec(o){let t=o.length*3/4;o[o.length-2]=="="?t-=2:o[o.length-1]=="="&&(t-=1);let i=new Uint8Array(t),e=0,n=0,s,a=0;for(let c=0;c<o.length;c++){if(s=decTable[o.charCodeAt(c)],s===void 0)switch(o[c]){case"=":n=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(n){case 0:a=s,n=1;break;case 1:i[e++]=a<<2|(s&48)>>4,a=s,n=2;break;case 2:i[e++]=(a&15)<<4|(s&60)>>2,a=s,n=3;break;case 3:i[e++]=(a&3)<<6|s,n=0;break}}if(n==1)throw Error("invalid base64 string.");return i.subarray(0,e)},enc(o){let t="",i=0,e,n=0;for(let s=0;s<o.length;s++)switch(e=o[s],i){case 0:t+=encTable[e>>2],n=(e&3)<<4,i=1;break;case 1:t+=encTable[n|e>>4],n=(e&15)<<2,i=2;break;case 2:t+=encTable[n|e>>6],t+=encTable[e&63],i=0;break}return i&&(t+=encTable[n],t+="=",i==1&&(t+="=")),t}};function getExtension(o,t,i){assertExtendee(t,o);const e=t.runtime.bin.makeReadOptions(i),n=filterUnknownFields(o.getType().runtime.bin.listUnknownFields(o),t.field),[s,a]=createExtensionContainer(t);for(const c of n)t.runtime.bin.readField(s,e.readerFactory(c.data),t.field,c.wireType,e);return a()}function setExtension(o,t,i,e){assertExtendee(t,o);const n=t.runtime.bin.makeReadOptions(e),s=t.runtime.bin.makeWriteOptions(e);if(hasExtension(o,t)){const u=o.getType().runtime.bin.listUnknownFields(o).filter(d=>d.no!=t.field.no);o.getType().runtime.bin.discardUnknownFields(o);for(const d of u)o.getType().runtime.bin.onUnknownField(o,d.no,d.wireType,d.data)}const a=s.writerFactory();let c=t.field;!c.opt&&!c.repeated&&(c.kind=="enum"||c.kind=="scalar")&&(c=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(c,i,a,s);const l=n.readerFactory(a.finish());for(;l.pos<l.len;){const[u,d]=l.tag(),f=l.skip(d,u);o.getType().runtime.bin.onUnknownField(o,u,d,f)}}function hasExtension(o,t){const i=o.getType();return t.extendee.typeName===i.typeName&&!!i.runtime.bin.listUnknownFields(o).find(e=>e.no==t.field.no)}function assertExtendee(o,t){assert(o.extendee.typeName==t.getType().typeName,"extension ".concat(o.typeName," can only be applied to message ").concat(o.extendee.typeName))}function isFieldSet(o,t){const i=o.localName;if(o.repeated)return t[i].length>0;if(o.oneof)return t[o.oneof.localName].case===i;switch(o.kind){case"enum":case"scalar":return o.opt||o.req?t[i]!==void 0:o.kind=="enum"?t[i]!==o.T.values[0].no:!isScalarZeroValue(o.T,t[i]);case"message":return t[i]!==void 0;case"map":return Object.keys(t[i]).length>0}}function clearField(o,t){const i=o.localName,e=!o.opt&&!o.req;if(o.repeated)t[i]=[];else if(o.oneof)t[o.oneof.localName]={case:void 0};else switch(o.kind){case"map":t[i]={};break;case"enum":t[i]=e?o.T.values[0].no:void 0;break;case"scalar":t[i]=e?scalarZeroValue(o.T,o.L):void 0;break;case"message":t[i]=void 0;break}}function isMessage(o,t){if(o===null||typeof o!="object"||!Object.getOwnPropertyNames(Message.prototype).every(e=>e in o&&typeof o[e]=="function"))return!1;const i=o.getType();return i===null||typeof i!="function"||!("typeName"in i)||typeof i.typeName!="string"?!1:t===void 0?!0:i.typeName==t.typeName}function wrapField(o,t){return isMessage(t)||!o.fieldWrapper?t:o.fieldWrapper.wrapField(t)}ScalarType.DOUBLE,ScalarType.FLOAT,ScalarType.INT64,ScalarType.UINT64,ScalarType.INT32,ScalarType.UINT32,ScalarType.BOOL,ScalarType.STRING,ScalarType.BYTES;const jsonReadDefaults={ignoreUnknownFields:!1},jsonWriteDefaults={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function makeReadOptions$1(o){return o?Object.assign(Object.assign({},jsonReadDefaults),o):jsonReadDefaults}function makeWriteOptions$1(o){return o?Object.assign(Object.assign({},jsonWriteDefaults),o):jsonWriteDefaults}const tokenNull=Symbol(),tokenIgnoredUnknownEnum=Symbol();function makeJsonFormat(){return{makeReadOptions:makeReadOptions$1,makeWriteOptions:makeWriteOptions$1,readMessage(o,t,i,e){if(t==null||Array.isArray(t)||typeof t!="object")throw new Error("cannot decode message ".concat(o.typeName," from JSON: ").concat(debugJsonValue(t)));e=e??new o;const n=new Map,s=i.typeRegistry;for(const[a,c]of Object.entries(t)){const l=o.fields.findJsonName(a);if(l){if(l.oneof){if(c===null&&l.kind=="scalar")continue;const u=n.get(l.oneof);if(u!==void 0)throw new Error("cannot decode message ".concat(o.typeName,' from JSON: multiple keys for oneof "').concat(l.oneof.name,'" present: "').concat(u,'", "').concat(a,'"'));n.set(l.oneof,a)}readField$1(e,c,l,i,o)}else{let u=!1;if(s!=null&&s.findExtension&&a.startsWith("[")&&a.endsWith("]")){const d=s.findExtension(a.substring(1,a.length-1));if(d&&d.extendee.typeName==o.typeName){u=!0;const[f,h]=createExtensionContainer(d);readField$1(f,c,d.field,i,d),setExtension(e,d,h(),i)}}if(!u&&!i.ignoreUnknownFields)throw new Error("cannot decode message ".concat(o.typeName,' from JSON: key "').concat(a,'" is unknown'))}}return e},writeMessage(o,t){const i=o.getType(),e={};let n;try{for(n of i.fields.byNumber()){if(!isFieldSet(n,o)){if(n.req)throw"required field not set";if(!t.emitDefaultValues||!canEmitFieldDefaultValue(n))continue}const a=n.oneof?o[n.oneof.localName].value:o[n.localName],c=writeField$1(n,a,t);c!==void 0&&(e[t.useProtoFieldName?n.name:n.jsonName]=c)}const s=t.typeRegistry;if(s!=null&&s.findExtensionFor)for(const a of i.runtime.bin.listUnknownFields(o)){const c=s.findExtensionFor(i.typeName,a.no);if(c&&hasExtension(o,c)){const l=getExtension(o,c,t),u=writeField$1(c.field,l,t);u!==void 0&&(e[c.field.jsonName]=u)}}}catch(s){const a=n?"cannot encode field ".concat(i.typeName,".").concat(n.name," to JSON"):"cannot encode message ".concat(i.typeName," to JSON"),c=s instanceof Error?s.message:String(s);throw new Error(a+(c.length>0?": ".concat(c):""))}return e},readScalar(o,t,i){return readScalar$1(o,t,i??LongType.BIGINT,!0)},writeScalar(o,t,i){if(t!==void 0&&(i||isScalarZeroValue(o,t)))return writeScalar$1(o,t)},debug:debugJsonValue}}function debugJsonValue(o){if(o===null)return"null";switch(typeof o){case"object":return Array.isArray(o)?"array":"object";case"string":return o.length>100?"string":'"'.concat(o.split('"').join('\\"'),'"');default:return String(o)}}function readField$1(o,t,i,e,n){let s=i.localName;if(i.repeated){if(assert(i.kind!="map"),t===null)return;if(!Array.isArray(t))throw new Error("cannot decode field ".concat(n.typeName,".").concat(i.name," from JSON: ").concat(debugJsonValue(t)));const a=o[s];for(const c of t){if(c===null)throw new Error("cannot decode field ".concat(n.typeName,".").concat(i.name," from JSON: ").concat(debugJsonValue(c)));switch(i.kind){case"message":a.push(i.T.fromJson(c,e));break;case"enum":const l=readEnum(i.T,c,e.ignoreUnknownFields,!0);l!==tokenIgnoredUnknownEnum&&a.push(l);break;case"scalar":try{a.push(readScalar$1(i.T,c,i.L,!0))}catch(u){let d="cannot decode field ".concat(n.typeName,".").concat(i.name," from JSON: ").concat(debugJsonValue(c));throw u instanceof Error&&u.message.length>0&&(d+=": ".concat(u.message)),new Error(d)}break}}}else if(i.kind=="map"){if(t===null)return;if(typeof t!="object"||Array.isArray(t))throw new Error("cannot decode field ".concat(n.typeName,".").concat(i.name," from JSON: ").concat(debugJsonValue(t)));const a=o[s];for(const[c,l]of Object.entries(t)){if(l===null)throw new Error("cannot decode field ".concat(n.typeName,".").concat(i.name," from JSON: map value null"));let u;try{u=readMapKey(i.K,c)}catch(d){let f="cannot decode map key for field ".concat(n.typeName,".").concat(i.name," from JSON: ").concat(debugJsonValue(t));throw d instanceof Error&&d.message.length>0&&(f+=": ".concat(d.message)),new Error(f)}switch(i.V.kind){case"message":a[u]=i.V.T.fromJson(l,e);break;case"enum":const d=readEnum(i.V.T,l,e.ignoreUnknownFields,!0);d!==tokenIgnoredUnknownEnum&&(a[u]=d);break;case"scalar":try{a[u]=readScalar$1(i.V.T,l,LongType.BIGINT,!0)}catch(f){let h="cannot decode map value for field ".concat(n.typeName,".").concat(i.name," from JSON: ").concat(debugJsonValue(t));throw f instanceof Error&&f.message.length>0&&(h+=": ".concat(f.message)),new Error(h)}break}}}else switch(i.oneof&&(o=o[i.oneof.localName]={case:s},s="value"),i.kind){case"message":const a=i.T;if(t===null&&a.typeName!="google.protobuf.Value")return;let c=o[s];isMessage(c)?c.fromJson(t,e):(o[s]=c=a.fromJson(t,e),a.fieldWrapper&&!i.oneof&&(o[s]=a.fieldWrapper.unwrapField(c)));break;case"enum":const l=readEnum(i.T,t,e.ignoreUnknownFields,!1);switch(l){case tokenNull:clearField(i,o);break;case tokenIgnoredUnknownEnum:break;default:o[s]=l;break}break;case"scalar":try{const u=readScalar$1(i.T,t,i.L,!1);switch(u){case tokenNull:clearField(i,o);break;default:o[s]=u;break}}catch(u){let d="cannot decode field ".concat(n.typeName,".").concat(i.name," from JSON: ").concat(debugJsonValue(t));throw u instanceof Error&&u.message.length>0&&(d+=": ".concat(u.message)),new Error(d)}break}}function readMapKey(o,t){if(o===ScalarType.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1;break}return readScalar$1(o,t,LongType.BIGINT,!0).toString()}function readScalar$1(o,t,i,e){if(t===null)return e?scalarZeroValue(o,i):tokenNull;switch(o){case ScalarType.DOUBLE:case ScalarType.FLOAT:if(t==="NaN")return Number.NaN;if(t==="Infinity")return Number.POSITIVE_INFINITY;if(t==="-Infinity")return Number.NEGATIVE_INFINITY;if(t===""||typeof t=="string"&&t.trim().length!==t.length||typeof t!="string"&&typeof t!="number")break;const n=Number(t);if(Number.isNaN(n)||!Number.isFinite(n))break;return o==ScalarType.FLOAT&&assertFloat32(n),n;case ScalarType.INT32:case ScalarType.FIXED32:case ScalarType.SFIXED32:case ScalarType.SINT32:case ScalarType.UINT32:let s;if(typeof t=="number"?s=t:typeof t=="string"&&t.length>0&&t.trim().length===t.length&&(s=Number(t)),s===void 0)break;return o==ScalarType.UINT32||o==ScalarType.FIXED32?assertUInt32(s):assertInt32(s),s;case ScalarType.INT64:case ScalarType.SFIXED64:case ScalarType.SINT64:if(typeof t!="number"&&typeof t!="string")break;const a=protoInt64.parse(t);return i?a.toString():a;case ScalarType.FIXED64:case ScalarType.UINT64:if(typeof t!="number"&&typeof t!="string")break;const c=protoInt64.uParse(t);return i?c.toString():c;case ScalarType.BOOL:if(typeof t!="boolean")break;return t;case ScalarType.STRING:if(typeof t!="string")break;try{encodeURIComponent(t)}catch{throw new Error("invalid UTF8")}return t;case ScalarType.BYTES:if(t==="")return new Uint8Array(0);if(typeof t!="string")break;return protoBase64.dec(t)}throw new Error}function readEnum(o,t,i,e){if(t===null)return o.typeName=="google.protobuf.NullValue"?0:e?o.values[0].no:tokenNull;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const n=o.findName(t);if(n!==void 0)return n.no;if(i)return tokenIgnoredUnknownEnum;break}throw new Error("cannot decode enum ".concat(o.typeName," from JSON: ").concat(debugJsonValue(t)))}function canEmitFieldDefaultValue(o){return o.repeated||o.kind=="map"?!0:!(o.oneof||o.kind=="message"||o.opt||o.req)}function writeField$1(o,t,i){if(o.kind=="map"){assert(typeof t=="object"&&t!=null);const e={},n=Object.entries(t);switch(o.V.kind){case"scalar":for(const[a,c]of n)e[a.toString()]=writeScalar$1(o.V.T,c);break;case"message":for(const[a,c]of n)e[a.toString()]=c.toJson(i);break;case"enum":const s=o.V.T;for(const[a,c]of n)e[a.toString()]=writeEnum(s,c,i.enumAsInteger);break}return i.emitDefaultValues||n.length>0?e:void 0}if(o.repeated){assert(Array.isArray(t));const e=[];switch(o.kind){case"scalar":for(let n=0;n<t.length;n++)e.push(writeScalar$1(o.T,t[n]));break;case"enum":for(let n=0;n<t.length;n++)e.push(writeEnum(o.T,t[n],i.enumAsInteger));break;case"message":for(let n=0;n<t.length;n++)e.push(t[n].toJson(i));break}return i.emitDefaultValues||e.length>0?e:void 0}switch(o.kind){case"scalar":return writeScalar$1(o.T,t);case"enum":return writeEnum(o.T,t,i.enumAsInteger);case"message":return wrapField(o.T,t).toJson(i)}}function writeEnum(o,t,i){var e;if(assert(typeof t=="number"),o.typeName=="google.protobuf.NullValue")return null;if(i)return t;const n=o.findNumber(t);return(e=n==null?void 0:n.name)!==null&&e!==void 0?e:t}function writeScalar$1(o,t){switch(o){case ScalarType.INT32:case ScalarType.SFIXED32:case ScalarType.SINT32:case ScalarType.FIXED32:case ScalarType.UINT32:return assert(typeof t=="number"),t;case ScalarType.FLOAT:case ScalarType.DOUBLE:return assert(typeof t=="number"),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case ScalarType.STRING:return assert(typeof t=="string"),t;case ScalarType.BOOL:return assert(typeof t=="boolean"),t;case ScalarType.UINT64:case ScalarType.FIXED64:case ScalarType.INT64:case ScalarType.SFIXED64:case ScalarType.SINT64:return assert(typeof t=="bigint"||typeof t=="string"||typeof t=="number"),t.toString();case ScalarType.BYTES:return assert(t instanceof Uint8Array),protoBase64.enc(t)}}const unknownFieldsSymbol=Symbol("@bufbuild/protobuf/unknown-fields"),readDefaults={readUnknownFields:!0,readerFactory:o=>new BinaryReader(o)},writeDefaults={writeUnknownFields:!0,writerFactory:()=>new BinaryWriter};function makeReadOptions(o){return o?Object.assign(Object.assign({},readDefaults),o):readDefaults}function makeWriteOptions(o){return o?Object.assign(Object.assign({},writeDefaults),o):writeDefaults}function makeBinaryFormat(){return{makeReadOptions,makeWriteOptions,listUnknownFields(o){var t;return(t=o[unknownFieldsSymbol])!==null&&t!==void 0?t:[]},discardUnknownFields(o){delete o[unknownFieldsSymbol]},writeUnknownFields(o,t){const e=o[unknownFieldsSymbol];if(e)for(const n of e)t.tag(n.no,n.wireType).raw(n.data)},onUnknownField(o,t,i,e){const n=o;Array.isArray(n[unknownFieldsSymbol])||(n[unknownFieldsSymbol]=[]),n[unknownFieldsSymbol].push({no:t,wireType:i,data:e})},readMessage(o,t,i,e,n){const s=o.getType(),a=n?t.len:t.pos+i;let c,l;for(;t.pos<a&&([c,l]=t.tag(),!(n===!0&&l==WireType.EndGroup));){const u=s.fields.find(c);if(!u){const d=t.skip(l,c);e.readUnknownFields&&this.onUnknownField(o,c,l,d);continue}readField(o,t,u,l,e)}if(n&&(l!=WireType.EndGroup||c!==i))throw new Error("invalid end group tag")},readField,writeMessage(o,t,i){const e=o.getType();for(const n of e.fields.byNumber()){if(!isFieldSet(n,o)){if(n.req)throw new Error("cannot encode field ".concat(e.typeName,".").concat(n.name," to binary: required field not set"));continue}const s=n.oneof?o[n.oneof.localName].value:o[n.localName];writeField(n,s,t,i)}return i.writeUnknownFields&&this.writeUnknownFields(o,t),t},writeField(o,t,i,e){t!==void 0&&writeField(o,t,i,e)}}}function readField(o,t,i,e,n){let{repeated:s,localName:a}=i;switch(i.oneof&&(o=o[i.oneof.localName],o.case!=a&&delete o.value,o.case=a,a="value"),i.kind){case"scalar":case"enum":const c=i.kind=="enum"?ScalarType.INT32:i.T;let l=readScalar;if(i.kind=="scalar"&&i.L>0&&(l=readScalarLTString),s){let h=o[a];if(e==WireType.LengthDelimited&&c!=ScalarType.STRING&&c!=ScalarType.BYTES){let m=t.uint32()+t.pos;for(;t.pos<m;)h.push(l(t,c))}else h.push(l(t,c))}else o[a]=l(t,c);break;case"message":const u=i.T;s?o[a].push(readMessageField(t,new u,n,i)):isMessage(o[a])?readMessageField(t,o[a],n,i):(o[a]=readMessageField(t,new u,n,i),u.fieldWrapper&&!i.oneof&&!i.repeated&&(o[a]=u.fieldWrapper.unwrapField(o[a])));break;case"map":let[d,f]=readMapEntry(i,t,n);o[a][d]=f;break}}function readMessageField(o,t,i,e){const n=t.getType().runtime.bin,s=e==null?void 0:e.delimited;return n.readMessage(t,o,s?e.no:o.uint32(),i,s),t}function readMapEntry(o,t,i){const e=t.uint32(),n=t.pos+e;let s,a;for(;t.pos<n;){const[c]=t.tag();switch(c){case 1:s=readScalar(t,o.K);break;case 2:switch(o.V.kind){case"scalar":a=readScalar(t,o.V.T);break;case"enum":a=t.int32();break;case"message":a=readMessageField(t,new o.V.T,i,void 0);break}break}}if(s===void 0&&(s=scalarZeroValue(o.K,LongType.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),a===void 0)switch(o.V.kind){case"scalar":a=scalarZeroValue(o.V.T,LongType.BIGINT);break;case"enum":a=o.V.T.values[0].no;break;case"message":a=new o.V.T;break}return[s,a]}function readScalarLTString(o,t){const i=readScalar(o,t);return typeof i=="bigint"?i.toString():i}function readScalar(o,t){switch(t){case ScalarType.STRING:return o.string();case ScalarType.BOOL:return o.bool();case ScalarType.DOUBLE:return o.double();case ScalarType.FLOAT:return o.float();case ScalarType.INT32:return o.int32();case ScalarType.INT64:return o.int64();case ScalarType.UINT64:return o.uint64();case ScalarType.FIXED64:return o.fixed64();case ScalarType.BYTES:return o.bytes();case ScalarType.FIXED32:return o.fixed32();case ScalarType.SFIXED32:return o.sfixed32();case ScalarType.SFIXED64:return o.sfixed64();case ScalarType.SINT64:return o.sint64();case ScalarType.UINT32:return o.uint32();case ScalarType.SINT32:return o.sint32()}}function writeField(o,t,i,e){assert(t!==void 0);const n=o.repeated;switch(o.kind){case"scalar":case"enum":let s=o.kind=="enum"?ScalarType.INT32:o.T;if(n)if(assert(Array.isArray(t)),o.packed)writePacked(i,s,o.no,t);else for(const a of t)writeScalar(i,s,o.no,a);else writeScalar(i,s,o.no,t);break;case"message":if(n){assert(Array.isArray(t));for(const a of t)writeMessageField(i,e,o,a)}else writeMessageField(i,e,o,t);break;case"map":assert(typeof t=="object"&&t!=null);for(const[a,c]of Object.entries(t))writeMapEntry(i,e,o,a,c);break}}function writeMapEntry(o,t,i,e,n){o.tag(i.no,WireType.LengthDelimited),o.fork();let s=e;switch(i.K){case ScalarType.INT32:case ScalarType.FIXED32:case ScalarType.UINT32:case ScalarType.SFIXED32:case ScalarType.SINT32:s=Number.parseInt(e);break;case ScalarType.BOOL:assert(e=="true"||e=="false"),s=e=="true";break}switch(writeScalar(o,i.K,1,s),i.V.kind){case"scalar":writeScalar(o,i.V.T,2,n);break;case"enum":writeScalar(o,ScalarType.INT32,2,n);break;case"message":assert(n!==void 0),o.tag(2,WireType.LengthDelimited).bytes(n.toBinary(t));break}o.join()}function writeMessageField(o,t,i,e){const n=wrapField(i.T,e);i.delimited?o.tag(i.no,WireType.StartGroup).raw(n.toBinary(t)).tag(i.no,WireType.EndGroup):o.tag(i.no,WireType.LengthDelimited).bytes(n.toBinary(t))}function writeScalar(o,t,i,e){assert(e!==void 0);let[n,s]=scalarTypeInfo(t);o.tag(i,n)[s](e)}function writePacked(o,t,i,e){if(!e.length)return;o.tag(i,WireType.LengthDelimited).fork();let[,n]=scalarTypeInfo(t);for(let s=0;s<e.length;s++)o[n](e[s]);o.join()}function scalarTypeInfo(o){let t=WireType.Varint;switch(o){case ScalarType.BYTES:case ScalarType.STRING:t=WireType.LengthDelimited;break;case ScalarType.DOUBLE:case ScalarType.FIXED64:case ScalarType.SFIXED64:t=WireType.Bit64;break;case ScalarType.FIXED32:case ScalarType.SFIXED32:case ScalarType.FLOAT:t=WireType.Bit32;break}const i=ScalarType[o].toLowerCase();return[t,i]}function makeUtilCommon(){return{setEnumType,initPartial(o,t){if(o===void 0)return;const i=t.getType();for(const e of i.fields.byMember()){const n=e.localName,s=t,a=o;if(a[n]!=null)switch(e.kind){case"oneof":const c=a[n].case;if(c===void 0)continue;const l=e.findField(c);let u=a[n].value;l&&l.kind=="message"&&!isMessage(u,l.T)?u=new l.T(u):l&&l.kind==="scalar"&&l.T===ScalarType.BYTES&&(u=toU8Arr(u)),s[n]={case:c,value:u};break;case"scalar":case"enum":let d=a[n];e.T===ScalarType.BYTES&&(d=e.repeated?d.map(toU8Arr):toU8Arr(d)),s[n]=d;break;case"map":switch(e.V.kind){case"scalar":case"enum":if(e.V.T===ScalarType.BYTES)for(const[p,m]of Object.entries(a[n]))s[n][p]=toU8Arr(m);else Object.assign(s[n],a[n]);break;case"message":const h=e.V.T;for(const p of Object.keys(a[n])){let m=a[n][p];h.fieldWrapper||(m=new h(m)),s[n][p]=m}break}break;case"message":const f=e.T;if(e.repeated)s[n]=a[n].map(h=>isMessage(h,f)?h:new f(h));else{const h=a[n];f.fieldWrapper?f.typeName==="google.protobuf.BytesValue"?s[n]=toU8Arr(h):s[n]=h:s[n]=isMessage(h,f)?h:new f(h)}break}}},equals(o,t,i){return t===i?!0:!t||!i?!1:o.fields.byMember().every(e=>{const n=t[e.localName],s=i[e.localName];if(e.repeated){if(n.length!==s.length)return!1;switch(e.kind){case"message":return n.every((a,c)=>e.T.equals(a,s[c]));case"scalar":return n.every((a,c)=>scalarEquals(e.T,a,s[c]));case"enum":return n.every((a,c)=>scalarEquals(ScalarType.INT32,a,s[c]))}throw new Error("repeated cannot contain ".concat(e.kind))}switch(e.kind){case"message":return e.T.equals(n,s);case"enum":return scalarEquals(ScalarType.INT32,n,s);case"scalar":return scalarEquals(e.T,n,s);case"oneof":if(n.case!==s.case)return!1;const a=e.findField(n.case);if(a===void 0)return!0;switch(a.kind){case"message":return a.T.equals(n.value,s.value);case"enum":return scalarEquals(ScalarType.INT32,n.value,s.value);case"scalar":return scalarEquals(a.T,n.value,s.value)}throw new Error("oneof cannot contain ".concat(a.kind));case"map":const c=Object.keys(n).concat(Object.keys(s));switch(e.V.kind){case"message":const l=e.V.T;return c.every(d=>l.equals(n[d],s[d]));case"enum":return c.every(d=>scalarEquals(ScalarType.INT32,n[d],s[d]));case"scalar":const u=e.V.T;return c.every(d=>scalarEquals(u,n[d],s[d]))}break}})},clone(o){const t=o.getType(),i=new t,e=i;for(const n of t.fields.byMember()){const s=o[n.localName];let a;if(n.repeated)a=s.map(cloneSingularField);else if(n.kind=="map"){a=e[n.localName];for(const[c,l]of Object.entries(s))a[c]=cloneSingularField(l)}else n.kind=="oneof"?a=n.findField(s.case)?{case:s.case,value:cloneSingularField(s.value)}:{case:void 0}:a=cloneSingularField(s);e[n.localName]=a}for(const n of t.runtime.bin.listUnknownFields(o))t.runtime.bin.onUnknownField(e,n.no,n.wireType,n.data);return i}}}function cloneSingularField(o){if(o===void 0)return o;if(isMessage(o))return o.clone();if(o instanceof Uint8Array){const t=new Uint8Array(o.byteLength);return t.set(o),t}return o}function toU8Arr(o){return o instanceof Uint8Array?o:new Uint8Array(o)}function makeProtoRuntime(o,t,i){return{syntax:o,json:makeJsonFormat(),bin:makeBinaryFormat(),util:Object.assign(Object.assign({},makeUtilCommon()),{newFieldList:t,initFields:i}),makeMessageType(e,n,s){return makeMessageType(this,e,n,s)},makeEnum,makeEnumType,getEnumType,makeExtension(e,n,s){return makeExtension(this,e,n,s)}}}class InternalFieldList{constructor(t,i){this._fields=t,this._normalizer=i}findJsonName(t){if(!this.jsonNames){const i={};for(const e of this.list())i[e.jsonName]=i[e.name]=e;this.jsonNames=i}return this.jsonNames[t]}find(t){if(!this.numbers){const i={};for(const e of this.list())i[e.no]=e;this.numbers=i}return this.numbers[t]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((t,i)=>t.no-i.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const t=this.members;let i;for(const e of this.list())e.oneof?e.oneof!==i&&(i=e.oneof,t.push(i)):t.push(e)}return this.members}}function localFieldName(o,t){const i=protoCamelCase(o);return t?i:safeObjectProperty(safeMessageProperty(i))}function localOneofName(o){return localFieldName(o,!1)}const fieldJsonName=protoCamelCase;function protoCamelCase(o){let t=!1;const i=[];for(let e=0;e<o.length;e++){let n=o.charAt(e);switch(n){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":i.push(n),t=!1;break;default:t&&(t=!1,n=n.toUpperCase()),i.push(n);break}}return i.join("")}const reservedObjectProperties=new Set(["constructor","toString","toJSON","valueOf"]),reservedMessageProperties=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),fallback=o=>"".concat(o,"$"),safeMessageProperty=o=>reservedMessageProperties.has(o)?fallback(o):o,safeObjectProperty=o=>reservedObjectProperties.has(o)?fallback(o):o;class InternalOneofInfo{constructor(t){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=t,this.localName=localOneofName(t)}addField(t){assert(t.oneof===this,"field ".concat(t.name," not one of ").concat(this.name)),this.fields.push(t)}findField(t){if(!this._lookup){this._lookup=Object.create(null);for(let i=0;i<this.fields.length;i++)this._lookup[this.fields[i].localName]=this.fields[i]}return this._lookup[t]}}function normalizeFieldInfos(o,t){var i,e,n,s,a,c;const l=[];let u;for(const d of typeof o=="function"?o():o){const f=d;if(f.localName=localFieldName(d.name,d.oneof!==void 0),f.jsonName=(i=d.jsonName)!==null&&i!==void 0?i:fieldJsonName(d.name),f.repeated=(e=d.repeated)!==null&&e!==void 0?e:!1,d.kind=="scalar"&&(f.L=(n=d.L)!==null&&n!==void 0?n:LongType.BIGINT),f.delimited=(s=d.delimited)!==null&&s!==void 0?s:!1,f.req=(a=d.req)!==null&&a!==void 0?a:!1,f.opt=(c=d.opt)!==null&&c!==void 0?c:!1,d.packed===void 0&&(f.packed=d.kind=="enum"||d.kind=="scalar"&&d.T!=ScalarType.BYTES&&d.T!=ScalarType.STRING),d.oneof!==void 0){const h=typeof d.oneof=="string"?d.oneof:d.oneof.name;(!u||u.name!=h)&&(u=new InternalOneofInfo(h)),f.oneof=u,u.addField(f)}l.push(f)}return l}const proto3=makeProtoRuntime("proto3",o=>new InternalFieldList(o,t=>normalizeFieldInfos(t)),o=>{for(const t of o.getType().fields.byMember()){if(t.opt)continue;const i=t.localName,e=o;if(t.repeated){e[i]=[];continue}switch(t.kind){case"oneof":e[i]={case:void 0};break;case"enum":e[i]=0;break;case"map":e[i]={};break;case"scalar":e[i]=scalarZeroValue(t.T,t.L);break}}}),TrackType=proto3.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),TrackSource=proto3.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),VideoQuality$1=proto3.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),ConnectionQuality$1=proto3.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),ClientConfigSetting=proto3.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),DisconnectReason=proto3.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"}]),ReconnectReason=proto3.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),SubscriptionError=proto3.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),AudioTrackFeature=proto3.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"}]),Room$1=proto3.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Codec,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:TimedVersion}]),Codec=proto3.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),ParticipantPermission=proto3.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:proto3.getEnumType(TrackSource),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8}]),ParticipantInfo=proto3.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:proto3.getEnumType(ParticipantInfo_State)},{no:4,name:"tracks",kind:"message",T:TrackInfo,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:ParticipantPermission},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:proto3.getEnumType(ParticipantInfo_Kind)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:proto3.getEnumType(DisconnectReason)}]),ParticipantInfo_State=proto3.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),ParticipantInfo_Kind=proto3.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),Encryption_Type=proto3.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),SimulcastCodecInfo=proto3.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:VideoLayer,repeated:!0}]),TrackInfo=proto3.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:proto3.getEnumType(TrackType)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:proto3.getEnumType(TrackSource)},{no:10,name:"layers",kind:"message",T:VideoLayer,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:SimulcastCodecInfo,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:proto3.getEnumType(Encryption_Type)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:TimedVersion},{no:19,name:"audio_features",kind:"enum",T:proto3.getEnumType(AudioTrackFeature),repeated:!0}]),VideoLayer=proto3.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:proto3.getEnumType(VideoQuality$1)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]),DataPacket=proto3.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:proto3.getEnumType(DataPacket_Kind)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:UserPacket,oneof:"value"},{no:3,name:"speaker",kind:"message",T:ActiveSpeakerUpdate,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:SipDTMF,oneof:"value"},{no:7,name:"transcription",kind:"message",T:Transcription,oneof:"value"}]),DataPacket_Kind=proto3.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),ActiveSpeakerUpdate=proto3.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:SpeakerInfo,repeated:!0}]),SpeakerInfo=proto3.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),UserPacket=proto3.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0}]),SipDTMF=proto3.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),Transcription=proto3.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:TranscriptionSegment,repeated:!0}]),TranscriptionSegment=proto3.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),ParticipantTracks=proto3.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),ServerInfo=proto3.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:proto3.getEnumType(ServerInfo_Edition)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),ServerInfo_Edition=proto3.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),ClientInfo=proto3.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:proto3.getEnumType(ClientInfo_SDK)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9}]),ClientInfo_SDK=proto3.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"}]),ClientConfiguration=proto3.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:VideoConfiguration},{no:2,name:"screen",kind:"message",T:VideoConfiguration},{no:3,name:"resume_connection",kind:"enum",T:proto3.getEnumType(ClientConfigSetting)},{no:4,name:"disabled_codecs",kind:"message",T:DisabledCodecs},{no:5,name:"force_relay",kind:"enum",T:proto3.getEnumType(ClientConfigSetting)}]),VideoConfiguration=proto3.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:proto3.getEnumType(ClientConfigSetting)}]),DisabledCodecs=proto3.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Codec,repeated:!0},{no:2,name:"publish",kind:"message",T:Codec,repeated:!0}]),TimedVersion=proto3.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),SignalTarget=proto3.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),StreamState=proto3.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),CandidateProtocol=proto3.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),SignalRequest=proto3.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:SessionDescription,oneof:"message"},{no:2,name:"answer",kind:"message",T:SessionDescription,oneof:"message"},{no:3,name:"trickle",kind:"message",T:TrickleRequest,oneof:"message"},{no:4,name:"add_track",kind:"message",T:AddTrackRequest,oneof:"message"},{no:5,name:"mute",kind:"message",T:MuteTrackRequest,oneof:"message"},{no:6,name:"subscription",kind:"message",T:UpdateSubscription,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:UpdateTrackSettings,oneof:"message"},{no:8,name:"leave",kind:"message",T:LeaveRequest,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:UpdateVideoLayers,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:SubscriptionPermission,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:SyncState,oneof:"message"},{no:13,name:"simulate",kind:"message",T:SimulateScenario,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:UpdateParticipantMetadata,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Ping,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:UpdateLocalAudioTrack,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:UpdateLocalVideoTrack,oneof:"message"}]),SignalResponse=proto3.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:JoinResponse,oneof:"message"},{no:2,name:"answer",kind:"message",T:SessionDescription,oneof:"message"},{no:3,name:"offer",kind:"message",T:SessionDescription,oneof:"message"},{no:4,name:"trickle",kind:"message",T:TrickleRequest,oneof:"message"},{no:5,name:"update",kind:"message",T:ParticipantUpdate,oneof:"message"},{no:6,name:"track_published",kind:"message",T:TrackPublishedResponse,oneof:"message"},{no:8,name:"leave",kind:"message",T:LeaveRequest,oneof:"message"},{no:9,name:"mute",kind:"message",T:MuteTrackRequest,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:SpeakersChanged,oneof:"message"},{no:11,name:"room_update",kind:"message",T:RoomUpdate,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:ConnectionQualityUpdate,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:StreamStateUpdate,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:SubscribedQualityUpdate,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:SubscriptionPermissionUpdate,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:TrackUnpublishedResponse,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:ReconnectResponse,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:Pong,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:SubscriptionResponse,oneof:"message"},{no:22,name:"request_response",kind:"message",T:RequestResponse,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:TrackSubscribed,oneof:"message"}]),SimulcastCodec=proto3.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),AddTrackRequest=proto3.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:proto3.getEnumType(TrackType)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:proto3.getEnumType(TrackSource)},{no:9,name:"layers",kind:"message",T:VideoLayer,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:SimulcastCodec,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:proto3.getEnumType(Encryption_Type)},{no:15,name:"stream",kind:"scalar",T:9}]),TrickleRequest=proto3.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:proto3.getEnumType(SignalTarget)},{no:3,name:"final",kind:"scalar",T:8}]),MuteTrackRequest=proto3.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),JoinResponse=proto3.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:Room$1},{no:2,name:"participant",kind:"message",T:ParticipantInfo},{no:3,name:"other_participants",kind:"message",T:ParticipantInfo,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:ICEServer,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:ClientConfiguration},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:ServerInfo},{no:13,name:"sif_trailer",kind:"scalar",T:12}]),ReconnectResponse=proto3.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:ICEServer,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:ClientConfiguration}]),TrackPublishedResponse=proto3.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:TrackInfo}]),TrackUnpublishedResponse=proto3.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),SessionDescription=proto3.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9}]),ParticipantUpdate=proto3.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:ParticipantInfo,repeated:!0}]),UpdateSubscription=proto3.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:ParticipantTracks,repeated:!0}]),UpdateTrackSettings=proto3.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:proto3.getEnumType(VideoQuality$1)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),UpdateLocalAudioTrack=proto3.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:proto3.getEnumType(AudioTrackFeature),repeated:!0}]),UpdateLocalVideoTrack=proto3.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),LeaveRequest=proto3.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:proto3.getEnumType(DisconnectReason)},{no:3,name:"action",kind:"enum",T:proto3.getEnumType(LeaveRequest_Action)},{no:4,name:"regions",kind:"message",T:RegionSettings}]),LeaveRequest_Action=proto3.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),UpdateVideoLayers=proto3.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:VideoLayer,repeated:!0}]),UpdateParticipantMetadata=proto3.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),ICEServer=proto3.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),SpeakersChanged=proto3.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:SpeakerInfo,repeated:!0}]),RoomUpdate=proto3.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:Room$1}]),ConnectionQualityInfo=proto3.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:proto3.getEnumType(ConnectionQuality$1)},{no:3,name:"score",kind:"scalar",T:2}]),ConnectionQualityUpdate=proto3.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:ConnectionQualityInfo,repeated:!0}]),StreamStateInfo=proto3.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:proto3.getEnumType(StreamState)}]),StreamStateUpdate=proto3.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:StreamStateInfo,repeated:!0}]),SubscribedQuality=proto3.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:proto3.getEnumType(VideoQuality$1)},{no:2,name:"enabled",kind:"scalar",T:8}]),SubscribedCodec=proto3.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:SubscribedQuality,repeated:!0}]),SubscribedQualityUpdate=proto3.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:SubscribedQuality,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:SubscribedCodec,repeated:!0}]),TrackPermission=proto3.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),SubscriptionPermission=proto3.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:TrackPermission,repeated:!0}]),SubscriptionPermissionUpdate=proto3.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),SyncState=proto3.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:SessionDescription},{no:2,name:"subscription",kind:"message",T:UpdateSubscription},{no:3,name:"publish_tracks",kind:"message",T:TrackPublishedResponse,repeated:!0},{no:4,name:"data_channels",kind:"message",T:DataChannelInfo,repeated:!0},{no:5,name:"offer",kind:"message",T:SessionDescription},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0}]),DataChannelInfo=proto3.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:proto3.getEnumType(SignalTarget)}]),SimulateScenario=proto3.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:proto3.getEnumType(CandidateProtocol),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),Ping=proto3.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),Pong=proto3.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),RegionSettings=proto3.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:RegionInfo,repeated:!0}]),RegionInfo=proto3.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),SubscriptionResponse=proto3.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:proto3.getEnumType(SubscriptionError)}]),RequestResponse=proto3.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:proto3.getEnumType(RequestResponse_Reason)},{no:3,name:"message",kind:"scalar",T:9}]),RequestResponse_Reason=proto3.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),TrackSubscribed=proto3.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof dist.global<"u"?dist.global:typeof self<"u"?self:{};function getDefaultExportFromCjs(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var loglevel={exports:{}};(function(o){(function(t,i){o.exports?o.exports=i():t.log=i()})(commonjsGlobal,function(){var t=function(){},i="undefined",e=typeof window!==i&&typeof window.navigator!==i&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"],s={},a=null;function c(g,v){var T=g[v];if(typeof T.bind=="function")return T.bind(g);try{return Function.prototype.bind.call(T,g)}catch{return function(){return Function.prototype.apply.apply(T,[g,arguments])}}}function l(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function u(g){return g==="debug"&&(g="log"),typeof console===i?!1:g==="trace"&&e?l:console[g]!==void 0?c(console,g):console.log!==void 0?c(console,"log"):t}function d(){for(var g=this.getLevel(),v=0;v<n.length;v++){var T=n[v];this[T]=v<g?t:this.methodFactory(T,g,this.name)}if(this.log=this.debug,typeof console===i&&g<this.levels.SILENT)return"No console available for logging"}function f(g){return function(){typeof console!==i&&(d.call(this),this[g].apply(this,arguments))}}function h(g,v,T){return u(g)||f.apply(this,arguments)}function p(g,v){var T=this,b,_,y,E="loglevel";typeof g=="string"?E+=":"+g:typeof g=="symbol"&&(E=void 0);function P(S){var k=(n[S]||"silent").toUpperCase();if(!(typeof window===i||!E)){try{window.localStorage[E]=k;return}catch{}try{window.document.cookie=encodeURIComponent(E)+"="+k+";"}catch{}}}function w(){var S;if(!(typeof window===i||!E)){try{S=window.localStorage[E]}catch{}if(typeof S===i)try{var k=window.document.cookie,A=encodeURIComponent(E),M=k.indexOf(A+"=");M!==-1&&(S=/^([^;]+)/.exec(k.slice(M+A.length+1))[1])}catch{}return T.levels[S]===void 0&&(S=void 0),S}}function C(){if(!(typeof window===i||!E)){try{window.localStorage.removeItem(E)}catch{}try{window.document.cookie=encodeURIComponent(E)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function I(S){var k=S;if(typeof k=="string"&&T.levels[k.toUpperCase()]!==void 0&&(k=T.levels[k.toUpperCase()]),typeof k=="number"&&k>=0&&k<=T.levels.SILENT)return k;throw new TypeError("log.setLevel() called with invalid level: "+S)}T.name=g,T.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},T.methodFactory=v||h,T.getLevel=function(){return y??_??b},T.setLevel=function(S,k){return y=I(S),k!==!1&&P(y),d.call(T)},T.setDefaultLevel=function(S){_=I(S),w()||T.setLevel(S,!1)},T.resetLevel=function(){y=null,C(),d.call(T)},T.enableAll=function(S){T.setLevel(T.levels.TRACE,S)},T.disableAll=function(S){T.setLevel(T.levels.SILENT,S)},T.rebuild=function(){if(a!==T&&(b=I(a.getLevel())),d.call(T),a===T)for(var S in s)s[S].rebuild()},b=I(a?a.getLevel():"WARN");var O=w();O!=null&&(y=I(O)),d.call(T)}a=new p,a.getLogger=function(v){if(typeof v!="symbol"&&typeof v!="string"||v==="")throw new TypeError("You must supply a name when creating a logger.");var T=s[v];return T||(T=s[v]=new p(v,a.methodFactory)),T};var m=typeof window!==i?window.log:void 0;return a.noConflict=function(){return typeof window!==i&&window.log===a&&(window.log=m),a},a.getLoggers=function(){return s},a.default=a,a})})(loglevel);var loglevelExports=loglevel.exports,LogLevel;(function(o){o[o.trace=0]="trace",o[o.debug=1]="debug",o[o.info=2]="info",o[o.warn=3]="warn",o[o.error=4]="error",o[o.silent=5]="silent"})(LogLevel||(LogLevel={}));var LoggerNames;(function(o){o.Default="livekit",o.Room="livekit-room",o.Participant="livekit-participant",o.Track="livekit-track",o.Publication="livekit-track-publication",o.Engine="livekit-engine",o.Signal="livekit-signal",o.PCManager="livekit-pc-manager",o.PCTransport="livekit-pc-transport",o.E2EE="lk-e2ee"})(LoggerNames||(LoggerNames={}));let livekitLogger=loglevelExports.getLogger("livekit");Object.values(LoggerNames).map(o=>loglevelExports.getLogger(o));livekitLogger.setDefaultLevel(LogLevel.info);function getLogger(o){const t=loglevelExports.getLogger(o);return t.setDefaultLevel(livekitLogger.getLevel()),t}const workerLogger=loglevelExports.getLogger("lk-e2ee"),maxRetryDelay=7e3,DEFAULT_RETRY_DELAYS_IN_MS=[0,300,2*2*300,3*3*300,4*4*300,maxRetryDelay,maxRetryDelay,maxRetryDelay,maxRetryDelay,maxRetryDelay];class DefaultReconnectPolicy{constructor(t){this._retryDelays=t!==void 0?[...t]:DEFAULT_RETRY_DELAYS_IN_MS}nextRetryDelayInMs(t){if(t.retryCount>=this._retryDelays.length)return null;const i=this._retryDelays[t.retryCount];return t.retryCount<=1?i:i+Math.random()*1e3}}function __awaiter(o,t,i,e){function n(s){return s instanceof i?s:new i(function(a){a(s)})}return new(i||(i=Promise))(function(s,a){function c(d){try{u(e.next(d))}catch(f){a(f)}}function l(d){try{u(e.throw(d))}catch(f){a(f)}}function u(d){d.done?s(d.value):n(d.value).then(c,l)}u((e=e.apply(o,t||[])).next())})}function __values(o){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&o[t],e=0;if(i)return i.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&e>=o.length&&(o=void 0),{value:o&&o[e++],done:!o}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function __asyncValues(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=o[Symbol.asyncIterator],i;return t?t.call(o):(o=typeof __values=="function"?__values(o):o[Symbol.iterator](),i={},e("next"),e("throw"),e("return"),i[Symbol.asyncIterator]=function(){return this},i);function e(s){i[s]=o[s]&&function(a){return new Promise(function(c,l){a=o[s](a),n(c,l,a.done,a.value)})}}function n(s,a,c,l){Promise.resolve(l).then(function(u){s({value:u,done:c})},a)}}typeof SuppressedError=="function"&&SuppressedError;var events={exports:{}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function o(t,i,e){return Function.prototype.apply.call(t,i,e)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:ReflectOwnKeys=function(t){return Object.getOwnPropertyNames(t)};function ProcessEmitWarning(o){console&&console.warn&&console.warn(o)}var NumberIsNaN=Number.isNaN||function o(t){return t!==t};function EventEmitter(){EventEmitter.init.call(this)}events.exports=EventEmitter;events.exports.once=once;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=void 0;EventEmitter.prototype._eventsCount=0;EventEmitter.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(o){if(typeof o!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof o)}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(o){if(typeof o!="number"||o<0||NumberIsNaN(o))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+o+".");defaultMaxListeners=o}});EventEmitter.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter.prototype.setMaxListeners=function o(t){if(typeof t!="number"||t<0||NumberIsNaN(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function _getMaxListeners(o){return o._maxListeners===void 0?EventEmitter.defaultMaxListeners:o._maxListeners}EventEmitter.prototype.getMaxListeners=function o(){return _getMaxListeners(this)};EventEmitter.prototype.emit=function o(t){for(var i=[],e=1;e<arguments.length;e++)i.push(arguments[e]);var n=t==="error",s=this._events;if(s!==void 0)n=n&&s.error===void 0;else if(!n)return!1;if(n){var a;if(i.length>0&&(a=i[0]),a instanceof Error)throw a;var c=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw c.context=a,c}var l=s[t];if(l===void 0)return!1;if(typeof l=="function")ReflectApply(l,this,i);else for(var u=l.length,d=arrayClone(l,u),e=0;e<u;++e)ReflectApply(d[e],this,i);return!0};function _addListener(o,t,i,e){var n,s,a;if(checkListener(i),s=o._events,s===void 0?(s=o._events=Object.create(null),o._eventsCount=0):(s.newListener!==void 0&&(o.emit("newListener",t,i.listener?i.listener:i),s=o._events),a=s[t]),a===void 0)a=s[t]=i,++o._eventsCount;else if(typeof a=="function"?a=s[t]=e?[i,a]:[a,i]:e?a.unshift(i):a.push(i),n=_getMaxListeners(o),n>0&&a.length>n&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=o,c.type=t,c.count=a.length,ProcessEmitWarning(c)}return o}EventEmitter.prototype.addListener=function o(t,i){return _addListener(this,t,i,!1)};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.prependListener=function o(t,i){return _addListener(this,t,i,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(o,t,i){var e={fired:!1,wrapFn:void 0,target:o,type:t,listener:i},n=onceWrapper.bind(e);return n.listener=i,e.wrapFn=n,n}EventEmitter.prototype.once=function o(t,i){return checkListener(i),this.on(t,_onceWrap(this,t,i)),this};EventEmitter.prototype.prependOnceListener=function o(t,i){return checkListener(i),this.prependListener(t,_onceWrap(this,t,i)),this};EventEmitter.prototype.removeListener=function o(t,i){var e,n,s,a,c;if(checkListener(i),n=this._events,n===void 0)return this;if(e=n[t],e===void 0)return this;if(e===i||e.listener===i)--this._eventsCount===0?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,e.listener||i));else if(typeof e!="function"){for(s=-1,a=e.length-1;a>=0;a--)if(e[a]===i||e[a].listener===i){c=e[a].listener,s=a;break}if(s<0)return this;s===0?e.shift():spliceOne(e,s),e.length===1&&(n[t]=e[0]),n.removeListener!==void 0&&this.emit("removeListener",t,c||i)}return this};EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.removeAllListeners=function o(t){var i,e,n;if(e=this._events,e===void 0)return this;if(e.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):e[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete e[t]),this;if(arguments.length===0){var s=Object.keys(e),a;for(n=0;n<s.length;++n)a=s[n],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(i=e[t],typeof i=="function")this.removeListener(t,i);else if(i!==void 0)for(n=i.length-1;n>=0;n--)this.removeListener(t,i[n]);return this};function _listeners(o,t,i){var e=o._events;if(e===void 0)return[];var n=e[t];return n===void 0?[]:typeof n=="function"?i?[n.listener||n]:[n]:i?unwrapListeners(n):arrayClone(n,n.length)}EventEmitter.prototype.listeners=function o(t){return _listeners(this,t,!0)};EventEmitter.prototype.rawListeners=function o(t){return _listeners(this,t,!1)};EventEmitter.listenerCount=function(o,t){return typeof o.listenerCount=="function"?o.listenerCount(t):listenerCount.call(o,t)};EventEmitter.prototype.listenerCount=listenerCount;function listenerCount(o){var t=this._events;if(t!==void 0){var i=t[o];if(typeof i=="function")return 1;if(i!==void 0)return i.length}return 0}EventEmitter.prototype.eventNames=function o(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(o,t){for(var i=new Array(t),e=0;e<t;++e)i[e]=o[e];return i}function spliceOne(o,t){for(;t+1<o.length;t++)o[t]=o[t+1];o.pop()}function unwrapListeners(o){for(var t=new Array(o.length),i=0;i<t.length;++i)t[i]=o[i].listener||o[i];return t}function once(o,t){return new Promise(function(i,e){function n(a){o.removeListener(t,s),e(a)}function s(){typeof o.removeListener=="function"&&o.removeListener("error",n),i([].slice.call(arguments))}eventTargetAgnosticAddListener(o,t,s,{once:!0}),t!=="error"&&addErrorHandlerIfEventEmitter(o,n,{once:!0})})}function addErrorHandlerIfEventEmitter(o,t,i){typeof o.on=="function"&&eventTargetAgnosticAddListener(o,"error",t,i)}function eventTargetAgnosticAddListener(o,t,i,e){if(typeof o.on=="function")e.once?o.once(t,i):o.on(t,i);else if(typeof o.addEventListener=="function")o.addEventListener(t,function n(s){e.once&&o.removeEventListener(t,n),i(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof o)}var eventsExports=events.exports;let logDisabled_=!0,deprecationWarnings_=!0;function extractVersion(o,t,i){const e=o.match(t);return e&&e.length>=i&&parseInt(e[i],10)}function wrapPeerConnectionEvent(o,t,i){if(!o.RTCPeerConnection)return;const e=o.RTCPeerConnection.prototype,n=e.addEventListener;e.addEventListener=function(a,c){if(a!==t)return n.apply(this,arguments);const l=u=>{const d=i(u);d&&(c.handleEvent?c.handleEvent(d):c(d))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(c,l),n.apply(this,[a,l])};const s=e.removeEventListener;e.removeEventListener=function(a,c){if(a!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(c))return s.apply(this,arguments);const l=this._eventMap[t].get(c);return this._eventMap[t].delete(c),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[a,l])},Object.defineProperty(e,"on"+t,{get(){return this["_on"+t]},set(a){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),a&&this.addEventListener(t,this["_on"+t]=a)},enumerable:!0,configurable:!0})}function disableLog(o){return typeof o!="boolean"?new Error("Argument type: "+typeof o+". Please use a boolean."):(logDisabled_=o,o?"adapter.js logging disabled":"adapter.js logging enabled")}function disableWarnings(o){return typeof o!="boolean"?new Error("Argument type: "+typeof o+". Please use a boolean."):(deprecationWarnings_=!o,"adapter.js deprecation warnings "+(o?"disabled":"enabled"))}function log(){if(typeof window=="object"){if(logDisabled_)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function deprecated(o,t){deprecationWarnings_&&console.warn(o+" is deprecated, please use "+t+" instead.")}function detectBrowser(o){const t={browser:null,version:null};if(typeof o>"u"||!o.navigator||!o.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:i}=o;if(i.userAgentData&&i.userAgentData.brands){const e=i.userAgentData.brands.find(n=>n.brand==="Chromium");if(e)return{browser:"chrome",version:parseInt(e.version,10)}}if(i.mozGetUserMedia)t.browser="firefox",t.version=extractVersion(i.userAgent,/Firefox\/(\d+)\./,1);else if(i.webkitGetUserMedia||o.isSecureContext===!1&&o.webkitRTCPeerConnection)t.browser="chrome",t.version=extractVersion(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(o.RTCPeerConnection&&i.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=extractVersion(i.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=o.RTCRtpTransceiver&&"currentDirection"in o.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}function isObject(o){return Object.prototype.toString.call(o)==="[object Object]"}function compactObject(o){return isObject(o)?Object.keys(o).reduce(function(t,i){const e=isObject(o[i]),n=e?compactObject(o[i]):o[i],s=e&&!Object.keys(n).length;return n===void 0||s?t:Object.assign(t,{[i]:n})},{}):o}function walkStats(o,t,i){!t||i.has(t.id)||(i.set(t.id,t),Object.keys(t).forEach(e=>{e.endsWith("Id")?walkStats(o,o.get(t[e]),i):e.endsWith("Ids")&&t[e].forEach(n=>{walkStats(o,o.get(n),i)})}))}function filterStats(o,t,i){const e=i?"outbound-rtp":"inbound-rtp",n=new Map;if(t===null)return n;const s=[];return o.forEach(a=>{a.type==="track"&&a.trackIdentifier===t.id&&s.push(a)}),s.forEach(a=>{o.forEach(c=>{c.type===e&&c.trackId===a.id&&walkStats(o,c,n)})}),n}const logging=log;function shimGetUserMedia$2(o,t){const i=o&&o.navigator;if(!i.mediaDevices)return;const e=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;const l={};return Object.keys(c).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const d=typeof c[u]=="object"?c[u]:{ideal:c[u]};d.exact!==void 0&&typeof d.exact=="number"&&(d.min=d.max=d.exact);const f=function(h,p){return h?h+p.charAt(0).toUpperCase()+p.slice(1):p==="deviceId"?"sourceId":p};if(d.ideal!==void 0){l.optional=l.optional||[];let h={};typeof d.ideal=="number"?(h[f("min",u)]=d.ideal,l.optional.push(h),h={},h[f("max",u)]=d.ideal,l.optional.push(h)):(h[f("",u)]=d.ideal,l.optional.push(h))}d.exact!==void 0&&typeof d.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[f("",u)]=d.exact):["min","max"].forEach(h=>{d[h]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[f(h,u)]=d[h])})}),c.advanced&&(l.optional=(l.optional||[]).concat(c.advanced)),l},n=function(c,l){if(t.version>=61)return l(c);if(c=JSON.parse(JSON.stringify(c)),c&&typeof c.audio=="object"){const u=function(d,f,h){f in d&&!(h in d)&&(d[h]=d[f],delete d[f])};c=JSON.parse(JSON.stringify(c)),u(c.audio,"autoGainControl","googAutoGainControl"),u(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=e(c.audio)}if(c&&typeof c.video=="object"){let u=c.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const d=t.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&!(i.mediaDevices.getSupportedConstraints&&i.mediaDevices.getSupportedConstraints().facingMode&&!d)){delete c.video.facingMode;let f;if(u.exact==="environment"||u.ideal==="environment"?f=["back","rear"]:(u.exact==="user"||u.ideal==="user")&&(f=["front"]),f)return i.mediaDevices.enumerateDevices().then(h=>{h=h.filter(m=>m.kind==="videoinput");let p=h.find(m=>f.some(g=>m.label.toLowerCase().includes(g)));return!p&&h.length&&f.includes("back")&&(p=h[h.length-1]),p&&(c.video.deviceId=u.exact?{exact:p.deviceId}:{ideal:p.deviceId}),c.video=e(c.video),logging("chrome: "+JSON.stringify(c)),l(c)})}c.video=e(c.video)}return logging("chrome: "+JSON.stringify(c)),l(c)},s=function(c){return t.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(c,l,u){n(c,d=>{i.webkitGetUserMedia(d,l,f=>{u&&u(s(f))})})};if(i.getUserMedia=a.bind(i),i.mediaDevices.getUserMedia){const c=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(l){return n(l,u=>c(u).then(d=>{if(u.audio&&!d.getAudioTracks().length||u.video&&!d.getVideoTracks().length)throw d.getTracks().forEach(f=>{f.stop()}),new DOMException("","NotFoundError");return d},d=>Promise.reject(s(d))))}}}function shimMediaStream(o){o.MediaStream=o.MediaStream||o.webkitMediaStream}function shimOnTrack$1(o){if(typeof o=="object"&&o.RTCPeerConnection&&!("ontrack"in o.RTCPeerConnection.prototype)){Object.defineProperty(o.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const t=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=e=>{e.stream.addEventListener("addtrack",n=>{let s;o.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(c=>c.track&&c.track.id===n.track.id):s={track:n.track};const a=new Event("track");a.track=n.track,a.receiver=s,a.transceiver={receiver:s},a.streams=[e.stream],this.dispatchEvent(a)}),e.stream.getTracks().forEach(n=>{let s;o.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(c=>c.track&&c.track.id===n.id):s={track:n};const a=new Event("track");a.track=n,a.receiver=s,a.transceiver={receiver:s},a.streams=[e.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else wrapPeerConnectionEvent(o,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function shimGetSendersWithDtmf(o){if(typeof o=="object"&&o.RTCPeerConnection&&!("getSenders"in o.RTCPeerConnection.prototype)&&"createDTMFSender"in o.RTCPeerConnection.prototype){const t=function(n,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=n.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:n}};if(!o.RTCPeerConnection.prototype.getSenders){o.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addTrack=function(c,l){let u=n.apply(this,arguments);return u||(u=t(this,c),this._senders.push(u)),u};const s=o.RTCPeerConnection.prototype.removeTrack;o.RTCPeerConnection.prototype.removeTrack=function(c){s.apply(this,arguments);const l=this._senders.indexOf(c);l!==-1&&this._senders.splice(l,1)}}const i=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(a=>{this._senders.push(t(this,a))})};const e=o.RTCPeerConnection.prototype.removeStream;o.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],e.apply(this,[s]),s.getTracks().forEach(a=>{const c=this._senders.find(l=>l.track===a);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof o=="object"&&o.RTCPeerConnection&&"getSenders"in o.RTCPeerConnection.prototype&&"createDTMFSender"in o.RTCPeerConnection.prototype&&o.RTCRtpSender&&!("dtmf"in o.RTCRtpSender.prototype)){const t=o.RTCPeerConnection.prototype.getSenders;o.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(n=>n._pc=this),e},Object.defineProperty(o.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function shimSenderReceiverGetStats(o){if(!(typeof o=="object"&&o.RTCPeerConnection&&o.RTCRtpSender&&o.RTCRtpReceiver))return;if(!("getStats"in o.RTCRtpSender.prototype)){const i=o.RTCPeerConnection.prototype.getSenders;i&&(o.RTCPeerConnection.prototype.getSenders=function(){const s=i.apply(this,[]);return s.forEach(a=>a._pc=this),s});const e=o.RTCPeerConnection.prototype.addTrack;e&&(o.RTCPeerConnection.prototype.addTrack=function(){const s=e.apply(this,arguments);return s._pc=this,s}),o.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(a=>filterStats(a,s.track,!0))}}if(!("getStats"in o.RTCRtpReceiver.prototype)){const i=o.RTCPeerConnection.prototype.getReceivers;i&&(o.RTCPeerConnection.prototype.getReceivers=function(){const n=i.apply(this,[]);return n.forEach(s=>s._pc=this),n}),wrapPeerConnectionEvent(o,"track",e=>(e.receiver._pc=e.srcElement,e)),o.RTCRtpReceiver.prototype.getStats=function(){const n=this;return this._pc.getStats().then(s=>filterStats(s,n.track,!1))}}if(!("getStats"in o.RTCRtpSender.prototype&&"getStats"in o.RTCRtpReceiver.prototype))return;const t=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof o.MediaStreamTrack){const e=arguments[0];let n,s,a;return this.getSenders().forEach(c=>{c.track===e&&(n?a=!0:n=c)}),this.getReceivers().forEach(c=>(c.track===e&&(s?a=!0:s=c),c.track===e)),a||n&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function shimAddTrackRemoveTrackWithNative(o){o.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const t=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addTrack=function(a,c){if(!c)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=t.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(l)===-1&&this._shimmedLocalStreams[c.id].push(l):this._shimmedLocalStreams[c.id]=[c,l],l};const i=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(u=>{if(this.getSenders().find(f=>f.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();i.apply(this,arguments);const l=this.getSenders().filter(u=>c.indexOf(u)===-1);this._shimmedLocalStreams[a.id]=[a].concat(l)};const e=o.RTCPeerConnection.prototype.removeStream;o.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],e.apply(this,arguments)};const n=o.RTCPeerConnection.prototype.removeTrack;o.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const l=this._shimmedLocalStreams[c].indexOf(a);l!==-1&&this._shimmedLocalStreams[c].splice(l,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),n.apply(this,arguments)}}function shimAddTrackRemoveTrack(o,t){if(!o.RTCPeerConnection)return;if(o.RTCPeerConnection.prototype.addTrack&&t.version>=65)return shimAddTrackRemoveTrackWithNative(o);const i=o.RTCPeerConnection.prototype.getLocalStreams;o.RTCPeerConnection.prototype.getLocalStreams=function(){const d=i.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(f=>this._reverseStreams[f.id])};const e=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(f=>{if(this.getSenders().find(p=>p.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){const f=new o.MediaStream(d.getTracks());this._streams[d.id]=f,this._reverseStreams[f.id]=d,d=f}e.apply(this,[d])};const n=o.RTCPeerConnection.prototype.removeStream;o.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},o.RTCPeerConnection.prototype.addTrack=function(d,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(g=>g===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const m=this._streams[f.id];if(m)m.addTrack(d),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new o.MediaStream([d]);this._streams[f.id]=g,this._reverseStreams[g.id]=f,this.addStream(g)}return this.getSenders().find(g=>g.track===d)};function s(u,d){let f=d.sdp;return Object.keys(u._reverseStreams||[]).forEach(h=>{const p=u._reverseStreams[h],m=u._streams[p.id];f=f.replace(new RegExp(m.id,"g"),p.id)}),new RTCSessionDescription({type:d.type,sdp:f})}function a(u,d){let f=d.sdp;return Object.keys(u._reverseStreams||[]).forEach(h=>{const p=u._reverseStreams[h],m=u._streams[p.id];f=f.replace(new RegExp(p.id,"g"),m.id)}),new RTCSessionDescription({type:d.type,sdp:f})}["createOffer","createAnswer"].forEach(function(u){const d=o.RTCPeerConnection.prototype[u],f={[u](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?d.apply(this,[m=>{const g=s(this,m);h[0].apply(null,[g])},m=>{h[1]&&h[1].apply(null,m)},arguments[2]]):d.apply(this,arguments).then(m=>s(this,m))}};o.RTCPeerConnection.prototype[u]=f[u]});const c=o.RTCPeerConnection.prototype.setLocalDescription;o.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?c.apply(this,arguments):(arguments[0]=a(this,arguments[0]),c.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(o.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(o.RTCPeerConnection.prototype,"localDescription",{get(){const u=l.get.apply(this);return u.type===""?u:s(this,u)}}),o.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(d._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(g=>d.track===g)&&(h=this._streams[p])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function shimPeerConnection$1(o,t){!o.RTCPeerConnection&&o.webkitRTCPeerConnection&&(o.RTCPeerConnection=o.webkitRTCPeerConnection),o.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const e=o.RTCPeerConnection.prototype[i],n={[i](){return arguments[0]=new(i==="addIceCandidate"?o.RTCIceCandidate:o.RTCSessionDescription)(arguments[0]),e.apply(this,arguments)}};o.RTCPeerConnection.prototype[i]=n[i]})}function fixNegotiationNeeded(o,t){wrapPeerConnectionEvent(o,"negotiationneeded",i=>{const e=i.target;if(!((t.version<72||e.getConfiguration&&e.getConfiguration().sdpSemantics==="plan-b")&&e.signalingState!=="stable"))return i})}var chromeShim=Object.freeze({__proto__:null,fixNegotiationNeeded,shimAddTrackRemoveTrack,shimAddTrackRemoveTrackWithNative,shimGetSendersWithDtmf,shimGetUserMedia:shimGetUserMedia$2,shimMediaStream,shimOnTrack:shimOnTrack$1,shimPeerConnection:shimPeerConnection$1,shimSenderReceiverGetStats});function shimGetUserMedia$1(o,t){const i=o&&o.navigator,e=o&&o.MediaStreamTrack;if(i.getUserMedia=function(n,s,a){deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(n).then(s,a)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const n=function(a,c,l){c in a&&!(l in a)&&(a[l]=a[c],delete a[c])},s=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),n(a.audio,"autoGainControl","mozAutoGainControl"),n(a.audio,"noiseSuppression","mozNoiseSuppression")),s(a)},e&&e.prototype.getSettings){const a=e.prototype.getSettings;e.prototype.getSettings=function(){const c=a.apply(this,arguments);return n(c,"mozAutoGainControl","autoGainControl"),n(c,"mozNoiseSuppression","noiseSuppression"),c}}if(e&&e.prototype.applyConstraints){const a=e.prototype.applyConstraints;e.prototype.applyConstraints=function(c){return this.kind==="audio"&&typeof c=="object"&&(c=JSON.parse(JSON.stringify(c)),n(c,"autoGainControl","mozAutoGainControl"),n(c,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[c])}}}}function shimGetDisplayMedia(o,t){o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices||o.navigator.mediaDevices&&(o.navigator.mediaDevices.getDisplayMedia=function(e){if(!(e&&e.video)){const n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return e.video===!0?e.video={mediaSource:t}:e.video.mediaSource=t,o.navigator.mediaDevices.getUserMedia(e)})}function shimOnTrack(o){typeof o=="object"&&o.RTCTrackEvent&&"receiver"in o.RTCTrackEvent.prototype&&!("transceiver"in o.RTCTrackEvent.prototype)&&Object.defineProperty(o.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function shimPeerConnection(o,t){if(typeof o!="object"||!(o.RTCPeerConnection||o.mozRTCPeerConnection))return;!o.RTCPeerConnection&&o.mozRTCPeerConnection&&(o.RTCPeerConnection=o.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const s=o.RTCPeerConnection.prototype[n],a={[n](){return arguments[0]=new(n==="addIceCandidate"?o.RTCIceCandidate:o.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};o.RTCPeerConnection.prototype[n]=a[n]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},e=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){const[s,a,c]=arguments;return e.apply(this,[s||null]).then(l=>{if(t.version<53&&!a)try{l.forEach(u=>{u.type=i[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;l.forEach((d,f)=>{l.set(f,Object.assign({},d,{type:i[d.type]||d.type}))})}return l}).then(a,c)}}function shimSenderGetStats(o){if(!(typeof o=="object"&&o.RTCPeerConnection&&o.RTCRtpSender)||o.RTCRtpSender&&"getStats"in o.RTCRtpSender.prototype)return;const t=o.RTCPeerConnection.prototype.getSenders;t&&(o.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(s=>s._pc=this),n});const i=o.RTCPeerConnection.prototype.addTrack;i&&(o.RTCPeerConnection.prototype.addTrack=function(){const n=i.apply(this,arguments);return n._pc=this,n}),o.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function shimReceiverGetStats(o){if(!(typeof o=="object"&&o.RTCPeerConnection&&o.RTCRtpSender)||o.RTCRtpSender&&"getStats"in o.RTCRtpReceiver.prototype)return;const t=o.RTCPeerConnection.prototype.getReceivers;t&&(o.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(n=>n._pc=this),e}),wrapPeerConnectionEvent(o,"track",i=>(i.receiver._pc=i.srcElement,i)),o.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function shimRemoveStream(o){!o.RTCPeerConnection||"removeStream"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.removeStream=function(i){deprecated("removeStream","removeTrack"),this.getSenders().forEach(e=>{e.track&&i.getTracks().includes(e.track)&&this.removeTrack(e)})})}function shimRTCDataChannel(o){o.DataChannel&&!o.RTCDataChannel&&(o.RTCDataChannel=o.DataChannel)}function shimAddTransceiver(o){if(!(typeof o=="object"&&o.RTCPeerConnection))return;const t=o.RTCPeerConnection.prototype.addTransceiver;t&&(o.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;e===void 0&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=t.apply(this,arguments);if(n){const{sender:a}=s,c=a.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=e,a.sendEncodings=e,this.setParametersPromises.push(a.setParameters(c).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return s})}function shimGetParameters(o){if(!(typeof o=="object"&&o.RTCRtpSender))return;const t=o.RTCRtpSender.prototype.getParameters;t&&(o.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function shimCreateOffer(o){if(!(typeof o=="object"&&o.RTCPeerConnection))return;const t=o.RTCPeerConnection.prototype.createOffer;o.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function shimCreateAnswer(o){if(!(typeof o=="object"&&o.RTCPeerConnection))return;const t=o.RTCPeerConnection.prototype.createAnswer;o.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var firefoxShim=Object.freeze({__proto__:null,shimAddTransceiver,shimCreateAnswer,shimCreateOffer,shimGetDisplayMedia,shimGetParameters,shimGetUserMedia:shimGetUserMedia$1,shimOnTrack,shimPeerConnection,shimRTCDataChannel,shimReceiverGetStats,shimRemoveStream,shimSenderGetStats});function shimLocalStreamsAPI(o){if(!(typeof o!="object"||!o.RTCPeerConnection)){if("getLocalStreams"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in o.RTCPeerConnection.prototype)){const t=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(n=>t.call(this,n,e)),e.getVideoTracks().forEach(n=>t.call(this,n,e))},o.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,s=new Array(n>1?n-1:0),a=1;a<n;a++)s[a-1]=arguments[a];return s&&s.forEach(c=>{this._localStreams?this._localStreams.includes(c)||this._localStreams.push(c):this._localStreams=[c]}),t.apply(this,arguments)}}"removeStream"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.removeStream=function(i){this._localStreams||(this._localStreams=[]);const e=this._localStreams.indexOf(i);if(e===-1)return;this._localStreams.splice(e,1);const n=i.getTracks();this.getSenders().forEach(s=>{n.includes(s.track)&&this.removeTrack(s)})})}}function shimRemoteStreamsAPI(o){if(!(typeof o!="object"||!o.RTCPeerConnection)&&("getRemoteStreams"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in o.RTCPeerConnection.prototype))){Object.defineProperty(o.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(n=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(n))return;this._remoteStreams.push(n);const s=new Event("addstream");s.stream=n,this.dispatchEvent(s)})})}});const t=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(s=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(s)>=0)return;e._remoteStreams.push(s);const a=new Event("addstream");a.stream=s,e.dispatchEvent(a)})}),t.apply(e,arguments)}}}function shimCallbacksAPI(o){if(typeof o!="object"||!o.RTCPeerConnection)return;const t=o.RTCPeerConnection.prototype,i=t.createOffer,e=t.createAnswer,n=t.setLocalDescription,s=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(u,d){const f=arguments.length>=2?arguments[2]:arguments[0],h=i.apply(this,[f]);return d?(h.then(u,d),Promise.resolve()):h},t.createAnswer=function(u,d){const f=arguments.length>=2?arguments[2]:arguments[0],h=e.apply(this,[f]);return d?(h.then(u,d),Promise.resolve()):h};let c=function(l,u,d){const f=n.apply(this,[l]);return d?(f.then(u,d),Promise.resolve()):f};t.setLocalDescription=c,c=function(l,u,d){const f=s.apply(this,[l]);return d?(f.then(u,d),Promise.resolve()):f},t.setRemoteDescription=c,c=function(l,u,d){const f=a.apply(this,[l]);return d?(f.then(u,d),Promise.resolve()):f},t.addIceCandidate=c}function shimGetUserMedia(o){const t=o&&o.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const i=t.mediaDevices,e=i.getUserMedia.bind(i);t.mediaDevices.getUserMedia=n=>e(shimConstraints(n))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(e,n,s){t.mediaDevices.getUserMedia(e).then(n,s)}).bind(t))}function shimConstraints(o){return o&&o.video!==void 0?Object.assign({},o,{video:compactObject(o.video)}):o}function shimRTCIceServerUrls(o){if(!o.RTCPeerConnection)return;const t=o.RTCPeerConnection;o.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const s=[];for(let a=0;a<e.iceServers.length;a++){let c=e.iceServers[a];c.urls===void 0&&c.url?(deprecated("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,s.push(c)):s.push(e.iceServers[a])}e.iceServers=s}return new t(e,n)},o.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(o.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function shimTrackEventTransceiver(o){typeof o=="object"&&o.RTCTrackEvent&&"receiver"in o.RTCTrackEvent.prototype&&!("transceiver"in o.RTCTrackEvent.prototype)&&Object.defineProperty(o.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function shimCreateOfferLegacy(o){const t=o.RTCPeerConnection.prototype.createOffer;o.RTCPeerConnection.prototype.createOffer=function(e){if(e){typeof e.offerToReceiveAudio<"u"&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const n=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");e.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):e.offerToReceiveAudio===!0&&!n&&this.addTransceiver("audio",{direction:"recvonly"}),typeof e.offerToReceiveVideo<"u"&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const s=this.getTransceivers().find(a=>a.receiver.track.kind==="video");e.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):e.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function shimAudioContext(o){typeof o!="object"||o.AudioContext||(o.AudioContext=o.webkitAudioContext)}var safariShim=Object.freeze({__proto__:null,shimAudioContext,shimCallbacksAPI,shimConstraints,shimCreateOfferLegacy,shimGetUserMedia,shimLocalStreamsAPI,shimRTCIceServerUrls,shimRemoteStreamsAPI,shimTrackEventTransceiver}),sdp$1={exports:{}};(function(o){const t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(i){return i.trim().split(`
`).map(e=>e.trim())},t.splitSections=function(i){return i.split(`
m=`).map((n,s)=>(s>0?"m="+n:n).trim()+`\r
`)},t.getDescription=function(i){const e=t.splitSections(i);return e&&e[0]},t.getMediaSections=function(i){const e=t.splitSections(i);return e.shift(),e},t.matchPrefix=function(i,e){return t.splitLines(i).filter(n=>n.indexOf(e)===0)},t.parseCandidate=function(i){let e;i.indexOf("a=candidate:")===0?e=i.substring(12).split(" "):e=i.substring(10).split(" ");const n={foundation:e[0],component:{1:"rtp",2:"rtcp"}[e[1]]||e[1],protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],address:e[4],port:parseInt(e[5],10),type:e[7]};for(let s=8;s<e.length;s+=2)switch(e[s]){case"raddr":n.relatedAddress=e[s+1];break;case"rport":n.relatedPort=parseInt(e[s+1],10);break;case"tcptype":n.tcpType=e[s+1];break;case"ufrag":n.ufrag=e[s+1],n.usernameFragment=e[s+1];break;default:n[e[s]]===void 0&&(n[e[s]]=e[s+1]);break}return n},t.writeCandidate=function(i){const e=[];e.push(i.foundation);const n=i.component;n==="rtp"?e.push(1):n==="rtcp"?e.push(2):e.push(n),e.push(i.protocol.toUpperCase()),e.push(i.priority),e.push(i.address||i.ip),e.push(i.port);const s=i.type;return e.push("typ"),e.push(s),s!=="host"&&i.relatedAddress&&i.relatedPort&&(e.push("raddr"),e.push(i.relatedAddress),e.push("rport"),e.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(e.push("tcptype"),e.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(e.push("ufrag"),e.push(i.usernameFragment||i.ufrag)),"candidate:"+e.join(" ")},t.parseIceOptions=function(i){return i.substring(14).split(" ")},t.parseRtpMap=function(i){let e=i.substring(9).split(" ");const n={payloadType:parseInt(e.shift(),10)};return e=e[0].split("/"),n.name=e[0],n.clockRate=parseInt(e[1],10),n.channels=e.length===3?parseInt(e[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(i){let e=i.payloadType;i.preferredPayloadType!==void 0&&(e=i.preferredPayloadType);const n=i.channels||i.numChannels||1;return"a=rtpmap:"+e+" "+i.name+"/"+i.clockRate+(n!==1?"/"+n:"")+`\r
`},t.parseExtmap=function(i){const e=i.substring(9).split(" ");return{id:parseInt(e[0],10),direction:e[0].indexOf("/")>0?e[0].split("/")[1]:"sendrecv",uri:e[1],attributes:e.slice(2).join(" ")}},t.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},t.parseFmtp=function(i){const e={};let n;const s=i.substring(i.indexOf(" ")+1).split(";");for(let a=0;a<s.length;a++)n=s[a].trim().split("="),e[n[0].trim()]=n[1];return e},t.writeFmtp=function(i){let e="",n=i.payloadType;if(i.preferredPayloadType!==void 0&&(n=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const s=[];Object.keys(i.parameters).forEach(a=>{i.parameters[a]!==void 0?s.push(a+"="+i.parameters[a]):s.push(a)}),e+="a=fmtp:"+n+" "+s.join(";")+`\r
`}return e},t.parseRtcpFb=function(i){const e=i.substring(i.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}},t.writeRtcpFb=function(i){let e="",n=i.payloadType;return i.preferredPayloadType!==void 0&&(n=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(s=>{e+="a=rtcp-fb:"+n+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),e},t.parseSsrcMedia=function(i){const e=i.indexOf(" "),n={ssrc:parseInt(i.substring(7,e),10)},s=i.indexOf(":",e);return s>-1?(n.attribute=i.substring(e+1,s),n.value=i.substring(s+1)):n.attribute=i.substring(e+1),n},t.parseSsrcGroup=function(i){const e=i.substring(13).split(" ");return{semantics:e.shift(),ssrcs:e.map(n=>parseInt(n,10))}},t.getMid=function(i){const e=t.matchPrefix(i,"a=mid:")[0];if(e)return e.substring(6)},t.parseFingerprint=function(i){const e=i.substring(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1].toUpperCase()}},t.getDtlsParameters=function(i,e){return{role:"auto",fingerprints:t.matchPrefix(i+e,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(i,e){let n="a=setup:"+e+`\r
`;return i.fingerprints.forEach(s=>{n+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),n},t.parseCryptoLine=function(i){const e=i.substring(9).split(" ");return{tag:parseInt(e[0],10),cryptoSuite:e[1],keyParams:e[2],sessionParams:e.slice(3)}},t.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?t.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const e=i.substring(7).split("|");return{keyMethod:"inline",keySalt:e[0],lifeTime:e[1],mkiValue:e[2]?e[2].split(":")[0]:void 0,mkiLength:e[2]?e[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},t.getCryptoParameters=function(i,e){return t.matchPrefix(i+e,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(i,e){const n=t.matchPrefix(i+e,"a=ice-ufrag:")[0],s=t.matchPrefix(i+e,"a=ice-pwd:")[0];return n&&s?{usernameFragment:n.substring(12),password:s.substring(10)}:null},t.writeIceParameters=function(i){let e="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(e+=`a=ice-lite\r
`),e},t.parseRtpParameters=function(i){const e={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=t.splitLines(i)[0].split(" ");e.profile=s[2];for(let c=3;c<s.length;c++){const l=s[c],u=t.matchPrefix(i,"a=rtpmap:"+l+" ")[0];if(u){const d=t.parseRtpMap(u),f=t.matchPrefix(i,"a=fmtp:"+l+" ");switch(d.parameters=f.length?t.parseFmtp(f[0]):{},d.rtcpFeedback=t.matchPrefix(i,"a=rtcp-fb:"+l+" ").map(t.parseRtcpFb),e.codecs.push(d),d.name.toUpperCase()){case"RED":case"ULPFEC":e.fecMechanisms.push(d.name.toUpperCase());break}}}t.matchPrefix(i,"a=extmap:").forEach(c=>{e.headerExtensions.push(t.parseExtmap(c))});const a=t.matchPrefix(i,"a=rtcp-fb:* ").map(t.parseRtcpFb);return e.codecs.forEach(c=>{a.forEach(l=>{c.rtcpFeedback.find(d=>d.type===l.type&&d.parameter===l.parameter)||c.rtcpFeedback.push(l)})}),e},t.writeRtpDescription=function(i,e){let n="";n+="m="+i+" ",n+=e.codecs.length>0?"9":"0",n+=" "+(e.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=e.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,e.codecs.forEach(a=>{n+=t.writeRtpMap(a),n+=t.writeFmtp(a),n+=t.writeRtcpFb(a)});let s=0;return e.codecs.forEach(a=>{a.maxptime>s&&(s=a.maxptime)}),s>0&&(n+="a=maxptime:"+s+`\r
`),e.headerExtensions&&e.headerExtensions.forEach(a=>{n+=t.writeExtmap(a)}),n},t.parseRtpEncodingParameters=function(i){const e=[],n=t.parseRtpParameters(i),s=n.fecMechanisms.indexOf("RED")!==-1,a=n.fecMechanisms.indexOf("ULPFEC")!==-1,c=t.matchPrefix(i,"a=ssrc:").map(h=>t.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),l=c.length>0&&c[0].ssrc;let u;const d=t.matchPrefix(i,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(m=>parseInt(m,10)));d.length>0&&d[0].length>1&&d[0][0]===l&&(u=d[0][1]),n.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let p={ssrc:l,codecPayloadType:parseInt(h.parameters.apt,10)};l&&u&&(p.rtx={ssrc:u}),e.push(p),s&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:l,mechanism:a?"red+ulpfec":"red"},e.push(p))}}),e.length===0&&l&&e.push({ssrc:l});let f=t.matchPrefix(i,"b=");return f.length&&(f[0].indexOf("b=TIAS:")===0?f=parseInt(f[0].substring(7),10):f[0].indexOf("b=AS:")===0?f=parseInt(f[0].substring(5),10)*1e3*.95-50*40*8:f=void 0,e.forEach(h=>{h.maxBitrate=f})),e},t.parseRtcpParameters=function(i){const e={},n=t.matchPrefix(i,"a=ssrc:").map(c=>t.parseSsrcMedia(c)).filter(c=>c.attribute==="cname")[0];n&&(e.cname=n.value,e.ssrc=n.ssrc);const s=t.matchPrefix(i,"a=rtcp-rsize");e.reducedSize=s.length>0,e.compound=s.length===0;const a=t.matchPrefix(i,"a=rtcp-mux");return e.mux=a.length>0,e},t.writeRtcpParameters=function(i){let e="";return i.reducedSize&&(e+=`a=rtcp-rsize\r
`),i.mux&&(e+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(e+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),e},t.parseMsid=function(i){let e;const n=t.matchPrefix(i,"a=msid:");if(n.length===1)return e=n[0].substring(7).split(" "),{stream:e[0],track:e[1]};const s=t.matchPrefix(i,"a=ssrc:").map(a=>t.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");if(s.length>0)return e=s[0].value.split(" "),{stream:e[0],track:e[1]}},t.parseSctpDescription=function(i){const e=t.parseMLine(i),n=t.matchPrefix(i,"a=max-message-size:");let s;n.length>0&&(s=parseInt(n[0].substring(19),10)),isNaN(s)&&(s=65536);const a=t.matchPrefix(i,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:e.fmt,maxMessageSize:s};const c=t.matchPrefix(i,"a=sctpmap:");if(c.length>0){const l=c[0].substring(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:s}}},t.writeSctpDescription=function(i,e){let n=[];return i.protocol!=="DTLS/SCTP"?n=["m="+i.kind+" 9 "+i.protocol+" "+e.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+e.port+`\r
`]:n=["m="+i.kind+" 9 "+i.protocol+" "+e.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+e.port+" "+e.protocol+` 65535\r
`],e.maxMessageSize!==void 0&&n.push("a=max-message-size:"+e.maxMessageSize+`\r
`),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(i,e,n){let s;const a=e!==void 0?e:2;return i?s=i:s=t.generateSessionId(),`v=0\r
o=`+(n||"thisisadapterortc")+" "+s+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(i,e){const n=t.splitLines(i);for(let s=0;s<n.length;s++)switch(n[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[s].substring(2)}return e?t.getDirection(e):"sendrecv"},t.getKind=function(i){return t.splitLines(i)[0].split(" ")[0].substring(2)},t.isRejected=function(i){return i.split(" ",2)[1]==="0"},t.parseMLine=function(i){const n=t.splitLines(i)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(i){const n=t.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const e=t.splitLines(i);for(let n=0;n<e.length;n++)if(e[n].length<2||e[n].charAt(1)!=="=")return!1;return!0},o.exports=t})(sdp$1);var sdpExports=sdp$1.exports,SDPUtils=getDefaultExportFromCjs(sdpExports),sdp=_mergeNamespaces({__proto__:null,default:SDPUtils},[sdpExports]);function shimRTCIceCandidate(o){if(!o.RTCIceCandidate||o.RTCIceCandidate&&"foundation"in o.RTCIceCandidate.prototype)return;const t=o.RTCIceCandidate;o.RTCIceCandidate=function(e){if(typeof e=="object"&&e.candidate&&e.candidate.indexOf("a=")===0&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const n=new t(e),s=SDPUtils.parseCandidate(e.candidate);for(const a in s)a in n||Object.defineProperty(n,a,{value:s[a]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},o.RTCIceCandidate.prototype=t.prototype,wrapPeerConnectionEvent(o,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new o.RTCIceCandidate(i.candidate),writable:"false"}),i))}function shimRTCIceCandidateRelayProtocol(o){!o.RTCIceCandidate||o.RTCIceCandidate&&"relayProtocol"in o.RTCIceCandidate.prototype||wrapPeerConnectionEvent(o,"icecandidate",t=>{if(t.candidate){const i=SDPUtils.parseCandidate(t.candidate.candidate);i.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return t})}function shimMaxMessageSize(o,t){if(!o.RTCPeerConnection)return;"sctp"in o.RTCPeerConnection.prototype||Object.defineProperty(o.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const i=function(c){if(!c||!c.sdp)return!1;const l=SDPUtils.splitSections(c.sdp);return l.shift(),l.some(u=>{const d=SDPUtils.parseMLine(u);return d&&d.kind==="application"&&d.protocol.indexOf("SCTP")!==-1})},e=function(c){const l=c.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const u=parseInt(l[1],10);return u!==u?-1:u},n=function(c){let l=65536;return t.browser==="firefox"&&(t.version<57?c===-1?l=16384:l=2147483637:t.version<60?l=t.version===57?65535:65536:l=2147483637),l},s=function(c,l){let u=65536;t.browser==="firefox"&&t.version===57&&(u=65535);const d=SDPUtils.matchPrefix(c.sdp,"a=max-message-size:");return d.length>0?u=parseInt(d[0].substring(19),10):t.browser==="firefox"&&l!==-1&&(u=2147483637),u},a=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const l=e(arguments[0]),u=n(l),d=s(arguments[0],l);let f;u===0&&d===0?f=Number.POSITIVE_INFINITY:u===0||d===0?f=Math.max(u,d):f=Math.min(u,d);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return f}}),this._sctp=h}return a.apply(this,arguments)}}function shimSendThrowTypeError(o){if(!(o.RTCPeerConnection&&"createDataChannel"in o.RTCPeerConnection.prototype))return;function t(e,n){const s=e.send;e.send=function(){const c=arguments[0],l=c.length||c.size||c.byteLength;if(e.readyState==="open"&&n.sctp&&l>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return s.apply(e,arguments)}}const i=o.RTCPeerConnection.prototype.createDataChannel;o.RTCPeerConnection.prototype.createDataChannel=function(){const n=i.apply(this,arguments);return t(n,this),n},wrapPeerConnectionEvent(o,"datachannel",e=>(t(e.channel,e.target),e))}function shimConnectionState(o){if(!o.RTCPeerConnection||"connectionState"in o.RTCPeerConnection.prototype)return;const t=o.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const e=t[i];t[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=n=>{const s=n.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const a=new Event("connectionstatechange",n);s.dispatchEvent(a)}return n},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),e.apply(this,arguments)}})}function removeExtmapAllowMixed(o,t){if(!o.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const i=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=n.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);o.RTCSessionDescription&&n instanceof o.RTCSessionDescription?arguments[0]=new o.RTCSessionDescription({type:n.type,sdp:s}):n.sdp=s}return i.apply(this,arguments)}}function shimAddIceCandidateNullOrEmpty(o,t){if(!(o.RTCPeerConnection&&o.RTCPeerConnection.prototype))return;const i=o.RTCPeerConnection.prototype.addIceCandidate;!i||i.length===0||(o.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function shimParameterlessSetLocalDescription(o,t){if(!(o.RTCPeerConnection&&o.RTCPeerConnection.prototype))return;const i=o.RTCPeerConnection.prototype.setLocalDescription;!i||i.length===0||(o.RTCPeerConnection.prototype.setLocalDescription=function(){let n=arguments[0]||{};if(typeof n!="object"||n.type&&n.sdp)return i.apply(this,arguments);if(n={type:n.type,sdp:n.sdp},!n.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":n.type="offer";break;default:n.type="answer";break}return n.sdp||n.type!=="offer"&&n.type!=="answer"?i.apply(this,[n]):(n.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>i.apply(this,[a]))})}var commonShim=Object.freeze({__proto__:null,removeExtmapAllowMixed,shimAddIceCandidateNullOrEmpty,shimConnectionState,shimMaxMessageSize,shimParameterlessSetLocalDescription,shimRTCIceCandidate,shimRTCIceCandidateRelayProtocol,shimSendThrowTypeError});function adapterFactory(){let{window:o}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=log,e=detectBrowser(o),n={browserDetails:e,commonShim,extractVersion,disableLog,disableWarnings,sdp};switch(e.browser){case"chrome":if(!chromeShim||!shimPeerConnection$1||!t.shimChrome)return i("Chrome shim is not included in this adapter release."),n;if(e.version===null)return i("Chrome shim can not determine version, not shimming."),n;i("adapter.js shimming chrome."),n.browserShim=chromeShim,shimAddIceCandidateNullOrEmpty(o,e),shimParameterlessSetLocalDescription(o),shimGetUserMedia$2(o,e),shimMediaStream(o),shimPeerConnection$1(o,e),shimOnTrack$1(o),shimAddTrackRemoveTrack(o,e),shimGetSendersWithDtmf(o),shimSenderReceiverGetStats(o),fixNegotiationNeeded(o,e),shimRTCIceCandidate(o),shimRTCIceCandidateRelayProtocol(o),shimConnectionState(o),shimMaxMessageSize(o,e),shimSendThrowTypeError(o),removeExtmapAllowMixed(o,e);break;case"firefox":if(!firefoxShim||!shimPeerConnection||!t.shimFirefox)return i("Firefox shim is not included in this adapter release."),n;i("adapter.js shimming firefox."),n.browserShim=firefoxShim,shimAddIceCandidateNullOrEmpty(o,e),shimParameterlessSetLocalDescription(o),shimGetUserMedia$1(o,e),shimPeerConnection(o,e),shimOnTrack(o),shimRemoveStream(o),shimSenderGetStats(o),shimReceiverGetStats(o),shimRTCDataChannel(o),shimAddTransceiver(o),shimGetParameters(o),shimCreateOffer(o),shimCreateAnswer(o),shimRTCIceCandidate(o),shimConnectionState(o),shimMaxMessageSize(o,e),shimSendThrowTypeError(o);break;case"safari":if(!safariShim||!t.shimSafari)return i("Safari shim is not included in this adapter release."),n;i("adapter.js shimming safari."),n.browserShim=safariShim,shimAddIceCandidateNullOrEmpty(o,e),shimParameterlessSetLocalDescription(o),shimRTCIceServerUrls(o),shimCreateOfferLegacy(o),shimCallbacksAPI(o),shimLocalStreamsAPI(o),shimRemoteStreamsAPI(o),shimTrackEventTransceiver(o),shimGetUserMedia(o),shimAudioContext(o),shimRTCIceCandidate(o),shimRTCIceCandidateRelayProtocol(o),shimMaxMessageSize(o,e),shimSendThrowTypeError(o),removeExtmapAllowMixed(o,e);break;default:i("Unsupported browser!");break}return n}adapterFactory({window:typeof window>"u"?void 0:window});const DECRYPTION_FAILURE_TOLERANCE=10,E2EE_FLAG="lk_e2ee",SALT="LKFrameEncryptionKey",KEY_PROVIDER_DEFAULTS={sharedKey:!1,ratchetSalt:SALT,ratchetWindowSize:8,failureTolerance:DECRYPTION_FAILURE_TOLERANCE,keyringSize:16};var KeyProviderEvent;(function(o){o.SetKey="setKey",o.RatchetRequest="ratchetRequest",o.KeyRatcheted="keyRatcheted"})(KeyProviderEvent||(KeyProviderEvent={}));var KeyHandlerEvent;(function(o){o.KeyRatcheted="keyRatcheted"})(KeyHandlerEvent||(KeyHandlerEvent={}));var EncryptionEvent;(function(o){o.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",o.EncryptionError="encryptionError"})(EncryptionEvent||(EncryptionEvent={}));var CryptorEvent;(function(o){o.Error="cryptorError"})(CryptorEvent||(CryptorEvent={}));function isE2EESupported(){return isInsertableStreamSupported()||isScriptTransformSupported()}function isScriptTransformSupported(){return typeof window.RTCRtpScriptTransform<"u"}function isInsertableStreamSupported(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}class BaseKeyProvider extends eventsExports.EventEmitter{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(i,e)=>{livekitLogger.debug("key ratcheted event received",{material:i,keyIndex:e})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},KEY_PROVIDER_DEFAULTS),t),this.on(KeyProviderEvent.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(t,i,e){const n={key:t,participantIdentity:i,keyIndex:e};if(!this.options.sharedKey&&!i)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(i??"shared","-").concat(e??0),n),this.emit(KeyProviderEvent.SetKey,n)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(t,i){this.emit(KeyProviderEvent.RatchetRequest,t,i)}}class LivekitError extends Error{constructor(t,i){super(i||"an error has occured"),this.code=t}}class ConnectionError extends LivekitError{constructor(t,i,e){super(1,t),this.status=e,this.reason=i}}class DeviceUnsupportedError extends LivekitError{constructor(t){super(21,t??"device is unsupported")}}class TrackInvalidError extends LivekitError{constructor(t){super(20,t??"track is invalid")}}class UnsupportedServer extends LivekitError{constructor(t){super(10,t??"unsupported server")}}class UnexpectedConnectionState extends LivekitError{constructor(t){super(12,t??"unexpected connection state")}}class NegotiationError extends LivekitError{constructor(t){super(13,t??"unable to negotiate")}}class SignalRequestError extends LivekitError{constructor(t,i){super(15,t),this.reason=i}}var MediaDeviceFailure;(function(o){o.PermissionDenied="PermissionDenied",o.NotFound="NotFound",o.DeviceInUse="DeviceInUse",o.Other="Other"})(MediaDeviceFailure||(MediaDeviceFailure={}));(function(o){function t(i){if(i&&"name"in i)return i.name==="NotFoundError"||i.name==="DevicesNotFoundError"?o.NotFound:i.name==="NotAllowedError"||i.name==="PermissionDeniedError"?o.PermissionDenied:i.name==="NotReadableError"||i.name==="TrackStartError"?o.DeviceInUse:o.Other}o.getFailure=t})(MediaDeviceFailure||(MediaDeviceFailure={}));var CryptorErrorReason;(function(o){o[o.InvalidKey=0]="InvalidKey",o[o.MissingKey=1]="MissingKey",o[o.InternalError=2]="InternalError"})(CryptorErrorReason||(CryptorErrorReason={}));var RoomEvent;(function(o){o.Connected="connected",o.Reconnecting="reconnecting",o.SignalReconnecting="signalReconnecting",o.Reconnected="reconnected",o.Disconnected="disconnected",o.ConnectionStateChanged="connectionStateChanged",o.MediaDevicesChanged="mediaDevicesChanged",o.ParticipantConnected="participantConnected",o.ParticipantDisconnected="participantDisconnected",o.TrackPublished="trackPublished",o.TrackSubscribed="trackSubscribed",o.TrackSubscriptionFailed="trackSubscriptionFailed",o.TrackUnpublished="trackUnpublished",o.TrackUnsubscribed="trackUnsubscribed",o.TrackMuted="trackMuted",o.TrackUnmuted="trackUnmuted",o.LocalTrackPublished="localTrackPublished",o.LocalTrackUnpublished="localTrackUnpublished",o.LocalAudioSilenceDetected="localAudioSilenceDetected",o.ActiveSpeakersChanged="activeSpeakersChanged",o.ParticipantMetadataChanged="participantMetadataChanged",o.ParticipantNameChanged="participantNameChanged",o.ParticipantAttributesChanged="participantAttributesChanged",o.RoomMetadataChanged="roomMetadataChanged",o.DataReceived="dataReceived",o.SipDTMFReceived="sipDTMFReceived",o.TranscriptionReceived="transcriptionReceived",o.ConnectionQualityChanged="connectionQualityChanged",o.TrackStreamStateChanged="trackStreamStateChanged",o.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",o.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",o.AudioPlaybackStatusChanged="audioPlaybackChanged",o.VideoPlaybackStatusChanged="videoPlaybackChanged",o.MediaDevicesError="mediaDevicesError",o.ParticipantPermissionsChanged="participantPermissionsChanged",o.SignalConnected="signalConnected",o.RecordingStatusChanged="recordingStatusChanged",o.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",o.EncryptionError="encryptionError",o.DCBufferStatusChanged="dcBufferStatusChanged",o.ActiveDeviceChanged="activeDeviceChanged"})(RoomEvent||(RoomEvent={}));var ParticipantEvent;(function(o){o.TrackPublished="trackPublished",o.TrackSubscribed="trackSubscribed",o.TrackSubscriptionFailed="trackSubscriptionFailed",o.TrackUnpublished="trackUnpublished",o.TrackUnsubscribed="trackUnsubscribed",o.TrackMuted="trackMuted",o.TrackUnmuted="trackUnmuted",o.LocalTrackPublished="localTrackPublished",o.LocalTrackUnpublished="localTrackUnpublished",o.ParticipantMetadataChanged="participantMetadataChanged",o.ParticipantNameChanged="participantNameChanged",o.DataReceived="dataReceived",o.SipDTMFReceived="sipDTMFReceived",o.TranscriptionReceived="transcriptionReceived",o.IsSpeakingChanged="isSpeakingChanged",o.ConnectionQualityChanged="connectionQualityChanged",o.TrackStreamStateChanged="trackStreamStateChanged",o.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",o.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",o.MediaDevicesError="mediaDevicesError",o.AudioStreamAcquired="audioStreamAcquired",o.ParticipantPermissionsChanged="participantPermissionsChanged",o.PCTrackAdded="pcTrackAdded",o.AttributesChanged="attributesChanged"})(ParticipantEvent||(ParticipantEvent={}));var EngineEvent;(function(o){o.TransportsCreated="transportsCreated",o.Connected="connected",o.Disconnected="disconnected",o.Resuming="resuming",o.Resumed="resumed",o.Restarting="restarting",o.Restarted="restarted",o.SignalResumed="signalResumed",o.SignalRestarted="signalRestarted",o.Closing="closing",o.MediaTrackAdded="mediaTrackAdded",o.ActiveSpeakersUpdate="activeSpeakersUpdate",o.DataPacketReceived="dataPacketReceived",o.RTPVideoMapUpdate="rtpVideoMapUpdate",o.DCBufferStatusChanged="dcBufferStatusChanged",o.ParticipantUpdate="participantUpdate",o.RoomUpdate="roomUpdate",o.SpeakersChanged="speakersChanged",o.StreamStateChanged="streamStateChanged",o.ConnectionQualityUpdate="connectionQualityUpdate",o.SubscriptionError="subscriptionError",o.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",o.RemoteMute="remoteMute",o.SubscribedQualityUpdate="subscribedQualityUpdate",o.LocalTrackUnpublished="localTrackUnpublished",o.LocalTrackSubscribed="localTrackSubscribed",o.Offline="offline",o.SignalRequestResponse="signalRequestResponse"})(EngineEvent||(EngineEvent={}));var TrackEvent;(function(o){o.Message="message",o.Muted="muted",o.Unmuted="unmuted",o.Restarted="restarted",o.Ended="ended",o.Subscribed="subscribed",o.Unsubscribed="unsubscribed",o.UpdateSettings="updateSettings",o.UpdateSubscription="updateSubscription",o.AudioPlaybackStarted="audioPlaybackStarted",o.AudioPlaybackFailed="audioPlaybackFailed",o.AudioSilenceDetected="audioSilenceDetected",o.VisibilityChanged="visibilityChanged",o.VideoDimensionsChanged="videoDimensionsChanged",o.VideoPlaybackStarted="videoPlaybackStarted",o.VideoPlaybackFailed="videoPlaybackFailed",o.ElementAttached="elementAttached",o.ElementDetached="elementDetached",o.UpstreamPaused="upstreamPaused",o.UpstreamResumed="upstreamResumed",o.SubscriptionPermissionChanged="subscriptionPermissionChanged",o.SubscriptionStatusChanged="subscriptionStatusChanged",o.SubscriptionFailed="subscriptionFailed",o.TrackProcessorUpdate="trackProcessorUpdate",o.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",o.TranscriptionReceived="transcriptionReceived",o.TimeSyncUpdate="timeSyncUpdate"})(TrackEvent||(TrackEvent={}));function r(o,t,i){var e,n,s;t===void 0&&(t=50),i===void 0&&(i={});var a=(e=i.isImmediate)!=null&&e,c=(n=i.callback)!=null&&n,l=i.maxWait,u=Date.now(),d=[];function f(){if(l!==void 0){var p=Date.now()-u;if(p+t>=l)return l-p}return t}var h=function(){var p=[].slice.call(arguments),m=this;return new Promise(function(g,v){var T=a&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,u=Date.now(),!a){var _=o.apply(m,p);c&&c(_),d.forEach(function(y){return(0,y.resolve)(_)}),d=[]}},f()),T){var b=o.apply(m,p);return c&&c(b),g(b)}d.push({resolve:g,reject:v})})};return h.cancel=function(p){s!==void 0&&clearTimeout(s),d.forEach(function(m){return(0,m.reject)(p)}),d=[]},h}const commonVersionIdentifier=/version\/(\d+(\.?_?\d+)+)/i;let browserDetails;function getBrowser(o){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof o>"u"&&typeof navigator>"u")return;const i=(o??navigator.userAgent).toLowerCase();if(browserDetails===void 0||t){const e=browsersList.find(n=>{let{test:s}=n;return s.test(i)});browserDetails=e==null?void 0:e.describe(i)}return browserDetails}const browsersList=[{test:/firefox|iceweasel|fxios/i,describe(o){return{name:"Firefox",version:getMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,o),os:o.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:getOSVersion(o)}}},{test:/chrom|crios|crmo/i,describe(o){return{name:"Chrome",version:getMatch(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,o),os:o.toLowerCase().includes("crios")?"iOS":void 0,osVersion:getOSVersion(o)}}},{test:/safari|applewebkit/i,describe(o){return{name:"Safari",version:getMatch(commonVersionIdentifier,o),os:o.includes("mobile/")?"iOS":"macOS",osVersion:getOSVersion(o)}}}];function getMatch(o,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const e=t.match(o);return e&&e.length>=i&&e[i]||""}function getOSVersion(o){return o.includes("mac os")?getMatch(/\(.+?(\d+_\d+(:?_\d+)?)/,o,1).replace(/_/g,"."):void 0}var version$1="2.5.0";const version=version$1,protocolVersion=15;class CriticalTimers{}CriticalTimers.setTimeout=function(){return setTimeout(...arguments)};CriticalTimers.setInterval=function(){return setInterval(...arguments)};CriticalTimers.clearTimeout=function(){return clearTimeout(...arguments)};CriticalTimers.clearInterval=function(){return clearInterval(...arguments)};class VideoPreset{constructor(t,i,e,n,s){if(typeof t=="object")this.width=t.width,this.height=t.height,this.aspectRatio=t.aspectRatio,this.encoding={maxBitrate:t.maxBitrate,maxFramerate:t.maxFramerate,priority:t.priority};else if(i!==void 0&&e!==void 0)this.width=t,this.height=i,this.aspectRatio=t/i,this.encoding={maxBitrate:e,maxFramerate:n,priority:s};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const backupCodecs=["vp8","h264"],videoCodecs=["vp8","h264","vp9","av1"];function isBackupCodec(o){return!!backupCodecs.find(t=>t===o)}var AudioPresets;(function(o){o.telephone={maxBitrate:12e3},o.speech={maxBitrate:2e4},o.music={maxBitrate:32e3},o.musicStereo={maxBitrate:48e3},o.musicHighQuality={maxBitrate:64e3},o.musicHighQualityStereo={maxBitrate:96e3}})(AudioPresets||(AudioPresets={}));const VideoPresets={h90:new VideoPreset(160,90,9e4,20),h180:new VideoPreset(320,180,16e4,20),h216:new VideoPreset(384,216,18e4,20),h360:new VideoPreset(640,360,45e4,20),h540:new VideoPreset(960,540,8e5,25),h720:new VideoPreset(1280,720,17e5,30),h1080:new VideoPreset(1920,1080,3e6,30),h1440:new VideoPreset(2560,1440,5e6,30),h2160:new VideoPreset(3840,2160,8e6,30)},VideoPresets43={h120:new VideoPreset(160,120,7e4,20),h180:new VideoPreset(240,180,125e3,20),h240:new VideoPreset(320,240,14e4,20),h360:new VideoPreset(480,360,33e4,20),h480:new VideoPreset(640,480,5e5,20),h540:new VideoPreset(720,540,6e5,25),h720:new VideoPreset(960,720,13e5,30),h1080:new VideoPreset(1440,1080,23e5,30),h1440:new VideoPreset(1920,1440,38e5,30)},ScreenSharePresets={h360fps3:new VideoPreset(640,360,2e5,3,"medium"),h360fps15:new VideoPreset(640,360,4e5,15,"medium"),h720fps5:new VideoPreset(1280,720,8e5,5,"medium"),h720fps15:new VideoPreset(1280,720,15e5,15,"medium"),h720fps30:new VideoPreset(1280,720,2e6,30,"medium"),h1080fps15:new VideoPreset(1920,1080,25e5,15,"medium"),h1080fps30:new VideoPreset(1920,1080,5e6,30,"medium"),original:new VideoPreset(0,0,7e6,30,"medium")};function cloneDeep(o){if(!(typeof o>"u"))return typeof structuredClone=="function"?structuredClone(o):JSON.parse(JSON.stringify(o))}const BACKGROUND_REACTION_DELAY=5e3,recycledElements=[];var VideoQuality;(function(o){o[o.LOW=0]="LOW",o[o.MEDIUM=1]="MEDIUM",o[o.HIGH=2]="HIGH"})(VideoQuality||(VideoQuality={}));class Track extends eventsExports.EventEmitter{constructor(t,i){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var n;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=Track.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=livekitLogger,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),BACKGROUND_REACTION_DELAY):this.handleAppVisibilityChanged()},this.log=getLogger((n=e.loggerName)!==null&&n!==void 0?n:LoggerNames.Track),this.loggerContextCb=e.loggerContextCb,this.setMaxListeners(100),this.kind=i,this._mediaStreamTrack=t,this._mediaStreamID=t.id,this.source=Track.Source.Unknown}get logContext(){var t;return Object.assign(Object.assign({},(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this)),getLogContextFromTrack(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(t){let i="audio";this.kind===Track.Kind.Video&&(i="video"),this.attachedElements.length===0&&this.kind===Track.Kind.Video&&this.addAppVisibilityListener(),t||(i==="audio"&&(recycledElements.forEach(s=>{s.parentElement===null&&!t&&(t=s)}),t&&recycledElements.splice(recycledElements.indexOf(t),1)),t||(t=document.createElement(i))),this.attachedElements.includes(t)||this.attachedElements.push(t),attachToElement(this.mediaStreamTrack,t);const e=t.srcObject.getTracks(),n=e.some(s=>s.kind==="audio");return t.play().then(()=>{this.emit(n?TrackEvent.AudioPlaybackStarted:TrackEvent.VideoPlaybackStarted)}).catch(s=>{s.name==="NotAllowedError"?this.emit(n?TrackEvent.AudioPlaybackFailed:TrackEvent.VideoPlaybackFailed,s):s.name==="AbortError"?livekitLogger.debug("".concat(n?"audio":"video"," playback aborted, likely due to new play request")):livekitLogger.warn("could not playback ".concat(n?"audio":"video"),s),n&&t&&e.some(a=>a.kind==="video")&&s.name==="NotAllowedError"&&(t.muted=!0,t.play().catch(()=>{}))}),this.emit(TrackEvent.ElementAttached,t),t}detach(t){try{if(t){detachTrack(this.mediaStreamTrack,t);const e=this.attachedElements.indexOf(t);return e>=0&&(this.attachedElements.splice(e,1),this.recycleElement(t),this.emit(TrackEvent.ElementDetached,t)),t}const i=[];return this.attachedElements.forEach(e=>{detachTrack(this.mediaStreamTrack,e),i.push(e),this.recycleElement(e),this.emit(TrackEvent.ElementDetached,e)}),this.attachedElements=[],i}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(t){t.loggerName&&(this.log=getLogger(t.loggerName)),t.loggerContextCb&&(this.loggerContextCb=t.loggerContextCb)}recycleElement(t){if(t instanceof HTMLAudioElement){let i=!0;t.pause(),recycledElements.forEach(e=>{e.parentElement||(i=!1)}),i&&recycledElements.push(t)}}handleAppVisibilityChanged(){return __awaiter(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===Track.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(t=>t.play().catch(()=>{})),0)})}addAppVisibilityListener(){isWeb()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){isWeb()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function attachToElement(o,t){let i;t.srcObject instanceof MediaStream?i=t.srcObject:i=new MediaStream;let e;o.kind==="audio"?e=i.getAudioTracks():e=i.getVideoTracks(),e.includes(o)||(e.forEach(n=>{i.removeTrack(n)}),i.addTrack(o)),(!isSafari()||!(t instanceof HTMLVideoElement))&&(t.autoplay=!0),t.muted=i.getAudioTracks().length===0,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==i&&(t.srcObject=i,(isSafari()||isFireFox())&&t instanceof HTMLVideoElement&&setTimeout(()=>{t.srcObject=i,t.play().catch(()=>{})},0))}function detachTrack(o,t){if(t.srcObject instanceof MediaStream){const i=t.srcObject;i.removeTrack(o),i.getTracks().length>0?t.srcObject=i:t.srcObject=null}}(function(o){let t;(function(u){u.Audio="audio",u.Video="video",u.Unknown="unknown"})(t=o.Kind||(o.Kind={}));let i;(function(u){u.Camera="camera",u.Microphone="microphone",u.ScreenShare="screen_share",u.ScreenShareAudio="screen_share_audio",u.Unknown="unknown"})(i=o.Source||(o.Source={}));let e;(function(u){u.Active="active",u.Paused="paused",u.Unknown="unknown"})(e=o.StreamState||(o.StreamState={}));function n(u){switch(u){case t.Audio:return TrackType.AUDIO;case t.Video:return TrackType.VIDEO;default:return TrackType.DATA}}o.kindToProto=n;function s(u){switch(u){case TrackType.AUDIO:return t.Audio;case TrackType.VIDEO:return t.Video;default:return t.Unknown}}o.kindFromProto=s;function a(u){switch(u){case i.Camera:return TrackSource.CAMERA;case i.Microphone:return TrackSource.MICROPHONE;case i.ScreenShare:return TrackSource.SCREEN_SHARE;case i.ScreenShareAudio:return TrackSource.SCREEN_SHARE_AUDIO;default:return TrackSource.UNKNOWN}}o.sourceToProto=a;function c(u){switch(u){case TrackSource.CAMERA:return i.Camera;case TrackSource.MICROPHONE:return i.Microphone;case TrackSource.SCREEN_SHARE:return i.ScreenShare;case TrackSource.SCREEN_SHARE_AUDIO:return i.ScreenShareAudio;default:return i.Unknown}}o.sourceFromProto=c;function l(u){switch(u){case StreamState.ACTIVE:return e.Active;case StreamState.PAUSED:return e.Paused;default:return e.Unknown}}o.streamStateFromProto=l})(Track||(Track={}));function mergeDefaultOptions(o,t,i){var e;const n=(e=cloneDeep(o))!==null&&e!==void 0?e:{};return n.audio===!0&&(n.audio={}),n.video===!0&&(n.video={}),n.audio&&mergeObjectWithoutOverwriting(n.audio,t),n.video&&mergeObjectWithoutOverwriting(n.video,i),n}function mergeObjectWithoutOverwriting(o,t){return Object.keys(t).forEach(i=>{o[i]===void 0&&(o[i]=t[i])}),o}function constraintsForOptions(o){const t={};if(o.video)if(typeof o.video=="object"){const i={},e=i,n=o.video;Object.keys(n).forEach(s=>{switch(s){case"resolution":mergeObjectWithoutOverwriting(e,n.resolution);break;default:e[s]=n[s]}}),t.video=i}else t.video=o.video;else t.video=!1;return o.audio?typeof o.audio=="object"?t.audio=o.audio:t.audio=!0:t.audio=!1,t}function detectSilence(o){return __awaiter(this,arguments,void 0,function(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const e=getNewAudioContext();if(e){const n=e.createAnalyser();n.fftSize=2048;const s=n.frequencyBinCount,a=new Uint8Array(s);e.createMediaStreamSource(new MediaStream([t.mediaStreamTrack])).connect(n),yield sleep(i),n.getByteTimeDomainData(a);const l=a.some(u=>u!==128&&u!==0);return e.close(),!l}return!1}()})}function getNewAudioContext(){const o=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(o)return new o({latencyHint:"interactive"})}function sourceToKind(o){return o===Track.Source.Microphone?"audioinput":o===Track.Source.Camera?"videoinput":void 0}function screenCaptureToDisplayMediaStreamOptions(o){var t,i;let e=(t=o.video)!==null&&t!==void 0?t:!0;return o.resolution&&o.resolution.width>0&&o.resolution.height>0&&(e=typeof e=="boolean"?{}:e,isSafari()?e=Object.assign(Object.assign({},e),{width:{max:o.resolution.width},height:{max:o.resolution.height},frameRate:o.resolution.frameRate}):e=Object.assign(Object.assign({},e),{width:{ideal:o.resolution.width},height:{ideal:o.resolution.height},frameRate:o.resolution.frameRate})),{audio:(i=o.audio)!==null&&i!==void 0?i:!1,video:e,controller:o.controller,selfBrowserSurface:o.selfBrowserSurface,surfaceSwitching:o.surfaceSwitching,systemAudio:o.systemAudio,preferCurrentTab:o.preferCurrentTab}}function mimeTypeToVideoCodecString(o){const t=o.split("/")[1].toLowerCase();if(!videoCodecs.includes(t))throw Error("Video codec not supported: ".concat(t));return t}function getTrackPublicationInfo(o){const t=[];return o.forEach(i=>{i.track!==void 0&&t.push(new TrackPublishedResponse({cid:i.track.mediaStreamID,track:i.trackInfo}))}),t}function getLogContextFromTrack(o){return o instanceof Track?{trackID:o.sid,source:o.source,muted:o.isMuted,enabled:o.mediaStreamTrack.enabled,kind:o.kind,streamID:o.mediaStreamID,streamTrackID:o.mediaStreamTrack.id}:{trackID:o.trackSid,enabled:o.isEnabled,muted:o.isMuted,trackInfo:Object.assign({mimeType:o.mimeType,name:o.trackName,encrypted:o.isEncrypted,kind:o.kind,source:o.source},o.track?getLogContextFromTrack(o.track):{})}}function supportsSynchronizationSources(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function diffAttributes(o,t){var i;o===void 0&&(o={}),t===void 0&&(t={});const e=[...Object.keys(t),...Object.keys(o)],n={};for(const s of e)o[s]!==t[s]&&(n[s]=(i=t[s])!==null&&i!==void 0?i:"");return n}const separator="|",ddExtensionURI="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function unpackStreamId(o){const t=o.split(separator);return t.length>1?[t[0],o.substr(t[0].length+1)]:[o,""]}function sleep(o){return __awaiter(this,void 0,void 0,function*(){return new Promise(t=>CriticalTimers.setTimeout(t,o))})}function supportsTransceiver(){return"addTransceiver"in RTCPeerConnection.prototype}function supportsAddTrack(){return"addTrack"in RTCPeerConnection.prototype}function supportsAV1(){if(!("getCapabilities"in RTCRtpSender)||isSafari())return!1;const o=RTCRtpSender.getCapabilities("video");let t=!1;if(o){for(const i of o.codecs)if(i.mimeType==="video/AV1"){t=!0;break}}return t}function supportsVP9(){if(!("getCapabilities"in RTCRtpSender)||isFireFox())return!1;if(isSafari()){const i=getBrowser();if(i!=null&&i.version&&compareVersions(i.version,"16")<0)return!1}const o=RTCRtpSender.getCapabilities("video");let t=!1;if(o){for(const i of o.codecs)if(i.mimeType==="video/VP9"){t=!0;break}}return t}function isSVCCodec(o){return o==="av1"||o==="vp9"}function supportsSetSinkId(o){return document?(o||(o=document.createElement("audio")),"setSinkId"in o):!1}function isBrowserSupported(){return typeof RTCPeerConnection>"u"?!1:supportsTransceiver()||supportsAddTrack()}function isFireFox(){var o;return((o=getBrowser())===null||o===void 0?void 0:o.name)==="Firefox"}function isSafari(){var o;return((o=getBrowser())===null||o===void 0?void 0:o.name)==="Safari"}function isSafari17(){const o=getBrowser();return(o==null?void 0:o.name)==="Safari"&&o.version.startsWith("17.")}function isMobile(){var o,t;return isWeb()?(t=(o=navigator.userAgentData)===null||o===void 0?void 0:o.mobile)!==null&&t!==void 0?t:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function isE2EESimulcastSupported(){const o=getBrowser(),t="17.2";if(o)return o.name!=="Safari"&&o.os!=="iOS"||o.os==="iOS"&&o.osVersion&&compareVersions(t,o.osVersion)>=0?!0:o.name==="Safari"&&compareVersions(t,o.version)>=0}function isWeb(){return typeof document<"u"}function isReactNative(){return navigator.product=="ReactNative"}function isCloud(o){return o.hostname.endsWith(".livekit.cloud")||o.hostname.endsWith(".livekit.run")}function getLKReactNativeInfo(){if(dist.global&&dist.global.LiveKitReactNativeGlobal)return dist.global.LiveKitReactNativeGlobal}function getReactNativeOs(){if(!isReactNative())return;let o=getLKReactNativeInfo();if(o)return o.platform}function getDevicePixelRatio(){if(isWeb())return window.devicePixelRatio;if(isReactNative()){let o=getLKReactNativeInfo();if(o)return o.devicePixelRatio}return 1}function compareVersions(o,t){const i=o.split("."),e=t.split("."),n=Math.min(i.length,e.length);for(let s=0;s<n;++s){const a=parseInt(i[s],10),c=parseInt(e[s],10);if(a>c)return 1;if(a<c)return-1;if(s===n-1&&a===c)return 0}return o===""&&t!==""?-1:t===""?1:i.length==e.length?0:i.length<e.length?-1:1}function roDispatchCallback(o){for(const t of o)t.target.handleResize(t)}function ioDispatchCallback(o){for(const t of o)t.target.handleVisibilityChanged(t)}let resizeObserver=null;const getResizeObserver=()=>(resizeObserver||(resizeObserver=new ResizeObserver(roDispatchCallback)),resizeObserver);let intersectionObserver=null;const getIntersectionObserver=()=>(intersectionObserver||(intersectionObserver=new IntersectionObserver(ioDispatchCallback,{root:null,rootMargin:"0px"})),intersectionObserver);function getClientInfo(){var o;const t=new ClientInfo({sdk:ClientInfo_SDK.JS,protocol:protocolVersion,version});return isReactNative()&&(t.os=(o=getReactNativeOs())!==null&&o!==void 0?o:""),t}function createDummyVideoStreamTrack(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,e=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const n=document.createElement("canvas");n.width=o,n.height=t;const s=n.getContext("2d");s==null||s.fillRect(0,0,n.width,n.height),e&&s&&(s.beginPath(),s.arc(o/2,t/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const a=n.captureStream(),[c]=a.getTracks();if(!c)throw Error("Could not get empty media stream video track");return c.enabled=i,c}let emptyAudioStreamTrack;function getEmptyAudioStreamTrack(){if(!emptyAudioStreamTrack){const o=new AudioContext,t=o.createOscillator(),i=o.createGain();i.gain.setValueAtTime(0,0);const e=o.createMediaStreamDestination();if(t.connect(i),i.connect(e),t.start(),[emptyAudioStreamTrack]=e.stream.getAudioTracks(),!emptyAudioStreamTrack)throw Error("Could not get empty media stream audio track");emptyAudioStreamTrack.enabled=!1}return emptyAudioStreamTrack.clone()}class Future{constructor(t,i){this.onFinally=i,this.promise=new Promise((e,n)=>__awaiter(this,void 0,void 0,function*(){this.resolve=e,this.reject=n,t&&(yield t(e,n))})).finally(()=>{var e;return(e=this.onFinally)===null||e===void 0?void 0:e.call(this)})}}class Mutex{constructor(){this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let t;const i=new Promise(n=>t=()=>{this._locks-=1,n()}),e=this._locking.then(()=>t);return this._locking=this._locking.then(()=>i),e}}function isVideoCodec(o){return videoCodecs.includes(o)}function unwrapConstraint(o){if(typeof o=="string"||typeof o=="number")return o;if(Array.isArray(o))return o[0];if(o.exact)return Array.isArray(o.exact)?o.exact[0]:o.exact;if(o.ideal)return Array.isArray(o.ideal)?o.ideal[0]:o.ideal;throw Error("could not unwrap constraint")}function toWebsocketUrl(o){return o.startsWith("http")?o.replace(/^(http)/,"ws"):o}function toHttpUrl(o){return o.startsWith("ws")?o.replace(/^(ws)/,"http"):o}function extractTranscriptionSegments(o){return o.segments.map(t=>{let{id:i,text:e,language:n,startTime:s,endTime:a,final:c}=t;return{id:i,text:e,startTime:Number.parseInt(s.toString()),endTime:Number.parseInt(a.toString()),final:c,language:n}})}const defaultId="default";class DeviceManager{static getInstance(){return this.instance===void 0&&(this.instance=new DeviceManager),this.instance}getDevices(t){return __awaiter(this,arguments,void 0,function(i){var e=this;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;if(((s=DeviceManager.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){livekitLogger.debug("awaiting getUserMedia promise");try{i?yield DeviceManager.userMediaPromiseMap.get(i):yield Promise.all(DeviceManager.userMediaPromiseMap.values())}catch{livekitLogger.warn("error waiting for media permissons")}}let a=yield navigator.mediaDevices.enumerateDevices();if(n&&!(isSafari()&&e.hasDeviceInUse(i))&&(a.filter(l=>l.kind===i).length===0||a.some(l=>{const u=l.label==="",d=i?l.kind===i:!0;return u&&d}))){const l={video:i!=="audioinput"&&i!=="audiooutput",audio:i!=="videoinput"},u=yield navigator.mediaDevices.getUserMedia(l);a=yield navigator.mediaDevices.enumerateDevices(),u.getTracks().forEach(d=>{d.stop()})}return i&&(a=a.filter(c=>c.kind===i)),a}()})}normalizeDeviceId(t,i,e){return __awaiter(this,void 0,void 0,function*(){if(i!==defaultId)return i;const n=yield this.getDevices(t),s=n.find(c=>c.deviceId===defaultId);if(!s){livekitLogger.warn("could not reliably determine default device");return}const a=n.find(c=>c.deviceId!==defaultId&&c.groupId===(e??s.groupId));if(!a){livekitLogger.warn("could not reliably determine default device");return}return a==null?void 0:a.deviceId})}hasDeviceInUse(t){return t?DeviceManager.userMediaPromiseMap.has(t):DeviceManager.userMediaPromiseMap.size>0}}DeviceManager.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];DeviceManager.userMediaPromiseMap=new Map;const defaultDimensionsTimeout=1e3;class LocalTrack extends Track{get sender(){return this._sender}set sender(t){this._sender=t}get constraints(){return this._constraints}constructor(t,i,e){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0;super(t,i,s),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=r(()=>__awaiter(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>__awaiter(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(TrackEvent.Ended,this)},this.reacquireTrack=!1,this.providedByUser=n,this.muteLock=new Mutex,this.pauseUpstreamLock=new Mutex,this.processorLock=new Mutex,this.restartLock=new Mutex,this.setMediaStreamTrack(t,!0),this._constraints=t.getConstraints(),e&&(this._constraints=e)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==Track.Kind.Video)return;const{width:t,height:i}=this._mediaStreamTrack.getSettings();if(t&&i)return{width:t,height:i}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var t,i;return(i=(t=this.processor)===null||t===void 0?void 0:t.processedTrack)!==null&&i!==void 0?i:this._mediaStreamTrack}setMediaStreamTrack(t,i){return __awaiter(this,void 0,void 0,function*(){if(t===this._mediaStreamTrack&&!i)return;this._mediaStreamTrack&&(this.attachedElements.forEach(n=>{detachTrack(this._mediaStreamTrack,n)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([t]),t&&(t.addEventListener("ended",this.handleEnded),t.addEventListener("mute",this.handleTrackMuteEvent),t.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=t.getConstraints());let e;if(this.processor&&t){const n=yield this.processorLock.lock();try{if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(attachToElement(t,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:t,kind:this.kind,element:this.processorElement}),e=this.processor.processedTrack}finally{n()}}this.sender&&(yield this.sender.replaceTrack(e??t)),!this.providedByUser&&this._mediaStreamTrack!==t&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=t,t&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(n=>{attachToElement(e??t,n)}))})}waitForDimensions(){return __awaiter(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:defaultDimensionsTimeout;return function*(){var e;if(t.kind===Track.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((e=getBrowser())===null||e===void 0?void 0:e.os)==="iOS"&&(yield sleep(10));const n=Date.now();for(;Date.now()-n<i;){const s=t.dimensions;if(s)return s;yield sleep(50)}throw new TrackInvalidError("unable to get track dimensions after timeout")}()})}getDeviceId(){return __awaiter(this,void 0,void 0,function*(){if(this.source===Track.Source.ScreenShare)return;const{deviceId:t,groupId:i}=this._mediaStreamTrack.getSettings(),e=this.kind===Track.Kind.Audio?"audioinput":"videoinput";return DeviceManager.getInstance().normalizeDeviceId(e,t,i)})}mute(){return __awaiter(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return __awaiter(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(t,i){return __awaiter(this,void 0,void 0,function*(){if(!this.sender)throw new TrackInvalidError("unable to replace an unpublished track");let e,n;return typeof i=="boolean"?e=i:i!==void 0&&(e=i.userProvidedTrack,n=i.stopProcessor),this.providedByUser=e??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(t),n&&this.processor&&(yield this.stopProcessor()),this})}restart(t){return __awaiter(this,void 0,void 0,function*(){this.manuallyStopped=!1;const i=yield this.restartLock.lock();try{t||(t=this._constraints),this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:t}));const e={audio:!1,video:!1};this.kind===Track.Kind.Video?e.video=t:e.audio=t,this.attachedElements.forEach(a=>{detachTrack(this.mediaStreamTrack,a)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const s=(yield navigator.mediaDevices.getUserMedia(e)).getTracks()[0];return s.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(s),this._constraints=t,this.emit(TrackEvent.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{i()}})}setTrackMuted(t){this.log.debug("setting ".concat(this.kind," track ").concat(t?"muted":"unmuted"),this.logContext),!(this.isMuted===t&&this._mediaStreamTrack.enabled!==t)&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?TrackEvent.Muted:TrackEvent.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return __awaiter(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),isMobile()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var t;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(t=this.processor)===null||t===void 0||t.destroy(),this.processor=void 0}pauseUpstream(){return __awaiter(this,void 0,void 0,function*(){const t=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(TrackEvent.UpstreamPaused,this);const i=getBrowser();if((i==null?void 0:i.name)==="Safari"&&compareVersions(i.version,"12.0")<0)throw new DeviceUnsupportedError("pauseUpstream is not supported on Safari < 12.");yield this.sender.replaceTrack(null)}finally{t()}})}resumeUpstream(){return __awaiter(this,void 0,void 0,function*(){const t=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(TrackEvent.UpstreamResumed,this),yield this.sender.replaceTrack(this.mediaStreamTrack)}finally{t()}})}getRTCStatsReport(){return __awaiter(this,void 0,void 0,function*(){var t;return!((t=this.sender)===null||t===void 0)&&t.getStats?yield this.sender.getStats():void 0})}setProcessor(t){return __awaiter(this,arguments,void 0,function(i){var e=this;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;const a=yield e.processorLock.lock();try{e.log.debug("setting up processor",e.logContext);const c=document.createElement(e.kind),l={kind:e.kind,track:e._mediaStreamTrack,element:c,audioContext:e.audioContext};if(yield i.init(l),e.log.debug("processor initialized",e.logContext),e.processor&&(yield e.stopProcessor()),e.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(attachToElement(e._mediaStreamTrack,c),c.muted=!0,c.play().catch(u=>e.log.error("failed to play processor element",Object.assign(Object.assign({},e.logContext),{error:u}))),e.processor=i,e.processorElement=c,e.processor.processedTrack){for(const u of e.attachedElements)u!==e.processorElement&&n&&(detachTrack(e._mediaStreamTrack,u),attachToElement(e.processor.processedTrack,u));yield(s=e.sender)===null||s===void 0?void 0:s.replaceTrack(e.processor.processedTrack)}e.emit(TrackEvent.TrackProcessorUpdate,e.processor)}finally{a()}}()})}getProcessor(){return this.processor}stopProcessor(){return __awaiter(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var e,n;t.processor&&(t.log.debug("stopping processor",t.logContext),(e=t.processor.processedTrack)===null||e===void 0||e.stop(),yield t.processor.destroy(),t.processor=void 0,i||((n=t.processorElement)===null||n===void 0||n.remove(),t.processorElement=void 0),yield t._mediaStreamTrack.applyConstraints(t._constraints),yield t.setMediaStreamTrack(t._mediaStreamTrack,!0),t.emit(TrackEvent.TrackProcessorUpdate))}()})}}class E2EEManager extends eventsExports.EventEmitter{constructor(t){super(),this.onWorkerMessage=i=>{var e,n;const{kind:s,data:a}=i.data;switch(s){case"error":livekitLogger.error(a.error.message),this.emit(EncryptionEvent.EncryptionError,a.error);break;case"initAck":a.enabled&&this.keyProvider.getKeys().forEach(c=>{this.postKey(c)});break;case"enable":if(this.encryptionEnabled!==a.enabled&&a.participantIdentity===((e=this.room)===null||e===void 0?void 0:e.localParticipant.identity))this.emit(EncryptionEvent.ParticipantEncryptionStatusChanged,a.enabled,this.room.localParticipant),this.encryptionEnabled=a.enabled;else if(a.participantIdentity){const c=(n=this.room)===null||n===void 0?void 0:n.getParticipantByIdentity(a.participantIdentity);if(!c)throw TypeError("couldn't set encryption status, participant not found".concat(a.participantIdentity));this.emit(EncryptionEvent.ParticipantEncryptionStatusChanged,a.enabled,c)}this.encryptionEnabled&&this.keyProvider.getKeys().forEach(c=>{this.postKey(c)});break;case"ratchetKey":this.keyProvider.emit(KeyProviderEvent.KeyRatcheted,a.material,a.keyIndex);break}},this.onWorkerError=i=>{livekitLogger.error("e2ee worker encountered an error:",{error:i.error}),this.emit(EncryptionEvent.EncryptionError,i.error)},this.keyProvider=t.keyProvider,this.worker=t.worker,this.encryptionEnabled=!1}setup(t){if(!isE2EESupported())throw new DeviceUnsupportedError("tried to setup end-to-end encryption on an unsupported browser");if(livekitLogger.info("setting up e2ee"),t!==this.room){this.room=t,this.setupEventListeners(t,this.keyProvider);const i={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:workerLogger.getLevel()}};this.worker&&(livekitLogger.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(i))}}setParticipantCryptorEnabled(t,i){livekitLogger.debug("set e2ee to ".concat(t," for participant ").concat(i)),this.postEnable(t,i)}setSifTrailer(t){!t||t.length===0?livekitLogger.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(t)}setupEngine(t){t.on(EngineEvent.RTPVideoMapUpdate,i=>{this.postRTPMap(i)})}setupEventListeners(t,i){t.on(RoomEvent.TrackPublished,(e,n)=>this.setParticipantCryptorEnabled(e.trackInfo.encryption!==Encryption_Type.NONE,n.identity)),t.on(RoomEvent.ConnectionStateChanged,e=>{e===ConnectionState.Connected&&t.remoteParticipants.forEach(n=>{n.trackPublications.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==Encryption_Type.NONE,n.identity)})})}).on(RoomEvent.TrackUnsubscribed,(e,n,s)=>{var a;const c={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:e.mediaStreamID}};(a=this.worker)===null||a===void 0||a.postMessage(c)}).on(RoomEvent.TrackSubscribed,(e,n,s)=>{this.setupE2EEReceiver(e,s.identity,n.trackInfo)}).on(RoomEvent.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity),i.getKeys().forEach(e=>{this.postKey(e)})}),t.localParticipant.on(ParticipantEvent.LocalTrackPublished,e=>__awaiter(this,void 0,void 0,function*(){this.setupE2EESender(e.track,e.track.sender)})),i.on(KeyProviderEvent.SetKey,e=>this.postKey(e)).on(KeyProviderEvent.RatchetRequest,(e,n)=>this.postRatchetRequest(e,n))}postRatchetRequest(t,i){if(!this.worker)throw Error("could not ratchet key, worker is missing");const e={kind:"ratchetRequest",data:{participantIdentity:t,keyIndex:i}};this.worker.postMessage(e)}postKey(t){let{key:i,participantIdentity:e,keyIndex:n}=t;var s;if(!this.worker)throw Error("could not set key, worker is missing");const a={kind:"setKey",data:{participantIdentity:e,isPublisher:e===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:i,keyIndex:n}};this.worker.postMessage(a)}postEnable(t,i){if(this.worker){const e={kind:"enable",data:{enabled:t,participantIdentity:i}};this.worker.postMessage(e)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(t){var i;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((i=this.room)===null||i===void 0)&&i.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const e={kind:"setRTPMap",data:{map:t,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(e)}postSifTrailer(t){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const i={kind:"setSifTrailer",data:{trailer:t}};this.worker.postMessage(i)}setupE2EEReceiver(t,i,e){if(t.receiver){if(!(e!=null&&e.mimeType)||e.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(t.receiver,t.mediaStreamID,i,t.kind==="video"?mimeTypeToVideoCodecString(e.mimeType):void 0)}}setupE2EESender(t,i){if(!(t instanceof LocalTrack)||!i){i||livekitLogger.warn("early return because sender is not ready");return}this.handleSender(i,t.mediaStreamID,void 0)}handleReceiver(t,i,e,n){return __awaiter(this,void 0,void 0,function*(){if(this.worker){if(isScriptTransformSupported()){const s={kind:"decode",participantIdentity:e,trackId:i,codec:n};t.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(E2EE_FLAG in t&&n){const l={kind:"updateCodec",data:{trackId:i,codec:n,participantIdentity:e}};this.worker.postMessage(l);return}let s=t.writableStream,a=t.readableStream;if(!s||!a){const l=t.createEncodedStreams();t.writableStream=l.writable,s=l.writable,t.readableStream=l.readable,a=l.readable}const c={kind:"decode",data:{readableStream:a,writableStream:s,trackId:i,codec:n,participantIdentity:e}};this.worker.postMessage(c,[a,s])}t[E2EE_FLAG]=!0}})}handleSender(t,i,e){var n;if(!(E2EE_FLAG in t||!this.worker)){if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(isScriptTransformSupported()){livekitLogger.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:i,codec:e};t.transform=new RTCRtpScriptTransform(this.worker,s)}else{livekitLogger.info("initialize encoded streams");const s=t.createEncodedStreams(),a={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:e,trackId:i,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(a,[s.readable,s.writable])}t[E2EE_FLAG]=!0}}}var QueueTaskStatus;(function(o){o[o.WAITING=0]="WAITING",o[o.RUNNING=1]="RUNNING",o[o.COMPLETED=2]="COMPLETED"})(QueueTaskStatus||(QueueTaskStatus={}));class AsyncQueue{constructor(){this.pendingTasks=new Map,this.taskMutex=new Mutex,this.nextTaskIndex=0}run(t){return __awaiter(this,void 0,void 0,function*(){const i={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:QueueTaskStatus.WAITING};this.pendingTasks.set(i.id,i);const e=yield this.taskMutex.lock();try{return i.executedAt=Date.now(),i.status=QueueTaskStatus.RUNNING,yield t()}finally{i.status=QueueTaskStatus.COMPLETED,this.pendingTasks.delete(i.id),e()}})}flush(){return __awaiter(this,void 0,void 0,function*(){return this.run(()=>__awaiter(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}const passThroughQueueSignals=["syncState","trickle","offer","answer","simulate","leave"];function canPassThroughQueue(o){const t=passThroughQueueSignals.indexOf(o.case)>=0;return livekitLogger.trace("request allowed to bypass queue:",{canPass:t,req:o}),t}var SignalConnectionState;(function(o){o[o.CONNECTING=0]="CONNECTING",o[o.CONNECTED=1]="CONNECTED",o[o.RECONNECTING=2]="RECONNECTING",o[o.DISCONNECTING=3]="DISCONNECTING",o[o.DISCONNECTED=4]="DISCONNECTED"})(SignalConnectionState||(SignalConnectionState={}));class SignalClient{get currentState(){return this.state}get isDisconnected(){return this.state===SignalConnectionState.DISCONNECTING||this.state===SignalConnectionState.DISCONNECTED}get isEstablishingConnection(){return this.state===SignalConnectionState.CONNECTING||this.state===SignalConnectionState.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var e;this.rtt=0,this.state=SignalConnectionState.DISCONNECTED,this.log=livekitLogger,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=getLogger((e=i.loggerName)!==null&&e!==void 0?e:LoggerNames.Signal),this.loggerContextCb=i.loggerContextCb,this.useJSON=t,this.requestQueue=new AsyncQueue,this.queuedRequests=[],this.closingLock=new Mutex,this.connectionLock=new Mutex,this.state=SignalConnectionState.DISCONNECTED}get logContext(){var t,i;return(i=(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this))!==null&&i!==void 0?i:{}}join(t,i,e,n){return __awaiter(this,void 0,void 0,function*(){return this.state=SignalConnectionState.CONNECTING,this.options=e,yield this.connect(t,i,e,n)})}reconnect(t,i,e,n){return __awaiter(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=SignalConnectionState.RECONNECTING,this.clearPingInterval(),yield this.connect(t,i,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:e,reconnectReason:n}))})}connect(t,i,e,n){this.connectOptions=e,t=toWebsocketUrl(t),t=t.replace(/\/$/,""),t+="/rtc";const s=getClientInfo(),a=createConnectionParams(i,s,e);return new Promise((c,l)=>__awaiter(this,void 0,void 0,function*(){const u=yield this.connectionLock.lock();try{const d=()=>__awaiter(this,void 0,void 0,function*(){this.close(),clearTimeout(f),l(new ConnectionError("room connection has been cancelled (signal)"))}),f=setTimeout(()=>{this.close(),l(new ConnectionError("room connection has timed out (signal)"))},e.websocketTimeout);n!=null&&n.aborted&&d(),n==null||n.addEventListener("abort",d),this.log.debug("connecting to ".concat(t+a),this.logContext),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(t+a),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(f)},this.ws.onerror=h=>__awaiter(this,void 0,void 0,function*(){if(this.state!==SignalConnectionState.CONNECTED){this.state=SignalConnectionState.DISCONNECTED,clearTimeout(f);try{const p=yield fetch("http".concat(t.substring(2),"/validate").concat(a));if(p.status.toFixed(0).startsWith("4")){const m=yield p.text();l(new ConnectionError(m,0,p.status))}else l(new ConnectionError("Internal error",2,p.status))}catch{l(new ConnectionError("server was not reachable",1))}return}this.handleWSError(h)}),this.ws.onmessage=h=>__awaiter(this,void 0,void 0,function*(){var p,m,g;let v;if(typeof h.data=="string"){const T=JSON.parse(h.data);v=SignalResponse.fromJson(T,{ignoreUnknownFields:!0})}else if(h.data instanceof ArrayBuffer)v=SignalResponse.fromBinary(new Uint8Array(h.data));else{this.log.error("could not decode websocket message: ".concat(typeof h.data),this.logContext);return}if(this.state!==SignalConnectionState.CONNECTED){let T=!1;if(((p=v.message)===null||p===void 0?void 0:p.case)==="join"?(this.state=SignalConnectionState.CONNECTED,n==null||n.removeEventListener("abort",d),this.pingTimeoutDuration=v.message.value.pingTimeout,this.pingIntervalDuration=v.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),c(v.message.value)):this.state===SignalConnectionState.RECONNECTING&&v.message.case!=="leave"?(this.state=SignalConnectionState.CONNECTED,n==null||n.removeEventListener("abort",d),this.startPingInterval(),((m=v.message)===null||m===void 0?void 0:m.case)==="reconnect"?c(v.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),c(void 0),T=!0)):this.isEstablishingConnection&&v.message.case==="leave"?l(new ConnectionError("Received leave request while trying to (re)connect",4)):e.reconnect||l(new ConnectionError("did not receive join response, got ".concat((g=v.message)===null||g===void 0?void 0:g.case," instead"))),!T)return}this.signalLatency&&(yield sleep(this.signalLatency)),this.handleSignalResponse(v)}),this.ws.onclose=h=>{this.isEstablishingConnection&&l(new ConnectionError("Websocket got closed during a (re)connection attempt")),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:h.reason,code:h.code,wasClean:h.wasClean,state:this.state})),this.handleOnClose(h.reason)}}finally{u()}}))}close(){return __awaiter(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const e=yield t.closingLock.lock();try{if(t.clearPingInterval(),i&&(t.state=SignalConnectionState.DISCONNECTING),t.ws){t.ws.onmessage=null,t.ws.onopen=null,t.ws.onclose=null;const n=new Promise(s=>{t.ws?t.ws.onclose=()=>{s()}:s()});t.ws.readyState<t.ws.CLOSING&&(t.ws.close(),yield Promise.race([n,sleep(250)])),t.ws=void 0}}finally{i&&(t.state=SignalConnectionState.DISCONNECTED),e()}}()})}sendOffer(t){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:t.sdp})),this.sendRequest({case:"offer",value:toProtoSessionDescription(t)})}sendAnswer(t){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:t.sdp})),this.sendRequest({case:"answer",value:toProtoSessionDescription(t)})}sendIceCandidate(t,i){return this.log.trace("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:t})),this.sendRequest({case:"trickle",value:new TrickleRequest({candidateInit:JSON.stringify(t),target:i})})}sendMuteTrack(t,i){return this.sendRequest({case:"mute",value:new MuteTrackRequest({sid:t,muted:i})})}sendAddTrack(t){return this.sendRequest({case:"addTrack",value:t})}sendUpdateLocalMetadata(t,i){return __awaiter(this,arguments,void 0,function(e,n){var s=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const c=s.getNextRequestId();return yield s.sendRequest({case:"updateMetadata",value:new UpdateParticipantMetadata({requestId:c,metadata:e,name:n,attributes:a})}),c}()})}sendUpdateTrackSettings(t){this.sendRequest({case:"trackSetting",value:t})}sendUpdateSubscription(t){return this.sendRequest({case:"subscription",value:t})}sendSyncState(t){return this.sendRequest({case:"syncState",value:t})}sendUpdateVideoLayers(t,i){return this.sendRequest({case:"updateLayers",value:new UpdateVideoLayers({trackSid:t,layers:i})})}sendUpdateSubscriptionPermissions(t,i){return this.sendRequest({case:"subscriptionPermission",value:new SubscriptionPermission({allParticipants:t,trackPermissions:i})})}sendSimulateScenario(t){return this.sendRequest({case:"simulate",value:t})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:protoInt64.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Ping({timestamp:protoInt64.parse(Date.now()),rtt:protoInt64.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(t,i){return this.sendRequest({case:"updateAudioTrack",value:new UpdateLocalAudioTrack({trackSid:t,features:i})})}sendLeave(){return this.sendRequest({case:"leave",value:new LeaveRequest({reason:DisconnectReason.CLIENT_INITIATED,action:LeaveRequest_Action.DISCONNECT})})}sendRequest(t){return __awaiter(this,arguments,void 0,function(i){var e=this;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!n&&!canPassThroughQueue(i)&&e.state===SignalConnectionState.RECONNECTING){e.queuedRequests.push(()=>__awaiter(e,void 0,void 0,function*(){yield this.sendRequest(i,!0)}));return}if(n||(yield e.requestQueue.flush()),e.signalLatency&&(yield sleep(e.signalLatency)),!e.ws||e.ws.readyState!==e.ws.OPEN){e.log.error("cannot send signal request before connected, type: ".concat(i==null?void 0:i.case),e.logContext);return}const a=new SignalRequest({message:i});try{e.useJSON?e.ws.send(a.toJsonString()):e.ws.send(a.toBinary())}catch(c){e.log.error("error sending signal message",Object.assign(Object.assign({},e.logContext),{error:c}))}}()})}handleSignalResponse(t){var i,e;const n=t.message;if(n==null){this.log.debug("received unsupported message",this.logContext);return}let s=!1;if(n.case==="answer"){const a=fromProtoSessionDescription(n.value);this.onAnswer&&this.onAnswer(a)}else if(n.case==="offer"){const a=fromProtoSessionDescription(n.value);this.onOffer&&this.onOffer(a)}else if(n.case==="trickle"){const a=JSON.parse(n.value.candidateInit);this.onTrickle&&this.onTrickle(a,n.value.target)}else n.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((i=n.value.participants)!==null&&i!==void 0?i:[]):n.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(n.value):n.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((e=n.value.speakers)!==null&&e!==void 0?e:[]):n.case==="leave"?this.onLeave&&this.onLeave(n.value):n.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(n.value.sid,n.value.muted):n.case==="roomUpdate"?this.onRoomUpdate&&n.value.room&&this.onRoomUpdate(n.value.room):n.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(n.value):n.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(n.value):n.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(n.value):n.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(n.value):n.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(n.value):n.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(n.value):n.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(n.value):n.case==="pong"||(n.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(n.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):n.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(n.value):n.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(n.value.trackSid):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:n.case})));s||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const t=this.queuedRequests.shift();t&&this.requestQueue.run(t)}}handleOnClose(t){return __awaiter(this,void 0,void 0,function*(){if(this.state===SignalConnectionState.DISCONNECTED)return;const i=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(t),Object.assign(Object.assign({},this.logContext),{reason:t})),i&&i(t)})}handleWSError(t){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:t}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=CriticalTimers.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&CriticalTimers.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=CriticalTimers.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&CriticalTimers.clearInterval(this.pingInterval)}}function fromProtoSessionDescription(o){const t={type:"offer",sdp:o.sdp};switch(o.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=o.type;break}return t}function toProtoSessionDescription(o){return new SessionDescription({sdp:o.sdp,type:o.type})}function createConnectionParams(o,t,i){var e;const n=new URLSearchParams;return n.set("access_token",o),i.reconnect&&(n.set("reconnect","1"),i.sid&&n.set("sid",i.sid)),n.set("auto_subscribe",i.autoSubscribe?"1":"0"),n.set("sdk",isReactNative()?"reactnative":"js"),n.set("version",t.version),n.set("protocol",t.protocol.toString()),t.deviceModel&&n.set("device_model",t.deviceModel),t.os&&n.set("os",t.os),t.osVersion&&n.set("os_version",t.osVersion),t.browser&&n.set("browser",t.browser),t.browserVersion&&n.set("browser_version",t.browserVersion),i.adaptiveStream&&n.set("adaptive_stream","1"),i.reconnectReason&&n.set("reconnect_reason",i.reconnectReason.toString()),!((e=navigator.connection)===null||e===void 0)&&e.type&&n.set("network",navigator.connection.type),"?".concat(n.toString())}var parser$1={},grammar$2={exports:{}},grammar$1=grammar$2.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(o){return o.encoding?"rtpmap:%d %s/%s/%s":o.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(o){return o.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(o){return o.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(o){return"extmap:%d"+(o.direction?"/%s":"%v")+(o["encrypt-uri"]?" %s":"%v")+" %s"+(o.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(o){return o.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(o){var t="candidate:%s %d %s %d %s %d typ %s";return t+=o.raddr!=null?" raddr %s rport %d":"%v%v",t+=o.tcptype!=null?" tcptype %s":"%v",o.generation!=null&&(t+=" generation %d"),t+=o["network-id"]!=null?" network-id %d":"%v",t+=o["network-cost"]!=null?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(o){var t="ssrc:%d";return o.attribute!=null&&(t+=" %s",o.value!=null&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(o){return o.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(o){return o.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(o){return"imageattr:%s %s %s"+(o.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(o){return"simulcast:%s %s"+(o.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(o){return"ts-refclk:%s"+(o.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(o){var t="mediaclk:";return t+=o.id!=null?"id=%s %s":"%v%s",t+=o.mediaClockValue!=null?"=%s":"",t+=o.rateNumerator!=null?" rate=%s":"",t+=o.rateDenominator!=null?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(grammar$1).forEach(function(o){var t=grammar$1[o];t.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})});var grammarExports=grammar$2.exports;(function(o){var t=function(c){return String(Number(c))===c?Number(c):c},i=function(c,l,u,d){if(d&&!u)l[d]=t(c[1]);else for(var f=0;f<u.length;f+=1)c[f+1]!=null&&(l[u[f]]=t(c[f+1]))},e=function(c,l,u){var d=c.name&&c.names;c.push&&!l[c.push]?l[c.push]=[]:d&&!l[c.name]&&(l[c.name]={});var f=c.push?{}:d?l[c.name]:l;i(u.match(c.reg),f,c.names,c.name),c.push&&l[c.push].push(f)},n=grammarExports,s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);o.parse=function(c){var l={},u=[],d=l;return c.split(/(\r\n|\r|\n)/).filter(s).forEach(function(f){var h=f[0],p=f.slice(2);h==="m"&&(u.push({rtp:[],fmtp:[]}),d=u[u.length-1]);for(var m=0;m<(n[h]||[]).length;m+=1){var g=n[h][m];if(g.reg.test(p))return e(g,d,p)}}),l.media=u,l};var a=function(c,l){var u=l.split(/=(.+)/,2);return u.length===2?c[u[0]]=t(u[1]):u.length===1&&l.length>1&&(c[u[0]]=void 0),c};o.parseParams=function(c){return c.split(/;\s?/).reduce(a,{})},o.parseFmtpConfig=o.parseParams,o.parsePayloads=function(c){return c.toString().split(" ").map(Number)},o.parseRemoteCandidates=function(c){for(var l=[],u=c.split(" ").map(t),d=0;d<u.length;d+=3)l.push({component:u[d],ip:u[d+1],port:u[d+2]});return l},o.parseImageAttributes=function(c){return c.split(" ").map(function(l){return l.substring(1,l.length-1).split(",").reduce(a,{})})},o.parseSimulcastStreamList=function(c){return c.split(";").map(function(l){return l.split(",").map(function(u){var d,f=!1;return u[0]!=="~"?d=t(u):(d=t(u.substring(1,u.length)),f=!0),{scid:d,paused:f}})})}})(parser$1);var grammar=grammarExports,formatRegExp=/%[sdv%]/g,format=function(o){var t=1,i=arguments,e=i.length;return o.replace(formatRegExp,function(n){if(t>=e)return n;var s=i[t];switch(t+=1,n){case"%%":return"%";case"%s":return String(s);case"%d":return Number(s);case"%v":return""}})},makeLine=function(o,t,i){var e=t.format instanceof Function?t.format(t.push?i:i[t.name]):t.format,n=[o+"="+e];if(t.names)for(var s=0;s<t.names.length;s+=1){var a=t.names[s];t.name?n.push(i[t.name][a]):n.push(i[t.names[s]])}else n.push(i[t.name]);return format.apply(null,n)},defaultOuterOrder=["v","o","s","i","u","e","p","c","b","t","r","z","a"],defaultInnerOrder=["i","c","b","a"],writer$1=function(o,t){t=t||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(s){s.payloads==null&&(s.payloads="")});var i=t.outerOrder||defaultOuterOrder,e=t.innerOrder||defaultInnerOrder,n=[];return i.forEach(function(s){grammar[s].forEach(function(a){a.name in o&&o[a.name]!=null?n.push(makeLine(s,a,o)):a.push in o&&o[a.push]!=null&&o[a.push].forEach(function(c){n.push(makeLine(s,a,c))})})}),o.media.forEach(function(s){n.push(makeLine("m",grammar.m[0],s)),e.forEach(function(a){grammar[a].forEach(function(c){c.name in s&&s[c.name]!=null?n.push(makeLine(a,c,s)):c.push in s&&s[c.push]!=null&&s[c.push].forEach(function(l){n.push(makeLine(a,c,l))})})})}),n.join(`\r
`)+`\r
`},parser=parser$1,writer=writer$1,write=writer,parse=parser.parse;const startBitrateForSVC=.7,PCEvents={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class PCTransport extends eventsExports.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var e;super(),this.log=livekitLogger,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=r(n=>__awaiter(this,void 0,void 0,function*(){this.emit(PCEvents.NegotiationStarted);try{yield this.createAndSendOffer()}catch(s){if(n)n(s);else throw s}}),100),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=getLogger((e=i.loggerName)!==null&&e!==void 0?e:LoggerNames.PCTransport),this.loggerOptions=i,this.config=t,this._pc=this.createPC()}createPC(){const t=new RTCPeerConnection(this.config);return t.onicecandidate=i=>{var e;i.candidate&&((e=this.onIceCandidate)===null||e===void 0||e.call(this,i.candidate))},t.onicecandidateerror=i=>{var e;(e=this.onIceCandidateError)===null||e===void 0||e.call(this,i)},t.oniceconnectionstatechange=()=>{var i;(i=this.onIceConnectionStateChange)===null||i===void 0||i.call(this,t.iceConnectionState)},t.onsignalingstatechange=()=>{var i;(i=this.onSignalingStatechange)===null||i===void 0||i.call(this,t.signalingState)},t.onconnectionstatechange=()=>{var i;(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,t.connectionState)},t.ondatachannel=i=>{var e;(e=this.onDataChannel)===null||e===void 0||e.call(this,i)},t.ontrack=i=>{var e;(e=this.onTrack)===null||e===void 0||e.call(this,i)},t}get logContext(){var t,i;return Object.assign({},(i=(t=this.loggerOptions).loggerContextCb)===null||i===void 0?void 0:i.call(t))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(t){return __awaiter(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(t);this.pendingCandidates.push(t)})}setRemoteDescription(t){return __awaiter(this,void 0,void 0,function*(){var i;let e;if(t.type==="offer"){let{stereoMids:n,nackMids:s}=extractStereoAndNackAudioFromOffer(t);this.remoteStereoMids=n,this.remoteNackMids=s}else if(t.type==="answer"){const n=parse((i=t.sdp)!==null&&i!==void 0?i:"");n.media.forEach(s=>{s.type==="audio"&&this.trackBitrates.some(a=>{if(!a.transceiver||s.mid!=a.transceiver.mid)return!1;let c=0;if(s.rtp.some(u=>u.codec.toUpperCase()===a.codec.toUpperCase()?(c=u.payload,!0):!1),c===0)return!0;let l=!1;for(const u of s.fmtp)if(u.payload===c){u.config=u.config.split(";").filter(d=>!d.includes("maxaveragebitrate")).join(";"),a.maxbr>0&&(u.config+=";maxaveragebitrate=".concat(a.maxbr*1e3)),l=!0;break}return l||a.maxbr>0&&s.fmtp.push({payload:c,config:"maxaveragebitrate=".concat(a.maxbr*1e3)}),!0})}),e=write(n)}yield this.setMungedSDP(t,e,!0),this.pendingCandidates.forEach(n=>{this.pc.addIceCandidate(n)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):t.type==="answer"&&(this.emit(PCEvents.NegotiationComplete),t.sdp&&parse(t.sdp).media.forEach(s=>{s.type==="video"&&this.emit(PCEvents.RTPVideoPayloadTypes,s.rtp)}))})}createAndSendOffer(t){return __awaiter(this,void 0,void 0,function*(){var i;if(this.onOffer===void 0)return;if(t!=null&&t.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const s=this._pc.remoteDescription;if(t!=null&&t.iceRestart&&s)yield this._pc.setRemoteDescription(s);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const e=yield this.pc.createOffer(t);this.log.debug("original offer",Object.assign({sdp:e.sdp},this.logContext));const n=parse((i=e.sdp)!==null&&i!==void 0?i:"");n.media.forEach(s=>{s.type==="audio"?ensureAudioNackAndStereo(s,[],[]):s.type==="video"&&this.trackBitrates.some(a=>{if(!s.msid||!a.cid||!s.msid.includes(a.cid))return!1;let c=0;if(s.rtp.some(u=>u.codec.toUpperCase()===a.codec.toUpperCase()?(c=u.payload,!0):!1),c===0||(isSVCCodec(a.codec)&&ensureVideoDDExtensionForSVC(s),a.codec!=="av1"))return!0;const l=Math.round(a.maxbr*startBitrateForSVC);for(const u of s.fmtp)if(u.payload===c){u.config.includes("x-google-start-bitrate")||(u.config+=";x-google-start-bitrate=".concat(l));break}return!0})}),yield this.setMungedSDP(e,write(n)),this.onOffer(e)})}createAndSetAnswer(){return __awaiter(this,void 0,void 0,function*(){var t;const i=yield this.pc.createAnswer(),e=parse((t=i.sdp)!==null&&t!==void 0?t:"");return e.media.forEach(n=>{n.type==="audio"&&ensureAudioNackAndStereo(n,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(i,write(e)),i})}createDataChannel(t,i){return this.pc.createDataChannel(t,i)}addTransceiver(t,i){return this.pc.addTransceiver(t,i)}addTrack(t){if(!this._pc)throw new UnexpectedConnectionState("PC closed, cannot add track");return this._pc.addTrack(t)}setTrackCodecBitrate(t){this.trackBitrates.push(t)}setConfiguration(t){var i;if(!this._pc)throw new UnexpectedConnectionState("PC closed, cannot configure");return(i=this._pc)===null||i===void 0?void 0:i.setConfiguration(t)}canRemoveTrack(){var t;return!!(!((t=this._pc)===null||t===void 0)&&t.removeTrack)}removeTrack(t){var i;return(i=this._pc)===null||i===void 0?void 0:i.removeTrack(t)}getConnectionState(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.connectionState)!==null&&i!==void 0?i:"closed"}getICEConnectionState(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.iceConnectionState)!==null&&i!==void 0?i:"closed"}getSignallingState(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.signalingState)!==null&&i!==void 0?i:"closed"}getTransceivers(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.getTransceivers())!==null&&i!==void 0?i:[]}getSenders(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.getSenders())!==null&&i!==void 0?i:[]}getLocalDescription(){var t;return(t=this._pc)===null||t===void 0?void 0:t.localDescription}getRemoteDescription(){var t;return(t=this.pc)===null||t===void 0?void 0:t.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return __awaiter(this,void 0,void 0,function*(){var t;if(!this._pc)return;let i="";const e=new Map,n=new Map;if((yield this._pc.getStats()).forEach(c=>{switch(c.type){case"transport":i=c.selectedCandidatePairId;break;case"candidate-pair":i===""&&c.selected&&(i=c.id),e.set(c.id,c);break;case"remote-candidate":n.set(c.id,"".concat(c.address,":").concat(c.port));break}}),i==="")return;const a=(t=e.get(i))===null||t===void 0?void 0:t.remoteCandidateId;if(a!==void 0)return n.get(a)})}setMungedSDP(t,i,e){return __awaiter(this,void 0,void 0,function*(){if(i){const n=t.sdp;t.sdp=i;try{this.log.debug("setting munged ".concat(e?"remote":"local"," description"),this.logContext),e?yield this.pc.setRemoteDescription(t):yield this.pc.setLocalDescription(t);return}catch(s){this.log.warn("not able to set ".concat(t.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:i})),t.sdp=n}}try{e?yield this.pc.setRemoteDescription(t):yield this.pc.setLocalDescription(t)}catch(n){let s="unknown error";n instanceof Error?s=n.message:typeof n=="string"&&(s=n);const a={error:s,sdp:t.sdp};throw!e&&this.pc.remoteDescription&&(a.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(t.type),Object.assign(Object.assign({},this.logContext),{fields:a})),new NegotiationError(s)}})}}function ensureAudioNackAndStereo(o,t,i){let e=0;o.rtp.some(n=>n.codec==="opus"?(e=n.payload,!0):!1),e>0&&(o.rtcpFb||(o.rtcpFb=[]),i.includes(o.mid)&&!o.rtcpFb.some(n=>n.payload===e&&n.type==="nack")&&o.rtcpFb.push({payload:e,type:"nack"}),t.includes(o.mid)&&o.fmtp.some(n=>n.payload===e?(n.config.includes("stereo=1")||(n.config+=";stereo=1"),!0):!1))}function ensureVideoDDExtensionForSVC(o){var t,i;let e=0;((t=o.ext)===null||t===void 0?void 0:t.some(s=>s.uri===ddExtensionURI?!0:(s.value>e&&(e=s.value),!1)))||(i=o.ext)===null||i===void 0||i.push({value:e+1,uri:ddExtensionURI})}function extractStereoAndNackAudioFromOffer(o){var t;const i=[],e=[],n=parse((t=o.sdp)!==null&&t!==void 0?t:"");let s=0;return n.media.forEach(a=>{var c;a.type==="audio"&&(a.rtp.some(l=>l.codec==="opus"?(s=l.payload,!0):!1),!((c=a.rtcpFb)===null||c===void 0)&&c.some(l=>l.payload===s&&l.type==="nack")&&e.push(a.mid),a.fmtp.some(l=>l.payload===s?(l.config.includes("sprop-stereo=1")&&i.push(a.mid),!0):!1))}),{stereoMids:i,nackMids:e}}const defaultVideoCodec="vp8",publishDefaults={audioPreset:AudioPresets.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:ScreenSharePresets.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:defaultVideoCodec,backupCodec:!0},audioDefaults={autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0},videoDefaults={resolution:VideoPresets.h720.resolution},roomOptionDefaults={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new DefaultReconnectPolicy,disconnectOnPageLeave:!0,webAudioMix:!1},roomConnectOptionDefaults={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var PCTransportState;(function(o){o[o.NEW=0]="NEW",o[o.CONNECTING=1]="CONNECTING",o[o.CONNECTED=2]="CONNECTED",o[o.FAILED=3]="FAILED",o[o.CLOSING=4]="CLOSING",o[o.CLOSED=5]="CLOSED"})(PCTransportState||(PCTransportState={}));class PCTransportManager{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(t,i,e){var n;this.peerConnectionTimeout=roomConnectOptionDefaults.peerConnectionTimeout,this.log=livekitLogger,this.updateState=()=>{var s;const a=this.state,c=this.requiredTransports.map(l=>l.getConnectionState());c.every(l=>l==="connected")?this.state=PCTransportState.CONNECTED:c.some(l=>l==="failed")?this.state=PCTransportState.FAILED:c.some(l=>l==="connecting")?this.state=PCTransportState.CONNECTING:c.every(l=>l==="closed")?this.state=PCTransportState.CLOSED:c.some(l=>l==="closed")?this.state=PCTransportState.CLOSING:c.every(l=>l==="new")&&(this.state=PCTransportState.NEW),a!==this.state&&(this.log.debug("pc state change: from ".concat(PCTransportState[a]," to ").concat(PCTransportState[this.state]),this.logContext),(s=this.onStateChange)===null||s===void 0||s.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=getLogger((n=e.loggerName)!==null&&n!==void 0?n:LoggerNames.PCManager),this.loggerOptions=e,this.isPublisherConnectionRequired=!i,this.isSubscriberConnectionRequired=i,this.publisher=new PCTransport(t,e),this.subscriber=new PCTransport(t,e),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=s=>{var a;(a=this.onIceCandidate)===null||a===void 0||a.call(this,s,SignalTarget.PUBLISHER)},this.subscriber.onIceCandidate=s=>{var a;(a=this.onIceCandidate)===null||a===void 0||a.call(this,s,SignalTarget.SUBSCRIBER)},this.subscriber.onDataChannel=s=>{var a;(a=this.onDataChannel)===null||a===void 0||a.call(this,s)},this.subscriber.onTrack=s=>{var a;(a=this.onTrack)===null||a===void 0||a.call(this,s)},this.publisher.onOffer=s=>{var a;(a=this.onPublisherOffer)===null||a===void 0||a.call(this,s)},this.state=PCTransportState.NEW,this.connectionLock=new Mutex}get logContext(){var t,i;return Object.assign({},(i=(t=this.loggerOptions).loggerContextCb)===null||i===void 0?void 0:i.call(t))}requirePublisher(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=t,this.updateState()}requireSubscriber(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=t,this.updateState()}createAndSendPublisherOffer(t){return this.publisher.createAndSendOffer(t)}setPublisherAnswer(t){return this.publisher.setRemoteDescription(t)}removeTrack(t){return this.publisher.removeTrack(t)}close(){return __awaiter(this,void 0,void 0,function*(){if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const t=this.publisher;for(const i of t.getSenders())try{t.canRemoveTrack()&&t.removeTrack(i)}catch(e){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:e}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return __awaiter(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(t,i){return __awaiter(this,void 0,void 0,function*(){i===SignalTarget.PUBLISHER?yield this.publisher.addIceCandidate(t):yield this.subscriber.addIceCandidate(t)})}createSubscriberAnswerFromOffer(t){return __awaiter(this,void 0,void 0,function*(){return this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:t.type,sdp:t.sdp,signalingState:this.subscriber.getSignallingState().toString()})),yield this.subscriber.setRemoteDescription(t),yield this.subscriber.createAndSetAnswer()})}updateConfiguration(t,i){this.publisher.setConfiguration(t),this.subscriber.setConfiguration(t),i&&this.triggerIceRestart()}ensurePCTransportConnection(t,i){return __awaiter(this,void 0,void 0,function*(){var e;const n=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((e=this.requiredTransports)===null||e===void 0?void 0:e.map(s=>this.ensureTransportConnected(s,t,i)))}finally{n()}})}negotiate(t){return __awaiter(this,void 0,void 0,function*(){return new Promise((i,e)=>__awaiter(this,void 0,void 0,function*(){const n=setTimeout(()=>{e("negotiation timed out")},this.peerConnectionTimeout),s=()=>{clearTimeout(n),e("negotiation aborted")};t.signal.addEventListener("abort",s),this.publisher.once(PCEvents.NegotiationStarted,()=>{t.signal.aborted||this.publisher.once(PCEvents.NegotiationComplete,()=>{clearTimeout(n),i()})}),yield this.publisher.negotiate(a=>{clearTimeout(n),e(a)})}))})}addPublisherTransceiver(t,i){return this.publisher.addTransceiver(t,i)}addPublisherTrack(t){return this.publisher.addTrack(t)}createPublisherDataChannel(t,i){return this.publisher.createDataChannel(t,i)}getConnectedAddress(t){return t===SignalTarget.PUBLISHER?this.publisher.getConnectedAddress():t===SignalTarget.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const t=[];return this.isPublisherConnectionRequired&&t.push(this.publisher),this.isSubscriberConnectionRequired&&t.push(this.subscriber),t}ensureTransportConnected(t,i){return __awaiter(this,arguments,void 0,function(e,n){var s=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(e.getConnectionState()!=="connected")return new Promise((l,u)=>__awaiter(s,void 0,void 0,function*(){const d=()=>{this.log.warn("abort transport connection",this.logContext),CriticalTimers.clearTimeout(f),u(new ConnectionError("room connection has been cancelled",3))};n!=null&&n.signal.aborted&&d(),n==null||n.signal.addEventListener("abort",d);const f=CriticalTimers.setTimeout(()=>{n==null||n.signal.removeEventListener("abort",d),u(new ConnectionError("could not establish pc connection"))},a);for(;this.state!==PCTransportState.CONNECTED;)if(yield sleep(50),n!=null&&n.signal.aborted){u(new ConnectionError("room connection has been cancelled",3));return}CriticalTimers.clearTimeout(f),n==null||n.signal.removeEventListener("abort",d),l()}))}()})}}const monitorFrequency=2e3;function computeBitrate(o,t){if(!t)return 0;let i,e;return"bytesReceived"in o?(i=o.bytesReceived,e=t.bytesReceived):"bytesSent"in o&&(i=o.bytesSent,e=t.bytesSent),i===void 0||e===void 0||o.timestamp===void 0||t.timestamp===void 0?0:(i-e)*8*1e3/(o.timestamp-t.timestamp)}class LocalAudioTrack extends LocalTrack{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(t,i){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;super(t,Track.Kind.Audio,i,e,s),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>__awaiter(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let a;try{a=yield this.getSenderStats()}catch(c){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:c}));return}a&&this.prevStats&&(this._currentBitrate=computeBitrate(a,this.prevStats)),this.prevStats=a}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(TrackEvent.AudioTrackFeatureUpdate,this,AudioTrackFeature.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(TrackEvent.AudioTrackFeatureUpdate,this,AudioTrackFeature.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=n,this.checkForSilence()}setDeviceId(t){return __awaiter(this,void 0,void 0,function*(){return this._constraints.deviceId===t&&this._mediaStreamTrack.getSettings().deviceId===unwrapConstraint(t)?!0:(this._constraints.deviceId=t,this.isMuted||(yield this.restartTrack()),this.isMuted||unwrapConstraint(t)===this._mediaStreamTrack.getSettings().deviceId)})}mute(){const t=Object.create(null,{mute:{get:()=>super.mute}});return __awaiter(this,void 0,void 0,function*(){const i=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===Track.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield t.mute.call(this),this)}finally{i()}})}unmute(){const t=Object.create(null,{unmute:{get:()=>super.unmute}});return __awaiter(this,void 0,void 0,function*(){const i=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const e=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==unwrapConstraint(this._constraints.deviceId);return this.source===Track.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||e)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield t.unmute.call(this),this}finally{i()}})}restartTrack(t){return __awaiter(this,void 0,void 0,function*(){let i;if(t){const e=constraintsForOptions({audio:t});typeof e.audio!="boolean"&&(i=e.audio)}yield this.restart(i)})}restart(t){const i=Object.create(null,{restart:{get:()=>super.restart}});return __awaiter(this,void 0,void 0,function*(){const e=yield i.restart.call(this,t);return this.checkForSilence(),e})}startMonitor(){isWeb()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},monitorFrequency)))}setProcessor(t){return __awaiter(this,void 0,void 0,function*(){var i;const e=yield this.processorLock.lock();try{if(!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.stopProcessor());const n={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(t.name),this.logContext),yield t.init(n),this.processor=t,this.processor.processedTrack&&(yield(i=this.sender)===null||i===void 0?void 0:i.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(TrackEvent.TrackProcessorUpdate,this.processor)}finally{e()}})}setAudioContext(t){this.audioContext=t}getSenderStats(){return __awaiter(this,void 0,void 0,function*(){var t;if(!(!((t=this.sender)===null||t===void 0)&&t.getStats))return;const i=yield this.sender.getStats();let e;return i.forEach(n=>{n.type==="outbound-rtp"&&(e={type:"audio",streamId:n.id,packetsSent:n.packetsSent,packetsLost:n.packetsLost,bytesSent:n.bytesSent,timestamp:n.timestamp,roundTripTime:n.roundTripTime,jitter:n.jitter})}),e})}checkForSilence(){return __awaiter(this,void 0,void 0,function*(){const t=yield detectSilence(this);return t&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(TrackEvent.AudioSilenceDetected)),t})}}function mediaTrackToLocalTrack(o,t,i){switch(o.kind){case"audio":return new LocalAudioTrack(o,t,!1,void 0,i);case"video":return new LocalVideoTrack(o,t,!1,i);default:throw new TrackInvalidError("unsupported track type: ".concat(o.kind))}}const presets169=Object.values(VideoPresets),presets43=Object.values(VideoPresets43),presetsScreenShare=Object.values(ScreenSharePresets),defaultSimulcastPresets169=[VideoPresets.h180,VideoPresets.h360],defaultSimulcastPresets43=[VideoPresets43.h180,VideoPresets43.h360],computeDefaultScreenShareSimulcastPresets=o=>[{scaleResolutionDownBy:2,fps:o.encoding.maxFramerate}].map(i=>{var e,n;return new VideoPreset(Math.floor(o.width/i.scaleResolutionDownBy),Math.floor(o.height/i.scaleResolutionDownBy),Math.max(15e4,Math.floor(o.encoding.maxBitrate/(Math.pow(i.scaleResolutionDownBy,2)*(((e=o.encoding.maxFramerate)!==null&&e!==void 0?e:30)/((n=i.fps)!==null&&n!==void 0?n:30))))),i.fps,o.encoding.priority)}),videoRids=["q","h","f"];function computeVideoEncodings(o,t,i,e){var n,s;let a=e==null?void 0:e.videoEncoding;o&&(a=e==null?void 0:e.screenShareEncoding);const c=e==null?void 0:e.simulcast,l=e==null?void 0:e.scalabilityMode,u=e==null?void 0:e.videoCodec;if(!a&&!c&&!l||!t||!i)return[{}];a||(a=determineAppropriateEncoding(o,t,i,u),livekitLogger.debug("using video encoding",a));const d=new VideoPreset(t,i,a.maxBitrate,a.maxFramerate,a.priority);if(l&&isSVCCodec(u)){const p=new ScalabilityMode(l),m=[];if(p.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(l));const g=getBrowser();if(isSafari()||isReactNative()||(g==null?void 0:g.name)==="Chrome"&&compareVersions(g==null?void 0:g.version,"113")<0){const v=p.suffix=="h"?2:3;for(let T=0;T<p.spatial;T+=1)m.push({rid:videoRids[2-T],maxBitrate:a.maxBitrate/Math.pow(v,T),maxFramerate:d.encoding.maxFramerate});m[0].scalabilityMode=l}else m.push({maxBitrate:a.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:l});return d.encoding.priority&&(m[0].priority=d.encoding.priority,m[0].networkPriority=d.encoding.priority),livekitLogger.debug("using svc encoding",{encodings:m}),m}if(!c)return[a];let f=[];o?f=(n=sortPresets(e==null?void 0:e.screenShareSimulcastLayers))!==null&&n!==void 0?n:defaultSimulcastLayers(o,d):f=(s=sortPresets(e==null?void 0:e.videoSimulcastLayers))!==null&&s!==void 0?s:defaultSimulcastLayers(o,d);let h;if(f.length>0){const p=f[0];f.length>1&&([,h]=f);const m=Math.max(t,i);if(m>=960&&h)return encodingsFromPresets(t,i,[p,h,d]);if(m>=480)return encodingsFromPresets(t,i,[p,d])}return encodingsFromPresets(t,i,[d])}function computeTrackBackupEncodings(o,t,i){var e,n,s,a;if(!i.backupCodec||i.backupCodec===!0||i.backupCodec.codec===i.videoCodec)return;t!==i.backupCodec.codec&&livekitLogger.warn("requested a different codec than specified as backup",{serverRequested:t,backup:i.backupCodec.codec}),i.videoCodec=t,i.videoEncoding=i.backupCodec.encoding;const c=o.mediaStreamTrack.getSettings(),l=(e=c.width)!==null&&e!==void 0?e:(n=o.dimensions)===null||n===void 0?void 0:n.width,u=(s=c.height)!==null&&s!==void 0?s:(a=o.dimensions)===null||a===void 0?void 0:a.height;return computeVideoEncodings(o.source===Track.Source.ScreenShare,l,u,i)}function determineAppropriateEncoding(o,t,i,e){const n=presetsForResolution(o,t,i);let{encoding:s}=n[0];const a=Math.max(t,i);for(let c=0;c<n.length;c+=1){const l=n[c];if(s=l.encoding,l.width>=a)break}if(e)switch(e){case"av1":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function presetsForResolution(o,t,i){if(o)return presetsScreenShare;const e=t>i?t/i:i/t;return Math.abs(e-16/9)<Math.abs(e-4/3)?presets169:presets43}function defaultSimulcastLayers(o,t){if(o)return computeDefaultScreenShareSimulcastPresets(t);const{width:i,height:e}=t,n=i>e?i/e:e/i;return Math.abs(n-16/9)<Math.abs(n-4/3)?defaultSimulcastPresets169:defaultSimulcastPresets43}function encodingsFromPresets(o,t,i){const e=[];if(i.forEach((n,s)=>{if(s>=videoRids.length)return;const a=Math.min(o,t),l={rid:videoRids[s],scaleResolutionDownBy:Math.max(1,a/Math.min(n.width,n.height)),maxBitrate:n.encoding.maxBitrate};n.encoding.maxFramerate&&(l.maxFramerate=n.encoding.maxFramerate);const u=isFireFox()||s===0;n.encoding.priority&&u&&(l.priority=n.encoding.priority,l.networkPriority=n.encoding.priority),e.push(l)}),isReactNative()&&getReactNativeOs()==="ios"){let n;e.forEach(a=>{n?a.maxFramerate&&a.maxFramerate>n&&(n=a.maxFramerate):n=a.maxFramerate});let s=!0;e.forEach(a=>{var c;a.maxFramerate!=n&&(s&&(s=!1,livekitLogger.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),livekitLogger.info('Setting framerate of encoding "'.concat((c=a.rid)!==null&&c!==void 0?c:"",'" to ').concat(n)),a.maxFramerate=n)})}return e}function sortPresets(o){if(o)return o.sort((t,i)=>{const{encoding:e}=t,{encoding:n}=i;return e.maxBitrate>n.maxBitrate?1:e.maxBitrate<n.maxBitrate?-1:e.maxBitrate===n.maxBitrate&&e.maxFramerate&&n.maxFramerate?e.maxFramerate>n.maxFramerate?1:-1:0})}class ScalabilityMode{constructor(t){const i=t.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!i)throw new Error("invalid scalability mode");if(this.spatial=parseInt(i[1]),this.temporal=parseInt(i[2]),i.length>3)switch(i[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=i[3]}}toString(){var t;return"L".concat(this.spatial,"T").concat(this.temporal).concat((t=this.suffix)!==null&&t!==void 0?t:"")}}function getDefaultDegradationPreference(o){return o.source===Track.Source.ScreenShare||o.constraints.height&&unwrapConstraint(o.constraints.height)>=1080?"maintain-resolution":"balanced"}const refreshSubscribedCodecAfterNewCodec=5e3;class LocalVideoTrack extends LocalTrack{get sender(){return this._sender}set sender(t){this._sender=t,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(t,i){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=arguments.length>3?arguments[3]:void 0;super(t,Track.Kind.Video,i,e,n),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.monitorSender=()=>__awaiter(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(c){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:c}));return}const a=new Map(s.map(c=>[c.rid,c]));if(this.prevStats){let c=0;a.forEach((l,u)=>{var d;const f=(d=this.prevStats)===null||d===void 0?void 0:d.get(u);c+=computeBitrate(l,f)}),this._currentBitrate=c}this.prevStats=a}),this.senderLock=new Mutex}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(t){var i;if(this.signalClient=t,!isWeb())return;const e=(i=this.sender)===null||i===void 0?void 0:i.getParameters();e&&(this.encodings=e.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},monitorFrequency))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(t=>{t.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const t=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return __awaiter(this,void 0,void 0,function*(){var i,e,n,s,a;yield t.pauseUpstream.call(this);try{for(var c=!0,l=__asyncValues(this.simulcastCodecs.values()),u;u=yield l.next(),i=u.done,!i;c=!0)s=u.value,c=!1,yield(a=s.sender)===null||a===void 0?void 0:a.replaceTrack(null)}catch(d){e={error:d}}finally{try{!c&&!i&&(n=l.return)&&(yield n.call(l))}finally{if(e)throw e.error}}})}resumeUpstream(){const t=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return __awaiter(this,void 0,void 0,function*(){var i,e,n,s,a;yield t.resumeUpstream.call(this);try{for(var c=!0,l=__asyncValues(this.simulcastCodecs.values()),u;u=yield l.next(),i=u.done,!i;c=!0){s=u.value,c=!1;const d=s;yield(a=d.sender)===null||a===void 0?void 0:a.replaceTrack(d.mediaStreamTrack)}}catch(d){e={error:d}}finally{try{!c&&!i&&(n=l.return)&&(yield n.call(l))}finally{if(e)throw e.error}}})}mute(){const t=Object.create(null,{mute:{get:()=>super.mute}});return __awaiter(this,void 0,void 0,function*(){const i=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===Track.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield t.mute.call(this),this)}finally{i()}})}unmute(){const t=Object.create(null,{unmute:{get:()=>super.unmute}});return __awaiter(this,void 0,void 0,function*(){const i=yield this.muteLock.lock();try{return this.isMuted?(this.source===Track.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield t.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{i()}})}setTrackMuted(t){super.setTrackMuted(t);for(const i of this.simulcastCodecs.values())i.mediaStreamTrack.enabled=!t}getSenderStats(){return __awaiter(this,void 0,void 0,function*(){var t;if(!(!((t=this.sender)===null||t===void 0)&&t.getStats))return[];const i=[],e=yield this.sender.getStats();return e.forEach(n=>{var s;if(n.type==="outbound-rtp"){const a={type:"video",streamId:n.id,frameHeight:n.frameHeight,frameWidth:n.frameWidth,framesPerSecond:n.framesPerSecond,framesSent:n.framesSent,firCount:n.firCount,pliCount:n.pliCount,nackCount:n.nackCount,packetsSent:n.packetsSent,bytesSent:n.bytesSent,qualityLimitationReason:n.qualityLimitationReason,qualityLimitationDurations:n.qualityLimitationDurations,qualityLimitationResolutionChanges:n.qualityLimitationResolutionChanges,rid:(s=n.rid)!==null&&s!==void 0?s:n.id,retransmittedPacketsSent:n.retransmittedPacketsSent,targetBitrate:n.targetBitrate,timestamp:n.timestamp},c=e.get(n.remoteId);c&&(a.jitter=c.jitter,a.packetsLost=c.packetsLost,a.roundTripTime=c.roundTripTime),i.push(a)}}),i.sort((n,s)=>{var a,c;return((a=s.frameWidth)!==null&&a!==void 0?a:0)-((c=n.frameWidth)!==null&&c!==void 0?c:0)}),i})}setPublishingQuality(t){const i=[];for(let e=VideoQuality.LOW;e<=VideoQuality.HIGH;e+=1)i.push(new SubscribedQuality({quality:e,enabled:e<=t}));this.log.debug("setting publishing quality. max quality ".concat(t),this.logContext),this.setPublishingLayers(i)}setDeviceId(t){return __awaiter(this,void 0,void 0,function*(){return this._constraints.deviceId===t&&this._mediaStreamTrack.getSettings().deviceId===unwrapConstraint(t)?!0:(this._constraints.deviceId=t,this.isMuted||(yield this.restartTrack()),this.isMuted||unwrapConstraint(t)===this._mediaStreamTrack.getSettings().deviceId)})}restartTrack(t){return __awaiter(this,void 0,void 0,function*(){var i,e,n,s;let a;if(t){const d=constraintsForOptions({video:t});typeof d.video!="boolean"&&(a=d.video)}yield this.restart(a);try{for(var c=!0,l=__asyncValues(this.simulcastCodecs.values()),u;u=yield l.next(),i=u.done,!i;c=!0){s=u.value,c=!1;const d=s;d.sender&&(d.mediaStreamTrack=this.mediaStreamTrack.clone(),yield d.sender.replaceTrack(d.mediaStreamTrack))}}catch(d){e={error:d}}finally{try{!c&&!i&&(n=l.return)&&(yield n.call(l))}finally{if(e)throw e.error}}})}setProcessor(t){const i=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return __awaiter(this,arguments,void 0,function(e){var n=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var a,c,l,u,d,f;if(yield i.setProcessor.call(n,e,s),!((d=n.processor)===null||d===void 0)&&d.processedTrack)try{for(var h=!0,p=__asyncValues(n.simulcastCodecs.values()),m;m=yield p.next(),a=m.done,!a;h=!0)u=m.value,h=!1,yield(f=u.sender)===null||f===void 0?void 0:f.replaceTrack(n.processor.processedTrack)}catch(g){c={error:g}}finally{try{!h&&!a&&(l=p.return)&&(yield l.call(p))}finally{if(c)throw c.error}}}()})}setDegradationPreference(t){return __awaiter(this,void 0,void 0,function*(){if(this.degradationPreference=t,this.sender)try{this.log.debug("setting degradationPreference to ".concat(t),this.logContext);const i=this.sender.getParameters();i.degradationPreference=t,this.sender.setParameters(i)}catch(i){this.log.warn("failed to set degradationPreference",Object.assign({error:i},this.logContext))}})}addSimulcastTrack(t,i){if(this.simulcastCodecs.has(t)){this.log.error("".concat(t," already added, skipping adding simulcast codec"),this.logContext);return}const e={codec:t,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:i};return this.simulcastCodecs.set(t,e),e}setSimulcastTrackSender(t,i){const e=this.simulcastCodecs.get(t);e&&(e.sender=i,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},refreshSubscribedCodecAfterNewCodec))}setPublishingCodecs(t){return __awaiter(this,void 0,void 0,function*(){var i,e,n,s,a,c,l;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:t,currentCodec:this.codec})),!this.codec&&t.length>0)return yield this.setPublishingLayers(t[0].qualities),[];this.subscribedCodecs=t;const u=[];try{for(i=!0,e=__asyncValues(t);n=yield e.next(),s=n.done,!s;i=!0){l=n.value,i=!1;const d=l;if(!this.codec||this.codec===d.codec)yield this.setPublishingLayers(d.qualities);else{const f=this.simulcastCodecs.get(d.codec);if(this.log.debug("try setPublishingCodec for ".concat(d.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:f})),!f||!f.sender){for(const h of d.qualities)if(h.enabled){u.push(d.codec);break}}else f.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(d.codec),this.logContext),yield setPublishingLayersForSender(f.sender,f.encodings,d.qualities,this.senderLock,this.log,this.logContext))}}}catch(d){a={error:d}}finally{try{!i&&!s&&(c=e.return)&&(yield c.call(e))}finally{if(a)throw a.error}}return u})}setPublishingLayers(t){return __awaiter(this,void 0,void 0,function*(){this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:t})),!(!this.sender||!this.encodings)&&(yield setPublishingLayersForSender(this.sender,this.encodings,t,this.senderLock,this.log,this.logContext))})}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return __awaiter(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),isMobile()&&this.isInBackground&&this.source===Track.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function setPublishingLayersForSender(o,t,i,e,n,s){return __awaiter(this,void 0,void 0,function*(){const a=yield e.lock();n.debug("setPublishingLayersForSender",Object.assign(Object.assign({},s),{sender:o,qualities:i,senderEncodings:t}));try{const c=o.getParameters(),{encodings:l}=c;if(!l)return;if(l.length!==t.length){n.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},s),{encodings:l,senderEncodings:t}));return}let u=!1;!1&&l[0].scalabilityMode||l.forEach((f,h)=>{var p;let m=(p=f.rid)!==null&&p!==void 0?p:"";m===""&&(m="q");const g=videoQualityForRid(m),v=i.find(T=>T.quality===g);v&&f.active!==v.enabled&&(u=!0,f.active=v.enabled,n.debug("setting layer ".concat(v.quality," to ").concat(f.active?"enabled":"disabled"),s),isFireFox()&&(v.enabled?(f.scaleResolutionDownBy=t[h].scaleResolutionDownBy,f.maxBitrate=t[h].maxBitrate,f.maxFrameRate=t[h].maxFrameRate):(f.scaleResolutionDownBy=4,f.maxBitrate=10,f.maxFrameRate=2)))}),u&&(c.encodings=l,n.debug("setting encodings",Object.assign(Object.assign({},s),{encodings:c.encodings})),yield o.setParameters(c))}finally{a()}})}function videoQualityForRid(o){switch(o){case"f":return VideoQuality.HIGH;case"h":return VideoQuality.MEDIUM;case"q":return VideoQuality.LOW;default:return VideoQuality.HIGH}}function videoLayersFromEncodings(o,t,i,e){if(!i)return[new VideoLayer({quality:VideoQuality.HIGH,width:o,height:t,bitrate:0,ssrc:0})];if(e){const n=i[0].scalabilityMode,s=new ScalabilityMode(n),a=[],c=s.suffix=="h"?1.5:2,l=s.suffix=="h"?2:3;for(let u=0;u<s.spatial;u+=1)a.push(new VideoLayer({quality:VideoQuality.HIGH-u,width:Math.ceil(o/Math.pow(c,u)),height:Math.ceil(t/Math.pow(c,u)),bitrate:i[0].maxBitrate?Math.ceil(i[0].maxBitrate/Math.pow(l,u)):0,ssrc:0}));return a}return i.map(n=>{var s,a,c;const l=(s=n.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let u=videoQualityForRid((a=n.rid)!==null&&a!==void 0?a:"");return new VideoLayer({quality:u,width:Math.ceil(o/l),height:Math.ceil(t/l),bitrate:(c=n.maxBitrate)!==null&&c!==void 0?c:0,ssrc:0})})}const lossyDataChannel="_lossy",reliableDataChannel="_reliable",minReconnectWait=2*1e3,leaveReconnect="leave-reconnect";var PCState;(function(o){o[o.New=0]="New",o[o.Connected=1]="Connected",o[o.Disconnected=2]="Disconnected",o[o.Reconnecting=3]="Reconnecting",o[o.Closed=4]="Closed"})(PCState||(PCState={}));class RTCEngine extends eventsExports.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(t){var i;super(),this.options=t,this.rtcConfig={},this.peerConnectionTimeout=roomConnectOptionDefaults.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.subscriberPrimary=!1,this.pcState=PCState.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=livekitLogger,this.handleDataChannel=e=>__awaiter(this,[e],void 0,function(n){var s=this;let{channel:a}=n;return function*(){if(a){if(a.label===reliableDataChannel)s.reliableDCSub=a;else if(a.label===lossyDataChannel)s.lossyDCSub=a;else return;s.log.debug("on data channel ".concat(a.id,", ").concat(a.label),s.logContext),a.onmessage=s.handleDataMessage}}()}),this.handleDataMessage=e=>__awaiter(this,void 0,void 0,function*(){var n,s;const a=yield this.dataProcessLock.lock();try{let c;if(e.data instanceof ArrayBuffer)c=e.data;else if(e.data instanceof Blob)c=yield e.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:e.data}));return}const l=DataPacket.fromBinary(new Uint8Array(c));((n=l.value)===null||n===void 0?void 0:n.case)==="speaker"?this.emit(EngineEvent.ActiveSpeakersUpdate,l.value.value.speakers):(((s=l.value)===null||s===void 0?void 0:s.case)==="user"&&applyUserDataCompat(l,l.value.value),this.emit(EngineEvent.DataPacketReceived,l))}finally{a()}}),this.handleDataError=e=>{const s=e.currentTarget.maxRetransmits===0?"lossy":"reliable";if(e instanceof ErrorEvent&&e.error){const{error:a}=e.error;this.log.error("DataChannel error on ".concat(s,": ").concat(e.message),Object.assign(Object.assign({},this.logContext),{error:a}))}else this.log.error("Unknown DataChannel error on ".concat(s),Object.assign(Object.assign({},this.logContext),{event:e}))},this.handleBufferedAmountLow=e=>{const s=e.currentTarget.maxRetransmits===0?DataPacket_Kind.LOSSY:DataPacket_Kind.RELIABLE;this.updateAndEmitDCBufferStatus(s)},this.handleDisconnect=(e,n)=>{if(this._isClosed)return;this.log.warn("".concat(e," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=l=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(l,"ms. giving up"),this.logContext),this.emit(EngineEvent.Disconnected),this.close()},a=Date.now()-this.reconnectStart;let c=this.getNextRetryDelay({elapsedMs:a,retryCount:this.reconnectAttempts});if(c===null){s(a);return}e===leaveReconnect&&(c=0),this.log.debug("reconnecting in ".concat(c,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=CriticalTimers.setTimeout(()=>this.attemptReconnect(n).finally(()=>this.reconnectTimeout=void 0),c)},this.waitForRestarted=()=>new Promise((e,n)=>{this.pcState===PCState.Connected&&e();const s=()=>{this.off(EngineEvent.Disconnected,a),e()},a=()=>{this.off(EngineEvent.Restarted,s),n()};this.once(EngineEvent.Restarted,s),this.once(EngineEvent.Disconnected,a)}),this.updateAndEmitDCBufferStatus=e=>{const n=this.isBufferStatusLow(e);typeof n<"u"&&n!==this.dcBufferStatus.get(e)&&(this.dcBufferStatus.set(e,n),this.emit(EngineEvent.DCBufferStatusChanged,n,e))},this.isBufferStatusLow=e=>{const n=this.dataChannelForKind(e);if(n)return n.bufferedAmount<=n.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===SignalConnectionState.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(ReconnectReason.RR_SIGNAL_DISCONNECTED))},this.log=getLogger((i=t.loggerName)!==null&&i!==void 0?i:LoggerNames.Engine),this.loggerOptions={loggerName:t.loggerName,loggerContextCb:()=>this.logContext},this.client=new SignalClient(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new Mutex,this.dataProcessLock=new Mutex,this.dcBufferStatus=new Map([[DataPacket_Kind.LOSSY,!0],[DataPacket_Kind.RELIABLE,!0]]),this.client.onParticipantUpdate=e=>this.emit(EngineEvent.ParticipantUpdate,e),this.client.onConnectionQuality=e=>this.emit(EngineEvent.ConnectionQualityUpdate,e),this.client.onRoomUpdate=e=>this.emit(EngineEvent.RoomUpdate,e),this.client.onSubscriptionError=e=>this.emit(EngineEvent.SubscriptionError,e),this.client.onSubscriptionPermissionUpdate=e=>this.emit(EngineEvent.SubscriptionPermissionUpdate,e),this.client.onSpeakersChanged=e=>this.emit(EngineEvent.SpeakersChanged,e),this.client.onStreamStateUpdate=e=>this.emit(EngineEvent.StreamStateChanged,e),this.client.onRequestResponse=e=>this.emit(EngineEvent.SignalRequestResponse,e)}get logContext(){var t,i,e,n,s,a,c,l;return{room:(i=(t=this.latestJoinResponse)===null||t===void 0?void 0:t.room)===null||i===void 0?void 0:i.name,roomID:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.sid,participant:(a=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||a===void 0?void 0:a.identity,pID:(l=(c=this.latestJoinResponse)===null||c===void 0?void 0:c.participant)===null||l===void 0?void 0:l.sid}}join(t,i,e,n){return __awaiter(this,void 0,void 0,function*(){this.url=t,this.token=i,this.signalOpts=e,this.maxJoinAttempts=e.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const s=yield this.client.join(t,i,e,n);return this._isClosed=!1,this.latestJoinResponse=s,this.subscriberPrimary=s.subscriberPrimary,this.pcManager||(yield this.configure(s)),this.subscriberPrimary||this.negotiate(),this.clientConfiguration=s.clientConfiguration,s}catch(s){if(s instanceof ConnectionError&&s.reason===1&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(t,i,e,n);throw s}})}close(){return __awaiter(this,void 0,void 0,function*(){const t=yield this.closingLock.lock();if(this.isClosed){t();return}try{this._isClosed=!0,this.emit(EngineEvent.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{t()}})}cleanupPeerConnections(){return __awaiter(this,void 0,void 0,function*(){var t;yield(t=this.pcManager)===null||t===void 0?void 0:t.close(),this.pcManager=void 0;const i=e=>{e&&(e.close(),e.onbufferedamountlow=null,e.onclose=null,e.onclosing=null,e.onerror=null,e.onmessage=null,e.onopen=null)};i(this.lossyDC),i(this.lossyDCSub),i(this.reliableDC),i(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0})}cleanupClient(){return __awaiter(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(t){if(this.pendingTrackResolvers[t.cid])throw new TrackInvalidError("a track with the same ID has already been published");return new Promise((i,e)=>{const n=setTimeout(()=>{delete this.pendingTrackResolvers[t.cid],e(new ConnectionError("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[t.cid]={resolve:s=>{clearTimeout(n),i(s)},reject:()=>{clearTimeout(n),e(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(t)})}removeTrack(t){if(t.track&&this.pendingTrackResolvers[t.track.id]){const{reject:i}=this.pendingTrackResolvers[t.track.id];i&&i(),delete this.pendingTrackResolvers[t.track.id]}try{return this.pcManager.removeTrack(t),!0}catch(i){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:i}))}return!1}updateMuteStatus(t,i){this.client.sendMuteTrack(t,i)}get dataSubscriberReadyState(){var t;return(t=this.reliableDCSub)===null||t===void 0?void 0:t.readyState}getConnectedServerAddress(){return __awaiter(this,void 0,void 0,function*(){var t;return(t=this.pcManager)===null||t===void 0?void 0:t.getConnectedAddress()})}setRegionUrlProvider(t){this.regionUrlProvider=t}configure(t){return __awaiter(this,void 0,void 0,function*(){var i,e;if(this.pcManager&&this.pcManager.currentState!==PCTransportState.NEW)return;this.participantSid=(i=t.participant)===null||i===void 0?void 0:i.sid;const n=this.makeRTCConfiguration(t);this.pcManager=new PCTransportManager(n,t.subscriberPrimary,this.loggerOptions),this.emit(EngineEvent.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(s,a)=>{this.client.sendIceCandidate(s,a)},this.pcManager.onPublisherOffer=s=>{this.client.sendOffer(s)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(s,a,c)=>__awaiter(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(s),this.logContext),["closed","disconnected","failed"].includes(a)&&(this.publisherConnectionPromise=void 0),s===PCTransportState.CONNECTED){const d=this.pcState===PCState.New;this.pcState=PCState.Connected,d&&this.emit(EngineEvent.Connected,t)}else s===PCTransportState.FAILED&&this.pcState===PCState.Connected&&(this.pcState=PCState.Disconnected,this.handleDisconnect("peerconnection failed",c==="failed"?ReconnectReason.RR_SUBSCRIBER_FAILED:ReconnectReason.RR_PUBLISHER_FAILED));const l=this.client.isDisconnected||this.client.currentState===SignalConnectionState.RECONNECTING,u=[PCTransportState.FAILED,PCTransportState.CLOSING,PCTransportState.CLOSED].includes(s);l&&u&&!this._isClosed&&this.emit(EngineEvent.Offline)}),this.pcManager.onTrack=s=>{this.emit(EngineEvent.MediaTrackAdded,s.track,s.streams[0],s.receiver)},supportOptionalDatachannel((e=t.serverInfo)===null||e===void 0?void 0:e.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=t=>__awaiter(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:t.type})),yield this.pcManager.setPublisherAnswer(t))}),this.client.onTrickle=(t,i)=>{this.pcManager&&(this.log.trace("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:t,target:i})),this.pcManager.addIceCandidate(t,i))},this.client.onOffer=t=>__awaiter(this,void 0,void 0,function*(){if(!this.pcManager)return;const i=yield this.pcManager.createSubscriberAnswerFromOffer(t);this.client.sendAnswer(i)}),this.client.onLocalTrackPublished=t=>{var i;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:t.cid,track:(i=t.track)===null||i===void 0?void 0:i.sid})),!this.pendingTrackResolvers[t.cid]){this.log.error("missing track resolver for ".concat(t.cid),Object.assign(Object.assign({},this.logContext),{cid:t.cid}));return}const{resolve:e}=this.pendingTrackResolvers[t.cid];delete this.pendingTrackResolvers[t.cid],e(t.track)},this.client.onLocalTrackUnpublished=t=>{this.emit(EngineEvent.LocalTrackUnpublished,t)},this.client.onLocalTrackSubscribed=t=>{this.emit(EngineEvent.LocalTrackSubscribed,t)},this.client.onTokenRefresh=t=>{this.token=t},this.client.onRemoteMuteChanged=(t,i)=>{this.emit(EngineEvent.RemoteMute,t,i)},this.client.onSubscribedQualityUpdate=t=>{this.emit(EngineEvent.SubscribedQualityUpdate,t)},this.client.onClose=()=>{this.handleDisconnect("signal",ReconnectReason.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=t=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:t==null?void 0:t.reason})),t.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(t.regions)),t.action){case LeaveRequest_Action.DISCONNECT:this.emit(EngineEvent.Disconnected,t==null?void 0:t.reason),this.close();break;case LeaveRequest_Action.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(leaveReconnect);break;case LeaveRequest_Action.RESUME:this.handleDisconnect(leaveReconnect)}}}makeRTCConfiguration(t){var i;const e=Object.assign({},this.rtcConfig);if(!((i=this.signalOpts)===null||i===void 0)&&i.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),e.encodedInsertableStreams=!0),t.iceServers&&!e.iceServers){const n=[];t.iceServers.forEach(s=>{const a={urls:s.urls};s.username&&(a.username=s.username),s.credential&&(a.credential=s.credential),n.push(a)}),e.iceServers=n}return t.clientConfiguration&&t.clientConfiguration.forceRelay===ClientConfigSetting.ENABLED&&(e.iceTransportPolicy="relay"),e.sdpSemantics="unified-plan",e.continualGatheringPolicy="gather_continually",e}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(lossyDataChannel,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(reliableDataChannel,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(t,i,e){return __awaiter(this,void 0,void 0,function*(){if(supportsTransceiver())return yield this.createTransceiverRTCRtpSender(t,i,e);if(supportsAddTrack())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(t.mediaStreamTrack);throw new UnexpectedConnectionState("Required webRTC APIs not supported on this device")})}createSimulcastSender(t,i,e,n){return __awaiter(this,void 0,void 0,function*(){if(supportsTransceiver())return this.createSimulcastTransceiverSender(t,i,e,n);if(supportsAddTrack())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(t.mediaStreamTrack);throw new UnexpectedConnectionState("Cannot stream on this device")})}createTransceiverRTCRtpSender(t,i,e){return __awaiter(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("publisher is closed");const n=[];t.mediaStream&&n.push(t.mediaStream),t instanceof LocalVideoTrack&&(t.codec=i.videoCodec);const s={direction:"sendonly",streams:n};return e&&(s.sendEncodings=e),(yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,s)).sender})}createSimulcastTransceiverSender(t,i,e,n){return __awaiter(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("publisher is closed");const s={direction:"sendonly"};n&&(s.sendEncodings=n);const a=yield this.pcManager.addPublisherTransceiver(i.mediaStreamTrack,s);if(e.videoCodec)return t.setSimulcastTrackSender(e.videoCodec,a.sender),a.sender})}createRTCRtpSender(t){return __awaiter(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("publisher is closed");return this.pcManager.addPublisherTrack(t)})}attemptReconnect(t){return __awaiter(this,void 0,void 0,function*(){var i,e,n;if(!this._isClosed){if(this.attemptingReconnect){livekitLogger.warn("already attempting reconnect, returning early",this.logContext);return}(((i=this.clientConfiguration)===null||i===void 0?void 0:i.resumeConnection)===ClientConfigSetting.DISABLED||((n=(e=this.pcManager)===null||e===void 0?void 0:e.currentState)!==null&&n!==void 0?n:PCTransportState.NEW)===PCTransportState.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(t),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let a=!0;s instanceof UnexpectedConnectionState?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),a=!1):s instanceof SignalReconnectError||(this.fullReconnectOnNext=!0),a?this.handleDisconnect("reconnect",ReconnectReason.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(EngineEvent.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(t){try{return this.reconnectPolicy.nextRetryDelayInMs(t)}catch(i){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:i}))}return null}restartConnection(t){return __awaiter(this,void 0,void 0,function*(){var i,e,n;try{if(!this.url||!this.token)throw new UnexpectedConnectionState("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(EngineEvent.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new SignalReconnectError;s=yield this.join(t??this.url,this.token,this.signalOpts)}catch(a){throw a instanceof ConnectionError&&a.reason===0?new UnexpectedConnectionState("could not reconnect, token might be expired"):new SignalReconnectError}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(EngineEvent.SignalRestarted,s),yield this.waitForPCReconnected(),this.client.currentState!==SignalConnectionState.CONNECTED)throw new SignalReconnectError("Signal connection got severed during reconnect");(i=this.regionUrlProvider)===null||i===void 0||i.resetAttempts(),this.emit(EngineEvent.Restarted)}catch(s){const a=yield(e=this.regionUrlProvider)===null||e===void 0?void 0:e.getNextBestRegionUrl();if(a){yield this.restartConnection(a);return}else throw(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),s}})}resumeConnection(t){return __awaiter(this,void 0,void 0,function*(){var i;if(!this.url||!this.token)throw new UnexpectedConnectionState("could not reconnect, url or token not saved");if(!this.pcManager)throw new UnexpectedConnectionState("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(EngineEvent.Resuming);let e;try{this.setupSignalClientCallbacks(),e=yield this.client.reconnect(this.url,this.token,this.participantSid,t)}catch(n){let s="";throw n instanceof Error&&(s=n.message,this.log.error(n.message,Object.assign(Object.assign({},this.logContext),{error:n}))),n instanceof ConnectionError&&n.reason===0?new UnexpectedConnectionState("could not reconnect, token might be expired"):n instanceof ConnectionError&&n.reason===4?n:new SignalReconnectError(s)}if(this.emit(EngineEvent.SignalResumed),e){const n=this.makeRTCConfiguration(e);this.pcManager.updateConfiguration(n)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==SignalConnectionState.CONNECTED)throw new SignalReconnectError("Signal connection got severed during reconnect");this.client.setReconnected(),((i=this.reliableDC)===null||i===void 0?void 0:i.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),this.emit(EngineEvent.Resumed)})}waitForPCInitialConnection(t,i){return __awaiter(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(i,t)})}waitForPCReconnected(){return __awaiter(this,void 0,void 0,function*(){this.pcState=PCState.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield sleep(minReconnectWait),!this.pcManager)throw new UnexpectedConnectionState("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=PCState.Connected}catch(t){throw this.pcState=PCState.Disconnected,new ConnectionError("could not establish PC connection, ".concat(t.message))}})}sendDataPacket(t,i){return __awaiter(this,void 0,void 0,function*(){const e=t.toBinary();yield this.ensurePublisherConnected(i);const n=this.dataChannelForKind(i);n&&n.send(e),this.updateAndEmitDCBufferStatus(i)})}ensureDataTransportConnected(t){return __awaiter(this,arguments,void 0,function(i){var e=this;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var s;if(!e.pcManager)throw new UnexpectedConnectionState("PC manager is closed");const a=n?e.pcManager.subscriber:e.pcManager.publisher,c=n?"Subscriber":"Publisher";if(!a)throw new ConnectionError("".concat(c," connection not set"));let l=!1;!n&&!e.dataChannelForKind(i,n)&&(e.createDataChannels(),l=!0),!l&&!n&&!e.pcManager.publisher.isICEConnected&&e.pcManager.publisher.getICEConnectionState()!=="checking"&&(l=!0),l&&e.negotiate();const u=e.dataChannelForKind(i,n);if((u==null?void 0:u.readyState)==="open")return;const d=new Date().getTime()+e.peerConnectionTimeout;for(;new Date().getTime()<d;){if(a.isICEConnected&&((s=e.dataChannelForKind(i,n))===null||s===void 0?void 0:s.readyState)==="open")return;yield sleep(50)}throw new ConnectionError("could not establish ".concat(c," connection, state: ").concat(a.getICEConnectionState()))}()})}ensurePublisherConnected(t){return __awaiter(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(t,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==PCTransportState.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return __awaiter(this,void 0,void 0,function*(){return new Promise((t,i)=>__awaiter(this,void 0,void 0,function*(){if(!this.pcManager){i(new NegotiationError("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const e=new AbortController,n=()=>{e.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),t()};this.isClosed&&i("cannot negotiate on closed engine"),this.on(EngineEvent.Closing,n),this.pcManager.publisher.once(PCEvents.RTPVideoPayloadTypes,s=>{const a=new Map;s.forEach(c=>{const l=c.codec.toLowerCase();isVideoCodec(l)&&a.set(c.payload,l)}),this.emit(EngineEvent.RTPVideoMapUpdate,a)});try{yield this.pcManager.negotiate(e),t()}catch(s){s instanceof NegotiationError&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",ReconnectReason.RR_UNKNOWN),i(s)}finally{this.off(EngineEvent.Closing,n)}}))})}dataChannelForKind(t,i){if(i){if(t===DataPacket_Kind.LOSSY)return this.lossyDCSub;if(t===DataPacket_Kind.RELIABLE)return this.reliableDCSub}else{if(t===DataPacket_Kind.LOSSY)return this.lossyDC;if(t===DataPacket_Kind.RELIABLE)return this.reliableDC}}sendSyncState(t,i){var e,n;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const s=this.pcManager.subscriber.getLocalDescription(),a=this.pcManager.subscriber.getRemoteDescription(),c=(n=(e=this.signalOpts)===null||e===void 0?void 0:e.autoSubscribe)!==null&&n!==void 0?n:!0,l=new Array,u=new Array;t.forEach(d=>{d.isDesired!==c&&l.push(d.trackSid),d.isEnabled||u.push(d.trackSid)}),this.client.sendSyncState(new SyncState({answer:s?toProtoSessionDescription({sdp:s.sdp,type:s.type}):void 0,offer:a?toProtoSessionDescription({sdp:a.sdp,type:a.type}):void 0,subscription:new UpdateSubscription({trackSids:l,subscribe:!c,participantTracks:[]}),publishTracks:getTrackPublicationInfo(i),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:u}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const t=[],i=(e,n)=>{(e==null?void 0:e.id)!==void 0&&e.id!==null&&t.push(new DataChannelInfo({label:e.label,id:e.id,target:n}))};return i(this.dataChannelForKind(DataPacket_Kind.LOSSY),SignalTarget.PUBLISHER),i(this.dataChannelForKind(DataPacket_Kind.RELIABLE),SignalTarget.PUBLISHER),i(this.dataChannelForKind(DataPacket_Kind.LOSSY,!0),SignalTarget.SUBSCRIBER),i(this.dataChannelForKind(DataPacket_Kind.RELIABLE,!0),SignalTarget.SUBSCRIBER),t}clearReconnectTimeout(){this.reconnectTimeout&&CriticalTimers.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){isWeb()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){isWeb()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class SignalReconnectError extends Error{}function supportOptionalDatachannel(o){return o!==void 0&&o>13}function applyUserDataCompat(o,t){const i=o.participantIdentity?o.participantIdentity:t.participantIdentity;o.participantIdentity=i,t.participantIdentity=i;const e=o.destinationIdentities.length!==0?o.destinationIdentities:t.destinationIdentities;o.destinationIdentities=e,t.destinationIdentities=e}class RegionUrlProvider{constructor(t,i){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(t),this.token=i}updateToken(t){this.token=t}isCloud(){return isCloud(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(t){return __awaiter(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(t));const i=this.regionSettings.regions.filter(e=>!this.attemptedRegions.find(n=>n.url===e.url));if(i.length>0){const e=i[0];return this.attemptedRegions.push(e),livekitLogger.debug("next region: ".concat(e.region)),e.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(t){return __awaiter(this,void 0,void 0,function*(){const i=yield fetch("".concat(getCloudConfigUrl(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:t});if(i.ok){const e=yield i.json();return this.lastUpdateAt=Date.now(),e}else throw new ConnectionError("Could not fetch region settings: ".concat(i.statusText),i.status===401?0:void 0,i.status)})}setServerReportedRegions(t){this.regionSettings=t,this.lastUpdateAt=Date.now()}}function getCloudConfigUrl(o){return"".concat(o.protocol.replace("ws","http"),"//").concat(o.host,"/settings")}class RemoteTrack extends Track{constructor(t,i,e,n,s){super(t,e,s),this.sid=i,this.receiver=n}setMuted(t){this.isMuted!==t&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?TrackEvent.Muted:TrackEvent.Unmuted,this))}setMediaStream(t){this.mediaStream=t;const i=e=>{e.track===this._mediaStreamTrack&&(t.removeEventListener("removetrack",i),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(TrackEvent.Ended,this))};t.addEventListener("removetrack",i)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return __awaiter(this,void 0,void 0,function*(){var t;return!((t=this.receiver)===null||t===void 0)&&t.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(t){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=t:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),monitorFrequency)),supportsSynchronizationSources()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const t=()=>{var i;this.timeSyncHandle=requestAnimationFrame(()=>t());const e=(i=this.receiver)===null||i===void 0?void 0:i.getSynchronizationSources()[0];if(e){const{timestamp:n,rtpTimestamp:s}=e;s&&this.rtpTimestamp!==s&&(this.emit(TrackEvent.TimeSyncUpdate,{timestamp:n,rtpTimestamp:s}),this.rtpTimestamp=s)}};t()}}class RemoteAudioTrack extends RemoteTrack{constructor(t,i,e,n,s,a){super(t,i,Track.Kind.Audio,e,a),this.monitorReceiver=()=>__awaiter(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const c=yield this.getReceiverStats();c&&this.prevStats&&this.receiver&&(this._currentBitrate=computeBitrate(c,this.prevStats)),this.prevStats=c}),this.audioContext=n,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(t){var i;for(const e of this.attachedElements)this.audioContext?(i=this.gainNode)===null||i===void 0||i.gain.setTargetAtTime(t,0,.1):e.volume=t;isReactNative()&&this._mediaStreamTrack._setVolume(t),this.elementVolume=t}getVolume(){if(this.elementVolume)return this.elementVolume;if(isReactNative())return 1;let t=0;return this.attachedElements.forEach(i=>{i.volume>t&&(t=i.volume)}),t}setSinkId(t){return __awaiter(this,void 0,void 0,function*(){this.sinkId=t,yield Promise.all(this.attachedElements.map(i=>{if(supportsSetSinkId(i))return i.setSinkId(t)}))})}attach(t){const i=this.attachedElements.length===0;return t?super.attach(t):t=super.attach(),this.sinkId&&supportsSetSinkId(t)&&t.setSinkId(this.sinkId),this.audioContext&&i&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,t),t.volume=0,t.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),t}detach(t){let i;return t?(i=super.detach(t),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(i=super.detach(),this.disconnectWebAudio()),i}setAudioContext(t){this.audioContext=t,t&&this.attachedElements.length>0?this.connectWebAudio(t,this.attachedElements[0]):t||this.disconnectWebAudio()}setWebAudioPlugins(t){this.webAudioPluginNodes=t,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(t,i){this.disconnectWebAudio(),this.sourceNode=t.createMediaStreamSource(i.srcObject);let e=this.sourceNode;this.webAudioPluginNodes.forEach(n=>{e.connect(n),e=n}),this.gainNode=t.createGain(),e.connect(this.gainNode),this.gainNode.connect(t.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),t.state!=="running"&&t.resume().then(()=>{t.state!=="running"&&this.emit(TrackEvent.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(n=>{this.emit(TrackEvent.AudioPlaybackFailed,n)})}disconnectWebAudio(){var t,i;(t=this.gainNode)===null||t===void 0||t.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return __awaiter(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const t=yield this.receiver.getStats();let i;return t.forEach(e=>{e.type==="inbound-rtp"&&(i={type:"audio",timestamp:e.timestamp,jitter:e.jitter,bytesReceived:e.bytesReceived,concealedSamples:e.concealedSamples,concealmentEvents:e.concealmentEvents,silentConcealedSamples:e.silentConcealedSamples,silentConcealmentEvents:e.silentConcealmentEvents,totalAudioEnergy:e.totalAudioEnergy,totalSamplesDuration:e.totalSamplesDuration})}),i})}}const REACTION_DELAY=100;class RemoteVideoTrack extends RemoteTrack{constructor(t,i,e,n,s){super(t,i,Track.Kind.Video,e,s),this.elementInfos=[],this.monitorReceiver=()=>__awaiter(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=computeBitrate(a,this.prevStats)),this.prevStats=a}),this.debouncedHandleResize=r(()=>{this.updateDimensions()},REACTION_DELAY),this.adaptiveStreamSettings=n}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(t){super.setMuted(t),this.attachedElements.forEach(i=>{t?detachTrack(this._mediaStreamTrack,i):attachToElement(this._mediaStreamTrack,i)})}attach(t){if(t?super.attach(t):t=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(i=>i.element===t)===void 0){const i=new HTMLElementInfo(t);this.observeElementInfo(i)}return t}observeElementInfo(t){this.adaptiveStreamSettings&&this.elementInfos.find(i=>i===t)===void 0?(t.handleResize=()=>{this.debouncedHandleResize()},t.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(t),t.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(t){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const i=this.elementInfos.filter(e=>e===t);for(const e of i)e.stopObserving();this.elementInfos=this.elementInfos.filter(e=>e!==t),this.updateVisibility(),this.debouncedHandleResize()}detach(t){let i=[];if(t)return this.stopObservingElement(t),super.detach(t);i=super.detach();for(const e of i)this.stopObservingElement(e);return i}getDecoderImplementation(){var t;return(t=this.prevStats)===null||t===void 0?void 0:t.decoderImplementation}getReceiverStats(){return __awaiter(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const t=yield this.receiver.getStats();let i,e="",n=new Map;return t.forEach(s=>{s.type==="inbound-rtp"?(e=s.codecId,i={type:"video",framesDecoded:s.framesDecoded,framesDropped:s.framesDropped,framesReceived:s.framesReceived,packetsReceived:s.packetsReceived,packetsLost:s.packetsLost,frameWidth:s.frameWidth,frameHeight:s.frameHeight,pliCount:s.pliCount,firCount:s.firCount,nackCount:s.nackCount,jitter:s.jitter,timestamp:s.timestamp,bytesReceived:s.bytesReceived,decoderImplementation:s.decoderImplementation}):s.type==="codec"&&n.set(s.id,s)}),i&&e!==""&&n.get(e)&&(i.mimeType=n.get(e).mimeType),i})}stopObservingElement(t){const i=this.elementInfos.filter(e=>e.element===t);for(const e of i)this.stopObservingElementInfo(e)}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return __awaiter(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var t,i;const e=this.elementInfos.reduce((c,l)=>Math.max(c,l.visibilityChangedAt||0),0),n=!((i=(t=this.adaptiveStreamSettings)===null||t===void 0?void 0:t.pauseVideoInBackground)!==null&&i!==void 0)||i?this.isInBackground:!1,s=this.elementInfos.some(c=>c.pictureInPicture),a=this.elementInfos.some(c=>c.visible)&&!n||s;if(this.lastVisible!==a){if(!a&&Date.now()-e<REACTION_DELAY){CriticalTimers.setTimeout(()=>{this.updateVisibility()},REACTION_DELAY);return}this.lastVisible=a,this.emit(TrackEvent.VisibilityChanged,a,this)}}updateDimensions(){var t,i;let e=0,n=0;const s=this.getPixelDensity();for(const a of this.elementInfos){const c=a.width()*s,l=a.height()*s;c+l>e+n&&(e=c,n=l)}((t=this.lastDimensions)===null||t===void 0?void 0:t.width)===e&&((i=this.lastDimensions)===null||i===void 0?void 0:i.height)===n||(this.lastDimensions={width:e,height:n},this.emit(TrackEvent.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var t;const i=(t=this.adaptiveStreamSettings)===null||t===void 0?void 0:t.pixelDensity;return i==="screen"?getDevicePixelRatio():i||(getDevicePixelRatio()>2?2:1)}}class HTMLElementInfo{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(t,i){this.onVisibilityChanged=e=>{var n;const{target:s,isIntersecting:a}=e;s===this.element&&(this.isIntersecting=a,this.visibilityChangedAt=Date.now(),(n=this.handleVisibilityChanged)===null||n===void 0||n.call(this))},this.onEnterPiP=()=>{var e;this.isPiP=!0,(e=this.handleVisibilityChanged)===null||e===void 0||e.call(this)},this.onLeavePiP=()=>{var e;this.isPiP=!1,(e=this.handleVisibilityChanged)===null||e===void 0||e.call(this)},this.element=t,this.isIntersecting=i??isElementInViewport(t),this.isPiP=isWeb()&&document.pictureInPictureElement===t,this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){this.isIntersecting=isElementInViewport(this.element),this.isPiP=document.pictureInPictureElement===this.element,this.element.handleResize=()=>{var t;(t=this.handleResize)===null||t===void 0||t.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,getIntersectionObserver().observe(this.element),getResizeObserver().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP)}stopObserving(){var t,i;(t=getIntersectionObserver())===null||t===void 0||t.unobserve(this.element),(i=getResizeObserver())===null||i===void 0||i.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP)}}function isElementInViewport(o){let t=o.offsetTop,i=o.offsetLeft;const e=o.offsetWidth,n=o.offsetHeight,{hidden:s}=o,{opacity:a,display:c}=getComputedStyle(o);for(;o.offsetParent;)o=o.offsetParent,t+=o.offsetTop,i+=o.offsetLeft;return t<window.pageYOffset+window.innerHeight&&i<window.pageXOffset+window.innerWidth&&t+n>window.pageYOffset&&i+e>window.pageXOffset&&!s&&(a!==""?parseFloat(a)>0:!0)&&c!=="none"}class TrackPublication extends eventsExports.EventEmitter{constructor(t,i,e,n){var s;super(),this.metadataMuted=!1,this.encryption=Encryption_Type.NONE,this.log=livekitLogger,this.handleMuted=()=>{this.emit(TrackEvent.Muted)},this.handleUnmuted=()=>{this.emit(TrackEvent.Unmuted)},this.log=getLogger((s=n==null?void 0:n.loggerName)!==null&&s!==void 0?s:LoggerNames.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=t,this.trackSid=i,this.trackName=e,this.source=Track.Source.Unknown}setTrack(t){this.track&&(this.track.off(TrackEvent.Muted,this.handleMuted),this.track.off(TrackEvent.Unmuted,this.handleUnmuted)),this.track=t,t&&(t.on(TrackEvent.Muted,this.handleMuted),t.on(TrackEvent.Unmuted,this.handleUnmuted))}get logContext(){var t;return Object.assign(Object.assign({},(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this)),getLogContextFromTrack(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==Encryption_Type.NONE}get audioTrack(){if(this.track instanceof LocalAudioTrack||this.track instanceof RemoteAudioTrack)return this.track}get videoTrack(){if(this.track instanceof LocalVideoTrack||this.track instanceof RemoteVideoTrack)return this.track}updateInfo(t){this.trackSid=t.sid,this.trackName=t.name,this.source=Track.sourceFromProto(t.source),this.mimeType=t.mimeType,this.kind===Track.Kind.Video&&t.width>0&&(this.dimensions={width:t.width,height:t.height},this.simulcasted=t.simulcast),this.encryption=t.encryption,this.trackInfo=t,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:t}))}}(function(o){(function(t){t.Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed"})(o.SubscriptionStatus||(o.SubscriptionStatus={})),function(t){t.Allowed="allowed",t.NotAllowed="not_allowed"}(o.PermissionStatus||(o.PermissionStatus={}))})(TrackPublication||(TrackPublication={}));class LocalTrackPublication extends TrackPublication{get isUpstreamPaused(){var t;return(t=this.track)===null||t===void 0?void 0:t.isUpstreamPaused}constructor(t,i,e,n){super(t,i.sid,i.name,n),this.track=void 0,this.handleTrackEnded=()=>{this.emit(TrackEvent.Ended)},this.updateInfo(i),this.setTrack(e)}setTrack(t){this.track&&this.track.off(TrackEvent.Ended,this.handleTrackEnded),super.setTrack(t),t&&t.on(TrackEvent.Ended,this.handleTrackEnded)}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}mute(){return __awaiter(this,void 0,void 0,function*(){var t;return(t=this.track)===null||t===void 0?void 0:t.mute()})}unmute(){return __awaiter(this,void 0,void 0,function*(){var t;return(t=this.track)===null||t===void 0?void 0:t.unmute()})}pauseUpstream(){return __awaiter(this,void 0,void 0,function*(){var t;yield(t=this.track)===null||t===void 0?void 0:t.pauseUpstream()})}resumeUpstream(){return __awaiter(this,void 0,void 0,function*(){var t;yield(t=this.track)===null||t===void 0?void 0:t.resumeUpstream()})}getTrackFeatures(){var t;if(this.track instanceof LocalAudioTrack){const i=this.track.mediaStreamTrack.getSettings(),e=new Set;return i.autoGainControl&&e.add(AudioTrackFeature.TF_AUTO_GAIN_CONTROL),i.echoCancellation&&e.add(AudioTrackFeature.TF_ECHO_CANCELLATION),i.noiseSuppression&&e.add(AudioTrackFeature.TF_NOISE_SUPPRESSION),i.channelCount&&i.channelCount>1&&e.add(AudioTrackFeature.TF_STEREO),!((t=this.options)===null||t===void 0)&&t.dtx||e.add(AudioTrackFeature.TF_STEREO),this.track.enhancedNoiseCancellation&&e.add(AudioTrackFeature.TF_ENHANCED_NOISE_CANCELLATION),Array.from(e.values())}else return[]}}var ConnectionQuality;(function(o){o.Excellent="excellent",o.Good="good",o.Poor="poor",o.Lost="lost",o.Unknown="unknown"})(ConnectionQuality||(ConnectionQuality={}));function qualityFromProto(o){switch(o){case ConnectionQuality$1.EXCELLENT:return ConnectionQuality.Excellent;case ConnectionQuality$1.GOOD:return ConnectionQuality.Good;case ConnectionQuality$1.POOR:return ConnectionQuality.Poor;case ConnectionQuality$1.LOST:return ConnectionQuality.Lost;default:return ConnectionQuality.Unknown}}class Participant extends eventsExports.EventEmitter{get logContext(){var t,i;return Object.assign({},(i=(t=this.loggerOptions)===null||t===void 0?void 0:t.loggerContextCb)===null||i===void 0?void 0:i.call(t))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(t=>t.isEncrypted)}get isAgent(){var t;return((t=this.permissions)===null||t===void 0?void 0:t.agent)||this.kind===ParticipantInfo_Kind.AGENT}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(t,i,e,n,s){let a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:ParticipantInfo_Kind.STANDARD;var c;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=ConnectionQuality.Unknown,this.log=livekitLogger,this.log=getLogger((c=s==null?void 0:s.loggerName)!==null&&c!==void 0?c:LoggerNames.Participant),this.loggerOptions=s,this.setMaxListeners(100),this.sid=t,this.identity=i,this.name=e,this.metadata=n,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes={}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(t){for(const[,i]of this.trackPublications)if(i.source===t)return i}getTrackPublicationByName(t){for(const[,i]of this.trackPublications)if(i.trackName===t)return i}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var t;const i=this.getTrackPublication(Track.Source.Camera);return!(!((t=i==null?void 0:i.isMuted)!==null&&t!==void 0)||t)}get isMicrophoneEnabled(){var t;const i=this.getTrackPublication(Track.Source.Microphone);return!(!((t=i==null?void 0:i.isMuted)!==null&&t!==void 0)||t)}get isScreenShareEnabled(){return!!this.getTrackPublication(Track.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(t){return this.participantInfo&&this.participantInfo.sid===t.sid&&this.participantInfo.version>t.version?!1:(this.identity=t.identity,this.sid=t.sid,this._setName(t.name),this._setMetadata(t.metadata),this._setAttributes(t.attributes),t.permission&&this.setPermissions(t.permission),this.participantInfo=t,this.log.trace("update participant info",Object.assign(Object.assign({},this.logContext),{info:t})),!0)}_setMetadata(t){const i=this.metadata!==t,e=this.metadata;this.metadata=t,i&&this.emit(ParticipantEvent.ParticipantMetadataChanged,e)}_setName(t){const i=this.name!==t;this.name=t,i&&this.emit(ParticipantEvent.ParticipantNameChanged,t)}_setAttributes(t){const i=diffAttributes(t,this.attributes);this._attributes=t,Object.keys(i).length>0&&this.emit(ParticipantEvent.AttributesChanged,i)}setPermissions(t){var i,e,n,s,a;const c=this.permissions,l=t.canPublish!==((i=this.permissions)===null||i===void 0?void 0:i.canPublish)||t.canSubscribe!==((e=this.permissions)===null||e===void 0?void 0:e.canSubscribe)||t.canPublishData!==((n=this.permissions)===null||n===void 0?void 0:n.canPublishData)||t.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||t.recorder!==((a=this.permissions)===null||a===void 0?void 0:a.recorder)||t.canPublishSources.length!==this.permissions.canPublishSources.length||t.canPublishSources.some((u,d)=>{var f;return u!==((f=this.permissions)===null||f===void 0?void 0:f.canPublishSources[d])});return this.permissions=t,l&&this.emit(ParticipantEvent.ParticipantPermissionsChanged,c),l}setIsSpeaking(t){t!==this.isSpeaking&&(this.isSpeaking=t,t&&(this.lastSpokeAt=new Date),this.emit(ParticipantEvent.IsSpeakingChanged,t))}setConnectionQuality(t){const i=this._connectionQuality;this._connectionQuality=qualityFromProto(t),i!==this._connectionQuality&&this.emit(ParticipantEvent.ConnectionQualityChanged,this._connectionQuality)}setAudioContext(t){this.audioContext=t,this.audioTrackPublications.forEach(i=>(i.track instanceof RemoteAudioTrack||i.track instanceof LocalAudioTrack)&&i.track.setAudioContext(t))}addTrackPublication(t){t.on(TrackEvent.Muted,()=>{this.emit(ParticipantEvent.TrackMuted,t)}),t.on(TrackEvent.Unmuted,()=>{this.emit(ParticipantEvent.TrackUnmuted,t)});const i=t;switch(i.track&&(i.track.sid=t.trackSid),this.trackPublications.set(t.trackSid,t),t.kind){case Track.Kind.Audio:this.audioTrackPublications.set(t.trackSid,t);break;case Track.Kind.Video:this.videoTrackPublications.set(t.trackSid,t);break}}}function trackPermissionToProto(o){var t,i,e;if(!o.participantSid&&!o.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new TrackPermission({participantIdentity:(t=o.participantIdentity)!==null&&t!==void 0?t:"",participantSid:(i=o.participantSid)!==null&&i!==void 0?i:"",allTracks:(e=o.allowAll)!==null&&e!==void 0?e:!1,trackSids:o.allowedTrackSids||[]})}class LocalParticipant extends Participant{constructor(t,i,e,n){super(t,i,void 0,void 0,{loggerName:n.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Encryption_Type.NONE,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Future)},this.handleReconnected=()=>{var s,a;(a=(s=this.reconnectFuture)===null||s===void 0?void 0:s.resolve)===null||a===void 0||a.call(s),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var s,a;this.reconnectFuture&&(this.reconnectFuture.promise.catch(c=>this.log.warn(c.message,this.logContext)),(a=(s=this.reconnectFuture)===null||s===void 0?void 0:s.reject)===null||a===void 0||a.call(s,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0)},this.handleSignalRequestResponse=s=>{const{requestId:a,reason:c,message:l}=s,u=this.pendingSignalRequests.get(a);u&&(c!==RequestResponse_Reason.OK&&u.reject(new SignalRequestError(l,c)),this.pendingSignalRequests.delete(a))},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(s=>trackPermissionToProto(s)))},this.onTrackUnmuted=s=>{this.onTrackMuted(s,s.isUpstreamPaused)},this.onTrackMuted=(s,a)=>{if(a===void 0&&(a=!0),!s.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(s)));return}this.engine.updateMuteStatus(s.sid,a)},this.onTrackUpstreamPaused=s=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(s))),this.onTrackMuted(s,!0)},this.onTrackUpstreamResumed=s=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(s))),this.onTrackMuted(s,s.isMuted)},this.onTrackFeatureUpdate=s=>{const a=this.audioTrackPublications.get(s.sid);if(!a){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(s.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(a.trackSid,a.getTrackFeatures())},this.handleSubscribedQualityUpdate=s=>__awaiter(this,void 0,void 0,function*(){var a,c,l,u,d,f;if(!(!((d=this.roomOptions)===null||d===void 0)&&d.dynacast))return;const h=this.videoTrackPublications.get(s.trackSid);if(!h){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:s.trackSid}));return}if(s.subscribedCodecs.length>0){if(!h.videoTrack)return;const v=yield h.videoTrack.setPublishingCodecs(s.subscribedCodecs);try{for(var p=!0,m=__asyncValues(v),g;g=yield m.next(),a=g.done,!a;p=!0){u=g.value,p=!1;const T=u;isBackupCodec(T)&&(this.log.debug("publish ".concat(T," for ").concat(h.videoTrack.sid),Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(h))),yield this.publishAdditionalCodecForTrack(h.videoTrack,T,h.options))}}catch(T){c={error:T}}finally{try{!p&&!a&&(l=m.return)&&(yield l.call(m))}finally{if(c)throw c.error}}}else s.subscribedQualities.length>0&&(yield(f=h.videoTrack)===null||f===void 0?void 0:f.setPublishingLayers(s.subscribedQualities))}),this.handleLocalTrackUnpublished=s=>{const a=this.trackPublications.get(s.trackSid);if(!a){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:s.trackSid}));return}this.unpublishTrack(a.track)},this.handleTrackEnded=s=>__awaiter(this,void 0,void 0,function*(){if(s.source===Track.Source.ScreenShare||s.source===Track.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(s))),this.unpublishTrack(s);else if(s.isUserProvided)yield s.mute();else if(s instanceof LocalAudioTrack||s instanceof LocalVideoTrack)try{if(isWeb())try{const a=yield navigator==null?void 0:navigator.permissions.query({name:s.source===Track.Source.Camera?"camera":"microphone"});if(a&&a.state==="denied")throw this.log.warn("user has revoked access to ".concat(s.source),Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(s))),a.onchange=()=>{a.state!=="denied"&&(s.isMuted||s.restartTrack(),a.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}s.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(s))),yield s.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(s))),yield s.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=e,this.roomOptions=n,this.setupEngine(e),this.activeDeviceMap=new Map,this.pendingSignalRequests=new Map}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Encryption_Type.NONE}getTrackPublication(t){const i=super.getTrackPublication(t);if(i)return i}getTrackPublicationByName(t){const i=super.getTrackPublicationByName(t);if(i)return i}setupEngine(t){this.engine=t,this.engine.on(EngineEvent.RemoteMute,(i,e)=>{const n=this.trackPublications.get(i);!n||!n.track||(e?n.mute():n.unmute())}),this.engine.on(EngineEvent.Connected,this.handleReconnected).on(EngineEvent.SignalRestarted,this.handleReconnected).on(EngineEvent.SignalResumed,this.handleReconnected).on(EngineEvent.Restarting,this.handleReconnecting).on(EngineEvent.Resuming,this.handleReconnecting).on(EngineEvent.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(EngineEvent.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(EngineEvent.Disconnected,this.handleDisconnected).on(EngineEvent.SignalRequestResponse,this.handleSignalRequestResponse)}setMetadata(t){return __awaiter(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:t})})}setName(t){return __awaiter(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:t})})}setAttributes(t){return __awaiter(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:t})})}requestMetadataUpdate(t){return __awaiter(this,arguments,void 0,function(i){var e=this;let{metadata:n,name:s,attributes:a}=i;return function*(){return new Promise((c,l)=>__awaiter(e,void 0,void 0,function*(){var u,d;try{let f=!1;const h=yield this.engine.client.sendUpdateLocalMetadata((u=n??this.metadata)!==null&&u!==void 0?u:"",(d=s??this.name)!==null&&d!==void 0?d:"",a),p=performance.now();for(this.pendingSignalRequests.set(h,{resolve:c,reject:m=>{l(m),f=!0},values:{name:s,metadata:n,attributes:a}});performance.now()-p<5e3&&!f;){if((!s||this.name===s)&&(!n||this.metadata===n)&&(!a||Object.entries(a).every(m=>{let[g,v]=m;return this.attributes[g]===v}))){this.pendingSignalRequests.delete(h),c();return}yield sleep(50)}l(new SignalRequestError("Request to update local metadata timed out","TimeoutError"))}catch(f){f instanceof Error&&l(f)}}))}()})}setCameraEnabled(t,i,e){return this.setTrackEnabled(Track.Source.Camera,t,i,e)}setMicrophoneEnabled(t,i,e){return this.setTrackEnabled(Track.Source.Microphone,t,i,e)}setScreenShareEnabled(t,i,e){return this.setTrackEnabled(Track.Source.ScreenShare,t,i,e)}setPermissions(t){const i=this.permissions,e=super.setPermissions(t);return e&&i&&this.emit(ParticipantEvent.ParticipantPermissionsChanged,i),e}setE2EEEnabled(t){return __awaiter(this,void 0,void 0,function*(){this.encryptionType=t?Encryption_Type.GCM:Encryption_Type.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(t,i,e,n){return __awaiter(this,void 0,void 0,function*(){var s,a;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:t,enabled:i}));let c=this.getTrackPublication(t);if(i)if(c)yield c.unmute();else{let l;if(this.pendingPublishing.has(t)){this.log.info("skipping duplicate published source",Object.assign(Object.assign({},this.logContext),{source:t}));return}this.pendingPublishing.add(t);try{switch(t){case Track.Source.Camera:l=yield this.createTracks({video:(s=e)!==null&&s!==void 0?s:!0});break;case Track.Source.Microphone:l=yield this.createTracks({audio:(a=e)!==null&&a!==void 0?a:!0});break;case Track.Source.ScreenShare:l=yield this.createScreenTracks(Object.assign({},e));break;default:throw new TrackInvalidError(t)}const u=[];for(const f of l)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(f))),u.push(this.publishTrack(f,n));[c]=yield Promise.all(u)}catch(u){throw l==null||l.forEach(d=>{d.stop()}),u instanceof Error&&!(u instanceof TrackInvalidError)&&this.emit(ParticipantEvent.MediaDevicesError,u),u}finally{this.pendingPublishing.delete(t)}}else if(c&&c.track)if(t===Track.Source.ScreenShare){c=yield this.unpublishTrack(c.track);const l=this.getTrackPublication(Track.Source.ScreenShareAudio);l&&l.track&&this.unpublishTrack(l.track)}else yield c.mute();return c})}enableCameraAndMicrophone(){return __awaiter(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(Track.Source.Camera)||this.pendingPublishing.has(Track.Source.Microphone))){this.pendingPublishing.add(Track.Source.Camera),this.pendingPublishing.add(Track.Source.Microphone);try{const t=yield this.createTracks({audio:!0,video:!0});yield Promise.all(t.map(i=>this.publishTrack(i)))}finally{this.pendingPublishing.delete(Track.Source.Camera),this.pendingPublishing.delete(Track.Source.Microphone)}}})}createTracks(t){return __awaiter(this,void 0,void 0,function*(){var i,e;const n=mergeDefaultOptions(t,(i=this.roomOptions)===null||i===void 0?void 0:i.audioCaptureDefaults,(e=this.roomOptions)===null||e===void 0?void 0:e.videoCaptureDefaults),s=constraintsForOptions(n);let a;try{a=yield navigator.mediaDevices.getUserMedia(s)}catch(c){throw c instanceof Error&&(s.audio&&(this.microphoneError=c),s.video&&(this.cameraError=c)),c}return s.audio&&(this.microphoneError=void 0,this.emit(ParticipantEvent.AudioStreamAcquired)),s.video&&(this.cameraError=void 0),Promise.all(a.getTracks().map(c=>__awaiter(this,void 0,void 0,function*(){const l=c.kind==="audio";let u=l?n.audio:n.video;(typeof u=="boolean"||!u)&&(u={});let d;const f=l?s.audio:s.video;typeof f!="boolean"&&(d=f);const h=mediaTrackToLocalTrack(c,d,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return h.kind===Track.Kind.Video?h.source=Track.Source.Camera:h.kind===Track.Kind.Audio&&(h.source=Track.Source.Microphone,h.setAudioContext(this.audioContext)),h.mediaStream=a,u.processor&&(h instanceof LocalAudioTrack?yield h.setProcessor(u.processor):yield h.setProcessor(u.processor)),h})))})}createScreenTracks(t){return __awaiter(this,void 0,void 0,function*(){if(t===void 0&&(t={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new DeviceUnsupportedError("getDisplayMedia not supported");t.resolution===void 0&&!isSafari17()&&(t.resolution=ScreenSharePresets.h1080fps30.resolution);const i=screenCaptureToDisplayMediaStreamOptions(t),e=yield navigator.mediaDevices.getDisplayMedia(i),n=e.getVideoTracks();if(n.length===0)throw new TrackInvalidError("no video track found");const s=new LocalVideoTrack(n[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=Track.Source.ScreenShare,t.contentHint&&(s.mediaStreamTrack.contentHint=t.contentHint);const a=[s];if(e.getAudioTracks().length>0){this.emit(ParticipantEvent.AudioStreamAcquired);const c=new LocalAudioTrack(e.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});c.source=Track.Source.ScreenShareAudio,a.push(c)}return a})}publishTrack(t,i){return __awaiter(this,void 0,void 0,function*(){var e,n,s,a;t instanceof LocalAudioTrack&&t.setAudioContext(this.audioContext),yield(e=this.reconnectFuture)===null||e===void 0?void 0:e.promise,t instanceof LocalTrack&&this.pendingPublishPromises.has(t)&&(yield this.pendingPublishPromises.get(t));let c;if(t instanceof MediaStreamTrack)c=t.getConstraints();else{c=t.constraints;let p;switch(t.source){case Track.Source.Microphone:p="audioinput";break;case Track.Source.Camera:p="videoinput"}p&&this.activeDeviceMap.has(p)&&(c=Object.assign(Object.assign({},c),{deviceId:this.activeDeviceMap.get(p)}))}if(t instanceof MediaStreamTrack)switch(t.kind){case"audio":t=new LocalAudioTrack(t,c,!0,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});break;case"video":t=new LocalVideoTrack(t,c,!0,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});break;default:throw new TrackInvalidError("unsupported MediaStreamTrack kind ".concat(t.kind))}else t.updateLoggerOptions({loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});let l;if(this.trackPublications.forEach(p=>{p.track&&p.track===t&&(l=p)}),l)return this.log.warn("track has already been published, skipping",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(l))),l;const u="channelCount"in t.mediaStreamTrack.getSettings()&&t.mediaStreamTrack.getSettings().channelCount===2||t.mediaStreamTrack.getConstraints().channelCount===2,d=(n=i==null?void 0:i.forceStereo)!==null&&n!==void 0?n:u;d&&(i||(i={}),i.dtx===void 0&&this.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(t))),i.red===void 0&&this.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(s=i.dtx)!==null&&s!==void 0||(i.dtx=!1),(a=i.red)!==null&&a!==void 0||(i.red=!1));const f=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);!isE2EESimulcastSupported()&&this.roomOptions.e2ee&&(this.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},this.logContext)),f.simulcast=!1),f.source&&(t.source=f.source);const h=this.publish(t,f,d);this.pendingPublishPromises.set(t,h);try{return yield h}catch(p){throw p}finally{this.pendingPublishPromises.delete(t)}})}publish(t,i,e){return __awaiter(this,void 0,void 0,function*(){var n,s,a,c,l,u,d,f,h,p,m,g,v;Array.from(this.trackPublications.values()).find(C=>t instanceof LocalTrack&&C.source===t.source)&&t.source!==Track.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(t.source),Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(t))),i.stopMicTrackOnMute&&t instanceof LocalAudioTrack&&(t.stopOnMute=!0),t.source===Track.Source.ScreenShare&&isFireFox()&&(i.simulcast=!1),i.videoCodec==="av1"&&!supportsAV1()&&(i.videoCodec=void 0),i.videoCodec==="vp9"&&!supportsVP9()&&(i.videoCodec=void 0),i.videoCodec===void 0&&(i.videoCodec=defaultVideoCodec);const b=i.videoCodec;t.on(TrackEvent.Muted,this.onTrackMuted),t.on(TrackEvent.Unmuted,this.onTrackUnmuted),t.on(TrackEvent.Ended,this.handleTrackEnded),t.on(TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),t.on(TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed),t.on(TrackEvent.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const _=new AddTrackRequest({cid:t.mediaStreamTrack.id,name:i.name,type:Track.kindToProto(t.kind),muted:t.isMuted,source:Track.sourceToProto(t.source),disableDtx:!(!((n=i.dtx)!==null&&n!==void 0)||n),encryption:this.encryptionType,stereo:e,disableRed:this.isE2EEEnabled||!(!((s=i.red)!==null&&s!==void 0)||s),stream:i==null?void 0:i.stream});let y;if(t.kind===Track.Kind.Video){let C={width:0,height:0};try{C=yield t.waitForDimensions()}catch{const O=(c=(a=this.roomOptions.videoCaptureDefaults)===null||a===void 0?void 0:a.resolution)!==null&&c!==void 0?c:VideoPresets.h720.resolution;C={width:O.width,height:O.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(t)),{dims:C}))}_.width=C.width,_.height=C.height,t instanceof LocalVideoTrack&&(isSVCCodec(b)&&(t.source===Track.Source.ScreenShare&&(i.scalabilityMode="L1T3","contentHint"in t.mediaStreamTrack&&(t.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(t))))),i.scalabilityMode=(l=i.scalabilityMode)!==null&&l!==void 0?l:"L3T3_KEY"),_.simulcastCodecs=[new SimulcastCodec({codec:b,cid:t.mediaStreamTrack.id})],i.backupCodec===!0&&(i.backupCodec={codec:defaultVideoCodec}),i.backupCodec&&b!==i.backupCodec.codec&&_.encryption===Encryption_Type.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),_.simulcastCodecs.push(new SimulcastCodec({codec:i.backupCodec.codec,cid:""})))),y=computeVideoEncodings(t.source===Track.Source.ScreenShare,_.width,_.height,i),_.layers=videoLayersFromEncodings(_.width,_.height,y,isSVCCodec(i.videoCodec))}else t.kind===Track.Kind.Audio&&(y=[{maxBitrate:(u=i.audioPreset)===null||u===void 0?void 0:u.maxBitrate,priority:(f=(d=i.audioPreset)===null||d===void 0?void 0:d.priority)!==null&&f!==void 0?f:"high",networkPriority:(p=(h=i.audioPreset)===null||h===void 0?void 0:h.priority)!==null&&p!==void 0?p:"high"}]);if(!this.engine||this.engine.isClosed)throw new UnexpectedConnectionState("cannot publish track when not connected");const E=yield this.engine.addTrack(_);let P;if(E.codecs.forEach(C=>{P===void 0&&(P=C.mimeType)}),P&&t.kind===Track.Kind.Video){const C=mimeTypeToVideoCodecString(P);C!==b&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(t)),{codec:C})),i.videoCodec=C,y=computeVideoEncodings(t.source===Track.Source.ScreenShare,_.width,_.height,i))}const w=new LocalTrackPublication(t.kind,E,t,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(w.options=i,t.sid=E.sid,!this.engine.pcManager)throw new UnexpectedConnectionState("pcManager is not ready");if(this.log.debug("publishing ".concat(t.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:y,trackInfo:E})),t.sender=yield this.engine.createSender(t,i,y),t instanceof LocalVideoTrack&&((m=i.degradationPreference)!==null&&m!==void 0||(i.degradationPreference=getDefaultDegradationPreference(t)),t.setDegradationPreference(i.degradationPreference)),y)if(isFireFox()&&t.kind===Track.Kind.Audio){let C;for(const I of this.engine.pcManager.publisher.getTransceivers())if(I.sender===t.sender){C=I;break}C&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:C,codec:"opus",maxbr:!((g=y[0])===null||g===void 0)&&g.maxBitrate?y[0].maxBitrate/1e3:0})}else t.codec&&isSVCCodec(t.codec)&&(!((v=y[0])===null||v===void 0)&&v.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:_.cid,codec:t.codec,maxbr:y[0].maxBitrate/1e3});return yield this.engine.negotiate(),t instanceof LocalVideoTrack?t.startMonitor(this.engine.client):t instanceof LocalAudioTrack&&t.startMonitor(),this.addTrackPublication(w),this.emit(ParticipantEvent.LocalTrackPublished,w),w})}get isLocal(){return!0}publishAdditionalCodecForTrack(t,i,e){return __awaiter(this,void 0,void 0,function*(){var n;if(this.encryptionType!==Encryption_Type.NONE)return;let s;if(this.trackPublications.forEach(f=>{f.track&&f.track===t&&(s=f)}),!s)throw new TrackInvalidError("track is not published");if(!(t instanceof LocalVideoTrack))throw new TrackInvalidError("track is not a video track");const a=Object.assign(Object.assign({},(n=this.roomOptions)===null||n===void 0?void 0:n.publishDefaults),e),c=computeTrackBackupEncodings(t,i,a);if(!c){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(t)));return}const l=t.addSimulcastTrack(i,c);if(!l)return;const u=new AddTrackRequest({cid:l.mediaStreamTrack.id,type:Track.kindToProto(t.kind),muted:t.isMuted,source:Track.sourceToProto(t.source),sid:t.sid,simulcastCodecs:[{codec:a.videoCodec,cid:l.mediaStreamTrack.id}]});if(u.layers=videoLayersFromEncodings(u.width,u.height,c),!this.engine||this.engine.isClosed)throw new UnexpectedConnectionState("cannot publish track when not connected");const d=yield this.engine.addTrack(u);yield this.engine.createSimulcastSender(t,l,a,c),yield this.engine.negotiate(),this.log.debug("published ".concat(i," for track ").concat(t.sid),Object.assign(Object.assign({},this.logContext),{encodings:c,trackInfo:d}))})}unpublishTrack(t,i){return __awaiter(this,void 0,void 0,function*(){var e,n;if(t instanceof LocalTrack){const u=this.pendingPublishPromises.get(t);u&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(t))),yield u)}const s=this.getPublicationForTrack(t),a=s?getLogContextFromTrack(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),a)),!s||!s.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),a));return}t=s.track,t.off(TrackEvent.Muted,this.onTrackMuted),t.off(TrackEvent.Unmuted,this.onTrackUnmuted),t.off(TrackEvent.Ended,this.handleTrackEnded),t.off(TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),t.off(TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed),t.off(TrackEvent.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),i===void 0&&(i=(n=(e=this.roomOptions)===null||e===void 0?void 0:e.stopLocalTrackOnUnpublish)!==null&&n!==void 0?n:!0),i&&t.stop();let c=!1;const l=t.sender;if(t.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<PCTransportState.FAILED&&l)try{for(const u of this.engine.pcManager.publisher.getTransceivers())u.sender===l&&(u.direction="inactive",c=!0);if(this.engine.removeTrack(l)&&(c=!0),t instanceof LocalVideoTrack){for(const[,u]of t.simulcastCodecs)u.sender&&(this.engine.removeTrack(u.sender)&&(c=!0),u.sender=void 0);t.simulcastCodecs.clear()}}catch(u){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),a),{error:u}))}switch(this.trackPublications.delete(s.trackSid),s.kind){case Track.Kind.Audio:this.audioTrackPublications.delete(s.trackSid);break;case Track.Kind.Video:this.videoTrackPublications.delete(s.trackSid);break}return this.emit(ParticipantEvent.LocalTrackUnpublished,s),s.setTrack(void 0),c&&(yield this.engine.negotiate()),s})}unpublishTracks(t){return __awaiter(this,void 0,void 0,function*(){return(yield Promise.all(t.map(e=>this.unpublishTrack(e)))).filter(e=>e instanceof LocalTrackPublication)})}republishAllTracks(t){return __awaiter(this,arguments,void 0,function(i){var e=this;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){const s=[];e.trackPublications.forEach(a=>{a.track&&(i&&(a.options=Object.assign(Object.assign({},a.options),i)),s.push(a))}),yield Promise.all(s.map(a=>__awaiter(e,void 0,void 0,function*(){const c=a.track;yield this.unpublishTrack(c,!1),n&&!c.isMuted&&c.source!==Track.Source.ScreenShare&&c.source!==Track.Source.ScreenShareAudio&&(c instanceof LocalAudioTrack||c instanceof LocalVideoTrack)&&!c.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:a.trackSid})),yield c.restartTrack()),yield this.publishTrack(c,a.options)})))}()})}publishData(t){return __awaiter(this,arguments,void 0,function(i){var e=this;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const s=n.reliable?DataPacket_Kind.RELIABLE:DataPacket_Kind.LOSSY,a=n.destinationIdentities,c=n.topic,l=new DataPacket({kind:s,value:{case:"user",value:new UserPacket({participantIdentity:e.identity,payload:i,destinationIdentities:a,topic:c})}});yield e.engine.sendDataPacket(l,s)}()})}setTrackSubscriptionPermissions(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=i,this.allParticipantsAllowedToSubscribe=t,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}updateInfo(t){return t.sid!==this.sid||!super.updateInfo(t)?!1:(t.tracks.forEach(i=>{var e,n;const s=this.trackPublications.get(i.sid);if(s){const a=s.isMuted||((n=(e=s.track)===null||e===void 0?void 0:e.isUpstreamPaused)!==null&&n!==void 0?n:!1);a!==i.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(s)),{mutedOnServer:a})),this.engine.client.sendMuteTrack(i.sid,a))}}),!0)}getPublicationForTrack(t){let i;return this.trackPublications.forEach(e=>{const n=e.track;n&&(t instanceof MediaStreamTrack?(n instanceof LocalAudioTrack||n instanceof LocalVideoTrack)&&n.mediaStreamTrack===t&&(i=e):t===n&&(i=e))}),i}}class RemoteTrackPublication extends TrackPublication{constructor(t,i,e,n){super(t,i.sid,i.name,n),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=VideoQuality.HIGH,this.handleEnded=s=>{this.setTrack(void 0),this.emit(TrackEvent.Ended,s)},this.handleVisibilityChange=s=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(s),this.logContext),this.disabled=!s,this.emitTrackUpdate()},this.handleVideoDimensionsChange=s=>{this.log.debug("adaptivestream video dimensions ".concat(s.width,"x").concat(s.height),this.logContext),this.videoDimensions=s,this.emitTrackUpdate()},this.subscribed=e,this.updateInfo(i)}setSubscribed(t){const i=this.subscriptionStatus,e=this.permissionStatus;this.subscribed=t,t&&(this.allowed=!0);const n=new UpdateSubscription({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new ParticipantTracks({participantSid:"",trackSids:[this.trackSid]})]});this.emit(TrackEvent.UpdateSubscription,n),this.emitSubscriptionUpdateIfChanged(i),this.emitPermissionUpdateIfChanged(e)}get subscriptionStatus(){return this.subscribed===!1?TrackPublication.SubscriptionStatus.Unsubscribed:super.isSubscribed?TrackPublication.SubscriptionStatus.Subscribed:TrackPublication.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?TrackPublication.PermissionStatus.Allowed:TrackPublication.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return!this.disabled}setEnabled(t){!this.isManualOperationAllowed()||this.disabled===!t||(this.disabled=!t,this.emitTrackUpdate())}setVideoQuality(t){!this.isManualOperationAllowed()||this.currentVideoQuality===t||(this.currentVideoQuality=t,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(t){var i,e;this.isManualOperationAllowed()&&(((i=this.videoDimensions)===null||i===void 0?void 0:i.width)===t.width&&((e=this.videoDimensions)===null||e===void 0?void 0:e.height)===t.height||(this.track instanceof RemoteVideoTrack&&(this.videoDimensions=t),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(t){this.isManualOperationAllowed()&&this.track instanceof RemoteVideoTrack&&this.fps!==t&&(this.fps=t,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(t){const i=this.subscriptionStatus,e=this.permissionStatus,n=this.track;n!==t&&(n&&(n.off(TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),n.off(TrackEvent.VisibilityChanged,this.handleVisibilityChange),n.off(TrackEvent.Ended,this.handleEnded),n.detach(),n.stopMonitor(),this.emit(TrackEvent.Unsubscribed,n)),super.setTrack(t),t&&(t.sid=this.trackSid,t.on(TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),t.on(TrackEvent.VisibilityChanged,this.handleVisibilityChange),t.on(TrackEvent.Ended,this.handleEnded),this.emit(TrackEvent.Subscribed,t)),this.emitPermissionUpdateIfChanged(e),this.emitSubscriptionUpdateIfChanged(i))}setAllowed(t){const i=this.subscriptionStatus,e=this.permissionStatus;this.allowed=t,this.emitPermissionUpdateIfChanged(e),this.emitSubscriptionUpdateIfChanged(i)}setSubscriptionError(t){this.emit(TrackEvent.SubscriptionFailed,t)}updateInfo(t){super.updateInfo(t);const i=this.metadataMuted;this.metadataMuted=t.muted,this.track?this.track.setMuted(t.muted):i!==t.muted&&this.emit(t.muted?TrackEvent.Muted:TrackEvent.Unmuted)}emitSubscriptionUpdateIfChanged(t){const i=this.subscriptionStatus;t!==i&&this.emit(TrackEvent.SubscriptionStatusChanged,i,t)}emitPermissionUpdateIfChanged(t){this.permissionStatus!==t&&this.emit(TrackEvent.SubscriptionPermissionChanged,this.permissionStatus,t)}isManualOperationAllowed(){return this.kind===Track.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return this.track instanceof RemoteVideoTrack&&this.track.isAdaptiveStream}emitTrackUpdate(){const t=new UpdateTrackSettings({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(t.width=Math.ceil(this.videoDimensions.width),t.height=Math.ceil(this.videoDimensions.height)):this.currentVideoQuality!==void 0?t.quality=this.currentVideoQuality:t.quality=VideoQuality.HIGH,this.emit(TrackEvent.UpdateSettings,t)}}class RemoteParticipant extends Participant{static fromParticipantInfo(t,i,e){return new RemoteParticipant(t,i.sid,i.identity,i.name,i.metadata,e,i.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(t,i,e,n,s,a){let c=arguments.length>6&&arguments[6]!==void 0?arguments[6]:ParticipantInfo_Kind.STANDARD;super(i,e||"",n,s,a,c),this.signalClient=t,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(t){super.addTrackPublication(t),t.on(TrackEvent.UpdateSettings,i=>{this.log.debug("send update settings",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(t))),this.signalClient.sendUpdateTrackSettings(i)}),t.on(TrackEvent.UpdateSubscription,i=>{i.participantTracks.forEach(e=>{e.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(i)}),t.on(TrackEvent.SubscriptionPermissionChanged,i=>{this.emit(ParticipantEvent.TrackSubscriptionPermissionChanged,t,i)}),t.on(TrackEvent.SubscriptionStatusChanged,i=>{this.emit(ParticipantEvent.TrackSubscriptionStatusChanged,t,i)}),t.on(TrackEvent.Subscribed,i=>{this.emit(ParticipantEvent.TrackSubscribed,i,t)}),t.on(TrackEvent.Unsubscribed,i=>{this.emit(ParticipantEvent.TrackUnsubscribed,i,t)}),t.on(TrackEvent.SubscriptionFailed,i=>{this.emit(ParticipantEvent.TrackSubscriptionFailed,t.trackSid,i)})}getTrackPublication(t){const i=super.getTrackPublication(t);if(i)return i}getTrackPublicationByName(t){const i=super.getTrackPublicationByName(t);if(i)return i}setVolume(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Track.Source.Microphone;this.volumeMap.set(i,t);const e=this.getTrackPublication(i);e&&e.track&&e.track.setVolume(t)}getVolume(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Track.Source.Microphone;const i=this.getTrackPublication(t);return i&&i.track?i.track.getVolume():this.volumeMap.get(t)}addSubscribedMediaTrack(t,i,e,n,s,a){let c=this.getTrackPublicationBySid(i);if(c||i.startsWith("TR")||this.trackPublications.forEach(d=>{!c&&t.kind===d.kind.toString()&&(c=d)}),!c){if(a===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:i})),this.emit(ParticipantEvent.TrackSubscriptionFailed,i);return}a===void 0&&(a=20),setTimeout(()=>{this.addSubscribedMediaTrack(t,i,e,n,s,a-1)},150);return}if(t.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(c))),this.emit(ParticipantEvent.TrackSubscriptionFailed,i);return}const l=t.kind==="video";let u;return l?u=new RemoteVideoTrack(t,i,n,s):u=new RemoteAudioTrack(t,i,n,this.audioContext,this.audioOutput),u.source=c.source,u.isMuted=c.isMuted,u.setMediaStream(e),u.start(),c.setTrack(u),this.volumeMap.has(c.source)&&u instanceof RemoteAudioTrack&&u.setVolume(this.volumeMap.get(c.source)),c}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(t){return this.trackPublications.get(t)}updateInfo(t){if(!super.updateInfo(t))return!1;const i=new Map,e=new Map;return t.tracks.forEach(n=>{var s,a;let c=this.getTrackPublicationBySid(n.sid);if(c)c.updateInfo(n);else{const l=Track.kindFromProto(n.type);if(!l)return;c=new RemoteTrackPublication(l,n,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(a=this.loggerOptions)===null||a===void 0?void 0:a.loggerName}),c.updateInfo(n),e.set(n.sid,c);const u=Array.from(this.trackPublications.values()).find(d=>d.source===(c==null?void 0:c.source));u&&c.source!==Track.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(c.source),Object.assign(Object.assign({},this.logContext),{oldTrack:getLogContextFromTrack(u),newTrack:getLogContextFromTrack(c)})),this.addTrackPublication(c)}i.set(n.sid,c)}),this.trackPublications.forEach(n=>{i.has(n.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(n))),this.unpublishTrack(n.trackSid,!0))}),e.forEach(n=>{this.emit(ParticipantEvent.TrackPublished,n)}),!0}unpublishTrack(t,i){const e=this.trackPublications.get(t);if(!e)return;const{track:n}=e;switch(n&&(n.stop(),e.setTrack(void 0)),this.trackPublications.delete(t),e.kind){case Track.Kind.Audio:this.audioTrackPublications.delete(t);break;case Track.Kind.Video:this.videoTrackPublications.delete(t);break}i&&this.emit(ParticipantEvent.TrackUnpublished,e)}setAudioOutput(t){return __awaiter(this,void 0,void 0,function*(){this.audioOutput=t;const i=[];this.audioTrackPublications.forEach(e=>{var n;e.track instanceof RemoteAudioTrack&&i.push(e.track.setSinkId((n=t.deviceId)!==null&&n!==void 0?n:"default"))}),yield Promise.all(i)})}emit(t){for(var i=arguments.length,e=new Array(i>1?i-1:0),n=1;n<i;n++)e[n-1]=arguments[n];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:t,args:e})),super.emit(t,...e)}}var ConnectionState;(function(o){o.Disconnected="disconnected",o.Connecting="connecting",o.Connected="connected",o.Reconnecting="reconnecting",o.SignalReconnecting="signalReconnecting"})(ConnectionState||(ConnectionState={}));const connectionReconcileFrequency=4*1e3;class Room extends eventsExports.EventEmitter{constructor(t){var i,e,n;super(),i=this,this.state=ConnectionState.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=livekitLogger,this.bufferedEvents=[],this.isResuming=!1,this.connect=(s,a,c)=>__awaiter(this,void 0,void 0,function*(){var l;if(!isBrowserSupported())throw isReactNative()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const u=yield this.disconnectLock.lock();if(this.state===ConnectionState.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),u(),Promise.resolve();if(this.connectFuture)return u(),this.connectFuture.promise;this.setAndEmitConnectionState(ConnectionState.Connecting),((l=this.regionUrlProvider)===null||l===void 0?void 0:l.getServerUrl().toString())!==s&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),isCloud(new URL(s))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new RegionUrlProvider(s,a):this.regionUrlProvider.updateToken(a),this.regionUrlProvider.fetchRegionSettings().then(h=>{var p;(p=this.regionUrlProvider)===null||p===void 0||p.setServerReportedRegions(h)}).catch(h=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:h}))}));const d=(h,p,m)=>__awaiter(this,void 0,void 0,function*(){var g,v;this.abortController&&this.abortController.abort();const T=new AbortController;this.abortController=T,u==null||u();try{yield this.attemptConnection(m??s,a,c,T),this.abortController=void 0,h()}catch(b){if(this.regionUrlProvider&&b instanceof ConnectionError&&b.reason!==3&&b.reason!==0){let _=null;try{_=yield this.regionUrlProvider.getNextBestRegionUrl((g=this.abortController)===null||g===void 0?void 0:g.signal)}catch(y){if(y instanceof ConnectionError&&(y.status===401||y.reason===3)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),p(y);return}}_&&!(!((v=this.abortController)===null||v===void 0)&&v.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(b.message,". Retrying with another region: ").concat(_),this.logContext),this.recreateEngine(),yield d(h,p,_)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),p(b))}else this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),p(b)}}),f=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Future((h,p)=>{d(h,p,f)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(s,a,c,l,u,d)=>__awaiter(this,void 0,void 0,function*(){var f,h,p;const m=yield c.join(s,a,{autoSubscribe:l.autoSubscribe,adaptiveStream:typeof u.adaptiveStream=="object"?!0:u.adaptiveStream,maxRetries:l.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:l.websocketTimeout},d.signal);let g=m.serverInfo;if(g||(g={version:m.serverVersion,region:m.serverRegion}),this.log.debug("connected to Livekit Server ".concat(Object.entries(g).map(v=>{let[T,b]=v;return"".concat(T,": ").concat(b)}).join(", ")),{room:(f=m.room)===null||f===void 0?void 0:f.name,roomSid:(h=m.room)===null||h===void 0?void 0:h.sid,identity:(p=m.participant)===null||p===void 0?void 0:p.identity}),!m.serverVersion)throw new UnsupportedServer("unknown server version");return m.serverVersion==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),u.dynacast=!1),m}),this.applyJoinResponse=s=>{const a=s.participant;if(this.localParticipant.sid=a.sid,this.localParticipant.identity=a.identity,this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(s.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([a,...s.otherParticipants]),s.room&&this.handleRoomUpdate(s.room)},this.attemptConnection=(s,a,c,l)=>__awaiter(this,void 0,void 0,function*(){var u,d,f;this.state===ConnectionState.Reconnecting||this.isResuming||!((u=this.engine)===null||u===void 0)&&u.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((d=this.regionUrlProvider)===null||d===void 0)&&d.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},roomConnectOptionDefaults),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const h=yield this.connectSignal(s,a,this.engine,this.connOptions,this.options,l);this.applyJoinResponse(h),this.setupLocalParticipantEvents(),this.emit(RoomEvent.SignalConnected)}catch(h){yield this.engine.close(),this.recreateEngine();const p=new ConnectionError("could not establish signal connection");throw h instanceof Error&&(p.message="".concat(p.message,": ").concat(h.message)),h instanceof ConnectionError&&(p.reason=h.reason,p.status=h.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:h})),p}if(l.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new ConnectionError("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,l)}catch(h){throw yield this.engine.close(),this.recreateEngine(),h}isWeb()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),isWeb()&&(document.addEventListener("freeze",this.onPageLeave),(f=navigator.mediaDevices)===null||f===void 0||f.addEventListener("devicechange",this.handleDeviceChange)),this.setAndEmitConnectionState(ConnectionState.Connected),this.emit(RoomEvent.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var s=arguments.length,a=new Array(s),c=0;c<s;c++)a[c]=arguments[c];return __awaiter(i,[...a],void 0,function(){var l=this;let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var d,f,h,p;const m=yield l.disconnectLock.lock();try{if(l.state===ConnectionState.Disconnected){l.log.debug("already disconnected",l.logContext);return}l.log.info("disconnect from room",Object.assign({},l.logContext)),(l.state===ConnectionState.Connecting||l.state===ConnectionState.Reconnecting||l.isResuming)&&(l.log.warn("abort connection attempt",l.logContext),(d=l.abortController)===null||d===void 0||d.abort(),(h=(f=l.connectFuture)===null||f===void 0?void 0:f.reject)===null||h===void 0||h.call(f,new ConnectionError("Client initiated disconnect")),l.connectFuture=void 0),!((p=l.engine)===null||p===void 0)&&p.client.isDisconnected||(yield l.engine.client.sendLeave()),l.engine&&(yield l.engine.close()),l.handleDisconnect(u,DisconnectReason.CLIENT_INITIATED),l.engine=void 0}finally{m()}}()})},this.onPageLeave=()=>__awaiter(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>__awaiter(this,void 0,void 0,function*(){const s=[],a=getBrowser();if(a&&a.os==="iOS"){const c="livekit-dummy-audio-el";let l=document.getElementById(c);if(!l){l=document.createElement("audio"),l.id=c,l.autoplay=!0,l.hidden=!0;const u=getEmptyAudioStreamTrack();u.enabled=!0;const d=new MediaStream([u]);l.srcObject=d,document.addEventListener("visibilitychange",()=>{l&&(l.srcObject=document.hidden?null:d,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(l),this.once(RoomEvent.Disconnected,()=>{l==null||l.remove(),l=null})}s.push(l)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(l=>{l.track&&l.track.attachedElements.forEach(u=>{s.push(u)})})});try{yield Promise.all([this.acquireAudioContext(),...s.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>__awaiter(this,void 0,void 0,function*(){const s=[];for(const a of this.remoteParticipants.values())a.videoTrackPublications.forEach(c=>{var l;(l=c.track)===null||l===void 0||l.attachedElements.forEach(u=>{s.includes(u)||s.push(u)})});yield Promise.all(s.map(a=>a.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(a=>{a.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const s of this.remoteParticipants.values())this.handleParticipantDisconnected(s.identity,s);this.setAndEmitConnectionState(ConnectionState.Reconnecting)&&this.emit(RoomEvent.Reconnecting)},this.handleSignalRestarted=s=>__awaiter(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(s.serverRegion),Object.assign(Object.assign({},this.logContext),{region:s.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(s);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(a){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:a}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:s.serverRegion}))}catch{return}this.setAndEmitConnectionState(ConnectionState.Connected),this.emit(RoomEvent.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=s=>{s.forEach(a=>{var c;if(a.identity===this.localParticipant.identity){this.localParticipant.updateInfo(a);return}a.identity===""&&(a.identity=(c=this.sidToIdentity.get(a.sid))!==null&&c!==void 0?c:"");let l=this.remoteParticipants.get(a.identity);a.state===ParticipantInfo_State.DISCONNECTED?this.handleParticipantDisconnected(a.identity,l):l=this.getOrCreateParticipant(a.identity,a)})},this.handleActiveSpeakersUpdate=s=>{const a=[],c={};s.forEach(l=>{if(c[l.sid]=!0,l.sid===this.localParticipant.sid)this.localParticipant.audioLevel=l.level,this.localParticipant.setIsSpeaking(!0),a.push(this.localParticipant);else{const u=this.getRemoteParticipantBySid(l.sid);u&&(u.audioLevel=l.level,u.setIsSpeaking(!0),a.push(u))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(l=>{c[l.sid]||(l.audioLevel=0,l.setIsSpeaking(!1))}),this.activeSpeakers=a,this.emitWhenConnected(RoomEvent.ActiveSpeakersChanged,a)},this.handleSpeakersChanged=s=>{const a=new Map;this.activeSpeakers.forEach(l=>{const u=this.remoteParticipants.get(l.identity);u&&u.sid!==l.sid||a.set(l.sid,l)}),s.forEach(l=>{let u=this.getRemoteParticipantBySid(l.sid);l.sid===this.localParticipant.sid&&(u=this.localParticipant),u&&(u.audioLevel=l.level,u.setIsSpeaking(l.active),l.active?a.set(l.sid,u):a.delete(l.sid))});const c=Array.from(a.values());c.sort((l,u)=>u.audioLevel-l.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(RoomEvent.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=s=>{s.streamStates.forEach(a=>{const c=this.getRemoteParticipantBySid(a.participantSid);if(!c)return;const l=c.getTrackPublicationBySid(a.trackSid);!l||!l.track||(l.track.streamState=Track.streamStateFromProto(a.state),c.emit(ParticipantEvent.TrackStreamStateChanged,l,l.track.streamState),this.emitWhenConnected(RoomEvent.TrackStreamStateChanged,l,l.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=s=>{const a=this.getRemoteParticipantBySid(s.participantSid);if(!a)return;const c=a.getTrackPublicationBySid(s.trackSid);c&&c.setAllowed(s.allowed)},this.handleSubscriptionError=s=>{const a=Array.from(this.remoteParticipants.values()).find(l=>l.trackPublications.has(s.trackSid));if(!a)return;const c=a.getTrackPublicationBySid(s.trackSid);c&&c.setSubscriptionError(s.err)},this.handleDataPacket=s=>{const a=this.remoteParticipants.get(s.participantIdentity);s.value.case==="user"?this.handleUserPacket(a,s.value.value,s.kind):s.value.case==="transcription"?this.handleTranscription(a,s.value.value):s.value.case==="sipDtmf"&&this.handleSipDtmf(a,s.value.value)},this.handleUserPacket=(s,a,c)=>{this.emit(RoomEvent.DataReceived,a.payload,s,c,a.topic),s==null||s.emit(ParticipantEvent.DataReceived,a.payload,c)},this.handleSipDtmf=(s,a)=>{this.emit(RoomEvent.SipDTMFReceived,a,s),s==null||s.emit(ParticipantEvent.SipDTMFReceived,a)},this.bufferedSegments=new Map,this.handleTranscription=(s,a)=>{const c=a.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(a.transcribedParticipantIdentity),l=c==null?void 0:c.trackPublications.get(a.trackId),u=extractTranscriptionSegments(a);l==null||l.emit(TrackEvent.TranscriptionReceived,u),c==null||c.emit(ParticipantEvent.TranscriptionReceived,u,l),this.emit(RoomEvent.TranscriptionReceived,u,c,l)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(RoomEvent.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=s=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:s})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(RoomEvent.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(RoomEvent.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(RoomEvent.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>__awaiter(this,void 0,void 0,function*(){this.emit(RoomEvent.MediaDevicesChanged)}),this.handleRoomUpdate=s=>{const a=this.roomInfo;this.roomInfo=s,a&&a.metadata!==s.metadata&&this.emitWhenConnected(RoomEvent.RoomMetadataChanged,s.metadata),(a==null?void 0:a.activeRecording)!==s.activeRecording&&this.emitWhenConnected(RoomEvent.RecordingStatusChanged,s.activeRecording)},this.handleConnectionQualityUpdate=s=>{s.updates.forEach(a=>{if(a.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(a.quality);return}const c=this.getRemoteParticipantBySid(a.participantSid);c&&c.setConnectionQuality(a.quality)})},this.onLocalParticipantMetadataChanged=s=>{this.emit(RoomEvent.ParticipantMetadataChanged,s,this.localParticipant)},this.onLocalParticipantNameChanged=s=>{this.emit(RoomEvent.ParticipantNameChanged,s,this.localParticipant)},this.onLocalAttributesChanged=s=>{this.emit(RoomEvent.ParticipantAttributesChanged,s,this.localParticipant)},this.onLocalTrackMuted=s=>{this.emit(RoomEvent.TrackMuted,s,this.localParticipant)},this.onLocalTrackUnmuted=s=>{this.emit(RoomEvent.TrackUnmuted,s,this.localParticipant)},this.onTrackProcessorUpdate=s=>{var a;(a=s==null?void 0:s.onPublish)===null||a===void 0||a.call(s,this)},this.onLocalTrackPublished=s=>__awaiter(this,void 0,void 0,function*(){var a,c,l,u,d;(a=s.track)===null||a===void 0||a.on(TrackEvent.TrackProcessorUpdate,this.onTrackProcessorUpdate),(u=(l=(c=s.track)===null||c===void 0?void 0:c.getProcessor())===null||l===void 0?void 0:l.onPublish)===null||u===void 0||u.call(l,this),this.emit(RoomEvent.LocalTrackPublished,s,this.localParticipant),s.track instanceof LocalAudioTrack&&(yield s.track.checkForSilence())&&this.emit(RoomEvent.LocalAudioSilenceDetected,s);const f=yield(d=s.track)===null||d===void 0?void 0:d.getDeviceId(),h=sourceToKind(s.source);h&&f&&f!==this.localParticipant.activeDeviceMap.get(h)&&(this.localParticipant.activeDeviceMap.set(h,f),this.emit(RoomEvent.ActiveDeviceChanged,h,f))}),this.onLocalTrackUnpublished=s=>{var a;(a=s.track)===null||a===void 0||a.off(TrackEvent.TrackProcessorUpdate,this.onTrackProcessorUpdate),this.emit(RoomEvent.LocalTrackUnpublished,s,this.localParticipant)},this.onLocalConnectionQualityChanged=s=>{this.emit(RoomEvent.ConnectionQualityChanged,s,this.localParticipant)},this.onMediaDevicesError=s=>{this.emit(RoomEvent.MediaDevicesError,s)},this.onLocalParticipantPermissionsChanged=s=>{this.emit(RoomEvent.ParticipantPermissionsChanged,s,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},roomOptionDefaults),t),this.log=getLogger((e=this.options.loggerName)!==null&&e!==void 0?e:LoggerNames.Room),this.options.audioCaptureDefaults=Object.assign(Object.assign({},audioDefaults),t==null?void 0:t.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},videoDefaults),t==null?void 0:t.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},publishDefaults),t==null?void 0:t.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new Mutex,this.localParticipant=new LocalParticipant("","",this.engine,this.options),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",unwrapConstraint(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",unwrapConstraint(this.options.audioCaptureDefaults.deviceId)),!((n=this.options.audioOutput)===null||n===void 0)&&n.deviceId&&this.switchActiveDevice("audiooutput",unwrapConstraint(this.options.audioOutput.deviceId)).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),this.options.e2ee&&this.setupE2EE()}setE2EEEnabled(t){return __awaiter(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(t)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(t,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var t;this.options.e2ee&&(this.e2eeManager=new E2EEManager(this.options.e2ee),this.e2eeManager.on(EncryptionEvent.ParticipantEncryptionStatusChanged,(i,e)=>{e instanceof LocalParticipant&&(this.isE2EEEnabled=i),this.emit(RoomEvent.ParticipantEncryptionStatusChanged,i,e)}),this.e2eeManager.on(EncryptionEvent.EncryptionError,i=>this.emit(RoomEvent.EncryptionError,i)),(t=this.e2eeManager)===null||t===void 0||t.setup(this))}get logContext(){var t;return{room:this.name,roomID:(t=this.roomInfo)===null||t===void 0?void 0:t.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var t,i;return(i=(t=this.roomInfo)===null||t===void 0?void 0:t.activeRecording)!==null&&i!==void 0?i:!1}getSid(){return __awaiter(this,void 0,void 0,function*(){return this.state===ConnectionState.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((t,i)=>{const e=n=>{n.sid!==""&&(this.engine.off(EngineEvent.RoomUpdate,e),t(n.sid))};this.engine.on(EngineEvent.RoomUpdate,e),this.once(RoomEvent.Disconnected,()=>{this.engine.off(EngineEvent.RoomUpdate,e),i("Room disconnected before room server id was available")})})})}get name(){var t,i;return(i=(t=this.roomInfo)===null||t===void 0?void 0:t.name)!==null&&i!==void 0?i:""}get metadata(){var t;return(t=this.roomInfo)===null||t===void 0?void 0:t.metadata}get numParticipants(){var t,i;return(i=(t=this.roomInfo)===null||t===void 0?void 0:t.numParticipants)!==null&&i!==void 0?i:0}get numPublishers(){var t,i;return(i=(t=this.roomInfo)===null||t===void 0?void 0:t.numPublishers)!==null&&i!==void 0?i:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new RTCEngine(this.options),this.engine.on(EngineEvent.ParticipantUpdate,this.handleParticipantUpdates).on(EngineEvent.RoomUpdate,this.handleRoomUpdate).on(EngineEvent.SpeakersChanged,this.handleSpeakersChanged).on(EngineEvent.StreamStateChanged,this.handleStreamStateUpdate).on(EngineEvent.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(EngineEvent.SubscriptionError,this.handleSubscriptionError).on(EngineEvent.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(EngineEvent.MediaTrackAdded,(t,i,e)=>{this.onTrackAdded(t,i,e)}).on(EngineEvent.Disconnected,t=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,t)}).on(EngineEvent.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(EngineEvent.DataPacketReceived,this.handleDataPacket).on(EngineEvent.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(ConnectionState.SignalReconnecting)&&this.emit(RoomEvent.SignalReconnecting)}).on(EngineEvent.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(ConnectionState.Connected)&&this.emit(RoomEvent.Reconnected)}).on(EngineEvent.SignalResumed,()=>{this.bufferedEvents=[],(this.state===ConnectionState.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(EngineEvent.Restarting,this.handleRestarting).on(EngineEvent.SignalRestarted,this.handleSignalRestarted).on(EngineEvent.Offline,()=>{this.setAndEmitConnectionState(ConnectionState.Reconnecting)&&this.emit(RoomEvent.Reconnecting)}).on(EngineEvent.DCBufferStatusChanged,(t,i)=>{this.emit(RoomEvent.DCBufferStatusChanged,t,i)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return DeviceManager.getInstance().getDevices(t,i)}prepareConnection(t,i){return __awaiter(this,void 0,void 0,function*(){if(this.state===ConnectionState.Disconnected){this.log.debug("prepareConnection to ".concat(t),this.logContext);try{if(isCloud(new URL(t))&&i){this.regionUrlProvider=new RegionUrlProvider(t,i);const e=yield this.regionUrlProvider.getNextBestRegionUrl();e&&this.state===ConnectionState.Disconnected&&(this.regionUrl=e,yield fetch(toHttpUrl(e),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(e),this.logContext))}else yield fetch(toHttpUrl(t),{method:"HEAD"})}catch(e){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:e}))}}})}getParticipantByIdentity(t){return this.localParticipant.identity===t?this.localParticipant:this.remoteParticipants.get(t)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(t,i){return __awaiter(this,void 0,void 0,function*(){let e=()=>{},n;switch(t){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":n=new SimulateScenario({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":n=new SimulateScenario({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":n=new SimulateScenario({scenario:{case:"serverLeave",value:!0}});break;case"migration":n=new SimulateScenario({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":e=()=>__awaiter(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),n=new SimulateScenario({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":e=()=>__awaiter(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),n=new SimulateScenario({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":n=new SimulateScenario({scenario:{case:"switchCandidateProtocol",value:t==="force-tls"?2:1}}),e=()=>__awaiter(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new LeaveRequest({reason:DisconnectReason.CLIENT_INITIATED,action:LeaveRequest_Action.RECONNECT}))});break;case"subscriber-bandwidth":if(i===void 0||typeof i!="number")throw new Error("subscriber-bandwidth requires a number as argument");n=new SimulateScenario({scenario:{case:"subscriberBandwidth",value:BigInt(i)}});break;case"leave-full-reconnect":n=new SimulateScenario({scenario:{case:"leaveRequestFullReconnect",value:!0}})}n&&(yield this.engine.client.sendSimulateScenario(n),yield e())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(t){return this.localParticipant.activeDeviceMap.get(t)}switchActiveDevice(t,i){return __awaiter(this,arguments,void 0,function(e,n){var s=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var c,l,u,d;let f=!1,h=!0;const p=a?{exact:n}:n;if(e==="audioinput"){const m=s.options.audioCaptureDefaults.deviceId;s.options.audioCaptureDefaults.deviceId=p,f=m!==p;const g=Array.from(s.localParticipant.audioTrackPublications.values()).filter(v=>v.source===Track.Source.Microphone);try{h=(yield Promise.all(g.map(v=>{var T;return(T=v.audioTrack)===null||T===void 0?void 0:T.setDeviceId(p)}))).every(v=>v===!0)}catch(v){throw s.options.audioCaptureDefaults.deviceId=m,v}}else if(e==="videoinput"){const m=s.options.videoCaptureDefaults.deviceId;s.options.videoCaptureDefaults.deviceId=p,f=m!==p;const g=Array.from(s.localParticipant.videoTrackPublications.values()).filter(v=>v.source===Track.Source.Camera);try{h=(yield Promise.all(g.map(v=>{var T;return(T=v.videoTrack)===null||T===void 0?void 0:T.setDeviceId(p)}))).every(v=>v===!0)}catch(v){throw s.options.videoCaptureDefaults.deviceId=m,v}}else if(e==="audiooutput"){if(!supportsSetSinkId()&&!s.options.webAudioMix||s.options.webAudioMix&&s.audioContext&&!("setSinkId"in s.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");s.options.webAudioMix&&(n=(c=yield DeviceManager.getInstance().normalizeDeviceId("audiooutput",n))!==null&&c!==void 0?c:""),(l=(d=s.options).audioOutput)!==null&&l!==void 0||(d.audioOutput={});const m=s.options.audioOutput.deviceId;s.options.audioOutput.deviceId=n,f=m!==p;try{s.options.webAudioMix&&((u=s.audioContext)===null||u===void 0||u.setSinkId(n)),yield Promise.all(Array.from(s.remoteParticipants.values()).map(g=>g.setAudioOutput({deviceId:n})))}catch(g){throw s.options.audioOutput.deviceId=m,g}}return f&&h&&(s.localParticipant.activeDeviceMap.set(e,n),s.emit(RoomEvent.ActiveDeviceChanged,e,n)),h}()})}setupLocalParticipantEvents(){this.localParticipant.on(ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(ParticipantEvent.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(ParticipantEvent.AttributesChanged,this.onLocalAttributesChanged).on(ParticipantEvent.TrackMuted,this.onLocalTrackMuted).on(ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).on(ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).on(ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).on(ParticipantEvent.AudioStreamAcquired,this.startAudio).on(ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var t;(t=this.engine)===null||t===void 0||t.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(t,i,e){if(this.state===ConnectionState.Connecting||this.state===ConnectionState.Reconnecting){const d=()=>{this.onTrackAdded(t,i,e),f()},f=()=>{this.off(RoomEvent.Reconnected,d),this.off(RoomEvent.Connected,d),this.off(RoomEvent.Disconnected,f)};this.once(RoomEvent.Reconnected,d),this.once(RoomEvent.Connected,d),this.once(RoomEvent.Disconnected,f);return}if(this.state===ConnectionState.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}const n=unpackStreamId(i.id),s=n[0];let a=n[1],c=t.id;if(a&&a.startsWith("TR")&&(c=a),s===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const l=Array.from(this.remoteParticipants.values()).find(d=>d.sid===s);if(!l){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);return}let u;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?u=this.options.adaptiveStream:u={}),l.addSubscribedMediaTrack(t,c,i,e,u)}handleDisconnect(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1?arguments[1]:void 0;var e;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.state!==ConnectionState.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(n=>{n.trackPublications.forEach(s=>{n.unpublishTrack(s.trackSid)})}),this.localParticipant.trackPublications.forEach(n=>{var s,a;n.track&&this.localParticipant.unpublishTrack(n.track,t),t&&((s=n.track)===null||s===void 0||s.detach(),(a=n.track)===null||a===void 0||a.stop())}),this.localParticipant.off(ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(ParticipantEvent.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(ParticipantEvent.AttributesChanged,this.onLocalAttributesChanged).off(ParticipantEvent.TrackMuted,this.onLocalTrackMuted).off(ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).off(ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).off(ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).off(ParticipantEvent.AudioStreamAcquired,this.startAudio).off(ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),isWeb()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(e=navigator.mediaDevices)===null||e===void 0||e.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(ConnectionState.Disconnected),this.emit(RoomEvent.Disconnected,i)}}}handleParticipantDisconnected(t,i){this.remoteParticipants.delete(t),i&&(i.trackPublications.forEach(e=>{i.unpublishTrack(e.trackSid,!0)}),this.emit(RoomEvent.ParticipantDisconnected,i))}acquireAudioContext(){return __awaiter(this,void 0,void 0,function*(){var t,i;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(t=getNewAudioContext())!==null&&t!==void 0?t:void 0),this.audioContext&&this.audioContext.state==="suspended")try{yield this.audioContext.resume()}catch(n){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:n}))}this.options.webAudioMix&&this.remoteParticipants.forEach(n=>n.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext);const e=((i=this.audioContext)===null||i===void 0?void 0:i.state)==="running";e!==this.canPlaybackAudio&&(this.audioEnabled=e,this.emit(RoomEvent.AudioPlaybackStatusChanged,e))})}createParticipant(t,i){var e;let n;return i?n=RemoteParticipant.fromParticipantInfo(this.engine.client,i,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):n=new RemoteParticipant(this.engine.client,"",t,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&n.setAudioContext(this.audioContext),!((e=this.options.audioOutput)===null||e===void 0)&&e.deviceId&&n.setAudioOutput(this.options.audioOutput).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),n}getOrCreateParticipant(t,i){if(this.remoteParticipants.has(t)){const n=this.remoteParticipants.get(t);return i&&n.updateInfo(i)&&this.sidToIdentity.set(i.sid,i.identity),n}const e=this.createParticipant(t,i);return this.remoteParticipants.set(t,e),this.sidToIdentity.set(i.sid,i.identity),this.emitWhenConnected(RoomEvent.ParticipantConnected,e),e.on(ParticipantEvent.TrackPublished,n=>{this.emitWhenConnected(RoomEvent.TrackPublished,n,e)}).on(ParticipantEvent.TrackSubscribed,(n,s)=>{n.kind===Track.Kind.Audio?(n.on(TrackEvent.AudioPlaybackStarted,this.handleAudioPlaybackStarted),n.on(TrackEvent.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):n.kind===Track.Kind.Video&&(n.on(TrackEvent.VideoPlaybackFailed,this.handleVideoPlaybackFailed),n.on(TrackEvent.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(RoomEvent.TrackSubscribed,n,s,e)}).on(ParticipantEvent.TrackUnpublished,n=>{this.emit(RoomEvent.TrackUnpublished,n,e)}).on(ParticipantEvent.TrackUnsubscribed,(n,s)=>{this.emit(RoomEvent.TrackUnsubscribed,n,s,e)}).on(ParticipantEvent.TrackSubscriptionFailed,n=>{this.emit(RoomEvent.TrackSubscriptionFailed,n,e)}).on(ParticipantEvent.TrackMuted,n=>{this.emitWhenConnected(RoomEvent.TrackMuted,n,e)}).on(ParticipantEvent.TrackUnmuted,n=>{this.emitWhenConnected(RoomEvent.TrackUnmuted,n,e)}).on(ParticipantEvent.ParticipantMetadataChanged,n=>{this.emitWhenConnected(RoomEvent.ParticipantMetadataChanged,n,e)}).on(ParticipantEvent.ParticipantNameChanged,n=>{this.emitWhenConnected(RoomEvent.ParticipantNameChanged,n,e)}).on(ParticipantEvent.AttributesChanged,n=>{this.emitWhenConnected(RoomEvent.ParticipantAttributesChanged,n,e)}).on(ParticipantEvent.ConnectionQualityChanged,n=>{this.emitWhenConnected(RoomEvent.ConnectionQualityChanged,n,e)}).on(ParticipantEvent.ParticipantPermissionsChanged,n=>{this.emitWhenConnected(RoomEvent.ParticipantPermissionsChanged,n,e)}).on(ParticipantEvent.TrackSubscriptionStatusChanged,(n,s)=>{this.emitWhenConnected(RoomEvent.TrackSubscriptionStatusChanged,n,s,e)}).on(ParticipantEvent.TrackSubscriptionFailed,(n,s)=>{this.emit(RoomEvent.TrackSubscriptionFailed,n,e,s)}).on(ParticipantEvent.TrackSubscriptionPermissionChanged,(n,s)=>{this.emitWhenConnected(RoomEvent.TrackSubscriptionPermissionChanged,n,s,e)}),i&&e.updateInfo(i),e}sendSyncState(){const t=Array.from(this.remoteParticipants.values()).reduce((e,n)=>(e.push(...n.getTrackPublications()),e),[]),i=this.localParticipant.getTrackPublications();this.engine.sendSyncState(t,i)}updateSubscriptions(){for(const t of this.remoteParticipants.values())for(const i of t.videoTrackPublications.values())i.isSubscribed&&i instanceof RemoteTrackPublication&&i.emitTrackUpdate()}getRemoteParticipantBySid(t){const i=this.sidToIdentity.get(t);if(i)return this.remoteParticipants.get(i)}registerConnectionReconcile(){this.clearConnectionReconcile();let t=0;this.connectionReconcileInterval=CriticalTimers.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(t++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:t,engine:{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}})),t>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,DisconnectReason.STATE_MISMATCH))):t=0},connectionReconcileFrequency)}clearConnectionReconcile(){this.connectionReconcileInterval&&CriticalTimers.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(t){return t===this.state?!1:(this.state=t,this.emit(RoomEvent.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(t=>{let[i,e]=t;this.emit(i,...e)}),this.bufferedEvents=[]}emitWhenConnected(t){for(var i=arguments.length,e=new Array(i>1?i-1:0),n=1;n<i;n++)e[n-1]=arguments[n];if(this.state===ConnectionState.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([t,e]);else if(this.state===ConnectionState.Connected)return this.emit(t,...e);return!1}simulateParticipants(t){return __awaiter(this,void 0,void 0,function*(){var i,e;const n=Object.assign({audio:!0,video:!0,useRealTracks:!1},t.publish),s=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},t.participants);if(this.handleDisconnect(),this.roomInfo=new Room$1({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:protoInt64.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new ParticipantInfo({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(RoomEvent.SignalConnected),this.emit(RoomEvent.Connected),this.setAndEmitConnectionState(ConnectionState.Connected),n.video){const a=new LocalTrackPublication(Track.Kind.Video,new TrackInfo({source:TrackSource.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO,name:"video-dummy"}),new LocalVideoTrack(n.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:createDummyVideoStreamTrack(160*((i=s.aspectRatios[0])!==null&&i!==void 0?i:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(a),this.localParticipant.emit(ParticipantEvent.LocalTrackPublished,a)}if(n.audio){const a=new LocalTrackPublication(Track.Kind.Audio,new TrackInfo({source:TrackSource.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO}),new LocalAudioTrack(n.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:getEmptyAudioStreamTrack(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(a),this.localParticipant.emit(ParticipantEvent.LocalTrackPublished,a)}for(let a=0;a<s.count-1;a+=1){let c=new ParticipantInfo({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(a),state:ParticipantInfo_State.ACTIVE,tracks:[],joinedAt:protoInt64.parse(Date.now())});const l=this.getOrCreateParticipant(c.identity,c);if(s.video){const u=createDummyVideoStreamTrack(160*((e=s.aspectRatios[a%s.aspectRatios.length])!==null&&e!==void 0?e:1),160,!1,!0),d=new TrackInfo({source:TrackSource.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO});l.addSubscribedMediaTrack(u,d.sid,new MediaStream([u]),new RTCRtpReceiver),c.tracks=[...c.tracks,d]}if(s.audio){const u=getEmptyAudioStreamTrack(),d=new TrackInfo({source:TrackSource.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO});l.addSubscribedMediaTrack(u,d.sid,new MediaStream([u]),new RTCRtpReceiver),c.tracks=[...c.tracks,d]}l.updateInfo(c)}})}emit(t){for(var i=arguments.length,e=new Array(i>1?i-1:0),n=1;n<i;n++)e[n-1]=arguments[n];if(t!==RoomEvent.ActiveSpeakersChanged){const s=mapArgs(e).filter(a=>a!==void 0);this.log.debug("room event ".concat(t),Object.assign(Object.assign({},this.logContext),{event:t,args:s}))}return super.emit(t,...e)}}function mapArgs(o){return o.map(t=>{if(t)return Array.isArray(t)?mapArgs(t):typeof t=="object"?"logContext"in t&&t.logContext:t})}var CheckStatus;(function(o){o[o.IDLE=0]="IDLE",o[o.RUNNING=1]="RUNNING",o[o.SKIPPED=2]="SKIPPED",o[o.SUCCESS=3]="SUCCESS",o[o.FAILED=4]="FAILED"})(CheckStatus||(CheckStatus={}));class Checker extends eventsExports.EventEmitter{constructor(t,i){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=CheckStatus.IDLE,this.logs=[],this.errorsAsWarnings=!1,this.url=t,this.token=i,this.name=this.constructor.name,this.room=new Room(e.roomOptions),this.connectOptions=e.connectOptions,e.errorsAsWarnings&&(this.errorsAsWarnings=e.errorsAsWarnings)}run(t){return __awaiter(this,void 0,void 0,function*(){if(this.status!==CheckStatus.IDLE)throw Error("check is running already");this.setStatus(CheckStatus.RUNNING);try{yield this.perform()}catch(i){i instanceof Error&&(this.errorsAsWarnings?this.appendWarning(i.message):this.appendError(i.message))}return yield this.disconnect(),yield new Promise(i=>setTimeout(i,500)),this.status!==CheckStatus.SKIPPED&&this.setStatus(this.isSuccess()?CheckStatus.SUCCESS:CheckStatus.FAILED),t&&t(),this.getInfo()})}isSuccess(){return!this.logs.some(t=>t.level==="error")}connect(){return __awaiter(this,void 0,void 0,function*(){return this.room.state===ConnectionState.Connected?this.room:(yield this.room.connect(this.url,this.token),this.room)})}disconnect(){return __awaiter(this,void 0,void 0,function*(){this.room&&this.room.state!==ConnectionState.Disconnected&&(yield this.room.disconnect(),yield new Promise(t=>setTimeout(t,500)))})}skip(){this.setStatus(CheckStatus.SKIPPED)}appendMessage(t){this.logs.push({level:"info",message:t}),this.emit("update",this.getInfo())}appendWarning(t){this.logs.push({level:"warning",message:t}),this.emit("update",this.getInfo())}appendError(t){this.logs.push({level:"error",message:t}),this.emit("update",this.getInfo())}setStatus(t){this.status=t,this.emit("update",this.getInfo())}get engine(){var t;return(t=this.room)===null||t===void 0?void 0:t.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}function createLocalTracks(o){return __awaiter(this,void 0,void 0,function*(){var t,i;o??(o={}),(t=o.audio)!==null&&t!==void 0||(o.audio=!0),(i=o.video)!==null&&i!==void 0||(o.video=!0);const e=mergeDefaultOptions(o,audioDefaults,videoDefaults),n=constraintsForOptions(e),s=navigator.mediaDevices.getUserMedia(n);o.audio&&(DeviceManager.userMediaPromiseMap.set("audioinput",s),s.catch(()=>DeviceManager.userMediaPromiseMap.delete("audioinput"))),o.video&&(DeviceManager.userMediaPromiseMap.set("videoinput",s),s.catch(()=>DeviceManager.userMediaPromiseMap.delete("videoinput")));const a=yield s;return Promise.all(a.getTracks().map(c=>__awaiter(this,void 0,void 0,function*(){const l=c.kind==="audio";let u=l?o.audio:o.video;(typeof u=="boolean"||!u)&&(u={});let d;const f=l?n.audio:n.video;typeof f!="boolean"&&(d=f),d?d.deviceId=c.getSettings().deviceId:d={deviceId:c.getSettings().deviceId};const h=mediaTrackToLocalTrack(c,d);return h.kind===Track.Kind.Video?h.source=Track.Source.Camera:h.kind===Track.Kind.Audio&&(h.source=Track.Source.Microphone),h.mediaStream=a,u.processor&&(h instanceof LocalAudioTrack?yield h.setProcessor(u.processor):h instanceof LocalVideoTrack&&(yield h.setProcessor(u.processor))),h})))})}function createLocalVideoTrack(o){return __awaiter(this,void 0,void 0,function*(){return(yield createLocalTracks({audio:!1,video:o}))[0]})}function createLocalAudioTrack(o){return __awaiter(this,void 0,void 0,function*(){return(yield createLocalTracks({audio:o,video:!1}))[0]})}class PublishAudioCheck extends Checker{get description(){return"Can publish audio"}perform(){return __awaiter(this,void 0,void 0,function*(){var t;const i=yield this.connect(),e=yield createLocalAudioTrack();i.localParticipant.publishTrack(e),yield new Promise(a=>setTimeout(a,3e3));const n=yield(t=e.sender)===null||t===void 0?void 0:t.getStats();if(!n)throw new Error("Could not get RTCStats");let s=0;if(n.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="audio"||!a.kind&&a.mediaType==="audio")&&(s=a.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," audio packets"))})}}class PublishVideoCheck extends Checker{get description(){return"Can publish video"}perform(){return __awaiter(this,void 0,void 0,function*(){var t;const i=yield this.connect(),e=yield createLocalVideoTrack();i.localParticipant.publishTrack(e),yield new Promise(a=>setTimeout(a,5e3));const n=yield(t=e.sender)===null||t===void 0?void 0:t.getStats();if(!n)throw new Error("Could not get RTCStats");let s=0;if(n.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="video"||!a.kind&&a.mediaType==="video")&&(s+=a.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}}class ReconnectCheck extends Checker{get description(){return"Resuming connection after interruption"}perform(){return __awaiter(this,void 0,void 0,function*(){var t;const i=yield this.connect();let e=!1,n=!1,s;const a=new Promise(u=>{setTimeout(u,5e3),s=u}),c=()=>{e=!0};i.on(RoomEvent.SignalReconnecting,c).on(RoomEvent.Reconnecting,c).on(RoomEvent.Reconnected,()=>{n=!0,s(!0)}),(t=i.engine.client.ws)===null||t===void 0||t.close();const l=i.engine.client.onClose;if(l&&l(""),yield a,e){if(!n||i.state!==ConnectionState.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class TURNCheck extends Checker{get description(){return"Can connect via TURN"}perform(){return __awaiter(this,void 0,void 0,function*(){var t,i;const e=new SignalClient,n=yield e.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let s=!1,a=!1,c=!1;for(let l of n.iceServers)for(let u of l.urls)u.startsWith("turn:")?(a=!0,c=!0):u.startsWith("turns:")&&(a=!0,c=!0,s=!0),u.startsWith("stun:")&&(c=!0);c?a&&!s&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield e.close(),!((i=(t=this.connectOptions)===null||t===void 0?void 0:t.rtcConfig)===null||i===void 0)&&i.iceServers||a?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(l=>setTimeout(l,0)))})}}class WebRTCCheck extends Checker{get description(){return"Establishing WebRTC connection"}perform(){return __awaiter(this,void 0,void 0,function*(){let t=!1,i=!1;this.room.on(RoomEvent.SignalConnected,()=>{const e=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(n,s)=>{if(n.candidate){const a=new RTCIceCandidate(n);let c="".concat(a.protocol," ").concat(a.address,":").concat(a.port," ").concat(a.type);a.address&&(isIPPrivate(a.address)?c+=" (private)":a.protocol==="tcp"&&a.tcpType==="passive"?(t=!0,c+=" (passive)"):a.protocol==="udp"&&(i=!0)),this.appendMessage(c)}e&&e(n,s)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=n=>{n instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(n.errorCode," ").concat(n.errorText," ").concat(n.url))})});try{yield this.connect(),livekitLogger.info("now the room is connected")}catch(e){throw this.appendWarning("ports need to be open on firewall in order to connect."),e}t||this.appendWarning("Server is not configured for ICE/TCP"),i||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function isIPPrivate(o){const t=o.split(".");if(t.length===4){if(t[0]==="10")return!0;if(t[0]==="192"&&t[1]==="168")return!0;if(t[0]==="172"){const i=parseInt(t[1],10);if(i>=16&&i<=31)return!0}}return!1}class WebSocketCheck extends Checker{get description(){return"Connecting to signal connection via WebSocket"}perform(){return __awaiter(this,void 0,void 0,function*(){var t,i,e;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let n=new SignalClient;const s=yield n.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((t=s.serverInfo)===null||t===void 0?void 0:t.edition)===ServerInfo_Edition.Cloud&&(!((i=s.serverInfo)===null||i===void 0)&&i.region)&&this.appendMessage("LiveKit Cloud: ".concat((e=s.serverInfo)===null||e===void 0?void 0:e.region)),yield n.close()})}}class ConnectionCheck extends eventsExports.EventEmitter{constructor(t,i){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=t,this.token=i,this.options=e}getNextCheckId(){const t=this.checkResults.size;return this.checkResults.set(t,{logs:[],status:CheckStatus.IDLE,name:"",description:""}),t}updateCheck(t,i){this.checkResults.set(t,i),this.emit("checkUpdate",t,i)}isSuccess(){return Array.from(this.checkResults.values()).every(t=>t.status!==CheckStatus.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(t){return __awaiter(this,void 0,void 0,function*(){const i=this.getNextCheckId(),e=new t(this.url,this.token,this.options),n=a=>{this.updateCheck(i,a)};e.on("update",n);const s=yield e.run();return e.off("update",n),s})}checkWebsocket(){return __awaiter(this,void 0,void 0,function*(){return this.createAndRunCheck(WebSocketCheck)})}checkWebRTC(){return __awaiter(this,void 0,void 0,function*(){return this.createAndRunCheck(WebRTCCheck)})}checkTURN(){return __awaiter(this,void 0,void 0,function*(){return this.createAndRunCheck(TURNCheck)})}checkReconnect(){return __awaiter(this,void 0,void 0,function*(){return this.createAndRunCheck(ReconnectCheck)})}checkPublishAudio(){return __awaiter(this,void 0,void 0,function*(){return this.createAndRunCheck(PublishAudioCheck)})}checkPublishVideo(){return __awaiter(this,void 0,void 0,function*(){return this.createAndRunCheck(PublishVideoCheck)})}}var MavModeFlag=(o=>(o[o.MAV_MODE_FLAG_SAFETY_ARMED=128]="MAV_MODE_FLAG_SAFETY_ARMED",o[o.MAV_MODE_FLAG_MANUAL_INPUT_ENABLED=64]="MAV_MODE_FLAG_MANUAL_INPUT_ENABLED",o[o.MAV_MODE_FLAG_HIL_ENABLED=32]="MAV_MODE_FLAG_HIL_ENABLED",o[o.MAV_MODE_FLAG_STABILIZE_ENABLED=16]="MAV_MODE_FLAG_STABILIZE_ENABLED",o[o.MAV_MODE_FLAG_GUIDED_ENABLED=8]="MAV_MODE_FLAG_GUIDED_ENABLED",o[o.MAV_MODE_FLAG_AUTO_ENABLED=4]="MAV_MODE_FLAG_AUTO_ENABLED",o[o.MAV_MODE_FLAG_TEST_ENABLED=2]="MAV_MODE_FLAG_TEST_ENABLED",o[o.MAV_MODE_FLAG_CUSTOM_MODE_ENABLED=1]="MAV_MODE_FLAG_CUSTOM_MODE_ENABLED",o))(MavModeFlag||{}),MavState=(o=>(o.MAV_STATE_UNINIT="MAV_STATE_UNINIT",o.MAV_STATE_BOOT="MAV_STATE_BOOT",o.MAV_STATE_CALIBRATING="MAV_STATE_CALIBRATING",o.MAV_STATE_STANDBY="MAV_STATE_STANDBY",o.MAV_STATE_ACTIVE="MAV_STATE_ACTIVE",o.MAV_STATE_CRITICAL="MAV_STATE_CRITICAL",o.MAV_STATE_EMERGENCY="MAV_STATE_EMERGENCY",o.MAV_STATE_POWEROFF="MAV_STATE_POWEROFF",o.MAV_STATE_FLIGHT_TERMINATION="MAV_STATE_FLIGHT_TERMINATION",o))(MavState||{}),MavSeverity=(o=>(o.MAV_SEVERITY_EMERGENCY="MAV_SEVERITY_EMERGENCY",o.MAV_SEVERITY_ALERT="MAV_SEVERITY_ALERT",o.MAV_SEVERITY_CRITICAL="MAV_SEVERITY_CRITICAL",o.MAV_SEVERITY_ERROR="MAV_SEVERITY_ERROR",o.MAV_SEVERITY_WARNING="MAV_SEVERITY_WARNING",o.MAV_SEVERITY_NOTICE="MAV_SEVERITY_NOTICE",o.MAV_SEVERITY_INFO="MAV_SEVERITY_INFO",o.MAV_SEVERITY_DEBUG="MAV_SEVERITY_DEBUG",o))(MavSeverity||{}),MAVLinkType=(o=>(o.ACTUATOR_CONTROL_TARGET="ACTUATOR_CONTROL_TARGET",o.ACTUATOR_OUTPUT_STATUS="ACTUATOR_OUTPUT_STATUS",o.ADAP_TUNING="ADAP_TUNING",o.ADSB_VEHICLE="ADSB_VEHICLE",o.AHRS="AHRS",o.AHRS2="AHRS2",o.AHRS3="AHRS3",o.AIRSPEED_AUTOCAL="AIRSPEED_AUTOCAL",o.AIS_VESSEL="AIS_VESSEL",o.ALTITUDE="ALTITUDE",o.AOA_SSA="AOA_SSA",o.AP_ADC="AP_ADC",o.ATT_POS_MOCAP="ATT_POS_MOCAP",o.ATTITUDE="ATTITUDE",o.ATTITUDE_QUATERNION="ATTITUDE_QUATERNION",o.ATTITUDE_QUATERNION_COV="ATTITUDE_QUATERNION_COV",o.ATTITUDE_TARGET="ATTITUDE_TARGET",o.AUTH_KEY="AUTH_KEY",o.AUTOPILOT_STATE_FOR_GIMBAL_DEVICE="AUTOPILOT_STATE_FOR_GIMBAL_DEVICE",o.AUTOPILOT_VERSION="AUTOPILOT_VERSION",o.AUTOPILOT_VERSION_REQUEST="AUTOPILOT_VERSION_REQUEST",o.BATTERY_STATUS="BATTERY_STATUS",o.BATTERY2="BATTERY2",o.BUTTON_CHANGE="BUTTON_CHANGE",o.CAMERA_CAPTURE_STATUS="CAMERA_CAPTURE_STATUS",o.CAMERA_FEEDBACK="CAMERA_FEEDBACK",o.CAMERA_IMAGE_CAPTURED="CAMERA_IMAGE_CAPTURED",o.CAMERA_INFORMATION="CAMERA_INFORMATION",o.CAMERA_SETTINGS="CAMERA_SETTINGS",o.CAMERA_STATUS="CAMERA_STATUS",o.CAMERA_TRIGGER="CAMERA_TRIGGER",o.CELLULAR_CONFIG="CELLULAR_CONFIG",o.CELLULAR_STATUS="CELLULAR_STATUS",o.CHANGE_OPERATOR_CONTROL="CHANGE_OPERATOR_CONTROL",o.CHANGE_OPERATOR_CONTROL_ACK="CHANGE_OPERATOR_CONTROL_ACK",o.COLLISION="COLLISION",o.COMMAND_ACK="COMMAND_ACK",o.COMMAND_CANCEL="COMMAND_CANCEL",o.COMMAND_INT="COMMAND_INT",o.COMMAND_LONG="COMMAND_LONG",o.COMPASSMOT_STATUS="COMPASSMOT_STATUS",o.COMPONENT_INFORMATION="COMPONENT_INFORMATION",o.CONTROL_SYSTEM_STATE="CONTROL_SYSTEM_STATE",o.DATA_STREAM="DATA_STREAM",o.DATA_TRANSMISSION_HANDSHAKE="DATA_TRANSMISSION_HANDSHAKE",o.DATA16="DATA16",o.DATA32="DATA32",o.DATA64="DATA64",o.DATA96="DATA96",o.DEBUG="DEBUG",o.DEBUG_FLOAT_ARRAY="DEBUG_FLOAT_ARRAY",o.DEBUG_VECT="DEBUG_VECT",o.DEEPSTALL="DEEPSTALL",o.DEVICE_OP_READ="DEVICE_OP_READ",o.DEVICE_OP_READ_REPLY="DEVICE_OP_READ_REPLY",o.DEVICE_OP_WRITE="DEVICE_OP_WRITE",o.DEVICE_OP_WRITE_REPLY="DEVICE_OP_WRITE_REPLY",o.DIGICAM_CONFIGURE="DIGICAM_CONFIGURE",o.DIGICAM_CONTROL="DIGICAM_CONTROL",o.DISTANCE_SENSOR="DISTANCE_SENSOR",o.EFI_STATUS="EFI_STATUS",o.EKF_STATUS_REPORT="EKF_STATUS_REPORT",o.ENCAPSULATED_DATA="ENCAPSULATED_DATA",o.ESC_TELEMETRY_1_TO_4="ESC_TELEMETRY_1_TO_4",o.ESC_TELEMETRY_5_TO_8="ESC_TELEMETRY_5_TO_8",o.ESC_TELEMETRY_9_TO_12="ESC_TELEMETRY_9_TO_12",o.ESTIMATOR_STATUS="ESTIMATOR_STATUS",o.EXTENDED_SYS_STATE="EXTENDED_SYS_STATE",o.FENCE_FETCH_POINT="FENCE_FETCH_POINT",o.FENCE_POINT="FENCE_POINT",o.FENCE_STATUS="FENCE_STATUS",o.FILE_TRANSFER_PROTOCOL="FILE_TRANSFER_PROTOCOL",o.FLIGHT_INFORMATION="FLIGHT_INFORMATION",o.FOLLOW_TARGET="FOLLOW_TARGET",o.GENERATOR_STATUS="GENERATOR_STATUS",o.GIMBAL_CONTROL="GIMBAL_CONTROL",o.GIMBAL_DEVICE_ATTITUDE_STATUS="GIMBAL_DEVICE_ATTITUDE_STATUS",o.GIMBAL_DEVICE_INFORMATION="GIMBAL_DEVICE_INFORMATION",o.GIMBAL_DEVICE_SET_ATTITUDE="GIMBAL_DEVICE_SET_ATTITUDE",o.GIMBAL_MANAGER_INFORMATION="GIMBAL_MANAGER_INFORMATION",o.GIMBAL_MANAGER_SET_ATTITUDE="GIMBAL_MANAGER_SET_ATTITUDE",o.GIMBAL_MANAGER_SET_TILTPAN="GIMBAL_MANAGER_SET_TILTPAN",o.GIMBAL_MANAGER_STATUS="GIMBAL_MANAGER_STATUS",o.GIMBAL_REPORT="GIMBAL_REPORT",o.GIMBAL_TORQUE_CMD_REPORT="GIMBAL_TORQUE_CMD_REPORT",o.GLOBAL_POSITION_INT="GLOBAL_POSITION_INT",o.GLOBAL_POSITION_INT_COV="GLOBAL_POSITION_INT_COV",o.GLOBAL_VISION_POSITION_ESTIMATE="GLOBAL_VISION_POSITION_ESTIMATE",o.GOPRO_GET_REQUEST="GOPRO_GET_REQUEST",o.GOPRO_GET_RESPONSE="GOPRO_GET_RESPONSE",o.GOPRO_HEARTBEAT="GOPRO_HEARTBEAT",o.GOPRO_SET_REQUEST="GOPRO_SET_REQUEST",o.GOPRO_SET_RESPONSE="GOPRO_SET_RESPONSE",o.GPS_GLOBAL_ORIGIN="GPS_GLOBAL_ORIGIN",o.GPS_INJECT_DATA="GPS_INJECT_DATA",o.GPS_INPUT="GPS_INPUT",o.GPS_RAW_INT="GPS_RAW_INT",o.GPS_RTCM_DATA="GPS_RTCM_DATA",o.GPS_RTK="GPS_RTK",o.GPS_STATUS="GPS_STATUS",o.GPS2_RAW="GPS2_RAW",o.GPS2_RTK="GPS2_RTK",o.HEARTBEAT="HEARTBEAT",o.HIGH_LATENCY="HIGH_LATENCY",o.HIGH_LATENCY2="HIGH_LATENCY2",o.HIGHRES_IMU="HIGHRES_IMU",o.HIL_ACTUATOR_CONTROLS="HIL_ACTUATOR_CONTROLS",o.HIL_CONTROLS="HIL_CONTROLS",o.HIL_GPS="HIL_GPS",o.HIL_OPTICAL_FLOW="HIL_OPTICAL_FLOW",o.HIL_RC_INPUTS_RAW="HIL_RC_INPUTS_RAW",o.HIL_SENSOR="HIL_SENSOR",o.HIL_STATE="HIL_STATE",o.HIL_STATE_QUATERNION="HIL_STATE_QUATERNION",o.HOME_POSITION="HOME_POSITION",o.HWSTATUS="HWSTATUS",o.ISBD_LINK_STATUS="ISBD_LINK_STATUS",o.LANDING_TARGET="LANDING_TARGET",o.LED_CONTROL="LED_CONTROL",o.LIMITS_STATUS="LIMITS_STATUS",o.LINK_NODE_STATUS="LINK_NODE_STATUS",o.LOCAL_POSITION_NED="LOCAL_POSITION_NED",o.LOCAL_POSITION_NED_COV="LOCAL_POSITION_NED_COV",o.LOCAL_POSITION_NED_SYSTEM_GLOBAL_OFFSET="LOCAL_POSITION_NED_SYSTEM_GLOBAL_OFFSET",o.LOG_DATA="LOG_DATA",o.LOG_ENTRY="LOG_ENTRY",o.LOG_ERASE="LOG_ERASE",o.LOG_REQUEST_DATA="LOG_REQUEST_DATA",o.LOG_REQUEST_END="LOG_REQUEST_END",o.LOG_REQUEST_LIST="LOG_REQUEST_LIST",o.LOGGING_ACK="LOGGING_ACK",o.LOGGING_DATA="LOGGING_DATA",o.LOGGING_DATA_ACKED="LOGGING_DATA_ACKED",o.MAG_CAL_PROGRESS="MAG_CAL_PROGRESS",o.MAG_CAL_REPORT="MAG_CAL_REPORT",o.MANUAL_CONTROL="MANUAL_CONTROL",o.MANUAL_SETPOINT="MANUAL_SETPOINT",o.MEMINFO="MEMINFO",o.MEMORY_VECT="MEMORY_VECT",o.MESSAGE_INTERVAL="MESSAGE_INTERVAL",o.MISSION_ACK="MISSION_ACK",o.MISSION_CHANGED="MISSION_CHANGED",o.MISSION_CLEAR_ALL="MISSION_CLEAR_ALL",o.MISSION_COUNT="MISSION_COUNT",o.MISSION_CURRENT="MISSION_CURRENT",o.MISSION_ITEM="MISSION_ITEM",o.MISSION_ITEM_INT="MISSION_ITEM_INT",o.MISSION_ITEM_REACHED="MISSION_ITEM_REACHED",o.MISSION_REQUEST="MISSION_REQUEST",o.MISSION_REQUEST_INT="MISSION_REQUEST_INT",o.MISSION_REQUEST_LIST="MISSION_REQUEST_LIST",o.MISSION_REQUEST_PARTIAL_LIST="MISSION_REQUEST_PARTIAL_LIST",o.MISSION_SET_CURRENT="MISSION_SET_CURRENT",o.MISSION_WRITE_PARTIAL_LIST="MISSION_WRITE_PARTIAL_LIST",o.MOUNT_CONFIGURE="MOUNT_CONFIGURE",o.MOUNT_CONTROL="MOUNT_CONTROL",o.MOUNT_ORIENTATION="MOUNT_ORIENTATION",o.MOUNT_STATUS="MOUNT_STATUS",o.NAMED_VALUE_FLOAT="NAMED_VALUE_FLOAT",o.NAMED_VALUE_INT="NAMED_VALUE_INT",o.NAV_CONTROLLER_OUTPUT="NAV_CONTROLLER_OUTPUT",o.OBSTACLE_DISTANCE="OBSTACLE_DISTANCE",o.ODOMETRY="ODOMETRY",o.ONBOARD_COMPUTER_STATUS="ONBOARD_COMPUTER_STATUS",o.OPEN_DRONE_ID_AUTHENTICATION="OPEN_DRONE_ID_AUTHENTICATION",o.OPEN_DRONE_ID_BASIC_ID="OPEN_DRONE_ID_BASIC_ID",o.OPEN_DRONE_ID_LOCATION="OPEN_DRONE_ID_LOCATION",o.OPEN_DRONE_ID_MESSAGE_PACK="OPEN_DRONE_ID_MESSAGE_PACK",o.OPEN_DRONE_ID_OPERATOR_ID="OPEN_DRONE_ID_OPERATOR_ID",o.OPEN_DRONE_ID_SELF_ID="OPEN_DRONE_ID_SELF_ID",o.OPEN_DRONE_ID_SYSTEM="OPEN_DRONE_ID_SYSTEM",o.OPTICAL_FLOW="OPTICAL_FLOW",o.OPTICAL_FLOW_RAD="OPTICAL_FLOW_RAD",o.ORBIT_EXECUTION_STATUS="ORBIT_EXECUTION_STATUS",o.PARAM_EXT_ACK="PARAM_EXT_ACK",o.PARAM_EXT_REQUEST_LIST="PARAM_EXT_REQUEST_LIST",o.PARAM_EXT_REQUEST_READ="PARAM_EXT_REQUEST_READ",o.PARAM_EXT_SET="PARAM_EXT_SET",o.PARAM_EXT_VALUE="PARAM_EXT_VALUE",o.PARAM_MAP_RC="PARAM_MAP_RC",o.PARAM_REQUEST_LIST="PARAM_REQUEST_LIST",o.PARAM_REQUEST_READ="PARAM_REQUEST_READ",o.PARAM_SET="PARAM_SET",o.PARAM_VALUE="PARAM_VALUE",o.PID_TUNING="PID_TUNING",o.PING="PING",o.PLAY_TUNE="PLAY_TUNE",o.PLAY_TUNE_V2="PLAY_TUNE_V2",o.POSITION_TARGET_GLOBAL_INT="POSITION_TARGET_GLOBAL_INT",o.POSITION_TARGET_LOCAL_NED="POSITION_TARGET_LOCAL_NED",o.POWER_STATUS="POWER_STATUS",o.PROTOCOL_VERSION="PROTOCOL_VERSION",o.RADIO="RADIO",o.RADIO_STATUS="RADIO_STATUS",o.RALLY_FETCH_POINT="RALLY_FETCH_POINT",o.RALLY_POINT="RALLY_POINT",o.RANGEFINDER="RANGEFINDER",o.RAW_IMU="RAW_IMU",o.RAW_PRESSURE="RAW_PRESSURE",o.RAW_RPM="RAW_RPM",o.RC_CHANNELS="RC_CHANNELS",o.RC_CHANNELS_OVERRIDE="RC_CHANNELS_OVERRIDE",o.RC_CHANNELS_RAW="RC_CHANNELS_RAW",o.RC_CHANNELS_SCALED="RC_CHANNELS_SCALED",o.REMOTE_LOG_BLOCK_STATUS="REMOTE_LOG_BLOCK_STATUS",o.REMOTE_LOG_DATA_BLOCK="REMOTE_LOG_DATA_BLOCK",o.REQUEST_DATA_STREAM="REQUEST_DATA_STREAM",o.RESOURCE_REQUEST="RESOURCE_REQUEST",o.RPM="RPM",o.SAFETY_ALLOWED_AREA="SAFETY_ALLOWED_AREA",o.SAFETY_SET_ALLOWED_AREA="SAFETY_SET_ALLOWED_AREA",o.SCALED_IMU="SCALED_IMU",o.SCALED_IMU2="SCALED_IMU2",o.SCALED_IMU3="SCALED_IMU3",o.SCALED_PRESSURE="SCALED_PRESSURE",o.SCALED_PRESSURE2="SCALED_PRESSURE2",o.SCALED_PRESSURE3="SCALED_PRESSURE3",o.SENSOR_OFFSETS="SENSOR_OFFSETS",o.SERIAL_CONTROL="SERIAL_CONTROL",o.SERVO_OUTPUT_RAW="SERVO_OUTPUT_RAW",o.SET_ACTUATOR_CONTROL_TARGET="SET_ACTUATOR_CONTROL_TARGET",o.SET_ATTITUDE_TARGET="SET_ATTITUDE_TARGET",o.SET_GPS_GLOBAL_ORIGIN="SET_GPS_GLOBAL_ORIGIN",o.SET_HOME_POSITION="SET_HOME_POSITION",o.SET_MAG_OFFSETS="SET_MAG_OFFSETS",o.SET_MODE="SET_MODE",o.SET_POSITION_TARGET_GLOBAL_INT="SET_POSITION_TARGET_GLOBAL_INT",o.SET_POSITION_TARGET_LOCAL_NED="SET_POSITION_TARGET_LOCAL_NED",o.SETUP_SIGNING="SETUP_SIGNING",o.SIM_STATE="SIM_STATE",o.SIMSTATE="SIMSTATE",o.SMART_BATTERY_INFO="SMART_BATTERY_INFO",o.SMART_BATTERY_STATUS="SMART_BATTERY_STATUS",o.STATUSTEXT="STATUSTEXT",o.STORAGE_INFORMATION="STORAGE_INFORMATION",o.SUPPORTED_TUNES="SUPPORTED_TUNES",o.SYS_STATUS="SYS_STATUS",o.SYSTEM_TIME="SYSTEM_TIME",o.TERRAIN_CHECK="TERRAIN_CHECK",o.TERRAIN_DATA="TERRAIN_DATA",o.TERRAIN_REPORT="TERRAIN_REPORT",o.TERRAIN_REQUEST="TERRAIN_REQUEST",o.TIME_ESTIMATE_TO_TARGET="TIME_ESTIMATE_TO_TARGET",o.TIMESYNC="TIMESYNC",o.TRAJECTORY_REPRESENTATION_BEZIER="TRAJECTORY_REPRESENTATION_BEZIER",o.TRAJECTORY_REPRESENTATION_WAYPOINTS="TRAJECTORY_REPRESENTATION_WAYPOINTS",o.TUNNEL="TUNNEL",o.UAVCAN_NODE_INFO="UAVCAN_NODE_INFO",o.UAVCAN_NODE_STATUS="UAVCAN_NODE_STATUS",o.UTM_GLOBAL_POSITION="UTM_GLOBAL_POSITION",o.V2_EXTENSION="V2_EXTENSION",o.VFR_HUD="VFR_HUD",o.VIBRATION="VIBRATION",o.VICON_POSITION_ESTIMATE="VICON_POSITION_ESTIMATE",o.VIDEO_STREAM_INFORMATION="VIDEO_STREAM_INFORMATION",o.VIDEO_STREAM_STATUS="VIDEO_STREAM_STATUS",o.VISION_POSITION_DELTA="VISION_POSITION_DELTA",o.VISION_POSITION_ESTIMATE="VISION_POSITION_ESTIMATE",o.VISION_SPEED_ESTIMATE="VISION_SPEED_ESTIMATE",o.WHEEL_DISTANCE="WHEEL_DISTANCE",o.WIFI_CONFIG_AP="WIFI_CONFIG_AP",o.WIND="WIND",o.WIND_COV="WIND_COV",o))(MAVLinkType||{}),ConnectionStates=(o=>(o.init="Init",o.connecting="Connecting",o.connected="Connected",o.reconnecting="Reconnecting",o.disconnectedOk="Disconnected",o.failed="Failed",o))(ConnectionStates||{});new TextEncoder;const TD=new TextDecoder,DECODE_TXT=o=>TD.decode(o),ENCRYPTED_AUTH_TOKEN_PREFIX="AUTHTOKEN:",SEA_LEVEL_PRESSURE=1013.25;MAVLinkType.HEARTBEAT,MAVLinkType.ATTITUDE,MAVLinkType.SYS_STATUS,MAVLinkType.STATUSTEXT,MAVLinkType.SCALED_PRESSURE,MAVLinkType.SCALED_PRESSURE2,MAVLinkType.SCALED_PRESSURE3;const LIVEKIT_FRONTEND_ROOM_CONNECTION_CONFIG={autoSubscribe:!1,maxRetries:6,peerConnectionTimeout:15e3};new DefaultReconnectPolicy;const LIVEKIT_FRONTEND_ROOM_CONFIG={reconnectPolicy:new DefaultReconnectPolicy,dynacast:!0,disconnectOnPageLeave:!0,adaptiveStream:!0},SIMPLEPEER_BASE_CONFIG={initiator:!0,trickle:!0,config:{bundlePolicy:"balanced",iceTransportPolicy:"all"}},urlParams=new URLSearchParams(window.location.search);function getStringQueryParam(o,t){const i=urlParams.get(o);if(i==null||i===""){if(t===void 0)throw new Error("Missing required url query parameter (string): "+o);return t}return i}function getBooleanQueryParam(o,t){const i=urlParams.get(o);if(i==null||i===""){if(t===void 0)throw new Error("Missing required boolean url query parameter (boolean): "+o);return t}return i.toLowerCase()!=="false"}const LIVEKIT_LIST_ONLY_TOKEN="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ2aWRlbyI6eyJyb29tTGlzdCI6dHJ1ZSwicm9vbUpvaW4iOmZhbHNlLCJjYW5QdWJsaXNoIjpmYWxzZSwiY2FuU3Vic2NyaWJlIjpmYWxzZSwiY2FuUHVibGlzaERhdGEiOmZhbHNlLCJjYW5VcGRhdGVPd25NZXRhZGF0YSI6ZmFsc2V9LCJpYXQiOjE2OTE0NTEzNDEsIm5iZiI6MTY5MTQ1MTM0MSwiZXhwIjoxMTE1MjI1MTM0MSwiaXNzIjoiQVBJSGQ3Qm9hOVJVVWlUIiwic3ViIjoibHQiLCJqdGkiOiJsdCJ9.X5fI6ceu2aLf0bc-h3PKc-u2PRzSAgVZEpK5FjScRGQ",URL_PARAMS={DEBUG_MODE:getBooleanQueryParam("DEBUG_MODE",!1),SHOW_REMOTE_LOGS:getBooleanQueryParam("SHOW_REMOTE_LOGS",!0),LIVEKIT_CLOUD_ENDPOINT:getStringQueryParam("LIVEKIT_CLOUD_URL","https://rov-web.livekit.cloud"),LIVEKIT_LOCAL_ENDPOINT:getStringQueryParam("LIVEKIT_LOCAL_URL","http://localhost:7880")},PING_INTERVAL=1e3,MOVE_MSG_TIMEOUT=100;var GPAD_STANDARD_BUTTON_INDEX=(o=>(o[o.A=0]="A",o[o.B=1]="B",o[o.X=2]="X",o[o.Y=3]="Y",o[o.LB=4]="LB",o[o.RB=5]="RB",o[o.LT=6]="LT",o[o.RT=7]="RT",o[o.SELECT=8]="SELECT",o[o.START=9]="START",o[o.LSTICK=10]="LSTICK",o[o.RSTICK=11]="RSTICK",o[o.DPAD_UP=12]="DPAD_UP",o[o.DPAD_DOWN=13]="DPAD_DOWN",o[o.DPAD_LEFT=14]="DPAD_LEFT",o[o.DPAD_RIGHT=15]="DPAD_RIGHT",o[o.VENDOR=16]="VENDOR",o))(GPAD_STANDARD_BUTTON_INDEX||{});const GPAD_STANDARD_BUTTON_INDEX_TO_MAVLINK_INDEX={0:0,1:1,2:2,3:3,4:9,5:10,8:4,9:6,10:7,11:8,12:11,13:12,14:13,15:14,16:5},GAME_CONTROLLER_BUTTON_CONFIG=[{btnName:"button_1",helpLabel:"Take Control",tooltipPlacement:"left"},{btnName:"button_2",helpLabel:"HALT Motors",tooltipPlacement:"left"},{btnName:"button_3",helpLabel:"Take Photo (N/A)",tooltipPlacement:"left"},{btnName:"button_4",helpLabel:"Change Fly Mode",tooltipPlacement:"left"},{btnName:"shoulder_button_front_left",helpLabel:"Decrease Throttle",tooltipPlacement:"right",fireWhileHolding:!0},{btnName:"shoulder_button_front_right",helpLabel:"Increase Throttle",tooltipPlacement:"left",fireWhileHolding:!0},{btnName:"shoulder_trigger_back_left",helpLabel:"Open Claw",fireWhileHolding:!0,tooltipPlacement:"right"},{btnName:"shoulder_trigger_back_right",helpLabel:"Close Claw",fireWhileHolding:!0,tooltipPlacement:"left"},{btnName:"select_button",helpLabel:"Tutorial",tooltipPlacement:"right"},{btnName:"start_button",helpLabel:"Move-Roll Toggle",tooltipPlacement:"left"},{btnName:"stick_button_left",helpLabel:"Move Forward-Back & Turn",tooltipPlacement:"right"},{btnName:"stick_button_right",helpLabel:"Move Up-Down & Left-Right",tooltipPlacement:"left"},{btnName:"d_pad_up",helpLabel:"Look Up",fireWhileHolding:!0,tooltipPlacement:"right"},{btnName:"d_pad_down",helpLabel:"Look Down",fireWhileHolding:!0,tooltipPlacement:"right"},{btnName:"d_pad_left",helpLabel:"Dim Lights",fireWhileHolding:!0,tooltipPlacement:"right"},{btnName:"d_pad_right",helpLabel:"Brighten Lights",fireWhileHolding:!0,tooltipPlacement:"right"}],ONSCREEN_GPAD_BUTTON_LABELS=["button_1","button_2","button_3","button_4","shoulder_button_front_left","shoulder_button_front_right","shoulder_trigger_back_left","shoulder_trigger_back_right","select_button","start_button","stick_button_left","stick_button_right","d_pad_up","d_pad_down","d_pad_left","d_pad_right"],ONSCREEN_GPAD_BUTTON_TOUCHED_CLASS="touched",ONSCREEN_GPAD_BUTTON_PRESSED_CLASS="pressed";function getURLQueryStringVariable(o){let i=window.location.search.substring(1).split("&");for(let e=0;e<i.length;e++){let n=i[e].split("=");if(decodeURIComponent(n[0])==o)return decodeURIComponent(n[1])}logWarn(`Query variable ${o} not found`)}function toggleFullscreen(o,t){t=t||document.documentElement;let i=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;!i||t!==i?(t.requestFullscreen||t.webkitEnterFullscreen||t.webkitRequestFullscreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullscreen).apply(t):(document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen).apply(document)}let modalStore=null;const setModalStore=o=>modalStore=o,openLogsTimelineModal=()=>{modalStore.trigger({type:"component",component:"LogTimeline"})},openControlTutModal=()=>{const o=Array.from(get_store_value(modalStore)).pop();o&&o.component==="ControlSchemeTut"?closeModal():modalStore.trigger({type:"component",component:"ControlSchemeTut"})},openFlyModesTutModal=()=>{const o=Array.from(get_store_value(modalStore)).pop();o&&o.component==="FlyModesTut"?closeModal():modalStore.trigger({type:"component",component:"FlyModesTut"})},closeModal=()=>modalStore.close();function popup(o,t){const{computePosition:i,autoUpdate:e,offset:n,shift:s,flip:a,arrow:c,size:l,autoPlacement:u,hide:d,inline:f}=get_store_value(storePopup),h={open:!1,autoUpdateCleanup:()=>{}},p=':is(a[href], button, input, textarea, select, details, [tabindex]):not([tabindex="-1"])';let m;const g="https://www.skeleton.dev/utilities/popups";let v,T,b=!1;function _(){v=document.querySelector(`[data-popup="${t.target}"]`)??document.createElement("div"),T=v.querySelector(".arrow")??document.createElement("div")}_();function y(){var S,k,A,M,N,L,U,x;if(!v)throw new Error(`The data-popup="${t.target}" element was not found. ${g}`);if(!i)throw new Error(`Floating UI 'computePosition' not found for data-popup="${t.target}". ${g}`);if(!n)throw new Error(`Floating UI 'offset' not found for data-popup="${t.target}". ${g}`);if(!s)throw new Error(`Floating UI 'shift' not found for data-popup="${t.target}". ${g}`);if(!a)throw new Error(`Floating UI 'flip' not found for data-popup="${t.target}". ${g}`);if(!c)throw new Error(`Floating UI 'arrow' not found for data-popup="${t.target}". ${g}`);const O=[];l&&O.push(l((S=t.middleware)==null?void 0:S.size)),u&&O.push(u((k=t.middleware)==null?void 0:k.autoPlacement)),d&&O.push(d((A=t.middleware)==null?void 0:A.hide)),f&&O.push(f((M=t.middleware)==null?void 0:M.inline)),i(o,v,{placement:t.placement??"bottom",middleware:[n(((N=t.middleware)==null?void 0:N.offset)??8),s(((L=t.middleware)==null?void 0:L.shift)??{padding:8}),a((U=t.middleware)==null?void 0:U.flip),c(((x=t.middleware)==null?void 0:x.arrow)??{element:T||null})]}).then(({x:F,y:j,placement:V,middlewareData:W})=>{if(Object.assign(v.style,{left:`${F}px`,top:`${j}px`}),T){const{x:$,y:B}=W.arrow,G={top:"bottom",right:"left",bottom:"top",left:"right"}[V.split("-")[0]];Object.assign(T.style,{left:$!=null?`${$}px`:"",top:B!=null?`${B}px`:"",right:"",bottom:"",[G]:"-4px"})}})}function E(){v&&(b=!0,setTimeout(()=>{b&&(h.open=!0,t.state&&t.state({state:h.open}),y(),v.style.display="block",v.style.opacity="1",v.style.pointerEvents="auto",v.removeAttribute("inert"),h.autoUpdateCleanup=e(o,v,y),m=Array.from(v==null?void 0:v.querySelectorAll(p)))},t.delay??0))}function P(O){if(!v||t.forceOpen)return;b=!1;const S=parseFloat(window.getComputedStyle(v).transitionDuration.replace("s",""))*1e3;setTimeout(()=>{h.open=!1,t.state&&t.state({state:h.open}),v.style.opacity="0",v.setAttribute("inert",""),h.autoUpdateCleanup&&h.autoUpdateCleanup(),O&&O()},S)}function w(){h.open===!1?E():P()}function C(O){if(h.open===!1||o.contains(O.target))return;if(v&&v.contains(O.target)===!1){P();return}const S=t.closeQuery===void 0?"a[href], button":t.closeQuery,k=v==null?void 0:v.querySelectorAll(S);k==null||k.forEach(A=>{A.contains(O.target)&&P()})}const I=O=>{if(h.open===!1)return;const S=O.key;if(S==="Escape"){O.preventDefault(),o.focus(),P();return}m=Array.from(v==null?void 0:v.querySelectorAll(p)),h.open&&document.activeElement===o&&(S==="ArrowDown"||S==="Tab")&&p.length>0&&m.length>0&&(O.preventDefault(),m[0].focus())};switch(t.event){case"click":o.addEventListener("click",w,!0),window.addEventListener("click",C,!0);break;case"hover":o.addEventListener("mouseover",()=>E(),!0),o.addEventListener("mouseleave",()=>P(),!0);break;case"focus-blur":o.addEventListener("focus",w,!0),o.addEventListener("blur",()=>P(),!0);break;case"focus-click":o.addEventListener("focus",E,!0),window.addEventListener("click",C,!0);break;default:throw new Error(`Event value of '${t.event}' is not supported. ${g}`)}return window.addEventListener("keydown",I,!0),y(),{update(O){P(()=>{t=O,y(),_()})},toggle:w,open:E,close:P,destroy(){o.removeEventListener("click",w,!0),o.removeEventListener("mouseover",E,!0),o.removeEventListener("mouseleave",()=>P(),!0),o.removeEventListener("focus",w,!0),o.removeEventListener("focus",E,!0),o.removeEventListener("blur",()=>P(),!0),window.removeEventListener("click",C,!0),window.removeEventListener("keydown",I,!0)}}}export{GAME_CONTROLLER_BUTTON_CONFIG as $,MavSeverity as A,isRovDriver as B,ConnectionStates as C,DECODE_TXT as D,ENCRYPTED_AUTH_TOKEN_PREFIX as E,LIVEKIT_FRONTEND_ROOM_CONNECTION_CONFIG as F,LIVEKIT_FRONTEND_ROOM_CONFIG as G,SIMPLEPEER_BASE_CONFIG as H,LIVEKIT_LIST_ONLY_TOKEN as I,ONSCREEN_GPAD_BUTTON_TOUCHED_CLASS as J,ONSCREEN_GPAD_BUTTON_PRESSED_CLASS as K,LogLevelConsole as L,MediaDeviceFailure as M,GPAD_STANDARD_BUTTON_INDEX as N,ONSCREEN_GPAD_BUTTON_LABELS as O,ParticipantEvent as P,throttleGain as Q,RoomEvent as R,SEA_LEVEL_PRESSURE as S,Track as T,URL_PARAMS as U,VideoSource as V,PING_INTERVAL as W,MOVE_MSG_TIMEOUT as X,rovDrivingVector as Y,GPAD_STANDARD_BUTTON_INDEX_TO_MAVLINK_INDEX as Z,popup as _,logWarn as a,openLogsTimelineModal as a0,toggleFullscreen as a1,logError as b,fullscreenOpen as c,debugPageModeActive as d,closeModal as e,focusTrap as f,getURLQueryStringVariable as g,openControlTutModal as h,setModalStore as i,currentVideoSource as j,sidebarExpanded as k,log$1 as l,mainLogr as m,nStore as n,openFlyModesTutModal as o,Room as p,DisconnectReason as q,ConnectionState as r,storePopup as s,tutorialModeActive as t,logInfo as u,getDefaultExportFromCjs$1 as v,logDebug as w,MavState as x,MavModeFlag as y,rov_actions_proto as z};
//# sourceMappingURL=popup.51566690.js.map
