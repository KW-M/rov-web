var JA=Object.defineProperty;var QA=(n,e,t)=>e in n?JA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Ne=(n,e,t)=>QA(n,typeof e!="symbol"?e+"":e,t);import{v as kn,x as Et,af as Qt,ae as Jm,Y as ZA,ag as E0,s as Ft,O as ii,e as K,c as q,b as F,f as S,i as x,j as D,P as si,Q as ri,R as ai,m as qn,o as $e,y as Wt,a as Te,g as Se,k as P,u as X,N as rl,a8 as hy,W as Qm,n as Tt,ah as $A,z as ae,t as be,d as ye,aa as zc,ab as Hc,D as dn,ai as fy,ac as Yr,w as Nt,H as Nn,ad as Vu,E as eC,S as zi,aj as tC,M as Ct,p as Ie,q as Pe,r as hn,C as pd,l as gt,h as En,a9 as py,V as my,K as _i,F as Da,I as A0,B as nC}from"./scheduler.Bguby_4Q.js";import{w as La,r as iC}from"./index.-Hakq5Eb.js";import{t as ce,b as fe,S as Bt,i as Vt,g as _n,e as vn,k as gy,p as sC,c as ct,a as pt,m as lt,d as ut,f as vi,o as C0}from"./index.LOXQR9dY.js";import{_ as _y}from"./preload-helper.C1FmrZbK.js";const rC=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function un(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function vy(n,e){n.d(1),e.delete(n.key)}function aC(n,e){fe(n,1,1,()=>{e.delete(n.key)})}function vV(n,e){n.f(),aC(n,e)}function by(n,e,t,i,s,r,a,o,l,c,u,d){let h=n.length,f=r.length,g=h;const v={};for(;g--;)v[n[g].key]=g;const m=[],_=new Map,y=new Map,b=[];for(g=f;g--;){const C=d(s,r,g),M=t(C);let I=a.get(M);I?b.push(()=>I.p(C,e)):(I=c(M,C),I.c()),_.set(M,m[g]=I),M in v&&y.set(M,Math.abs(g-v[M]))}const p=new Set,w=new Set;function E(C){ce(C,1),C.m(o,u),a.set(C.key,C),u=C.first,f--}for(;h&&f;){const C=m[f-1],M=n[h-1],I=C.key,T=M.key;C===M?(u=C.first,h--,f--):_.has(T)?!a.has(I)||p.has(I)?E(C):w.has(T)?h--:y.get(I)>y.get(T)?(w.add(I),E(C)):(p.add(T),h--):(l(M,a),h--)}for(;h--;){const C=n[h];_.has(C.key)||l(C,a)}for(;f;)E(m[f-1]);return kn(b),m}function Qn(n,e){const t={},i={},s={$$scope:1};let r=n.length;for(;r--;){const a=n[r],o=e[r];if(o){for(const l in a)l in o||(i[l]=1);for(const l in o)s[l]||(t[l]=o[l],s[l]=1);n[r]=o}else for(const l in a)s[l]=1}for(const a in i)a in t||(t[a]=void 0);return t}function bV(n){return typeof n=="object"&&n!==null?n:{}}const oC=La(void 0),yy="drawerStore";function cC(){const n=Et(yy);if(!n)throw new Error("drawerStore is not initialized. Please ensure that `initializeStores()` is invoked in the root layout file of this app!");return n}function yV(){const n=lC();return Qt(yy,n)}function lC(){const{subscribe:n,set:e,update:t}=La({});return{subscribe:n,set:e,update:t,open:i=>t(()=>({open:!0,...i})),close:()=>t(i=>(i.open=!1,i))}}const Ty="modalStore";function Sy(){const n=Et(Ty);if(!n)throw new Error("modalStore is not initialized. Please ensure that `initializeStores()` is invoked in the root layout file of this app!");return n}function TV(){const n=uC();return Qt(Ty,n)}function uC(){const{subscribe:n,set:e,update:t}=La([]);return{subscribe:n,set:e,update:t,trigger:i=>t(s=>(s.push(i),s)),close:()=>t(i=>(i.length>0&&i.shift(),i)),clear:()=>e([])}}const dC={message:"Missing Toast Message",autohide:!0,timeout:5e3},Ey="toastStore";function hC(){const n=Et(Ey);if(!n)throw new Error("toastStore is not initialized. Please ensure that `initializeStores()` is invoked in the root layout file of this app!");return n}function SV(){const n=pC();return Qt(Ey,n)}function fC(){const n=Math.random();return Number(n).toString(32)}function pC(){const{subscribe:n,set:e,update:t}=La([]),i=r=>t(a=>{if(a.length>0){const o=a.findIndex(c=>c.id===r),l=a[o];l&&(l.callback&&l.callback({id:r,status:"closed"}),l.timeoutId&&clearTimeout(l.timeoutId),a.splice(o,1))}return a});function s(r){if(r.autohide===!0)return setTimeout(()=>{i(r.id)},r.timeout)}return{subscribe:n,close:i,trigger:r=>{const a=fC();return t(o=>{r&&r.callback&&r.callback({id:a,status:"queued"}),r.hideDismiss&&(r.autohide=!0);const l={...dC,...r,id:a};return l.timeoutId=s(l),o.push(l),o}),a},freeze:r=>t(a=>(a.length>0&&clearTimeout(a[r].timeoutId),a)),unfreeze:r=>t(a=>(a.length>0&&(a[r].timeoutId=s(a[r])),a)),clear:()=>e([])}}const jd={};function w0(n){return n==="local"?localStorage:sessionStorage}function Zm(n,e,t){const i=JSON,s="local";function r(a,o){w0(s).setItem(a,i.stringify(o))}if(!jd[n]){const a=La(e,c=>{const u=w0(s).getItem(n);u&&c(i.parse(u));{const d=h=>{h.key===n&&c(h.newValue?i.parse(h.newValue):null)};return window.addEventListener("storage",d),()=>window.removeEventListener("storage",d)}}),{subscribe:o,set:l}=a;jd[n]={set(c){r(n,c),l(c)},update(c){const u=c(Jm(a));r(n,u),l(u)},subscribe:o}}return jd[n]}Zm("modeOsPrefers",!1);Zm("modeUserPrefers",void 0);Zm("modeCurrent",!1);const Ay="(prefers-reduced-motion: reduce)";function mC(){return window.matchMedia(Ay).matches}const gC=iC(mC(),n=>{{const e=i=>{n(i.matches)},t=window.matchMedia(Ay);return t.addEventListener("change",e),()=>{t.removeEventListener("change",e)}}});function EV(n){return n*n*n}function $m(n){const e=n-1;return e*e*e+1}function cp(n,{delay:e=0,duration:t=400,easing:i=ZA}={}){const s=+getComputedStyle(n).opacity;return{delay:e,duration:t,easing:i,css:r=>`opacity: ${r*s}`}}function AV(n,{delay:e=0,duration:t=400,easing:i=$m,x:s=0,y:r=0,opacity:a=0}={}){const o=getComputedStyle(n),l=+o.opacity,c=o.transform==="none"?"":o.transform,u=l*(1-a),[d,h]=E0(s),[f,g]=E0(r);return{delay:e,duration:t,easing:i,css:(v,m)=>`
			transform: ${c} translate(${(1-v)*d}${h}, ${(1-v)*f}${g});
			opacity: ${l-u*m}`}}function R0(n,{delay:e=0,duration:t=400,easing:i=$m,axis:s="y"}={}){const r=getComputedStyle(n),a=+r.opacity,o=s==="y"?"height":"width",l=parseFloat(r[o]),c=s==="y"?["top","bottom"]:["left","right"],u=c.map(_=>`${_[0].toUpperCase()}${_.slice(1)}`),d=parseFloat(r[`padding${u[0]}`]),h=parseFloat(r[`padding${u[1]}`]),f=parseFloat(r[`margin${u[0]}`]),g=parseFloat(r[`margin${u[1]}`]),v=parseFloat(r[`border${u[0]}Width`]),m=parseFloat(r[`border${u[1]}Width`]);return{delay:e,duration:t,easing:i,css:_=>`overflow: hidden;opacity: ${Math.min(_*20,1)*a};${o}: ${_*l}px;padding-${c[0]}: ${_*d}px;padding-${c[1]}: ${_*h}px;margin-${c[0]}: ${_*f}px;margin-${c[1]}: ${_*g}px;border-${c[0]}-width: ${_*v}px;border-${c[1]}-width: ${_*m}px;`}}function CV(n,{delay:e=0,duration:t=400,easing:i=$m,start:s=0,opacity:r=0}={}){const a=getComputedStyle(n),o=+a.opacity,l=a.transform==="none"?"":a.transform,c=1-s,u=o*(1-r);return{delay:e,duration:t,easing:i,css:(d,h)=>`
			transform: ${l} scale(${1-c*h});
			opacity: ${o-u*h}
		`}}function _C(n){let e,t,i;const s=n[19].default,r=ii(s,n,n[18],null);return{c(){e=K("div"),r&&r.c(),this.h()},l(a){e=q(a,"DIV",{class:!0,"data-testid":!0});var o=F(e);r&&r.l(o),o.forEach(S),this.h()},h(){x(e,"class",t="accordion "+n[0]),x(e,"data-testid","accordion")},m(a,o){D(a,e,o),r&&r.m(e,null),i=!0},p(a,[o]){r&&r.p&&(!i||o&262144)&&si(r,s,a,a[18],i?ai(s,a[18],o,null):ri(a[18]),null),(!i||o&1&&t!==(t="accordion "+a[0]))&&x(e,"class",t)},i(a){i||(ce(r,a),i=!0)},o(a){fe(r,a),i=!1},d(a){a&&S(e),r&&r.d(a)}}}function vC(n,e,t){let i,s;qn(n,gC,I=>t(20,s=I));let{$$slots:r={},$$scope:a}=e,{autocollapse:o=!1}=e,{width:l="w-full"}=e,{spacing:c="space-y-1"}=e,{disabled:u=!1}=e,{padding:d="py-2 px-4"}=e,{hover:h="hover:bg-primary-hover-token"}=e,{rounded:f="rounded-container-token"}=e,{caretOpen:g="rotate-180"}=e,{caretClosed:v=""}=e,{regionControl:m=""}=e,{regionPanel:_="space-y-4"}=e,{regionCaret:y=""}=e,{transitions:b=!s}=e,{transitionIn:p=R0}=e,{transitionInParams:w={duration:200}}=e,{transitionOut:E=R0}=e,{transitionOutParams:C={duration:200}}=e;const M=La(null);return Qt("active",M),Qt("autocollapse",o),Qt("disabled",u),Qt("padding",d),Qt("hover",h),Qt("rounded",f),Qt("caretOpen",g),Qt("caretClosed",v),Qt("regionControl",m),Qt("regionPanel",_),Qt("regionCaret",y),Qt("transitions",b),Qt("transitionIn",p),Qt("transitionInParams",w),Qt("transitionOut",E),Qt("transitionOutParams",C),n.$$set=I=>{t(22,e=$e($e({},e),Wt(I))),"autocollapse"in I&&t(1,o=I.autocollapse),"width"in I&&t(2,l=I.width),"spacing"in I&&t(3,c=I.spacing),"disabled"in I&&t(4,u=I.disabled),"padding"in I&&t(5,d=I.padding),"hover"in I&&t(6,h=I.hover),"rounded"in I&&t(7,f=I.rounded),"caretOpen"in I&&t(8,g=I.caretOpen),"caretClosed"in I&&t(9,v=I.caretClosed),"regionControl"in I&&t(10,m=I.regionControl),"regionPanel"in I&&t(11,_=I.regionPanel),"regionCaret"in I&&t(12,y=I.regionCaret),"transitions"in I&&t(13,b=I.transitions),"transitionIn"in I&&t(14,p=I.transitionIn),"transitionInParams"in I&&t(15,w=I.transitionInParams),"transitionOut"in I&&t(16,E=I.transitionOut),"transitionOutParams"in I&&t(17,C=I.transitionOutParams),"$$scope"in I&&t(18,a=I.$$scope)},n.$$.update=()=>{t(0,i=`${l} ${c} ${e.class??""}`)},e=Wt(e),[i,o,l,c,u,d,h,f,g,v,m,_,y,b,p,w,E,C,a,r]}class Cy extends Bt{constructor(e){super(),Vt(this,e,vC,_C,Ft,{autocollapse:1,width:2,spacing:3,disabled:4,padding:5,hover:6,rounded:7,caretOpen:8,caretClosed:9,regionControl:10,regionPanel:11,regionCaret:12,transitions:13,transitionIn:14,transitionInParams:15,transitionOut:16,transitionOutParams:17})}}function k0(n,e){const{transition:t,params:i,enabled:s}=e;return s?t(n,i):"duration"in i?t(n,{duration:0}):{duration:0}}const bC=n=>({}),M0=n=>({}),yC=n=>({}),x0=n=>({}),TC=n=>({}),I0=n=>({}),SC=n=>({}),P0=n=>({}),EC=n=>({}),N0=n=>({});function D0(n){let e,t;const i=n[30].lead,s=ii(i,n,n[29],N0);return{c(){e=K("div"),s&&s.c(),this.h()},l(r){e=q(r,"DIV",{class:!0});var a=F(e);s&&s.l(a),a.forEach(S),this.h()},h(){x(e,"class","accordion-lead")},m(r,a){D(r,e,a),s&&s.m(e,null),t=!0},p(r,a){s&&s.p&&(!t||a[0]&536870912)&&si(s,i,r,r[29],t?ai(i,r[29],a,EC):ri(r[29]),N0)},i(r){t||(ce(s,r),t=!0)},o(r){fe(s,r),t=!1},d(r){r&&S(e),s&&s.d(r)}}}function AC(n){let e;return{c(){e=be("(summary)")},l(t){e=ye(t,"(summary)")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function CC(n){let e,t,i;return{c(){e=K("div"),t=new zc(!1),this.h()},l(s){e=q(s,"DIV",{class:!0});var r=F(e);t=Hc(r,!1),r.forEach(S),this.h()},h(){t.a=null,x(e,"class",i="accordion-summary-caret "+n[11])},m(s,r){D(s,e,r),t.m(n[14],e)},p(s,r){r[0]&2048&&i!==(i="accordion-summary-caret "+s[11])&&x(e,"class",i)},i:Tt,o:Tt,d(s){s&&S(e)}}}function wC(n){let e,t,i,s,r;const a=[kC,RC],o=[];function l(c,u){return c[8]?0:1}return t=l(n),i=o[t]=a[t](n),{c(){e=K("div"),i.c(),this.h()},l(c){e=q(c,"DIV",{class:!0});var u=F(e);i.l(u),u.forEach(S),this.h()},h(){x(e,"class",s="accordion-summary-icons "+n[10])},m(c,u){D(c,e,u),o[t].m(e,null),r=!0},p(c,u){let d=t;t=l(c),t===d?o[t].p(c,u):(_n(),fe(o[d],1,1,()=>{o[d]=null}),vn(),i=o[t],i?i.p(c,u):(i=o[t]=a[t](c),i.c()),ce(i,1),i.m(e,null)),(!r||u[0]&1024&&s!==(s="accordion-summary-icons "+c[10]))&&x(e,"class",s)},i(c){r||(ce(i),r=!0)},o(c){fe(i),r=!1},d(c){c&&S(e),o[t].d()}}}function RC(n){let e;const t=n[30].iconOpen,i=ii(t,n,n[29],x0),s=i||MC(n);return{c(){s&&s.c()},l(r){s&&s.l(r)},m(r,a){s&&s.m(r,a),e=!0},p(r,a){i&&i.p&&(!e||a[0]&536870912)&&si(i,t,r,r[29],e?ai(t,r[29],a,yC):ri(r[29]),x0)},i(r){e||(ce(s,r),e=!0)},o(r){fe(s,r),e=!1},d(r){s&&s.d(r)}}}function kC(n){let e;const t=n[30].iconClosed,i=ii(t,n,n[29],I0),s=i||xC(n);return{c(){s&&s.c()},l(r){s&&s.l(r)},m(r,a){s&&s.m(r,a),e=!0},p(r,a){i&&i.p&&(!e||a[0]&536870912)&&si(i,t,r,r[29],e?ai(t,r[29],a,TC):ri(r[29]),I0)},i(r){e||(ce(s,r),e=!0)},o(r){fe(s,r),e=!1},d(r){s&&s.d(r)}}}function MC(n){let e,t;return{c(){e=new zc(!1),t=dn(),this.h()},l(i){e=Hc(i,!1),t=dn(),this.h()},h(){e.a=t},m(i,s){e.m(n[14],i,s),D(i,t,s)},p:Tt,d(i){i&&(S(t),e.d())}}}function xC(n){let e,t;return{c(){e=new zc(!1),t=dn(),this.h()},l(i){e=Hc(i,!1),t=dn(),this.h()},h(){e.a=t},m(i,s){e.m(n[14],i,s),D(i,t,s)},p:Tt,d(i){i&&(S(t),e.d())}}}function L0(n){let e,t,i,s,r,a,o;const l=n[30].content,c=ii(l,n,n[29],M0),u=c||IC();return{c(){e=K("div"),u&&u.c(),this.h()},l(d){e=q(d,"DIV",{class:!0,id:!0,role:!0,"aria-hidden":!0,"aria-labelledby":!0});var h=F(e);u&&u.l(h),h.forEach(S),this.h()},h(){x(e,"class",t="accordion-panel "+n[9]),x(e,"id",i="accordion-panel-"+n[0]),x(e,"role","region"),x(e,"aria-hidden",s=!n[8]),x(e,"aria-labelledby",n[0])},m(d,h){D(d,e,h),u&&u.m(e,null),o=!0},p(d,h){n=d,c&&c.p&&(!o||h[0]&536870912)&&si(c,l,n,n[29],o?ai(l,n[29],h,bC):ri(n[29]),M0),(!o||h[0]&512&&t!==(t="accordion-panel "+n[9]))&&x(e,"class",t),(!o||h[0]&1&&i!==(i="accordion-panel-"+n[0]))&&x(e,"id",i),(!o||h[0]&256&&s!==(s=!n[8]))&&x(e,"aria-hidden",s),(!o||h[0]&1)&&x(e,"aria-labelledby",n[0])},i(d){o||(ce(u,d),d&&Qm(()=>{o&&(a&&a.end(1),r=gy(e,k0,{transition:n[4],params:n[5],enabled:n[3]}),r.start())}),o=!0)},o(d){fe(u,d),r&&r.invalidate(),d&&(a=sC(e,k0,{transition:n[6],params:n[7],enabled:n[3]})),o=!1},d(d){d&&S(e),u&&u.d(d),d&&a&&a.end()}}}function IC(n){let e;return{c(){e=be("(content)")},l(t){e=ye(t,"(content)")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function PC(n){let e,t,i,s,r,a,o,l,c,u,d,h,f,g,v=n[16].lead&&D0(n);const m=n[30].summary,_=ii(m,n,n[29],P0),y=_||AC(),b=[wC,CC],p=[];function w(C,M){return C[16].iconClosed||C[16].iconOpen?0:1}a=w(n),o=p[a]=b[a](n);let E=n[8]&&L0(n);return{c(){e=K("div"),t=K("button"),v&&v.c(),i=Te(),s=K("div"),y&&y.c(),r=Te(),o.c(),u=Te(),E&&E.c(),this.h()},l(C){e=q(C,"DIV",{class:!0,"data-testid":!0});var M=F(e);t=q(M,"BUTTON",{type:!0,class:!0,id:!0,"aria-expanded":!0,"aria-controls":!0});var I=F(t);v&&v.l(I),i=Se(I),s=q(I,"DIV",{class:!0});var T=F(s);y&&y.l(T),T.forEach(S),r=Se(I),o.l(I),I.forEach(S),u=Se(M),E&&E.l(M),M.forEach(S),this.h()},h(){x(s,"class","accordion-summary flex-1"),x(t,"type","button"),x(t,"class",l="accordion-control "+n[12]),x(t,"id",n[0]),x(t,"aria-expanded",n[8]),x(t,"aria-controls",c="accordion-panel-"+n[0]),t.disabled=n[2],x(e,"class",d="accordion-item "+n[13]),x(e,"data-testid","accordion-item")},m(C,M){D(C,e,M),P(e,t),v&&v.m(t,null),P(t,i),P(t,s),y&&y.m(s,null),P(t,r),p[a].m(t,null),P(e,u),E&&E.m(e,null),h=!0,f||(g=[X(t,"click",n[15]),X(t,"click",n[31]),X(t,"keydown",n[32]),X(t,"keyup",n[33]),X(t,"keypress",n[34])],f=!0)},p(C,M){C[16].lead?v?(v.p(C,M),M[0]&65536&&ce(v,1)):(v=D0(C),v.c(),ce(v,1),v.m(t,i)):v&&(_n(),fe(v,1,1,()=>{v=null}),vn()),_&&_.p&&(!h||M[0]&536870912)&&si(_,m,C,C[29],h?ai(m,C[29],M,SC):ri(C[29]),P0);let I=a;a=w(C),a===I?p[a].p(C,M):(_n(),fe(p[I],1,1,()=>{p[I]=null}),vn(),o=p[a],o?o.p(C,M):(o=p[a]=b[a](C),o.c()),ce(o,1),o.m(t,null)),(!h||M[0]&4096&&l!==(l="accordion-control "+C[12]))&&x(t,"class",l),(!h||M[0]&1)&&x(t,"id",C[0]),(!h||M[0]&256)&&x(t,"aria-expanded",C[8]),(!h||M[0]&1&&c!==(c="accordion-panel-"+C[0]))&&x(t,"aria-controls",c),(!h||M[0]&4)&&(t.disabled=C[2]),C[8]?E?(E.p(C,M),M[0]&256&&ce(E,1)):(E=L0(C),E.c(),ce(E,1),E.m(e,null)):E&&(_n(),fe(E,1,1,()=>{E=null}),vn()),(!h||M[0]&8192&&d!==(d="accordion-item "+C[13]))&&x(e,"class",d)},i(C){h||(ce(v),ce(y,C),ce(o),ce(E),h=!0)},o(C){fe(v),fe(y,C),fe(o),fe(E),h=!1},d(C){C&&S(e),v&&v.d(),y&&y.d(C),p[a].d(),E&&E.d(),f=!1,kn(g)}}}const NC="",DC="text-start w-full flex items-center space-x-4",O0="fill-current w-3 transition-transform duration-[200ms]",LC="";function OC(n,e,t){let i,s,r,a,o,l,c,u,d=Tt,h=()=>(d(),d=$A(p,U=>t(28,u=U)),p);n.$$.on_destroy.push(()=>d());let{$$slots:f={},$$scope:g}=e;const v=rl(f),m=hy();let{open:_=!1}=e,{id:y=String(Math.random())}=e,{autocollapse:b=Et("autocollapse")}=e,{active:p=Et("active")}=e;h();let{disabled:w=Et("disabled")}=e,{padding:E=Et("padding")}=e,{hover:C=Et("hover")}=e,{rounded:M=Et("rounded")}=e,{caretOpen:I=Et("caretOpen")}=e,{caretClosed:T=Et("caretClosed")}=e,{regionControl:R=Et("regionControl")}=e,{regionPanel:V=Et("regionPanel")}=e,{regionCaret:H=Et("regionCaret")}=e,{transitions:B=Et("transitions")}=e,{transitionIn:te=Et("transitionIn")}=e,{transitionInParams:j=Et("transitionInParams")}=e,{transitionOut:oe=Et("transitionOut")}=e,{transitionOutParams:z=Et("transitionOutParams")}=e;const W=`
		<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
			<path d="M201.4 374.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 306.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z" />
		</svg>`;function ie(U){b===!0?p.set(y):t(17,_=!_),se(U)}function se(U){const de=b?u===y:_;m("toggle",{event:U,id:y,panelId:`accordion-panel-${y}`,open:de,autocollapse:b})}b&&_&&ie();function je(U){ae.call(this,n,U)}function ge(U){ae.call(this,n,U)}function L(U){ae.call(this,n,U)}function J(U){ae.call(this,n,U)}return n.$$set=U=>{t(37,e=$e($e({},e),Wt(U))),"open"in U&&t(17,_=U.open),"id"in U&&t(0,y=U.id),"autocollapse"in U&&t(18,b=U.autocollapse),"active"in U&&h(t(1,p=U.active)),"disabled"in U&&t(2,w=U.disabled),"padding"in U&&t(19,E=U.padding),"hover"in U&&t(20,C=U.hover),"rounded"in U&&t(21,M=U.rounded),"caretOpen"in U&&t(22,I=U.caretOpen),"caretClosed"in U&&t(23,T=U.caretClosed),"regionControl"in U&&t(24,R=U.regionControl),"regionPanel"in U&&t(25,V=U.regionPanel),"regionCaret"in U&&t(26,H=U.regionCaret),"transitions"in U&&t(3,B=U.transitions),"transitionIn"in U&&t(4,te=U.transitionIn),"transitionInParams"in U&&t(5,j=U.transitionInParams),"transitionOut"in U&&t(6,oe=U.transitionOut),"transitionOutParams"in U&&t(7,z=U.transitionOutParams),"$$scope"in U&&t(29,g=U.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&393216&&_&&b&&ie(),n.$$.dirty[0]&268828673&&t(8,i=b?u===y:_),t(13,s=`${NC} ${e.class??""}`),n.$$.dirty[0]&20447232&&t(12,r=`${DC} ${E} ${C} ${M} ${R}`),n.$$.dirty[0]&12583168&&t(27,a=i?I:T),n.$$.dirty[0]&201326592&&t(11,o=`${O0} ${H} ${a}`),n.$$.dirty[0]&67108864&&t(10,l=`${O0} ${H}`),n.$$.dirty[0]&36175872&&t(9,c=`${LC} ${E} ${M} ${V}`)},e=Wt(e),[y,p,w,B,te,j,oe,z,i,c,l,o,r,s,W,ie,v,_,b,E,C,M,I,T,R,V,H,a,u,g,f,je,ge,L,J]}class UC extends Bt{constructor(e){super(),Vt(this,e,OC,PC,Ft,{open:17,id:0,autocollapse:18,active:1,disabled:2,padding:19,hover:20,rounded:21,caretOpen:22,caretClosed:23,regionControl:24,regionPanel:25,regionCaret:26,transitions:3,transitionIn:4,transitionInParams:5,transitionOut:6,transitionOutParams:7},null,[-1,-1])}}function FC(n){let e,t,i;const s=n[15].default,r=ii(s,n,n[14],null);return{c(){e=K("div"),r&&r.c(),this.h()},l(a){e=q(a,"DIV",{class:!0,"data-testid":!0,role:!0,"aria-labelledby":!0});var o=F(e);r&&r.l(o),o.forEach(S),this.h()},h(){x(e,"class",t="radio-group "+n[1]),x(e,"data-testid","radio-group"),x(e,"role","radiogroup"),x(e,"aria-labelledby",n[0])},m(a,o){D(a,e,o),r&&r.m(e,null),i=!0},p(a,[o]){r&&r.p&&(!i||o&16384)&&si(r,s,a,a[14],i?ai(s,a[14],o,null):ri(a[14]),null),(!i||o&2&&t!==(t="radio-group "+a[1]))&&x(e,"class",t),(!i||o&1)&&x(e,"aria-labelledby",a[0])},i(a){i||(ce(r,a),i=!0)},o(a){fe(r,a),i=!1},d(a){a&&S(e),r&&r.d(a)}}}const BC="p-1";function VC(n,e,t){let i,{$$slots:s={},$$scope:r}=e,{display:a="inline-flex"}=e,{flexDirection:o="flex-row"}=e,{gap:l="gap-1"}=e,{background:c="bg-surface-200-700-token"}=e,{border:u="border-token border-surface-400-500-token"}=e,{rounded:d="rounded-token"}=e,{padding:h="px-4 py-1"}=e,{active:f="variant-filled"}=e,{hover:g="hover:variant-soft"}=e,{color:v=""}=e,{fill:m=""}=e,{regionLabel:_=""}=e,{labelledby:y=""}=e;return Qt("rounded",d),Qt("padding",h),Qt("active",f),Qt("hover",g),Qt("color",v),Qt("fill",m),Qt("regionLabel",_),n.$$set=b=>{t(16,e=$e($e({},e),Wt(b))),"display"in b&&t(2,a=b.display),"flexDirection"in b&&t(3,o=b.flexDirection),"gap"in b&&t(4,l=b.gap),"background"in b&&t(5,c=b.background),"border"in b&&t(6,u=b.border),"rounded"in b&&t(7,d=b.rounded),"padding"in b&&t(8,h=b.padding),"active"in b&&t(9,f=b.active),"hover"in b&&t(10,g=b.hover),"color"in b&&t(11,v=b.color),"fill"in b&&t(12,m=b.fill),"regionLabel"in b&&t(13,_=b.regionLabel),"labelledby"in b&&t(0,y=b.labelledby),"$$scope"in b&&t(14,r=b.$$scope)},n.$$.update=()=>{t(1,i=`${BC} ${a} ${o} ${l} ${c} ${u} ${d} ${e.class??""}`)},e=Wt(e),[y,i,a,o,l,c,u,d,h,f,g,v,m,_,r,s]}class lp extends Bt{constructor(e){super(),Vt(this,e,VC,FC,Ft,{display:2,flexDirection:3,gap:4,background:5,border:6,rounded:7,padding:8,active:9,hover:10,color:11,fill:12,regionLabel:13,labelledby:0})}}function GC(n){let e,t,i,s,r,a,o,l,c,u,d,h=[{type:"radio"},{name:n[1]},{__value:n[2]},n[11](),{tabindex:"-1"}],f={};for(let m=0;m<h.length;m+=1)f=$e(f,h[m]);const g=n[21].default,v=ii(g,n,n[20],null);return c=fy(n[29][0]),{c(){e=K("label"),t=K("div"),i=K("div"),s=K("input"),r=Te(),v&&v.c(),this.h()},l(m){e=q(m,"LABEL",{class:!0});var _=F(e);t=q(_,"DIV",{class:!0,"data-testid":!0,role:!0,"aria-checked":!0,"aria-label":!0,tabindex:!0,title:!0});var y=F(t);i=q(y,"DIV",{class:!0});var b=F(i);s=q(b,"INPUT",{type:!0,name:!0,tabindex:!0}),b.forEach(S),r=Se(y),v&&v.l(y),y.forEach(S),_.forEach(S),this.h()},h(){Yr(s,f),x(i,"class","h-0 w-0 overflow-hidden"),x(t,"class",a="radio-item "+n[8]),x(t,"data-testid","radio-item"),x(t,"role","radio"),x(t,"aria-checked",n[6]),x(t,"aria-label",n[4]),x(t,"tabindex","0"),x(t,"title",n[3]),x(e,"class",o="radio-label "+n[9]+" "+n[5]),c.p(s)},m(m,_){D(m,e,_),P(e,t),P(t,i),P(i,s),s.autofocus&&s.focus(),n[27](s),s.checked=s.__value===n[0],P(t,r),v&&v.m(t,null),l=!0,u||(d=[X(s,"change",n[28]),X(s,"click",n[25]),X(s,"change",n[26]),X(t,"keydown",n[10]),X(t,"keydown",n[22]),X(t,"keyup",n[23]),X(t,"keypress",n[24])],u=!0)},p(m,_){Yr(s,f=Qn(h,[{type:"radio"},(!l||_[0]&2)&&{name:m[1]},(!l||_[0]&4)&&{__value:m[2]},m[11](),{tabindex:"-1"}])),_[0]&1&&(s.checked=s.__value===m[0]),v&&v.p&&(!l||_[0]&1048576)&&si(v,g,m,m[20],l?ai(g,m[20],_,null):ri(m[20]),null),(!l||_[0]&256&&a!==(a="radio-item "+m[8]))&&x(t,"class",a),(!l||_[0]&64)&&x(t,"aria-checked",m[6]),(!l||_[0]&16)&&x(t,"aria-label",m[4]),(!l||_[0]&8)&&x(t,"title",m[3]),(!l||_[0]&544&&o!==(o="radio-label "+m[9]+" "+m[5]))&&x(e,"class",o)},i(m){l||(ce(v,m),l=!0)},o(m){fe(v,m),l=!1},d(m){m&&S(e),n[27](null),v&&v.d(m),c.r(),u=!1,kn(d)}}}const zC="flex-auto",HC="text-base text-center cursor-pointer",WC="opacity-50 cursor-not-allowed";function jC(n,e,t){let i,s,r,a,o;const l=["group","name","value","title","label","rounded","padding","active","hover","color","fill","regionLabel"];let c=Nt(e,l),{$$slots:u={},$$scope:d}=e,{group:h}=e,{name:f}=e,{value:g}=e,{title:v=""}=e,{label:m=""}=e,{rounded:_=Et("rounded")}=e,{padding:y=Et("padding")}=e,{active:b=Et("active")}=e,{hover:p=Et("hover")}=e,{color:w=Et("color")}=e,{fill:E=Et("fill")}=e,{regionLabel:C=Et("regionLabel")}=e,M;function I(W){["Enter","Space"].includes(W.code)&&(W.preventDefault(),M.click())}function T(){return delete c.class,c}const R=[[]];function V(W){ae.call(this,n,W)}function H(W){ae.call(this,n,W)}function B(W){ae.call(this,n,W)}function te(W){ae.call(this,n,W)}function j(W){ae.call(this,n,W)}function oe(W){Nn[W?"unshift":"push"](()=>{M=W,t(7,M)})}function z(){h=this.__value,t(0,h)}return n.$$set=W=>{t(31,e=$e($e({},e),Wt(W))),t(30,c=Nt(e,l)),"group"in W&&t(0,h=W.group),"name"in W&&t(1,f=W.name),"value"in W&&t(2,g=W.value),"title"in W&&t(3,v=W.title),"label"in W&&t(4,m=W.label),"rounded"in W&&t(12,_=W.rounded),"padding"in W&&t(13,y=W.padding),"active"in W&&t(14,b=W.active),"hover"in W&&t(15,p=W.hover),"color"in W&&t(16,w=W.color),"fill"in W&&t(17,E=W.fill),"regionLabel"in W&&t(5,C=W.regionLabel),"$$scope"in W&&t(20,d=W.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&5&&t(6,i=g===h),n.$$.dirty[0]&245824&&t(19,s=i?`${b} ${w} ${E}`:p),t(18,r=e.disabled?WC:""),t(8,o=`${HC} ${y} ${_} ${s} ${r} ${e.class??""}`)},t(9,a=`${zC}`),e=Wt(e),[h,f,g,v,m,C,i,M,o,a,I,T,_,y,b,p,w,E,r,s,d,u,V,H,B,te,j,oe,z,R]}class eg extends Bt{constructor(e){super(),Vt(this,e,jC,GC,Ft,{group:0,name:1,value:2,title:3,label:4,rounded:12,padding:13,active:14,hover:15,color:16,fill:17,regionLabel:5},null,[-1,-1])}}const KC=n=>({}),U0=n=>({});function F0(n,e,t){const i=n.slice();return i[23]=e[t],i}function B0(n){let e,t;const i=n[15].default,s=ii(i,n,n[14],null);return{c(){e=K("label"),s&&s.c(),this.h()},l(r){e=q(r,"LABEL",{class:!0,for:!0});var a=F(e);s&&s.l(a),a.forEach(S),this.h()},h(){x(e,"class","range-slider-label "+YC),x(e,"for",n[2])},m(r,a){D(r,e,a),s&&s.m(e,null),t=!0},p(r,a){s&&s.p&&(!t||a&16384)&&si(s,i,r,r[14],t?ai(i,r[14],a,null):ri(r[14]),null),(!t||a&4)&&x(e,"for",r[2])},i(r){t||(ce(s,r),t=!0)},o(r){fe(s,r),t=!1},d(r){r&&S(e),s&&s.d(r)}}}function V0(n){let e,t,i=un(n[8]),s=[];for(let r=0;r<i.length;r+=1)s[r]=G0(F0(n,i,r));return{c(){e=K("datalist");for(let r=0;r<s.length;r+=1)s[r].c();this.h()},l(r){e=q(r,"DATALIST",{id:!0,class:!0});var a=F(e);for(let o=0;o<s.length;o+=1)s[o].l(a);a.forEach(S),this.h()},h(){x(e,"id",t="tickmarks-"+n[2]),x(e,"class","range-slider-ticks")},m(r,a){D(r,e,a);for(let o=0;o<s.length;o+=1)s[o]&&s[o].m(e,null)},p(r,a){if(a&256){i=un(r[8]);let o;for(o=0;o<i.length;o+=1){const l=F0(r,i,o);s[o]?s[o].p(l,a):(s[o]=G0(l),s[o].c(),s[o].m(e,null))}for(;o<s.length;o+=1)s[o].d(1);s.length=i.length}a&4&&t!==(t="tickmarks-"+r[2])&&x(e,"id",t)},d(r){r&&S(e),zi(s,r)}}}function G0(n){let e,t,i;return{c(){e=K("option"),this.h()},l(s){e=q(s,"OPTION",{label:!0}),F(e).forEach(S),this.h()},h(){e.__value=t=n[23],Vu(e,e.__value),x(e,"label",i=n[23])},m(s,r){D(s,e,r)},p(s,r){r&256&&t!==(t=s[23])&&(e.__value=t,Vu(e,e.__value)),r&256&&i!==(i=s[23])&&x(e,"label",i)},d(s){s&&S(e)}}}function z0(n){let e,t;const i=n[15].trail,s=ii(i,n,n[14],U0);return{c(){e=K("div"),s&&s.c(),this.h()},l(r){e=q(r,"DIV",{class:!0});var a=F(e);s&&s.l(a),a.forEach(S),this.h()},h(){x(e,"class","range-slider-trail")},m(r,a){D(r,e,a),s&&s.m(e,null),t=!0},p(r,a){s&&s.p&&(!t||a&16384)&&si(s,i,r,r[14],t?ai(i,r[14],a,KC):ri(r[14]),U0)},i(r){t||(ce(s,r),t=!0)},o(r){fe(s,r),t=!1},d(r){r&&S(e),s&&s.d(r)}}}function qC(n){let e,t,i,s,r,a,o,l,c,u,d,h,f=n[12].default&&B0(n),g=[{type:"range"},{id:n[2]},{name:n[1]},{class:r="range-slider-input "+n[9]},{list:a="tickmarks-"+n[2]},{"aria-label":n[7]},{min:n[3]},{max:n[4]},{step:n[5]},n[11]()],v={};for(let y=0;y<g.length;y+=1)v=$e(v,g[y]);let m=n[6]&&n[8]&&n[8].length&&V0(n),_=n[12].trail&&z0(n);return{c(){e=K("div"),f&&f.c(),t=Te(),i=K("div"),s=K("input"),o=Te(),m&&m.c(),l=Te(),_&&_.c(),this.h()},l(y){e=q(y,"DIV",{class:!0,"data-testid":!0});var b=F(e);f&&f.l(b),t=Se(b),i=q(b,"DIV",{class:!0});var p=F(i);s=q(p,"INPUT",{type:!0,id:!0,name:!0,class:!0,list:!0,"aria-label":!0,min:!0,max:!0,step:!0}),o=Se(p),m&&m.l(p),p.forEach(S),l=Se(b),_&&_.l(b),b.forEach(S),this.h()},h(){Yr(s,v),x(i,"class","range-content "+JC),x(e,"class",c="range-slider "+n[10]),x(e,"data-testid","range-slider")},m(y,b){D(y,e,b),f&&f.m(e,null),P(e,t),P(e,i),P(i,s),s.autofocus&&s.focus(),Vu(s,n[0]),P(i,o),m&&m.m(i,null),P(e,l),_&&_.m(e,null),u=!0,d||(h=[X(s,"change",n[19]),X(s,"input",n[19]),X(s,"click",n[16]),X(s,"change",n[17]),X(s,"blur",n[18])],d=!0)},p(y,[b]){y[12].default?f?(f.p(y,b),b&4096&&ce(f,1)):(f=B0(y),f.c(),ce(f,1),f.m(e,t)):f&&(_n(),fe(f,1,1,()=>{f=null}),vn()),Yr(s,v=Qn(g,[{type:"range"},(!u||b&4)&&{id:y[2]},(!u||b&2)&&{name:y[1]},(!u||b&512&&r!==(r="range-slider-input "+y[9]))&&{class:r},(!u||b&4&&a!==(a="tickmarks-"+y[2]))&&{list:a},(!u||b&128)&&{"aria-label":y[7]},(!u||b&8)&&{min:y[3]},(!u||b&16)&&{max:y[4]},(!u||b&32)&&{step:y[5]},y[11]()])),b&1&&Vu(s,y[0]),y[6]&&y[8]&&y[8].length?m?m.p(y,b):(m=V0(y),m.c(),m.m(i,null)):m&&(m.d(1),m=null),y[12].trail?_?(_.p(y,b),b&4096&&ce(_,1)):(_=z0(y),_.c(),ce(_,1),_.m(e,null)):_&&(_n(),fe(_,1,1,()=>{_=null}),vn()),(!u||b&1024&&c!==(c="range-slider "+y[10]))&&x(e,"class",c)},i(y){u||(ce(f),ce(_),u=!0)},o(y){fe(f),fe(_),u=!1},d(y){y&&S(e),f&&f.d(),m&&m.d(),_&&_.d(),d=!1,kn(h)}}}const XC="space-y-2",YC="",JC="flex justify-center py-2",QC="w-full h-2";function ZC(n,e,t){let i,s;const r=["name","id","value","min","max","step","ticked","accent","label"];let a=Nt(e,r),{$$slots:o={},$$scope:l}=e;const c=rl(o);let{name:u}=e,{id:d=String(Math.random())}=e,{value:h=0}=e,{min:f=0}=e,{max:g=100}=e,{step:v=1}=e,{ticked:m=!1}=e,{accent:_="accent-surface-900 dark:accent-surface-50"}=e,{label:y=""}=e,b;function p(){m!=!1&&t(8,b=Array.from({length:g-f+1},(T,R)=>R+f))}m&&p(),eC(()=>{p()});function w(){return delete a.class,a}function E(T){ae.call(this,n,T)}function C(T){ae.call(this,n,T)}function M(T){ae.call(this,n,T)}function I(){h=tC(this.value),t(0,h)}return n.$$set=T=>{t(22,e=$e($e({},e),Wt(T))),t(21,a=Nt(e,r)),"name"in T&&t(1,u=T.name),"id"in T&&t(2,d=T.id),"value"in T&&t(0,h=T.value),"min"in T&&t(3,f=T.min),"max"in T&&t(4,g=T.max),"step"in T&&t(5,v=T.step),"ticked"in T&&t(6,m=T.ticked),"accent"in T&&t(13,_=T.accent),"label"in T&&t(7,y=T.label),"$$scope"in T&&t(14,l=T.$$scope)},n.$$.update=()=>{t(10,i=`${XC} ${e.class??""}`),n.$$.dirty&8192&&t(9,s=`${QC} ${_}`)},e=Wt(e),[h,u,d,f,g,v,m,y,b,s,i,w,c,_,l,o,E,C,M,I]}class tg extends Bt{constructor(e){super(),Vt(this,e,ZC,qC,Ft,{name:1,id:2,value:0,min:3,max:4,step:5,ticked:6,accent:13,label:7})}}function H0(n){let e,t;const i=n[22].default,s=ii(i,n,n[21],null);return{c(){e=K("div"),s&&s.c(),this.h()},l(r){e=q(r,"DIV",{class:!0});var a=F(e);s&&s.l(a),a.forEach(S),this.h()},h(){x(e,"class","slide-toggle-text ml-3")},m(r,a){D(r,e,a),s&&s.m(e,null),t=!0},p(r,a){s&&s.p&&(!t||a[0]&2097152)&&si(s,i,r,r[21],t?ai(i,r[21],a,null):ri(r[21]),null)},i(r){t||(ce(s,r),t=!0)},o(r){fe(s,r),t=!1},d(r){r&&S(e),s&&s.d(r)}}}function $C(n){let e,t,i,s,r,a,o,l,c,u,d,h,f,g,v,m=[{type:"checkbox"},{class:"slide-toggle-input hidden"},{name:n[1]},n[8](),{disabled:s=n[9].disabled}],_={};for(let b=0;b<m.length;b+=1)_=$e(_,m[b]);let y=n[10].default&&H0(n);return{c(){e=K("div"),t=K("label"),i=K("input"),r=Te(),a=K("div"),o=K("div"),u=Te(),y&&y.c(),this.h()},l(b){e=q(b,"DIV",{id:!0,class:!0,"data-testid":!0,role:!0,"aria-label":!0,"aria-checked":!0,tabindex:!0});var p=F(e);t=q(p,"LABEL",{class:!0});var w=F(t);i=q(w,"INPUT",{type:!0,class:!0,name:!0}),r=Se(w),a=q(w,"DIV",{class:!0});var E=F(a);o=q(E,"DIV",{class:!0}),F(o).forEach(S),E.forEach(S),u=Se(w),y&&y.l(w),w.forEach(S),p.forEach(S),this.h()},h(){Yr(i,_),x(o,"class",l="slide-toggle-thumb "+n[3]),Ct(o,"cursor-not-allowed",n[9].disabled),x(a,"class",c="slide-toggle-track "+n[4]),Ct(a,"cursor-not-allowed",n[9].disabled),x(t,"class",d="slide-toggle-label "+n[5]),x(e,"id",n[2]),x(e,"class",h="slide-toggle "+n[6]),x(e,"data-testid","slide-toggle"),x(e,"role","switch"),x(e,"aria-label",n[2]),x(e,"aria-checked",n[0]),x(e,"tabindex","0")},m(b,p){D(b,e,p),P(e,t),P(t,i),i.autofocus&&i.focus(),i.checked=n[0],P(t,r),P(t,a),P(a,o),P(t,u),y&&y.m(t,null),f=!0,g||(v=[X(i,"change",n[31]),X(i,"click",n[23]),X(i,"keydown",n[24]),X(i,"keyup",n[25]),X(i,"keypress",n[26]),X(i,"mouseover",n[27]),X(i,"change",n[28]),X(i,"focus",n[29]),X(i,"blur",n[30]),X(e,"keydown",n[7])],g=!0)},p(b,p){Yr(i,_=Qn(m,[{type:"checkbox"},{class:"slide-toggle-input hidden"},(!f||p[0]&2)&&{name:b[1]},b[8](),(!f||p[0]&512&&s!==(s=b[9].disabled))&&{disabled:s}])),p[0]&1&&(i.checked=b[0]),(!f||p[0]&8&&l!==(l="slide-toggle-thumb "+b[3]))&&x(o,"class",l),(!f||p[0]&520)&&Ct(o,"cursor-not-allowed",b[9].disabled),(!f||p[0]&16&&c!==(c="slide-toggle-track "+b[4]))&&x(a,"class",c),(!f||p[0]&528)&&Ct(a,"cursor-not-allowed",b[9].disabled),b[10].default?y?(y.p(b,p),p[0]&1024&&ce(y,1)):(y=H0(b),y.c(),ce(y,1),y.m(t,null)):y&&(_n(),fe(y,1,1,()=>{y=null}),vn()),(!f||p[0]&32&&d!==(d="slide-toggle-label "+b[5]))&&x(t,"class",d),(!f||p[0]&4)&&x(e,"id",b[2]),(!f||p[0]&64&&h!==(h="slide-toggle "+b[6]))&&x(e,"class",h),(!f||p[0]&4)&&x(e,"aria-label",b[2]),(!f||p[0]&1)&&x(e,"aria-checked",b[0])},i(b){f||(ce(y),f=!0)},o(b){fe(y),f=!1},d(b){b&&S(e),y&&y.d(),g=!1,kn(v)}}}const ew="inline-block",tw="unstyled flex items-center",nw="flex transition-all duration-[200ms] cursor-pointer",iw="w-[50%] h-full scale-[0.8] transition-all duration-[200ms] shadow";function sw(n,e,t){let i,s,r,a,o,l,c,u;const d=["name","checked","size","background","active","border","rounded","label"];let h=Nt(e,d),{$$slots:f={},$$scope:g}=e;const v=rl(f),m=hy();let{name:_}=e,{checked:y=!1}=e,{size:b="md"}=e,{background:p="bg-surface-400 dark:bg-surface-700"}=e,{active:w="bg-surface-900 dark:bg-surface-300"}=e,{border:E=""}=e,{rounded:C="rounded-full"}=e,{label:M=""}=e,I;switch(b){case"sm":I="w-12 h-6";break;case"lg":I="w-20 h-10";break;default:I="w-16 h-8"}function T(se){["Enter","Space"].includes(se.code)&&(se.preventDefault(),m("keyup",se),se.currentTarget.firstChild.click())}function R(){return delete h.class,h}function V(se){ae.call(this,n,se)}function H(se){ae.call(this,n,se)}function B(se){ae.call(this,n,se)}function te(se){ae.call(this,n,se)}function j(se){ae.call(this,n,se)}function oe(se){ae.call(this,n,se)}function z(se){ae.call(this,n,se)}function W(se){ae.call(this,n,se)}function ie(){y=this.checked,t(0,y)}return n.$$set=se=>{t(9,e=$e($e({},e),Wt(se))),t(33,h=Nt(e,d)),"name"in se&&t(1,_=se.name),"checked"in se&&t(0,y=se.checked),"size"in se&&t(11,b=se.size),"background"in se&&t(12,p=se.background),"active"in se&&t(13,w=se.active),"border"in se&&t(14,E=se.border),"rounded"in se&&t(15,C=se.rounded),"label"in se&&t(2,M=se.label),"$$scope"in se&&t(21,g=se.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&12289&&t(19,i=y?w:`${p} cursor-pointer`),n.$$.dirty[0]&1&&t(18,s=y?"bg-white/75":"bg-white"),n.$$.dirty[0]&1&&t(17,r=y?"translate-x-full":""),t(20,a=e.disabled===!0?"opacity-50":"hover:brightness-[105%] dark:hover:brightness-110 cursor-pointer"),t(6,o=`${ew} ${C} ${a} ${e.class??""}`),n.$$.dirty[0]&638976&&t(4,c=`${nw} ${E} ${C} ${I} ${i}`),n.$$.dirty[0]&425984&&t(3,u=`${iw} ${C} ${s} ${r}`)},t(5,l=`${tw}`),e=Wt(e),[y,_,M,u,c,l,o,T,R,e,v,b,p,w,E,C,I,r,s,i,a,g,f,V,H,B,te,j,oe,z,W,ie]}class Po extends Bt{constructor(e){super(),Vt(this,e,sw,$C,Ft,{name:1,checked:0,size:11,background:12,active:13,border:14,rounded:15,label:2},null,[-1,-1])}}const rw=n=>({}),W0=n=>({});function j0(n){let e,t,i;const s=n[17].panel,r=ii(s,n,n[16],W0);return{c(){e=K("div"),r&&r.c(),this.h()},l(a){e=q(a,"DIV",{class:!0,role:!0,"aria-labelledby":!0,tabindex:!0});var o=F(e);r&&r.l(o),o.forEach(S),this.h()},h(){x(e,"class",t="tab-panel "+n[2]),x(e,"role","tabpanel"),x(e,"aria-labelledby",n[1]),x(e,"tabindex","0")},m(a,o){D(a,e,o),r&&r.m(e,null),i=!0},p(a,o){r&&r.p&&(!i||o&65536)&&si(r,s,a,a[16],i?ai(s,a[16],o,rw):ri(a[16]),W0),(!i||o&4&&t!==(t="tab-panel "+a[2]))&&x(e,"class",t),(!i||o&2)&&x(e,"aria-labelledby",a[1])},i(a){i||(ce(r,a),i=!0)},o(a){fe(r,a),i=!1},d(a){a&&S(e),r&&r.d(a)}}}function aw(n){let e,t,i,s,r,a;const o=n[17].default,l=ii(o,n,n[16],null);let c=n[5].panel&&j0(n);return{c(){e=K("div"),t=K("div"),l&&l.c(),s=Te(),c&&c.c(),this.h()},l(u){e=q(u,"DIV",{class:!0,"data-testid":!0});var d=F(e);t=q(d,"DIV",{class:!0,role:!0,"aria-labelledby":!0});var h=F(t);l&&l.l(h),h.forEach(S),s=Se(d),c&&c.l(d),d.forEach(S),this.h()},h(){x(t,"class",i="tab-list "+n[3]),x(t,"role","tablist"),x(t,"aria-labelledby",n[0]),x(e,"class",r="tab-group "+n[4]),x(e,"data-testid","tab-group")},m(u,d){D(u,e,d),P(e,t),l&&l.m(t,null),P(e,s),c&&c.m(e,null),a=!0},p(u,[d]){l&&l.p&&(!a||d&65536)&&si(l,o,u,u[16],a?ai(o,u[16],d,null):ri(u[16]),null),(!a||d&8&&i!==(i="tab-list "+u[3]))&&x(t,"class",i),(!a||d&1)&&x(t,"aria-labelledby",u[0]),u[5].panel?c?(c.p(u,d),d&32&&ce(c,1)):(c=j0(u),c.c(),ce(c,1),c.m(e,null)):c&&(_n(),fe(c,1,1,()=>{c=null}),vn()),(!a||d&16&&r!==(r="tab-group "+u[4]))&&x(e,"class",r)},i(u){a||(ce(l,u),ce(c),a=!0)},o(u){fe(l,u),fe(c),a=!1},d(u){u&&S(e),l&&l.d(u),c&&c.d()}}}const ow="space-y-4",cw="flex overflow-x-auto hide-scrollbar",lw="";function uw(n,e,t){let i,s,r,{$$slots:a={},$$scope:o}=e;const l=rl(a);let{justify:c="justify-start"}=e,{border:u="border-b border-surface-400-500-token"}=e,{active:d="border-b-2 border-surface-900-50-token"}=e,{hover:h="hover:variant-soft"}=e,{flex:f="flex-none"}=e,{padding:g="px-4 py-2"}=e,{rounded:v="rounded-tl-container-token rounded-tr-container-token"}=e,{spacing:m="space-y-1"}=e,{regionList:_=""}=e,{regionPanel:y=""}=e,{labelledby:b=""}=e,{panel:p=""}=e;return Qt("active",d),Qt("hover",h),Qt("flex",f),Qt("padding",g),Qt("rounded",v),Qt("spacing",m),n.$$set=w=>{t(18,e=$e($e({},e),Wt(w))),"justify"in w&&t(6,c=w.justify),"border"in w&&t(7,u=w.border),"active"in w&&t(8,d=w.active),"hover"in w&&t(9,h=w.hover),"flex"in w&&t(10,f=w.flex),"padding"in w&&t(11,g=w.padding),"rounded"in w&&t(12,v=w.rounded),"spacing"in w&&t(13,m=w.spacing),"regionList"in w&&t(14,_=w.regionList),"regionPanel"in w&&t(15,y=w.regionPanel),"labelledby"in w&&t(0,b=w.labelledby),"panel"in w&&t(1,p=w.panel),"$$scope"in w&&t(16,o=w.$$scope)},n.$$.update=()=>{t(4,i=`${ow} ${e.class??""}`),n.$$.dirty&16576&&t(3,s=`${cw} ${c} ${u} ${_}`),n.$$.dirty&32768&&t(2,r=`${lw} ${y}`)},e=Wt(e),[b,p,r,s,i,l,c,u,d,h,f,g,v,m,_,y,o,a]}class dw extends Bt{constructor(e){super(),Vt(this,e,uw,aw,Ft,{justify:6,border:7,active:8,hover:9,flex:10,padding:11,rounded:12,spacing:13,regionList:14,regionPanel:15,labelledby:0,panel:1})}}const hw=n=>({}),K0=n=>({});function q0(n){let e,t;const i=n[22].lead,s=ii(i,n,n[21],K0);return{c(){e=K("div"),s&&s.c(),this.h()},l(r){e=q(r,"DIV",{class:!0});var a=F(e);s&&s.l(a),a.forEach(S),this.h()},h(){x(e,"class","tab-lead")},m(r,a){D(r,e,a),s&&s.m(e,null),t=!0},p(r,a){s&&s.p&&(!t||a[0]&2097152)&&si(s,i,r,r[21],t?ai(i,r[21],a,hw):ri(r[21]),K0)},i(r){t||(ce(s,r),t=!0)},o(r){fe(s,r),t=!1},d(r){r&&S(e),s&&s.d(r)}}}function fw(n){let e,t,i,s,r,a,o,l,c,u,d,h,f,g,v,m=[{type:"radio"},{name:n[1]},{__value:n[2]},n[11](),{tabindex:"-1"}],_={};for(let w=0;w<m.length;w+=1)_=$e(_,m[w]);let y=n[12].lead&&q0(n);const b=n[22].default,p=ii(b,n,n[21],null);return f=fy(n[30][0]),{c(){e=K("label"),t=K("div"),i=K("div"),s=K("input"),r=Te(),a=K("div"),y&&y.c(),o=Te(),l=K("div"),p&&p.c(),this.h()},l(w){e=q(w,"LABEL",{class:!0,title:!0});var E=F(e);t=q(E,"DIV",{class:!0,"data-testid":!0,role:!0,"aria-controls":!0,"aria-selected":!0,tabindex:!0});var C=F(t);i=q(C,"DIV",{class:!0});var M=F(i);s=q(M,"INPUT",{type:!0,name:!0,tabindex:!0}),M.forEach(S),r=Se(C),a=q(C,"DIV",{class:!0});var I=F(a);y&&y.l(I),o=Se(I),l=q(I,"DIV",{class:!0});var T=F(l);p&&p.l(T),T.forEach(S),I.forEach(S),C.forEach(S),E.forEach(S),this.h()},h(){Yr(s,_),x(i,"class","h-0 w-0 overflow-hidden"),x(l,"class","tab-label"),x(a,"class",c="tab-interface "+n[8]),x(t,"class",u="tab "+n[7]),x(t,"data-testid","tab"),x(t,"role","tab"),x(t,"aria-controls",n[4]),x(t,"aria-selected",n[5]),x(t,"tabindex",d=n[5]?0:-1),x(e,"class",n[9]),x(e,"title",n[3]),f.p(s)},m(w,E){D(w,e,E),P(e,t),P(t,i),P(i,s),s.autofocus&&s.focus(),n[28](s),s.checked=s.__value===n[0],P(t,r),P(t,a),y&&y.m(a,null),P(a,o),P(a,l),p&&p.m(l,null),h=!0,g||(v=[X(s,"change",n[29]),X(s,"click",n[26]),X(s,"change",n[27]),X(t,"keydown",n[10]),X(t,"keydown",n[23]),X(t,"keyup",n[24]),X(t,"keypress",n[25])],g=!0)},p(w,E){Yr(s,_=Qn(m,[{type:"radio"},(!h||E[0]&2)&&{name:w[1]},(!h||E[0]&4)&&{__value:w[2]},w[11](),{tabindex:"-1"}])),E[0]&1&&(s.checked=s.__value===w[0]),w[12].lead?y?(y.p(w,E),E[0]&4096&&ce(y,1)):(y=q0(w),y.c(),ce(y,1),y.m(a,o)):y&&(_n(),fe(y,1,1,()=>{y=null}),vn()),p&&p.p&&(!h||E[0]&2097152)&&si(p,b,w,w[21],h?ai(b,w[21],E,null):ri(w[21]),null),(!h||E[0]&256&&c!==(c="tab-interface "+w[8]))&&x(a,"class",c),(!h||E[0]&128&&u!==(u="tab "+w[7]))&&x(t,"class",u),(!h||E[0]&16)&&x(t,"aria-controls",w[4]),(!h||E[0]&32)&&x(t,"aria-selected",w[5]),(!h||E[0]&32&&d!==(d=w[5]?0:-1))&&x(t,"tabindex",d),(!h||E[0]&512)&&x(e,"class",w[9]),(!h||E[0]&8)&&x(e,"title",w[3])},i(w){h||(ce(y),ce(p,w),h=!0)},o(w){fe(y),fe(p,w),h=!1},d(w){w&&S(e),n[28](null),y&&y.d(),p&&p.d(w),f.r(),g=!1,kn(v)}}}const pw="text-center cursor-pointer transition-colors duration-100",mw="";function gw(n,e,t){let i,s,r,a,o;const l=["group","name","value","title","controls","regionTab","active","hover","flex","padding","rounded","spacing"];let c=Nt(e,l),{$$slots:u={},$$scope:d}=e;const h=rl(u);let{group:f}=e,{name:g}=e,{value:v}=e,{title:m=""}=e,{controls:_=""}=e,{regionTab:y=""}=e,{active:b=Et("active")}=e,{hover:p=Et("hover")}=e,{flex:w=Et("flex")}=e,{padding:E=Et("padding")}=e,{rounded:C=Et("rounded")}=e,{spacing:M=Et("spacing")}=e,I;function T(ie){if(["Enter","Space"].includes(ie.code))ie.preventDefault(),I.click();else if(ie.code==="ArrowRight"){const se=I.closest(".tab-list");if(!se)return;const je=Array.from(se.querySelectorAll(".tab")),ge=I.closest(".tab");if(!ge)return;const L=je.indexOf(ge),J=L+1>=je.length?0:L+1,U=je[J],de=U==null?void 0:U.querySelector("input");U&&de&&(de.click(),U.focus())}else if(ie.code==="ArrowLeft"){const se=I.closest(".tab-list");if(!se)return;const je=Array.from(se.querySelectorAll(".tab")),ge=I.closest(".tab");if(!ge)return;const L=je.indexOf(ge),J=L-1<0?je.length-1:L-1,U=je[J],de=U==null?void 0:U.querySelector("input");U&&de&&(de.click(),U.focus())}}function R(){return delete c.class,c}const V=[[]];function H(ie){ae.call(this,n,ie)}function B(ie){ae.call(this,n,ie)}function te(ie){ae.call(this,n,ie)}function j(ie){ae.call(this,n,ie)}function oe(ie){ae.call(this,n,ie)}function z(ie){Nn[ie?"unshift":"push"](()=>{I=ie,t(6,I)})}function W(){f=this.__value,t(0,f)}return n.$$set=ie=>{t(32,e=$e($e({},e),Wt(ie))),t(31,c=Nt(e,l)),"group"in ie&&t(0,f=ie.group),"name"in ie&&t(1,g=ie.name),"value"in ie&&t(2,v=ie.value),"title"in ie&&t(3,m=ie.title),"controls"in ie&&t(4,_=ie.controls),"regionTab"in ie&&t(13,y=ie.regionTab),"active"in ie&&t(14,b=ie.active),"hover"in ie&&t(15,p=ie.hover),"flex"in ie&&t(16,w=ie.flex),"padding"in ie&&t(17,E=ie.padding),"rounded"in ie&&t(18,C=ie.rounded),"spacing"in ie&&t(19,M=ie.spacing),"$$scope"in ie&&t(21,d=ie.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&5&&t(5,i=v===f),n.$$.dirty[0]&49184&&t(20,s=i?b:p),t(9,r=`${pw} ${w} ${E} ${C} ${s} ${e.class??""}`),n.$$.dirty[0]&524288&&t(8,a=`${mw} ${M}`),n.$$.dirty[0]&8192&&t(7,o=`${y}`)},e=Wt(e),[f,g,v,m,_,i,I,o,a,r,T,R,h,y,b,p,w,E,C,M,s,d,u,H,B,te,j,oe,z,W,V]}class X0 extends Bt{constructor(e){super(),Vt(this,e,gw,fw,Ft,{group:0,name:1,value:2,title:3,controls:4,regionTab:13,active:14,hover:15,flex:16,padding:17,rounded:18,spacing:19},null,[-1,-1])}}let ho=[];function Ze(n){let e=[],t=(a,o=!0)=>(e.includes(a)||e.push(a),o&&a(n),()=>{e=e.filter(l=>l!=a)});function i(a){if(a===n&&(n===null||typeof n!="object"))return;let o=n;n=a;for(let l of e)l(n,o)}function s(){let a=ho[ho.length-1];return a&&t(a[0],!1),n}if(typeof n=="function")return _w(n);function r(){for(let a of e)a(n,n)}return{subscribe:t,set:i,get:s,refresh:r,update:a=>{typeof a=="function"&&i(a(n))}}}function _w(n){let e=Ze(null),t=[i];return i(),e;function i(){if(ho.includes(t))throw Error("Circular computation");ho.push(t);let s;try{s=n()}catch(r){throw ho.pop(),r}ho.pop(),e.set(s)}}let Wc=null,ru=null,Kd=null;const ti=()=>{ng();const n=Date.now();return Wc!=null?n+Wc:n},wy=()=>{if(!globalThis.window||window.performance==null)return ti();const n=performance.now();return ru==null&&(ru=Date.now()-n),ng(),n+ru},wV=()=>(ng(),Wc),ng=()=>{Wc!=null||Kd!=null||(Kd=setInterval(async()=>{try{await vw(),clearInterval(Kd)}catch(n){console.error("Failed getting server time: ",n)}},3e3))},vw=async()=>{if(!globalThis.window||!window.fetch)return;const n=await fetch(window.location.href,{method:"HEAD"}).then(e=>{const t=e.headers.get("date");return t?new Date(t).getTime():null});if(n==null)throw new Error("Date header not found.");Wc=n-Date.now(),window.performance!=null&&(ru=n-performance.now())};function Ry(n){let e=typeof n;if(e=="object"){if(Array.isArray(n))return"array";if(n===null)return"null"}return e}function bw(n){return n!==null&&typeof n=="object"&&!Array.isArray(n)}let ir="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),md=[];for(let n=0;n<ir.length;n++)md[ir[n].charCodeAt(0)]=n;md[45]=ir.indexOf("+");md[95]=ir.indexOf("/");function yw(n){let e=n.length*3/4;n[n.length-2]=="="?e-=2:n[n.length-1]=="="&&(e-=1);let t=new Uint8Array(e),i=0,s=0,r,a=0;for(let o=0;o<n.length;o++){if(r=md[n.charCodeAt(o)],r===void 0)switch(n[o]){case"=":s=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(s){case 0:a=r,s=1;break;case 1:t[i++]=a<<2|(r&48)>>4,a=r,s=2;break;case 2:t[i++]=(a&15)<<4|(r&60)>>2,a=r,s=3;break;case 3:t[i++]=(a&3)<<6|r,s=0;break}}if(s==1)throw Error("invalid base64 string.");return t.subarray(0,i)}function Tw(n){let e="",t=0,i,s=0;for(let r=0;r<n.length;r++)switch(i=n[r],t){case 0:e+=ir[i>>2],s=(i&3)<<4,t=1;break;case 1:e+=ir[s|i>>4],s=(i&15)<<2,t=2;break;case 2:e+=ir[s|i>>6],e+=ir[i&63],t=0;break}return t&&(e+=ir[s],e+="=",t==1&&(e+="=")),e}var De;(function(n){n.symbol=Symbol.for("protobuf-ts/unknown"),n.onRead=(t,i,s,r,a)=>{(e(i)?i[n.symbol]:i[n.symbol]=[]).push({no:s,wireType:r,data:a})},n.onWrite=(t,i,s)=>{for(let{no:r,wireType:a,data:o}of n.list(i))s.tag(r,a).raw(o)},n.list=(t,i)=>{if(e(t)){let s=t[n.symbol];return i?s.filter(r=>r.no==i):s}return[]},n.last=(t,i)=>n.list(t,i).slice(-1)[0];const e=t=>t&&Array.isArray(t[n.symbol])})(De||(De={}));var ne;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32"})(ne||(ne={}));function Sw(){let n=0,e=0;for(let i=0;i<28;i+=7){let s=this.buf[this.pos++];if(n|=(s&127)<<i,!(s&128))return this.assertBounds(),[n,e]}let t=this.buf[this.pos++];if(n|=(t&15)<<28,e=(t&112)>>4,!(t&128))return this.assertBounds(),[n,e];for(let i=3;i<=31;i+=7){let s=this.buf[this.pos++];if(e|=(s&127)<<i,!(s&128))return this.assertBounds(),[n,e]}throw new Error("invalid varint")}function qd(n,e,t){for(let r=0;r<28;r=r+7){const a=n>>>r,o=!(!(a>>>7)&&e==0),l=(o?a|128:a)&255;if(t.push(l),!o)return}const i=n>>>28&15|(e&7)<<4,s=!!(e>>3);if(t.push((s?i|128:i)&255),!!s){for(let r=3;r<31;r=r+7){const a=e>>>r,o=!!(a>>>7),l=(o?a|128:a)&255;if(t.push(l),!o)return}t.push(e>>>31&1)}}const au=65536*65536;function ky(n){let e=n[0]=="-";e&&(n=n.slice(1));const t=1e6;let i=0,s=0;function r(a,o){const l=Number(n.slice(a,o));s*=t,i=i*t+l,i>=au&&(s=s+(i/au|0),i=i%au)}return r(-24,-18),r(-18,-12),r(-12,-6),r(-6),[e,i,s]}function up(n,e){if(e>>>0<=2097151)return""+(au*e+(n>>>0));let t=n&16777215,i=(n>>>24|e<<8)>>>0&16777215,s=e>>16&65535,r=t+i*6777216+s*6710656,a=i+s*8147497,o=s*2,l=1e7;r>=l&&(a+=Math.floor(r/l),r%=l),a>=l&&(o+=Math.floor(a/l),a%=l);function c(u,d){let h=u?String(u):"";return d?"0000000".slice(h.length)+h:h}return c(o,0)+c(a,o)+c(r,1)}function Y0(n,e){if(n>=0){for(;n>127;)e.push(n&127|128),n=n>>>7;e.push(n)}else{for(let t=0;t<9;t++)e.push(n&127|128),n=n>>7;e.push(1)}}function Ew(){let n=this.buf[this.pos++],e=n&127;if(!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<7,!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<14,!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<21,!(n&128))return this.assertBounds(),e;n=this.buf[this.pos++],e|=(n&15)<<28;for(let t=5;n&128&&t<10;t++)n=this.buf[this.pos++];if(n&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}let Tn;function Aw(){const n=new DataView(new ArrayBuffer(8));Tn=globalThis.BigInt!==void 0&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"?{MIN:BigInt("-9223372036854775808"),MAX:BigInt("9223372036854775807"),UMIN:BigInt("0"),UMAX:BigInt("18446744073709551615"),C:BigInt,V:n}:void 0}Aw();function My(n){if(!n)throw new Error("BigInt unavailable, see https://github.com/timostamm/protobuf-ts/blob/v1.0.8/MANUAL.md#bigint-support")}const xy=/^-?[0-9]+$/,Gu=4294967296,_l=2147483648;class Iy{constructor(e,t){this.lo=e|0,this.hi=t|0}isZero(){return this.lo==0&&this.hi==0}toNumber(){let e=this.hi*Gu+(this.lo>>>0);if(!Number.isSafeInteger(e))throw new Error("cannot convert to safe number");return e}}class gi extends Iy{static from(e){if(Tn)switch(typeof e){case"string":if(e=="0")return this.ZERO;if(e=="")throw new Error("string is no integer");e=Tn.C(e);case"number":if(e===0)return this.ZERO;e=Tn.C(e);case"bigint":if(!e)return this.ZERO;if(e<Tn.UMIN)throw new Error("signed value for ulong");if(e>Tn.UMAX)throw new Error("ulong too large");return Tn.V.setBigUint64(0,e,!0),new gi(Tn.V.getInt32(0,!0),Tn.V.getInt32(4,!0))}else switch(typeof e){case"string":if(e=="0")return this.ZERO;if(e=e.trim(),!xy.test(e))throw new Error("string is no integer");let[t,i,s]=ky(e);if(t)throw new Error("signed value for ulong");return new gi(i,s);case"number":if(e==0)return this.ZERO;if(!Number.isSafeInteger(e))throw new Error("number is no integer");if(e<0)throw new Error("signed value for ulong");return new gi(e,e/Gu)}throw new Error("unknown value "+typeof e)}toString(){return Tn?this.toBigInt().toString():up(this.lo,this.hi)}toBigInt(){return My(Tn),Tn.V.setInt32(0,this.lo,!0),Tn.V.setInt32(4,this.hi,!0),Tn.V.getBigUint64(0,!0)}}gi.ZERO=new gi(0,0);class Hn extends Iy{static from(e){if(Tn)switch(typeof e){case"string":if(e=="0")return this.ZERO;if(e=="")throw new Error("string is no integer");e=Tn.C(e);case"number":if(e===0)return this.ZERO;e=Tn.C(e);case"bigint":if(!e)return this.ZERO;if(e<Tn.MIN)throw new Error("signed long too small");if(e>Tn.MAX)throw new Error("signed long too large");return Tn.V.setBigInt64(0,e,!0),new Hn(Tn.V.getInt32(0,!0),Tn.V.getInt32(4,!0))}else switch(typeof e){case"string":if(e=="0")return this.ZERO;if(e=e.trim(),!xy.test(e))throw new Error("string is no integer");let[t,i,s]=ky(e);if(t){if(s>_l||s==_l&&i!=0)throw new Error("signed long too small")}else if(s>=_l)throw new Error("signed long too large");let r=new Hn(i,s);return t?r.negate():r;case"number":if(e==0)return this.ZERO;if(!Number.isSafeInteger(e))throw new Error("number is no integer");return e>0?new Hn(e,e/Gu):new Hn(-e,-e/Gu).negate()}throw new Error("unknown value "+typeof e)}isNegative(){return(this.hi&_l)!==0}negate(){let e=~this.hi,t=this.lo;return t?t=~t+1:e+=1,new Hn(t,e)}toString(){if(Tn)return this.toBigInt().toString();if(this.isNegative()){let e=this.negate();return"-"+up(e.lo,e.hi)}return up(this.lo,this.hi)}toBigInt(){return My(Tn),Tn.V.setInt32(0,this.lo,!0),Tn.V.setInt32(4,this.hi,!0),Tn.V.getBigInt64(0,!0)}}Hn.ZERO=new Hn(0,0);const J0={readUnknownField:!0,readerFactory:n=>new ww(n)};function Cw(n){return n?Object.assign(Object.assign({},J0),n):J0}let ww=class{constructor(e,t){this.varint64=Sw,this.uint32=Ew,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t??new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0})}tag(){let e=this.uint32(),t=e>>>3,i=e&7;if(t<=0||i<0||i>5)throw new Error("illegal tag: field no "+t+" wire type "+i);return[t,i]}skip(e){let t=this.pos;switch(e){case ne.Varint:for(;this.buf[this.pos++]&128;);break;case ne.Bit64:this.pos+=4;case ne.Bit32:this.pos+=4;break;case ne.LengthDelimited:let i=this.uint32();this.pos+=i;break;case ne.StartGroup:let s;for(;(s=this.tag()[1])!==ne.EndGroup;)this.skip(s);break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(t,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return new Hn(...this.varint64())}uint64(){return new gi(...this.varint64())}sint64(){let[e,t]=this.varint64(),i=-(e&1);return e=(e>>>1|(t&1)<<31)^i,t=t>>>1^i,new Hn(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return new gi(this.sfixed32(),this.sfixed32())}sfixed64(){return new Hn(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}};function sn(n,e){if(!n)throw new Error(e)}const Rw=34028234663852886e22,kw=-34028234663852886e22,Mw=4294967295,xw=2147483647,Iw=-2147483648;function Pc(n){if(typeof n!="number")throw new Error("invalid int 32: "+typeof n);if(!Number.isInteger(n)||n>xw||n<Iw)throw new Error("invalid int 32: "+n)}function zu(n){if(typeof n!="number")throw new Error("invalid uint 32: "+typeof n);if(!Number.isInteger(n)||n>Mw||n<0)throw new Error("invalid uint 32: "+n)}function ig(n){if(typeof n!="number")throw new Error("invalid float 32: "+typeof n);if(Number.isFinite(n)&&(n>Rw||n<kw))throw new Error("invalid float 32: "+n)}const Q0={writeUnknownFields:!0,writerFactory:()=>new Nw};function Pw(n){return n?Object.assign(Object.assign({},Q0),n):Q0}let Nw=class{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let s=0;s<this.chunks.length;s++)e+=this.chunks[s].length;let t=new Uint8Array(e),i=0;for(let s=0;s<this.chunks.length;s++)t.set(this.chunks[s],i),i+=this.chunks[s].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(zu(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Pc(e),Y0(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){ig(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){zu(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){Pc(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return Pc(e),e=(e<<1^e>>31)>>>0,Y0(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),s=Hn.from(e);return i.setInt32(0,s.lo,!0),i.setInt32(4,s.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),s=gi.from(e);return i.setInt32(0,s.lo,!0),i.setInt32(4,s.hi,!0),this.raw(t)}int64(e){let t=Hn.from(e);return qd(t.lo,t.hi,this.buf),this}sint64(e){let t=Hn.from(e),i=t.hi>>31,s=t.lo<<1^i,r=(t.hi<<1|t.lo>>>31)^i;return qd(s,r,this.buf),this}uint64(e){let t=gi.from(e);return qd(t.lo,t.hi,this.buf),this}};const Z0={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0},$0={ignoreUnknownFields:!1};function Dw(n){return n?Object.assign(Object.assign({},$0),n):$0}function Lw(n){return n?Object.assign(Object.assign({},Z0),n):Z0}const Py=Symbol.for("protobuf-ts/message-type");function e_(n){let e=!1;const t=[];for(let i=0;i<n.length;i++){let s=n.charAt(i);s=="_"?e=!0:/\d/.test(s)?(t.push(s),e=!0):e?(t.push(s.toUpperCase()),e=!1):i==0?t.push(s.toLowerCase()):t.push(s)}return t.join("")}var Ae;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(Ae||(Ae={}));var Ps;(function(n){n[n.BIGINT=0]="BIGINT",n[n.STRING=1]="STRING",n[n.NUMBER=2]="NUMBER"})(Ps||(Ps={}));var Hu;(function(n){n[n.NO=0]="NO",n[n.PACKED=1]="PACKED",n[n.UNPACKED=2]="UNPACKED"})(Hu||(Hu={}));function Ow(n){var e,t,i,s;return n.localName=(e=n.localName)!==null&&e!==void 0?e:e_(n.name),n.jsonName=(t=n.jsonName)!==null&&t!==void 0?t:e_(n.name),n.repeat=(i=n.repeat)!==null&&i!==void 0?i:Hu.NO,n.opt=(s=n.opt)!==null&&s!==void 0?s:n.repeat||n.oneof?!1:n.kind=="message",n}function Uw(n){if(typeof n!="object"||n===null||!n.hasOwnProperty("oneofKind"))return!1;switch(typeof n.oneofKind){case"string":return n[n.oneofKind]===void 0?!1:Object.keys(n).length==2;case"undefined":return Object.keys(n).length==1;default:return!1}}class Fw{constructor(e){var t;this.fields=(t=e.fields)!==null&&t!==void 0?t:[]}prepare(){if(this.data)return;const e=[],t=[],i=[];for(let s of this.fields)if(s.oneof)i.includes(s.oneof)||(i.push(s.oneof),e.push(s.oneof),t.push(s.oneof));else switch(t.push(s.localName),s.kind){case"scalar":case"enum":(!s.opt||s.repeat)&&e.push(s.localName);break;case"message":s.repeat&&e.push(s.localName);break;case"map":e.push(s.localName);break}this.data={req:e,known:t,oneofs:Object.values(i)}}is(e,t,i=!1){if(t<0)return!0;if(e==null||typeof e!="object")return!1;this.prepare();let s=Object.keys(e),r=this.data;if(s.length<r.req.length||r.req.some(a=>!s.includes(a))||!i&&s.some(a=>!r.known.includes(a)))return!1;if(t<1)return!0;for(const a of r.oneofs){const o=e[a];if(!Uw(o))return!1;if(o.oneofKind===void 0)continue;const l=this.fields.find(c=>c.localName===o.oneofKind);if(!l||!this.field(o[o.oneofKind],l,i,t))return!1}for(const a of this.fields)if(a.oneof===void 0&&!this.field(e[a.localName],a,i,t))return!1;return!0}field(e,t,i,s){let r=t.repeat;switch(t.kind){case"scalar":return e===void 0?t.opt:r?this.scalars(e,t.T,s,t.L):this.scalar(e,t.T,t.L);case"enum":return e===void 0?t.opt:r?this.scalars(e,Ae.INT32,s):this.scalar(e,Ae.INT32);case"message":return e===void 0?!0:r?this.messages(e,t.T(),i,s):this.message(e,t.T(),i,s);case"map":if(typeof e!="object"||e===null)return!1;if(s<2)return!0;if(!this.mapKeys(e,t.K,s))return!1;switch(t.V.kind){case"scalar":return this.scalars(Object.values(e),t.V.T,s,t.V.L);case"enum":return this.scalars(Object.values(e),Ae.INT32,s);case"message":return this.messages(Object.values(e),t.V.T(),i,s)}break}return!0}message(e,t,i,s){return i?t.isAssignable(e,s):t.is(e,s)}messages(e,t,i,s){if(!Array.isArray(e))return!1;if(s<2)return!0;if(i){for(let r=0;r<e.length&&r<s;r++)if(!t.isAssignable(e[r],s-1))return!1}else for(let r=0;r<e.length&&r<s;r++)if(!t.is(e[r],s-1))return!1;return!0}scalar(e,t,i){let s=typeof e;switch(t){case Ae.UINT64:case Ae.FIXED64:case Ae.INT64:case Ae.SFIXED64:case Ae.SINT64:switch(i){case Ps.BIGINT:return s=="bigint";case Ps.NUMBER:return s=="number"&&!isNaN(e);default:return s=="string"}case Ae.BOOL:return s=="boolean";case Ae.STRING:return s=="string";case Ae.BYTES:return e instanceof Uint8Array;case Ae.DOUBLE:case Ae.FLOAT:return s=="number"&&!isNaN(e);default:return s=="number"&&Number.isInteger(e)}}scalars(e,t,i,s){if(!Array.isArray(e))return!1;if(i<2)return!0;if(Array.isArray(e)){for(let r=0;r<e.length&&r<i;r++)if(!this.scalar(e[r],t,s))return!1}return!0}mapKeys(e,t,i){let s=Object.keys(e);switch(t){case Ae.INT32:case Ae.FIXED32:case Ae.SFIXED32:case Ae.SINT32:case Ae.UINT32:return this.scalars(s.slice(0,i).map(r=>parseInt(r)),t,i);case Ae.BOOL:return this.scalars(s.slice(0,i).map(r=>r=="true"?!0:r=="false"?!1:r),t,i);default:return this.scalars(s,t,i,Ps.STRING)}}}function hs(n,e){switch(e){case Ps.BIGINT:return n.toBigInt();case Ps.NUMBER:return n.toNumber();default:return n.toString()}}class Bw{constructor(e){this.info=e}prepare(){var e;if(this.fMap===void 0){this.fMap={};const t=(e=this.info.fields)!==null&&e!==void 0?e:[];for(const i of t)this.fMap[i.name]=i,this.fMap[i.jsonName]=i,this.fMap[i.localName]=i}}assert(e,t,i){if(!e){let s=Ry(i);throw(s=="number"||s=="boolean")&&(s=i.toString()),new Error(`Cannot parse JSON ${s} for ${this.info.typeName}#${t}`)}}read(e,t,i){this.prepare();const s=[];for(const[r,a]of Object.entries(e)){const o=this.fMap[r];if(!o){if(!i.ignoreUnknownFields)throw new Error(`Found unknown field while reading ${this.info.typeName} from JSON format. JSON key: ${r}`);continue}const l=o.localName;let c;if(o.oneof){if(a===null&&(o.kind!=="enum"||o.T()[0]!=="google.protobuf.NullValue"))continue;if(s.includes(o.oneof))throw new Error(`Multiple members of the oneof group "${o.oneof}" of ${this.info.typeName} are present in JSON.`);s.push(o.oneof),c=t[o.oneof]={oneofKind:l}}else c=t;if(o.kind=="map"){if(a===null)continue;this.assert(bw(a),o.name,a);const u=c[l];for(const[d,h]of Object.entries(a)){this.assert(h!==null,o.name+" map value",null);let f;switch(o.V.kind){case"message":f=o.V.T().internalJsonRead(h,i);break;case"enum":if(f=this.enum(o.V.T(),h,o.name,i.ignoreUnknownFields),f===!1)continue;break;case"scalar":f=this.scalar(h,o.V.T,o.V.L,o.name);break}this.assert(f!==void 0,o.name+" map value",h);let g=d;o.K==Ae.BOOL&&(g=g=="true"?!0:g=="false"?!1:g),g=this.scalar(g,o.K,Ps.STRING,o.name).toString(),u[g]=f}}else if(o.repeat){if(a===null)continue;this.assert(Array.isArray(a),o.name,a);const u=c[l];for(const d of a){this.assert(d!==null,o.name,null);let h;switch(o.kind){case"message":h=o.T().internalJsonRead(d,i);break;case"enum":if(h=this.enum(o.T(),d,o.name,i.ignoreUnknownFields),h===!1)continue;break;case"scalar":h=this.scalar(d,o.T,o.L,o.name);break}this.assert(h!==void 0,o.name,a),u.push(h)}}else switch(o.kind){case"message":if(a===null&&o.T().typeName!="google.protobuf.Value"){this.assert(o.oneof===void 0,o.name+" (oneof member)",null);continue}c[l]=o.T().internalJsonRead(a,i,c[l]);break;case"enum":let u=this.enum(o.T(),a,o.name,i.ignoreUnknownFields);if(u===!1)continue;c[l]=u;break;case"scalar":c[l]=this.scalar(a,o.T,o.L,o.name);break}}}enum(e,t,i,s){if(e[0]=="google.protobuf.NullValue"&&sn(t===null||t==="NULL_VALUE",`Unable to parse field ${this.info.typeName}#${i}, enum ${e[0]} only accepts null.`),t===null)return 0;switch(typeof t){case"number":return sn(Number.isInteger(t),`Unable to parse field ${this.info.typeName}#${i}, enum can only be integral number, got ${t}.`),t;case"string":let r=t;e[2]&&t.substring(0,e[2].length)===e[2]&&(r=t.substring(e[2].length));let a=e[1][r];return typeof a>"u"&&s?!1:(sn(typeof a=="number",`Unable to parse field ${this.info.typeName}#${i}, enum ${e[0]} has no value for "${t}".`),a)}sn(!1,`Unable to parse field ${this.info.typeName}#${i}, cannot parse enum value from ${typeof t}".`)}scalar(e,t,i,s){let r;try{switch(t){case Ae.DOUBLE:case Ae.FLOAT:if(e===null)return 0;if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""){r="empty string";break}if(typeof e=="string"&&e.trim().length!==e.length){r="extra whitespace";break}if(typeof e!="string"&&typeof e!="number")break;let a=Number(e);if(Number.isNaN(a)){r="not a number";break}if(!Number.isFinite(a)){r="too large or small";break}return t==Ae.FLOAT&&ig(a),a;case Ae.INT32:case Ae.FIXED32:case Ae.SFIXED32:case Ae.SINT32:case Ae.UINT32:if(e===null)return 0;let o;if(typeof e=="number"?o=e:e===""?r="empty string":typeof e=="string"&&(e.trim().length!==e.length?r="extra whitespace":o=Number(e)),o===void 0)break;return t==Ae.UINT32?zu(o):Pc(o),o;case Ae.INT64:case Ae.SFIXED64:case Ae.SINT64:if(e===null)return hs(Hn.ZERO,i);if(typeof e!="number"&&typeof e!="string")break;return hs(Hn.from(e),i);case Ae.FIXED64:case Ae.UINT64:if(e===null)return hs(gi.ZERO,i);if(typeof e!="number"&&typeof e!="string")break;return hs(gi.from(e),i);case Ae.BOOL:if(e===null)return!1;if(typeof e!="boolean")break;return e;case Ae.STRING:if(e===null)return"";if(typeof e!="string"){r="extra whitespace";break}try{encodeURIComponent(e)}catch(l){l="invalid UTF8";break}return e;case Ae.BYTES:if(e===null||e==="")return new Uint8Array(0);if(typeof e!="string")break;return yw(e)}}catch(a){r=a.message}this.assert(!1,s+(r?" - "+r:""),e)}}class Vw{constructor(e){var t;this.fields=(t=e.fields)!==null&&t!==void 0?t:[]}write(e,t){const i={},s=e;for(const r of this.fields){if(!r.oneof){let c=this.field(r,s[r.localName],t);c!==void 0&&(i[t.useProtoFieldName?r.name:r.jsonName]=c);continue}const a=s[r.oneof];if(a.oneofKind!==r.localName)continue;const o=r.kind=="scalar"||r.kind=="enum"?Object.assign(Object.assign({},t),{emitDefaultValues:!0}):t;let l=this.field(r,a[r.localName],o);sn(l!==void 0),i[t.useProtoFieldName?r.name:r.jsonName]=l}return i}field(e,t,i){let s;if(e.kind=="map"){sn(typeof t=="object"&&t!==null);const r={};switch(e.V.kind){case"scalar":for(const[l,c]of Object.entries(t)){const u=this.scalar(e.V.T,c,e.name,!1,!0);sn(u!==void 0),r[l.toString()]=u}break;case"message":const a=e.V.T();for(const[l,c]of Object.entries(t)){const u=this.message(a,c,e.name,i);sn(u!==void 0),r[l.toString()]=u}break;case"enum":const o=e.V.T();for(const[l,c]of Object.entries(t)){sn(c===void 0||typeof c=="number");const u=this.enum(o,c,e.name,!1,!0,i.enumAsInteger);sn(u!==void 0),r[l.toString()]=u}break}(i.emitDefaultValues||Object.keys(r).length>0)&&(s=r)}else if(e.repeat){sn(Array.isArray(t));const r=[];switch(e.kind){case"scalar":for(let l=0;l<t.length;l++){const c=this.scalar(e.T,t[l],e.name,e.opt,!0);sn(c!==void 0),r.push(c)}break;case"enum":const a=e.T();for(let l=0;l<t.length;l++){sn(t[l]===void 0||typeof t[l]=="number");const c=this.enum(a,t[l],e.name,e.opt,!0,i.enumAsInteger);sn(c!==void 0),r.push(c)}break;case"message":const o=e.T();for(let l=0;l<t.length;l++){const c=this.message(o,t[l],e.name,i);sn(c!==void 0),r.push(c)}break}(i.emitDefaultValues||r.length>0||i.emitDefaultValues)&&(s=r)}else switch(e.kind){case"scalar":s=this.scalar(e.T,t,e.name,e.opt,i.emitDefaultValues);break;case"enum":s=this.enum(e.T(),t,e.name,e.opt,i.emitDefaultValues,i.enumAsInteger);break;case"message":s=this.message(e.T(),t,e.name,i);break}return s}enum(e,t,i,s,r,a){if(e[0]=="google.protobuf.NullValue")return!r&&!s?void 0:null;if(t===void 0){sn(s);return}if(!(t===0&&!r&&!s))return sn(typeof t=="number"),sn(Number.isInteger(t)),a||!e[1].hasOwnProperty(t)?t:e[2]?e[2]+e[1][t]:e[1][t]}message(e,t,i,s){return t===void 0?s.emitDefaultValues?null:void 0:e.internalJsonWrite(t,s)}scalar(e,t,i,s,r){if(t===void 0){sn(s);return}const a=r||s;switch(e){case Ae.INT32:case Ae.SFIXED32:case Ae.SINT32:return t===0?a?0:void 0:(Pc(t),t);case Ae.FIXED32:case Ae.UINT32:return t===0?a?0:void 0:(zu(t),t);case Ae.FLOAT:ig(t);case Ae.DOUBLE:return t===0?a?0:void 0:(sn(typeof t=="number"),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t);case Ae.STRING:return t===""?a?"":void 0:(sn(typeof t=="string"),t);case Ae.BOOL:return t===!1?a?!1:void 0:(sn(typeof t=="boolean"),t);case Ae.UINT64:case Ae.FIXED64:sn(typeof t=="number"||typeof t=="string"||typeof t=="bigint");let o=gi.from(t);return o.isZero()&&!a?void 0:o.toString();case Ae.INT64:case Ae.SFIXED64:case Ae.SINT64:sn(typeof t=="number"||typeof t=="string"||typeof t=="bigint");let l=Hn.from(t);return l.isZero()&&!a?void 0:l.toString();case Ae.BYTES:return sn(t instanceof Uint8Array),t.byteLength?Tw(t):a?"":void 0}}}function dp(n,e=Ps.STRING){switch(n){case Ae.BOOL:return!1;case Ae.UINT64:case Ae.FIXED64:return hs(gi.ZERO,e);case Ae.INT64:case Ae.SFIXED64:case Ae.SINT64:return hs(Hn.ZERO,e);case Ae.DOUBLE:case Ae.FLOAT:return 0;case Ae.BYTES:return new Uint8Array(0);case Ae.STRING:return"";default:return 0}}class Gw{constructor(e){this.info=e}prepare(){var e;if(!this.fieldNoToField){const t=(e=this.info.fields)!==null&&e!==void 0?e:[];this.fieldNoToField=new Map(t.map(i=>[i.no,i]))}}read(e,t,i,s){this.prepare();const r=s===void 0?e.len:e.pos+s;for(;e.pos<r;){const[a,o]=e.tag(),l=this.fieldNoToField.get(a);if(!l){let h=i.readUnknownField;if(h=="throw")throw new Error(`Unknown field ${a} (wire type ${o}) for ${this.info.typeName}`);let f=e.skip(o);h!==!1&&(h===!0?De.onRead:h)(this.info.typeName,t,a,o,f);continue}let c=t,u=l.repeat,d=l.localName;switch(l.oneof&&(c=c[l.oneof],c.oneofKind!==d&&(c=t[l.oneof]={oneofKind:d})),l.kind){case"scalar":case"enum":let h=l.kind=="enum"?Ae.INT32:l.T,f=l.kind=="scalar"?l.L:void 0;if(u){let m=c[d];if(o==ne.LengthDelimited&&h!=Ae.STRING&&h!=Ae.BYTES){let _=e.uint32()+e.pos;for(;e.pos<_;)m.push(this.scalar(e,h,f))}else m.push(this.scalar(e,h,f))}else c[d]=this.scalar(e,h,f);break;case"message":if(u){let m=c[d],_=l.T().internalBinaryRead(e,e.uint32(),i);m.push(_)}else c[d]=l.T().internalBinaryRead(e,e.uint32(),i,c[d]);break;case"map":let[g,v]=this.mapEntry(l,e,i);c[d][g]=v;break}}}mapEntry(e,t,i){let s=t.uint32(),r=t.pos+s,a,o;for(;t.pos<r;){let[l,c]=t.tag();switch(l){case 1:e.K==Ae.BOOL?a=t.bool().toString():a=this.scalar(t,e.K,Ps.STRING);break;case 2:switch(e.V.kind){case"scalar":o=this.scalar(t,e.V.T,e.V.L);break;case"enum":o=t.int32();break;case"message":o=e.V.T().internalBinaryRead(t,t.uint32(),i);break}break;default:throw new Error(`Unknown field ${l} (wire type ${c}) in map entry for ${this.info.typeName}#${e.name}`)}}if(a===void 0){let l=dp(e.K);a=e.K==Ae.BOOL?l.toString():l}if(o===void 0)switch(e.V.kind){case"scalar":o=dp(e.V.T,e.V.L);break;case"enum":o=0;break;case"message":o=e.V.T().create();break}return[a,o]}scalar(e,t,i){switch(t){case Ae.INT32:return e.int32();case Ae.STRING:return e.string();case Ae.BOOL:return e.bool();case Ae.DOUBLE:return e.double();case Ae.FLOAT:return e.float();case Ae.INT64:return hs(e.int64(),i);case Ae.UINT64:return hs(e.uint64(),i);case Ae.FIXED64:return hs(e.fixed64(),i);case Ae.FIXED32:return e.fixed32();case Ae.BYTES:return e.bytes();case Ae.UINT32:return e.uint32();case Ae.SFIXED32:return e.sfixed32();case Ae.SFIXED64:return hs(e.sfixed64(),i);case Ae.SINT32:return e.sint32();case Ae.SINT64:return hs(e.sint64(),i)}}}class zw{constructor(e){this.info=e}prepare(){if(!this.fields){const e=this.info.fields?this.info.fields.concat():[];this.fields=e.sort((t,i)=>t.no-i.no)}}write(e,t,i){this.prepare();for(const r of this.fields){let a,o,l=r.repeat,c=r.localName;if(r.oneof){const u=e[r.oneof];if(u.oneofKind!==c)continue;a=u[c],o=!0}else a=e[c],o=!1;switch(r.kind){case"scalar":case"enum":let u=r.kind=="enum"?Ae.INT32:r.T;if(l)if(sn(Array.isArray(a)),l==Hu.PACKED)this.packed(t,u,r.no,a);else for(const d of a)this.scalar(t,u,r.no,d,!0);else a===void 0?sn(r.opt):this.scalar(t,u,r.no,a,o||r.opt);break;case"message":if(l){sn(Array.isArray(a));for(const d of a)this.message(t,i,r.T(),r.no,d)}else this.message(t,i,r.T(),r.no,a);break;case"map":sn(typeof a=="object"&&a!==null);for(const[d,h]of Object.entries(a))this.mapEntry(t,i,r,d,h);break}}let s=i.writeUnknownFields;s!==!1&&(s===!0?De.onWrite:s)(this.info.typeName,e,t)}mapEntry(e,t,i,s,r){e.tag(i.no,ne.LengthDelimited),e.fork();let a=s;switch(i.K){case Ae.INT32:case Ae.FIXED32:case Ae.UINT32:case Ae.SFIXED32:case Ae.SINT32:a=Number.parseInt(s);break;case Ae.BOOL:sn(s=="true"||s=="false"),a=s=="true";break}switch(this.scalar(e,i.K,1,a,!0),i.V.kind){case"scalar":this.scalar(e,i.V.T,2,r,!0);break;case"enum":this.scalar(e,Ae.INT32,2,r,!0);break;case"message":this.message(e,t,i.V.T(),2,r);break}e.join()}message(e,t,i,s,r){r!==void 0&&(i.internalBinaryWrite(r,e.tag(s,ne.LengthDelimited).fork(),t),e.join())}scalar(e,t,i,s,r){let[a,o,l]=this.scalarInfo(t,s);(!l||r)&&(e.tag(i,a),e[o](s))}packed(e,t,i,s){if(!s.length)return;sn(t!==Ae.BYTES&&t!==Ae.STRING),e.tag(i,ne.LengthDelimited),e.fork();let[,r]=this.scalarInfo(t);for(let a=0;a<s.length;a++)e[r](s[a]);e.join()}scalarInfo(e,t){let i=ne.Varint,s,r=t===void 0,a=t===0;switch(e){case Ae.INT32:s="int32";break;case Ae.STRING:a=r||!t.length,i=ne.LengthDelimited,s="string";break;case Ae.BOOL:a=t===!1,s="bool";break;case Ae.UINT32:s="uint32";break;case Ae.DOUBLE:i=ne.Bit64,s="double";break;case Ae.FLOAT:i=ne.Bit32,s="float";break;case Ae.INT64:a=r||Hn.from(t).isZero(),s="int64";break;case Ae.UINT64:a=r||gi.from(t).isZero(),s="uint64";break;case Ae.FIXED64:a=r||gi.from(t).isZero(),i=ne.Bit64,s="fixed64";break;case Ae.BYTES:a=r||!t.byteLength,i=ne.LengthDelimited,s="bytes";break;case Ae.FIXED32:i=ne.Bit32,s="fixed32";break;case Ae.SFIXED32:i=ne.Bit32,s="sfixed32";break;case Ae.SFIXED64:a=r||Hn.from(t).isZero(),i=ne.Bit64,s="sfixed64";break;case Ae.SINT32:s="sint32";break;case Ae.SINT64:a=r||Hn.from(t).isZero(),s="sint64";break}return[i,s,r||a]}}function Hw(n){const e=n.messagePrototype?Object.create(n.messagePrototype):Object.defineProperty({},Py,{value:n});for(let t of n.fields){let i=t.localName;if(!t.opt)if(t.oneof)e[t.oneof]={oneofKind:void 0};else if(t.repeat)e[i]=[];else switch(t.kind){case"scalar":e[i]=dp(t.T,t.L);break;case"enum":e[i]=0;break;case"map":e[i]={};break}}return e}function _t(n,e,t){let i,s=t,r;for(let a of n.fields){let o=a.localName;if(a.oneof){const l=s[a.oneof];if((l==null?void 0:l.oneofKind)==null)continue;if(i=l[o],r=e[a.oneof],r.oneofKind=l.oneofKind,i==null){delete r[o];continue}}else if(i=s[o],r=e,i==null)continue;switch(a.repeat&&(r[o].length=i.length),a.kind){case"scalar":case"enum":if(a.repeat)for(let c=0;c<i.length;c++)r[o][c]=i[c];else r[o]=i;break;case"message":let l=a.T();if(a.repeat)for(let c=0;c<i.length;c++)r[o][c]=l.create(i[c]);else r[o]===void 0?r[o]=l.create(i):l.mergePartial(r[o],i);break;case"map":switch(a.V.kind){case"scalar":case"enum":Object.assign(r[o],i);break;case"message":let c=a.V.T();for(let u of Object.keys(i))r[o][u]=c.create(i[u]);break}break}}}function Ww(n,e,t){if(e===t)return!0;if(!e||!t)return!1;for(let i of n.fields){let s=i.localName,r=i.oneof?e[i.oneof][s]:e[s],a=i.oneof?t[i.oneof][s]:t[s];switch(i.kind){case"enum":case"scalar":let o=i.kind=="enum"?Ae.INT32:i.T;if(!(i.repeat?t_(o,r,a):Ny(o,r,a)))return!1;break;case"map":if(!(i.V.kind=="message"?n_(i.V.T(),vl(r),vl(a)):t_(i.V.kind=="enum"?Ae.INT32:i.V.T,vl(r),vl(a))))return!1;break;case"message":let l=i.T();if(!(i.repeat?n_(l,r,a):l.equals(r,a)))return!1;break}}return!0}const vl=Object.values;function Ny(n,e,t){if(e===t)return!0;if(n!==Ae.BYTES)return!1;let i=e,s=t;if(i.length!==s.length)return!1;for(let r=0;r<i.length;r++)if(i[r]!=s[r])return!1;return!0}function t_(n,e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!Ny(n,e[i],t[i]))return!1;return!0}function n_(n,e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!n.equals(e[i],t[i]))return!1;return!0}const jw=Object.getOwnPropertyDescriptors(Object.getPrototypeOf({}));class bt{constructor(e,t,i){this.defaultCheckDepth=16,this.typeName=e,this.fields=t.map(Ow),this.options=i??{},this.messagePrototype=Object.create(null,Object.assign(Object.assign({},jw),{[Py]:{value:this}})),this.refTypeCheck=new Fw(this),this.refJsonReader=new Bw(this),this.refJsonWriter=new Vw(this),this.refBinReader=new Gw(this),this.refBinWriter=new zw(this)}create(e){let t=Hw(this);return e!==void 0&&_t(this,t,e),t}clone(e){let t=this.create();return _t(this,t,e),t}equals(e,t){return Ww(this,e,t)}is(e,t=this.defaultCheckDepth){return this.refTypeCheck.is(e,t,!1)}isAssignable(e,t=this.defaultCheckDepth){return this.refTypeCheck.is(e,t,!0)}mergePartial(e,t){_t(this,e,t)}fromBinary(e,t){let i=Cw(t);return this.internalBinaryRead(i.readerFactory(e),e.byteLength,i)}fromJson(e,t){return this.internalJsonRead(e,Dw(t))}fromJsonString(e,t){let i=JSON.parse(e);return this.fromJson(i,t)}toJson(e,t){return this.internalJsonWrite(e,Lw(t))}toJsonString(e,t){var i;let s=this.toJson(e,t);return JSON.stringify(s,null,(i=t==null?void 0:t.prettySpaces)!==null&&i!==void 0?i:0)}toBinary(e,t){let i=Pw(t);return this.internalBinaryWrite(e,i.writerFactory(),i).finish()}internalJsonRead(e,t,i){if(e!==null&&typeof e=="object"&&!Array.isArray(e)){let s=i??this.create();return this.refJsonReader.read(e,s,t),s}throw new Error(`Unable to parse message ${this.typeName} from JSON ${Ry(e)}.`)}internalJsonWrite(e,t){return this.refJsonWriter.write(e,t)}internalBinaryWrite(e,t,i){return this.refBinWriter.write(e,t,i),t}internalBinaryRead(e,t,i,s){let r=s??this.create();return this.refBinReader.read(e,r,i,t),r}}var Mt=(n=>(n[n.Debug=0]="Debug",n[n.Info=1]="Info",n[n.Warning=2]="Warning",n[n.Error=3]="Error",n[n.Critical=4]="Critical",n[n.Console=5]="Console",n))(Mt||{}),ds=(n=>(n[n.depth_meters=0]="depth_meters",n[n.water_temp_celsius=1]="water_temp_celsius",n[n.pressure_mbar=2]="pressure_mbar",n[n.yaw_degrees=3]="yaw_degrees",n[n.pitch_degrees=4]="pitch_degrees",n[n.roll_degrees=5]="roll_degrees",n[n.x_acceleration_m_s2=6]="x_acceleration_m_s2",n[n.y_acceleration_m_s2=7]="y_acceleration_m_s2",n[n.z_acceleration_m_s2=8]="z_acceleration_m_s2",n[n.battery_voltage=9]="battery_voltage",n[n.battery_current_amps=10]="battery_current_amps",n[n.internal_temp_celsius=11]="internal_temp_celsius",n))(ds||{}),Dy=(n=>(n[n.LivekitReliable=0]="LivekitReliable",n[n.LivekitUnreliable=1]="LivekitUnreliable",n[n.DirectReliable=2]="DirectReliable",n[n.DirectUnreliable=3]="DirectUnreliable",n))(Dy||{}),Ly=(n=>(n[n.Nothing=0]="Nothing",n[n.RovConnected=1]="RovConnected",n[n.RovDisconnected=2]="RovDisconnected",n[n.UserConnected=3]="UserConnected",n[n.UserDisconnected=4]="UserDisconnected",n))(Ly||{});class Kw extends bt{constructor(){super("rov_actions_proto.VideoSenderStats",[{no:1,name:"encoderImplementation",kind:"scalar",opt:!0,T:9},{no:2,name:"powerEfficientEncoder",kind:"scalar",opt:!0,T:8},{no:3,name:"qualityLimitationReason",kind:"scalar",opt:!0,T:9},{no:4,name:"cpuLimitedQualityDurration",kind:"scalar",opt:!0,T:2},{no:5,name:"bandwidthLimitedQualityDurration",kind:"scalar",opt:!0,T:2},{no:6,name:"otherLimitedQualityDurration",kind:"scalar",opt:!0,T:2},{no:7,name:"noLimitedQualityDurration",kind:"scalar",opt:!0,T:2},{no:8,name:"totalPacketSendDelay",kind:"scalar",opt:!0,T:2},{no:9,name:"retransmittedBytesSent",kind:"scalar",opt:!0,T:2},{no:10,name:"scalabilityMode",kind:"scalar",opt:!0,T:9},{no:11,name:"qualityLimitationResolutionChanges",kind:"scalar",opt:!0,T:13},{no:12,name:"frameWidth",kind:"scalar",opt:!0,T:13},{no:13,name:"frameHeight",kind:"scalar",opt:!0,T:13},{no:14,name:"framesPerSecond",kind:"scalar",opt:!0,T:13},{no:16,name:"videoCodec",kind:"scalar",opt:!0,T:9},{no:15,name:"videoSdpFmtpLine",kind:"scalar",opt:!0,T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.encoderImplementation=e.string();break;case 2:r.powerEfficientEncoder=e.bool();break;case 3:r.qualityLimitationReason=e.string();break;case 4:r.cpuLimitedQualityDurration=e.float();break;case 5:r.bandwidthLimitedQualityDurration=e.float();break;case 6:r.otherLimitedQualityDurration=e.float();break;case 7:r.noLimitedQualityDurration=e.float();break;case 8:r.totalPacketSendDelay=e.float();break;case 9:r.retransmittedBytesSent=e.float();break;case 10:r.scalabilityMode=e.string();break;case 11:r.qualityLimitationResolutionChanges=e.uint32();break;case 12:r.frameWidth=e.uint32();break;case 13:r.frameHeight=e.uint32();break;case 14:r.framesPerSecond=e.uint32();break;case 16:r.videoCodec=e.string();break;case 15:r.videoSdpFmtpLine=e.string();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.encoderImplementation!==void 0&&t.tag(1,ne.LengthDelimited).string(e.encoderImplementation),e.powerEfficientEncoder!==void 0&&t.tag(2,ne.Varint).bool(e.powerEfficientEncoder),e.qualityLimitationReason!==void 0&&t.tag(3,ne.LengthDelimited).string(e.qualityLimitationReason),e.cpuLimitedQualityDurration!==void 0&&t.tag(4,ne.Bit32).float(e.cpuLimitedQualityDurration),e.bandwidthLimitedQualityDurration!==void 0&&t.tag(5,ne.Bit32).float(e.bandwidthLimitedQualityDurration),e.otherLimitedQualityDurration!==void 0&&t.tag(6,ne.Bit32).float(e.otherLimitedQualityDurration),e.noLimitedQualityDurration!==void 0&&t.tag(7,ne.Bit32).float(e.noLimitedQualityDurration),e.totalPacketSendDelay!==void 0&&t.tag(8,ne.Bit32).float(e.totalPacketSendDelay),e.retransmittedBytesSent!==void 0&&t.tag(9,ne.Bit32).float(e.retransmittedBytesSent),e.scalabilityMode!==void 0&&t.tag(10,ne.LengthDelimited).string(e.scalabilityMode),e.qualityLimitationResolutionChanges!==void 0&&t.tag(11,ne.Varint).uint32(e.qualityLimitationResolutionChanges),e.frameWidth!==void 0&&t.tag(12,ne.Varint).uint32(e.frameWidth),e.frameHeight!==void 0&&t.tag(13,ne.Varint).uint32(e.frameHeight),e.framesPerSecond!==void 0&&t.tag(14,ne.Varint).uint32(e.framesPerSecond),e.videoCodec!==void 0&&t.tag(16,ne.LengthDelimited).string(e.videoCodec),e.videoSdpFmtpLine!==void 0&&t.tag(15,ne.LengthDelimited).string(e.videoSdpFmtpLine);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const Xd=new Kw;class qw extends bt{constructor(){super("rov_actions_proto.VideoRecieverStats",[{no:1,name:"hung",kind:"scalar",opt:!0,T:8},{no:2,name:"frameWidth",kind:"scalar",opt:!0,T:13},{no:3,name:"frameHeight",kind:"scalar",opt:!0,T:13},{no:4,name:"framesPerSecond",kind:"scalar",opt:!0,T:13},{no:5,name:"currentRoundTripTime",kind:"scalar",opt:!0,T:2},{no:6,name:"jitterBufferDelay",kind:"scalar",opt:!0,T:2},{no:7,name:"jitter",kind:"scalar",opt:!0,T:2},{no:8,name:"nackCount",kind:"scalar",opt:!0,T:13},{no:9,name:"pliCount",kind:"scalar",opt:!0,T:13},{no:10,name:"freezeCount",kind:"scalar",opt:!0,T:13},{no:11,name:"totalFreezeTime",kind:"scalar",opt:!0,T:2},{no:12,name:"estimatedPlayoutDelay",kind:"scalar",opt:!0,T:2},{no:13,name:"videoCodec",kind:"scalar",opt:!0,T:9},{no:14,name:"videoSdpFmtpLine",kind:"scalar",opt:!0,T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.hung=e.bool();break;case 2:r.frameWidth=e.uint32();break;case 3:r.frameHeight=e.uint32();break;case 4:r.framesPerSecond=e.uint32();break;case 5:r.currentRoundTripTime=e.float();break;case 6:r.jitterBufferDelay=e.float();break;case 7:r.jitter=e.float();break;case 8:r.nackCount=e.uint32();break;case 9:r.pliCount=e.uint32();break;case 10:r.freezeCount=e.uint32();break;case 11:r.totalFreezeTime=e.float();break;case 12:r.estimatedPlayoutDelay=e.float();break;case 13:r.videoCodec=e.string();break;case 14:r.videoSdpFmtpLine=e.string();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.hung!==void 0&&t.tag(1,ne.Varint).bool(e.hung),e.frameWidth!==void 0&&t.tag(2,ne.Varint).uint32(e.frameWidth),e.frameHeight!==void 0&&t.tag(3,ne.Varint).uint32(e.frameHeight),e.framesPerSecond!==void 0&&t.tag(4,ne.Varint).uint32(e.framesPerSecond),e.currentRoundTripTime!==void 0&&t.tag(5,ne.Bit32).float(e.currentRoundTripTime),e.jitterBufferDelay!==void 0&&t.tag(6,ne.Bit32).float(e.jitterBufferDelay),e.jitter!==void 0&&t.tag(7,ne.Bit32).float(e.jitter),e.nackCount!==void 0&&t.tag(8,ne.Varint).uint32(e.nackCount),e.pliCount!==void 0&&t.tag(9,ne.Varint).uint32(e.pliCount),e.freezeCount!==void 0&&t.tag(10,ne.Varint).uint32(e.freezeCount),e.totalFreezeTime!==void 0&&t.tag(11,ne.Bit32).float(e.totalFreezeTime),e.estimatedPlayoutDelay!==void 0&&t.tag(12,ne.Bit32).float(e.estimatedPlayoutDelay),e.videoCodec!==void 0&&t.tag(13,ne.LengthDelimited).string(e.videoCodec),e.videoSdpFmtpLine!==void 0&&t.tag(14,ne.LengthDelimited).string(e.videoSdpFmtpLine);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const Yd=new qw;class Xw extends bt{constructor(){super("rov_actions_proto.VideoBaseStats",[{no:7,name:"bitrateReceive",kind:"scalar",T:13},{no:8,name:"bitrateSend",kind:"scalar",T:13},{no:9,name:"availableIncomingBitrate",kind:"scalar",T:13},{no:10,name:"availableOutgoingBitrate",kind:"scalar",T:13},{no:11,name:"senderLayerStats",kind:"message",repeat:1,T:()=>Xd},{no:12,name:"recieverStats",kind:"message",T:()=>Yd},{no:13,name:"rtcStatsJson",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.bitrateReceive=0,t.bitrateSend=0,t.availableIncomingBitrate=0,t.availableOutgoingBitrate=0,t.senderLayerStats=[],t.rtcStatsJson="",e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 7:r.bitrateReceive=e.uint32();break;case 8:r.bitrateSend=e.uint32();break;case 9:r.availableIncomingBitrate=e.uint32();break;case 10:r.availableOutgoingBitrate=e.uint32();break;case 11:r.senderLayerStats.push(Xd.internalBinaryRead(e,e.uint32(),i));break;case 12:r.recieverStats=Yd.internalBinaryRead(e,e.uint32(),i,r.recieverStats);break;case 13:r.rtcStatsJson=e.string();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.bitrateReceive!==0&&t.tag(7,ne.Varint).uint32(e.bitrateReceive),e.bitrateSend!==0&&t.tag(8,ne.Varint).uint32(e.bitrateSend),e.availableIncomingBitrate!==0&&t.tag(9,ne.Varint).uint32(e.availableIncomingBitrate),e.availableOutgoingBitrate!==0&&t.tag(10,ne.Varint).uint32(e.availableOutgoingBitrate);for(let r=0;r<e.senderLayerStats.length;r++)Xd.internalBinaryWrite(e.senderLayerStats[r],t.tag(11,ne.LengthDelimited).fork(),i).join();e.recieverStats&&Yd.internalBinaryWrite(e.recieverStats,t.tag(12,ne.LengthDelimited).fork(),i).join(),e.rtcStatsJson!==""&&t.tag(13,ne.LengthDelimited).string(e.rtcStatsJson);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const bo=new Xw;class Yw extends bt{constructor(){super("rov_actions_proto.VideoStreamOptions",[{no:1,name:"Height",kind:"scalar",jsonName:"Height",T:13},{no:2,name:"Width",kind:"scalar",jsonName:"Width",T:13},{no:3,name:"Fps",kind:"scalar",jsonName:"Fps",T:13},{no:4,name:"MaxBitrate",kind:"scalar",jsonName:"MaxBitrate",T:13}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.height=0,t.width=0,t.fps=0,t.maxBitrate=0,e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.height=e.uint32();break;case 2:r.width=e.uint32();break;case 3:r.fps=e.uint32();break;case 4:r.maxBitrate=e.uint32();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.height!==0&&t.tag(1,ne.Varint).uint32(e.height),e.width!==0&&t.tag(2,ne.Varint).uint32(e.width),e.fps!==0&&t.tag(3,ne.Varint).uint32(e.fps),e.maxBitrate!==0&&t.tag(4,ne.Varint).uint32(e.maxBitrate);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const $n=new Yw;class Jw extends bt{constructor(){super("rov_actions_proto.SetLivekitVideoOptionsAction",[{no:1,name:"Enabled",kind:"scalar",jsonName:"Enabled",T:8},{no:2,name:"Codec",kind:"scalar",jsonName:"Codec",T:9},{no:3,name:"AllowBackupCodec",kind:"scalar",jsonName:"AllowBackupCodec",T:8},{no:4,name:"BaseStream",kind:"message",jsonName:"BaseStream",T:()=>$n},{no:5,name:"SimulcastLayers",kind:"message",jsonName:"SimulcastLayers",repeat:1,T:()=>$n}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.enabled=!1,t.codec="",t.allowBackupCodec=!1,t.simulcastLayers=[],e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.enabled=e.bool();break;case 2:r.codec=e.string();break;case 3:r.allowBackupCodec=e.bool();break;case 4:r.baseStream=$n.internalBinaryRead(e,e.uint32(),i,r.baseStream);break;case 5:r.simulcastLayers.push($n.internalBinaryRead(e,e.uint32(),i));break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.enabled!==!1&&t.tag(1,ne.Varint).bool(e.enabled),e.codec!==""&&t.tag(2,ne.LengthDelimited).string(e.codec),e.allowBackupCodec!==!1&&t.tag(3,ne.Varint).bool(e.allowBackupCodec),e.baseStream&&$n.internalBinaryWrite(e.baseStream,t.tag(4,ne.LengthDelimited).fork(),i).join();for(let r=0;r<e.simulcastLayers.length;r++)$n.internalBinaryWrite(e.simulcastLayers[r],t.tag(5,ne.LengthDelimited).fork(),i).join();let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const Jd=new Jw;class Qw extends bt{constructor(){super("rov_actions_proto.SetSimplePeerVideoOptionsAction",[{no:1,name:"Enabled",kind:"scalar",jsonName:"Enabled",T:8},{no:2,name:"Bitrate",kind:"scalar",jsonName:"Bitrate",T:13},{no:3,name:"Codec",kind:"scalar",jsonName:"Codec",T:9},{no:4,name:"BaseStream",kind:"message",jsonName:"BaseStream",T:()=>$n}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.enabled=!1,t.bitrate=0,t.codec="",e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.enabled=e.bool();break;case 2:r.bitrate=e.uint32();break;case 3:r.codec=e.string();break;case 4:r.baseStream=$n.internalBinaryRead(e,e.uint32(),i,r.baseStream);break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.enabled!==!1&&t.tag(1,ne.Varint).bool(e.enabled),e.bitrate!==0&&t.tag(2,ne.Varint).uint32(e.bitrate),e.codec!==""&&t.tag(3,ne.LengthDelimited).string(e.codec),e.baseStream&&$n.internalBinaryWrite(e.baseStream,t.tag(4,ne.LengthDelimited).fork(),i).join();let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const Qd=new Qw;class Zw extends bt{constructor(){super("rov_actions_proto.PingAction",[{no:1,name:"Time",kind:"scalar",jsonName:"Time",T:3,L:2}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.time=0,e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.time=e.int64().toNumber();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.time!==0&&t.tag(1,ne.Varint).int64(e.time);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const Zd=new Zw;class $w extends bt{constructor(){super("rov_actions_proto.PasswordAttemptAction",[{no:1,name:"Password",kind:"scalar",jsonName:"Password",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.password="",e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.password=e.string();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.password!==""&&t.tag(1,ne.LengthDelimited).string(e.password);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const $d=new $w;class eR extends bt{constructor(){super("rov_actions_proto.AuthTokenAttemptAction",[{no:1,name:"Token",kind:"scalar",jsonName:"Token",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.token="",e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.token=e.string();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.token!==""&&t.tag(1,ne.LengthDelimited).string(e.token);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const eh=new eR;class tR extends bt{constructor(){super("rov_actions_proto.TakeControlAction",[])}create(e){const t=globalThis.Object.create(this.messagePrototype);return e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){return s??this.create()}internalBinaryWrite(e,t,i){let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const th=new tR;class nR extends bt{constructor(){super("rov_actions_proto.MoveAction",[{no:1,name:"velocityX",kind:"scalar",T:2},{no:2,name:"velocityY",kind:"scalar",T:2},{no:3,name:"velocityZ",kind:"scalar",T:2},{no:4,name:"angularVelocityYaw",kind:"scalar",T:2},{no:5,name:"ButtonBitmask",kind:"scalar",jsonName:"ButtonBitmask",T:5}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.velocityX=0,t.velocityY=0,t.velocityZ=0,t.angularVelocityYaw=0,t.buttonBitmask=0,e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.velocityX=e.float();break;case 2:r.velocityY=e.float();break;case 3:r.velocityZ=e.float();break;case 4:r.angularVelocityYaw=e.float();break;case 5:r.buttonBitmask=e.int32();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.velocityX!==0&&t.tag(1,ne.Bit32).float(e.velocityX),e.velocityY!==0&&t.tag(2,ne.Bit32).float(e.velocityY),e.velocityZ!==0&&t.tag(3,ne.Bit32).float(e.velocityZ),e.angularVelocityYaw!==0&&t.tag(4,ne.Bit32).float(e.angularVelocityYaw),e.buttonBitmask!==0&&t.tag(5,ne.Varint).int32(e.buttonBitmask);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const nh=new nR;class iR extends bt{constructor(){super("rov_actions_proto.TakePhotoAction",[])}create(e){const t=globalThis.Object.create(this.messagePrototype);return e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){return s??this.create()}internalBinaryWrite(e,t,i){let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const ih=new iR;class sR extends bt{constructor(){super("rov_actions_proto.StartVideoRecAction",[])}create(e){const t=globalThis.Object.create(this.messagePrototype);return e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){return s??this.create()}internalBinaryWrite(e,t,i){let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const sh=new sR;class rR extends bt{constructor(){super("rov_actions_proto.StopVideoRecAction",[])}create(e){const t=globalThis.Object.create(this.messagePrototype);return e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){return s??this.create()}internalBinaryWrite(e,t,i){let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const rh=new rR;class aR extends bt{constructor(){super("rov_actions_proto.ToggleLightsAction",[])}create(e){const t=globalThis.Object.create(this.messagePrototype);return e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){return s??this.create()}internalBinaryWrite(e,t,i){let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const ah=new aR;class oR extends bt{constructor(){super("rov_actions_proto.ShutdownRovAction",[])}create(e){const t=globalThis.Object.create(this.messagePrototype);return e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){return s??this.create()}internalBinaryWrite(e,t,i){let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const oh=new oR;class cR extends bt{constructor(){super("rov_actions_proto.RebootRovAction",[])}create(e){const t=globalThis.Object.create(this.messagePrototype);return e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){return s??this.create()}internalBinaryWrite(e,t,i){let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const ch=new cR;class lR extends bt{constructor(){super("rov_actions_proto.EnableWifiAction",[])}create(e){const t=globalThis.Object.create(this.messagePrototype);return e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){return s??this.create()}internalBinaryWrite(e,t,i){let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const lh=new lR;class uR extends bt{constructor(){super("rov_actions_proto.DisableWifiAction",[])}create(e){const t=globalThis.Object.create(this.messagePrototype);return e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){return s??this.create()}internalBinaryWrite(e,t,i){let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const uh=new uR;class dR extends bt{constructor(){super("rov_actions_proto.RovStatusReportAction",[])}create(e){const t=globalThis.Object.create(this.messagePrototype);return e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){return s??this.create()}internalBinaryWrite(e,t,i){let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const dh=new dR;class hR extends bt{constructor(){super("rov_actions_proto.RestartRovServicesAction",[])}create(e){const t=globalThis.Object.create(this.messagePrototype);return e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){return s??this.create()}internalBinaryWrite(e,t,i){let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const hh=new hR;class fR extends bt{constructor(){super("rov_actions_proto.SendRovLogsAction",[])}create(e){const t=globalThis.Object.create(this.messagePrototype);return e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){return s??this.create()}internalBinaryWrite(e,t,i){let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const fh=new fR;class pR extends bt{constructor(){super("rov_actions_proto.RefreshAllSensorsAction",[])}create(e){const t=globalThis.Object.create(this.messagePrototype);return e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){return s??this.create()}internalBinaryWrite(e,t,i){let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const ph=new pR;class mR extends bt{constructor(){super("rov_actions_proto.MoveClawAction",[{no:1,name:"Value",kind:"scalar",jsonName:"Value",T:2}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.value=0,e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.value=e.float();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.value!==0&&t.tag(1,ne.Bit32).float(e.value);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const mh=new mR;class gR extends bt{constructor(){super("rov_actions_proto.SimplePeerSignalAction",[{no:1,name:"Message",kind:"scalar",jsonName:"Message",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.message="",e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.message=e.string();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.message!==""&&t.tag(1,ne.LengthDelimited).string(e.message);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const gh=new gR;class _R extends bt{constructor(){super("rov_actions_proto.DisarmAction",[])}create(e){const t=globalThis.Object.create(this.messagePrototype);return e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){return s??this.create()}internalBinaryWrite(e,t,i){let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const _h=new _R;class vR extends bt{constructor(){super("rov_actions_proto.SetAutopilotModeAction",[{no:1,name:"mode",kind:"scalar",T:5}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.mode=0,e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.mode=e.int32();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.mode!==0&&t.tag(1,ne.Varint).int32(e.mode);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const vh=new vR;class bR extends bt{constructor(){super("rov_actions_proto.SetLivestreamingEnabledAction",[{no:1,name:"Enabled",kind:"scalar",jsonName:"Enabled",T:8}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.enabled=!1,e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.enabled=e.bool();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.enabled!==!1&&t.tag(1,ne.Varint).bool(e.enabled);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const bh=new bR;class yR extends bt{constructor(){super("rov_actions_proto.ActionBackendMetadata",[{no:1,name:"FromUserId",kind:"scalar",jsonName:"FromUserId",T:9},{no:2,name:"InternalWebpageEvt",kind:"enum",jsonName:"InternalWebpageEvt",T:()=>["rov_actions_proto.InternalWebpageEvent",Ly]}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.fromUserId="",t.internalWebpageEvt=0,e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.fromUserId=e.string();break;case 2:r.internalWebpageEvt=e.int32();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.fromUserId!==""&&t.tag(1,ne.LengthDelimited).string(e.fromUserId),e.internalWebpageEvt!==0&&t.tag(2,ne.Varint).int32(e.internalWebpageEvt);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}new yR;class TR extends bt{constructor(){super("rov_actions_proto.RovAction",[{no:2,name:"ExchangeId",kind:"scalar",jsonName:"ExchangeId",T:5},{no:3,name:"Ping",kind:"message",jsonName:"Ping",oneof:"body",T:()=>Zd},{no:4,name:"PasswordAttempt",kind:"message",jsonName:"PasswordAttempt",oneof:"body",T:()=>$d},{no:5,name:"AuthTokenAttempt",kind:"message",jsonName:"AuthTokenAttempt",oneof:"body",T:()=>eh},{no:6,name:"TakeControl",kind:"message",jsonName:"TakeControl",oneof:"body",T:()=>th},{no:7,name:"Move",kind:"message",jsonName:"Move",oneof:"body",T:()=>nh},{no:9,name:"TakePhoto",kind:"message",jsonName:"TakePhoto",oneof:"body",T:()=>ih},{no:10,name:"StartVideoRec",kind:"message",jsonName:"StartVideoRec",oneof:"body",T:()=>sh},{no:11,name:"StopVideoRec",kind:"message",jsonName:"StopVideoRec",oneof:"body",T:()=>rh},{no:12,name:"ToggleLights",kind:"message",jsonName:"ToggleLights",oneof:"body",T:()=>ah},{no:13,name:"ShutdownRov",kind:"message",jsonName:"ShutdownRov",oneof:"body",T:()=>oh},{no:14,name:"RebootRov",kind:"message",jsonName:"RebootRov",oneof:"body",T:()=>ch},{no:15,name:"EnableWifi",kind:"message",jsonName:"EnableWifi",oneof:"body",T:()=>lh},{no:16,name:"DisableWifi",kind:"message",jsonName:"DisableWifi",oneof:"body",T:()=>uh},{no:17,name:"RovStatusReport",kind:"message",jsonName:"RovStatusReport",oneof:"body",T:()=>dh},{no:18,name:"RestartRovServices",kind:"message",jsonName:"RestartRovServices",oneof:"body",T:()=>hh},{no:19,name:"SendRovLogs",kind:"message",jsonName:"SendRovLogs",oneof:"body",T:()=>fh},{no:20,name:"RefreshAllSensors",kind:"message",jsonName:"RefreshAllSensors",oneof:"body",T:()=>ph},{no:21,name:"MoveClaw",kind:"message",jsonName:"MoveClaw",oneof:"body",T:()=>mh},{no:22,name:"SimplePeerSignal",kind:"message",jsonName:"SimplePeerSignal",oneof:"body",T:()=>gh},{no:23,name:"Disarm",kind:"message",jsonName:"Disarm",oneof:"body",T:()=>_h},{no:24,name:"SetAutopilotMode",kind:"message",jsonName:"SetAutopilotMode",oneof:"body",T:()=>vh},{no:25,name:"SetLivekitVideoOptions",kind:"message",jsonName:"SetLivekitVideoOptions",oneof:"body",T:()=>Jd},{no:26,name:"SetSimplePeerVideoOptions",kind:"message",jsonName:"SetSimplePeerVideoOptions",oneof:"body",T:()=>Qd},{no:27,name:"SetLivestreamingEnabled",kind:"message",jsonName:"SetLivestreamingEnabled",oneof:"body",T:()=>bh}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.exchangeId=0,t.body={oneofKind:void 0},e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 2:r.exchangeId=e.int32();break;case 3:r.body={oneofKind:"ping",ping:Zd.internalBinaryRead(e,e.uint32(),i,r.body.ping)};break;case 4:r.body={oneofKind:"passwordAttempt",passwordAttempt:$d.internalBinaryRead(e,e.uint32(),i,r.body.passwordAttempt)};break;case 5:r.body={oneofKind:"authTokenAttempt",authTokenAttempt:eh.internalBinaryRead(e,e.uint32(),i,r.body.authTokenAttempt)};break;case 6:r.body={oneofKind:"takeControl",takeControl:th.internalBinaryRead(e,e.uint32(),i,r.body.takeControl)};break;case 7:r.body={oneofKind:"move",move:nh.internalBinaryRead(e,e.uint32(),i,r.body.move)};break;case 9:r.body={oneofKind:"takePhoto",takePhoto:ih.internalBinaryRead(e,e.uint32(),i,r.body.takePhoto)};break;case 10:r.body={oneofKind:"startVideoRec",startVideoRec:sh.internalBinaryRead(e,e.uint32(),i,r.body.startVideoRec)};break;case 11:r.body={oneofKind:"stopVideoRec",stopVideoRec:rh.internalBinaryRead(e,e.uint32(),i,r.body.stopVideoRec)};break;case 12:r.body={oneofKind:"toggleLights",toggleLights:ah.internalBinaryRead(e,e.uint32(),i,r.body.toggleLights)};break;case 13:r.body={oneofKind:"shutdownRov",shutdownRov:oh.internalBinaryRead(e,e.uint32(),i,r.body.shutdownRov)};break;case 14:r.body={oneofKind:"rebootRov",rebootRov:ch.internalBinaryRead(e,e.uint32(),i,r.body.rebootRov)};break;case 15:r.body={oneofKind:"enableWifi",enableWifi:lh.internalBinaryRead(e,e.uint32(),i,r.body.enableWifi)};break;case 16:r.body={oneofKind:"disableWifi",disableWifi:uh.internalBinaryRead(e,e.uint32(),i,r.body.disableWifi)};break;case 17:r.body={oneofKind:"rovStatusReport",rovStatusReport:dh.internalBinaryRead(e,e.uint32(),i,r.body.rovStatusReport)};break;case 18:r.body={oneofKind:"restartRovServices",restartRovServices:hh.internalBinaryRead(e,e.uint32(),i,r.body.restartRovServices)};break;case 19:r.body={oneofKind:"sendRovLogs",sendRovLogs:fh.internalBinaryRead(e,e.uint32(),i,r.body.sendRovLogs)};break;case 20:r.body={oneofKind:"refreshAllSensors",refreshAllSensors:ph.internalBinaryRead(e,e.uint32(),i,r.body.refreshAllSensors)};break;case 21:r.body={oneofKind:"moveClaw",moveClaw:mh.internalBinaryRead(e,e.uint32(),i,r.body.moveClaw)};break;case 22:r.body={oneofKind:"simplePeerSignal",simplePeerSignal:gh.internalBinaryRead(e,e.uint32(),i,r.body.simplePeerSignal)};break;case 23:r.body={oneofKind:"disarm",disarm:_h.internalBinaryRead(e,e.uint32(),i,r.body.disarm)};break;case 24:r.body={oneofKind:"setAutopilotMode",setAutopilotMode:vh.internalBinaryRead(e,e.uint32(),i,r.body.setAutopilotMode)};break;case 25:r.body={oneofKind:"setLivekitVideoOptions",setLivekitVideoOptions:Jd.internalBinaryRead(e,e.uint32(),i,r.body.setLivekitVideoOptions)};break;case 26:r.body={oneofKind:"setSimplePeerVideoOptions",setSimplePeerVideoOptions:Qd.internalBinaryRead(e,e.uint32(),i,r.body.setSimplePeerVideoOptions)};break;case 27:r.body={oneofKind:"setLivestreamingEnabled",setLivestreamingEnabled:bh.internalBinaryRead(e,e.uint32(),i,r.body.setLivestreamingEnabled)};break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.exchangeId!==0&&t.tag(2,ne.Varint).int32(e.exchangeId),e.body.oneofKind==="ping"&&Zd.internalBinaryWrite(e.body.ping,t.tag(3,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="passwordAttempt"&&$d.internalBinaryWrite(e.body.passwordAttempt,t.tag(4,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="authTokenAttempt"&&eh.internalBinaryWrite(e.body.authTokenAttempt,t.tag(5,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="takeControl"&&th.internalBinaryWrite(e.body.takeControl,t.tag(6,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="move"&&nh.internalBinaryWrite(e.body.move,t.tag(7,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="takePhoto"&&ih.internalBinaryWrite(e.body.takePhoto,t.tag(9,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="startVideoRec"&&sh.internalBinaryWrite(e.body.startVideoRec,t.tag(10,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="stopVideoRec"&&rh.internalBinaryWrite(e.body.stopVideoRec,t.tag(11,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="toggleLights"&&ah.internalBinaryWrite(e.body.toggleLights,t.tag(12,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="shutdownRov"&&oh.internalBinaryWrite(e.body.shutdownRov,t.tag(13,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="rebootRov"&&ch.internalBinaryWrite(e.body.rebootRov,t.tag(14,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="enableWifi"&&lh.internalBinaryWrite(e.body.enableWifi,t.tag(15,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="disableWifi"&&uh.internalBinaryWrite(e.body.disableWifi,t.tag(16,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="rovStatusReport"&&dh.internalBinaryWrite(e.body.rovStatusReport,t.tag(17,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="restartRovServices"&&hh.internalBinaryWrite(e.body.restartRovServices,t.tag(18,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="sendRovLogs"&&fh.internalBinaryWrite(e.body.sendRovLogs,t.tag(19,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="refreshAllSensors"&&ph.internalBinaryWrite(e.body.refreshAllSensors,t.tag(20,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="moveClaw"&&mh.internalBinaryWrite(e.body.moveClaw,t.tag(21,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="simplePeerSignal"&&gh.internalBinaryWrite(e.body.simplePeerSignal,t.tag(22,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="disarm"&&_h.internalBinaryWrite(e.body.disarm,t.tag(23,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="setAutopilotMode"&&vh.internalBinaryWrite(e.body.setAutopilotMode,t.tag(24,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="setLivekitVideoOptions"&&Jd.internalBinaryWrite(e.body.setLivekitVideoOptions,t.tag(25,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="setSimplePeerVideoOptions"&&Qd.internalBinaryWrite(e.body.setSimplePeerVideoOptions,t.tag(26,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="setLivestreamingEnabled"&&bh.internalBinaryWrite(e.body.setLivestreamingEnabled,t.tag(27,ne.LengthDelimited).fork(),i).join();let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const wn=new TR;class SR extends bt{constructor(){super("rov_actions_proto.DoneResponse",[{no:1,name:"Message",kind:"scalar",jsonName:"Message",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.message="",e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.message=e.string();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.message!==""&&t.tag(1,ne.LengthDelimited).string(e.message);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const yh=new SR;class ER extends bt{constructor(){super("rov_actions_proto.ErrorResponse",[{no:1,name:"Message",kind:"scalar",jsonName:"Message",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.message="",e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.message=e.string();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.message!==""&&t.tag(1,ne.LengthDelimited).string(e.message);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const Th=new ER;class AR extends bt{constructor(){super("rov_actions_proto.PongResponse",[{no:1,name:"Time",kind:"scalar",jsonName:"Time",T:3,L:2}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.time=0,e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.time=e.int64().toNumber();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.time!==0&&t.tag(1,ne.Varint).int64(e.time);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const Sh=new AR;class CR extends bt{constructor(){super("rov_actions_proto.Measurement",[{no:1,name:"MeasurementType",kind:"enum",jsonName:"MeasurementType",T:()=>["rov_actions_proto.SensorMeasurmentTypes",ds]},{no:2,name:"Value",kind:"scalar",jsonName:"Value",T:2}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.measurementType=0,t.value=0,e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.measurementType=e.int32();break;case 2:r.value=e.float();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.measurementType!==0&&t.tag(1,ne.Varint).int32(e.measurementType),e.value!==0&&t.tag(2,ne.Bit32).float(e.value);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const Eh=new CR;class wR extends bt{constructor(){super("rov_actions_proto.SensorUpdatesResponse",[{no:1,name:"MeasurementUpdates",kind:"message",jsonName:"MeasurementUpdates",repeat:1,T:()=>Eh}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.measurementUpdates=[],e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.measurementUpdates.push(Eh.internalBinaryRead(e,e.uint32(),i));break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){for(let r=0;r<e.measurementUpdates.length;r++)Eh.internalBinaryWrite(e.measurementUpdates[r],t.tag(1,ne.LengthDelimited).fork(),i).join();let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const Ah=new wR;class RR extends bt{constructor(){super("rov_actions_proto.PasswordRequiredResponse",[{no:1,name:"RovId",kind:"scalar",jsonName:"RovId",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.rovId="",e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.rovId=e.string();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.rovId!==""&&t.tag(1,ne.LengthDelimited).string(e.rovId);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const Ch=new RR;class kR extends bt{constructor(){super("rov_actions_proto.PasswordAcceptedResponse",[{no:1,name:"AuthToken",kind:"scalar",jsonName:"AuthToken",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.authToken="",e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.authToken=e.string();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.authToken!==""&&t.tag(1,ne.LengthDelimited).string(e.authToken);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const wh=new kR;class MR extends bt{constructor(){super("rov_actions_proto.PasswordInvalidResponse",[])}create(e){const t=globalThis.Object.create(this.messagePrototype);return e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){return s??this.create()}internalBinaryWrite(e,t,i){let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const Rh=new MR;class xR extends bt{constructor(){super("rov_actions_proto.PilotChangedResponse",[{no:1,name:"PilotIdentity",kind:"scalar",jsonName:"PilotIdentity",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.pilotIdentity="",e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.pilotIdentity=e.string();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.pilotIdentity!==""&&t.tag(1,ne.LengthDelimited).string(e.pilotIdentity);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const kh=new xR;class IR extends bt{constructor(){super("rov_actions_proto.ClientConnectedResponse",[{no:1,name:"ClientPeerId",kind:"scalar",jsonName:"ClientPeerId",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.clientPeerId="",e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.clientPeerId=e.string();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.clientPeerId!==""&&t.tag(1,ne.LengthDelimited).string(e.clientPeerId);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const Mh=new IR;class PR extends bt{constructor(){super("rov_actions_proto.ClientDisconnectedResponse",[{no:1,name:"ClientPeerId",kind:"scalar",jsonName:"ClientPeerId",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.clientPeerId="",e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.clientPeerId=e.string();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.clientPeerId!==""&&t.tag(1,ne.LengthDelimited).string(e.clientPeerId);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const xh=new PR;class NR extends bt{constructor(){super("rov_actions_proto.ArmingResponse",[{no:1,name:"armed",kind:"scalar",T:8}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.armed=!1,e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.armed=e.bool();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.armed!==!1&&t.tag(1,ne.Varint).bool(e.armed);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const Ih=new NR;class DR extends bt{constructor(){super("rov_actions_proto.ContinuedOutputResponse",[{no:1,name:"Message",kind:"scalar",jsonName:"Message",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.message="",e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.message=e.string();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.message!==""&&t.tag(1,ne.LengthDelimited).string(e.message);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const Ph=new DR;class LR extends bt{constructor(){super("rov_actions_proto.MavlinkResponse",[{no:1,name:"Message",kind:"scalar",jsonName:"Message",T:12}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.message=new Uint8Array(0),e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.message=e.bytes();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.message.length&&t.tag(1,ne.LengthDelimited).bytes(e.message);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const Nh=new LR;class OR extends bt{constructor(){super("rov_actions_proto.SimplePeerSignalResponse",[{no:1,name:"Message",kind:"scalar",jsonName:"Message",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.message="",e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.message=e.string();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.message!==""&&t.tag(1,ne.LengthDelimited).string(e.message);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const Dh=new OR;class UR extends bt{constructor(){super("rov_actions_proto.SystemMonitorResponse",[{no:1,name:"CpuTemp",kind:"scalar",jsonName:"CpuTemp",T:2},{no:2,name:"CpuUsage",kind:"scalar",jsonName:"CpuUsage",T:2},{no:3,name:"MemoryUsage",kind:"scalar",jsonName:"MemoryUsage",T:2},{no:4,name:"DiskUsage",kind:"scalar",jsonName:"DiskUsage",T:2},{no:5,name:"Warnings",kind:"scalar",jsonName:"Warnings",repeat:2,T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.cpuTemp=0,t.cpuUsage=0,t.memoryUsage=0,t.diskUsage=0,t.warnings=[],e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.cpuTemp=e.float();break;case 2:r.cpuUsage=e.float();break;case 3:r.memoryUsage=e.float();break;case 4:r.diskUsage=e.float();break;case 5:r.warnings.push(e.string());break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.cpuTemp!==0&&t.tag(1,ne.Bit32).float(e.cpuTemp),e.cpuUsage!==0&&t.tag(2,ne.Bit32).float(e.cpuUsage),e.memoryUsage!==0&&t.tag(3,ne.Bit32).float(e.memoryUsage),e.diskUsage!==0&&t.tag(4,ne.Bit32).float(e.diskUsage);for(let r=0;r<e.warnings.length;r++)t.tag(5,ne.LengthDelimited).string(e.warnings[r]);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const Lh=new UR;class FR extends bt{constructor(){super("rov_actions_proto.LogMessageResponse",[{no:1,name:"Message",kind:"scalar",jsonName:"Message",T:9},{no:2,name:"Level",kind:"enum",jsonName:"Level",T:()=>["rov_actions_proto.LogLevel",Mt]}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.message="",t.level=0,e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.message=e.string();break;case 2:r.level=e.int32();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.message!==""&&t.tag(1,ne.LengthDelimited).string(e.message),e.level!==0&&t.tag(2,ne.Varint).int32(e.level);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const Oh=new FR;class BR extends bt{constructor(){super("rov_actions_proto.LivekitVideoStatsResponse",[{no:1,name:"enabled",kind:"scalar",T:8},{no:2,name:"codec",kind:"scalar",T:9},{no:3,name:"allowBackupCodec",kind:"scalar",T:8},{no:4,name:"baseStream",kind:"message",T:()=>$n},{no:5,name:"simulcastLayers",kind:"message",repeat:1,T:()=>$n},{no:6,name:"stats",kind:"message",T:()=>bo}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.enabled=!1,t.codec="",t.allowBackupCodec=!1,t.simulcastLayers=[],e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.enabled=e.bool();break;case 2:r.codec=e.string();break;case 3:r.allowBackupCodec=e.bool();break;case 4:r.baseStream=$n.internalBinaryRead(e,e.uint32(),i,r.baseStream);break;case 5:r.simulcastLayers.push($n.internalBinaryRead(e,e.uint32(),i));break;case 6:r.stats=bo.internalBinaryRead(e,e.uint32(),i,r.stats);break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.enabled!==!1&&t.tag(1,ne.Varint).bool(e.enabled),e.codec!==""&&t.tag(2,ne.LengthDelimited).string(e.codec),e.allowBackupCodec!==!1&&t.tag(3,ne.Varint).bool(e.allowBackupCodec),e.baseStream&&$n.internalBinaryWrite(e.baseStream,t.tag(4,ne.LengthDelimited).fork(),i).join();for(let r=0;r<e.simulcastLayers.length;r++)$n.internalBinaryWrite(e.simulcastLayers[r],t.tag(5,ne.LengthDelimited).fork(),i).join();e.stats&&bo.internalBinaryWrite(e.stats,t.tag(6,ne.LengthDelimited).fork(),i).join();let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const Uh=new BR;class VR extends bt{constructor(){super("rov_actions_proto.SimplePeerVideoStatsResponse",[{no:1,name:"enabled",kind:"scalar",T:8},{no:2,name:"codec",kind:"scalar",T:9},{no:3,name:"baseStream",kind:"message",T:()=>$n},{no:4,name:"stats",kind:"message",T:()=>bo}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.enabled=!1,t.codec="",e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.enabled=e.bool();break;case 2:r.codec=e.string();break;case 3:r.baseStream=$n.internalBinaryRead(e,e.uint32(),i,r.baseStream);break;case 4:r.stats=bo.internalBinaryRead(e,e.uint32(),i,r.stats);break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.enabled!==!1&&t.tag(1,ne.Varint).bool(e.enabled),e.codec!==""&&t.tag(2,ne.LengthDelimited).string(e.codec),e.baseStream&&$n.internalBinaryWrite(e.baseStream,t.tag(3,ne.LengthDelimited).fork(),i).join(),e.stats&&bo.internalBinaryWrite(e.stats,t.tag(4,ne.LengthDelimited).fork(),i).join();let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const Fh=new VR;class GR extends bt{constructor(){super("rov_actions_proto.HearbeatResponse",[])}create(e){const t=globalThis.Object.create(this.messagePrototype);return e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){return s??this.create()}internalBinaryWrite(e,t,i){let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const Bh=new GR;class zR extends bt{constructor(){super("rov_actions_proto.ResponseBackendMetadata",[{no:1,name:"TargetUserIds",kind:"scalar",jsonName:"TargetUserIds",repeat:2,T:9},{no:2,name:"TransportMethod",kind:"enum",jsonName:"TransportMethod",T:()=>["rov_actions_proto.DataTransportMethod",Dy]}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.targetUserIds=[],t.transportMethod=0,e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 1:r.targetUserIds.push(e.string());break;case 2:r.transportMethod=e.int32();break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){for(let r=0;r<e.targetUserIds.length;r++)t.tag(1,ne.LengthDelimited).string(e.targetUserIds[r]);e.transportMethod!==0&&t.tag(2,ne.Varint).int32(e.transportMethod);let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}new zR;class HR extends bt{constructor(){super("rov_actions_proto.RovResponse",[{no:2,name:"ExchangeId",kind:"scalar",jsonName:"ExchangeId",opt:!0,T:5},{no:3,name:"Done",kind:"message",jsonName:"Done",oneof:"body",T:()=>yh},{no:4,name:"Error",kind:"message",jsonName:"Error",oneof:"body",T:()=>Th},{no:5,name:"Pong",kind:"message",jsonName:"Pong",oneof:"body",T:()=>Sh},{no:6,name:"ContinuedOutput",kind:"message",jsonName:"ContinuedOutput",oneof:"body",T:()=>Ph},{no:7,name:"SensorUpdates",kind:"message",jsonName:"SensorUpdates",oneof:"body",T:()=>Ah},{no:8,name:"PasswordRequired",kind:"message",jsonName:"PasswordRequired",oneof:"body",T:()=>Ch},{no:9,name:"PasswordAccepted",kind:"message",jsonName:"PasswordAccepted",oneof:"body",T:()=>wh},{no:10,name:"PasswordInvalid",kind:"message",jsonName:"PasswordInvalid",oneof:"body",T:()=>Rh},{no:13,name:"PilotChanged",kind:"message",jsonName:"PilotChanged",oneof:"body",T:()=>kh},{no:14,name:"ClientConnected",kind:"message",jsonName:"ClientConnected",oneof:"body",T:()=>Mh},{no:15,name:"ClientDisconnected",kind:"message",jsonName:"ClientDisconnected",oneof:"body",T:()=>xh},{no:16,name:"arming",kind:"message",oneof:"body",T:()=>Ih},{no:17,name:"Mavlink",kind:"message",jsonName:"Mavlink",oneof:"body",T:()=>Nh},{no:18,name:"SimplePeerSignal",kind:"message",jsonName:"SimplePeerSignal",oneof:"body",T:()=>Dh},{no:19,name:"SystemMonitor",kind:"message",jsonName:"SystemMonitor",oneof:"body",T:()=>Lh},{no:20,name:"LogMessage",kind:"message",jsonName:"LogMessage",oneof:"body",T:()=>Oh},{no:21,name:"LivekitVideoStats",kind:"message",jsonName:"LivekitVideoStats",oneof:"body",T:()=>Uh},{no:22,name:"SimplePeerVideoStats",kind:"message",jsonName:"SimplePeerVideoStats",oneof:"body",T:()=>Fh},{no:23,name:"Heartbeat",kind:"message",jsonName:"Heartbeat",oneof:"body",T:()=>Bh}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.body={oneofKind:void 0},e!==void 0&&_t(this,t,e),t}internalBinaryRead(e,t,i,s){let r=s??this.create(),a=e.pos+t;for(;e.pos<a;){let[o,l]=e.tag();switch(o){case 2:r.exchangeId=e.int32();break;case 3:r.body={oneofKind:"done",done:yh.internalBinaryRead(e,e.uint32(),i,r.body.done)};break;case 4:r.body={oneofKind:"error",error:Th.internalBinaryRead(e,e.uint32(),i,r.body.error)};break;case 5:r.body={oneofKind:"pong",pong:Sh.internalBinaryRead(e,e.uint32(),i,r.body.pong)};break;case 6:r.body={oneofKind:"continuedOutput",continuedOutput:Ph.internalBinaryRead(e,e.uint32(),i,r.body.continuedOutput)};break;case 7:r.body={oneofKind:"sensorUpdates",sensorUpdates:Ah.internalBinaryRead(e,e.uint32(),i,r.body.sensorUpdates)};break;case 8:r.body={oneofKind:"passwordRequired",passwordRequired:Ch.internalBinaryRead(e,e.uint32(),i,r.body.passwordRequired)};break;case 9:r.body={oneofKind:"passwordAccepted",passwordAccepted:wh.internalBinaryRead(e,e.uint32(),i,r.body.passwordAccepted)};break;case 10:r.body={oneofKind:"passwordInvalid",passwordInvalid:Rh.internalBinaryRead(e,e.uint32(),i,r.body.passwordInvalid)};break;case 13:r.body={oneofKind:"pilotChanged",pilotChanged:kh.internalBinaryRead(e,e.uint32(),i,r.body.pilotChanged)};break;case 14:r.body={oneofKind:"clientConnected",clientConnected:Mh.internalBinaryRead(e,e.uint32(),i,r.body.clientConnected)};break;case 15:r.body={oneofKind:"clientDisconnected",clientDisconnected:xh.internalBinaryRead(e,e.uint32(),i,r.body.clientDisconnected)};break;case 16:r.body={oneofKind:"arming",arming:Ih.internalBinaryRead(e,e.uint32(),i,r.body.arming)};break;case 17:r.body={oneofKind:"mavlink",mavlink:Nh.internalBinaryRead(e,e.uint32(),i,r.body.mavlink)};break;case 18:r.body={oneofKind:"simplePeerSignal",simplePeerSignal:Dh.internalBinaryRead(e,e.uint32(),i,r.body.simplePeerSignal)};break;case 19:r.body={oneofKind:"systemMonitor",systemMonitor:Lh.internalBinaryRead(e,e.uint32(),i,r.body.systemMonitor)};break;case 20:r.body={oneofKind:"logMessage",logMessage:Oh.internalBinaryRead(e,e.uint32(),i,r.body.logMessage)};break;case 21:r.body={oneofKind:"livekitVideoStats",livekitVideoStats:Uh.internalBinaryRead(e,e.uint32(),i,r.body.livekitVideoStats)};break;case 22:r.body={oneofKind:"simplePeerVideoStats",simplePeerVideoStats:Fh.internalBinaryRead(e,e.uint32(),i,r.body.simplePeerVideoStats)};break;case 23:r.body={oneofKind:"heartbeat",heartbeat:Bh.internalBinaryRead(e,e.uint32(),i,r.body.heartbeat)};break;default:let c=i.readUnknownField;if(c==="throw")throw new globalThis.Error(`Unknown field ${o} (wire type ${l}) for ${this.typeName}`);let u=e.skip(l);c!==!1&&(c===!0?De.onRead:c)(this.typeName,r,o,l,u)}}return r}internalBinaryWrite(e,t,i){e.exchangeId!==void 0&&t.tag(2,ne.Varint).int32(e.exchangeId),e.body.oneofKind==="done"&&yh.internalBinaryWrite(e.body.done,t.tag(3,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="error"&&Th.internalBinaryWrite(e.body.error,t.tag(4,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="pong"&&Sh.internalBinaryWrite(e.body.pong,t.tag(5,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="continuedOutput"&&Ph.internalBinaryWrite(e.body.continuedOutput,t.tag(6,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="sensorUpdates"&&Ah.internalBinaryWrite(e.body.sensorUpdates,t.tag(7,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="passwordRequired"&&Ch.internalBinaryWrite(e.body.passwordRequired,t.tag(8,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="passwordAccepted"&&wh.internalBinaryWrite(e.body.passwordAccepted,t.tag(9,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="passwordInvalid"&&Rh.internalBinaryWrite(e.body.passwordInvalid,t.tag(10,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="pilotChanged"&&kh.internalBinaryWrite(e.body.pilotChanged,t.tag(13,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="clientConnected"&&Mh.internalBinaryWrite(e.body.clientConnected,t.tag(14,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="clientDisconnected"&&xh.internalBinaryWrite(e.body.clientDisconnected,t.tag(15,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="arming"&&Ih.internalBinaryWrite(e.body.arming,t.tag(16,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="mavlink"&&Nh.internalBinaryWrite(e.body.mavlink,t.tag(17,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="simplePeerSignal"&&Dh.internalBinaryWrite(e.body.simplePeerSignal,t.tag(18,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="systemMonitor"&&Lh.internalBinaryWrite(e.body.systemMonitor,t.tag(19,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="logMessage"&&Oh.internalBinaryWrite(e.body.logMessage,t.tag(20,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="livekitVideoStats"&&Uh.internalBinaryWrite(e.body.livekitVideoStats,t.tag(21,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="simplePeerVideoStats"&&Fh.internalBinaryWrite(e.body.simplePeerVideoStats,t.tag(22,ne.LengthDelimited).fork(),i).join(),e.body.oneofKind==="heartbeat"&&Bh.internalBinaryWrite(e.body.heartbeat,t.tag(23,ne.LengthDelimited).fork(),i).join();let s=i.writeUnknownFields;return s!==!1&&(s==!0?De.onWrite:s)(this.typeName,e,t),t}}const WR=new HR,jR="/@fs/Users/ky/Documents/Github/rov-web";var Ui=(n=>(n[n.ROV=0]="ROV",n[n.PILOT=1]="PILOT",n))(Ui||{});class KR{constructor(e=1){Ne(this,"logsStore",[]);Ne(this,"rootURL");Ne(this,"sendLogsAllowed",!1);Ne(this,"rawConsole");Ne(this,"defaultLogOrigin");Ne(this,"svelteSubscribers",[]);Ne(this,"log",(...e)=>{this.rawConsole.log.apply(console,e),this.addLog(Mt.Console,e)});Ne(this,"logDebug",(...e)=>{this.rawConsole.debug.apply(console,e),this.addLog(Mt.Debug,e)});Ne(this,"logWarn",(...e)=>{this.rawConsole.warn.apply(console,e),this.addLog(Mt.Warning,e)});Ne(this,"logError",(...e)=>{this.rawConsole.error.apply(console,e),this.addLog(Mt.Error,e)});Ne(this,"logInfo",(...e)=>{this.rawConsole.info.apply(console,e),this.addLog(Mt.Info,e)});const{log:t,debug:i,warn:s,error:r,info:a}=console;this.rawConsole={log:t,debug:i,warn:s,error:r,info:a},this.rootURL=globalThis.window?window.location.protocol+"//"+window.location.host:"unknown",this.defaultLogOrigin=e,console.log("Logger initialized",this.rootURL)}subscribe(e){this.svelteSubscribers.push(e),e()}sendQueuedLogs(e){if(!this.sendLogsAllowed)return;const t=this.logsStore.filter(i=>!i.sentToRemote);return t.forEach(i=>{i.sentToRemote=!0}),Promise.allSettled(t.map((i,s)=>{const r=Ti.logToJson(i);return e(i.level,r,i.timestamp.toString()+"_"+i.origin.toString()+"_"+s.toString())})).then(i=>{const s=[];for(let r=0;r<i.length;r++){const a=i[r];a&&a.status=="fulfilled"&&a.value==!0?this.logsStore[r].sentToRemote=!0:(this.logsStore[r].sentToRemote=!1,s.push({log:this.logsStore[r],result:a}))}return s.length>0&&console.warn("Failed to send some logs.",s),s.length})}addLog(e,t,i=[],s=0,r=this.defaultLogOrigin,a=wy(),o=!1){if(!i){const u=new Error().stack;i=u?u.split(`
`).slice(3).map(d=>d.replace(this.rootURL,"").replace(jR,"").trim().slice(3)):[]}let l=this.logsStore.length;for(;l>0&&this.logsStore[l-1].timestamp>a;)l--;const c={timestamp:a,level:e,args:t,trace:i,sentToRemote:o,kind:s,origin:r};this.logsStore.splice(l,0,c),this.svelteSubscribers.forEach(u=>u())}logAddLevelFlair(e){const t=e.args;return typeof t[0]!="string"?t.unshift("****"):t[0]="**** "+t[0],{...e,args:t}}printLog(e){if(e.trace&&e.trace.length>0){const t=e.args[0],i=e.args.slice(1);i.push(e.trace.join(`
`)),console.groupCollapsed("%c"+t,this._getLevelColor(e.level)),this._consoleLogAtLevel(e.level,i),console.groupEnd()}else typeof e.args[0]!="string"&&e.args.unshift("****"),e.args[0]="%c "+e.args[0],e.args.splice(1,0,this._getLevelColor(e.level)),this._consoleLogAtLevel(e.level,e.args)}consoleRecentLogs(e=100){console.clear(),console.groupCollapsed("Recent Logs");const t=Math.max(this.logsStore.length-e,0);for(let i=this.logsStore.length-1;i>t;i--){const s=this.logsStore[i];this.printLog(s)}console.groupEnd()}printRecentLogs(e,t=1e3){e.innerHTML="";const i=Math.max(this.logsStore.length-t,0);for(let s=this.logsStore.length-1;s>i;s--){const r=this.logsStore[s],[a,o]=this.logToText(r),l=document.createElement("div");l.innerHTML=`<details style="font-size: 1.1em; font-weight: bold; padding: 0.2em; ${this._getLevelColor(r.level)}"><summary><small>${r.timestamp} </small> <span>${a}</span></summary><pre>${o}</pre></details>`,e.appendChild(l)}}_makeJsonEncodable(e,t=0){if(t>9)return"Max recursion level reached";const i=typeof e;if(i==="string"||i==="number"||i==="boolean")return e;if(e===void 0)return"undefined";if(e===null)return null;if(e instanceof Error)return{instanceOf:i,name:e.name,errMessage:e.message,stack:e.stack,cause:e.cause};if(e instanceof Date)return e.toISOString();if(e instanceof Map){const s={};return e.forEach((r,a)=>{s[a]=this._makeJsonEncodable(r,t+1)}),{instanceof:i,value:s}}else if(e instanceof Set){let s=Array.from(e).map(r=>this._makeJsonEncodable(r,t+1));return{instanceof:i,value:s}}else{if(e instanceof Array||e instanceof Uint8Array||e instanceof Int8Array||e instanceof Uint16Array||e instanceof Int16Array||e instanceof Uint32Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array)return e.map(s=>this._makeJsonEncodable(s,t+1));if(e instanceof Object){const s={};for(const r in e)e.hasOwnProperty(r)&&(s[r]=this._makeJsonEncodable(e[r],t+1));return s}else try{return e.toString()}catch(s){return{instanceof:i,value:"Failed to stringify: "+s.message}}}}logToJson(e){const{timestamp:t,args:i,trace:s,origin:r,kind:a,level:o}=e;return JSON.stringify(this._makeJsonEncodable({level:o,timestamp:t,args:i,trace:s,origin:r,kind:a}))}logToText(e){let t="",i="",s=0;for(;s<e.args.length;s++){const r=e.args[s];try{if(r===null)t+=" null";else if(r===void 0)t+=" undefined";else if(r instanceof Error)t+=r.name+" "+r.message+" "+r.cause,i+=r.stack;else if(r instanceof Object){i+=`
`+JSON.stringify(r,null,2)+`
`;break}else t+=" "+r.toString()}catch(a){i+=" STRINGFAIL:"+typeof r+" ",console.error("Failed to stringify logs arg: "+a.message,typeof r,r)}}for(;s<e.args.length;s++){const r=e.args[s];try{r===null?i+=" null":r===void 0?i+=" undefined":r instanceof Error?i+=r.name+" "+r.message+" "+r.cause+`
`+r.stack:r instanceof Object?i+=`
`+JSON.stringify(r,null,2)+`
`:i+=" "+r.toString()}catch(a){i+=" STRINGFAIL:"+typeof r+" ",console.error("Failed to stringify logs arg: "+(a==null?void 0:a.message),typeof r,r)}}return e.trace&&e.trace.length>0&&(i+=`
`+e.trace.join(`
`)),[t,i]}_consoleLogAtLevel(e,t,i=[]){e===Mt.Debug?this.rawConsole.debug.apply(console,t):e===Mt.Warning?this.rawConsole.warn.apply(console,t):e===Mt.Error?this.rawConsole.error.apply(console,t):e===Mt.Info&&this.rawConsole.info.apply(console,t)}_getLevelColor(e){if(e===Mt.Debug)return"color: #008888";if(e===Mt.Warning)return"color: #888800";if(e===Mt.Error)return"color: #880000";if(e===Mt.Info)return"color: #000088";if(e===Mt.Console)return"color: #000000"}_getLevelIcon(e){if(e===Mt.Debug)return"🐛";if(e===Mt.Warning)return"🟨";if(e===Mt.Error)return"🛑";if(e===Mt.Info)return"ℹ️";if(e===Mt.Console)return"ℹ️"}getLogs(){return this.logsStore}clearLogs(){this.logsStore=[],this.svelteSubscribers.forEach(e=>e())}}const Ti=new KR,Lt=Ti.logDebug,$t=Ti.logWarn,fs=Ti.logError,li=Ti.logInfo,Fi=Ti.log,Oy=new URLSearchParams(globalThis.window?window.location.search:"");function i_(n,e){const t=Oy.get(n);if(t==null||t===""){if(e===void 0)throw new Error("Missing required url query parameter (string): "+n);return li("Using default value for string url query parameter: "+n+"="+e),e}return t}function s_(n,e){const t=Oy.get(n);if(t==null||t===""){if(e===void 0)throw new Error("Missing required boolean url query parameter (boolean): "+n);return li("Using default value for bool url query parameter: "+n+"="+e),e}return t.toLowerCase()!=="false"}var qR=(n=>(n.None="",n.Livekit="LK",n.SimplePeer="SP",n))(qR||{});const es=Ze(!1),MV=Ze(!1),Uy=Ze(!1),ci=Ze(!1),ic=Ze(50),r_=Ze(!1),a_=Ze(!1),XR=Ze(""),xV=Ze(""),Fy=Ze(new Set),ou=Ze({velocityX:0,velocityY:0,velocityZ:0,angularVelocityYaw:0,buttonBitmask:0});var Zt=(n=>(n.success="success",n.info="tertiary",n.warning="warning",n.error="error",n))(Zt||{});const cr=new Map,YR=Ze([]),Vh=n=>{cr.set(n.msg,n),YR.set(Array.from(cr.values()).reverse())};let jc;const IV=()=>{jc=hC(),Uy.subscribe(n=>{n&&cr.forEach(e=>{e.closed=!0,jc.close(e.toastId)})})};function JR(){const n=Math.random();return Number(n).toString(32)}const cn=(n,e=2e3,t=!0,i="tertiary",s=null)=>{const r=cr.get(n),a=r?r.toastId:JR();if(Uy.get())return Vh({msg:n,severity:i,messageRepeatCount:r?r.messageRepeatCount+1:1,toastId:a,closed:!0}),a;if(jc&&(!r||!t)){let o=jc.trigger({classes:`variant-filled-${i} w-72`,message:n,timeout:e,callback:({id:l,status:c})=>{if(c=="closed"){const u=cr.get(n);u&&Vh({...u,closed:!0}),s&&s()}},hoverable:!0,autohide:!0});return cr.set(n,{msg:n,toastId:o,closed:!1,severity:i,messageRepeatCount:1}),o}else r.closed&&cr.delete(n),Vh({...r,messageRepeatCount:r.messageRepeatCount+1})},QR=n=>{const e=cr.get(n);e&&(jc.close(e.toastId),e.closed=!0,cr.set(n,e))};function ZR(n){let e,t;return{c(){e=Ie("path"),t=Ie("path"),this.h()},l(i){e=Pe(i,"path",{d:!0,opacity:!0}),F(e).forEach(S),t=Pe(i,"path",{d:!0}),F(t).forEach(S),this.h()},h(){x(e,"d","M12 4c-4.41 0-8 3.59-8 8s3.59 8 8 8 8-3.59 8-8-3.59-8-8-8zm-2 13-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"),x(e,"opacity",".3"),x(t,"d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm4.59-12.42L10 14.17l-2.59-2.58L6 13l4 4 8-8z")},m(i,s){D(i,e,s),D(i,t,s)},d(i){i&&(S(e),S(t))}}}function $R(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function ek(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM9.29 16.29 5.7 12.7a.996.996 0 1 1 1.41-1.41L10 14.17l6.88-6.88a.996.996 0 1 1 1.41 1.41l-7.59 7.59a.996.996 0 0 1-1.41 0z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function tk(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function nk(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm4.59-12.42L10 14.17l-2.59-2.58L6 13l4 4 8-8z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function ik(n){let e,t,i;function s(c,u){if(c[3]==="outlined")return nk;if(c[3]==="filled")return tk;if(c[3]==="round")return ek;if(c[3]==="sharp")return $R;if(c[3]==="two-tone")return ZR}let r=s(n),a=r&&r(n),o=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[4]},{viewBox:"0 0 24 24"}],l={};for(let c=0;c<o.length;c+=1)l=$e(l,o[c]);return{c(){e=Ie("svg"),a&&a.c(),this.h()},l(c){e=Pe(c,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var u=F(e);a&&a.l(u),u.forEach(S),this.h()},h(){hn(e,l)},m(c,u){D(c,e,u),a&&a.m(e,null),t||(i=[X(e,"click",n[6]),X(e,"keydown",n[7]),X(e,"keyup",n[8]),X(e,"focus",n[9]),X(e,"blur",n[10]),X(e,"mouseenter",n[11]),X(e,"mouseleave",n[12]),X(e,"mouseover",n[13]),X(e,"mouseout",n[14])],t=!0)},p(c,[u]){r!==(r=s(c))&&(a&&a.d(1),a=r&&r(c),a&&(a.c(),a.m(e,null))),hn(e,l=Qn(o,[{xmlns:"http://www.w3.org/2000/svg"},u&32&&c[5],u&2&&{role:c[1]},u&1&&{width:c[0]},u&1&&{height:c[0]},u&4&&{fill:c[2]},u&16&&{"aria-label":c[4]},{viewBox:"0 0 24 24"}]))},i:Tt,o:Tt,d(c){c&&S(e),a&&a.d(),t=!1,kn(i)}}}function sk(n,e,t){const i=["size","role","color","variation","ariaLabel"];let s=Nt(e,i);const r=Et("iconCtx")??{};let{size:a=r.size||"24"}=e,{role:o=r.role||"img"}=e,{color:l=r.color||"currentColor"}=e,{variation:c=r.variation||"outlined"}=e,{ariaLabel:u="check circle"}=e;function d(p){ae.call(this,n,p)}function h(p){ae.call(this,n,p)}function f(p){ae.call(this,n,p)}function g(p){ae.call(this,n,p)}function v(p){ae.call(this,n,p)}function m(p){ae.call(this,n,p)}function _(p){ae.call(this,n,p)}function y(p){ae.call(this,n,p)}function b(p){ae.call(this,n,p)}return n.$$set=p=>{e=$e($e({},e),Wt(p)),t(5,s=Nt(e,i)),"size"in p&&t(0,a=p.size),"role"in p&&t(1,o=p.role),"color"in p&&t(2,l=p.color),"variation"in p&&t(3,c=p.variation),"ariaLabel"in p&&t(4,u=p.ariaLabel)},[a,o,l,c,u,s,d,h,f,g,v,m,_,y,b]}class rk extends Bt{constructor(e){super(),Vt(this,e,sk,ik,Ft,{size:0,role:1,color:2,variation:3,ariaLabel:4})}}function ak(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function ok(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function ck(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59 7.11 5.7A.996.996 0 1 0 5.7 7.11L10.59 12 5.7 16.89a.996.996 0 1 0 1.41 1.41L12 13.41l4.89 4.89a.996.996 0 1 0 1.41-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function lk(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function uk(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function dk(n){let e,t,i;function s(c,u){if(c[3]==="outlined")return uk;if(c[3]==="filled")return lk;if(c[3]==="round")return ck;if(c[3]==="sharp")return ok;if(c[3]==="two-tone")return ak}let r=s(n),a=r&&r(n),o=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[4]},{viewBox:"0 0 24 24"}],l={};for(let c=0;c<o.length;c+=1)l=$e(l,o[c]);return{c(){e=Ie("svg"),a&&a.c(),this.h()},l(c){e=Pe(c,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var u=F(e);a&&a.l(u),u.forEach(S),this.h()},h(){hn(e,l)},m(c,u){D(c,e,u),a&&a.m(e,null),t||(i=[X(e,"click",n[6]),X(e,"keydown",n[7]),X(e,"keyup",n[8]),X(e,"focus",n[9]),X(e,"blur",n[10]),X(e,"mouseenter",n[11]),X(e,"mouseleave",n[12]),X(e,"mouseover",n[13]),X(e,"mouseout",n[14])],t=!0)},p(c,[u]){r!==(r=s(c))&&(a&&a.d(1),a=r&&r(c),a&&(a.c(),a.m(e,null))),hn(e,l=Qn(o,[{xmlns:"http://www.w3.org/2000/svg"},u&32&&c[5],u&2&&{role:c[1]},u&1&&{width:c[0]},u&1&&{height:c[0]},u&4&&{fill:c[2]},u&16&&{"aria-label":c[4]},{viewBox:"0 0 24 24"}]))},i:Tt,o:Tt,d(c){c&&S(e),a&&a.d(),t=!1,kn(i)}}}function hk(n,e,t){const i=["size","role","color","variation","ariaLabel"];let s=Nt(e,i);const r=Et("iconCtx")??{};let{size:a=r.size||"24"}=e,{role:o=r.role||"img"}=e,{color:l=r.color||"currentColor"}=e,{variation:c=r.variation||"outlined"}=e,{ariaLabel:u="close"}=e;function d(p){ae.call(this,n,p)}function h(p){ae.call(this,n,p)}function f(p){ae.call(this,n,p)}function g(p){ae.call(this,n,p)}function v(p){ae.call(this,n,p)}function m(p){ae.call(this,n,p)}function _(p){ae.call(this,n,p)}function y(p){ae.call(this,n,p)}function b(p){ae.call(this,n,p)}return n.$$set=p=>{e=$e($e({},e),Wt(p)),t(5,s=Nt(e,i)),"size"in p&&t(0,a=p.size),"role"in p&&t(1,o=p.role),"color"in p&&t(2,l=p.color),"variation"in p&&t(3,c=p.variation),"ariaLabel"in p&&t(4,u=p.ariaLabel)},[a,o,l,c,u,s,d,h,f,g,v,m,_,y,b]}class gd extends Bt{constructor(e){super(),Vt(this,e,hk,dk,Ft,{size:0,role:1,color:2,variation:3,ariaLabel:4})}}function fk(n){let e,t;return{c(){e=Ie("path"),t=Ie("path"),this.h()},l(i){e=Pe(i,"path",{d:!0,opacity:!0}),F(e).forEach(S),t=Pe(i,"path",{d:!0}),F(t).forEach(S),this.h()},h(){x(e,"d","M21.51 18H15c-.55 0-1-.45-1-1s.45-1 1-1h1.25v-.25c0-.97.78-1.75 1.75-1.75s1.75.78 1.75 1.75V17h1.76c.28 0 .5.22.5.5-.01.27-.23.5-.5.5z"),x(e,"opacity",".3"),x(t,"d","M21.5 14.98c-.02 0-.03 0-.05.01A3.49 3.49 0 0 0 18 12c-1.4 0-2.6.83-3.16 2.02A2.988 2.988 0 0 0 12 17c0 1.66 1.34 3 3 3l6.5-.02a2.5 2.5 0 0 0 0-5zm.01 3.02H15c-.55 0-1-.45-1-1s.45-1 1-1h1.25v-.25c0-.97.78-1.75 1.75-1.75s1.75.78 1.75 1.75V17h1.76c.28 0 .5.22.5.5-.01.27-.23.5-.5.5zM10 4.26v2.09C7.67 7.18 6 9.39 6 12c0 1.77.78 3.34 2 4.44V14h2v6H4v-2h2.73A7.942 7.942 0 0 1 4 12c0-3.73 2.55-6.85 6-7.74zM20 6h-2.73a7.98 7.98 0 0 1 2.66 5h-2.02c-.23-1.36-.93-2.55-1.91-3.44V10h-2V4h6v2z")},m(i,s){D(i,e,s),D(i,t,s)},d(i){i&&(S(e),S(t))}}}function pk(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M21.5 14.98c-.02 0-.03 0-.05.01A3.49 3.49 0 0 0 18 12c-1.4 0-2.6.83-3.16 2.02A2.988 2.988 0 0 0 12 17c0 1.66 1.34 3 3 3l6.5-.02a2.5 2.5 0 0 0 0-5zM10 4.26v2.09C7.67 7.18 6 9.39 6 12c0 1.77.78 3.34 2 4.44V14h2v6H4v-2h2.73A7.942 7.942 0 0 1 4 12c0-3.73 2.55-6.85 6-7.74zM20 6h-2.73a7.98 7.98 0 0 1 2.66 5h-2.02c-.23-1.36-.93-2.55-1.91-3.44V10h-2V4h6v2z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function mk(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M24 17.48a2.5 2.5 0 0 1-2.5 2.5L15 20c-1.66 0-3-1.34-3-3 0-1.6 1.26-2.9 2.84-2.98A3.495 3.495 0 0 1 18 12c1.76 0 3.2 1.3 3.45 2.99.02 0 .03-.01.05-.01a2.5 2.5 0 0 1 2.5 2.5zM10 15c0-.55-.45-1-1-1s-1 .45-1 1v1.44c-1.22-1.1-2-2.67-2-4.44 0-2.38 1.39-4.43 3.4-5.4.37-.18.6-.56.6-.97 0-.71-.73-1.18-1.37-.88C5.89 6.03 4 8.79 4 12c0 2.4 1.06 4.54 2.73 6H5c-.55 0-1 .45-1 1s.45 1 1 1h4c.55 0 1-.45 1-1v-4zm9-9c.55 0 1-.45 1-1s-.45-1-1-1h-4c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1s1-.45 1-1V7.56c.98.89 1.68 2.08 1.92 3.44h2.02a7.98 7.98 0 0 0-2.66-5H19z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function gk(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M21.5 14.98c-.02 0-.03 0-.05.01A3.49 3.49 0 0 0 18 12c-1.4 0-2.6.83-3.16 2.02A2.988 2.988 0 0 0 12 17c0 1.66 1.34 3 3 3l6.5-.02a2.5 2.5 0 0 0 0-5zM10 4.26v2.09C7.67 7.18 6 9.39 6 12c0 1.77.78 3.34 2 4.44V14h2v6H4v-2h2.73A7.942 7.942 0 0 1 4 12c0-3.73 2.55-6.85 6-7.74zM20 6h-2.73a7.98 7.98 0 0 1 2.66 5h-2.02c-.23-1.36-.93-2.55-1.91-3.44V10h-2V4h6v2z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function _k(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M21.5 14.98c-.02 0-.03 0-.05.01A3.49 3.49 0 0 0 18 12c-1.4 0-2.6.83-3.16 2.02A2.988 2.988 0 0 0 12 17c0 1.66 1.34 3 3 3l6.5-.02a2.5 2.5 0 0 0 0-5zm.01 3.02H15c-.55 0-1-.45-1-1s.45-1 1-1h1.25v-.25c0-.97.78-1.75 1.75-1.75s1.75.78 1.75 1.75V17h1.76c.28 0 .5.22.5.5-.01.27-.23.5-.5.5zM10 4.26v2.09C7.67 7.18 6 9.39 6 12c0 1.77.78 3.34 2 4.44V14h2v6H4v-2h2.73A7.942 7.942 0 0 1 4 12c0-3.73 2.55-6.85 6-7.74zM20 6h-2.73a7.98 7.98 0 0 1 2.66 5h-2.02c-.23-1.36-.93-2.55-1.91-3.44V10h-2V4h6v2z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function vk(n){let e,t,i;function s(c,u){if(c[3]==="outlined")return _k;if(c[3]==="filled")return gk;if(c[3]==="round")return mk;if(c[3]==="sharp")return pk;if(c[3]==="two-tone")return fk}let r=s(n),a=r&&r(n),o=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[4]},{viewBox:"0 0 24 24"}],l={};for(let c=0;c<o.length;c+=1)l=$e(l,o[c]);return{c(){e=Ie("svg"),a&&a.c(),this.h()},l(c){e=Pe(c,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var u=F(e);a&&a.l(u),u.forEach(S),this.h()},h(){hn(e,l)},m(c,u){D(c,e,u),a&&a.m(e,null),t||(i=[X(e,"click",n[6]),X(e,"keydown",n[7]),X(e,"keyup",n[8]),X(e,"focus",n[9]),X(e,"blur",n[10]),X(e,"mouseenter",n[11]),X(e,"mouseleave",n[12]),X(e,"mouseover",n[13]),X(e,"mouseout",n[14])],t=!0)},p(c,[u]){r!==(r=s(c))&&(a&&a.d(1),a=r&&r(c),a&&(a.c(),a.m(e,null))),hn(e,l=Qn(o,[{xmlns:"http://www.w3.org/2000/svg"},u&32&&c[5],u&2&&{role:c[1]},u&1&&{width:c[0]},u&1&&{height:c[0]},u&4&&{fill:c[2]},u&16&&{"aria-label":c[4]},{viewBox:"0 0 24 24"}]))},i:Tt,o:Tt,d(c){c&&S(e),a&&a.d(),t=!1,kn(i)}}}function bk(n,e,t){const i=["size","role","color","variation","ariaLabel"];let s=Nt(e,i);const r=Et("iconCtx")??{};let{size:a=r.size||"24"}=e,{role:o=r.role||"img"}=e,{color:l=r.color||"currentColor"}=e,{variation:c=r.variation||"outlined"}=e,{ariaLabel:u="cloud sync"}=e;function d(p){ae.call(this,n,p)}function h(p){ae.call(this,n,p)}function f(p){ae.call(this,n,p)}function g(p){ae.call(this,n,p)}function v(p){ae.call(this,n,p)}function m(p){ae.call(this,n,p)}function _(p){ae.call(this,n,p)}function y(p){ae.call(this,n,p)}function b(p){ae.call(this,n,p)}return n.$$set=p=>{e=$e($e({},e),Wt(p)),t(5,s=Nt(e,i)),"size"in p&&t(0,a=p.size),"role"in p&&t(1,o=p.role),"color"in p&&t(2,l=p.color),"variation"in p&&t(3,c=p.variation),"ariaLabel"in p&&t(4,u=p.ariaLabel)},[a,o,l,c,u,s,d,h,f,g,v,m,_,y,b]}class yk extends Bt{constructor(e){super(),Vt(this,e,bk,vk,Ft,{size:0,role:1,color:2,variation:3,ariaLabel:4})}}function Tk(n){let e,t;return{c(){e=Ie("path"),t=Ie("path"),this.h()},l(i){e=Pe(i,"path",{d:!0,opacity:!0}),F(e).forEach(S),t=Pe(i,"path",{d:!0}),F(t).forEach(S),this.h()},h(){x(e,"d","M16 9H8v10h8V9zm-.47 7.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12z"),x(e,"opacity",".3"),x(t,"d","M14.12 10.47 12 12.59l-2.13-2.12-1.41 1.41L10.59 14l-2.12 2.12 1.41 1.41L12 15.41l2.12 2.12 1.41-1.41L13.41 14l2.12-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4zM6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9z")},m(i,s){D(i,e,s),D(i,t,s)},d(i){i&&(S(e),S(t))}}}function Sk(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M6 21h12V7H6v14zm2.46-9.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4h-3.5z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function Ek(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm3.17-6.41a.996.996 0 1 1 1.41-1.41L12 12.59l1.41-1.41a.996.996 0 1 1 1.41 1.41L13.41 14l1.41 1.41a.996.996 0 1 1-1.41 1.41L12 15.41l-1.41 1.41a.996.996 0 1 1-1.41-1.41L10.59 14l-1.42-1.41zM18 4h-2.5l-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26 0-.52.11-.7.29L8.5 4H6c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function Ak(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function Ck(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M14.12 10.47 12 12.59l-2.13-2.12-1.41 1.41L10.59 14l-2.12 2.12 1.41 1.41L12 15.41l2.12 2.12 1.41-1.41L13.41 14l2.12-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4zM6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function wk(n){let e,t,i;function s(c,u){if(c[3]==="outlined")return Ck;if(c[3]==="filled")return Ak;if(c[3]==="round")return Ek;if(c[3]==="sharp")return Sk;if(c[3]==="two-tone")return Tk}let r=s(n),a=r&&r(n),o=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[4]},{viewBox:"0 0 24 24"}],l={};for(let c=0;c<o.length;c+=1)l=$e(l,o[c]);return{c(){e=Ie("svg"),a&&a.c(),this.h()},l(c){e=Pe(c,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var u=F(e);a&&a.l(u),u.forEach(S),this.h()},h(){hn(e,l)},m(c,u){D(c,e,u),a&&a.m(e,null),t||(i=[X(e,"click",n[6]),X(e,"keydown",n[7]),X(e,"keyup",n[8]),X(e,"focus",n[9]),X(e,"blur",n[10]),X(e,"mouseenter",n[11]),X(e,"mouseleave",n[12]),X(e,"mouseover",n[13]),X(e,"mouseout",n[14])],t=!0)},p(c,[u]){r!==(r=s(c))&&(a&&a.d(1),a=r&&r(c),a&&(a.c(),a.m(e,null))),hn(e,l=Qn(o,[{xmlns:"http://www.w3.org/2000/svg"},u&32&&c[5],u&2&&{role:c[1]},u&1&&{width:c[0]},u&1&&{height:c[0]},u&4&&{fill:c[2]},u&16&&{"aria-label":c[4]},{viewBox:"0 0 24 24"}]))},i:Tt,o:Tt,d(c){c&&S(e),a&&a.d(),t=!1,kn(i)}}}function Rk(n,e,t){const i=["size","role","color","variation","ariaLabel"];let s=Nt(e,i);const r=Et("iconCtx")??{};let{size:a=r.size||"24"}=e,{role:o=r.role||"img"}=e,{color:l=r.color||"currentColor"}=e,{variation:c=r.variation||"outlined"}=e,{ariaLabel:u="delete forever"}=e;function d(p){ae.call(this,n,p)}function h(p){ae.call(this,n,p)}function f(p){ae.call(this,n,p)}function g(p){ae.call(this,n,p)}function v(p){ae.call(this,n,p)}function m(p){ae.call(this,n,p)}function _(p){ae.call(this,n,p)}function y(p){ae.call(this,n,p)}function b(p){ae.call(this,n,p)}return n.$$set=p=>{e=$e($e({},e),Wt(p)),t(5,s=Nt(e,i)),"size"in p&&t(0,a=p.size),"role"in p&&t(1,o=p.role),"color"in p&&t(2,l=p.color),"variation"in p&&t(3,c=p.variation),"ariaLabel"in p&&t(4,u=p.ariaLabel)},[a,o,l,c,u,s,d,h,f,g,v,m,_,y,b]}class kk extends Bt{constructor(e){super(),Vt(this,e,Rk,wk,Ft,{size:0,role:1,color:2,variation:3,ariaLabel:4})}}function Mk(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M5 18h14v2H5v-2zm4.6-2.7L5 10.7l2-1.9 2.6 2.6L17 4l2 2-9.4 9.3z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function xk(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M5 18h14v2H5v-2zm4.6-2.7L5 10.7l2-1.9 2.6 2.6L17 4l2 2-9.4 9.3z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function Ik(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M6 18h12c.55 0 1 .45 1 1s-.45 1-1 1H6c-.55 0-1-.45-1-1s.45-1 1-1zm5.01-4.1a2 2 0 0 1-2.82-.01L6 11.7c-.55-.55-.54-1.44.03-1.97.54-.52 1.4-.5 1.92.02L9.6 11.4l6.43-6.43c.54-.54 1.41-.54 1.95 0l.04.04c.54.54.54 1.42-.01 1.96l-7 6.93z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function Pk(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M20.13 5.41 18.72 4l-9.19 9.19-4.25-4.24-1.41 1.41 5.66 5.66zM5 18h14v2H5z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function Nk(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M5 18h14v2H5v-2zm4.6-2.7L5 10.7l2-1.9 2.6 2.6L17 4l2 2-9.4 9.3z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function Dk(n){let e,t,i;function s(c,u){if(c[3]==="outlined")return Nk;if(c[3]==="filled")return Pk;if(c[3]==="round")return Ik;if(c[3]==="sharp")return xk;if(c[3]==="two-tone")return Mk}let r=s(n),a=r&&r(n),o=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[4]},{viewBox:"0 0 24 24"}],l={};for(let c=0;c<o.length;c+=1)l=$e(l,o[c]);return{c(){e=Ie("svg"),a&&a.c(),this.h()},l(c){e=Pe(c,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var u=F(e);a&&a.l(u),u.forEach(S),this.h()},h(){hn(e,l)},m(c,u){D(c,e,u),a&&a.m(e,null),t||(i=[X(e,"click",n[6]),X(e,"keydown",n[7]),X(e,"keyup",n[8]),X(e,"focus",n[9]),X(e,"blur",n[10]),X(e,"mouseenter",n[11]),X(e,"mouseleave",n[12]),X(e,"mouseover",n[13]),X(e,"mouseout",n[14])],t=!0)},p(c,[u]){r!==(r=s(c))&&(a&&a.d(1),a=r&&r(c),a&&(a.c(),a.m(e,null))),hn(e,l=Qn(o,[{xmlns:"http://www.w3.org/2000/svg"},u&32&&c[5],u&2&&{role:c[1]},u&1&&{width:c[0]},u&1&&{height:c[0]},u&4&&{fill:c[2]},u&16&&{"aria-label":c[4]},{viewBox:"0 0 24 24"}]))},i:Tt,o:Tt,d(c){c&&S(e),a&&a.d(),t=!1,kn(i)}}}function Lk(n,e,t){const i=["size","role","color","variation","ariaLabel"];let s=Nt(e,i);const r=Et("iconCtx")??{};let{size:a=r.size||"24"}=e,{role:o=r.role||"img"}=e,{color:l=r.color||"currentColor"}=e,{variation:c=r.variation||"outlined"}=e,{ariaLabel:u="download done"}=e;function d(p){ae.call(this,n,p)}function h(p){ae.call(this,n,p)}function f(p){ae.call(this,n,p)}function g(p){ae.call(this,n,p)}function v(p){ae.call(this,n,p)}function m(p){ae.call(this,n,p)}function _(p){ae.call(this,n,p)}function y(p){ae.call(this,n,p)}function b(p){ae.call(this,n,p)}return n.$$set=p=>{e=$e($e({},e),Wt(p)),t(5,s=Nt(e,i)),"size"in p&&t(0,a=p.size),"role"in p&&t(1,o=p.role),"color"in p&&t(2,l=p.color),"variation"in p&&t(3,c=p.variation),"ariaLabel"in p&&t(4,u=p.ariaLabel)},[a,o,l,c,u,s,d,h,f,g,v,m,_,y,b]}class Ok extends Bt{constructor(e){super(),Vt(this,e,Lk,Dk,Ft,{size:0,role:1,color:2,variation:3,ariaLabel:4})}}function Uk(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M4 9h16v2H4zm0 4h16v2H4z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function Fk(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M20 9H4v2h16V9zM4 15h16v-2H4v2z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function Bk(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M19 9H5c-.55 0-1 .45-1 1s.45 1 1 1h14c.55 0 1-.45 1-1s-.45-1-1-1zM5 15h14c.55 0 1-.45 1-1s-.45-1-1-1H5c-.55 0-1 .45-1 1s.45 1 1 1z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function Vk(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M20 9H4v2h16V9zM4 15h16v-2H4v2z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function Gk(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M20 9H4v2h16V9zM4 15h16v-2H4v2z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function zk(n){let e,t,i;function s(c,u){if(c[3]==="outlined")return Gk;if(c[3]==="filled")return Vk;if(c[3]==="round")return Bk;if(c[3]==="sharp")return Fk;if(c[3]==="two-tone")return Uk}let r=s(n),a=r&&r(n),o=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[4]},{viewBox:"0 0 24 24"}],l={};for(let c=0;c<o.length;c+=1)l=$e(l,o[c]);return{c(){e=Ie("svg"),a&&a.c(),this.h()},l(c){e=Pe(c,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var u=F(e);a&&a.l(u),u.forEach(S),this.h()},h(){hn(e,l)},m(c,u){D(c,e,u),a&&a.m(e,null),t||(i=[X(e,"click",n[6]),X(e,"keydown",n[7]),X(e,"keyup",n[8]),X(e,"focus",n[9]),X(e,"blur",n[10]),X(e,"mouseenter",n[11]),X(e,"mouseleave",n[12]),X(e,"mouseover",n[13]),X(e,"mouseout",n[14])],t=!0)},p(c,[u]){r!==(r=s(c))&&(a&&a.d(1),a=r&&r(c),a&&(a.c(),a.m(e,null))),hn(e,l=Qn(o,[{xmlns:"http://www.w3.org/2000/svg"},u&32&&c[5],u&2&&{role:c[1]},u&1&&{width:c[0]},u&1&&{height:c[0]},u&4&&{fill:c[2]},u&16&&{"aria-label":c[4]},{viewBox:"0 0 24 24"}]))},i:Tt,o:Tt,d(c){c&&S(e),a&&a.d(),t=!1,kn(i)}}}function Hk(n,e,t){const i=["size","role","color","variation","ariaLabel"];let s=Nt(e,i);const r=Et("iconCtx")??{};let{size:a=r.size||"24"}=e,{role:o=r.role||"img"}=e,{color:l=r.color||"currentColor"}=e,{variation:c=r.variation||"outlined"}=e,{ariaLabel:u="drag handle"}=e;function d(p){ae.call(this,n,p)}function h(p){ae.call(this,n,p)}function f(p){ae.call(this,n,p)}function g(p){ae.call(this,n,p)}function v(p){ae.call(this,n,p)}function m(p){ae.call(this,n,p)}function _(p){ae.call(this,n,p)}function y(p){ae.call(this,n,p)}function b(p){ae.call(this,n,p)}return n.$$set=p=>{e=$e($e({},e),Wt(p)),t(5,s=Nt(e,i)),"size"in p&&t(0,a=p.size),"role"in p&&t(1,o=p.role),"color"in p&&t(2,l=p.color),"variation"in p&&t(3,c=p.variation),"ariaLabel"in p&&t(4,u=p.ariaLabel)},[a,o,l,c,u,s,d,h,f,g,v,m,_,y,b]}class Wk extends Bt{constructor(e){super(),Vt(this,e,Hk,zk,Ft,{size:0,role:1,color:2,variation:3,ariaLabel:4})}}function jk(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M2.5 19h19v2h-19v-2zm16.84-3.15c.8.21 1.62-.26 1.84-1.06.21-.8-.26-1.62-1.06-1.84l-5.31-1.42-2.76-9.02L10.12 2v8.28L5.15 8.95l-.93-2.32-1.45-.39v5.17l16.57 4.44z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function Kk(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M2.5 19h19v2h-19v-2zm16.84-3.15c.8.21 1.62-.26 1.84-1.06.21-.8-.26-1.62-1.06-1.84l-5.31-1.42-2.76-9.02L10.12 2v8.28L5.15 8.95l-.93-2.32-1.45-.39v5.17l16.57 4.44z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function qk(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M20.5 19h-17c-.55 0-1 .45-1 1s.45 1 1 1h17c.55 0 1-.45 1-1s-.45-1-1-1zM3.51 11.61l15.83 4.24c.8.21 1.62-.26 1.84-1.06.21-.8-.26-1.62-1.06-1.84l-5.31-1.42-2.58-8.45a1.08 1.08 0 0 0-.75-.73c-.68-.18-1.35.33-1.35 1.04v6.88L5.15 8.95 4.4 7.09a.991.991 0 0 0-.67-.59l-.33-.09a.495.495 0 0 0-.63.48v3.75c0 .46.3.85.74.97z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function Xk(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M2.5 19h19v2h-19v-2zm16.84-3.15c.8.21 1.62-.26 1.84-1.06.21-.8-.26-1.62-1.06-1.84l-5.31-1.42-2.76-9.02L10.12 2v8.28L5.15 8.95l-.93-2.32-1.45-.39v5.17l16.57 4.44z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function Yk(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M2.5 19h19v2h-19v-2zm16.84-3.15c.8.21 1.62-.26 1.84-1.06.21-.8-.26-1.62-1.06-1.84l-5.31-1.42-2.76-9.02L10.12 2v8.28L5.15 8.95l-.93-2.32-1.45-.39v5.17l16.57 4.44z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function Jk(n){let e,t,i;function s(c,u){if(c[3]==="outlined")return Yk;if(c[3]==="filled")return Xk;if(c[3]==="round")return qk;if(c[3]==="sharp")return Kk;if(c[3]==="two-tone")return jk}let r=s(n),a=r&&r(n),o=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[4]},{viewBox:"0 0 24 24"}],l={};for(let c=0;c<o.length;c+=1)l=$e(l,o[c]);return{c(){e=Ie("svg"),a&&a.c(),this.h()},l(c){e=Pe(c,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var u=F(e);a&&a.l(u),u.forEach(S),this.h()},h(){hn(e,l)},m(c,u){D(c,e,u),a&&a.m(e,null),t||(i=[X(e,"click",n[6]),X(e,"keydown",n[7]),X(e,"keyup",n[8]),X(e,"focus",n[9]),X(e,"blur",n[10]),X(e,"mouseenter",n[11]),X(e,"mouseleave",n[12]),X(e,"mouseover",n[13]),X(e,"mouseout",n[14])],t=!0)},p(c,[u]){r!==(r=s(c))&&(a&&a.d(1),a=r&&r(c),a&&(a.c(),a.m(e,null))),hn(e,l=Qn(o,[{xmlns:"http://www.w3.org/2000/svg"},u&32&&c[5],u&2&&{role:c[1]},u&1&&{width:c[0]},u&1&&{height:c[0]},u&4&&{fill:c[2]},u&16&&{"aria-label":c[4]},{viewBox:"0 0 24 24"}]))},i:Tt,o:Tt,d(c){c&&S(e),a&&a.d(),t=!1,kn(i)}}}function Qk(n,e,t){const i=["size","role","color","variation","ariaLabel"];let s=Nt(e,i);const r=Et("iconCtx")??{};let{size:a=r.size||"24"}=e,{role:o=r.role||"img"}=e,{color:l=r.color||"currentColor"}=e,{variation:c=r.variation||"outlined"}=e,{ariaLabel:u="flight land"}=e;function d(p){ae.call(this,n,p)}function h(p){ae.call(this,n,p)}function f(p){ae.call(this,n,p)}function g(p){ae.call(this,n,p)}function v(p){ae.call(this,n,p)}function m(p){ae.call(this,n,p)}function _(p){ae.call(this,n,p)}function y(p){ae.call(this,n,p)}function b(p){ae.call(this,n,p)}return n.$$set=p=>{e=$e($e({},e),Wt(p)),t(5,s=Nt(e,i)),"size"in p&&t(0,a=p.size),"role"in p&&t(1,o=p.role),"color"in p&&t(2,l=p.color),"variation"in p&&t(3,c=p.variation),"ariaLabel"in p&&t(4,u=p.ariaLabel)},[a,o,l,c,u,s,d,h,f,g,v,m,_,y,b]}class Zk extends Bt{constructor(e){super(),Vt(this,e,Qk,Jk,Ft,{size:0,role:1,color:2,variation:3,ariaLabel:4})}}function $k(n){let e,t;return{c(){e=Ie("path"),t=Ie("path"),this.h()},l(i){e=Pe(i,"path",{d:!0,opacity:!0}),F(e).forEach(S),t=Pe(i,"path",{d:!0}),F(t).forEach(S),this.h()},h(){x(e,"d","M11 17.33V20h2v-2.67l-1-1zm2-10.66V4h-2v2.67l1 1zM16.33 12l1 1H20v-2h-2.67zM4 11v2h2.67l1-1-1-1z"),x(e,"opacity",".3"),x(t,"d","M2 9v6h5.5l3-3-3-3H2zm4.67 4H4v-2h2.67l1 1-1 1zM22 9h-5.5l-3 3 3 3H22V9zm-2 4h-2.67l-1-1 1-1H20v2zm-5 3.5-3-3-3 3V22h6v-5.5zM13 20h-2v-2.67l1-1 1 1V20zM9 7.5l3 3 3-3V2H9v5.5zM11 4h2v2.67l-1 1-1-1V4z")},m(i,s){D(i,e,s),D(i,t,s)},d(i){i&&(S(e),S(t))}}}function eM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M15 7.5V2H9v5.5l3 3 3-3zM7.5 9H2v6h5.5l3-3-3-3zM9 16.5V22h6v-5.5l-3-3-3 3zM16.5 9l-3 3 3 3H22V9h-5.5z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function tM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M15 7.29V3c0-.55-.45-1-1-1h-4c-.55 0-1 .45-1 1v4.29c0 .13.05.26.15.35l2.5 2.5c.2.2.51.2.71 0l2.5-2.5c.09-.09.14-.21.14-.35zM7.29 9H3c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1h4.29c.13 0 .26-.05.35-.15l2.5-2.5c.2-.2.2-.51 0-.71l-2.5-2.5A.483.483 0 0 0 7.29 9zM9 16.71V21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-4.29a.47.47 0 0 0-.15-.35l-2.5-2.5c-.2-.2-.51-.2-.71 0l-2.5 2.5c-.09.09-.14.21-.14.35zm7.35-7.56-2.5 2.5c-.2.2-.2.51 0 .71l2.5 2.5c.09.09.22.15.35.15H21c.55 0 1-.45 1-1v-4c0-.55-.45-1-1-1h-4.29a.447.447 0 0 0-.36.14z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function nM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M15 7.5V2H9v5.5l3 3 3-3zM7.5 9H2v6h5.5l3-3-3-3zM9 16.5V22h6v-5.5l-3-3-3 3zM16.5 9l-3 3 3 3H22V9h-5.5z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function iM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M13 4v2.67l-1 1-1-1V4h2m7 7v2h-2.67l-1-1 1-1H20M6.67 11l1 1-1 1H4v-2h2.67M12 16.33l1 1V20h-2v-2.67l1-1M15 2H9v5.5l3 3 3-3V2zm7 7h-5.5l-3 3 3 3H22V9zM7.5 9H2v6h5.5l3-3-3-3zm4.5 4.5-3 3V22h6v-5.5l-3-3z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function sM(n){let e,t,i;function s(c,u){if(c[3]==="outlined")return iM;if(c[3]==="filled")return nM;if(c[3]==="round")return tM;if(c[3]==="sharp")return eM;if(c[3]==="two-tone")return $k}let r=s(n),a=r&&r(n),o=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[4]},{viewBox:"0 0 24 24"}],l={};for(let c=0;c<o.length;c+=1)l=$e(l,o[c]);return{c(){e=Ie("svg"),a&&a.c(),this.h()},l(c){e=Pe(c,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var u=F(e);a&&a.l(u),u.forEach(S),this.h()},h(){hn(e,l)},m(c,u){D(c,e,u),a&&a.m(e,null),t||(i=[X(e,"click",n[6]),X(e,"keydown",n[7]),X(e,"keyup",n[8]),X(e,"focus",n[9]),X(e,"blur",n[10]),X(e,"mouseenter",n[11]),X(e,"mouseleave",n[12]),X(e,"mouseover",n[13]),X(e,"mouseout",n[14])],t=!0)},p(c,[u]){r!==(r=s(c))&&(a&&a.d(1),a=r&&r(c),a&&(a.c(),a.m(e,null))),hn(e,l=Qn(o,[{xmlns:"http://www.w3.org/2000/svg"},u&32&&c[5],u&2&&{role:c[1]},u&1&&{width:c[0]},u&1&&{height:c[0]},u&4&&{fill:c[2]},u&16&&{"aria-label":c[4]},{viewBox:"0 0 24 24"}]))},i:Tt,o:Tt,d(c){c&&S(e),a&&a.d(),t=!1,kn(i)}}}function rM(n,e,t){const i=["size","role","color","variation","ariaLabel"];let s=Nt(e,i);const r=Et("iconCtx")??{};let{size:a=r.size||"24"}=e,{role:o=r.role||"img"}=e,{color:l=r.color||"currentColor"}=e,{variation:c=r.variation||"outlined"}=e,{ariaLabel:u="games"}=e;function d(p){ae.call(this,n,p)}function h(p){ae.call(this,n,p)}function f(p){ae.call(this,n,p)}function g(p){ae.call(this,n,p)}function v(p){ae.call(this,n,p)}function m(p){ae.call(this,n,p)}function _(p){ae.call(this,n,p)}function y(p){ae.call(this,n,p)}function b(p){ae.call(this,n,p)}return n.$$set=p=>{e=$e($e({},e),Wt(p)),t(5,s=Nt(e,i)),"size"in p&&t(0,a=p.size),"role"in p&&t(1,o=p.role),"color"in p&&t(2,l=p.color),"variation"in p&&t(3,c=p.variation),"ariaLabel"in p&&t(4,u=p.ariaLabel)},[a,o,l,c,u,s,d,h,f,g,v,m,_,y,b]}class aM extends Bt{constructor(e){super(),Vt(this,e,rM,sM,Ft,{size:0,role:1,color:2,variation:3,ariaLabel:4})}}function oM(n){let e,t;return{c(){e=Ie("path"),t=Ie("path"),this.h()},l(i){e=Pe(i,"path",{d:!0,opacity:!0}),F(e).forEach(S),t=Pe(i,"path",{d:!0}),F(t).forEach(S),this.h()},h(){x(e,"d","M12 4c-4.41 0-8 3.59-8 8s3.59 8 8 8 8-3.59 8-8-3.59-8-8-8zm1 13h-2v-6h2v6zm0-8h-2V7h2v2z"),x(e,"opacity",".3"),x(t,"d","M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z")},m(i,s){D(i,e,s),D(i,t,s)},d(i){i&&(S(e),S(t))}}}function cM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function lM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 15c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1s1 .45 1 1v4c0 .55-.45 1-1 1zm1-8h-2V7h2v2z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function uM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function dM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function hM(n){let e,t,i;function s(c,u){if(c[3]==="outlined")return dM;if(c[3]==="filled")return uM;if(c[3]==="round")return lM;if(c[3]==="sharp")return cM;if(c[3]==="two-tone")return oM}let r=s(n),a=r&&r(n),o=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[4]},{viewBox:"0 0 24 24"}],l={};for(let c=0;c<o.length;c+=1)l=$e(l,o[c]);return{c(){e=Ie("svg"),a&&a.c(),this.h()},l(c){e=Pe(c,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var u=F(e);a&&a.l(u),u.forEach(S),this.h()},h(){hn(e,l)},m(c,u){D(c,e,u),a&&a.m(e,null),t||(i=[X(e,"click",n[6]),X(e,"keydown",n[7]),X(e,"keyup",n[8]),X(e,"focus",n[9]),X(e,"blur",n[10]),X(e,"mouseenter",n[11]),X(e,"mouseleave",n[12]),X(e,"mouseover",n[13]),X(e,"mouseout",n[14])],t=!0)},p(c,[u]){r!==(r=s(c))&&(a&&a.d(1),a=r&&r(c),a&&(a.c(),a.m(e,null))),hn(e,l=Qn(o,[{xmlns:"http://www.w3.org/2000/svg"},u&32&&c[5],u&2&&{role:c[1]},u&1&&{width:c[0]},u&1&&{height:c[0]},u&4&&{fill:c[2]},u&16&&{"aria-label":c[4]},{viewBox:"0 0 24 24"}]))},i:Tt,o:Tt,d(c){c&&S(e),a&&a.d(),t=!1,kn(i)}}}function fM(n,e,t){const i=["size","role","color","variation","ariaLabel"];let s=Nt(e,i);const r=Et("iconCtx")??{};let{size:a=r.size||"24"}=e,{role:o=r.role||"img"}=e,{color:l=r.color||"currentColor"}=e,{variation:c=r.variation||"outlined"}=e,{ariaLabel:u="info"}=e;function d(p){ae.call(this,n,p)}function h(p){ae.call(this,n,p)}function f(p){ae.call(this,n,p)}function g(p){ae.call(this,n,p)}function v(p){ae.call(this,n,p)}function m(p){ae.call(this,n,p)}function _(p){ae.call(this,n,p)}function y(p){ae.call(this,n,p)}function b(p){ae.call(this,n,p)}return n.$$set=p=>{e=$e($e({},e),Wt(p)),t(5,s=Nt(e,i)),"size"in p&&t(0,a=p.size),"role"in p&&t(1,o=p.role),"color"in p&&t(2,l=p.color),"variation"in p&&t(3,c=p.variation),"ariaLabel"in p&&t(4,u=p.ariaLabel)},[a,o,l,c,u,s,d,h,f,g,v,m,_,y,b]}class pM extends Bt{constructor(e){super(),Vt(this,e,fM,hM,Ft,{size:0,role:1,color:2,variation:3,ariaLabel:4})}}function mM(n){let e,t;return{c(){e=Ie("path"),t=Ie("path"),this.h()},l(i){e=Pe(i,"path",{d:!0,opacity:!0}),F(e).forEach(S),t=Pe(i,"path",{d:!0}),F(t).forEach(S),this.h()},h(){x(e,"d","M4 17h16V7H4v10zm13-9h2v2h-2V8zm0 3h2v2h-2v-2zm-3-3h2v2h-2V8zm0 3h2v2h-2v-2zm-3-3h2v2h-2V8zm0 3h2v2h-2v-2zM8 8h2v2H8V8zm0 3h2v2H8v-2zm0 3h8v2H8v-2zM5 8h2v2H5V8zm0 3h2v2H5v-2z"),x(e,"opacity",".3"),x(t,"d","M20 5H4c-1.1 0-1.99.9-1.99 2L2 17c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 12H4V7h16v10zm-9-9h2v2h-2zm0 3h2v2h-2zM8 8h2v2H8zm0 3h2v2H8zm-3 0h2v2H5zm0-3h2v2H5zm3 6h8v2H8zm6-3h2v2h-2zm0-3h2v2h-2zm3 3h2v2h-2zm0-3h2v2h-2z")},m(i,s){D(i,e,s),D(i,t,s)},d(i){i&&(S(e),S(t))}}}function gM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M22 5H2.01L2 19h20V5zM11 8h2v2h-2V8zm0 3h2v2h-2v-2zM8 8h2v2H8V8zm0 3h2v2H8v-2zm-1 2H5v-2h2v2zm0-3H5V8h2v2zm9 7H8v-2h8v2zm0-4h-2v-2h2v2zm0-3h-2V8h2v2zm3 3h-2v-2h2v2zm0-3h-2V8h2v2z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function _M(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M20 5H4c-1.1 0-1.99.9-1.99 2L2 17c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-9 3h2v2h-2V8zm0 3h2v2h-2v-2zM8 8h2v2H8V8zm0 3h2v2H8v-2zm-1 2H5v-2h2v2zm0-3H5V8h2v2zm8 7H9c-.55 0-1-.45-1-1s.45-1 1-1h6c.55 0 1 .45 1 1s-.45 1-1 1zm1-4h-2v-2h2v2zm0-3h-2V8h2v2zm3 3h-2v-2h2v2zm0-3h-2V8h2v2z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function vM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M20 5H4c-1.1 0-1.99.9-1.99 2L2 17c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-9 3h2v2h-2V8zm0 3h2v2h-2v-2zM8 8h2v2H8V8zm0 3h2v2H8v-2zm-1 2H5v-2h2v2zm0-3H5V8h2v2zm9 7H8v-2h8v2zm0-4h-2v-2h2v2zm0-3h-2V8h2v2zm3 3h-2v-2h2v2zm0-3h-2V8h2v2z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function bM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M20 7v10H4V7h16m0-2H4c-1.1 0-1.99.9-1.99 2L2 17c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-9 3h2v2h-2zm0 3h2v2h-2zM8 8h2v2H8zm0 3h2v2H8zm-3 0h2v2H5zm0-3h2v2H5zm3 6h8v2H8zm6-3h2v2h-2zm0-3h2v2h-2zm3 3h2v2h-2zm0-3h2v2h-2z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function yM(n){let e,t,i;function s(c,u){if(c[3]==="outlined")return bM;if(c[3]==="filled")return vM;if(c[3]==="round")return _M;if(c[3]==="sharp")return gM;if(c[3]==="two-tone")return mM}let r=s(n),a=r&&r(n),o=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[4]},{viewBox:"0 0 24 24"}],l={};for(let c=0;c<o.length;c+=1)l=$e(l,o[c]);return{c(){e=Ie("svg"),a&&a.c(),this.h()},l(c){e=Pe(c,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var u=F(e);a&&a.l(u),u.forEach(S),this.h()},h(){hn(e,l)},m(c,u){D(c,e,u),a&&a.m(e,null),t||(i=[X(e,"click",n[6]),X(e,"keydown",n[7]),X(e,"keyup",n[8]),X(e,"focus",n[9]),X(e,"blur",n[10]),X(e,"mouseenter",n[11]),X(e,"mouseleave",n[12]),X(e,"mouseover",n[13]),X(e,"mouseout",n[14])],t=!0)},p(c,[u]){r!==(r=s(c))&&(a&&a.d(1),a=r&&r(c),a&&(a.c(),a.m(e,null))),hn(e,l=Qn(o,[{xmlns:"http://www.w3.org/2000/svg"},u&32&&c[5],u&2&&{role:c[1]},u&1&&{width:c[0]},u&1&&{height:c[0]},u&4&&{fill:c[2]},u&16&&{"aria-label":c[4]},{viewBox:"0 0 24 24"}]))},i:Tt,o:Tt,d(c){c&&S(e),a&&a.d(),t=!1,kn(i)}}}function TM(n,e,t){const i=["size","role","color","variation","ariaLabel"];let s=Nt(e,i);const r=Et("iconCtx")??{};let{size:a=r.size||"24"}=e,{role:o=r.role||"img"}=e,{color:l=r.color||"currentColor"}=e,{variation:c=r.variation||"outlined"}=e,{ariaLabel:u="keyboard"}=e;function d(p){ae.call(this,n,p)}function h(p){ae.call(this,n,p)}function f(p){ae.call(this,n,p)}function g(p){ae.call(this,n,p)}function v(p){ae.call(this,n,p)}function m(p){ae.call(this,n,p)}function _(p){ae.call(this,n,p)}function y(p){ae.call(this,n,p)}function b(p){ae.call(this,n,p)}return n.$$set=p=>{e=$e($e({},e),Wt(p)),t(5,s=Nt(e,i)),"size"in p&&t(0,a=p.size),"role"in p&&t(1,o=p.role),"color"in p&&t(2,l=p.color),"variation"in p&&t(3,c=p.variation),"ariaLabel"in p&&t(4,u=p.ariaLabel)},[a,o,l,c,u,s,d,h,f,g,v,m,_,y,b]}class SM extends Bt{constructor(e){super(),Vt(this,e,TM,yM,Ft,{size:0,role:1,color:2,variation:3,ariaLabel:4})}}function EM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M18 21h3v-3c-1.66 0-3 1.34-3 3zM3 14c6.08 0 11-4.93 11-11h-2a9 9 0 0 1-9 9v2zm11 7h2c0-2.76 2.24-5 5-5v-2c-3.87 0-7 3.13-7 7zM3 10c3.87 0 7-3.13 7-7H8c0 2.76-2.24 5-5 5v2zm7 11h2a9 9 0 0 1 9-9v-2c-6.07 0-11 4.93-11 11zM3 3v3c1.66 0 3-1.34 3-3H3z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function AM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M6 3H3v3c1.66 0 3-1.34 3-3zm8 0h-2a9 9 0 0 1-9 9v2c6.08 0 11-4.93 11-11zm-4 0H8c0 2.76-2.24 5-5 5v2c3.87 0 7-3.13 7-7zm0 18h2a9 9 0 0 1 9-9v-2c-6.07 0-11 4.93-11 11zm8 0h3v-3c-1.66 0-3 1.34-3 3zm-4 0h2c0-2.76 2.24-5 5-5v-2c-3.87 0-7 3.13-7 7z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function CM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M11.05 21c.5 0 .94-.37.99-.87a8.997 8.997 0 0 1 8.08-8.08c.5-.05.88-.48.88-.99 0-.59-.51-1.06-1.1-1-5.19.52-9.32 4.65-9.84 9.83-.06.59.4 1.11.99 1.11zM18 21h3v-3c-1.66 0-3 1.34-3 3zm-2.91 0c.49 0 .9-.36.98-.85.36-2.08 2-3.72 4.08-4.08.49-.08.85-.49.85-.98 0-.61-.54-1.09-1.14-1a6.986 6.986 0 0 0-5.77 5.77c-.1.6.39 1.14 1 1.14zM12.97 3.02c-.5 0-.94.37-.99.87a8.997 8.997 0 0 1-8.08 8.08c-.5.05-.88.48-.88.99 0 .59.51 1.06 1.1 1 5.19-.52 9.32-4.65 9.84-9.83a.998.998 0 0 0-.99-1.11zm-6.94 0h-3v3c1.66 0 3-1.34 3-3zm2.91 0c-.49 0-.9.36-.98.85-.36 2.08-2 3.72-4.08 4.08-.49.09-.85.49-.85.99 0 .61.54 1.09 1.14 1a6.986 6.986 0 0 0 5.77-5.77c.09-.61-.4-1.15-1-1.15z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function wM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M6 3H3v3c1.66 0 3-1.34 3-3zm8 0h-2a9 9 0 0 1-9 9v2c6.08 0 11-4.93 11-11zm-4 0H8c0 2.76-2.24 5-5 5v2c3.87 0 7-3.13 7-7zm0 18h2a9 9 0 0 1 9-9v-2c-6.07 0-11 4.93-11 11zm8 0h3v-3c-1.66 0-3 1.34-3 3zm-4 0h2c0-2.76 2.24-5 5-5v-2c-3.87 0-7 3.13-7 7z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function RM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M6 3H3v3c1.66 0 3-1.34 3-3zm8 0h-2a9 9 0 0 1-9 9v2c6.08 0 11-4.93 11-11zm-4 0H8c0 2.76-2.24 5-5 5v2c3.87 0 7-3.13 7-7zm0 18h2a9 9 0 0 1 9-9v-2c-6.07 0-11 4.93-11 11zm8 0h3v-3c-1.66 0-3 1.34-3 3zm-4 0h2c0-2.76 2.24-5 5-5v-2c-3.87 0-7 3.13-7 7z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function kM(n){let e,t,i;function s(c,u){if(c[3]==="outlined")return RM;if(c[3]==="filled")return wM;if(c[3]==="round")return CM;if(c[3]==="sharp")return AM;if(c[3]==="two-tone")return EM}let r=s(n),a=r&&r(n),o=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[4]},{viewBox:"0 0 24 24"}],l={};for(let c=0;c<o.length;c+=1)l=$e(l,o[c]);return{c(){e=Ie("svg"),a&&a.c(),this.h()},l(c){e=Pe(c,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var u=F(e);a&&a.l(u),u.forEach(S),this.h()},h(){hn(e,l)},m(c,u){D(c,e,u),a&&a.m(e,null),t||(i=[X(e,"click",n[6]),X(e,"keydown",n[7]),X(e,"keyup",n[8]),X(e,"focus",n[9]),X(e,"blur",n[10]),X(e,"mouseenter",n[11]),X(e,"mouseleave",n[12]),X(e,"mouseover",n[13]),X(e,"mouseout",n[14])],t=!0)},p(c,[u]){r!==(r=s(c))&&(a&&a.d(1),a=r&&r(c),a&&(a.c(),a.m(e,null))),hn(e,l=Qn(o,[{xmlns:"http://www.w3.org/2000/svg"},u&32&&c[5],u&2&&{role:c[1]},u&1&&{width:c[0]},u&1&&{height:c[0]},u&4&&{fill:c[2]},u&16&&{"aria-label":c[4]},{viewBox:"0 0 24 24"}]))},i:Tt,o:Tt,d(c){c&&S(e),a&&a.d(),t=!1,kn(i)}}}function MM(n,e,t){const i=["size","role","color","variation","ariaLabel"];let s=Nt(e,i);const r=Et("iconCtx")??{};let{size:a=r.size||"24"}=e,{role:o=r.role||"img"}=e,{color:l=r.color||"currentColor"}=e,{variation:c=r.variation||"outlined"}=e,{ariaLabel:u="leak add"}=e;function d(p){ae.call(this,n,p)}function h(p){ae.call(this,n,p)}function f(p){ae.call(this,n,p)}function g(p){ae.call(this,n,p)}function v(p){ae.call(this,n,p)}function m(p){ae.call(this,n,p)}function _(p){ae.call(this,n,p)}function y(p){ae.call(this,n,p)}function b(p){ae.call(this,n,p)}return n.$$set=p=>{e=$e($e({},e),Wt(p)),t(5,s=Nt(e,i)),"size"in p&&t(0,a=p.size),"role"in p&&t(1,o=p.role),"color"in p&&t(2,l=p.color),"variation"in p&&t(3,c=p.variation),"ariaLabel"in p&&t(4,u=p.ariaLabel)},[a,o,l,c,u,s,d,h,f,g,v,m,_,y,b]}class xM extends Bt{constructor(e){super(),Vt(this,e,MM,kM,Ft,{size:0,role:1,color:2,variation:3,ariaLabel:4})}}function IM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M13 17.91v2.02c3.95-.49 7-3.85 7-7.93s-3.05-7.44-7-7.93V1L8.45 5.55 13 10V6.09c2.84.48 5 2.94 5 5.91s-2.16 5.43-5 5.91zm-7.31-1.02 1.41-1.42c-.52-.75-.87-1.59-1.01-2.47H4.07c.17 1.39.72 2.73 1.62 3.89zm1.42-8.36L5.7 7.11C4.8 8.27 4.24 9.61 4.07 11h2.02c.14-.87.49-1.72 1.02-2.47zM11 17.9c-.87-.15-1.71-.49-2.46-1.03L7.1 18.32c1.16.9 2.51 1.44 3.9 1.61V17.9z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function PM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M7.11 8.53 5.7 7.11C4.8 8.27 4.24 9.61 4.07 11h2.02c.14-.87.49-1.72 1.02-2.47zM6.09 13H4.07c.17 1.39.72 2.73 1.62 3.89l1.41-1.42c-.52-.75-.87-1.59-1.01-2.47zm1.01 5.32c1.16.9 2.51 1.44 3.9 1.61V17.9c-.87-.15-1.71-.49-2.46-1.03L7.1 18.32zM13 4.07V1L8.45 5.55 13 10V6.09c2.84.48 5 2.94 5 5.91s-2.16 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93s-3.05-7.44-7-7.93z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function NM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M6.56 7.98C6.1 7.52 5.31 7.6 5 8.17c-.28.51-.5 1.03-.67 1.58-.19.63.31 1.25.96 1.25h.01c.43 0 .82-.28.94-.7.12-.4.28-.79.48-1.17.22-.37.15-.84-.16-1.15zM5.31 13h-.02c-.65 0-1.15.62-.96 1.25.16.54.38 1.07.66 1.58.31.57 1.11.66 1.57.2.3-.31.38-.77.17-1.15-.2-.37-.36-.76-.48-1.16a.97.97 0 0 0-.94-.72zm2.85 6.02c.51.28 1.04.5 1.59.66.62.18 1.24-.32 1.24-.96v-.03c0-.43-.28-.82-.7-.94-.4-.12-.78-.28-1.15-.48a.97.97 0 0 0-1.16.17l-.03.03c-.45.45-.36 1.24.21 1.55zM13 4.07v-.66c0-.89-1.08-1.34-1.71-.71L9.17 4.83c-.4.4-.4 1.04 0 1.43l2.13 2.08c.63.62 1.7.17 1.7-.72V6.09c2.84.48 5 2.94 5 5.91 0 2.73-1.82 5.02-4.32 5.75a.97.97 0 0 0-.68.94v.02c0 .65.61 1.14 1.23.96A7.976 7.976 0 0 0 20 12c0-4.08-3.05-7.44-7-7.93z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function DM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M7.11 8.53 5.7 7.11C4.8 8.27 4.24 9.61 4.07 11h2.02c.14-.87.49-1.72 1.02-2.47zM6.09 13H4.07c.17 1.39.72 2.73 1.62 3.89l1.41-1.42c-.52-.75-.87-1.59-1.01-2.47zm1.01 5.32c1.16.9 2.51 1.44 3.9 1.61V17.9c-.87-.15-1.71-.49-2.46-1.03L7.1 18.32zM13 4.07V1L8.45 5.55 13 10V6.09c2.84.48 5 2.94 5 5.91s-2.16 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93s-3.05-7.44-7-7.93z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function LM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M7.11 8.53 5.7 7.11C4.8 8.27 4.24 9.61 4.07 11h2.02c.14-.87.49-1.72 1.02-2.47zM6.09 13H4.07c.17 1.39.72 2.73 1.62 3.89l1.41-1.42c-.52-.75-.87-1.59-1.01-2.47zm1.01 5.32c1.16.9 2.51 1.44 3.9 1.61V17.9c-.87-.15-1.71-.49-2.46-1.03L7.1 18.32zM13 4.07V1L8.45 5.55 13 10V6.09c2.84.48 5 2.94 5 5.91s-2.16 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93s-3.05-7.44-7-7.93z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function OM(n){let e,t,i;function s(c,u){if(c[3]==="outlined")return LM;if(c[3]==="filled")return DM;if(c[3]==="round")return NM;if(c[3]==="sharp")return PM;if(c[3]==="two-tone")return IM}let r=s(n),a=r&&r(n),o=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[4]},{viewBox:"0 0 24 24"}],l={};for(let c=0;c<o.length;c+=1)l=$e(l,o[c]);return{c(){e=Ie("svg"),a&&a.c(),this.h()},l(c){e=Pe(c,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var u=F(e);a&&a.l(u),u.forEach(S),this.h()},h(){hn(e,l)},m(c,u){D(c,e,u),a&&a.m(e,null),t||(i=[X(e,"click",n[6]),X(e,"keydown",n[7]),X(e,"keyup",n[8]),X(e,"focus",n[9]),X(e,"blur",n[10]),X(e,"mouseenter",n[11]),X(e,"mouseleave",n[12]),X(e,"mouseover",n[13]),X(e,"mouseout",n[14])],t=!0)},p(c,[u]){r!==(r=s(c))&&(a&&a.d(1),a=r&&r(c),a&&(a.c(),a.m(e,null))),hn(e,l=Qn(o,[{xmlns:"http://www.w3.org/2000/svg"},u&32&&c[5],u&2&&{role:c[1]},u&1&&{width:c[0]},u&1&&{height:c[0]},u&4&&{fill:c[2]},u&16&&{"aria-label":c[4]},{viewBox:"0 0 24 24"}]))},i:Tt,o:Tt,d(c){c&&S(e),a&&a.d(),t=!1,kn(i)}}}function UM(n,e,t){const i=["size","role","color","variation","ariaLabel"];let s=Nt(e,i);const r=Et("iconCtx")??{};let{size:a=r.size||"24"}=e,{role:o=r.role||"img"}=e,{color:l=r.color||"currentColor"}=e,{variation:c=r.variation||"outlined"}=e,{ariaLabel:u="rotate left"}=e;function d(p){ae.call(this,n,p)}function h(p){ae.call(this,n,p)}function f(p){ae.call(this,n,p)}function g(p){ae.call(this,n,p)}function v(p){ae.call(this,n,p)}function m(p){ae.call(this,n,p)}function _(p){ae.call(this,n,p)}function y(p){ae.call(this,n,p)}function b(p){ae.call(this,n,p)}return n.$$set=p=>{e=$e($e({},e),Wt(p)),t(5,s=Nt(e,i)),"size"in p&&t(0,a=p.size),"role"in p&&t(1,o=p.role),"color"in p&&t(2,l=p.color),"variation"in p&&t(3,c=p.variation),"ariaLabel"in p&&t(4,u=p.ariaLabel)},[a,o,l,c,u,s,d,h,f,g,v,m,_,y,b]}class FM extends Bt{constructor(e){super(),Vt(this,e,UM,OM,Ft,{size:0,role:1,color:2,variation:3,ariaLabel:4})}}function BM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67 2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2v9.67z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function VM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M19 12v7H5v-7H3v9h18v-9h-2zm-6 .67 2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2v9.67z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function GM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M19 13v5c0 .55-.45 1-1 1H6c-.55 0-1-.45-1-1v-5c0-.55-.45-1-1-1s-1 .45-1 1v6c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6c0-.55-.45-1-1-1s-1 .45-1 1zm-6-.33 1.88-1.88a.996.996 0 1 1 1.41 1.41l-3.59 3.59a.996.996 0 0 1-1.41 0L7.7 12.2a.996.996 0 1 1 1.41-1.41L11 12.67V4c0-.55.45-1 1-1s1 .45 1 1v8.67z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function zM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67 2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function HM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67 2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2v9.67z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function WM(n){let e,t,i;function s(c,u){if(c[3]==="outlined")return HM;if(c[3]==="filled")return zM;if(c[3]==="round")return GM;if(c[3]==="sharp")return VM;if(c[3]==="two-tone")return BM}let r=s(n),a=r&&r(n),o=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[4]},{viewBox:"0 0 24 24"}],l={};for(let c=0;c<o.length;c+=1)l=$e(l,o[c]);return{c(){e=Ie("svg"),a&&a.c(),this.h()},l(c){e=Pe(c,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var u=F(e);a&&a.l(u),u.forEach(S),this.h()},h(){hn(e,l)},m(c,u){D(c,e,u),a&&a.m(e,null),t||(i=[X(e,"click",n[6]),X(e,"keydown",n[7]),X(e,"keyup",n[8]),X(e,"focus",n[9]),X(e,"blur",n[10]),X(e,"mouseenter",n[11]),X(e,"mouseleave",n[12]),X(e,"mouseover",n[13]),X(e,"mouseout",n[14])],t=!0)},p(c,[u]){r!==(r=s(c))&&(a&&a.d(1),a=r&&r(c),a&&(a.c(),a.m(e,null))),hn(e,l=Qn(o,[{xmlns:"http://www.w3.org/2000/svg"},u&32&&c[5],u&2&&{role:c[1]},u&1&&{width:c[0]},u&1&&{height:c[0]},u&4&&{fill:c[2]},u&16&&{"aria-label":c[4]},{viewBox:"0 0 24 24"}]))},i:Tt,o:Tt,d(c){c&&S(e),a&&a.d(),t=!1,kn(i)}}}function jM(n,e,t){const i=["size","role","color","variation","ariaLabel"];let s=Nt(e,i);const r=Et("iconCtx")??{};let{size:a=r.size||"24"}=e,{role:o=r.role||"img"}=e,{color:l=r.color||"currentColor"}=e,{variation:c=r.variation||"outlined"}=e,{ariaLabel:u="save alt"}=e;function d(p){ae.call(this,n,p)}function h(p){ae.call(this,n,p)}function f(p){ae.call(this,n,p)}function g(p){ae.call(this,n,p)}function v(p){ae.call(this,n,p)}function m(p){ae.call(this,n,p)}function _(p){ae.call(this,n,p)}function y(p){ae.call(this,n,p)}function b(p){ae.call(this,n,p)}return n.$$set=p=>{e=$e($e({},e),Wt(p)),t(5,s=Nt(e,i)),"size"in p&&t(0,a=p.size),"role"in p&&t(1,o=p.role),"color"in p&&t(2,l=p.color),"variation"in p&&t(3,c=p.variation),"ariaLabel"in p&&t(4,u=p.ariaLabel)},[a,o,l,c,u,s,d,h,f,g,v,m,_,y,b]}class KM extends Bt{constructor(e){super(),Vt(this,e,jM,WM,Ft,{size:0,role:1,color:2,variation:3,ariaLabel:4})}}function qM(n){let e,t;return{c(){e=Ie("path"),t=Ie("path"),this.h()},l(i){e=Pe(i,"path",{d:!0}),F(e).forEach(S),t=Pe(i,"path",{d:!0,opacity:!0}),F(t).forEach(S),this.h()},h(){x(e,"d","m18.19 12.44-3.24-1.62c1.29-1 2.12-2.56 2.12-4.32 0-3.03-2.47-5.5-5.5-5.5s-5.5 2.47-5.5 5.5c0 2.13 1.22 3.98 3 4.89v3.26c-2.08-.44-2.01-.44-2.26-.44-.53 0-1.03.21-1.41.59L4 16.22l5.09 5.09c.43.44 1.03.69 1.65.69h6.3c.98 0 1.81-.7 1.97-1.67l.8-4.71c.22-1.3-.43-2.58-1.62-3.18zM8.07 6.5c0-1.93 1.57-3.5 3.5-3.5s3.5 1.57 3.5 3.5c0 .95-.38 1.81-1 2.44V6.5a2.5 2.5 0 0 0-5 0v2.44c-.62-.63-1-1.49-1-2.44zm9.77 8.79-.8 4.71h-6.3c-.09 0-.17-.04-.24-.1l-3.68-3.68 4.25.89V6.5c0-.28.22-.5.5-.5s.5.22.5.5v6h1.76l3.46 1.73c.4.2.62.63.55 1.06z"),x(t,"d","m17.3 14.23-3.46-1.73h-1.77v-6c0-.28-.22-.5-.5-.5s-.5.22-.5.5v10.61l-4.25-.89 3.68 3.68c.06.06.15.1.24.1h6.3l.8-4.71c.07-.43-.15-.86-.54-1.06z"),x(t,"opacity",".3")},m(i,s){D(i,e,s),D(i,t,s)},d(i){i&&(S(e),S(t))}}}function XM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M8.25 9.24V5.5a2.5 2.5 0 0 1 5 0v3.74c1.21-.81 2-2.18 2-3.74 0-2.49-2.01-4.5-4.5-4.5s-4.5 2.01-4.5 4.5c0 1.56.79 2.93 2 3.74zm5.08 2.26h-1.08v-6c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v10.74l-4.04-.85L4 16.62 9.38 22h8.67l1.07-7.62-5.79-2.88z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function YM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M8.79 9.24V5.5a2.5 2.5 0 0 1 5 0v3.74c1.21-.81 2-2.18 2-3.74 0-2.49-2.01-4.5-4.5-4.5s-4.5 2.01-4.5 4.5c0 1.56.79 2.93 2 3.74zm5.5 2.47c-.28-.14-.58-.21-.89-.21h-.61v-6c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v10.74l-3.44-.72c-.37-.08-.76.04-1.03.31-.43.44-.43 1.14 0 1.58l4.01 4.01c.38.37.89.58 1.42.58h6.1c1 0 1.84-.73 1.98-1.72l.63-4.47c.12-.85-.32-1.69-1.09-2.07l-4.08-2.03z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function JM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M9 11.24V7.5a2.5 2.5 0 0 1 5 0v3.74c1.21-.81 2-2.18 2-3.74C16 5.01 13.99 3 11.5 3S7 5.01 7 7.5c0 1.56.79 2.93 2 3.74zm9.84 4.63-4.54-2.26c-.17-.07-.35-.11-.54-.11H13v-6c0-.83-.67-1.5-1.5-1.5S10 6.67 10 7.5v10.74c-3.6-.76-3.54-.75-3.67-.75-.31 0-.59.13-.79.33l-.79.8 4.94 4.94c.27.27.65.44 1.06.44h6.79c.75 0 1.33-.55 1.44-1.28l.75-5.27c.01-.07.02-.14.02-.2 0-.62-.38-1.16-.91-1.38z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function QM(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","m18.19 12.44-3.24-1.62c1.29-1 2.12-2.56 2.12-4.32 0-3.03-2.47-5.5-5.5-5.5s-5.5 2.47-5.5 5.5c0 2.13 1.22 3.98 3 4.89v3.26c-2.15-.46-2.02-.44-2.26-.44-.53 0-1.03.21-1.41.59L4 16.22l5.09 5.09c.43.44 1.03.69 1.65.69h6.3c.98 0 1.81-.7 1.97-1.67l.8-4.71c.22-1.3-.43-2.58-1.62-3.18zm-.35 2.85-.8 4.71h-6.3c-.09 0-.17-.04-.24-.1l-3.68-3.68 4.25.89V6.5c0-.28.22-.5.5-.5s.5.22.5.5v6h1.76l3.46 1.73c.4.2.62.63.55 1.06zM8.07 6.5c0-1.93 1.57-3.5 3.5-3.5s3.5 1.57 3.5 3.5c0 .95-.38 1.81-1 2.44V6.5a2.5 2.5 0 0 0-5 0v2.44c-.62-.63-1-1.49-1-2.44z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function ZM(n){let e,t,i;function s(c,u){if(c[3]==="outlined")return QM;if(c[3]==="filled")return JM;if(c[3]==="round")return YM;if(c[3]==="sharp")return XM;if(c[3]==="two-tone")return qM}let r=s(n),a=r&&r(n),o=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[4]},{viewBox:"0 0 24 24"}],l={};for(let c=0;c<o.length;c+=1)l=$e(l,o[c]);return{c(){e=Ie("svg"),a&&a.c(),this.h()},l(c){e=Pe(c,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var u=F(e);a&&a.l(u),u.forEach(S),this.h()},h(){hn(e,l)},m(c,u){D(c,e,u),a&&a.m(e,null),t||(i=[X(e,"click",n[6]),X(e,"keydown",n[7]),X(e,"keyup",n[8]),X(e,"focus",n[9]),X(e,"blur",n[10]),X(e,"mouseenter",n[11]),X(e,"mouseleave",n[12]),X(e,"mouseover",n[13]),X(e,"mouseout",n[14])],t=!0)},p(c,[u]){r!==(r=s(c))&&(a&&a.d(1),a=r&&r(c),a&&(a.c(),a.m(e,null))),hn(e,l=Qn(o,[{xmlns:"http://www.w3.org/2000/svg"},u&32&&c[5],u&2&&{role:c[1]},u&1&&{width:c[0]},u&1&&{height:c[0]},u&4&&{fill:c[2]},u&16&&{"aria-label":c[4]},{viewBox:"0 0 24 24"}]))},i:Tt,o:Tt,d(c){c&&S(e),a&&a.d(),t=!1,kn(i)}}}function $M(n,e,t){const i=["size","role","color","variation","ariaLabel"];let s=Nt(e,i);const r=Et("iconCtx")??{};let{size:a=r.size||"24"}=e,{role:o=r.role||"img"}=e,{color:l=r.color||"currentColor"}=e,{variation:c=r.variation||"outlined"}=e,{ariaLabel:u="touch app"}=e;function d(p){ae.call(this,n,p)}function h(p){ae.call(this,n,p)}function f(p){ae.call(this,n,p)}function g(p){ae.call(this,n,p)}function v(p){ae.call(this,n,p)}function m(p){ae.call(this,n,p)}function _(p){ae.call(this,n,p)}function y(p){ae.call(this,n,p)}function b(p){ae.call(this,n,p)}return n.$$set=p=>{e=$e($e({},e),Wt(p)),t(5,s=Nt(e,i)),"size"in p&&t(0,a=p.size),"role"in p&&t(1,o=p.role),"color"in p&&t(2,l=p.color),"variation"in p&&t(3,c=p.variation),"ariaLabel"in p&&t(4,u=p.ariaLabel)},[a,o,l,c,u,s,d,h,f,g,v,m,_,y,b]}class ex extends Bt{constructor(e){super(),Vt(this,e,$M,ZM,Ft,{size:0,role:1,color:2,variation:3,ariaLabel:4})}}function tx(n){let e,t;return{c(){e=Ie("path"),t=Ie("path"),this.h()},l(i){e=Pe(i,"path",{d:!0,opacity:!0}),F(e).forEach(S),t=Pe(i,"path",{d:!0}),F(t).forEach(S),this.h()},h(){x(e,"d","M4.47 19h15.06L12 5.99 4.47 19zM13 18h-2v-2h2v2zm0-4h-2v-4h2v4z"),x(e,"opacity",".3"),x(t,"d","M1 21h22L12 2 1 21zm3.47-2L12 5.99 19.53 19H4.47zM11 16h2v2h-2zm0-6h2v4h-2z")},m(i,s){D(i,e,s),D(i,t,s)},d(i){i&&(S(e),S(t))}}}function nx(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function ix(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M4.47 21h15.06c1.54 0 2.5-1.67 1.73-3L13.73 4.99c-.77-1.33-2.69-1.33-3.46 0L2.74 18c-.77 1.33.19 3 1.73 3zM12 14c-.55 0-1-.45-1-1v-2c0-.55.45-1 1-1s1 .45 1 1v2c0 .55-.45 1-1 1zm1 4h-2v-2h2v2z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function sx(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function rx(n){let e;return{c(){e=Ie("path"),this.h()},l(t){e=Pe(t,"path",{d:!0}),F(e).forEach(S),this.h()},h(){x(e,"d","M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function ax(n){let e,t,i;function s(c,u){if(c[3]==="outlined")return rx;if(c[3]==="filled")return sx;if(c[3]==="round")return ix;if(c[3]==="sharp")return nx;if(c[3]==="two-tone")return tx}let r=s(n),a=r&&r(n),o=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[4]},{viewBox:"0 0 24 24"}],l={};for(let c=0;c<o.length;c+=1)l=$e(l,o[c]);return{c(){e=Ie("svg"),a&&a.c(),this.h()},l(c){e=Pe(c,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var u=F(e);a&&a.l(u),u.forEach(S),this.h()},h(){hn(e,l)},m(c,u){D(c,e,u),a&&a.m(e,null),t||(i=[X(e,"click",n[6]),X(e,"keydown",n[7]),X(e,"keyup",n[8]),X(e,"focus",n[9]),X(e,"blur",n[10]),X(e,"mouseenter",n[11]),X(e,"mouseleave",n[12]),X(e,"mouseover",n[13]),X(e,"mouseout",n[14])],t=!0)},p(c,[u]){r!==(r=s(c))&&(a&&a.d(1),a=r&&r(c),a&&(a.c(),a.m(e,null))),hn(e,l=Qn(o,[{xmlns:"http://www.w3.org/2000/svg"},u&32&&c[5],u&2&&{role:c[1]},u&1&&{width:c[0]},u&1&&{height:c[0]},u&4&&{fill:c[2]},u&16&&{"aria-label":c[4]},{viewBox:"0 0 24 24"}]))},i:Tt,o:Tt,d(c){c&&S(e),a&&a.d(),t=!1,kn(i)}}}function ox(n,e,t){const i=["size","role","color","variation","ariaLabel"];let s=Nt(e,i);const r=Et("iconCtx")??{};let{size:a=r.size||"24"}=e,{role:o=r.role||"img"}=e,{color:l=r.color||"currentColor"}=e,{variation:c=r.variation||"outlined"}=e,{ariaLabel:u="warning"}=e;function d(p){ae.call(this,n,p)}function h(p){ae.call(this,n,p)}function f(p){ae.call(this,n,p)}function g(p){ae.call(this,n,p)}function v(p){ae.call(this,n,p)}function m(p){ae.call(this,n,p)}function _(p){ae.call(this,n,p)}function y(p){ae.call(this,n,p)}function b(p){ae.call(this,n,p)}return n.$$set=p=>{e=$e($e({},e),Wt(p)),t(5,s=Nt(e,i)),"size"in p&&t(0,a=p.size),"role"in p&&t(1,o=p.role),"color"in p&&t(2,l=p.color),"variation"in p&&t(3,c=p.variation),"ariaLabel"in p&&t(4,u=p.ariaLabel)},[a,o,l,c,u,s,d,h,f,g,v,m,_,y,b]}class cx extends Bt{constructor(e){super(),Vt(this,e,ox,ax,Ft,{size:0,role:1,color:2,variation:3,ariaLabel:4})}}var o_={};function lx(n,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(i){if(i!=="default"&&!(i in n)){var s=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:function(){return t[i]}})}})}),Object.freeze(n)}var ux=Object.defineProperty,dx=(n,e,t)=>e in n?ux(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,c_=(n,e,t)=>dx(n,typeof e!="symbol"?e+"":e,t);class Hi{constructor(){c_(this,"_locking"),c_(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const t=new Promise(s=>e=()=>{this._locks-=1,s()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>t),i}}function Un(n,e){if(!n)throw new Error(e)}const hx=34028234663852886e22,fx=-34028234663852886e22,px=4294967295,mx=2147483647,gx=-2147483648;function cu(n){if(typeof n!="number")throw new Error("invalid int 32: "+typeof n);if(!Number.isInteger(n)||n>mx||n<gx)throw new Error("invalid int 32: "+n)}function hp(n){if(typeof n!="number")throw new Error("invalid uint 32: "+typeof n);if(!Number.isInteger(n)||n>px||n<0)throw new Error("invalid uint 32: "+n)}function By(n){if(typeof n!="number")throw new Error("invalid float 32: "+typeof n);if(Number.isFinite(n)&&(n>hx||n<fx))throw new Error("invalid float 32: "+n)}const Vy=Symbol("@bufbuild/protobuf/enum-type");function _x(n){const e=n[Vy];return Un(e,"missing enum type on enum object"),e}function Gy(n,e,t,i){n[Vy]=zy(e,t.map(s=>({no:s.no,name:s.name,localName:n[s.no]})))}function zy(n,e,t){const i=Object.create(null),s=Object.create(null),r=[];for(const a of e){const o=Hy(a);r.push(o),i[a.name]=o,s[a.no]=o}return{typeName:n,values:r,findName(a){return i[a]},findNumber(a){return s[a]}}}function vx(n,e,t){const i={};for(const s of e){const r=Hy(s);i[r.localName]=r.no,i[r.no]=r.localName}return Gy(i,n,e),i}function Hy(n){return"localName"in n?n:Object.assign(Object.assign({},n),{localName:n.name})}let sg=class{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const i=this.getType(),s=i.runtime.bin,r=s.makeReadOptions(t);return s.readMessage(this,r.readerFactory(e),e.byteLength,r),this}fromJson(e,t){const i=this.getType(),s=i.runtime.json,r=s.makeReadOptions(t);return s.readMessage(i,e,r,this),this}fromJsonString(e,t){let i;try{i=JSON.parse(e)}catch(s){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(s instanceof Error?s.message:String(s)))}return this.fromJson(i,t)}toBinary(e){const t=this.getType(),i=t.runtime.bin,s=i.makeWriteOptions(e),r=s.writerFactory();return i.writeMessage(this,r,s),r.finish()}toJson(e){const t=this.getType(),i=t.runtime.json,s=i.makeWriteOptions(e);return i.writeMessage(this,s)}toJsonString(e){var t;const i=this.toJson(e);return JSON.stringify(i,null,(t=e==null?void 0:e.prettySpaces)!==null&&t!==void 0?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}};function bx(n,e,t,i){var s;const r=(s=i==null?void 0:i.localName)!==null&&s!==void 0?s:e.substring(e.lastIndexOf(".")+1),a={[r]:function(o){n.util.initFields(this),n.util.initPartial(o,this)}}[r];return Object.setPrototypeOf(a.prototype,new sg),Object.assign(a,{runtime:n,typeName:e,fields:n.util.newFieldList(t),fromBinary(o,l){return new a().fromBinary(o,l)},fromJson(o,l){return new a().fromJson(o,l)},fromJsonString(o,l){return new a().fromJsonString(o,l)},equals(o,l){return n.util.equals(a,o,l)}}),a}function yx(){let n=0,e=0;for(let i=0;i<28;i+=7){let s=this.buf[this.pos++];if(n|=(s&127)<<i,!(s&128))return this.assertBounds(),[n,e]}let t=this.buf[this.pos++];if(n|=(t&15)<<28,e=(t&112)>>4,!(t&128))return this.assertBounds(),[n,e];for(let i=3;i<=31;i+=7){let s=this.buf[this.pos++];if(e|=(s&127)<<i,!(s&128))return this.assertBounds(),[n,e]}throw new Error("invalid varint")}function Gh(n,e,t){for(let r=0;r<28;r=r+7){const a=n>>>r,o=!(!(a>>>7)&&e==0),l=(o?a|128:a)&255;if(t.push(l),!o)return}const i=n>>>28&15|(e&7)<<4,s=!!(e>>3);if(t.push((s?i|128:i)&255),!!s){for(let r=3;r<31;r=r+7){const a=e>>>r,o=!!(a>>>7),l=(o?a|128:a)&255;if(t.push(l),!o)return}t.push(e>>>31&1)}}const lu=4294967296;function l_(n){const e=n[0]==="-";e&&(n=n.slice(1));const t=1e6;let i=0,s=0;function r(a,o){const l=Number(n.slice(a,o));s*=t,i=i*t+l,i>=lu&&(s=s+(i/lu|0),i=i%lu)}return r(-24,-18),r(-18,-12),r(-12,-6),r(-6),e?jy(i,s):rg(i,s)}function Tx(n,e){let t=rg(n,e);const i=t.hi&2147483648;i&&(t=jy(t.lo,t.hi));const s=Wy(t.lo,t.hi);return i?"-"+s:s}function Wy(n,e){if({lo:n,hi:e}=Sx(n,e),e<=2097151)return String(lu*e+n);const t=n&16777215,i=(n>>>24|e<<8)&16777215,s=e>>16&65535;let r=t+i*6777216+s*6710656,a=i+s*8147497,o=s*2;const l=1e7;return r>=l&&(a+=Math.floor(r/l),r%=l),a>=l&&(o+=Math.floor(a/l),a%=l),o.toString()+u_(a)+u_(r)}function Sx(n,e){return{lo:n>>>0,hi:e>>>0}}function rg(n,e){return{lo:n|0,hi:e|0}}function jy(n,e){return e=~e,n?n=~n+1:e+=1,rg(n,e)}const u_=n=>{const e=String(n);return"0000000".slice(e.length)+e};function d_(n,e){if(n>=0){for(;n>127;)e.push(n&127|128),n=n>>>7;e.push(n)}else{for(let t=0;t<9;t++)e.push(n&127|128),n=n>>7;e.push(1)}}function Ex(){let n=this.buf[this.pos++],e=n&127;if(!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<7,!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<14,!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<21,!(n&128))return this.assertBounds(),e;n=this.buf[this.pos++],e|=(n&15)<<28;for(let t=5;n&128&&t<10;t++)n=this.buf[this.pos++];if(n&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function Ax(){const n=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"&&(typeof process!="object"||typeof o_!="object"||o_.BUF_BIGINT_DISABLE!=="1")){const s=BigInt("-9223372036854775808"),r=BigInt("9223372036854775807"),a=BigInt("0"),o=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(l){const c=typeof l=="bigint"?l:BigInt(l);if(c>r||c<s)throw new Error("int64 invalid: ".concat(l));return c},uParse(l){const c=typeof l=="bigint"?l:BigInt(l);if(c>o||c<a)throw new Error("uint64 invalid: ".concat(l));return c},enc(l){return n.setBigInt64(0,this.parse(l),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},uEnc(l){return n.setBigInt64(0,this.uParse(l),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},dec(l,c){return n.setInt32(0,l,!0),n.setInt32(4,c,!0),n.getBigInt64(0,!0)},uDec(l,c){return n.setInt32(0,l,!0),n.setInt32(4,c,!0),n.getBigUint64(0,!0)}}}const t=s=>Un(/^-?[0-9]+$/.test(s),"int64 invalid: ".concat(s)),i=s=>Un(/^[0-9]+$/.test(s),"uint64 invalid: ".concat(s));return{zero:"0",supported:!1,parse(s){return typeof s!="string"&&(s=s.toString()),t(s),s},uParse(s){return typeof s!="string"&&(s=s.toString()),i(s),s},enc(s){return typeof s!="string"&&(s=s.toString()),t(s),l_(s)},uEnc(s){return typeof s!="string"&&(s=s.toString()),i(s),l_(s)},dec(s,r){return Tx(s,r)},uDec(s,r){return Wy(s,r)}}}const xn=Ax();var Re;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(Re||(Re={}));var Jr;(function(n){n[n.BIGINT=0]="BIGINT",n[n.STRING=1]="STRING"})(Jr||(Jr={}));function yr(n,e,t){if(e===t)return!0;if(n==Re.BYTES){if(!(e instanceof Uint8Array)||!(t instanceof Uint8Array)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}switch(n){case Re.UINT64:case Re.FIXED64:case Re.INT64:case Re.SFIXED64:case Re.SINT64:return e==t}return!1}function No(n,e){switch(n){case Re.BOOL:return!1;case Re.UINT64:case Re.FIXED64:case Re.INT64:case Re.SFIXED64:case Re.SINT64:return e==0?xn.zero:"0";case Re.DOUBLE:case Re.FLOAT:return 0;case Re.BYTES:return new Uint8Array(0);case Re.STRING:return"";default:return 0}}function Ky(n,e){switch(n){case Re.BOOL:return e===!1;case Re.STRING:return e==="";case Re.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var Gn;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32"})(Gn||(Gn={}));let Cx=class{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let s=0;s<this.chunks.length;s++)e+=this.chunks[s].length;let t=new Uint8Array(e),i=0;for(let s=0;s<this.chunks.length;s++)t.set(this.chunks[s],i),i+=this.chunks[s].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(hp(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return cu(e),d_(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){By(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){hp(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){cu(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return cu(e),e=(e<<1^e>>31)>>>0,d_(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),s=xn.enc(e);return i.setInt32(0,s.lo,!0),i.setInt32(4,s.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),s=xn.uEnc(e);return i.setInt32(0,s.lo,!0),i.setInt32(4,s.hi,!0),this.raw(t)}int64(e){let t=xn.enc(e);return Gh(t.lo,t.hi,this.buf),this}sint64(e){let t=xn.enc(e),i=t.hi>>31,s=t.lo<<1^i,r=(t.hi<<1|t.lo>>>31)^i;return Gh(s,r,this.buf),this}uint64(e){let t=xn.uEnc(e);return Gh(t.lo,t.hi,this.buf),this}},wx=class{constructor(e,t){this.varint64=yx,this.uint32=Ex,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t??new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,i=e&7;if(t<=0||i<0||i>5)throw new Error("illegal tag: field no "+t+" wire type "+i);return[t,i]}skip(e,t){let i=this.pos;switch(e){case Gn.Varint:for(;this.buf[this.pos++]&128;);break;case Gn.Bit64:this.pos+=4;case Gn.Bit32:this.pos+=4;break;case Gn.LengthDelimited:let s=this.uint32();this.pos+=s;break;case Gn.StartGroup:for(;;){const[r,a]=this.tag();if(a===Gn.EndGroup){if(t!==void 0&&r!==t)throw new Error("invalid end group tag");break}this.skip(a,r)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return xn.dec(...this.varint64())}uint64(){return xn.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),i=-(e&1);return e=(e>>>1|(t&1)<<31)^i,t=t>>>1^i,xn.dec(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return xn.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return xn.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}};function Rx(n,e,t,i){let s;return{typeName:e,extendee:t,get field(){if(!s){const r=typeof i=="function"?i():i;r.name=e.split(".").pop(),r.jsonName="[".concat(e,"]"),s=n.util.newFieldList([r]).list()[0]}return s},runtime:n}}function qy(n){const e=n.field.localName,t=Object.create(null);return t[e]=kx(n),[t,()=>t[e]]}function kx(n){const e=n.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return No(e.T,e.L);case"message":const t=e.T,i=new t;return t.fieldWrapper?t.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function Mx(n,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let t=n.length-1;t>=0;--t)if(n[t].no==e.no)return[n[t]];return[]}return n.filter(t=>t.no===e.no)}let sr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),_d=[];for(let n=0;n<sr.length;n++)_d[sr[n].charCodeAt(0)]=n;_d[45]=sr.indexOf("+");_d[95]=sr.indexOf("/");const Xy={dec(n){let e=n.length*3/4;n[n.length-2]=="="?e-=2:n[n.length-1]=="="&&(e-=1);let t=new Uint8Array(e),i=0,s=0,r,a=0;for(let o=0;o<n.length;o++){if(r=_d[n.charCodeAt(o)],r===void 0)switch(n[o]){case"=":s=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(s){case 0:a=r,s=1;break;case 1:t[i++]=a<<2|(r&48)>>4,a=r,s=2;break;case 2:t[i++]=(a&15)<<4|(r&60)>>2,a=r,s=3;break;case 3:t[i++]=(a&3)<<6|r,s=0;break}}if(s==1)throw Error("invalid base64 string.");return t.subarray(0,i)},enc(n){let e="",t=0,i,s=0;for(let r=0;r<n.length;r++)switch(i=n[r],t){case 0:e+=sr[i>>2],s=(i&3)<<4,t=1;break;case 1:e+=sr[s|i>>4],s=(i&15)<<2,t=2;break;case 2:e+=sr[s|i>>6],e+=sr[i&63],t=0;break}return t&&(e+=sr[s],e+="=",t==1&&(e+="=")),e}};function xx(n,e,t){Jy(e,n);const i=e.runtime.bin.makeReadOptions(t),s=Mx(n.getType().runtime.bin.listUnknownFields(n),e.field),[r,a]=qy(e);for(const o of s)e.runtime.bin.readField(r,i.readerFactory(o.data),e.field,o.wireType,i);return a()}function Ix(n,e,t,i){Jy(e,n);const s=e.runtime.bin.makeReadOptions(i),r=e.runtime.bin.makeWriteOptions(i);if(Yy(n,e)){const c=n.getType().runtime.bin.listUnknownFields(n).filter(u=>u.no!=e.field.no);n.getType().runtime.bin.discardUnknownFields(n);for(const u of c)n.getType().runtime.bin.onUnknownField(n,u.no,u.wireType,u.data)}const a=r.writerFactory();let o=e.field;!o.opt&&!o.repeated&&(o.kind=="enum"||o.kind=="scalar")&&(o=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(o,t,a,r);const l=s.readerFactory(a.finish());for(;l.pos<l.len;){const[c,u]=l.tag(),d=l.skip(u,c);n.getType().runtime.bin.onUnknownField(n,c,u,d)}}function Yy(n,e){const t=n.getType();return e.extendee.typeName===t.typeName&&!!t.runtime.bin.listUnknownFields(n).find(i=>i.no==e.field.no)}function Jy(n,e){Un(n.extendee.typeName==e.getType().typeName,"extension ".concat(n.typeName," can only be applied to message ").concat(n.extendee.typeName))}function Qy(n,e){const t=n.localName;if(n.repeated)return e[t].length>0;if(n.oneof)return e[n.oneof.localName].case===t;switch(n.kind){case"enum":case"scalar":return n.opt||n.req?e[t]!==void 0:n.kind=="enum"?e[t]!==n.T.values[0].no:!Ky(n.T,e[t]);case"message":return e[t]!==void 0;case"map":return Object.keys(e[t]).length>0}}function h_(n,e){const t=n.localName,i=!n.opt&&!n.req;if(n.repeated)e[t]=[];else if(n.oneof)e[n.oneof.localName]={case:void 0};else switch(n.kind){case"map":e[t]={};break;case"enum":e[t]=i?n.T.values[0].no:void 0;break;case"scalar":e[t]=i?No(n.T,n.L):void 0;break;case"message":e[t]=void 0;break}}function Ea(n,e){if(n===null||typeof n!="object"||!Object.getOwnPropertyNames(sg.prototype).every(i=>i in n&&typeof n[i]=="function"))return!1;const t=n.getType();return t===null||typeof t!="function"||!("typeName"in t)||typeof t.typeName!="string"?!1:e===void 0?!0:t.typeName==e.typeName}function Zy(n,e){return Ea(e)||!n.fieldWrapper?e:n.fieldWrapper.wrapField(e)}Re.DOUBLE,Re.FLOAT,Re.INT64,Re.UINT64,Re.INT32,Re.UINT32,Re.BOOL,Re.STRING,Re.BYTES;const f_={ignoreUnknownFields:!1},p_={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function Px(n){return n?Object.assign(Object.assign({},f_),n):f_}function Nx(n){return n?Object.assign(Object.assign({},p_),n):p_}const Wu=Symbol(),uu=Symbol();function Dx(){return{makeReadOptions:Px,makeWriteOptions:Nx,readMessage(n,e,t,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(n.typeName," from JSON: ").concat(Rs(e)));i=i??new n;const s=new Map,r=t.typeRegistry;for(const[a,o]of Object.entries(e)){const l=n.fields.findJsonName(a);if(l){if(l.oneof){if(o===null&&l.kind=="scalar")continue;const c=s.get(l.oneof);if(c!==void 0)throw new Error("cannot decode message ".concat(n.typeName,' from JSON: multiple keys for oneof "').concat(l.oneof.name,'" present: "').concat(c,'", "').concat(a,'"'));s.set(l.oneof,a)}m_(i,o,l,t,n)}else{let c=!1;if(r!=null&&r.findExtension&&a.startsWith("[")&&a.endsWith("]")){const u=r.findExtension(a.substring(1,a.length-1));if(u&&u.extendee.typeName==n.typeName){c=!0;const[d,h]=qy(u);m_(d,o,u.field,t,u),Ix(i,u,h(),t)}}if(!c&&!t.ignoreUnknownFields)throw new Error("cannot decode message ".concat(n.typeName,' from JSON: key "').concat(a,'" is unknown'))}}return i},writeMessage(n,e){const t=n.getType(),i={};let s;try{for(s of t.fields.byNumber()){if(!Qy(s,n)){if(s.req)throw"required field not set";if(!e.emitDefaultValues||!Ox(s))continue}const a=s.oneof?n[s.oneof.localName].value:n[s.localName],o=g_(s,a,e);o!==void 0&&(i[e.useProtoFieldName?s.name:s.jsonName]=o)}const r=e.typeRegistry;if(r!=null&&r.findExtensionFor)for(const a of t.runtime.bin.listUnknownFields(n)){const o=r.findExtensionFor(t.typeName,a.no);if(o&&Yy(n,o)){const l=xx(n,o,e),c=g_(o.field,l,e);c!==void 0&&(i[o.field.jsonName]=c)}}}catch(r){const a=s?"cannot encode field ".concat(t.typeName,".").concat(s.name," to JSON"):"cannot encode message ".concat(t.typeName," to JSON"),o=r instanceof Error?r.message:String(r);throw new Error(a+(o.length>0?": ".concat(o):""))}return i},readScalar(n,e,t){return Nc(n,e,t??Jr.BIGINT,!0)},writeScalar(n,e,t){if(e!==void 0&&(t||Ky(n,e)))return du(n,e)},debug:Rs}}function Rs(n){if(n===null)return"null";switch(typeof n){case"object":return Array.isArray(n)?"array":"object";case"string":return n.length>100?"string":'"'.concat(n.split('"').join('\\"'),'"');default:return String(n)}}function m_(n,e,t,i,s){let r=t.localName;if(t.repeated){if(Un(t.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(s.typeName,".").concat(t.name," from JSON: ").concat(Rs(e)));const a=n[r];for(const o of e){if(o===null)throw new Error("cannot decode field ".concat(s.typeName,".").concat(t.name," from JSON: ").concat(Rs(o)));switch(t.kind){case"message":a.push(t.T.fromJson(o,i));break;case"enum":const l=zh(t.T,o,i.ignoreUnknownFields,!0);l!==uu&&a.push(l);break;case"scalar":try{a.push(Nc(t.T,o,t.L,!0))}catch(c){let u="cannot decode field ".concat(s.typeName,".").concat(t.name," from JSON: ").concat(Rs(o));throw c instanceof Error&&c.message.length>0&&(u+=": ".concat(c.message)),new Error(u)}break}}}else if(t.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(s.typeName,".").concat(t.name," from JSON: ").concat(Rs(e)));const a=n[r];for(const[o,l]of Object.entries(e)){if(l===null)throw new Error("cannot decode field ".concat(s.typeName,".").concat(t.name," from JSON: map value null"));let c;try{c=Lx(t.K,o)}catch(u){let d="cannot decode map key for field ".concat(s.typeName,".").concat(t.name," from JSON: ").concat(Rs(e));throw u instanceof Error&&u.message.length>0&&(d+=": ".concat(u.message)),new Error(d)}switch(t.V.kind){case"message":a[c]=t.V.T.fromJson(l,i);break;case"enum":const u=zh(t.V.T,l,i.ignoreUnknownFields,!0);u!==uu&&(a[c]=u);break;case"scalar":try{a[c]=Nc(t.V.T,l,Jr.BIGINT,!0)}catch(d){let h="cannot decode map value for field ".concat(s.typeName,".").concat(t.name," from JSON: ").concat(Rs(e));throw d instanceof Error&&d.message.length>0&&(h+=": ".concat(d.message)),new Error(h)}break}}}else switch(t.oneof&&(n=n[t.oneof.localName]={case:r},r="value"),t.kind){case"message":const a=t.T;if(e===null&&a.typeName!="google.protobuf.Value")return;let o=n[r];Ea(o)?o.fromJson(e,i):(n[r]=o=a.fromJson(e,i),a.fieldWrapper&&!t.oneof&&(n[r]=a.fieldWrapper.unwrapField(o)));break;case"enum":const l=zh(t.T,e,i.ignoreUnknownFields,!1);switch(l){case Wu:h_(t,n);break;case uu:break;default:n[r]=l;break}break;case"scalar":try{const c=Nc(t.T,e,t.L,!1);switch(c){case Wu:h_(t,n);break;default:n[r]=c;break}}catch(c){let u="cannot decode field ".concat(s.typeName,".").concat(t.name," from JSON: ").concat(Rs(e));throw c instanceof Error&&c.message.length>0&&(u+=": ".concat(c.message)),new Error(u)}break}}function Lx(n,e){if(n===Re.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Nc(n,e,Jr.BIGINT,!0).toString()}function Nc(n,e,t,i){if(e===null)return i?No(n,t):Wu;switch(n){case Re.DOUBLE:case Re.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const s=Number(e);if(Number.isNaN(s)||!Number.isFinite(s))break;return n==Re.FLOAT&&By(s),s;case Re.INT32:case Re.FIXED32:case Re.SFIXED32:case Re.SINT32:case Re.UINT32:let r;if(typeof e=="number"?r=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(r=Number(e)),r===void 0)break;return n==Re.UINT32||n==Re.FIXED32?hp(r):cu(r),r;case Re.INT64:case Re.SFIXED64:case Re.SINT64:if(typeof e!="number"&&typeof e!="string")break;const a=xn.parse(e);return t?a.toString():a;case Re.FIXED64:case Re.UINT64:if(typeof e!="number"&&typeof e!="string")break;const o=xn.uParse(e);return t?o.toString():o;case Re.BOOL:if(typeof e!="boolean")break;return e;case Re.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case Re.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return Xy.dec(e)}throw new Error}function zh(n,e,t,i){if(e===null)return n.typeName=="google.protobuf.NullValue"?0:i?n.values[0].no:Wu;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const s=n.findName(e);if(s!==void 0)return s.no;if(t)return uu;break}throw new Error("cannot decode enum ".concat(n.typeName," from JSON: ").concat(Rs(e)))}function Ox(n){return n.repeated||n.kind=="map"?!0:!(n.oneof||n.kind=="message"||n.opt||n.req)}function g_(n,e,t){if(n.kind=="map"){Un(typeof e=="object"&&e!=null);const i={},s=Object.entries(e);switch(n.V.kind){case"scalar":for(const[a,o]of s)i[a.toString()]=du(n.V.T,o);break;case"message":for(const[a,o]of s)i[a.toString()]=o.toJson(t);break;case"enum":const r=n.V.T;for(const[a,o]of s)i[a.toString()]=Hh(r,o,t.enumAsInteger);break}return t.emitDefaultValues||s.length>0?i:void 0}if(n.repeated){Un(Array.isArray(e));const i=[];switch(n.kind){case"scalar":for(let s=0;s<e.length;s++)i.push(du(n.T,e[s]));break;case"enum":for(let s=0;s<e.length;s++)i.push(Hh(n.T,e[s],t.enumAsInteger));break;case"message":for(let s=0;s<e.length;s++)i.push(e[s].toJson(t));break}return t.emitDefaultValues||i.length>0?i:void 0}switch(n.kind){case"scalar":return du(n.T,e);case"enum":return Hh(n.T,e,t.enumAsInteger);case"message":return Zy(n.T,e).toJson(t)}}function Hh(n,e,t){var i;if(Un(typeof e=="number"),n.typeName=="google.protobuf.NullValue")return null;if(t)return e;const s=n.findNumber(e);return(i=s==null?void 0:s.name)!==null&&i!==void 0?i:e}function du(n,e){switch(n){case Re.INT32:case Re.SFIXED32:case Re.SINT32:case Re.FIXED32:case Re.UINT32:return Un(typeof e=="number"),e;case Re.FLOAT:case Re.DOUBLE:return Un(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case Re.STRING:return Un(typeof e=="string"),e;case Re.BOOL:return Un(typeof e=="boolean"),e;case Re.UINT64:case Re.FIXED64:case Re.INT64:case Re.SFIXED64:case Re.SINT64:return Un(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case Re.BYTES:return Un(e instanceof Uint8Array),Xy.enc(e)}}const za=Symbol("@bufbuild/protobuf/unknown-fields"),__={readUnknownFields:!0,readerFactory:n=>new wx(n)},v_={writeUnknownFields:!0,writerFactory:()=>new Cx};function Ux(n){return n?Object.assign(Object.assign({},__),n):__}function Fx(n){return n?Object.assign(Object.assign({},v_),n):v_}function Bx(){return{makeReadOptions:Ux,makeWriteOptions:Fx,listUnknownFields(n){var e;return(e=n[za])!==null&&e!==void 0?e:[]},discardUnknownFields(n){delete n[za]},writeUnknownFields(n,e){const i=n[za];if(i)for(const s of i)e.tag(s.no,s.wireType).raw(s.data)},onUnknownField(n,e,t,i){const s=n;Array.isArray(s[za])||(s[za]=[]),s[za].push({no:e,wireType:t,data:i})},readMessage(n,e,t,i,s){const r=n.getType(),a=s?e.len:e.pos+t;let o,l;for(;e.pos<a&&([o,l]=e.tag(),!(s===!0&&l==Gn.EndGroup));){const c=r.fields.find(o);if(!c){const u=e.skip(l,o);i.readUnknownFields&&this.onUnknownField(n,o,l,u);continue}b_(n,e,c,l,i)}if(s&&(l!=Gn.EndGroup||o!==t))throw new Error("invalid end group tag")},readField:b_,writeMessage(n,e,t){const i=n.getType();for(const s of i.fields.byNumber()){if(!Qy(s,n)){if(s.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(s.name," to binary: required field not set"));continue}const r=s.oneof?n[s.oneof.localName].value:n[s.localName];y_(s,r,e,t)}return t.writeUnknownFields&&this.writeUnknownFields(n,e),e},writeField(n,e,t,i){e!==void 0&&y_(n,e,t,i)}}}function b_(n,e,t,i,s){let{repeated:r,localName:a}=t;switch(t.oneof&&(n=n[t.oneof.localName],n.case!=a&&delete n.value,n.case=a,a="value"),t.kind){case"scalar":case"enum":const o=t.kind=="enum"?Re.INT32:t.T;let l=ju;if(t.kind=="scalar"&&t.L>0&&(l=Gx),r){let h=n[a];if(i==Gn.LengthDelimited&&o!=Re.STRING&&o!=Re.BYTES){let g=e.uint32()+e.pos;for(;e.pos<g;)h.push(l(e,o))}else h.push(l(e,o))}else n[a]=l(e,o);break;case"message":const c=t.T;r?n[a].push(hu(e,new c,s,t)):Ea(n[a])?hu(e,n[a],s,t):(n[a]=hu(e,new c,s,t),c.fieldWrapper&&!t.oneof&&!t.repeated&&(n[a]=c.fieldWrapper.unwrapField(n[a])));break;case"map":let[u,d]=Vx(t,e,s);n[a][u]=d;break}}function hu(n,e,t,i){const s=e.getType().runtime.bin,r=i==null?void 0:i.delimited;return s.readMessage(e,n,r?i.no:n.uint32(),t,r),e}function Vx(n,e,t){const i=e.uint32(),s=e.pos+i;let r,a;for(;e.pos<s;){const[o]=e.tag();switch(o){case 1:r=ju(e,n.K);break;case 2:switch(n.V.kind){case"scalar":a=ju(e,n.V.T);break;case"enum":a=e.int32();break;case"message":a=hu(e,new n.V.T,t,void 0);break}break}}if(r===void 0&&(r=No(n.K,Jr.BIGINT)),typeof r!="string"&&typeof r!="number"&&(r=r.toString()),a===void 0)switch(n.V.kind){case"scalar":a=No(n.V.T,Jr.BIGINT);break;case"enum":a=n.V.T.values[0].no;break;case"message":a=new n.V.T;break}return[r,a]}function Gx(n,e){const t=ju(n,e);return typeof t=="bigint"?t.toString():t}function ju(n,e){switch(e){case Re.STRING:return n.string();case Re.BOOL:return n.bool();case Re.DOUBLE:return n.double();case Re.FLOAT:return n.float();case Re.INT32:return n.int32();case Re.INT64:return n.int64();case Re.UINT64:return n.uint64();case Re.FIXED64:return n.fixed64();case Re.BYTES:return n.bytes();case Re.FIXED32:return n.fixed32();case Re.SFIXED32:return n.sfixed32();case Re.SFIXED64:return n.sfixed64();case Re.SINT64:return n.sint64();case Re.UINT32:return n.uint32();case Re.SINT32:return n.sint32()}}function y_(n,e,t,i){Un(e!==void 0);const s=n.repeated;switch(n.kind){case"scalar":case"enum":let r=n.kind=="enum"?Re.INT32:n.T;if(s)if(Un(Array.isArray(e)),n.packed)Hx(t,r,n.no,e);else for(const a of e)Dc(t,r,n.no,a);else Dc(t,r,n.no,e);break;case"message":if(s){Un(Array.isArray(e));for(const a of e)T_(t,i,n,a)}else T_(t,i,n,e);break;case"map":Un(typeof e=="object"&&e!=null);for(const[a,o]of Object.entries(e))zx(t,i,n,a,o);break}}function zx(n,e,t,i,s){n.tag(t.no,Gn.LengthDelimited),n.fork();let r=i;switch(t.K){case Re.INT32:case Re.FIXED32:case Re.UINT32:case Re.SFIXED32:case Re.SINT32:r=Number.parseInt(i);break;case Re.BOOL:Un(i=="true"||i=="false"),r=i=="true";break}switch(Dc(n,t.K,1,r),t.V.kind){case"scalar":Dc(n,t.V.T,2,s);break;case"enum":Dc(n,Re.INT32,2,s);break;case"message":Un(s!==void 0),n.tag(2,Gn.LengthDelimited).bytes(s.toBinary(e));break}n.join()}function T_(n,e,t,i){const s=Zy(t.T,i);t.delimited?n.tag(t.no,Gn.StartGroup).raw(s.toBinary(e)).tag(t.no,Gn.EndGroup):n.tag(t.no,Gn.LengthDelimited).bytes(s.toBinary(e))}function Dc(n,e,t,i){Un(i!==void 0);let[s,r]=$y(e);n.tag(t,s)[r](i)}function Hx(n,e,t,i){if(!i.length)return;n.tag(t,Gn.LengthDelimited).fork();let[,s]=$y(e);for(let r=0;r<i.length;r++)n[s](i[r]);n.join()}function $y(n){let e=Gn.Varint;switch(n){case Re.BYTES:case Re.STRING:e=Gn.LengthDelimited;break;case Re.DOUBLE:case Re.FIXED64:case Re.SFIXED64:e=Gn.Bit64;break;case Re.FIXED32:case Re.SFIXED32:case Re.FLOAT:e=Gn.Bit32;break}const t=Re[n].toLowerCase();return[e,t]}function Wx(){return{setEnumType:Gy,initPartial(n,e){if(n===void 0)return;const t=e.getType();for(const i of t.fields.byMember()){const s=i.localName,r=e,a=n;if(a[s]!=null)switch(i.kind){case"oneof":const o=a[s].case;if(o===void 0)continue;const l=i.findField(o);let c=a[s].value;l&&l.kind=="message"&&!Ea(c,l.T)?c=new l.T(c):l&&l.kind==="scalar"&&l.T===Re.BYTES&&(c=sc(c)),r[s]={case:o,value:c};break;case"scalar":case"enum":let u=a[s];i.T===Re.BYTES&&(u=i.repeated?u.map(sc):sc(u)),r[s]=u;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===Re.BYTES)for(const[f,g]of Object.entries(a[s]))r[s][f]=sc(g);else Object.assign(r[s],a[s]);break;case"message":const h=i.V.T;for(const f of Object.keys(a[s])){let g=a[s][f];h.fieldWrapper||(g=new h(g)),r[s][f]=g}break}break;case"message":const d=i.T;if(i.repeated)r[s]=a[s].map(h=>Ea(h,d)?h:new d(h));else{const h=a[s];d.fieldWrapper?d.typeName==="google.protobuf.BytesValue"?r[s]=sc(h):r[s]=h:r[s]=Ea(h,d)?h:new d(h)}break}}},equals(n,e,t){return e===t?!0:!e||!t?!1:n.fields.byMember().every(i=>{const s=e[i.localName],r=t[i.localName];if(i.repeated){if(s.length!==r.length)return!1;switch(i.kind){case"message":return s.every((a,o)=>i.T.equals(a,r[o]));case"scalar":return s.every((a,o)=>yr(i.T,a,r[o]));case"enum":return s.every((a,o)=>yr(Re.INT32,a,r[o]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":return i.T.equals(s,r);case"enum":return yr(Re.INT32,s,r);case"scalar":return yr(i.T,s,r);case"oneof":if(s.case!==r.case)return!1;const a=i.findField(s.case);if(a===void 0)return!0;switch(a.kind){case"message":return a.T.equals(s.value,r.value);case"enum":return yr(Re.INT32,s.value,r.value);case"scalar":return yr(a.T,s.value,r.value)}throw new Error("oneof cannot contain ".concat(a.kind));case"map":const o=Object.keys(s).concat(Object.keys(r));switch(i.V.kind){case"message":const l=i.V.T;return o.every(u=>l.equals(s[u],r[u]));case"enum":return o.every(u=>yr(Re.INT32,s[u],r[u]));case"scalar":const c=i.V.T;return o.every(u=>yr(c,s[u],r[u]))}break}})},clone(n){const e=n.getType(),t=new e,i=t;for(const s of e.fields.byMember()){const r=n[s.localName];let a;if(s.repeated)a=r.map(bl);else if(s.kind=="map"){a=i[s.localName];for(const[o,l]of Object.entries(r))a[o]=bl(l)}else s.kind=="oneof"?a=s.findField(r.case)?{case:r.case,value:bl(r.value)}:{case:void 0}:a=bl(r);i[s.localName]=a}for(const s of e.runtime.bin.listUnknownFields(n))e.runtime.bin.onUnknownField(i,s.no,s.wireType,s.data);return t}}}function bl(n){if(n===void 0)return n;if(Ea(n))return n.clone();if(n instanceof Uint8Array){const e=new Uint8Array(n.byteLength);return e.set(n),e}return n}function sc(n){return n instanceof Uint8Array?n:new Uint8Array(n)}function jx(n,e,t){return{syntax:n,json:Dx(),bin:Bx(),util:Object.assign(Object.assign({},Wx()),{newFieldList:e,initFields:t}),makeMessageType(i,s,r){return bx(this,i,s,r)},makeEnum:vx,makeEnumType:zy,getEnumType:_x,makeExtension(i,s,r){return Rx(this,i,s,r)}}}let Kx=class{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const t={};for(const i of this.list())t[i.jsonName]=t[i.name]=i;this.jsonNames=t}return this.jsonNames[e]}find(e){if(!this.numbers){const t={};for(const i of this.list())t[i.no]=i;this.numbers=t}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const i of this.list())i.oneof?i.oneof!==t&&(t=i.oneof,e.push(t)):e.push(i)}return this.members}};function eT(n,e){const t=tT(n);return e?t:Zx(Qx(t))}function qx(n){return eT(n,!1)}const Xx=tT;function tT(n){let e=!1;const t=[];for(let i=0;i<n.length;i++){let s=n.charAt(i);switch(s){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":t.push(s),e=!1;break;default:e&&(e=!1,s=s.toUpperCase()),t.push(s);break}}return t.join("")}const Yx=new Set(["constructor","toString","toJSON","valueOf"]),Jx=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),nT=n=>"".concat(n,"$"),Qx=n=>Jx.has(n)?nT(n):n,Zx=n=>Yx.has(n)?nT(n):n;let $x=class{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=qx(e)}addField(e){Un(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let t=0;t<this.fields.length;t++)this._lookup[this.fields[t].localName]=this.fields[t]}return this._lookup[e]}};function e2(n,e){var t,i,s,r,a,o;const l=[];let c;for(const u of typeof n=="function"?n():n){const d=u;if(d.localName=eT(u.name,u.oneof!==void 0),d.jsonName=(t=u.jsonName)!==null&&t!==void 0?t:Xx(u.name),d.repeated=(i=u.repeated)!==null&&i!==void 0?i:!1,u.kind=="scalar"&&(d.L=(s=u.L)!==null&&s!==void 0?s:Jr.BIGINT),d.delimited=(r=u.delimited)!==null&&r!==void 0?r:!1,d.req=(a=u.req)!==null&&a!==void 0?a:!1,d.opt=(o=u.opt)!==null&&o!==void 0?o:!1,u.packed===void 0&&(d.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=Re.BYTES&&u.T!=Re.STRING),u.oneof!==void 0){const h=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!c||c.name!=h)&&(c=new $x(h)),d.oneof=c,c.addField(d)}l.push(d)}return l}const he=jx("proto3",n=>new Kx(n,e=>e2(e)),n=>{for(const e of n.getType().fields.byMember()){if(e.opt)continue;const t=e.localName,i=n;if(e.repeated){i[t]=[];continue}switch(e.kind){case"oneof":i[t]={case:void 0};break;case"enum":i[t]=0;break;case"map":i[t]={};break;case"scalar":i[t]=No(e.T,e.L);break}}});class Mi extends sg{constructor(e){super(),this.seconds=xn.zero,this.nanos=0,he.util.initPartial(e,this)}fromJson(e,t){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(he.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const s=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(s))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(s<Date.parse("0001-01-01T00:00:00Z")||s>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=xn.parse(s/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const t=Number(this.seconds)*1e3;if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const s=(this.nanos+1e9).toString().substring(1);s.substring(3)==="000000"?i="."+s.substring(0,3)+"Z":s.substring(6)==="000"?i="."+s.substring(0,6)+"Z":i="."+s+"Z"}return new Date(t).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Mi.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new Mi({seconds:xn.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return new Mi().fromBinary(e,t)}static fromJson(e,t){return new Mi().fromJson(e,t)}static fromJsonString(e,t){return new Mi().fromJsonString(e,t)}static equals(e,t){return he.util.equals(Mi,e,t)}}Mi.runtime=he;Mi.typeName="google.protobuf.Timestamp";Mi.fields=he.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const t2=he.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Mi},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:n2,repeated:!0},{no:5,name:"events",kind:"message",T:s2,repeated:!0}]),n2=he.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:i2,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),i2=he.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Mi},{no:3,name:"value",kind:"scalar",T:2}]),s2=he.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Mi},{no:7,name:"normalized_end_timestamp",kind:"message",T:Mi,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),iT=he.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"REGRESSION"},{no:1,name:"SIMULCAST"}]),ps=he.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),pi=he.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),ag=he.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Rc=he.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Kc=he.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Kn=he.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"}]),Ha=he.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),r2=he.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Ms=he.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"}]),og=he.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Ku,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:mT}]),Ku=he.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),a2=he.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:he.getEnumType(pi),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),qc=he.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:he.getEnumType(fp)},{no:4,name:"tracks",kind:"message",T:fo,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:a2},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:he.getEnumType(qu)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:he.getEnumType(Kn)}]),fp=he.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),qu=he.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),Bi=he.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),o2=he.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Aa,repeated:!0}]),fo=he.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:he.getEnumType(ps)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:he.getEnumType(pi)},{no:10,name:"layers",kind:"message",T:Aa,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:o2,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:he.getEnumType(Bi)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:mT},{no:19,name:"audio_features",kind:"enum",T:he.getEnumType(Ms),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:he.getEnumType(iT)}]),Aa=he.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:he.getEnumType(ag)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]),ki=he.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:he.getEnumType(Jt)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:rT,oneof:"value"},{no:3,name:"speaker",kind:"message",T:c2,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:aT,oneof:"value"},{no:7,name:"transcription",kind:"message",T:l2,oneof:"value"},{no:8,name:"metrics",kind:"message",T:t2,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:pp,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:oT,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:cT,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:lT,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:gp,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:_p,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:vp,oneof:"value"}]),Jt=he.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),c2=he.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:sT,repeated:!0}]),sT=he.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),rT=he.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),aT=he.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),l2=he.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:u2,repeated:!0}]),u2=he.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),pp=he.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),oT=he.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),cT=he.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),lT=he.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:uT,oneof:"value"}]),uT=he.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),dT=he.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),d2=he.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:he.getEnumType(hT)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),hT=he.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),h2=he.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:he.getEnumType(fT)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),fT=he.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"}]),pT=he.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:S_},{no:2,name:"screen",kind:"message",T:S_},{no:3,name:"resume_connection",kind:"enum",T:he.getEnumType(Kc)},{no:4,name:"disabled_codecs",kind:"message",T:f2},{no:5,name:"force_relay",kind:"enum",T:he.getEnumType(Kc)}]),S_=he.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:he.getEnumType(Kc)}]),f2=he.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Ku,repeated:!0},{no:2,name:"publish",kind:"message",T:Ku,repeated:!0}]),mT=he.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),mp=he.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),gT=he.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:he.getEnumType(mp)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),_T=he.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),gp=he.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:he.getEnumType(Bi)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:gT,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:_T,oneof:"content_header"}],{localName:"DataStream_Header"}),_p=he.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),vp=he.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),ms=he.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),bp=he.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),p2=he.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),m2=he.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:Ra,oneof:"message"},{no:2,name:"answer",kind:"message",T:Ra,oneof:"message"},{no:3,name:"trickle",kind:"message",T:cg,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Tp,oneof:"message"},{no:5,name:"mute",kind:"message",T:lg,oneof:"message"},{no:6,name:"subscription",kind:"message",T:vd,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:vT,oneof:"message"},{no:8,name:"leave",kind:"message",T:bd,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:yT,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:AT,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:CT,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Cs,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:TT,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:RT,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:bT,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:y2,oneof:"message"}]),E_=he.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:g2,oneof:"message"},{no:2,name:"answer",kind:"message",T:Ra,oneof:"message"},{no:3,name:"offer",kind:"message",T:Ra,oneof:"message"},{no:4,name:"trickle",kind:"message",T:cg,oneof:"message"},{no:5,name:"update",kind:"message",T:b2,oneof:"message"},{no:6,name:"track_published",kind:"message",T:ug,oneof:"message"},{no:8,name:"leave",kind:"message",T:bd,oneof:"message"},{no:9,name:"mute",kind:"message",T:lg,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:T2,oneof:"message"},{no:11,name:"room_update",kind:"message",T:S2,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:A2,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:w2,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:k2,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:M2,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:v2,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:_2,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:x2,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:N2,oneof:"message"},{no:22,name:"request_response",kind:"message",T:D2,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:L2,oneof:"message"}]),yp=he.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),Tp=he.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:he.getEnumType(ps)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:he.getEnumType(pi)},{no:9,name:"layers",kind:"message",T:Aa,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:yp,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:he.getEnumType(Bi)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:he.getEnumType(iT)}]),cg=he.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:he.getEnumType(ms)},{no:3,name:"final",kind:"scalar",T:8}]),lg=he.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),g2=he.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:og},{no:2,name:"participant",kind:"message",T:qc},{no:3,name:"other_participants",kind:"message",T:qc,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:ST,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:pT},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:d2},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Ku,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),_2=he.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:ST,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:pT}]),ug=he.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:fo}]),v2=he.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Ra=he.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9}]),b2=he.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:qc,repeated:!0}]),vd=he.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:dT,repeated:!0}]),vT=he.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:he.getEnumType(ag)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),bT=he.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:he.getEnumType(Ms),repeated:!0}]),y2=he.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),bd=he.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:he.getEnumType(Kn)},{no:3,name:"action",kind:"enum",T:he.getEnumType(yo)},{no:4,name:"regions",kind:"message",T:I2}]),yo=he.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),yT=he.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Aa,repeated:!0}]),TT=he.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),ST=he.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),T2=he.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:sT,repeated:!0}]),S2=he.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:og}]),E2=he.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:he.getEnumType(Rc)},{no:3,name:"score",kind:"scalar",T:2}]),A2=he.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:E2,repeated:!0}]),C2=he.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:he.getEnumType(bp)}]),w2=he.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:C2,repeated:!0}]),dg=he.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:he.getEnumType(ag)},{no:2,name:"enabled",kind:"scalar",T:8}]),R2=he.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:dg,repeated:!0}]),k2=he.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:dg,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:R2,repeated:!0}]),ET=he.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),AT=he.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:ET,repeated:!0}]),M2=he.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),CT=he.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:Ra},{no:2,name:"subscription",kind:"message",T:vd},{no:3,name:"publish_tracks",kind:"message",T:ug,repeated:!0},{no:4,name:"data_channels",kind:"message",T:wT,repeated:!0},{no:5,name:"offer",kind:"message",T:Ra},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0}]),wT=he.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:he.getEnumType(ms)}]),Cs=he.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:he.getEnumType(p2),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),RT=he.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),x2=he.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),I2=he.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:P2,repeated:!0}]),P2=he.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),N2=he.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:he.getEnumType(r2)}]),D2=he.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:he.getEnumType(hg)},{no:3,name:"message",kind:"scalar",T:9}]),hg=he.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),L2=he.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);function O2(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var fu={exports:{}},U2=fu.exports,A_;function F2(){return A_||(A_=1,function(n){(function(e,t){n.exports?n.exports=t():e.log=t()})(U2,function(){var e=function(){},t="undefined",i=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),s=["trace","debug","info","warn","error"],r={},a=null;function o(v,m){var _=v[m];if(typeof _.bind=="function")return _.bind(v);try{return Function.prototype.bind.call(_,v)}catch{return function(){return Function.prototype.apply.apply(_,[v,arguments])}}}function l(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(v){return v==="debug"&&(v="log"),typeof console===t?!1:v==="trace"&&i?l:console[v]!==void 0?o(console,v):console.log!==void 0?o(console,"log"):e}function u(){for(var v=this.getLevel(),m=0;m<s.length;m++){var _=s[m];this[_]=m<v?e:this.methodFactory(_,v,this.name)}if(this.log=this.debug,typeof console===t&&v<this.levels.SILENT)return"No console available for logging"}function d(v){return function(){typeof console!==t&&(u.call(this),this[v].apply(this,arguments))}}function h(v,m,_){return c(v)||d.apply(this,arguments)}function f(v,m){var _=this,y,b,p,w="loglevel";typeof v=="string"?w+=":"+v:typeof v=="symbol"&&(w=void 0);function E(R){var V=(s[R]||"silent").toUpperCase();if(!(typeof window===t||!w)){try{window.localStorage[w]=V;return}catch{}try{window.document.cookie=encodeURIComponent(w)+"="+V+";"}catch{}}}function C(){var R;if(!(typeof window===t||!w)){try{R=window.localStorage[w]}catch{}if(typeof R===t)try{var V=window.document.cookie,H=encodeURIComponent(w),B=V.indexOf(H+"=");B!==-1&&(R=/^([^;]+)/.exec(V.slice(B+H.length+1))[1])}catch{}return _.levels[R]===void 0&&(R=void 0),R}}function M(){if(!(typeof window===t||!w)){try{window.localStorage.removeItem(w)}catch{}try{window.document.cookie=encodeURIComponent(w)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function I(R){var V=R;if(typeof V=="string"&&_.levels[V.toUpperCase()]!==void 0&&(V=_.levels[V.toUpperCase()]),typeof V=="number"&&V>=0&&V<=_.levels.SILENT)return V;throw new TypeError("log.setLevel() called with invalid level: "+R)}_.name=v,_.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},_.methodFactory=m||h,_.getLevel=function(){return p??b??y},_.setLevel=function(R,V){return p=I(R),V!==!1&&E(p),u.call(_)},_.setDefaultLevel=function(R){b=I(R),C()||_.setLevel(R,!1)},_.resetLevel=function(){p=null,M(),u.call(_)},_.enableAll=function(R){_.setLevel(_.levels.TRACE,R)},_.disableAll=function(R){_.setLevel(_.levels.SILENT,R)},_.rebuild=function(){if(a!==_&&(y=I(a.getLevel())),u.call(_),a===_)for(var R in r)r[R].rebuild()},y=I(a?a.getLevel():"WARN");var T=C();T!=null&&(p=I(T)),u.call(_)}a=new f,a.getLogger=function(m){if(typeof m!="symbol"&&typeof m!="string"||m==="")throw new TypeError("You must supply a name when creating a logger.");var _=r[m];return _||(_=r[m]=new f(m,a.methodFactory)),_};var g=typeof window!==t?window.log:void 0;return a.noConflict=function(){return typeof window!==t&&window.log===a&&(window.log=g),a},a.getLoggers=function(){return r},a.default=a,a})}(fu)),fu.exports}var yd=F2(),Sp;(function(n){n[n.trace=0]="trace",n[n.debug=1]="debug",n[n.info=2]="info",n[n.warn=3]="warn",n[n.error=4]="error",n[n.silent=5]="silent"})(Sp||(Sp={}));var ys;(function(n){n.Default="livekit",n.Room="livekit-room",n.Participant="livekit-participant",n.Track="livekit-track",n.Publication="livekit-track-publication",n.Engine="livekit-engine",n.Signal="livekit-signal",n.PCManager="livekit-pc-manager",n.PCTransport="livekit-pc-transport",n.E2EE="lk-e2ee"})(ys||(ys={}));let Ht=yd.getLogger("livekit");Object.values(ys).map(n=>yd.getLogger(n));Ht.setDefaultLevel(Sp.info);function hr(n){const e=yd.getLogger(n);return e.setDefaultLevel(Ht.getLevel()),e}const B2=yd.getLogger("lk-e2ee"),rc=7e3,V2=[0,300,2*2*300,3*3*300,4*4*300,rc,rc,rc,rc,rc];class fg{constructor(e){this._retryDelays=e!==void 0?[...e]:V2}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+Math.random()*1e3}}function G2(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(n);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(n,i[s])&&(t[i[s]]=n[i[s]]);return t}function G(n,e,t,i){function s(r){return r instanceof t?r:new t(function(a){a(r)})}return new(t||(t=Promise))(function(r,a){function o(u){try{c(i.next(u))}catch(d){a(d)}}function l(u){try{c(i.throw(u))}catch(d){a(d)}}function c(u){u.done?r(u.value):s(u.value).then(o,l)}c((i=i.apply(n,e||[])).next())})}function C_(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ur(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof C_=="function"?C_(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(r){t[r]=n[r]&&function(a){return new Promise(function(o,l){a=n[r](a),s(o,l,a.done,a.value)})}}function s(r,a,o,l){Promise.resolve(l).then(function(c){r({value:c,done:o})},a)}}var yl={exports:{}},w_;function z2(){if(w_)return yl.exports;w_=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(w,E,C){return Function.prototype.apply.call(w,E,C)},t;n&&typeof n.ownKeys=="function"?t=n.ownKeys:Object.getOwnPropertySymbols?t=function(w){return Object.getOwnPropertyNames(w).concat(Object.getOwnPropertySymbols(w))}:t=function(w){return Object.getOwnPropertyNames(w)};function i(p){console&&console.warn&&console.warn(p)}var s=Number.isNaN||function(w){return w!==w};function r(){r.init.call(this)}yl.exports=r,yl.exports.once=_,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var a=10;function o(p){if(typeof p!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof p)}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(p){if(typeof p!="number"||p<0||s(p))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+p+".");a=p}}),r.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(w){if(typeof w!="number"||w<0||s(w))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+w+".");return this._maxListeners=w,this};function l(p){return p._maxListeners===void 0?r.defaultMaxListeners:p._maxListeners}r.prototype.getMaxListeners=function(){return l(this)},r.prototype.emit=function(w){for(var E=[],C=1;C<arguments.length;C++)E.push(arguments[C]);var M=w==="error",I=this._events;if(I!==void 0)M=M&&I.error===void 0;else if(!M)return!1;if(M){var T;if(E.length>0&&(T=E[0]),T instanceof Error)throw T;var R=new Error("Unhandled error."+(T?" ("+T.message+")":""));throw R.context=T,R}var V=I[w];if(V===void 0)return!1;if(typeof V=="function")e(V,this,E);else for(var H=V.length,B=g(V,H),C=0;C<H;++C)e(B[C],this,E);return!0};function c(p,w,E,C){var M,I,T;if(o(E),I=p._events,I===void 0?(I=p._events=Object.create(null),p._eventsCount=0):(I.newListener!==void 0&&(p.emit("newListener",w,E.listener?E.listener:E),I=p._events),T=I[w]),T===void 0)T=I[w]=E,++p._eventsCount;else if(typeof T=="function"?T=I[w]=C?[E,T]:[T,E]:C?T.unshift(E):T.push(E),M=l(p),M>0&&T.length>M&&!T.warned){T.warned=!0;var R=new Error("Possible EventEmitter memory leak detected. "+T.length+" "+String(w)+" listeners added. Use emitter.setMaxListeners() to increase limit");R.name="MaxListenersExceededWarning",R.emitter=p,R.type=w,R.count=T.length,i(R)}return p}r.prototype.addListener=function(w,E){return c(this,w,E,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(w,E){return c(this,w,E,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(p,w,E){var C={fired:!1,wrapFn:void 0,target:p,type:w,listener:E},M=u.bind(C);return M.listener=E,C.wrapFn=M,M}r.prototype.once=function(w,E){return o(E),this.on(w,d(this,w,E)),this},r.prototype.prependOnceListener=function(w,E){return o(E),this.prependListener(w,d(this,w,E)),this},r.prototype.removeListener=function(w,E){var C,M,I,T,R;if(o(E),M=this._events,M===void 0)return this;if(C=M[w],C===void 0)return this;if(C===E||C.listener===E)--this._eventsCount===0?this._events=Object.create(null):(delete M[w],M.removeListener&&this.emit("removeListener",w,C.listener||E));else if(typeof C!="function"){for(I=-1,T=C.length-1;T>=0;T--)if(C[T]===E||C[T].listener===E){R=C[T].listener,I=T;break}if(I<0)return this;I===0?C.shift():v(C,I),C.length===1&&(M[w]=C[0]),M.removeListener!==void 0&&this.emit("removeListener",w,R||E)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(w){var E,C,M;if(C=this._events,C===void 0)return this;if(C.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):C[w]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete C[w]),this;if(arguments.length===0){var I=Object.keys(C),T;for(M=0;M<I.length;++M)T=I[M],T!=="removeListener"&&this.removeAllListeners(T);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(E=C[w],typeof E=="function")this.removeListener(w,E);else if(E!==void 0)for(M=E.length-1;M>=0;M--)this.removeListener(w,E[M]);return this};function h(p,w,E){var C=p._events;if(C===void 0)return[];var M=C[w];return M===void 0?[]:typeof M=="function"?E?[M.listener||M]:[M]:E?m(M):g(M,M.length)}r.prototype.listeners=function(w){return h(this,w,!0)},r.prototype.rawListeners=function(w){return h(this,w,!1)},r.listenerCount=function(p,w){return typeof p.listenerCount=="function"?p.listenerCount(w):f.call(p,w)},r.prototype.listenerCount=f;function f(p){var w=this._events;if(w!==void 0){var E=w[p];if(typeof E=="function")return 1;if(E!==void 0)return E.length}return 0}r.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function g(p,w){for(var E=new Array(w),C=0;C<w;++C)E[C]=p[C];return E}function v(p,w){for(;w+1<p.length;w++)p[w]=p[w+1];p.pop()}function m(p){for(var w=new Array(p.length),E=0;E<w.length;++E)w[E]=p[E].listener||p[E];return w}function _(p,w){return new Promise(function(E,C){function M(T){p.removeListener(w,I),C(T)}function I(){typeof p.removeListener=="function"&&p.removeListener("error",M),E([].slice.call(arguments))}b(p,w,I,{once:!0}),w!=="error"&&y(p,M,{once:!0})})}function y(p,w,E){typeof p.on=="function"&&b(p,"error",w,E)}function b(p,w,E,C){if(typeof p.on=="function")C.once?p.once(w,E):p.on(w,E);else if(typeof p.addEventListener=="function")p.addEventListener(w,function M(I){C.once&&p.removeEventListener(w,M),E(I)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof p)}return yl.exports}var Fs=z2();let kT=!0,MT=!0;function pu(n,e,t){const i=n.match(e);return i&&i.length>=t&&parseInt(i[t],10)}function Oa(n,e,t){if(!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype,s=i.addEventListener;i.addEventListener=function(a,o){if(a!==e)return s.apply(this,arguments);const l=c=>{const u=t(c);u&&(o.handleEvent?o.handleEvent(u):o(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(o,l),s.apply(this,[a,l])};const r=i.removeEventListener;i.removeEventListener=function(a,o){if(a!==e||!this._eventMap||!this._eventMap[e])return r.apply(this,arguments);if(!this._eventMap[e].has(o))return r.apply(this,arguments);const l=this._eventMap[e].get(o);return this._eventMap[e].delete(o),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,r.apply(this,[a,l])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(a){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),a&&this.addEventListener(e,this["_on"+e]=a)},enumerable:!0,configurable:!0})}function H2(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(kT=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function W2(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(MT=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function xT(){if(typeof window=="object"){if(kT)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function pg(n,e){MT&&console.warn(n+" is deprecated, please use "+e+" instead.")}function j2(n){const e={browser:null,version:null};if(typeof n>"u"||!n.navigator||!n.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:t}=n;if(t.userAgentData&&t.userAgentData.brands){const i=t.userAgentData.brands.find(s=>s.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(t.mozGetUserMedia)e.browser="firefox",e.version=pu(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection)e.browser="chrome",e.version=pu(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=pu(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function R_(n){return Object.prototype.toString.call(n)==="[object Object]"}function IT(n){return R_(n)?Object.keys(n).reduce(function(e,t){const i=R_(n[t]),s=i?IT(n[t]):n[t],r=i&&!Object.keys(s).length;return s===void 0||r?e:Object.assign(e,{[t]:s})},{}):n}function Ep(n,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?Ep(n,n.get(e[i]),t):i.endsWith("Ids")&&e[i].forEach(s=>{Ep(n,n.get(s),t)})}))}function k_(n,e,t){const i=t?"outbound-rtp":"inbound-rtp",s=new Map;if(e===null)return s;const r=[];return n.forEach(a=>{a.type==="track"&&a.trackIdentifier===e.id&&r.push(a)}),r.forEach(a=>{n.forEach(o=>{o.type===i&&o.trackId===a.id&&Ep(n,o,s)})}),s}const M_=xT;function PT(n,e){const t=n&&n.navigator;if(!t.mediaDevices)return;const i=function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;const l={};return Object.keys(o).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;const u=typeof o[c]=="object"?o[c]:{ideal:o[c]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(h,f){return h?h+f.charAt(0).toUpperCase()+f.slice(1):f==="deviceId"?"sourceId":f};if(u.ideal!==void 0){l.optional=l.optional||[];let h={};typeof u.ideal=="number"?(h[d("min",c)]=u.ideal,l.optional.push(h),h={},h[d("max",c)]=u.ideal,l.optional.push(h)):(h[d("",c)]=u.ideal,l.optional.push(h))}u.exact!==void 0&&typeof u.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[d("",c)]=u.exact):["min","max"].forEach(h=>{u[h]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[d(h,c)]=u[h])})}),o.advanced&&(l.optional=(l.optional||[]).concat(o.advanced)),l},s=function(o,l){if(e.version>=61)return l(o);if(o=JSON.parse(JSON.stringify(o)),o&&typeof o.audio=="object"){const c=function(u,d,h){d in u&&!(h in u)&&(u[h]=u[d],delete u[d])};o=JSON.parse(JSON.stringify(o)),c(o.audio,"autoGainControl","googAutoGainControl"),c(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=i(o.audio)}if(o&&typeof o.video=="object"){let c=o.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});const u=e.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete o.video.facingMode;let d;if(c.exact==="environment"||c.ideal==="environment"?d=["back","rear"]:(c.exact==="user"||c.ideal==="user")&&(d=["front"]),d)return t.mediaDevices.enumerateDevices().then(h=>{h=h.filter(g=>g.kind==="videoinput");let f=h.find(g=>d.some(v=>g.label.toLowerCase().includes(v)));return!f&&h.length&&d.includes("back")&&(f=h[h.length-1]),f&&(o.video.deviceId=c.exact?{exact:f.deviceId}:{ideal:f.deviceId}),o.video=i(o.video),M_("chrome: "+JSON.stringify(o)),l(o)})}o.video=i(o.video)}return M_("chrome: "+JSON.stringify(o)),l(o)},r=function(o){return e.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(o,l,c){s(o,u=>{t.webkitGetUserMedia(u,l,d=>{c&&c(r(d))})})};if(t.getUserMedia=a.bind(t),t.mediaDevices.getUserMedia){const o=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(l){return s(l,c=>o(c).then(u=>{if(c.audio&&!u.getAudioTracks().length||c.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(r(u))))}}}function NT(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function DT(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",s=>{let r;n.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(o=>o.track&&o.track.id===s.track.id):r={track:s.track};const a=new Event("track");a.track=s.track,a.receiver=r,a.transceiver={receiver:r},a.streams=[i.stream],this.dispatchEvent(a)}),i.stream.getTracks().forEach(s=>{let r;n.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(o=>o.track&&o.track.id===s.id):r={track:s};const a=new Event("track");a.track=s,a.receiver=r,a.transceiver={receiver:r},a.streams=[i.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Oa(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function LT(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(s,r){return{track:r,get dtmf(){return this._dtmf===void 0&&(r.kind==="audio"?this._dtmf=s.createDTMFSender(r):this._dtmf=null),this._dtmf},_pc:s}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(o,l){let c=s.apply(this,arguments);return c||(c=e(this,o),this._senders.push(c)),c};const r=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(o){r.apply(this,arguments);const l=this._senders.indexOf(o);l!==-1&&this._senders.splice(l,1)}}const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],t.apply(this,[r]),r.getTracks().forEach(a=>{this._senders.push(e(this,a))})};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(a=>{const o=this._senders.find(l=>l.track===a);o&&this._senders.splice(this._senders.indexOf(o),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function OT(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(a=>a._pc=this),r});const i=n.RTCPeerConnection.prototype.addTrack;i&&(n.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),n.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(a=>k_(a,r.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const s=t.apply(this,[]);return s.forEach(r=>r._pc=this),s}),Oa(n,"track",i=>(i.receiver._pc=i.srcElement,i)),n.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(r=>k_(r,s.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const i=arguments[0];let s,r,a;return this.getSenders().forEach(o=>{o.track===i&&(s?a=!0:s=o)}),this.getReceivers().forEach(o=>(o.track===i&&(r?a=!0:r=o),o.track===i)),a||s&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function UT(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,o){if(!o)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(l)===-1&&this._shimmedLocalStreams[o.id].push(l):this._shimmedLocalStreams[o.id]=[o,l],l};const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(c=>{if(this.getSenders().find(d=>d.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const o=this.getSenders();t.apply(this,arguments);const l=this.getSenders().filter(c=>o.indexOf(c)===-1);this._shimmedLocalStreams[a.id]=[a].concat(l)};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],i.apply(this,arguments)};const s=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(o=>{const l=this._shimmedLocalStreams[o].indexOf(a);l!==-1&&this._shimmedLocalStreams[o].splice(l,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]}),s.apply(this,arguments)}}function FT(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return UT(n);const t=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const u=t.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(d=>this._reverseStreams[d.id])};const i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(d=>{if(this.getSenders().find(f=>f.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const d=new n.MediaStream(u.getTracks());this._streams[u.id]=d,this._reverseStreams[d.id]=u,u=d}i.apply(this,[u])};const s=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},n.RTCPeerConnection.prototype.addTrack=function(u,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(v=>v===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(v=>v.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const g=this._streams[d.id];if(g)g.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const v=new n.MediaStream([u]);this._streams[d.id]=v,this._reverseStreams[v.id]=d,this.addStream(v)}return this.getSenders().find(v=>v.track===u)};function r(c,u){let d=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(h=>{const f=c._reverseStreams[h],g=c._streams[f.id];d=d.replace(new RegExp(g.id,"g"),f.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function a(c,u){let d=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(h=>{const f=c._reverseStreams[h],g=c._streams[f.id];d=d.replace(new RegExp(f.id,"g"),g.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(c){const u=n.RTCPeerConnection.prototype[c],d={[c](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[g=>{const v=r(this,g);h[0].apply(null,[v])},g=>{h[1]&&h[1].apply(null,g)},arguments[2]]):u.apply(this,arguments).then(g=>r(this,g))}};n.RTCPeerConnection.prototype[c]=d[c]});const o=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?o.apply(this,arguments):(arguments[0]=a(this,arguments[0]),o.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const c=l.get.apply(this);return c.type===""?c:r(this,c)}}),n.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(f=>{this._streams[f].getTracks().find(v=>u.track===v)&&(h=this._streams[f])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Ap(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const i=n.RTCPeerConnection.prototype[t],s={[t](){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};n.RTCPeerConnection.prototype[t]=s[t]})}function BT(n,e){Oa(n,"negotiationneeded",t=>{const i=t.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return t})}var x_=Object.freeze({__proto__:null,fixNegotiationNeeded:BT,shimAddTrackRemoveTrack:FT,shimAddTrackRemoveTrackWithNative:UT,shimGetSendersWithDtmf:LT,shimGetUserMedia:PT,shimMediaStream:NT,shimOnTrack:DT,shimPeerConnection:Ap,shimSenderReceiverGetStats:OT});function VT(n,e){const t=n&&n.navigator,i=n&&n.MediaStreamTrack;if(t.getUserMedia=function(s,r,a){pg("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(s).then(r,a)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const s=function(a,o,l){o in a&&!(l in a)&&(a[l]=a[o],delete a[o])},r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),s(a.audio,"autoGainControl","mozAutoGainControl"),s(a.audio,"noiseSuppression","mozNoiseSuppression")),r(a)},i&&i.prototype.getSettings){const a=i.prototype.getSettings;i.prototype.getSettings=function(){const o=a.apply(this,arguments);return s(o,"mozAutoGainControl","autoGainControl"),s(o,"mozNoiseSuppression","noiseSuppression"),o}}if(i&&i.prototype.applyConstraints){const a=i.prototype.applyConstraints;i.prototype.applyConstraints=function(o){return this.kind==="audio"&&typeof o=="object"&&(o=JSON.parse(JSON.stringify(o)),s(o,"autoGainControl","mozAutoGainControl"),s(o,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[o])}}}}function K2(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(i)})}function GT(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Cp(n,e){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const r=n.RTCPeerConnection.prototype[s],a={[s](){return arguments[0]=new(s==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};n.RTCPeerConnection.prototype[s]=a[s]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[r,a,o]=arguments;return i.apply(this,[r||null]).then(l=>{if(e.version<53&&!a)try{l.forEach(c=>{c.type=t[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;l.forEach((u,d)=>{l.set(d,Object.assign({},u,{type:t[u.type]||u.type}))})}return l}).then(a,o)}}function zT(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(r=>r._pc=this),s});const t=n.RTCPeerConnection.prototype.addTrack;t&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=t.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function HT(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i}),Oa(n,"track",t=>(t.receiver._pc=t.srcElement,t)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function WT(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){pg("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&t.getTracks().includes(i.track)&&this.removeTrack(i)})})}function jT(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function KT(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const s=i.length>0;s&&i.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=e.apply(this,arguments);if(s){const{sender:a}=r,o=a.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=i,a.sendEncodings=i,this.setParametersPromises.push(a.setParameters(o).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return r})}function qT(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function XT(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function YT(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var I_=Object.freeze({__proto__:null,shimAddTransceiver:KT,shimCreateAnswer:YT,shimCreateOffer:XT,shimGetDisplayMedia:K2,shimGetParameters:qT,shimGetUserMedia:VT,shimOnTrack:GT,shimPeerConnection:Cp,shimRTCDataChannel:jT,shimReceiverGetStats:HT,shimRemoveStream:WT,shimSenderGetStats:zT});function JT(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(s=>e.call(this,s,i)),i.getVideoTracks().forEach(s=>e.call(this,s,i))},n.RTCPeerConnection.prototype.addTrack=function(i){for(var s=arguments.length,r=new Array(s>1?s-1:0),a=1;a<s;a++)r[a-1]=arguments[a];return r&&r.forEach(o=>{this._localStreams?this._localStreams.includes(o)||this._localStreams.push(o):this._localStreams=[o]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(t);if(i===-1)return;this._localStreams.splice(i,1);const s=t.getTracks();this.getSenders().forEach(r=>{s.includes(r.track)&&this.removeTrack(r)})})}}function QT(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const r=new Event("addstream");r.stream=s,this.dispatchEvent(r)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(r=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(r)>=0)return;i._remoteStreams.push(r);const a=new Event("addstream");a.stream=r,i.dispatchEvent(a)})}),e.apply(i,arguments)}}}function ZT(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,t=e.createOffer,i=e.createAnswer,s=e.setLocalDescription,r=e.setRemoteDescription,a=e.addIceCandidate;e.createOffer=function(c,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=t.apply(this,[d]);return u?(h.then(c,u),Promise.resolve()):h},e.createAnswer=function(c,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=i.apply(this,[d]);return u?(h.then(c,u),Promise.resolve()):h};let o=function(l,c,u){const d=s.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d};e.setLocalDescription=o,o=function(l,c,u){const d=r.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d},e.setRemoteDescription=o,o=function(l,c,u){const d=a.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d},e.addIceCandidate=o}function $T(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,i=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=s=>i(eS(s))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,s,r){e.mediaDevices.getUserMedia(i).then(s,r)}).bind(e))}function eS(n){return n&&n.video!==void 0?Object.assign({},n,{video:IT(n.video)}):n}function tS(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(i,s){if(i&&i.iceServers){const r=[];for(let a=0;a<i.iceServers.length;a++){let o=i.iceServers[a];o.urls===void 0&&o.url?(pg("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,r.push(o)):r.push(i.iceServers[a])}i.iceServers=r}return new e(i,s)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function nS(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function iS(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const s=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const r=this.getTransceivers().find(a=>a.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveVideo===!0&&!r&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function sS(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}var P_=Object.freeze({__proto__:null,shimAudioContext:sS,shimCallbacksAPI:ZT,shimConstraints:eS,shimCreateOfferLegacy:iS,shimGetUserMedia:$T,shimLocalStreamsAPI:JT,shimRTCIceServerUrls:tS,shimRemoteStreamsAPI:QT,shimTrackEventTransceiver:nS}),Wh={exports:{}},N_;function q2(){return N_||(N_=1,function(n){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(t){return t.split(`
m=`).map((s,r)=>(r>0?"m="+s:s).trim()+`\r
`)},e.getDescription=function(t){const i=e.splitSections(t);return i&&i[0]},e.getMediaSections=function(t){const i=e.splitSections(t);return i.shift(),i},e.matchPrefix=function(t,i){return e.splitLines(t).filter(s=>s.indexOf(i)===0)},e.parseCandidate=function(t){let i;t.indexOf("a=candidate:")===0?i=t.substring(12).split(" "):i=t.substring(10).split(" ");const s={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let r=8;r<i.length;r+=2)switch(i[r]){case"raddr":s.relatedAddress=i[r+1];break;case"rport":s.relatedPort=parseInt(i[r+1],10);break;case"tcptype":s.tcpType=i[r+1];break;case"ufrag":s.ufrag=i[r+1],s.usernameFragment=i[r+1];break;default:s[i[r]]===void 0&&(s[i[r]]=i[r+1]);break}return s},e.writeCandidate=function(t){const i=[];i.push(t.foundation);const s=t.component;s==="rtp"?i.push(1):s==="rtcp"?i.push(2):i.push(s),i.push(t.protocol.toUpperCase()),i.push(t.priority),i.push(t.address||t.ip),i.push(t.port);const r=t.type;return i.push("typ"),i.push(r),r!=="host"&&t.relatedAddress&&t.relatedPort&&(i.push("raddr"),i.push(t.relatedAddress),i.push("rport"),i.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(i.push("ufrag"),i.push(t.usernameFragment||t.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let i=t.substring(9).split(" ");const s={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),s.name=i[0],s.clockRate=parseInt(i[1],10),s.channels=i.length===3?parseInt(i[2],10):1,s.numChannels=s.channels,s},e.writeRtpMap=function(t){let i=t.payloadType;t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType);const s=t.channels||t.numChannels||1;return"a=rtpmap:"+i+" "+t.name+"/"+t.clockRate+(s!==1?"/"+s:"")+`\r
`},e.parseExtmap=function(t){const i=t.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`},e.parseFmtp=function(t){const i={};let s;const r=t.substring(t.indexOf(" ")+1).split(";");for(let a=0;a<r.length;a++)s=r[a].trim().split("="),i[s[0].trim()]=s[1];return i},e.writeFmtp=function(t){let i="",s=t.payloadType;if(t.preferredPayloadType!==void 0&&(s=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const r=[];Object.keys(t.parameters).forEach(a=>{t.parameters[a]!==void 0?r.push(a+"="+t.parameters[a]):r.push(a)}),i+="a=fmtp:"+s+" "+r.join(";")+`\r
`}return i},e.parseRtcpFb=function(t){const i=t.substring(t.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(t){let i="",s=t.payloadType;return t.preferredPayloadType!==void 0&&(s=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(r=>{i+="a=rtcp-fb:"+s+" "+r.type+(r.parameter&&r.parameter.length?" "+r.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(t){const i=t.indexOf(" "),s={ssrc:parseInt(t.substring(7,i),10)},r=t.indexOf(":",i);return r>-1?(s.attribute=t.substring(i+1,r),s.value=t.substring(r+1)):s.attribute=t.substring(i+1),s},e.parseSsrcGroup=function(t){const i=t.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(s=>parseInt(s,10))}},e.getMid=function(t){const i=e.matchPrefix(t,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(t){const i=t.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(t,i){return{role:"auto",fingerprints:e.matchPrefix(t+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,i){let s="a=setup:"+i+`\r
`;return t.fingerprints.forEach(r=>{s+="a=fingerprint:"+r.algorithm+" "+r.value+`\r
`}),s},e.parseCryptoLine=function(t){const i=t.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;const i=t.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,i){return e.matchPrefix(t+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,i){const s=e.matchPrefix(t+i,"a=ice-ufrag:")[0],r=e.matchPrefix(t+i,"a=ice-pwd:")[0];return s&&r?{usernameFragment:s.substring(12),password:r.substring(10)}:null},e.writeIceParameters=function(t){let i="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(t){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=e.splitLines(t)[0].split(" ");i.profile=r[2];for(let o=3;o<r.length;o++){const l=r[o],c=e.matchPrefix(t,"a=rtpmap:"+l+" ")[0];if(c){const u=e.parseRtpMap(c),d=e.matchPrefix(t,"a=fmtp:"+l+" ");switch(u.parameters=d.length?e.parseFmtp(d[0]):{},u.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),i.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(t,"a=extmap:").forEach(o=>{i.headerExtensions.push(e.parseExtmap(o))});const a=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(o=>{a.forEach(l=>{o.rtcpFeedback.find(u=>u.type===l.type&&u.parameter===l.parameter)||o.rtcpFeedback.push(l)})}),i},e.writeRtpDescription=function(t,i){let s="";s+="m="+t+" ",s+=i.codecs.length>0?"9":"0",s+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=i.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(a=>{s+=e.writeRtpMap(a),s+=e.writeFmtp(a),s+=e.writeRtcpFb(a)});let r=0;return i.codecs.forEach(a=>{a.maxptime>r&&(r=a.maxptime)}),r>0&&(s+="a=maxptime:"+r+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(a=>{s+=e.writeExtmap(a)}),s},e.parseRtpEncodingParameters=function(t){const i=[],s=e.parseRtpParameters(t),r=s.fecMechanisms.indexOf("RED")!==-1,a=s.fecMechanisms.indexOf("ULPFEC")!==-1,o=e.matchPrefix(t,"a=ssrc:").map(h=>e.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),l=o.length>0&&o[0].ssrc;let c;const u=e.matchPrefix(t,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(g=>parseInt(g,10)));u.length>0&&u[0].length>1&&u[0][0]===l&&(c=u[0][1]),s.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let f={ssrc:l,codecPayloadType:parseInt(h.parameters.apt,10)};l&&c&&(f.rtx={ssrc:c}),i.push(f),r&&(f=JSON.parse(JSON.stringify(f)),f.fec={ssrc:l,mechanism:a?"red+ulpfec":"red"},i.push(f))}}),i.length===0&&l&&i.push({ssrc:l});let d=e.matchPrefix(t,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substring(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substring(5),10)*1e3*.95-50*40*8:d=void 0,i.forEach(h=>{h.maxBitrate=d})),i},e.parseRtcpParameters=function(t){const i={},s=e.matchPrefix(t,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="cname")[0];s&&(i.cname=s.value,i.ssrc=s.ssrc);const r=e.matchPrefix(t,"a=rtcp-rsize");i.reducedSize=r.length>0,i.compound=r.length===0;const a=e.matchPrefix(t,"a=rtcp-mux");return i.mux=a.length>0,i},e.writeRtcpParameters=function(t){let i="";return t.reducedSize&&(i+=`a=rtcp-rsize\r
`),t.mux&&(i+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(i+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),i},e.parseMsid=function(t){let i;const s=e.matchPrefix(t,"a=msid:");if(s.length===1)return i=s[0].substring(7).split(" "),{stream:i[0],track:i[1]};const r=e.matchPrefix(t,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");if(r.length>0)return i=r[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(t){const i=e.parseMLine(t),s=e.matchPrefix(t,"a=max-message-size:");let r;s.length>0&&(r=parseInt(s[0].substring(19),10)),isNaN(r)&&(r=65536);const a=e.matchPrefix(t,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:i.fmt,maxMessageSize:r};const o=e.matchPrefix(t,"a=sctpmap:");if(o.length>0){const l=o[0].substring(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:r}}},e.writeSctpDescription=function(t,i){let s=[];return t.protocol!=="DTLS/SCTP"?s=["m="+t.kind+" 9 "+t.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:s=["m="+t.kind+" 9 "+t.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&s.push("a=max-message-size:"+i.maxMessageSize+`\r
`),s.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,i,s){let r;const a=i!==void 0?i:2;return t?r=t:r=e.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+r+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(t,i){const s=e.splitLines(t);for(let r=0;r<s.length;r++)switch(s[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[r].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){const s=e.splitLines(t)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},e.parseOLine=function(t){const s=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;const i=e.splitLines(t);for(let s=0;s<i.length;s++)if(i[s].length<2||i[s].charAt(1)!=="=")return!1;return!0},n.exports=e}(Wh)),Wh.exports}var rS=q2(),To=O2(rS),X2=lx({__proto__:null,default:To},[rS]);function mu(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const s=new e(i),r=To.parseCandidate(i.candidate);for(const a in r)a in s||Object.defineProperty(s,a,{value:r[a]});return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(i)},n.RTCIceCandidate.prototype=e.prototype,Oa(n,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t))}function wp(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||Oa(n,"icecandidate",e=>{if(e.candidate){const t=To.parseCandidate(e.candidate.candidate);t.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function gu(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(o){if(!o||!o.sdp)return!1;const l=To.splitSections(o.sdp);return l.shift(),l.some(c=>{const u=To.parseMLine(c);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},i=function(o){const l=o.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const c=parseInt(l[1],10);return c!==c?-1:c},s=function(o){let l=65536;return e.browser==="firefox"&&(e.version<57?o===-1?l=16384:l=2147483637:e.version<60?l=e.version===57?65535:65536:l=2147483637),l},r=function(o,l){let c=65536;e.browser==="firefox"&&e.version===57&&(c=65535);const u=To.matchPrefix(o.sdp,"a=max-message-size:");return u.length>0?c=parseInt(u[0].substring(19),10):e.browser==="firefox"&&l!==-1&&(c=2147483637),c},a=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const l=i(arguments[0]),c=s(l),u=r(arguments[0],l);let d;c===0&&u===0?d=Number.POSITIVE_INFINITY:c===0||u===0?d=Math.max(c,u):d=Math.min(c,u);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return d}}),this._sctp=h}return a.apply(this,arguments)}}function _u(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function e(i,s){const r=i.send;i.send=function(){const o=arguments[0],l=o.length||o.size||o.byteLength;if(i.readyState==="open"&&s.sctp&&l>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return r.apply(i,arguments)}}const t=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const s=t.apply(this,arguments);return e(s,this),s},Oa(n,"datachannel",i=>(e(i.channel,i.target),i))}function Rp(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const i=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const r=s.target;if(r._lastConnectionState!==r.connectionState){r._lastConnectionState=r.connectionState;const a=new Event("connectionstatechange",s);r.dispatchEvent(a)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function kp(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=s.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&s instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:s.type,sdp:r}):s.sdp=r}return t.apply(this,arguments)}}function vu(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function bu(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.setLocalDescription;!t||t.length===0||(n.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return t.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer";break}return s.sdp||s.type!=="offer"&&s.type!=="answer"?t.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>t.apply(this,[a]))})}var Y2=Object.freeze({__proto__:null,removeExtmapAllowMixed:kp,shimAddIceCandidateNullOrEmpty:vu,shimConnectionState:Rp,shimMaxMessageSize:gu,shimParameterlessSetLocalDescription:bu,shimRTCIceCandidate:mu,shimRTCIceCandidateRelayProtocol:wp,shimSendThrowTypeError:_u});function J2(){let{window:n}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const t=xT,i=j2(n),s={browserDetails:i,commonShim:Y2,extractVersion:pu,disableLog:H2,disableWarnings:W2,sdp:X2};switch(i.browser){case"chrome":if(!x_||!Ap||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),s;if(i.version===null)return t("Chrome shim can not determine version, not shimming."),s;t("adapter.js shimming chrome."),s.browserShim=x_,vu(n,i),bu(n),PT(n,i),NT(n),Ap(n,i),DT(n),FT(n,i),LT(n),OT(n),BT(n,i),mu(n),wp(n),Rp(n),gu(n,i),_u(n),kp(n,i);break;case"firefox":if(!I_||!Cp||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),s;t("adapter.js shimming firefox."),s.browserShim=I_,vu(n,i),bu(n),VT(n,i),Cp(n,i),GT(n),WT(n),zT(n),HT(n),jT(n),KT(n),qT(n),XT(n),YT(n),mu(n),Rp(n),gu(n,i),_u(n);break;case"safari":if(!P_||!e.shimSafari)return t("Safari shim is not included in this adapter release."),s;t("adapter.js shimming safari."),s.browserShim=P_,vu(n,i),bu(n),tS(n),iS(n),ZT(n),JT(n),QT(n),nS(n),$T(n),sS(n),mu(n),wp(n),gu(n,i),_u(n),kp(n,i);break;default:t("Unsupported browser!");break}return s}J2({window:typeof window>"u"?void 0:window});const Q2=10,Tl="lk_e2ee",Z2="LKFrameEncryptionKey",$2={sharedKey:!1,ratchetSalt:Z2,ratchetWindowSize:8,failureTolerance:Q2,keyringSize:16};var Wr;(function(n){n.SetKey="setKey",n.RatchetRequest="ratchetRequest",n.KeyRatcheted="keyRatcheted"})(Wr||(Wr={}));var D_;(function(n){n.KeyRatcheted="keyRatcheted"})(D_||(D_={}));var Gr;(function(n){n.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",n.EncryptionError="encryptionError"})(Gr||(Gr={}));var L_;(function(n){n.Error="cryptorError"})(L_||(L_={}));function eI(){return tI()||Mp()}function Mp(){return typeof window.RTCRtpScriptTransform<"u"}function tI(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}class UV extends Fs.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(t,i)=>{Ht.debug("key ratcheted event received",{material:t,keyIndex:i})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},$2),e),this.on(Wr.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,t,i){const s={key:e,participantIdentity:t,keyIndex:i};if(!this.options.sharedKey&&!t)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(t??"shared","-").concat(i??0),s),this.emit(Wr.SetKey,s)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,t){this.emit(Wr.RatchetRequest,e,t)}}class Ua extends Error{constructor(e,t){super(t||"an error has occured"),this.name="LiveKitError",this.code=e}}var qt;(function(n){n[n.NotAllowed=0]="NotAllowed",n[n.ServerUnreachable=1]="ServerUnreachable",n[n.InternalError=2]="InternalError",n[n.Cancelled=3]="Cancelled",n[n.LeaveRequest=4]="LeaveRequest"})(qt||(qt={}));class Sn extends Ua{constructor(e,t,i,s){super(1,e),this.name="ConnectionError",this.status=i,this.reason=t,this.context=s,this.reasonName=qt[t]}}class mg extends Ua{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class rr extends Ua{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class nI extends Ua{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class Xn extends Ua{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class xp extends Ua{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class O_ extends Ua{constructor(e,t){super(15,e),this.reason=t,this.reasonName=typeof t=="string"?t:hg[t]}}var Xc;(function(n){n.PermissionDenied="PermissionDenied",n.NotFound="NotFound",n.DeviceInUse="DeviceInUse",n.Other="Other"})(Xc||(Xc={}));(function(n){function e(t){if(t&&"name"in t)return t.name==="NotFoundError"||t.name==="DevicesNotFoundError"?n.NotFound:t.name==="NotAllowedError"||t.name==="PermissionDeniedError"?n.PermissionDenied:t.name==="NotReadableError"||t.name==="TrackStartError"?n.DeviceInUse:n.Other}n.getFailure=e})(Xc||(Xc={}));var U_;(function(n){n[n.InvalidKey=0]="InvalidKey",n[n.MissingKey=1]="MissingKey",n[n.InternalError=2]="InternalError"})(U_||(U_={}));var Ce;(function(n){n.Connected="connected",n.Reconnecting="reconnecting",n.SignalReconnecting="signalReconnecting",n.Reconnected="reconnected",n.Disconnected="disconnected",n.ConnectionStateChanged="connectionStateChanged",n.MediaDevicesChanged="mediaDevicesChanged",n.ParticipantConnected="participantConnected",n.ParticipantDisconnected="participantDisconnected",n.TrackPublished="trackPublished",n.TrackSubscribed="trackSubscribed",n.TrackSubscriptionFailed="trackSubscriptionFailed",n.TrackUnpublished="trackUnpublished",n.TrackUnsubscribed="trackUnsubscribed",n.TrackMuted="trackMuted",n.TrackUnmuted="trackUnmuted",n.LocalTrackPublished="localTrackPublished",n.LocalTrackUnpublished="localTrackUnpublished",n.LocalAudioSilenceDetected="localAudioSilenceDetected",n.ActiveSpeakersChanged="activeSpeakersChanged",n.ParticipantMetadataChanged="participantMetadataChanged",n.ParticipantNameChanged="participantNameChanged",n.ParticipantAttributesChanged="participantAttributesChanged",n.RoomMetadataChanged="roomMetadataChanged",n.DataReceived="dataReceived",n.SipDTMFReceived="sipDTMFReceived",n.TranscriptionReceived="transcriptionReceived",n.ConnectionQualityChanged="connectionQualityChanged",n.TrackStreamStateChanged="trackStreamStateChanged",n.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",n.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",n.AudioPlaybackStatusChanged="audioPlaybackChanged",n.VideoPlaybackStatusChanged="videoPlaybackChanged",n.MediaDevicesError="mediaDevicesError",n.ParticipantPermissionsChanged="participantPermissionsChanged",n.SignalConnected="signalConnected",n.RecordingStatusChanged="recordingStatusChanged",n.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",n.EncryptionError="encryptionError",n.DCBufferStatusChanged="dcBufferStatusChanged",n.ActiveDeviceChanged="activeDeviceChanged",n.ChatMessage="chatMessage",n.LocalTrackSubscribed="localTrackSubscribed",n.MetricsReceived="metricsReceived"})(Ce||(Ce={}));var qe;(function(n){n.TrackPublished="trackPublished",n.TrackSubscribed="trackSubscribed",n.TrackSubscriptionFailed="trackSubscriptionFailed",n.TrackUnpublished="trackUnpublished",n.TrackUnsubscribed="trackUnsubscribed",n.TrackMuted="trackMuted",n.TrackUnmuted="trackUnmuted",n.LocalTrackPublished="localTrackPublished",n.LocalTrackUnpublished="localTrackUnpublished",n.ParticipantMetadataChanged="participantMetadataChanged",n.ParticipantNameChanged="participantNameChanged",n.DataReceived="dataReceived",n.SipDTMFReceived="sipDTMFReceived",n.TranscriptionReceived="transcriptionReceived",n.IsSpeakingChanged="isSpeakingChanged",n.ConnectionQualityChanged="connectionQualityChanged",n.TrackStreamStateChanged="trackStreamStateChanged",n.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",n.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",n.MediaDevicesError="mediaDevicesError",n.AudioStreamAcquired="audioStreamAcquired",n.ParticipantPermissionsChanged="participantPermissionsChanged",n.PCTrackAdded="pcTrackAdded",n.AttributesChanged="attributesChanged",n.LocalTrackSubscribed="localTrackSubscribed",n.ChatMessage="chatMessage"})(qe||(qe={}));var We;(function(n){n.TransportsCreated="transportsCreated",n.Connected="connected",n.Disconnected="disconnected",n.Resuming="resuming",n.Resumed="resumed",n.Restarting="restarting",n.Restarted="restarted",n.SignalResumed="signalResumed",n.SignalRestarted="signalRestarted",n.Closing="closing",n.MediaTrackAdded="mediaTrackAdded",n.ActiveSpeakersUpdate="activeSpeakersUpdate",n.DataPacketReceived="dataPacketReceived",n.RTPVideoMapUpdate="rtpVideoMapUpdate",n.DCBufferStatusChanged="dcBufferStatusChanged",n.ParticipantUpdate="participantUpdate",n.RoomUpdate="roomUpdate",n.SpeakersChanged="speakersChanged",n.StreamStateChanged="streamStateChanged",n.ConnectionQualityUpdate="connectionQualityUpdate",n.SubscriptionError="subscriptionError",n.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",n.RemoteMute="remoteMute",n.SubscribedQualityUpdate="subscribedQualityUpdate",n.LocalTrackUnpublished="localTrackUnpublished",n.LocalTrackSubscribed="localTrackSubscribed",n.Offline="offline",n.SignalRequestResponse="signalRequestResponse"})(We||(We={}));var Ve;(function(n){n.Message="message",n.Muted="muted",n.Unmuted="unmuted",n.Restarted="restarted",n.Ended="ended",n.Subscribed="subscribed",n.Unsubscribed="unsubscribed",n.UpdateSettings="updateSettings",n.UpdateSubscription="updateSubscription",n.AudioPlaybackStarted="audioPlaybackStarted",n.AudioPlaybackFailed="audioPlaybackFailed",n.AudioSilenceDetected="audioSilenceDetected",n.VisibilityChanged="visibilityChanged",n.VideoDimensionsChanged="videoDimensionsChanged",n.VideoPlaybackStarted="videoPlaybackStarted",n.VideoPlaybackFailed="videoPlaybackFailed",n.ElementAttached="elementAttached",n.ElementDetached="elementDetached",n.UpstreamPaused="upstreamPaused",n.UpstreamResumed="upstreamResumed",n.SubscriptionPermissionChanged="subscriptionPermissionChanged",n.SubscriptionStatusChanged="subscriptionStatusChanged",n.SubscriptionFailed="subscriptionFailed",n.TrackProcessorUpdate="trackProcessorUpdate",n.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",n.TranscriptionReceived="transcriptionReceived",n.TimeSyncUpdate="timeSyncUpdate"})(Ve||(Ve={}));function iI(n){if(!(typeof n>"u"))return typeof structuredClone=="function"?structuredClone(n):JSON.parse(JSON.stringify(n))}const sI=/version\/(\d+(\.?_?\d+)+)/i;let jh;function Ls(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const t=navigator.userAgent.toLowerCase();if(jh===void 0||e){const i=rI.find(s=>{let{test:r}=s;return r.test(t)});jh=i==null?void 0:i.describe(t)}return jh}const rI=[{test:/firefox|iceweasel|fxios/i,describe(n){return{name:"Firefox",version:yu(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,n),os:n.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Kh(n)}}},{test:/chrom|crios|crmo/i,describe(n){return{name:"Chrome",version:yu(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,n),os:n.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Kh(n)}}},{test:/safari|applewebkit/i,describe(n){return{name:"Safari",version:yu(sI,n),os:n.includes("mobile/")?"iOS":"macOS",osVersion:Kh(n)}}}];function yu(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(n);return i&&i.length>=t&&i[t]||""}function Kh(n){return n.includes("mac os")?yu(/\(.+?(\d+_\d+(:?_\d+)?)/,n,1).replace(/_/g,"."):void 0}var aI="2.9.4";const oI=aI,cI=15;class ui{}ui.setTimeout=function(){return setTimeout(...arguments)};ui.setInterval=function(){return setInterval(...arguments)};ui.clearTimeout=function(){return clearTimeout(...arguments)};ui.clearInterval=function(){return clearInterval(...arguments)};const lI=5e3,ac=[];var Zi;(function(n){n[n.LOW=0]="LOW",n[n.MEDIUM=1]="MEDIUM",n[n.HIGH=2]="HIGH"})(Zi||(Zi={}));class xe extends Fs.EventEmitter{constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var s;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=xe.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Ht,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),lI):this.handleAppVisibilityChanged()},this.log=hr((s=i.loggerName)!==null&&s!==void 0?s:ys.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=t,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=xe.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),yn(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let t="audio";this.kind===xe.Kind.Video&&(t="video"),this.attachedElements.length===0&&this.kind===xe.Kind.Video&&this.addAppVisibilityListener(),e||(t==="audio"&&(ac.forEach(r=>{r.parentElement===null&&!e&&(e=r)}),e&&ac.splice(ac.indexOf(e),1)),e||(e=document.createElement(t))),this.attachedElements.includes(e)||this.attachedElements.push(e),po(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),s=i.some(r=>r.kind==="audio");return e.play().then(()=>{this.emit(s?Ve.AudioPlaybackStarted:Ve.VideoPlaybackStarted)}).catch(r=>{r.name==="NotAllowedError"?this.emit(s?Ve.AudioPlaybackFailed:Ve.VideoPlaybackFailed,r):r.name==="AbortError"?Ht.debug("".concat(s?"audio":"video"," playback aborted, likely due to new play request")):Ht.warn("could not playback ".concat(s?"audio":"video"),r),s&&e&&i.some(a=>a.kind==="video")&&r.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(Ve.ElementAttached,e),e}detach(e){try{if(e){So(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(Ve.ElementDetached,e)),e}const t=[];return this.attachedElements.forEach(i=>{So(this.mediaStreamTrack,i),t.push(i),this.recycleElement(i),this.emit(Ve.ElementDetached,i)}),this.attachedElements=[],t}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=hr(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let t=!0;e.pause(),ac.forEach(i=>{i.parentElement||(t=!1)}),t&&ac.push(e)}}handleAppVisibilityChanged(){return G(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===xe.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){xi()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){xi()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function po(n,e){let t;e.srcObject instanceof MediaStream?t=e.srcObject:t=new MediaStream;let i;n.kind==="audio"?i=t.getAudioTracks():i=t.getVideoTracks(),i.includes(n)||(i.forEach(s=>{t.removeTrack(s)}),t.addTrack(n)),(!Qr()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=t.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==t&&(e.srcObject=t,(Qr()||Do())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=t,e.play().catch(()=>{})},0))}function So(n,e){if(e.srcObject instanceof MediaStream){const t=e.srcObject;t.removeTrack(n),t.getTracks().length>0?e.srcObject=t:e.srcObject=null}}(function(n){let e;(function(c){c.Audio="audio",c.Video="video",c.Unknown="unknown"})(e=n.Kind||(n.Kind={}));let t;(function(c){c.Camera="camera",c.Microphone="microphone",c.ScreenShare="screen_share",c.ScreenShareAudio="screen_share_audio",c.Unknown="unknown"})(t=n.Source||(n.Source={}));let i;(function(c){c.Active="active",c.Paused="paused",c.Unknown="unknown"})(i=n.StreamState||(n.StreamState={}));function s(c){switch(c){case e.Audio:return ps.AUDIO;case e.Video:return ps.VIDEO;default:return ps.DATA}}n.kindToProto=s;function r(c){switch(c){case ps.AUDIO:return e.Audio;case ps.VIDEO:return e.Video;default:return e.Unknown}}n.kindFromProto=r;function a(c){switch(c){case t.Camera:return pi.CAMERA;case t.Microphone:return pi.MICROPHONE;case t.ScreenShare:return pi.SCREEN_SHARE;case t.ScreenShareAudio:return pi.SCREEN_SHARE_AUDIO;default:return pi.UNKNOWN}}n.sourceToProto=a;function o(c){switch(c){case pi.CAMERA:return t.Camera;case pi.MICROPHONE:return t.Microphone;case pi.SCREEN_SHARE:return t.ScreenShare;case pi.SCREEN_SHARE_AUDIO:return t.ScreenShareAudio;default:return t.Unknown}}n.sourceFromProto=o;function l(c){switch(c){case bp.ACTIVE:return i.Active;case bp.PAUSED:return i.Paused;default:return i.Unknown}}n.streamStateFromProto=l})(xe);class gn{constructor(e,t,i,s,r){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(t!==void 0&&i!==void 0)this.width=e,this.height=t,this.aspectRatio=e/t,this.encoding={maxBitrate:i,maxFramerate:s,priority:r};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const uI=["vp8","h264"],dI=["vp8","h264","vp9","av1"];function hI(n){return!!uI.find(e=>e===n)}var F_;(function(n){n[n.REGRESSION=0]="REGRESSION",n[n.SIMULCAST=1]="SIMULCAST"})(F_||(F_={}));var Ip;(function(n){n.telephone={maxBitrate:12e3},n.speech={maxBitrate:24e3},n.music={maxBitrate:48e3},n.musicStereo={maxBitrate:64e3},n.musicHighQuality={maxBitrate:96e3},n.musicHighQualityStereo={maxBitrate:128e3}})(Ip||(Ip={}));const Yc={h90:new gn(160,90,9e4,20),h180:new gn(320,180,16e4,20),h216:new gn(384,216,18e4,20),h360:new gn(640,360,45e4,20),h540:new gn(960,540,8e5,25),h720:new gn(1280,720,17e5,30),h1080:new gn(1920,1080,3e6,30),h1440:new gn(2560,1440,5e6,30),h2160:new gn(3840,2160,8e6,30)},Pp={h120:new gn(160,120,7e4,20),h180:new gn(240,180,125e3,20),h240:new gn(320,240,14e4,20),h360:new gn(480,360,33e4,20),h480:new gn(640,480,5e5,20),h540:new gn(720,540,6e5,25),h720:new gn(960,720,13e5,30),h1080:new gn(1440,1080,23e5,30),h1440:new gn(1920,1440,38e5,30)},gg={h360fps3:new gn(640,360,2e5,3,"medium"),h360fps15:new gn(640,360,4e5,15,"medium"),h720fps5:new gn(1280,720,8e5,5,"medium"),h720fps15:new gn(1280,720,15e5,15,"medium"),h720fps30:new gn(1280,720,2e6,30,"medium"),h1080fps15:new gn(1920,1080,25e5,15,"medium"),h1080fps30:new gn(1920,1080,5e6,30,"medium"),original:new gn(0,0,7e6,30,"medium")},fI="|",B_="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function pI(n){const e=n.split(fI);return e.length>1?[e[0],n.substr(e[0].length+1)]:[n,""]}function Ii(n){return G(this,void 0,void 0,function*(){return new Promise(e=>ui.setTimeout(e,n))})}function Np(){return"addTransceiver"in RTCPeerConnection.prototype}function Dp(){return"addTrack"in RTCPeerConnection.prototype}function mI(){if(!("getCapabilities"in RTCRtpSender)||Qr())return!1;const n=RTCRtpSender.getCapabilities("video");let e=!1;if(n){for(const t of n.codecs)if(t.mimeType==="video/AV1"){e=!0;break}}return e}function gI(){if(!("getCapabilities"in RTCRtpSender)||Do())return!1;if(Qr()){const t=Ls();if(t!=null&&t.version&&Lo(t.version,"16")<0)return!1}const n=RTCRtpSender.getCapabilities("video");let e=!1;if(n){for(const t of n.codecs)if(t.mimeType==="video/VP9"){e=!0;break}}return e}function Lc(n){return n==="av1"||n==="vp9"}function Lp(n){return document?(n||(n=document.createElement("audio")),"setSinkId"in n):!1}function _I(){return typeof RTCPeerConnection>"u"?!1:Np()||Dp()}function Do(){var n;return((n=Ls())===null||n===void 0?void 0:n.name)==="Firefox"}function Qr(){var n;return((n=Ls())===null||n===void 0?void 0:n.name)==="Safari"}function vI(){const n=Ls();return(n==null?void 0:n.name)==="Safari"&&n.version.startsWith("17.")}function aS(){var n,e;return xi()?(e=(n=navigator.userAgentData)===null||n===void 0?void 0:n.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function bI(){const n=Ls(),e="17.2";if(n)return n.name!=="Safari"&&n.os!=="iOS"||n.os==="iOS"&&n.osVersion&&Lo(e,n.osVersion)>=0?!0:n.name==="Safari"&&Lo(e,n.version)>=0}function xi(){return typeof document<"u"}function Os(){return navigator.product=="ReactNative"}function Op(n){return n.hostname.endsWith(".livekit.cloud")||n.hostname.endsWith(".livekit.run")}function oS(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function cS(){if(!Os())return;let n=oS();if(n)return n.platform}function V_(){if(xi())return window.devicePixelRatio;if(Os()){let n=oS();if(n)return n.devicePixelRatio}return 1}function Lo(n,e){const t=n.split("."),i=e.split("."),s=Math.min(t.length,i.length);for(let r=0;r<s;++r){const a=parseInt(t[r],10),o=parseInt(i[r],10);if(a>o)return 1;if(a<o)return-1;if(r===s-1&&a===o)return 0}return n===""&&e!==""?-1:e===""?1:t.length==i.length?0:t.length<i.length?-1:1}function yI(n){for(const e of n)e.target.handleResize(e)}function TI(n){for(const e of n)e.target.handleVisibilityChanged(e)}let qh=null;const G_=()=>(qh||(qh=new ResizeObserver(yI)),qh);let Xh=null;const z_=()=>(Xh||(Xh=new IntersectionObserver(TI,{root:null,rootMargin:"0px"})),Xh);function SI(){var n;const e=new h2({sdk:fT.JS,protocol:cI,version:oI});return Os()&&(e.os=(n=cS())!==null&&n!==void 0?n:""),e}function H_(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const s=document.createElement("canvas");s.width=n,s.height=e;const r=s.getContext("2d");r==null||r.fillRect(0,0,s.width,s.height),i&&r&&(r.beginPath(),r.arc(n/2,e/2,50,0,Math.PI*2,!0),r.closePath(),r.fillStyle="grey",r.fill());const a=s.captureStream(),[o]=a.getTracks();if(!o)throw Error("Could not get empty media stream video track");return o.enabled=t,o}let oc;function Yh(){if(!oc){const n=new AudioContext,e=n.createOscillator(),t=n.createGain();t.gain.setValueAtTime(0,0);const i=n.createMediaStreamDestination();if(e.connect(t),t.connect(i),e.start(),[oc]=i.stream.getAudioTracks(),!oc)throw Error("Could not get empty media stream audio track");oc.enabled=!1}return oc.clone()}class lS{constructor(e,t){this.onFinally=t,this.promise=new Promise((i,s)=>G(this,void 0,void 0,function*(){this.resolve=i,this.reject=s,e&&(yield e(i,s))})).finally(()=>{var i;return(i=this.onFinally)===null||i===void 0?void 0:i.call(this)})}}function EI(n){return dI.includes(n)}function jr(n){if(typeof n=="string"||typeof n=="number")return n;if(Array.isArray(n))return n[0];if(n.exact)return Array.isArray(n.exact)?n.exact[0]:n.exact;if(n.ideal)return Array.isArray(n.ideal)?n.ideal[0]:n.ideal;throw Error("could not unwrap constraint")}function AI(n){return n.startsWith("http")?n.replace(/^(http)/,"ws"):n}function W_(n){return n.startsWith("ws")?n.replace(/^(ws)/,"http"):n}function CI(n,e){return n.segments.map(t=>{let{id:i,text:s,language:r,startTime:a,endTime:o,final:l}=t;var c;const u=(c=e.get(i))!==null&&c!==void 0?c:Date.now(),d=Date.now();return l?e.delete(i):e.set(i,u),{id:i,text:s,startTime:Number.parseInt(a.toString()),endTime:Number.parseInt(o.toString()),final:l,language:r,firstReceivedTime:u,lastReceivedTime:d}})}function wI(n){const{id:e,timestamp:t,message:i,editTimestamp:s}=n;return{id:e,timestamp:Number.parseInt(t.toString()),editTimestamp:s?Number.parseInt(s.toString()):void 0,message:i}}function j_(n){switch(n.reason){case qt.LeaveRequest:return n.context;case qt.Cancelled:return Kn.CLIENT_INITIATED;case qt.NotAllowed:return Kn.USER_REJECTED;case qt.ServerUnreachable:return Kn.JOIN_FAILURE;default:return Kn.UNKNOWN_REASON}}function Tu(n){return n!==void 0?Number(n):void 0}function pa(n){return n!==void 0?BigInt(n):void 0}function Eo(n){return!!n&&!(n instanceof MediaStreamTrack)&&n.isLocal}function fr(n){return!!n&&n.kind==xe.Kind.Audio}function Jo(n){return!!n&&n.kind==xe.Kind.Video}function Tr(n){return Eo(n)&&Jo(n)}function ma(n){return Eo(n)&&fr(n)}function Up(n){return!!n&&!n.isLocal}function RI(n){return!!n&&!n.isLocal}function Jh(n){return Up(n)&&Jo(n)}function kI(n){return n.isLocal}function MI(n,e){const t=[];let i=new TextEncoder().encode(n);for(;i.length>e;){let s=e;for(;s>0;){const r=i[s];if(r!==void 0&&(r&192)!==128)break;s--}t.push(i.slice(0,s)),i=i.slice(s)}return i.length>0&&t.push(i),t}function uS(n,e,t){var i,s,r,a,o;const{optionsWithoutProcessor:l,audioProcessor:c,videoProcessor:u}=_g(n??{}),d=e==null?void 0:e.processor,h=t==null?void 0:t.processor,f=(i=iI(l))!==null&&i!==void 0?i:{};return f.audio===!0&&(f.audio={}),f.video===!0&&(f.video={}),f.audio&&(Fp(f.audio,e),(s=(a=f.audio).deviceId)!==null&&s!==void 0||(a.deviceId="default"),(c||d)&&(f.audio.processor=c??d)),f.video&&(Fp(f.video,t),(r=(o=f.video).deviceId)!==null&&r!==void 0||(o.deviceId="default"),(u||h)&&(f.video.processor=u??h)),f}function Fp(n,e){return Object.keys(e).forEach(t=>{n[t]===void 0&&(n[t]=e[t])}),n}function Td(n){var e,t,i,s;const r={};if(n.video)if(typeof n.video=="object"){const a={},o=a,l=n.video;Object.keys(l).forEach(c=>{switch(c){case"resolution":Fp(o,l.resolution);break;default:o[c]=l[c]}}),r.video=a,(e=(i=r.video).deviceId)!==null&&e!==void 0||(i.deviceId="default")}else r.video=n.video?{deviceId:"default"}:!1;else r.video=!1;return n.audio?typeof n.audio=="object"?(r.audio=n.audio,(t=(s=r.audio).deviceId)!==null&&t!==void 0||(s.deviceId="default")):r.audio={deviceId:"default"}:r.audio=!1,r}function dS(n){return G(this,arguments,void 0,function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const i=hS();if(i){const s=i.createAnalyser();s.fftSize=2048;const r=s.frequencyBinCount,a=new Uint8Array(r);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(s),yield Ii(t),s.getByteTimeDomainData(a);const l=a.some(c=>c!==128&&c!==0);return i.close(),!l}return!1}()})}function hS(){const n=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(n)return new n({latencyHint:"interactive"})}function K_(n){return n===xe.Source.Microphone?"audioinput":n===xe.Source.Camera?"videoinput":void 0}function xI(n){var e,t;let i=(e=n.video)!==null&&e!==void 0?e:!0;return n.resolution&&n.resolution.width>0&&n.resolution.height>0&&(i=typeof i=="boolean"?{}:i,Qr()?i=Object.assign(Object.assign({},i),{width:{max:n.resolution.width},height:{max:n.resolution.height},frameRate:n.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:n.resolution.width},height:{ideal:n.resolution.height},frameRate:n.resolution.frameRate})),{audio:(t=n.audio)!==null&&t!==void 0?t:!1,video:i,controller:n.controller,selfBrowserSurface:n.selfBrowserSurface,surfaceSwitching:n.surfaceSwitching,systemAudio:n.systemAudio,preferCurrentTab:n.preferCurrentTab}}function Su(n){return n.split("/")[1].toLowerCase()}function II(n){const e=[];return n.forEach(t=>{t.track!==void 0&&e.push(new ug({cid:t.track.mediaStreamID,track:t.trackInfo}))}),e}function yn(n){return"mediaStreamTrack"in n?{trackID:n.sid,source:n.source,muted:n.isMuted,enabled:n.mediaStreamTrack.enabled,kind:n.kind,streamID:n.mediaStreamID,streamTrackID:n.mediaStreamTrack.id}:{trackID:n.trackSid,enabled:n.isEnabled,muted:n.isMuted,trackInfo:Object.assign({mimeType:n.mimeType,name:n.trackName,encrypted:n.isEncrypted,kind:n.kind,source:n.source},n.track?yn(n.track):{})}}function PI(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function NI(n,e){var t;n===void 0&&(n={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(n)],s={};for(const r of i)n[r]!==e[r]&&(s[r]=(t=e[r])!==null&&t!==void 0?t:"");return s}function _g(n){const e=Object.assign({},n);let t,i;return typeof e.audio=="object"&&e.audio.processor&&(t=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:t,videoProcessor:i,optionsWithoutProcessor:e}}class DI extends Fs.EventEmitter{constructor(e){super(),this.onWorkerMessage=t=>{var i,s;const{kind:r,data:a}=t.data;switch(r){case"error":Ht.error(a.error.message),this.emit(Gr.EncryptionError,a.error);break;case"initAck":a.enabled&&this.keyProvider.getKeys().forEach(o=>{this.postKey(o)});break;case"enable":if(a.enabled&&this.keyProvider.getKeys().forEach(o=>{this.postKey(o)}),this.encryptionEnabled!==a.enabled&&a.participantIdentity===((i=this.room)===null||i===void 0?void 0:i.localParticipant.identity))this.emit(Gr.ParticipantEncryptionStatusChanged,a.enabled,this.room.localParticipant),this.encryptionEnabled=a.enabled;else if(a.participantIdentity){const o=(s=this.room)===null||s===void 0?void 0:s.getParticipantByIdentity(a.participantIdentity);if(!o)throw TypeError("couldn't set encryption status, participant not found".concat(a.participantIdentity));this.emit(Gr.ParticipantEncryptionStatusChanged,a.enabled,o)}break;case"ratchetKey":this.keyProvider.emit(Wr.KeyRatcheted,a.material,a.keyIndex);break}},this.onWorkerError=t=>{Ht.error("e2ee worker encountered an error:",{error:t.error}),this.emit(Gr.EncryptionError,t.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!eI())throw new mg("tried to setup end-to-end encryption on an unsupported browser");if(Ht.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:B2.getLevel()}};this.worker&&(Ht.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}setParticipantCryptorEnabled(e,t){Ht.debug("set e2ee to ".concat(e," for participant ").concat(t)),this.postEnable(e,t)}setSifTrailer(e){!e||e.length===0?Ht.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(We.RTPVideoMapUpdate,t=>{this.postRTPMap(t)})}setupEventListeners(e,t){e.on(Ce.TrackPublished,(i,s)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==Bi.NONE,s.identity)),e.on(Ce.ConnectionStateChanged,i=>{i===nn.Connected&&e.remoteParticipants.forEach(s=>{s.trackPublications.forEach(r=>{this.setParticipantCryptorEnabled(r.trackInfo.encryption!==Bi.NONE,s.identity)})})}).on(Ce.TrackUnsubscribed,(i,s,r)=>{var a;const o={kind:"removeTransform",data:{participantIdentity:r.identity,trackId:i.mediaStreamID}};(a=this.worker)===null||a===void 0||a.postMessage(o)}).on(Ce.TrackSubscribed,(i,s,r)=>{this.setupE2EEReceiver(i,r.identity,s.trackInfo)}).on(Ce.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");t.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(qe.LocalTrackPublished,i=>G(this,void 0,void 0,function*(){this.setupE2EESender(i.track,i.track.sender)})),t.on(Wr.SetKey,i=>this.postKey(i)).on(Wr.RatchetRequest,(i,s)=>this.postRatchetRequest(i,s))}postRatchetRequest(e,t){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t}};this.worker.postMessage(i)}postKey(e){let{key:t,participantIdentity:i,keyIndex:s}=e;var r;if(!this.worker)throw Error("could not set key, worker is missing");const a={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity),key:t,keyIndex:s}};this.worker.postMessage(a)}postEnable(e,t){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((t=this.room)===null||t===void 0)&&t.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}setupE2EEReceiver(e,t,i){if(e.receiver){if(!(i!=null&&i.mimeType)||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,t,e.kind==="video"?Su(i.mimeType):void 0)}}setupE2EESender(e,t){if(!Eo(e)||!t){t||Ht.warn("early return because sender is not ready");return}this.handleSender(t,e.mediaStreamID,void 0)}handleReceiver(e,t,i,s){return G(this,void 0,void 0,function*(){if(this.worker){if(Mp()){const r={kind:"decode",participantIdentity:i,trackId:t,codec:s};e.transform=new RTCRtpScriptTransform(this.worker,r)}else{if(Tl in e&&s){const l={kind:"updateCodec",data:{trackId:t,codec:s,participantIdentity:i}};this.worker.postMessage(l);return}let r=e.writableStream,a=e.readableStream;if(!r||!a){const l=e.createEncodedStreams();e.writableStream=l.writable,r=l.writable,e.readableStream=l.readable,a=l.readable}const o={kind:"decode",data:{readableStream:a,writableStream:r,trackId:t,codec:s,participantIdentity:i}};this.worker.postMessage(o,[a,r])}e[Tl]=!0}})}handleSender(e,t,i){var s;if(!(Tl in e||!this.worker)){if(!(!((s=this.room)===null||s===void 0)&&s.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(Mp()){Ht.info("initialize script transform");const r={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:t,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,r)}else{Ht.info("initialize encoded streams");const r=e.createEncodedStreams(),a={kind:"encode",data:{readableStream:r.readable,writableStream:r.writable,codec:i,trackId:t,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(a,[r.readable,r.writable])}e[Tl]=!0}}}const Qh="default";class ei{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new ei),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return G(this,arguments,void 0,function(t){var i=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var r;if(((r=ei.userMediaPromiseMap)===null||r===void 0?void 0:r.size)>0){Ht.debug("awaiting getUserMedia promise");try{t?yield ei.userMediaPromiseMap.get(t):yield Promise.all(ei.userMediaPromiseMap.values())}catch{Ht.warn("error waiting for media permissons")}}let a=yield navigator.mediaDevices.enumerateDevices();if(s&&!(Qr()&&i.hasDeviceInUse(t))&&(a.filter(l=>l.kind===t).length===0||a.some(l=>{const c=l.label==="",u=t?l.kind===t:!0;return c&&u}))){const l={video:t!=="audioinput"&&t!=="audiooutput",audio:t!=="videoinput"&&{deviceId:"default"}},c=yield navigator.mediaDevices.getUserMedia(l);a=yield navigator.mediaDevices.enumerateDevices(),c.getTracks().forEach(u=>{u.stop()})}return i._previousDevices=a,t&&(a=a.filter(o=>o.kind===t)),a}()})}normalizeDeviceId(e,t,i){return G(this,void 0,void 0,function*(){if(t!==Qh)return t;const s=yield this.getDevices(e),r=s.find(o=>o.deviceId===Qh);if(!r){Ht.warn("could not reliably determine default device");return}const a=s.find(o=>o.deviceId!==Qh&&o.groupId===(i??r.groupId));if(!a){Ht.warn("could not reliably determine default device");return}return a==null?void 0:a.deviceId})}hasDeviceInUse(e){return e?ei.userMediaPromiseMap.has(e):ei.userMediaPromiseMap.size>0}}ei.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];ei.userMediaPromiseMap=new Map;var Oc;(function(n){n[n.WAITING=0]="WAITING",n[n.RUNNING=1]="RUNNING",n[n.COMPLETED=2]="COMPLETED"})(Oc||(Oc={}));class LI{constructor(){this.pendingTasks=new Map,this.taskMutex=new Hi,this.nextTaskIndex=0}run(e){return G(this,void 0,void 0,function*(){const t={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Oc.WAITING};this.pendingTasks.set(t.id,t);const i=yield this.taskMutex.lock();try{return t.executedAt=Date.now(),t.status=Oc.RUNNING,yield e()}finally{t.status=Oc.COMPLETED,this.pendingTasks.delete(t.id),i()}})}flush(){return G(this,void 0,void 0,function*(){return this.run(()=>G(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}const OI=["syncState","trickle","offer","answer","simulate","leave"];function UI(n){const e=OI.indexOf(n.case)>=0;return Ht.trace("request allowed to bypass queue:",{canPass:e,req:n}),e}var Mn;(function(n){n[n.CONNECTING=0]="CONNECTING",n[n.CONNECTED=1]="CONNECTED",n[n.RECONNECTING=2]="RECONNECTING",n[n.DISCONNECTING=3]="DISCONNECTING",n[n.DISCONNECTED=4]="DISCONNECTED"})(Mn||(Mn={}));class vg{get currentState(){return this.state}get isDisconnected(){return this.state===Mn.DISCONNECTING||this.state===Mn.DISCONNECTED}get isEstablishingConnection(){return this.state===Mn.CONNECTING||this.state===Mn.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=Mn.DISCONNECTED,this.log=Ht,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=hr((i=t.loggerName)!==null&&i!==void 0?i:ys.Signal),this.loggerContextCb=t.loggerContextCb,this.useJSON=e,this.requestQueue=new LI,this.queuedRequests=[],this.closingLock=new Hi,this.connectionLock=new Hi,this.state=Mn.DISCONNECTED}get logContext(){var e,t;return(t=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&t!==void 0?t:{}}join(e,t,i,s){return G(this,void 0,void 0,function*(){return this.state=Mn.CONNECTING,this.options=i,yield this.connect(e,t,i,s)})}reconnect(e,t,i,s){return G(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=Mn.RECONNECTING,this.clearPingInterval(),yield this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:s}))})}connect(e,t,i,s){this.connectOptions=i,e=AI(e),e=e.replace(/\/$/,""),e+="/rtc";const r=SI(),a=FI(t,r,i);return new Promise((o,l)=>G(this,void 0,void 0,function*(){const c=yield this.connectionLock.lock();try{const u=()=>G(this,void 0,void 0,function*(){this.close(),clearTimeout(d),l(new Sn("room connection has been cancelled (signal)",qt.Cancelled))}),d=setTimeout(()=>{this.close(),l(new Sn("room connection has timed out (signal)",qt.ServerUnreachable))},i.websocketTimeout);s!=null&&s.aborted&&u(),s==null||s.addEventListener("abort",u),this.log.debug("connecting to ".concat(e+a.replace(/access_token=([^&#$]*)/,"access_token=<redacted>")),this.logContext),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(e+a),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(d)},this.ws.onerror=h=>G(this,void 0,void 0,function*(){if(this.state!==Mn.CONNECTED){this.state=Mn.DISCONNECTED,clearTimeout(d);try{const f=yield fetch("http".concat(e.substring(2),"/validate").concat(a));if(f.status.toFixed(0).startsWith("4")){const g=yield f.text();l(new Sn(g,qt.NotAllowed,f.status))}else l(new Sn("Internal error",qt.InternalError,f.status))}catch(f){l(new Sn(f instanceof Error?f.message:"server was not reachable",qt.ServerUnreachable))}return}this.handleWSError(h)}),this.ws.onmessage=h=>G(this,void 0,void 0,function*(){var f,g,v;let m;if(typeof h.data=="string"){const _=JSON.parse(h.data);m=E_.fromJson(_,{ignoreUnknownFields:!0})}else if(h.data instanceof ArrayBuffer)m=E_.fromBinary(new Uint8Array(h.data));else{this.log.error("could not decode websocket message: ".concat(typeof h.data),this.logContext);return}if(this.state!==Mn.CONNECTED){let _=!1;if(((f=m.message)===null||f===void 0?void 0:f.case)==="join"?(this.state=Mn.CONNECTED,s==null||s.removeEventListener("abort",u),this.pingTimeoutDuration=m.message.value.pingTimeout,this.pingIntervalDuration=m.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),o(m.message.value)):this.state===Mn.RECONNECTING&&m.message.case!=="leave"?(this.state=Mn.CONNECTED,s==null||s.removeEventListener("abort",u),this.startPingInterval(),((g=m.message)===null||g===void 0?void 0:g.case)==="reconnect"?o(m.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),o(void 0),_=!0)):this.isEstablishingConnection&&m.message.case==="leave"?l(new Sn("Received leave request while trying to (re)connect",qt.LeaveRequest,void 0,m.message.value.reason)):i.reconnect||l(new Sn("did not receive join response, got ".concat((v=m.message)===null||v===void 0?void 0:v.case," instead"),qt.InternalError)),!_)return}this.signalLatency&&(yield Ii(this.signalLatency)),this.handleSignalResponse(m)}),this.ws.onclose=h=>{this.isEstablishingConnection&&l(new Sn("Websocket got closed during a (re)connection attempt",qt.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:h.reason,code:h.code,wasClean:h.wasClean,state:this.state})),this.handleOnClose(h.reason)}}finally{c()}}))}close(){return G(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const i=yield e.closingLock.lock();try{if(e.clearPingInterval(),t&&(e.state=Mn.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const s=new Promise(r=>{e.ws?e.ws.onclose=()=>{r()}:r()});e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([s,Ii(250)])),e.ws=void 0}}finally{t&&(e.state=Mn.DISCONNECTED),i()}}()})}sendOffer(e){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:Xu(e)})}sendAnswer(e){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:Xu(e)})}sendIceCandidate(e,t){return this.log.trace("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new cg({candidateInit:JSON.stringify(e),target:t})})}sendMuteTrack(e,t){return this.sendRequest({case:"mute",value:new lg({sid:e,muted:t})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,t){return G(this,arguments,void 0,function(i,s){var r=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const o=r.getNextRequestId();return yield r.sendRequest({case:"updateMetadata",value:new TT({requestId:o,metadata:i,name:s,attributes:a})}),o}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,t){return this.sendRequest({case:"updateLayers",value:new yT({trackSid:e,layers:t})})}sendUpdateSubscriptionPermissions(e,t){return this.sendRequest({case:"subscriptionPermission",value:new AT({allParticipants:e,trackPermissions:t})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:xn.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new RT({timestamp:xn.parse(Date.now()),rtt:xn.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,t){return this.sendRequest({case:"updateAudioTrack",value:new bT({trackSid:e,features:t})})}sendLeave(){return this.sendRequest({case:"leave",value:new bd({reason:Kn.CLIENT_INITIATED,action:yo.DISCONNECT})})}sendRequest(e){return G(this,arguments,void 0,function(t){var i=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!s&&!UI(t)&&i.state===Mn.RECONNECTING){i.queuedRequests.push(()=>G(i,void 0,void 0,function*(){yield this.sendRequest(t,!0)}));return}if(s||(yield i.requestQueue.flush()),i.signalLatency&&(yield Ii(i.signalLatency)),!i.ws||i.ws.readyState!==i.ws.OPEN){i.log.error("cannot send signal request before connected, type: ".concat(t==null?void 0:t.case),i.logContext);return}const a=new m2({message:t});try{i.useJSON?i.ws.send(a.toJsonString()):i.ws.send(a.toBinary())}catch(o){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:o}))}}()})}handleSignalResponse(e){var t,i;const s=e.message;if(s==null){this.log.debug("received unsupported message",this.logContext);return}let r=!1;if(s.case==="answer"){const a=q_(s.value);this.onAnswer&&this.onAnswer(a)}else if(s.case==="offer"){const a=q_(s.value);this.onOffer&&this.onOffer(a)}else if(s.case==="trickle"){const a=JSON.parse(s.value.candidateInit);this.onTrickle&&this.onTrickle(a,s.value.target)}else s.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((t=s.value.participants)!==null&&t!==void 0?t:[]):s.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(s.value):s.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=s.value.speakers)!==null&&i!==void 0?i:[]):s.case==="leave"?this.onLeave&&this.onLeave(s.value):s.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(s.value.sid,s.value.muted):s.case==="roomUpdate"?this.onRoomUpdate&&s.value.room&&this.onRoomUpdate(s.value.room):s.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(s.value):s.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(s.value):s.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(s.value):s.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(s.value):s.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(s.value):s.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(s.value):s.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(s.value):s.case==="pong"||(s.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(s.value.lastPingTimestamp.toString()),this.resetPingTimeout(),r=!0):s.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(s.value):s.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(s.value.trackSid):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:s.case})));r||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return G(this,void 0,void 0,function*(){if(this.state===Mn.DISCONNECTED)return;const t=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),t&&t(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=ui.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&ui.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=ui.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&ui.clearInterval(this.pingInterval)}}function q_(n){const e={type:"offer",sdp:n.sdp};switch(n.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=n.type;break}return e}function Xu(n){return new Ra({sdp:n.sdp,type:n.type})}function FI(n,e,t){var i;const s=new URLSearchParams;return s.set("access_token",n),t.reconnect&&(s.set("reconnect","1"),t.sid&&s.set("sid",t.sid)),s.set("auto_subscribe",t.autoSubscribe?"1":"0"),s.set("sdk",Os()?"reactnative":"js"),s.set("version",e.version),s.set("protocol",e.protocol.toString()),e.deviceModel&&s.set("device_model",e.deviceModel),e.os&&s.set("os",e.os),e.osVersion&&s.set("os_version",e.osVersion),e.browser&&s.set("browser",e.browser),e.browserVersion&&s.set("browser_version",e.browserVersion),t.adaptiveStream&&s.set("adaptive_stream","1"),t.reconnectReason&&s.set("reconnect_reason",t.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&s.set("network",navigator.connection.type),"?".concat(s.toString())}var ns={},Zh={},$h={exports:{}},X_;function bg(){if(X_)return $h.exports;X_=1;var n=$h.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=e.raddr!=null?" raddr %s rport %d":"%v%v",t+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(t+=" generation %d"),t+=e["network-id"]!=null?" network-id %d":"%v",t+=e["network-cost"]!=null?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return e.attribute!=null&&(t+=" %s",e.value!=null&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=e.id!=null?"id=%s %s":"%v%s",t+=e.mediaClockValue!=null?"=%s":"",t+=e.rateNumerator!=null?" rate=%s":"",t+=e.rateDenominator!=null?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(n).forEach(function(e){var t=n[e];t.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),$h.exports}var Y_;function BI(){return Y_||(Y_=1,function(n){var e=function(o){return String(Number(o))===o?Number(o):o},t=function(o,l,c,u){if(u&&!c)l[u]=e(o[1]);else for(var d=0;d<c.length;d+=1)o[d+1]!=null&&(l[c[d]]=e(o[d+1]))},i=function(o,l,c){var u=o.name&&o.names;o.push&&!l[o.push]?l[o.push]=[]:u&&!l[o.name]&&(l[o.name]={});var d=o.push?{}:u?l[o.name]:l;t(c.match(o.reg),d,o.names,o.name),o.push&&l[o.push].push(d)},s=bg(),r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(o){var l={},c=[],u=l;return o.split(/(\r\n|\r|\n)/).filter(r).forEach(function(d){var h=d[0],f=d.slice(2);h==="m"&&(c.push({rtp:[],fmtp:[]}),u=c[c.length-1]);for(var g=0;g<(s[h]||[]).length;g+=1){var v=s[h][g];if(v.reg.test(f))return i(v,u,f)}}),l.media=c,l};var a=function(o,l){var c=l.split(/=(.+)/,2);return c.length===2?o[c[0]]=e(c[1]):c.length===1&&l.length>1&&(o[c[0]]=void 0),o};n.parseParams=function(o){return o.split(/;\s?/).reduce(a,{})},n.parseFmtpConfig=n.parseParams,n.parsePayloads=function(o){return o.toString().split(" ").map(Number)},n.parseRemoteCandidates=function(o){for(var l=[],c=o.split(" ").map(e),u=0;u<c.length;u+=3)l.push({component:c[u],ip:c[u+1],port:c[u+2]});return l},n.parseImageAttributes=function(o){return o.split(" ").map(function(l){return l.substring(1,l.length-1).split(",").reduce(a,{})})},n.parseSimulcastStreamList=function(o){return o.split(";").map(function(l){return l.split(",").map(function(c){var u,d=!1;return c[0]!=="~"?u=e(c):(u=e(c.substring(1,c.length)),d=!0),{scid:u,paused:d}})})}}(Zh)),Zh}var ef,J_;function VI(){if(J_)return ef;J_=1;var n=bg(),e=/%[sdv%]/g,t=function(a){var o=1,l=arguments,c=l.length;return a.replace(e,function(u){if(o>=c)return u;var d=l[o];switch(o+=1,u){case"%%":return"%";case"%s":return String(d);case"%d":return Number(d);case"%v":return""}})},i=function(a,o,l){var c=o.format instanceof Function?o.format(o.push?l:l[o.name]):o.format,u=[a+"="+c];if(o.names)for(var d=0;d<o.names.length;d+=1){var h=o.names[d];o.name?u.push(l[o.name][h]):u.push(l[o.names[d]])}else u.push(l[o.name]);return t.apply(null,u)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],r=["i","c","b","a"];return ef=function(a,o){o=o||{},a.version==null&&(a.version=0),a.name==null&&(a.name=" "),a.media.forEach(function(d){d.payloads==null&&(d.payloads="")});var l=o.outerOrder||s,c=o.innerOrder||r,u=[];return l.forEach(function(d){n[d].forEach(function(h){h.name in a&&a[h.name]!=null?u.push(i(d,h,a)):h.push in a&&a[h.push]!=null&&a[h.push].forEach(function(f){u.push(i(d,h,f))})})}),a.media.forEach(function(d){u.push(i("m",n.m[0],d)),c.forEach(function(h){n[h].forEach(function(f){f.name in d&&d[f.name]!=null?u.push(i(h,f,d)):f.push in d&&d[f.push]!=null&&d[f.push].forEach(function(g){u.push(i(h,f,g))})})})}),u.join(`\r
`)+`\r
`},ef}var Q_;function GI(){if(Q_)return ns;Q_=1;var n=BI(),e=VI(),t=bg();return ns.grammar=t,ns.write=e,ns.parse=n.parse,ns.parseParams=n.parseParams,ns.parseFmtpConfig=n.parseFmtpConfig,ns.parsePayloads=n.parsePayloads,ns.parseRemoteCandidates=n.parseRemoteCandidates,ns.parseImageAttributes=n.parseImageAttributes,ns.parseSimulcastStreamList=n.parseSimulcastStreamList,ns}var Ir=GI();function yg(n,e,t){var i,s,r;e===void 0&&(e=50),t===void 0&&(t={});var a=(i=t.isImmediate)!=null&&i,o=(s=t.callback)!=null&&s,l=t.maxWait,c=Date.now(),u=[];function d(){if(l!==void 0){var f=Date.now()-c;if(f+e>=l)return l-f}return e}var h=function(){var f=[].slice.call(arguments),g=this;return new Promise(function(v,m){var _=a&&r===void 0;if(r!==void 0&&clearTimeout(r),r=setTimeout(function(){if(r=void 0,c=Date.now(),!a){var b=n.apply(g,f);o&&o(b),u.forEach(function(p){return(0,p.resolve)(b)}),u=[]}},d()),_){var y=n.apply(g,f);return o&&o(y),v(y)}u.push({resolve:v,reject:m})})};return h.cancel=function(f){r!==void 0&&clearTimeout(r),u.forEach(function(g){return(0,g.reject)(f)}),u=[]},h}const zI=.7,HI=20,Ao={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class Z_ extends Fs.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=Ht,this.ddExtID=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=yg(s=>G(this,void 0,void 0,function*(){this.emit(Ao.NegotiationStarted);try{yield this.createAndSendOffer()}catch(r){if(s)s(r);else throw r}}),HI),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=hr((i=t.loggerName)!==null&&i!==void 0?i:ys.PCTransport),this.loggerOptions=t,this.config=e,this._pc=this.createPC()}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=t=>{var i;t.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,t.candidate))},e.onicecandidateerror=t=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,t)},e.oniceconnectionstatechange=()=>{var t;(t=this.onIceConnectionStateChange)===null||t===void 0||t.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var t;(t=this.onSignalingStatechange)===null||t===void 0||t.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,e.connectionState)},e.ondatachannel=t=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,t)},e.ontrack=t=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,t)},e}get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions).loggerContextCb)===null||t===void 0?void 0:t.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return G(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e){return G(this,void 0,void 0,function*(){var t;let i;if(e.type==="offer"){let{stereoMids:s,nackMids:r}=WI(e);this.remoteStereoMids=s,this.remoteNackMids=r}else if(e.type==="answer"){const s=Ir.parse((t=e.sdp)!==null&&t!==void 0?t:"");s.media.forEach(r=>{r.type==="audio"&&this.trackBitrates.some(a=>{if(!a.transceiver||r.mid!=a.transceiver.mid)return!1;let o=0;if(r.rtp.some(c=>c.codec.toUpperCase()===a.codec.toUpperCase()?(o=c.payload,!0):!1),o===0)return!0;let l=!1;for(const c of r.fmtp)if(c.payload===o){c.config=c.config.split(";").filter(u=>!u.includes("maxaveragebitrate")).join(";"),a.maxbr>0&&(c.config+=";maxaveragebitrate=".concat(a.maxbr*1e3)),l=!0;break}return l||a.maxbr>0&&r.fmtp.push({payload:o,config:"maxaveragebitrate=".concat(a.maxbr*1e3)}),!0})}),i=Ir.write(s)}yield this.setMungedSDP(e,i,!0),this.pendingCandidates.forEach(s=>{this.pc.addIceCandidate(s)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(Ao.NegotiationComplete),e.sdp&&Ir.parse(e.sdp).media.forEach(r=>{r.type==="video"&&this.emit(Ao.RTPVideoPayloadTypes,r.rtp)}))})}createAndSendOffer(e){return G(this,void 0,void 0,function*(){var t;if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const r=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&r)yield this._pc.setRemoteDescription(r);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const i=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:i.sdp},this.logContext));const s=Ir.parse((t=i.sdp)!==null&&t!==void 0?t:"");s.media.forEach(r=>{ev(r),r.type==="audio"?$_(r,[],[]):r.type==="video"&&this.trackBitrates.some(a=>{if(!r.msid||!a.cid||!r.msid.includes(a.cid))return!1;let o=0;if(r.rtp.some(c=>c.codec.toUpperCase()===a.codec.toUpperCase()?(o=c.payload,!0):!1),o===0||(Lc(a.codec)&&this.ensureVideoDDExtensionForSVC(r,s),a.codec!=="av1"))return!0;const l=Math.round(a.maxbr*zI);for(const c of r.fmtp)if(c.payload===o){c.config.includes("x-google-start-bitrate")||(c.config+=";x-google-start-bitrate=".concat(l));break}return!0})}),yield this.setMungedSDP(i,Ir.write(s)),this.onOffer(i)})}createAndSetAnswer(){return G(this,void 0,void 0,function*(){var e;const t=yield this.pc.createAnswer(),i=Ir.parse((e=t.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(s=>{ev(s),s.type==="audio"&&$_(s,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(t,Ir.write(i)),t})}createDataChannel(e,t){return this.pc.createDataChannel(e,t)}addTransceiver(e,t){return this.pc.addTransceiver(e,t)}addTrack(e){if(!this._pc)throw new Xn("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var t;if(!this._pc)throw new Xn("PC closed, cannot configure");return(t=this._pc)===null||t===void 0?void 0:t.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var t;return(t=this._pc)===null||t===void 0?void 0:t.removeTrack(e)}getConnectionState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&t!==void 0?t:"closed"}getICEConnectionState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&t!==void 0?t:"closed"}getSignallingState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&t!==void 0?t:"closed"}getTransceivers(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&t!==void 0?t:[]}getSenders(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&t!==void 0?t:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return G(this,void 0,void 0,function*(){var e;if(!this._pc)return;let t="";const i=new Map,s=new Map;if((yield this._pc.getStats()).forEach(o=>{switch(o.type){case"transport":t=o.selectedCandidatePairId;break;case"candidate-pair":t===""&&o.selected&&(t=o.id),i.set(o.id,o);break;case"remote-candidate":s.set(o.id,"".concat(o.address,":").concat(o.port));break}}),t==="")return;const a=(e=i.get(t))===null||e===void 0?void 0:e.remoteCandidateId;if(a!==void 0)return s.get(a)})}setMungedSDP(e,t,i){return G(this,void 0,void 0,function*(){if(t){const s=e.sdp;e.sdp=t;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(r){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:r,sdp:t})),e.sdp=s}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(s){let r="unknown error";s instanceof Error?r=s.message:typeof s=="string"&&(r=s);const a={error:r,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(a.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:a})),new xp(r)}})}ensureVideoDDExtensionForSVC(e,t){var i,s;if(!((i=e.ext)===null||i===void 0?void 0:i.some(a=>a.uri===B_))){if(this.ddExtID===0){let a=0;t.media.forEach(o=>{var l;o.type==="video"&&((l=o.ext)===null||l===void 0||l.forEach(c=>{c.value>a&&(a=c.value)}))}),this.ddExtID=a+1}(s=e.ext)===null||s===void 0||s.push({value:this.ddExtID,uri:B_})}}}function $_(n,e,t){let i=0;n.rtp.some(s=>s.codec==="opus"?(i=s.payload,!0):!1),i>0&&(n.rtcpFb||(n.rtcpFb=[]),t.includes(n.mid)&&!n.rtcpFb.some(s=>s.payload===i&&s.type==="nack")&&n.rtcpFb.push({payload:i,type:"nack"}),e.includes(n.mid)&&n.fmtp.some(s=>s.payload===i?(s.config.includes("stereo=1")||(s.config+=";stereo=1"),!0):!1))}function WI(n){var e;const t=[],i=[],s=Ir.parse((e=n.sdp)!==null&&e!==void 0?e:"");let r=0;return s.media.forEach(a=>{var o;a.type==="audio"&&(a.rtp.some(l=>l.codec==="opus"?(r=l.payload,!0):!1),!((o=a.rtcpFb)===null||o===void 0)&&o.some(l=>l.payload===r&&l.type==="nack")&&i.push(a.mid),a.fmtp.some(l=>l.payload===r?(l.config.includes("sprop-stereo=1")&&t.push(a.mid),!0):!1))}),{stereoMids:t,nackMids:i}}function ev(n){if(n.connection){const e=n.connection.ip.indexOf(":")>=0;(n.connection.version===4&&e||n.connection.version===6&&!e)&&(n.connection.ip="0.0.0.0",n.connection.version=4)}}const Bp="vp8",jI={audioPreset:Ip.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:gg.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Bp,backupCodec:!0},fS={deviceId:"default",autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},pS={deviceId:"default",resolution:Yc.h720.resolution},KI={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new fg,disconnectOnPageLeave:!0,webAudioMix:!1},Tg={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var On;(function(n){n[n.NEW=0]="NEW",n[n.CONNECTING=1]="CONNECTING",n[n.CONNECTED=2]="CONNECTED",n[n.FAILED=3]="FAILED",n[n.CLOSING=4]="CLOSING",n[n.CLOSED=5]="CLOSED"})(On||(On={}));class qI{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,t,i){var s;this.peerConnectionTimeout=Tg.peerConnectionTimeout,this.log=Ht,this.updateState=()=>{var r;const a=this.state,o=this.requiredTransports.map(l=>l.getConnectionState());o.every(l=>l==="connected")?this.state=On.CONNECTED:o.some(l=>l==="failed")?this.state=On.FAILED:o.some(l=>l==="connecting")?this.state=On.CONNECTING:o.every(l=>l==="closed")?this.state=On.CLOSED:o.some(l=>l==="closed")?this.state=On.CLOSING:o.every(l=>l==="new")&&(this.state=On.NEW),a!==this.state&&(this.log.debug("pc state change: from ".concat(On[a]," to ").concat(On[this.state]),this.logContext),(r=this.onStateChange)===null||r===void 0||r.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=hr((s=i.loggerName)!==null&&s!==void 0?s:ys.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=!t,this.isSubscriberConnectionRequired=t,this.publisher=new Z_(e,i),this.subscriber=new Z_(e,i),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=r=>{var a;(a=this.onIceCandidate)===null||a===void 0||a.call(this,r,ms.PUBLISHER)},this.subscriber.onIceCandidate=r=>{var a;(a=this.onIceCandidate)===null||a===void 0||a.call(this,r,ms.SUBSCRIBER)},this.subscriber.onDataChannel=r=>{var a;(a=this.onDataChannel)===null||a===void 0||a.call(this,r)},this.subscriber.onTrack=r=>{var a;(a=this.onTrack)===null||a===void 0||a.call(this,r)},this.publisher.onOffer=r=>{var a;(a=this.onPublisherOffer)===null||a===void 0||a.call(this,r)},this.state=On.NEW,this.connectionLock=new Hi,this.remoteOfferLock=new Hi}get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions).loggerContextCb)===null||t===void 0?void 0:t.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e){return this.publisher.setRemoteDescription(e)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return G(this,void 0,void 0,function*(){if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const e=this.publisher;for(const t of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(t)}catch(i){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:i}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return G(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,t){return G(this,void 0,void 0,function*(){t===ms.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e){return G(this,void 0,void 0,function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const t=yield this.remoteOfferLock.lock();try{return yield this.subscriber.setRemoteDescription(e),yield this.subscriber.createAndSetAnswer()}finally{t()}})}updateConfiguration(e,t){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),t&&this.triggerIceRestart()}ensurePCTransportConnection(e,t){return G(this,void 0,void 0,function*(){var i;const s=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(r=>this.ensureTransportConnected(r,e,t)))}finally{s()}})}negotiate(e){return G(this,void 0,void 0,function*(){return new Promise((t,i)=>G(this,void 0,void 0,function*(){const s=setTimeout(()=>{i("negotiation timed out")},this.peerConnectionTimeout),r=()=>{clearTimeout(s),i("negotiation aborted")};e.signal.addEventListener("abort",r),this.publisher.once(Ao.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(Ao.NegotiationComplete,()=>{clearTimeout(s),t()})}),yield this.publisher.negotiate(a=>{clearTimeout(s),i(a)})}))})}addPublisherTransceiver(e,t){return this.publisher.addTransceiver(e,t)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,t){return this.publisher.createDataChannel(e,t)}getConnectedAddress(e){return e===ms.PUBLISHER?this.publisher.getConnectedAddress():e===ms.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,t){return G(this,arguments,void 0,function(i,s){var r=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(i.getConnectionState()!=="connected")return new Promise((l,c)=>G(r,void 0,void 0,function*(){const u=()=>{this.log.warn("abort transport connection",this.logContext),ui.clearTimeout(d),c(new Sn("room connection has been cancelled",qt.Cancelled))};s!=null&&s.signal.aborted&&u(),s==null||s.signal.addEventListener("abort",u);const d=ui.setTimeout(()=>{s==null||s.signal.removeEventListener("abort",u),c(new Sn("could not establish pc connection",qt.InternalError))},a);for(;this.state!==On.CONNECTED;)if(yield Ii(50),s!=null&&s.signal.aborted){c(new Sn("room connection has been cancelled",qt.Cancelled));return}ui.clearTimeout(d),s==null||s.signal.removeEventListener("abort",u),l()}))}()})}}class Fn extends Error{constructor(e,t,i){super(t),this.code=e,this.message=tv(t,Fn.MAX_MESSAGE_BYTES),this.data=i?tv(i,Fn.MAX_DATA_BYTES):void 0}static fromProto(e){return new Fn(e.code,e.message,e.data)}toProto(){return new uT({code:this.code,message:this.message,data:this.data})}static builtIn(e,t){return new Fn(Fn.ErrorCode[e],Fn.ErrorMessage[e],t)}}Fn.MAX_MESSAGE_BYTES=256;Fn.MAX_DATA_BYTES=15360;Fn.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};Fn.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const mS=15360;function Sg(n){return new TextEncoder().encode(n).length}function tv(n,e){if(Sg(n)<=e)return n;let t=0,i=n.length;const s=new TextEncoder;for(;t<i;){const r=Math.floor((t+i+1)/2);s.encode(n.slice(0,r)).length<=e?t=r:i=r-1}return n.slice(0,t)}const Eg=2e3;function Sd(n,e){if(!e)return 0;let t,i;return"bytesReceived"in n?(t=n.bytesReceived,i=e.bytesReceived):"bytesSent"in n&&(t=n.bytesSent,i=e.bytesSent),t===void 0||i===void 0||n.timestamp===void 0||e.timestamp===void 0?0:(t-i)*8*1e3/(n.timestamp-e.timestamp)}const XI=1e3;class gS extends xe{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}constructor(e,t,i){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,r=arguments.length>4?arguments[4]:void 0;super(e,t,r),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=yg(()=>G(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>G(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(Ve.Ended,this)},this.reacquireTrack=!1,this.providedByUser=s,this.muteLock=new Hi,this.pauseUpstreamLock=new Hi,this.processorLock=new Hi,this.restartLock=new Hi,this.setMediaStreamTrack(e,!0),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==xe.Kind.Video)return;const{width:e,height:t}=this._mediaStreamTrack.getSettings();if(e&&t)return{width:e,height:t}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,t;return(t=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&t!==void 0?t:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,t){return G(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!t)return;this._mediaStreamTrack&&(this.attachedElements.forEach(r=>{So(this._mediaStreamTrack,r)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let s;if(this.processor&&e){const r=yield this.processorLock.lock();try{if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(po(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),s=this.processor.processedTrack}finally{r()}}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(s??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(r=>{po(s??e,r)}))})}waitForDimensions(){return G(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:XI;return function*(){var i;if(e.kind===xe.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=Ls())===null||i===void 0?void 0:i.os)==="iOS"&&(yield Ii(10));const s=Date.now();for(;Date.now()-s<t;){const r=e.dimensions;if(r)return r;yield Ii(50)}throw new rr("unable to get track dimensions after timeout")}()})}setDeviceId(e){return G(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===jr(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),jr(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return G(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===xe.Source.ScreenShare)return;const{deviceId:i,groupId:s}=e._mediaStreamTrack.getSettings(),r=e.kind===xe.Kind.Audio?"audioinput":"videoinput";return t?ei.getInstance().normalizeDeviceId(r,i,s):i}()})}mute(){return G(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return G(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,t){return G(this,void 0,void 0,function*(){if(!this.sender)throw new rr("unable to replace an unpublished track");let i,s;return typeof t=="boolean"?i=t:t!==void 0&&(i=t.userProvidedTrack,s=t.stopProcessor),this.providedByUser=i??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),s&&this.processor&&(yield this.stopProcessor()),this})}restart(e){return G(this,void 0,void 0,function*(){this.manuallyStopped=!1;const t=yield this.restartLock.lock();try{e||(e=this._constraints);const i=this._constraints,{deviceId:s}=i,r=G2(i,["deviceId"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const a={audio:!1,video:!1};this.kind===xe.Kind.Video?a.video=s?{deviceId:s}:!0:a.audio=s?{deviceId:s}:!0,this.attachedElements.forEach(c=>{So(this.mediaStreamTrack,c)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const l=(yield navigator.mediaDevices.getUserMedia(a)).getTracks()[0];return yield l.applyConstraints(r),l.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(l),this._constraints=e,this.emit(Ve.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{t()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Ve.Muted:Ve.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return G(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),aS()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return G(this,void 0,void 0,function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(Ve.UpstreamPaused,this);const i=Ls();if((i==null?void 0:i.name)==="Safari"&&Lo(i.version,"12.0")<0)throw new mg("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{t()}})}resumeUpstream(){return G(this,void 0,void 0,function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(Ve.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{t()}})}getRTCStatsReport(){return G(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return G(this,arguments,void 0,function(t){var i=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var r;const a=yield i.processorLock.lock();try{i.log.debug("setting up processor",i.logContext);const o=document.createElement(i.kind),l={kind:i.kind,track:i._mediaStreamTrack,element:o,audioContext:i.audioContext};if(yield t.init(l),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.stopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(po(i._mediaStreamTrack,o),o.muted=!0,o.play().catch(c=>i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:c}))),i.processor=t,i.processorElement=o,i.processor.processedTrack){for(const c of i.attachedElements)c!==i.processorElement&&s&&(So(i._mediaStreamTrack,c),po(i.processor.processedTrack,c));yield(r=i.sender)===null||r===void 0?void 0:r.replaceTrack(i.processor.processedTrack)}i.emit(Ve.TrackProcessorUpdate,i.processor)}finally{a()}}()})}getProcessor(){return this.processor}stopProcessor(){return G(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var i,s;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,t||((s=e.processorElement)===null||s===void 0||s.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(Ve.TrackProcessorUpdate))}()})}}class Yu extends gS{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,s=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;super(e,xe.Kind.Audio,t,i,r),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>G(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let a;try{a=yield this.getSenderStats()}catch(o){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:o}));return}a&&this.prevStats&&(this._currentBitrate=Sd(a,this.prevStats)),this.prevStats=a}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(Ve.AudioTrackFeatureUpdate,this,Ms.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(Ve.AudioTrackFeatureUpdate,this,Ms.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=s,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return G(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===xe.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return G(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==jr(this._constraints.deviceId);return this.source===xe.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}})}restartTrack(e){return G(this,void 0,void 0,function*(){let t;if(e){const i=Td({audio:e});typeof i.audio!="boolean"&&(t=i.audio)}yield this.restart(t)})}restart(e){const t=Object.create(null,{restart:{get:()=>super.restart}});return G(this,void 0,void 0,function*(){const i=yield t.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){xi()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Eg)))}setProcessor(e){return G(this,void 0,void 0,function*(){var t;const i=yield this.processorLock.lock();try{if(!Os()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.stopProcessor());const s={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(s),this.processor=e,this.processor.processedTrack&&(yield(t=this.sender)===null||t===void 0?void 0:t.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(Ve.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return G(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const t=yield this.sender.getStats();let i;return t.forEach(s=>{s.type==="outbound-rtp"&&(i={type:"audio",streamId:s.id,packetsSent:s.packetsSent,packetsLost:s.packetsLost,bytesSent:s.bytesSent,timestamp:s.timestamp,roundTripTime:s.roundTripTime,jitter:s.jitter})}),i})}checkForSilence(){return G(this,void 0,void 0,function*(){const e=yield dS(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(Ve.AudioSilenceDetected)),e})}}function _S(n,e,t){switch(n.kind){case"audio":return new Yu(n,e,!1,void 0,t);case"video":return new Ju(n,e,!1,t);default:throw new rr("unsupported track type: ".concat(n.kind))}}const YI=Object.values(Yc),JI=Object.values(Pp),QI=Object.values(gg),ZI=[Yc.h180,Yc.h360],$I=[Pp.h180,Pp.h360],eP=n=>[{scaleResolutionDownBy:2,fps:n.encoding.maxFramerate}].map(t=>{var i,s;return new gn(Math.floor(n.width/t.scaleResolutionDownBy),Math.floor(n.height/t.scaleResolutionDownBy),Math.max(15e4,Math.floor(n.encoding.maxBitrate/(Math.pow(t.scaleResolutionDownBy,2)*(((i=n.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((s=t.fps)!==null&&s!==void 0?s:30))))),t.fps,n.encoding.priority)}),Vp=["q","h","f"];function Gp(n,e,t,i){var s,r;let a=i==null?void 0:i.videoEncoding;n&&(a=i==null?void 0:i.screenShareEncoding);const o=i==null?void 0:i.simulcast,l=i==null?void 0:i.scalabilityMode,c=i==null?void 0:i.videoCodec;if(!a&&!o&&!l||!e||!t)return[{}];a||(a=nP(n,e,t,c),Ht.debug("using video encoding",a));const u=a.maxFramerate,d=new gn(e,t,a.maxBitrate,a.maxFramerate,a.priority);if(l&&Lc(c)){const g=new vS(l),v=[];if(g.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(l));const m=Ls();if(Qr()||Os()||(m==null?void 0:m.name)==="Chrome"&&Lo(m==null?void 0:m.version,"113")<0){const _=g.suffix=="h"?2:3;for(let y=0;y<g.spatial;y+=1)v.push({rid:Vp[2-y],maxBitrate:a.maxBitrate/Math.pow(_,y),maxFramerate:d.encoding.maxFramerate});v[0].scalabilityMode=l}else v.push({maxBitrate:a.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:l});return d.encoding.priority&&(v[0].priority=d.encoding.priority,v[0].networkPriority=d.encoding.priority),Ht.debug("using svc encoding",{encodings:v}),v}if(!o)return[a];let h=[];n?h=(s=iv(i==null?void 0:i.screenShareSimulcastLayers))!==null&&s!==void 0?s:nv(n,d):h=(r=iv(i==null?void 0:i.videoSimulcastLayers))!==null&&r!==void 0?r:nv(n,d);let f;if(h.length>0){const g=h[0];h.length>1&&([,f]=h);const v=Math.max(e,t);if(v>=960&&f)return tf(e,t,[g,f,d],u);if(v>=480)return tf(e,t,[g,d],u)}return tf(e,t,[d])}function tP(n,e,t){var i,s,r,a;if(!t.backupCodec||t.backupCodec===!0||t.backupCodec.codec===t.videoCodec)return;e!==t.backupCodec.codec&&Ht.warn("requested a different codec than specified as backup",{serverRequested:e,backup:t.backupCodec.codec}),t.videoCodec=e,t.videoEncoding=t.backupCodec.encoding;const o=n.mediaStreamTrack.getSettings(),l=(i=o.width)!==null&&i!==void 0?i:(s=n.dimensions)===null||s===void 0?void 0:s.width,c=(r=o.height)!==null&&r!==void 0?r:(a=n.dimensions)===null||a===void 0?void 0:a.height;return n.source===xe.Source.ScreenShare&&t.simulcast&&(t.simulcast=!1),Gp(n.source===xe.Source.ScreenShare,l,c,t)}function nP(n,e,t,i){const s=iP(n,e,t);let{encoding:r}=s[0];const a=Math.max(e,t);for(let o=0;o<s.length;o+=1){const l=s[o];if(r=l.encoding,l.width>=a)break}if(i)switch(i){case"av1":r=Object.assign({},r),r.maxBitrate=r.maxBitrate*.7;break;case"vp9":r=Object.assign({},r),r.maxBitrate=r.maxBitrate*.85;break}return r}function iP(n,e,t){if(n)return QI;const i=e>t?e/t:t/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?YI:JI}function nv(n,e){if(n)return eP(e);const{width:t,height:i}=e,s=t>i?t/i:i/t;return Math.abs(s-16/9)<Math.abs(s-4/3)?ZI:$I}function tf(n,e,t,i){const s=[];if(t.forEach((r,a)=>{if(a>=Vp.length)return;const o=Math.min(n,e),c={rid:Vp[a],scaleResolutionDownBy:Math.max(1,o/Math.min(r.width,r.height)),maxBitrate:r.encoding.maxBitrate},u=i&&r.encoding.maxFramerate?Math.min(i,r.encoding.maxFramerate):r.encoding.maxFramerate;u&&(c.maxFramerate=u);const d=Do()||a===0;r.encoding.priority&&d&&(c.priority=r.encoding.priority,c.networkPriority=r.encoding.priority),s.push(c)}),Os()&&cS()==="ios"){let r;s.forEach(o=>{r?o.maxFramerate&&o.maxFramerate>r&&(r=o.maxFramerate):r=o.maxFramerate});let a=!0;s.forEach(o=>{var l;o.maxFramerate!=r&&(a&&(a=!1,Ht.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Ht.info('Setting framerate of encoding "'.concat((l=o.rid)!==null&&l!==void 0?l:"",'" to ').concat(r)),o.maxFramerate=r)})}return s}function iv(n){if(n)return n.sort((e,t)=>{const{encoding:i}=e,{encoding:s}=t;return i.maxBitrate>s.maxBitrate?1:i.maxBitrate<s.maxBitrate?-1:i.maxBitrate===s.maxBitrate&&i.maxFramerate&&s.maxFramerate?i.maxFramerate>s.maxFramerate?1:-1:0})}class vS{constructor(e){const t=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!t)throw new Error("invalid scalability mode");if(this.spatial=parseInt(t[1]),this.temporal=parseInt(t[2]),t.length>3)switch(t[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=t[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function sP(n){return n.source===xe.Source.ScreenShare||n.constraints.height&&jr(n.constraints.height)>=1080?"maintain-resolution":"balanced"}const rP=5e3;class Ju extends gS{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,s=arguments.length>3?arguments[3]:void 0;super(e,xe.Kind.Video,t,i,s),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.monitorSender=()=>G(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let r;try{r=yield this.getSenderStats()}catch(o){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:o}));return}const a=new Map(r.map(o=>[o.rid,o]));if(this.prevStats){let o=0;a.forEach((l,c)=>{var u;const d=(u=this.prevStats)===null||u===void 0?void 0:u.get(c);o+=Sd(l,d)}),this._currentBitrate=o}this.prevStats=a}),this.senderLock=new Hi}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var t;if(this.signalClient=e,!xi())return;const i=(t=this.sender)===null||t===void 0?void 0:t.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},Eg))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return G(this,void 0,void 0,function*(){var t,i,s,r,a;yield e.pauseUpstream.call(this);try{for(var o=!0,l=Ur(this.simulcastCodecs.values()),c;c=yield l.next(),t=c.done,!t;o=!0)r=c.value,o=!1,yield(a=r.sender)===null||a===void 0?void 0:a.replaceTrack(null)}catch(u){i={error:u}}finally{try{!o&&!t&&(s=l.return)&&(yield s.call(l))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return G(this,void 0,void 0,function*(){var t,i,s,r,a;yield e.resumeUpstream.call(this);try{for(var o=!0,l=Ur(this.simulcastCodecs.values()),c;c=yield l.next(),t=c.done,!t;o=!0){r=c.value,o=!1;const u=r;yield(a=u.sender)===null||a===void 0?void 0:a.replaceTrack(u.mediaStreamTrack)}}catch(u){i={error:u}}finally{try{!o&&!t&&(s=l.return)&&(yield s.call(l))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return G(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===xe.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return G(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.source===xe.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{t()}})}setTrackMuted(e){super.setTrackMuted(e);for(const t of this.simulcastCodecs.values())t.mediaStreamTrack.enabled=!e}getSenderStats(){return G(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const t=[],i=yield this.sender.getStats();return i.forEach(s=>{var r;if(s.type==="outbound-rtp"){const a={type:"video",streamId:s.id,frameHeight:s.frameHeight,frameWidth:s.frameWidth,framesPerSecond:s.framesPerSecond,framesSent:s.framesSent,firCount:s.firCount,pliCount:s.pliCount,nackCount:s.nackCount,packetsSent:s.packetsSent,bytesSent:s.bytesSent,qualityLimitationReason:s.qualityLimitationReason,qualityLimitationDurations:s.qualityLimitationDurations,qualityLimitationResolutionChanges:s.qualityLimitationResolutionChanges,rid:(r=s.rid)!==null&&r!==void 0?r:s.id,retransmittedPacketsSent:s.retransmittedPacketsSent,targetBitrate:s.targetBitrate,timestamp:s.timestamp},o=i.get(s.remoteId);o&&(a.jitter=o.jitter,a.packetsLost=o.packetsLost,a.roundTripTime=o.roundTripTime),t.push(a)}}),t.sort((s,r)=>{var a,o;return((a=r.frameWidth)!==null&&a!==void 0?a:0)-((o=s.frameWidth)!==null&&o!==void 0?o:0)}),t})}setPublishingQuality(e){const t=[];for(let i=Zi.LOW;i<=Zi.HIGH;i+=1)t.push(new dg({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(t)}restartTrack(e){return G(this,void 0,void 0,function*(){var t,i,s,r,a;let o;if(e){const d=Td({video:e});typeof d.video!="boolean"&&(o=d.video)}yield this.restart(o);try{for(var l=!0,c=Ur(this.simulcastCodecs.values()),u;u=yield c.next(),t=u.done,!t;l=!0){r=u.value,l=!1;const d=r;d.sender&&((a=d.sender.transport)===null||a===void 0?void 0:a.state)!=="closed"&&(d.mediaStreamTrack=this.mediaStreamTrack.clone(),yield d.sender.replaceTrack(d.mediaStreamTrack))}}catch(d){i={error:d}}finally{try{!l&&!t&&(s=c.return)&&(yield s.call(c))}finally{if(i)throw i.error}}})}setProcessor(e){const t=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return G(this,arguments,void 0,function(i){var s=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var a,o,l,c,u,d;if(yield t.setProcessor.call(s,i,r),!((u=s.processor)===null||u===void 0)&&u.processedTrack)try{for(var h=!0,f=Ur(s.simulcastCodecs.values()),g;g=yield f.next(),a=g.done,!a;h=!0)c=g.value,h=!1,yield(d=c.sender)===null||d===void 0?void 0:d.replaceTrack(s.processor.processedTrack)}catch(v){o={error:v}}finally{try{!h&&!a&&(l=f.return)&&(yield l.call(f))}finally{if(o)throw o.error}}}()})}setDegradationPreference(e){return G(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const t=this.sender.getParameters();t.degradationPreference=e,this.sender.setParameters(t)}catch(t){this.log.warn("failed to set degradationPreference",Object.assign({error:t},this.logContext))}})}addSimulcastTrack(e,t){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,t){const i=this.simulcastCodecs.get(e);i&&(i.sender=t,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},rP))}setPublishingCodecs(e){return G(this,void 0,void 0,function*(){var t,i,s,r,a,o,l;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(e[0].qualities),[];this.subscribedCodecs=e;const c=[];try{for(t=!0,i=Ur(e);s=yield i.next(),r=s.done,!r;t=!0){l=s.value,t=!1;const u=l;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers(u.qualities);else{const d=this.simulcastCodecs.get(u.codec);if(this.log.debug("try setPublishingCodec for ".concat(u.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:d})),!d||!d.sender){for(const h of u.qualities)if(h.enabled){c.push(u.codec);break}}else d.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(u.codec),this.logContext),yield sv(d.sender,d.encodings,u.qualities,this.senderLock,this.log,this.logContext))}}}catch(u){a={error:u}}finally{try{!t&&!r&&(o=i.return)&&(yield o.call(i))}finally{if(a)throw a.error}}return c})}setPublishingLayers(e){return G(this,void 0,void 0,function*(){this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:e})),!(!this.sender||!this.encodings)&&(yield sv(this.sender,this.encodings,e,this.senderLock,this.log,this.logContext))})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return G(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),aS()&&this.isInBackground&&this.source===xe.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function sv(n,e,t,i,s,r){return G(this,void 0,void 0,function*(){const a=yield i.lock();s.debug("setPublishingLayersForSender",Object.assign(Object.assign({},r),{sender:n,qualities:t,senderEncodings:e}));try{const o=n.getParameters(),{encodings:l}=o;if(!l)return;if(l.length!==e.length){s.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},r),{encodings:l,senderEncodings:e}));return}let c=!1;!1&&l[0].scalabilityMode||l.forEach((d,h)=>{var f;let g=(f=d.rid)!==null&&f!==void 0?f:"";g===""&&(g="q");const v=bS(g),m=t.find(_=>_.quality===v);m&&d.active!==m.enabled&&(c=!0,d.active=m.enabled,s.debug("setting layer ".concat(m.quality," to ").concat(d.active?"enabled":"disabled"),r),Do()&&(m.enabled?(d.scaleResolutionDownBy=e[h].scaleResolutionDownBy,d.maxBitrate=e[h].maxBitrate,d.maxFrameRate=e[h].maxFrameRate):(d.scaleResolutionDownBy=4,d.maxBitrate=10,d.maxFrameRate=2)))}),c&&(o.encodings=l,s.debug("setting encodings",Object.assign(Object.assign({},r),{encodings:o.encodings})),yield n.setParameters(o))}finally{a()}})}function bS(n){switch(n){case"f":return Zi.HIGH;case"h":return Zi.MEDIUM;case"q":return Zi.LOW;default:return Zi.HIGH}}function rv(n,e,t,i){if(!t)return[new Aa({quality:Zi.HIGH,width:n,height:e,bitrate:0,ssrc:0})];if(i){const s=t[0].scalabilityMode,r=new vS(s),a=[],o=r.suffix=="h"?1.5:2,l=r.suffix=="h"?2:3;for(let c=0;c<r.spatial;c+=1)a.push(new Aa({quality:Math.min(Zi.HIGH,r.spatial-1)-c,width:Math.ceil(n/Math.pow(o,c)),height:Math.ceil(e/Math.pow(o,c)),bitrate:t[0].maxBitrate?Math.ceil(t[0].maxBitrate/Math.pow(l,c)):0,ssrc:0}));return a}return t.map(s=>{var r,a,o;const l=(r=s.scaleResolutionDownBy)!==null&&r!==void 0?r:1;let c=bS((a=s.rid)!==null&&a!==void 0?a:"");return new Aa({quality:c,width:Math.ceil(n/l),height:Math.ceil(e/l),bitrate:(o=s.maxBitrate)!==null&&o!==void 0?o:0,ssrc:0})})}const av="_lossy",ov="_reliable",aP=2*1e3,nf="leave-reconnect";var os;(function(n){n[n.New=0]="New",n[n.Connected=1]="Connected",n[n.Disconnected=2]="Disconnected",n[n.Reconnecting=3]="Reconnecting",n[n.Closed=4]="Closed"})(os||(os={}));class oP extends Fs.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var t;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=Tg.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.subscriberPrimary=!1,this.pcState=os.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Ht,this.handleDataChannel=i=>G(this,[i],void 0,function(s){var r=this;let{channel:a}=s;return function*(){if(a){if(a.label===ov)r.reliableDCSub=a;else if(a.label===av)r.lossyDCSub=a;else return;r.log.debug("on data channel ".concat(a.id,", ").concat(a.label),r.logContext),a.onmessage=r.handleDataMessage}}()}),this.handleDataMessage=i=>G(this,void 0,void 0,function*(){var s,r;const a=yield this.dataProcessLock.lock();try{let o;if(i.data instanceof ArrayBuffer)o=i.data;else if(i.data instanceof Blob)o=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const l=ki.fromBinary(new Uint8Array(o));((s=l.value)===null||s===void 0?void 0:s.case)==="speaker"?this.emit(We.ActiveSpeakersUpdate,l.value.value.speakers):(((r=l.value)===null||r===void 0?void 0:r.case)==="user"&&lP(l,l.value.value),this.emit(We.DataPacketReceived,l))}finally{a()}}),this.handleDataError=i=>{const r=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:a}=i.error;this.log.error("DataChannel error on ".concat(r,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:a}))}else this.log.error("Unknown DataChannel error on ".concat(r),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const r=i.currentTarget.maxRetransmits===0?Jt.LOSSY:Jt.RELIABLE;this.updateAndEmitDCBufferStatus(r)},this.handleDisconnect=(i,s)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const r=l=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(l,"ms. giving up"),this.logContext),this.emit(We.Disconnected),this.close()},a=Date.now()-this.reconnectStart;let o=this.getNextRetryDelay({elapsedMs:a,retryCount:this.reconnectAttempts});if(o===null){r(a);return}i===nf&&(o=0),this.log.debug("reconnecting in ".concat(o,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=ui.setTimeout(()=>this.attemptReconnect(s).finally(()=>this.reconnectTimeout=void 0),o)},this.waitForRestarted=()=>new Promise((i,s)=>{this.pcState===os.Connected&&i();const r=()=>{this.off(We.Disconnected,a),i()},a=()=>{this.off(We.Restarted,r),s()};this.once(We.Restarted,r),this.once(We.Disconnected,a)}),this.updateAndEmitDCBufferStatus=i=>{const s=this.isBufferStatusLow(i);typeof s<"u"&&s!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,s),this.emit(We.DCBufferStatusChanged,s,i))},this.isBufferStatusLow=i=>{const s=this.dataChannelForKind(i);if(s)return s.bufferedAmount<=s.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===Mn.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(Ha.RR_SIGNAL_DISCONNECTED))},this.log=hr((t=e.loggerName)!==null&&t!==void 0?t:ys.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new vg(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new Hi,this.dataProcessLock=new Hi,this.dcBufferStatus=new Map([[Jt.LOSSY,!0],[Jt.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(We.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(We.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(We.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(We.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(We.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(We.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(We.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(We.SignalRequestResponse,i)}get logContext(){var e,t,i,s,r,a,o,l;return{room:(t=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||t===void 0?void 0:t.name,roomID:(s=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||s===void 0?void 0:s.sid,participant:(a=(r=this.latestJoinResponse)===null||r===void 0?void 0:r.participant)===null||a===void 0?void 0:a.identity,pID:(l=(o=this.latestJoinResponse)===null||o===void 0?void 0:o.participant)===null||l===void 0?void 0:l.sid}}join(e,t,i,s){return G(this,void 0,void 0,function*(){this.url=e,this.token=t,this.signalOpts=i,this.maxJoinAttempts=i.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const r=yield this.client.join(e,t,i,s);return this._isClosed=!1,this.latestJoinResponse=r,this.subscriberPrimary=r.subscriberPrimary,this.pcManager||(yield this.configure(r)),(!this.subscriberPrimary||r.fastPublish)&&this.negotiate(),this.clientConfiguration=r.clientConfiguration,r}catch(r){if(r instanceof Sn&&r.reason===qt.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,t,i,s);throw r}})}close(){return G(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(We.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return G(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const t=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};t(this.lossyDC),t(this.lossyDCSub),t(this.reliableDC),t(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0})}cleanupClient(){return G(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new rr("a track with the same ID has already been published");return new Promise((t,i)=>{const s=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(new Sn("publication of local track timed out, no response from server",qt.InternalError))},1e4);this.pendingTrackResolvers[e.cid]={resolve:r=>{clearTimeout(s),t(r)},reject:()=>{clearTimeout(s),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:t}=this.pendingTrackResolvers[e.track.id];t&&t(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(t){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:t}))}return!1}updateMuteStatus(e,t){this.client.sendMuteTrack(e,t)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return G(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return G(this,void 0,void 0,function*(){var t,i;if(this.pcManager&&this.pcManager.currentState!==On.NEW)return;this.participantSid=(t=e.participant)===null||t===void 0?void 0:t.sid;const s=this.makeRTCConfiguration(e);this.pcManager=new qI(s,e.subscriberPrimary,this.loggerOptions),this.emit(We.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(r,a)=>{this.client.sendIceCandidate(r,a)},this.pcManager.onPublisherOffer=r=>{this.client.sendOffer(r)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(r,a,o)=>G(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(r),this.logContext),["closed","disconnected","failed"].includes(a)&&(this.publisherConnectionPromise=void 0),r===On.CONNECTED){const u=this.pcState===os.New;this.pcState=os.Connected,u&&this.emit(We.Connected,e)}else r===On.FAILED&&this.pcState===os.Connected&&(this.pcState=os.Disconnected,this.handleDisconnect("peerconnection failed",o==="failed"?Ha.RR_SUBSCRIBER_FAILED:Ha.RR_PUBLISHER_FAILED));const l=this.client.isDisconnected||this.client.currentState===Mn.RECONNECTING,c=[On.FAILED,On.CLOSING,On.CLOSED].includes(r);l&&c&&!this._isClosed&&this.emit(We.Offline)}),this.pcManager.onTrack=r=>{this.emit(We.MediaTrackAdded,r.track,r.streams[0],r.receiver)},cP((i=e.serverInfo)===null||i===void 0?void 0:i.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=e=>G(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e))}),this.client.onTrickle=(e,t)=>{this.pcManager&&(this.log.trace("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:t})),this.pcManager.addIceCandidate(e,t))},this.client.onOffer=e=>G(this,void 0,void 0,function*(){if(!this.pcManager)return;const t=yield this.pcManager.createSubscriberAnswerFromOffer(e);this.client.sendAnswer(t)}),this.client.onLocalTrackPublished=e=>{var t;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(t=e.track)===null||t===void 0?void 0:t.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(We.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(We.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,t)=>{this.emit(We.RemoteMute,e,t)},this.client.onSubscribedQualityUpdate=e=>{this.emit(We.SubscribedQualityUpdate,e)},this.client.onClose=()=>{this.handleDisconnect("signal",Ha.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case yo.DISCONNECT:this.emit(We.Disconnected,e==null?void 0:e.reason),this.close();break;case yo.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(nf);break;case yo.RESUME:this.handleDisconnect(nf)}}}makeRTCConfiguration(e){var t;const i=Object.assign({},this.rtcConfig);if(!((t=this.signalOpts)===null||t===void 0)&&t.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const s=[];e.iceServers.forEach(r=>{const a={urls:r.urls};r.username&&(a.username=r.username),r.credential&&(a.credential=r.credential),s.push(a)}),i.iceServers=s}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Kc.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(av,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(ov,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,t,i){return G(this,void 0,void 0,function*(){if(Np())return yield this.createTransceiverRTCRtpSender(e,t,i);if(Dp())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Xn("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,t,i,s){return G(this,void 0,void 0,function*(){if(Np())return this.createSimulcastTransceiverSender(e,t,i,s);if(Dp())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Xn("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,t,i){return G(this,void 0,void 0,function*(){if(!this.pcManager)throw new Xn("publisher is closed");const s=[];e.mediaStream&&s.push(e.mediaStream),Jo(e)&&(e.codec=t.videoCodec);const r={direction:"sendonly",streams:s};return i&&(r.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,r)).sender})}createSimulcastTransceiverSender(e,t,i,s){return G(this,void 0,void 0,function*(){if(!this.pcManager)throw new Xn("publisher is closed");const r={direction:"sendonly"};s&&(r.sendEncodings=s);const a=yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,r);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,a.sender),a.sender})}createRTCRtpSender(e){return G(this,void 0,void 0,function*(){if(!this.pcManager)throw new Xn("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return G(this,void 0,void 0,function*(){var t,i,s;if(!this._isClosed){if(this.attemptingReconnect){Ht.warn("already attempting reconnect, returning early",this.logContext);return}(((t=this.clientConfiguration)===null||t===void 0?void 0:t.resumeConnection)===Kc.DISABLED||((s=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&s!==void 0?s:On.NEW)===On.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(r){this.reconnectAttempts+=1;let a=!0;r instanceof Xn?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:r})),a=!1):r instanceof Wa||(this.fullReconnectOnNext=!0),a?this.handleDisconnect("reconnect",Ha.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(We.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(t){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:t}))}return null}restartConnection(e){return G(this,void 0,void 0,function*(){var t,i,s;try{if(!this.url||!this.token)throw new Xn("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(We.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let r;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Wa;r=yield this.join(e??this.url,this.token,this.signalOpts)}catch(a){throw a instanceof Sn&&a.reason===qt.NotAllowed?new Xn("could not reconnect, token might be expired"):new Wa}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(We.SignalRestarted,r),yield this.waitForPCReconnected(),this.client.currentState!==Mn.CONNECTED)throw new Wa("Signal connection got severed during reconnect");(t=this.regionUrlProvider)===null||t===void 0||t.resetAttempts(),this.emit(We.Restarted)}catch(r){const a=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(a){yield this.restartConnection(a);return}else throw(s=this.regionUrlProvider)===null||s===void 0||s.resetAttempts(),r}})}resumeConnection(e){return G(this,void 0,void 0,function*(){var t;if(!this.url||!this.token)throw new Xn("could not reconnect, url or token not saved");if(!this.pcManager)throw new Xn("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(We.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(s){let r="";throw s instanceof Error&&(r=s.message,this.log.error(s.message,Object.assign(Object.assign({},this.logContext),{error:s}))),s instanceof Sn&&s.reason===qt.NotAllowed?new Xn("could not reconnect, token might be expired"):s instanceof Sn&&s.reason===qt.LeaveRequest?s:new Wa(r)}if(this.emit(We.SignalResumed),i){const s=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(s)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==Mn.CONNECTED)throw new Wa("Signal connection got severed during reconnect");this.client.setReconnected(),((t=this.reliableDC)===null||t===void 0?void 0:t.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),this.emit(We.Resumed)})}waitForPCInitialConnection(e,t){return G(this,void 0,void 0,function*(){if(!this.pcManager)throw new Xn("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(t,e)})}waitForPCReconnected(){return G(this,void 0,void 0,function*(){this.pcState=os.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Ii(aP),!this.pcManager)throw new Xn("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=os.Connected}catch(e){throw this.pcState=os.Disconnected,new Sn("could not establish PC connection, ".concat(e.message),qt.InternalError)}})}publishRpcResponse(e,t,i,s){return G(this,void 0,void 0,function*(){const r=new ki({destinationIdentities:[e],kind:Jt.RELIABLE,value:{case:"rpcResponse",value:new lT({requestId:t,value:s?{case:"error",value:s.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(r,Jt.RELIABLE)})}publishRpcAck(e,t){return G(this,void 0,void 0,function*(){const i=new ki({destinationIdentities:[e],kind:Jt.RELIABLE,value:{case:"rpcAck",value:new cT({requestId:t})}});yield this.sendDataPacket(i,Jt.RELIABLE)})}sendDataPacket(e,t){return G(this,void 0,void 0,function*(){const i=e.toBinary();yield this.ensurePublisherConnected(t);const s=this.dataChannelForKind(t);s&&s.send(i),this.updateAndEmitDCBufferStatus(t)})}waitForBufferStatusLow(e){return new Promise((t,i)=>G(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))t();else{const s=()=>i("Engine closed");for(this.once(We.Closing,s);!this.dcBufferStatus.get(e);)yield Ii(10);this.off(We.Closing,s),t()}}))}ensureDataTransportConnected(e){return G(this,arguments,void 0,function(t){var i=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var r;if(!i.pcManager)throw new Xn("PC manager is closed");const a=s?i.pcManager.subscriber:i.pcManager.publisher,o=s?"Subscriber":"Publisher";if(!a)throw new Sn("".concat(o," connection not set"),qt.InternalError);let l=!1;!s&&!i.dataChannelForKind(t,s)&&(i.createDataChannels(),l=!0),!l&&!s&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(l=!0),l&&i.negotiate();const c=i.dataChannelForKind(t,s);if((c==null?void 0:c.readyState)==="open")return;const u=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<u;){if(a.isICEConnected&&((r=i.dataChannelForKind(t,s))===null||r===void 0?void 0:r.readyState)==="open")return;yield Ii(50)}throw new Sn("could not establish ".concat(o," connection, state: ").concat(a.getICEConnectionState()),qt.InternalError)}()})}ensurePublisherConnected(e){return G(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==On.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return G(this,void 0,void 0,function*(){return new Promise((e,t)=>G(this,void 0,void 0,function*(){if(!this.pcManager){t(new xp("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,s=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&t("cannot negotiate on closed engine"),this.on(We.Closing,s),this.pcManager.publisher.once(Ao.RTPVideoPayloadTypes,r=>{const a=new Map;r.forEach(o=>{const l=o.codec.toLowerCase();EI(l)&&a.set(o.payload,l)}),this.emit(We.RTPVideoMapUpdate,a)});try{yield this.pcManager.negotiate(i),e()}catch(r){r instanceof xp&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Ha.RR_UNKNOWN),t(r)}finally{this.off(We.Closing,s)}}))})}dataChannelForKind(e,t){if(t){if(e===Jt.LOSSY)return this.lossyDCSub;if(e===Jt.RELIABLE)return this.reliableDCSub}else{if(e===Jt.LOSSY)return this.lossyDC;if(e===Jt.RELIABLE)return this.reliableDC}}sendSyncState(e,t){var i,s;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const r=this.pcManager.subscriber.getLocalDescription(),a=this.pcManager.subscriber.getRemoteDescription(),o=(s=(i=this.signalOpts)===null||i===void 0?void 0:i.autoSubscribe)!==null&&s!==void 0?s:!0,l=new Array,c=new Array;e.forEach(u=>{u.isDesired!==o&&l.push(u.trackSid),u.isEnabled||c.push(u.trackSid)}),this.client.sendSyncState(new CT({answer:r?Xu({sdp:r.sdp,type:r.type}):void 0,offer:a?Xu({sdp:a.sdp,type:a.type}):void 0,subscription:new vd({trackSids:l,subscribe:!o,participantTracks:[]}),publishTracks:II(t),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:c}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],t=(i,s)=>{(i==null?void 0:i.id)!==void 0&&i.id!==null&&e.push(new wT({label:i.label,id:i.id,target:s}))};return t(this.dataChannelForKind(Jt.LOSSY),ms.PUBLISHER),t(this.dataChannelForKind(Jt.RELIABLE),ms.PUBLISHER),t(this.dataChannelForKind(Jt.LOSSY,!0),ms.SUBSCRIBER),t(this.dataChannelForKind(Jt.RELIABLE,!0),ms.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&ui.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){xi()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){xi()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class Wa extends Error{}function cP(n){return n!==void 0&&n>13}function lP(n,e){const t=n.participantIdentity?n.participantIdentity:e.participantIdentity;n.participantIdentity=t,e.participantIdentity=t;const i=n.destinationIdentities.length!==0?n.destinationIdentities:e.destinationIdentities;n.destinationIdentities=i,e.destinationIdentities=i}class zp{constructor(e,t){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=t}updateToken(e){this.token=e}isCloud(){return Op(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return G(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const t=this.regionSettings.regions.filter(i=>!this.attemptedRegions.find(s=>s.url===i.url));if(t.length>0){const i=t[0];return this.attemptedRegions.push(i),Ht.debug("next region: ".concat(i.region)),i.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return G(this,void 0,void 0,function*(){const t=yield fetch("".concat(uP(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});if(t.ok){const i=yield t.json();return this.lastUpdateAt=Date.now(),i}else throw new Sn("Could not fetch region settings: ".concat(t.statusText),t.status===401?qt.NotAllowed:qt.InternalError,t.status)})}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}function uP(n){return"".concat(n.protocol.replace("ws","http"),"//").concat(n.host,"/settings")}class yS{get info(){return this._info}constructor(e,t,i){this.reader=t,this.totalByteSize=i,this._info=e,this.bytesReceived=0}}class dP extends yS{handleChunkReceived(e){var t;this.bytesReceived+=e.content.byteLength;const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(t=this.onProgress)===null||t===void 0||t.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();return{next:()=>G(this,void 0,void 0,function*(){try{const{done:t,value:i}=yield e.read();return t?{done:!0,value:void 0}:(this.handleChunkReceived(i),{done:!1,value:i.content})}catch{return{done:!0,value:void 0}}}),return(){return G(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return G(this,void 0,void 0,function*(){var e,t,i,s;let r=new Set;try{for(var a=!0,o=Ur(this),l;l=yield o.next(),e=l.done,!e;a=!0){s=l.value,a=!1;const c=s;r.add(c)}}catch(c){t={error:c}}finally{try{!a&&!e&&(i=o.return)&&(yield i.call(o))}finally{if(t)throw t.error}}return Array.from(r)})}}class hP extends yS{constructor(e,t,i){super(e,t,i),this.receivedChunks=new Map}handleChunkReceived(e){var t;const i=Tu(e.chunkIndex),s=this.receivedChunks.get(i);if(s&&s.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength;const r=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(t=this.onProgress)===null||t===void 0||t.call(this,r)}[Symbol.asyncIterator](){const e=this.reader.getReader(),t=new TextDecoder;return{next:()=>G(this,void 0,void 0,function*(){try{const{done:i,value:s}=yield e.read();return i?{done:!0,value:void 0}:(this.handleChunkReceived(s),{done:!1,value:t.decode(s.content)})}catch{return{done:!0,value:void 0}}}),return(){return G(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return G(this,void 0,void 0,function*(){var e,t,i,s;let r="";try{for(var a=!0,o=Ur(this),l;l=yield o.next(),e=l.done,!e;a=!0)s=l.value,a=!1,r+=s}catch(c){t={error:c}}finally{try{!a&&!e&&(i=o.return)&&(yield i.call(o))}finally{if(t)throw t.error}}return r})}}class fP{constructor(e,t,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=t}write(e){return this.defaultWriter.write(e)}close(){return G(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class pP extends fP{}class TS extends xe{constructor(e,t,i,s,r){super(e,i,r),this.sid=t,this.receiver=s}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Ve.Muted:Ve.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const t=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",t),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(Ve.Ended,this))};e.addEventListener("removetrack",t)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return G(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Eg)),PI()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var t;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(t=this.receiver)===null||t===void 0?void 0:t.getSynchronizationSources()[0];if(i){const{timestamp:s,rtpTimestamp:r}=i;r&&this.rtpTimestamp!==r&&(this.emit(Ve.TimeSyncUpdate,{timestamp:s,rtpTimestamp:r}),this.rtpTimestamp=r)}};e()}}class mP extends TS{constructor(e,t,i,s,r,a){super(e,t,xe.Kind.Audio,i,a),this.monitorReceiver=()=>G(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=Sd(o,this.prevStats)),this.prevStats=o}),this.audioContext=s,this.webAudioPluginNodes=[],r&&(this.sinkId=r.deviceId)}setVolume(e){var t;for(const i of this.attachedElements)this.audioContext?(t=this.gainNode)===null||t===void 0||t.gain.setTargetAtTime(e,0,.1):i.volume=e;Os()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(Os())return 1;let e=0;return this.attachedElements.forEach(t=>{t.volume>e&&(e=t.volume)}),e}setSinkId(e){return G(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(t=>{if(Lp(t))return t.setSinkId(e)}))})}attach(e){const t=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&Lp(e)&&e.setSinkId(this.sinkId),this.audioContext&&t&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let t;return e?(t=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=super.detach(),this.disconnectWebAudio()),t}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,t){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(t.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(s=>{i.connect(s),i=s}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(Ve.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(s=>{this.emit(Ve.AudioPlaybackFailed,s)})}disconnectWebAudio(){var e,t;(e=this.gainNode)===null||e===void 0||e.disconnect(),(t=this.sourceNode)===null||t===void 0||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return G(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t;return e.forEach(i=>{i.type==="inbound-rtp"&&(t={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),t})}}const sf=100;class gP extends TS{constructor(e,t,i,s,r){super(e,t,xe.Kind.Video,i,r),this.elementInfos=[],this.monitorReceiver=()=>G(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=Sd(a,this.prevStats)),this.prevStats=a}),this.debouncedHandleResize=yg(()=>{this.updateDimensions()},sf),this.adaptiveStreamSettings=s}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(t=>{e?So(this._mediaStreamTrack,t):po(this._mediaStreamTrack,t)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(t=>t.element===e)===void 0){const t=new _P(e);this.observeElementInfo(t)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(t=>t===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const t=this.elementInfos.filter(i=>i===e);for(const i of t)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let t=[];if(e)return this.stopObservingElement(e),super.detach(e);t=super.detach();for(const i of t)this.stopObservingElement(i);return t}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return G(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t,i="",s=new Map;return e.forEach(r=>{r.type==="inbound-rtp"?(i=r.codecId,t={type:"video",streamId:r.id,framesDecoded:r.framesDecoded,framesDropped:r.framesDropped,framesReceived:r.framesReceived,packetsReceived:r.packetsReceived,packetsLost:r.packetsLost,frameWidth:r.frameWidth,frameHeight:r.frameHeight,pliCount:r.pliCount,firCount:r.firCount,nackCount:r.nackCount,jitter:r.jitter,timestamp:r.timestamp,bytesReceived:r.bytesReceived,decoderImplementation:r.decoderImplementation}):r.type==="codec"&&s.set(r.id,r)}),t&&i!==""&&s.get(i)&&(t.mimeType=s.get(i).mimeType),t})}stopObservingElement(e){const t=this.elementInfos.filter(i=>i.element===e);for(const i of t)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return G(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var e,t;const i=this.elementInfos.reduce((o,l)=>Math.max(o,l.visibilityChangedAt||0),0),s=!((t=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pauseVideoInBackground)!==null&&t!==void 0)||t?this.isInBackground:!1,r=this.elementInfos.some(o=>o.pictureInPicture),a=this.elementInfos.some(o=>o.visible)&&!s||r;if(this.lastVisible!==a){if(!a&&Date.now()-i<sf){ui.setTimeout(()=>{this.updateVisibility()},sf);return}this.lastVisible=a,this.emit(Ve.VisibilityChanged,a,this)}}updateDimensions(){var e,t;let i=0,s=0;const r=this.getPixelDensity();for(const a of this.elementInfos){const o=a.width()*r,l=a.height()*r;o+l>i+s&&(i=o,s=l)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((t=this.lastDimensions)===null||t===void 0?void 0:t.height)===s||(this.lastDimensions={width:i,height:s},this.emit(Ve.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const t=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return t==="screen"?V_():t||(V_()>2?2:1)}}class _P{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,t){this.onVisibilityChanged=i=>{var s;const{target:r,isIntersecting:a}=i;r===this.element&&(this.isIntersecting=a,this.isPiP=cc(this.element),this.visibilityChangedAt=Date.now(),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this))},this.onEnterPiP=()=>{var i,s,r;(s=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||s===void 0||s.addEventListener("pagehide",this.onLeavePiP),this.isPiP=cc(this.element),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=cc(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=t??Hp(e),this.isPiP=xi()&&cc(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,t,i;this.isIntersecting=Hp(this.element),this.isPiP=cc(this.element),this.element.handleResize=()=>{var s;(s=this.handleResize)===null||s===void 0||s.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,z_().observe(this.element),G_().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(t=window.documentPictureInPicture)===null||t===void 0?void 0:t.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,t,i,s,r;(e=z_())===null||e===void 0||e.unobserve(this.element),(t=G_())===null||t===void 0||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(r=(s=window.documentPictureInPicture)===null||s===void 0?void 0:s.window)===null||r===void 0||r.removeEventListener("pagehide",this.onLeavePiP)}}function cc(n){var e,t;return document.pictureInPictureElement===n?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?Hp(n,(t=window.documentPictureInPicture)===null||t===void 0?void 0:t.window):!1}function Hp(n,e){const t=e||window;let i=n.offsetTop,s=n.offsetLeft;const r=n.offsetWidth,a=n.offsetHeight,{hidden:o}=n,{display:l}=getComputedStyle(n);for(;n.offsetParent;)n=n.offsetParent,i+=n.offsetTop,s+=n.offsetLeft;return i<t.pageYOffset+t.innerHeight&&s<t.pageXOffset+t.innerWidth&&i+a>t.pageYOffset&&s+r>t.pageXOffset&&!o&&l!=="none"}class Or extends Fs.EventEmitter{constructor(e,t,i,s){var r;super(),this.metadataMuted=!1,this.encryption=Bi.NONE,this.log=Ht,this.handleMuted=()=>{this.emit(Ve.Muted)},this.handleUnmuted=()=>{this.emit(Ve.Unmuted)},this.log=hr((r=s==null?void 0:s.loggerName)!==null&&r!==void 0?r:ys.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=t,this.trackName=i,this.source=xe.Source.Unknown}setTrack(e){this.track&&(this.track.off(Ve.Muted,this.handleMuted),this.track.off(Ve.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(Ve.Muted,this.handleMuted),e.on(Ve.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),yn(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==Bi.NONE}get audioTrack(){if(fr(this.track))return this.track}get videoTrack(){if(Jo(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=xe.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===xe.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(n){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(n.SubscriptionStatus||(n.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(n.PermissionStatus||(n.PermissionStatus={}))})(Or);class Wp extends Or{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,t,i,s){super(e,t.sid,t.name,s),this.track=void 0,this.handleTrackEnded=()=>{this.emit(Ve.Ended)},this.updateInfo(t),this.setTrack(i)}setTrack(e){this.track&&this.track.off(Ve.Ended,this.handleTrackEnded),super.setTrack(e),e&&e.on(Ve.Ended,this.handleTrackEnded)}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return G(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return G(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return G(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return G(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(fr(this.track)){const t=this.track.getSourceTrackSettings(),i=new Set;return t.autoGainControl&&i.add(Ms.TF_AUTO_GAIN_CONTROL),t.echoCancellation&&i.add(Ms.TF_ECHO_CANCELLATION),t.noiseSuppression&&i.add(Ms.TF_NOISE_SUPPRESSION),t.channelCount&&t.channelCount>1&&i.add(Ms.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(Ms.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(Ms.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}var Fr;(function(n){n.Excellent="excellent",n.Good="good",n.Poor="poor",n.Lost="lost",n.Unknown="unknown"})(Fr||(Fr={}));function vP(n){switch(n){case Rc.EXCELLENT:return Fr.Excellent;case Rc.GOOD:return Fr.Good;case Rc.POOR:return Fr.Poor;case Rc.LOST:return Fr.Lost;default:return Fr.Unknown}}class SS extends Fs.EventEmitter{get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||t===void 0?void 0:t.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===qu.AGENT}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,t,i,s,r,a){let o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:qu.STANDARD;var l;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Fr.Unknown,this.log=Ht,this.log=hr((l=a==null?void 0:a.loggerName)!==null&&l!==void 0?l:ys.Participant),this.loggerOptions=a,this.setMaxListeners(100),this.sid=e,this.identity=t,this.name=i,this.metadata=s,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=o,this._attributes=r??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,t]of this.trackPublications)if(t.source===e)return t}getTrackPublicationByName(e){for(const[,t]of this.trackPublications)if(t.trackName===e)return t}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const t=this.getTrackPublication(xe.Source.Camera);return!(!((e=t==null?void 0:t.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const t=this.getTrackPublication(xe.Source.Microphone);return!(!((e=t==null?void 0:t.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(xe.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,this.log.trace("update participant info",Object.assign(Object.assign({},this.logContext),{info:e})),!0)}_setMetadata(e){const t=this.metadata!==e,i=this.metadata;this.metadata=e,t&&this.emit(qe.ParticipantMetadataChanged,i)}_setName(e){const t=this.name!==e;this.name=e,t&&this.emit(qe.ParticipantNameChanged,e)}_setAttributes(e){const t=NI(this.attributes,e);this._attributes=e,Object.keys(t).length>0&&this.emit(qe.AttributesChanged,t)}setPermissions(e){var t,i,s,r,a,o;const l=this.permissions,c=e.canPublish!==((t=this.permissions)===null||t===void 0?void 0:t.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((s=this.permissions)===null||s===void 0?void 0:s.canPublishData)||e.hidden!==((r=this.permissions)===null||r===void 0?void 0:r.hidden)||e.recorder!==((a=this.permissions)===null||a===void 0?void 0:a.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((u,d)=>{var h;return u!==((h=this.permissions)===null||h===void 0?void 0:h.canPublishSources[d])})||e.canSubscribeMetrics!==((o=this.permissions)===null||o===void 0?void 0:o.canSubscribeMetrics);return this.permissions=e,c&&this.emit(qe.ParticipantPermissionsChanged,l),c}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(qe.IsSpeakingChanged,e))}setConnectionQuality(e){const t=this._connectionQuality;this._connectionQuality=vP(e),t!==this._connectionQuality&&this.emit(qe.ConnectionQualityChanged,this._connectionQuality)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(t=>fr(t.track)&&t.track.setAudioContext(e))}addTrackPublication(e){e.on(Ve.Muted,()=>{this.emit(qe.TrackMuted,e)}),e.on(Ve.Unmuted,()=>{this.emit(qe.TrackUnmuted,e)});const t=e;switch(t.track&&(t.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case xe.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case xe.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function bP(n){var e,t,i;if(!n.participantSid&&!n.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new ET({participantIdentity:(e=n.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(t=n.participantSid)!==null&&t!==void 0?t:"",allTracks:(i=n.allowAll)!==null&&i!==void 0?i:!1,trackSids:n.allowedTrackSids||[]})}const Sl=15e3;class yP extends SS{constructor(e,t,i,s,r){super(e,t,void 0,void 0,void 0,{loggerName:s.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Bi.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new lS)},this.handleReconnected=()=>{var a,o;(o=(a=this.reconnectFuture)===null||a===void 0?void 0:a.resolve)===null||o===void 0||o.call(a),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var a,o;this.reconnectFuture&&(this.reconnectFuture.promise.catch(l=>this.log.warn(l.message,this.logContext)),(o=(a=this.reconnectFuture)===null||a===void 0?void 0:a.reject)===null||o===void 0||o.call(a,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0)},this.handleSignalRequestResponse=a=>{const{requestId:o,reason:l,message:c}=a,u=this.pendingSignalRequests.get(o);u&&(l!==hg.OK&&u.reject(new O_(c,l)),this.pendingSignalRequests.delete(o))},this.handleDataPacket=a=>{switch(a.value.case){case"rpcResponse":let o=a.value.value,l=null,c=null;o.value.case==="payload"?l=o.value.value:o.value.case==="error"&&(c=Fn.fromProto(o.value.value)),this.handleIncomingRpcResponse(o.requestId,l,c);break;case"rpcAck":let u=a.value.value;this.handleIncomingRpcAck(u.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(a=>bP(a)))},this.onTrackUnmuted=a=>{this.onTrackMuted(a,a.isUpstreamPaused)},this.onTrackMuted=(a,o)=>{if(o===void 0&&(o=!0),!a.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),yn(a)));return}this.engine.updateMuteStatus(a.sid,o)},this.onTrackUpstreamPaused=a=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),yn(a))),this.onTrackMuted(a,!0)},this.onTrackUpstreamResumed=a=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),yn(a))),this.onTrackMuted(a,a.isMuted)},this.onTrackFeatureUpdate=a=>{const o=this.audioTrackPublications.get(a.sid);if(!o){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(a.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(o.trackSid,o.getTrackFeatures())},this.handleSubscribedQualityUpdate=a=>G(this,void 0,void 0,function*(){var o,l,c,u,d,h;if(!(!((d=this.roomOptions)===null||d===void 0)&&d.dynacast))return;const f=this.videoTrackPublications.get(a.trackSid);if(!f){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}if(a.subscribedCodecs.length>0){if(!f.videoTrack)return;const _=yield f.videoTrack.setPublishingCodecs(a.subscribedCodecs);try{for(var g=!0,v=Ur(_),m;m=yield v.next(),o=m.done,!o;g=!0){u=m.value,g=!1;const y=u;hI(y)&&(this.log.debug("publish ".concat(y," for ").concat(f.videoTrack.sid),Object.assign(Object.assign({},this.logContext),yn(f))),yield this.publishAdditionalCodecForTrack(f.videoTrack,y,f.options))}}catch(y){l={error:y}}finally{try{!g&&!o&&(c=v.return)&&(yield c.call(v))}finally{if(l)throw l.error}}}else a.subscribedQualities.length>0&&(yield(h=f.videoTrack)===null||h===void 0?void 0:h.setPublishingLayers(a.subscribedQualities))}),this.handleLocalTrackUnpublished=a=>{const o=this.trackPublications.get(a.trackSid);if(!o){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}this.unpublishTrack(o.track)},this.handleTrackEnded=a=>G(this,void 0,void 0,function*(){if(a.source===xe.Source.ScreenShare||a.source===xe.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),yn(a))),this.unpublishTrack(a);else if(a.isUserProvided)yield a.mute();else if(ma(a)||Tr(a))try{if(xi())try{const o=yield navigator==null?void 0:navigator.permissions.query({name:a.source===xe.Source.Camera?"camera":"microphone"});if(o&&o.state==="denied")throw this.log.warn("user has revoked access to ".concat(a.source),Object.assign(Object.assign({},this.logContext),yn(a))),o.onchange=()=>{o.state!=="denied"&&(a.isMuted||a.restartTrack(),o.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}a.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),yn(a))),ma(a)?yield a.restartTrack({deviceId:"default"}):yield a.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),yn(a))),yield a.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=s,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=r}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Bi.NONE}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setupEngine(e){this.engine=e,this.engine.on(We.RemoteMute,(t,i)=>{const s=this.trackPublications.get(t);!s||!s.track||(i?s.mute():s.unmute())}),this.engine.on(We.Connected,this.handleReconnected).on(We.SignalRestarted,this.handleReconnected).on(We.SignalResumed,this.handleReconnected).on(We.Restarting,this.handleReconnecting).on(We.Resuming,this.handleReconnecting).on(We.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(We.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(We.Disconnected,this.handleDisconnected).on(We.SignalRequestResponse,this.handleSignalRequestResponse).on(We.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return G(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return G(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return G(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return G(this,arguments,void 0,function(t){var i=this;let{metadata:s,name:r,attributes:a}=t;return function*(){return new Promise((o,l)=>G(i,void 0,void 0,function*(){var c,u;try{let d=!1;const h=yield this.engine.client.sendUpdateLocalMetadata((c=s??this.metadata)!==null&&c!==void 0?c:"",(u=r??this.name)!==null&&u!==void 0?u:"",a),f=performance.now();for(this.pendingSignalRequests.set(h,{resolve:o,reject:g=>{l(g),d=!0},values:{name:r,metadata:s,attributes:a}});performance.now()-f<5e3&&!d;){if((!r||this.name===r)&&(!s||this.metadata===s)&&(!a||Object.entries(a).every(g=>{let[v,m]=g;return this.attributes[v]===m||m===""&&!this.attributes[v]}))){this.pendingSignalRequests.delete(h),o();return}yield Ii(50)}l(new O_("Request to update local metadata timed out","TimeoutError"))}catch(d){d instanceof Error&&l(d)}}))}()})}setCameraEnabled(e,t,i){return this.setTrackEnabled(xe.Source.Camera,e,t,i)}setMicrophoneEnabled(e,t,i){return this.setTrackEnabled(xe.Source.Microphone,e,t,i)}setScreenShareEnabled(e,t,i){return this.setTrackEnabled(xe.Source.ScreenShare,e,t,i)}setPermissions(e){const t=this.permissions,i=super.setPermissions(e);return i&&t&&this.emit(qe.ParticipantPermissionsChanged,t),i}setE2EEEnabled(e){return G(this,void 0,void 0,function*(){this.encryptionType=e?Bi.GCM:Bi.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,t,i,s){return G(this,void 0,void 0,function*(){var r,a;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:t})),this.republishPromise&&(yield this.republishPromise);let o=this.getTrackPublication(e);if(t)if(o)yield o.unmute();else{let l;if(this.pendingPublishing.has(e)){const c=yield this.waitForPendingPublicationOfSource(e);return c||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield c==null?void 0:c.unmute(),c}this.pendingPublishing.add(e);try{switch(e){case xe.Source.Camera:l=yield this.createTracks({video:(r=i)!==null&&r!==void 0?r:!0});break;case xe.Source.Microphone:l=yield this.createTracks({audio:(a=i)!==null&&a!==void 0?a:!0});break;case xe.Source.ScreenShare:l=yield this.createScreenTracks(Object.assign({},i));break;default:throw new rr(e)}}catch(c){throw l==null||l.forEach(u=>{u.stop()}),c instanceof Error&&this.emit(qe.MediaDevicesError,c),this.pendingPublishing.delete(e),c}try{const c=[];for(const d of l)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),yn(d))),c.push(this.publishTrack(d,s));[o]=yield Promise.all(c)}catch(c){throw l==null||l.forEach(u=>{u.stop()}),c}finally{this.pendingPublishing.delete(e)}}else if(!(o!=null&&o.track)&&this.pendingPublishing.has(e)&&(o=yield this.waitForPendingPublicationOfSource(e),o||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),o&&o.track)if(e===xe.Source.ScreenShare){o=yield this.unpublishTrack(o.track);const l=this.getTrackPublication(xe.Source.ScreenShareAudio);l&&l.track&&this.unpublishTrack(l.track)}else yield o.mute();return o})}enableCameraAndMicrophone(){return G(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(xe.Source.Camera)||this.pendingPublishing.has(xe.Source.Microphone))){this.pendingPublishing.add(xe.Source.Camera),this.pendingPublishing.add(xe.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(t=>this.publishTrack(t)))}finally{this.pendingPublishing.delete(xe.Source.Camera),this.pendingPublishing.delete(xe.Source.Microphone)}}})}createTracks(e){return G(this,void 0,void 0,function*(){var t,i;e??(e={});const s=uS(e,(t=this.roomOptions)===null||t===void 0?void 0:t.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults),{audioProcessor:r,videoProcessor:a,optionsWithoutProcessor:o}=_g(s),l=Td(o);let c;try{c=yield navigator.mediaDevices.getUserMedia(l)}catch(u){throw u instanceof Error&&(l.audio&&(this.microphoneError=u),l.video&&(this.cameraError=u)),u}return l.audio&&(this.microphoneError=void 0,this.emit(qe.AudioStreamAcquired)),l.video&&(this.cameraError=void 0),Promise.all(c.getTracks().map(u=>G(this,void 0,void 0,function*(){const d=u.kind==="audio";let h;const f=d?l.audio:l.video;typeof f!="boolean"&&(h=f);const g=_S(u,h,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return g.kind===xe.Kind.Video?g.source=xe.Source.Camera:g.kind===xe.Kind.Audio&&(g.source=xe.Source.Microphone,g.setAudioContext(this.audioContext)),g.mediaStream=c,fr(g)&&r?yield g.setProcessor(r):Jo(g)&&a&&(yield g.setProcessor(a)),g})))})}createScreenTracks(e){return G(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new mg("getDisplayMedia not supported");e.resolution===void 0&&!vI()&&(e.resolution=gg.h1080fps30.resolution);const t=xI(e),i=yield navigator.mediaDevices.getDisplayMedia(t),s=i.getVideoTracks();if(s.length===0)throw new rr("no video track found");const r=new Ju(s[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});r.source=xe.Source.ScreenShare,e.contentHint&&(r.mediaStreamTrack.contentHint=e.contentHint);const a=[r];if(i.getAudioTracks().length>0){this.emit(qe.AudioStreamAcquired);const o=new Yu(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});o.source=xe.Source.ScreenShareAudio,a.push(o)}return a})}publishTrack(e,t){return G(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,t)})}publishOrRepublishTrack(e,t){return G(this,arguments,void 0,function(i,s){var r=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var o,l,c,u;ma(i)&&i.setAudioContext(r.audioContext),yield(o=r.reconnectFuture)===null||o===void 0?void 0:o.promise,r.republishPromise&&!a&&(yield r.republishPromise),Eo(i)&&r.pendingPublishPromises.has(i)&&(yield r.pendingPublishPromises.get(i));let d;if(i instanceof MediaStreamTrack)d=i.getConstraints();else{d=i.constraints;let _;switch(i.source){case xe.Source.Microphone:_="audioinput";break;case xe.Source.Camera:_="videoinput"}_&&r.activeDeviceMap.has(_)&&(d=Object.assign(Object.assign({},d),{deviceId:r.activeDeviceMap.get(_)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new Yu(i,d,!0,r.audioContext,{loggerName:r.roomOptions.loggerName,loggerContextCb:()=>r.logContext});break;case"video":i=new Ju(i,d,!0,{loggerName:r.roomOptions.loggerName,loggerContextCb:()=>r.logContext});break;default:throw new rr("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:r.roomOptions.loggerName,loggerContextCb:()=>r.logContext});let h;if(r.trackPublications.forEach(_=>{_.track&&_.track===i&&(h=_)}),h)return r.log.warn("track has already been published, skipping",Object.assign(Object.assign({},r.logContext),yn(h))),h;const f="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,g=(l=s==null?void 0:s.forceStereo)!==null&&l!==void 0?l:f;g&&(s||(s={}),s.dtx===void 0&&r.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},r.logContext),yn(i))),s.red===void 0&&r.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(c=s.dtx)!==null&&c!==void 0||(s.dtx=!1),(u=s.red)!==null&&u!==void 0||(s.red=!1));const v=Object.assign(Object.assign({},r.roomOptions.publishDefaults),s);!bI()&&r.roomOptions.e2ee&&(r.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},r.logContext)),v.simulcast=!1),v.source&&(i.source=v.source);const m=r.publish(i,v,g);r.pendingPublishPromises.set(i,m);try{return yield m}catch(_){throw _}finally{r.pendingPublishPromises.delete(i)}}()})}publish(e,t,i){return G(this,void 0,void 0,function*(){var s,r,a,o,l,c,u,d,h,f;Array.from(this.trackPublications.values()).find(w=>Eo(e)&&w.source===e.source)&&e.source!==xe.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),yn(e))),t.stopMicTrackOnMute&&fr(e)&&(e.stopOnMute=!0),e.source===xe.Source.ScreenShare&&Do()&&(t.simulcast=!1),t.videoCodec==="av1"&&!mI()&&(t.videoCodec=void 0),t.videoCodec==="vp9"&&!gI()&&(t.videoCodec=void 0),t.videoCodec===void 0&&(t.videoCodec=Bp),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(w=>t.videoCodec===Su(w.mime))||(t.videoCodec=Su(this.enabledPublishVideoCodecs[0].mime)));const v=t.videoCodec;e.on(Ve.Muted,this.onTrackMuted),e.on(Ve.Unmuted,this.onTrackUnmuted),e.on(Ve.Ended,this.handleTrackEnded),e.on(Ve.UpstreamPaused,this.onTrackUpstreamPaused),e.on(Ve.UpstreamResumed,this.onTrackUpstreamResumed),e.on(Ve.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const m=new Tp({cid:e.mediaStreamTrack.id,name:t.name,type:xe.kindToProto(e.kind),muted:e.isMuted,source:xe.sourceToProto(e.source),disableDtx:!(!((s=t.dtx)!==null&&s!==void 0)||s),encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((r=t.red)!==null&&r!==void 0)||r),stream:t==null?void 0:t.stream,backupCodecPolicy:t==null?void 0:t.backupCodecPolicy});let _;if(e.kind===xe.Kind.Video){let w={width:0,height:0};try{w=yield e.waitForDimensions()}catch{const C=(o=(a=this.roomOptions.videoCaptureDefaults)===null||a===void 0?void 0:a.resolution)!==null&&o!==void 0?o:Yc.h720.resolution;w={width:C.width,height:C.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),yn(e)),{dims:w}))}m.width=w.width,m.height=w.height,Tr(e)&&(Lc(v)&&(e.source===xe.Source.ScreenShare&&(t.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),yn(e))))),t.scalabilityMode=(l=t.scalabilityMode)!==null&&l!==void 0?l:"L3T3_KEY"),m.simulcastCodecs=[new yp({codec:v,cid:e.mediaStreamTrack.id})],t.backupCodec===!0&&(t.backupCodec={codec:Bp}),t.backupCodec&&v!==t.backupCodec.codec&&m.encryption===Bi.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),m.simulcastCodecs.push(new yp({codec:t.backupCodec.codec,cid:""})))),_=Gp(e.source===xe.Source.ScreenShare,m.width,m.height,t),m.layers=rv(m.width,m.height,_,Lc(t.videoCodec))}else e.kind===xe.Kind.Audio&&(_=[{maxBitrate:(c=t.audioPreset)===null||c===void 0?void 0:c.maxBitrate,priority:(d=(u=t.audioPreset)===null||u===void 0?void 0:u.priority)!==null&&d!==void 0?d:"high",networkPriority:(f=(h=t.audioPreset)===null||h===void 0?void 0:h.priority)!==null&&f!==void 0?f:"high"}]);if(!this.engine||this.engine.isClosed)throw new Xn("cannot publish track when not connected");const y=()=>G(this,void 0,void 0,function*(){var w,E,C;if(!this.engine.pcManager)throw new Xn("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,t,_),Tr(e)&&((w=t.degradationPreference)!==null&&w!==void 0||(t.degradationPreference=sP(e)),e.setDegradationPreference(t.degradationPreference)),_)if(Do()&&e.kind===xe.Kind.Audio){let M;for(const I of this.engine.pcManager.publisher.getTransceivers())if(I.sender===e.sender){M=I;break}M&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:M,codec:"opus",maxbr:!((E=_[0])===null||E===void 0)&&E.maxBitrate?_[0].maxBitrate/1e3:0})}else e.codec&&Lc(e.codec)&&(!((C=_[0])===null||C===void 0)&&C.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:m.cid,codec:e.codec,maxbr:_[0].maxBitrate/1e3});yield this.engine.negotiate()});let b;if(this.enabledPublishVideoCodecs.length>0)b=(yield Promise.all([this.engine.addTrack(m),y()]))[0];else{b=yield this.engine.addTrack(m);let w;if(b.codecs.forEach(E=>{w===void 0&&(w=E.mimeType)}),w&&e.kind===xe.Kind.Video){const E=Su(w);E!==v&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),yn(e)),{codec:E})),t.videoCodec=E,_=Gp(e.source===xe.Source.ScreenShare,m.width,m.height,t))}yield y()}const p=new Wp(e.kind,b,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return p.options=t,e.sid=b.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:_,trackInfo:b})),Tr(e)?e.startMonitor(this.engine.client):ma(e)&&e.startMonitor(),this.addTrackPublication(p),this.emit(qe.LocalTrackPublished,p),p})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,t,i){return G(this,void 0,void 0,function*(){var s;if(this.encryptionType!==Bi.NONE)return;let r;if(this.trackPublications.forEach(f=>{f.track&&f.track===e&&(r=f)}),!r)throw new rr("track is not published");if(!Tr(e))throw new rr("track is not a video track");const a=Object.assign(Object.assign({},(s=this.roomOptions)===null||s===void 0?void 0:s.publishDefaults),i),o=tP(e,t,a);if(!o){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),yn(e)));return}const l=e.addSimulcastTrack(t,o);if(!l)return;const c=new Tp({cid:l.mediaStreamTrack.id,type:xe.kindToProto(e.kind),muted:e.isMuted,source:xe.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:a.videoCodec,cid:l.mediaStreamTrack.id}]});if(c.layers=rv(c.width,c.height,o),!this.engine||this.engine.isClosed)throw new Xn("cannot publish track when not connected");const u=()=>G(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,l,a,o),yield this.engine.negotiate()}),h=(yield Promise.all([this.engine.addTrack(c),u()]))[0];this.log.debug("published ".concat(t," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:o,trackInfo:h}))})}unpublishTrack(e,t){return G(this,void 0,void 0,function*(){var i,s;if(Eo(e)){const c=this.pendingPublishPromises.get(e);c&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),yn(e))),yield c)}const r=this.getPublicationForTrack(e),a=r?yn(r):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),a)),!r||!r.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),a));return}e=r.track,e.off(Ve.Muted,this.onTrackMuted),e.off(Ve.Unmuted,this.onTrackUnmuted),e.off(Ve.Ended,this.handleTrackEnded),e.off(Ve.UpstreamPaused,this.onTrackUpstreamPaused),e.off(Ve.UpstreamResumed,this.onTrackUpstreamResumed),e.off(Ve.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),t===void 0&&(t=(s=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&s!==void 0?s:!0),t?e.stop():e.stopMonitor();let o=!1;const l=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<On.FAILED&&l)try{for(const c of this.engine.pcManager.publisher.getTransceivers())c.sender===l&&(c.direction="inactive",o=!0);if(this.engine.removeTrack(l)&&(o=!0),Tr(e)){for(const[,c]of e.simulcastCodecs)c.sender&&(this.engine.removeTrack(c.sender)&&(o=!0),c.sender=void 0);e.simulcastCodecs.clear()}}catch(c){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),a),{error:c}))}switch(this.trackPublications.delete(r.trackSid),r.kind){case xe.Kind.Audio:this.audioTrackPublications.delete(r.trackSid);break;case xe.Kind.Video:this.videoTrackPublications.delete(r.trackSid);break}return this.emit(qe.LocalTrackUnpublished,r),r.setTrack(void 0),o&&(yield this.engine.negotiate()),r})}unpublishTracks(e){return G(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return G(this,arguments,void 0,function(t){var i=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new Promise((r,a)=>G(i,void 0,void 0,function*(){try{const o=[];this.trackPublications.forEach(l=>{l.track&&(t&&(l.options=Object.assign(Object.assign({},l.options),t)),o.push(l))}),yield Promise.all(o.map(l=>G(this,void 0,void 0,function*(){const c=l.track;yield this.unpublishTrack(c,!1),s&&!c.isMuted&&c.source!==xe.Source.ScreenShare&&c.source!==xe.Source.ScreenShareAudio&&(ma(c)||Tr(c))&&!c.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:l.trackSid})),yield c.restartTrack()),yield this.publishOrRepublishTrack(c,l.options,!0)}))),r()}catch(o){a(o)}finally{this.republishPromise=void 0}})),yield i.republishPromise}()})}publishData(e){return G(this,arguments,void 0,function(t){var i=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const r=s.reliable?Jt.RELIABLE:Jt.LOSSY,a=s.destinationIdentities,o=s.topic,l=new ki({kind:r,value:{case:"user",value:new rT({participantIdentity:i.identity,payload:t,destinationIdentities:a,topic:o})}});yield i.engine.sendDataPacket(l,r)}()})}publishDtmf(e,t){return G(this,void 0,void 0,function*(){const i=new ki({kind:Jt.RELIABLE,value:{case:"sipDtmf",value:new aT({code:e,digit:t})}});yield this.engine.sendDataPacket(i,Jt.RELIABLE)})}sendChatMessage(e,t){return G(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:t==null?void 0:t.attachments},s=new ki({value:{case:"chatMessage",value:new pp(Object.assign(Object.assign({},i),{timestamp:xn.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(s,Jt.RELIABLE),this.emit(qe.ChatMessage,i),i})}editChatMessage(e,t){return G(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},t),{message:e,editTimestamp:Date.now()}),s=new ki({value:{case:"chatMessage",value:new pp(Object.assign(Object.assign({},i),{timestamp:xn.parse(i.timestamp),editTimestamp:xn.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(s,Jt.RELIABLE),this.emit(qe.ChatMessage,i),i})}sendText(e,t){return G(this,void 0,void 0,function*(){var i;const s=crypto.randomUUID(),a=new TextEncoder().encode(e).byteLength,o=(i=t==null?void 0:t.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),l=new Array(o?o.length+1:1).fill(0),c=(d,h)=>{var f;l[h]=d;const g=l.reduce((v,m)=>v+m,0);(f=t==null?void 0:t.onProgress)===null||f===void 0||f.call(t,g)},u=yield this.streamText({streamId:s,totalSize:a,destinationIdentities:t==null?void 0:t.destinationIdentities,topic:t==null?void 0:t.topic,attachedStreamIds:o});return yield u.write(e),c(1,0),yield u.close(),t!=null&&t.attachments&&o&&(yield Promise.all(t.attachments.map((d,h)=>G(this,void 0,void 0,function*(){return this._sendFile(o[h],d,{topic:t.topic,mimeType:d.type,onProgress:f=>{c(f,h+1)}})})))),u.info})}streamText(e){return G(this,void 0,void 0,function*(){var t,i;const s=(t=e==null?void 0:e.streamId)!==null&&t!==void 0?t:crypto.randomUUID(),r={id:s,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e==null?void 0:e.topic)!==null&&i!==void 0?i:"",size:e==null?void 0:e.totalSize},a=new gp({streamId:s,mimeType:r.mimeType,topic:r.topic,timestamp:pa(r.timestamp),totalLength:pa(e==null?void 0:e.totalSize),contentHeader:{case:"textHeader",value:new gT({version:e==null?void 0:e.version,attachedStreamIds:e==null?void 0:e.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?mp.UPDATE:mp.CREATE})}}),o=e==null?void 0:e.destinationIdentities,l=new ki({destinationIdentities:o,value:{case:"streamHeader",value:a}});yield this.engine.sendDataPacket(l,Jt.RELIABLE);let c=0;const u=this,d=new WritableStream({write(g){return G(this,void 0,void 0,function*(){for(const v of MI(g,Sl)){yield u.engine.waitForBufferStatusLow(Jt.RELIABLE);const m=new _p({content:v,streamId:s,chunkIndex:pa(c)}),_=new ki({destinationIdentities:o,value:{case:"streamChunk",value:m}});yield u.engine.sendDataPacket(_,Jt.RELIABLE),c+=1}})},close(){return G(this,void 0,void 0,function*(){const g=new vp({streamId:s}),v=new ki({destinationIdentities:o,value:{case:"streamTrailer",value:g}});yield u.engine.sendDataPacket(v,Jt.RELIABLE)})},abort(g){console.log("Sink error:",g)}});let h=()=>G(this,void 0,void 0,function*(){yield f.close()});u.engine.once(We.Closing,h);const f=new pP(d,r,()=>this.engine.off(We.Closing,h));return f})}sendFile(e,t){return G(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,t),{id:i}})}_sendFile(e,t,i){return G(this,void 0,void 0,function*(){var s,r;const a=t.size,o=new gp({totalLength:pa(a),mimeType:(s=i==null?void 0:i.mimeType)!==null&&s!==void 0?s:t.type,streamId:e,topic:i==null?void 0:i.topic,encryptionType:i==null?void 0:i.encryptionType,timestamp:pa(Date.now()),contentHeader:{case:"byteHeader",value:new _T({name:t.name})}}),l=i==null?void 0:i.destinationIdentities,c=new ki({destinationIdentities:l,value:{case:"streamHeader",value:o}});yield this.engine.sendDataPacket(c,Jt.RELIABLE);function u(g){return new Promise(v=>{const m=new FileReader;m.onload=()=>{v(new Uint8Array(m.result))},m.readAsArrayBuffer(g)})}const d=Math.ceil(a/Sl);for(let g=0;g<d;g++){const v=yield u(t.slice(g*Sl,Math.min((g+1)*Sl,a)));yield this.engine.waitForBufferStatusLow(Jt.RELIABLE);const m=new _p({content:v,streamId:e,chunkIndex:pa(g)}),_=new ki({destinationIdentities:l,value:{case:"streamChunk",value:m}});yield this.engine.sendDataPacket(_,Jt.RELIABLE),(r=i==null?void 0:i.onProgress)===null||r===void 0||r.call(i,(g+1)/d)}const h=new vp({streamId:e}),f=new ki({destinationIdentities:l,value:{case:"streamTrailer",value:h}});yield this.engine.sendDataPacket(f,Jt.RELIABLE)})}performRpc(e){return G(this,arguments,void 0,function(t){var i=this;let{destinationIdentity:s,method:r,payload:a,responseTimeout:o=1e4}=t;return function*(){return new Promise((c,u)=>G(i,void 0,void 0,function*(){var d,h,f,g;if(Sg(a)>mS){u(Fn.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((h=(d=this.engine.latestJoinResponse)===null||d===void 0?void 0:d.serverInfo)===null||h===void 0)&&h.version&&Lo((g=(f=this.engine.latestJoinResponse)===null||f===void 0?void 0:f.serverInfo)===null||g===void 0?void 0:g.version,"1.8.0")<0){u(Fn.builtIn("UNSUPPORTED_SERVER"));return}const v=crypto.randomUUID();yield this.publishRpcRequest(s,v,r,a,o-2e3);const m=setTimeout(()=>{this.pendingAcks.delete(v),u(Fn.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(v),clearTimeout(_)},2e3);this.pendingAcks.set(v,{resolve:()=>{clearTimeout(m)},participantIdentity:s});const _=setTimeout(()=>{this.pendingResponses.delete(v),u(Fn.builtIn("RESPONSE_TIMEOUT"))},o);this.pendingResponses.set(v,{resolve:(y,b)=>{clearTimeout(_),this.pendingAcks.has(v)&&(console.warn("RPC response received before ack",v),this.pendingAcks.delete(v),clearTimeout(m)),b?u(b):c(y??"")},participantIdentity:s})}))}()})}registerRpcMethod(e,t){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const t=this.pendingAcks.get(e);t?(t.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,t,i){const s=this.pendingResponses.get(e);s?(s.resolve(t,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,t,i,s,r){return G(this,void 0,void 0,function*(){const a=new ki({destinationIdentities:[e],kind:Jt.RELIABLE,value:{case:"rpcRequest",value:new oT({id:t,method:i,payload:s,responseTimeoutMs:r,version:1})}});yield this.engine.sendDataPacket(a,Jt.RELIABLE)})}handleParticipantDisconnected(e){for(const[t,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(t);for(const[t,{participantIdentity:i,resolve:s}]of this.pendingResponses)i===e&&(s(null,Fn.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(t))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(t=>t.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return e.sid!==this.sid||!super.updateInfo(e)?!1:(e.tracks.forEach(t=>{var i,s;const r=this.trackPublications.get(t.sid);if(r){const a=r.isMuted||((s=(i=r.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&s!==void 0?s:!1);a!==t.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),yn(r)),{mutedOnServer:a})),this.engine.client.sendMuteTrack(t.sid,a))}}),!0)}getPublicationForTrack(e){let t;return this.trackPublications.forEach(i=>{const s=i.track;s&&(e instanceof MediaStreamTrack?(ma(s)||Tr(s))&&s.mediaStreamTrack===e&&(t=i):e===s&&(t=i))}),t}waitForPendingPublicationOfSource(e){return G(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const s=Array.from(this.pendingPublishPromises.entries()).find(r=>{let[a]=r;return a.source===e});if(s)return s[1];yield Ii(20)}})}}class TP extends Or{constructor(e,t,i,s){super(e,t.sid,t.name,s),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=Zi.HIGH,this.handleEnded=r=>{this.setTrack(void 0),this.emit(Ve.Ended,r)},this.handleVisibilityChange=r=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(r),this.logContext),this.disabled=!r,this.emitTrackUpdate()},this.handleVideoDimensionsChange=r=>{this.log.debug("adaptivestream video dimensions ".concat(r.width,"x").concat(r.height),this.logContext),this.videoDimensions=r,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(t)}setSubscribed(e){const t=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const s=new vd({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new dT({participantSid:"",trackSids:[this.trackSid]})]});this.emit(Ve.UpdateSubscription,s),this.emitSubscriptionUpdateIfChanged(t),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?Or.SubscriptionStatus.Unsubscribed:super.isSubscribed?Or.SubscriptionStatus.Subscribed:Or.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?Or.PermissionStatus.Allowed:Or.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return!this.disabled}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.disabled===!e||(this.disabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.currentVideoQuality===e||(this.currentVideoQuality=e,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var t,i;this.isManualOperationAllowed()&&(((t=this.videoDimensions)===null||t===void 0?void 0:t.width)===e.width&&((i=this.videoDimensions)===null||i===void 0?void 0:i.height)===e.height||(Jh(this.track)&&(this.videoDimensions=e),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&Jh(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(e){const t=this.subscriptionStatus,i=this.permissionStatus,s=this.track;s!==e&&(s&&(s.off(Ve.VideoDimensionsChanged,this.handleVideoDimensionsChange),s.off(Ve.VisibilityChanged,this.handleVisibilityChange),s.off(Ve.Ended,this.handleEnded),s.detach(),s.stopMonitor(),this.emit(Ve.Unsubscribed,s)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(Ve.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(Ve.VisibilityChanged,this.handleVisibilityChange),e.on(Ve.Ended,this.handleEnded),this.emit(Ve.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(t))}setAllowed(e){const t=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(t)}setSubscriptionError(e){this.emit(Ve.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const t=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):t!==e.muted&&this.emit(e.muted?Ve.Muted:Ve.Unmuted)}emitSubscriptionUpdateIfChanged(e){const t=this.subscriptionStatus;e!==t&&this.emit(Ve.SubscriptionStatusChanged,t,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(Ve.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.kind===xe.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return Jh(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new vT({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(e.width=Math.ceil(this.videoDimensions.width),e.height=Math.ceil(this.videoDimensions.height)):this.currentVideoQuality!==void 0?e.quality=this.currentVideoQuality:e.quality=Zi.HIGH,this.emit(Ve.UpdateSettings,e)}}class Qu extends SS{static fromParticipantInfo(e,t,i){return new Qu(e,t.sid,t.identity,t.name,t.metadata,t.attributes,i,t.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,t,i,s,r,a,o){let l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:qu.STANDARD;super(t,i||"",s,r,a,o,l),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(Ve.UpdateSettings,t=>{this.log.debug("send update settings",Object.assign(Object.assign({},this.logContext),yn(e))),this.signalClient.sendUpdateTrackSettings(t)}),e.on(Ve.UpdateSubscription,t=>{t.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(t)}),e.on(Ve.SubscriptionPermissionChanged,t=>{this.emit(qe.TrackSubscriptionPermissionChanged,e,t)}),e.on(Ve.SubscriptionStatusChanged,t=>{this.emit(qe.TrackSubscriptionStatusChanged,e,t)}),e.on(Ve.Subscribed,t=>{this.emit(qe.TrackSubscribed,t,e)}),e.on(Ve.Unsubscribed,t=>{this.emit(qe.TrackUnsubscribed,t,e)}),e.on(Ve.SubscriptionFailed,t=>{this.emit(qe.TrackSubscriptionFailed,e.trackSid,t)})}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setVolume(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:xe.Source.Microphone;this.volumeMap.set(t,e);const i=this.getTrackPublication(t);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:xe.Source.Microphone;const t=this.getTrackPublication(e);return t&&t.track?t.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,t,i,s,r,a){let o=this.getTrackPublicationBySid(t);if(o||t.startsWith("TR")||this.trackPublications.forEach(u=>{!o&&e.kind===u.kind.toString()&&(o=u)}),!o){if(a===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:t})),this.emit(qe.TrackSubscriptionFailed,t);return}a===void 0&&(a=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,t,i,s,r,a-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),yn(o))),this.emit(qe.TrackSubscriptionFailed,t);return}const l=e.kind==="video";let c;return l?c=new gP(e,t,s,r):c=new mP(e,t,s,this.audioContext,this.audioOutput),c.source=o.source,c.isMuted=o.isMuted,c.setMediaStream(i),c.start(),o.setTrack(c),this.volumeMap.has(o.source)&&Up(c)&&fr(c)&&c.setVolume(this.volumeMap.get(o.source)),o}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const t=new Map,i=new Map;return e.tracks.forEach(s=>{var r,a;let o=this.getTrackPublicationBySid(s.sid);if(o)o.updateInfo(s);else{const l=xe.kindFromProto(s.type);if(!l)return;o=new TP(l,s,(r=this.signalClient.connectOptions)===null||r===void 0?void 0:r.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(a=this.loggerOptions)===null||a===void 0?void 0:a.loggerName}),o.updateInfo(s),i.set(s.sid,o);const c=Array.from(this.trackPublications.values()).find(u=>u.source===(o==null?void 0:o.source));c&&o.source!==xe.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(o.source),Object.assign(Object.assign({},this.logContext),{oldTrack:yn(c),newTrack:yn(o)})),this.addTrackPublication(o)}t.set(s.sid,o)}),this.trackPublications.forEach(s=>{t.has(s.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),yn(s))),this.unpublishTrack(s.trackSid,!0))}),i.forEach(s=>{this.emit(qe.TrackPublished,s)}),!0}unpublishTrack(e,t){const i=this.trackPublications.get(e);if(!i)return;const{track:s}=i;switch(s&&(s.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case xe.Kind.Audio:this.audioTrackPublications.delete(e);break;case xe.Kind.Video:this.videoTrackPublications.delete(e);break}t&&this.emit(qe.TrackUnpublished,i)}setAudioOutput(e){return G(this,void 0,void 0,function*(){this.audioOutput=e;const t=[];this.audioTrackPublications.forEach(i=>{var s;fr(i.track)&&Up(i.track)&&t.push(i.track.setSinkId((s=e.deviceId)!==null&&s!==void 0?s:"default"))}),yield Promise.all(t)})}emit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var nn;(function(n){n.Disconnected="disconnected",n.Connecting="connecting",n.Connected="connected",n.Reconnecting="reconnecting",n.SignalReconnecting="signalReconnecting"})(nn||(nn={}));const SP=4*1e3;let Ag=class jp extends Fs.EventEmitter{constructor(e){var t,i,s,r;if(super(),t=this,this.state=nn.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Ht,this.bufferedEvents=[],this.isResuming=!1,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map,this.rpcHandlers=new Map,this.connect=(a,o,l)=>G(this,void 0,void 0,function*(){var c;if(!_I())throw Os()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const u=yield this.disconnectLock.lock();if(this.state===nn.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),u(),Promise.resolve();if(this.connectFuture)return u(),this.connectFuture.promise;this.setAndEmitConnectionState(nn.Connecting),((c=this.regionUrlProvider)===null||c===void 0?void 0:c.getServerUrl().toString())!==a&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Op(new URL(a))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new zp(a,o):this.regionUrlProvider.updateToken(o),this.regionUrlProvider.fetchRegionSettings().then(f=>{var g;(g=this.regionUrlProvider)===null||g===void 0||g.setServerReportedRegions(f)}).catch(f=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:f}))}));const d=(f,g,v)=>G(this,void 0,void 0,function*(){var m,_;this.abortController&&this.abortController.abort();const y=new AbortController;this.abortController=y,u==null||u();try{yield this.attemptConnection(v??a,o,l,y),this.abortController=void 0,f()}catch(b){if(this.regionUrlProvider&&b instanceof Sn&&b.reason!==qt.Cancelled&&b.reason!==qt.NotAllowed){let p=null;try{p=yield this.regionUrlProvider.getNextBestRegionUrl((m=this.abortController)===null||m===void 0?void 0:m.signal)}catch(w){if(w instanceof Sn&&(w.status===401||w.reason===qt.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),g(w);return}}p&&!(!((_=this.abortController)===null||_===void 0)&&_.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(b.message,". Retrying with another region: ").concat(p),this.logContext),this.recreateEngine(),yield d(f,g,p)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,j_(b)),g(b))}else{let p=Kn.UNKNOWN_REASON;b instanceof Sn&&(p=j_(b)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,p),g(b)}}}),h=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new lS((f,g)=>{d(f,g,h)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(a,o,l,c,u,d)=>G(this,void 0,void 0,function*(){var h,f,g;const v=yield l.join(a,o,{autoSubscribe:c.autoSubscribe,adaptiveStream:typeof u.adaptiveStream=="object"?!0:u.adaptiveStream,maxRetries:c.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:c.websocketTimeout},d.signal);let m=v.serverInfo;if(m||(m={version:v.serverVersion,region:v.serverRegion}),this.serverInfo=m,this.log.debug("connected to Livekit Server ".concat(Object.entries(m).map(_=>{let[y,b]=_;return"".concat(y,": ").concat(b)}).join(", ")),{room:(h=v.room)===null||h===void 0?void 0:h.name,roomSid:(f=v.room)===null||f===void 0?void 0:f.sid,identity:(g=v.participant)===null||g===void 0?void 0:g.identity}),!m.version)throw new nI("unknown server version");return m.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),u.dynacast=!1),v}),this.applyJoinResponse=a=>{const o=a.participant;if(this.localParticipant.sid=o.sid,this.localParticipant.identity=o.identity,this.localParticipant.setEnabledPublishCodecs(a.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(a.sifTrailer)}catch(l){this.log.error(l instanceof Error?l.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:l}))}this.handleParticipantUpdates([o,...a.otherParticipants]),a.room&&this.handleRoomUpdate(a.room)},this.attemptConnection=(a,o,l,c)=>G(this,void 0,void 0,function*(){var u,d;this.state===nn.Reconnecting||this.isResuming||!((u=this.engine)===null||u===void 0)&&u.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((d=this.regionUrlProvider)===null||d===void 0)&&d.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Tg),l),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const h=yield this.connectSignal(a,o,this.engine,this.connOptions,this.options,c);this.applyJoinResponse(h),this.setupLocalParticipantEvents(),this.emit(Ce.SignalConnected)}catch(h){yield this.engine.close(),this.recreateEngine();const f=new Sn("could not establish signal connection",qt.ServerUnreachable);throw h instanceof Error&&(f.message="".concat(f.message,": ").concat(h.message)),h instanceof Sn&&(f.reason=h.reason,f.status=h.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:h})),f}if(c.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new Sn("Connection attempt aborted",qt.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,c)}catch(h){throw yield this.engine.close(),this.recreateEngine(),h}xi()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),xi()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(nn.Connected),this.emit(Ce.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return G(t,[...o],void 0,function(){var c=this;let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var d,h,f,g;const v=yield c.disconnectLock.lock();try{if(c.state===nn.Disconnected){c.log.debug("already disconnected",c.logContext);return}c.log.info("disconnect from room",Object.assign({},c.logContext)),(c.state===nn.Connecting||c.state===nn.Reconnecting||c.isResuming)&&(c.log.warn("abort connection attempt",c.logContext),(d=c.abortController)===null||d===void 0||d.abort(),(f=(h=c.connectFuture)===null||h===void 0?void 0:h.reject)===null||f===void 0||f.call(h,new Sn("Client initiated disconnect",qt.Cancelled)),c.connectFuture=void 0),!((g=c.engine)===null||g===void 0)&&g.client.isDisconnected||(yield c.engine.client.sendLeave()),c.engine&&(yield c.engine.close()),c.handleDisconnect(u,Kn.CLIENT_INITIATED),c.engine=void 0}finally{v()}}()})},this.onPageLeave=()=>G(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>G(this,void 0,void 0,function*(){const a=[],o=Ls();if(o&&o.os==="iOS"){const l="livekit-dummy-audio-el";let c=document.getElementById(l);if(!c){c=document.createElement("audio"),c.id=l,c.autoplay=!0,c.hidden=!0;const u=Yh();u.enabled=!0;const d=new MediaStream([u]);c.srcObject=d,document.addEventListener("visibilitychange",()=>{c&&(c.srcObject=document.hidden?null:d,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(c),this.once(Ce.Disconnected,()=>{c==null||c.remove(),c=null})}a.push(c)}this.remoteParticipants.forEach(l=>{l.audioTrackPublications.forEach(c=>{c.track&&c.track.attachedElements.forEach(u=>{a.push(u)})})});try{yield Promise.all([this.acquireAudioContext(),...a.map(l=>(l.muted=!1,l.play()))]),this.handleAudioPlaybackStarted()}catch(l){throw this.handleAudioPlaybackFailed(l),l}}),this.startVideo=()=>G(this,void 0,void 0,function*(){const a=[];for(const o of this.remoteParticipants.values())o.videoTrackPublications.forEach(l=>{var c;(c=l.track)===null||c===void 0||c.attachedElements.forEach(u=>{a.includes(u)||a.push(u)})});yield Promise.all(a.map(o=>o.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(o=>{o.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const a of this.remoteParticipants.values())this.handleParticipantDisconnected(a.identity,a);this.setAndEmitConnectionState(nn.Reconnecting)&&this.emit(Ce.Reconnecting)},this.handleSignalRestarted=a=>G(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(a.serverRegion),Object.assign(Object.assign({},this.logContext),{region:a.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(a);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(o){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:o}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:a.serverRegion}))}catch{return}this.setAndEmitConnectionState(nn.Connected),this.emit(Ce.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=a=>{a.forEach(o=>{var l;if(o.identity===this.localParticipant.identity){this.localParticipant.updateInfo(o);return}o.identity===""&&(o.identity=(l=this.sidToIdentity.get(o.sid))!==null&&l!==void 0?l:"");let c=this.remoteParticipants.get(o.identity);o.state===fp.DISCONNECTED?this.handleParticipantDisconnected(o.identity,c):c=this.getOrCreateParticipant(o.identity,o)})},this.handleActiveSpeakersUpdate=a=>{const o=[],l={};a.forEach(c=>{if(l[c.sid]=!0,c.sid===this.localParticipant.sid)this.localParticipant.audioLevel=c.level,this.localParticipant.setIsSpeaking(!0),o.push(this.localParticipant);else{const u=this.getRemoteParticipantBySid(c.sid);u&&(u.audioLevel=c.level,u.setIsSpeaking(!0),o.push(u))}}),l[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(c=>{l[c.sid]||(c.audioLevel=0,c.setIsSpeaking(!1))}),this.activeSpeakers=o,this.emitWhenConnected(Ce.ActiveSpeakersChanged,o)},this.handleSpeakersChanged=a=>{const o=new Map;this.activeSpeakers.forEach(c=>{const u=this.remoteParticipants.get(c.identity);u&&u.sid!==c.sid||o.set(c.sid,c)}),a.forEach(c=>{let u=this.getRemoteParticipantBySid(c.sid);c.sid===this.localParticipant.sid&&(u=this.localParticipant),u&&(u.audioLevel=c.level,u.setIsSpeaking(c.active),c.active?o.set(c.sid,u):o.delete(c.sid))});const l=Array.from(o.values());l.sort((c,u)=>u.audioLevel-c.audioLevel),this.activeSpeakers=l,this.emitWhenConnected(Ce.ActiveSpeakersChanged,l)},this.handleStreamStateUpdate=a=>{a.streamStates.forEach(o=>{const l=this.getRemoteParticipantBySid(o.participantSid);if(!l)return;const c=l.getTrackPublicationBySid(o.trackSid);if(!c||!c.track)return;const u=xe.streamStateFromProto(o.state);u!==c.track.streamState&&(c.track.streamState=u,l.emit(qe.TrackStreamStateChanged,c,c.track.streamState),this.emitWhenConnected(Ce.TrackStreamStateChanged,c,c.track.streamState,l))})},this.handleSubscriptionPermissionUpdate=a=>{const o=this.getRemoteParticipantBySid(a.participantSid);if(!o)return;const l=o.getTrackPublicationBySid(a.trackSid);l&&l.setAllowed(a.allowed)},this.handleSubscriptionError=a=>{const o=Array.from(this.remoteParticipants.values()).find(c=>c.trackPublications.has(a.trackSid));if(!o)return;const l=o.getTrackPublicationBySid(a.trackSid);l&&l.setSubscriptionError(a.err)},this.handleDataPacket=a=>{const o=this.remoteParticipants.get(a.participantIdentity);if(a.value.case==="user")this.handleUserPacket(o,a.value.value,a.kind);else if(a.value.case==="transcription")this.handleTranscription(o,a.value.value);else if(a.value.case==="sipDtmf")this.handleSipDtmf(o,a.value.value);else if(a.value.case==="chatMessage")this.handleChatMessage(o,a.value.value);else if(a.value.case==="metrics")this.handleMetrics(a.value.value,o);else if(a.value.case==="streamHeader")this.handleStreamHeader(a.value.value,a.participantIdentity);else if(a.value.case==="streamChunk")this.handleStreamChunk(a.value.value);else if(a.value.case==="streamTrailer")this.handleStreamTrailer(a.value.value);else if(a.value.case==="rpcRequest"){const l=a.value.value;this.handleIncomingRpcRequest(a.participantIdentity,l.id,l.method,l.payload,l.responseTimeoutMs,l.version)}},this.handleUserPacket=(a,o,l)=>{this.emit(Ce.DataReceived,o.payload,a,l,o.topic),a==null||a.emit(qe.DataReceived,o.payload,l)},this.handleSipDtmf=(a,o)=>{this.emit(Ce.SipDTMFReceived,o,a),a==null||a.emit(qe.SipDTMFReceived,o)},this.bufferedSegments=new Map,this.handleTranscription=(a,o)=>{const l=o.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(o.transcribedParticipantIdentity),c=l==null?void 0:l.trackPublications.get(o.trackId),u=CI(o,this.transcriptionReceivedTimes);c==null||c.emit(Ve.TranscriptionReceived,u),l==null||l.emit(qe.TranscriptionReceived,u,c),this.emit(Ce.TranscriptionReceived,u,l,c)},this.handleChatMessage=(a,o)=>{const l=wI(o);this.emit(Ce.ChatMessage,l,a)},this.handleMetrics=(a,o)=>{this.emit(Ce.MetricsReceived,a,o)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(Ce.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=a=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:a})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(Ce.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(Ce.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(Ce.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>G(this,void 0,void 0,function*(){var a,o;const l=ei.getInstance().previousDevices,c=yield ei.getInstance().getDevices(void 0,!1),u=Ls();if((u==null?void 0:u.name)==="Chrome"&&u.os!=="iOS")for(let h of c){const f=l.find(g=>g.deviceId===h.deviceId);f&&f.label!==""&&f.kind===h.kind&&f.label!==h.label&&this.getActiveDevice(h.kind)==="default"&&this.emit(Ce.ActiveDeviceChanged,h.kind,h.deviceId)}const d=["audiooutput","audioinput","videoinput"];for(let h of d){const f=c.filter(v=>v.kind===h),g=this.getActiveDevice(h);if(g===((a=l.filter(v=>v.kind===h)[0])===null||a===void 0?void 0:a.deviceId)&&f.length>0&&((o=f[0])===null||o===void 0?void 0:o.deviceId)!==g){yield this.switchActiveDevice(h,f[0].deviceId);continue}h==="audioinput"&&!Qr()||h==="videoinput"||f.length>0&&!f.find(v=>v.deviceId===this.getActiveDevice(h))&&(yield this.switchActiveDevice(h,f[0].deviceId))}this.emit(Ce.MediaDevicesChanged)}),this.handleRoomUpdate=a=>{const o=this.roomInfo;this.roomInfo=a,o&&o.metadata!==a.metadata&&this.emitWhenConnected(Ce.RoomMetadataChanged,a.metadata),(o==null?void 0:o.activeRecording)!==a.activeRecording&&this.emitWhenConnected(Ce.RecordingStatusChanged,a.activeRecording)},this.handleConnectionQualityUpdate=a=>{a.updates.forEach(o=>{if(o.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(o.quality);return}const l=this.getRemoteParticipantBySid(o.participantSid);l&&l.setConnectionQuality(o.quality)})},this.onLocalParticipantMetadataChanged=a=>{this.emit(Ce.ParticipantMetadataChanged,a,this.localParticipant)},this.onLocalParticipantNameChanged=a=>{this.emit(Ce.ParticipantNameChanged,a,this.localParticipant)},this.onLocalAttributesChanged=a=>{this.emit(Ce.ParticipantAttributesChanged,a,this.localParticipant)},this.onLocalTrackMuted=a=>{this.emit(Ce.TrackMuted,a,this.localParticipant)},this.onLocalTrackUnmuted=a=>{this.emit(Ce.TrackUnmuted,a,this.localParticipant)},this.onTrackProcessorUpdate=a=>{var o;(o=a==null?void 0:a.onPublish)===null||o===void 0||o.call(a,this)},this.onLocalTrackPublished=a=>G(this,void 0,void 0,function*(){var o,l,c,u,d,h;(o=a.track)===null||o===void 0||o.on(Ve.TrackProcessorUpdate,this.onTrackProcessorUpdate),(l=a.track)===null||l===void 0||l.on(Ve.Restarted,this.onLocalTrackRestarted),(d=(u=(c=a.track)===null||c===void 0?void 0:c.getProcessor())===null||u===void 0?void 0:u.onPublish)===null||d===void 0||d.call(u,this),this.emit(Ce.LocalTrackPublished,a,this.localParticipant),ma(a.track)&&(yield a.track.checkForSilence())&&this.emit(Ce.LocalAudioSilenceDetected,a);const f=yield(h=a.track)===null||h===void 0?void 0:h.getDeviceId(!1),g=K_(a.source);g&&f&&f!==this.localParticipant.activeDeviceMap.get(g)&&(this.localParticipant.activeDeviceMap.set(g,f),this.emit(Ce.ActiveDeviceChanged,g,f))}),this.onLocalTrackUnpublished=a=>{var o,l;(o=a.track)===null||o===void 0||o.off(Ve.TrackProcessorUpdate,this.onTrackProcessorUpdate),(l=a.track)===null||l===void 0||l.off(Ve.Restarted,this.onLocalTrackRestarted),this.emit(Ce.LocalTrackUnpublished,a,this.localParticipant)},this.onLocalTrackRestarted=a=>G(this,void 0,void 0,function*(){const o=yield a.getDeviceId(!1),l=K_(a.source);l&&o&&o!==this.localParticipant.activeDeviceMap.get(l)&&(this.log.debug("local track restarted, setting ".concat(l," ").concat(o," active"),this.logContext),this.localParticipant.activeDeviceMap.set(l,o),this.emit(Ce.ActiveDeviceChanged,l,o))}),this.onLocalConnectionQualityChanged=a=>{this.emit(Ce.ConnectionQualityChanged,a,this.localParticipant)},this.onMediaDevicesError=a=>{this.emit(Ce.MediaDevicesError,a)},this.onLocalParticipantPermissionsChanged=a=>{this.emit(Ce.ParticipantPermissionsChanged,a,this.localParticipant)},this.onLocalChatMessageSent=a=>{this.emit(Ce.ChatMessage,a,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},KI),e),this.log=hr((i=this.options.loggerName)!==null&&i!==void 0?i:ys.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},fS),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},pS),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},jI),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new Hi,this.localParticipant=new yP("","",this.engine,this.options,this.rpcHandlers),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",jr(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",jr(this.options.audioCaptureDefaults.deviceId)),!((s=this.options.audioOutput)===null||s===void 0)&&s.deviceId&&this.switchActiveDevice("audiooutput",jr(this.options.audioOutput.deviceId)).catch(a=>this.log.warn("Could not set audio output: ".concat(a.message),this.logContext)),this.options.e2ee&&this.setupE2EE(),xi()){const a=new AbortController;(r=navigator.mediaDevices)===null||r===void 0||r.addEventListener("devicechange",this.handleDeviceChange,{signal:a.signal}),jp.cleanupRegistry&&jp.cleanupRegistry.register(this,()=>{a.abort()})}}registerTextStreamHandler(e,t){if(this.textStreamHandlers.has(e))throw new TypeError('A text stream handler for topic "'.concat(e,'" has already been set.'));this.textStreamHandlers.set(e,t)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,t){if(this.byteStreamHandlers.has(e))throw new TypeError('A byte stream handler for topic "'.concat(e,'" has already been set.'));this.byteStreamHandlers.set(e,t)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}registerRpcMethod(e,t){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}handleIncomingRpcRequest(e,t,i,s,r,a){return G(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,t),a!==1){yield this.engine.publishRpcResponse(e,t,null,Fn.builtIn("UNSUPPORTED_VERSION"));return}const o=this.rpcHandlers.get(i);if(!o){yield this.engine.publishRpcResponse(e,t,null,Fn.builtIn("UNSUPPORTED_METHOD"));return}let l=null,c=null;try{const u=yield o({requestId:t,callerIdentity:e,payload:s,responseTimeout:r});Sg(u)>mS?(l=Fn.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(i))):c=u}catch(u){u instanceof Fn?l=u:(console.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),u),l=Fn.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,t,c,l)})}setE2EEEnabled(e){return G(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new DI(this.options.e2ee),this.e2eeManager.on(Gr.ParticipantEncryptionStatusChanged,(t,i)=>{kI(i)&&(this.isE2EEEnabled=t),this.emit(Ce.ParticipantEncryptionStatusChanged,t,i)}),this.e2eeManager.on(Gr.EncryptionError,t=>this.emit(Ce.EncryptionError,t)),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&t!==void 0?t:!1}getSid(){return G(this,void 0,void 0,function*(){return this.state===nn.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,t)=>{const i=s=>{s.sid!==""&&(this.engine.off(We.RoomUpdate,i),e(s.sid))};this.engine.on(We.RoomUpdate,i),this.once(Ce.Disconnected,()=>{this.engine.off(We.RoomUpdate,i),t("Room disconnected before room server id was available")})})})}get name(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&t!==void 0?t:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&t!==void 0?t:0}get numPublishers(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&t!==void 0?t:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new oP(this.options),this.engine.on(We.ParticipantUpdate,this.handleParticipantUpdates).on(We.RoomUpdate,this.handleRoomUpdate).on(We.SpeakersChanged,this.handleSpeakersChanged).on(We.StreamStateChanged,this.handleStreamStateUpdate).on(We.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(We.SubscriptionError,this.handleSubscriptionError).on(We.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(We.MediaTrackAdded,(e,t,i)=>{this.onTrackAdded(e,t,i)}).on(We.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(We.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(We.DataPacketReceived,this.handleDataPacket).on(We.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(nn.SignalReconnecting)&&this.emit(Ce.SignalReconnecting)}).on(We.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(nn.Connected)&&this.emit(Ce.Reconnected)}).on(We.SignalResumed,()=>{this.bufferedEvents=[],(this.state===nn.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(We.Restarting,this.handleRestarting).on(We.SignalRestarted,this.handleSignalRestarted).on(We.Offline,()=>{this.setAndEmitConnectionState(nn.Reconnecting)&&this.emit(Ce.Reconnecting)}).on(We.DCBufferStatusChanged,(e,t)=>{this.emit(Ce.DCBufferStatusChanged,e,t)}).on(We.LocalTrackSubscribed,e=>{const t=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:s}=i;return s===e});if(!t){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(qe.LocalTrackSubscribed,t),this.emitWhenConnected(Ce.LocalTrackSubscribed,t,this.localParticipant)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return ei.getInstance().getDevices(e,t)}prepareConnection(e,t){return G(this,void 0,void 0,function*(){if(this.state===nn.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(Op(new URL(e))&&t){this.regionUrlProvider=new zp(e,t);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===nn.Disconnected&&(this.regionUrl=i,yield fetch(W_(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(W_(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,t){return G(this,void 0,void 0,function*(){let i=()=>{},s;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":s=new Cs({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":s=new Cs({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":s=new Cs({scenario:{case:"serverLeave",value:!0}});break;case"migration":s=new Cs({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>G(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),s=new Cs({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>G(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),s=new Cs({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":s=new Cs({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>G(this,void 0,void 0,function*(){const r=this.engine.client.onLeave;r&&r(new bd({reason:Kn.CLIENT_INITIATED,action:yo.RECONNECT}))});break;case"subscriber-bandwidth":if(t===void 0||typeof t!="number")throw new Error("subscriber-bandwidth requires a number as argument");s=new Cs({scenario:{case:"subscriberBandwidth",value:pa(t)}});break;case"leave-full-reconnect":s=new Cs({scenario:{case:"leaveRequestFullReconnect",value:!0}})}s&&(yield this.engine.client.sendSimulateScenario(s),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,t){return G(this,arguments,void 0,function(i,s){var r=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var o,l,c,u,d,h,f,g;let v=!0,m=!1;const _=a?{exact:s}:s;if(i==="audioinput"){m=r.localParticipant.audioTrackPublications.size===0;const y=(o=r.getActiveDevice(i))!==null&&o!==void 0?o:r.options.audioCaptureDefaults.deviceId;r.options.audioCaptureDefaults.deviceId=_;const b=Array.from(r.localParticipant.audioTrackPublications.values()).filter(p=>p.source===xe.Source.Microphone);try{v=(yield Promise.all(b.map(p=>{var w;return(w=p.audioTrack)===null||w===void 0?void 0:w.setDeviceId(_)}))).every(p=>p===!0)}catch(p){throw r.options.audioCaptureDefaults.deviceId=y,p}}else if(i==="videoinput"){m=r.localParticipant.videoTrackPublications.size===0;const y=(l=r.getActiveDevice(i))!==null&&l!==void 0?l:r.options.videoCaptureDefaults.deviceId;r.options.videoCaptureDefaults.deviceId=_;const b=Array.from(r.localParticipant.videoTrackPublications.values()).filter(p=>p.source===xe.Source.Camera);try{v=(yield Promise.all(b.map(p=>{var w;return(w=p.videoTrack)===null||w===void 0?void 0:w.setDeviceId(_)}))).every(p=>p===!0)}catch(p){throw r.options.videoCaptureDefaults.deviceId=y,p}}else if(i==="audiooutput"){if(!Lp()&&!r.options.webAudioMix||r.options.webAudioMix&&r.audioContext&&!("setSinkId"in r.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");r.options.webAudioMix&&(s=(c=yield ei.getInstance().normalizeDeviceId("audiooutput",s))!==null&&c!==void 0?c:""),(u=(g=r.options).audioOutput)!==null&&u!==void 0||(g.audioOutput={});const y=(d=r.getActiveDevice(i))!==null&&d!==void 0?d:r.options.audioOutput.deviceId;r.options.audioOutput.deviceId=s;try{r.options.webAudioMix&&((h=r.audioContext)===null||h===void 0||h.setSinkId(s)),yield Promise.all(Array.from(r.remoteParticipants.values()).map(b=>b.setAudioOutput({deviceId:s})))}catch(b){throw r.options.audioOutput.deviceId=y,b}}return(m||i==="audiooutput")&&(r.localParticipant.activeDeviceMap.set(i,i==="audiooutput"&&((f=r.options.audioOutput)===null||f===void 0?void 0:f.deviceId)||s),r.emit(Ce.ActiveDeviceChanged,i,s)),v}()})}setupLocalParticipantEvents(){this.localParticipant.on(qe.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(qe.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(qe.AttributesChanged,this.onLocalAttributesChanged).on(qe.TrackMuted,this.onLocalTrackMuted).on(qe.TrackUnmuted,this.onLocalTrackUnmuted).on(qe.LocalTrackPublished,this.onLocalTrackPublished).on(qe.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(qe.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(qe.MediaDevicesError,this.onMediaDevicesError).on(qe.AudioStreamAcquired,this.startAudio).on(qe.ChatMessage,this.onLocalChatMessageSent).on(qe.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,t,i){if(this.state===nn.Connecting||this.state===nn.Reconnecting){const u=()=>{this.onTrackAdded(e,t,i),d()},d=()=>{this.off(Ce.Reconnected,u),this.off(Ce.Connected,u),this.off(Ce.Disconnected,d)};this.once(Ce.Reconnected,u),this.once(Ce.Connected,u),this.once(Ce.Disconnected,d);return}if(this.state===nn.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}const s=pI(t.id),r=s[0];let a=s[1],o=e.id;if(a&&a.startsWith("TR")&&(o=a),r===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const l=Array.from(this.remoteParticipants.values()).find(u=>u.sid===r);if(!l){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(r),this.logContext);return}let c;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?c=this.options.adaptiveStream:c={}),l.addSubscribedMediaTrack(e,o,t,i,c)}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=arguments.length>1?arguments[1]:void 0;var i;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==nn.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(s=>{s.trackPublications.forEach(r=>{s.unpublishTrack(r.trackSid)})}),this.localParticipant.trackPublications.forEach(s=>{var r,a,o;s.track&&this.localParticipant.unpublishTrack(s.track,e),e?((r=s.track)===null||r===void 0||r.detach(),(a=s.track)===null||a===void 0||a.stop()):(o=s.track)===null||o===void 0||o.stopMonitor()}),this.localParticipant.off(qe.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(qe.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(qe.AttributesChanged,this.onLocalAttributesChanged).off(qe.TrackMuted,this.onLocalTrackMuted).off(qe.TrackUnmuted,this.onLocalTrackUnmuted).off(qe.LocalTrackPublished,this.onLocalTrackPublished).off(qe.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(qe.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(qe.MediaDevicesError,this.onMediaDevicesError).off(qe.AudioStreamAcquired,this.startAudio).off(qe.ChatMessage,this.onLocalChatMessageSent).off(qe.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),xi()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(i=navigator.mediaDevices)===null||i===void 0||i.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(nn.Disconnected),this.emit(Ce.Disconnected,t)}}}handleParticipantDisconnected(e,t){var i;this.remoteParticipants.delete(e),t&&(t.trackPublications.forEach(s=>{t.unpublishTrack(s.trackSid,!0)}),this.emit(Ce.ParticipantDisconnected,t),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(t.identity))}handleStreamHeader(e,t){return G(this,void 0,void 0,function*(){var i;if(e.contentHeader.case==="byteHeader"){const s=this.byteStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let r;const a={id:e.streamId,name:(i=e.contentHeader.value.name)!==null&&i!==void 0?i:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Tu(e.timestamp),attributes:e.attributes},o=new ReadableStream({start:l=>{r=l,this.byteStreamControllers.set(e.streamId,{info:a,controller:r,startTime:Date.now()})}});s(new dP(a,o,Tu(e.totalLength)),{identity:t})}else if(e.contentHeader.case==="textHeader"){const s=this.textStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let r;const a={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes},o=new ReadableStream({start:l=>{r=l,this.textStreamControllers.set(e.streamId,{info:a,controller:r,startTime:Date.now()})}});s(new hP(a,o,Tu(e.totalLength)),{identity:t})}})}handleStreamChunk(e){const t=this.byteStreamControllers.get(e.streamId);t&&e.content.length>0&&t.controller.enqueue(e);const i=this.textStreamControllers.get(e.streamId);i&&e.content.length>0&&i.controller.enqueue(e)}handleStreamTrailer(e){const t=this.textStreamControllers.get(e.streamId);t&&(t.info.attributes=Object.assign(Object.assign({},t.info.attributes),e.attributes),t.controller.close(),this.byteStreamControllers.delete(e.streamId));const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.byteStreamControllers.delete(e.streamId))}acquireAudioContext(){return G(this,void 0,void 0,function*(){var e,t;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=hS())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(s=>s.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Ii(200)])}catch(s){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:s}))}const i=((t=this.audioContext)===null||t===void 0?void 0:t.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(Ce.AudioPlaybackStatusChanged,i))})}createParticipant(e,t){var i;let s;return t?s=Qu.fromParticipantInfo(this.engine.client,t,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):s=new Qu(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&s.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&s.setAudioOutput(this.options.audioOutput).catch(r=>this.log.warn("Could not set audio output: ".concat(r.message),this.logContext)),s}getOrCreateParticipant(e,t){if(this.remoteParticipants.has(e)){const s=this.remoteParticipants.get(e);return t&&s.updateInfo(t)&&this.sidToIdentity.set(t.sid,t.identity),s}const i=this.createParticipant(e,t);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(t.sid,t.identity),this.emitWhenConnected(Ce.ParticipantConnected,i),i.on(qe.TrackPublished,s=>{this.emitWhenConnected(Ce.TrackPublished,s,i)}).on(qe.TrackSubscribed,(s,r)=>{s.kind===xe.Kind.Audio?(s.on(Ve.AudioPlaybackStarted,this.handleAudioPlaybackStarted),s.on(Ve.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):s.kind===xe.Kind.Video&&(s.on(Ve.VideoPlaybackFailed,this.handleVideoPlaybackFailed),s.on(Ve.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(Ce.TrackSubscribed,s,r,i)}).on(qe.TrackUnpublished,s=>{this.emit(Ce.TrackUnpublished,s,i)}).on(qe.TrackUnsubscribed,(s,r)=>{this.emit(Ce.TrackUnsubscribed,s,r,i)}).on(qe.TrackMuted,s=>{this.emitWhenConnected(Ce.TrackMuted,s,i)}).on(qe.TrackUnmuted,s=>{this.emitWhenConnected(Ce.TrackUnmuted,s,i)}).on(qe.ParticipantMetadataChanged,s=>{this.emitWhenConnected(Ce.ParticipantMetadataChanged,s,i)}).on(qe.ParticipantNameChanged,s=>{this.emitWhenConnected(Ce.ParticipantNameChanged,s,i)}).on(qe.AttributesChanged,s=>{this.emitWhenConnected(Ce.ParticipantAttributesChanged,s,i)}).on(qe.ConnectionQualityChanged,s=>{this.emitWhenConnected(Ce.ConnectionQualityChanged,s,i)}).on(qe.ParticipantPermissionsChanged,s=>{this.emitWhenConnected(Ce.ParticipantPermissionsChanged,s,i)}).on(qe.TrackSubscriptionStatusChanged,(s,r)=>{this.emitWhenConnected(Ce.TrackSubscriptionStatusChanged,s,r,i)}).on(qe.TrackSubscriptionFailed,(s,r)=>{this.emit(Ce.TrackSubscriptionFailed,s,i,r)}).on(qe.TrackSubscriptionPermissionChanged,(s,r)=>{this.emitWhenConnected(Ce.TrackSubscriptionPermissionChanged,s,r,i)}),t&&i.updateInfo(t),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,s)=>(i.push(...s.getTrackPublications()),i),[]),t=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,t)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const t of e.videoTrackPublications.values())t.isSubscribed&&RI(t)&&t.emitTrackUpdate()}getRemoteParticipantBySid(e){const t=this.sidToIdentity.get(e);if(t)return this.remoteParticipants.get(t)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=ui.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Kn.STATE_MISMATCH))):e=0},SP)}clearConnectionReconcile(){this.connectionReconcileInterval&&ui.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(Ce.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[t,i]=e;this.emit(t,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];if(this.state===nn.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===nn.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return G(this,void 0,void 0,function*(){var t,i;const s=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),r=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new og({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:xn.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new qc({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(Ce.SignalConnected),this.emit(Ce.Connected),this.setAndEmitConnectionState(nn.Connected),s.video){const a=new Wp(xe.Kind.Video,new fo({source:pi.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:ps.AUDIO,name:"video-dummy"}),new Ju(s.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:H_(160*((t=r.aspectRatios[0])!==null&&t!==void 0?t:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(a),this.localParticipant.emit(qe.LocalTrackPublished,a)}if(s.audio){const a=new Wp(xe.Kind.Audio,new fo({source:pi.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:ps.AUDIO}),new Yu(s.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:Yh(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(a),this.localParticipant.emit(qe.LocalTrackPublished,a)}for(let a=0;a<r.count-1;a+=1){let o=new qc({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(a),state:fp.ACTIVE,tracks:[],joinedAt:xn.parse(Date.now())});const l=this.getOrCreateParticipant(o.identity,o);if(r.video){const c=H_(160*((i=r.aspectRatios[a%r.aspectRatios.length])!==null&&i!==void 0?i:1),160,!1,!0),u=new fo({source:pi.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:ps.AUDIO});l.addSubscribedMediaTrack(c,u.sid,new MediaStream([c]),new RTCRtpReceiver),o.tracks=[...o.tracks,u]}if(r.audio){const c=Yh(),u=new fo({source:pi.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:ps.AUDIO});l.addSubscribedMediaTrack(c,u.sid,new MediaStream([c]),new RTCRtpReceiver),o.tracks=[...o.tracks,u]}l.updateInfo(o)}})}emit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];if(e!==Ce.ActiveSpeakersChanged){const r=ES(i).filter(a=>a!==void 0);this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:r}))}return super.emit(e,...i)}};Ag.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(n=>{n()});function ES(n){return n.map(e=>{if(e)return Array.isArray(e)?ES(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var us;(function(n){n[n.IDLE=0]="IDLE",n[n.RUNNING=1]="RUNNING",n[n.SKIPPED=2]="SKIPPED",n[n.SUCCESS=3]="SUCCESS",n[n.FAILED=4]="FAILED"})(us||(us={}));class ea extends Fs.EventEmitter{constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=us.IDLE,this.logs=[],this.options={},this.url=e,this.token=t,this.name=this.constructor.name,this.room=new Ag(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return G(this,void 0,void 0,function*(){if(this.status!==us.IDLE)throw Error("check is running already");this.setStatus(us.RUNNING);try{yield this.perform()}catch(t){t instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(t.message):this.appendError(t.message))}return yield this.disconnect(),yield new Promise(t=>setTimeout(t,500)),this.status!==us.SKIPPED&&this.setStatus(this.isSuccess()?us.SUCCESS:us.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return G(this,void 0,void 0,function*(){return this.room.state===nn.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return G(this,void 0,void 0,function*(){this.room&&this.room.state!==nn.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(us.SKIPPED)}switchProtocol(e){return G(this,void 0,void 0,function*(){let t=!1,i=!1;if(this.room.on(Ce.Reconnecting,()=>{t=!0}),this.room.once(Ce.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(r=>setTimeout(r,1e3)),!t)return;const s=Date.now()+1e4;for(;Date.now()<s;){if(i)return;yield Ii(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class EP extends ea{get description(){return"Cloud regions"}perform(){return G(this,void 0,void 0,function*(){const e=new zp(this.url,this.token);if(!e.isCloud()){this.skip();return}const t=[],i=new Set;for(let r=0;r<3;r++){const a=yield e.getNextBestRegionUrl();if(!a)break;if(i.has(a))continue;i.add(a);const o=yield this.checkCloudRegion(a);this.appendMessage("".concat(o.region," RTT: ").concat(o.rtt,"ms, duration: ").concat(o.duration,"ms")),t.push(o)}t.sort((r,a)=>(r.duration-a.duration)*.5+(r.rtt-a.rtt)*.5);const s=t[0];this.bestStats=s,this.appendMessage("best Cloud region: ".concat(s.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return G(this,void 0,void 0,function*(){var t,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const s=(t=this.room.serverInfo)===null||t===void 0?void 0:t.region;if(!s)throw new Error("Region not found");const r=yield this.room.localParticipant.streamText({topic:"test"}),a=1e3,l=1e6/a,c="A".repeat(a),u=Date.now();for(let g=0;g<l;g++)yield r.write(c);yield r.close();const d=Date.now(),h=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),f={region:s,rtt:1e4,duration:d-u};return h==null||h.forEach(g=>{g.type==="candidate-pair"&&g.nominated&&(f.rtt=g.currentRoundTripTime*1e3)}),yield this.disconnect(),f})}}const rf=1e4;class AP extends ea{get description(){return"Connection via UDP vs TCP"}perform(){return G(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),t=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-t.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-t.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=t):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(rf/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(rf/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return G(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const t=document.createElement("canvas");t.width=1280,t.height=720;const i=t.getContext("2d");if(!i)throw new Error("Could not get canvas context");let s=0;const r=()=>{s=(s+1)%360,i.fillStyle="hsl(".concat(s,", 100%, 50%)"),i.fillRect(0,0,t.width,t.height),requestAnimationFrame(r)};r();const o=t.captureStream(30).getVideoTracks()[0],c=(yield this.room.localParticipant.publishTrack(o,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,u={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},d=setInterval(()=>G(this,void 0,void 0,function*(){const h=yield c.getRTCStatsReport();h==null||h.forEach(f=>{f.type==="outbound-rtp"?(u.packetsSent=f.packetsSent,u.qualityLimitationDurations=f.qualityLimitationDurations,u.bitrateTotal+=f.targetBitrate,u.count++):f.type==="remote-inbound-rtp"&&(u.packetsLost=f.packetsLost,u.rttTotal+=f.roundTripTime,u.jitterTotal+=f.jitter)})}),1e3);return yield new Promise(h=>setTimeout(h,rf)),clearInterval(d),o.stop(),t.remove(),yield this.disconnect(),u})}}function AS(n){return G(this,void 0,void 0,function*(){var e,t;n??(n={}),(e=n.audio)!==null&&e!==void 0||(n.audio={deviceId:"default"}),(t=n.video)!==null&&t!==void 0||(n.video={deviceId:"default"});const{audioProcessor:i,videoProcessor:s}=_g(n),r=uS(n,fS,pS),a=Td(r),o=navigator.mediaDevices.getUserMedia(a);n.audio&&(ei.userMediaPromiseMap.set("audioinput",o),o.catch(()=>ei.userMediaPromiseMap.delete("audioinput"))),n.video&&(ei.userMediaPromiseMap.set("videoinput",o),o.catch(()=>ei.userMediaPromiseMap.delete("videoinput")));const l=yield o;return Promise.all(l.getTracks().map(c=>G(this,void 0,void 0,function*(){const u=c.kind==="audio";u?r.audio:r.video;let d;const h=u?a.audio:a.video;typeof h!="boolean"&&(d=h);const f=c.getSettings().deviceId;d!=null&&d.deviceId&&jr(d.deviceId)!==f?d.deviceId=f:d||(d={deviceId:f});const g=_S(c,d);return g.kind===xe.Kind.Video?g.source=xe.Source.Camera:g.kind===xe.Kind.Audio&&(g.source=xe.Source.Microphone),g.mediaStream=l,fr(g)&&i?yield g.setProcessor(i):Jo(g)&&s&&(yield g.setProcessor(s)),g})))})}function CP(n){return G(this,void 0,void 0,function*(){return(yield AS({audio:!1,video:n}))[0]})}function wP(n){return G(this,void 0,void 0,function*(){return(yield AS({audio:n,video:!1}))[0]})}class RP extends ea{get description(){return"Can publish audio"}perform(){return G(this,void 0,void 0,function*(){var e;const t=yield this.connect(),i=yield wP();if(yield dS(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),t.localParticipant.publishTrack(i),yield new Promise(o=>setTimeout(o,3e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let a=0;if(r.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="audio"||!o.kind&&o.mediaType==="audio")&&(a=o.packetsSent)}),a===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(a," audio packets"))})}}class kP extends ea{get description(){return"Can publish video"}perform(){return G(this,void 0,void 0,function*(){var e;const t=yield this.connect(),i=yield CP();yield this.checkForVideo(i.mediaStreamTrack),t.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,5e3));const s=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!s)throw new Error("Could not get RTCStats");let r=0;if(s.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="video"||!a.kind&&a.mediaType==="video")&&(r+=a.packetsSent)}),r===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(r," video packets"))})}checkForVideo(e){return G(this,void 0,void 0,function*(){const t=new MediaStream;t.addTrack(e.clone());const i=document.createElement("video");i.srcObject=t,i.muted=!0,yield new Promise(s=>{i.onplay=()=>{setTimeout(()=>{var r,a,o,l;const c=document.createElement("canvas"),u=e.getSettings(),d=(a=(r=u.width)!==null&&r!==void 0?r:i.videoWidth)!==null&&a!==void 0?a:1280,h=(l=(o=u.height)!==null&&o!==void 0?o:i.videoHeight)!==null&&l!==void 0?l:720;c.width=d,c.height=h;const f=c.getContext("2d");f.drawImage(i,0,0);const v=f.getImageData(0,0,c.width,c.height).data;let m=!0;for(let _=0;_<v.length;_+=4)if(v[_]!==0||v[_+1]!==0||v[_+2]!==0){m=!1;break}m?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),s()},1e3)},i.play()}),i.remove()})}}class MP extends ea{get description(){return"Resuming connection after interruption"}perform(){return G(this,void 0,void 0,function*(){var e;const t=yield this.connect();let i=!1,s=!1,r;const a=new Promise(c=>{setTimeout(c,5e3),r=c}),o=()=>{i=!0};t.on(Ce.SignalReconnecting,o).on(Ce.Reconnecting,o).on(Ce.Reconnected,()=>{s=!0,r(!0)}),(e=t.engine.client.ws)===null||e===void 0||e.close();const l=t.engine.client.onClose;if(l&&l(""),yield a,i){if(!s||t.state!==nn.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class xP extends ea{get description(){return"Can connect via TURN"}perform(){return G(this,void 0,void 0,function*(){var e,t;const i=new vg,s=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let r=!1,a=!1,o=!1;for(let l of s.iceServers)for(let c of l.urls)c.startsWith("turn:")?(a=!0,o=!0):c.startsWith("turns:")&&(a=!0,o=!0,r=!0),c.startsWith("stun:")&&(o=!0);o?a&&!r&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield i.close(),!((t=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||t===void 0)&&t.iceServers||a?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(l=>setTimeout(l,0)))})}}class IP extends ea{get description(){return"Establishing WebRTC connection"}perform(){return G(this,void 0,void 0,function*(){let e=!1,t=!1;this.room.on(Ce.SignalConnected,()=>{const i=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(s,r)=>{if(s.candidate){const a=new RTCIceCandidate(s);let o="".concat(a.protocol," ").concat(a.address,":").concat(a.port," ").concat(a.type);a.address&&(PP(a.address)?o+=" (private)":a.protocol==="tcp"&&a.tcpType==="passive"?(e=!0,o+=" (passive)"):a.protocol==="udp"&&(t=!0)),this.appendMessage(o)}i&&i(s,r)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=s=>{s instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(s.errorCode," ").concat(s.errorText," ").concat(s.url))})});try{yield this.connect(),Ht.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),t||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function PP(n){const e=n.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const t=parseInt(e[1],10);if(t>=16&&t<=31)return!0}}return!1}class NP extends ea{get description(){return"Connecting to signal connection via WebSocket"}perform(){return G(this,void 0,void 0,function*(){var e,t,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let s=new vg;const r=yield s.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(r.serverVersion,".")),((e=r.serverInfo)===null||e===void 0?void 0:e.edition)===hT.Cloud&&(!((t=r.serverInfo)===null||t===void 0)&&t.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=r.serverInfo)===null||i===void 0?void 0:i.region)),yield s.close()})}}let FV=class extends Fs.EventEmitter{constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=t,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:us.IDLE,name:"",description:""}),e}updateCheck(e,t){this.checkResults.set(e,t),this.emit("checkUpdate",e,t)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==us.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return G(this,void 0,void 0,function*(){const t=this.getNextCheckId(),i=new e(this.url,this.token,this.options),s=a=>{this.updateCheck(t,a)};i.on("update",s);const r=yield i.run();return i.off("update",s),r})}checkWebsocket(){return G(this,void 0,void 0,function*(){return this.createAndRunCheck(NP)})}checkWebRTC(){return G(this,void 0,void 0,function*(){return this.createAndRunCheck(IP)})}checkTURN(){return G(this,void 0,void 0,function*(){return this.createAndRunCheck(xP)})}checkReconnect(){return G(this,void 0,void 0,function*(){return this.createAndRunCheck(MP)})}checkPublishAudio(){return G(this,void 0,void 0,function*(){return this.createAndRunCheck(RP)})}checkPublishVideo(){return G(this,void 0,void 0,function*(){return this.createAndRunCheck(kP)})}checkConnectionProtocol(){return G(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(AP);if(e.data&&"protocol"in e.data){const t=e.data;this.options.protocol=t.protocol}return e})}checkCloudRegion(){return G(this,void 0,void 0,function*(){return this.createAndRunCheck(EP)})}};var Pr=(n=>(n[n.MAV_MODE_FLAG_SAFETY_ARMED=128]="MAV_MODE_FLAG_SAFETY_ARMED",n[n.MAV_MODE_FLAG_MANUAL_INPUT_ENABLED=64]="MAV_MODE_FLAG_MANUAL_INPUT_ENABLED",n[n.MAV_MODE_FLAG_HIL_ENABLED=32]="MAV_MODE_FLAG_HIL_ENABLED",n[n.MAV_MODE_FLAG_STABILIZE_ENABLED=16]="MAV_MODE_FLAG_STABILIZE_ENABLED",n[n.MAV_MODE_FLAG_GUIDED_ENABLED=8]="MAV_MODE_FLAG_GUIDED_ENABLED",n[n.MAV_MODE_FLAG_AUTO_ENABLED=4]="MAV_MODE_FLAG_AUTO_ENABLED",n[n.MAV_MODE_FLAG_TEST_ENABLED=2]="MAV_MODE_FLAG_TEST_ENABLED",n[n.MAV_MODE_FLAG_CUSTOM_MODE_ENABLED=1]="MAV_MODE_FLAG_CUSTOM_MODE_ENABLED",n))(Pr||{}),Yi=(n=>(n.MAV_STATE_UNINIT="MAV_STATE_UNINIT",n.MAV_STATE_BOOT="MAV_STATE_BOOT",n.MAV_STATE_CALIBRATING="MAV_STATE_CALIBRATING",n.MAV_STATE_STANDBY="MAV_STATE_STANDBY",n.MAV_STATE_ACTIVE="MAV_STATE_ACTIVE",n.MAV_STATE_CRITICAL="MAV_STATE_CRITICAL",n.MAV_STATE_EMERGENCY="MAV_STATE_EMERGENCY",n.MAV_STATE_POWEROFF="MAV_STATE_POWEROFF",n.MAV_STATE_FLIGHT_TERMINATION="MAV_STATE_FLIGHT_TERMINATION",n))(Yi||{}),Qs=(n=>(n.MAV_SEVERITY_EMERGENCY="MAV_SEVERITY_EMERGENCY",n.MAV_SEVERITY_ALERT="MAV_SEVERITY_ALERT",n.MAV_SEVERITY_CRITICAL="MAV_SEVERITY_CRITICAL",n.MAV_SEVERITY_ERROR="MAV_SEVERITY_ERROR",n.MAV_SEVERITY_WARNING="MAV_SEVERITY_WARNING",n.MAV_SEVERITY_NOTICE="MAV_SEVERITY_NOTICE",n.MAV_SEVERITY_INFO="MAV_SEVERITY_INFO",n.MAV_SEVERITY_DEBUG="MAV_SEVERITY_DEBUG",n))(Qs||{}),Nr=(n=>(n.ACTUATOR_CONTROL_TARGET="ACTUATOR_CONTROL_TARGET",n.ACTUATOR_OUTPUT_STATUS="ACTUATOR_OUTPUT_STATUS",n.ADAP_TUNING="ADAP_TUNING",n.ADSB_VEHICLE="ADSB_VEHICLE",n.AHRS="AHRS",n.AHRS2="AHRS2",n.AHRS3="AHRS3",n.AIRSPEED_AUTOCAL="AIRSPEED_AUTOCAL",n.AIS_VESSEL="AIS_VESSEL",n.ALTITUDE="ALTITUDE",n.AOA_SSA="AOA_SSA",n.AP_ADC="AP_ADC",n.ATT_POS_MOCAP="ATT_POS_MOCAP",n.ATTITUDE="ATTITUDE",n.ATTITUDE_QUATERNION="ATTITUDE_QUATERNION",n.ATTITUDE_QUATERNION_COV="ATTITUDE_QUATERNION_COV",n.ATTITUDE_TARGET="ATTITUDE_TARGET",n.AUTH_KEY="AUTH_KEY",n.AUTOPILOT_STATE_FOR_GIMBAL_DEVICE="AUTOPILOT_STATE_FOR_GIMBAL_DEVICE",n.AUTOPILOT_VERSION="AUTOPILOT_VERSION",n.AUTOPILOT_VERSION_REQUEST="AUTOPILOT_VERSION_REQUEST",n.BATTERY_STATUS="BATTERY_STATUS",n.BATTERY2="BATTERY2",n.BUTTON_CHANGE="BUTTON_CHANGE",n.CAMERA_CAPTURE_STATUS="CAMERA_CAPTURE_STATUS",n.CAMERA_FEEDBACK="CAMERA_FEEDBACK",n.CAMERA_IMAGE_CAPTURED="CAMERA_IMAGE_CAPTURED",n.CAMERA_INFORMATION="CAMERA_INFORMATION",n.CAMERA_SETTINGS="CAMERA_SETTINGS",n.CAMERA_STATUS="CAMERA_STATUS",n.CAMERA_TRIGGER="CAMERA_TRIGGER",n.CELLULAR_CONFIG="CELLULAR_CONFIG",n.CELLULAR_STATUS="CELLULAR_STATUS",n.CHANGE_OPERATOR_CONTROL="CHANGE_OPERATOR_CONTROL",n.CHANGE_OPERATOR_CONTROL_ACK="CHANGE_OPERATOR_CONTROL_ACK",n.COLLISION="COLLISION",n.COMMAND_ACK="COMMAND_ACK",n.COMMAND_CANCEL="COMMAND_CANCEL",n.COMMAND_INT="COMMAND_INT",n.COMMAND_LONG="COMMAND_LONG",n.COMPASSMOT_STATUS="COMPASSMOT_STATUS",n.COMPONENT_INFORMATION="COMPONENT_INFORMATION",n.CONTROL_SYSTEM_STATE="CONTROL_SYSTEM_STATE",n.DATA_STREAM="DATA_STREAM",n.DATA_TRANSMISSION_HANDSHAKE="DATA_TRANSMISSION_HANDSHAKE",n.DATA16="DATA16",n.DATA32="DATA32",n.DATA64="DATA64",n.DATA96="DATA96",n.DEBUG="DEBUG",n.DEBUG_FLOAT_ARRAY="DEBUG_FLOAT_ARRAY",n.DEBUG_VECT="DEBUG_VECT",n.DEEPSTALL="DEEPSTALL",n.DEVICE_OP_READ="DEVICE_OP_READ",n.DEVICE_OP_READ_REPLY="DEVICE_OP_READ_REPLY",n.DEVICE_OP_WRITE="DEVICE_OP_WRITE",n.DEVICE_OP_WRITE_REPLY="DEVICE_OP_WRITE_REPLY",n.DIGICAM_CONFIGURE="DIGICAM_CONFIGURE",n.DIGICAM_CONTROL="DIGICAM_CONTROL",n.DISTANCE_SENSOR="DISTANCE_SENSOR",n.EFI_STATUS="EFI_STATUS",n.EKF_STATUS_REPORT="EKF_STATUS_REPORT",n.ENCAPSULATED_DATA="ENCAPSULATED_DATA",n.ESC_TELEMETRY_1_TO_4="ESC_TELEMETRY_1_TO_4",n.ESC_TELEMETRY_5_TO_8="ESC_TELEMETRY_5_TO_8",n.ESC_TELEMETRY_9_TO_12="ESC_TELEMETRY_9_TO_12",n.ESTIMATOR_STATUS="ESTIMATOR_STATUS",n.EXTENDED_SYS_STATE="EXTENDED_SYS_STATE",n.FENCE_FETCH_POINT="FENCE_FETCH_POINT",n.FENCE_POINT="FENCE_POINT",n.FENCE_STATUS="FENCE_STATUS",n.FILE_TRANSFER_PROTOCOL="FILE_TRANSFER_PROTOCOL",n.FLIGHT_INFORMATION="FLIGHT_INFORMATION",n.FOLLOW_TARGET="FOLLOW_TARGET",n.GENERATOR_STATUS="GENERATOR_STATUS",n.GIMBAL_CONTROL="GIMBAL_CONTROL",n.GIMBAL_DEVICE_ATTITUDE_STATUS="GIMBAL_DEVICE_ATTITUDE_STATUS",n.GIMBAL_DEVICE_INFORMATION="GIMBAL_DEVICE_INFORMATION",n.GIMBAL_DEVICE_SET_ATTITUDE="GIMBAL_DEVICE_SET_ATTITUDE",n.GIMBAL_MANAGER_INFORMATION="GIMBAL_MANAGER_INFORMATION",n.GIMBAL_MANAGER_SET_ATTITUDE="GIMBAL_MANAGER_SET_ATTITUDE",n.GIMBAL_MANAGER_SET_TILTPAN="GIMBAL_MANAGER_SET_TILTPAN",n.GIMBAL_MANAGER_STATUS="GIMBAL_MANAGER_STATUS",n.GIMBAL_REPORT="GIMBAL_REPORT",n.GIMBAL_TORQUE_CMD_REPORT="GIMBAL_TORQUE_CMD_REPORT",n.GLOBAL_POSITION_INT="GLOBAL_POSITION_INT",n.GLOBAL_POSITION_INT_COV="GLOBAL_POSITION_INT_COV",n.GLOBAL_VISION_POSITION_ESTIMATE="GLOBAL_VISION_POSITION_ESTIMATE",n.GOPRO_GET_REQUEST="GOPRO_GET_REQUEST",n.GOPRO_GET_RESPONSE="GOPRO_GET_RESPONSE",n.GOPRO_HEARTBEAT="GOPRO_HEARTBEAT",n.GOPRO_SET_REQUEST="GOPRO_SET_REQUEST",n.GOPRO_SET_RESPONSE="GOPRO_SET_RESPONSE",n.GPS_GLOBAL_ORIGIN="GPS_GLOBAL_ORIGIN",n.GPS_INJECT_DATA="GPS_INJECT_DATA",n.GPS_INPUT="GPS_INPUT",n.GPS_RAW_INT="GPS_RAW_INT",n.GPS_RTCM_DATA="GPS_RTCM_DATA",n.GPS_RTK="GPS_RTK",n.GPS_STATUS="GPS_STATUS",n.GPS2_RAW="GPS2_RAW",n.GPS2_RTK="GPS2_RTK",n.HEARTBEAT="HEARTBEAT",n.HIGH_LATENCY="HIGH_LATENCY",n.HIGH_LATENCY2="HIGH_LATENCY2",n.HIGHRES_IMU="HIGHRES_IMU",n.HIL_ACTUATOR_CONTROLS="HIL_ACTUATOR_CONTROLS",n.HIL_CONTROLS="HIL_CONTROLS",n.HIL_GPS="HIL_GPS",n.HIL_OPTICAL_FLOW="HIL_OPTICAL_FLOW",n.HIL_RC_INPUTS_RAW="HIL_RC_INPUTS_RAW",n.HIL_SENSOR="HIL_SENSOR",n.HIL_STATE="HIL_STATE",n.HIL_STATE_QUATERNION="HIL_STATE_QUATERNION",n.HOME_POSITION="HOME_POSITION",n.HWSTATUS="HWSTATUS",n.ISBD_LINK_STATUS="ISBD_LINK_STATUS",n.LANDING_TARGET="LANDING_TARGET",n.LED_CONTROL="LED_CONTROL",n.LIMITS_STATUS="LIMITS_STATUS",n.LINK_NODE_STATUS="LINK_NODE_STATUS",n.LOCAL_POSITION_NED="LOCAL_POSITION_NED",n.LOCAL_POSITION_NED_COV="LOCAL_POSITION_NED_COV",n.LOCAL_POSITION_NED_SYSTEM_GLOBAL_OFFSET="LOCAL_POSITION_NED_SYSTEM_GLOBAL_OFFSET",n.LOG_DATA="LOG_DATA",n.LOG_ENTRY="LOG_ENTRY",n.LOG_ERASE="LOG_ERASE",n.LOG_REQUEST_DATA="LOG_REQUEST_DATA",n.LOG_REQUEST_END="LOG_REQUEST_END",n.LOG_REQUEST_LIST="LOG_REQUEST_LIST",n.LOGGING_ACK="LOGGING_ACK",n.LOGGING_DATA="LOGGING_DATA",n.LOGGING_DATA_ACKED="LOGGING_DATA_ACKED",n.MAG_CAL_PROGRESS="MAG_CAL_PROGRESS",n.MAG_CAL_REPORT="MAG_CAL_REPORT",n.MANUAL_CONTROL="MANUAL_CONTROL",n.MANUAL_SETPOINT="MANUAL_SETPOINT",n.MEMINFO="MEMINFO",n.MEMORY_VECT="MEMORY_VECT",n.MESSAGE_INTERVAL="MESSAGE_INTERVAL",n.MISSION_ACK="MISSION_ACK",n.MISSION_CHANGED="MISSION_CHANGED",n.MISSION_CLEAR_ALL="MISSION_CLEAR_ALL",n.MISSION_COUNT="MISSION_COUNT",n.MISSION_CURRENT="MISSION_CURRENT",n.MISSION_ITEM="MISSION_ITEM",n.MISSION_ITEM_INT="MISSION_ITEM_INT",n.MISSION_ITEM_REACHED="MISSION_ITEM_REACHED",n.MISSION_REQUEST="MISSION_REQUEST",n.MISSION_REQUEST_INT="MISSION_REQUEST_INT",n.MISSION_REQUEST_LIST="MISSION_REQUEST_LIST",n.MISSION_REQUEST_PARTIAL_LIST="MISSION_REQUEST_PARTIAL_LIST",n.MISSION_SET_CURRENT="MISSION_SET_CURRENT",n.MISSION_WRITE_PARTIAL_LIST="MISSION_WRITE_PARTIAL_LIST",n.MOUNT_CONFIGURE="MOUNT_CONFIGURE",n.MOUNT_CONTROL="MOUNT_CONTROL",n.MOUNT_ORIENTATION="MOUNT_ORIENTATION",n.MOUNT_STATUS="MOUNT_STATUS",n.NAMED_VALUE_FLOAT="NAMED_VALUE_FLOAT",n.NAMED_VALUE_INT="NAMED_VALUE_INT",n.NAV_CONTROLLER_OUTPUT="NAV_CONTROLLER_OUTPUT",n.OBSTACLE_DISTANCE="OBSTACLE_DISTANCE",n.ODOMETRY="ODOMETRY",n.ONBOARD_COMPUTER_STATUS="ONBOARD_COMPUTER_STATUS",n.OPEN_DRONE_ID_AUTHENTICATION="OPEN_DRONE_ID_AUTHENTICATION",n.OPEN_DRONE_ID_BASIC_ID="OPEN_DRONE_ID_BASIC_ID",n.OPEN_DRONE_ID_LOCATION="OPEN_DRONE_ID_LOCATION",n.OPEN_DRONE_ID_MESSAGE_PACK="OPEN_DRONE_ID_MESSAGE_PACK",n.OPEN_DRONE_ID_OPERATOR_ID="OPEN_DRONE_ID_OPERATOR_ID",n.OPEN_DRONE_ID_SELF_ID="OPEN_DRONE_ID_SELF_ID",n.OPEN_DRONE_ID_SYSTEM="OPEN_DRONE_ID_SYSTEM",n.OPTICAL_FLOW="OPTICAL_FLOW",n.OPTICAL_FLOW_RAD="OPTICAL_FLOW_RAD",n.ORBIT_EXECUTION_STATUS="ORBIT_EXECUTION_STATUS",n.PARAM_EXT_ACK="PARAM_EXT_ACK",n.PARAM_EXT_REQUEST_LIST="PARAM_EXT_REQUEST_LIST",n.PARAM_EXT_REQUEST_READ="PARAM_EXT_REQUEST_READ",n.PARAM_EXT_SET="PARAM_EXT_SET",n.PARAM_EXT_VALUE="PARAM_EXT_VALUE",n.PARAM_MAP_RC="PARAM_MAP_RC",n.PARAM_REQUEST_LIST="PARAM_REQUEST_LIST",n.PARAM_REQUEST_READ="PARAM_REQUEST_READ",n.PARAM_SET="PARAM_SET",n.PARAM_VALUE="PARAM_VALUE",n.PID_TUNING="PID_TUNING",n.PING="PING",n.PLAY_TUNE="PLAY_TUNE",n.PLAY_TUNE_V2="PLAY_TUNE_V2",n.POSITION_TARGET_GLOBAL_INT="POSITION_TARGET_GLOBAL_INT",n.POSITION_TARGET_LOCAL_NED="POSITION_TARGET_LOCAL_NED",n.POWER_STATUS="POWER_STATUS",n.PROTOCOL_VERSION="PROTOCOL_VERSION",n.RADIO="RADIO",n.RADIO_STATUS="RADIO_STATUS",n.RALLY_FETCH_POINT="RALLY_FETCH_POINT",n.RALLY_POINT="RALLY_POINT",n.RANGEFINDER="RANGEFINDER",n.RAW_IMU="RAW_IMU",n.RAW_PRESSURE="RAW_PRESSURE",n.RAW_RPM="RAW_RPM",n.RC_CHANNELS="RC_CHANNELS",n.RC_CHANNELS_OVERRIDE="RC_CHANNELS_OVERRIDE",n.RC_CHANNELS_RAW="RC_CHANNELS_RAW",n.RC_CHANNELS_SCALED="RC_CHANNELS_SCALED",n.REMOTE_LOG_BLOCK_STATUS="REMOTE_LOG_BLOCK_STATUS",n.REMOTE_LOG_DATA_BLOCK="REMOTE_LOG_DATA_BLOCK",n.REQUEST_DATA_STREAM="REQUEST_DATA_STREAM",n.RESOURCE_REQUEST="RESOURCE_REQUEST",n.RPM="RPM",n.SAFETY_ALLOWED_AREA="SAFETY_ALLOWED_AREA",n.SAFETY_SET_ALLOWED_AREA="SAFETY_SET_ALLOWED_AREA",n.SCALED_IMU="SCALED_IMU",n.SCALED_IMU2="SCALED_IMU2",n.SCALED_IMU3="SCALED_IMU3",n.SCALED_PRESSURE="SCALED_PRESSURE",n.SCALED_PRESSURE2="SCALED_PRESSURE2",n.SCALED_PRESSURE3="SCALED_PRESSURE3",n.SENSOR_OFFSETS="SENSOR_OFFSETS",n.SERIAL_CONTROL="SERIAL_CONTROL",n.SERVO_OUTPUT_RAW="SERVO_OUTPUT_RAW",n.SET_ACTUATOR_CONTROL_TARGET="SET_ACTUATOR_CONTROL_TARGET",n.SET_ATTITUDE_TARGET="SET_ATTITUDE_TARGET",n.SET_GPS_GLOBAL_ORIGIN="SET_GPS_GLOBAL_ORIGIN",n.SET_HOME_POSITION="SET_HOME_POSITION",n.SET_MAG_OFFSETS="SET_MAG_OFFSETS",n.SET_MODE="SET_MODE",n.SET_POSITION_TARGET_GLOBAL_INT="SET_POSITION_TARGET_GLOBAL_INT",n.SET_POSITION_TARGET_LOCAL_NED="SET_POSITION_TARGET_LOCAL_NED",n.SETUP_SIGNING="SETUP_SIGNING",n.SIM_STATE="SIM_STATE",n.SIMSTATE="SIMSTATE",n.SMART_BATTERY_INFO="SMART_BATTERY_INFO",n.SMART_BATTERY_STATUS="SMART_BATTERY_STATUS",n.STATUSTEXT="STATUSTEXT",n.STORAGE_INFORMATION="STORAGE_INFORMATION",n.SUPPORTED_TUNES="SUPPORTED_TUNES",n.SYS_STATUS="SYS_STATUS",n.SYSTEM_TIME="SYSTEM_TIME",n.TERRAIN_CHECK="TERRAIN_CHECK",n.TERRAIN_DATA="TERRAIN_DATA",n.TERRAIN_REPORT="TERRAIN_REPORT",n.TERRAIN_REQUEST="TERRAIN_REQUEST",n.TIME_ESTIMATE_TO_TARGET="TIME_ESTIMATE_TO_TARGET",n.TIMESYNC="TIMESYNC",n.TRAJECTORY_REPRESENTATION_BEZIER="TRAJECTORY_REPRESENTATION_BEZIER",n.TRAJECTORY_REPRESENTATION_WAYPOINTS="TRAJECTORY_REPRESENTATION_WAYPOINTS",n.TUNNEL="TUNNEL",n.UAVCAN_NODE_INFO="UAVCAN_NODE_INFO",n.UAVCAN_NODE_STATUS="UAVCAN_NODE_STATUS",n.UTM_GLOBAL_POSITION="UTM_GLOBAL_POSITION",n.V2_EXTENSION="V2_EXTENSION",n.VFR_HUD="VFR_HUD",n.VIBRATION="VIBRATION",n.VICON_POSITION_ESTIMATE="VICON_POSITION_ESTIMATE",n.VIDEO_STREAM_INFORMATION="VIDEO_STREAM_INFORMATION",n.VIDEO_STREAM_STATUS="VIDEO_STREAM_STATUS",n.VISION_POSITION_DELTA="VISION_POSITION_DELTA",n.VISION_POSITION_ESTIMATE="VISION_POSITION_ESTIMATE",n.VISION_SPEED_ESTIMATE="VISION_SPEED_ESTIMATE",n.WHEEL_DISTANCE="WHEEL_DISTANCE",n.WIFI_CONFIG_AP="WIFI_CONFIG_AP",n.WIND="WIND",n.WIND_COV="WIND_COV",n))(Nr||{}),Dt=(n=>(n.init="Init",n.connecting="Connecting",n.connected="Connected",n.reconnecting="Reconnecting",n.disconnectedOk="Disconnected",n.failed="Failed",n))(Dt||{});new TextEncoder;const DP=new TextDecoder,LP=n=>DP.decode(n),CS=1013.25;Nr.HEARTBEAT,Nr.ATTITUDE,Nr.SYS_STATUS,Nr.STATUSTEXT,Nr.SCALED_PRESSURE,Nr.SCALED_PRESSURE2,Nr.SCALED_PRESSURE3;const cv={autoSubscribe:!1,maxRetries:6,peerConnectionTimeout:15e3};new fg;const lv={reconnectPolicy:new fg,dynacast:!0,disconnectOnPageLeave:!0,adaptiveStream:!0},OP={trickle:!0,config:{bundlePolicy:"balanced",iceTransportPolicy:"all"},iceRestartEnabled:!1,iceFailureRecoveryTimeout:1e5};function Bn(n,e){if(!n)throw new Error(e)}const UP=34028234663852886e22,FP=-34028234663852886e22,BP=4294967295,VP=2147483647,GP=-2147483648;function Eu(n){if(typeof n!="number")throw new Error("invalid int 32: "+typeof n);if(!Number.isInteger(n)||n>VP||n<GP)throw new Error("invalid int 32: "+n)}function Kp(n){if(typeof n!="number")throw new Error("invalid uint 32: "+typeof n);if(!Number.isInteger(n)||n>BP||n<0)throw new Error("invalid uint 32: "+n)}function wS(n){if(typeof n!="number")throw new Error("invalid float 32: "+typeof n);if(Number.isFinite(n)&&(n>UP||n<FP))throw new Error("invalid float 32: "+n)}const RS=Symbol("@bufbuild/protobuf/enum-type");function zP(n){const e=n[RS];return Bn(e,"missing enum type on enum object"),e}function kS(n,e,t,i){n[RS]=MS(e,t.map(s=>({no:s.no,name:s.name,localName:n[s.no]})))}function MS(n,e,t){const i=Object.create(null),s=Object.create(null),r=[];for(const a of e){const o=xS(a);r.push(o),i[a.name]=o,s[a.no]=o}return{typeName:n,values:r,findName(a){return i[a]},findNumber(a){return s[a]}}}function HP(n,e,t){const i={};for(const s of e){const r=xS(s);i[r.localName]=r.no,i[r.no]=r.localName}return kS(i,n,e),i}function xS(n){return"localName"in n?n:Object.assign(Object.assign({},n),{localName:n.name})}class IS{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const i=this.getType(),s=i.runtime.bin,r=s.makeReadOptions(t);return s.readMessage(this,r.readerFactory(e),e.byteLength,r),this}fromJson(e,t){const i=this.getType(),s=i.runtime.json,r=s.makeReadOptions(t);return s.readMessage(i,e,r,this),this}fromJsonString(e,t){let i;try{i=JSON.parse(e)}catch(s){throw new Error(`cannot decode ${this.getType().typeName} from JSON: ${s instanceof Error?s.message:String(s)}`)}return this.fromJson(i,t)}toBinary(e){const t=this.getType(),i=t.runtime.bin,s=i.makeWriteOptions(e),r=s.writerFactory();return i.writeMessage(this,r,s),r.finish()}toJson(e){const t=this.getType(),i=t.runtime.json,s=i.makeWriteOptions(e);return i.writeMessage(this,s)}toJsonString(e){var t;const i=this.toJson(e);return JSON.stringify(i,null,(t=e==null?void 0:e.prettySpaces)!==null&&t!==void 0?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function WP(n,e,t,i){var s;const r=(s=i==null?void 0:i.localName)!==null&&s!==void 0?s:e.substring(e.lastIndexOf(".")+1),a={[r]:function(o){n.util.initFields(this),n.util.initPartial(o,this)}}[r];return Object.setPrototypeOf(a.prototype,new IS),Object.assign(a,{runtime:n,typeName:e,fields:n.util.newFieldList(t),fromBinary(o,l){return new a().fromBinary(o,l)},fromJson(o,l){return new a().fromJson(o,l)},fromJsonString(o,l){return new a().fromJsonString(o,l)},equals(o,l){return n.util.equals(a,o,l)}}),a}function jP(){let n=0,e=0;for(let i=0;i<28;i+=7){let s=this.buf[this.pos++];if(n|=(s&127)<<i,!(s&128))return this.assertBounds(),[n,e]}let t=this.buf[this.pos++];if(n|=(t&15)<<28,e=(t&112)>>4,!(t&128))return this.assertBounds(),[n,e];for(let i=3;i<=31;i+=7){let s=this.buf[this.pos++];if(e|=(s&127)<<i,!(s&128))return this.assertBounds(),[n,e]}throw new Error("invalid varint")}function af(n,e,t){for(let r=0;r<28;r=r+7){const a=n>>>r,o=!(!(a>>>7)&&e==0),l=(o?a|128:a)&255;if(t.push(l),!o)return}const i=n>>>28&15|(e&7)<<4,s=!!(e>>3);if(t.push((s?i|128:i)&255),!!s){for(let r=3;r<31;r=r+7){const a=e>>>r,o=!!(a>>>7),l=(o?a|128:a)&255;if(t.push(l),!o)return}t.push(e>>>31&1)}}const Au=4294967296;function uv(n){const e=n[0]==="-";e&&(n=n.slice(1));const t=1e6;let i=0,s=0;function r(a,o){const l=Number(n.slice(a,o));s*=t,i=i*t+l,i>=Au&&(s=s+(i/Au|0),i=i%Au)}return r(-24,-18),r(-18,-12),r(-12,-6),r(-6),e?NS(i,s):Cg(i,s)}function KP(n,e){let t=Cg(n,e);const i=t.hi&2147483648;i&&(t=NS(t.lo,t.hi));const s=PS(t.lo,t.hi);return i?"-"+s:s}function PS(n,e){if({lo:n,hi:e}=qP(n,e),e<=2097151)return String(Au*e+n);const t=n&16777215,i=(n>>>24|e<<8)&16777215,s=e>>16&65535;let r=t+i*6777216+s*6710656,a=i+s*8147497,o=s*2;const l=1e7;return r>=l&&(a+=Math.floor(r/l),r%=l),a>=l&&(o+=Math.floor(a/l),a%=l),o.toString()+dv(a)+dv(r)}function qP(n,e){return{lo:n>>>0,hi:e>>>0}}function Cg(n,e){return{lo:n|0,hi:e|0}}function NS(n,e){return e=~e,n?n=~n+1:e+=1,Cg(n,e)}const dv=n=>{const e=String(n);return"0000000".slice(e.length)+e};function hv(n,e){if(n>=0){for(;n>127;)e.push(n&127|128),n=n>>>7;e.push(n)}else{for(let t=0;t<9;t++)e.push(n&127|128),n=n>>7;e.push(1)}}function XP(){let n=this.buf[this.pos++],e=n&127;if(!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<7,!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<14,!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<21,!(n&128))return this.assertBounds(),e;n=this.buf[this.pos++],e|=(n&15)<<28;for(let t=5;n&128&&t<10;t++)n=this.buf[this.pos++];if(n&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}var fv={};function YP(){const n=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"&&(typeof process!="object"||typeof fv!="object"||fv.BUF_BIGINT_DISABLE!=="1")){const s=BigInt("-9223372036854775808"),r=BigInt("9223372036854775807"),a=BigInt("0"),o=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(l){const c=typeof l=="bigint"?l:BigInt(l);if(c>r||c<s)throw new Error(`int64 invalid: ${l}`);return c},uParse(l){const c=typeof l=="bigint"?l:BigInt(l);if(c>o||c<a)throw new Error(`uint64 invalid: ${l}`);return c},enc(l){return n.setBigInt64(0,this.parse(l),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},uEnc(l){return n.setBigInt64(0,this.uParse(l),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},dec(l,c){return n.setInt32(0,l,!0),n.setInt32(4,c,!0),n.getBigInt64(0,!0)},uDec(l,c){return n.setInt32(0,l,!0),n.setInt32(4,c,!0),n.getBigUint64(0,!0)}}}const t=s=>Bn(/^-?[0-9]+$/.test(s),`int64 invalid: ${s}`),i=s=>Bn(/^[0-9]+$/.test(s),`uint64 invalid: ${s}`);return{zero:"0",supported:!1,parse(s){return typeof s!="string"&&(s=s.toString()),t(s),s},uParse(s){return typeof s!="string"&&(s=s.toString()),i(s),s},enc(s){return typeof s!="string"&&(s=s.toString()),t(s),uv(s)},uEnc(s){return typeof s!="string"&&(s=s.toString()),i(s),uv(s)},dec(s,r){return KP(s,r)},uDec(s,r){return PS(s,r)}}}const Vi=YP();var ke;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(ke||(ke={}));var Zr;(function(n){n[n.BIGINT=0]="BIGINT",n[n.STRING=1]="STRING"})(Zr||(Zr={}));function Sr(n,e,t){if(e===t)return!0;if(n==ke.BYTES){if(!(e instanceof Uint8Array)||!(t instanceof Uint8Array)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}switch(n){case ke.UINT64:case ke.FIXED64:case ke.INT64:case ke.SFIXED64:case ke.SINT64:return e==t}return!1}function Oo(n,e){switch(n){case ke.BOOL:return!1;case ke.UINT64:case ke.FIXED64:case ke.INT64:case ke.SFIXED64:case ke.SINT64:return e==0?Vi.zero:"0";case ke.DOUBLE:case ke.FLOAT:return 0;case ke.BYTES:return new Uint8Array(0);case ke.STRING:return"";default:return 0}}function DS(n,e){switch(n){case ke.BOOL:return e===!1;case ke.STRING:return e==="";case ke.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var zn;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32"})(zn||(zn={}));class JP{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let s=0;s<this.chunks.length;s++)e+=this.chunks[s].length;let t=new Uint8Array(e),i=0;for(let s=0;s<this.chunks.length;s++)t.set(this.chunks[s],i),i+=this.chunks[s].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Kp(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Eu(e),hv(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){wS(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){Kp(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){Eu(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return Eu(e),e=(e<<1^e>>31)>>>0,hv(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),s=Vi.enc(e);return i.setInt32(0,s.lo,!0),i.setInt32(4,s.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),s=Vi.uEnc(e);return i.setInt32(0,s.lo,!0),i.setInt32(4,s.hi,!0),this.raw(t)}int64(e){let t=Vi.enc(e);return af(t.lo,t.hi,this.buf),this}sint64(e){let t=Vi.enc(e),i=t.hi>>31,s=t.lo<<1^i,r=(t.hi<<1|t.lo>>>31)^i;return af(s,r,this.buf),this}uint64(e){let t=Vi.uEnc(e);return af(t.lo,t.hi,this.buf),this}}class QP{constructor(e,t){this.varint64=jP,this.uint32=XP,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t??new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,i=e&7;if(t<=0||i<0||i>5)throw new Error("illegal tag: field no "+t+" wire type "+i);return[t,i]}skip(e,t){let i=this.pos;switch(e){case zn.Varint:for(;this.buf[this.pos++]&128;);break;case zn.Bit64:this.pos+=4;case zn.Bit32:this.pos+=4;break;case zn.LengthDelimited:let s=this.uint32();this.pos+=s;break;case zn.StartGroup:for(;;){const[r,a]=this.tag();if(a===zn.EndGroup){if(t!==void 0&&r!==t)throw new Error("invalid end group tag");break}this.skip(a,r)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return Vi.dec(...this.varint64())}uint64(){return Vi.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),i=-(e&1);return e=(e>>>1|(t&1)<<31)^i,t=t>>>1^i,Vi.dec(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return Vi.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return Vi.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function ZP(n,e,t,i){let s;return{typeName:e,extendee:t,get field(){if(!s){const r=typeof i=="function"?i():i;r.name=e.split(".").pop(),r.jsonName=`[${e}]`,s=n.util.newFieldList([r]).list()[0]}return s},runtime:n}}function LS(n){const e=n.field.localName,t=Object.create(null);return t[e]=$P(n),[t,()=>t[e]]}function $P(n){const e=n.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Oo(e.T,e.L);case"message":const t=e.T,i=new t;return t.fieldWrapper?t.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function e3(n,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let t=n.length-1;t>=0;--t)if(n[t].no==e.no)return[n[t]];return[]}return n.filter(t=>t.no===e.no)}let ar="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Ed=[];for(let n=0;n<ar.length;n++)Ed[ar[n].charCodeAt(0)]=n;Ed[45]=ar.indexOf("+");Ed[95]=ar.indexOf("/");const OS={dec(n){let e=n.length*3/4;n[n.length-2]=="="?e-=2:n[n.length-1]=="="&&(e-=1);let t=new Uint8Array(e),i=0,s=0,r,a=0;for(let o=0;o<n.length;o++){if(r=Ed[n.charCodeAt(o)],r===void 0)switch(n[o]){case"=":s=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(s){case 0:a=r,s=1;break;case 1:t[i++]=a<<2|(r&48)>>4,a=r,s=2;break;case 2:t[i++]=(a&15)<<4|(r&60)>>2,a=r,s=3;break;case 3:t[i++]=(a&3)<<6|r,s=0;break}}if(s==1)throw Error("invalid base64 string.");return t.subarray(0,i)},enc(n){let e="",t=0,i,s=0;for(let r=0;r<n.length;r++)switch(i=n[r],t){case 0:e+=ar[i>>2],s=(i&3)<<4,t=1;break;case 1:e+=ar[s|i>>4],s=(i&15)<<2,t=2;break;case 2:e+=ar[s|i>>6],e+=ar[i&63],t=0;break}return t&&(e+=ar[s],e+="=",t==1&&(e+="=")),e}};function t3(n,e,t){FS(e,n);const i=e.runtime.bin.makeReadOptions(t),s=e3(n.getType().runtime.bin.listUnknownFields(n),e.field),[r,a]=LS(e);for(const o of s)e.runtime.bin.readField(r,i.readerFactory(o.data),e.field,o.wireType,i);return a()}function n3(n,e,t,i){FS(e,n);const s=e.runtime.bin.makeReadOptions(i),r=e.runtime.bin.makeWriteOptions(i);if(US(n,e)){const c=n.getType().runtime.bin.listUnknownFields(n).filter(u=>u.no!=e.field.no);n.getType().runtime.bin.discardUnknownFields(n);for(const u of c)n.getType().runtime.bin.onUnknownField(n,u.no,u.wireType,u.data)}const a=r.writerFactory();let o=e.field;!o.opt&&!o.repeated&&(o.kind=="enum"||o.kind=="scalar")&&(o=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(o,t,a,r);const l=s.readerFactory(a.finish());for(;l.pos<l.len;){const[c,u]=l.tag(),d=l.skip(u,c);n.getType().runtime.bin.onUnknownField(n,c,u,d)}}function US(n,e){const t=n.getType();return e.extendee.typeName===t.typeName&&!!t.runtime.bin.listUnknownFields(n).find(i=>i.no==e.field.no)}function FS(n,e){Bn(n.extendee.typeName==e.getType().typeName,`extension ${n.typeName} can only be applied to message ${n.extendee.typeName}`)}function BS(n,e){const t=n.localName;if(n.repeated)return e[t].length>0;if(n.oneof)return e[n.oneof.localName].case===t;switch(n.kind){case"enum":case"scalar":return n.opt||n.req?e[t]!==void 0:n.kind=="enum"?e[t]!==n.T.values[0].no:!DS(n.T,e[t]);case"message":return e[t]!==void 0;case"map":return Object.keys(e[t]).length>0}}function pv(n,e){const t=n.localName,i=!n.opt&&!n.req;if(n.repeated)e[t]=[];else if(n.oneof)e[n.oneof.localName]={case:void 0};else switch(n.kind){case"map":e[t]={};break;case"enum":e[t]=i?n.T.values[0].no:void 0;break;case"scalar":e[t]=i?Oo(n.T,n.L):void 0;break;case"message":e[t]=void 0;break}}function Ca(n,e){if(n===null||typeof n!="object"||!Object.getOwnPropertyNames(IS.prototype).every(i=>i in n&&typeof n[i]=="function"))return!1;const t=n.getType();return t===null||typeof t!="function"||!("typeName"in t)||typeof t.typeName!="string"?!1:e===void 0?!0:t.typeName==e.typeName}function VS(n,e){return Ca(e)||!n.fieldWrapper?e:n.fieldWrapper.wrapField(e)}ke.DOUBLE,ke.FLOAT,ke.INT64,ke.UINT64,ke.INT32,ke.UINT32,ke.BOOL,ke.STRING,ke.BYTES;const mv={ignoreUnknownFields:!1},gv={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function i3(n){return n?Object.assign(Object.assign({},mv),n):mv}function s3(n){return n?Object.assign(Object.assign({},gv),n):gv}const Zu=Symbol(),Cu=Symbol();function r3(){return{makeReadOptions:i3,makeWriteOptions:s3,readMessage(n,e,t,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error(`cannot decode message ${n.typeName} from JSON: ${ks(e)}`);i=i??new n;const s=new Map,r=t.typeRegistry;for(const[a,o]of Object.entries(e)){const l=n.fields.findJsonName(a);if(l){if(l.oneof){if(o===null&&l.kind=="scalar")continue;const c=s.get(l.oneof);if(c!==void 0)throw new Error(`cannot decode message ${n.typeName} from JSON: multiple keys for oneof "${l.oneof.name}" present: "${c}", "${a}"`);s.set(l.oneof,a)}_v(i,o,l,t,n)}else{let c=!1;if(r!=null&&r.findExtension&&a.startsWith("[")&&a.endsWith("]")){const u=r.findExtension(a.substring(1,a.length-1));if(u&&u.extendee.typeName==n.typeName){c=!0;const[d,h]=LS(u);_v(d,o,u.field,t,u),n3(i,u,h(),t)}}if(!c&&!t.ignoreUnknownFields)throw new Error(`cannot decode message ${n.typeName} from JSON: key "${a}" is unknown`)}}return i},writeMessage(n,e){const t=n.getType(),i={};let s;try{for(s of t.fields.byNumber()){if(!BS(s,n)){if(s.req)throw"required field not set";if(!e.emitDefaultValues||!o3(s))continue}const a=s.oneof?n[s.oneof.localName].value:n[s.localName],o=vv(s,a,e);o!==void 0&&(i[e.useProtoFieldName?s.name:s.jsonName]=o)}const r=e.typeRegistry;if(r!=null&&r.findExtensionFor)for(const a of t.runtime.bin.listUnknownFields(n)){const o=r.findExtensionFor(t.typeName,a.no);if(o&&US(n,o)){const l=t3(n,o,e),c=vv(o.field,l,e);c!==void 0&&(i[o.field.jsonName]=c)}}}catch(r){const a=s?`cannot encode field ${t.typeName}.${s.name} to JSON`:`cannot encode message ${t.typeName} to JSON`,o=r instanceof Error?r.message:String(r);throw new Error(a+(o.length>0?`: ${o}`:""))}return i},readScalar(n,e,t){return Uc(n,e,t??Zr.BIGINT,!0)},writeScalar(n,e,t){if(e!==void 0&&(t||DS(n,e)))return wu(n,e)},debug:ks}}function ks(n){if(n===null)return"null";switch(typeof n){case"object":return Array.isArray(n)?"array":"object";case"string":return n.length>100?"string":`"${n.split('"').join('\\"')}"`;default:return String(n)}}function _v(n,e,t,i,s){let r=t.localName;if(t.repeated){if(Bn(t.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error(`cannot decode field ${s.typeName}.${t.name} from JSON: ${ks(e)}`);const a=n[r];for(const o of e){if(o===null)throw new Error(`cannot decode field ${s.typeName}.${t.name} from JSON: ${ks(o)}`);switch(t.kind){case"message":a.push(t.T.fromJson(o,i));break;case"enum":const l=of(t.T,o,i.ignoreUnknownFields,!0);l!==Cu&&a.push(l);break;case"scalar":try{a.push(Uc(t.T,o,t.L,!0))}catch(c){let u=`cannot decode field ${s.typeName}.${t.name} from JSON: ${ks(o)}`;throw c instanceof Error&&c.message.length>0&&(u+=`: ${c.message}`),new Error(u)}break}}}else if(t.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error(`cannot decode field ${s.typeName}.${t.name} from JSON: ${ks(e)}`);const a=n[r];for(const[o,l]of Object.entries(e)){if(l===null)throw new Error(`cannot decode field ${s.typeName}.${t.name} from JSON: map value null`);let c;try{c=a3(t.K,o)}catch(u){let d=`cannot decode map key for field ${s.typeName}.${t.name} from JSON: ${ks(e)}`;throw u instanceof Error&&u.message.length>0&&(d+=`: ${u.message}`),new Error(d)}switch(t.V.kind){case"message":a[c]=t.V.T.fromJson(l,i);break;case"enum":const u=of(t.V.T,l,i.ignoreUnknownFields,!0);u!==Cu&&(a[c]=u);break;case"scalar":try{a[c]=Uc(t.V.T,l,Zr.BIGINT,!0)}catch(d){let h=`cannot decode map value for field ${s.typeName}.${t.name} from JSON: ${ks(e)}`;throw d instanceof Error&&d.message.length>0&&(h+=`: ${d.message}`),new Error(h)}break}}}else switch(t.oneof&&(n=n[t.oneof.localName]={case:r},r="value"),t.kind){case"message":const a=t.T;if(e===null&&a.typeName!="google.protobuf.Value")return;let o=n[r];Ca(o)?o.fromJson(e,i):(n[r]=o=a.fromJson(e,i),a.fieldWrapper&&!t.oneof&&(n[r]=a.fieldWrapper.unwrapField(o)));break;case"enum":const l=of(t.T,e,i.ignoreUnknownFields,!1);switch(l){case Zu:pv(t,n);break;case Cu:break;default:n[r]=l;break}break;case"scalar":try{const c=Uc(t.T,e,t.L,!1);switch(c){case Zu:pv(t,n);break;default:n[r]=c;break}}catch(c){let u=`cannot decode field ${s.typeName}.${t.name} from JSON: ${ks(e)}`;throw c instanceof Error&&c.message.length>0&&(u+=`: ${c.message}`),new Error(u)}break}}function a3(n,e){if(n===ke.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Uc(n,e,Zr.BIGINT,!0).toString()}function Uc(n,e,t,i){if(e===null)return i?Oo(n,t):Zu;switch(n){case ke.DOUBLE:case ke.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const s=Number(e);if(Number.isNaN(s)||!Number.isFinite(s))break;return n==ke.FLOAT&&wS(s),s;case ke.INT32:case ke.FIXED32:case ke.SFIXED32:case ke.SINT32:case ke.UINT32:let r;if(typeof e=="number"?r=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(r=Number(e)),r===void 0)break;return n==ke.UINT32||n==ke.FIXED32?Kp(r):Eu(r),r;case ke.INT64:case ke.SFIXED64:case ke.SINT64:if(typeof e!="number"&&typeof e!="string")break;const a=Vi.parse(e);return t?a.toString():a;case ke.FIXED64:case ke.UINT64:if(typeof e!="number"&&typeof e!="string")break;const o=Vi.uParse(e);return t?o.toString():o;case ke.BOOL:if(typeof e!="boolean")break;return e;case ke.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case ke.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return OS.dec(e)}throw new Error}function of(n,e,t,i){if(e===null)return n.typeName=="google.protobuf.NullValue"?0:i?n.values[0].no:Zu;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const s=n.findName(e);if(s!==void 0)return s.no;if(t)return Cu;break}throw new Error(`cannot decode enum ${n.typeName} from JSON: ${ks(e)}`)}function o3(n){return n.repeated||n.kind=="map"?!0:!(n.oneof||n.kind=="message"||n.opt||n.req)}function vv(n,e,t){if(n.kind=="map"){Bn(typeof e=="object"&&e!=null);const i={},s=Object.entries(e);switch(n.V.kind){case"scalar":for(const[a,o]of s)i[a.toString()]=wu(n.V.T,o);break;case"message":for(const[a,o]of s)i[a.toString()]=o.toJson(t);break;case"enum":const r=n.V.T;for(const[a,o]of s)i[a.toString()]=cf(r,o,t.enumAsInteger);break}return t.emitDefaultValues||s.length>0?i:void 0}if(n.repeated){Bn(Array.isArray(e));const i=[];switch(n.kind){case"scalar":for(let s=0;s<e.length;s++)i.push(wu(n.T,e[s]));break;case"enum":for(let s=0;s<e.length;s++)i.push(cf(n.T,e[s],t.enumAsInteger));break;case"message":for(let s=0;s<e.length;s++)i.push(e[s].toJson(t));break}return t.emitDefaultValues||i.length>0?i:void 0}switch(n.kind){case"scalar":return wu(n.T,e);case"enum":return cf(n.T,e,t.enumAsInteger);case"message":return VS(n.T,e).toJson(t)}}function cf(n,e,t){var i;if(Bn(typeof e=="number"),n.typeName=="google.protobuf.NullValue")return null;if(t)return e;const s=n.findNumber(e);return(i=s==null?void 0:s.name)!==null&&i!==void 0?i:e}function wu(n,e){switch(n){case ke.INT32:case ke.SFIXED32:case ke.SINT32:case ke.FIXED32:case ke.UINT32:return Bn(typeof e=="number"),e;case ke.FLOAT:case ke.DOUBLE:return Bn(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case ke.STRING:return Bn(typeof e=="string"),e;case ke.BOOL:return Bn(typeof e=="boolean"),e;case ke.UINT64:case ke.FIXED64:case ke.INT64:case ke.SFIXED64:case ke.SINT64:return Bn(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case ke.BYTES:return Bn(e instanceof Uint8Array),OS.enc(e)}}const ja=Symbol("@bufbuild/protobuf/unknown-fields"),bv={readUnknownFields:!0,readerFactory:n=>new QP(n)},yv={writeUnknownFields:!0,writerFactory:()=>new JP};function c3(n){return n?Object.assign(Object.assign({},bv),n):bv}function l3(n){return n?Object.assign(Object.assign({},yv),n):yv}function u3(){return{makeReadOptions:c3,makeWriteOptions:l3,listUnknownFields(n){var e;return(e=n[ja])!==null&&e!==void 0?e:[]},discardUnknownFields(n){delete n[ja]},writeUnknownFields(n,e){const i=n[ja];if(i)for(const s of i)e.tag(s.no,s.wireType).raw(s.data)},onUnknownField(n,e,t,i){const s=n;Array.isArray(s[ja])||(s[ja]=[]),s[ja].push({no:e,wireType:t,data:i})},readMessage(n,e,t,i,s){const r=n.getType(),a=s?e.len:e.pos+t;let o,l;for(;e.pos<a&&([o,l]=e.tag(),!(s===!0&&l==zn.EndGroup));){const c=r.fields.find(o);if(!c){const u=e.skip(l,o);i.readUnknownFields&&this.onUnknownField(n,o,l,u);continue}Tv(n,e,c,l,i)}if(s&&(l!=zn.EndGroup||o!==t))throw new Error("invalid end group tag")},readField:Tv,writeMessage(n,e,t){const i=n.getType();for(const s of i.fields.byNumber()){if(!BS(s,n)){if(s.req)throw new Error(`cannot encode field ${i.typeName}.${s.name} to binary: required field not set`);continue}const r=s.oneof?n[s.oneof.localName].value:n[s.localName];Sv(s,r,e,t)}return t.writeUnknownFields&&this.writeUnknownFields(n,e),e},writeField(n,e,t,i){e!==void 0&&Sv(n,e,t,i)}}}function Tv(n,e,t,i,s){let{repeated:r,localName:a}=t;switch(t.oneof&&(n=n[t.oneof.localName],n.case!=a&&delete n.value,n.case=a,a="value"),t.kind){case"scalar":case"enum":const o=t.kind=="enum"?ke.INT32:t.T;let l=$u;if(t.kind=="scalar"&&t.L>0&&(l=h3),r){let h=n[a];if(i==zn.LengthDelimited&&o!=ke.STRING&&o!=ke.BYTES){let g=e.uint32()+e.pos;for(;e.pos<g;)h.push(l(e,o))}else h.push(l(e,o))}else n[a]=l(e,o);break;case"message":const c=t.T;r?n[a].push(Ru(e,new c,s,t)):Ca(n[a])?Ru(e,n[a],s,t):(n[a]=Ru(e,new c,s,t),c.fieldWrapper&&!t.oneof&&!t.repeated&&(n[a]=c.fieldWrapper.unwrapField(n[a])));break;case"map":let[u,d]=d3(t,e,s);n[a][u]=d;break}}function Ru(n,e,t,i){const s=e.getType().runtime.bin,r=i==null?void 0:i.delimited;return s.readMessage(e,n,r?i.no:n.uint32(),t,r),e}function d3(n,e,t){const i=e.uint32(),s=e.pos+i;let r,a;for(;e.pos<s;){const[o]=e.tag();switch(o){case 1:r=$u(e,n.K);break;case 2:switch(n.V.kind){case"scalar":a=$u(e,n.V.T);break;case"enum":a=e.int32();break;case"message":a=Ru(e,new n.V.T,t,void 0);break}break}}if(r===void 0&&(r=Oo(n.K,Zr.BIGINT)),typeof r!="string"&&typeof r!="number"&&(r=r.toString()),a===void 0)switch(n.V.kind){case"scalar":a=Oo(n.V.T,Zr.BIGINT);break;case"enum":a=n.V.T.values[0].no;break;case"message":a=new n.V.T;break}return[r,a]}function h3(n,e){const t=$u(n,e);return typeof t=="bigint"?t.toString():t}function $u(n,e){switch(e){case ke.STRING:return n.string();case ke.BOOL:return n.bool();case ke.DOUBLE:return n.double();case ke.FLOAT:return n.float();case ke.INT32:return n.int32();case ke.INT64:return n.int64();case ke.UINT64:return n.uint64();case ke.FIXED64:return n.fixed64();case ke.BYTES:return n.bytes();case ke.FIXED32:return n.fixed32();case ke.SFIXED32:return n.sfixed32();case ke.SFIXED64:return n.sfixed64();case ke.SINT64:return n.sint64();case ke.UINT32:return n.uint32();case ke.SINT32:return n.sint32()}}function Sv(n,e,t,i){Bn(e!==void 0);const s=n.repeated;switch(n.kind){case"scalar":case"enum":let r=n.kind=="enum"?ke.INT32:n.T;if(s)if(Bn(Array.isArray(e)),n.packed)p3(t,r,n.no,e);else for(const a of e)Fc(t,r,n.no,a);else Fc(t,r,n.no,e);break;case"message":if(s){Bn(Array.isArray(e));for(const a of e)Ev(t,i,n,a)}else Ev(t,i,n,e);break;case"map":Bn(typeof e=="object"&&e!=null);for(const[a,o]of Object.entries(e))f3(t,i,n,a,o);break}}function f3(n,e,t,i,s){n.tag(t.no,zn.LengthDelimited),n.fork();let r=i;switch(t.K){case ke.INT32:case ke.FIXED32:case ke.UINT32:case ke.SFIXED32:case ke.SINT32:r=Number.parseInt(i);break;case ke.BOOL:Bn(i=="true"||i=="false"),r=i=="true";break}switch(Fc(n,t.K,1,r),t.V.kind){case"scalar":Fc(n,t.V.T,2,s);break;case"enum":Fc(n,ke.INT32,2,s);break;case"message":Bn(s!==void 0),n.tag(2,zn.LengthDelimited).bytes(s.toBinary(e));break}n.join()}function Ev(n,e,t,i){const s=VS(t.T,i);t.delimited?n.tag(t.no,zn.StartGroup).raw(s.toBinary(e)).tag(t.no,zn.EndGroup):n.tag(t.no,zn.LengthDelimited).bytes(s.toBinary(e))}function Fc(n,e,t,i){Bn(i!==void 0);let[s,r]=GS(e);n.tag(t,s)[r](i)}function p3(n,e,t,i){if(!i.length)return;n.tag(t,zn.LengthDelimited).fork();let[,s]=GS(e);for(let r=0;r<i.length;r++)n[s](i[r]);n.join()}function GS(n){let e=zn.Varint;switch(n){case ke.BYTES:case ke.STRING:e=zn.LengthDelimited;break;case ke.DOUBLE:case ke.FIXED64:case ke.SFIXED64:e=zn.Bit64;break;case ke.FIXED32:case ke.SFIXED32:case ke.FLOAT:e=zn.Bit32;break}const t=ke[n].toLowerCase();return[e,t]}function m3(){return{setEnumType:kS,initPartial(n,e){if(n===void 0)return;const t=e.getType();for(const i of t.fields.byMember()){const s=i.localName,r=e,a=n;if(a[s]!=null)switch(i.kind){case"oneof":const o=a[s].case;if(o===void 0)continue;const l=i.findField(o);let c=a[s].value;l&&l.kind=="message"&&!Ca(c,l.T)?c=new l.T(c):l&&l.kind==="scalar"&&l.T===ke.BYTES&&(c=lc(c)),r[s]={case:o,value:c};break;case"scalar":case"enum":let u=a[s];i.T===ke.BYTES&&(u=i.repeated?u.map(lc):lc(u)),r[s]=u;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===ke.BYTES)for(const[f,g]of Object.entries(a[s]))r[s][f]=lc(g);else Object.assign(r[s],a[s]);break;case"message":const h=i.V.T;for(const f of Object.keys(a[s])){let g=a[s][f];h.fieldWrapper||(g=new h(g)),r[s][f]=g}break}break;case"message":const d=i.T;if(i.repeated)r[s]=a[s].map(h=>Ca(h,d)?h:new d(h));else{const h=a[s];d.fieldWrapper?d.typeName==="google.protobuf.BytesValue"?r[s]=lc(h):r[s]=h:r[s]=Ca(h,d)?h:new d(h)}break}}},equals(n,e,t){return e===t?!0:!e||!t?!1:n.fields.byMember().every(i=>{const s=e[i.localName],r=t[i.localName];if(i.repeated){if(s.length!==r.length)return!1;switch(i.kind){case"message":return s.every((a,o)=>i.T.equals(a,r[o]));case"scalar":return s.every((a,o)=>Sr(i.T,a,r[o]));case"enum":return s.every((a,o)=>Sr(ke.INT32,a,r[o]))}throw new Error(`repeated cannot contain ${i.kind}`)}switch(i.kind){case"message":return i.T.equals(s,r);case"enum":return Sr(ke.INT32,s,r);case"scalar":return Sr(i.T,s,r);case"oneof":if(s.case!==r.case)return!1;const a=i.findField(s.case);if(a===void 0)return!0;switch(a.kind){case"message":return a.T.equals(s.value,r.value);case"enum":return Sr(ke.INT32,s.value,r.value);case"scalar":return Sr(a.T,s.value,r.value)}throw new Error(`oneof cannot contain ${a.kind}`);case"map":const o=Object.keys(s).concat(Object.keys(r));switch(i.V.kind){case"message":const l=i.V.T;return o.every(u=>l.equals(s[u],r[u]));case"enum":return o.every(u=>Sr(ke.INT32,s[u],r[u]));case"scalar":const c=i.V.T;return o.every(u=>Sr(c,s[u],r[u]))}break}})},clone(n){const e=n.getType(),t=new e,i=t;for(const s of e.fields.byMember()){const r=n[s.localName];let a;if(s.repeated)a=r.map(El);else if(s.kind=="map"){a=i[s.localName];for(const[o,l]of Object.entries(r))a[o]=El(l)}else s.kind=="oneof"?a=s.findField(r.case)?{case:r.case,value:El(r.value)}:{case:void 0}:a=El(r);i[s.localName]=a}for(const s of e.runtime.bin.listUnknownFields(n))e.runtime.bin.onUnknownField(i,s.no,s.wireType,s.data);return t}}}function El(n){if(n===void 0)return n;if(Ca(n))return n.clone();if(n instanceof Uint8Array){const e=new Uint8Array(n.byteLength);return e.set(n),e}return n}function lc(n){return n instanceof Uint8Array?n:new Uint8Array(n)}function g3(n,e,t){return{syntax:n,json:r3(),bin:u3(),util:Object.assign(Object.assign({},m3()),{newFieldList:e,initFields:t}),makeMessageType(i,s,r){return WP(this,i,s,r)},makeEnum:HP,makeEnumType:MS,getEnumType:zP,makeExtension(i,s,r){return ZP(this,i,s,r)}}}class _3{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const t={};for(const i of this.list())t[i.jsonName]=t[i.name]=i;this.jsonNames=t}return this.jsonNames[e]}find(e){if(!this.numbers){const t={};for(const i of this.list())t[i.no]=i;this.numbers=t}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const i of this.list())i.oneof?i.oneof!==t&&(t=i.oneof,e.push(t)):e.push(i)}return this.members}}function zS(n,e){const t=HS(n);return e?t:E3(S3(t))}function v3(n){return zS(n,!1)}const b3=HS;function HS(n){let e=!1;const t=[];for(let i=0;i<n.length;i++){let s=n.charAt(i);switch(s){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":t.push(s),e=!1;break;default:e&&(e=!1,s=s.toUpperCase()),t.push(s);break}}return t.join("")}const y3=new Set(["constructor","toString","toJSON","valueOf"]),T3=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),WS=n=>`${n}$`,S3=n=>T3.has(n)?WS(n):n,E3=n=>y3.has(n)?WS(n):n;class A3{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=v3(e)}addField(e){Bn(e.oneof===this,`field ${e.name} not one of ${this.name}`),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let t=0;t<this.fields.length;t++)this._lookup[this.fields[t].localName]=this.fields[t]}return this._lookup[e]}}function C3(n,e){var t,i,s,r,a,o;const l=[];let c;for(const u of typeof n=="function"?n():n){const d=u;if(d.localName=zS(u.name,u.oneof!==void 0),d.jsonName=(t=u.jsonName)!==null&&t!==void 0?t:b3(u.name),d.repeated=(i=u.repeated)!==null&&i!==void 0?i:!1,u.kind=="scalar"&&(d.L=(s=u.L)!==null&&s!==void 0?s:Zr.BIGINT),d.delimited=(r=u.delimited)!==null&&r!==void 0?r:!1,d.req=(a=u.req)!==null&&a!==void 0?a:!1,d.opt=(o=u.opt)!==null&&o!==void 0?o:!1,u.packed===void 0&&(d.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=ke.BYTES&&u.T!=ke.STRING),u.oneof!==void 0){const h=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!c||c.name!=h)&&(c=new A3(h)),d.oneof=c,c.addField(d)}l.push(d)}return l}const ze=g3("proto3",n=>new _3(n,e=>C3(e)),n=>{for(const e of n.getType().fields.byMember()){if(e.opt)continue;const t=e.localName,i=n;if(e.repeated){i[t]=[];continue}switch(e.kind){case"oneof":i[t]={case:void 0};break;case"enum":i[t]=0;break;case"map":i[t]={};break;case"scalar":i[t]=Oo(e.T,e.L);break}}}),w3=ze.makeEnum("livekit.AudioCodec",[{no:0,name:"DEFAULT_AC"},{no:1,name:"OPUS"},{no:2,name:"AAC"}]),R3=ze.makeEnum("livekit.VideoCodec",[{no:0,name:"DEFAULT_VC"},{no:1,name:"H264_BASELINE"},{no:2,name:"H264_MAIN"},{no:3,name:"H264_HIGH"},{no:4,name:"VP8"}]),k3=ze.makeEnum("livekit.ImageCodec",[{no:0,name:"IC_DEFAULT"},{no:1,name:"IC_JPEG"}]),M3=ze.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"REGRESSION"},{no:1,name:"SIMULCAST"}]),x3=ze.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),mo=ze.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),I3=ze.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),P3=ze.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"}]),N3=ze.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"}]),qp=ze.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:D3,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:qS}]),D3=ze.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),wg=ze.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:ze.getEnumType(mo),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Xp=ze.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:ze.getEnumType(L3)},{no:4,name:"tracks",kind:"message",T:jS,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:wg},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:ze.getEnumType(O3)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:ze.getEnumType(P3)}]),L3=ze.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),O3=ze.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),U3=ze.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),F3=ze.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:KS,repeated:!0}]),jS=ze.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:ze.getEnumType(x3)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:ze.getEnumType(mo)},{no:10,name:"layers",kind:"message",T:KS,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:F3,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:ze.getEnumType(U3)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:qS},{no:19,name:"audio_features",kind:"enum",T:ze.getEnumType(N3),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:ze.getEnumType(M3)}]),KS=ze.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:ze.getEnumType(I3)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]),B3=ze.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),V3=ze.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),qS=ze.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),G3=ze.makeMessageType("livekit.RoomAgentDispatch",()=>[{no:1,name:"agent_name",kind:"scalar",T:9},{no:2,name:"metadata",kind:"scalar",T:9}]),z3=ze.makeEnum("livekit.EncodedFileType",[{no:0,name:"DEFAULT_FILETYPE"},{no:1,name:"MP4"},{no:2,name:"OGG"}]),H3=ze.makeEnum("livekit.SegmentedFileProtocol",[{no:0,name:"DEFAULT_SEGMENTED_FILE_PROTOCOL"},{no:1,name:"HLS_PROTOCOL"}]),W3=ze.makeEnum("livekit.SegmentedFileSuffix",[{no:0,name:"INDEX"},{no:1,name:"TIMESTAMP"}]),j3=ze.makeEnum("livekit.ImageFileSuffix",[{no:0,name:"IMAGE_SUFFIX_INDEX"},{no:1,name:"IMAGE_SUFFIX_TIMESTAMP"}]),K3=ze.makeEnum("livekit.StreamProtocol",[{no:0,name:"DEFAULT_PROTOCOL"},{no:1,name:"RTMP"},{no:2,name:"SRT"}]),q3=ze.makeEnum("livekit.AudioMixing",[{no:0,name:"DEFAULT_MIXING"},{no:1,name:"DUAL_CHANNEL_AGENT"},{no:2,name:"DUAL_CHANNEL_ALTERNATE"}]),XS=ze.makeEnum("livekit.EncodingOptionsPreset",[{no:0,name:"H264_720P_30"},{no:1,name:"H264_720P_60"},{no:2,name:"H264_1080P_30"},{no:3,name:"H264_1080P_60"},{no:4,name:"PORTRAIT_H264_720P_30"},{no:5,name:"PORTRAIT_H264_720P_60"},{no:6,name:"PORTRAIT_H264_1080P_30"},{no:7,name:"PORTRAIT_H264_1080P_60"}]),X3=ze.makeMessageType("livekit.RoomCompositeEgressRequest",()=>[{no:1,name:"room_name",kind:"scalar",T:9},{no:2,name:"layout",kind:"scalar",T:9},{no:3,name:"audio_only",kind:"scalar",T:8},{no:15,name:"audio_mixing",kind:"enum",T:ze.getEnumType(q3)},{no:4,name:"video_only",kind:"scalar",T:8},{no:5,name:"custom_base_url",kind:"scalar",T:9},{no:6,name:"file",kind:"message",T:Yp,oneof:"output"},{no:7,name:"stream",kind:"message",T:Av,oneof:"output"},{no:10,name:"segments",kind:"message",T:Jp,oneof:"output"},{no:8,name:"preset",kind:"enum",T:ze.getEnumType(XS),oneof:"options"},{no:9,name:"advanced",kind:"message",T:JS,oneof:"options"},{no:11,name:"file_outputs",kind:"message",T:Yp,repeated:!0},{no:12,name:"stream_outputs",kind:"message",T:Av,repeated:!0},{no:13,name:"segment_outputs",kind:"message",T:Jp,repeated:!0},{no:14,name:"image_outputs",kind:"message",T:Y3,repeated:!0}]),Yp=ze.makeMessageType("livekit.EncodedFileOutput",()=>[{no:1,name:"file_type",kind:"enum",T:ze.getEnumType(z3)},{no:2,name:"filepath",kind:"scalar",T:9},{no:6,name:"disable_manifest",kind:"scalar",T:8},{no:3,name:"s3",kind:"message",T:Ad,oneof:"output"},{no:4,name:"gcp",kind:"message",T:Cd,oneof:"output"},{no:5,name:"azure",kind:"message",T:wd,oneof:"output"},{no:7,name:"aliOSS",kind:"message",T:Rd,oneof:"output"}]),Jp=ze.makeMessageType("livekit.SegmentedFileOutput",()=>[{no:1,name:"protocol",kind:"enum",T:ze.getEnumType(H3)},{no:2,name:"filename_prefix",kind:"scalar",T:9},{no:3,name:"playlist_name",kind:"scalar",T:9},{no:11,name:"live_playlist_name",kind:"scalar",T:9},{no:4,name:"segment_duration",kind:"scalar",T:13},{no:10,name:"filename_suffix",kind:"enum",T:ze.getEnumType(W3)},{no:8,name:"disable_manifest",kind:"scalar",T:8},{no:5,name:"s3",kind:"message",T:Ad,oneof:"output"},{no:6,name:"gcp",kind:"message",T:Cd,oneof:"output"},{no:7,name:"azure",kind:"message",T:wd,oneof:"output"},{no:9,name:"aliOSS",kind:"message",T:Rd,oneof:"output"}]),Y3=ze.makeMessageType("livekit.ImageOutput",()=>[{no:1,name:"capture_interval",kind:"scalar",T:13},{no:2,name:"width",kind:"scalar",T:5},{no:3,name:"height",kind:"scalar",T:5},{no:4,name:"filename_prefix",kind:"scalar",T:9},{no:5,name:"filename_suffix",kind:"enum",T:ze.getEnumType(j3)},{no:6,name:"image_codec",kind:"enum",T:ze.getEnumType(k3)},{no:7,name:"disable_manifest",kind:"scalar",T:8},{no:8,name:"s3",kind:"message",T:Ad,oneof:"output"},{no:9,name:"gcp",kind:"message",T:Cd,oneof:"output"},{no:10,name:"azure",kind:"message",T:wd,oneof:"output"},{no:11,name:"aliOSS",kind:"message",T:Rd,oneof:"output"}]),Ad=ze.makeMessageType("livekit.S3Upload",()=>[{no:1,name:"access_key",kind:"scalar",T:9},{no:2,name:"secret",kind:"scalar",T:9},{no:11,name:"session_token",kind:"scalar",T:9},{no:3,name:"region",kind:"scalar",T:9},{no:4,name:"endpoint",kind:"scalar",T:9},{no:5,name:"bucket",kind:"scalar",T:9},{no:6,name:"force_path_style",kind:"scalar",T:8},{no:7,name:"metadata",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:8,name:"tagging",kind:"scalar",T:9},{no:9,name:"content_disposition",kind:"scalar",T:9},{no:10,name:"proxy",kind:"message",T:YS}]),Cd=ze.makeMessageType("livekit.GCPUpload",()=>[{no:1,name:"credentials",kind:"scalar",T:9},{no:2,name:"bucket",kind:"scalar",T:9},{no:3,name:"proxy",kind:"message",T:YS}]),wd=ze.makeMessageType("livekit.AzureBlobUpload",()=>[{no:1,name:"account_name",kind:"scalar",T:9},{no:2,name:"account_key",kind:"scalar",T:9},{no:3,name:"container_name",kind:"scalar",T:9}]),Rd=ze.makeMessageType("livekit.AliOSSUpload",()=>[{no:1,name:"access_key",kind:"scalar",T:9},{no:2,name:"secret",kind:"scalar",T:9},{no:3,name:"region",kind:"scalar",T:9},{no:4,name:"endpoint",kind:"scalar",T:9},{no:5,name:"bucket",kind:"scalar",T:9}]),YS=ze.makeMessageType("livekit.ProxyConfig",()=>[{no:1,name:"url",kind:"scalar",T:9},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"password",kind:"scalar",T:9}]),Av=ze.makeMessageType("livekit.StreamOutput",()=>[{no:1,name:"protocol",kind:"enum",T:ze.getEnumType(K3)},{no:2,name:"urls",kind:"scalar",T:9,repeated:!0}]),JS=ze.makeMessageType("livekit.EncodingOptions",()=>[{no:1,name:"width",kind:"scalar",T:5},{no:2,name:"height",kind:"scalar",T:5},{no:3,name:"depth",kind:"scalar",T:5},{no:4,name:"framerate",kind:"scalar",T:5},{no:5,name:"audio_codec",kind:"enum",T:ze.getEnumType(w3)},{no:6,name:"audio_bitrate",kind:"scalar",T:5},{no:11,name:"audio_quality",kind:"scalar",T:5},{no:7,name:"audio_frequency",kind:"scalar",T:5},{no:8,name:"video_codec",kind:"enum",T:ze.getEnumType(R3)},{no:9,name:"video_bitrate",kind:"scalar",T:5},{no:12,name:"video_quality",kind:"scalar",T:5},{no:10,name:"key_frame_interval",kind:"scalar",T:1}]),J3=ze.makeMessageType("livekit.AutoParticipantEgress",()=>[{no:1,name:"preset",kind:"enum",T:ze.getEnumType(XS),oneof:"options"},{no:2,name:"advanced",kind:"message",T:JS,oneof:"options"},{no:3,name:"file_outputs",kind:"message",T:Yp,repeated:!0},{no:4,name:"segment_outputs",kind:"message",T:Jp,repeated:!0}]),Q3=ze.makeMessageType("livekit.AutoTrackEgress",()=>[{no:1,name:"filepath",kind:"scalar",T:9},{no:5,name:"disable_manifest",kind:"scalar",T:8},{no:2,name:"s3",kind:"message",T:Ad,oneof:"output"},{no:3,name:"gcp",kind:"message",T:Cd,oneof:"output"},{no:4,name:"azure",kind:"message",T:wd,oneof:"output"},{no:6,name:"aliOSS",kind:"message",T:Rd,oneof:"output"}]),Z3=ze.makeMessageType("livekit.CreateRoomRequest",()=>[{no:1,name:"name",kind:"scalar",T:9},{no:12,name:"room_preset",kind:"scalar",T:9},{no:2,name:"empty_timeout",kind:"scalar",T:13},{no:10,name:"departure_timeout",kind:"scalar",T:13},{no:3,name:"max_participants",kind:"scalar",T:13},{no:4,name:"node_id",kind:"scalar",T:9},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"egress",kind:"message",T:$3},{no:7,name:"min_playout_delay",kind:"scalar",T:13},{no:8,name:"max_playout_delay",kind:"scalar",T:13},{no:9,name:"sync_streams",kind:"scalar",T:8},{no:13,name:"replay_enabled",kind:"scalar",T:8},{no:14,name:"agents",kind:"message",T:G3,repeated:!0}]),$3=ze.makeMessageType("livekit.RoomEgress",()=>[{no:1,name:"room",kind:"message",T:X3},{no:3,name:"participant",kind:"message",T:J3},{no:2,name:"tracks",kind:"message",T:Q3}]),eN=ze.makeMessageType("livekit.ListRoomsRequest",()=>[{no:1,name:"names",kind:"scalar",T:9,repeated:!0}]),tN=ze.makeMessageType("livekit.ListRoomsResponse",()=>[{no:1,name:"rooms",kind:"message",T:qp,repeated:!0}]),nN=ze.makeMessageType("livekit.DeleteRoomRequest",()=>[{no:1,name:"room",kind:"scalar",T:9}]),iN=ze.makeMessageType("livekit.ListParticipantsRequest",()=>[{no:1,name:"room",kind:"scalar",T:9}]),sN=ze.makeMessageType("livekit.ListParticipantsResponse",()=>[{no:1,name:"participants",kind:"message",T:Xp,repeated:!0}]),Cv=ze.makeMessageType("livekit.RoomParticipantIdentity",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9}]),rN=ze.makeMessageType("livekit.MuteRoomTrackRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"track_sid",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8}]),aN=ze.makeMessageType("livekit.MuteRoomTrackResponse",()=>[{no:1,name:"track",kind:"message",T:jS}]),oN=ze.makeMessageType("livekit.UpdateParticipantRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"permission",kind:"message",T:wg},{no:5,name:"name",kind:"scalar",T:9},{no:6,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}]),cN=ze.makeMessageType("livekit.UpdateSubscriptionsRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"subscribe",kind:"scalar",T:8},{no:5,name:"participant_tracks",kind:"message",T:V3,repeated:!0}]),lN=ze.makeMessageType("livekit.SendDataRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"data",kind:"scalar",T:12},{no:3,name:"kind",kind:"enum",T:ze.getEnumType(B3)},{no:4,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:5,name:"topic",kind:"scalar",T:9,opt:!0},{no:7,name:"nonce",kind:"scalar",T:12}]),uN=ze.makeMessageType("livekit.UpdateRoomMetadataRequest",()=>[{no:1,name:"room",kind:"scalar",T:9},{no:2,name:"metadata",kind:"scalar",T:9}]),Rg=crypto,QS=n=>n instanceof CryptoKey,go=new TextEncoder,ed=new TextDecoder;function dN(...n){const e=n.reduce((s,{length:r})=>s+r,0),t=new Uint8Array(e);let i=0;for(const s of n)t.set(s,i),i+=s.length;return t}const hN=n=>{let e=n;typeof e=="string"&&(e=go.encode(e));const t=32768,i=[];for(let s=0;s<e.length;s+=t)i.push(String.fromCharCode.apply(null,e.subarray(s,s+t)));return btoa(i.join(""))},lf=n=>hN(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),fN=n=>{const e=atob(n),t=new Uint8Array(e.length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t},kd=n=>{let e=n;e instanceof Uint8Array&&(e=ed.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return fN(e)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class kg extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(t=Error.captureStackTrace)==null||t.call(Error,this,this.constructor)}}class _o extends kg{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}}class uc extends kg{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}}class Dr extends kg{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}}function Hs(n,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${n}`)}function Al(n,e){return n.name===e}function uf(n){return parseInt(n.name.slice(4),10)}function pN(n){switch(n){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function mN(n,e){if(e.length&&!e.some(t=>n.usages.includes(t))){let t="CryptoKey does not support this operation, its usages must include ";if(e.length>2){const i=e.pop();t+=`one of ${e.join(", ")}, or ${i}.`}else e.length===2?t+=`one of ${e[0]} or ${e[1]}.`:t+=`${e[0]}.`;throw new TypeError(t)}}function gN(n,e,...t){switch(e){case"HS256":case"HS384":case"HS512":{if(!Al(n.algorithm,"HMAC"))throw Hs("HMAC");const i=parseInt(e.slice(2),10);if(uf(n.algorithm.hash)!==i)throw Hs(`SHA-${i}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!Al(n.algorithm,"RSASSA-PKCS1-v1_5"))throw Hs("RSASSA-PKCS1-v1_5");const i=parseInt(e.slice(2),10);if(uf(n.algorithm.hash)!==i)throw Hs(`SHA-${i}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!Al(n.algorithm,"RSA-PSS"))throw Hs("RSA-PSS");const i=parseInt(e.slice(2),10);if(uf(n.algorithm.hash)!==i)throw Hs(`SHA-${i}`,"algorithm.hash");break}case"EdDSA":{if(n.algorithm.name!=="Ed25519"&&n.algorithm.name!=="Ed448")throw Hs("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!Al(n.algorithm,"ECDSA"))throw Hs("ECDSA");const i=pN(e);if(n.algorithm.namedCurve!==i)throw Hs(i,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}mN(n,t)}function ZS(n,e,...t){var i;if(t=t.filter(Boolean),t.length>2){const s=t.pop();n+=`one of type ${t.join(", ")}, or ${s}.`}else t.length===2?n+=`one of type ${t[0]} or ${t[1]}.`:n+=`of type ${t[0]}.`;return e==null?n+=` Received ${e}`:typeof e=="function"&&e.name?n+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&(i=e.constructor)!=null&&i.name&&(n+=` Received an instance of ${e.constructor.name}`),n}const wv=(n,...e)=>ZS("Key must be ",n,...e);function $S(n,e,...t){return ZS(`Key for the ${n} algorithm must be `,e,...t)}const eE=n=>QS(n)?!0:(n==null?void 0:n[Symbol.toStringTag])==="KeyObject",td=["CryptoKey"],_N=(...n)=>{const e=n.filter(Boolean);if(e.length===0||e.length===1)return!0;let t;for(const i of e){const s=Object.keys(i);if(!t||t.size===0){t=new Set(s);continue}for(const r of s){if(t.has(r))return!1;t.add(r)}}return!0};function vN(n){return typeof n=="object"&&n!==null}function Mg(n){if(!vN(n)||Object.prototype.toString.call(n)!=="[object Object]")return!1;if(Object.getPrototypeOf(n)===null)return!0;let e=n;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(n)===e}const bN=(n,e)=>{if(n.startsWith("RS")||n.startsWith("PS")){const{modulusLength:t}=e.algorithm;if(typeof t!="number"||t<2048)throw new TypeError(`${n} requires key modulusLength to be 2048 bits or larger`)}};function al(n){return Mg(n)&&typeof n.kty=="string"}function yN(n){return n.kty!=="oct"&&typeof n.d=="string"}function TN(n){return n.kty!=="oct"&&typeof n.d>"u"}function SN(n){return al(n)&&n.kty==="oct"&&typeof n.k=="string"}function EN(n){let e,t;switch(n.kty){case"RSA":{switch(n.alg){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${n.alg.slice(-3)}`},t=n.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${n.alg.slice(-3)}`},t=n.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(n.alg.slice(-3),10)||1}`},t=n.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new _o('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(n.alg){case"ES256":e={name:"ECDSA",namedCurve:"P-256"},t=n.d?["sign"]:["verify"];break;case"ES384":e={name:"ECDSA",namedCurve:"P-384"},t=n.d?["sign"]:["verify"];break;case"ES512":e={name:"ECDSA",namedCurve:"P-521"},t=n.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:"ECDH",namedCurve:n.crv},t=n.d?["deriveBits"]:[];break;default:throw new _o('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(n.alg){case"EdDSA":e={name:n.crv},t=n.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:n.crv},t=n.d?["deriveBits"]:[];break;default:throw new _o('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new _o('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:e,keyUsages:t}}const AN=async n=>{if(!n.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:e,keyUsages:t}=EN(n),i=[e,n.ext??!1,n.key_ops??t],s={...n};return delete s.alg,delete s.use,Rg.subtle.importKey("jwk",s,...i)},tE=n=>kd(n);let Ka,qa;const nE=n=>(n==null?void 0:n[Symbol.toStringTag])==="KeyObject",nd=async(n,e,t,i,s=!1)=>{let r=n.get(e);if(r!=null&&r[i])return r[i];const a=await AN({...t,alg:i});return s&&Object.freeze(e),r?r[i]=a:n.set(e,{[i]:a}),a},CN=(n,e)=>{if(nE(n)){let t=n.export({format:"jwk"});return delete t.d,delete t.dp,delete t.dq,delete t.p,delete t.q,delete t.qi,t.k?tE(t.k):(qa||(qa=new WeakMap),nd(qa,n,t,e))}return al(n)?n.k?kd(n.k):(qa||(qa=new WeakMap),nd(qa,n,n,e,!0)):n},wN=(n,e)=>{if(nE(n)){let t=n.export({format:"jwk"});return t.k?tE(t.k):(Ka||(Ka=new WeakMap),nd(Ka,n,t,e))}return al(n)?n.k?kd(n.k):(Ka||(Ka=new WeakMap),nd(Ka,n,n,e,!0)):n},RN={normalizePublicKey:CN,normalizePrivateKey:wN},uo=n=>n==null?void 0:n[Symbol.toStringTag],Qp=(n,e,t)=>{var i,s;if(e.use!==void 0&&e.use!=="sig")throw new TypeError("Invalid key for this operation, when present its use must be sig");if(e.key_ops!==void 0&&((s=(i=e.key_ops).includes)==null?void 0:s.call(i,t))!==!0)throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${t}`);if(e.alg!==void 0&&e.alg!==n)throw new TypeError(`Invalid key for this operation, when present its alg must be ${n}`);return!0},kN=(n,e,t,i)=>{if(!(e instanceof Uint8Array)){if(i&&al(e)){if(SN(e)&&Qp(n,e,t))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!eE(e))throw new TypeError($S(n,e,...td,"Uint8Array",i?"JSON Web Key":null));if(e.type!=="secret")throw new TypeError(`${uo(e)} instances for symmetric algorithms must be of type "secret"`)}},MN=(n,e,t,i)=>{if(i&&al(e))switch(t){case"sign":if(yN(e)&&Qp(n,e,t))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(TN(e)&&Qp(n,e,t))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!eE(e))throw new TypeError($S(n,e,...td,i?"JSON Web Key":null));if(e.type==="secret")throw new TypeError(`${uo(e)} instances for asymmetric algorithms must not be of type "secret"`);if(t==="sign"&&e.type==="public")throw new TypeError(`${uo(e)} instances for asymmetric algorithm signing must be of type "private"`);if(t==="decrypt"&&e.type==="public")throw new TypeError(`${uo(e)} instances for asymmetric algorithm decryption must be of type "private"`);if(e.algorithm&&t==="verify"&&e.type==="private")throw new TypeError(`${uo(e)} instances for asymmetric algorithm verifying must be of type "public"`);if(e.algorithm&&t==="encrypt"&&e.type==="private")throw new TypeError(`${uo(e)} instances for asymmetric algorithm encryption must be of type "public"`)};function iE(n,e,t,i){e.startsWith("HS")||e==="dir"||e.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(e)?kN(e,t,i,n):MN(e,t,i,n)}iE.bind(void 0,!1);const xN=iE.bind(void 0,!0);function IN(n,e,t,i,s){if(s.crit!==void 0&&(i==null?void 0:i.crit)===void 0)throw new n('"crit" (Critical) Header Parameter MUST be integrity protected');if(!i||i.crit===void 0)return new Set;if(!Array.isArray(i.crit)||i.crit.length===0||i.crit.some(a=>typeof a!="string"||a.length===0))throw new n('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let r;t!==void 0?r=new Map([...Object.entries(t),...e.entries()]):r=e;for(const a of i.crit){if(!r.has(a))throw new _o(`Extension Header Parameter "${a}" is not recognized`);if(s[a]===void 0)throw new n(`Extension Header Parameter "${a}" is missing`);if(r.get(a)&&i[a]===void 0)throw new n(`Extension Header Parameter "${a}" MUST be integrity protected`)}return new Set(i.crit)}function PN(n,e){const t=`SHA-${n.slice(-3)}`;switch(n){case"HS256":case"HS384":case"HS512":return{hash:t,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:t,name:"RSA-PSS",saltLength:n.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:t,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:t,name:"ECDSA",namedCurve:e.namedCurve};case"EdDSA":return{name:e.name};default:throw new _o(`alg ${n} is not supported either by JOSE or your javascript runtime`)}}async function NN(n,e,t){if(e=await RN.normalizePrivateKey(e,n),QS(e))return gN(e,n,t),e;if(e instanceof Uint8Array){if(!n.startsWith("HS"))throw new TypeError(wv(e,...td));return Rg.subtle.importKey("raw",e,{hash:`SHA-${n.slice(-3)}`,name:"HMAC"},!1,[t])}throw new TypeError(wv(e,...td,"Uint8Array","JSON Web Key"))}const sa=n=>Math.floor(n.getTime()/1e3),sE=60,rE=sE*60,xg=rE*24,DN=xg*7,LN=xg*365.25,ON=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,df=n=>{const e=ON.exec(n);if(!e||e[4]&&e[1])throw new TypeError("Invalid time period format");const t=parseFloat(e[2]),i=e[3].toLowerCase();let s;switch(i){case"sec":case"secs":case"second":case"seconds":case"s":s=Math.round(t);break;case"minute":case"minutes":case"min":case"mins":case"m":s=Math.round(t*sE);break;case"hour":case"hours":case"hr":case"hrs":case"h":s=Math.round(t*rE);break;case"day":case"days":case"d":s=Math.round(t*xg);break;case"week":case"weeks":case"w":s=Math.round(t*DN);break;default:s=Math.round(t*LN);break}return e[1]==="-"||e[4]==="ago"?-s:s},UN=async(n,e,t)=>{const i=await NN(n,e,"sign");bN(n,i);const s=await Rg.subtle.sign(PN(n,i.algorithm),i,t);return new Uint8Array(s)};class FN{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){if(!this._protectedHeader&&!this._unprotectedHeader)throw new uc("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!_N(this._protectedHeader,this._unprotectedHeader))throw new uc("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const i={...this._protectedHeader,...this._unprotectedHeader},s=IN(uc,new Map([["b64",!0]]),t==null?void 0:t.crit,this._protectedHeader,i);let r=!0;if(s.has("b64")&&(r=this._protectedHeader.b64,typeof r!="boolean"))throw new uc('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:a}=i;if(typeof a!="string"||!a)throw new uc('JWS "alg" (Algorithm) Header Parameter missing or invalid');xN(a,e,"sign");let o=this._payload;r&&(o=go.encode(lf(o)));let l;this._protectedHeader?l=go.encode(lf(JSON.stringify(this._protectedHeader))):l=go.encode("");const c=dN(l,go.encode("."),o),u=await UN(a,e,c),d={signature:lf(u),payload:""};return r&&(d.payload=ed.decode(o)),this._unprotectedHeader&&(d.header=this._unprotectedHeader),this._protectedHeader&&(d.protected=ed.decode(l)),d}}class BN{constructor(e){this._flattened=new FN(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){const i=await this._flattened.sign(e,t);if(i.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${i.protected}.${i.payload}.${i.signature}`}}function ra(n,e){if(!Number.isFinite(e))throw new TypeError(`Invalid ${n} input`);return e}class VN{constructor(e={}){if(!Mg(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return typeof e=="number"?this._payload={...this._payload,nbf:ra("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:ra("setNotBefore",sa(e))}:this._payload={...this._payload,nbf:sa(new Date)+df(e)},this}setExpirationTime(e){return typeof e=="number"?this._payload={...this._payload,exp:ra("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:ra("setExpirationTime",sa(e))}:this._payload={...this._payload,exp:sa(new Date)+df(e)},this}setIssuedAt(e){return typeof e>"u"?this._payload={...this._payload,iat:sa(new Date)}:e instanceof Date?this._payload={...this._payload,iat:ra("setIssuedAt",sa(e))}:typeof e=="string"?this._payload={...this._payload,iat:ra("setIssuedAt",sa(new Date)+df(e))}:this._payload={...this._payload,iat:ra("setIssuedAt",e)},this}}class GN extends VN{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){var s;const i=new BN(go.encode(JSON.stringify(this._payload)));if(i.setProtectedHeader(this._protectedHeader),Array.isArray((s=this._protectedHeader)==null?void 0:s.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new Dr("JWTs MUST NOT use unencoded payload");return i.sign(e,t)}}const zN=kd;function HN(n){if(typeof n!="string")throw new Dr("JWTs must use Compact JWS serialization, JWT must be a string");const{1:e,length:t}=n.split(".");if(t===5)throw new Dr("Only JWTs using Compact JWS serialization can be decoded");if(t!==3)throw new Dr("Invalid JWT");if(!e)throw new Dr("JWTs must contain a payload");let i;try{i=zN(e)}catch{throw new Dr("Failed to base64url decode the payload")}let s;try{s=JSON.parse(ed.decode(i))}catch{throw new Dr("Failed to parse the decoded payload as JSON")}if(!Mg(s))throw new Dr("Invalid JWT Claims Set");return s}function WN(n){switch(n){case mo.CAMERA:return"camera";case mo.MICROPHONE:return"microphone";case mo.SCREEN_SHARE:return"screen_share";case mo.SCREEN_SHARE_AUDIO:return"screen_share_audio";default:throw new TypeError(`Cannot convert TrackSource ${n} to string`)}}function jN(n){var e;const t={...n};return Array.isArray((e=t.video)==null?void 0:e.canPublishSources)&&(t.video.canPublishSources=t.video.canPublishSources.map(WN)),t}var Rv={};const KN="6h";class qN{constructor(e,t,i){if(e||(e=Rv.LIVEKIT_API_KEY),t||(t=Rv.LIVEKIT_API_SECRET),!e||!t)throw Error("api-key and api-secret must be set");typeof document<"u"&&console.error(`You should not include your API secret in your web client bundle.

Your web client should request a token from your backend server which should then use the API secret to generate a token. See https://docs.livekit.io/client/connect/`),this.apiKey=e,this.apiSecret=t,this.grants={},this.identity=i==null?void 0:i.identity,this.ttl=(i==null?void 0:i.ttl)||KN,typeof this.ttl=="number"&&(this.ttl=`${this.ttl}s`),i!=null&&i.metadata&&(this.metadata=i.metadata),i!=null&&i.attributes&&(this.attributes=i.attributes),i!=null&&i.name&&(this.name=i.name)}addGrant(e){this.grants.video={...this.grants.video??{},...e}}addSIPGrant(e){this.grants.sip={...this.grants.sip??{},...e}}get name(){return this.grants.name}set name(e){this.grants.name=e}get metadata(){return this.grants.metadata}set metadata(e){this.grants.metadata=e}get attributes(){return this.grants.attributes}set attributes(e){this.grants.attributes=e}get kind(){return this.grants.kind}set kind(e){this.grants.kind=e}get sha256(){return this.grants.sha256}set sha256(e){this.grants.sha256=e}get roomPreset(){return this.grants.roomPreset}set roomPreset(e){this.grants.roomPreset=e}get roomConfig(){return this.grants.roomConfig}set roomConfig(e){this.grants.roomConfig=e}async toJwt(){var e;const t=new TextEncoder().encode(this.apiSecret),i=new GN(jN(this.grants)).setProtectedHeader({alg:"HS256"}).setIssuer(this.apiKey).setExpirationTime(this.ttl).setNotBefore(0);if(this.identity)i.setSubject(this.identity);else if((e=this.grants.video)!=null&&e.roomJoin)throw Error("identity is required for join but not set");return i.sign(t)}}class XN{constructor(e,t,i){this.apiKey=e,this.secret=t,this.ttl=i||"10m"}async authHeader(e,t){const i=new qN(this.apiKey,this.secret,{ttl:this.ttl});return e&&i.addGrant(e),t&&i.addSIPGrant(t),{Authorization:`Bearer ${await i.toJwt()}`}}}const YN="/twirp",JN="livekit";class QN extends Error{constructor(e,t,i,s){super(t),this.name=e,this.status=i,this.code=s}}class ZN{constructor(e,t,i){e.startsWith("ws")&&(e=e.replace("ws","http")),this.host=e,this.pkg=t,this.prefix=i||YN}async request(e,t,i,s){const r=`${this.prefix}/${this.pkg}.${e}/${t}`,a=new URL(r,this.host),o=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json;charset=UTF-8",...s},body:JSON.stringify(i)});if(!o.ok){const u=o.headers.get("content-type")==="application/json";let d="Unknown internal error",h;try{if(u){const f=await o.json();"msg"in f&&(d=f.msg),"code"in f&&(h=f.code)}else d=await o.text()}catch(f){console.debug("Error when trying to parse error message, using defaults",f)}throw new QN(o.statusText,d,o.status,h)}const l=await o.json();return(await _y(()=>import("./index.BLfCKlkn.js"),[],import.meta.url).then(u=>u.default))(l,{deep:!0})}}async function $N(n=16){return globalThis.crypto?crypto.getRandomValues(new Uint8Array(n)):(await _y(()=>import("./__vite-browser-external.BIHI7g3E.js"),[],import.meta.url)).getRandomValues(new Uint8Array(n))}const is="RoomService";class eD extends XN{constructor(e,t,i){super(t,i),this.rpc=new ZN(e,JN)}async createRoom(e){const t=await this.rpc.request(is,"CreateRoom",new Z3(e).toJson(),await this.authHeader({roomCreate:!0}));return qp.fromJson(t,{ignoreUnknownFields:!0})}async listRooms(e){const t=await this.rpc.request(is,"ListRooms",new eN({names:e??[]}).toJson(),await this.authHeader({roomList:!0}));return tN.fromJson(t,{ignoreUnknownFields:!0}).rooms??[]}async deleteRoom(e){await this.rpc.request(is,"DeleteRoom",new nN({room:e}).toJson(),await this.authHeader({roomCreate:!0}))}async updateRoomMetadata(e,t){const i=await this.rpc.request(is,"UpdateRoomMetadata",new uN({room:e,metadata:t}).toJson(),await this.authHeader({roomAdmin:!0,room:e}));return qp.fromJson(i,{ignoreUnknownFields:!0})}async listParticipants(e){const t=await this.rpc.request(is,"ListParticipants",new iN({room:e}).toJson(),await this.authHeader({roomAdmin:!0,room:e}));return sN.fromJson(t,{ignoreUnknownFields:!0}).participants??[]}async getParticipant(e,t){const i=await this.rpc.request(is,"GetParticipant",new Cv({room:e,identity:t}).toJson(),await this.authHeader({roomAdmin:!0,room:e}));return Xp.fromJson(i,{ignoreUnknownFields:!0})}async removeParticipant(e,t){await this.rpc.request(is,"RemoveParticipant",new Cv({room:e,identity:t}).toJson(),await this.authHeader({roomAdmin:!0,room:e}))}async mutePublishedTrack(e,t,i,s){const r=new rN({room:e,identity:t,trackSid:i,muted:s}).toJson(),a=await this.rpc.request(is,"MutePublishedTrack",r,await this.authHeader({roomAdmin:!0,room:e}));return aN.fromJson(a,{ignoreUnknownFields:!0}).track}async updateParticipant(e,t,i,s,r){const a=typeof i=="object",o=a?i==null?void 0:i.metadata:i,l=a?i.permission:s,c=a?i.name:r,u=a?i.attributes:{},d=new oN({room:e,identity:t,attributes:u,metadata:o,name:c});l&&(d.permission=new wg(l));const h=await this.rpc.request(is,"UpdateParticipant",d.toJson(),await this.authHeader({roomAdmin:!0,room:e}));return Xp.fromJson(h,{ignoreUnknownFields:!0})}async updateSubscriptions(e,t,i,s){const r=new cN({room:e,identity:t,trackSids:i,subscribe:s,participantTracks:[]}).toJson();await this.rpc.request(is,"UpdateSubscriptions",r,await this.authHeader({roomAdmin:!0,room:e}))}async sendData(e,t,i,s={}){const r=Array.isArray(s)?s:s.destinationSids,a=Array.isArray(s)?void 0:s.topic,o=new lN({room:e,data:t,kind:i,destinationSids:r??[],topic:a});!Array.isArray(s)&&s.destinationIdentities&&(o.destinationIdentities=s.destinationIdentities),o.nonce=await $N(16),await this.rpc.request(is,"SendData",o.toJson(),await this.authHeader({roomAdmin:!0,room:e}))}}const tD=async n=>{try{const e=await HN(n),t=!e.exp||e.exp<ti()/1e3,i=!!e.nbf&&e.nbf>ti()/1e3;return Lt("isTokenValid() tokenInfo: ",e,"expired: ",t,"beforeValid: ",i,"now: ",ti()/1e3,"valid: ",!t&&!i,e),!t&&!i?e.sub:!1}catch(e){fs("Error in decodeJwt() on auth token: ",e)}};function id(n){return new Promise(e=>{setTimeout(()=>{e()},n)})}function dc(n,e){let t=!1,i=n.get();return n.subscribe(r=>{if(t==!1){t=!0,i=r;return}e(r,i),i=r})}function nD(n,e){const t=n.subscribe(i=>{i&&setTimeout(()=>{t(),e(i)})});return t}function iD(n,e=!1){return n.replace("http","ws")}const aE=n=>{for(const e in n)n[e]===void 0||typeof n[e]=="number"&&isNaN(n[e])?delete n[e]:typeof n[e]=="object"&&aE(n[e]);return n};class sD{constructor(e,t){Ne(this,"client");this.client=new eD(e),Object.assign(this.client,{authToken:t,authHeader:async i=>({Authorization:`Bearer ${t}`})})}listLivekitRooms(){return this.client.listRooms()}}async function rD(n,e){return(await new sD(n,e).listLivekitRooms()).filter(s=>s.numParticipants>0)}function aD(n,e){try{const t=JSON.parse(n),i=t.accessTokens,s=t.numParticipants;if(!i||!Array.isArray(i)||i.length===0||e>s)return $t("Failed to get tokens list from livekit room metadata","numRoomParticipants",e,"numRovKnownParticipants",s,t),null;{let r=Math.floor(Math.random()*100001)%i.length;for(let a=0;a<i.length;a++){let o=i[(a+r)%i.length];if(o&&o.userGivenIdentity&&!Fy.get().has(o.userGivenIdentity)&&!(!o.encrypted&&!tD(o.token)))return o}return null}}catch(t){return $t("Error parsing livekit room metadata: "+n,t),null}}class oD{constructor(e=!0){Ne(this,"config");Ne(this,"lastMsgRecivedTimestamp");Ne(this,"connectionState");Ne(this,"latestRecivedDataMessage");Ne(this,"participantConnectionEvents");Ne(this,"_rovRoomName");Ne(this,"_accessToken");Ne(this,"_reconnectAttemptCount",0);Ne(this,"_shouldReconnect");Ne(this,"_roomConn");this.config={},this._shouldReconnect=e,this.connectionState=Ze(Dt.init),this.latestRecivedDataMessage=Ze(null),this.participantConnectionEvents=Ze(null)}async init(e){this.config=e,this._shouldReconnect=!0,this._roomConn=new Ag(e.roomConfig),this._roomConn.on(Ce.DCBufferStatusChanged,(t,i)=>{t?$t("LK: Data channel buffer is low: ",i):Lt("LK: Data channel buffer is normal: ",i)}).on(Ce.SignalConnected,async()=>{Lt(`LK: Signal connection established to ${this.config.hostUrl}`)}).on(Ce.Connected,async()=>{li(`LK: Connected to room: ${this._roomConn.name} via ${this.config.hostUrl}`),this.connectionState.set(Dt.connected)}).on(Ce.SignalReconnecting,()=>{this.connectionState.set(Dt.reconnecting)}).on(Ce.Disconnected,t=>{let i=this._shouldReconnect&&!!this._roomConn;t===Kn.DUPLICATE_IDENTITY?($t("LK: disconnected from room - duplicate identity"),i=!1):t===Kn.CLIENT_INITIATED?($t("LK: disconnected from room - client initiated"),i=!1):t===Kn.PARTICIPANT_REMOVED?($t("LK: disconnected from room - participant removed"),i=!1):t===Kn.ROOM_DELETED?$t("LK: disconnected from room - room deleted"):t===Kn.STATE_MISMATCH?$t("LK: disconnected from room - state mismatch"):t===Kn.SERVER_SHUTDOWN?$t("LK: disconnected from room - server shutdown"):t===Kn.JOIN_FAILURE?$t("LK: disconnected from room - join failure"):t===Kn.UNKNOWN_REASON&&$t("LK: disconnected from room - unknown reason"),i?this._reconnect():(this.connectionState.set(Dt.disconnectedOk),this.close())}).on(Ce.Reconnecting,()=>{Lt(`LK: Reconnecting to room ${this._roomConn.name} via ${this.config.hostUrl}`),this.connectionState.set(Dt.reconnecting)}).on(Ce.Reconnected,async()=>{li("LK: Successfully reconnected. server=",await this._roomConn.engine.getConnectedServerAddress()),this.connectionState.set(Dt.connected)}).on(Ce.ParticipantMetadataChanged,t=>{Lt("LK: Participant Metadata Changed",t)}).on(Ce.ParticipantConnected,async t=>{li(`LK: Participant ${t.identity} (${t.sid}) connected`,t.metadata),this.participantConnectionEvents.set({id:t.identity,joined:!0}),t.on(qe.ConnectionQualityChanged,()=>{Lt("LK: ParticipantEvent.ConnectionQualityChanged",t.connectionQuality)})}).on(Ce.ParticipantDisconnected,t=>{Lt(`LK: Participant ${t.identity} (${t.sid}) disconnected`),this.participantConnectionEvents.set({id:t.identity,joined:!1})}).on(Ce.MediaDevicesError,t=>{const i=Xc.getFailure(t);$t("LK: Media device failure",i)}).on(Ce.ConnectionQualityChanged,(t,i)=>{Lt(`LK: connection quality for ${i?i.identity:"[no identity]"} changed to ${t}`)}).on(Ce.RoomMetadataChanged,t=>{try{Lt("LK: New metadata for room",JSON.parse(t))}catch{Lt("LK: New metadata for room (NOT VALID JSON)",t)}}).on(Ce.MediaDevicesChanged,()=>{Lt("LK: MediaDevicesChanged")}).on(Ce.LocalTrackUnpublished,(t,i)=>{Lt("LK: LocalTrackUnpublished",t.trackSid,"by participant",i.identity,"source",t.track?t.track.source:"[no track found]")}).on(Ce.LocalTrackPublished,(t,i)=>{Lt("LK: LocalVideoTrackPublished",t.trackSid,"by participant",i.identity,"source",t.track?t.track.source:"[no track found]")}).on(Ce.AudioPlaybackStatusChanged,()=>{Lt("LK: AudioPlaybackStatusChanged. canPlaybackAudio =",this._roomConn.canPlaybackAudio)})}async start(e,t){this._rovRoomName=e,this._accessToken=t,this._shouldReconnect=!0;const i=ti();Fi(`LK: Starting conn with ${e} via ${this.config.hostUrl} token = ${t}`);try{const s=setTimeout(()=>{Fi(`livekit connect timeout for ${this.config.hostUrl}. Reconnecting...`),this._reconnect()},16e3);await this._connect(),clearTimeout(s),Fi(`LK: Connected in ${ti()-i}ms ${this.config.hostUrl}`)}catch(s){Fi(`LK: Error connecting to ${this.config.hostUrl}. Reconnecting...`,s),this._reconnect()}}async sendMessage(e,t=!0,i=[]){if(!this._roomConn)return $t("LK: Can't send message, room not connected");if(e.length==0)return $t("LK: Can't send empty message");try{await this._roomConn.localParticipant.publishData(e,{reliable:t,destinationIdentities:i})}catch(s){fs("LK: Error sending message",s)}}getParticipantSid(e){const t=[...this._roomConn.remoteParticipants.values()].find(i=>i.identity===e);return t?t.sid:null}getLivekitIdentitiy(){return this._roomConn?this._roomConn.localParticipant.identity:null}getRoomName(){return this._roomConn?this._roomConn.name:this._rovRoomName}close(){this._shouldReconnect=!1,this.connectionState.set(Dt.disconnectedOk),this._roomConn&&($t("LK: Closing Livekit Connection: ",this._rovRoomName,this.config.hostUrl),this._roomConn.disconnect(!0))}async _connect(){await this._roomConn.connect(iD(this.config.hostUrl),this._accessToken,this.config.roomConnectionConfig),li("LK: Connected to room",this._roomConn.name,this._roomConn)}async _reconnect(){this.connectionState.set(Dt.reconnecting);try{await this._roomConn.disconnect(!0)}catch(e){fs("LK: Error disconnecting from room",e)}if(this._shouldReconnect!=!1)if(this._reconnectAttemptCount<this.config.reconnectAttempts){const e=this._reconnectAttemptCount*800;this._reconnectAttemptCount++,await id(e);try{await this._connect()}catch(t){throw fs("LK: Error reconnecting to room",t),t}}else fs("LK: Failed to reconnect after ",this._reconnectAttemptCount,"/",this.config.reconnectAttempts,"attempts"),this._fail()}_fail(){this._shouldReconnect=!1,this.connectionState.set(Dt.failed)}}class oE{constructor(){Ne(this,"lastStats");Ne(this,"timestamp",0);Ne(this,"bytesSent",0);Ne(this,"bytesReceived",0);Ne(this,"selectedCandidatePairId","");this.lastStats={availableIncomingBitrate:0,availableOutgoingBitrate:0,bitrateReceive:0,bitrateSend:0,recieverStats:{},senderLayerStats:[],rtcStatsJson:"",selectedCandidatePairChanges:0,canidatePairState:"waiting",canidatePairNominated:!1,iceState:"new",dtlsState:"new",allStats:[]}}parse(e){var r;let t={...this.lastStats};if(t.senderLayerStats=[],t.recieverStats={},!e)return t.recieverStats.hung=!0,t;const i=t.allStats=Array.from(e.values?e.values():e),s=new Map;for(const a of i)if(a.type==="codec"){const{mimeType:l,sdpFmtpLine:c,id:u}=a,[d,h]=l.toLowerCase().split("/");s.set(u,{codec:h??"unknown",sdpFmtpLine:c})}for(const a of i){const o=a.type;if(o==="inbound-rtp"&&a.kind==="video"){let{frameWidth:l,frameHeight:c,framesPerSecond:u,estimatedPlayoutTimestamp:d,nackCount:h,pliCount:f,jitterBufferDelay:g,freezeCount:v,jitter:m,codecId:_}=a;h=h??0,f=f??0;const{codec:y,sdpFmtpLine:b}=s.get(_||"")||{codec:"unknown",sdpFmtpLine:""},p=Math.max(d?d-this.timestamp:0,g);t.recieverStats={...t.recieverStats,nackCount:h,pliCount:f,freezeCount:v,estimatedPlayoutDelay:p,jitterBufferDelay:g,jitter:m,frameWidth:l,frameHeight:c,framesPerSecond:Math.floor(u),videoCodec:y,videoSdpFmtpLine:b}}else if(o==="outbound-rtp"&&a.kind==="video"){let{retransmittedBytesSent:l,scalabilityMode:c,qualityLimitationResolutionChanges:u,encoderImplementation:d,powerEfficientEncoder:h,qualityLimitationReason:f,qualityLimitationDurations:g,totalPacketSendDelay:v,frameWidth:m,frameHeight:_,framesPerSecond:y,codecId:b}=a;const{codec:p,sdpFmtpLine:w}=s.get(b||"")||{codec:"unknown",sdpFmtpLine:""};(r=t.senderLayerStats)==null||r.push({qualityLimitationResolutionChanges:u,qualityLimitationReason:f,bandwidthLimitedQualityDurration:g==null?void 0:g.bandwidth,cpuLimitedQualityDurration:g==null?void 0:g.cpu,otherLimitedQualityDurration:g==null?void 0:g.other,noLimitedQualityDurration:g==null?void 0:g.none,encoderImplementation:d,powerEfficientEncoder:h,scalabilityMode:c,totalPacketSendDelay:v,retransmittedBytesSent:l,frameWidth:Math.floor(m),frameHeight:Math.floor(_),framesPerSecond:Math.floor(y),videoCodec:p,videoSdpFmtpLine:w})}else if(o==="candidate-pair"){const{availableOutgoingBitrate:l,availableIncomingBitrate:c,currentRoundTripTime:u,state:d,nominated:h}=a;if(h===!1)continue;t={...t,recieverStats:{...t.recieverStats,currentRoundTripTime:u},availableOutgoingBitrate:Math.floor(l??0),availableIncomingBitrate:Math.floor(c??0),canidatePairState:d,canidatePairNominated:h}}else if(o==="transport"){let{bytesReceived:l,bytesSent:c,selectedCandidatePairId:u,timestamp:d}=a;l=l??0,c=c??0,u=u??"",u!==this.selectedCandidatePairId&&(t.selectedCandidatePairChanges=(t.selectedCandidatePairChanges||0)+1,this.selectedCandidatePairId=u),d!=this.timestamp&&(t.bitrateReceive=Math.floor((l-this.bytesReceived)/(d-this.timestamp)*8e3),t.bitrateSend=Math.floor((c-this.bytesSent)/(d-this.timestamp)*8e3),t.recieverStats={...t.recieverStats,hung:t.bitrateReceive<=0},this.timestamp=d),this.bytesSent=c,this.bytesReceived=l}}return t.senderLayerStats=t.senderLayerStats?t.senderLayerStats.sort((a,o)=>(o.frameWidth||0)*(o.frameHeight||0)-(a.frameWidth||0)*(a.frameHeight||0)):[],this.lastStats=t,aE(t)}}class cD extends oE{}class lD extends oD{constructor(){super();Ne(this,"remoteVideoTracks");Ne(this,"videoStatsParser",new cD);Ne(this,"isLivestreamRecording",Ze(!1));this.remoteVideoTracks=Ze(new Map)}subscribeToTracks(t){this._rovRoomName===t.identity&&(t.videoTrackPublications.forEach(i=>{i.setSubscribed(!0)}),t.audioTrackPublications.forEach(i=>i.setSubscribed(!0)),li(`Can playback - audio: ${this._roomConn.canPlaybackAudio}, video: ${this._roomConn.canPlaybackVideo}`))}async getVideoStats(){for(const[t,i]of this.remoteVideoTracks.get()){if(!i)continue;const s=await i.getRTCStatsReport();if(!s)continue;const r=this.videoStatsParser.parse(s);if(r)return r}}close(){super.close()}_fail(){super._fail()}async init(t){await super.init(t),this._roomConn.on(Ce.DataReceived,async(i,s)=>{if(!s)return $t("LK: Ignoring received data message with no participant. This can happen when the message is sent before connection completes or if the message comes from the server: ",i);if(s.identity!==this._rovRoomName)return;const r=s.identity;this.lastMsgRecivedTimestamp=ti(),this.latestRecivedDataMessage.set({senderId:r,msgBytes:i})}).on(Ce.Connected,()=>{const i=this._roomConn.remoteParticipants.get(this._rovRoomName);i&&this.subscribeToTracks(i),this.isLivestreamRecording.set(this._roomConn.isRecording)}).on(Ce.ParticipantConnected,i=>{i.identity===this._rovRoomName&&(Lt("LK: ROV Participant connected: ",i.identity),this.subscribeToTracks(i))}).on(Ce.ParticipantDisconnected,i=>{i.identity===this._rovRoomName&&this.connectionState.get()===Dt.connected&&(Lt("LK: ROV Participant disconnected: ",i.identity),cn("ROV is offline"))}).on(Ce.TrackPublished,(i,s)=>{Lt("LK: ROV Participant track published: ",s.identity,i.kind,i.trackSid),this.subscribeToTracks(s)}).on(Ce.TrackSubscribed,(i,s,r)=>{if(i.kind!==xe.Kind.Video)return $t("LK: Subscribed to unknown track kind: ",i.kind,i.source);this.remoteVideoTracks.update(a=>{var o;if(a.has(i.source)){if(a.get(i.source)==i)return;$t("LK: already subscribed to video track "+i.source+", unsubscribing from old track"),(o=a.get(i.source))==null||o.stop()}return Fi("LK: subscribed to video",i.source),a.set(i.source,i),a}),i.on("upstreamPaused",()=>{Fi("LK: video upstream paused")}),i.on("muted",()=>{Fi("LK: video muted")}),i.on("ended",()=>{Fi("LK: video ended")}),this.isLivestreamRecording.set(this._roomConn.isRecording)}).on(Ce.TrackUnsubscribed,(i,s,r)=>{Fi("LK: Unsubscribed from track",s.source,s.trackSid," from participant: ",r.identity)}).on(Ce.Disconnected,i=>{i===Kn.DUPLICATE_IDENTITY&&Fy.update(s=>(s.add(this.getLivekitIdentitiy()),s))}).on(Ce.RecordingStatusChanged,i=>{Fi("LK: RecordingStatusChanged ",i),this.isLivestreamRecording.set(i)})}checkIfLivestreamRecording(){return this.isLivestreamRecording.set(this._roomConn.isRecording),this.isLivestreamRecording.get()}}function cE(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Zp={exports:{}},hf,kv;function uD(){if(kv)return hf;kv=1;var n=1e3,e=n*60,t=e*60,i=t*24,s=i*7,r=i*365.25;hf=function(u,d){d=d||{};var h=typeof u;if(h==="string"&&u.length>0)return a(u);if(h==="number"&&isFinite(u))return d.long?l(u):o(u);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(u))};function a(u){if(u=String(u),!(u.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(d){var h=parseFloat(d[1]),f=(d[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return h*r;case"weeks":case"week":case"w":return h*s;case"days":case"day":case"d":return h*i;case"hours":case"hour":case"hrs":case"hr":case"h":return h*t;case"minutes":case"minute":case"mins":case"min":case"m":return h*e;case"seconds":case"second":case"secs":case"sec":case"s":return h*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function o(u){var d=Math.abs(u);return d>=i?Math.round(u/i)+"d":d>=t?Math.round(u/t)+"h":d>=e?Math.round(u/e)+"m":d>=n?Math.round(u/n)+"s":u+"ms"}function l(u){var d=Math.abs(u);return d>=i?c(u,d,i,"day"):d>=t?c(u,d,t,"hour"):d>=e?c(u,d,e,"minute"):d>=n?c(u,d,n,"second"):u+" ms"}function c(u,d,h,f){var g=d>=h*1.5;return Math.round(u/h)+" "+f+(g?"s":"")}return hf}function dD(n){t.debug=t,t.default=t,t.coerce=l,t.disable=r,t.enable=s,t.enabled=a,t.humanize=uD(),t.destroy=c,Object.keys(n).forEach(u=>{t[u]=n[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let d=0;for(let h=0;h<u.length;h++)d=(d<<5)-d+u.charCodeAt(h),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(u){let d,h=null,f,g;function v(...m){if(!v.enabled)return;const _=v,y=Number(new Date),b=y-(d||y);_.diff=b,_.prev=d,_.curr=y,d=y,m[0]=t.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");let p=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,(E,C)=>{if(E==="%%")return"%";p++;const M=t.formatters[C];if(typeof M=="function"){const I=m[p];E=M.call(_,I),m.splice(p,1),p--}return E}),t.formatArgs.call(_,m),(_.log||t.log).apply(_,m)}return v.namespace=u,v.useColors=t.useColors(),v.color=t.selectColor(u),v.extend=i,v.destroy=t.destroy,Object.defineProperty(v,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(f!==t.namespaces&&(f=t.namespaces,g=t.enabled(u)),g),set:m=>{h=m}}),typeof t.init=="function"&&t.init(v),v}function i(u,d){const h=t(this.namespace+(typeof d>"u"?":":d)+u);return h.log=this.log,h}function s(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];let d;const h=(typeof u=="string"?u:"").split(/[\s,]+/),f=h.length;for(d=0;d<f;d++)h[d]&&(u=h[d].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.slice(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function r(){const u=[...t.names.map(o),...t.skips.map(o).map(d=>"-"+d)].join(",");return t.enable(""),u}function a(u){if(u[u.length-1]==="*")return!0;let d,h;for(d=0,h=t.skips.length;d<h;d++)if(t.skips[d].test(u))return!1;for(d=0,h=t.names.length;d<h;d++)if(t.names[d].test(u))return!0;return!1}function o(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function l(u){return u instanceof Error?u.stack||u.message:u}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var hD=dD;(function(n,e){var t={};e.formatArgs=s,e.save=r,e.load=a,e.useColors=i,e.storage=o(),e.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function i(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;c.splice(1,0,u,"color: inherit");let d=0,h=0;c[0].replace(/%[a-zA-Z%]/g,f=>{f!=="%%"&&(d++,f==="%c"&&(h=d))}),c.splice(h,0,u)}e.log=console.debug||console.log||(()=>{});function r(c){try{c?e.storage.setItem("debug",c):e.storage.removeItem("debug")}catch{}}function a(){let c;try{c=e.storage.getItem("debug")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=t.DEBUG),c}function o(){try{return localStorage}catch{}}n.exports=hD(e);const{formatters:l}=n.exports;l.j=function(c){try{return JSON.stringify(c)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(Zp,Zp.exports);var fD=Zp.exports;const pD=cE(fD),dr=typeof window<"u"?window:self,$p=dr.RTCPeerConnection||dr.mozRTCPeerConnection||dr.webkitRTCPeerConnection,mD=dr.RTCSessionDescription||dr.mozRTCSessionDescription||dr.webkitRTCSessionDescription,gD=dr.RTCIceCandidate||dr.mozRTCIceCandidate||dr.webkitRTCIceCandidate;var Ig={exports:{}},Co=typeof Reflect=="object"?Reflect:null,Mv=Co&&typeof Co.apply=="function"?Co.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)},ku;Co&&typeof Co.ownKeys=="function"?ku=Co.ownKeys:Object.getOwnPropertySymbols?ku=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:ku=function(e){return Object.getOwnPropertyNames(e)};function _D(n){console&&console.warn&&console.warn(n)}var lE=Number.isNaN||function(e){return e!==e};function bn(){bn.init.call(this)}Ig.exports=bn;Ig.exports.once=TD;bn.EventEmitter=bn;bn.prototype._events=void 0;bn.prototype._eventsCount=0;bn.prototype._maxListeners=void 0;var xv=10;function Md(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(bn,"defaultMaxListeners",{enumerable:!0,get:function(){return xv},set:function(n){if(typeof n!="number"||n<0||lE(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");xv=n}});bn.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};bn.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||lE(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function uE(n){return n._maxListeners===void 0?bn.defaultMaxListeners:n._maxListeners}bn.prototype.getMaxListeners=function(){return uE(this)};bn.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var s=e==="error",r=this._events;if(r!==void 0)s=s&&r.error===void 0;else if(!s)return!1;if(s){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var l=r[e];if(l===void 0)return!1;if(typeof l=="function")Mv(l,this,t);else for(var c=l.length,u=mE(l,c),i=0;i<c;++i)Mv(u[i],this,t);return!0};function dE(n,e,t,i){var s,r,a;if(Md(t),r=n._events,r===void 0?(r=n._events=Object.create(null),n._eventsCount=0):(r.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),r=n._events),a=r[e]),a===void 0)a=r[e]=t,++n._eventsCount;else if(typeof a=="function"?a=r[e]=i?[t,a]:[a,t]:i?a.unshift(t):a.push(t),s=uE(n),s>0&&a.length>s&&!a.warned){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=n,o.type=e,o.count=a.length,_D(o)}return n}bn.prototype.addListener=function(e,t){return dE(this,e,t,!1)};bn.prototype.on=bn.prototype.addListener;bn.prototype.prependListener=function(e,t){return dE(this,e,t,!0)};function vD(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function hE(n,e,t){var i={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},s=vD.bind(i);return s.listener=t,i.wrapFn=s,s}bn.prototype.once=function(e,t){return Md(t),this.on(e,hE(this,e,t)),this};bn.prototype.prependOnceListener=function(e,t){return Md(t),this.prependListener(e,hE(this,e,t)),this};bn.prototype.removeListener=function(e,t){var i,s,r,a,o;if(Md(t),s=this._events,s===void 0)return this;if(i=s[e],i===void 0)return this;if(i===t||i.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,i.listener||t));else if(typeof i!="function"){for(r=-1,a=i.length-1;a>=0;a--)if(i[a]===t||i[a].listener===t){o=i[a].listener,r=a;break}if(r<0)return this;r===0?i.shift():bD(i,r),i.length===1&&(s[e]=i[0]),s.removeListener!==void 0&&this.emit("removeListener",e,o||t)}return this};bn.prototype.off=bn.prototype.removeListener;bn.prototype.removeAllListeners=function(e){var t,i,s;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var r=Object.keys(i),a;for(s=0;s<r.length;++s)a=r[s],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=i[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this};function fE(n,e,t){var i=n._events;if(i===void 0)return[];var s=i[e];return s===void 0?[]:typeof s=="function"?t?[s.listener||s]:[s]:t?yD(s):mE(s,s.length)}bn.prototype.listeners=function(e){return fE(this,e,!0)};bn.prototype.rawListeners=function(e){return fE(this,e,!1)};bn.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):pE.call(n,e)};bn.prototype.listenerCount=pE;function pE(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}bn.prototype.eventNames=function(){return this._eventsCount>0?ku(this._events):[]};function mE(n,e){for(var t=new Array(e),i=0;i<e;++i)t[i]=n[i];return t}function bD(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function yD(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function TD(n,e){return new Promise(function(t,i){function s(a){n.removeListener(e,r),i(a)}function r(){typeof n.removeListener=="function"&&n.removeListener("error",s),t([].slice.call(arguments))}gE(n,e,r,{once:!0}),e!=="error"&&SD(n,s,{once:!0})})}function SD(n,e,t){typeof n.on=="function"&&gE(n,"error",e,t)}function gE(n,e,t,i){if(typeof n.on=="function")i.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function s(r){i.once&&n.removeEventListener(e,s),t(r)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var ED=Ig.exports,AD=typeof queueMicrotask=="function"?queueMicrotask:n=>Promise.resolve().then(n),CD=class{constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return this.buffer[this.btm]===void 0}};const Iv=CD;var wD=class{constructor(e){this.hwm=e||16,this.head=new Iv(this.hwm),this.tail=this.head,this.length=0}clear(){this.head=this.tail,this.head.clear(),this.length=0}push(e){if(this.length++,!this.head.push(e)){const t=this.head;this.head=t.next=new Iv(2*this.head.buffer.length),this.head.push(e)}}shift(){this.length!==0&&this.length--;const e=this.tail.shift();if(e===void 0&&this.tail.next){const t=this.tail.next;return this.tail.next=null,this.tail=t,this.tail.shift()}return e}peek(){const e=this.tail.peek();return e===void 0&&this.tail.next?this.tail.next.peek():e}isEmpty(){return this.length===0}},_E=class{constructor(e){this.decoder=new TextDecoder(e==="utf16le"?"utf16-le":e)}decode(e){return this.decoder.decode(e,{stream:!0})}flush(){return this.decoder.decode(new Uint8Array(0))}};const RD=_E,kD=_E;var MD=class{constructor(e="utf8"){switch(this.encoding=xD(e),this.encoding){case"utf8":this.decoder=new kD;break;case"utf16le":case"base64":throw new Error("Unsupported encoding: "+this.encoding);default:this.decoder=new RD(this.encoding)}}push(e){return typeof e=="string"?e:this.decoder.decode(e)}write(e){return this.push(e)}end(e){let t="";return e&&(t=this.push(e)),t+=this.decoder.flush(),t}};function xD(n){switch(n=n.toLowerCase(),n){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return n;default:throw new Error("Unknown encoding: "+n)}}const{EventEmitter:ID}=ED,xd=new Error("Stream was destroyed"),ff=new Error("Premature close"),vE=AD,bE=wD,PD=MD,Dn=(1<<29)-1,Fa=1,Pg=2,ka=4,Jc=8,yE=Dn^Fa,ND=Dn^Pg,ol=16,Qc=32,Qo=64,Kr=128,cl=256,Ng=512,Ma=1024,em=2048,Dg=4096,Lg=8192,Ts=16384,wo=32768,Id=65536,xa=131072,TE=cl|Ng,DD=ol|Id,LD=Qo|ol,OD=Dg|Kr,Og=cl|xa,UD=Dn^ol,FD=Dn^Qo,BD=Dn^(Qo|Id),Pv=Dn^Id,VD=Dn^cl,GD=Dn^(Kr|Lg),zD=Dn^Ma,Nv=Dn^TE,SE=Dn^wo,HD=Dn^Qc,EE=Dn^xa,WD=Dn^Og,ta=1<<18,Uo=2<<18,ll=4<<18,Ia=8<<18,ul=16<<18,Ba=32<<18,tm=64<<18,Ro=128<<18,Ug=256<<18,Fo=512<<18,Pd=1024<<18,AE=Dn^(ta|Ug),CE=Dn^ll,jD=Dn^Fo,KD=Dn^ul,qD=Dn^Ia,wE=Dn^Ro,XD=Dn^Uo,RE=Dn^Pd,Zc=ol|ta,kE=Dn^Zc,Fg=Ts|Ba,pr=ka|Jc|Pg,ji=pr|Fa,ME=pr|Fg,YD=CE&FD,Bg=Ro|wo,JD=Bg&kE,xE=ji|JD,QD=ji|Ma|Ts,Dv=ji|Ts|Kr,ZD=ji|Ma|Kr,$D=ji|Dg|Kr|Lg,eL=ji|ol|Ma|Ts|Id|xa,tL=pr|Ma|Ts,nL=Qc|ji|wo|Qo,iL=ji|Fo|Ba,sL=Ia|ul,IE=Ia|ta,rL=Ia|ul|ji|ta,Lv=ji|ta|Ia|Pd,aL=ll|ta,oL=ta|Ug,cL=ji|Fo|IE|Ba,lL=ul|pr|Fo|Ba,uL=Uo|ji|Ro|ll,Cl=Symbol.asyncIterator||Symbol("asyncIterator");class PE{constructor(e,{highWaterMark:t=16384,map:i=null,mapWritable:s,byteLength:r,byteLengthWritable:a}={}){this.stream=e,this.queue=new bE,this.highWaterMark=t,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=a||r||BE,this.map=s||i,this.afterWrite=gL.bind(this),this.afterUpdateNextTick=bL.bind(this)}get ended(){return(this.stream._duplexState&Ba)!==0}push(e){return this.map!==null&&(e=this.map(e)),this.buffered+=this.byteLength(e),this.queue.push(e),this.buffered<this.highWaterMark?(this.stream._duplexState|=Ia,!0):(this.stream._duplexState|=sL,!1)}shift(){const e=this.queue.shift();return this.buffered-=this.byteLength(e),this.buffered===0&&(this.stream._duplexState&=qD),e}end(e){typeof e=="function"?this.stream.once("finish",e):e!=null&&this.push(e),this.stream._duplexState=(this.stream._duplexState|Fo)&CE}autoBatch(e,t){const i=[],s=this.stream;for(i.push(e);(s._duplexState&Lv)===IE;)i.push(s._writableState.shift());if(s._duplexState&ji)return t(null);s._writev(i,t)}update(){const e=this.stream;e._duplexState|=Uo;do{for(;(e._duplexState&Lv)===Ia;){const t=this.shift();e._duplexState|=oL,e._write(t,this.afterWrite)}e._duplexState&aL||this.updateNonPrimary()}while(this.continueUpdate()===!0);e._duplexState&=XD}updateNonPrimary(){const e=this.stream;if((e._duplexState&cL)===Fo){e._duplexState=(e._duplexState|ta)&jD,e._final(mL.bind(this));return}if((e._duplexState&pr)===ka){e._duplexState&Bg||(e._duplexState|=Zc,e._destroy(NE.bind(this)));return}(e._duplexState&xE)===Fa&&(e._duplexState=(e._duplexState|Zc)&yE,e._open(DE.bind(this)))}continueUpdate(){return this.stream._duplexState&Ro?(this.stream._duplexState&=wE,!0):!1}updateCallback(){(this.stream._duplexState&uL)===ll?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&Ro||(this.stream._duplexState|=Ro,this.stream._duplexState&Uo||vE(this.afterUpdateNextTick))}}class dL{constructor(e,{highWaterMark:t=16384,map:i=null,mapReadable:s,byteLength:r,byteLengthReadable:a}={}){this.stream=e,this.queue=new bE,this.highWaterMark=t===0?1:t,this.buffered=0,this.readAhead=t>0,this.error=null,this.pipeline=null,this.byteLength=a||r||BE,this.map=s||i,this.pipeTo=null,this.afterRead=_L.bind(this),this.afterUpdateNextTick=vL.bind(this)}get ended(){return(this.stream._duplexState&Ts)!==0}pipe(e,t){if(this.pipeTo!==null)throw new Error("Can only pipe to one destination");if(typeof t!="function"&&(t=null),this.stream._duplexState|=Ng,this.pipeTo=e,this.pipeline=new fL(this.stream,e,t),t&&this.stream.on("error",Ov),el(e))e._writableState.pipeline=this.pipeline,t&&e.on("error",Ov),e.on("finish",this.pipeline.finished.bind(this.pipeline));else{const i=this.pipeline.done.bind(this.pipeline,e),s=this.pipeline.done.bind(this.pipeline,e,null);e.on("error",i),e.on("close",s),e.on("finish",this.pipeline.finished.bind(this.pipeline))}e.on("drain",pL.bind(this)),this.stream.emit("piping",e),e.emit("pipe",this.stream)}push(e){const t=this.stream;return e===null?(this.highWaterMark=0,t._duplexState=(t._duplexState|Ma)&BD,!1):this.map!==null&&(e=this.map(e),e===null)?(t._duplexState&=Pv,this.buffered<this.highWaterMark):(this.buffered+=this.byteLength(e),this.queue.push(e),t._duplexState=(t._duplexState|Kr)&Pv,this.buffered<this.highWaterMark)}shift(){const e=this.queue.shift();return this.buffered-=this.byteLength(e),this.buffered===0&&(this.stream._duplexState&=GD),e}unshift(e){const t=[this.map!==null?this.map(e):e];for(;this.buffered>0;)t.push(this.shift());for(let i=0;i<t.length-1;i++){const s=t[i];this.buffered+=this.byteLength(s),this.queue.push(s)}this.push(t[t.length-1])}read(){const e=this.stream;if((e._duplexState&Dv)===Kr){const t=this.shift();return this.pipeTo!==null&&this.pipeTo.write(t)===!1&&(e._duplexState&=Nv),e._duplexState&em&&e.emit("data",t),t}return this.readAhead===!1&&(e._duplexState|=xa,this.updateNextTick()),null}drain(){const e=this.stream;for(;(e._duplexState&Dv)===Kr&&e._duplexState&TE;){const t=this.shift();this.pipeTo!==null&&this.pipeTo.write(t)===!1&&(e._duplexState&=Nv),e._duplexState&em&&e.emit("data",t)}}update(){const e=this.stream;e._duplexState|=Qc;do{for(this.drain();this.buffered<this.highWaterMark&&(e._duplexState&eL)===xa;)e._duplexState|=DD,e._read(this.afterRead),this.drain();(e._duplexState&$D)===OD&&(e._duplexState|=Lg,e.emit("readable")),e._duplexState&LD||this.updateNonPrimary()}while(this.continueUpdate()===!0);e._duplexState&=HD}updateNonPrimary(){const e=this.stream;if((e._duplexState&ZD)===Ma&&(e._duplexState=(e._duplexState|Ts)&zD,e.emit("end"),(e._duplexState&ME)===Fg&&(e._duplexState|=ka),this.pipeTo!==null&&this.pipeTo.end()),(e._duplexState&pr)===ka){e._duplexState&Bg||(e._duplexState|=Zc,e._destroy(NE.bind(this)));return}(e._duplexState&xE)===Fa&&(e._duplexState=(e._duplexState|Zc)&yE,e._open(DE.bind(this)))}continueUpdate(){return this.stream._duplexState&wo?(this.stream._duplexState&=SE,!0):!1}updateCallback(){(this.stream._duplexState&nL)===Qo?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&wo||(this.stream._duplexState|=wo,this.stream._duplexState&Qc||vE(this.afterUpdateNextTick))}}class hL{constructor(e){this.data=null,this.afterTransform=TL.bind(e),this.afterFinal=null}}class fL{constructor(e,t,i){this.from=e,this.to=t,this.afterPipe=i,this.error=null,this.pipeToFinished=!1}finished(){this.pipeToFinished=!0}done(e,t){if(t&&(this.error=t),e===this.to&&(this.to=null,this.from!==null)){(!(this.from._duplexState&Ts)||!this.pipeToFinished)&&this.from.destroy(this.error||new Error("Writable stream closed prematurely"));return}if(e===this.from&&(this.from=null,this.to!==null)){e._duplexState&Ts||this.to.destroy(this.error||new Error("Readable stream closed before ending"));return}this.afterPipe!==null&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null}}function pL(){this.stream._duplexState|=Ng,this.updateCallback()}function mL(n){const e=this.stream;n&&e.destroy(n),e._duplexState&pr||(e._duplexState|=Ba,e.emit("finish")),(e._duplexState&ME)===Fg&&(e._duplexState|=ka),e._duplexState&=AE,e._duplexState&Uo?this.updateNextTick():this.update()}function NE(n){const e=this.stream;!n&&this.error!==xd&&(n=this.error),n&&e.emit("error",n),e._duplexState|=Jc,e.emit("close");const t=e._readableState,i=e._writableState;if(t!==null&&t.pipeline!==null&&t.pipeline.done(e,n),i!==null){for(;i.drains!==null&&i.drains.length>0;)i.drains.shift().resolve(!1);i.pipeline!==null&&i.pipeline.done(e,n)}}function gL(n){const e=this.stream;n&&e.destroy(n),e._duplexState&=AE,this.drains!==null&&yL(this.drains),(e._duplexState&rL)===ul&&(e._duplexState&=KD,(e._duplexState&tm)===tm&&e.emit("drain")),this.updateCallback()}function _L(n){n&&this.stream.destroy(n),this.stream._duplexState&=UD,this.readAhead===!1&&!(this.stream._duplexState&cl)&&(this.stream._duplexState&=EE),this.updateCallback()}function vL(){this.stream._duplexState&Qc||(this.stream._duplexState&=SE,this.update())}function bL(){this.stream._duplexState&Uo||(this.stream._duplexState&=wE,this.update())}function yL(n){for(let e=0;e<n.length;e++)--n[e].writes===0&&(n.shift().resolve(!0),e--)}function DE(n){const e=this.stream;n&&e.destroy(n),e._duplexState&ka||(e._duplexState&QD||(e._duplexState|=Qo),e._duplexState&iL||(e._duplexState|=ll),e.emit("open")),e._duplexState&=kE,e._writableState!==null&&e._writableState.updateCallback(),e._readableState!==null&&e._readableState.updateCallback()}function TL(n,e){e!=null&&this.push(e),this._writableState.afterWrite(n)}function SL(n){this._readableState!==null&&(n==="data"&&(this._duplexState|=em|Og,this._readableState.updateNextTick()),n==="readable"&&(this._duplexState|=Dg,this._readableState.updateNextTick())),this._writableState!==null&&n==="drain"&&(this._duplexState|=tm,this._writableState.updateNextTick())}class Vg extends ID{constructor(e){super(),this._duplexState=0,this._readableState=null,this._writableState=null,e&&(e.open&&(this._open=e.open),e.destroy&&(this._destroy=e.destroy),e.predestroy&&(this._predestroy=e.predestroy),e.signal&&e.signal.addEventListener("abort",PL.bind(this))),this.on("newListener",SL)}_open(e){e(null)}_destroy(e){e(null)}_predestroy(){}get readable(){return this._readableState!==null?!0:void 0}get writable(){return this._writableState!==null?!0:void 0}get destroyed(){return(this._duplexState&Jc)!==0}get destroying(){return(this._duplexState&pr)!==0}destroy(e){this._duplexState&pr||(e||(e=xd),this._duplexState=(this._duplexState|ka)&YD,this._readableState!==null&&(this._readableState.highWaterMark=0,this._readableState.error=e),this._writableState!==null&&(this._writableState.highWaterMark=0,this._writableState.error=e),this._duplexState|=Pg,this._predestroy(),this._duplexState&=ND,this._readableState!==null&&this._readableState.updateNextTick(),this._writableState!==null&&this._writableState.updateNextTick())}}class $c extends Vg{constructor(e){super(e),this._duplexState|=Fa|Ba|xa,this._readableState=new dL(this,e),e&&(this._readableState.readAhead===!1&&(this._duplexState&=EE),e.read&&(this._read=e.read),e.eagerOpen&&this._readableState.updateNextTick(),e.encoding&&this.setEncoding(e.encoding))}setEncoding(e){const t=new PD(e),i=this._readableState.map||wL;return this._readableState.map=s,this;function s(r){const a=t.push(r);return a===""?null:i(a)}}_read(e){e(null)}pipe(e,t){return this._readableState.updateNextTick(),this._readableState.pipe(e,t),e}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(e){return this._readableState.updateNextTick(),this._readableState.push(e)}unshift(e){return this._readableState.updateNextTick(),this._readableState.unshift(e)}resume(){return this._duplexState|=Og,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=this._readableState.readAhead===!1?WD:VD,this}static _fromAsyncIterator(e,t){let i;const s=new $c({...t,read(a){e.next().then(r).then(a.bind(null,null)).catch(a)},predestroy(){i=e.return()},destroy(a){if(!i)return a(null);i.then(a.bind(null,null)).catch(a)}});return s;function r(a){a.done?s.push(null):s.push(a.value)}}static from(e,t){if(xL(e))return e;if(e[Cl])return this._fromAsyncIterator(e[Cl](),t);Array.isArray(e)||(e=e===void 0?[]:[e]);let i=0;return new $c({...t,read(s){this.push(i===e.length?null:e[i++]),s(null)}})}static isBackpressured(e){return(e._duplexState&tL)!==0||e._readableState.buffered>=e._readableState.highWaterMark}static isPaused(e){return(e._duplexState&cl)===0}[Cl](){const e=this;let t=null,i=null,s=null;return this.on("error",c=>{t=c}),this.on("readable",r),this.on("close",a),{[Cl](){return this},next(){return new Promise(function(c,u){i=c,s=u;const d=e.read();d!==null?o(d):e._duplexState&Jc&&o(null)})},return(){return l(null)},throw(c){return l(c)}};function r(){i!==null&&o(e.read())}function a(){i!==null&&o(null)}function o(c){s!==null&&(t?s(t):c===null&&!(e._duplexState&Ts)?s(xd):i({value:c,done:c===null}),s=i=null)}function l(c){return e.destroy(c),new Promise((u,d)=>{if(e._duplexState&Jc)return u({value:void 0,done:!0});e.once("close",function(){c?d(c):u({value:void 0,done:!0})})})}}}class LE extends Vg{constructor(e){super(e),this._duplexState|=Fa|Ts,this._writableState=new PE(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final),e.eagerOpen&&this._writableState.updateNextTick())}cork(){this._duplexState|=Pd}uncork(){this._duplexState&=RE,this._writableState.updateNextTick()}_writev(e,t){t(null)}_write(e,t){this._writableState.autoBatch(e,t)}_final(e){e(null)}static isBackpressured(e){return(e._duplexState&lL)!==0}static drained(e){if(e.destroyed)return Promise.resolve(!1);const t=e._writableState,s=(NL(e)?Math.min(1,t.queue.length):t.queue.length)+(e._duplexState&Ug?1:0);return s===0?Promise.resolve(!0):(t.drains===null&&(t.drains=[]),new Promise(r=>{t.drains.push({writes:s,resolve:r})}))}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}class Gg extends $c{constructor(e){super(e),this._duplexState=Fa|this._duplexState&xa,this._writableState=new PE(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final))}cork(){this._duplexState|=Pd}uncork(){this._duplexState&=RE,this._writableState.updateNextTick()}_writev(e,t){t(null)}_write(e,t){this._writableState.autoBatch(e,t)}_final(e){e(null)}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}class OE extends Gg{constructor(e){super(e),this._transformState=new hL(this),e&&(e.transform&&(this._transform=e.transform),e.flush&&(this._flush=e.flush))}_write(e,t){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=e:this._transform(e,this._transformState.afterTransform)}_read(e){if(this._transformState.data!==null){const t=this._transformState.data;this._transformState.data=null,e(null),this._transform(t,this._transformState.afterTransform)}else e(null)}destroy(e){super.destroy(e),this._transformState.data!==null&&(this._transformState.data=null,this._transformState.afterTransform())}_transform(e,t){t(null,e)}_flush(e){e(null)}_final(e){this._transformState.afterFinal=e,this._flush(AL.bind(this))}}class EL extends OE{}function AL(n,e){const t=this._transformState.afterFinal;if(n)return t(n);e!=null&&this.push(e),this.push(null),t(null)}function CL(...n){return new Promise((e,t)=>UE(...n,i=>{if(i)return t(i);e()}))}function UE(n,...e){const t=Array.isArray(n)?[...n,...e]:[n,...e],i=t.length&&typeof t[t.length-1]=="function"?t.pop():null;if(t.length<2)throw new Error("Pipeline requires at least 2 streams");let s=t[0],r=null,a=null;for(let c=1;c<t.length;c++)r=t[c],el(s)?s.pipe(r,l):(o(s,!0,c>1,l),s.pipe(r)),s=r;if(i){let c=!1;const u=el(r)||!!(r._writableState&&r._writableState.autoDestroy);r.on("error",d=>{a===null&&(a=d)}),r.on("finish",()=>{c=!0,u||i(a)}),u&&r.on("close",()=>i(a||(c?null:ff)))}return r;function o(c,u,d,h){c.on("error",h),c.on("close",f);function f(){if(c._readableState&&!c._readableState.ended||d&&c._writableState&&!c._writableState.ended)return h(ff)}}function l(c){if(!(!c||a)){a=c;for(const u of t)u.destroy(c)}}}function wL(n){return n}function FE(n){return!!n._readableState||!!n._writableState}function el(n){return typeof n._duplexState=="number"&&FE(n)}function RL(n){return!!n._readableState&&n._readableState.ended}function kL(n){return!!n._writableState&&n._writableState.ended}function ML(n,e={}){const t=n._readableState&&n._readableState.error||n._writableState&&n._writableState.error;return!e.all&&t===xd?null:t}function xL(n){return el(n)&&n.readable}function IL(n){return typeof n=="object"&&n!==null&&typeof n.byteLength=="number"}function BE(n){return IL(n)?n.byteLength:1024}function Ov(){}function PL(){this.destroy(new Error("Stream aborted."))}function NL(n){return n._writev!==LE.prototype._writev&&n._writev!==Gg.prototype._writev}var DL={pipeline:UE,pipelinePromise:CL,isStream:FE,isStreamx:el,isEnded:RL,isFinished:kL,getStreamError:ML,Stream:Vg,Writable:LE,Readable:$c,Duplex:Gg,Transform:OE,PassThrough:EL};function Uv(n,e){for(const t in e)Object.defineProperty(n,t,{value:e[t],enumerable:!0,configurable:!0});return n}function LL(n,e,t){if(!n||typeof n=="string")throw new TypeError("Please pass an Error to err-code");t||(t={}),typeof e=="object"&&(t=e,e=""),e&&(t.code=e);try{return Uv(n,t)}catch{t.message=n.message,t.stack=n.stack;const s=function(){};return s.prototype=Object.create(Object.getPrototypeOf(n)),Uv(new s,t)}}var OL=LL;const Ut=cE(OL);/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wärting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const Fv="0123456789abcdef",VE=[];for(let n=0;n<256;n++)VE[n]=Fv[n>>4&15]+Fv[n&15];const Bv=n=>{const e=n.length;let t="",i=0;for(;i<e;)t+=VE[n[i++]];return t};var Vv="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",UL=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var wl=0;wl<Vv.length;wl++)UL[Vv.charCodeAt(wl)]=wl;new TextDecoder;const FL=new TextEncoder,BL=n=>FL.encode(n),Gv=typeof window<"u"?window:self,nm=Gv.crypto||Gv.msCrypto||{};nm.subtle||nm.webkitSubtle;const zv=n=>{const e=new Uint8Array(n);return nm.getRandomValues(e)};/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const VL=pD("simple-peer"),pf=64*1024,GL=5*1e3,zL=5*1e3,HL=5*1e3;function Hv(n){return n.replace(/a=ice-options:trickle\s\n/g,"")}function WL(n){console.warn(n)}class $r extends DL.Duplex{constructor(t){t=Object.assign({allowHalfOpen:!1},t);super(t);Ne(this,"_pc");if(this.__objectMode=!!t.objectMode,this._id=Bv(zv(4)).slice(0,7),this._debug("new peer %o",t),this.channelName=t.initiator?t.channelName||Bv(zv(20)):null,this.initiator=t.initiator||!1,this.channelConfig=t.channelConfig||$r.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},$r.config,t.config),this.offerOptions=t.offerOptions||{},this.answerOptions=t.answerOptions||{},this.sdpTransform=t.sdpTransform||(i=>i),this.streams=t.streams||(t.stream?[t.stream]:[]),this.trickle=t.trickle!==void 0?t.trickle:!0,this.allowHalfTrickle=t.allowHalfTrickle!==void 0?t.allowHalfTrickle:!1,this.iceCompleteTimeout=t.iceCompleteTimeout||GL,this.iceRestartEnabled=t.iceRestartEnabled??(this.trickle===!0&&!t.wrtc?"onFailure":!1),this.iceRestartEnabled===!0&&(this.iceRestartEnabled="onFailure"),this.iceFailureRecoveryTimeout=t.iceFailureRecoveryTimeout??HL,this._iceFailureRecoveryTimer=null,this._destroying=!1,this._connected=!1,this._connecting=!1,this._connectedOnce=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,!$p)throw Ut(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceGatheringComplete=!1,this._iceGatheringCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._isRestartingIce=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new $p(this.config)}catch(i){this.__destroy(Ut(i,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=i=>{this._onIceCandidate(i)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(i=>{this.__destroy(Ut(i,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=i=>{this._setupData(i)},this.streams&&this.streams.forEach(i=>{this.addStream(i)}),this._pc.ontrack=i=>{this._onTrack(i)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(t){if(!this._destroying){if(this.destroyed)throw Ut(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof t=="string")try{t=JSON.parse(t)}catch{t={}}this._debug("signal()"),t.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),t.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(t.transceiverRequest.kind,t.transceiverRequest.init)),t.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(t.candidate):this._pendingCandidates.push(t.candidate)),t.sdp&&this._pc.setRemoteDescription(new mD(t)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(i=>{this._addIceCandidate(i)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(i=>{this.__destroy(Ut(i,"ERR_SET_REMOTE_DESCRIPTION"))}),!t.sdp&&!t.candidate&&!t.renegotiate&&!t.transceiverRequest&&this.__destroy(Ut(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(t){const i=new gD(t);this._pc.addIceCandidate(i).catch(s=>{!i.address||i.address.endsWith(".local")?WL("Ignoring unsupported ICE candidate."):this.__destroy(Ut(s,"ERR_ADD_ICE_CANDIDATE"))})}send(t){if(!this._destroying){if(this.destroyed)throw Ut(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(t)}}addTransceiver(t,i){if(!this._destroying){if(this.destroyed)throw Ut(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(t,i),this._needsNegotiation()}catch(s){this.__destroy(Ut(s,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:t,init:i}})}}addStream(t){if(!this._destroying){if(this.destroyed)throw Ut(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),t.getTracks().forEach(i=>{this.addTrack(i,t)})}}addTrack(t,i){if(this._destroying)return;if(this.destroyed)throw Ut(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const s=this._senderMap.get(t)||new Map;let r=s.get(i);if(!r)r=this._pc.addTrack(t,i),s.set(i,r),this._senderMap.set(t,s),this._needsNegotiation();else throw r.removed?Ut(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):Ut(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(t,i,s){if(this._destroying)return;if(this.destroyed)throw Ut(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const r=this._senderMap.get(t),a=r?r.get(s):null;if(!a)throw Ut(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");i&&this._senderMap.set(i,r),a.replaceTrack!=null?a.replaceTrack(i):this.__destroy(Ut(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(t,i){if(this._destroying)return;if(this.destroyed)throw Ut(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const s=this._senderMap.get(t),r=s?s.get(i):null;if(!r)throw Ut(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{r.removed=!0,this._pc.removeTrack(r)}catch(a){a.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(r):this.__destroy(Ut(a,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(t){if(!this._destroying){if(this.destroyed)throw Ut(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),t.getTracks().forEach(i=>{this.removeTrack(i,t)})}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,queueMicrotask(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this._destroying){if(this.destroyed)throw Ut(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}restartIce(){return this.destroyed||this._destroying?!1:this.initiator?this._isRestartingIce?(this._debug("Already restarting ice, ignoring restartIce()"),!1):(this._debug("Restarting ICE"),this._iceFailureRecoveryTimer!=null&&(clearTimeout(this._iceFailureRecoveryTimer),this._iceFailureRecoveryTimer=null,this._startIceFailureRecoveryTimeout()),this._iceGatheringComplete=!1,clearTimeout(this._iceGatheringCompleteTimer),this._iceGatheringCompleteTimer=null,this._isNegotiating=!1,this._isRestartingIce=!0,this._pc.restartIce&&this._pc.restartIce(),this._needsNegotiation(),!0):(this._debug("restartIce() only works for the initiator"),!1)}_startIceFailureRecoveryTimeout(){this.destroyed||this._destroying||this._iceFailureRecoveryTimer==null&&(this._debug("started iceFailureRecovery timeout"),this._iceGatheringComplete=!1,clearTimeout(this._iceGatheringCompleteTimer),this._iceGatheringCompleteTimer=null,this._iceFailureRecoveryTimer=setTimeout(()=>{const t=this._pc.iceConnectionState,i=this._pc.iceGatheringState;this._debug("checking iceFailureRecovery timeout",t,i,this._iceGatheringComplete),!(t==="connected"||t==="completed")&&(this._debug("iceFailureRecovery timeout completed - failed"),this.__destroy(Ut(new Error("Ice connection recovery failed."),"ERR_ICE_CONNECTION_FAILURE")))},this.iceFailureRecoveryTimeout))}_final(t){this._readableState.ended||this.push(null),t(null)}__destroy(t){this.end(),this._destroy(()=>{},t)}_destroy(t,i){this.destroyed||this._destroying||(this._destroying=!0,this._debug("destroying (error: %s)",i&&(i.message||i)),setTimeout(()=>{if(this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,i&&this.emit("error",i),t()},0))}_setupData(t){if(!t.channel)return this.__destroy(Ut(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=t.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=pf),this.channelName=this._channel.label,this._channel.onmessage=s=>{this._onChannelMessage(s)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=s=>{const r=s.error instanceof Error?s.error:new Error(`Datachannel error: ${s.message} ${s.filename}:${s.lineno}:${s.colno}`);this.__destroy(Ut(r,"ERR_DATA_CHANNEL"))};let i=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(i&&this._onChannelClose(),i=!0):i=!1},zL)}_write(t,i){if(this.destroyed)return i(Ut(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(t)}catch(s){return this.__destroy(Ut(s,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>pf?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=i):i(null)}else this._debug("write before connect"),this._chunk=t,this._cb=i}_onFinish(){if(this.destroyed)return;const t=()=>{setTimeout(()=>this.__destroy(),1e3)};this._connected?t():this.once("connect",t)}_startIceCompleteTimeout(){this.destroyed||this._iceGatheringCompleteTimer||(this._debug("started iceComplete timeout"),this._iceGatheringCompleteTimer=setTimeout(()=>{this._iceGatheringComplete||(this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this._onIceGatheringComplete())},this.iceCompleteTimeout))}_createOffer(){if(this.destroyed)return;const t=Object.assign({},this.offerOptions);this._isRestartingIce&&(this.offerOptions.iceRestart=!0),this._pc.createOffer(t).then(i=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(i.sdp=Hv(i.sdp)),i.sdp=this.sdpTransform(i.sdp);const s=()=>{if(this.destroyed)return;const o=this._pc.localDescription||i;this._debug("signal"),this.emit("signal",{type:o.type,sdp:o.sdp})},r=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceGatheringComplete?s():this.once("_iceGatheringComplete",s))},a=o=>{this.__destroy(Ut(o,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(i).then(r).catch(a)}).catch(i=>{this.__destroy(Ut(i,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(t=>{!t.mid&&t.sender.track&&!t.requested&&(t.requested=!0,this.addTransceiver(t.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(t=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(t.sdp=Hv(t.sdp)),t.sdp=this.sdpTransform(t.sdp);const i=()=>{if(this.destroyed)return;const a=this._pc.localDescription||t;this._debug("signal"),this.emit("signal",{type:a.type,sdp:a.sdp}),this.initiator||this._requestMissingTransceivers()},s=()=>{this.destroyed||(this.trickle||this._iceGatheringComplete?i():this.once("_iceGatheringComplete",i))},r=a=>{this.__destroy(Ut(a,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(t).then(s).catch(r)}).catch(t=>{this.__destroy(Ut(t,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){if(!(this.destroyed||this._destroying)){if(this._debug("_onConnectionStateChange "+this._pc.connectionState),this._pc.connectionState!=="connected"&&(this._connected=!1),this._pc.connectionState==="failed")if(this.iceRestartEnabled||this._isRestartingIce)this._startIceFailureRecoveryTimeout();else return this.__destroy(Ut(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"));(this._pc.connectionState==="failed"&&this.iceRestartEnabled==="onFailure"||this._pc.connectionState==="disconnected"&&this.iceRestartEnabled==="onDisconnect")&&this.initiator&&!this._isRestartingIce&&this.restartIce()}}_onIceStateChange(){if(this.destroyed)return;const t=this._pc.iceConnectionState,i=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",t,i),this.emit("iceStateChange",t,i),i==="complete"&&this._onIceGatheringComplete(),(t==="connected"||t==="completed")&&(this._iceFailureRecoveryTimer!=null&&(clearTimeout(this._iceFailureRecoveryTimer),this._iceFailureRecoveryTimer=null),this._pcReady=!0,this._isRestartingIce=!1,this._maybeReady()),t==="closed"?this.__destroy(Ut(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED")):t==="failed"&&!this.iceRestartEnabled&&!this._isRestartingIce?this.__destroy(Ut(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")):t==="failed"&&(this.iceRestartEnabled||this._isRestartingIce)&&this._startIceFailureRecoveryTimeout(),(t==="failed"&&this.iceRestartEnabled==="onFailure"||t==="disconnected"&&this.iceRestartEnabled==="onDisconnect")&&this.initiator&&!this._isRestartingIce&&this.restartIce()}_onIceGatheringComplete(){this._iceGatheringComplete||(this._debug("iceGatheringComplete"),this._iceGatheringComplete=!0,this.emit("_iceGatheringComplete"),clearTimeout(this._iceGatheringCompleteTimer),this._iceGatheringCompleteTimer=null)}getStats(t){const i=s=>(Object.prototype.toString.call(s.values)==="[object Array]"&&s.values.forEach(r=>{Object.assign(s,r)}),s);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(s=>{const r=[];s.forEach(a=>{r.push(i(a))}),t(null,r)},s=>t(s)):this._pc.getStats.length>0?this._pc.getStats(s=>{if(this.destroyed)return;const r=[];s.result().forEach(a=>{const o={};a.names().forEach(l=>{o[l]=a.stat(l)}),o.id=a.id,o.type=a.type,o.timestamp=a.timestamp,r.push(i(o))}),t(null,r)},s=>t(s)):t(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const t=()=>{this.destroyed||this._destroying||this.getStats((i,s)=>{if(this.destroyed||this._destroying)return;i&&(s=[]);const r={},a={},o={};let l=!1;s.forEach(u=>{(u.type==="remotecandidate"||u.type==="remote-candidate")&&(r[u.id]=u),(u.type==="localcandidate"||u.type==="local-candidate")&&(a[u.id]=u),(u.type==="candidatepair"||u.type==="candidate-pair")&&(o[u.id]=u)});const c=u=>{l=!0;let d=a[u.localCandidateId];d&&(d.ip||d.address)?(this.localAddress=d.ip||d.address,this.localPort=Number(d.port)):d&&d.ipAddress?(this.localAddress=d.ipAddress,this.localPort=Number(d.portNumber)):typeof u.googLocalAddress=="string"&&(d=u.googLocalAddress.split(":"),this.localAddress=d[0],this.localPort=Number(d[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let h=r[u.remoteCandidateId];h&&(h.ip||h.address)?(this.remoteAddress=h.ip||h.address,this.remotePort=Number(h.port)):h&&h.ipAddress?(this.remoteAddress=h.ipAddress,this.remotePort=Number(h.portNumber)):typeof u.googRemoteAddress=="string"&&(h=u.googRemoteAddress.split(":"),this.remoteAddress=h[0],this.remotePort=Number(h[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(s.forEach(u=>{u.type==="transport"&&u.selectedCandidatePairId&&c(o[u.selectedCandidatePairId]),(u.type==="googCandidatePair"&&u.googActiveConnection==="true"||(u.type==="candidatepair"||u.type==="candidate-pair")&&u.selected)&&c(u)}),!l&&(!Object.keys(o).length||Object.keys(a).length)){setTimeout(t,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(d){return this.__destroy(Ut(d,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const u=this._cb;this._cb=null,u(null)}this._connectedOnce?(this._debug("reconnect"),this.emit("reconnect")):(this._connectedOnce=!0,typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect"))})};t()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>pf||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(t=>{this._pc.removeTrack(t),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(t){this.destroyed||(t.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:t.candidate.candidate,sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid}}):!t.candidate&&!this._iceGatheringComplete&&this._onIceGatheringComplete(),t.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(t){if(this.destroyed)return;let i=t.data;i instanceof ArrayBuffer?i=new Uint8Array(i):this.__objectMode===!1&&(i=BL(i)),this.push(i)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const t=this._cb;this._cb=null,t(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.__destroy())}_onTrack(t){this.destroyed||t.streams.forEach(i=>{this._debug("on track"),this.emit("track",t.track,i),this._remoteTracks.push({track:t.track,stream:i}),!this._remoteStreams.some(s=>s.id===i.id)&&(this._remoteStreams.push(i),queueMicrotask(()=>{this._debug("on stream"),this.emit("stream",i)}))})}_debug(){const t=[].slice.call(arguments);t[0]="["+this._id+"] "+t[0],VL.apply(null,t)}}$r.WEBRTC_SUPPORT=!!$p;$r.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};$r.channelConfig={};let jL=0;class KL{constructor(e,t=[]){Ne(this,"lastMsgRecivedTimestamp");Ne(this,"connectionState",Ze(Dt.init));Ne(this,"latestRecivedDataMessage",Ze(null));Ne(this,"outgoingSignalingMessages",Ze(null));Ne(this,"remoteVideoStreams",Ze(new Map));Ne(this,"_p",null);Ne(this,"_spConfig",null);Ne(this,"_incomingSignalQueue",[]);Ne(this,"_consecutiveSignalMsgsProcessed",0);Ne(this,"_msgSendQueue",[]);Ne(this,"_reconnectAttemptCount",0);Ne(this,"_shouldReconnect");Ne(this,"_stopping",!1);Ne(this,"_startComplete",!1);Ne(this,"_initiator",!1);Ne(this,"_connectionId",-1);Ne(this,"_signalMsgSendCounter",0);Ne(this,"_signalMsgRecivedCounter",0);Ne(this,"_lastSignalMsgRecivedTimestamp",0);Ne(this,"_videoStatsParser",new oE);this._spConfig=Object.assign({},e,$r.config,{streams:t})}setStreamsEnabled(e){this.remoteVideoStreams.get().size!==0&&this.remoteVideoStreams.update(t=>(t.forEach(i=>{i&&i.getTracks().forEach(s=>s.enabled=e)}),t))}resetVideoStreamMap(){let e=this.remoteVideoStreams.get();this.remoteVideoStreams.set(new Map),e.forEach(t=>{t&&t.getTracks().forEach(i=>i.stop())})}start(e=!0,t=0,i=[]){if(this._startComplete=!1,this._p&&this.stop(),this._stopping=!1,this._shouldReconnect=e,i.length!==0&&(this._spConfig.streams=i),$t("SP: starting with opts: ",this._spConfig,jL++),this._spConfig.initiator&&(this._connectionId=wy()),this._signalMsgRecivedCounter=0,this._signalMsgSendCounter=0,this._p=new $r(this._spConfig),!this._p)return fs("Failed to create SimplePeer instance!");this._p._debug=(...s)=>Lt("SIMPLEPEER DEBUG: "+s[0],...s.slice(1)),this._reconnectAttemptCount=t,this._initiator=this._spConfig.initiator||!1,this.connectionState.set(Dt.connecting),this._p.on("signal",s=>{if(this._connectionId===-1){fs("SP sending signal message when connectionId is -1, this should not happen!");return}s=Object.assign({},s,{connId:this._connectionId,msgNum:this._signalMsgSendCounter}),this._signalMsgSendCounter++,Lt("SP: signal out",s),this.outgoingSignalingMessages.set(JSON.stringify(s))}),this._p.on("connect",()=>{li("SP: Connected!"),this._reconnectAttemptCount=0,this.connectionState.set(Dt.connected),this._emptySendMsgQueue()}),this._p.on("data",s=>{this.lastMsgRecivedTimestamp=ti(),this.latestRecivedDataMessage.set(s)}),this._p.on("stream",s=>{s.addEventListener,li("SP got video stream: ",s),this.remoteVideoStreams.update(r=>(r=new Map,r.set(s.id,s),r))}),this._p.on("iceStateChange",(s,r)=>{li(`SP: ICE State - connection: ${s}, gathering: ${r}`),s==="connected"||s==="completed"?this.setStreamsEnabled(!0):this.setStreamsEnabled(!1)}),this._p.on("close",()=>{this._initiator||this.resetConnectionStats(),$t("SP connection closed"),this.resetVideoStreamMap(),this._shouldReconnect||this.connectionState.set(Dt.disconnectedOk)}),this._p.on("end",()=>{this.resetVideoStreamMap(),li("SP: connection ended")}),this._p.on("pause",()=>{li("SP: connection paused")}),this._p.on("error",s=>{fs("SP: ERROR ",s),this.resetVideoStreamMap(),this._shouldReconnect=!1,this.connectionState.set(Dt.failed)}),setTimeout(()=>{this._startComplete=!0,this._processSignalMsgQueue()},0)}stop(){var e,t;this._stopping=!0,this._startComplete=!1,this.resetConnectionStats(),this.connectionState.set(Dt.disconnectedOk),this._shouldReconnect=!1,$t("SP: Stop",this._connectionId,(e=this._p)==null?void 0:e.destroyed,(t=this._p)==null?void 0:t.destroying),this._p&&this._p.destroy(),this._p=null}restartIce(){this._p&&this._p.restartIce()}async restart(e,t){var i,s;Lt("SP Restart",this._reconnectAttemptCount,e,this._connectionId,(i=this._p)==null?void 0:i.destroyed,(s=this._p)==null?void 0:s.destroying),this._reconnectAttemptCount++,this.stop(),this._connectionId=e||-1,await id(500*this._reconnectAttemptCount),Lt("SP Restart2",this._spConfig),this.start(this._shouldReconnect,this._reconnectAttemptCount),t&&this.ingestSignalingMsg(t)}checkAliveness(){if(this._initiator&&this._shouldReconnect&&!this._stopping&&this._lastSignalMsgRecivedTimestamp!==void 0&&!(this._lastSignalMsgRecivedTimestamp-ti()<2e3)){if(!this._p)return this.restart();if(this.connectionState.get()!==Dt.connected&&!this._p.isIceRestartInProgress())return this.restartIce()}}resetConnectionStats(){this._signalMsgRecivedCounter=0,this._signalMsgSendCounter=0,this._consecutiveSignalMsgsProcessed=0}changeMediaStream(e){if(!(!this._p||this._stopping===!0))try{Lt("SP: changeMediaStream replacing track",e.getVideoTracks()[0].getSettings());const t=this._p.streams[0],i=t.getVideoTracks()[0];this._p.replaceTrack(i,e.getVideoTracks()[0],t)}catch(t){fs("SP: changeMediaStream failed to replace track trying stream remove+add",t.message);for(const i of this._p.streams)this._p.removeStream(i);this._p.addStream(e)}}setCodecPreferences(e){var r,a,o;const t=((r=RTCRtpReceiver.getCapabilities("video"))==null?void 0:r.codecs)||[],i=this.sortCodecsByMimeTypes(t,e);if(li("SP: availReceiveCodecs",t,"sortedCodecs",i),!this._p)return;const s=((o=(a=this._p)==null?void 0:a._pc)==null?void 0:o.getTransceivers())||[];for(const l of s)l.setCodecPreferences(i);this._p.negotiate()}getCodecPreferences(){var t,i;if(!this._p)return;const e=((i=(t=this._p)==null?void 0:t._pc)==null?void 0:i.getTransceivers())||[];for(const s of e){const r=s.receiver.getParameters();if(r.codecs)return r.codecs.map(a=>a.mimeType)}}async getStats(){if(!this._p||!this._p._pc)return;const e=await new Promise((t,i)=>{(!this._p||!this._p._pc)&&i("No active simplePeer instance found!"),this._p.getStats((s,r)=>{s&&i(s),t(r)})});return this._videoStatsParser.parse(e)}getPlayoutDelay(){var t,i;if(!this._p)return;const e=((i=(t=this._p)==null?void 0:t._pc)==null?void 0:i.getTransceivers())||[];for(const s of e){if(!s.receiver)continue;const r=s.receiver;if(r.playoutDelayHint)return r.playoutDelayHint;if(r.jitterBufferTarget)return r.jitterBufferTarget/1e3}return 0}setPlayoutDelay(e){var i,s;if(!this._p)return;const t=((s=(i=this._p)==null?void 0:i._pc)==null?void 0:s.getTransceivers())||[];for(const r of t){if(!r.receiver)continue;const a=r.receiver;a.playoutDelayHint!==void 0?a.playoutDelayHint!==e&&(Lt("SP: Setting playoutDelayHint to "+e),a.playoutDelayHint=e):a.jitterBufferTarget!==void 0&&a.jitterBufferTarget!==e&&(Lt("SP: Setting jitterBufferTarget to "+e),a.jitterBufferTarget=e*1e3)}}sortCodecsByMimeTypes(e,t){return e.sort((i,s)=>{const r=t.indexOf(i.mimeType.toLowerCase()),a=t.indexOf(s.mimeType.toLowerCase()),o=r>=0?r:Number.MAX_VALUE,l=a>=0?a:Number.MAX_VALUE;return o-l})}ingestSignalingMsg(e){this._lastSignalMsgRecivedTimestamp=ti();try{const t=JSON.parse(e);if(t.msgNum===void 0||t.connId===void 0)return $t("SP: Ignoring Invalid Signal Message (no connId or msgNum)!",t);if(t.connId>this._connectionId){if($t("SP: Found Newer connid, fastforwarding!",t.connId,this._connectionId),this._consecutiveSignalMsgsProcessed=0,this._connectionId=t.connId,this._incomingSignalQueue=[],this._spConfig&&!this._initiator)return this.restart(t.connId,e)}else if(t.connId<this._connectionId){$t("SP: Ignoring Signal Message For Old connid (connId mismatch)!",t.connId,this._connectionId);return}li("SP: signal queued",t,t.msgNum,this._consecutiveSignalMsgsProcessed,t.connId,this._connectionId),this._incomingSignalQueue.push(t)}catch(t){$t("SP: Failed to parse json signal message: ",e,t.message)}this._processSignalMsgQueue()}sendMessage(e){this._msgSendQueue.push(e),this._emptySendMsgQueue()}_processSignalMsgQueue(){if(!(!this._p||this._stopping===!0||this._startComplete===!1))for(;this._incomingSignalQueue.length!=0;){const e=this._incomingSignalQueue.shift();li("SP: signal in",e,e.msgNum,this._consecutiveSignalMsgsProcessed,e.connId,this._connectionId),this._p.signal(e),this._consecutiveSignalMsgsProcessed++}}_emptySendMsgQueue(){if(!this._p||!this._p.connected)return!1;for(this._msgSendQueue.length;this._msgSendQueue.length>0;){const e=this._msgSendQueue.shift();try{this._p.send(e)}catch(t){fs("failed to send message over simplePeer data channel: ",t.message),this._msgSendQueue.unshift(e)}}}}var zt=(n=>(n.up="up",n.down="down",n.left="left",n.right="right",n))(zt||{}),or=(n=>(n.onOff="onOff",n.variable="variable",n))(or||{}),ga=(n=>(n.real="real",n.emulated="emulated",n.overlay="overlay",n))(ga||{}),ft=(n=>(n[n.A=0]="A",n[n.B=1]="B",n[n.X=2]="X",n[n.Y=3]="Y",n[n.LShoulder=4]="LShoulder",n[n.RShoulder=5]="RShoulder",n[n.LTrigger=6]="LTrigger",n[n.RTrigger=7]="RTrigger",n[n.Back=8]="Back",n[n.Start=9]="Start",n[n.LStick=10]="LStick",n[n.RStick=11]="RStick",n[n.DPadUp=12]="DPadUp",n[n.DPadDown=13]="DPadDown",n[n.DPadLeft=14]="DPadLeft",n[n.DPadRight=15]="DPadRight",n[n.Vendor=16]="Vendor",n))(ft||{}),Mu=(n=>(n.TapTarget="gpad-tap-target",n.ButtonIcon="gpad-btn-icon",n.ButtonShadow="gpad-shadow",n.ButtonHighlight="gpad-highlight",n.ButtonBackground="gpad-btn-bg",n.DirectionHighlight="gpad-direction-highlight",n.Thumbstick="gpad-thumbstick",n.GpadBaseShape="gpad-base",n.StickBaseShape="gpad-stick-base",n))(Mu||{});const Br=["button_1","button_2","button_3","button_4","shoulder_button_front_left","shoulder_button_front_right","shoulder_trigger_back_left","shoulder_trigger_back_right","select_button","start_button","stick_button_left","stick_button_right","dpad_up","dpad_down","dpad_left","dpad_right"],Wv=Br.map(n=>n+"_tap_target"),qL={dpad_up_left_tap_target:[12,14],dpad_up_right_tap_target:[12,15],dpad_down_left_tap_target:[13,14],dpad_down_right_tap_target:[13,15]};var XL=Object.defineProperty,YL=(n,e,t)=>e in n?XL(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,As=(n,e,t)=>YL(n,typeof e!="symbol"?e+"":e,t);class zg{constructor(e){As(this,"updateDelay"),As(this,"axisDeadZone"),As(this,"buttonConfigs"),As(this,"currentStateOfGamepads"),As(this,"gamepadConnectListeners"),As(this,"gamepadDisconnectListeners"),As(this,"gamepadButtonChangeListeners"),As(this,"gamepadAxisChangeListeners"),As(this,"_requestAnimationFrame"),As(this,"_getGamepads"),this.updateDelay=e.updateDelay||0,this.axisDeadZone=e.axisDeadZone||0,this.buttonConfigs=e.buttonConfigs||[],this.currentStateOfGamepads=[],this.gamepadConnectListeners=[],this.gamepadDisconnectListeners=[],this.gamepadButtonChangeListeners=[],this.gamepadAxisChangeListeners=[],navigator.gamepadInputEmulation="gamepad",this._requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,this._getGamepads=navigator.getGamepads||navigator.webkitGetGamepads||navigator.mozGetGamepads||navigator.msGetGamepads,(this.gamepadApiSupported()||navigator.getNativeGamepads!==void 0)&&this.tickLoop()}setButtonsConfig(e){this.buttonConfigs=e}setUpdateDelay(e){this.updateDelay=e}onGamepadConnect(e){return this.gamepadConnectListeners.push(e),window.addEventListener("gamepadconnected",e,!0),e}offGamepadConnect(e){this.gamepadConnectListeners=this.gamepadConnectListeners.filter(t=>t!==e),window.removeEventListener("gamepadconnected",e,!0)}onGamepadDisconnect(e){return this.gamepadDisconnectListeners.push(e),window.addEventListener("gamepaddisconnected",e,!0),e}offGamepadDisconnect(e){this.gamepadDisconnectListeners=this.gamepadDisconnectListeners.filter(t=>t!==e),window.removeEventListener("gamepaddisconnected",e,!0)}onGamepadAxisChange(e){return this.gamepadAxisChangeListeners.push(e),e}offGamepadAxisChange(e){this.gamepadAxisChangeListeners=this.gamepadAxisChangeListeners.filter(t=>t!==e)}onGamepadButtonChange(e){return this.gamepadButtonChangeListeners.push(e),e}offGamepadButtonChange(e){this.gamepadButtonChangeListeners=this.gamepadButtonChangeListeners.filter(t=>t!==e)}gamepadApiSupported(){const e=navigator.getNativeGamepads||navigator.getGamepads||navigator.webkitGetGamepads||navigator.mozGetGamepads||navigator.msGetGamepads;if(e!=null&&typeof e=="function")try{const t=e.apply(navigator);return t!=null&&(t[0]!==void 0||t.length!==0||window.isSecureContext)}catch{return!1}else return!1}getGamepads(){const e=navigator.getGamepads||navigator.webkitGetGamepads||navigator.mozGetGamepads||navigator.msGetGamepads;return e&&typeof e=="function"?e.apply(navigator)||[]:[]}getCurrentGamepadStates(e=!1){return e&&this.checkForGamepadChanges(),this.currentStateOfGamepads}cleanup(){this.updateDelay=-1,this.gamepadConnectListeners.forEach(e=>window.removeEventListener("gamepadconnected",e,!0)),this.gamepadDisconnectListeners.forEach(e=>window.removeEventListener("gamepaddisconnected",e,!0)),this.gamepadConnectListeners=[],this.gamepadDisconnectListeners=[],this.gamepadButtonChangeListeners=[],this.gamepadAxisChangeListeners=[]}tickLoop(){this.updateDelay<0||(this.checkForGamepadChanges(),this.updateDelay==0?requestAnimationFrame(this.tickLoop.bind(this)):setTimeout(()=>{requestAnimationFrame(this.tickLoop.bind(this))},this.updateDelay))}checkForGamepadChanges(){let e=this.getGamepads();for(var t=0;t<e.length;t++){let i=e[t];i&&(this.checkForAxisChanges(t,i),this.checkForButtonChanges(t,i),this.currentStateOfGamepads[t]=i)}}checkForAxisChanges(e,t){let i=t.axes;if(i.length==0)return;const s=this.currentStateOfGamepads[e];let r=(s==null?void 0:s.axes)||[],a=[],o,l=!1;for(o=0;o<i.length;o++){let c=i[o]||0,u=r[o]||0;if(c!=u){if(Math.abs(c)<this.axisDeadZone&&Math.abs(u)<this.axisDeadZone)continue;a[o]=!0,l=!0}else a[o]=!1}l&&this.gamepadAxisChangeListeners.forEach(c=>c(e,t,a))}checkForButtonChanges(e,t){let i=t.buttons;if(i.length==0)return;const s=this.currentStateOfGamepads[e],r=(s==null?void 0:s.buttons)||i,a=new Array(i.length).fill(!1);let o=!1;for(let l=0;l<i.length;l++){let c=!1;const u=i[l]||{pressed:!1,value:0,touched:!1},d=r[l]||{pressed:!1,value:0,touched:!1},h=this.buttonConfigs[l]||{},f={};u.touched&&!d.touched?(f.touchDown=!0,c=!0):!u.touched&&d.touched&&(f.touchUp=!0,c=!0),u.pressed&&!d.pressed?(f.pressed=!0,c=!0):!u.pressed&&d.pressed&&(f.released=!0,c=!0),h.fireWhileHolding&&u.pressed&&d.pressed&&(f.heldDown=!0,c=!0),u.value!=d.value&&(f.valueChanged=!0,c=!0),c?(o=!0,a[l]=f):a[l]=!1}o&&this.gamepadButtonChangeListeners.forEach(l=>l(e,t,a))}}var JL=Object.defineProperty,QL=(n,e,t)=>e in n?JL(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Xa=(n,e,t)=>QL(n,typeof e!="symbol"?e+"":e,t);class ZL{constructor(e,t){Xa(this,"config"),Xa(this,"apiWrapper"),Xa(this,"DefaultJoystickDisplayFunction",(r,a,o)=>{const l=r.movementRange;if(r.joystickElement.style.transform=`translate(${a*l}px,${o*l}px)`,r.highlights&&this.config.moveDirectionHighlightClass){const c=r.highlights[zt.up],u=r.highlights[zt.down],d=r.highlights[zt.left],h=r.highlights[zt.right];c&&o<-.1?c.classList.add(this.config.moveDirectionHighlightClass||""):c&&c.classList.remove(this.config.moveDirectionHighlightClass||""),u&&o>.1?u.classList.add(this.config.moveDirectionHighlightClass||""):u&&u.classList.remove(this.config.moveDirectionHighlightClass||""),d&&a<-.1?d.classList.add(this.config.moveDirectionHighlightClass||""):d&&d.classList.remove(this.config.moveDirectionHighlightClass||""),h&&a>.1?h.classList.add(this.config.moveDirectionHighlightClass||""):h&&h.classList.remove(this.config.moveDirectionHighlightClass||"")}}),Xa(this,"DefaultButtonDisplayFunction",(r,a,o,l,c,u)=>{const d=r.highlight;if(this.config.touchedHighlightClass&&d&&(c.touchDown?d.classList.add(this.config.touchedHighlightClass):c.touchUp&&d.classList.remove(this.config.touchedHighlightClass)),this.config.pressedHighlightClass&&d&&(c.pressed?d.classList.add(this.config.pressedHighlightClass):c.released&&d.classList.remove(this.config.pressedHighlightClass)),r.type==or.variable){const h=r.directionHighlight;if(this.config.moveDirectionHighlightClass&&h&&(c.pressed?h.classList.add(this.config.moveDirectionHighlightClass):c.released&&h.classList.remove(this.config.moveDirectionHighlightClass)),r.buttonElement){const f=r.direction==zt.left||r.direction==zt.right,g=r.direction==zt.right||r.direction==zt.down;r.buttonElement.style.transform=`translate${f?"X":"Y"}(${g?"":"-"}${a*r.movementRange}px)`}}}),Xa(this,"displayJoystickChanges",(r,a,o)=>{if(r!=this.config.gamepadIndex)return;const l=this.config.sticks;for(let c=0;c<l.length;c++){const u=l[c];if(u&&(u.xAxisIndex!==void 0&&o[u.xAxisIndex]||u.yAxisIndex!==void 0&&o[u.yAxisIndex])){const d=a.axes,h=u.xAxisIndex!==void 0&&d[u.xAxisIndex]||0,f=u.yAxisIndex!==void 0&&d[u.yAxisIndex]||0;this.config.joystickDisplayFunction?this.config.joystickDisplayFunction(u,h,f):this.DefaultJoystickDisplayFunction(u,h,f)}}}),Xa(this,"displayButtonChanges",(r,a,o)=>{if(r!=this.config.gamepadIndex)return;const l=this.config.buttons;for(let c=0;c<l.length;c++){const u=l[c],d=o[c];if(!u||Object.keys(u).length==0||!d||Object.keys(d).length==0)continue;const h=a.buttons[c].value,f=a.buttons[c].touched,g=a.buttons[c].pressed;this.config.buttonDisplayFunction?this.config.buttonDisplayFunction(u,h,f,g,d,c):this.DefaultButtonDisplayFunction(u,h,f,g,d,c)}});var i,s;this.config=Object.assign({gamepadIndex:0,buttons:[],sticks:[],touchedHighlightClass:"touched",pressedHighlightClass:"pressed",moveDirectionHighlightClass:"active"},e),this.apiWrapper=t||new zg({buttonConfigs:[],updateDelay:0}),((i=this.config.buttons)==null?void 0:i.length)!==0&&this.apiWrapper.onGamepadButtonChange(this.displayButtonChanges),((s=this.config.sticks)==null?void 0:s.length)!==0&&this.apiWrapper.onGamepadAxisChange(this.displayJoystickChanges)}Cleanup(){this.apiWrapper.offGamepadButtonChange(this.displayButtonChanges),this.apiWrapper.offGamepadAxisChange(this.displayJoystickChanges)}}function $L(n,e,t){const i=Math.sqrt(n*n+e*e);return i>t?{x:n/i,y:e/i}:{x:n/t,y:e/t}}function jv(n){if(n instanceof SVGGraphicsElement){n.getAttribute("transform")&&console.warn("VirtualGamepadLib: Setting Transform origin on an element that already has a transform attribute. This may break the transform!",n);const e=n.getBBox();n.style.transformOrigin=`${e.x+e.width/2}px ${e.y+e.height/2}px`}else if(n instanceof HTMLElement){console.warn("VirtualGamepadLib: Setting Transform origin on an element that is not an SVG element. This may break the transform!",n);const e=n.getBoundingClientRect();n.style.transformOrigin=`${e.width/2}px ${e.height/2}px`}}var eO=Object.defineProperty,tO=(n,e,t)=>e in n?eO(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Xi=(n,e,t)=>tO(n,typeof e!="symbol"?e+"":e,t);const Hg=18,Wg=4,GE=class xu{constructor(e){if(Xi(this,"getNativeGamepads"),Xi(this,"buttonPressThreshold",.1),Xi(this,"realGpadToPatchedIndexMap",[]),Xi(this,"patchedGpadToRealIndexMap",[]),Xi(this,"emulatedGamepads",[]),Xi(this,"emulatedGamepadsMetadata",[]),Xi(this,"undoEventPatch",()=>{}),Xi(this,"AddDisplayButtonEventListeners",this.AddButtonTouchEventListeners),Xi(this,"AddDisplayJoystickEventListeners",this.AddJoystickTouchEventListeners),Xi(this,"ClearDisplayButtonEventListeners",this.ClearButtonTouchEventListeners),Xi(this,"ClearDisplayJoystickEventListeners",this.ClearJoystickTouchEventListeners),this.buttonPressThreshold=e||this.buttonPressThreshold,xu.instanceRunning)throw new Error("Only one GamepadEmulator instance may exist at a time!");xu.instanceRunning=!0,this.undoEventPatch=this.monkeyPatchGamepadEvents(),this.monkeyPatchGetGamepads()}gamepadApiNativelySupported(){return!!this.getNativeGamepads&&!!this.getNativeGamepads.apply(navigator)}AddEmulatedGamepad(e,t,i=Hg,s=Wg){if((e===-1||!e&&e!==0)&&(e=this.nextEmptyEGpadIndex(t)),this.emulatedGamepads[e])return!1;const r={emulation:ga.emulated,connected:!0,timestamp:performance.now(),displayId:"Emulated Gamepad "+e,id:"Emulated Gamepad "+e+" (Xinput STANDARD GAMEPAD)",mapping:"standard",index:e,buttons:new Array(i).fill({pressed:!1,value:0,touched:!1},0,i),axes:new Array(s).fill(0,0,s),hapticActuators:[]};this.emulatedGamepads[e]=r,this.emulatedGamepadsMetadata[e]={overlayMode:t};const a=new Event("gamepadconnected");return a.gamepad=r,window.dispatchEvent(a),r}RemoveEmulatedGamepad(e){this.ClearButtonTouchEventListeners(e),this.ClearJoystickTouchEventListeners(e);var t=this.emulatedGamepads[e];if(t){delete this.emulatedGamepads[e],delete this.emulatedGamepadsMetadata[e];const i={...t,connected:!1,timestamp:performance.now()},s=new Event("gamepaddisconnected");s.gamepad=i,window.dispatchEvent(s)}else console.warn("GamepadEmulator Error: Cannot remove emulated gamepad. No emulated gamepad exists at index "+e)}PressButton(e,t,i,s){var r,a,o;if(this.emulatedGamepads[e]==null)throw new Error("Error: PressButton() - no emulated gamepad at index "+e+", pass a valid index, or call AddEmulatedGamepad() first to create an emulated gamepad at that index");const l=[...((r=this.emulatedGamepads[e])==null?void 0:r.buttons)||[]],c=i>this.buttonPressThreshold;if(Array.isArray(t)){const d=c||(s??((a=l[t[0]])==null?void 0:a.touched))||!1;for(var u=0;u<t.length;u++){const h=t[u];if(h<0||h>=this.emulatedGamepads[e].buttons.length){console.error("Error: PressButton() - button index "+h+" out of range, pass a valid index between 0 and "+(this.emulatedGamepads[e].buttons.length-1));continue}l[h]={pressed:c,value:i||0,touched:d}}}else{const d=c||(s??((o=l[t])==null?void 0:o.touched))||!1;if(t<0||t>=this.emulatedGamepads[e].buttons.length){console.error("Error: PressButton() - button index "+t+" out of range, pass a valid index between 0 and "+(this.emulatedGamepads[e].buttons.length-1));return}l[t]={pressed:c,value:i||0,touched:d}}Object.defineProperty(this.emulatedGamepads[e],"buttons",{value:l,enumerable:!0,configurable:!0})}MoveAxis(e,t,i){var s;if(this.emulatedGamepads[e]==null)throw new Error("Error: MoveAxis() - no emulated gamepad at index "+e+", pass a valid index, or call AddEmulatedGamepad() first to create an emulated gamepad at that index");const r=[...((s=this.emulatedGamepads[e])==null?void 0:s.axes)||[]];r[t]=i,Object.defineProperty(this.emulatedGamepads[e],"axes",{value:r,enumerable:!0,configurable:!0})}AddButtonTouchEventListeners(e,t){if(!this.emulatedGamepads[e])throw new Error("Error: AddJoystickTouchEventListeners() - no emulated gamepad at index "+e+", pass a valid index, or call AddEmulatedGamepad() first to create an emulated gamepad at that index");let i=[];for(var s=0;s<t.length;s++){const r=t[s];if(!r)continue;const a=r.buttonIndexes??r.buttonIndex,o=r.tapTarget;if(!o){console.warn("GamepadEmulator: No tap target in gamepad "+e+" display config for button "+a+", skipping...");continue}const l=h=>{const f=h.changedTouches[0].target;(f==o||f.parentElement==o)&&h.preventDefault()};window.addEventListener("touchstart",l,{passive:!1});const c=h=>{const f=h.buttons==1?1:0;(!r.lockTargetWhilePressed||f==0)&&this.PressButton(e,a,f,!0)};o.addEventListener("pointerenter",c);const u=h=>{const f=h.buttons==1?1:0;(!r.lockTargetWhilePressed||f==0)&&this.PressButton(e,a,0,!1)};o.addEventListener("pointerleave",u);const d=h=>{this.PressButton(e,a,0,!1)};if(o.addEventListener("pointercancel",d),r.type==or.onOff){const h=g=>{g.preventDefault(),this.PressButton(e,a,1,!0),r.lockTargetWhilePressed?o.setPointerCapture(g.pointerId):o.releasePointerCapture(g.pointerId)};o.addEventListener("pointerdown",h);const f=()=>{this.PressButton(e,a,0)};o.addEventListener("pointerup",f),i.push(function(){window.removeEventListener("touchstart",l),o.removeEventListener("pointerenter",c),o.removeEventListener("pointerleave",u),o.removeEventListener("pointerdown",h),o.removeEventListener("pointerup",f),o.removeEventListener("pointercancel",d)})}else if(r.type==or.variable){const h=this.AddDragControlListener(r,(f,g,v)=>{let m=f?this.buttonPressThreshold+1e-5:0;m+=r.directions[zt.left]||r.directions[zt.right]?Math.abs(g):0,m+=r.directions[zt.up]||r.directions[zt.down]?Math.abs(v):0,this.PressButton(e,a,Math.min(m,1))});i.push(function(){window.removeEventListener("touchstart",l),o.removeEventListener("pointerenter",c),o.removeEventListener("pointerleave",u),o.removeEventListener("pointercancel",d),h()})}}this.emulatedGamepadsMetadata[e].removeButtonListenersFunc=()=>{i.forEach(r=>r())}}AddJoystickTouchEventListeners(e,t){if(!this.emulatedGamepads[e])throw new Error("Error: AddJoystickTouchEventListeners() - no emulated gamepad at index "+e+", pass a valid index, or call AddEmulatedGamepad() first to create an emulated gamepad at that index");let i=[];for(let s=0;s<t.length;s++){const r=t[s];if(!r)continue;if(r.tapTarget==null){console.warn("GamepadEmulator: No tap target in gamepad "+e+" display config for joystick "+s+", skipping...");continue}const a=this.AddDragControlListener(r,(o,l,c)=>{r.xAxisIndex!==void 0&&this.MoveAxis(e,r.xAxisIndex,l),r.yAxisIndex!==void 0&&this.MoveAxis(e,r.yAxisIndex,c)});i.push(a)}this.emulatedGamepadsMetadata[e].removeJoystickListenersFunc=()=>{i.forEach(s=>s())}}ClearButtonTouchEventListeners(e){var t;this.emulatedGamepadsMetadata[e]&&(t=this.emulatedGamepadsMetadata[e])!=null&&t.removeButtonListenersFunc&&this.emulatedGamepadsMetadata[e].removeButtonListenersFunc()}ClearJoystickTouchEventListeners(e){var t;this.emulatedGamepadsMetadata[e]&&(t=this.emulatedGamepadsMetadata[e])!=null&&t.removeJoystickListenersFunc&&this.emulatedGamepadsMetadata[e].removeJoystickListenersFunc()}AddDragControlListener(e,t){let i={startX:0,startY:0},s=-1;const r=l=>{var c=l.pointerId;if(s===c){const u=e.directions[zt.left]?-1:0,d=e.directions[zt.right]?1:0,h=e.directions[zt.up]?-1:0,f=e.directions[zt.down]?1:0,g=l.clientX-i.startX,v=l.clientY-i.startY;let{x:m,y:_}=$L(g,v,e.dragDistance);m=Math.max(Math.min(m,d),u),_=Math.max(Math.min(_,f),h),t(!0,m,_)}},a=l=>{s==l.pointerId&&(document.removeEventListener("pointermove",r,!1),document.removeEventListener("pointerup",a,!1),s=-1,t(!1,0,0))};e.tapTarget.addEventListener("pointerdown",l=>{l.preventDefault(),i.startX=l.clientX,i.startY=l.clientY,s=l.pointerId,e.lockTargetWhilePressed?e.tapTarget.setPointerCapture(l.pointerId):e.tapTarget.releasePointerCapture(l.pointerId),t(!0,0,0),document.addEventListener("pointermove",r,!1),document.addEventListener("pointerup",a,!1)});const o=l=>{l.changedTouches[0].target==e.tapTarget&&l.preventDefault()};return window.addEventListener("touchstart",o,{passive:!1}),function(){window.removeEventListener("touchstart",o),e.tapTarget.removeEventListener("pointerdown",r)}}cloneGamepad(e){if(!e)return e;const t=e.axes?e.axes.length:0,i=e.buttons?e.buttons.length:0,s={};for(let r in e)if(r==="axes"){const a=new Array(t);for(let o=0;o<t;o++)a[o]=Number(e.axes[o]);Object.defineProperty(s,"axes",{value:a,enumerable:!0,configurable:!0})}else if(r==="buttons"){const a=new Array(i);for(let o=0;o<i;o++){const l=e.buttons[o];if(l==null)a[o]=l;else{const c=l.pressed,u=l.value,d=l.touched||!1;a[o]={pressed:c,value:u,touched:d}}}Object.defineProperty(s,"buttons",{value:a,enumerable:!0,configurable:!0})}else Object.defineProperty(s,r,{get:()=>e[r],configurable:!0,enumerable:!0});return s.emulation||Object.defineProperty(s,"emulation",{value:ga.real,configurable:!0,enumerable:!0}),s}nextEmptyEGpadIndex(e){let t=0;if(e)do{if(!this.emulatedGamepads[t])break;t++}while(t<this.emulatedGamepads.length);else{const i=Math.max(this.emulatedGamepads.length,this.patchedGpadToRealIndexMap.length);do{if(!this.emulatedGamepads[t]&&this.patchedGpadToRealIndexMap[t]==null)break;t++}while(t<i)}return t}nextEmptyRealGpadIndex(e){let t=e;const i=Math.max(this.emulatedGamepads.length,this.patchedGpadToRealIndexMap.length);do{const s=this.emulatedGamepadsMetadata[t],r=this.realGpadToPatchedIndexMap[t]==null&&this.patchedGpadToRealIndexMap[t]==null;if(s&&s.overlayMode||!s&&r)break;t++}while(t<i);return t}monkeyPatchGamepadEvents(){let e,t,i,s;window.hasOwnProperty("ongamepadconnected")&&(e=Object.getOwnPropertyDescriptor(window,"ongamepadconnected"),e.configurable=!0,i=window.ongamepadconnected,window.ongamepadconnected=null,Object.defineProperty(window,"ongamepadconnected",{get:()=>function(o){},set:o=>{i=o},configurable:!0})),window.hasOwnProperty("ongamepaddisconnected")&&(t=Object.getOwnPropertyDescriptor(window,"ongamepaddisconnected"),t.configurable=!0,s=window.ongamepaddisconnected,window.ongamepaddisconnected=null,Object.defineProperty(window,"ongamepaddisconnected",{get:()=>function(o){},set:o=>{i=o},configurable:!0}));const r=o=>{const l=o.gamepad;if(l&&l.emulation===void 0){o.stopImmediatePropagation(),o.preventDefault();const c=this.cloneGamepad(o.gamepad),u=c.index,d=this.nextEmptyRealGpadIndex(u);this.realGpadToPatchedIndexMap[u]=d,this.patchedGpadToRealIndexMap[d]=u,Object.defineProperty(c,"index",{get:()=>d}),Object.defineProperty(c,"emulation",{get:()=>ga.real});const h=new Event(o.type||"gamepadconnected");h.gamepad=c,window.dispatchEvent(h)}i&&i.call(window,o)};window.addEventListener("gamepadconnected",r);const a=o=>{const l=o.gamepad;if(l&&l.emulation===void 0){o.stopImmediatePropagation(),o.preventDefault();const c=this.cloneGamepad(o.gamepad),u=this.realGpadToPatchedIndexMap[c.index]||c.index;Object.defineProperty(c,"index",{get:()=>u}),Object.defineProperty(c,"emulation",{get:()=>ga.real}),delete this.realGpadToPatchedIndexMap[c.index],delete this.patchedGpadToRealIndexMap[u];const d=new Event(o.type||"gamepaddisconnected");d.gamepad=c,window.dispatchEvent(d)}s&&s.call(window,o)};return window.addEventListener("gamepaddisconnected",a),function(){window.removeEventListener("gamepadconnected",r),window.hasOwnProperty("ongamepadconnected")&&(Object.defineProperty(window,"ongamepadconnected",e),window.ongamepadconnected=i),window.removeEventListener("gamepaddisconnected",a),window.hasOwnProperty("ongamepaddisconnected")&&(Object.defineProperty(window,"ongamepaddisconnected",t),window.ongamepaddisconnected=s)}}monkeyPatchGetGamepads(){const e=this;let t=navigator.getGamepads||navigator.webkitGetGamepads||navigator.mozGetGamepads||navigator.msGetGamepads;this.getNativeGamepads=t,navigator.getNativeGamepads=t||function(){return[]},Object.defineProperty(navigator,"getGamepads",{configurable:!0,value:function(){var i;let s=e.emulatedGamepads,r=t!=null?t.apply(navigator)||[]:[],a=new Array(Math.max(r.length,s.length)).fill(null);for(let o=0;o<r.length;o++){const l=r[o];if(!l)continue;let c=e.cloneGamepad(l),u=e.realGpadToPatchedIndexMap[c.index]||c.index;Object.defineProperty(c,"index",{get:()=>u}),a[u]=c}for(let o=0;o<s.length;o++){let l=a[o],c=s[o];if(c&&l){Object.defineProperty(a[o],"emulation",{value:ga.overlay,configurable:!0});let u=Math.max(((i=l==null?void 0:l.buttons)==null?void 0:i.length)??0,c.buttons.length),d=new Array(u);for(let g=0;g<u;g++){const v=(c==null?void 0:c.buttons[g])||{touched:!1,pressed:!1,value:0},m=(l==null?void 0:l.buttons[g])||{touched:!1,pressed:!1,value:0};d[g]={touched:v.touched||m.touched||!1,pressed:v.pressed||m.pressed||!1,value:Math.max(v.value,m.value)||0}}Object.defineProperty(a[o],"buttons",{value:d,enumerable:!0,configurable:!0});let h=Math.max(c.axes.length,l.axes.length),f=new Array(u);for(let g=0;g<h;g++){const v=c.axes[g]??0,m=l.axes[g]??0;f[g]=Math.abs(v)>Math.abs(m)?v:m}Object.defineProperty(a[o],"axes",{value:f,enumerable:!0,configurable:!0})}else c&&(Object.defineProperty(c,"emulation",{value:ga.emulated,enumerable:!0,configurable:!0}),Object.defineProperty(c,"timestamp",{value:performance.now(),enumerable:!0,configurable:!0}),a[o]=e.cloneGamepad(c))}return a}})}cleanup(){for(let e=0;e<this.emulatedGamepads.length;e++)this.ClearButtonTouchEventListeners(e),this.ClearJoystickTouchEventListeners(e);this.emulatedGamepads=[],this.undoEventPatch(),this.getNativeGamepads?Object.defineProperty(navigator,"getGamepads",{value:this.getNativeGamepads,configurable:!0}):Object.defineProperty(navigator,"getGamepads",{value:void 0,configurable:!0}),xu.instanceRunning=!1,delete navigator.getNativeGamepads}};Xi(GE,"instanceRunning",!1);let zE=GE;const nO=(n,e)=>{e=Object.assign({GpadDisplayConfig:{gamepadIndex:0},EmulatedGamepadIndex:0,EmulatedGamepadOverlayMode:!0,AllowDpadDiagonals:!1,VariableTriggers:!0,ClickableJoysticks:!0,JoystickDragDistance:50,TriggerDragDistance:50},e),n.classList.add("gpad-container");const t=e.GpadEmulator??new zE(.1),i=e.GpadApiWrapper??new zg({updateDelay:0,axisDeadZone:.05,buttonConfigs:[]}),s=e.EmulatedGamepadIndex;t.AddEmulatedGamepad(s,e.EmulatedGamepadOverlayMode,Hg,Wg);const r=[];for(let d=0;d<Wv.length;d++){const h=Wv[d],f=n.querySelector("#"+h),g=h.includes("trigger"),v=h.includes("stick");if(f)g&&e.VariableTriggers?r.push({buttonIndex:d,type:or.variable,tapTarget:f,dragDistance:e.TriggerDragDistance,lockTargetWhilePressed:!0,directions:{[zt.down]:!0}}):(!v||e.ClickableJoysticks)&&r.push({buttonIndex:d,tapTarget:f,type:or.onOff,lockTargetWhilePressed:v===!0});else{console.error("Could not find gamepad tap target with id "+h+". Make sure to insert the full gamepad SVG into the DOM before calling setupPremadeInteractiveGamepad().");continue}}if(e.AllowDpadDiagonals)for(const[d,h]of Object.entries(qL)){const f=n.querySelector("#"+d);if(f)r.push({buttonIndexes:h,type:or.onOff,tapTarget:f,lockTargetWhilePressed:!1});else{console.error("Could not find gamepad tap target with id "+d+". Make sure to insert the full gamepad SVG into the DOM before calling setupPremadeInteractiveGamepad().");continue}}t.AddButtonTouchEventListeners(s,r),t.AddJoystickTouchEventListeners(s,[{tapTarget:n.querySelector("#stick_button_left_tap_target"),dragDistance:e.JoystickDragDistance,xAxisIndex:0,yAxisIndex:1,lockTargetWhilePressed:!0,directions:{[zt.up]:!0,[zt.down]:!0,[zt.left]:!0,[zt.right]:!0}},{tapTarget:n.querySelector("#stick_button_right_tap_target"),dragDistance:e.JoystickDragDistance,xAxisIndex:2,yAxisIndex:3,lockTargetWhilePressed:!0,directions:{[zt.up]:!0,[zt.down]:!0,[zt.left]:!0,[zt.right]:!0}}]);const a=document.querySelector(`#${Br[ft.LStick]}`),o=document.querySelector(`#${Br[ft.RStick]}`);jv(a),jv(o);const l=Br.map(d=>d.includes("trigger")&&e.VariableTriggers?{type:or.variable,direction:zt.down,buttonElement:n.querySelector(`#${d}`),highlight:n.querySelector(`#${d} .${Mu.ButtonHighlight}`),directionHighlight:n.querySelector(`#${d} .${Mu.DirectionHighlight}`),movementRange:10}:{type:or.onOff,highlight:n.querySelector(`#${d} .${Mu.ButtonHighlight}`),extraData:{myCustomData:"onOff btn name is "+d}}),c=[{joystickElement:n.querySelector(`#${Br[ft.LStick]}`),xAxisIndex:0,yAxisIndex:1,movementRange:10},{joystickElement:n.querySelector(`#${Br[ft.RStick]}`),xAxisIndex:2,yAxisIndex:3,movementRange:10}],u=new ZL(Object.assign({gamepadIndex:s,buttons:l,sticks:c},e.GpadDisplayConfig),i);return{gpadEmulator:t,gpadApiWrapper:i,gpadDisplay:u}},iO="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ2aWRlbyI6eyJyb29tTGlzdCI6dHJ1ZSwicm9vbUpvaW4iOmZhbHNlLCJjYW5QdWJsaXNoIjpmYWxzZSwiY2FuU3Vic2NyaWJlIjpmYWxzZSwiY2FuUHVibGlzaERhdGEiOmZhbHNlLCJjYW5VcGRhdGVPd25NZXRhZGF0YSI6ZmFsc2V9LCJpYXQiOjE2OTE0NTEzNDEsIm5iZiI6MTY5MTQ1MTM0MSwiZXhwIjoxMTE1MjI1MTM0MSwiaXNzIjoiQVBJSGQ3Qm9hOVJVVWlUIiwic3ViIjoibHQiLCJqdGkiOiJsdCJ9.X5fI6ceu2aLf0bc-h3PKc-u2PRzSAgVZEpK5FjScRGQ",sO=1e3,rO=100,kc={DEBUG_MODE:!1,SHOW_REMOTE_LOGS:!0,LIVEKIT_CLOUD_ENDPOINT:"https://rov-web.livekit.cloud",LIVEKIT_LOCAL_ENDPOINT:"http://localhost:7880"},Er={};Object.defineProperties(kc,{DEBUG_MODE:{get:()=>Er.DEBUG_MODE??(Er.DEBUG_MODE=s_("DEBUG_MODE",!1))},SHOW_REMOTE_LOGS:{get:()=>Er.SHOW_REMOTE_LOGS??(Er.SHOW_REMOTE_LOGS=s_("SHOW_REMOTE_LOGS",!0))},LIVEKIT_CLOUD_ENDPOINT:{get:()=>Er.LIVEKIT_CLOUD_ENDPOINT??(Er.LIVEKIT_CLOUD_ENDPOINT=i_("LIVEKIT_CLOUD_URL","https://rov-web.livekit.cloud"))},LIVEKIT_LOCAL_ENDPOINT:{get:()=>Er.LIVEKIT_LOCAL_ENDPOINT??(Er.LIVEKIT_LOCAL_ENDPOINT=i_("LIVEKIT_LOCAL_URL","http://localhost:7880"))}});const aO=Object.assign({},OP,{initiator:!0,offerOptions:{offerToReceiveVideo:!0,offerToReciveAudio:!1}}),oO={[ft.A]:0,[ft.B]:1,[ft.X]:2,[ft.Y]:3,[ft.LShoulder]:9,[ft.RShoulder]:10,[ft.Back]:4,[ft.Start]:6,[ft.LStick]:7,[ft.RStick]:8,[ft.DPadUp]:11,[ft.DPadDown]:12,[ft.DPadLeft]:13,[ft.DPadRight]:14,[ft.Vendor]:5},im=[{btnName:"button_1",helpLabel:"Take Control",tooltipPlacement:"left",fireWhileHolding:!1},{btnName:"button_2",helpLabel:"Record Video",tooltipPlacement:"left",fireWhileHolding:!1},{btnName:"button_3",helpLabel:"Take Photo",tooltipPlacement:"left",fireWhileHolding:!1},{btnName:"button_4",helpLabel:"Change Fly Mode",tooltipPlacement:"left",fireWhileHolding:!1},{btnName:"shoulder_button_front_left",helpLabel:"Less Throttle",tooltipPlacement:"right",fireWhileHolding:!0},{btnName:"shoulder_button_front_right",helpLabel:"More Throttle",tooltipPlacement:"left",fireWhileHolding:!0},{btnName:"shoulder_trigger_back_left",helpLabel:"Open Claw",fireWhileHolding:!0,tooltipPlacement:"right"},{btnName:"shoulder_trigger_back_right",helpLabel:"Close Claw",fireWhileHolding:!0,tooltipPlacement:"left"},{btnName:"select_button",helpLabel:"Tutorial",tooltipPlacement:"right",fireWhileHolding:!1},{btnName:"start_button",helpLabel:"Move-Roll Toggle",tooltipPlacement:"left",fireWhileHolding:!1},{btnName:"stick_button_left",helpLabel:"Move Forward-Back & Turn",tooltipPlacement:"right",fireWhileHolding:!1},{btnName:"stick_button_right",helpLabel:"Move Up-Down & Left-Right",tooltipPlacement:"left",fireWhileHolding:!1},{btnName:"d_pad_up",helpLabel:"Look Up",fireWhileHolding:!0,tooltipPlacement:"right"},{btnName:"d_pad_down",helpLabel:"Look Down",fireWhileHolding:!0,tooltipPlacement:"right"},{btnName:"d_pad_left",helpLabel:"Dim Lights",fireWhileHolding:!0,tooltipPlacement:"right"},{btnName:"d_pad_right",helpLabel:"Bright Lights",fireWhileHolding:!0,tooltipPlacement:"right"}],cO=Ze(1/0),HE=Ze(1/0),WE=Ze(1/0),jE=Ze(1/0);Ze(1/0);const KE=Ze(1/0),qE=Ze(0),XE=Ze(0),YE=Ze(0),lO=n=>(n-CS)*.009962143853;function JE(n){for(let e of n.measurementUpdates)e.measurementType==ds.pressure_mbar?(KE.set(e.value),HE.set(lO(e.value))):e.measurementType==ds.water_temp_celsius?WE.set(e.value):e.measurementType==ds.internal_temp_celsius?jE.set(e.value):e.measurementType==ds.yaw_degrees?qE.set(e.value):e.measurementType==ds.pitch_degrees?XE.set(e.value):e.measurementType==ds.roll_degrees&&YE.set(e.value)}var ls=(n=>(n[n.unknown=-1]="unknown",n[n.manual=19]="manual",n[n.stabilize=0]="stabilize",n[n.acrobatic=1]="acrobatic",n[n.depth_hold=2]="depth_hold",n[n.surface=9]="surface",n))(ls||{});Yi.MAV_STATE_UNINIT+"",Yi.MAV_STATE_BOOT+"",Yi.MAV_STATE_CALIBRATING+"",Yi.MAV_STATE_STANDBY+"",Yi.MAV_STATE_ACTIVE+"",Yi.MAV_STATE_CRITICAL+"",Yi.MAV_STATE_EMERGENCY+"",Yi.MAV_STATE_POWEROFF+"",Yi.MAV_STATE_FLIGHT_TERMINATION+"";Ze(1/0);const uO=Ze(1/0),dO=Ze(1/0),hO=Ze(1/0),fO=Ze(1/0),pO=Ze(0),QE=Ze(ls.unknown),mO=Ze(Yi.MAV_STATE_UNINIT),Nd=Ze(!1),gO=Ze(1/0),_O=Ze(1/0),vO=Ze(1/0),bO=Ze(1/0);function yO(n,e,t,i,s){gO.set(n),_O.set(e),vO.set(t),bO.set(i),s.forEach(r=>{$t("System Monitor Warning: "+r),cn(r,5e3,!0,Zt.warning)})}function TO(n,e,t){uO.set(n),dO.set(e),hO.set(t)}function SO(n){QE.set(n)}function EO(n){mO.set(n)}function AO(n){fO.set(n)}function CO(n){pO.set(n)}const wO=n=>{if(!n.message)return;if(!n.message.type)return Lt("@ invalid mavlink message rcvd: ",n);const e=n.message;switch(e.type){case"HEARTBEAT":RO(e);break;case"ATTITUDE":kO(e);break;case"SYS_STATUS":IO(e);break;case"STATUSTEXT":PO(e);break;case"SCALED_PRESSURE":MO(e);break;case"SCALED_PRESSURE2":xO(e);break;default:Lt("@ unhandled mavlink message "+String(e.type),e)}},RO=n=>{if(n.autopilot.type=="MAV_AUTOPILOT_INVALID")return;const e=n.custom_mode;SO(e);const t=n.system_status.type||Yi.MAV_STATE_UNINIT;EO(t);const i=n.base_mode.bits,s=(i&Pr.MAV_MODE_FLAG_SAFETY_ARMED)>0;Nd.set(s);const r=(i&Pr.MAV_MODE_FLAG_MANUAL_INPUT_ENABLED)>0,a=(i&Pr.MAV_MODE_FLAG_HIL_ENABLED)>0,o=(i&Pr.MAV_MODE_FLAG_STABILIZE_ENABLED)>0,l=(i&Pr.MAV_MODE_FLAG_GUIDED_ENABLED)>0,c=(i&Pr.MAV_MODE_FLAG_AUTO_ENABLED)>0,u=(i&Pr.MAV_MODE_FLAG_TEST_ENABLED)>0;es.get()&&Lt("@  autopilot state",t,"flight mode",e,"armed",s,"manual_enabled",r,"hil_enabled",a,"stabilize_enabled",o,"guided_enabled",l,"auto_enabled",c,"test_enabled",u)},kO=n=>{es.get()&&Lt("@  attitude",n),JE({measurementUpdates:[{measurementType:ds.yaw_degrees,value:n.yaw/Math.PI*180},{measurementType:ds.pitch_degrees,value:n.pitch/Math.PI*180},{measurementType:ds.roll_degrees,value:n.roll/Math.PI*180}]})},MO=n=>{es.get()&&Lt("@  scaled pressure",n),KE.set(n.press_abs),HE.set((n.press_abs-CS)*.009962143853),jE.set(n.temperature/100)},xO=n=>{es.get()&&Lt("@  scaled pressure 2",n),WE.set(n.temperature/100)},IO=n=>{es.get()&&Lt("@  system status",n);const e=n.voltage_battery/1e3,t=n.current_battery/100,i=n.errors_comm+n.errors_count1+n.errors_count2+n.errors_count3+n.errors_count4;TO(n.battery_remaining,e,t),CO(i),AO(n.load),n.errors_comm>0&&cn(`${i} autopilot errors detected!`,5e3,!0,Zt.warning),(e<14||n.battery_remaining>0&&n.battery_remaining<10)&&cn(`Low Battery: ${e.toFixed(2)}volts`,8e3,!0,Zt.warning),t>30&&cn(`High Current Draw: ${t.toFixed(1)} amps`,5e3,!0,Zt.warning)},PO=n=>{const e=n.severity.type,t=n.text.join("");es.get()&&Lt("@  status text",n);const s={[Qs.MAV_SEVERITY_INFO]:Zt.info,[Qs.MAV_SEVERITY_DEBUG]:Zt.info,[Qs.MAV_SEVERITY_NOTICE]:Zt.info,[Qs.MAV_SEVERITY_WARNING]:Zt.warning,[Qs.MAV_SEVERITY_ALERT]:Zt.warning,[Qs.MAV_SEVERITY_CRITICAL]:Zt.error,[Qs.MAV_SEVERITY_EMERGENCY]:Zt.error,[Qs.MAV_SEVERITY_ERROR]:Zt.error}[e]||Zt.info;cn(t+" - "+e,5e3,!1,s)};function WV(){return document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled}function jV(n,e){e=e||document.documentElement;let t=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(!t||e!==t){const i=e.requestFullscreen||e.webkitEnterFullscreen||e.webkitRequestFullscreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullscreen;i&&i.apply(e)}else{const i=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;i&&i.apply(document)}}const Kt=n=>n==null||Number.isNaN(n)?"?":n==1/0?"∞":n==-1/0?"-∞":n<9999?String(n).substring(0,4):n.toExponential(0),ws=n=>n==null||Number.isNaN(n)?"?b":n==1/0?"∞b":n==-1/0?"-∞b":n>1e9?Number(n/1e9).toFixed(2)+"Gb":n>1e6?Number(n/1e6).toFixed(2)+"Mb":n>1e3?Number(n/1e3).toFixed(2)+"Kb":n.toFixed(0)+"b",Kv=["bg-green-900","bg-yellow-900","bg-red-900","bg-blue-900","bg-purple-900","bg-indigo-900","bg-gray-900","bg-orange-900"],NO=["border-green-700","border-yellow-700","border-red-700","border-blue-700","border-purple-700","border-indigo-700","border-gray-700","border-orange-700"];let Rl=0;const KV=()=>{const n=Kv[Rl],e=NO[Rl];return Rl=(Rl+1)%Kv.length,{bg:n,border:e}};function DO(n,e){const{computePosition:t,autoUpdate:i,offset:s,shift:r,flip:a,arrow:o,size:l,autoPlacement:c,hide:u,inline:d}=Jm(oC),h={open:!1,autoUpdateCleanup:()=>{}},f=':is(a[href], button, input, textarea, select, details, [tabindex]):not([tabindex="-1"])';let g;const v="https://www.skeleton.dev/utilities/popups";let m,_,y=!1;function b(){m=document.querySelector(`[data-popup="${e.target}"]`)??document.createElement("div"),_=m.querySelector(".arrow")??document.createElement("div")}b();function p(){var R,V,H,B,te,j,oe,z;if(!m)throw new Error(`The data-popup="${e.target}" element was not found. ${v}`);if(!t)throw new Error(`Floating UI 'computePosition' not found for data-popup="${e.target}". ${v}`);if(!s)throw new Error(`Floating UI 'offset' not found for data-popup="${e.target}". ${v}`);if(!r)throw new Error(`Floating UI 'shift' not found for data-popup="${e.target}". ${v}`);if(!a)throw new Error(`Floating UI 'flip' not found for data-popup="${e.target}". ${v}`);if(!o)throw new Error(`Floating UI 'arrow' not found for data-popup="${e.target}". ${v}`);const T=[];l&&T.push(l((R=e.middleware)==null?void 0:R.size)),c&&T.push(c((V=e.middleware)==null?void 0:V.autoPlacement)),u&&T.push(u((H=e.middleware)==null?void 0:H.hide)),d&&T.push(d((B=e.middleware)==null?void 0:B.inline)),t(n,m,{placement:e.placement??"bottom",middleware:[s(((te=e.middleware)==null?void 0:te.offset)??8),r(((j=e.middleware)==null?void 0:j.shift)??{padding:8}),a((oe=e.middleware)==null?void 0:oe.flip),o(((z=e.middleware)==null?void 0:z.arrow)??{element:_||null})]}).then(({x:W,y:ie,placement:se,middlewareData:je})=>{var ge;if(Object.assign(m.style,{left:`${W}px`,top:`${ie}px`}),_){const{x:L,y:J}=je.arrow,U={top:"bottom",right:"left",bottom:"top",left:"right"}[se.split("-")[0]],de={top:255,right:315,bottom:45,left:135}[se.split("-")[0]];Object.assign(_.style,{left:L!=null?`${L}px`:"",top:J!=null?`${J}px`:"",right:"",bottom:"",[U]:(((ge=e.middleware)==null?void 0:ge.arrowOffset)??-4)+"px",transform:`rotate(${de}deg)`})}})}function w(){m&&(y=!0,setTimeout(()=>{y&&(h.open=!0,e.state&&e.state({state:h.open}),p(),m.style.display="block",m.style.opacity="1",m.style.pointerEvents="auto",m.removeAttribute("inert"),h.autoUpdateCleanup=i(n,m,p),g=Array.from(m==null?void 0:m.querySelectorAll(f)))},e.delay??0))}function E(T){if(!m||e.forceOpen)return;y=!1;const R=parseFloat(window.getComputedStyle(m).transitionDuration.replace("s",""))*1e3;setTimeout(()=>{h.open=!1,e.state&&e.state({state:h.open}),m.style.opacity="0",m.setAttribute("inert",""),h.autoUpdateCleanup&&h.autoUpdateCleanup(),T&&T()},R)}function C(){h.open===!1?w():E()}function M(T){if(h.open===!1||n.contains(T.target))return;if(m&&m.contains(T.target)===!1){E();return}const R=e.closeQuery===void 0?"a[href], button":e.closeQuery,V=m==null?void 0:m.querySelectorAll(R);V==null||V.forEach(H=>{H.contains(T.target)&&E()})}const I=T=>{if(h.open===!1)return;const R=T.key;if(R==="Escape"){T.preventDefault(),n.focus(),E();return}g=Array.from(m==null?void 0:m.querySelectorAll(f)),h.open&&document.activeElement===n&&(R==="ArrowDown"||R==="Tab")&&f.length>0&&g.length>0&&(T.preventDefault(),g[0].focus())};switch(e.event){case"click":n.addEventListener("click",C,!0),window.addEventListener("click",M,!0);break;case"hover":n.addEventListener("mouseover",()=>w(),!0),n.addEventListener("mouseleave",()=>E(),!0);break;case"focus-blur":n.addEventListener("focus",C,!0),n.addEventListener("blur",()=>E(),!0);break;case"focus-click":n.addEventListener("focus",w,!0),window.addEventListener("click",M,!0);break;default:throw new Error(`Event value of '${e.event}' is not supported. ${v}`)}return window.addEventListener("keydown",I,!0),p(),{update(T){E(()=>{e=T,p(),b()})},toggle:C,open:w,close:E,destroy(){n.removeEventListener("click",C,!0),n.removeEventListener("mouseover",w,!0),n.removeEventListener("mouseleave",()=>E(),!0),n.removeEventListener("focus",C,!0),n.removeEventListener("focus",w,!0),n.removeEventListener("blur",()=>E(),!0),window.removeEventListener("click",M,!0),window.removeEventListener("keydown",I,!0)}}}const{Map:LO}=rC;function qv(n,e,t){const i=n.slice();return i[1]=e[t],i[3]=t,i}function Xv(n,e){let t,i=e[1].label+"",s,r,a,o,l;return{key:n,first:null,c(){t=K("div"),s=be(i),r=Te(),a=K("div"),o=Te(),this.h()},l(c){t=q(c,"DIV",{class:!0,"data-popup":!0});var u=F(t);s=ye(u,i),r=Se(u),a=q(u,"DIV",{class:!0}),F(a).forEach(S),o=Se(u),u.forEach(S),this.h()},h(){x(a,"class","arrow triangle bg-transparent border-secondary-500 pointer-events-none svelte-1ew0uut"),x(t,"class","card px-4 py-2 opacity-95 font-bold max-w[40px] variant-glass-secondary border-token border-secondary-500 box-border z-50 pointer-events-none select-none"),x(t,"data-popup",l=e[1].id),this.first=t},m(c,u){D(c,t,u),P(t,s),P(t,r),P(t,a),P(t,o)},p(c,u){e=c,u&1&&i!==(i=e[1].label+"")&&gt(s,i),u&1&&l!==(l=e[1].id)&&x(t,"data-popup",l)},d(c){c&&S(t)}}}function OO(n){let e=[],t=new LO,i,s=un(n[0].values());const r=a=>a[1].id??a[3];for(let a=0;a<s.length;a+=1){let o=qv(n,s,a),l=r(o);t.set(l,e[a]=Xv(l,o))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();i=dn()},l(a){for(let o=0;o<e.length;o+=1)e[o].l(a);i=dn()},m(a,o){for(let l=0;l<e.length;l+=1)e[l]&&e[l].m(a,o);D(a,i,o)},p(a,[o]){o&1&&(s=un(a[0].values()),e=by(e,o,r,1,a,s,t,i.parentNode,vy,Xv,i,qv))},i:Tt,o:Tt,d(a){a&&S(i);for(let o=0;o<e.length;o+=1)e[o].d(a)}}}let $s=Ze(new Map),UO=0;const jg=(n,e)=>{let{label:t,config:i}=e;const s="TT-"+String(UO++);return $s.update(r=>{if(r==null&&(r=new Map),!s)return fs("TOOLTIP ID UNDEFINED WHAT DA HECK?",r,s),r;i=Object.assign({event:"hover",target:s,delay:800,placement:"top",middleware:{offset:-5,arrowOffset:-8}},i||{});const a={id:s,label:t,config:i,update:()=>{},toggle:()=>{},open:()=>{},close:()=>{},destroy:()=>{}};return r.set(s,a),r}),setTimeout(()=>{const r=DO(n,i);$s.update(a=>{const o=a.get(s);return a.set(s,{...o,...r}),a})},0),{update:r=>{var a;return(a=$s.get().get(s))==null?void 0:a.update(r)},toggle:()=>{var r;return(r=$s.get().get(s))==null?void 0:r.toggle()},open:()=>{var r;return(r=$s.get().get(s))==null?void 0:r.open()},close:()=>{var r;return(r=$s.get().get(s))==null?void 0:r.close()},destroy:()=>{$s.update(r=>{const a=r.get(s);return a&&(a.destroy(),r.delete(s)),r})}}};function FO(n,e,t){let i;return qn(n,$s,s=>t(0,i=s)),pd(()=>{$s.update(s=>(s.forEach(r=>{r.destroy()}),new Map))}),[i]}class qV extends Bt{constructor(e){super(),Vt(this,e,FO,OO,Ft,{})}}function Yv(n,e,t){const i=n.slice();return i[9]=e[t],i}function Jv(n,e,t){const i=n.slice();return i[12]=e[t],i[14]=t,i}function Qv(n,e,t){const i=n.slice();return i[15]=e[t][0],i[16]=e[t][1],i}function Zv(n,e,t){const i=n.slice();return i[15]=e[t][0],i[16]=e[t][1],i}function $v(n,e,t){const i=n.slice();return i[15]=e[t][0],i[16]=e[t][1],i}function eb(n,e,t){const i=n.slice();return i[12]=e[t],i}function tb(n,e,t){const i=n.slice();return i[12]=e[t],i}function nb(n,e,t){const i=n.slice();return i[12]=e[t],i}function ib(n,e,t){const i=n.slice();return i[12]=e[t],i}function sb(n){let e,t;return e=new UC({props:{autocollapse:!0,class:"card variant-filled "+n[7].class,regionPanel:"space-y-3",active:n[3],id:n[4],$$slots:{content:[WO],summary:[GO]},$$scope:{ctx:n}}}),{c(){ct(e.$$.fragment)},l(i){pt(e.$$.fragment,i)},m(i,s){lt(e,i,s),t=!0},p(i,s){const r={};s[0]&128&&(r.class="card variant-filled "+i[7].class),s[0]&8&&(r.active=i[3]),s[0]&16&&(r.id=i[4]),s[0]&103|s[1]&1&&(r.$$scope={dirty:s,ctx:i}),e.$set(r)},i(i){t||(ce(e.$$.fragment,i),t=!0)},o(i){fe(e.$$.fragment,i),t=!1},d(i){ut(e,i)}}}function BO(n){let e,t=Kt(n[6].frameHeight)+"",i,s,r=Kt(n[6].framesPerSecond)+"",a,o,l=(n[6].videoCodec||"?")+"",c;return{c(){e=K("span"),i=be(t),s=be("p | "),a=be(r),o=be("fps | "),c=be(l),this.h()},l(u){e=q(u,"SPAN",{class:!0});var d=F(e);i=ye(d,t),s=ye(d,"p | "),a=ye(d,r),o=ye(d,"fps | "),c=ye(d,l),d.forEach(S),this.h()},h(){x(e,"class","font-normal")},m(u,d){D(u,e,d),P(e,i),P(e,s),P(e,a),P(e,o),P(e,c)},p(u,d){d[0]&64&&t!==(t=Kt(u[6].frameHeight)+"")&&gt(i,t),d[0]&64&&r!==(r=Kt(u[6].framesPerSecond)+"")&&gt(a,r),d[0]&64&&l!==(l=(u[6].videoCodec||"?")+"")&&gt(c,l)},d(u){u&&S(e)}}}function VO(n){let e,t=Kt(n[6].frameHeight)+"",i,s,r=Kt(n[6].framesPerSecond)+"",a,o,l=(n[6].videoCodec||"?")+"",c,u,d=n[5].hung?"hung":"live",h;return{c(){e=K("span"),i=be(t),s=be("p | "),a=be(r),o=be("fps | "),c=be(l),u=be(" | "),h=be(d),this.h()},l(f){e=q(f,"SPAN",{class:!0});var g=F(e);i=ye(g,t),s=ye(g,"p | "),a=ye(g,r),o=ye(g,"fps | "),c=ye(g,l),u=ye(g," | "),h=ye(g,d),g.forEach(S),this.h()},h(){x(e,"class","font-normal")},m(f,g){D(f,e,g),P(e,i),P(e,s),P(e,a),P(e,o),P(e,c),P(e,u),P(e,h)},p(f,g){g[0]&64&&t!==(t=Kt(f[6].frameHeight)+"")&&gt(i,t),g[0]&64&&r!==(r=Kt(f[6].framesPerSecond)+"")&&gt(a,r),g[0]&64&&l!==(l=(f[6].videoCodec||"?")+"")&&gt(c,l),g[0]&32&&d!==(d=f[5].hung?"hung":"live")&&gt(h,d)},d(f){f&&S(e)}}}function GO(n){let e,t,i,s;function r(l,c){return l[2]==="reciever"?VO:BO}let a=r(n),o=a(n);return{c(){e=K("b"),t=be(n[1]),i=Te(),o.c(),s=dn(),this.h()},l(l){e=q(l,"B",{class:!0});var c=F(e);t=ye(c,n[1]),c.forEach(S),i=Se(l),o.l(l),s=dn(),this.h()},h(){x(e,"class","flex-1")},m(l,c){D(l,e,c),P(e,t),D(l,i,c),o.m(l,c),D(l,s,c)},p(l,c){c[0]&2&&gt(t,l[1]),a===(a=r(l))&&o?o.p(l,c):(o.d(1),o=a(l),o&&(o.c(),o.m(s.parentNode,s)))},d(l){l&&(S(e),S(i),S(s)),o.d(l)}}}function zO(n){let e,t,i="Resolutions",s,r,a,o,l,c,u,d="Codecs",h,f,g,v,m,_,y,b="Limited by",p,w,E,C,M,I,T,R="Net",V,H,B,te,j=un(n[0].senderLayerStats),oe=[];for(let L=0;L<j.length;L+=1)oe[L]=rb(ib(n,j,L));let z=un(n[0].senderLayerStats),W=[];for(let L=0;L<z.length;L+=1)W[L]=ab(nb(n,z,L));let ie=un(n[0].senderLayerStats),se=[];for(let L=0;L<ie.length;L+=1)se[L]=ob(tb(n,ie,L));let je=un(n[0].senderLayerStats),ge=[];for(let L=0;L<je.length;L+=1)ge[L]=cb(eb(n,je,L));return{c(){e=K("div"),t=K("b"),t.textContent=i,s=Te(),r=K("div");for(let L=0;L<oe.length;L+=1)oe[L].c();a=Te(),o=K("hr"),l=Te(),c=K("div"),u=K("b"),u.textContent=d,h=Te(),f=K("div");for(let L=0;L<W.length;L+=1)W[L].c();g=Te(),v=K("hr"),m=Te(),_=K("div"),y=K("b"),y.textContent=b,p=Te(),w=K("div");for(let L=0;L<se.length;L+=1)se[L].c();E=Te(),C=K("hr"),M=Te(),I=K("div"),T=K("b"),T.textContent=R,V=Te(),H=K("div");for(let L=0;L<ge.length;L+=1)ge[L].c();B=Te(),te=K("hr"),this.h()},l(L){e=q(L,"DIV",{class:!0});var J=F(e);t=q(J,"B",{"data-svelte-h":!0}),En(t)!=="svelte-18mbp2z"&&(t.textContent=i),s=Se(J),r=q(J,"DIV",{});var U=F(r);for(let O=0;O<oe.length;O+=1)oe[O].l(U);U.forEach(S),J.forEach(S),a=Se(L),o=q(L,"HR",{}),l=Se(L),c=q(L,"DIV",{class:!0});var de=F(c);u=q(de,"B",{"data-svelte-h":!0}),En(u)!=="svelte-1he60zh"&&(u.textContent=d),h=Se(de),f=q(de,"DIV",{});var et=F(f);for(let O=0;O<W.length;O+=1)W[O].l(et);et.forEach(S),de.forEach(S),g=Se(L),v=q(L,"HR",{}),m=Se(L),_=q(L,"DIV",{class:!0});var Ue=F(_);y=q(Ue,"B",{"data-svelte-h":!0}),En(y)!=="svelte-3niybh"&&(y.textContent=b),p=Se(Ue),w=q(Ue,"DIV",{});var dt=F(w);for(let O=0;O<se.length;O+=1)se[O].l(dt);dt.forEach(S),Ue.forEach(S),E=Se(L),C=q(L,"HR",{}),M=Se(L),I=q(L,"DIV",{class:!0});var _e=F(I);T=q(_e,"B",{"data-svelte-h":!0}),En(T)!=="svelte-1ohit1v"&&(T.textContent=R),V=Se(_e),H=q(_e,"DIV",{});var we=F(H);for(let O=0;O<ge.length;O+=1)ge[O].l(we);we.forEach(S),_e.forEach(S),B=Se(L),te=q(L,"HR",{}),this.h()},h(){x(e,"class","flex justify-between"),x(c,"class","flex justify-between"),x(_,"class","flex justify-between"),x(I,"class","flex justify-between")},m(L,J){D(L,e,J),P(e,t),P(e,s),P(e,r);for(let U=0;U<oe.length;U+=1)oe[U]&&oe[U].m(r,null);D(L,a,J),D(L,o,J),D(L,l,J),D(L,c,J),P(c,u),P(c,h),P(c,f);for(let U=0;U<W.length;U+=1)W[U]&&W[U].m(f,null);D(L,g,J),D(L,v,J),D(L,m,J),D(L,_,J),P(_,y),P(_,p),P(_,w);for(let U=0;U<se.length;U+=1)se[U]&&se[U].m(w,null);D(L,E,J),D(L,C,J),D(L,M,J),D(L,I,J),P(I,T),P(I,V),P(I,H);for(let U=0;U<ge.length;U+=1)ge[U]&&ge[U].m(H,null);D(L,B,J),D(L,te,J)},p(L,J){if(J[0]&1){j=un(L[0].senderLayerStats);let U;for(U=0;U<j.length;U+=1){const de=ib(L,j,U);oe[U]?oe[U].p(de,J):(oe[U]=rb(de),oe[U].c(),oe[U].m(r,null))}for(;U<oe.length;U+=1)oe[U].d(1);oe.length=j.length}if(J[0]&1){z=un(L[0].senderLayerStats);let U;for(U=0;U<z.length;U+=1){const de=nb(L,z,U);W[U]?W[U].p(de,J):(W[U]=ab(de),W[U].c(),W[U].m(f,null))}for(;U<W.length;U+=1)W[U].d(1);W.length=z.length}if(J[0]&1){ie=un(L[0].senderLayerStats);let U;for(U=0;U<ie.length;U+=1){const de=tb(L,ie,U);se[U]?se[U].p(de,J):(se[U]=ob(de),se[U].c(),se[U].m(w,null))}for(;U<se.length;U+=1)se[U].d(1);se.length=ie.length}if(J[0]&1){je=un(L[0].senderLayerStats);let U;for(U=0;U<je.length;U+=1){const de=eb(L,je,U);ge[U]?ge[U].p(de,J):(ge[U]=cb(de),ge[U].c(),ge[U].m(H,null))}for(;U<ge.length;U+=1)ge[U].d(1);ge.length=je.length}},d(L){L&&(S(e),S(a),S(o),S(l),S(c),S(g),S(v),S(m),S(_),S(E),S(C),S(M),S(I),S(B),S(te)),zi(oe,L),zi(W,L),zi(se,L),zi(ge,L)}}}function HO(n){let e,t,i="Resolution",s,r,a=Kt(n[6].frameWidth)+"",o,l,c=Kt(n[6].frameHeight)+"",u,d,h=Kt(n[6].framesPerSecond)+"",f,g,v,m,_,y,b,p="Codec",w,E,C=(n[6].videoCodec||"?")+"",M,I,T,R,V,H,B,te="Latency",j,oe,z=Kt(n[5].currentRoundTripTime*1e3)+"",W,ie,se=Math.floor(n[5].estimatedPlayoutDelay)+"",je,ge,L,J,U,de,et,Ue="Freezes",dt,_e,we=Kt(n[5].freezeCount)+"",O,wt,st=Kt(n[5].nackCount)+"",Ee,Fe,He=Kt(n[5].pliCount)+"",rt,N,A,ee,me,ve;return{c(){e=K("div"),t=K("b"),t.textContent=i,s=Te(),r=K("span"),o=be(a),l=be("x"),u=be(c),d=be(" at "),f=be(h),g=be("fps"),v=Te(),m=K("hr"),_=Te(),y=K("div"),b=K("b"),b.textContent=p,w=Te(),E=K("span"),M=be(C),T=Te(),R=K("hr"),V=Te(),H=K("div"),B=K("b"),B.textContent=te,j=Te(),oe=K("span"),W=be(z),ie=be("ms | Playout Delay "),je=be(se),ge=be("ms"),L=Te(),J=K("hr"),U=Te(),de=K("div"),et=K("b"),et.textContent=Ue,dt=Te(),_e=K("span"),O=be(we),wt=be(" Freezes | "),Ee=be(st),Fe=be(" NACKs | "),rt=be(He),N=be(" PLIs"),A=Te(),ee=K("hr"),this.h()},l(re){e=q(re,"DIV",{class:!0});var Oe=F(e);t=q(Oe,"B",{"data-svelte-h":!0}),En(t)!=="svelte-hua9w6"&&(t.textContent=i),s=Se(Oe),r=q(Oe,"SPAN",{class:!0});var Ge=F(r);o=ye(Ge,a),l=ye(Ge,"x"),u=ye(Ge,c),d=ye(Ge," at "),f=ye(Ge,h),g=ye(Ge,"fps"),Ge.forEach(S),Oe.forEach(S),v=Se(re),m=q(re,"HR",{}),_=Se(re),y=q(re,"DIV",{class:!0});var Xe=F(y);b=q(Xe,"B",{"data-svelte-h":!0}),En(b)!=="svelte-tju2ru"&&(b.textContent=p),w=Se(Xe),E=q(Xe,"SPAN",{class:!0});var Gt=F(E);M=ye(Gt,C),Gt.forEach(S),Xe.forEach(S),T=Se(re),R=q(re,"HR",{}),V=Se(re),H=q(re,"DIV",{class:!0});var Le=F(H);B=q(Le,"B",{"data-svelte-h":!0}),En(B)!=="svelte-1wpyx9m"&&(B.textContent=te),j=Se(Le),oe=q(Le,"SPAN",{class:!0});var Ye=F(oe);W=ye(Ye,z),ie=ye(Ye,"ms | Playout Delay "),je=ye(Ye,se),ge=ye(Ye,"ms"),Ye.forEach(S),Le.forEach(S),L=Se(re),J=q(re,"HR",{}),U=Se(re),de=q(re,"DIV",{class:!0});var yt=F(de);et=q(yt,"B",{"data-svelte-h":!0}),En(et)!=="svelte-120tso"&&(et.textContent=Ue),dt=Se(yt),_e=q(yt,"SPAN",{class:!0});var vt=F(_e);O=ye(vt,we),wt=ye(vt," Freezes | "),Ee=ye(vt,st),Fe=ye(vt," NACKs | "),rt=ye(vt,He),N=ye(vt," PLIs"),vt.forEach(S),yt.forEach(S),A=Se(re),ee=q(re,"HR",{}),this.h()},h(){x(r,"class","text-right"),x(e,"class","flex justify-between"),x(E,"class","text-right"),x(y,"class","flex justify-between"),x(oe,"class","text-right"),x(H,"class","flex justify-between"),x(_e,"class","text-right"),x(de,"class","flex justify-between")},m(re,Oe){D(re,e,Oe),P(e,t),P(e,s),P(e,r),P(r,o),P(r,l),P(r,u),P(r,d),P(r,f),P(r,g),D(re,v,Oe),D(re,m,Oe),D(re,_,Oe),D(re,y,Oe),P(y,b),P(y,w),P(y,E),P(E,M),D(re,T,Oe),D(re,R,Oe),D(re,V,Oe),D(re,H,Oe),P(H,B),P(H,j),P(H,oe),P(oe,W),P(oe,ie),P(oe,je),P(oe,ge),D(re,L,Oe),D(re,J,Oe),D(re,U,Oe),D(re,de,Oe),P(de,et),P(de,dt),P(de,_e),P(_e,O),P(_e,wt),P(_e,Ee),P(_e,Fe),P(_e,rt),P(_e,N),D(re,A,Oe),D(re,ee,Oe),me||(ve=py(I=jg.call(null,E,{label:n[6].videoSdpFmtpLine||"?"})),me=!0)},p(re,Oe){Oe[0]&64&&a!==(a=Kt(re[6].frameWidth)+"")&&gt(o,a),Oe[0]&64&&c!==(c=Kt(re[6].frameHeight)+"")&&gt(u,c),Oe[0]&64&&h!==(h=Kt(re[6].framesPerSecond)+"")&&gt(f,h),Oe[0]&64&&C!==(C=(re[6].videoCodec||"?")+"")&&gt(M,C),I&&my(I.update)&&Oe[0]&64&&I.update.call(null,{label:re[6].videoSdpFmtpLine||"?"}),Oe[0]&32&&z!==(z=Kt(re[5].currentRoundTripTime*1e3)+"")&&gt(W,z),Oe[0]&32&&se!==(se=Math.floor(re[5].estimatedPlayoutDelay)+"")&&gt(je,se),Oe[0]&32&&we!==(we=Kt(re[5].freezeCount)+"")&&gt(O,we),Oe[0]&32&&st!==(st=Kt(re[5].nackCount)+"")&&gt(Ee,st),Oe[0]&32&&He!==(He=Kt(re[5].pliCount)+"")&&gt(rt,He)},d(re){re&&(S(e),S(v),S(m),S(_),S(y),S(T),S(R),S(V),S(H),S(L),S(J),S(U),S(de),S(A),S(ee)),me=!1,ve()}}}function rb(n){let e,t=Kt(n[12].frameWidth)+"",i,s,r=Kt(n[12].frameHeight)+"",a,o,l=Kt(n[12].framesPerSecond)+"",c,u,d;return{c(){e=K("span"),i=be(t),s=be("x"),a=be(r),o=be(" at "),c=be(l),u=be("fps"),d=K("br"),this.h()},l(h){e=q(h,"SPAN",{class:!0});var f=F(e);i=ye(f,t),s=ye(f,"x"),a=ye(f,r),o=ye(f," at "),c=ye(f,l),u=ye(f,"fps"),f.forEach(S),d=q(h,"BR",{}),this.h()},h(){x(e,"class","text-right")},m(h,f){D(h,e,f),P(e,i),P(e,s),P(e,a),P(e,o),P(e,c),P(e,u),D(h,d,f)},p(h,f){f[0]&1&&t!==(t=Kt(h[12].frameWidth)+"")&&gt(i,t),f[0]&1&&r!==(r=Kt(h[12].frameHeight)+"")&&gt(a,r),f[0]&1&&l!==(l=Kt(h[12].framesPerSecond)+"")&&gt(c,l)},d(h){h&&(S(e),S(d))}}}function ab(n){let e,t=(n[12].videoCodec||"?")+"",i,s,r=(n[12].scalabilityMode||"")+"",a,o,l=n[12].encoderImplementation+"",c,u,d=n[12].powerEfficientEncoder?"(low-power)":"",h,f,g,v,m;return{c(){e=K("span"),i=be(t),s=Te(),a=be(r),o=Te(),c=be(l),u=Te(),h=be(d),g=K("br"),this.h()},l(_){e=q(_,"SPAN",{class:!0});var y=F(e);i=ye(y,t),s=Se(y),a=ye(y,r),o=Se(y),c=ye(y,l),u=Se(y),h=ye(y,d),y.forEach(S),g=q(_,"BR",{}),this.h()},h(){x(e,"class","text-right")},m(_,y){D(_,e,y),P(e,i),P(e,s),P(e,a),P(e,o),P(e,c),P(e,u),P(e,h),D(_,g,y),v||(m=py(f=jg.call(null,e,{label:n[12].videoSdpFmtpLine||"?"})),v=!0)},p(_,y){n=_,y[0]&1&&t!==(t=(n[12].videoCodec||"?")+"")&&gt(i,t),y[0]&1&&r!==(r=(n[12].scalabilityMode||"")+"")&&gt(a,r),y[0]&1&&l!==(l=n[12].encoderImplementation+"")&&gt(c,l),y[0]&1&&d!==(d=n[12].powerEfficientEncoder?"(low-power)":"")&&gt(h,d),f&&my(f.update)&&y[0]&1&&f.update.call(null,{label:n[12].videoSdpFmtpLine||"?"})},d(_){_&&(S(e),S(g)),v=!1,m()}}}function ob(n){let e,t=n[12].qualityLimitationReason+"",i,s,r=Kt(n[12].bandwidthLimitedQualityDurration)+"",a,o,l=Kt(n[12].cpuLimitedQualityDurration)+"",c,u,d=n[12].otherLimitedQualityDurration?" | Other "+Kt(n[12].otherLimitedQualityDurration)+"s":"",h,f;return{c(){e=K("span"),i=be(t),s=be(" | Net "),a=be(r),o=be("s | CPU "),c=be(l),u=be("s"),h=be(d),f=K("br"),this.h()},l(g){e=q(g,"SPAN",{class:!0});var v=F(e);i=ye(v,t),s=ye(v," | Net "),a=ye(v,r),o=ye(v,"s | CPU "),c=ye(v,l),u=ye(v,"s"),h=ye(v,d),v.forEach(S),f=q(g,"BR",{}),this.h()},h(){x(e,"class","text-right")},m(g,v){D(g,e,v),P(e,i),P(e,s),P(e,a),P(e,o),P(e,c),P(e,u),P(e,h),D(g,f,v)},p(g,v){v[0]&1&&t!==(t=g[12].qualityLimitationReason+"")&&gt(i,t),v[0]&1&&r!==(r=Kt(g[12].bandwidthLimitedQualityDurration)+"")&&gt(a,r),v[0]&1&&l!==(l=Kt(g[12].cpuLimitedQualityDurration)+"")&&gt(c,l),v[0]&1&&d!==(d=g[12].otherLimitedQualityDurration?" | Other "+Kt(g[12].otherLimitedQualityDurration)+"s":"")&&gt(h,d)},d(g){g&&(S(e),S(f))}}}function cb(n){let e,t,i=ws(n[12].retransmittedBytesSent*8)+"",s,r,a=Math.floor(n[12].totalPacketSendDelay)+"",o,l,c;return{c(){e=K("span"),t=be("Re-sent "),s=be(i),r=be(" | Delay "),o=be(a),l=be("ms"),c=K("br"),this.h()},l(u){e=q(u,"SPAN",{class:!0});var d=F(e);t=ye(d,"Re-sent "),s=ye(d,i),r=ye(d," | Delay "),o=ye(d,a),l=ye(d,"ms"),d.forEach(S),c=q(u,"BR",{}),this.h()},h(){x(e,"class","text-right")},m(u,d){D(u,e,d),P(e,t),P(e,s),P(e,r),P(e,o),P(e,l),D(u,c,d)},p(u,d){d[0]&1&&i!==(i=ws(u[12].retransmittedBytesSent*8)+"")&&gt(s,i),d[0]&1&&a!==(a=Math.floor(u[12].totalPacketSendDelay)+"")&&gt(o,a)},d(u){u&&(S(e),S(c))}}}function lb(n){let e,t=n[15]+"",i,s,r,a=n[16]+"",o,l;return{c(){e=K("b"),i=be(t),s=be(": "),r=K("span"),o=be(a),l=K("br")},l(c){e=q(c,"B",{});var u=F(e);i=ye(u,t),s=ye(u,": "),u.forEach(S),r=q(c,"SPAN",{});var d=F(r);o=ye(d,a),d.forEach(S),l=q(c,"BR",{})},m(c,u){D(c,e,u),P(e,i),P(e,s),D(c,r,u),P(r,o),D(c,l,u)},p(c,u){u[0]&1&&t!==(t=c[15]+"")&&gt(i,t),u[0]&1&&a!==(a=c[16]+"")&&gt(o,a)},d(c){c&&(S(e),S(r),S(l))}}}function ub(n){let e,t=n[15]!=="allStats"&&n[15]!=="recieverStats"&&n[15]!=="senderLayerStats"&&n[15]!=="rtcStatsJson"&&lb(n);return{c(){t&&t.c(),e=dn()},l(i){t&&t.l(i),e=dn()},m(i,s){t&&t.m(i,s),D(i,e,s)},p(i,s){i[15]!=="allStats"&&i[15]!=="recieverStats"&&i[15]!=="senderLayerStats"&&i[15]!=="rtcStatsJson"?t?t.p(i,s):(t=lb(i),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(i){i&&S(e),t&&t.d(i)}}}function db(n){let e,t=n[15]+"",i,s,r,a=n[16]+"",o,l;return{c(){e=K("b"),i=be(t),s=be(": "),r=K("span"),o=be(a),l=K("br")},l(c){e=q(c,"B",{});var u=F(e);i=ye(u,t),s=ye(u,": "),u.forEach(S),r=q(c,"SPAN",{});var d=F(r);o=ye(d,a),d.forEach(S),l=q(c,"BR",{})},m(c,u){D(c,e,u),P(e,i),P(e,s),D(c,r,u),P(r,o),D(c,l,u)},p(c,u){u[0]&1&&t!==(t=c[15]+"")&&gt(i,t),u[0]&1&&a!==(a=c[16]+"")&&gt(o,a)},d(c){c&&(S(e),S(r),S(l))}}}function hb(n){let e,t=un(n[0].senderLayerStats),i=[];for(let s=0;s<t.length;s+=1)i[s]=pb(Jv(n,t,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=dn()},l(s){for(let r=0;r<i.length;r+=1)i[r].l(s);e=dn()},m(s,r){for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(s,r);D(s,e,r)},p(s,r){if(r[0]&1){t=un(s[0].senderLayerStats);let a;for(a=0;a<t.length;a+=1){const o=Jv(s,t,a);i[a]?i[a].p(o,r):(i[a]=pb(o),i[a].c(),i[a].m(e.parentNode,e))}for(;a<i.length;a+=1)i[a].d(1);i.length=t.length}},d(s){s&&S(e),zi(i,s)}}}function fb(n){let e,t=n[15]+"",i,s,r,a=n[16]+"",o,l;return{c(){e=K("b"),i=be(t),s=be(": "),r=K("span"),o=be(a),l=K("br")},l(c){e=q(c,"B",{});var u=F(e);i=ye(u,t),s=ye(u,": "),u.forEach(S),r=q(c,"SPAN",{});var d=F(r);o=ye(d,a),d.forEach(S),l=q(c,"BR",{})},m(c,u){D(c,e,u),P(e,i),P(e,s),D(c,r,u),P(r,o),D(c,l,u)},p(c,u){u[0]&1&&t!==(t=c[15]+"")&&gt(i,t),u[0]&1&&a!==(a=c[16]+"")&&gt(o,a)},d(c){c&&(S(e),S(r),S(l))}}}function pb(n){let e,t,i,s,r,a,o,l=un(Object.entries(n[12])),c=[];for(let u=0;u<l.length;u+=1)c[u]=fb(Qv(n,l,u));return{c(){e=K("div"),t=K("em"),i=be("Sender Stats - Layer "),s=be(n[14]),r=K("br"),a=Te();for(let u=0;u<c.length;u+=1)c[u].c();o=Te(),this.h()},l(u){e=q(u,"DIV",{class:!0});var d=F(e);t=q(d,"EM",{});var h=F(t);i=ye(h,"Sender Stats - Layer "),s=ye(h,n[14]),h.forEach(S),r=q(d,"BR",{}),a=Se(d);for(let f=0;f<c.length;f+=1)c[f].l(d);o=Se(d),d.forEach(S),this.h()},h(){x(e,"class","text-sm mt-4")},m(u,d){D(u,e,d),P(e,t),P(t,i),P(t,s),P(e,r),P(e,a);for(let h=0;h<c.length;h+=1)c[h]&&c[h].m(e,null);P(e,o)},p(u,d){if(d[0]&1){l=un(Object.entries(u[12]));let h;for(h=0;h<l.length;h+=1){const f=Qv(u,l,h);c[h]?c[h].p(f,d):(c[h]=fb(f),c[h].c(),c[h].m(e,o))}for(;h<c.length;h+=1)c[h].d(1);c.length=l.length}},d(u){u&&S(e),zi(c,u)}}}function mb(n){let e,t=un(n[0].allStats),i=[];for(let s=0;s<t.length;s+=1)i[s]=gb(Yv(n,t,s));return{c(){e=K("div");for(let s=0;s<i.length;s+=1)i[s].c();this.h()},l(s){e=q(s,"DIV",{class:!0});var r=F(e);for(let a=0;a<i.length;a+=1)i[a].l(r);r.forEach(S),this.h()},h(){x(e,"class","max-h-full max-w-full overflow-x-scroll overflow-y-scroll mt-4")},m(s,r){D(s,e,r);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(e,null)},p(s,r){if(r[0]&1){t=un(s[0].allStats);let a;for(a=0;a<t.length;a+=1){const o=Yv(s,t,a);i[a]?i[a].p(o,r):(i[a]=gb(o),i[a].c(),i[a].m(e,null))}for(;a<i.length;a+=1)i[a].d(1);i.length=t.length}},d(s){s&&S(e),zi(i,s)}}}function gb(n){let e,t=JSON.stringify(n[9],null,2)+"",i;return{c(){e=K("pre"),i=be(t),this.h()},l(s){e=q(s,"PRE",{class:!0});var r=F(e);i=ye(r,t),r.forEach(S),this.h()},h(){x(e,"class","block p-2")},m(s,r){D(s,e,r),P(e,i)},p(s,r){r[0]&1&&t!==(t=JSON.stringify(s[9],null,2)+"")&&gt(i,t)},d(s){s&&S(e)}}}function WO(n){let e,t,i,s="Bitrate ←",r,a,o=ws(n[0].bitrateReceive)+"",l,c,u=ws(n[0].availableIncomingBitrate)+"",d,h,f,g,v,m,_,y="Bitrate →",b,p,w=ws(n[0].bitrateSend)+"",E,C,M=ws(n[0].availableOutgoingBitrate)+"",I,T,R,V,H,B,te,j="All Stats",oe,z,W,ie,se,je="Reciever Stats",ge,L,J,U;function de(Ee,Fe){if(Ee[2]==="reciever")return HO;if(Ee[2]==="sender")return zO}let et=de(n),Ue=et&&et(n),dt=un(Object.entries(n[0])),_e=[];for(let Ee=0;Ee<dt.length;Ee+=1)_e[Ee]=ub($v(n,dt,Ee));let we=un(Object.entries(n[0].recieverStats)),O=[];for(let Ee=0;Ee<we.length;Ee+=1)O[Ee]=db(Zv(n,we,Ee));let wt=n[0].senderLayerStats&&n[0].senderLayerStats.length&&hb(n),st=n[0].allStats&&n[0].allStats.length&&mb(n);return{c(){Ue&&Ue.c(),e=Te(),t=K("div"),i=K("b"),i.textContent=s,r=Te(),a=K("span"),l=be(o),c=be("ps of "),d=be(u),h=be("ps avail"),f=Te(),g=K("hr"),v=Te(),m=K("div"),_=K("b"),_.textContent=y,b=Te(),p=K("span"),E=be(w),C=be("ps of "),I=be(M),T=be("ps avail"),R=Te(),V=K("hr"),H=Te(),B=K("details"),te=K("summary"),te.textContent=j,oe=Te(),z=K("div");for(let Ee=0;Ee<_e.length;Ee+=1)_e[Ee].c();W=Te(),ie=K("div"),se=K("em"),se.textContent=je,ge=K("br"),L=Te();for(let Ee=0;Ee<O.length;Ee+=1)O[Ee].c();J=Te(),wt&&wt.c(),U=Te(),st&&st.c(),this.h()},l(Ee){Ue&&Ue.l(Ee),e=Se(Ee),t=q(Ee,"DIV",{class:!0});var Fe=F(t);i=q(Fe,"B",{"data-svelte-h":!0}),En(i)!=="svelte-umvpgp"&&(i.textContent=s),r=Se(Fe),a=q(Fe,"SPAN",{class:!0});var He=F(a);l=ye(He,o),c=ye(He,"ps of "),d=ye(He,u),h=ye(He,"ps avail"),He.forEach(S),Fe.forEach(S),f=Se(Ee),g=q(Ee,"HR",{}),v=Se(Ee),m=q(Ee,"DIV",{class:!0});var rt=F(m);_=q(rt,"B",{"data-svelte-h":!0}),En(_)!=="svelte-7fbtvb"&&(_.textContent=y),b=Se(rt),p=q(rt,"SPAN",{class:!0});var N=F(p);E=ye(N,w),C=ye(N,"ps of "),I=ye(N,M),T=ye(N,"ps avail"),N.forEach(S),rt.forEach(S),R=Se(Ee),V=q(Ee,"HR",{}),H=Se(Ee),B=q(Ee,"DETAILS",{});var A=F(B);te=q(A,"SUMMARY",{"data-svelte-h":!0}),En(te)!=="svelte-1ig7oxo"&&(te.textContent=j),oe=Se(A),z=q(A,"DIV",{class:!0});var ee=F(z);for(let ve=0;ve<_e.length;ve+=1)_e[ve].l(ee);ee.forEach(S),W=Se(A),ie=q(A,"DIV",{class:!0});var me=F(ie);se=q(me,"EM",{"data-svelte-h":!0}),En(se)!=="svelte-lyfci8"&&(se.textContent=je),ge=q(me,"BR",{}),L=Se(me);for(let ve=0;ve<O.length;ve+=1)O[ve].l(me);me.forEach(S),J=Se(A),wt&&wt.l(A),U=Se(A),st&&st.l(A),A.forEach(S),this.h()},h(){x(a,"class","text-right"),x(t,"class","flex justify-between"),x(p,"class","text-right"),x(m,"class","flex justify-between"),x(z,"class","text-sm"),x(ie,"class","text-sm mt-4")},m(Ee,Fe){Ue&&Ue.m(Ee,Fe),D(Ee,e,Fe),D(Ee,t,Fe),P(t,i),P(t,r),P(t,a),P(a,l),P(a,c),P(a,d),P(a,h),D(Ee,f,Fe),D(Ee,g,Fe),D(Ee,v,Fe),D(Ee,m,Fe),P(m,_),P(m,b),P(m,p),P(p,E),P(p,C),P(p,I),P(p,T),D(Ee,R,Fe),D(Ee,V,Fe),D(Ee,H,Fe),D(Ee,B,Fe),P(B,te),P(B,oe),P(B,z);for(let He=0;He<_e.length;He+=1)_e[He]&&_e[He].m(z,null);P(B,W),P(B,ie),P(ie,se),P(ie,ge),P(ie,L);for(let He=0;He<O.length;He+=1)O[He]&&O[He].m(ie,null);P(B,J),wt&&wt.m(B,null),P(B,U),st&&st.m(B,null)},p(Ee,Fe){if(et===(et=de(Ee))&&Ue?Ue.p(Ee,Fe):(Ue&&Ue.d(1),Ue=et&&et(Ee),Ue&&(Ue.c(),Ue.m(e.parentNode,e))),Fe[0]&1&&o!==(o=ws(Ee[0].bitrateReceive)+"")&&gt(l,o),Fe[0]&1&&u!==(u=ws(Ee[0].availableIncomingBitrate)+"")&&gt(d,u),Fe[0]&1&&w!==(w=ws(Ee[0].bitrateSend)+"")&&gt(E,w),Fe[0]&1&&M!==(M=ws(Ee[0].availableOutgoingBitrate)+"")&&gt(I,M),Fe[0]&1){dt=un(Object.entries(Ee[0]));let He;for(He=0;He<dt.length;He+=1){const rt=$v(Ee,dt,He);_e[He]?_e[He].p(rt,Fe):(_e[He]=ub(rt),_e[He].c(),_e[He].m(z,null))}for(;He<_e.length;He+=1)_e[He].d(1);_e.length=dt.length}if(Fe[0]&1){we=un(Object.entries(Ee[0].recieverStats));let He;for(He=0;He<we.length;He+=1){const rt=Zv(Ee,we,He);O[He]?O[He].p(rt,Fe):(O[He]=db(rt),O[He].c(),O[He].m(ie,null))}for(;He<O.length;He+=1)O[He].d(1);O.length=we.length}Ee[0].senderLayerStats&&Ee[0].senderLayerStats.length?wt?wt.p(Ee,Fe):(wt=hb(Ee),wt.c(),wt.m(B,U)):wt&&(wt.d(1),wt=null),Ee[0].allStats&&Ee[0].allStats.length?st?st.p(Ee,Fe):(st=mb(Ee),st.c(),st.m(B,null)):st&&(st.d(1),st=null)},d(Ee){Ee&&(S(e),S(t),S(f),S(g),S(v),S(m),S(R),S(V),S(H),S(B)),Ue&&Ue.d(Ee),zi(_e,Ee),zi(O,Ee),wt&&wt.d(),st&&st.d()}}}function jO(n){let e,t,i=n[0]&&n[6]&&sb(n);return{c(){i&&i.c(),e=dn()},l(s){i&&i.l(s),e=dn()},m(s,r){i&&i.m(s,r),D(s,e,r),t=!0},p(s,r){s[0]&&s[6]?i?(i.p(s,r),r[0]&65&&ce(i,1)):(i=sb(s),i.c(),ce(i,1),i.m(e.parentNode,e)):i&&(_n(),fe(i,1,1,()=>{i=null}),vn())},i(s){t||(ce(i),t=!0)},o(s){fe(i),t=!1},d(s){s&&S(e),i&&i.d(s)}}}function KO(n,e,t){let i,s,r,{stats:a}=e,{name:o="Video Stats"}=e,{direction:l="reciever"}=e,{activeStore:c}=e,{activeId:u}=e;return n.$$set=d=>{t(7,e=$e($e({},e),Wt(d))),"stats"in d&&t(0,a=d.stats),"name"in d&&t(1,o=d.name),"direction"in d&&t(2,l=d.direction),"activeStore"in d&&t(3,c=d.activeStore),"activeId"in d&&t(4,u=d.activeId)},n.$$.update=()=>{n.$$.dirty[0]&1&&t(8,i=a.senderLayerStats&&a.senderLayerStats.length?a.senderLayerStats[0]:null),n.$$.dirty[0]&1&&t(5,s=a.recieverStats??null),n.$$.dirty[0]&292&&t(6,r=l==="reciever"?s:i)},e=Wt(e),[a,o,l,c,u,s,r,e,i]}class Dd extends Bt{constructor(e){super(),Vt(this,e,KO,jO,Ft,{stats:0,name:1,direction:2,activeStore:3,activeId:4},null,[-1,-1])}}function mf(n){const e=n.slice(),t=e[14];return e[54]=t,e}function gf(n){const e=n.slice(),t=e[13];return e[54]=t,e}function _f(n){const e=n.slice(),t=e[12];return e[54]=t,e}function vf(n){const e=n.slice(),t=e[11];return e[54]=t,e}function _b(n,e,t){const i=n.slice();return i[55]=e[t],i}function vb(n,e,t){const i=n.slice();return i[58]=e[t],i}function qO(n){let e;return{c(){e=be("Enable Direct Connection")},l(t){e=ye(t,"Enable Direct Connection")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function XO(n){let e;return{c(){e=be("Enable Livekit Connection")},l(t){e=ye(t,"Enable Livekit Connection")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function bb(n){let e,t,i;function s(a){n[34](a)}let r={disabled:!n[2],name:"Use Direct Connection",active:"bg-red-700",class:"mb-6 mx-auto",$$slots:{default:[YO]},$$scope:{ctx:n}};return n[3]!==void 0&&(r.checked=n[3]),e=new Po({props:r}),Nn.push(()=>vi(e,"checked",s)),e.$on("change",n[35]),{c(){ct(e.$$.fragment)},l(a){pt(e.$$.fragment,a)},m(a,o){lt(e,a,o),i=!0},p(a,o){const l={};o[0]&4&&(l.disabled=!a[2]),o[1]&1073741824&&(l.$$scope={dirty:o,ctx:a}),!t&&o[0]&8&&(t=!0,l.checked=a[3],_i(()=>t=!1)),e.$set(l)},i(a){i||(ce(e.$$.fragment,a),i=!0)},o(a){fe(e.$$.fragment,a),i=!1},d(a){ut(e,a)}}}function YO(n){let e;return{c(){e=be("Record To Twitch")},l(t){e=ye(t,"Record To Twitch")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function JO(n){let e=n[58]+"p",t;return{c(){t=be(e)},l(i){t=ye(i,e)},m(i,s){D(i,t,s)},p:Tt,d(i){i&&S(t)}}}function yb(n){let e,t,i;function s(a){n[36](a)}let r={name:"video size",value:parseInt(n[58]),label:n[58]+"p",regionLabel:"flex-grow-0",$$slots:{default:[JO]},$$scope:{ctx:n}};return n[4]!==void 0&&(r.group=n[4]),e=new eg({props:r}),Nn.push(()=>vi(e,"group",s)),e.$on("change",n[23]),{c(){ct(e.$$.fragment)},l(a){pt(e.$$.fragment,a)},m(a,o){lt(e,a,o),i=!0},p(a,o){const l={};o[1]&1073741824&&(l.$$scope={dirty:o,ctx:a}),!t&&o[0]&16&&(t=!0,l.group=a[4],_i(()=>t=!1)),e.$set(l)},i(a){i||(ce(e.$$.fragment,a),i=!0)},o(a){fe(e.$$.fragment,a),i=!1},d(a){ut(e,a)}}}function QO(n){let e,t,i=un(Object.keys(n[20])),s=[];for(let a=0;a<i.length;a+=1)s[a]=yb(vb(n,i,a));const r=a=>fe(s[a],1,1,()=>{s[a]=null});return{c(){for(let a=0;a<s.length;a+=1)s[a].c();e=dn()},l(a){for(let o=0;o<s.length;o+=1)s[o].l(a);e=dn()},m(a,o){for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(a,o);D(a,e,o),t=!0},p(a,o){if(o[0]&9437200){i=un(Object.keys(a[20]));let l;for(l=0;l<i.length;l+=1){const c=vb(a,i,l);s[l]?(s[l].p(c,o),ce(s[l],1)):(s[l]=yb(c),s[l].c(),ce(s[l],1),s[l].m(e.parentNode,e))}for(_n(),l=i.length;l<s.length;l+=1)r(l);vn()}},i(a){if(!t){for(let o=0;o<i.length;o+=1)ce(s[o]);t=!0}},o(a){s=s.filter(Boolean);for(let o=0;o<s.length;o+=1)fe(s[o]);t=!1},d(a){a&&S(e),zi(s,a)}}}function ZO(n){let e=n[55]+"",t;return{c(){t=be(e)},l(i){t=ye(i,e)},m(i,s){D(i,t,s)},p:Tt,d(i){i&&S(t)}}}function Tb(n){let e,t,i;function s(a){n[37](a)}let r={name:"video codec",value:n[55],label:n[55],regionLabel:"flex-grow-0",$$slots:{default:[ZO]},$$scope:{ctx:n}};return n[5]!==void 0&&(r.group=n[5]),e=new eg({props:r}),Nn.push(()=>vi(e,"group",s)),e.$on("change",n[23]),{c(){ct(e.$$.fragment)},l(a){pt(e.$$.fragment,a)},m(a,o){lt(e,a,o),i=!0},p(a,o){const l={};o[1]&1073741824&&(l.$$scope={dirty:o,ctx:a}),!t&&o[0]&32&&(t=!0,l.group=a[5],_i(()=>t=!1)),e.$set(l)},i(a){i||(ce(e.$$.fragment,a),i=!0)},o(a){fe(e.$$.fragment,a),i=!1},d(a){ut(e,a)}}}function $O(n){let e,t,i=un(n[19]),s=[];for(let a=0;a<i.length;a+=1)s[a]=Tb(_b(n,i,a));const r=a=>fe(s[a],1,1,()=>{s[a]=null});return{c(){for(let a=0;a<s.length;a+=1)s[a].c();e=dn()},l(a){for(let o=0;o<s.length;o+=1)s[o].l(a);e=dn()},m(a,o){for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(a,o);D(a,e,o),t=!0},p(a,o){if(o[0]&8912928){i=un(a[19]);let l;for(l=0;l<i.length;l+=1){const c=_b(a,i,l);s[l]?(s[l].p(c,o),ce(s[l],1)):(s[l]=Tb(c),s[l].c(),ce(s[l],1),s[l].m(e.parentNode,e))}for(_n(),l=i.length;l<s.length;l+=1)r(l);vn()}},i(a){if(!t){for(let o=0;o<i.length;o+=1)ce(s[o]);t=!0}},o(a){s=s.filter(Boolean);for(let o=0;o<s.length;o+=1)fe(s[o]);t=!1},d(a){a&&S(e),zi(s,a)}}}function Sb(n){let e,t,i;function s(a){n[38](a)}let r={disabled:!n[2],name:"Allow Backup Codec",active:"bg-primary-700",class:"my-2",$$slots:{default:[e4]},$$scope:{ctx:n}};return n[6]!==void 0&&(r.checked=n[6]),e=new Po({props:r}),Nn.push(()=>vi(e,"checked",s)),e.$on("change",n[39]),{c(){ct(e.$$.fragment)},l(a){pt(e.$$.fragment,a)},m(a,o){lt(e,a,o),i=!0},p(a,o){const l={};o[0]&4&&(l.disabled=!a[2]),o[1]&1073741824&&(l.$$scope={dirty:o,ctx:a}),!t&&o[0]&64&&(t=!0,l.checked=a[6],_i(()=>t=!1)),e.$set(l)},i(a){i||(ce(e.$$.fragment,a),i=!0)},o(a){fe(e.$$.fragment,a),i=!1},d(a){ut(e,a)}}}function e4(n){let e;return{c(){e=be("Allow Fallback Codec")},l(t){e=ye(t,"Allow Fallback Codec")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function Eb(n){let e,t,i,s,r,a;function o(d){n[40](d)}let l={id:"bitrate_slider",class:"mt-8",name:"Max Bitrate slider",min:1e5,max:9e6,step:1e5,$$slots:{default:[t4]},$$scope:{ctx:n}};n[7]!==void 0&&(l.value=n[7]),e=new tg({props:l}),Nn.push(()=>vi(e,"value",o)),e.$on("change",n[41]);function c(d){n[42](d)}let u={name:"Update",size:"sm",active:"bg-primary-700",class:"mt-2 mx-auto",$$slots:{default:[n4]},$$scope:{ctx:n}};return n[8]!==void 0&&(u.checked=n[8]),s=new Po({props:u}),Nn.push(()=>vi(s,"checked",c)),{c(){ct(e.$$.fragment),i=Te(),ct(s.$$.fragment)},l(d){pt(e.$$.fragment,d),i=Se(d),pt(s.$$.fragment,d)},m(d,h){lt(e,d,h),D(d,i,h),lt(s,d,h),a=!0},p(d,h){const f={};h[0]&128|h[1]&1073741824&&(f.$$scope={dirty:h,ctx:d}),!t&&h[0]&128&&(t=!0,f.value=d[7],_i(()=>t=!1)),e.$set(f);const g={};h[1]&1073741824&&(g.$$scope={dirty:h,ctx:d}),!r&&h[0]&256&&(r=!0,g.checked=d[8],_i(()=>r=!1)),s.$set(g)},i(d){a||(ce(e.$$.fragment,d),ce(s.$$.fragment,d),a=!0)},o(d){fe(e.$$.fragment,d),fe(s.$$.fragment,d),a=!1},d(d){d&&S(i),ut(e,d),ut(s,d)}}}function t4(n){let e,t,i="Max Bitrate",s,r,a=n[7]/1e3+"",o,l;return{c(){e=K("div"),t=K("h4"),t.textContent=i,s=Te(),r=K("div"),o=be(a),l=be("k bits/sec"),this.h()},l(c){e=q(c,"DIV",{class:!0});var u=F(e);t=q(u,"H4",{class:!0,"data-svelte-h":!0}),En(t)!=="svelte-1ifilb2"&&(t.textContent=i),s=Se(u),r=q(u,"DIV",{class:!0});var d=F(r);o=ye(d,a),l=ye(d,"k bits/sec"),d.forEach(S),u.forEach(S),this.h()},h(){x(t,"class","h4"),x(r,"class","text-sm"),x(e,"class","flex justify-between items-center")},m(c,u){D(c,e,u),P(e,t),P(e,s),P(e,r),P(r,o),P(r,l)},p(c,u){u[0]&128&&a!==(a=c[7]/1e3+"")&&gt(o,a)},d(c){c&&S(e)}}}function n4(n){let e;return{c(){e=be("Update With Resolution + Codec")},l(t){e=ye(t,"Update With Resolution + Codec")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function i4(n){let e,t,i;function s(a){n[45](a)}let r={id:"playout_delay_slider",class:"mt-8",name:"Playout Delay slider",min:0,max:4,step:.01,$$slots:{default:[r4]},$$scope:{ctx:n}};return n[10]!==void 0&&(r.value=n[10]),e=new tg({props:r}),Nn.push(()=>vi(e,"value",s)),e.$on("change",n[46]),{c(){ct(e.$$.fragment)},l(a){pt(e.$$.fragment,a)},m(a,o){lt(e,a,o),i=!0},p(a,o){const l={};o[0]&1024|o[1]&1073741824&&(l.$$scope={dirty:o,ctx:a}),!t&&o[0]&1024&&(t=!0,l.value=a[10],_i(()=>t=!1)),e.$set(l)},i(a){i||(ce(e.$$.fragment,a),i=!0)},o(a){fe(e.$$.fragment,a),i=!1},d(a){ut(e,a)}}}function s4(n){let e,t,i;function s(a){n[43](a)}let r={id:"playout_delay_slider",class:"mt-8",name:"Playout Delay slider",min:0,max:4,step:.01,$$slots:{default:[a4]},$$scope:{ctx:n}};return n[9]!==void 0&&(r.value=n[9]),e=new tg({props:r}),Nn.push(()=>vi(e,"value",s)),e.$on("change",n[44]),{c(){ct(e.$$.fragment)},l(a){pt(e.$$.fragment,a)},m(a,o){lt(e,a,o),i=!0},p(a,o){const l={};o[0]&512|o[1]&1073741824&&(l.$$scope={dirty:o,ctx:a}),!t&&o[0]&512&&(t=!0,l.value=a[9],_i(()=>t=!1)),e.$set(l)},i(a){i||(ce(e.$$.fragment,a),i=!0)},o(a){fe(e.$$.fragment,a),i=!1},d(a){ut(e,a)}}}function r4(n){let e,t,i="Livekit Playout Delay",s,r,a,o;return{c(){e=K("div"),t=K("h4"),t.textContent=i,s=Te(),r=K("div"),a=be(n[10]),o=be(" seconds"),this.h()},l(l){e=q(l,"DIV",{class:!0});var c=F(e);t=q(c,"H4",{class:!0,"data-svelte-h":!0}),En(t)!=="svelte-eub2dm"&&(t.textContent=i),s=Se(c),r=q(c,"DIV",{class:!0});var u=F(r);a=ye(u,n[10]),o=ye(u," seconds"),u.forEach(S),c.forEach(S),this.h()},h(){x(t,"class","h4"),x(r,"class","text-sm"),x(e,"class","flex justify-between items-center")},m(l,c){D(l,e,c),P(e,t),P(e,s),P(e,r),P(r,a),P(r,o)},p(l,c){c[0]&1024&&gt(a,l[10])},d(l){l&&S(e)}}}function a4(n){let e,t,i="Direct Playout Delay",s,r,a,o;return{c(){e=K("div"),t=K("h4"),t.textContent=i,s=Te(),r=K("div"),a=be(n[9]),o=be(" seconds"),this.h()},l(l){e=q(l,"DIV",{class:!0});var c=F(e);t=q(c,"H4",{class:!0,"data-svelte-h":!0}),En(t)!=="svelte-11xis01"&&(t.textContent=i),s=Se(c),r=q(c,"DIV",{class:!0});var u=F(r);a=ye(u,n[9]),o=ye(u," seconds"),u.forEach(S),c.forEach(S),this.h()},h(){x(t,"class","h4"),x(r,"class","text-sm"),x(e,"class","flex justify-between items-center")},m(l,c){D(l,e,c),P(e,t),P(e,s),P(e,r),P(r,a),P(r,o)},p(l,c){c[0]&512&&gt(a,l[9])},d(l){l&&S(e)}}}function o4(n){let e;return{c(){e=be("YOU")},l(t){e=ye(t,"YOU")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function c4(n){let e;return{c(){e=be("ROV")},l(t){e=ye(t,"ROV")},m(t,i){D(t,e,i)},d(t){t&&S(e)}}}function l4(n){let e,t="Video Stats",i,s,r,a,o,l,c;function u(g){n[49](g)}let d={name:"your side",value:0,$$slots:{default:[o4]},$$scope:{ctx:n}};n[0]!==void 0&&(d.group=n[0]),s=new X0({props:d}),Nn.push(()=>vi(s,"group",u));function h(g){n[50](g)}let f={name:"ROVs side",value:1,$$slots:{default:[c4]},$$scope:{ctx:n}};return n[0]!==void 0&&(f.group=n[0]),o=new X0({props:f}),Nn.push(()=>vi(o,"group",h)),{c(){e=K("h4"),e.textContent=t,i=Te(),ct(s.$$.fragment),a=Te(),ct(o.$$.fragment),this.h()},l(g){e=q(g,"H4",{class:!0,"data-svelte-h":!0}),En(e)!=="svelte-16l2n7b"&&(e.textContent=t),i=Se(g),pt(s.$$.fragment,g),a=Se(g),pt(o.$$.fragment,g),this.h()},h(){x(e,"class","h4 self-center flex-1 font-bold")},m(g,v){D(g,e,v),D(g,i,v),lt(s,g,v),D(g,a,v),lt(o,g,v),c=!0},p(g,v){const m={};v[1]&1073741824&&(m.$$scope={dirty:v,ctx:g}),!r&&v[0]&1&&(r=!0,m.group=g[0],_i(()=>r=!1)),s.$set(m);const _={};v[1]&1073741824&&(_.$$scope={dirty:v,ctx:g}),!l&&v[0]&1&&(l=!0,_.group=g[0],_i(()=>l=!1)),o.$set(_)},i(g){c||(ce(s.$$.fragment,g),ce(o.$$.fragment,g),c=!0)},o(g){fe(s.$$.fragment,g),fe(o.$$.fragment,g),c=!1},d(g){g&&(S(e),S(i),S(a)),ut(s,g),ut(o,g)}}}function u4(n){let e,t;return e=new Cy({props:{$$slots:{default:[h4]},$$scope:{ctx:n}}}),{c(){ct(e.$$.fragment)},l(i){pt(e.$$.fragment,i)},m(i,s){lt(e,i,s),t=!0},p(i,s){const r={};s[0]&24576|s[1]&1073741824&&(r.$$scope={dirty:s,ctx:i}),e.$set(r)},i(i){t||(ce(e.$$.fragment,i),t=!0)},o(i){fe(e.$$.fragment,i),t=!1},d(i){ut(e,i)}}}function d4(n){let e,t;return e=new Cy({props:{$$slots:{default:[f4]},$$scope:{ctx:n}}}),{c(){ct(e.$$.fragment)},l(i){pt(e.$$.fragment,i)},m(i,s){lt(e,i,s),t=!0},p(i,s){const r={};s[0]&6144|s[1]&1073741824&&(r.$$scope={dirty:s,ctx:i}),e.$set(r)},i(i){t||(ce(e.$$.fragment,i),t=!0)},o(i){fe(e.$$.fragment,i),t=!1},d(i){ut(e,i)}}}function Ab(n){let e,t;return e=new Dd({props:{stats:n[54],activeStore:n[15],activeId:$E,direction:"sender",name:"Direct",class:"border-token border-teal-500 !bg-teal-100"}}),{c(){ct(e.$$.fragment)},l(i){pt(e.$$.fragment,i)},m(i,s){lt(e,i,s),t=!0},p(i,s){const r={};s[0]&8192&&(r.stats=i[54]),e.$set(r)},i(i){t||(ce(e.$$.fragment,i),t=!0)},o(i){fe(e.$$.fragment,i),t=!1},d(i){ut(e,i)}}}function Cb(n){let e,t;return e=new Dd({props:{stats:n[54],activeStore:n[15],activeId:ZE,direction:"sender",name:"Livekit",class:"border-token border-pink-500 !bg-pink-100"}}),{c(){ct(e.$$.fragment)},l(i){pt(e.$$.fragment,i)},m(i,s){lt(e,i,s),t=!0},p(i,s){const r={};s[0]&16384&&(r.stats=i[54]),e.$set(r)},i(i){t||(ce(e.$$.fragment,i),t=!0)},o(i){fe(e.$$.fragment,i),t=!1},d(i){ut(e,i)}}}function h4(n){let e,t,i,s=n[13]&&Ab(gf(n)),r=n[14]&&Cb(mf(n));return{c(){s&&s.c(),e=Te(),r&&r.c(),t=dn()},l(a){s&&s.l(a),e=Se(a),r&&r.l(a),t=dn()},m(a,o){s&&s.m(a,o),D(a,e,o),r&&r.m(a,o),D(a,t,o),i=!0},p(a,o){a[13]?s?(s.p(gf(a),o),o[0]&8192&&ce(s,1)):(s=Ab(gf(a)),s.c(),ce(s,1),s.m(e.parentNode,e)):s&&(_n(),fe(s,1,1,()=>{s=null}),vn()),a[14]?r?(r.p(mf(a),o),o[0]&16384&&ce(r,1)):(r=Cb(mf(a)),r.c(),ce(r,1),r.m(t.parentNode,t)):r&&(_n(),fe(r,1,1,()=>{r=null}),vn())},i(a){i||(ce(s),ce(r),i=!0)},o(a){fe(s),fe(r),i=!1},d(a){a&&(S(e),S(t)),s&&s.d(a),r&&r.d(a)}}}function wb(n){let e,t;return e=new Dd({props:{stats:n[54],activeStore:n[15],activeId:$E,direction:"reciever",name:"Direct",class:"border-token border-teal-500 !bg-teal-100"}}),{c(){ct(e.$$.fragment)},l(i){pt(e.$$.fragment,i)},m(i,s){lt(e,i,s),t=!0},p(i,s){const r={};s[0]&2048&&(r.stats=i[54]),e.$set(r)},i(i){t||(ce(e.$$.fragment,i),t=!0)},o(i){fe(e.$$.fragment,i),t=!1},d(i){ut(e,i)}}}function Rb(n){let e,t;return e=new Dd({props:{stats:n[54],activeStore:n[15],activeId:ZE,direction:"reciever",name:"Livekit",class:"border-token border-pink-500 !bg-pink-100"}}),{c(){ct(e.$$.fragment)},l(i){pt(e.$$.fragment,i)},m(i,s){lt(e,i,s),t=!0},p(i,s){const r={};s[0]&4096&&(r.stats=i[54]),e.$set(r)},i(i){t||(ce(e.$$.fragment,i),t=!0)},o(i){fe(e.$$.fragment,i),t=!1},d(i){ut(e,i)}}}function f4(n){let e,t,i,s=n[11]&&wb(vf(n)),r=n[12]&&Rb(_f(n));return{c(){s&&s.c(),e=Te(),r&&r.c(),t=dn()},l(a){s&&s.l(a),e=Se(a),r&&r.l(a),t=dn()},m(a,o){s&&s.m(a,o),D(a,e,o),r&&r.m(a,o),D(a,t,o),i=!0},p(a,o){a[11]?s?(s.p(vf(a),o),o[0]&2048&&ce(s,1)):(s=wb(vf(a)),s.c(),ce(s,1),s.m(e.parentNode,e)):s&&(_n(),fe(s,1,1,()=>{s=null}),vn()),a[12]?r?(r.p(_f(a),o),o[0]&4096&&ce(r,1)):(r=Rb(_f(a)),r.c(),ce(r,1),r.m(t.parentNode,t)):r&&(_n(),fe(r,1,1,()=>{r=null}),vn())},i(a){i||(ce(s),ce(r),i=!0)},o(a){fe(s),fe(r),i=!1},d(a){a&&(S(e),S(t)),s&&s.d(a),r&&r.d(a)}}}function p4(n){let e,t,i,s;const r=[d4,u4],a=[];function o(l,c){return l[0]==0?0:1}return e=o(n),t=a[e]=r[e](n),{c(){t.c(),i=dn()},l(l){t.l(l),i=dn()},m(l,c){a[e].m(l,c),D(l,i,c),s=!0},p(l,c){let u=e;e=o(l),e===u?a[e].p(l,c):(_n(),fe(a[u],1,1,()=>{a[u]=null}),vn(),t=a[e],t?t.p(l,c):(t=a[e]=r[e](l),t.c()),ce(t,1),t.m(i.parentNode,i))},i(l){s||(ce(t),s=!0)},o(l){fe(t),s=!1},d(l){l&&S(i),a[e].d(l)}}}function m4(n){let e,t,i,s,r,a="Video Settings",o,l,c,u,d,h,f,g,v,m,_,y="Resolution",b,p,w,E,C="Codec",M,I,T,R,V,H,B,te,j,oe,z,W,ie;i=new gd({props:{class:"text-3xl pointer-events-none",tabindex:"-1",variation:"round"}});function se(_e){n[30](_e)}let je={name:"Enable Direct Connection",active:"bg-teal-700",class:"mb-6 mx-auto",$$slots:{default:[qO]},$$scope:{ctx:n}};n[1]!==void 0&&(je.checked=n[1]),l=new Po({props:je}),Nn.push(()=>vi(l,"checked",se)),l.$on("change",n[31]);function ge(_e){n[32](_e)}let L={name:"Enable Direct Connection",active:"bg-pink-600",class:"mb-6 mx-auto",$$slots:{default:[XO]},$$scope:{ctx:n}};n[2]!==void 0&&(L.checked=n[2]),d=new Po({props:L}),Nn.push(()=>vi(d,"checked",ge)),d.$on("change",n[33]);let J=n[2]&&bb(n);p=new lp({props:{id:"resolution_radio_group",display:"flex flex-wrap max-w-full items-center justify-center",rounded:"rounded-3xl",$$slots:{default:[QO]},$$scope:{ctx:n}}}),I=new lp({props:{id:"codec_radio_group",display:"flex flex-wrap max-w-full items-center  justify-center",rounded:"rounded-3xl",$$slots:{default:[$O]},$$scope:{ctx:n}}});let U=n[2]&&Sb(n),de=n[2]&&Eb(n);const et=[s4,i4],Ue=[];function dt(_e,we){return _e[1]?0:_e[2]?1:-1}return~(B=dt(n))&&(te=Ue[B]=et[B](n)),oe=new dw({props:{justify:"justify-center",class:"mt-8 mb-2",active:"border-token !border-t-0 !border-r-0 !border-l-0 border-surface-900-50-token",$$slots:{panel:[p4],default:[l4]},$$scope:{ctx:n}}}),{c(){e=K("div"),t=K("button"),ct(i.$$.fragment),s=Te(),r=K("h3"),r.textContent=a,o=Te(),ct(l.$$.fragment),u=Te(),ct(d.$$.fragment),f=Te(),J&&J.c(),g=Te(),v=K("hr"),m=Te(),_=K("label"),_.textContent=y,b=Te(),ct(p.$$.fragment),w=Te(),E=K("label"),E.textContent=C,M=Te(),ct(I.$$.fragment),T=Te(),U&&U.c(),R=Te(),de&&de.c(),V=Te(),H=K("div"),te&&te.c(),j=Te(),ct(oe.$$.fragment),this.h()},l(_e){e=q(_e,"DIV",{class:!0});var we=F(e);t=q(we,"BUTTON",{class:!0});var O=F(t);pt(i.$$.fragment,O),O.forEach(S),s=Se(we),r=q(we,"H3",{class:!0,"data-svelte-h":!0}),En(r)!=="svelte-s5whrt"&&(r.textContent=a),o=Se(we),pt(l.$$.fragment,we),u=Se(we),pt(d.$$.fragment,we),f=Se(we),J&&J.l(we),g=Se(we),v=q(we,"HR",{}),m=Se(we),_=q(we,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),En(_)!=="svelte-152hiqk"&&(_.textContent=y),b=Se(we),pt(p.$$.fragment,we),w=Se(we),E=q(we,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),En(E)!=="svelte-1ilwpw8"&&(E.textContent=C),M=Se(we),pt(I.$$.fragment,we),T=Se(we),U&&U.l(we),R=Se(we),de&&de.l(we),V=Se(we),H=q(we,"DIV",{role:!0,tabindex:!0});var wt=F(H);te&&te.l(wt),wt.forEach(S),j=Se(we),pt(oe.$$.fragment,we),we.forEach(S),this.h()},h(){x(t,"class","btn btn-icon-lg btn-icon fixed bg-surface-800 top-2.5 right-2.5"),x(r,"class","h3 my-0.5 mb-6 text-left"),x(_,"class","h4 mt-8 mb-2 font-bold"),x(_,"for","resolution_radio_group"),x(E,"class","h4 font-bold mt-8 mb-2"),x(E,"for","codec_radio_group"),x(H,"role","cell"),x(H,"tabindex","-1"),x(e,"class","w-full px-6 py-4 relative")},m(_e,we){D(_e,e,we),P(e,t),lt(i,t,null),P(e,s),P(e,r),P(e,o),lt(l,e,null),P(e,u),lt(d,e,null),P(e,f),J&&J.m(e,null),P(e,g),P(e,v),P(e,m),P(e,_),P(e,b),lt(p,e,null),P(e,w),P(e,E),P(e,M),lt(I,e,null),P(e,T),U&&U.m(e,null),P(e,R),de&&de.m(e,null),P(e,V),P(e,H),~B&&Ue[B].m(H,null),P(e,j),lt(oe,e,null),z=!0,W||(ie=[X(t,"click",n[29]),X(H,"mouseenter",n[47]),X(H,"mouseleave",n[48])],W=!0)},p(_e,we){const O={};we[1]&1073741824&&(O.$$scope={dirty:we,ctx:_e}),!c&&we[0]&2&&(c=!0,O.checked=_e[1],_i(()=>c=!1)),l.$set(O);const wt={};we[1]&1073741824&&(wt.$$scope={dirty:we,ctx:_e}),!h&&we[0]&4&&(h=!0,wt.checked=_e[2],_i(()=>h=!1)),d.$set(wt),_e[2]?J?(J.p(_e,we),we[0]&4&&ce(J,1)):(J=bb(_e),J.c(),ce(J,1),J.m(e,g)):J&&(_n(),fe(J,1,1,()=>{J=null}),vn());const st={};we[0]&16|we[1]&1073741824&&(st.$$scope={dirty:we,ctx:_e}),p.$set(st);const Ee={};we[0]&32|we[1]&1073741824&&(Ee.$$scope={dirty:we,ctx:_e}),I.$set(Ee),_e[2]?U?(U.p(_e,we),we[0]&4&&ce(U,1)):(U=Sb(_e),U.c(),ce(U,1),U.m(e,R)):U&&(_n(),fe(U,1,1,()=>{U=null}),vn()),_e[2]?de?(de.p(_e,we),we[0]&4&&ce(de,1)):(de=Eb(_e),de.c(),ce(de,1),de.m(e,V)):de&&(_n(),fe(de,1,1,()=>{de=null}),vn());let Fe=B;B=dt(_e),B===Fe?~B&&Ue[B].p(_e,we):(te&&(_n(),fe(Ue[Fe],1,1,()=>{Ue[Fe]=null}),vn()),~B?(te=Ue[B],te?te.p(_e,we):(te=Ue[B]=et[B](_e),te.c()),ce(te,1),te.m(H,null)):te=null);const He={};we[0]&30721|we[1]&1073741824&&(He.$$scope={dirty:we,ctx:_e}),oe.$set(He)},i(_e){z||(ce(i.$$.fragment,_e),ce(l.$$.fragment,_e),ce(d.$$.fragment,_e),ce(J),ce(p.$$.fragment,_e),ce(I.$$.fragment,_e),ce(U),ce(de),ce(te),ce(oe.$$.fragment,_e),z=!0)},o(_e){fe(i.$$.fragment,_e),fe(l.$$.fragment,_e),fe(d.$$.fragment,_e),fe(J),fe(p.$$.fragment,_e),fe(I.$$.fragment,_e),fe(U),fe(de),fe(te),fe(oe.$$.fragment,_e),z=!1},d(_e){_e&&S(e),ut(i),ut(l),ut(d),J&&J.d(),ut(p),ut(I),U&&U.d(),de&&de.d(),~B&&Ue[B].d(),ut(oe),W=!1,kn(ie)}}}const g4=n=>{var e,t,i,s;if(rm.set(n.stats),!(am+500>ti())&&(cs.set(n.enabled),cs.get()===!0&&(Mc.set(n.allowBackupCodec===!0),((e=n.baseStream)==null?void 0:e.maxBitrate)!=null&&Lr.set(n.baseStream.maxBitrate),Ji.get()===!1))){((t=n.baseStream)==null?void 0:t.height)!=null&&er.set(n.baseStream.height);const r=n==null?void 0:n.codec,a=(s=(i=ln.livekitVideoStats.get())==null?void 0:i.recieverStats)==null?void 0:s.videoCodec;tr.set(a??r??"unknown")}},_4=n=>{var t,i,s,r,a,o;sm.set(n.stats);const e=ln.simplePeerConnection&&ln.simplePeerConnection.connectionState.get()!==Dt.failed&&ln.simplePeerConnection.connectionState.get()!==Dt.disconnectedOk;if(Ji.set(e),Ji.get()===!0){(t=n.baseStream)!=null&&t.height&&er.set(n.baseStream.height);const l=n==null?void 0:n.codec,c=(s=(i=ln.simplePeerVideoStats.get())==null?void 0:i.recieverStats)==null?void 0:s.videoCodec,u=(o=(a=(r=ln.simplePeerConnection.getCodecPreferences())==null?void 0:r[0])==null?void 0:a.split("/")[1])==null?void 0:o.toLowerCase();tr.set(c??l??u??"unknown")}},Mc=Ze(!1),er=Ze(1080),Lr=Ze(7e5),kl=Ze(!0),hc=Ze(0),fc=Ze(0),tr=Ze("vp9"),v4=Ze(!1),Ji=Ze(!1),cs=Ze(!0),aa=Ze(!1),sm=Ze(null),rm=Ze(null),kb=Ze(!1);let am=0;const ZE="lk_stats_accordion",$E="sp_stats_accordion";function b4(n,e,t){let i,s,r,a,o,l,c,u,d,h,f,g,v,m;qn(n,Ji,A=>t(1,i=A)),qn(n,cs,A=>t(2,s=A)),qn(n,aa,A=>t(3,r=A)),qn(n,er,A=>t(4,a=A)),qn(n,tr,A=>t(5,o=A)),qn(n,Mc,A=>t(6,l=A)),qn(n,Lr,A=>t(7,c=A)),qn(n,kl,A=>t(8,u=A)),qn(n,hc,A=>t(9,d=A)),qn(n,fc,A=>t(10,h=A)),qn(n,sm,A=>t(13,v=A)),qn(n,rm,A=>t(14,m=A));let _=0,y=La("");const b=cC(),p=ln.livekitVideoStats;qn(n,p,A=>t(12,g=A));const w=ln.simplePeerVideoStats;qn(n,w,A=>t(11,f=A));const E=["h264","vp8","vp9","av1"],C={90:{bitrate:{h264:95e4,vp8:75e4,vp9:55e4,av1:55e4}},180:{bitrate:{h264:95e4,vp8:75e4,vp9:55e4,av1:55e4}},360:{bitrate:{h264:95e4,vp8:75e4,vp9:55e4,av1:55e4}},480:{bitrate:{h264:169e4,vp8:133e4,vp9:98e4,av1:98e4}},540:{bitrate:{h264:18e5,vp8:15e5,vp9:11e5,av1:11e5}},720:{bitrate:{h264:35e5,vp8:3e6,vp9:18e5,av1:17e5}},1080:{bitrate:{h264:85e5,vp8:55e5,vp9:4e6,av1:35e5}}},M=A=>{Lt(A,{useSimplePeer:Ji.get(),useLivekit:cs.get(),useTwitch:aa.get(),size:er.get(),maxBitrate:Lr.get(),updateBitrateWithResolution:kl.get(),spPlayoutDelay:hc.get(),lkPlayoutDelay:fc.get(),codec:tr.get(),keepFullResLayer:v4.get(),allowBkupCodec:Mc.get(),lkRecieverVideoStats:p.get(),spRecieverVideoStats:w.get(),lkSenderVideoStats:rm.get(),spSenderVideoStats:sm.get()})},I=()=>{M("Sending twitch video change. current state:"),In.sendRovMessage(wn.create({body:{oneofKind:"setLivestreamingEnabled",setLivestreamingEnabled:{enabled:aa.get()}}}),!0)},T=A=>{if(!cs.get()&&A===!1)return;am=ti(),M("Sending lk video change. current state:");const ee={maxBitrate:Lr.get(),height:er.get(),width:0,fps:60};In.sendRovMessage(wn.create({body:{oneofKind:"setLivekitVideoOptions",setLivekitVideoOptions:{enabled:cs.get(),allowBackupCodec:Mc.get(),codec:tr.get(),baseStream:ee,simulcastLayers:[]}}}),!0)},R=A=>{if(!cs.get()&&A===!1)return;am=ti(),M("Sending sp video change. current state:");const ee=`video/${tr.get().toLowerCase()}`;ln.setSimplePeerCodec(ee),In.sendRovMessage(wn.create({body:{oneofKind:"setSimplePeerVideoOptions",setSimplePeerVideoOptions:{enabled:Ji.get(),codec:tr.get().toUpperCase(),bitrate:Lr.get(),baseStream:{maxBitrate:Lr.get(),height:er.get(),width:er.get()*(16/9),fps:60}}}}),!0)},V=()=>{T(),R()},H=()=>{kl.get()&&Lr.set(C[er.get()].bitrate[tr.get()]),V()},B=A=>{A!==void 0&&Ji.set(A),Ji.get()?ln.startSimplePeerConnection():ln.simplePeerConnection&&ln.simplePeerConnection.stop()},te=A=>{A!==void 0&&cs.set(A),cs.get()?oe():j(!1),T()},j=A=>{A!==void 0&&aa.set(A),I()},oe=async()=>{cs.get()&&ln.livekitConnection.remoteVideoTracks.get().forEach(async A=>{const ee=A.getPlayoutDelay()||0;A.setMuted(!0),A.setPlayoutDelay(fc.get()),await id(Math.max(fc.get()*1e3-ee*1e3,0)),A.setMuted(!1)})},z=async()=>{if(Ji.get()){const A=ln.simplePeerConnection.getPlayoutDelay(),ee=ln.simplePeerConnection.remoteVideoStreams.get();for(const[me,ve]of ee)for(const re of ve.getTracks())re.enabled=!1;ln.simplePeerConnection.setPlayoutDelay(hc.get()),await id(Math.max(hc.get()*1e3-A*1e3,0));for(const[me,ve]of ee)for(const re of ve.getTracks())re.enabled=!0}};Da(()=>{aa.set(ln.livekitConnection.checkIfLivestreamRecording());const A=ln.livekitConnection.isLivestreamRecording.subscribe(ve=>{aa.set(ve)}),ee=ln.simplePeerConnection.remoteVideoStreams.subscribe(ve=>{ve.size!==0?(z(),Ji.set(!0)):Ji.set(!1)}),me=ln.livekitConnection.remoteVideoTracks.subscribe(ve=>{ve.size>0&&oe()});return()=>{A(),ee(),me()}});const W=()=>b.close();function ie(A){i=A,Ji.set(i)}const se=()=>B();function je(A){s=A,cs.set(s)}const ge=()=>te();function L(A){r=A,aa.set(r)}const J=()=>j();function U(A){a=A,er.set(a)}function de(A){o=A,tr.set(o)}function et(A){l=A,Mc.set(l)}const Ue=()=>T();function dt(A){c=A,Lr.set(c)}const _e=()=>V();function we(A){u=A,kl.set(u)}function O(A){d=A,hc.set(d)}const wt=()=>z();function st(A){h=A,fc.set(h)}const Ee=()=>oe(),Fe=()=>kb.set(!0),He=()=>kb.set(!1);function rt(A){_=A,t(0,_)}function N(A){_=A,t(0,_)}return[_,i,s,r,a,o,l,c,u,d,h,f,g,v,m,y,b,p,w,E,C,T,V,H,B,te,j,oe,z,W,ie,se,je,ge,L,J,U,de,et,Ue,dt,_e,we,O,wt,st,Ee,Fe,He,rt,N]}class XV extends Bt{constructor(e){super(),Vt(this,e,b4,m4,Ft,{},null,[-1,-1])}}let Mb=NaN;class y4{constructor(){Ne(this,"replyContinuityCallbacks",[])}sendRovMessage(e,t=!1,i=null){ln.currentLivekitIdentity.get()!==null&&(e.exchangeId||(e.exchangeId=this.replyContinuityCallbacks.length+1),this.replyContinuityCallbacks[e.exchangeId]||(this.replyContinuityCallbacks[e.exchangeId]={callback:i,originalMsgData:e,reliable:t}),ln.sendMessageToRov(e,t))}resendMessage(e){const t=this.replyContinuityCallbacks[e];t&&t.originalMsgData?(li("Resending message: ",t.originalMsgData),this.sendRovMessage(t.originalMsgData,t.reliable,t.callback)):$t("resendMessage(): No message to resend for ExchangeId: ",e)}runExchangeCallback(e,t){const i=this.replyContinuityCallbacks[t];if(i){i.callback&&i.callback(e);const s=e.body.oneofKind;(s==="done"||s==="error")&&delete this.replyContinuityCallbacks[t]}}processRecivedMessage(e){let t=new Uint8Array(e);if(!t||t.length===0)return;const i=WR.fromBinary(t);this.handleRecivedMessage(i)}handleRecivedMessage(e){const t=e.body,i=e.exchangeId,s=t.oneofKind;switch(this.runExchangeCallback(e,i),ln.simplePeerConnection.checkAliveness(),s){case"heartbeat":return!0;case"done":return this.handleDoneMsgRecived(t.done,i);case"error":return this.handleErrorMsgRecived(t.error,i);case"pong":return this.handlePongMsgRecived(t.pong,i);case"continuedOutput":return this.handleContinuedOutputMsgRecived(t.continuedOutput,i);case"sensorUpdates":return this.handleSensorUpdatesMsgRecived(t.sensorUpdates,i);case"pilotChanged":return this.handlePilotChangedMsgRecived(t.pilotChanged,i);case"arming":return this.handleArmingMessageRecived(t.arming,i);case"clientConnected":return this.handleClientConnectedMsgRecived(t.clientConnected,i);case"clientDisconnected":return this.handleClientDisconnectedMsgRecived(t.clientDisconnected,i);case"simplePeerSignal":return t.simplePeerSignal.message?ln.ingestSimplePeerSignallingMsg(t.simplePeerSignal.message):$t("SP: rcvd simplePeerSignal message is empty");case"mavlink":return this.handleMavlinkMessageRecived(t.mavlink,i);case"systemMonitor":return this.handleSystemMonitorMsgRecived(t.systemMonitor,i);case"logMessage":return this.handleLogMsgRecived(t.logMessage,i);case"livekitVideoStats":return this.handleLivekitVideoStatsMsgRecived(t.livekitVideoStats,i);case"simplePeerVideoStats":return this.handleSimplePeerVideoStatsMsgRecived(t.simplePeerVideoStats,i);default:$t("Unhandled ROV message recived: ",e)}}handleDoneMsgRecived(e,t){es.get()&&Lt("Done: ",e)}handleErrorMsgRecived(e,t){$t("ROV Error: ",e),cn("ROV Error: "+e.message,2e3,null)}handlePongMsgRecived(e,t){Mb=ti();const i=Mb-Number(e.time);cO.set(i)}handleContinuedOutputMsgRecived(e,t){es.get()&&Lt("ContinuedOutput: ",t,e)}handleSensorUpdatesMsgRecived(e,t){es.get()&&Lt("SensorUpdates: ",e),JE(e)}handleSystemMonitorMsgRecived(e,t){yO(e.cpuTemp,e.cpuUsage,e.memoryUsage,e.diskUsage,e.warnings)}handlePilotChangedMsgRecived(e,t){let i=ln.currentLivekitIdentity.get();e.pilotIdentity==i?(cn("You are now the driver"),a_.set(!0)):(cn("ROV Driver is now "+e.pilotIdentity),a_.set(!1)),XR.set(e.pilotIdentity)}handleMavlinkMessageRecived(e,t){if(!e.message)return;let i=LP(e.message);for(;!i.startsWith("{");)i=i.substring(1);try{const s=JSON.parse(i);wO(s)}catch{$t("@ Mav MSG RECIVED W INVALID JSON: ",i)}}handleArmingMessageRecived(e,t){const i=e.armed;Nd.set(i)}handleClientConnectedMsgRecived(e,t){cn(e.clientPeerId+" Connected to ROV",1500,null)}handleClientDisconnectedMsgRecived(e,t){cn(e.clientPeerId+" Disconnected from ROV",1500,null)}handleLogMsgRecived(e,t){const{level:i,timestamp:s,args:r,trace:a,kind:o,origin:l}=JSON.parse(e.message);Ti.addLog(i,r,a,o,l,s)}handleLivekitVideoStatsMsgRecived(e,t){g4(e)}handleSimplePeerVideoStatsMsgRecived(e,t){_4(e)}}const In=new y4;var T4=(n=>(n.none="none",n.livekit="livekit",n.simplePeer="simplePeer",n))(T4||{});class S4{constructor(){Ne(this,"connectionState",Ze(Dt.init));Ne(this,"livekitConnection",new lD);Ne(this,"videoStreams",Ze(void 0));Ne(this,"currentLivekitIdentity",Ze(null));Ne(this,"simplePeerConnection");Ne(this,"livekitRoomPollingInterval",-1);Ne(this,"openLivekitRoomInfo",Ze([]));Ne(this,"currentVideoStreamMethod",Ze("none"));Ne(this,"livekitVideoStats",Ze(null));Ne(this,"simplePeerVideoStats",Ze(null));Ne(this,"_videoStatsIntervalId");Ne(this,"_cleanupFuncs",{});this._addCleanupFunc(dc(this.livekitConnection.latestRecivedDataMessage,e=>{const{senderId:t,msgBytes:i}=e;t==this.livekitConnection.getRoomName()&&In.processRecivedMessage(i)})),this.simplePeerConnection=new KL(aO),this._addCleanupFunc(dc(this.simplePeerConnection.latestRecivedDataMessage,e=>{In.processRecivedMessage(e)})),this._addCleanupFunc(dc(this.simplePeerConnection.outgoingSignalingMessages,e=>{In.sendRovMessage(wn.create({body:{oneofKind:"simplePeerSignal",simplePeerSignal:{message:e}}}),!0)})),this.startVideoStatsCollection()}async pollForOpenLivekitRooms(e){this.livekitRoomPollingInterval!==-1&&clearInterval(this.livekitRoomPollingInterval);const t=async()=>{const i=this.connectionState.get();if(![Dt.init,Dt.disconnectedOk,Dt.failed].includes(i))return;let s;try{s=await rD(e,iO)}catch(a){return $t("LK Error: Could not retrive list of livekit rooms",a),this.openLivekitRoomInfo.set([])}const r=s.map(a=>({name:a.name,token:a.metadata.length===0?null:aD(a.metadata,a.numParticipants)})).sort((a,o)=>a.name>o.name?1:o.name>a.name?-1:0);this.openLivekitRoomInfo.set(r)};await t(),this.livekitRoomPollingInterval=window.setInterval(t,5e3)}onConnectedActions(){Fi("Connected to ROV",this.livekitConnection._roomConn.name,this.livekitConnection._roomConn.isRecording,this.livekitConnection._roomConn.remoteParticipants.keys()),cn(`Connected to ROV ${this.livekitConnection._roomConn.name}!`,2e3,!1,Zt.success),setTimeout(()=>{Fi("Starting simplepeer after onConnectedActions: remote participants=",this.livekitConnection._roomConn.remoteParticipants.keys()),this.startSimplePeerConnection()},1e3)}onReconnectActions(){li("Reconnected to ROV",this.livekitConnection._roomConn.name),cn(`Reconnected to ROV ${this.livekitConnection._roomConn.name}`,2e4,!1,Zt.success),this.simplePeerConnection&&this.simplePeerConnection.restartIce()}startVideoStatsCollection(){this._videoStatsIntervalId&&clearInterval(this._videoStatsIntervalId),this._videoStatsIntervalId=setInterval(async()=>{const e=await this.livekitConnection.getVideoStats();this.livekitVideoStats.set(e);const t=await this.simplePeerConnection.getStats();this.simplePeerVideoStats.set(t)},600)}async _keepTrackOfConnectionState(){this._runCleanupFunc("livekitConnState"),this._runCleanupFunc("simplepeerConnState"),this._addCleanupFunc(dc(this.livekitConnection.connectionState,(e,t)=>{this.simplePeerConnection&&this.simplePeerConnection.connectionState.get()===Dt.connected?this.connectionState.set(Dt.connected):e===Dt.connected?this.connectionState.set(Dt.connected):this.connectionState.set(e),this.connectionState.get()===Dt.reconnecting?cn("Reconnecting...",1e5,!1,Zt.info):QR("Reconnecting..."),e===Dt.connected&&t===Dt.reconnecting&&this.onReconnectActions()}),"livekitConnState"),this._addCleanupFunc(dc(this.simplePeerConnection.connectionState,e=>{this.livekitConnection&&this.livekitConnection.connectionState.get()===Dt.connected?this.connectionState.set(Dt.connected):this.connectionState.set(e)}),"simplepeerConnState")}async initUsingCloudLivekitConnection(){this.livekitConnection.close(),this.pollForOpenLivekitRooms(kc.LIVEKIT_CLOUD_ENDPOINT),await this.livekitConnection.init({hostUrl:kc.LIVEKIT_CLOUD_ENDPOINT,publishVideo:!1,reconnectAttempts:3,roomConnectionConfig:cv,roomConfig:lv})}async initUsingLocalLivekitConnection(){this.livekitConnection.close(),this.pollForOpenLivekitRooms(kc.LIVEKIT_LOCAL_ENDPOINT),await this.livekitConnection.init({hostUrl:kc.LIVEKIT_LOCAL_ENDPOINT,publishVideo:!1,reconnectAttempts:3,roomConnectionConfig:cv,roomConfig:lv})}async connectToLivekitRoom(e,t){if(!this.livekitConnection||!this.livekitConnection.config)throw new Error("connectToLivekitRoom() called before livekitConnection was initilized");this._keepTrackOfConnectionState(),await this.livekitConnection.start(e,t),this.currentLivekitIdentity.set(this.livekitConnection.getLivekitIdentitiy()),nD(this.livekitConnection.latestRecivedDataMessage,()=>this.onConnectedActions())}async startSimplePeerConnection(){if(!this.livekitConnection||this.livekitConnection.connectionState.get()!=Dt.connected)throw new Error("startSimplePeerConnection() called when livekitConnection was not fully connected!");if(!this.simplePeerConnection)throw new Error("startSimplePeerConnection() called without initilized simplePeerConnection!");this.simplePeerConnection.start(!0)}async ingestSimplePeerSignallingMsg(e){const t=this.simplePeerConnection;if(t)t.ingestSignalingMsg(e);else throw new Error("ingestSimplePeerSignallingMsg() called when simplePeerConnection was not initilized!")}async setSimplePeerCodec(e){if(!this.simplePeerConnection)throw new Error("setSimplePeerCodec() called without simplePeerConnection in class!");this.simplePeerConnection.setCodecPreferences([e])}async sendMessageToRov(e,t=!0){if(!this.livekitConnection)throw new Error("sendMessageToRov() called before livekitConnection was initilized");const i=wn.toBinary(e),s=this.livekitConnection._rovRoomName;es.get()&&Lt("Sending Message to ",s,t?"reliably":"unreliably",":",`(${i.byteLength} bytes) LK: ${this.livekitConnection.connectionState.get()} SP: ${this.simplePeerConnection.connectionState.get()}`,e),t&&this.livekitConnection.connectionState.get()===Dt.connected?await this.livekitConnection.sendMessage(i,t,[s]):await this.livekitConnection.sendMessage(i,!1,[s])}close(){this.connectionState.set(Dt.disconnectedOk),this.livekitConnection&&this.livekitConnection.close(),this.simplePeerConnection&&this.simplePeerConnection.stop(),this._videoStatsIntervalId&&clearInterval(this._videoStatsIntervalId);for(const e in this._cleanupFuncs)this._cleanupFuncs[e]();this._cleanupFuncs={}}_addCleanupFunc(e,t){return t=t??Math.random().toString(36).substring(7),this._cleanupFuncs[t]=e,t}_runCleanupFunc(e){this._cleanupFuncs[e]&&(this._cleanupFuncs[e](),delete this._cleanupFuncs[e])}}const ln=new S4;function xb(n,e,t){const i=n.slice();i[12]=e[t],i[16]=t;const s=Ti.logToText(i[12]);return i[13]=s[0],i[14]=s[1],i}function E4(n){let e,t=n[1]?"ON":"OFF",i;return{c(){e=be("Debug Mode "),i=be(t)},l(s){e=ye(s,"Debug Mode "),i=ye(s,t)},m(s,r){D(s,e,r),D(s,i,r)},p(s,r){r&2&&t!==(t=s[1]?"ON":"OFF")&&gt(i,t)},d(s){s&&(S(e),S(i))}}}function A4(n){let e,t,i=n[12].timestamp+"",s,r,a,o=n[13]+"",l;return{c(){e=K("summary"),t=K("small"),s=be(i),r=Te(),a=K("span"),l=be(o),this.h()},l(c){e=q(c,"SUMMARY",{class:!0});var u=F(e);t=q(u,"SMALL",{});var d=F(t);s=ye(d,i),d.forEach(S),r=Se(u),a=q(u,"SPAN",{});var h=F(a);l=ye(h,o),h.forEach(S),u.forEach(S),this.h()},h(){x(e,"class","overflow-hidden text-ellipsis max-w-full pl-3"),Ct(e,"text-right",n[12].origin===Ui.ROV)},m(c,u){D(c,e,u),P(e,t),P(t,s),P(e,r),P(e,a),P(a,l)},p(c,u){u&1&&i!==(i=c[12].timestamp+"")&&gt(s,i),u&1&&o!==(o=c[13]+"")&&gt(l,o),u&1&&Ct(e,"text-right",c[12].origin===Ui.ROV)},d(c){c&&S(e)}}}function C4(n){let e,t,i,s=n[12].timestamp+"",r,a,o,l=n[13]+"",c,u,d,h=n[14]+"",f;return{c(){e=K("details"),t=K("summary"),i=K("small"),r=be(s),a=Te(),o=K("span"),c=be(l),u=Te(),d=K("pre"),f=be(h),this.h()},l(g){e=q(g,"DETAILS",{});var v=F(e);t=q(v,"SUMMARY",{class:!0});var m=F(t);i=q(m,"SMALL",{});var _=F(i);r=ye(_,s),_.forEach(S),a=Se(m),o=q(m,"SPAN",{});var y=F(o);c=ye(y,l),y.forEach(S),m.forEach(S),u=Se(v),d=q(v,"PRE",{class:!0});var b=F(d);f=ye(b,h),b.forEach(S),v.forEach(S),this.h()},h(){x(t,"class","overflow-hidden text-ellipsis max-w-full"),Ct(t,"text-right",n[12].origin===Ui.ROV),x(d,"class","overflow-auto max-h-96 max-w-full")},m(g,v){D(g,e,v),P(e,t),P(t,i),P(i,r),P(t,a),P(t,o),P(o,c),P(e,u),P(e,d),P(d,f)},p(g,v){v&1&&s!==(s=g[12].timestamp+"")&&gt(r,s),v&1&&l!==(l=g[13]+"")&&gt(c,l),v&1&&Ct(t,"text-right",g[12].origin===Ui.ROV),v&1&&h!==(h=g[14]+"")&&gt(f,h)},d(g){g&&S(e)}}}function Ib(n,e){let t,i,s;function r(l,c){return l[14]&&l[14].length>0?C4:A4}let a=r(e),o=a(e);return{key:n,first:null,c(){t=K("div"),o.c(),i=Te(),this.h()},l(l){t=q(l,"DIV",{class:!0});var c=F(t);o.l(c),i=Se(c),c.forEach(S),this.h()},h(){x(t,"class","px-2 mt-px bg-opacity-50 border-b-2 border-t-0 border-t-slate-400 border-b-white/20 -order-1"),Ct(t,"brightness-150",e[12].origin===Ui.ROV),Ct(t,"!font-mono",e[12].origin===Ui.ROV),Ct(t,"border-l-8",e[12].origin===Ui.PILOT),Ct(t,"!border-t-4",e[12].origin!==e[0][Math.max(e[16]-1,0)].origin),Ct(t,"border-r-8",e[12].origin===Ui.ROV),Ct(t,"bg-sky-700",e[12].level===Mt.Info),Ct(t,"bg-yellow-600",e[12].level===Mt.Warning),Ct(t,"bg-red-700",e[12].level===Mt.Error),Ct(t,"bg-green-700",e[12].level===Mt.Debug),Ct(t,"bg-slate-800",e[12].level===Mt.Console),Ct(t,"border-sky-600",e[12].level===Mt.Info),Ct(t,"border-yellow-500",e[12].level===Mt.Warning),Ct(t,"border-red-600",e[12].level===Mt.Error),Ct(t,"border-green-600",e[12].level===Mt.Debug),Ct(t,"border-purple-800",e[12].level===Mt.Console),this.first=t},m(l,c){D(l,t,c),o.m(t,null),P(t,i)},p(l,c){e=l,a===(a=r(e))&&o?o.p(e,c):(o.d(1),o=a(e),o&&(o.c(),o.m(t,i))),c&1&&Ct(t,"brightness-150",e[12].origin===Ui.ROV),c&1&&Ct(t,"!font-mono",e[12].origin===Ui.ROV),c&1&&Ct(t,"border-l-8",e[12].origin===Ui.PILOT),c&1&&Ct(t,"!border-t-4",e[12].origin!==e[0][Math.max(e[16]-1,0)].origin),c&1&&Ct(t,"border-r-8",e[12].origin===Ui.ROV),c&1&&Ct(t,"bg-sky-700",e[12].level===Mt.Info),c&1&&Ct(t,"bg-yellow-600",e[12].level===Mt.Warning),c&1&&Ct(t,"bg-red-700",e[12].level===Mt.Error),c&1&&Ct(t,"bg-green-700",e[12].level===Mt.Debug),c&1&&Ct(t,"bg-slate-800",e[12].level===Mt.Console),c&1&&Ct(t,"border-sky-600",e[12].level===Mt.Info),c&1&&Ct(t,"border-yellow-500",e[12].level===Mt.Warning),c&1&&Ct(t,"border-red-600",e[12].level===Mt.Error),c&1&&Ct(t,"border-green-600",e[12].level===Mt.Debug),c&1&&Ct(t,"border-purple-800",e[12].level===Mt.Console)},i(l){l&&(s||Qm(()=>{s=gy(t,cp,{}),s.start()}))},o:Tt,d(l){l&&S(t),o.d()}}}function w4(n){let e,t,i,s,r,a,o,l="Logs",c,u,d,h,f,g,v,m,_,y,b,p,w,E,C,M,I,T,R,V,H,B=[],te=new Map,j,oe,z;s=new gd({props:{class:"text-2xl pointer-events-none",tabindex:"-1",variation:"round"}}),d=new yk({props:{class:"text-2xl pointer-events-none mr-2",tabindex:"-1",variation:"round"}}),v=new KM({props:{class:"text-2xl pointer-events-none mr-2",tabindex:"-1",variation:"round"}}),b=new kk({props:{class:"text-2xl pointer-events-none mr-2",tabindex:"-1",variation:"round"}}),C=new xM({props:{class:"text-2xl pointer-events-none mr-2",tabindex:"-1",variation:"round"}});function W(ge){n[11](ge)}let ie={name:"Debug Mode",size:"lg",$$slots:{default:[E4]},$$scope:{ctx:n}};n[1]!==void 0&&(ie.checked=n[1]),T=new Po({props:ie}),Nn.push(()=>vi(T,"checked",W));let se=un(n[0]);const je=ge=>ge[16];for(let ge=0;ge<se.length;ge+=1){let L=xb(n,se,ge),J=je(L);te.set(J,B[ge]=Ib(J,L))}return{c(){e=K("div"),t=K("div"),i=K("button"),ct(s.$$.fragment),r=Te(),a=K("nav"),o=K("h3"),o.textContent=l,c=Te(),u=K("button"),ct(d.$$.fragment),h=be(`
      Sync ROV`),f=Te(),g=K("button"),ct(v.$$.fragment),m=be(`
      Download Logs`),_=Te(),y=K("button"),ct(b.$$.fragment),p=be(`
      Clear Logs`),w=Te(),E=K("button"),ct(C.$$.fragment),M=be(`
      Restart ICE`),I=Te(),ct(T.$$.fragment),V=Te(),H=K("div");for(let ge=0;ge<B.length;ge+=1)B[ge].c();this.h()},l(ge){e=q(ge,"DIV",{class:!0,role:!0,"aria-modal":!0,"aria-label":!0});var L=F(e);t=q(L,"DIV",{class:!0});var J=F(t);i=q(J,"BUTTON",{class:!0});var U=F(i);pt(s.$$.fragment,U),U.forEach(S),J.forEach(S),r=Se(L),a=q(L,"NAV",{class:!0});var de=F(a);o=q(de,"H3",{class:!0,"data-svelte-h":!0}),En(o)!=="svelte-1kg0d76"&&(o.textContent=l),c=Se(de),u=q(de,"BUTTON",{class:!0});var et=F(u);pt(d.$$.fragment,et),h=ye(et,`
      Sync ROV`),et.forEach(S),f=Se(de),g=q(de,"BUTTON",{class:!0});var Ue=F(g);pt(v.$$.fragment,Ue),m=ye(Ue,`
      Download Logs`),Ue.forEach(S),_=Se(de),y=q(de,"BUTTON",{class:!0});var dt=F(y);pt(b.$$.fragment,dt),p=ye(dt,`
      Clear Logs`),dt.forEach(S),w=Se(de),E=q(de,"BUTTON",{class:!0});var _e=F(E);pt(C.$$.fragment,_e),M=ye(_e,`
      Restart ICE`),_e.forEach(S),I=Se(de),pt(T.$$.fragment,de),de.forEach(S),V=Se(L),H=q(L,"DIV",{class:!0});var we=F(H);for(let O=0;O<B.length;O+=1)B[O].l(we);we.forEach(S),L.forEach(S),this.h()},h(){x(i,"class","btn btn-icon-lg btn-icon variant-filled-primary shadow-xl"),x(t,"class","flex flex-col justify-center align-middle right-6 top-6 fixed"),x(o,"class","h3 mr-[0.75em] text-nowrap"),x(u,"class","btn variant-filled-success"),x(g,"class","btn variant-filled-tertiary"),x(y,"class","btn bg-red-700"),x(E,"class","btn variant-soft-secondary"),x(a,"class","flex app-bar p-4 w-full z-10 overflow-auto bg-surface-900/80 overflow-y-auto space-x-2 pr-20 items-center"),x(H,"class","bg-slate-800/70 w-full flex-1 box-border flex flex-col-reverse overflow-scroll pb-20"),x(e,"class","modal flex-col justify-stretch items-start h-fit w-full rounded-xl overflow-hidden"),x(e,"role","dialog"),x(e,"aria-modal","true"),x(e,"aria-label","Log Timeline")},m(ge,L){D(ge,e,L),P(e,t),P(t,i),lt(s,i,null),P(e,r),P(e,a),P(a,o),P(a,c),P(a,u),lt(d,u,null),P(u,h),P(a,f),P(a,g),lt(v,g,null),P(g,m),P(a,_),P(a,y),lt(b,y,null),P(y,p),P(a,w),P(a,E),lt(C,E,null),P(E,M),P(a,I),lt(T,a,null),P(e,V),P(e,H);for(let J=0;J<B.length;J+=1)B[J]&&B[J].m(H,null);j=!0,oe||(z=[X(i,"click",n[6]),X(u,"click",n[7]),X(g,"click",n[8]),X(y,"click",n[9]),X(E,"click",n[10])],oe=!0)},p(ge,[L]){const J={};L&131074&&(J.$$scope={dirty:L,ctx:ge}),!R&&L&2&&(R=!0,J.checked=ge[1],_i(()=>R=!1)),T.$set(J),L&1&&(se=un(ge[0]),B=by(B,L,je,1,ge,se,te,H,vy,Ib,null,xb))},i(ge){if(!j){ce(s.$$.fragment,ge),ce(d.$$.fragment,ge),ce(v.$$.fragment,ge),ce(b.$$.fragment,ge),ce(C.$$.fragment,ge),ce(T.$$.fragment,ge);for(let L=0;L<se.length;L+=1)ce(B[L]);j=!0}},o(ge){fe(s.$$.fragment,ge),fe(d.$$.fragment,ge),fe(v.$$.fragment,ge),fe(b.$$.fragment,ge),fe(C.$$.fragment,ge),fe(T.$$.fragment,ge),j=!1},d(ge){ge&&S(e),ut(s),ut(d),ut(v),ut(b),ut(C),ut(T);for(let L=0;L<B.length;L+=1)B[L].d();oe=!1,kn(z)}}}function R4(n,e,t){let i;qn(n,es,v=>t(1,i=v));const s=Sy();let r=Ti.getLogs();const a=async()=>{await In.sendRovMessage(wn.create({body:{oneofKind:"sendRovLogs",sendRovLogs:{}}}),!0)},o=()=>{const v=Ti.getLogs(),m=new Blob([`[
`+v.map(b=>Ti.logToJson(b)).join(`,
`)+`
]`],{type:"application/json"}),_=URL.createObjectURL(m),y=document.createElement("a");y.href=_,y.download=`rov-web-pilot-logs-${new Date().toString()}.json`,y.click()},l=()=>{Ti.clearLogs(),t(0,r=Ti.getLogs())};Da(()=>{Ti.subscribe(()=>{t(0,r=Ti.getLogs())})});const c=()=>s.close(),u=()=>a(),d=()=>o(),h=()=>l(),f=()=>{var v;(v=ln.simplePeerConnection)!=null&&v._p&&ln.simplePeerConnection._p.restartIce()};function g(v){i=v,es.set(i)}return[r,i,s,a,o,l,c,u,d,h,f,g]}class k4 extends Bt{constructor(e){super(),Vt(this,e,R4,w4,Ft,{})}}function Pb(n,e,t){const i=n.slice();return i[13]=e[t],i}function M4(n){let e,t,i,s=n[13].label+"",r,a,o;var l=n[13].icon;function c(u,d){return{props:{class:"text-4xl pointer-events-none h-10 w-10 m-1",tabindex:"-1",variation:"round"}}}return l&&(e=A0(l,c())),{c(){e&&ct(e.$$.fragment),t=Te(),i=K("b"),r=be(s),a=Te(),this.h()},l(u){e&&pt(e.$$.fragment,u),t=Se(u),i=q(u,"B",{class:!0});var d=F(i);r=ye(d,s),d.forEach(S),a=Se(u),this.h()},h(){x(i,"class","text-lg text-center whitespace-break-spaces pointer-events-none leading-8")},m(u,d){e&&lt(e,u,d),D(u,t,d),D(u,i,d),P(i,r),D(u,a,d),o=!0},p(u,d){if(d&8&&l!==(l=u[13].icon)){if(e){_n();const h=e;fe(h.$$.fragment,1,0,()=>{ut(h,1)}),vn()}l?(e=A0(l,c()),ct(e.$$.fragment),ce(e.$$.fragment,1),lt(e,t.parentNode,t)):e=null}(!o||d&8)&&s!==(s=u[13].label+"")&&gt(r,s)},i(u){o||(e&&ce(e.$$.fragment,u),o=!0)},o(u){e&&fe(e.$$.fragment,u),o=!1},d(u){u&&(S(t),S(i),S(a)),e&&ut(e,u)}}}function Nb(n){let e,t,i;function s(o){n[8](o)}function r(){return n[9](n[13])}let a={title:n[13].label,label:n[13].label,regionLabel:"flex-none",rounded:`rounded-2xl w-32 h-32  flex flex-col items-center justify-center btn select-none bg${n[4]}-800/70`,hover:`hover:variant-outline${n[4]} `,active:"variant-filled focus:brightness-125",name:"justify",value:n[13].value,disabled:n[1],$$slots:{default:[M4]},$$scope:{ctx:n}};return n[0]!==void 0&&(a.group=n[0]),e=new eg({props:a}),Nn.push(()=>vi(e,"group",s)),e.$on("change",r),{c(){ct(e.$$.fragment)},l(o){pt(e.$$.fragment,o)},m(o,l){lt(e,o,l),i=!0},p(o,l){n=o;const c={};l&8&&(c.title=n[13].label),l&8&&(c.label=n[13].label),l&16&&(c.rounded=`rounded-2xl w-32 h-32  flex flex-col items-center justify-center btn select-none bg${n[4]}-800/70`),l&16&&(c.hover=`hover:variant-outline${n[4]} `),l&8&&(c.value=n[13].value),l&2&&(c.disabled=n[1]),l&65544&&(c.$$scope={dirty:l,ctx:n}),!t&&l&1&&(t=!0,c.group=n[0],_i(()=>t=!1)),e.$set(c)},i(o){i||(ce(e.$$.fragment,o),i=!0)},o(o){fe(e.$$.fragment,o),i=!1},d(o){ut(e,o)}}}function x4(n){let e,t,i=un(n[3]),s=[];for(let a=0;a<i.length;a+=1)s[a]=Nb(Pb(n,i,a));const r=a=>fe(s[a],1,1,()=>{s[a]=null});return{c(){for(let a=0;a<s.length;a+=1)s[a].c();e=dn()},l(a){for(let o=0;o<s.length;o+=1)s[o].l(a);e=dn()},m(a,o){for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(a,o);D(a,e,o),t=!0},p(a,o){if(o&63){i=un(a[3]);let l;for(l=0;l<i.length;l+=1){const c=Pb(a,i,l);s[l]?(s[l].p(c,o),ce(s[l],1)):(s[l]=Nb(c),s[l].c(),ce(s[l],1),s[l].m(e.parentNode,e))}for(_n(),l=i.length;l<s.length;l+=1)r(l);vn()}},i(a){if(!t){for(let o=0;o<i.length;o+=1)ce(s[o]);t=!0}},o(a){s=s.filter(Boolean);for(let o=0;o<s.length;o+=1)fe(s[o]);t=!1},d(a){a&&S(e),zi(s,a)}}}function I4(n){let e,t,i={display:"flex p-2 gap-2 max-w-full flex-wrap justify-center items-center variant-glass-error",background:n[4]?"":null,border:n[4]?`border-token border${n[4]}-400-500-token`:null,rounded:"rounded-3xl "+(n[4]?"!border"+n[4]+"-500 ":" ")+n[7].class,$$slots:{default:[x4]},$$scope:{ctx:n}};return e=new lp({props:i}),n[10](e),{c(){ct(e.$$.fragment)},l(s){pt(e.$$.fragment,s)},m(s,r){lt(e,s,r),t=!0},p(s,[r]){const a={};r&16&&(a.background=s[4]?"":null),r&16&&(a.border=s[4]?`border-token border${s[4]}-400-500-token`:null),r&144&&(a.rounded="rounded-3xl "+(s[4]?"!border"+s[4]+"-500 ":" ")+s[7].class),r&65599&&(a.$$scope={dirty:r,ctx:s}),e.$set(a)},i(s){t||(ce(e.$$.fragment,s),t=!0)},o(s){fe(e.$$.fragment,s),t=!1},d(s){n[10](null),ut(e,s)}}}function P4(n,e,t){let{disabled:i=!1}=e,{autoReset:s=!1}=e,{value:r=""}=e,{options:a=[]}=e,{variant:o=""}=e,{onChange:l=()=>{}}=e,c=null;const u=()=>{if(r&&c&&c.$$.root){const v=c.$$.root.querySelectorAll("[tabindex]");for(const m of v)m.getAttribute("value")===r?(m.focus(),m.setAttribute("data-focusindex","0")):m.removeAttribute("data-focusindex")}};let d=new Map;a.forEach(({value:v,label:m,icon:_,action:y})=>{d.set(v,{label:m,icon:_,action:y})}),Da(()=>{u()});function h(v){r=v,t(0,r)}const f=v=>{v.action&&v.action(),l(v.value),s&&t(0,r="")};function g(v){Nn[v?"unshift":"push"](()=>{c=v,t(6,c)})}return n.$$set=v=>{t(7,e=$e($e({},e),Wt(v))),"disabled"in v&&t(1,i=v.disabled),"autoReset"in v&&t(2,s=v.autoReset),"value"in v&&t(0,r=v.value),"options"in v&&t(3,a=v.options),"variant"in v&&t(4,o=v.variant),"onChange"in v&&t(5,l=v.onChange)},n.$$.update=()=>{n.$$.dirty&1&&r&&u()},e=Wt(e),[r,i,s,a,o,l,c,e,h,f,g]}class eA extends Bt{constructor(e){super(),Vt(this,e,P4,I4,Ft,{disabled:1,autoReset:2,value:0,options:3,variant:4,onChange:5})}}const N4=""+new URL("../assets/environment.n5A804WF.jpg",import.meta.url).href,D4=""+new URL("../assets/Tiny_ROV_Color._9m2DtMm.glb",import.meta.url).href;/**
* @license
* Copyright 2010-2024 Three.js Authors
* SPDX-License-Identifier: MIT
*/const Kg="169",L4=0,Db=1,O4=2,qg=1,U4=2,Zs=3,mr=0,Pi=1,Is=2,qr=0,ko=1,Lb=2,Ob=3,Ub=4,F4=5,ba=100,B4=101,V4=102,G4=103,z4=104,H4=200,W4=201,j4=202,K4=203,om=204,cm=205,q4=206,X4=207,Y4=208,J4=209,Q4=210,Z4=211,$4=212,eU=213,tU=214,lm=0,um=1,dm=2,Bo=3,hm=4,fm=5,pm=6,mm=7,tA=0,nU=1,iU=2,Xr=0,sU=1,rU=2,aU=3,oU=4,cU=5,lU=6,uU=7,Fb="attached",dU="detached",nA=300,Vo=301,Go=302,sd=303,gm=304,Ld=306,zo=1e3,zr=1001,rd=1002,Ai=1003,iA=1004,xc=1005,Gi=1006,Iu=1007,lr=1008,gr=1009,sA=1010,rA=1011,tl=1012,Xg=1013,Pa=1014,vs=1015,dl=1016,Yg=1017,Jg=1018,Ho=1020,aA=35902,oA=1021,cA=1022,$i=1023,lA=1024,uA=1025,Mo=1026,Wo=1027,Qg=1028,Zg=1029,dA=1030,$g=1031,e0=1033,Pu=33776,Nu=33777,Du=33778,Lu=33779,_m=35840,vm=35841,bm=35842,ym=35843,Tm=36196,Sm=37492,Em=37496,Am=37808,Cm=37809,wm=37810,Rm=37811,km=37812,Mm=37813,xm=37814,Im=37815,Pm=37816,Nm=37817,Dm=37818,Lm=37819,Om=37820,Um=37821,Ou=36492,Fm=36494,Bm=36495,hA=36283,Vm=36284,Gm=36285,zm=36286,nl=2300,il=2301,bf=2302,Bb=2400,Vb=2401,Gb=2402,hU=2500,fU=0,fA=1,Hm=2,pU=3200,mU=3201,pA=0,gU=1,Vr="",Si="srgb",di="srgb-linear",t0="display-p3",Od="display-p3-linear",ad="linear",Rn="srgb",od="rec709",cd="p3",Ya=7680,zb=519,_U=512,vU=513,bU=514,mA=515,yU=516,TU=517,SU=518,EU=519,Wm=35044,Hb="300 es",ur=2e3,ld=2001;class Zo{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const r=s.indexOf(t);r!==-1&&s.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let r=0,a=s.length;r<a;r++)s[r].call(this,e);e.target=null}}}const hi=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Wb=1234567;const Bc=Math.PI/180,jo=180/Math.PI;function bs(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(hi[n&255]+hi[n>>8&255]+hi[n>>16&255]+hi[n>>24&255]+"-"+hi[e&255]+hi[e>>8&255]+"-"+hi[e>>16&15|64]+hi[e>>24&255]+"-"+hi[t&63|128]+hi[t>>8&255]+"-"+hi[t>>16&255]+hi[t>>24&255]+hi[i&255]+hi[i>>8&255]+hi[i>>16&255]+hi[i>>24&255]).toLowerCase()}function mi(n,e,t){return Math.max(e,Math.min(t,n))}function n0(n,e){return(n%e+e)%e}function AU(n,e,t,i,s){return i+(n-e)*(s-i)/(t-e)}function CU(n,e,t){return n!==e?(t-n)/(e-n):0}function Vc(n,e,t){return(1-t)*n+t*e}function wU(n,e,t,i){return Vc(n,e,1-Math.exp(-t*i))}function RU(n,e=1){return e-Math.abs(n0(n,e*2)-e)}function kU(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function MU(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function xU(n,e){return n+Math.floor(Math.random()*(e-n+1))}function IU(n,e){return n+Math.random()*(e-n)}function PU(n){return n*(.5-Math.random())}function NU(n){n!==void 0&&(Wb=n);let e=Wb+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function DU(n){return n*Bc}function LU(n){return n*jo}function OU(n){return(n&n-1)===0&&n!==0}function UU(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function FU(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function BU(n,e,t,i,s){const r=Math.cos,a=Math.sin,o=r(t/2),l=a(t/2),c=r((e+i)/2),u=a((e+i)/2),d=r((e-i)/2),h=a((e-i)/2),f=r((i-e)/2),g=a((i-e)/2);switch(s){case"XYX":n.set(o*u,l*d,l*h,o*c);break;case"YZY":n.set(l*h,o*u,l*d,o*c);break;case"ZXZ":n.set(l*d,l*h,o*u,o*c);break;case"XZX":n.set(o*u,l*g,l*f,o*c);break;case"YXY":n.set(l*f,o*u,l*g,o*c);break;case"ZYZ":n.set(l*g,l*f,o*u,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function gs(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function pn(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const VU={DEG2RAD:Bc,RAD2DEG:jo,generateUUID:bs,clamp:mi,euclideanModulo:n0,mapLinear:AU,inverseLerp:CU,lerp:Vc,damp:wU,pingpong:RU,smoothstep:kU,smootherstep:MU,randInt:xU,randFloat:IU,randFloatSpread:PU,seededRandom:NU,degToRad:DU,radToDeg:LU,isPowerOfTwo:OU,ceilPowerOfTwo:UU,floorPowerOfTwo:FU,setQuaternionFromProperEuler:BU,normalize:pn,denormalize:gs};class Xt{constructor(e=0,t=0){Xt.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6],this.y=s[1]*t+s[4]*i+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(mi(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),s=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*i-a*s+e.x,this.y=r*s+a*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Pt{constructor(e,t,i,s,r,a,o,l,c){Pt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,s,r,a,o,l,c)}set(e,t,i,s,r,a,o,l,c){const u=this.elements;return u[0]=e,u[1]=s,u[2]=o,u[3]=t,u[4]=r,u[5]=l,u[6]=i,u[7]=a,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,r=this.elements,a=i[0],o=i[3],l=i[6],c=i[1],u=i[4],d=i[7],h=i[2],f=i[5],g=i[8],v=s[0],m=s[3],_=s[6],y=s[1],b=s[4],p=s[7],w=s[2],E=s[5],C=s[8];return r[0]=a*v+o*y+l*w,r[3]=a*m+o*b+l*E,r[6]=a*_+o*p+l*C,r[1]=c*v+u*y+d*w,r[4]=c*m+u*b+d*E,r[7]=c*_+u*p+d*C,r[2]=h*v+f*y+g*w,r[5]=h*m+f*b+g*E,r[8]=h*_+f*p+g*C,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8];return t*a*u-t*o*c-i*r*u+i*o*l+s*r*c-s*a*l}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8],d=u*a-o*c,h=o*l-u*r,f=c*r-a*l,g=t*d+i*h+s*f;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/g;return e[0]=d*v,e[1]=(s*c-u*i)*v,e[2]=(o*i-s*a)*v,e[3]=h*v,e[4]=(u*t-s*l)*v,e[5]=(s*r-o*t)*v,e[6]=f*v,e[7]=(i*l-c*t)*v,e[8]=(a*t-i*r)*v,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,s,r,a,o){const l=Math.cos(r),c=Math.sin(r);return this.set(i*l,i*c,-i*(l*a+c*o)+a+e,-s*c,s*l,-s*(-c*a+l*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(yf.makeScale(e,t)),this}rotate(e){return this.premultiply(yf.makeRotation(-e)),this}translate(e,t){return this.premultiply(yf.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<9;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const yf=new Pt;function gA(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function sl(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function GU(){const n=sl("canvas");return n.style.display="block",n}const jb={};function Uu(n){n in jb||(jb[n]=!0,console.warn(n))}function zU(n,e,t){return new Promise(function(i,s){function r(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:s();break;case n.TIMEOUT_EXPIRED:setTimeout(r,t);break;default:i()}}setTimeout(r,t)})}function HU(n){const e=n.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function WU(n){const e=n.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const Kb=new Pt().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),qb=new Pt().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),pc={[di]:{transfer:ad,primaries:od,luminanceCoefficients:[.2126,.7152,.0722],toReference:n=>n,fromReference:n=>n},[Si]:{transfer:Rn,primaries:od,luminanceCoefficients:[.2126,.7152,.0722],toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[Od]:{transfer:ad,primaries:cd,luminanceCoefficients:[.2289,.6917,.0793],toReference:n=>n.applyMatrix3(qb),fromReference:n=>n.applyMatrix3(Kb)},[t0]:{transfer:Rn,primaries:cd,luminanceCoefficients:[.2289,.6917,.0793],toReference:n=>n.convertSRGBToLinear().applyMatrix3(qb),fromReference:n=>n.applyMatrix3(Kb).convertLinearToSRGB()}},jU=new Set([di,Od]),en={enabled:!0,_workingColorSpace:di,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!jU.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,e,t){if(this.enabled===!1||e===t||!e||!t)return n;const i=pc[e].toReference,s=pc[t].fromReference;return s(i(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this._workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this._workingColorSpace)},getPrimaries:function(n){return pc[n].primaries},getTransfer:function(n){return n===Vr?ad:pc[n].transfer},getLuminanceCoefficients:function(n,e=this._workingColorSpace){return n.fromArray(pc[e].luminanceCoefficients)}};function xo(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function Tf(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let Ja;class KU{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Ja===void 0&&(Ja=sl("canvas")),Ja.width=e.width,Ja.height=e.height;const i=Ja.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Ja}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=sl("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const s=i.getImageData(0,0,e.width,e.height),r=s.data;for(let a=0;a<r.length;a++)r[a]=xo(r[a]/255)*255;return i.putImageData(s,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(xo(t[i]/255)*255):t[i]=xo(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let qU=0;class _A{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:qU++}),this.uuid=bs(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(s!==null){let r;if(Array.isArray(s)){r=[];for(let a=0,o=s.length;a<o;a++)s[a].isDataTexture?r.push(Sf(s[a].image)):r.push(Sf(s[a]))}else r=Sf(s);i.url=r}return t||(e.images[this.uuid]=i),i}}function Sf(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?KU.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let XU=0;class ni extends Zo{constructor(e=ni.DEFAULT_IMAGE,t=ni.DEFAULT_MAPPING,i=zr,s=zr,r=Gi,a=lr,o=$i,l=gr,c=ni.DEFAULT_ANISOTROPY,u=Vr){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:XU++}),this.uuid=bs(),this.name="",this.source=new _A(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=s,this.magFilter=r,this.minFilter=a,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=l,this.offset=new Xt(0,0),this.repeat=new Xt(1,1),this.center=new Xt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Pt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==nA)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case zo:e.x=e.x-Math.floor(e.x);break;case zr:e.x=e.x<0?0:1;break;case rd:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case zo:e.y=e.y-Math.floor(e.y);break;case zr:e.y=e.y<0?0:1;break;case rd:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}ni.DEFAULT_IMAGE=null;ni.DEFAULT_MAPPING=nA;ni.DEFAULT_ANISOTROPY=1;class rn{constructor(e=0,t=0,i=0,s=1){rn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,s){return this.x=e,this.y=t,this.z=i,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*i+a[8]*s+a[12]*r,this.y=a[1]*t+a[5]*i+a[9]*s+a[13]*r,this.z=a[2]*t+a[6]*i+a[10]*s+a[14]*r,this.w=a[3]*t+a[7]*i+a[11]*s+a[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,s,r;const l=e.elements,c=l[0],u=l[4],d=l[8],h=l[1],f=l[5],g=l[9],v=l[2],m=l[6],_=l[10];if(Math.abs(u-h)<.01&&Math.abs(d-v)<.01&&Math.abs(g-m)<.01){if(Math.abs(u+h)<.1&&Math.abs(d+v)<.1&&Math.abs(g+m)<.1&&Math.abs(c+f+_-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const b=(c+1)/2,p=(f+1)/2,w=(_+1)/2,E=(u+h)/4,C=(d+v)/4,M=(g+m)/4;return b>p&&b>w?b<.01?(i=0,s=.707106781,r=.707106781):(i=Math.sqrt(b),s=E/i,r=C/i):p>w?p<.01?(i=.707106781,s=0,r=.707106781):(s=Math.sqrt(p),i=E/s,r=M/s):w<.01?(i=.707106781,s=.707106781,r=0):(r=Math.sqrt(w),i=C/r,s=M/r),this.set(i,s,r,t),this}let y=Math.sqrt((m-g)*(m-g)+(d-v)*(d-v)+(h-u)*(h-u));return Math.abs(y)<.001&&(y=1),this.x=(m-g)/y,this.y=(d-v)/y,this.z=(h-u)/y,this.w=Math.acos((c+f+_-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class YU extends Zo{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new rn(0,0,e,t),this.scissorTest=!1,this.viewport=new rn(0,0,e,t);const s={width:e,height:t,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Gi,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const r=new ni(s,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);r.flipY=!1,r.generateMipmaps=i.generateMipmaps,r.internalFormat=i.internalFormat,this.textures=[];const a=i.count;for(let o=0;o<a;o++)this.textures[o]=r.clone(),this.textures[o].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let s=0,r=this.textures.length;s<r;s++)this.textures[s].image.width=e,this.textures[s].image.height=t,this.textures[s].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,s=e.textures.length;i<s;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new _A(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Na extends YU{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class vA extends ni{constructor(e=null,t=1,i=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:s},this.magFilter=Ai,this.minFilter=Ai,this.wrapR=zr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class JU extends ni{constructor(e=null,t=1,i=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:s},this.magFilter=Ai,this.minFilter=Ai,this.wrapR=zr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class na{constructor(e=0,t=0,i=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=s}static slerpFlat(e,t,i,s,r,a,o){let l=i[s+0],c=i[s+1],u=i[s+2],d=i[s+3];const h=r[a+0],f=r[a+1],g=r[a+2],v=r[a+3];if(o===0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d;return}if(o===1){e[t+0]=h,e[t+1]=f,e[t+2]=g,e[t+3]=v;return}if(d!==v||l!==h||c!==f||u!==g){let m=1-o;const _=l*h+c*f+u*g+d*v,y=_>=0?1:-1,b=1-_*_;if(b>Number.EPSILON){const w=Math.sqrt(b),E=Math.atan2(w,_*y);m=Math.sin(m*E)/w,o=Math.sin(o*E)/w}const p=o*y;if(l=l*m+h*p,c=c*m+f*p,u=u*m+g*p,d=d*m+v*p,m===1-o){const w=1/Math.sqrt(l*l+c*c+u*u+d*d);l*=w,c*=w,u*=w,d*=w}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d}static multiplyQuaternionsFlat(e,t,i,s,r,a){const o=i[s],l=i[s+1],c=i[s+2],u=i[s+3],d=r[a],h=r[a+1],f=r[a+2],g=r[a+3];return e[t]=o*g+u*d+l*f-c*h,e[t+1]=l*g+u*h+c*d-o*f,e[t+2]=c*g+u*f+o*h-l*d,e[t+3]=u*g-o*d-l*h-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,s){return this._x=e,this._y=t,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,s=e._y,r=e._z,a=e._order,o=Math.cos,l=Math.sin,c=o(i/2),u=o(s/2),d=o(r/2),h=l(i/2),f=l(s/2),g=l(r/2);switch(a){case"XYZ":this._x=h*u*d+c*f*g,this._y=c*f*d-h*u*g,this._z=c*u*g+h*f*d,this._w=c*u*d-h*f*g;break;case"YXZ":this._x=h*u*d+c*f*g,this._y=c*f*d-h*u*g,this._z=c*u*g-h*f*d,this._w=c*u*d+h*f*g;break;case"ZXY":this._x=h*u*d-c*f*g,this._y=c*f*d+h*u*g,this._z=c*u*g+h*f*d,this._w=c*u*d-h*f*g;break;case"ZYX":this._x=h*u*d-c*f*g,this._y=c*f*d+h*u*g,this._z=c*u*g-h*f*d,this._w=c*u*d+h*f*g;break;case"YZX":this._x=h*u*d+c*f*g,this._y=c*f*d+h*u*g,this._z=c*u*g-h*f*d,this._w=c*u*d-h*f*g;break;case"XZY":this._x=h*u*d-c*f*g,this._y=c*f*d-h*u*g,this._z=c*u*g+h*f*d,this._w=c*u*d+h*f*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,s=Math.sin(i);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],s=t[4],r=t[8],a=t[1],o=t[5],l=t[9],c=t[2],u=t[6],d=t[10],h=i+o+d;if(h>0){const f=.5/Math.sqrt(h+1);this._w=.25/f,this._x=(u-l)*f,this._y=(r-c)*f,this._z=(a-s)*f}else if(i>o&&i>d){const f=2*Math.sqrt(1+i-o-d);this._w=(u-l)/f,this._x=.25*f,this._y=(s+a)/f,this._z=(r+c)/f}else if(o>d){const f=2*Math.sqrt(1+o-i-d);this._w=(r-c)/f,this._x=(s+a)/f,this._y=.25*f,this._z=(l+u)/f}else{const f=2*Math.sqrt(1+d-i-o);this._w=(a-s)/f,this._x=(r+c)/f,this._y=(l+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(mi(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const s=Math.min(1,t/i);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,s=e._y,r=e._z,a=e._w,o=t._x,l=t._y,c=t._z,u=t._w;return this._x=i*u+a*o+s*c-r*l,this._y=s*u+a*l+r*o-i*c,this._z=r*u+a*c+i*l-s*o,this._w=a*u-i*o-s*l-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,s=this._y,r=this._z,a=this._w;let o=a*e._w+i*e._x+s*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=i,this._y=s,this._z=r,this;const l=1-o*o;if(l<=Number.EPSILON){const f=1-t;return this._w=f*a+t*this._w,this._x=f*i+t*this._x,this._y=f*s+t*this._y,this._z=f*r+t*this._z,this.normalize(),this}const c=Math.sqrt(l),u=Math.atan2(c,o),d=Math.sin((1-t)*u)/c,h=Math.sin(t*u)/c;return this._w=a*d+this._w*h,this._x=i*d+this._x*h,this._y=s*d+this._y*h,this._z=r*d+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),s=Math.sqrt(1-i),r=Math.sqrt(i);return this.set(s*Math.sin(e),s*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Z{constructor(e=0,t=0,i=0){Z.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Xb.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Xb.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*s,this.y=r[1]*t+r[4]*i+r[7]*s,this.z=r[2]*t+r[5]*i+r[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,r=e.elements,a=1/(r[3]*t+r[7]*i+r[11]*s+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*s+r[12])*a,this.y=(r[1]*t+r[5]*i+r[9]*s+r[13])*a,this.z=(r[2]*t+r[6]*i+r[10]*s+r[14])*a,this}applyQuaternion(e){const t=this.x,i=this.y,s=this.z,r=e.x,a=e.y,o=e.z,l=e.w,c=2*(a*s-o*i),u=2*(o*t-r*s),d=2*(r*i-a*t);return this.x=t+l*c+a*d-o*u,this.y=i+l*u+o*c-r*d,this.z=s+l*d+r*u-a*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*s,this.y=r[1]*t+r[5]*i+r[9]*s,this.z=r[2]*t+r[6]*i+r[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,s=e.y,r=e.z,a=t.x,o=t.y,l=t.z;return this.x=s*l-r*o,this.y=r*a-i*l,this.z=i*o-s*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return Ef.copy(this).projectOnVector(e),this.sub(Ef)}reflect(e){return this.sub(Ef.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(mi(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return t*t+i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const s=Math.sin(t)*e;return this.x=s*Math.sin(i),this.y=Math.cos(t)*e,this.z=s*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Ef=new Z,Xb=new na;class vr{constructor(e=new Z(1/0,1/0,1/0),t=new Z(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(ss.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(ss.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=ss.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const r=i.getAttribute("position");if(t===!0&&r!==void 0&&e.isInstancedMesh!==!0)for(let a=0,o=r.count;a<o;a++)e.isMesh===!0?e.getVertexPosition(a,ss):ss.fromBufferAttribute(r,a),ss.applyMatrix4(e.matrixWorld),this.expandByPoint(ss);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Ml.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),Ml.copy(i.boundingBox)),Ml.applyMatrix4(e.matrixWorld),this.union(Ml)}const s=e.children;for(let r=0,a=s.length;r<a;r++)this.expandByObject(s[r],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,ss),ss.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(mc),xl.subVectors(this.max,mc),Qa.subVectors(e.a,mc),Za.subVectors(e.b,mc),$a.subVectors(e.c,mc),Ar.subVectors(Za,Qa),Cr.subVectors($a,Za),oa.subVectors(Qa,$a);let t=[0,-Ar.z,Ar.y,0,-Cr.z,Cr.y,0,-oa.z,oa.y,Ar.z,0,-Ar.x,Cr.z,0,-Cr.x,oa.z,0,-oa.x,-Ar.y,Ar.x,0,-Cr.y,Cr.x,0,-oa.y,oa.x,0];return!Af(t,Qa,Za,$a,xl)||(t=[1,0,0,0,1,0,0,0,1],!Af(t,Qa,Za,$a,xl))?!1:(Il.crossVectors(Ar,Cr),t=[Il.x,Il.y,Il.z],Af(t,Qa,Za,$a,xl))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,ss).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(ss).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Ws[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ws[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ws[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ws[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ws[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ws[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ws[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ws[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ws),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Ws=[new Z,new Z,new Z,new Z,new Z,new Z,new Z,new Z],ss=new Z,Ml=new vr,Qa=new Z,Za=new Z,$a=new Z,Ar=new Z,Cr=new Z,oa=new Z,mc=new Z,xl=new Z,Il=new Z,ca=new Z;function Af(n,e,t,i,s){for(let r=0,a=n.length-3;r<=a;r+=3){ca.fromArray(n,r);const o=s.x*Math.abs(ca.x)+s.y*Math.abs(ca.y)+s.z*Math.abs(ca.z),l=e.dot(ca),c=t.dot(ca),u=i.dot(ca);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>o)return!1}return!0}const QU=new vr,gc=new Z,Cf=new Z;class Bs{constructor(e=new Z,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):QU.setFromPoints(e).getCenter(i);let s=0;for(let r=0,a=e.length;r<a;r++)s=Math.max(s,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;gc.subVectors(e,this.center);const t=gc.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),s=(i-this.radius)*.5;this.center.addScaledVector(gc,s/i),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Cf.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(gc.copy(e.center).add(Cf)),this.expandByPoint(gc.copy(e.center).sub(Cf))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const js=new Z,wf=new Z,Pl=new Z,wr=new Z,Rf=new Z,Nl=new Z,kf=new Z;class Ud{constructor(e=new Z,t=new Z(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,js)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=js.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(js.copy(this.origin).addScaledVector(this.direction,t),js.distanceToSquared(e))}distanceSqToSegment(e,t,i,s){wf.copy(e).add(t).multiplyScalar(.5),Pl.copy(t).sub(e).normalize(),wr.copy(this.origin).sub(wf);const r=e.distanceTo(t)*.5,a=-this.direction.dot(Pl),o=wr.dot(this.direction),l=-wr.dot(Pl),c=wr.lengthSq(),u=Math.abs(1-a*a);let d,h,f,g;if(u>0)if(d=a*l-o,h=a*o-l,g=r*u,d>=0)if(h>=-g)if(h<=g){const v=1/u;d*=v,h*=v,f=d*(d+a*h+2*o)+h*(a*d+h+2*l)+c}else h=r,d=Math.max(0,-(a*h+o)),f=-d*d+h*(h+2*l)+c;else h=-r,d=Math.max(0,-(a*h+o)),f=-d*d+h*(h+2*l)+c;else h<=-g?(d=Math.max(0,-(-a*r+o)),h=d>0?-r:Math.min(Math.max(-r,-l),r),f=-d*d+h*(h+2*l)+c):h<=g?(d=0,h=Math.min(Math.max(-r,-l),r),f=h*(h+2*l)+c):(d=Math.max(0,-(a*r+o)),h=d>0?r:Math.min(Math.max(-r,-l),r),f=-d*d+h*(h+2*l)+c);else h=a>0?-r:r,d=Math.max(0,-(a*h+o)),f=-d*d+h*(h+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,d),s&&s.copy(wf).addScaledVector(Pl,h),f}intersectSphere(e,t){js.subVectors(e.center,this.origin);const i=js.dot(this.direction),s=js.dot(js)-i*i,r=e.radius*e.radius;if(s>r)return null;const a=Math.sqrt(r-s),o=i-a,l=i+a;return l<0?null:o<0?this.at(l,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,s,r,a,o,l;const c=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,h=this.origin;return c>=0?(i=(e.min.x-h.x)*c,s=(e.max.x-h.x)*c):(i=(e.max.x-h.x)*c,s=(e.min.x-h.x)*c),u>=0?(r=(e.min.y-h.y)*u,a=(e.max.y-h.y)*u):(r=(e.max.y-h.y)*u,a=(e.min.y-h.y)*u),i>a||r>s||((r>i||isNaN(i))&&(i=r),(a<s||isNaN(s))&&(s=a),d>=0?(o=(e.min.z-h.z)*d,l=(e.max.z-h.z)*d):(o=(e.max.z-h.z)*d,l=(e.min.z-h.z)*d),i>l||o>s)||((o>i||i!==i)&&(i=o),(l<s||s!==s)&&(s=l),s<0)?null:this.at(i>=0?i:s,t)}intersectsBox(e){return this.intersectBox(e,js)!==null}intersectTriangle(e,t,i,s,r){Rf.subVectors(t,e),Nl.subVectors(i,e),kf.crossVectors(Rf,Nl);let a=this.direction.dot(kf),o;if(a>0){if(s)return null;o=1}else if(a<0)o=-1,a=-a;else return null;wr.subVectors(this.origin,e);const l=o*this.direction.dot(Nl.crossVectors(wr,Nl));if(l<0)return null;const c=o*this.direction.dot(Rf.cross(wr));if(c<0||l+c>a)return null;const u=-o*wr.dot(kf);return u<0?null:this.at(u/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class xt{constructor(e,t,i,s,r,a,o,l,c,u,d,h,f,g,v,m){xt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,s,r,a,o,l,c,u,d,h,f,g,v,m)}set(e,t,i,s,r,a,o,l,c,u,d,h,f,g,v,m){const _=this.elements;return _[0]=e,_[4]=t,_[8]=i,_[12]=s,_[1]=r,_[5]=a,_[9]=o,_[13]=l,_[2]=c,_[6]=u,_[10]=d,_[14]=h,_[3]=f,_[7]=g,_[11]=v,_[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new xt().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,s=1/eo.setFromMatrixColumn(e,0).length(),r=1/eo.setFromMatrixColumn(e,1).length(),a=1/eo.setFromMatrixColumn(e,2).length();return t[0]=i[0]*s,t[1]=i[1]*s,t[2]=i[2]*s,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*a,t[9]=i[9]*a,t[10]=i[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,s=e.y,r=e.z,a=Math.cos(i),o=Math.sin(i),l=Math.cos(s),c=Math.sin(s),u=Math.cos(r),d=Math.sin(r);if(e.order==="XYZ"){const h=a*u,f=a*d,g=o*u,v=o*d;t[0]=l*u,t[4]=-l*d,t[8]=c,t[1]=f+g*c,t[5]=h-v*c,t[9]=-o*l,t[2]=v-h*c,t[6]=g+f*c,t[10]=a*l}else if(e.order==="YXZ"){const h=l*u,f=l*d,g=c*u,v=c*d;t[0]=h+v*o,t[4]=g*o-f,t[8]=a*c,t[1]=a*d,t[5]=a*u,t[9]=-o,t[2]=f*o-g,t[6]=v+h*o,t[10]=a*l}else if(e.order==="ZXY"){const h=l*u,f=l*d,g=c*u,v=c*d;t[0]=h-v*o,t[4]=-a*d,t[8]=g+f*o,t[1]=f+g*o,t[5]=a*u,t[9]=v-h*o,t[2]=-a*c,t[6]=o,t[10]=a*l}else if(e.order==="ZYX"){const h=a*u,f=a*d,g=o*u,v=o*d;t[0]=l*u,t[4]=g*c-f,t[8]=h*c+v,t[1]=l*d,t[5]=v*c+h,t[9]=f*c-g,t[2]=-c,t[6]=o*l,t[10]=a*l}else if(e.order==="YZX"){const h=a*l,f=a*c,g=o*l,v=o*c;t[0]=l*u,t[4]=v-h*d,t[8]=g*d+f,t[1]=d,t[5]=a*u,t[9]=-o*u,t[2]=-c*u,t[6]=f*d+g,t[10]=h-v*d}else if(e.order==="XZY"){const h=a*l,f=a*c,g=o*l,v=o*c;t[0]=l*u,t[4]=-d,t[8]=c*u,t[1]=h*d+v,t[5]=a*u,t[9]=f*d-g,t[2]=g*d-f,t[6]=o*u,t[10]=v*d+h}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(ZU,e,$U)}lookAt(e,t,i){const s=this.elements;return Li.subVectors(e,t),Li.lengthSq()===0&&(Li.z=1),Li.normalize(),Rr.crossVectors(i,Li),Rr.lengthSq()===0&&(Math.abs(i.z)===1?Li.x+=1e-4:Li.z+=1e-4,Li.normalize(),Rr.crossVectors(i,Li)),Rr.normalize(),Dl.crossVectors(Li,Rr),s[0]=Rr.x,s[4]=Dl.x,s[8]=Li.x,s[1]=Rr.y,s[5]=Dl.y,s[9]=Li.y,s[2]=Rr.z,s[6]=Dl.z,s[10]=Li.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,r=this.elements,a=i[0],o=i[4],l=i[8],c=i[12],u=i[1],d=i[5],h=i[9],f=i[13],g=i[2],v=i[6],m=i[10],_=i[14],y=i[3],b=i[7],p=i[11],w=i[15],E=s[0],C=s[4],M=s[8],I=s[12],T=s[1],R=s[5],V=s[9],H=s[13],B=s[2],te=s[6],j=s[10],oe=s[14],z=s[3],W=s[7],ie=s[11],se=s[15];return r[0]=a*E+o*T+l*B+c*z,r[4]=a*C+o*R+l*te+c*W,r[8]=a*M+o*V+l*j+c*ie,r[12]=a*I+o*H+l*oe+c*se,r[1]=u*E+d*T+h*B+f*z,r[5]=u*C+d*R+h*te+f*W,r[9]=u*M+d*V+h*j+f*ie,r[13]=u*I+d*H+h*oe+f*se,r[2]=g*E+v*T+m*B+_*z,r[6]=g*C+v*R+m*te+_*W,r[10]=g*M+v*V+m*j+_*ie,r[14]=g*I+v*H+m*oe+_*se,r[3]=y*E+b*T+p*B+w*z,r[7]=y*C+b*R+p*te+w*W,r[11]=y*M+b*V+p*j+w*ie,r[15]=y*I+b*H+p*oe+w*se,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],s=e[8],r=e[12],a=e[1],o=e[5],l=e[9],c=e[13],u=e[2],d=e[6],h=e[10],f=e[14],g=e[3],v=e[7],m=e[11],_=e[15];return g*(+r*l*d-s*c*d-r*o*h+i*c*h+s*o*f-i*l*f)+v*(+t*l*f-t*c*h+r*a*h-s*a*f+s*c*u-r*l*u)+m*(+t*c*d-t*o*f-r*a*d+i*a*f+r*o*u-i*c*u)+_*(-s*o*u-t*l*d+t*o*h+s*a*d-i*a*h+i*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8],d=e[9],h=e[10],f=e[11],g=e[12],v=e[13],m=e[14],_=e[15],y=d*m*c-v*h*c+v*l*f-o*m*f-d*l*_+o*h*_,b=g*h*c-u*m*c-g*l*f+a*m*f+u*l*_-a*h*_,p=u*v*c-g*d*c+g*o*f-a*v*f-u*o*_+a*d*_,w=g*d*l-u*v*l-g*o*h+a*v*h+u*o*m-a*d*m,E=t*y+i*b+s*p+r*w;if(E===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const C=1/E;return e[0]=y*C,e[1]=(v*h*r-d*m*r-v*s*f+i*m*f+d*s*_-i*h*_)*C,e[2]=(o*m*r-v*l*r+v*s*c-i*m*c-o*s*_+i*l*_)*C,e[3]=(d*l*r-o*h*r-d*s*c+i*h*c+o*s*f-i*l*f)*C,e[4]=b*C,e[5]=(u*m*r-g*h*r+g*s*f-t*m*f-u*s*_+t*h*_)*C,e[6]=(g*l*r-a*m*r-g*s*c+t*m*c+a*s*_-t*l*_)*C,e[7]=(a*h*r-u*l*r+u*s*c-t*h*c-a*s*f+t*l*f)*C,e[8]=p*C,e[9]=(g*d*r-u*v*r-g*i*f+t*v*f+u*i*_-t*d*_)*C,e[10]=(a*v*r-g*o*r+g*i*c-t*v*c-a*i*_+t*o*_)*C,e[11]=(u*o*r-a*d*r-u*i*c+t*d*c+a*i*f-t*o*f)*C,e[12]=w*C,e[13]=(u*v*s-g*d*s+g*i*h-t*v*h-u*i*m+t*d*m)*C,e[14]=(g*o*s-a*v*s-g*i*l+t*v*l+a*i*m-t*o*m)*C,e[15]=(a*d*s-u*o*s+u*i*l-t*d*l-a*i*h+t*o*h)*C,this}scale(e){const t=this.elements,i=e.x,s=e.y,r=e.z;return t[0]*=i,t[4]*=s,t[8]*=r,t[1]*=i,t[5]*=s,t[9]*=r,t[2]*=i,t[6]*=s,t[10]*=r,t[3]*=i,t[7]*=s,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,s))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),s=Math.sin(t),r=1-i,a=e.x,o=e.y,l=e.z,c=r*a,u=r*o;return this.set(c*a+i,c*o-s*l,c*l+s*o,0,c*o+s*l,u*o+i,u*l-s*a,0,c*l-s*o,u*l+s*a,r*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,s,r,a){return this.set(1,i,r,0,e,1,a,0,t,s,1,0,0,0,0,1),this}compose(e,t,i){const s=this.elements,r=t._x,a=t._y,o=t._z,l=t._w,c=r+r,u=a+a,d=o+o,h=r*c,f=r*u,g=r*d,v=a*u,m=a*d,_=o*d,y=l*c,b=l*u,p=l*d,w=i.x,E=i.y,C=i.z;return s[0]=(1-(v+_))*w,s[1]=(f+p)*w,s[2]=(g-b)*w,s[3]=0,s[4]=(f-p)*E,s[5]=(1-(h+_))*E,s[6]=(m+y)*E,s[7]=0,s[8]=(g+b)*C,s[9]=(m-y)*C,s[10]=(1-(h+v))*C,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,i){const s=this.elements;let r=eo.set(s[0],s[1],s[2]).length();const a=eo.set(s[4],s[5],s[6]).length(),o=eo.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),e.x=s[12],e.y=s[13],e.z=s[14],rs.copy(this);const c=1/r,u=1/a,d=1/o;return rs.elements[0]*=c,rs.elements[1]*=c,rs.elements[2]*=c,rs.elements[4]*=u,rs.elements[5]*=u,rs.elements[6]*=u,rs.elements[8]*=d,rs.elements[9]*=d,rs.elements[10]*=d,t.setFromRotationMatrix(rs),i.x=r,i.y=a,i.z=o,this}makePerspective(e,t,i,s,r,a,o=ur){const l=this.elements,c=2*r/(t-e),u=2*r/(i-s),d=(t+e)/(t-e),h=(i+s)/(i-s);let f,g;if(o===ur)f=-(a+r)/(a-r),g=-2*a*r/(a-r);else if(o===ld)f=-a/(a-r),g=-a*r/(a-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return l[0]=c,l[4]=0,l[8]=d,l[12]=0,l[1]=0,l[5]=u,l[9]=h,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=g,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,i,s,r,a,o=ur){const l=this.elements,c=1/(t-e),u=1/(i-s),d=1/(a-r),h=(t+e)*c,f=(i+s)*u;let g,v;if(o===ur)g=(a+r)*d,v=-2*d;else if(o===ld)g=r*d,v=-1*d;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-h,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-f,l[2]=0,l[6]=0,l[10]=v,l[14]=-g,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<16;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const eo=new Z,rs=new xt,ZU=new Z(0,0,0),$U=new Z(1,1,1),Rr=new Z,Dl=new Z,Li=new Z,Yb=new xt,Jb=new na;class Us{constructor(e=0,t=0,i=0,s=Us.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,s=this._order){return this._x=e,this._y=t,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const s=e.elements,r=s[0],a=s[4],o=s[8],l=s[1],c=s[5],u=s[9],d=s[2],h=s[6],f=s[10];switch(t){case"XYZ":this._y=Math.asin(mi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(h,c),this._z=0);break;case"YXZ":this._x=Math.asin(-mi(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,r),this._z=0);break;case"ZXY":this._x=Math.asin(mi(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-d,f),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-mi(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(h,f),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(mi(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-d,r)):(this._x=0,this._y=Math.atan2(o,f));break;case"XZY":this._z=Math.asin(-mi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,c),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-u,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return Yb.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Yb,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Jb.setFromEuler(this),this.setFromQuaternion(Jb,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Us.DEFAULT_ORDER="XYZ";class bA{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let e5=0;const Qb=new Z,to=new na,Ks=new xt,Ll=new Z,_c=new Z,t5=new Z,n5=new na,Zb=new Z(1,0,0),$b=new Z(0,1,0),e1=new Z(0,0,1),t1={type:"added"},i5={type:"removed"},no={type:"childadded",child:null},Mf={type:"childremoved",child:null};class Pn extends Zo{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:e5++}),this.uuid=bs(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Pn.DEFAULT_UP.clone();const e=new Z,t=new Us,i=new na,s=new Z(1,1,1);function r(){i.setFromEuler(t,!1)}function a(){t.setFromQuaternion(i,void 0,!1)}t._onChange(r),i._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new xt},normalMatrix:{value:new Pt}}),this.matrix=new xt,this.matrixWorld=new xt,this.matrixAutoUpdate=Pn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Pn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new bA,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return to.setFromAxisAngle(e,t),this.quaternion.multiply(to),this}rotateOnWorldAxis(e,t){return to.setFromAxisAngle(e,t),this.quaternion.premultiply(to),this}rotateX(e){return this.rotateOnAxis(Zb,e)}rotateY(e){return this.rotateOnAxis($b,e)}rotateZ(e){return this.rotateOnAxis(e1,e)}translateOnAxis(e,t){return Qb.copy(e).applyQuaternion(this.quaternion),this.position.add(Qb.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Zb,e)}translateY(e){return this.translateOnAxis($b,e)}translateZ(e){return this.translateOnAxis(e1,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Ks.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Ll.copy(e):Ll.set(e,t,i);const s=this.parent;this.updateWorldMatrix(!0,!1),_c.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ks.lookAt(_c,Ll,this.up):Ks.lookAt(Ll,_c,this.up),this.quaternion.setFromRotationMatrix(Ks),s&&(Ks.extractRotation(s.matrixWorld),to.setFromRotationMatrix(Ks),this.quaternion.premultiply(to.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(t1),no.child=e,this.dispatchEvent(no),no.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(i5),Mf.child=e,this.dispatchEvent(Mf),Mf.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Ks.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Ks.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ks),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(t1),no.child=e,this.dispatchEvent(no),no.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,s=this.children.length;i<s;i++){const a=this.children[i].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const s=this.children;for(let r=0,a=s.length;r<a;r++)s[r].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_c,e,t5),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_c,n5,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const s=this.children;for(let r=0,a=s.length;r<a;r++)s[r].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(o=>({boxInitialized:o.boxInitialized,boxMin:o.box.min.toArray(),boxMax:o.box.max.toArray(),sphereInitialized:o.sphereInitialized,sphereRadius:o.sphere.radius,sphereCenter:o.sphere.center.toArray()})),s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function r(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const d=l[c];r(e.shapes,d)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,c=this.material.length;l<c;l++)o.push(r(e.materials,this.material[l]));s.material=o}else s.material=r(e.materials,this.material);if(this.children.length>0){s.children=[];for(let o=0;o<this.children.length;o++)s.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];s.animations.push(r(e.animations,l))}}if(t){const o=a(e.geometries),l=a(e.materials),c=a(e.textures),u=a(e.images),d=a(e.shapes),h=a(e.skeletons),f=a(e.animations),g=a(e.nodes);o.length>0&&(i.geometries=o),l.length>0&&(i.materials=l),c.length>0&&(i.textures=c),u.length>0&&(i.images=u),d.length>0&&(i.shapes=d),h.length>0&&(i.skeletons=h),f.length>0&&(i.animations=f),g.length>0&&(i.nodes=g)}return i.object=s,i;function a(o){const l=[];for(const c in o){const u=o[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const s=e.children[i];this.add(s.clone())}return this}}Pn.DEFAULT_UP=new Z(0,1,0);Pn.DEFAULT_MATRIX_AUTO_UPDATE=!0;Pn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const as=new Z,qs=new Z,xf=new Z,Xs=new Z,io=new Z,so=new Z,n1=new Z,If=new Z,Pf=new Z,Nf=new Z,Df=new rn,Lf=new rn,Of=new rn;class _s{constructor(e=new Z,t=new Z,i=new Z){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,s){s.subVectors(i,t),as.subVectors(e,t),s.cross(as);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(e,t,i,s,r){as.subVectors(s,t),qs.subVectors(i,t),xf.subVectors(e,t);const a=as.dot(as),o=as.dot(qs),l=as.dot(xf),c=qs.dot(qs),u=qs.dot(xf),d=a*c-o*o;if(d===0)return r.set(0,0,0),null;const h=1/d,f=(c*l-o*u)*h,g=(a*u-o*l)*h;return r.set(1-f-g,g,f)}static containsPoint(e,t,i,s){return this.getBarycoord(e,t,i,s,Xs)===null?!1:Xs.x>=0&&Xs.y>=0&&Xs.x+Xs.y<=1}static getInterpolation(e,t,i,s,r,a,o,l){return this.getBarycoord(e,t,i,s,Xs)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(r,Xs.x),l.addScaledVector(a,Xs.y),l.addScaledVector(o,Xs.z),l)}static getInterpolatedAttribute(e,t,i,s,r,a){return Df.setScalar(0),Lf.setScalar(0),Of.setScalar(0),Df.fromBufferAttribute(e,t),Lf.fromBufferAttribute(e,i),Of.fromBufferAttribute(e,s),a.setScalar(0),a.addScaledVector(Df,r.x),a.addScaledVector(Lf,r.y),a.addScaledVector(Of,r.z),a}static isFrontFacing(e,t,i,s){return as.subVectors(i,t),qs.subVectors(e,t),as.cross(qs).dot(s)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,s){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,i,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return as.subVectors(this.c,this.b),qs.subVectors(this.a,this.b),as.cross(qs).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return _s.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return _s.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,s,r){return _s.getInterpolation(e,this.a,this.b,this.c,t,i,s,r)}containsPoint(e){return _s.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return _s.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,s=this.b,r=this.c;let a,o;io.subVectors(s,i),so.subVectors(r,i),If.subVectors(e,i);const l=io.dot(If),c=so.dot(If);if(l<=0&&c<=0)return t.copy(i);Pf.subVectors(e,s);const u=io.dot(Pf),d=so.dot(Pf);if(u>=0&&d<=u)return t.copy(s);const h=l*d-u*c;if(h<=0&&l>=0&&u<=0)return a=l/(l-u),t.copy(i).addScaledVector(io,a);Nf.subVectors(e,r);const f=io.dot(Nf),g=so.dot(Nf);if(g>=0&&f<=g)return t.copy(r);const v=f*c-l*g;if(v<=0&&c>=0&&g<=0)return o=c/(c-g),t.copy(i).addScaledVector(so,o);const m=u*g-f*d;if(m<=0&&d-u>=0&&f-g>=0)return n1.subVectors(r,s),o=(d-u)/(d-u+(f-g)),t.copy(s).addScaledVector(n1,o);const _=1/(m+v+h);return a=v*_,o=h*_,t.copy(i).addScaledVector(io,a).addScaledVector(so,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const yA={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},kr={h:0,s:0,l:0},Ol={h:0,s:0,l:0};function Uf(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class Rt{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const s=e;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Si){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,en.toWorkingColorSpace(this,t),this}setRGB(e,t,i,s=en.workingColorSpace){return this.r=e,this.g=t,this.b=i,en.toWorkingColorSpace(this,s),this}setHSL(e,t,i,s=en.workingColorSpace){if(e=n0(e,1),t=mi(t,0,1),i=mi(i,0,1),t===0)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+t):i+t-i*t,a=2*i-r;this.r=Uf(a,r,e+1/3),this.g=Uf(a,r,e),this.b=Uf(a,r,e-1/3)}return en.toWorkingColorSpace(this,s),this}setStyle(e,t=Si){function i(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const a=s[1],o=s[2];switch(a){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=s[1],a=r.length;if(a===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(a===6)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Si){const i=yA[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=xo(e.r),this.g=xo(e.g),this.b=xo(e.b),this}copyLinearToSRGB(e){return this.r=Tf(e.r),this.g=Tf(e.g),this.b=Tf(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Si){return en.fromWorkingColorSpace(fi.copy(this),e),Math.round(mi(fi.r*255,0,255))*65536+Math.round(mi(fi.g*255,0,255))*256+Math.round(mi(fi.b*255,0,255))}getHexString(e=Si){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=en.workingColorSpace){en.fromWorkingColorSpace(fi.copy(this),t);const i=fi.r,s=fi.g,r=fi.b,a=Math.max(i,s,r),o=Math.min(i,s,r);let l,c;const u=(o+a)/2;if(o===a)l=0,c=0;else{const d=a-o;switch(c=u<=.5?d/(a+o):d/(2-a-o),a){case i:l=(s-r)/d+(s<r?6:0);break;case s:l=(r-i)/d+2;break;case r:l=(i-s)/d+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,t=en.workingColorSpace){return en.fromWorkingColorSpace(fi.copy(this),t),e.r=fi.r,e.g=fi.g,e.b=fi.b,e}getStyle(e=Si){en.fromWorkingColorSpace(fi.copy(this),e);const t=fi.r,i=fi.g,s=fi.b;return e!==Si?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(s*255)})`}offsetHSL(e,t,i){return this.getHSL(kr),this.setHSL(kr.h+e,kr.s+t,kr.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(kr),e.getHSL(Ol);const i=Vc(kr.h,Ol.h,t),s=Vc(kr.s,Ol.s,t),r=Vc(kr.l,Ol.l,t);return this.setHSL(i,s,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,s=this.b,r=e.elements;return this.r=r[0]*t+r[3]*i+r[6]*s,this.g=r[1]*t+r[4]*i+r[7]*s,this.b=r[2]*t+r[5]*i+r[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const fi=new Rt;Rt.NAMES=yA;let s5=0;class Ns extends Zo{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:s5++}),this.uuid=bs(),this.name="",this.type="Material",this.blending=ko,this.side=mr,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=om,this.blendDst=cm,this.blendEquation=ba,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Rt(0,0,0),this.blendAlpha=0,this.depthFunc=Bo,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=zb,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Ya,this.stencilZFail=Ya,this.stencilZPass=Ya,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const s=this[t];if(s===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==ko&&(i.blending=this.blending),this.side!==mr&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==om&&(i.blendSrc=this.blendSrc),this.blendDst!==cm&&(i.blendDst=this.blendDst),this.blendEquation!==ba&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==Bo&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==zb&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Ya&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Ya&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Ya&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function s(r){const a=[];for(const o in r){const l=r[o];delete l.metadata,a.push(l)}return a}if(t){const r=s(e.textures),a=s(e.images);r.length>0&&(i.textures=r),a.length>0&&(i.images=a)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const s=t.length;i=new Array(s);for(let r=0;r!==s;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class Ta extends Ns{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Rt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Us,this.combine=tA,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const jn=new Z,Ul=new Xt;class Ci{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=Wm,this.updateRanges=[],this.gpuType=vs,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[e+s]=t.array[i+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Ul.fromBufferAttribute(this,t),Ul.applyMatrix3(e),this.setXY(t,Ul.x,Ul.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)jn.fromBufferAttribute(this,t),jn.applyMatrix3(e),this.setXYZ(t,jn.x,jn.y,jn.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)jn.fromBufferAttribute(this,t),jn.applyMatrix4(e),this.setXYZ(t,jn.x,jn.y,jn.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)jn.fromBufferAttribute(this,t),jn.applyNormalMatrix(e),this.setXYZ(t,jn.x,jn.y,jn.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)jn.fromBufferAttribute(this,t),jn.transformDirection(e),this.setXYZ(t,jn.x,jn.y,jn.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=gs(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=pn(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=gs(t,this.array)),t}setX(e,t){return this.normalized&&(t=pn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=gs(t,this.array)),t}setY(e,t){return this.normalized&&(t=pn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=gs(t,this.array)),t}setZ(e,t){return this.normalized&&(t=pn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=gs(t,this.array)),t}setW(e,t){return this.normalized&&(t=pn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=pn(t,this.array),i=pn(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,s){return e*=this.itemSize,this.normalized&&(t=pn(t,this.array),i=pn(i,this.array),s=pn(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this}setXYZW(e,t,i,s,r){return e*=this.itemSize,this.normalized&&(t=pn(t,this.array),i=pn(i,this.array),s=pn(s,this.array),r=pn(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Wm&&(e.usage=this.usage),e}}class TA extends Ci{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class SA extends Ci{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class Ds extends Ci{constructor(e,t,i){super(new Float32Array(e),t,i)}}let r5=0;const qi=new xt,Ff=new Pn,ro=new Z,Oi=new vr,vc=new vr,Zn=new Z;class Es extends Zo{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:r5++}),this.uuid=bs(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(gA(e)?SA:TA)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const r=new Pt().getNormalMatrix(e);i.applyNormalMatrix(r),i.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return qi.makeRotationFromQuaternion(e),this.applyMatrix4(qi),this}rotateX(e){return qi.makeRotationX(e),this.applyMatrix4(qi),this}rotateY(e){return qi.makeRotationY(e),this.applyMatrix4(qi),this}rotateZ(e){return qi.makeRotationZ(e),this.applyMatrix4(qi),this}translate(e,t,i){return qi.makeTranslation(e,t,i),this.applyMatrix4(qi),this}scale(e,t,i){return qi.makeScale(e,t,i),this.applyMatrix4(qi),this}lookAt(e){return Ff.lookAt(e),Ff.updateMatrix(),this.applyMatrix4(Ff.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ro).negate(),this.translate(ro.x,ro.y,ro.z),this}setFromPoints(e){const t=[];for(let i=0,s=e.length;i<s;i++){const r=e[i];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Ds(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new vr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Z(-1/0,-1/0,-1/0),new Z(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,s=t.length;i<s;i++){const r=t[i];Oi.setFromBufferAttribute(r),this.morphTargetsRelative?(Zn.addVectors(this.boundingBox.min,Oi.min),this.boundingBox.expandByPoint(Zn),Zn.addVectors(this.boundingBox.max,Oi.max),this.boundingBox.expandByPoint(Zn)):(this.boundingBox.expandByPoint(Oi.min),this.boundingBox.expandByPoint(Oi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Bs);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Z,1/0);return}if(e){const i=this.boundingSphere.center;if(Oi.setFromBufferAttribute(e),t)for(let r=0,a=t.length;r<a;r++){const o=t[r];vc.setFromBufferAttribute(o),this.morphTargetsRelative?(Zn.addVectors(Oi.min,vc.min),Oi.expandByPoint(Zn),Zn.addVectors(Oi.max,vc.max),Oi.expandByPoint(Zn)):(Oi.expandByPoint(vc.min),Oi.expandByPoint(vc.max))}Oi.getCenter(i);let s=0;for(let r=0,a=e.count;r<a;r++)Zn.fromBufferAttribute(e,r),s=Math.max(s,i.distanceToSquared(Zn));if(t)for(let r=0,a=t.length;r<a;r++){const o=t[r],l=this.morphTargetsRelative;for(let c=0,u=o.count;c<u;c++)Zn.fromBufferAttribute(o,c),l&&(ro.fromBufferAttribute(e,c),Zn.add(ro)),s=Math.max(s,i.distanceToSquared(Zn))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,s=t.normal,r=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ci(new Float32Array(4*i.count),4));const a=this.getAttribute("tangent"),o=[],l=[];for(let M=0;M<i.count;M++)o[M]=new Z,l[M]=new Z;const c=new Z,u=new Z,d=new Z,h=new Xt,f=new Xt,g=new Xt,v=new Z,m=new Z;function _(M,I,T){c.fromBufferAttribute(i,M),u.fromBufferAttribute(i,I),d.fromBufferAttribute(i,T),h.fromBufferAttribute(r,M),f.fromBufferAttribute(r,I),g.fromBufferAttribute(r,T),u.sub(c),d.sub(c),f.sub(h),g.sub(h);const R=1/(f.x*g.y-g.x*f.y);isFinite(R)&&(v.copy(u).multiplyScalar(g.y).addScaledVector(d,-f.y).multiplyScalar(R),m.copy(d).multiplyScalar(f.x).addScaledVector(u,-g.x).multiplyScalar(R),o[M].add(v),o[I].add(v),o[T].add(v),l[M].add(m),l[I].add(m),l[T].add(m))}let y=this.groups;y.length===0&&(y=[{start:0,count:e.count}]);for(let M=0,I=y.length;M<I;++M){const T=y[M],R=T.start,V=T.count;for(let H=R,B=R+V;H<B;H+=3)_(e.getX(H+0),e.getX(H+1),e.getX(H+2))}const b=new Z,p=new Z,w=new Z,E=new Z;function C(M){w.fromBufferAttribute(s,M),E.copy(w);const I=o[M];b.copy(I),b.sub(w.multiplyScalar(w.dot(I))).normalize(),p.crossVectors(E,I);const R=p.dot(l[M])<0?-1:1;a.setXYZW(M,b.x,b.y,b.z,R)}for(let M=0,I=y.length;M<I;++M){const T=y[M],R=T.start,V=T.count;for(let H=R,B=R+V;H<B;H+=3)C(e.getX(H+0)),C(e.getX(H+1)),C(e.getX(H+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Ci(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let h=0,f=i.count;h<f;h++)i.setXYZ(h,0,0,0);const s=new Z,r=new Z,a=new Z,o=new Z,l=new Z,c=new Z,u=new Z,d=new Z;if(e)for(let h=0,f=e.count;h<f;h+=3){const g=e.getX(h+0),v=e.getX(h+1),m=e.getX(h+2);s.fromBufferAttribute(t,g),r.fromBufferAttribute(t,v),a.fromBufferAttribute(t,m),u.subVectors(a,r),d.subVectors(s,r),u.cross(d),o.fromBufferAttribute(i,g),l.fromBufferAttribute(i,v),c.fromBufferAttribute(i,m),o.add(u),l.add(u),c.add(u),i.setXYZ(g,o.x,o.y,o.z),i.setXYZ(v,l.x,l.y,l.z),i.setXYZ(m,c.x,c.y,c.z)}else for(let h=0,f=t.count;h<f;h+=3)s.fromBufferAttribute(t,h+0),r.fromBufferAttribute(t,h+1),a.fromBufferAttribute(t,h+2),u.subVectors(a,r),d.subVectors(s,r),u.cross(d),i.setXYZ(h+0,u.x,u.y,u.z),i.setXYZ(h+1,u.x,u.y,u.z),i.setXYZ(h+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Zn.fromBufferAttribute(e,t),Zn.normalize(),e.setXYZ(t,Zn.x,Zn.y,Zn.z)}toNonIndexed(){function e(o,l){const c=o.array,u=o.itemSize,d=o.normalized,h=new c.constructor(l.length*u);let f=0,g=0;for(let v=0,m=l.length;v<m;v++){o.isInterleavedBufferAttribute?f=l[v]*o.data.stride+o.offset:f=l[v]*u;for(let _=0;_<u;_++)h[g++]=c[f++]}return new Ci(h,u,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Es,i=this.index.array,s=this.attributes;for(const o in s){const l=s[o],c=e(l,i);t.setAttribute(o,c)}const r=this.morphAttributes;for(const o in r){const l=[],c=r[o];for(let u=0,d=c.length;u<d;u++){const h=c[u],f=e(h,i);l.push(f)}t.morphAttributes[o]=l}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,l=a.length;o<l;o++){const c=a[o];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const c=i[l];e.data.attributes[l]=c.toJSON(e.data)}const s={};let r=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let d=0,h=c.length;d<h;d++){const f=c[d];u.push(f.toJSON(e.data))}u.length>0&&(s[l]=u,r=!0)}r&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const s=e.attributes;for(const c in s){const u=s[c];this.setAttribute(c,u.clone(t))}const r=e.morphAttributes;for(const c in r){const u=[],d=r[c];for(let h=0,f=d.length;h<f;h++)u.push(d[h].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let c=0,u=a.length;c<u;c++){const d=a[c];this.addGroup(d.start,d.count,d.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const i1=new xt,la=new Ud,Fl=new Bs,s1=new Z,Bl=new Z,Vl=new Z,Gl=new Z,Bf=new Z,zl=new Z,r1=new Z,Hl=new Z;class Wi extends Pn{constructor(e=new Es,t=new Ta){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=s.length;r<a;r++){const o=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}getVertexPosition(e,t){const i=this.geometry,s=i.attributes.position,r=i.morphAttributes.position,a=i.morphTargetsRelative;t.fromBufferAttribute(s,e);const o=this.morphTargetInfluences;if(r&&o){zl.set(0,0,0);for(let l=0,c=r.length;l<c;l++){const u=o[l],d=r[l];u!==0&&(Bf.fromBufferAttribute(d,e),a?zl.addScaledVector(Bf,u):zl.addScaledVector(Bf.sub(t),u))}t.add(zl)}return t}raycast(e,t){const i=this.geometry,s=this.material,r=this.matrixWorld;s!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),Fl.copy(i.boundingSphere),Fl.applyMatrix4(r),la.copy(e.ray).recast(e.near),!(Fl.containsPoint(la.origin)===!1&&(la.intersectSphere(Fl,s1)===null||la.origin.distanceToSquared(s1)>(e.far-e.near)**2))&&(i1.copy(r).invert(),la.copy(e.ray).applyMatrix4(i1),!(i.boundingBox!==null&&la.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,la)))}_computeIntersections(e,t,i){let s;const r=this.geometry,a=this.material,o=r.index,l=r.attributes.position,c=r.attributes.uv,u=r.attributes.uv1,d=r.attributes.normal,h=r.groups,f=r.drawRange;if(o!==null)if(Array.isArray(a))for(let g=0,v=h.length;g<v;g++){const m=h[g],_=a[m.materialIndex],y=Math.max(m.start,f.start),b=Math.min(o.count,Math.min(m.start+m.count,f.start+f.count));for(let p=y,w=b;p<w;p+=3){const E=o.getX(p),C=o.getX(p+1),M=o.getX(p+2);s=Wl(this,_,e,i,c,u,d,E,C,M),s&&(s.faceIndex=Math.floor(p/3),s.face.materialIndex=m.materialIndex,t.push(s))}}else{const g=Math.max(0,f.start),v=Math.min(o.count,f.start+f.count);for(let m=g,_=v;m<_;m+=3){const y=o.getX(m),b=o.getX(m+1),p=o.getX(m+2);s=Wl(this,a,e,i,c,u,d,y,b,p),s&&(s.faceIndex=Math.floor(m/3),t.push(s))}}else if(l!==void 0)if(Array.isArray(a))for(let g=0,v=h.length;g<v;g++){const m=h[g],_=a[m.materialIndex],y=Math.max(m.start,f.start),b=Math.min(l.count,Math.min(m.start+m.count,f.start+f.count));for(let p=y,w=b;p<w;p+=3){const E=p,C=p+1,M=p+2;s=Wl(this,_,e,i,c,u,d,E,C,M),s&&(s.faceIndex=Math.floor(p/3),s.face.materialIndex=m.materialIndex,t.push(s))}}else{const g=Math.max(0,f.start),v=Math.min(l.count,f.start+f.count);for(let m=g,_=v;m<_;m+=3){const y=m,b=m+1,p=m+2;s=Wl(this,a,e,i,c,u,d,y,b,p),s&&(s.faceIndex=Math.floor(m/3),t.push(s))}}}}function a5(n,e,t,i,s,r,a,o){let l;if(e.side===Pi?l=i.intersectTriangle(a,r,s,!0,o):l=i.intersectTriangle(s,r,a,e.side===mr,o),l===null)return null;Hl.copy(o),Hl.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(Hl);return c<t.near||c>t.far?null:{distance:c,point:Hl.clone(),object:n}}function Wl(n,e,t,i,s,r,a,o,l,c){n.getVertexPosition(o,Bl),n.getVertexPosition(l,Vl),n.getVertexPosition(c,Gl);const u=a5(n,e,t,i,Bl,Vl,Gl,r1);if(u){const d=new Z;_s.getBarycoord(r1,Bl,Vl,Gl,d),s&&(u.uv=_s.getInterpolatedAttribute(s,o,l,c,d,new Xt)),r&&(u.uv1=_s.getInterpolatedAttribute(r,o,l,c,d,new Xt)),a&&(u.normal=_s.getInterpolatedAttribute(a,o,l,c,d,new Z),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const h={a:o,b:l,c,normal:new Z,materialIndex:0};_s.getNormal(Bl,Vl,Gl,h.normal),u.face=h,u.barycoord=d}return u}class hl extends Es{constructor(e=1,t=1,i=1,s=1,r=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:s,heightSegments:r,depthSegments:a};const o=this;s=Math.floor(s),r=Math.floor(r),a=Math.floor(a);const l=[],c=[],u=[],d=[];let h=0,f=0;g("z","y","x",-1,-1,i,t,e,a,r,0),g("z","y","x",1,-1,i,t,-e,a,r,1),g("x","z","y",1,1,e,i,t,s,a,2),g("x","z","y",1,-1,e,i,-t,s,a,3),g("x","y","z",1,-1,e,t,i,s,r,4),g("x","y","z",-1,-1,e,t,-i,s,r,5),this.setIndex(l),this.setAttribute("position",new Ds(c,3)),this.setAttribute("normal",new Ds(u,3)),this.setAttribute("uv",new Ds(d,2));function g(v,m,_,y,b,p,w,E,C,M,I){const T=p/C,R=w/M,V=p/2,H=w/2,B=E/2,te=C+1,j=M+1;let oe=0,z=0;const W=new Z;for(let ie=0;ie<j;ie++){const se=ie*R-H;for(let je=0;je<te;je++){const ge=je*T-V;W[v]=ge*y,W[m]=se*b,W[_]=B,c.push(W.x,W.y,W.z),W[v]=0,W[m]=0,W[_]=E>0?1:-1,u.push(W.x,W.y,W.z),d.push(je/C),d.push(1-ie/M),oe+=1}}for(let ie=0;ie<M;ie++)for(let se=0;se<C;se++){const je=h+se+te*ie,ge=h+se+te*(ie+1),L=h+(se+1)+te*(ie+1),J=h+(se+1)+te*ie;l.push(je,ge,J),l.push(ge,L,J),z+=6}o.addGroup(f,z,I),f+=z,h+=oe}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new hl(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Ko(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const s=n[t][i];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=s.clone():Array.isArray(s)?e[t][i]=s.slice():e[t][i]=s}}return e}function yi(n){const e={};for(let t=0;t<n.length;t++){const i=Ko(n[t]);for(const s in i)e[s]=i[s]}return e}function o5(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function EA(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:en.workingColorSpace}const c5={clone:Ko,merge:yi};var l5=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,u5=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class _r extends Ns{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=l5,this.fragmentShader=u5,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ko(e.uniforms),this.uniformsGroups=o5(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const a=this.uniforms[s].value;a&&a.isTexture?t.uniforms[s]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[s]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[s]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[s]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[s]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[s]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[s]={type:"m4",value:a.toArray()}:t.uniforms[s]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const s in this.extensions)this.extensions[s]===!0&&(i[s]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class AA extends Pn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new xt,this.projectionMatrix=new xt,this.projectionMatrixInverse=new xt,this.coordinateSystem=ur}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Mr=new Z,a1=new Xt,o1=new Xt;class Ei extends AA{constructor(e=50,t=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=jo*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Bc*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return jo*2*Math.atan(Math.tan(Bc*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){Mr.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Mr.x,Mr.y).multiplyScalar(-e/Mr.z),Mr.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Mr.x,Mr.y).multiplyScalar(-e/Mr.z)}getViewSize(e,t){return this.getViewBounds(e,a1,o1),t.subVectors(o1,a1)}setViewOffset(e,t,i,s,r,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Bc*.5*this.fov)/this.zoom,i=2*t,s=this.aspect*i,r=-.5*s;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,c=a.fullHeight;r+=a.offsetX*s/l,t-=a.offsetY*i/c,s*=a.width/l,i*=a.height/c}const o=this.filmOffset;o!==0&&(r+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const ao=-90,oo=1;class d5 extends Pn{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new Ei(ao,oo,e,t);s.layers=this.layers,this.add(s);const r=new Ei(ao,oo,e,t);r.layers=this.layers,this.add(r);const a=new Ei(ao,oo,e,t);a.layers=this.layers,this.add(a);const o=new Ei(ao,oo,e,t);o.layers=this.layers,this.add(o);const l=new Ei(ao,oo,e,t);l.layers=this.layers,this.add(l);const c=new Ei(ao,oo,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,s,r,a,o,l]=t;for(const c of t)this.remove(c);if(e===ur)i.up.set(0,1,0),i.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===ld)i.up.set(0,-1,0),i.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:s}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,a,o,l,c,u]=this.children,d=e.getRenderTarget(),h=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),g=e.xr.enabled;e.xr.enabled=!1;const v=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,s),e.render(t,r),e.setRenderTarget(i,1,s),e.render(t,a),e.setRenderTarget(i,2,s),e.render(t,o),e.setRenderTarget(i,3,s),e.render(t,l),e.setRenderTarget(i,4,s),e.render(t,c),i.texture.generateMipmaps=v,e.setRenderTarget(i,5,s),e.render(t,u),e.setRenderTarget(d,h,f),e.xr.enabled=g,i.texture.needsPMREMUpdate=!0}}class CA extends ni{constructor(e,t,i,s,r,a,o,l,c,u){e=e!==void 0?e:[],t=t!==void 0?t:Vo,super(e,t,i,s,r,a,o,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class h5 extends Na{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},s=[i,i,i,i,i,i];this.texture=new CA(s,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Gi}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new hl(5,5,5),r=new _r({name:"CubemapFromEquirect",uniforms:Ko(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Pi,blending:qr});r.uniforms.tEquirect.value=t;const a=new Wi(s,r),o=t.minFilter;return t.minFilter===lr&&(t.minFilter=Gi),new d5(1,10,this).update(e,a),t.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,i,s){const r=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,i,s);e.setRenderTarget(r)}}const Vf=new Z,f5=new Z,p5=new Pt;class _a{constructor(e=new Z(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,s){return this.normal.set(e,t,i),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const s=Vf.subVectors(i,t).cross(f5.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(Vf),s=this.normal.dot(i);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:t.copy(e.start).addScaledVector(i,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||p5.getNormalMatrix(e),s=this.coplanarPoint(Vf).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-s.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const ua=new Bs,jl=new Z;class i0{constructor(e=new _a,t=new _a,i=new _a,s=new _a,r=new _a,a=new _a){this.planes=[e,t,i,s,r,a]}set(e,t,i,s,r,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(i),o[3].copy(s),o[4].copy(r),o[5].copy(a),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=ur){const i=this.planes,s=e.elements,r=s[0],a=s[1],o=s[2],l=s[3],c=s[4],u=s[5],d=s[6],h=s[7],f=s[8],g=s[9],v=s[10],m=s[11],_=s[12],y=s[13],b=s[14],p=s[15];if(i[0].setComponents(l-r,h-c,m-f,p-_).normalize(),i[1].setComponents(l+r,h+c,m+f,p+_).normalize(),i[2].setComponents(l+a,h+u,m+g,p+y).normalize(),i[3].setComponents(l-a,h-u,m-g,p-y).normalize(),i[4].setComponents(l-o,h-d,m-v,p-b).normalize(),t===ur)i[5].setComponents(l+o,h+d,m+v,p+b).normalize();else if(t===ld)i[5].setComponents(o,d,v,b).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),ua.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),ua.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(ua)}intersectsSprite(e){return ua.center.set(0,0,0),ua.radius=.7071067811865476,ua.applyMatrix4(e.matrixWorld),this.intersectsSphere(ua)}intersectsSphere(e){const t=this.planes,i=e.center,s=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(i)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const s=t[i];if(jl.x=s.normal.x>0?e.max.x:e.min.x,jl.y=s.normal.y>0?e.max.y:e.min.y,jl.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(jl)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function wA(){let n=null,e=!1,t=null,i=null;function s(r,a){t(r,a),i=n.requestAnimationFrame(s)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(s),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){n=r}}}function m5(n){const e=new WeakMap;function t(o,l){const c=o.array,u=o.usage,d=c.byteLength,h=n.createBuffer();n.bindBuffer(l,h),n.bufferData(l,c,u),o.onUploadCallback();let f;if(c instanceof Float32Array)f=n.FLOAT;else if(c instanceof Uint16Array)o.isFloat16BufferAttribute?f=n.HALF_FLOAT:f=n.UNSIGNED_SHORT;else if(c instanceof Int16Array)f=n.SHORT;else if(c instanceof Uint32Array)f=n.UNSIGNED_INT;else if(c instanceof Int32Array)f=n.INT;else if(c instanceof Int8Array)f=n.BYTE;else if(c instanceof Uint8Array)f=n.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)f=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:h,type:f,bytesPerElement:c.BYTES_PER_ELEMENT,version:o.version,size:d}}function i(o,l,c){const u=l.array,d=l.updateRanges;if(n.bindBuffer(c,o),d.length===0)n.bufferSubData(c,0,u);else{d.sort((f,g)=>f.start-g.start);let h=0;for(let f=1;f<d.length;f++){const g=d[h],v=d[f];v.start<=g.start+g.count+1?g.count=Math.max(g.count,v.start+v.count-g.start):(++h,d[h]=v)}d.length=h+1;for(let f=0,g=d.length;f<g;f++){const v=d[f];n.bufferSubData(c,v.start*u.BYTES_PER_ELEMENT,u,v.start,v.count)}l.clearUpdateRanges()}l.onUploadCallback()}function s(o){return o.isInterleavedBufferAttribute&&(o=o.data),e.get(o)}function r(o){o.isInterleavedBufferAttribute&&(o=o.data);const l=e.get(o);l&&(n.deleteBuffer(l.buffer),e.delete(o))}function a(o,l){if(o.isInterleavedBufferAttribute&&(o=o.data),o.isGLBufferAttribute){const u=e.get(o);(!u||u.version<o.version)&&e.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}const c=e.get(o);if(c===void 0)e.set(o,t(o,l));else if(c.version<o.version){if(c.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(c.buffer,o,l),c.version=o.version}}return{get:s,remove:r,update:a}}class Fd extends Es{constructor(e=1,t=1,i=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:s};const r=e/2,a=t/2,o=Math.floor(i),l=Math.floor(s),c=o+1,u=l+1,d=e/o,h=t/l,f=[],g=[],v=[],m=[];for(let _=0;_<u;_++){const y=_*h-a;for(let b=0;b<c;b++){const p=b*d-r;g.push(p,-y,0),v.push(0,0,1),m.push(b/o),m.push(1-_/l)}}for(let _=0;_<l;_++)for(let y=0;y<o;y++){const b=y+c*_,p=y+c*(_+1),w=y+1+c*(_+1),E=y+1+c*_;f.push(b,p,E),f.push(p,w,E)}this.setIndex(f),this.setAttribute("position",new Ds(g,3)),this.setAttribute("normal",new Ds(v,3)),this.setAttribute("uv",new Ds(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Fd(e.width,e.height,e.widthSegments,e.heightSegments)}}var g5=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,_5=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,v5=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,b5=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,y5=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,T5=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,S5=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,E5=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,A5=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,C5=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,w5=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,R5=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,k5=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,M5=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,x5=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,I5=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,P5=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,N5=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,D5=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,L5=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,O5=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,U5=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,F5=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,B5=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,V5=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,G5=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,z5=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,H5=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,W5=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,j5=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,K5="gl_FragColor = linearToOutputTexel( gl_FragColor );",q5=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,X5=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Y5=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,J5=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Q5=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Z5=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,$5=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,eF=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,tF=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,nF=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,iF=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,sF=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,rF=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,aF=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,oF=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,cF=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,lF=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,uF=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,dF=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,hF=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,fF=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,pF=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,mF=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,gF=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,_F=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,vF=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,bF=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,yF=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,TF=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,SF=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,EF=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,AF=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,CF=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,wF=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,RF=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,kF=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,MF=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,xF=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,IF=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,PF=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,NF=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,DF=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,LF=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,OF=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,UF=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,FF=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,BF=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,VF=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,GF=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,zF=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,HF=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,WF=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,jF=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,KF=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,qF=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,XF=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,YF=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,JF=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,QF=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,ZF=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,$F=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,eB=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,tB=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,nB=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,iB=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,sB=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,rB=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,aB=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,oB=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,cB=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,lB=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,uB=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,dB=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,hB=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,fB=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,pB=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const mB=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,gB=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,_B=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,vB=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,bB=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,yB=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,TB=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,SB=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,EB=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,AB=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,CB=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,wB=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,RB=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,kB=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,MB=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,xB=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,IB=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,PB=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,NB=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,DB=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,LB=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,OB=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,UB=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,FB=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,BB=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,VB=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,GB=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,zB=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,HB=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,WB=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,jB=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,KB=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,qB=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,XB=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,It={alphahash_fragment:g5,alphahash_pars_fragment:_5,alphamap_fragment:v5,alphamap_pars_fragment:b5,alphatest_fragment:y5,alphatest_pars_fragment:T5,aomap_fragment:S5,aomap_pars_fragment:E5,batching_pars_vertex:A5,batching_vertex:C5,begin_vertex:w5,beginnormal_vertex:R5,bsdfs:k5,iridescence_fragment:M5,bumpmap_pars_fragment:x5,clipping_planes_fragment:I5,clipping_planes_pars_fragment:P5,clipping_planes_pars_vertex:N5,clipping_planes_vertex:D5,color_fragment:L5,color_pars_fragment:O5,color_pars_vertex:U5,color_vertex:F5,common:B5,cube_uv_reflection_fragment:V5,defaultnormal_vertex:G5,displacementmap_pars_vertex:z5,displacementmap_vertex:H5,emissivemap_fragment:W5,emissivemap_pars_fragment:j5,colorspace_fragment:K5,colorspace_pars_fragment:q5,envmap_fragment:X5,envmap_common_pars_fragment:Y5,envmap_pars_fragment:J5,envmap_pars_vertex:Q5,envmap_physical_pars_fragment:cF,envmap_vertex:Z5,fog_vertex:$5,fog_pars_vertex:eF,fog_fragment:tF,fog_pars_fragment:nF,gradientmap_pars_fragment:iF,lightmap_pars_fragment:sF,lights_lambert_fragment:rF,lights_lambert_pars_fragment:aF,lights_pars_begin:oF,lights_toon_fragment:lF,lights_toon_pars_fragment:uF,lights_phong_fragment:dF,lights_phong_pars_fragment:hF,lights_physical_fragment:fF,lights_physical_pars_fragment:pF,lights_fragment_begin:mF,lights_fragment_maps:gF,lights_fragment_end:_F,logdepthbuf_fragment:vF,logdepthbuf_pars_fragment:bF,logdepthbuf_pars_vertex:yF,logdepthbuf_vertex:TF,map_fragment:SF,map_pars_fragment:EF,map_particle_fragment:AF,map_particle_pars_fragment:CF,metalnessmap_fragment:wF,metalnessmap_pars_fragment:RF,morphinstance_vertex:kF,morphcolor_vertex:MF,morphnormal_vertex:xF,morphtarget_pars_vertex:IF,morphtarget_vertex:PF,normal_fragment_begin:NF,normal_fragment_maps:DF,normal_pars_fragment:LF,normal_pars_vertex:OF,normal_vertex:UF,normalmap_pars_fragment:FF,clearcoat_normal_fragment_begin:BF,clearcoat_normal_fragment_maps:VF,clearcoat_pars_fragment:GF,iridescence_pars_fragment:zF,opaque_fragment:HF,packing:WF,premultiplied_alpha_fragment:jF,project_vertex:KF,dithering_fragment:qF,dithering_pars_fragment:XF,roughnessmap_fragment:YF,roughnessmap_pars_fragment:JF,shadowmap_pars_fragment:QF,shadowmap_pars_vertex:ZF,shadowmap_vertex:$F,shadowmask_pars_fragment:eB,skinbase_vertex:tB,skinning_pars_vertex:nB,skinning_vertex:iB,skinnormal_vertex:sB,specularmap_fragment:rB,specularmap_pars_fragment:aB,tonemapping_fragment:oB,tonemapping_pars_fragment:cB,transmission_fragment:lB,transmission_pars_fragment:uB,uv_pars_fragment:dB,uv_pars_vertex:hB,uv_vertex:fB,worldpos_vertex:pB,background_vert:mB,background_frag:gB,backgroundCube_vert:_B,backgroundCube_frag:vB,cube_vert:bB,cube_frag:yB,depth_vert:TB,depth_frag:SB,distanceRGBA_vert:EB,distanceRGBA_frag:AB,equirect_vert:CB,equirect_frag:wB,linedashed_vert:RB,linedashed_frag:kB,meshbasic_vert:MB,meshbasic_frag:xB,meshlambert_vert:IB,meshlambert_frag:PB,meshmatcap_vert:NB,meshmatcap_frag:DB,meshnormal_vert:LB,meshnormal_frag:OB,meshphong_vert:UB,meshphong_frag:FB,meshphysical_vert:BB,meshphysical_frag:VB,meshtoon_vert:GB,meshtoon_frag:zB,points_vert:HB,points_frag:WB,shadow_vert:jB,shadow_frag:KB,sprite_vert:qB,sprite_frag:XB},Ke={common:{diffuse:{value:new Rt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Pt},alphaMap:{value:null},alphaMapTransform:{value:new Pt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Pt}},envmap:{envMap:{value:null},envMapRotation:{value:new Pt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Pt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Pt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Pt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Pt},normalScale:{value:new Xt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Pt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Pt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Pt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Pt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Rt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Rt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Pt},alphaTest:{value:0},uvTransform:{value:new Pt}},sprite:{diffuse:{value:new Rt(16777215)},opacity:{value:1},center:{value:new Xt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Pt},alphaMap:{value:null},alphaMapTransform:{value:new Pt},alphaTest:{value:0}}},xs={basic:{uniforms:yi([Ke.common,Ke.specularmap,Ke.envmap,Ke.aomap,Ke.lightmap,Ke.fog]),vertexShader:It.meshbasic_vert,fragmentShader:It.meshbasic_frag},lambert:{uniforms:yi([Ke.common,Ke.specularmap,Ke.envmap,Ke.aomap,Ke.lightmap,Ke.emissivemap,Ke.bumpmap,Ke.normalmap,Ke.displacementmap,Ke.fog,Ke.lights,{emissive:{value:new Rt(0)}}]),vertexShader:It.meshlambert_vert,fragmentShader:It.meshlambert_frag},phong:{uniforms:yi([Ke.common,Ke.specularmap,Ke.envmap,Ke.aomap,Ke.lightmap,Ke.emissivemap,Ke.bumpmap,Ke.normalmap,Ke.displacementmap,Ke.fog,Ke.lights,{emissive:{value:new Rt(0)},specular:{value:new Rt(1118481)},shininess:{value:30}}]),vertexShader:It.meshphong_vert,fragmentShader:It.meshphong_frag},standard:{uniforms:yi([Ke.common,Ke.envmap,Ke.aomap,Ke.lightmap,Ke.emissivemap,Ke.bumpmap,Ke.normalmap,Ke.displacementmap,Ke.roughnessmap,Ke.metalnessmap,Ke.fog,Ke.lights,{emissive:{value:new Rt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:It.meshphysical_vert,fragmentShader:It.meshphysical_frag},toon:{uniforms:yi([Ke.common,Ke.aomap,Ke.lightmap,Ke.emissivemap,Ke.bumpmap,Ke.normalmap,Ke.displacementmap,Ke.gradientmap,Ke.fog,Ke.lights,{emissive:{value:new Rt(0)}}]),vertexShader:It.meshtoon_vert,fragmentShader:It.meshtoon_frag},matcap:{uniforms:yi([Ke.common,Ke.bumpmap,Ke.normalmap,Ke.displacementmap,Ke.fog,{matcap:{value:null}}]),vertexShader:It.meshmatcap_vert,fragmentShader:It.meshmatcap_frag},points:{uniforms:yi([Ke.points,Ke.fog]),vertexShader:It.points_vert,fragmentShader:It.points_frag},dashed:{uniforms:yi([Ke.common,Ke.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:It.linedashed_vert,fragmentShader:It.linedashed_frag},depth:{uniforms:yi([Ke.common,Ke.displacementmap]),vertexShader:It.depth_vert,fragmentShader:It.depth_frag},normal:{uniforms:yi([Ke.common,Ke.bumpmap,Ke.normalmap,Ke.displacementmap,{opacity:{value:1}}]),vertexShader:It.meshnormal_vert,fragmentShader:It.meshnormal_frag},sprite:{uniforms:yi([Ke.sprite,Ke.fog]),vertexShader:It.sprite_vert,fragmentShader:It.sprite_frag},background:{uniforms:{uvTransform:{value:new Pt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:It.background_vert,fragmentShader:It.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Pt}},vertexShader:It.backgroundCube_vert,fragmentShader:It.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:It.cube_vert,fragmentShader:It.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:It.equirect_vert,fragmentShader:It.equirect_frag},distanceRGBA:{uniforms:yi([Ke.common,Ke.displacementmap,{referencePosition:{value:new Z},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:It.distanceRGBA_vert,fragmentShader:It.distanceRGBA_frag},shadow:{uniforms:yi([Ke.lights,Ke.fog,{color:{value:new Rt(0)},opacity:{value:1}}]),vertexShader:It.shadow_vert,fragmentShader:It.shadow_frag}};xs.physical={uniforms:yi([xs.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Pt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Pt},clearcoatNormalScale:{value:new Xt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Pt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Pt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Pt},sheen:{value:0},sheenColor:{value:new Rt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Pt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Pt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Pt},transmissionSamplerSize:{value:new Xt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Pt},attenuationDistance:{value:0},attenuationColor:{value:new Rt(0)},specularColor:{value:new Rt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Pt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Pt},anisotropyVector:{value:new Xt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Pt}}]),vertexShader:It.meshphysical_vert,fragmentShader:It.meshphysical_frag};const Kl={r:0,b:0,g:0},da=new Us,YB=new xt;function JB(n,e,t,i,s,r,a){const o=new Rt(0);let l=r===!0?0:1,c,u,d=null,h=0,f=null;function g(y){let b=y.isScene===!0?y.background:null;return b&&b.isTexture&&(b=(y.backgroundBlurriness>0?t:e).get(b)),b}function v(y){let b=!1;const p=g(y);p===null?_(o,l):p&&p.isColor&&(_(p,1),b=!0);const w=n.xr.getEnvironmentBlendMode();w==="additive"?i.buffers.color.setClear(0,0,0,1,a):w==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,a),(n.autoClear||b)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function m(y,b){const p=g(b);p&&(p.isCubeTexture||p.mapping===Ld)?(u===void 0&&(u=new Wi(new hl(1,1,1),new _r({name:"BackgroundCubeMaterial",uniforms:Ko(xs.backgroundCube.uniforms),vertexShader:xs.backgroundCube.vertexShader,fragmentShader:xs.backgroundCube.fragmentShader,side:Pi,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(w,E,C){this.matrixWorld.copyPosition(C.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(u)),da.copy(b.backgroundRotation),da.x*=-1,da.y*=-1,da.z*=-1,p.isCubeTexture&&p.isRenderTargetTexture===!1&&(da.y*=-1,da.z*=-1),u.material.uniforms.envMap.value=p,u.material.uniforms.flipEnvMap.value=p.isCubeTexture&&p.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=b.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=b.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(YB.makeRotationFromEuler(da)),u.material.toneMapped=en.getTransfer(p.colorSpace)!==Rn,(d!==p||h!==p.version||f!==n.toneMapping)&&(u.material.needsUpdate=!0,d=p,h=p.version,f=n.toneMapping),u.layers.enableAll(),y.unshift(u,u.geometry,u.material,0,0,null)):p&&p.isTexture&&(c===void 0&&(c=new Wi(new Fd(2,2),new _r({name:"BackgroundMaterial",uniforms:Ko(xs.background.uniforms),vertexShader:xs.background.vertexShader,fragmentShader:xs.background.fragmentShader,side:mr,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(c)),c.material.uniforms.t2D.value=p,c.material.uniforms.backgroundIntensity.value=b.backgroundIntensity,c.material.toneMapped=en.getTransfer(p.colorSpace)!==Rn,p.matrixAutoUpdate===!0&&p.updateMatrix(),c.material.uniforms.uvTransform.value.copy(p.matrix),(d!==p||h!==p.version||f!==n.toneMapping)&&(c.material.needsUpdate=!0,d=p,h=p.version,f=n.toneMapping),c.layers.enableAll(),y.unshift(c,c.geometry,c.material,0,0,null))}function _(y,b){y.getRGB(Kl,EA(n)),i.buffers.color.setClear(Kl.r,Kl.g,Kl.b,b,a)}return{getClearColor:function(){return o},setClearColor:function(y,b=1){o.set(y),l=b,_(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(y){l=y,_(o,l)},render:v,addToRenderList:m}}function QB(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),i={},s=h(null);let r=s,a=!1;function o(T,R,V,H,B){let te=!1;const j=d(H,V,R);r!==j&&(r=j,c(r.object)),te=f(T,H,V,B),te&&g(T,H,V,B),B!==null&&e.update(B,n.ELEMENT_ARRAY_BUFFER),(te||a)&&(a=!1,p(T,R,V,H),B!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(B).buffer))}function l(){return n.createVertexArray()}function c(T){return n.bindVertexArray(T)}function u(T){return n.deleteVertexArray(T)}function d(T,R,V){const H=V.wireframe===!0;let B=i[T.id];B===void 0&&(B={},i[T.id]=B);let te=B[R.id];te===void 0&&(te={},B[R.id]=te);let j=te[H];return j===void 0&&(j=h(l()),te[H]=j),j}function h(T){const R=[],V=[],H=[];for(let B=0;B<t;B++)R[B]=0,V[B]=0,H[B]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:R,enabledAttributes:V,attributeDivisors:H,object:T,attributes:{},index:null}}function f(T,R,V,H){const B=r.attributes,te=R.attributes;let j=0;const oe=V.getAttributes();for(const z in oe)if(oe[z].location>=0){const ie=B[z];let se=te[z];if(se===void 0&&(z==="instanceMatrix"&&T.instanceMatrix&&(se=T.instanceMatrix),z==="instanceColor"&&T.instanceColor&&(se=T.instanceColor)),ie===void 0||ie.attribute!==se||se&&ie.data!==se.data)return!0;j++}return r.attributesNum!==j||r.index!==H}function g(T,R,V,H){const B={},te=R.attributes;let j=0;const oe=V.getAttributes();for(const z in oe)if(oe[z].location>=0){let ie=te[z];ie===void 0&&(z==="instanceMatrix"&&T.instanceMatrix&&(ie=T.instanceMatrix),z==="instanceColor"&&T.instanceColor&&(ie=T.instanceColor));const se={};se.attribute=ie,ie&&ie.data&&(se.data=ie.data),B[z]=se,j++}r.attributes=B,r.attributesNum=j,r.index=H}function v(){const T=r.newAttributes;for(let R=0,V=T.length;R<V;R++)T[R]=0}function m(T){_(T,0)}function _(T,R){const V=r.newAttributes,H=r.enabledAttributes,B=r.attributeDivisors;V[T]=1,H[T]===0&&(n.enableVertexAttribArray(T),H[T]=1),B[T]!==R&&(n.vertexAttribDivisor(T,R),B[T]=R)}function y(){const T=r.newAttributes,R=r.enabledAttributes;for(let V=0,H=R.length;V<H;V++)R[V]!==T[V]&&(n.disableVertexAttribArray(V),R[V]=0)}function b(T,R,V,H,B,te,j){j===!0?n.vertexAttribIPointer(T,R,V,B,te):n.vertexAttribPointer(T,R,V,H,B,te)}function p(T,R,V,H){v();const B=H.attributes,te=V.getAttributes(),j=R.defaultAttributeValues;for(const oe in te){const z=te[oe];if(z.location>=0){let W=B[oe];if(W===void 0&&(oe==="instanceMatrix"&&T.instanceMatrix&&(W=T.instanceMatrix),oe==="instanceColor"&&T.instanceColor&&(W=T.instanceColor)),W!==void 0){const ie=W.normalized,se=W.itemSize,je=e.get(W);if(je===void 0)continue;const ge=je.buffer,L=je.type,J=je.bytesPerElement,U=L===n.INT||L===n.UNSIGNED_INT||W.gpuType===Xg;if(W.isInterleavedBufferAttribute){const de=W.data,et=de.stride,Ue=W.offset;if(de.isInstancedInterleavedBuffer){for(let dt=0;dt<z.locationSize;dt++)_(z.location+dt,de.meshPerAttribute);T.isInstancedMesh!==!0&&H._maxInstanceCount===void 0&&(H._maxInstanceCount=de.meshPerAttribute*de.count)}else for(let dt=0;dt<z.locationSize;dt++)m(z.location+dt);n.bindBuffer(n.ARRAY_BUFFER,ge);for(let dt=0;dt<z.locationSize;dt++)b(z.location+dt,se/z.locationSize,L,ie,et*J,(Ue+se/z.locationSize*dt)*J,U)}else{if(W.isInstancedBufferAttribute){for(let de=0;de<z.locationSize;de++)_(z.location+de,W.meshPerAttribute);T.isInstancedMesh!==!0&&H._maxInstanceCount===void 0&&(H._maxInstanceCount=W.meshPerAttribute*W.count)}else for(let de=0;de<z.locationSize;de++)m(z.location+de);n.bindBuffer(n.ARRAY_BUFFER,ge);for(let de=0;de<z.locationSize;de++)b(z.location+de,se/z.locationSize,L,ie,se*J,se/z.locationSize*de*J,U)}}else if(j!==void 0){const ie=j[oe];if(ie!==void 0)switch(ie.length){case 2:n.vertexAttrib2fv(z.location,ie);break;case 3:n.vertexAttrib3fv(z.location,ie);break;case 4:n.vertexAttrib4fv(z.location,ie);break;default:n.vertexAttrib1fv(z.location,ie)}}}}y()}function w(){M();for(const T in i){const R=i[T];for(const V in R){const H=R[V];for(const B in H)u(H[B].object),delete H[B];delete R[V]}delete i[T]}}function E(T){if(i[T.id]===void 0)return;const R=i[T.id];for(const V in R){const H=R[V];for(const B in H)u(H[B].object),delete H[B];delete R[V]}delete i[T.id]}function C(T){for(const R in i){const V=i[R];if(V[T.id]===void 0)continue;const H=V[T.id];for(const B in H)u(H[B].object),delete H[B];delete V[T.id]}}function M(){I(),a=!0,r!==s&&(r=s,c(r.object))}function I(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:o,reset:M,resetDefaultState:I,dispose:w,releaseStatesOfGeometry:E,releaseStatesOfProgram:C,initAttributes:v,enableAttribute:m,disableUnusedAttributes:y}}function ZB(n,e,t){let i;function s(c){i=c}function r(c,u){n.drawArrays(i,c,u),t.update(u,i,1)}function a(c,u,d){d!==0&&(n.drawArraysInstanced(i,c,u,d),t.update(u,i,d))}function o(c,u,d){if(d===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,c,0,u,0,d);let f=0;for(let g=0;g<d;g++)f+=u[g];t.update(f,i,1)}function l(c,u,d,h){if(d===0)return;const f=e.get("WEBGL_multi_draw");if(f===null)for(let g=0;g<c.length;g++)a(c[g],u[g],h[g]);else{f.multiDrawArraysInstancedWEBGL(i,c,0,u,0,h,0,d);let g=0;for(let v=0;v<d;v++)g+=u[v];for(let v=0;v<h.length;v++)t.update(g,i,h[v])}}this.setMode=s,this.render=r,this.renderInstances=a,this.renderMultiDraw=o,this.renderMultiDrawInstances=l}function $B(n,e,t,i){let s;function r(){if(s!==void 0)return s;if(e.has("EXT_texture_filter_anisotropic")===!0){const C=e.get("EXT_texture_filter_anisotropic");s=n.getParameter(C.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s}function a(C){return!(C!==$i&&i.convert(C)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function o(C){const M=C===dl&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(C!==gr&&i.convert(C)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&C!==vs&&!M)}function l(C){if(C==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";C="mediump"}return C==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=t.precision!==void 0?t.precision:"highp";const u=l(c);u!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",u,"instead."),c=u);const d=t.logarithmicDepthBuffer===!0,h=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control");if(h===!0){const C=e.get("EXT_clip_control");C.clipControlEXT(C.LOWER_LEFT_EXT,C.ZERO_TO_ONE_EXT)}const f=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),g=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),v=n.getParameter(n.MAX_TEXTURE_SIZE),m=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),_=n.getParameter(n.MAX_VERTEX_ATTRIBS),y=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),b=n.getParameter(n.MAX_VARYING_VECTORS),p=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),w=g>0,E=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:r,getMaxPrecision:l,textureFormatReadable:a,textureTypeReadable:o,precision:c,logarithmicDepthBuffer:d,reverseDepthBuffer:h,maxTextures:f,maxVertexTextures:g,maxTextureSize:v,maxCubemapSize:m,maxAttributes:_,maxVertexUniforms:y,maxVaryings:b,maxFragmentUniforms:p,vertexTextures:w,maxSamples:E}}function e6(n){const e=this;let t=null,i=0,s=!1,r=!1;const a=new _a,o=new Pt,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,h){const f=d.length!==0||h||i!==0||s;return s=h,i=d.length,f},this.beginShadows=function(){r=!0,u(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(d,h){t=u(d,h,0)},this.setState=function(d,h,f){const g=d.clippingPlanes,v=d.clipIntersection,m=d.clipShadows,_=n.get(d);if(!s||g===null||g.length===0||r&&!m)r?u(null):c();else{const y=r?0:i,b=y*4;let p=_.clippingState||null;l.value=p,p=u(g,h,b,f);for(let w=0;w!==b;++w)p[w]=t[w];_.clippingState=p,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=y}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function u(d,h,f,g){const v=d!==null?d.length:0;let m=null;if(v!==0){if(m=l.value,g!==!0||m===null){const _=f+v*4,y=h.matrixWorldInverse;o.getNormalMatrix(y),(m===null||m.length<_)&&(m=new Float32Array(_));for(let b=0,p=f;b!==v;++b,p+=4)a.copy(d[b]).applyMatrix4(y,o),a.normal.toArray(m,p),m[p+3]=a.constant}l.value=m,l.needsUpdate=!0}return e.numPlanes=v,e.numIntersection=0,m}}function t6(n){let e=new WeakMap;function t(a,o){return o===sd?a.mapping=Vo:o===gm&&(a.mapping=Go),a}function i(a){if(a&&a.isTexture){const o=a.mapping;if(o===sd||o===gm)if(e.has(a)){const l=e.get(a).texture;return t(l,a.mapping)}else{const l=a.image;if(l&&l.height>0){const c=new h5(l.height);return c.fromEquirectangularTexture(n,a),e.set(a,c),a.addEventListener("dispose",s),t(c.texture,a.mapping)}else return null}}return a}function s(a){const o=a.target;o.removeEventListener("dispose",s);const l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function r(){e=new WeakMap}return{get:i,dispose:r}}class s0 extends AA{constructor(e=-1,t=1,i=1,s=-1,r=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=s,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,s,r,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=i-e,a=i+e,o=s+t,l=s-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,a=r+c*this.view.width,o-=u*this.view.offsetY,l=o-u*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const vo=4,c1=[.125,.215,.35,.446,.526,.582],ya=20,Gf=new s0,l1=new Rt;let zf=null,Hf=0,Wf=0,jf=!1;const va=(1+Math.sqrt(5))/2,co=1/va,u1=[new Z(-va,co,0),new Z(va,co,0),new Z(-co,0,va),new Z(co,0,va),new Z(0,va,-co),new Z(0,va,co),new Z(-1,1,-1),new Z(1,1,-1),new Z(-1,1,1),new Z(1,1,1)];class d1{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,s=100){zf=this._renderer.getRenderTarget(),Hf=this._renderer.getActiveCubeFace(),Wf=this._renderer.getActiveMipmapLevel(),jf=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,i,s,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=p1(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=f1(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(zf,Hf,Wf),this._renderer.xr.enabled=jf,e.scissorTest=!1,ql(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Vo||e.mapping===Go?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),zf=this._renderer.getRenderTarget(),Hf=this._renderer.getActiveCubeFace(),Wf=this._renderer.getActiveMipmapLevel(),jf=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Gi,minFilter:Gi,generateMipmaps:!1,type:dl,format:$i,colorSpace:di,depthBuffer:!1},s=h1(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=h1(e,t,i);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=n6(r)),this._blurMaterial=i6(r,e,t)}return s}_compileMaterial(e){const t=new Wi(this._lodPlanes[0],e);this._renderer.compile(t,Gf)}_sceneToCubeUV(e,t,i,s){const o=new Ei(90,1,t,i),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,d=u.autoClear,h=u.toneMapping;u.getClearColor(l1),u.toneMapping=Xr,u.autoClear=!1;const f=new Ta({name:"PMREM.Background",side:Pi,depthWrite:!1,depthTest:!1}),g=new Wi(new hl,f);let v=!1;const m=e.background;m?m.isColor&&(f.color.copy(m),e.background=null,v=!0):(f.color.copy(l1),v=!0);for(let _=0;_<6;_++){const y=_%3;y===0?(o.up.set(0,l[_],0),o.lookAt(c[_],0,0)):y===1?(o.up.set(0,0,l[_]),o.lookAt(0,c[_],0)):(o.up.set(0,l[_],0),o.lookAt(0,0,c[_]));const b=this._cubeSize;ql(s,y*b,_>2?b:0,b,b),u.setRenderTarget(s),v&&u.render(g,o),u.render(e,o)}g.geometry.dispose(),g.material.dispose(),u.toneMapping=h,u.autoClear=d,e.background=m}_textureToCubeUV(e,t){const i=this._renderer,s=e.mapping===Vo||e.mapping===Go;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=p1()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=f1());const r=s?this._cubemapMaterial:this._equirectMaterial,a=new Wi(this._lodPlanes[0],r),o=r.uniforms;o.envMap.value=e;const l=this._cubeSize;ql(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(a,Gf)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const s=this._lodPlanes.length;for(let r=1;r<s;r++){const a=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),o=u1[(s-r-1)%u1.length];this._blur(e,r-1,r,a,o)}t.autoClear=i}_blur(e,t,i,s,r){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,i,s,"latitudinal",r),this._halfBlur(a,e,i,i,s,"longitudinal",r)}_halfBlur(e,t,i,s,r,a,o){const l=this._renderer,c=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,d=new Wi(this._lodPlanes[s],c),h=c.uniforms,f=this._sizeLods[i]-1,g=isFinite(r)?Math.PI/(2*f):2*Math.PI/(2*ya-1),v=r/g,m=isFinite(r)?1+Math.floor(u*v):ya;m>ya&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${m} samples when the maximum is set to ${ya}`);const _=[];let y=0;for(let C=0;C<ya;++C){const M=C/v,I=Math.exp(-M*M/2);_.push(I),C===0?y+=I:C<m&&(y+=2*I)}for(let C=0;C<_.length;C++)_[C]=_[C]/y;h.envMap.value=e.texture,h.samples.value=m,h.weights.value=_,h.latitudinal.value=a==="latitudinal",o&&(h.poleAxis.value=o);const{_lodMax:b}=this;h.dTheta.value=g,h.mipInt.value=b-i;const p=this._sizeLods[s],w=3*p*(s>b-vo?s-b+vo:0),E=4*(this._cubeSize-p);ql(t,w,E,3*p,2*p),l.setRenderTarget(t),l.render(d,Gf)}}function n6(n){const e=[],t=[],i=[];let s=n;const r=n-vo+1+c1.length;for(let a=0;a<r;a++){const o=Math.pow(2,s);t.push(o);let l=1/o;a>n-vo?l=c1[a-n+vo-1]:a===0&&(l=0),i.push(l);const c=1/(o-2),u=-c,d=1+c,h=[u,u,d,u,d,d,u,u,d,d,u,d],f=6,g=6,v=3,m=2,_=1,y=new Float32Array(v*g*f),b=new Float32Array(m*g*f),p=new Float32Array(_*g*f);for(let E=0;E<f;E++){const C=E%3*2/3-1,M=E>2?0:-1,I=[C,M,0,C+2/3,M,0,C+2/3,M+1,0,C,M,0,C+2/3,M+1,0,C,M+1,0];y.set(I,v*g*E),b.set(h,m*g*E);const T=[E,E,E,E,E,E];p.set(T,_*g*E)}const w=new Es;w.setAttribute("position",new Ci(y,v)),w.setAttribute("uv",new Ci(b,m)),w.setAttribute("faceIndex",new Ci(p,_)),e.push(w),s>vo&&s--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function h1(n,e,t){const i=new Na(n,e,t);return i.texture.mapping=Ld,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function ql(n,e,t,i,s){n.viewport.set(e,t,i,s),n.scissor.set(e,t,i,s)}function i6(n,e,t){const i=new Float32Array(ya),s=new Z(0,1,0);return new _r({name:"SphericalGaussianBlur",defines:{n:ya,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:r0(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:qr,depthTest:!1,depthWrite:!1})}function f1(){return new _r({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:r0(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:qr,depthTest:!1,depthWrite:!1})}function p1(){return new _r({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:r0(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:qr,depthTest:!1,depthWrite:!1})}function r0(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function s6(n){let e=new WeakMap,t=null;function i(o){if(o&&o.isTexture){const l=o.mapping,c=l===sd||l===gm,u=l===Vo||l===Go;if(c||u){let d=e.get(o);const h=d!==void 0?d.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==h)return t===null&&(t=new d1(n)),d=c?t.fromEquirectangular(o,d):t.fromCubemap(o,d),d.texture.pmremVersion=o.pmremVersion,e.set(o,d),d.texture;if(d!==void 0)return d.texture;{const f=o.image;return c&&f&&f.height>0||u&&f&&s(f)?(t===null&&(t=new d1(n)),d=c?t.fromEquirectangular(o):t.fromCubemap(o),d.texture.pmremVersion=o.pmremVersion,e.set(o,d),o.addEventListener("dispose",r),d.texture):null}}}return o}function s(o){let l=0;const c=6;for(let u=0;u<c;u++)o[u]!==void 0&&l++;return l===c}function r(o){const l=o.target;l.removeEventListener("dispose",r);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function a(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:a}}function r6(n){const e={};function t(i){if(e[i]!==void 0)return e[i];let s;switch(i){case"WEBGL_depth_texture":s=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=n.getExtension(i)}return e[i]=s,s}return{has:function(i){return t(i)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const s=t(i);return s===null&&Uu("THREE.WebGLRenderer: "+i+" extension not supported."),s}}}function a6(n,e,t,i){const s={},r=new WeakMap;function a(d){const h=d.target;h.index!==null&&e.remove(h.index);for(const g in h.attributes)e.remove(h.attributes[g]);for(const g in h.morphAttributes){const v=h.morphAttributes[g];for(let m=0,_=v.length;m<_;m++)e.remove(v[m])}h.removeEventListener("dispose",a),delete s[h.id];const f=r.get(h);f&&(e.remove(f),r.delete(h)),i.releaseStatesOfGeometry(h),h.isInstancedBufferGeometry===!0&&delete h._maxInstanceCount,t.memory.geometries--}function o(d,h){return s[h.id]===!0||(h.addEventListener("dispose",a),s[h.id]=!0,t.memory.geometries++),h}function l(d){const h=d.attributes;for(const g in h)e.update(h[g],n.ARRAY_BUFFER);const f=d.morphAttributes;for(const g in f){const v=f[g];for(let m=0,_=v.length;m<_;m++)e.update(v[m],n.ARRAY_BUFFER)}}function c(d){const h=[],f=d.index,g=d.attributes.position;let v=0;if(f!==null){const y=f.array;v=f.version;for(let b=0,p=y.length;b<p;b+=3){const w=y[b+0],E=y[b+1],C=y[b+2];h.push(w,E,E,C,C,w)}}else if(g!==void 0){const y=g.array;v=g.version;for(let b=0,p=y.length/3-1;b<p;b+=3){const w=b+0,E=b+1,C=b+2;h.push(w,E,E,C,C,w)}}else return;const m=new(gA(h)?SA:TA)(h,1);m.version=v;const _=r.get(d);_&&e.remove(_),r.set(d,m)}function u(d){const h=r.get(d);if(h){const f=d.index;f!==null&&h.version<f.version&&c(d)}else c(d);return r.get(d)}return{get:o,update:l,getWireframeAttribute:u}}function o6(n,e,t){let i;function s(h){i=h}let r,a;function o(h){r=h.type,a=h.bytesPerElement}function l(h,f){n.drawElements(i,f,r,h*a),t.update(f,i,1)}function c(h,f,g){g!==0&&(n.drawElementsInstanced(i,f,r,h*a,g),t.update(f,i,g))}function u(h,f,g){if(g===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,f,0,r,h,0,g);let m=0;for(let _=0;_<g;_++)m+=f[_];t.update(m,i,1)}function d(h,f,g,v){if(g===0)return;const m=e.get("WEBGL_multi_draw");if(m===null)for(let _=0;_<h.length;_++)c(h[_]/a,f[_],v[_]);else{m.multiDrawElementsInstancedWEBGL(i,f,0,r,h,0,v,0,g);let _=0;for(let y=0;y<g;y++)_+=f[y];for(let y=0;y<v.length;y++)t.update(_,i,v[y])}}this.setMode=s,this.setIndex=o,this.render=l,this.renderInstances=c,this.renderMultiDraw=u,this.renderMultiDrawInstances=d}function c6(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(r,a,o){switch(t.calls++,a){case n.TRIANGLES:t.triangles+=o*(r/3);break;case n.LINES:t.lines+=o*(r/2);break;case n.LINE_STRIP:t.lines+=o*(r-1);break;case n.LINE_LOOP:t.lines+=o*r;break;case n.POINTS:t.points+=o*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function s(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:s,update:i}}function l6(n,e,t){const i=new WeakMap,s=new rn;function r(a,o,l){const c=a.morphTargetInfluences,u=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,d=u!==void 0?u.length:0;let h=i.get(o);if(h===void 0||h.count!==d){let I=function(){C.dispose(),i.delete(o),o.removeEventListener("dispose",I)};h!==void 0&&h.texture.dispose();const f=o.morphAttributes.position!==void 0,g=o.morphAttributes.normal!==void 0,v=o.morphAttributes.color!==void 0,m=o.morphAttributes.position||[],_=o.morphAttributes.normal||[],y=o.morphAttributes.color||[];let b=0;f===!0&&(b=1),g===!0&&(b=2),v===!0&&(b=3);let p=o.attributes.position.count*b,w=1;p>e.maxTextureSize&&(w=Math.ceil(p/e.maxTextureSize),p=e.maxTextureSize);const E=new Float32Array(p*w*4*d),C=new vA(E,p,w,d);C.type=vs,C.needsUpdate=!0;const M=b*4;for(let T=0;T<d;T++){const R=m[T],V=_[T],H=y[T],B=p*w*4*T;for(let te=0;te<R.count;te++){const j=te*M;f===!0&&(s.fromBufferAttribute(R,te),E[B+j+0]=s.x,E[B+j+1]=s.y,E[B+j+2]=s.z,E[B+j+3]=0),g===!0&&(s.fromBufferAttribute(V,te),E[B+j+4]=s.x,E[B+j+5]=s.y,E[B+j+6]=s.z,E[B+j+7]=0),v===!0&&(s.fromBufferAttribute(H,te),E[B+j+8]=s.x,E[B+j+9]=s.y,E[B+j+10]=s.z,E[B+j+11]=H.itemSize===4?s.w:1)}}h={count:d,texture:C,size:new Xt(p,w)},i.set(o,h),o.addEventListener("dispose",I)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)l.getUniforms().setValue(n,"morphTexture",a.morphTexture,t);else{let f=0;for(let v=0;v<c.length;v++)f+=c[v];const g=o.morphTargetsRelative?1:1-f;l.getUniforms().setValue(n,"morphTargetBaseInfluence",g),l.getUniforms().setValue(n,"morphTargetInfluences",c)}l.getUniforms().setValue(n,"morphTargetsTexture",h.texture,t),l.getUniforms().setValue(n,"morphTargetsTextureSize",h.size)}return{update:r}}function u6(n,e,t,i){let s=new WeakMap;function r(l){const c=i.render.frame,u=l.geometry,d=e.get(l,u);if(s.get(d)!==c&&(e.update(d),s.set(d,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),s.get(l)!==c&&(t.update(l.instanceMatrix,n.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,n.ARRAY_BUFFER),s.set(l,c))),l.isSkinnedMesh){const h=l.skeleton;s.get(h)!==c&&(h.update(),s.set(h,c))}return d}function a(){s=new WeakMap}function o(l){const c=l.target;c.removeEventListener("dispose",o),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:r,dispose:a}}class RA extends ni{constructor(e,t,i,s,r,a,o,l,c,u=Mo){if(u!==Mo&&u!==Wo)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&u===Mo&&(i=Pa),i===void 0&&u===Wo&&(i=Ho),super(null,s,r,a,o,l,u,i,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=o!==void 0?o:Ai,this.minFilter=l!==void 0?l:Ai,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const kA=new ni,m1=new RA(1,1),MA=new vA,xA=new JU,IA=new CA,g1=[],_1=[],v1=new Float32Array(16),b1=new Float32Array(9),y1=new Float32Array(4);function $o(n,e,t){const i=n[0];if(i<=0||i>0)return n;const s=e*t;let r=g1[s];if(r===void 0&&(r=new Float32Array(s),g1[s]=r),e!==0){i.toArray(r,0);for(let a=1,o=0;a!==e;++a)o+=t,n[a].toArray(r,o)}return r}function Yn(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function Jn(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function Bd(n,e){let t=_1[e];t===void 0&&(t=new Int32Array(e),_1[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function d6(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function h6(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Yn(t,e))return;n.uniform2fv(this.addr,e),Jn(t,e)}}function f6(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Yn(t,e))return;n.uniform3fv(this.addr,e),Jn(t,e)}}function p6(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Yn(t,e))return;n.uniform4fv(this.addr,e),Jn(t,e)}}function m6(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Yn(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Jn(t,e)}else{if(Yn(t,i))return;y1.set(i),n.uniformMatrix2fv(this.addr,!1,y1),Jn(t,i)}}function g6(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Yn(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Jn(t,e)}else{if(Yn(t,i))return;b1.set(i),n.uniformMatrix3fv(this.addr,!1,b1),Jn(t,i)}}function _6(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Yn(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Jn(t,e)}else{if(Yn(t,i))return;v1.set(i),n.uniformMatrix4fv(this.addr,!1,v1),Jn(t,i)}}function v6(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function b6(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Yn(t,e))return;n.uniform2iv(this.addr,e),Jn(t,e)}}function y6(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Yn(t,e))return;n.uniform3iv(this.addr,e),Jn(t,e)}}function T6(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Yn(t,e))return;n.uniform4iv(this.addr,e),Jn(t,e)}}function S6(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function E6(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Yn(t,e))return;n.uniform2uiv(this.addr,e),Jn(t,e)}}function A6(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Yn(t,e))return;n.uniform3uiv(this.addr,e),Jn(t,e)}}function C6(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Yn(t,e))return;n.uniform4uiv(this.addr,e),Jn(t,e)}}function w6(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s);let r;this.type===n.SAMPLER_2D_SHADOW?(m1.compareFunction=mA,r=m1):r=kA,t.setTexture2D(e||r,s)}function R6(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTexture3D(e||xA,s)}function k6(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTextureCube(e||IA,s)}function M6(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTexture2DArray(e||MA,s)}function x6(n){switch(n){case 5126:return d6;case 35664:return h6;case 35665:return f6;case 35666:return p6;case 35674:return m6;case 35675:return g6;case 35676:return _6;case 5124:case 35670:return v6;case 35667:case 35671:return b6;case 35668:case 35672:return y6;case 35669:case 35673:return T6;case 5125:return S6;case 36294:return E6;case 36295:return A6;case 36296:return C6;case 35678:case 36198:case 36298:case 36306:case 35682:return w6;case 35679:case 36299:case 36307:return R6;case 35680:case 36300:case 36308:case 36293:return k6;case 36289:case 36303:case 36311:case 36292:return M6}}function I6(n,e){n.uniform1fv(this.addr,e)}function P6(n,e){const t=$o(e,this.size,2);n.uniform2fv(this.addr,t)}function N6(n,e){const t=$o(e,this.size,3);n.uniform3fv(this.addr,t)}function D6(n,e){const t=$o(e,this.size,4);n.uniform4fv(this.addr,t)}function L6(n,e){const t=$o(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function O6(n,e){const t=$o(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function U6(n,e){const t=$o(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function F6(n,e){n.uniform1iv(this.addr,e)}function B6(n,e){n.uniform2iv(this.addr,e)}function V6(n,e){n.uniform3iv(this.addr,e)}function G6(n,e){n.uniform4iv(this.addr,e)}function z6(n,e){n.uniform1uiv(this.addr,e)}function H6(n,e){n.uniform2uiv(this.addr,e)}function W6(n,e){n.uniform3uiv(this.addr,e)}function j6(n,e){n.uniform4uiv(this.addr,e)}function K6(n,e,t){const i=this.cache,s=e.length,r=Bd(t,s);Yn(i,r)||(n.uniform1iv(this.addr,r),Jn(i,r));for(let a=0;a!==s;++a)t.setTexture2D(e[a]||kA,r[a])}function q6(n,e,t){const i=this.cache,s=e.length,r=Bd(t,s);Yn(i,r)||(n.uniform1iv(this.addr,r),Jn(i,r));for(let a=0;a!==s;++a)t.setTexture3D(e[a]||xA,r[a])}function X6(n,e,t){const i=this.cache,s=e.length,r=Bd(t,s);Yn(i,r)||(n.uniform1iv(this.addr,r),Jn(i,r));for(let a=0;a!==s;++a)t.setTextureCube(e[a]||IA,r[a])}function Y6(n,e,t){const i=this.cache,s=e.length,r=Bd(t,s);Yn(i,r)||(n.uniform1iv(this.addr,r),Jn(i,r));for(let a=0;a!==s;++a)t.setTexture2DArray(e[a]||MA,r[a])}function J6(n){switch(n){case 5126:return I6;case 35664:return P6;case 35665:return N6;case 35666:return D6;case 35674:return L6;case 35675:return O6;case 35676:return U6;case 5124:case 35670:return F6;case 35667:case 35671:return B6;case 35668:case 35672:return V6;case 35669:case 35673:return G6;case 5125:return z6;case 36294:return H6;case 36295:return W6;case 36296:return j6;case 35678:case 36198:case 36298:case 36306:case 35682:return K6;case 35679:case 36299:case 36307:return q6;case 35680:case 36300:case 36308:case 36293:return X6;case 36289:case 36303:case 36311:case 36292:return Y6}}class Q6{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=x6(t.type)}}class Z6{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=J6(t.type)}}class $6{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const s=this.seq;for(let r=0,a=s.length;r!==a;++r){const o=s[r];o.setValue(e,t[o.id],i)}}}const Kf=/(\w+)(\])?(\[|\.)?/g;function T1(n,e){n.seq.push(e),n.map[e.id]=e}function e8(n,e,t){const i=n.name,s=i.length;for(Kf.lastIndex=0;;){const r=Kf.exec(i),a=Kf.lastIndex;let o=r[1];const l=r[2]==="]",c=r[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===s){T1(t,c===void 0?new Q6(o,n,e):new Z6(o,n,e));break}else{let d=t.map[o];d===void 0&&(d=new $6(o),T1(t,d)),t=d}}}class Fu{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<i;++s){const r=e.getActiveUniform(t,s),a=e.getUniformLocation(t,r.name);e8(r,a,this)}}setValue(e,t,i,s){const r=this.map[t];r!==void 0&&r.setValue(e,i,s)}setOptional(e,t,i){const s=t[i];s!==void 0&&this.setValue(e,i,s)}static upload(e,t,i,s){for(let r=0,a=t.length;r!==a;++r){const o=t[r],l=i[o.id];l.needsUpdate!==!1&&o.setValue(e,l.value,s)}}static seqWithValue(e,t){const i=[];for(let s=0,r=e.length;s!==r;++s){const a=e[s];a.id in t&&i.push(a)}return i}}function S1(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}const t8=37297;let n8=0;function i8(n,e){const t=n.split(`
`),i=[],s=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let a=s;a<r;a++){const o=a+1;i.push(`${o===e?">":" "} ${o}: ${t[a]}`)}return i.join(`
`)}function s8(n){const e=en.getPrimaries(en.workingColorSpace),t=en.getPrimaries(n);let i;switch(e===t?i="":e===cd&&t===od?i="LinearDisplayP3ToLinearSRGB":e===od&&t===cd&&(i="LinearSRGBToLinearDisplayP3"),n){case di:case Od:return[i,"LinearTransferOETF"];case Si:case t0:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",n),[i,"LinearTransferOETF"]}}function E1(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),s=n.getShaderInfoLog(e).trim();if(i&&s==="")return"";const r=/ERROR: 0:(\d+)/.exec(s);if(r){const a=parseInt(r[1]);return t.toUpperCase()+`

`+s+`

`+i8(n.getShaderSource(e),a)}else return s}function r8(n,e){const t=s8(e);return`vec4 ${n}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function a8(n,e){let t;switch(e){case sU:t="Linear";break;case rU:t="Reinhard";break;case aU:t="Cineon";break;case oU:t="ACESFilmic";break;case lU:t="AgX";break;case uU:t="Neutral";break;case cU:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const Xl=new Z;function o8(){en.getLuminanceCoefficients(Xl);const n=Xl.x.toFixed(4),e=Xl.y.toFixed(4),t=Xl.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function c8(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Ic).join(`
`)}function l8(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function u8(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){const r=n.getActiveAttrib(e,s),a=r.name;let o=1;r.type===n.FLOAT_MAT2&&(o=2),r.type===n.FLOAT_MAT3&&(o=3),r.type===n.FLOAT_MAT4&&(o=4),t[a]={type:r.type,location:n.getAttribLocation(e,a),locationSize:o}}return t}function Ic(n){return n!==""}function A1(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function C1(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const d8=/^[ \t]*#include +<([\w\d./]+)>/gm;function jm(n){return n.replace(d8,f8)}const h8=new Map;function f8(n,e){let t=It[e];if(t===void 0){const i=h8.get(e);if(i!==void 0)t=It[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return jm(t)}const p8=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function w1(n){return n.replace(p8,m8)}function m8(n,e,t,i){let s="";for(let r=parseInt(e);r<parseInt(t);r++)s+=i.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return s}function R1(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function g8(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===qg?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===U4?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Zs&&(e="SHADOWMAP_TYPE_VSM"),e}function _8(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Vo:case Go:e="ENVMAP_TYPE_CUBE";break;case Ld:e="ENVMAP_TYPE_CUBE_UV";break}return e}function v8(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case Go:e="ENVMAP_MODE_REFRACTION";break}return e}function b8(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case tA:e="ENVMAP_BLENDING_MULTIPLY";break;case nU:e="ENVMAP_BLENDING_MIX";break;case iU:e="ENVMAP_BLENDING_ADD";break}return e}function y8(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function T8(n,e,t,i){const s=n.getContext(),r=t.defines;let a=t.vertexShader,o=t.fragmentShader;const l=g8(t),c=_8(t),u=v8(t),d=b8(t),h=y8(t),f=c8(t),g=l8(r),v=s.createProgram();let m,_,y=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(m=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g].filter(Ic).join(`
`),m.length>0&&(m+=`
`),_=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g].filter(Ic).join(`
`),_.length>0&&(_+=`
`)):(m=[R1(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Ic).join(`
`),_=[R1(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+d:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Xr?"#define TONE_MAPPING":"",t.toneMapping!==Xr?It.tonemapping_pars_fragment:"",t.toneMapping!==Xr?a8("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",It.colorspace_pars_fragment,r8("linearToOutputTexel",t.outputColorSpace),o8(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Ic).join(`
`)),a=jm(a),a=A1(a,t),a=C1(a,t),o=jm(o),o=A1(o,t),o=C1(o,t),a=w1(a),o=w1(o),t.isRawShaderMaterial!==!0&&(y=`#version 300 es
`,m=[f,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,_=["#define varying in",t.glslVersion===Hb?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===Hb?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+_);const b=y+m+a,p=y+_+o,w=S1(s,s.VERTEX_SHADER,b),E=S1(s,s.FRAGMENT_SHADER,p);s.attachShader(v,w),s.attachShader(v,E),t.index0AttributeName!==void 0?s.bindAttribLocation(v,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(v,0,"position"),s.linkProgram(v);function C(R){if(n.debug.checkShaderErrors){const V=s.getProgramInfoLog(v).trim(),H=s.getShaderInfoLog(w).trim(),B=s.getShaderInfoLog(E).trim();let te=!0,j=!0;if(s.getProgramParameter(v,s.LINK_STATUS)===!1)if(te=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(s,v,w,E);else{const oe=E1(s,w,"vertex"),z=E1(s,E,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(v,s.VALIDATE_STATUS)+`

Material Name: `+R.name+`
Material Type: `+R.type+`

Program Info Log: `+V+`
`+oe+`
`+z)}else V!==""?console.warn("THREE.WebGLProgram: Program Info Log:",V):(H===""||B==="")&&(j=!1);j&&(R.diagnostics={runnable:te,programLog:V,vertexShader:{log:H,prefix:m},fragmentShader:{log:B,prefix:_}})}s.deleteShader(w),s.deleteShader(E),M=new Fu(s,v),I=u8(s,v)}let M;this.getUniforms=function(){return M===void 0&&C(this),M};let I;this.getAttributes=function(){return I===void 0&&C(this),I};let T=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return T===!1&&(T=s.getProgramParameter(v,t8)),T},this.destroy=function(){i.releaseStatesOfProgram(this),s.deleteProgram(v),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=n8++,this.cacheKey=e,this.usedTimes=1,this.program=v,this.vertexShader=w,this.fragmentShader=E,this}let S8=0;class E8{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,s=this._getShaderStage(t),r=this._getShaderStage(i),a=this._getShaderCacheForMaterial(e);return a.has(s)===!1&&(a.add(s),s.usedTimes++),a.has(r)===!1&&(a.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new A8(e),t.set(e,i)),i}}class A8{constructor(e){this.id=S8++,this.code=e,this.usedTimes=0}}function C8(n,e,t,i,s,r,a){const o=new bA,l=new E8,c=new Set,u=[],d=s.logarithmicDepthBuffer,h=s.reverseDepthBuffer,f=s.vertexTextures;let g=s.precision;const v={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(T){return c.add(T),T===0?"uv":`uv${T}`}function _(T,R,V,H,B){const te=H.fog,j=B.geometry,oe=T.isMeshStandardMaterial?H.environment:null,z=(T.isMeshStandardMaterial?t:e).get(T.envMap||oe),W=z&&z.mapping===Ld?z.image.height:null,ie=v[T.type];T.precision!==null&&(g=s.getMaxPrecision(T.precision),g!==T.precision&&console.warn("THREE.WebGLProgram.getParameters:",T.precision,"not supported, using",g,"instead."));const se=j.morphAttributes.position||j.morphAttributes.normal||j.morphAttributes.color,je=se!==void 0?se.length:0;let ge=0;j.morphAttributes.position!==void 0&&(ge=1),j.morphAttributes.normal!==void 0&&(ge=2),j.morphAttributes.color!==void 0&&(ge=3);let L,J,U,de;if(ie){const Ri=xs[ie];L=Ri.vertexShader,J=Ri.fragmentShader}else L=T.vertexShader,J=T.fragmentShader,l.update(T),U=l.getVertexShaderID(T),de=l.getFragmentShaderID(T);const et=n.getRenderTarget(),Ue=B.isInstancedMesh===!0,dt=B.isBatchedMesh===!0,_e=!!T.map,we=!!T.matcap,O=!!z,wt=!!T.aoMap,st=!!T.lightMap,Ee=!!T.bumpMap,Fe=!!T.normalMap,He=!!T.displacementMap,rt=!!T.emissiveMap,N=!!T.metalnessMap,A=!!T.roughnessMap,ee=T.anisotropy>0,me=T.clearcoat>0,ve=T.dispersion>0,re=T.iridescence>0,Oe=T.sheen>0,Ge=T.transmission>0,Xe=ee&&!!T.anisotropyMap,Gt=me&&!!T.clearcoatMap,Le=me&&!!T.clearcoatNormalMap,Ye=me&&!!T.clearcoatRoughnessMap,yt=re&&!!T.iridescenceMap,vt=re&&!!T.iridescenceThicknessMap,it=Oe&&!!T.sheenColorMap,jt=Oe&&!!T.sheenRoughnessMap,kt=!!T.specularMap,An=!!T.specularColorMap,Y=!!T.specularIntensityMap,tt=Ge&&!!T.transmissionMap,pe=Ge&&!!T.thicknessMap,Me=!!T.gradientMap,Je=!!T.alphaMap,nt=T.alphaTest>0,Yt=!!T.alphaHash,Wn=!!T.extensions;let wi=Xr;T.toneMapped&&(et===null||et.isXRRenderTarget===!0)&&(wi=n.toneMapping);const tn={shaderID:ie,shaderType:T.type,shaderName:T.name,vertexShader:L,fragmentShader:J,defines:T.defines,customVertexShaderID:U,customFragmentShaderID:de,isRawShaderMaterial:T.isRawShaderMaterial===!0,glslVersion:T.glslVersion,precision:g,batching:dt,batchingColor:dt&&B._colorsTexture!==null,instancing:Ue,instancingColor:Ue&&B.instanceColor!==null,instancingMorph:Ue&&B.morphTexture!==null,supportsVertexTextures:f,outputColorSpace:et===null?n.outputColorSpace:et.isXRRenderTarget===!0?et.texture.colorSpace:di,alphaToCoverage:!!T.alphaToCoverage,map:_e,matcap:we,envMap:O,envMapMode:O&&z.mapping,envMapCubeUVHeight:W,aoMap:wt,lightMap:st,bumpMap:Ee,normalMap:Fe,displacementMap:f&&He,emissiveMap:rt,normalMapObjectSpace:Fe&&T.normalMapType===gU,normalMapTangentSpace:Fe&&T.normalMapType===pA,metalnessMap:N,roughnessMap:A,anisotropy:ee,anisotropyMap:Xe,clearcoat:me,clearcoatMap:Gt,clearcoatNormalMap:Le,clearcoatRoughnessMap:Ye,dispersion:ve,iridescence:re,iridescenceMap:yt,iridescenceThicknessMap:vt,sheen:Oe,sheenColorMap:it,sheenRoughnessMap:jt,specularMap:kt,specularColorMap:An,specularIntensityMap:Y,transmission:Ge,transmissionMap:tt,thicknessMap:pe,gradientMap:Me,opaque:T.transparent===!1&&T.blending===ko&&T.alphaToCoverage===!1,alphaMap:Je,alphaTest:nt,alphaHash:Yt,combine:T.combine,mapUv:_e&&m(T.map.channel),aoMapUv:wt&&m(T.aoMap.channel),lightMapUv:st&&m(T.lightMap.channel),bumpMapUv:Ee&&m(T.bumpMap.channel),normalMapUv:Fe&&m(T.normalMap.channel),displacementMapUv:He&&m(T.displacementMap.channel),emissiveMapUv:rt&&m(T.emissiveMap.channel),metalnessMapUv:N&&m(T.metalnessMap.channel),roughnessMapUv:A&&m(T.roughnessMap.channel),anisotropyMapUv:Xe&&m(T.anisotropyMap.channel),clearcoatMapUv:Gt&&m(T.clearcoatMap.channel),clearcoatNormalMapUv:Le&&m(T.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ye&&m(T.clearcoatRoughnessMap.channel),iridescenceMapUv:yt&&m(T.iridescenceMap.channel),iridescenceThicknessMapUv:vt&&m(T.iridescenceThicknessMap.channel),sheenColorMapUv:it&&m(T.sheenColorMap.channel),sheenRoughnessMapUv:jt&&m(T.sheenRoughnessMap.channel),specularMapUv:kt&&m(T.specularMap.channel),specularColorMapUv:An&&m(T.specularColorMap.channel),specularIntensityMapUv:Y&&m(T.specularIntensityMap.channel),transmissionMapUv:tt&&m(T.transmissionMap.channel),thicknessMapUv:pe&&m(T.thicknessMap.channel),alphaMapUv:Je&&m(T.alphaMap.channel),vertexTangents:!!j.attributes.tangent&&(Fe||ee),vertexColors:T.vertexColors,vertexAlphas:T.vertexColors===!0&&!!j.attributes.color&&j.attributes.color.itemSize===4,pointsUvs:B.isPoints===!0&&!!j.attributes.uv&&(_e||Je),fog:!!te,useFog:T.fog===!0,fogExp2:!!te&&te.isFogExp2,flatShading:T.flatShading===!0,sizeAttenuation:T.sizeAttenuation===!0,logarithmicDepthBuffer:d,reverseDepthBuffer:h,skinning:B.isSkinnedMesh===!0,morphTargets:j.morphAttributes.position!==void 0,morphNormals:j.morphAttributes.normal!==void 0,morphColors:j.morphAttributes.color!==void 0,morphTargetsCount:je,morphTextureStride:ge,numDirLights:R.directional.length,numPointLights:R.point.length,numSpotLights:R.spot.length,numSpotLightMaps:R.spotLightMap.length,numRectAreaLights:R.rectArea.length,numHemiLights:R.hemi.length,numDirLightShadows:R.directionalShadowMap.length,numPointLightShadows:R.pointShadowMap.length,numSpotLightShadows:R.spotShadowMap.length,numSpotLightShadowsWithMaps:R.numSpotLightShadowsWithMaps,numLightProbes:R.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:T.dithering,shadowMapEnabled:n.shadowMap.enabled&&V.length>0,shadowMapType:n.shadowMap.type,toneMapping:wi,decodeVideoTexture:_e&&T.map.isVideoTexture===!0&&en.getTransfer(T.map.colorSpace)===Rn,premultipliedAlpha:T.premultipliedAlpha,doubleSided:T.side===Is,flipSided:T.side===Pi,useDepthPacking:T.depthPacking>=0,depthPacking:T.depthPacking||0,index0AttributeName:T.index0AttributeName,extensionClipCullDistance:Wn&&T.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Wn&&T.extensions.multiDraw===!0||dt)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:T.customProgramCacheKey()};return tn.vertexUv1s=c.has(1),tn.vertexUv2s=c.has(2),tn.vertexUv3s=c.has(3),c.clear(),tn}function y(T){const R=[];if(T.shaderID?R.push(T.shaderID):(R.push(T.customVertexShaderID),R.push(T.customFragmentShaderID)),T.defines!==void 0)for(const V in T.defines)R.push(V),R.push(T.defines[V]);return T.isRawShaderMaterial===!1&&(b(R,T),p(R,T),R.push(n.outputColorSpace)),R.push(T.customProgramCacheKey),R.join()}function b(T,R){T.push(R.precision),T.push(R.outputColorSpace),T.push(R.envMapMode),T.push(R.envMapCubeUVHeight),T.push(R.mapUv),T.push(R.alphaMapUv),T.push(R.lightMapUv),T.push(R.aoMapUv),T.push(R.bumpMapUv),T.push(R.normalMapUv),T.push(R.displacementMapUv),T.push(R.emissiveMapUv),T.push(R.metalnessMapUv),T.push(R.roughnessMapUv),T.push(R.anisotropyMapUv),T.push(R.clearcoatMapUv),T.push(R.clearcoatNormalMapUv),T.push(R.clearcoatRoughnessMapUv),T.push(R.iridescenceMapUv),T.push(R.iridescenceThicknessMapUv),T.push(R.sheenColorMapUv),T.push(R.sheenRoughnessMapUv),T.push(R.specularMapUv),T.push(R.specularColorMapUv),T.push(R.specularIntensityMapUv),T.push(R.transmissionMapUv),T.push(R.thicknessMapUv),T.push(R.combine),T.push(R.fogExp2),T.push(R.sizeAttenuation),T.push(R.morphTargetsCount),T.push(R.morphAttributeCount),T.push(R.numDirLights),T.push(R.numPointLights),T.push(R.numSpotLights),T.push(R.numSpotLightMaps),T.push(R.numHemiLights),T.push(R.numRectAreaLights),T.push(R.numDirLightShadows),T.push(R.numPointLightShadows),T.push(R.numSpotLightShadows),T.push(R.numSpotLightShadowsWithMaps),T.push(R.numLightProbes),T.push(R.shadowMapType),T.push(R.toneMapping),T.push(R.numClippingPlanes),T.push(R.numClipIntersection),T.push(R.depthPacking)}function p(T,R){o.disableAll(),R.supportsVertexTextures&&o.enable(0),R.instancing&&o.enable(1),R.instancingColor&&o.enable(2),R.instancingMorph&&o.enable(3),R.matcap&&o.enable(4),R.envMap&&o.enable(5),R.normalMapObjectSpace&&o.enable(6),R.normalMapTangentSpace&&o.enable(7),R.clearcoat&&o.enable(8),R.iridescence&&o.enable(9),R.alphaTest&&o.enable(10),R.vertexColors&&o.enable(11),R.vertexAlphas&&o.enable(12),R.vertexUv1s&&o.enable(13),R.vertexUv2s&&o.enable(14),R.vertexUv3s&&o.enable(15),R.vertexTangents&&o.enable(16),R.anisotropy&&o.enable(17),R.alphaHash&&o.enable(18),R.batching&&o.enable(19),R.dispersion&&o.enable(20),R.batchingColor&&o.enable(21),T.push(o.mask),o.disableAll(),R.fog&&o.enable(0),R.useFog&&o.enable(1),R.flatShading&&o.enable(2),R.logarithmicDepthBuffer&&o.enable(3),R.reverseDepthBuffer&&o.enable(4),R.skinning&&o.enable(5),R.morphTargets&&o.enable(6),R.morphNormals&&o.enable(7),R.morphColors&&o.enable(8),R.premultipliedAlpha&&o.enable(9),R.shadowMapEnabled&&o.enable(10),R.doubleSided&&o.enable(11),R.flipSided&&o.enable(12),R.useDepthPacking&&o.enable(13),R.dithering&&o.enable(14),R.transmission&&o.enable(15),R.sheen&&o.enable(16),R.opaque&&o.enable(17),R.pointsUvs&&o.enable(18),R.decodeVideoTexture&&o.enable(19),R.alphaToCoverage&&o.enable(20),T.push(o.mask)}function w(T){const R=v[T.type];let V;if(R){const H=xs[R];V=c5.clone(H.uniforms)}else V=T.uniforms;return V}function E(T,R){let V;for(let H=0,B=u.length;H<B;H++){const te=u[H];if(te.cacheKey===R){V=te,++V.usedTimes;break}}return V===void 0&&(V=new T8(n,R,T,r),u.push(V)),V}function C(T){if(--T.usedTimes===0){const R=u.indexOf(T);u[R]=u[u.length-1],u.pop(),T.destroy()}}function M(T){l.remove(T)}function I(){l.dispose()}return{getParameters:_,getProgramCacheKey:y,getUniforms:w,acquireProgram:E,releaseProgram:C,releaseShaderCache:M,programs:u,dispose:I}}function w8(){let n=new WeakMap;function e(a){return n.has(a)}function t(a){let o=n.get(a);return o===void 0&&(o={},n.set(a,o)),o}function i(a){n.delete(a)}function s(a,o,l){n.get(a)[o]=l}function r(){n=new WeakMap}return{has:e,get:t,remove:i,update:s,dispose:r}}function R8(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function k1(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function M1(){const n=[];let e=0;const t=[],i=[],s=[];function r(){e=0,t.length=0,i.length=0,s.length=0}function a(d,h,f,g,v,m){let _=n[e];return _===void 0?(_={id:d.id,object:d,geometry:h,material:f,groupOrder:g,renderOrder:d.renderOrder,z:v,group:m},n[e]=_):(_.id=d.id,_.object=d,_.geometry=h,_.material=f,_.groupOrder=g,_.renderOrder=d.renderOrder,_.z=v,_.group=m),e++,_}function o(d,h,f,g,v,m){const _=a(d,h,f,g,v,m);f.transmission>0?i.push(_):f.transparent===!0?s.push(_):t.push(_)}function l(d,h,f,g,v,m){const _=a(d,h,f,g,v,m);f.transmission>0?i.unshift(_):f.transparent===!0?s.unshift(_):t.unshift(_)}function c(d,h){t.length>1&&t.sort(d||R8),i.length>1&&i.sort(h||k1),s.length>1&&s.sort(h||k1)}function u(){for(let d=e,h=n.length;d<h;d++){const f=n[d];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:t,transmissive:i,transparent:s,init:r,push:o,unshift:l,finish:u,sort:c}}function k8(){let n=new WeakMap;function e(i,s){const r=n.get(i);let a;return r===void 0?(a=new M1,n.set(i,[a])):s>=r.length?(a=new M1,r.push(a)):a=r[s],a}function t(){n=new WeakMap}return{get:e,dispose:t}}function M8(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Z,color:new Rt};break;case"SpotLight":t={position:new Z,direction:new Z,color:new Rt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Z,color:new Rt,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Z,skyColor:new Rt,groundColor:new Rt};break;case"RectAreaLight":t={color:new Rt,position:new Z,halfWidth:new Z,halfHeight:new Z};break}return n[e.id]=t,t}}}function x8(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Xt};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Xt};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Xt,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let I8=0;function P8(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function N8(n){const e=new M8,t=x8(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)i.probe.push(new Z);const s=new Z,r=new xt,a=new xt;function o(c){let u=0,d=0,h=0;for(let I=0;I<9;I++)i.probe[I].set(0,0,0);let f=0,g=0,v=0,m=0,_=0,y=0,b=0,p=0,w=0,E=0,C=0;c.sort(P8);for(let I=0,T=c.length;I<T;I++){const R=c[I],V=R.color,H=R.intensity,B=R.distance,te=R.shadow&&R.shadow.map?R.shadow.map.texture:null;if(R.isAmbientLight)u+=V.r*H,d+=V.g*H,h+=V.b*H;else if(R.isLightProbe){for(let j=0;j<9;j++)i.probe[j].addScaledVector(R.sh.coefficients[j],H);C++}else if(R.isDirectionalLight){const j=e.get(R);if(j.color.copy(R.color).multiplyScalar(R.intensity),R.castShadow){const oe=R.shadow,z=t.get(R);z.shadowIntensity=oe.intensity,z.shadowBias=oe.bias,z.shadowNormalBias=oe.normalBias,z.shadowRadius=oe.radius,z.shadowMapSize=oe.mapSize,i.directionalShadow[f]=z,i.directionalShadowMap[f]=te,i.directionalShadowMatrix[f]=R.shadow.matrix,y++}i.directional[f]=j,f++}else if(R.isSpotLight){const j=e.get(R);j.position.setFromMatrixPosition(R.matrixWorld),j.color.copy(V).multiplyScalar(H),j.distance=B,j.coneCos=Math.cos(R.angle),j.penumbraCos=Math.cos(R.angle*(1-R.penumbra)),j.decay=R.decay,i.spot[v]=j;const oe=R.shadow;if(R.map&&(i.spotLightMap[w]=R.map,w++,oe.updateMatrices(R),R.castShadow&&E++),i.spotLightMatrix[v]=oe.matrix,R.castShadow){const z=t.get(R);z.shadowIntensity=oe.intensity,z.shadowBias=oe.bias,z.shadowNormalBias=oe.normalBias,z.shadowRadius=oe.radius,z.shadowMapSize=oe.mapSize,i.spotShadow[v]=z,i.spotShadowMap[v]=te,p++}v++}else if(R.isRectAreaLight){const j=e.get(R);j.color.copy(V).multiplyScalar(H),j.halfWidth.set(R.width*.5,0,0),j.halfHeight.set(0,R.height*.5,0),i.rectArea[m]=j,m++}else if(R.isPointLight){const j=e.get(R);if(j.color.copy(R.color).multiplyScalar(R.intensity),j.distance=R.distance,j.decay=R.decay,R.castShadow){const oe=R.shadow,z=t.get(R);z.shadowIntensity=oe.intensity,z.shadowBias=oe.bias,z.shadowNormalBias=oe.normalBias,z.shadowRadius=oe.radius,z.shadowMapSize=oe.mapSize,z.shadowCameraNear=oe.camera.near,z.shadowCameraFar=oe.camera.far,i.pointShadow[g]=z,i.pointShadowMap[g]=te,i.pointShadowMatrix[g]=R.shadow.matrix,b++}i.point[g]=j,g++}else if(R.isHemisphereLight){const j=e.get(R);j.skyColor.copy(R.color).multiplyScalar(H),j.groundColor.copy(R.groundColor).multiplyScalar(H),i.hemi[_]=j,_++}}m>0&&(n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=Ke.LTC_FLOAT_1,i.rectAreaLTC2=Ke.LTC_FLOAT_2):(i.rectAreaLTC1=Ke.LTC_HALF_1,i.rectAreaLTC2=Ke.LTC_HALF_2)),i.ambient[0]=u,i.ambient[1]=d,i.ambient[2]=h;const M=i.hash;(M.directionalLength!==f||M.pointLength!==g||M.spotLength!==v||M.rectAreaLength!==m||M.hemiLength!==_||M.numDirectionalShadows!==y||M.numPointShadows!==b||M.numSpotShadows!==p||M.numSpotMaps!==w||M.numLightProbes!==C)&&(i.directional.length=f,i.spot.length=v,i.rectArea.length=m,i.point.length=g,i.hemi.length=_,i.directionalShadow.length=y,i.directionalShadowMap.length=y,i.pointShadow.length=b,i.pointShadowMap.length=b,i.spotShadow.length=p,i.spotShadowMap.length=p,i.directionalShadowMatrix.length=y,i.pointShadowMatrix.length=b,i.spotLightMatrix.length=p+w-E,i.spotLightMap.length=w,i.numSpotLightShadowsWithMaps=E,i.numLightProbes=C,M.directionalLength=f,M.pointLength=g,M.spotLength=v,M.rectAreaLength=m,M.hemiLength=_,M.numDirectionalShadows=y,M.numPointShadows=b,M.numSpotShadows=p,M.numSpotMaps=w,M.numLightProbes=C,i.version=I8++)}function l(c,u){let d=0,h=0,f=0,g=0,v=0;const m=u.matrixWorldInverse;for(let _=0,y=c.length;_<y;_++){const b=c[_];if(b.isDirectionalLight){const p=i.directional[d];p.direction.setFromMatrixPosition(b.matrixWorld),s.setFromMatrixPosition(b.target.matrixWorld),p.direction.sub(s),p.direction.transformDirection(m),d++}else if(b.isSpotLight){const p=i.spot[f];p.position.setFromMatrixPosition(b.matrixWorld),p.position.applyMatrix4(m),p.direction.setFromMatrixPosition(b.matrixWorld),s.setFromMatrixPosition(b.target.matrixWorld),p.direction.sub(s),p.direction.transformDirection(m),f++}else if(b.isRectAreaLight){const p=i.rectArea[g];p.position.setFromMatrixPosition(b.matrixWorld),p.position.applyMatrix4(m),a.identity(),r.copy(b.matrixWorld),r.premultiply(m),a.extractRotation(r),p.halfWidth.set(b.width*.5,0,0),p.halfHeight.set(0,b.height*.5,0),p.halfWidth.applyMatrix4(a),p.halfHeight.applyMatrix4(a),g++}else if(b.isPointLight){const p=i.point[h];p.position.setFromMatrixPosition(b.matrixWorld),p.position.applyMatrix4(m),h++}else if(b.isHemisphereLight){const p=i.hemi[v];p.direction.setFromMatrixPosition(b.matrixWorld),p.direction.transformDirection(m),v++}}}return{setup:o,setupView:l,state:i}}function x1(n){const e=new N8(n),t=[],i=[];function s(u){c.camera=u,t.length=0,i.length=0}function r(u){t.push(u)}function a(u){i.push(u)}function o(){e.setup(t)}function l(u){e.setupView(t,u)}const c={lightsArray:t,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:s,state:c,setupLights:o,setupLightsView:l,pushLight:r,pushShadow:a}}function D8(n){let e=new WeakMap;function t(s,r=0){const a=e.get(s);let o;return a===void 0?(o=new x1(n),e.set(s,[o])):r>=a.length?(o=new x1(n),a.push(o)):o=a[r],o}function i(){e=new WeakMap}return{get:t,dispose:i}}class L8 extends Ns{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=pU,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class O8 extends Ns{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const U8=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,F8=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function B8(n,e,t){let i=new i0;const s=new Xt,r=new Xt,a=new rn,o=new L8({depthPacking:mU}),l=new O8,c={},u=t.maxTextureSize,d={[mr]:Pi,[Pi]:mr,[Is]:Is},h=new _r({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Xt},radius:{value:4}},vertexShader:U8,fragmentShader:F8}),f=h.clone();f.defines.HORIZONTAL_PASS=1;const g=new Es;g.setAttribute("position",new Ci(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new Wi(g,h),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=qg;let _=this.type;this.render=function(E,C,M){if(m.enabled===!1||m.autoUpdate===!1&&m.needsUpdate===!1||E.length===0)return;const I=n.getRenderTarget(),T=n.getActiveCubeFace(),R=n.getActiveMipmapLevel(),V=n.state;V.setBlending(qr),V.buffers.color.setClear(1,1,1,1),V.buffers.depth.setTest(!0),V.setScissorTest(!1);const H=_!==Zs&&this.type===Zs,B=_===Zs&&this.type!==Zs;for(let te=0,j=E.length;te<j;te++){const oe=E[te],z=oe.shadow;if(z===void 0){console.warn("THREE.WebGLShadowMap:",oe,"has no shadow.");continue}if(z.autoUpdate===!1&&z.needsUpdate===!1)continue;s.copy(z.mapSize);const W=z.getFrameExtents();if(s.multiply(W),r.copy(z.mapSize),(s.x>u||s.y>u)&&(s.x>u&&(r.x=Math.floor(u/W.x),s.x=r.x*W.x,z.mapSize.x=r.x),s.y>u&&(r.y=Math.floor(u/W.y),s.y=r.y*W.y,z.mapSize.y=r.y)),z.map===null||H===!0||B===!0){const se=this.type!==Zs?{minFilter:Ai,magFilter:Ai}:{};z.map!==null&&z.map.dispose(),z.map=new Na(s.x,s.y,se),z.map.texture.name=oe.name+".shadowMap",z.camera.updateProjectionMatrix()}n.setRenderTarget(z.map),n.clear();const ie=z.getViewportCount();for(let se=0;se<ie;se++){const je=z.getViewport(se);a.set(r.x*je.x,r.y*je.y,r.x*je.z,r.y*je.w),V.viewport(a),z.updateMatrices(oe,se),i=z.getFrustum(),p(C,M,z.camera,oe,this.type)}z.isPointLightShadow!==!0&&this.type===Zs&&y(z,M),z.needsUpdate=!1}_=this.type,m.needsUpdate=!1,n.setRenderTarget(I,T,R)};function y(E,C){const M=e.update(v);h.defines.VSM_SAMPLES!==E.blurSamples&&(h.defines.VSM_SAMPLES=E.blurSamples,f.defines.VSM_SAMPLES=E.blurSamples,h.needsUpdate=!0,f.needsUpdate=!0),E.mapPass===null&&(E.mapPass=new Na(s.x,s.y)),h.uniforms.shadow_pass.value=E.map.texture,h.uniforms.resolution.value=E.mapSize,h.uniforms.radius.value=E.radius,n.setRenderTarget(E.mapPass),n.clear(),n.renderBufferDirect(C,null,M,h,v,null),f.uniforms.shadow_pass.value=E.mapPass.texture,f.uniforms.resolution.value=E.mapSize,f.uniforms.radius.value=E.radius,n.setRenderTarget(E.map),n.clear(),n.renderBufferDirect(C,null,M,f,v,null)}function b(E,C,M,I){let T=null;const R=M.isPointLight===!0?E.customDistanceMaterial:E.customDepthMaterial;if(R!==void 0)T=R;else if(T=M.isPointLight===!0?l:o,n.localClippingEnabled&&C.clipShadows===!0&&Array.isArray(C.clippingPlanes)&&C.clippingPlanes.length!==0||C.displacementMap&&C.displacementScale!==0||C.alphaMap&&C.alphaTest>0||C.map&&C.alphaTest>0){const V=T.uuid,H=C.uuid;let B=c[V];B===void 0&&(B={},c[V]=B);let te=B[H];te===void 0&&(te=T.clone(),B[H]=te,C.addEventListener("dispose",w)),T=te}if(T.visible=C.visible,T.wireframe=C.wireframe,I===Zs?T.side=C.shadowSide!==null?C.shadowSide:C.side:T.side=C.shadowSide!==null?C.shadowSide:d[C.side],T.alphaMap=C.alphaMap,T.alphaTest=C.alphaTest,T.map=C.map,T.clipShadows=C.clipShadows,T.clippingPlanes=C.clippingPlanes,T.clipIntersection=C.clipIntersection,T.displacementMap=C.displacementMap,T.displacementScale=C.displacementScale,T.displacementBias=C.displacementBias,T.wireframeLinewidth=C.wireframeLinewidth,T.linewidth=C.linewidth,M.isPointLight===!0&&T.isMeshDistanceMaterial===!0){const V=n.properties.get(T);V.light=M}return T}function p(E,C,M,I,T){if(E.visible===!1)return;if(E.layers.test(C.layers)&&(E.isMesh||E.isLine||E.isPoints)&&(E.castShadow||E.receiveShadow&&T===Zs)&&(!E.frustumCulled||i.intersectsObject(E))){E.modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,E.matrixWorld);const H=e.update(E),B=E.material;if(Array.isArray(B)){const te=H.groups;for(let j=0,oe=te.length;j<oe;j++){const z=te[j],W=B[z.materialIndex];if(W&&W.visible){const ie=b(E,W,I,T);E.onBeforeShadow(n,E,C,M,H,ie,z),n.renderBufferDirect(M,null,H,ie,E,z),E.onAfterShadow(n,E,C,M,H,ie,z)}}}else if(B.visible){const te=b(E,B,I,T);E.onBeforeShadow(n,E,C,M,H,te,null),n.renderBufferDirect(M,null,H,te,E,null),E.onAfterShadow(n,E,C,M,H,te,null)}}const V=E.children;for(let H=0,B=V.length;H<B;H++)p(V[H],C,M,I,T)}function w(E){E.target.removeEventListener("dispose",w);for(const M in c){const I=c[M],T=E.target.uuid;T in I&&(I[T].dispose(),delete I[T])}}}const V8={[lm]:um,[dm]:pm,[hm]:mm,[Bo]:fm,[um]:lm,[pm]:dm,[mm]:hm,[fm]:Bo};function G8(n){function e(){let Y=!1;const tt=new rn;let pe=null;const Me=new rn(0,0,0,0);return{setMask:function(Je){pe!==Je&&!Y&&(n.colorMask(Je,Je,Je,Je),pe=Je)},setLocked:function(Je){Y=Je},setClear:function(Je,nt,Yt,Wn,wi){wi===!0&&(Je*=Wn,nt*=Wn,Yt*=Wn),tt.set(Je,nt,Yt,Wn),Me.equals(tt)===!1&&(n.clearColor(Je,nt,Yt,Wn),Me.copy(tt))},reset:function(){Y=!1,pe=null,Me.set(-1,0,0,0)}}}function t(){let Y=!1,tt=!1,pe=null,Me=null,Je=null;return{setReversed:function(nt){tt=nt},setTest:function(nt){nt?U(n.DEPTH_TEST):de(n.DEPTH_TEST)},setMask:function(nt){pe!==nt&&!Y&&(n.depthMask(nt),pe=nt)},setFunc:function(nt){if(tt&&(nt=V8[nt]),Me!==nt){switch(nt){case lm:n.depthFunc(n.NEVER);break;case um:n.depthFunc(n.ALWAYS);break;case dm:n.depthFunc(n.LESS);break;case Bo:n.depthFunc(n.LEQUAL);break;case hm:n.depthFunc(n.EQUAL);break;case fm:n.depthFunc(n.GEQUAL);break;case pm:n.depthFunc(n.GREATER);break;case mm:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}Me=nt}},setLocked:function(nt){Y=nt},setClear:function(nt){Je!==nt&&(n.clearDepth(nt),Je=nt)},reset:function(){Y=!1,pe=null,Me=null,Je=null}}}function i(){let Y=!1,tt=null,pe=null,Me=null,Je=null,nt=null,Yt=null,Wn=null,wi=null;return{setTest:function(tn){Y||(tn?U(n.STENCIL_TEST):de(n.STENCIL_TEST))},setMask:function(tn){tt!==tn&&!Y&&(n.stencilMask(tn),tt=tn)},setFunc:function(tn,Ri,zs){(pe!==tn||Me!==Ri||Je!==zs)&&(n.stencilFunc(tn,Ri,zs),pe=tn,Me=Ri,Je=zs)},setOp:function(tn,Ri,zs){(nt!==tn||Yt!==Ri||Wn!==zs)&&(n.stencilOp(tn,Ri,zs),nt=tn,Yt=Ri,Wn=zs)},setLocked:function(tn){Y=tn},setClear:function(tn){wi!==tn&&(n.clearStencil(tn),wi=tn)},reset:function(){Y=!1,tt=null,pe=null,Me=null,Je=null,nt=null,Yt=null,Wn=null,wi=null}}}const s=new e,r=new t,a=new i,o=new WeakMap,l=new WeakMap;let c={},u={},d=new WeakMap,h=[],f=null,g=!1,v=null,m=null,_=null,y=null,b=null,p=null,w=null,E=new Rt(0,0,0),C=0,M=!1,I=null,T=null,R=null,V=null,H=null;const B=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let te=!1,j=0;const oe=n.getParameter(n.VERSION);oe.indexOf("WebGL")!==-1?(j=parseFloat(/^WebGL (\d)/.exec(oe)[1]),te=j>=1):oe.indexOf("OpenGL ES")!==-1&&(j=parseFloat(/^OpenGL ES (\d)/.exec(oe)[1]),te=j>=2);let z=null,W={};const ie=n.getParameter(n.SCISSOR_BOX),se=n.getParameter(n.VIEWPORT),je=new rn().fromArray(ie),ge=new rn().fromArray(se);function L(Y,tt,pe,Me){const Je=new Uint8Array(4),nt=n.createTexture();n.bindTexture(Y,nt),n.texParameteri(Y,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(Y,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let Yt=0;Yt<pe;Yt++)Y===n.TEXTURE_3D||Y===n.TEXTURE_2D_ARRAY?n.texImage3D(tt,0,n.RGBA,1,1,Me,0,n.RGBA,n.UNSIGNED_BYTE,Je):n.texImage2D(tt+Yt,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,Je);return nt}const J={};J[n.TEXTURE_2D]=L(n.TEXTURE_2D,n.TEXTURE_2D,1),J[n.TEXTURE_CUBE_MAP]=L(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),J[n.TEXTURE_2D_ARRAY]=L(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),J[n.TEXTURE_3D]=L(n.TEXTURE_3D,n.TEXTURE_3D,1,1),s.setClear(0,0,0,1),r.setClear(1),a.setClear(0),U(n.DEPTH_TEST),r.setFunc(Bo),st(!1),Ee(Db),U(n.CULL_FACE),O(qr);function U(Y){c[Y]!==!0&&(n.enable(Y),c[Y]=!0)}function de(Y){c[Y]!==!1&&(n.disable(Y),c[Y]=!1)}function et(Y,tt){return u[Y]!==tt?(n.bindFramebuffer(Y,tt),u[Y]=tt,Y===n.DRAW_FRAMEBUFFER&&(u[n.FRAMEBUFFER]=tt),Y===n.FRAMEBUFFER&&(u[n.DRAW_FRAMEBUFFER]=tt),!0):!1}function Ue(Y,tt){let pe=h,Me=!1;if(Y){pe=d.get(tt),pe===void 0&&(pe=[],d.set(tt,pe));const Je=Y.textures;if(pe.length!==Je.length||pe[0]!==n.COLOR_ATTACHMENT0){for(let nt=0,Yt=Je.length;nt<Yt;nt++)pe[nt]=n.COLOR_ATTACHMENT0+nt;pe.length=Je.length,Me=!0}}else pe[0]!==n.BACK&&(pe[0]=n.BACK,Me=!0);Me&&n.drawBuffers(pe)}function dt(Y){return f!==Y?(n.useProgram(Y),f=Y,!0):!1}const _e={[ba]:n.FUNC_ADD,[B4]:n.FUNC_SUBTRACT,[V4]:n.FUNC_REVERSE_SUBTRACT};_e[G4]=n.MIN,_e[z4]=n.MAX;const we={[H4]:n.ZERO,[W4]:n.ONE,[j4]:n.SRC_COLOR,[om]:n.SRC_ALPHA,[Q4]:n.SRC_ALPHA_SATURATE,[Y4]:n.DST_COLOR,[q4]:n.DST_ALPHA,[K4]:n.ONE_MINUS_SRC_COLOR,[cm]:n.ONE_MINUS_SRC_ALPHA,[J4]:n.ONE_MINUS_DST_COLOR,[X4]:n.ONE_MINUS_DST_ALPHA,[Z4]:n.CONSTANT_COLOR,[$4]:n.ONE_MINUS_CONSTANT_COLOR,[eU]:n.CONSTANT_ALPHA,[tU]:n.ONE_MINUS_CONSTANT_ALPHA};function O(Y,tt,pe,Me,Je,nt,Yt,Wn,wi,tn){if(Y===qr){g===!0&&(de(n.BLEND),g=!1);return}if(g===!1&&(U(n.BLEND),g=!0),Y!==F4){if(Y!==v||tn!==M){if((m!==ba||b!==ba)&&(n.blendEquation(n.FUNC_ADD),m=ba,b=ba),tn)switch(Y){case ko:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case Lb:n.blendFunc(n.ONE,n.ONE);break;case Ob:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case Ub:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Y);break}else switch(Y){case ko:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case Lb:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case Ob:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case Ub:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Y);break}_=null,y=null,p=null,w=null,E.set(0,0,0),C=0,v=Y,M=tn}return}Je=Je||tt,nt=nt||pe,Yt=Yt||Me,(tt!==m||Je!==b)&&(n.blendEquationSeparate(_e[tt],_e[Je]),m=tt,b=Je),(pe!==_||Me!==y||nt!==p||Yt!==w)&&(n.blendFuncSeparate(we[pe],we[Me],we[nt],we[Yt]),_=pe,y=Me,p=nt,w=Yt),(Wn.equals(E)===!1||wi!==C)&&(n.blendColor(Wn.r,Wn.g,Wn.b,wi),E.copy(Wn),C=wi),v=Y,M=!1}function wt(Y,tt){Y.side===Is?de(n.CULL_FACE):U(n.CULL_FACE);let pe=Y.side===Pi;tt&&(pe=!pe),st(pe),Y.blending===ko&&Y.transparent===!1?O(qr):O(Y.blending,Y.blendEquation,Y.blendSrc,Y.blendDst,Y.blendEquationAlpha,Y.blendSrcAlpha,Y.blendDstAlpha,Y.blendColor,Y.blendAlpha,Y.premultipliedAlpha),r.setFunc(Y.depthFunc),r.setTest(Y.depthTest),r.setMask(Y.depthWrite),s.setMask(Y.colorWrite);const Me=Y.stencilWrite;a.setTest(Me),Me&&(a.setMask(Y.stencilWriteMask),a.setFunc(Y.stencilFunc,Y.stencilRef,Y.stencilFuncMask),a.setOp(Y.stencilFail,Y.stencilZFail,Y.stencilZPass)),He(Y.polygonOffset,Y.polygonOffsetFactor,Y.polygonOffsetUnits),Y.alphaToCoverage===!0?U(n.SAMPLE_ALPHA_TO_COVERAGE):de(n.SAMPLE_ALPHA_TO_COVERAGE)}function st(Y){I!==Y&&(Y?n.frontFace(n.CW):n.frontFace(n.CCW),I=Y)}function Ee(Y){Y!==L4?(U(n.CULL_FACE),Y!==T&&(Y===Db?n.cullFace(n.BACK):Y===O4?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):de(n.CULL_FACE),T=Y}function Fe(Y){Y!==R&&(te&&n.lineWidth(Y),R=Y)}function He(Y,tt,pe){Y?(U(n.POLYGON_OFFSET_FILL),(V!==tt||H!==pe)&&(n.polygonOffset(tt,pe),V=tt,H=pe)):de(n.POLYGON_OFFSET_FILL)}function rt(Y){Y?U(n.SCISSOR_TEST):de(n.SCISSOR_TEST)}function N(Y){Y===void 0&&(Y=n.TEXTURE0+B-1),z!==Y&&(n.activeTexture(Y),z=Y)}function A(Y,tt,pe){pe===void 0&&(z===null?pe=n.TEXTURE0+B-1:pe=z);let Me=W[pe];Me===void 0&&(Me={type:void 0,texture:void 0},W[pe]=Me),(Me.type!==Y||Me.texture!==tt)&&(z!==pe&&(n.activeTexture(pe),z=pe),n.bindTexture(Y,tt||J[Y]),Me.type=Y,Me.texture=tt)}function ee(){const Y=W[z];Y!==void 0&&Y.type!==void 0&&(n.bindTexture(Y.type,null),Y.type=void 0,Y.texture=void 0)}function me(){try{n.compressedTexImage2D.apply(n,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function ve(){try{n.compressedTexImage3D.apply(n,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function re(){try{n.texSubImage2D.apply(n,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function Oe(){try{n.texSubImage3D.apply(n,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function Ge(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function Xe(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function Gt(){try{n.texStorage2D.apply(n,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function Le(){try{n.texStorage3D.apply(n,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function Ye(){try{n.texImage2D.apply(n,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function yt(){try{n.texImage3D.apply(n,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function vt(Y){je.equals(Y)===!1&&(n.scissor(Y.x,Y.y,Y.z,Y.w),je.copy(Y))}function it(Y){ge.equals(Y)===!1&&(n.viewport(Y.x,Y.y,Y.z,Y.w),ge.copy(Y))}function jt(Y,tt){let pe=l.get(tt);pe===void 0&&(pe=new WeakMap,l.set(tt,pe));let Me=pe.get(Y);Me===void 0&&(Me=n.getUniformBlockIndex(tt,Y.name),pe.set(Y,Me))}function kt(Y,tt){const Me=l.get(tt).get(Y);o.get(tt)!==Me&&(n.uniformBlockBinding(tt,Me,Y.__bindingPointIndex),o.set(tt,Me))}function An(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),c={},z=null,W={},u={},d=new WeakMap,h=[],f=null,g=!1,v=null,m=null,_=null,y=null,b=null,p=null,w=null,E=new Rt(0,0,0),C=0,M=!1,I=null,T=null,R=null,V=null,H=null,je.set(0,0,n.canvas.width,n.canvas.height),ge.set(0,0,n.canvas.width,n.canvas.height),s.reset(),r.reset(),a.reset()}return{buffers:{color:s,depth:r,stencil:a},enable:U,disable:de,bindFramebuffer:et,drawBuffers:Ue,useProgram:dt,setBlending:O,setMaterial:wt,setFlipSided:st,setCullFace:Ee,setLineWidth:Fe,setPolygonOffset:He,setScissorTest:rt,activeTexture:N,bindTexture:A,unbindTexture:ee,compressedTexImage2D:me,compressedTexImage3D:ve,texImage2D:Ye,texImage3D:yt,updateUBOMapping:jt,uniformBlockBinding:kt,texStorage2D:Gt,texStorage3D:Le,texSubImage2D:re,texSubImage3D:Oe,compressedTexSubImage2D:Ge,compressedTexSubImage3D:Xe,scissor:vt,viewport:it,reset:An}}function I1(n,e,t,i){const s=z8(i);switch(t){case oA:return n*e;case lA:return n*e;case uA:return n*e*2;case Qg:return n*e/s.components*s.byteLength;case Zg:return n*e/s.components*s.byteLength;case dA:return n*e*2/s.components*s.byteLength;case $g:return n*e*2/s.components*s.byteLength;case cA:return n*e*3/s.components*s.byteLength;case $i:return n*e*4/s.components*s.byteLength;case e0:return n*e*4/s.components*s.byteLength;case Pu:case Nu:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case Du:case Lu:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case vm:case ym:return Math.max(n,16)*Math.max(e,8)/4;case _m:case bm:return Math.max(n,8)*Math.max(e,8)/2;case Tm:case Sm:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case Em:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Am:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Cm:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case wm:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case Rm:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case km:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case Mm:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case xm:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case Im:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case Pm:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case Nm:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case Dm:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case Lm:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case Om:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case Um:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case Ou:case Fm:case Bm:return Math.ceil(n/4)*Math.ceil(e/4)*16;case hA:case Vm:return Math.ceil(n/4)*Math.ceil(e/4)*8;case Gm:case zm:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function z8(n){switch(n){case gr:case sA:return{byteLength:1,components:1};case tl:case rA:case dl:return{byteLength:2,components:1};case Yg:case Jg:return{byteLength:2,components:4};case Pa:case Xg:case vs:return{byteLength:4,components:1};case aA:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}function H8(n,e,t,i,s,r,a){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new Xt,u=new WeakMap;let d;const h=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function g(N,A){return f?new OffscreenCanvas(N,A):sl("canvas")}function v(N,A,ee){let me=1;const ve=rt(N);if((ve.width>ee||ve.height>ee)&&(me=ee/Math.max(ve.width,ve.height)),me<1)if(typeof HTMLImageElement<"u"&&N instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&N instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&N instanceof ImageBitmap||typeof VideoFrame<"u"&&N instanceof VideoFrame){const re=Math.floor(me*ve.width),Oe=Math.floor(me*ve.height);d===void 0&&(d=g(re,Oe));const Ge=A?g(re,Oe):d;return Ge.width=re,Ge.height=Oe,Ge.getContext("2d").drawImage(N,0,0,re,Oe),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ve.width+"x"+ve.height+") to ("+re+"x"+Oe+")."),Ge}else return"data"in N&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ve.width+"x"+ve.height+")."),N;return N}function m(N){return N.generateMipmaps&&N.minFilter!==Ai&&N.minFilter!==Gi}function _(N){n.generateMipmap(N)}function y(N,A,ee,me,ve=!1){if(N!==null){if(n[N]!==void 0)return n[N];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+N+"'")}let re=A;if(A===n.RED&&(ee===n.FLOAT&&(re=n.R32F),ee===n.HALF_FLOAT&&(re=n.R16F),ee===n.UNSIGNED_BYTE&&(re=n.R8)),A===n.RED_INTEGER&&(ee===n.UNSIGNED_BYTE&&(re=n.R8UI),ee===n.UNSIGNED_SHORT&&(re=n.R16UI),ee===n.UNSIGNED_INT&&(re=n.R32UI),ee===n.BYTE&&(re=n.R8I),ee===n.SHORT&&(re=n.R16I),ee===n.INT&&(re=n.R32I)),A===n.RG&&(ee===n.FLOAT&&(re=n.RG32F),ee===n.HALF_FLOAT&&(re=n.RG16F),ee===n.UNSIGNED_BYTE&&(re=n.RG8)),A===n.RG_INTEGER&&(ee===n.UNSIGNED_BYTE&&(re=n.RG8UI),ee===n.UNSIGNED_SHORT&&(re=n.RG16UI),ee===n.UNSIGNED_INT&&(re=n.RG32UI),ee===n.BYTE&&(re=n.RG8I),ee===n.SHORT&&(re=n.RG16I),ee===n.INT&&(re=n.RG32I)),A===n.RGB_INTEGER&&(ee===n.UNSIGNED_BYTE&&(re=n.RGB8UI),ee===n.UNSIGNED_SHORT&&(re=n.RGB16UI),ee===n.UNSIGNED_INT&&(re=n.RGB32UI),ee===n.BYTE&&(re=n.RGB8I),ee===n.SHORT&&(re=n.RGB16I),ee===n.INT&&(re=n.RGB32I)),A===n.RGBA_INTEGER&&(ee===n.UNSIGNED_BYTE&&(re=n.RGBA8UI),ee===n.UNSIGNED_SHORT&&(re=n.RGBA16UI),ee===n.UNSIGNED_INT&&(re=n.RGBA32UI),ee===n.BYTE&&(re=n.RGBA8I),ee===n.SHORT&&(re=n.RGBA16I),ee===n.INT&&(re=n.RGBA32I)),A===n.RGB&&ee===n.UNSIGNED_INT_5_9_9_9_REV&&(re=n.RGB9_E5),A===n.RGBA){const Oe=ve?ad:en.getTransfer(me);ee===n.FLOAT&&(re=n.RGBA32F),ee===n.HALF_FLOAT&&(re=n.RGBA16F),ee===n.UNSIGNED_BYTE&&(re=Oe===Rn?n.SRGB8_ALPHA8:n.RGBA8),ee===n.UNSIGNED_SHORT_4_4_4_4&&(re=n.RGBA4),ee===n.UNSIGNED_SHORT_5_5_5_1&&(re=n.RGB5_A1)}return(re===n.R16F||re===n.R32F||re===n.RG16F||re===n.RG32F||re===n.RGBA16F||re===n.RGBA32F)&&e.get("EXT_color_buffer_float"),re}function b(N,A){let ee;return N?A===null||A===Pa||A===Ho?ee=n.DEPTH24_STENCIL8:A===vs?ee=n.DEPTH32F_STENCIL8:A===tl&&(ee=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):A===null||A===Pa||A===Ho?ee=n.DEPTH_COMPONENT24:A===vs?ee=n.DEPTH_COMPONENT32F:A===tl&&(ee=n.DEPTH_COMPONENT16),ee}function p(N,A){return m(N)===!0||N.isFramebufferTexture&&N.minFilter!==Ai&&N.minFilter!==Gi?Math.log2(Math.max(A.width,A.height))+1:N.mipmaps!==void 0&&N.mipmaps.length>0?N.mipmaps.length:N.isCompressedTexture&&Array.isArray(N.image)?A.mipmaps.length:1}function w(N){const A=N.target;A.removeEventListener("dispose",w),C(A),A.isVideoTexture&&u.delete(A)}function E(N){const A=N.target;A.removeEventListener("dispose",E),I(A)}function C(N){const A=i.get(N);if(A.__webglInit===void 0)return;const ee=N.source,me=h.get(ee);if(me){const ve=me[A.__cacheKey];ve.usedTimes--,ve.usedTimes===0&&M(N),Object.keys(me).length===0&&h.delete(ee)}i.remove(N)}function M(N){const A=i.get(N);n.deleteTexture(A.__webglTexture);const ee=N.source,me=h.get(ee);delete me[A.__cacheKey],a.memory.textures--}function I(N){const A=i.get(N);if(N.depthTexture&&N.depthTexture.dispose(),N.isWebGLCubeRenderTarget)for(let me=0;me<6;me++){if(Array.isArray(A.__webglFramebuffer[me]))for(let ve=0;ve<A.__webglFramebuffer[me].length;ve++)n.deleteFramebuffer(A.__webglFramebuffer[me][ve]);else n.deleteFramebuffer(A.__webglFramebuffer[me]);A.__webglDepthbuffer&&n.deleteRenderbuffer(A.__webglDepthbuffer[me])}else{if(Array.isArray(A.__webglFramebuffer))for(let me=0;me<A.__webglFramebuffer.length;me++)n.deleteFramebuffer(A.__webglFramebuffer[me]);else n.deleteFramebuffer(A.__webglFramebuffer);if(A.__webglDepthbuffer&&n.deleteRenderbuffer(A.__webglDepthbuffer),A.__webglMultisampledFramebuffer&&n.deleteFramebuffer(A.__webglMultisampledFramebuffer),A.__webglColorRenderbuffer)for(let me=0;me<A.__webglColorRenderbuffer.length;me++)A.__webglColorRenderbuffer[me]&&n.deleteRenderbuffer(A.__webglColorRenderbuffer[me]);A.__webglDepthRenderbuffer&&n.deleteRenderbuffer(A.__webglDepthRenderbuffer)}const ee=N.textures;for(let me=0,ve=ee.length;me<ve;me++){const re=i.get(ee[me]);re.__webglTexture&&(n.deleteTexture(re.__webglTexture),a.memory.textures--),i.remove(ee[me])}i.remove(N)}let T=0;function R(){T=0}function V(){const N=T;return N>=s.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+N+" texture units while this GPU supports only "+s.maxTextures),T+=1,N}function H(N){const A=[];return A.push(N.wrapS),A.push(N.wrapT),A.push(N.wrapR||0),A.push(N.magFilter),A.push(N.minFilter),A.push(N.anisotropy),A.push(N.internalFormat),A.push(N.format),A.push(N.type),A.push(N.generateMipmaps),A.push(N.premultiplyAlpha),A.push(N.flipY),A.push(N.unpackAlignment),A.push(N.colorSpace),A.join()}function B(N,A){const ee=i.get(N);if(N.isVideoTexture&&Fe(N),N.isRenderTargetTexture===!1&&N.version>0&&ee.__version!==N.version){const me=N.image;if(me===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(me.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{ge(ee,N,A);return}}t.bindTexture(n.TEXTURE_2D,ee.__webglTexture,n.TEXTURE0+A)}function te(N,A){const ee=i.get(N);if(N.version>0&&ee.__version!==N.version){ge(ee,N,A);return}t.bindTexture(n.TEXTURE_2D_ARRAY,ee.__webglTexture,n.TEXTURE0+A)}function j(N,A){const ee=i.get(N);if(N.version>0&&ee.__version!==N.version){ge(ee,N,A);return}t.bindTexture(n.TEXTURE_3D,ee.__webglTexture,n.TEXTURE0+A)}function oe(N,A){const ee=i.get(N);if(N.version>0&&ee.__version!==N.version){L(ee,N,A);return}t.bindTexture(n.TEXTURE_CUBE_MAP,ee.__webglTexture,n.TEXTURE0+A)}const z={[zo]:n.REPEAT,[zr]:n.CLAMP_TO_EDGE,[rd]:n.MIRRORED_REPEAT},W={[Ai]:n.NEAREST,[iA]:n.NEAREST_MIPMAP_NEAREST,[xc]:n.NEAREST_MIPMAP_LINEAR,[Gi]:n.LINEAR,[Iu]:n.LINEAR_MIPMAP_NEAREST,[lr]:n.LINEAR_MIPMAP_LINEAR},ie={[_U]:n.NEVER,[EU]:n.ALWAYS,[vU]:n.LESS,[mA]:n.LEQUAL,[bU]:n.EQUAL,[SU]:n.GEQUAL,[yU]:n.GREATER,[TU]:n.NOTEQUAL};function se(N,A){if(A.type===vs&&e.has("OES_texture_float_linear")===!1&&(A.magFilter===Gi||A.magFilter===Iu||A.magFilter===xc||A.magFilter===lr||A.minFilter===Gi||A.minFilter===Iu||A.minFilter===xc||A.minFilter===lr)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(N,n.TEXTURE_WRAP_S,z[A.wrapS]),n.texParameteri(N,n.TEXTURE_WRAP_T,z[A.wrapT]),(N===n.TEXTURE_3D||N===n.TEXTURE_2D_ARRAY)&&n.texParameteri(N,n.TEXTURE_WRAP_R,z[A.wrapR]),n.texParameteri(N,n.TEXTURE_MAG_FILTER,W[A.magFilter]),n.texParameteri(N,n.TEXTURE_MIN_FILTER,W[A.minFilter]),A.compareFunction&&(n.texParameteri(N,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(N,n.TEXTURE_COMPARE_FUNC,ie[A.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(A.magFilter===Ai||A.minFilter!==xc&&A.minFilter!==lr||A.type===vs&&e.has("OES_texture_float_linear")===!1)return;if(A.anisotropy>1||i.get(A).__currentAnisotropy){const ee=e.get("EXT_texture_filter_anisotropic");n.texParameterf(N,ee.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(A.anisotropy,s.getMaxAnisotropy())),i.get(A).__currentAnisotropy=A.anisotropy}}}function je(N,A){let ee=!1;N.__webglInit===void 0&&(N.__webglInit=!0,A.addEventListener("dispose",w));const me=A.source;let ve=h.get(me);ve===void 0&&(ve={},h.set(me,ve));const re=H(A);if(re!==N.__cacheKey){ve[re]===void 0&&(ve[re]={texture:n.createTexture(),usedTimes:0},a.memory.textures++,ee=!0),ve[re].usedTimes++;const Oe=ve[N.__cacheKey];Oe!==void 0&&(ve[N.__cacheKey].usedTimes--,Oe.usedTimes===0&&M(A)),N.__cacheKey=re,N.__webglTexture=ve[re].texture}return ee}function ge(N,A,ee){let me=n.TEXTURE_2D;(A.isDataArrayTexture||A.isCompressedArrayTexture)&&(me=n.TEXTURE_2D_ARRAY),A.isData3DTexture&&(me=n.TEXTURE_3D);const ve=je(N,A),re=A.source;t.bindTexture(me,N.__webglTexture,n.TEXTURE0+ee);const Oe=i.get(re);if(re.version!==Oe.__version||ve===!0){t.activeTexture(n.TEXTURE0+ee);const Ge=en.getPrimaries(en.workingColorSpace),Xe=A.colorSpace===Vr?null:en.getPrimaries(A.colorSpace),Gt=A.colorSpace===Vr||Ge===Xe?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,A.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,A.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,A.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Gt);let Le=v(A.image,!1,s.maxTextureSize);Le=He(A,Le);const Ye=r.convert(A.format,A.colorSpace),yt=r.convert(A.type);let vt=y(A.internalFormat,Ye,yt,A.colorSpace,A.isVideoTexture);se(me,A);let it;const jt=A.mipmaps,kt=A.isVideoTexture!==!0,An=Oe.__version===void 0||ve===!0,Y=re.dataReady,tt=p(A,Le);if(A.isDepthTexture)vt=b(A.format===Wo,A.type),An&&(kt?t.texStorage2D(n.TEXTURE_2D,1,vt,Le.width,Le.height):t.texImage2D(n.TEXTURE_2D,0,vt,Le.width,Le.height,0,Ye,yt,null));else if(A.isDataTexture)if(jt.length>0){kt&&An&&t.texStorage2D(n.TEXTURE_2D,tt,vt,jt[0].width,jt[0].height);for(let pe=0,Me=jt.length;pe<Me;pe++)it=jt[pe],kt?Y&&t.texSubImage2D(n.TEXTURE_2D,pe,0,0,it.width,it.height,Ye,yt,it.data):t.texImage2D(n.TEXTURE_2D,pe,vt,it.width,it.height,0,Ye,yt,it.data);A.generateMipmaps=!1}else kt?(An&&t.texStorage2D(n.TEXTURE_2D,tt,vt,Le.width,Le.height),Y&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,Le.width,Le.height,Ye,yt,Le.data)):t.texImage2D(n.TEXTURE_2D,0,vt,Le.width,Le.height,0,Ye,yt,Le.data);else if(A.isCompressedTexture)if(A.isCompressedArrayTexture){kt&&An&&t.texStorage3D(n.TEXTURE_2D_ARRAY,tt,vt,jt[0].width,jt[0].height,Le.depth);for(let pe=0,Me=jt.length;pe<Me;pe++)if(it=jt[pe],A.format!==$i)if(Ye!==null)if(kt){if(Y)if(A.layerUpdates.size>0){const Je=I1(it.width,it.height,A.format,A.type);for(const nt of A.layerUpdates){const Yt=it.data.subarray(nt*Je/it.data.BYTES_PER_ELEMENT,(nt+1)*Je/it.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,pe,0,0,nt,it.width,it.height,1,Ye,Yt,0,0)}A.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,pe,0,0,0,it.width,it.height,Le.depth,Ye,it.data,0,0)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,pe,vt,it.width,it.height,Le.depth,0,it.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else kt?Y&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,pe,0,0,0,it.width,it.height,Le.depth,Ye,yt,it.data):t.texImage3D(n.TEXTURE_2D_ARRAY,pe,vt,it.width,it.height,Le.depth,0,Ye,yt,it.data)}else{kt&&An&&t.texStorage2D(n.TEXTURE_2D,tt,vt,jt[0].width,jt[0].height);for(let pe=0,Me=jt.length;pe<Me;pe++)it=jt[pe],A.format!==$i?Ye!==null?kt?Y&&t.compressedTexSubImage2D(n.TEXTURE_2D,pe,0,0,it.width,it.height,Ye,it.data):t.compressedTexImage2D(n.TEXTURE_2D,pe,vt,it.width,it.height,0,it.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):kt?Y&&t.texSubImage2D(n.TEXTURE_2D,pe,0,0,it.width,it.height,Ye,yt,it.data):t.texImage2D(n.TEXTURE_2D,pe,vt,it.width,it.height,0,Ye,yt,it.data)}else if(A.isDataArrayTexture)if(kt){if(An&&t.texStorage3D(n.TEXTURE_2D_ARRAY,tt,vt,Le.width,Le.height,Le.depth),Y)if(A.layerUpdates.size>0){const pe=I1(Le.width,Le.height,A.format,A.type);for(const Me of A.layerUpdates){const Je=Le.data.subarray(Me*pe/Le.data.BYTES_PER_ELEMENT,(Me+1)*pe/Le.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,Me,Le.width,Le.height,1,Ye,yt,Je)}A.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,Le.width,Le.height,Le.depth,Ye,yt,Le.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,vt,Le.width,Le.height,Le.depth,0,Ye,yt,Le.data);else if(A.isData3DTexture)kt?(An&&t.texStorage3D(n.TEXTURE_3D,tt,vt,Le.width,Le.height,Le.depth),Y&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,Le.width,Le.height,Le.depth,Ye,yt,Le.data)):t.texImage3D(n.TEXTURE_3D,0,vt,Le.width,Le.height,Le.depth,0,Ye,yt,Le.data);else if(A.isFramebufferTexture){if(An)if(kt)t.texStorage2D(n.TEXTURE_2D,tt,vt,Le.width,Le.height);else{let pe=Le.width,Me=Le.height;for(let Je=0;Je<tt;Je++)t.texImage2D(n.TEXTURE_2D,Je,vt,pe,Me,0,Ye,yt,null),pe>>=1,Me>>=1}}else if(jt.length>0){if(kt&&An){const pe=rt(jt[0]);t.texStorage2D(n.TEXTURE_2D,tt,vt,pe.width,pe.height)}for(let pe=0,Me=jt.length;pe<Me;pe++)it=jt[pe],kt?Y&&t.texSubImage2D(n.TEXTURE_2D,pe,0,0,Ye,yt,it):t.texImage2D(n.TEXTURE_2D,pe,vt,Ye,yt,it);A.generateMipmaps=!1}else if(kt){if(An){const pe=rt(Le);t.texStorage2D(n.TEXTURE_2D,tt,vt,pe.width,pe.height)}Y&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,Ye,yt,Le)}else t.texImage2D(n.TEXTURE_2D,0,vt,Ye,yt,Le);m(A)&&_(me),Oe.__version=re.version,A.onUpdate&&A.onUpdate(A)}N.__version=A.version}function L(N,A,ee){if(A.image.length!==6)return;const me=je(N,A),ve=A.source;t.bindTexture(n.TEXTURE_CUBE_MAP,N.__webglTexture,n.TEXTURE0+ee);const re=i.get(ve);if(ve.version!==re.__version||me===!0){t.activeTexture(n.TEXTURE0+ee);const Oe=en.getPrimaries(en.workingColorSpace),Ge=A.colorSpace===Vr?null:en.getPrimaries(A.colorSpace),Xe=A.colorSpace===Vr||Oe===Ge?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,A.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,A.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,A.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Xe);const Gt=A.isCompressedTexture||A.image[0].isCompressedTexture,Le=A.image[0]&&A.image[0].isDataTexture,Ye=[];for(let Me=0;Me<6;Me++)!Gt&&!Le?Ye[Me]=v(A.image[Me],!0,s.maxCubemapSize):Ye[Me]=Le?A.image[Me].image:A.image[Me],Ye[Me]=He(A,Ye[Me]);const yt=Ye[0],vt=r.convert(A.format,A.colorSpace),it=r.convert(A.type),jt=y(A.internalFormat,vt,it,A.colorSpace),kt=A.isVideoTexture!==!0,An=re.__version===void 0||me===!0,Y=ve.dataReady;let tt=p(A,yt);se(n.TEXTURE_CUBE_MAP,A);let pe;if(Gt){kt&&An&&t.texStorage2D(n.TEXTURE_CUBE_MAP,tt,jt,yt.width,yt.height);for(let Me=0;Me<6;Me++){pe=Ye[Me].mipmaps;for(let Je=0;Je<pe.length;Je++){const nt=pe[Je];A.format!==$i?vt!==null?kt?Y&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Me,Je,0,0,nt.width,nt.height,vt,nt.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Me,Je,jt,nt.width,nt.height,0,nt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):kt?Y&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Me,Je,0,0,nt.width,nt.height,vt,it,nt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Me,Je,jt,nt.width,nt.height,0,vt,it,nt.data)}}}else{if(pe=A.mipmaps,kt&&An){pe.length>0&&tt++;const Me=rt(Ye[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,tt,jt,Me.width,Me.height)}for(let Me=0;Me<6;Me++)if(Le){kt?Y&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Me,0,0,0,Ye[Me].width,Ye[Me].height,vt,it,Ye[Me].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Me,0,jt,Ye[Me].width,Ye[Me].height,0,vt,it,Ye[Me].data);for(let Je=0;Je<pe.length;Je++){const Yt=pe[Je].image[Me].image;kt?Y&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Me,Je+1,0,0,Yt.width,Yt.height,vt,it,Yt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Me,Je+1,jt,Yt.width,Yt.height,0,vt,it,Yt.data)}}else{kt?Y&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Me,0,0,0,vt,it,Ye[Me]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Me,0,jt,vt,it,Ye[Me]);for(let Je=0;Je<pe.length;Je++){const nt=pe[Je];kt?Y&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Me,Je+1,0,0,vt,it,nt.image[Me]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Me,Je+1,jt,vt,it,nt.image[Me])}}}m(A)&&_(n.TEXTURE_CUBE_MAP),re.__version=ve.version,A.onUpdate&&A.onUpdate(A)}N.__version=A.version}function J(N,A,ee,me,ve,re){const Oe=r.convert(ee.format,ee.colorSpace),Ge=r.convert(ee.type),Xe=y(ee.internalFormat,Oe,Ge,ee.colorSpace);if(!i.get(A).__hasExternalTextures){const Le=Math.max(1,A.width>>re),Ye=Math.max(1,A.height>>re);ve===n.TEXTURE_3D||ve===n.TEXTURE_2D_ARRAY?t.texImage3D(ve,re,Xe,Le,Ye,A.depth,0,Oe,Ge,null):t.texImage2D(ve,re,Xe,Le,Ye,0,Oe,Ge,null)}t.bindFramebuffer(n.FRAMEBUFFER,N),Ee(A)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,me,ve,i.get(ee).__webglTexture,0,st(A)):(ve===n.TEXTURE_2D||ve>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&ve<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,me,ve,i.get(ee).__webglTexture,re),t.bindFramebuffer(n.FRAMEBUFFER,null)}function U(N,A,ee){if(n.bindRenderbuffer(n.RENDERBUFFER,N),A.depthBuffer){const me=A.depthTexture,ve=me&&me.isDepthTexture?me.type:null,re=b(A.stencilBuffer,ve),Oe=A.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Ge=st(A);Ee(A)?o.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Ge,re,A.width,A.height):ee?n.renderbufferStorageMultisample(n.RENDERBUFFER,Ge,re,A.width,A.height):n.renderbufferStorage(n.RENDERBUFFER,re,A.width,A.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,Oe,n.RENDERBUFFER,N)}else{const me=A.textures;for(let ve=0;ve<me.length;ve++){const re=me[ve],Oe=r.convert(re.format,re.colorSpace),Ge=r.convert(re.type),Xe=y(re.internalFormat,Oe,Ge,re.colorSpace),Gt=st(A);ee&&Ee(A)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,Gt,Xe,A.width,A.height):Ee(A)?o.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Gt,Xe,A.width,A.height):n.renderbufferStorage(n.RENDERBUFFER,Xe,A.width,A.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function de(N,A){if(A&&A.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,N),!(A.depthTexture&&A.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(A.depthTexture).__webglTexture||A.depthTexture.image.width!==A.width||A.depthTexture.image.height!==A.height)&&(A.depthTexture.image.width=A.width,A.depthTexture.image.height=A.height,A.depthTexture.needsUpdate=!0),B(A.depthTexture,0);const me=i.get(A.depthTexture).__webglTexture,ve=st(A);if(A.depthTexture.format===Mo)Ee(A)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,me,0,ve):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,me,0);else if(A.depthTexture.format===Wo)Ee(A)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,me,0,ve):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,me,0);else throw new Error("Unknown depthTexture format")}function et(N){const A=i.get(N),ee=N.isWebGLCubeRenderTarget===!0;if(A.__boundDepthTexture!==N.depthTexture){const me=N.depthTexture;if(A.__depthDisposeCallback&&A.__depthDisposeCallback(),me){const ve=()=>{delete A.__boundDepthTexture,delete A.__depthDisposeCallback,me.removeEventListener("dispose",ve)};me.addEventListener("dispose",ve),A.__depthDisposeCallback=ve}A.__boundDepthTexture=me}if(N.depthTexture&&!A.__autoAllocateDepthBuffer){if(ee)throw new Error("target.depthTexture not supported in Cube render targets");de(A.__webglFramebuffer,N)}else if(ee){A.__webglDepthbuffer=[];for(let me=0;me<6;me++)if(t.bindFramebuffer(n.FRAMEBUFFER,A.__webglFramebuffer[me]),A.__webglDepthbuffer[me]===void 0)A.__webglDepthbuffer[me]=n.createRenderbuffer(),U(A.__webglDepthbuffer[me],N,!1);else{const ve=N.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,re=A.__webglDepthbuffer[me];n.bindRenderbuffer(n.RENDERBUFFER,re),n.framebufferRenderbuffer(n.FRAMEBUFFER,ve,n.RENDERBUFFER,re)}}else if(t.bindFramebuffer(n.FRAMEBUFFER,A.__webglFramebuffer),A.__webglDepthbuffer===void 0)A.__webglDepthbuffer=n.createRenderbuffer(),U(A.__webglDepthbuffer,N,!1);else{const me=N.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ve=A.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,ve),n.framebufferRenderbuffer(n.FRAMEBUFFER,me,n.RENDERBUFFER,ve)}t.bindFramebuffer(n.FRAMEBUFFER,null)}function Ue(N,A,ee){const me=i.get(N);A!==void 0&&J(me.__webglFramebuffer,N,N.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),ee!==void 0&&et(N)}function dt(N){const A=N.texture,ee=i.get(N),me=i.get(A);N.addEventListener("dispose",E);const ve=N.textures,re=N.isWebGLCubeRenderTarget===!0,Oe=ve.length>1;if(Oe||(me.__webglTexture===void 0&&(me.__webglTexture=n.createTexture()),me.__version=A.version,a.memory.textures++),re){ee.__webglFramebuffer=[];for(let Ge=0;Ge<6;Ge++)if(A.mipmaps&&A.mipmaps.length>0){ee.__webglFramebuffer[Ge]=[];for(let Xe=0;Xe<A.mipmaps.length;Xe++)ee.__webglFramebuffer[Ge][Xe]=n.createFramebuffer()}else ee.__webglFramebuffer[Ge]=n.createFramebuffer()}else{if(A.mipmaps&&A.mipmaps.length>0){ee.__webglFramebuffer=[];for(let Ge=0;Ge<A.mipmaps.length;Ge++)ee.__webglFramebuffer[Ge]=n.createFramebuffer()}else ee.__webglFramebuffer=n.createFramebuffer();if(Oe)for(let Ge=0,Xe=ve.length;Ge<Xe;Ge++){const Gt=i.get(ve[Ge]);Gt.__webglTexture===void 0&&(Gt.__webglTexture=n.createTexture(),a.memory.textures++)}if(N.samples>0&&Ee(N)===!1){ee.__webglMultisampledFramebuffer=n.createFramebuffer(),ee.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,ee.__webglMultisampledFramebuffer);for(let Ge=0;Ge<ve.length;Ge++){const Xe=ve[Ge];ee.__webglColorRenderbuffer[Ge]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,ee.__webglColorRenderbuffer[Ge]);const Gt=r.convert(Xe.format,Xe.colorSpace),Le=r.convert(Xe.type),Ye=y(Xe.internalFormat,Gt,Le,Xe.colorSpace,N.isXRRenderTarget===!0),yt=st(N);n.renderbufferStorageMultisample(n.RENDERBUFFER,yt,Ye,N.width,N.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ge,n.RENDERBUFFER,ee.__webglColorRenderbuffer[Ge])}n.bindRenderbuffer(n.RENDERBUFFER,null),N.depthBuffer&&(ee.__webglDepthRenderbuffer=n.createRenderbuffer(),U(ee.__webglDepthRenderbuffer,N,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(re){t.bindTexture(n.TEXTURE_CUBE_MAP,me.__webglTexture),se(n.TEXTURE_CUBE_MAP,A);for(let Ge=0;Ge<6;Ge++)if(A.mipmaps&&A.mipmaps.length>0)for(let Xe=0;Xe<A.mipmaps.length;Xe++)J(ee.__webglFramebuffer[Ge][Xe],N,A,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Ge,Xe);else J(ee.__webglFramebuffer[Ge],N,A,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Ge,0);m(A)&&_(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Oe){for(let Ge=0,Xe=ve.length;Ge<Xe;Ge++){const Gt=ve[Ge],Le=i.get(Gt);t.bindTexture(n.TEXTURE_2D,Le.__webglTexture),se(n.TEXTURE_2D,Gt),J(ee.__webglFramebuffer,N,Gt,n.COLOR_ATTACHMENT0+Ge,n.TEXTURE_2D,0),m(Gt)&&_(n.TEXTURE_2D)}t.unbindTexture()}else{let Ge=n.TEXTURE_2D;if((N.isWebGL3DRenderTarget||N.isWebGLArrayRenderTarget)&&(Ge=N.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(Ge,me.__webglTexture),se(Ge,A),A.mipmaps&&A.mipmaps.length>0)for(let Xe=0;Xe<A.mipmaps.length;Xe++)J(ee.__webglFramebuffer[Xe],N,A,n.COLOR_ATTACHMENT0,Ge,Xe);else J(ee.__webglFramebuffer,N,A,n.COLOR_ATTACHMENT0,Ge,0);m(A)&&_(Ge),t.unbindTexture()}N.depthBuffer&&et(N)}function _e(N){const A=N.textures;for(let ee=0,me=A.length;ee<me;ee++){const ve=A[ee];if(m(ve)){const re=N.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,Oe=i.get(ve).__webglTexture;t.bindTexture(re,Oe),_(re),t.unbindTexture()}}}const we=[],O=[];function wt(N){if(N.samples>0){if(Ee(N)===!1){const A=N.textures,ee=N.width,me=N.height;let ve=n.COLOR_BUFFER_BIT;const re=N.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Oe=i.get(N),Ge=A.length>1;if(Ge)for(let Xe=0;Xe<A.length;Xe++)t.bindFramebuffer(n.FRAMEBUFFER,Oe.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Xe,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,Oe.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Xe,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,Oe.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Oe.__webglFramebuffer);for(let Xe=0;Xe<A.length;Xe++){if(N.resolveDepthBuffer&&(N.depthBuffer&&(ve|=n.DEPTH_BUFFER_BIT),N.stencilBuffer&&N.resolveStencilBuffer&&(ve|=n.STENCIL_BUFFER_BIT)),Ge){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,Oe.__webglColorRenderbuffer[Xe]);const Gt=i.get(A[Xe]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,Gt,0)}n.blitFramebuffer(0,0,ee,me,0,0,ee,me,ve,n.NEAREST),l===!0&&(we.length=0,O.length=0,we.push(n.COLOR_ATTACHMENT0+Xe),N.depthBuffer&&N.resolveDepthBuffer===!1&&(we.push(re),O.push(re),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,O)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,we))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),Ge)for(let Xe=0;Xe<A.length;Xe++){t.bindFramebuffer(n.FRAMEBUFFER,Oe.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Xe,n.RENDERBUFFER,Oe.__webglColorRenderbuffer[Xe]);const Gt=i.get(A[Xe]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,Oe.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Xe,n.TEXTURE_2D,Gt,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Oe.__webglMultisampledFramebuffer)}else if(N.depthBuffer&&N.resolveDepthBuffer===!1&&l){const A=N.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[A])}}}function st(N){return Math.min(s.maxSamples,N.samples)}function Ee(N){const A=i.get(N);return N.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&A.__useRenderToTexture!==!1}function Fe(N){const A=a.render.frame;u.get(N)!==A&&(u.set(N,A),N.update())}function He(N,A){const ee=N.colorSpace,me=N.format,ve=N.type;return N.isCompressedTexture===!0||N.isVideoTexture===!0||ee!==di&&ee!==Vr&&(en.getTransfer(ee)===Rn?(me!==$i||ve!==gr)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",ee)),A}function rt(N){return typeof HTMLImageElement<"u"&&N instanceof HTMLImageElement?(c.width=N.naturalWidth||N.width,c.height=N.naturalHeight||N.height):typeof VideoFrame<"u"&&N instanceof VideoFrame?(c.width=N.displayWidth,c.height=N.displayHeight):(c.width=N.width,c.height=N.height),c}this.allocateTextureUnit=V,this.resetTextureUnits=R,this.setTexture2D=B,this.setTexture2DArray=te,this.setTexture3D=j,this.setTextureCube=oe,this.rebindTextures=Ue,this.setupRenderTarget=dt,this.updateRenderTargetMipmap=_e,this.updateMultisampleRenderTarget=wt,this.setupDepthRenderbuffer=et,this.setupFrameBufferTexture=J,this.useMultisampledRTT=Ee}function W8(n,e){function t(i,s=Vr){let r;const a=en.getTransfer(s);if(i===gr)return n.UNSIGNED_BYTE;if(i===Yg)return n.UNSIGNED_SHORT_4_4_4_4;if(i===Jg)return n.UNSIGNED_SHORT_5_5_5_1;if(i===aA)return n.UNSIGNED_INT_5_9_9_9_REV;if(i===sA)return n.BYTE;if(i===rA)return n.SHORT;if(i===tl)return n.UNSIGNED_SHORT;if(i===Xg)return n.INT;if(i===Pa)return n.UNSIGNED_INT;if(i===vs)return n.FLOAT;if(i===dl)return n.HALF_FLOAT;if(i===oA)return n.ALPHA;if(i===cA)return n.RGB;if(i===$i)return n.RGBA;if(i===lA)return n.LUMINANCE;if(i===uA)return n.LUMINANCE_ALPHA;if(i===Mo)return n.DEPTH_COMPONENT;if(i===Wo)return n.DEPTH_STENCIL;if(i===Qg)return n.RED;if(i===Zg)return n.RED_INTEGER;if(i===dA)return n.RG;if(i===$g)return n.RG_INTEGER;if(i===e0)return n.RGBA_INTEGER;if(i===Pu||i===Nu||i===Du||i===Lu)if(a===Rn)if(r=e.get("WEBGL_compressed_texture_s3tc_srgb"),r!==null){if(i===Pu)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===Nu)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===Du)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===Lu)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(r=e.get("WEBGL_compressed_texture_s3tc"),r!==null){if(i===Pu)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===Nu)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===Du)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===Lu)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===_m||i===vm||i===bm||i===ym)if(r=e.get("WEBGL_compressed_texture_pvrtc"),r!==null){if(i===_m)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===vm)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===bm)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===ym)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===Tm||i===Sm||i===Em)if(r=e.get("WEBGL_compressed_texture_etc"),r!==null){if(i===Tm||i===Sm)return a===Rn?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(i===Em)return a===Rn?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===Am||i===Cm||i===wm||i===Rm||i===km||i===Mm||i===xm||i===Im||i===Pm||i===Nm||i===Dm||i===Lm||i===Om||i===Um)if(r=e.get("WEBGL_compressed_texture_astc"),r!==null){if(i===Am)return a===Rn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===Cm)return a===Rn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===wm)return a===Rn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===Rm)return a===Rn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===km)return a===Rn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===Mm)return a===Rn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===xm)return a===Rn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===Im)return a===Rn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===Pm)return a===Rn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===Nm)return a===Rn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===Dm)return a===Rn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===Lm)return a===Rn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===Om)return a===Rn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===Um)return a===Rn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===Ou||i===Fm||i===Bm)if(r=e.get("EXT_texture_compression_bptc"),r!==null){if(i===Ou)return a===Rn?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===Fm)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===Bm)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===hA||i===Vm||i===Gm||i===zm)if(r=e.get("EXT_texture_compression_rgtc"),r!==null){if(i===Ou)return r.COMPRESSED_RED_RGTC1_EXT;if(i===Vm)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===Gm)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===zm)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===Ho?n.UNSIGNED_INT_24_8:n[i]!==void 0?n[i]:null}return{convert:t}}class j8 extends Ei{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Sa extends Pn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const K8={type:"move"};class qf{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Sa,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Sa,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Z,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Z),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Sa,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Z,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Z),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let s=null,r=null,a=null;const o=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){a=!0;for(const v of e.hand.values()){const m=t.getJointPose(v,i),_=this._getHandJoint(c,v);m!==null&&(_.matrix.fromArray(m.transform.matrix),_.matrix.decompose(_.position,_.rotation,_.scale),_.matrixWorldNeedsUpdate=!0,_.jointRadius=m.radius),_.visible=m!==null}const u=c.joints["index-finger-tip"],d=c.joints["thumb-tip"],h=u.position.distanceTo(d.position),f=.02,g=.005;c.inputState.pinching&&h>f+g?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&h<=f-g&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(s=t.getPose(e.targetRaySpace,i),s===null&&r!==null&&(s=r),s!==null&&(o.matrix.fromArray(s.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,s.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(s.linearVelocity)):o.hasLinearVelocity=!1,s.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(s.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(K8)))}return o!==null&&(o.visible=s!==null),l!==null&&(l.visible=r!==null),c!==null&&(c.visible=a!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new Sa;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}const q8=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,X8=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class Y8{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,i){if(this.texture===null){const s=new ni,r=e.properties.get(s);r.__webglTexture=t.texture,(t.depthNear!=i.depthNear||t.depthFar!=i.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=s}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,i=new _r({vertexShader:q8,fragmentShader:X8,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Wi(new Fd(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class J8 extends Zo{constructor(e,t){super();const i=this;let s=null,r=1,a=null,o="local-floor",l=1,c=null,u=null,d=null,h=null,f=null,g=null;const v=new Y8,m=t.getContextAttributes();let _=null,y=null;const b=[],p=[],w=new Xt;let E=null;const C=new Ei;C.layers.enable(1),C.viewport=new rn;const M=new Ei;M.layers.enable(2),M.viewport=new rn;const I=[C,M],T=new j8;T.layers.enable(1),T.layers.enable(2);let R=null,V=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(L){let J=b[L];return J===void 0&&(J=new qf,b[L]=J),J.getTargetRaySpace()},this.getControllerGrip=function(L){let J=b[L];return J===void 0&&(J=new qf,b[L]=J),J.getGripSpace()},this.getHand=function(L){let J=b[L];return J===void 0&&(J=new qf,b[L]=J),J.getHandSpace()};function H(L){const J=p.indexOf(L.inputSource);if(J===-1)return;const U=b[J];U!==void 0&&(U.update(L.inputSource,L.frame,c||a),U.dispatchEvent({type:L.type,data:L.inputSource}))}function B(){s.removeEventListener("select",H),s.removeEventListener("selectstart",H),s.removeEventListener("selectend",H),s.removeEventListener("squeeze",H),s.removeEventListener("squeezestart",H),s.removeEventListener("squeezeend",H),s.removeEventListener("end",B),s.removeEventListener("inputsourceschange",te);for(let L=0;L<b.length;L++){const J=p[L];J!==null&&(p[L]=null,b[L].disconnect(J))}R=null,V=null,v.reset(),e.setRenderTarget(_),f=null,h=null,d=null,s=null,y=null,ge.stop(),i.isPresenting=!1,e.setPixelRatio(E),e.setSize(w.width,w.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(L){r=L,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(L){o=L,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||a},this.setReferenceSpace=function(L){c=L},this.getBaseLayer=function(){return h!==null?h:f},this.getBinding=function(){return d},this.getFrame=function(){return g},this.getSession=function(){return s},this.setSession=async function(L){if(s=L,s!==null){if(_=e.getRenderTarget(),s.addEventListener("select",H),s.addEventListener("selectstart",H),s.addEventListener("selectend",H),s.addEventListener("squeeze",H),s.addEventListener("squeezestart",H),s.addEventListener("squeezeend",H),s.addEventListener("end",B),s.addEventListener("inputsourceschange",te),m.xrCompatible!==!0&&await t.makeXRCompatible(),E=e.getPixelRatio(),e.getSize(w),s.renderState.layers===void 0){const J={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:r};f=new XRWebGLLayer(s,t,J),s.updateRenderState({baseLayer:f}),e.setPixelRatio(1),e.setSize(f.framebufferWidth,f.framebufferHeight,!1),y=new Na(f.framebufferWidth,f.framebufferHeight,{format:$i,type:gr,colorSpace:e.outputColorSpace,stencilBuffer:m.stencil})}else{let J=null,U=null,de=null;m.depth&&(de=m.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,J=m.stencil?Wo:Mo,U=m.stencil?Ho:Pa);const et={colorFormat:t.RGBA8,depthFormat:de,scaleFactor:r};d=new XRWebGLBinding(s,t),h=d.createProjectionLayer(et),s.updateRenderState({layers:[h]}),e.setPixelRatio(1),e.setSize(h.textureWidth,h.textureHeight,!1),y=new Na(h.textureWidth,h.textureHeight,{format:$i,type:gr,depthTexture:new RA(h.textureWidth,h.textureHeight,U,void 0,void 0,void 0,void 0,void 0,void 0,J),stencilBuffer:m.stencil,colorSpace:e.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:h.ignoreDepthValues===!1})}y.isXRRenderTarget=!0,this.setFoveation(l),c=null,a=await s.requestReferenceSpace(o),ge.setContext(s),ge.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode},this.getDepthTexture=function(){return v.getDepthTexture()};function te(L){for(let J=0;J<L.removed.length;J++){const U=L.removed[J],de=p.indexOf(U);de>=0&&(p[de]=null,b[de].disconnect(U))}for(let J=0;J<L.added.length;J++){const U=L.added[J];let de=p.indexOf(U);if(de===-1){for(let Ue=0;Ue<b.length;Ue++)if(Ue>=p.length){p.push(U),de=Ue;break}else if(p[Ue]===null){p[Ue]=U,de=Ue;break}if(de===-1)break}const et=b[de];et&&et.connect(U)}}const j=new Z,oe=new Z;function z(L,J,U){j.setFromMatrixPosition(J.matrixWorld),oe.setFromMatrixPosition(U.matrixWorld);const de=j.distanceTo(oe),et=J.projectionMatrix.elements,Ue=U.projectionMatrix.elements,dt=et[14]/(et[10]-1),_e=et[14]/(et[10]+1),we=(et[9]+1)/et[5],O=(et[9]-1)/et[5],wt=(et[8]-1)/et[0],st=(Ue[8]+1)/Ue[0],Ee=dt*wt,Fe=dt*st,He=de/(-wt+st),rt=He*-wt;if(J.matrixWorld.decompose(L.position,L.quaternion,L.scale),L.translateX(rt),L.translateZ(He),L.matrixWorld.compose(L.position,L.quaternion,L.scale),L.matrixWorldInverse.copy(L.matrixWorld).invert(),et[10]===-1)L.projectionMatrix.copy(J.projectionMatrix),L.projectionMatrixInverse.copy(J.projectionMatrixInverse);else{const N=dt+He,A=_e+He,ee=Ee-rt,me=Fe+(de-rt),ve=we*_e/A*N,re=O*_e/A*N;L.projectionMatrix.makePerspective(ee,me,ve,re,N,A),L.projectionMatrixInverse.copy(L.projectionMatrix).invert()}}function W(L,J){J===null?L.matrixWorld.copy(L.matrix):L.matrixWorld.multiplyMatrices(J.matrixWorld,L.matrix),L.matrixWorldInverse.copy(L.matrixWorld).invert()}this.updateCamera=function(L){if(s===null)return;let J=L.near,U=L.far;v.texture!==null&&(v.depthNear>0&&(J=v.depthNear),v.depthFar>0&&(U=v.depthFar)),T.near=M.near=C.near=J,T.far=M.far=C.far=U,(R!==T.near||V!==T.far)&&(s.updateRenderState({depthNear:T.near,depthFar:T.far}),R=T.near,V=T.far);const de=L.parent,et=T.cameras;W(T,de);for(let Ue=0;Ue<et.length;Ue++)W(et[Ue],de);et.length===2?z(T,C,M):T.projectionMatrix.copy(C.projectionMatrix),ie(L,T,de)};function ie(L,J,U){U===null?L.matrix.copy(J.matrixWorld):(L.matrix.copy(U.matrixWorld),L.matrix.invert(),L.matrix.multiply(J.matrixWorld)),L.matrix.decompose(L.position,L.quaternion,L.scale),L.updateMatrixWorld(!0),L.projectionMatrix.copy(J.projectionMatrix),L.projectionMatrixInverse.copy(J.projectionMatrixInverse),L.isPerspectiveCamera&&(L.fov=jo*2*Math.atan(1/L.projectionMatrix.elements[5]),L.zoom=1)}this.getCamera=function(){return T},this.getFoveation=function(){if(!(h===null&&f===null))return l},this.setFoveation=function(L){l=L,h!==null&&(h.fixedFoveation=L),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=L)},this.hasDepthSensing=function(){return v.texture!==null},this.getDepthSensingMesh=function(){return v.getMesh(T)};let se=null;function je(L,J){if(u=J.getViewerPose(c||a),g=J,u!==null){const U=u.views;f!==null&&(e.setRenderTargetFramebuffer(y,f.framebuffer),e.setRenderTarget(y));let de=!1;U.length!==T.cameras.length&&(T.cameras.length=0,de=!0);for(let Ue=0;Ue<U.length;Ue++){const dt=U[Ue];let _e=null;if(f!==null)_e=f.getViewport(dt);else{const O=d.getViewSubImage(h,dt);_e=O.viewport,Ue===0&&(e.setRenderTargetTextures(y,O.colorTexture,h.ignoreDepthValues?void 0:O.depthStencilTexture),e.setRenderTarget(y))}let we=I[Ue];we===void 0&&(we=new Ei,we.layers.enable(Ue),we.viewport=new rn,I[Ue]=we),we.matrix.fromArray(dt.transform.matrix),we.matrix.decompose(we.position,we.quaternion,we.scale),we.projectionMatrix.fromArray(dt.projectionMatrix),we.projectionMatrixInverse.copy(we.projectionMatrix).invert(),we.viewport.set(_e.x,_e.y,_e.width,_e.height),Ue===0&&(T.matrix.copy(we.matrix),T.matrix.decompose(T.position,T.quaternion,T.scale)),de===!0&&T.cameras.push(we)}const et=s.enabledFeatures;if(et&&et.includes("depth-sensing")){const Ue=d.getDepthInformation(U[0]);Ue&&Ue.isValid&&Ue.texture&&v.init(e,Ue,s.renderState)}}for(let U=0;U<b.length;U++){const de=p[U],et=b[U];de!==null&&et!==void 0&&et.update(de,J,c||a)}se&&se(L,J),J.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:J}),g=null}const ge=new wA;ge.setAnimationLoop(je),this.setAnimationLoop=function(L){se=L},this.dispose=function(){}}}const ha=new Us,Q8=new xt;function Z8(n,e){function t(m,_){m.matrixAutoUpdate===!0&&m.updateMatrix(),_.value.copy(m.matrix)}function i(m,_){_.color.getRGB(m.fogColor.value,EA(n)),_.isFog?(m.fogNear.value=_.near,m.fogFar.value=_.far):_.isFogExp2&&(m.fogDensity.value=_.density)}function s(m,_,y,b,p){_.isMeshBasicMaterial||_.isMeshLambertMaterial?r(m,_):_.isMeshToonMaterial?(r(m,_),d(m,_)):_.isMeshPhongMaterial?(r(m,_),u(m,_)):_.isMeshStandardMaterial?(r(m,_),h(m,_),_.isMeshPhysicalMaterial&&f(m,_,p)):_.isMeshMatcapMaterial?(r(m,_),g(m,_)):_.isMeshDepthMaterial?r(m,_):_.isMeshDistanceMaterial?(r(m,_),v(m,_)):_.isMeshNormalMaterial?r(m,_):_.isLineBasicMaterial?(a(m,_),_.isLineDashedMaterial&&o(m,_)):_.isPointsMaterial?l(m,_,y,b):_.isSpriteMaterial?c(m,_):_.isShadowMaterial?(m.color.value.copy(_.color),m.opacity.value=_.opacity):_.isShaderMaterial&&(_.uniformsNeedUpdate=!1)}function r(m,_){m.opacity.value=_.opacity,_.color&&m.diffuse.value.copy(_.color),_.emissive&&m.emissive.value.copy(_.emissive).multiplyScalar(_.emissiveIntensity),_.map&&(m.map.value=_.map,t(_.map,m.mapTransform)),_.alphaMap&&(m.alphaMap.value=_.alphaMap,t(_.alphaMap,m.alphaMapTransform)),_.bumpMap&&(m.bumpMap.value=_.bumpMap,t(_.bumpMap,m.bumpMapTransform),m.bumpScale.value=_.bumpScale,_.side===Pi&&(m.bumpScale.value*=-1)),_.normalMap&&(m.normalMap.value=_.normalMap,t(_.normalMap,m.normalMapTransform),m.normalScale.value.copy(_.normalScale),_.side===Pi&&m.normalScale.value.negate()),_.displacementMap&&(m.displacementMap.value=_.displacementMap,t(_.displacementMap,m.displacementMapTransform),m.displacementScale.value=_.displacementScale,m.displacementBias.value=_.displacementBias),_.emissiveMap&&(m.emissiveMap.value=_.emissiveMap,t(_.emissiveMap,m.emissiveMapTransform)),_.specularMap&&(m.specularMap.value=_.specularMap,t(_.specularMap,m.specularMapTransform)),_.alphaTest>0&&(m.alphaTest.value=_.alphaTest);const y=e.get(_),b=y.envMap,p=y.envMapRotation;b&&(m.envMap.value=b,ha.copy(p),ha.x*=-1,ha.y*=-1,ha.z*=-1,b.isCubeTexture&&b.isRenderTargetTexture===!1&&(ha.y*=-1,ha.z*=-1),m.envMapRotation.value.setFromMatrix4(Q8.makeRotationFromEuler(ha)),m.flipEnvMap.value=b.isCubeTexture&&b.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=_.reflectivity,m.ior.value=_.ior,m.refractionRatio.value=_.refractionRatio),_.lightMap&&(m.lightMap.value=_.lightMap,m.lightMapIntensity.value=_.lightMapIntensity,t(_.lightMap,m.lightMapTransform)),_.aoMap&&(m.aoMap.value=_.aoMap,m.aoMapIntensity.value=_.aoMapIntensity,t(_.aoMap,m.aoMapTransform))}function a(m,_){m.diffuse.value.copy(_.color),m.opacity.value=_.opacity,_.map&&(m.map.value=_.map,t(_.map,m.mapTransform))}function o(m,_){m.dashSize.value=_.dashSize,m.totalSize.value=_.dashSize+_.gapSize,m.scale.value=_.scale}function l(m,_,y,b){m.diffuse.value.copy(_.color),m.opacity.value=_.opacity,m.size.value=_.size*y,m.scale.value=b*.5,_.map&&(m.map.value=_.map,t(_.map,m.uvTransform)),_.alphaMap&&(m.alphaMap.value=_.alphaMap,t(_.alphaMap,m.alphaMapTransform)),_.alphaTest>0&&(m.alphaTest.value=_.alphaTest)}function c(m,_){m.diffuse.value.copy(_.color),m.opacity.value=_.opacity,m.rotation.value=_.rotation,_.map&&(m.map.value=_.map,t(_.map,m.mapTransform)),_.alphaMap&&(m.alphaMap.value=_.alphaMap,t(_.alphaMap,m.alphaMapTransform)),_.alphaTest>0&&(m.alphaTest.value=_.alphaTest)}function u(m,_){m.specular.value.copy(_.specular),m.shininess.value=Math.max(_.shininess,1e-4)}function d(m,_){_.gradientMap&&(m.gradientMap.value=_.gradientMap)}function h(m,_){m.metalness.value=_.metalness,_.metalnessMap&&(m.metalnessMap.value=_.metalnessMap,t(_.metalnessMap,m.metalnessMapTransform)),m.roughness.value=_.roughness,_.roughnessMap&&(m.roughnessMap.value=_.roughnessMap,t(_.roughnessMap,m.roughnessMapTransform)),_.envMap&&(m.envMapIntensity.value=_.envMapIntensity)}function f(m,_,y){m.ior.value=_.ior,_.sheen>0&&(m.sheenColor.value.copy(_.sheenColor).multiplyScalar(_.sheen),m.sheenRoughness.value=_.sheenRoughness,_.sheenColorMap&&(m.sheenColorMap.value=_.sheenColorMap,t(_.sheenColorMap,m.sheenColorMapTransform)),_.sheenRoughnessMap&&(m.sheenRoughnessMap.value=_.sheenRoughnessMap,t(_.sheenRoughnessMap,m.sheenRoughnessMapTransform))),_.clearcoat>0&&(m.clearcoat.value=_.clearcoat,m.clearcoatRoughness.value=_.clearcoatRoughness,_.clearcoatMap&&(m.clearcoatMap.value=_.clearcoatMap,t(_.clearcoatMap,m.clearcoatMapTransform)),_.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=_.clearcoatRoughnessMap,t(_.clearcoatRoughnessMap,m.clearcoatRoughnessMapTransform)),_.clearcoatNormalMap&&(m.clearcoatNormalMap.value=_.clearcoatNormalMap,t(_.clearcoatNormalMap,m.clearcoatNormalMapTransform),m.clearcoatNormalScale.value.copy(_.clearcoatNormalScale),_.side===Pi&&m.clearcoatNormalScale.value.negate())),_.dispersion>0&&(m.dispersion.value=_.dispersion),_.iridescence>0&&(m.iridescence.value=_.iridescence,m.iridescenceIOR.value=_.iridescenceIOR,m.iridescenceThicknessMinimum.value=_.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=_.iridescenceThicknessRange[1],_.iridescenceMap&&(m.iridescenceMap.value=_.iridescenceMap,t(_.iridescenceMap,m.iridescenceMapTransform)),_.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=_.iridescenceThicknessMap,t(_.iridescenceThicknessMap,m.iridescenceThicknessMapTransform))),_.transmission>0&&(m.transmission.value=_.transmission,m.transmissionSamplerMap.value=y.texture,m.transmissionSamplerSize.value.set(y.width,y.height),_.transmissionMap&&(m.transmissionMap.value=_.transmissionMap,t(_.transmissionMap,m.transmissionMapTransform)),m.thickness.value=_.thickness,_.thicknessMap&&(m.thicknessMap.value=_.thicknessMap,t(_.thicknessMap,m.thicknessMapTransform)),m.attenuationDistance.value=_.attenuationDistance,m.attenuationColor.value.copy(_.attenuationColor)),_.anisotropy>0&&(m.anisotropyVector.value.set(_.anisotropy*Math.cos(_.anisotropyRotation),_.anisotropy*Math.sin(_.anisotropyRotation)),_.anisotropyMap&&(m.anisotropyMap.value=_.anisotropyMap,t(_.anisotropyMap,m.anisotropyMapTransform))),m.specularIntensity.value=_.specularIntensity,m.specularColor.value.copy(_.specularColor),_.specularColorMap&&(m.specularColorMap.value=_.specularColorMap,t(_.specularColorMap,m.specularColorMapTransform)),_.specularIntensityMap&&(m.specularIntensityMap.value=_.specularIntensityMap,t(_.specularIntensityMap,m.specularIntensityMapTransform))}function g(m,_){_.matcap&&(m.matcap.value=_.matcap)}function v(m,_){const y=e.get(_).light;m.referencePosition.value.setFromMatrixPosition(y.matrixWorld),m.nearDistance.value=y.shadow.camera.near,m.farDistance.value=y.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:s}}function $8(n,e,t,i){let s={},r={},a=[];const o=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function l(y,b){const p=b.program;i.uniformBlockBinding(y,p)}function c(y,b){let p=s[y.id];p===void 0&&(g(y),p=u(y),s[y.id]=p,y.addEventListener("dispose",m));const w=b.program;i.updateUBOMapping(y,w);const E=e.render.frame;r[y.id]!==E&&(h(y),r[y.id]=E)}function u(y){const b=d();y.__bindingPointIndex=b;const p=n.createBuffer(),w=y.__size,E=y.usage;return n.bindBuffer(n.UNIFORM_BUFFER,p),n.bufferData(n.UNIFORM_BUFFER,w,E),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,b,p),p}function d(){for(let y=0;y<o;y++)if(a.indexOf(y)===-1)return a.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function h(y){const b=s[y.id],p=y.uniforms,w=y.__cache;n.bindBuffer(n.UNIFORM_BUFFER,b);for(let E=0,C=p.length;E<C;E++){const M=Array.isArray(p[E])?p[E]:[p[E]];for(let I=0,T=M.length;I<T;I++){const R=M[I];if(f(R,E,I,w)===!0){const V=R.__offset,H=Array.isArray(R.value)?R.value:[R.value];let B=0;for(let te=0;te<H.length;te++){const j=H[te],oe=v(j);typeof j=="number"||typeof j=="boolean"?(R.__data[0]=j,n.bufferSubData(n.UNIFORM_BUFFER,V+B,R.__data)):j.isMatrix3?(R.__data[0]=j.elements[0],R.__data[1]=j.elements[1],R.__data[2]=j.elements[2],R.__data[3]=0,R.__data[4]=j.elements[3],R.__data[5]=j.elements[4],R.__data[6]=j.elements[5],R.__data[7]=0,R.__data[8]=j.elements[6],R.__data[9]=j.elements[7],R.__data[10]=j.elements[8],R.__data[11]=0):(j.toArray(R.__data,B),B+=oe.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,V,R.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function f(y,b,p,w){const E=y.value,C=b+"_"+p;if(w[C]===void 0)return typeof E=="number"||typeof E=="boolean"?w[C]=E:w[C]=E.clone(),!0;{const M=w[C];if(typeof E=="number"||typeof E=="boolean"){if(M!==E)return w[C]=E,!0}else if(M.equals(E)===!1)return M.copy(E),!0}return!1}function g(y){const b=y.uniforms;let p=0;const w=16;for(let C=0,M=b.length;C<M;C++){const I=Array.isArray(b[C])?b[C]:[b[C]];for(let T=0,R=I.length;T<R;T++){const V=I[T],H=Array.isArray(V.value)?V.value:[V.value];for(let B=0,te=H.length;B<te;B++){const j=H[B],oe=v(j),z=p%w,W=z%oe.boundary,ie=z+W;p+=W,ie!==0&&w-ie<oe.storage&&(p+=w-ie),V.__data=new Float32Array(oe.storage/Float32Array.BYTES_PER_ELEMENT),V.__offset=p,p+=oe.storage}}}const E=p%w;return E>0&&(p+=w-E),y.__size=p,y.__cache={},this}function v(y){const b={boundary:0,storage:0};return typeof y=="number"||typeof y=="boolean"?(b.boundary=4,b.storage=4):y.isVector2?(b.boundary=8,b.storage=8):y.isVector3||y.isColor?(b.boundary=16,b.storage=12):y.isVector4?(b.boundary=16,b.storage=16):y.isMatrix3?(b.boundary=48,b.storage=48):y.isMatrix4?(b.boundary=64,b.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),b}function m(y){const b=y.target;b.removeEventListener("dispose",m);const p=a.indexOf(b.__bindingPointIndex);a.splice(p,1),n.deleteBuffer(s[b.id]),delete s[b.id],delete r[b.id]}function _(){for(const y in s)n.deleteBuffer(s[y]);a=[],s={},r={}}return{bind:l,update:c,dispose:_}}class e9{constructor(e={}){const{canvas:t=GU(),context:i=null,depth:s=!0,stencil:r=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:d=!1}=e;this.isWebGLRenderer=!0;let h;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");h=i.getContextAttributes().alpha}else h=a;const f=new Uint32Array(4),g=new Int32Array(4);let v=null,m=null;const _=[],y=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Si,this.toneMapping=Xr,this.toneMappingExposure=1;const b=this;let p=!1,w=0,E=0,C=null,M=-1,I=null;const T=new rn,R=new rn;let V=null;const H=new Rt(0);let B=0,te=t.width,j=t.height,oe=1,z=null,W=null;const ie=new rn(0,0,te,j),se=new rn(0,0,te,j);let je=!1;const ge=new i0;let L=!1,J=!1;const U=new xt,de=new xt,et=new Z,Ue=new rn,dt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let _e=!1;function we(){return C===null?oe:1}let O=i;function wt(k,Q){return t.getContext(k,Q)}try{const k={alpha:!0,depth:s,stencil:r,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:d};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Kg}`),t.addEventListener("webglcontextlost",Me,!1),t.addEventListener("webglcontextrestored",Je,!1),t.addEventListener("webglcontextcreationerror",nt,!1),O===null){const Q="webgl2";if(O=wt(Q,k),O===null)throw wt(Q)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(k){throw console.error("THREE.WebGLRenderer: "+k.message),k}let st,Ee,Fe,He,rt,N,A,ee,me,ve,re,Oe,Ge,Xe,Gt,Le,Ye,yt,vt,it,jt,kt,An,Y;function tt(){st=new r6(O),st.init(),kt=new W8(O,st),Ee=new $B(O,st,e,kt),Fe=new G8(O),Ee.reverseDepthBuffer&&Fe.buffers.depth.setReversed(!0),He=new c6(O),rt=new w8,N=new H8(O,st,Fe,rt,Ee,kt,He),A=new t6(b),ee=new s6(b),me=new m5(O),An=new QB(O,me),ve=new a6(O,me,He,An),re=new u6(O,ve,me,He),vt=new l6(O,Ee,N),Le=new e6(rt),Oe=new C8(b,A,ee,st,Ee,An,Le),Ge=new Z8(b,rt),Xe=new k8,Gt=new D8(st),yt=new JB(b,A,ee,Fe,re,h,l),Ye=new B8(b,re,Ee),Y=new $8(O,He,Ee,Fe),it=new ZB(O,st,He),jt=new o6(O,st,He),He.programs=Oe.programs,b.capabilities=Ee,b.extensions=st,b.properties=rt,b.renderLists=Xe,b.shadowMap=Ye,b.state=Fe,b.info=He}tt();const pe=new J8(b,O);this.xr=pe,this.getContext=function(){return O},this.getContextAttributes=function(){return O.getContextAttributes()},this.forceContextLoss=function(){const k=st.get("WEBGL_lose_context");k&&k.loseContext()},this.forceContextRestore=function(){const k=st.get("WEBGL_lose_context");k&&k.restoreContext()},this.getPixelRatio=function(){return oe},this.setPixelRatio=function(k){k!==void 0&&(oe=k,this.setSize(te,j,!1))},this.getSize=function(k){return k.set(te,j)},this.setSize=function(k,Q,le=!0){if(pe.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}te=k,j=Q,t.width=Math.floor(k*oe),t.height=Math.floor(Q*oe),le===!0&&(t.style.width=k+"px",t.style.height=Q+"px"),this.setViewport(0,0,k,Q)},this.getDrawingBufferSize=function(k){return k.set(te*oe,j*oe).floor()},this.setDrawingBufferSize=function(k,Q,le){te=k,j=Q,oe=le,t.width=Math.floor(k*le),t.height=Math.floor(Q*le),this.setViewport(0,0,k,Q)},this.getCurrentViewport=function(k){return k.copy(T)},this.getViewport=function(k){return k.copy(ie)},this.setViewport=function(k,Q,le,ue){k.isVector4?ie.set(k.x,k.y,k.z,k.w):ie.set(k,Q,le,ue),Fe.viewport(T.copy(ie).multiplyScalar(oe).round())},this.getScissor=function(k){return k.copy(se)},this.setScissor=function(k,Q,le,ue){k.isVector4?se.set(k.x,k.y,k.z,k.w):se.set(k,Q,le,ue),Fe.scissor(R.copy(se).multiplyScalar(oe).round())},this.getScissorTest=function(){return je},this.setScissorTest=function(k){Fe.setScissorTest(je=k)},this.setOpaqueSort=function(k){z=k},this.setTransparentSort=function(k){W=k},this.getClearColor=function(k){return k.copy(yt.getClearColor())},this.setClearColor=function(){yt.setClearColor.apply(yt,arguments)},this.getClearAlpha=function(){return yt.getClearAlpha()},this.setClearAlpha=function(){yt.setClearAlpha.apply(yt,arguments)},this.clear=function(k=!0,Q=!0,le=!0){let ue=0;if(k){let $=!1;if(C!==null){const Be=C.texture.format;$=Be===e0||Be===$g||Be===Zg}if($){const Be=C.texture.type,Qe=Be===gr||Be===Pa||Be===tl||Be===Ho||Be===Yg||Be===Jg,at=yt.getClearColor(),ot=yt.getClearAlpha(),St=at.r,At=at.g,ht=at.b;Qe?(f[0]=St,f[1]=At,f[2]=ht,f[3]=ot,O.clearBufferuiv(O.COLOR,0,f)):(g[0]=St,g[1]=At,g[2]=ht,g[3]=ot,O.clearBufferiv(O.COLOR,0,g))}else ue|=O.COLOR_BUFFER_BIT}Q&&(ue|=O.DEPTH_BUFFER_BIT,O.clearDepth(this.capabilities.reverseDepthBuffer?0:1)),le&&(ue|=O.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),O.clear(ue)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Me,!1),t.removeEventListener("webglcontextrestored",Je,!1),t.removeEventListener("webglcontextcreationerror",nt,!1),Xe.dispose(),Gt.dispose(),rt.dispose(),A.dispose(),ee.dispose(),re.dispose(),An.dispose(),Y.dispose(),Oe.dispose(),pe.dispose(),pe.removeEventListener("sessionstart",m0),pe.removeEventListener("sessionend",g0),ia.stop()};function Me(k){k.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),p=!0}function Je(){console.log("THREE.WebGLRenderer: Context Restored."),p=!1;const k=He.autoReset,Q=Ye.enabled,le=Ye.autoUpdate,ue=Ye.needsUpdate,$=Ye.type;tt(),He.autoReset=k,Ye.enabled=Q,Ye.autoUpdate=le,Ye.needsUpdate=ue,Ye.type=$}function nt(k){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",k.statusMessage)}function Yt(k){const Q=k.target;Q.removeEventListener("dispose",Yt),Wn(Q)}function Wn(k){wi(k),rt.remove(k)}function wi(k){const Q=rt.get(k).programs;Q!==void 0&&(Q.forEach(function(le){Oe.releaseProgram(le)}),k.isShaderMaterial&&Oe.releaseShaderCache(k))}this.renderBufferDirect=function(k,Q,le,ue,$,Be){Q===null&&(Q=dt);const Qe=$.isMesh&&$.matrixWorld.determinant()<0,at=KA(k,Q,le,ue,$);Fe.setMaterial(ue,Qe);let ot=le.index,St=1;if(ue.wireframe===!0){if(ot=ve.getWireframeAttribute(le),ot===void 0)return;St=2}const At=le.drawRange,ht=le.attributes.position;let fn=At.start*St,Cn=(At.start+At.count)*St;Be!==null&&(fn=Math.max(fn,Be.start*St),Cn=Math.min(Cn,(Be.start+Be.count)*St)),ot!==null?(fn=Math.max(fn,0),Cn=Math.min(Cn,ot.count)):ht!=null&&(fn=Math.max(fn,0),Cn=Math.min(Cn,ht.count));const Ln=Cn-fn;if(Ln<0||Ln===1/0)return;An.setup($,ue,at,le,ot);let Ni,an=it;if(ot!==null&&(Ni=me.get(ot),an=jt,an.setIndex(Ni)),$.isMesh)ue.wireframe===!0?(Fe.setLineWidth(ue.wireframeLinewidth*we()),an.setMode(O.LINES)):an.setMode(O.TRIANGLES);else if($.isLine){let mt=ue.linewidth;mt===void 0&&(mt=1),Fe.setLineWidth(mt*we()),$.isLineSegments?an.setMode(O.LINES):$.isLineLoop?an.setMode(O.LINE_LOOP):an.setMode(O.LINE_STRIP)}else $.isPoints?an.setMode(O.POINTS):$.isSprite&&an.setMode(O.TRIANGLES);if($.isBatchedMesh)if($._multiDrawInstances!==null)an.renderMultiDrawInstances($._multiDrawStarts,$._multiDrawCounts,$._multiDrawCount,$._multiDrawInstances);else if(st.get("WEBGL_multi_draw"))an.renderMultiDraw($._multiDrawStarts,$._multiDrawCounts,$._multiDrawCount);else{const mt=$._multiDrawStarts,oi=$._multiDrawCounts,on=$._multiDrawCount,ts=ot?me.get(ot).bytesPerElement:1,Ga=rt.get(ue).currentProgram.getUniforms();for(let Di=0;Di<on;Di++)Ga.setValue(O,"_gl_DrawID",Di),an.render(mt[Di]/ts,oi[Di])}else if($.isInstancedMesh)an.renderInstances(fn,Ln,$.count);else if(le.isInstancedBufferGeometry){const mt=le._maxInstanceCount!==void 0?le._maxInstanceCount:1/0,oi=Math.min(le.instanceCount,mt);an.renderInstances(fn,Ln,oi)}else an.render(fn,Ln)};function tn(k,Q,le){k.transparent===!0&&k.side===Is&&k.forceSinglePass===!1?(k.side=Pi,k.needsUpdate=!0,gl(k,Q,le),k.side=mr,k.needsUpdate=!0,gl(k,Q,le),k.side=Is):gl(k,Q,le)}this.compile=function(k,Q,le=null){le===null&&(le=k),m=Gt.get(le),m.init(Q),y.push(m),le.traverseVisible(function($){$.isLight&&$.layers.test(Q.layers)&&(m.pushLight($),$.castShadow&&m.pushShadow($))}),k!==le&&k.traverseVisible(function($){$.isLight&&$.layers.test(Q.layers)&&(m.pushLight($),$.castShadow&&m.pushShadow($))}),m.setupLights();const ue=new Set;return k.traverse(function($){if(!($.isMesh||$.isPoints||$.isLine||$.isSprite))return;const Be=$.material;if(Be)if(Array.isArray(Be))for(let Qe=0;Qe<Be.length;Qe++){const at=Be[Qe];tn(at,le,$),ue.add(at)}else tn(Be,le,$),ue.add(Be)}),y.pop(),m=null,ue},this.compileAsync=function(k,Q,le=null){const ue=this.compile(k,Q,le);return new Promise($=>{function Be(){if(ue.forEach(function(Qe){rt.get(Qe).currentProgram.isReady()&&ue.delete(Qe)}),ue.size===0){$(k);return}setTimeout(Be,10)}st.get("KHR_parallel_shader_compile")!==null?Be():setTimeout(Be,10)})};let Ri=null;function zs(k){Ri&&Ri(k)}function m0(){ia.stop()}function g0(){ia.start()}const ia=new wA;ia.setAnimationLoop(zs),typeof self<"u"&&ia.setContext(self),this.setAnimationLoop=function(k){Ri=k,pe.setAnimationLoop(k),k===null?ia.stop():ia.start()},pe.addEventListener("sessionstart",m0),pe.addEventListener("sessionend",g0),this.render=function(k,Q){if(Q!==void 0&&Q.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(p===!0)return;if(k.matrixWorldAutoUpdate===!0&&k.updateMatrixWorld(),Q.parent===null&&Q.matrixWorldAutoUpdate===!0&&Q.updateMatrixWorld(),pe.enabled===!0&&pe.isPresenting===!0&&(pe.cameraAutoUpdate===!0&&pe.updateCamera(Q),Q=pe.getCamera()),k.isScene===!0&&k.onBeforeRender(b,k,Q,C),m=Gt.get(k,y.length),m.init(Q),y.push(m),de.multiplyMatrices(Q.projectionMatrix,Q.matrixWorldInverse),ge.setFromProjectionMatrix(de),J=this.localClippingEnabled,L=Le.init(this.clippingPlanes,J),v=Xe.get(k,_.length),v.init(),_.push(v),pe.enabled===!0&&pe.isPresenting===!0){const Be=b.xr.getDepthSensingMesh();Be!==null&&Gd(Be,Q,-1/0,b.sortObjects)}Gd(k,Q,0,b.sortObjects),v.finish(),b.sortObjects===!0&&v.sort(z,W),_e=pe.enabled===!1||pe.isPresenting===!1||pe.hasDepthSensing()===!1,_e&&yt.addToRenderList(v,k),this.info.render.frame++,L===!0&&Le.beginShadows();const le=m.state.shadowsArray;Ye.render(le,k,Q),L===!0&&Le.endShadows(),this.info.autoReset===!0&&this.info.reset();const ue=v.opaque,$=v.transmissive;if(m.setupLights(),Q.isArrayCamera){const Be=Q.cameras;if($.length>0)for(let Qe=0,at=Be.length;Qe<at;Qe++){const ot=Be[Qe];v0(ue,$,k,ot)}_e&&yt.render(k);for(let Qe=0,at=Be.length;Qe<at;Qe++){const ot=Be[Qe];_0(v,k,ot,ot.viewport)}}else $.length>0&&v0(ue,$,k,Q),_e&&yt.render(k),_0(v,k,Q);C!==null&&(N.updateMultisampleRenderTarget(C),N.updateRenderTargetMipmap(C)),k.isScene===!0&&k.onAfterRender(b,k,Q),An.resetDefaultState(),M=-1,I=null,y.pop(),y.length>0?(m=y[y.length-1],L===!0&&Le.setGlobalState(b.clippingPlanes,m.state.camera)):m=null,_.pop(),_.length>0?v=_[_.length-1]:v=null};function Gd(k,Q,le,ue){if(k.visible===!1)return;if(k.layers.test(Q.layers)){if(k.isGroup)le=k.renderOrder;else if(k.isLOD)k.autoUpdate===!0&&k.update(Q);else if(k.isLight)m.pushLight(k),k.castShadow&&m.pushShadow(k);else if(k.isSprite){if(!k.frustumCulled||ge.intersectsSprite(k)){ue&&Ue.setFromMatrixPosition(k.matrixWorld).applyMatrix4(de);const Qe=re.update(k),at=k.material;at.visible&&v.push(k,Qe,at,le,Ue.z,null)}}else if((k.isMesh||k.isLine||k.isPoints)&&(!k.frustumCulled||ge.intersectsObject(k))){const Qe=re.update(k),at=k.material;if(ue&&(k.boundingSphere!==void 0?(k.boundingSphere===null&&k.computeBoundingSphere(),Ue.copy(k.boundingSphere.center)):(Qe.boundingSphere===null&&Qe.computeBoundingSphere(),Ue.copy(Qe.boundingSphere.center)),Ue.applyMatrix4(k.matrixWorld).applyMatrix4(de)),Array.isArray(at)){const ot=Qe.groups;for(let St=0,At=ot.length;St<At;St++){const ht=ot[St],fn=at[ht.materialIndex];fn&&fn.visible&&v.push(k,Qe,fn,le,Ue.z,ht)}}else at.visible&&v.push(k,Qe,at,le,Ue.z,null)}}const Be=k.children;for(let Qe=0,at=Be.length;Qe<at;Qe++)Gd(Be[Qe],Q,le,ue)}function _0(k,Q,le,ue){const $=k.opaque,Be=k.transmissive,Qe=k.transparent;m.setupLightsView(le),L===!0&&Le.setGlobalState(b.clippingPlanes,le),ue&&Fe.viewport(T.copy(ue)),$.length>0&&ml($,Q,le),Be.length>0&&ml(Be,Q,le),Qe.length>0&&ml(Qe,Q,le),Fe.buffers.depth.setTest(!0),Fe.buffers.depth.setMask(!0),Fe.buffers.color.setMask(!0),Fe.setPolygonOffset(!1)}function v0(k,Q,le,ue){if((le.isScene===!0?le.overrideMaterial:null)!==null)return;m.state.transmissionRenderTarget[ue.id]===void 0&&(m.state.transmissionRenderTarget[ue.id]=new Na(1,1,{generateMipmaps:!0,type:st.has("EXT_color_buffer_half_float")||st.has("EXT_color_buffer_float")?dl:gr,minFilter:lr,samples:4,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:en.workingColorSpace}));const Be=m.state.transmissionRenderTarget[ue.id],Qe=ue.viewport||T;Be.setSize(Qe.z,Qe.w);const at=b.getRenderTarget();b.setRenderTarget(Be),b.getClearColor(H),B=b.getClearAlpha(),B<1&&b.setClearColor(16777215,.5),b.clear(),_e&&yt.render(le);const ot=b.toneMapping;b.toneMapping=Xr;const St=ue.viewport;if(ue.viewport!==void 0&&(ue.viewport=void 0),m.setupLightsView(ue),L===!0&&Le.setGlobalState(b.clippingPlanes,ue),ml(k,le,ue),N.updateMultisampleRenderTarget(Be),N.updateRenderTargetMipmap(Be),st.has("WEBGL_multisampled_render_to_texture")===!1){let At=!1;for(let ht=0,fn=Q.length;ht<fn;ht++){const Cn=Q[ht],Ln=Cn.object,Ni=Cn.geometry,an=Cn.material,mt=Cn.group;if(an.side===Is&&Ln.layers.test(ue.layers)){const oi=an.side;an.side=Pi,an.needsUpdate=!0,b0(Ln,le,ue,Ni,an,mt),an.side=oi,an.needsUpdate=!0,At=!0}}At===!0&&(N.updateMultisampleRenderTarget(Be),N.updateRenderTargetMipmap(Be))}b.setRenderTarget(at),b.setClearColor(H,B),St!==void 0&&(ue.viewport=St),b.toneMapping=ot}function ml(k,Q,le){const ue=Q.isScene===!0?Q.overrideMaterial:null;for(let $=0,Be=k.length;$<Be;$++){const Qe=k[$],at=Qe.object,ot=Qe.geometry,St=ue===null?Qe.material:ue,At=Qe.group;at.layers.test(le.layers)&&b0(at,Q,le,ot,St,At)}}function b0(k,Q,le,ue,$,Be){k.onBeforeRender(b,Q,le,ue,$,Be),k.modelViewMatrix.multiplyMatrices(le.matrixWorldInverse,k.matrixWorld),k.normalMatrix.getNormalMatrix(k.modelViewMatrix),$.onBeforeRender(b,Q,le,ue,k,Be),$.transparent===!0&&$.side===Is&&$.forceSinglePass===!1?($.side=Pi,$.needsUpdate=!0,b.renderBufferDirect(le,Q,ue,$,k,Be),$.side=mr,$.needsUpdate=!0,b.renderBufferDirect(le,Q,ue,$,k,Be),$.side=Is):b.renderBufferDirect(le,Q,ue,$,k,Be),k.onAfterRender(b,Q,le,ue,$,Be)}function gl(k,Q,le){Q.isScene!==!0&&(Q=dt);const ue=rt.get(k),$=m.state.lights,Be=m.state.shadowsArray,Qe=$.state.version,at=Oe.getParameters(k,$.state,Be,Q,le),ot=Oe.getProgramCacheKey(at);let St=ue.programs;ue.environment=k.isMeshStandardMaterial?Q.environment:null,ue.fog=Q.fog,ue.envMap=(k.isMeshStandardMaterial?ee:A).get(k.envMap||ue.environment),ue.envMapRotation=ue.environment!==null&&k.envMap===null?Q.environmentRotation:k.envMapRotation,St===void 0&&(k.addEventListener("dispose",Yt),St=new Map,ue.programs=St);let At=St.get(ot);if(At!==void 0){if(ue.currentProgram===At&&ue.lightsStateVersion===Qe)return T0(k,at),At}else at.uniforms=Oe.getUniforms(k),k.onBeforeCompile(at,b),At=Oe.acquireProgram(at,ot),St.set(ot,At),ue.uniforms=at.uniforms;const ht=ue.uniforms;return(!k.isShaderMaterial&&!k.isRawShaderMaterial||k.clipping===!0)&&(ht.clippingPlanes=Le.uniform),T0(k,at),ue.needsLights=XA(k),ue.lightsStateVersion=Qe,ue.needsLights&&(ht.ambientLightColor.value=$.state.ambient,ht.lightProbe.value=$.state.probe,ht.directionalLights.value=$.state.directional,ht.directionalLightShadows.value=$.state.directionalShadow,ht.spotLights.value=$.state.spot,ht.spotLightShadows.value=$.state.spotShadow,ht.rectAreaLights.value=$.state.rectArea,ht.ltc_1.value=$.state.rectAreaLTC1,ht.ltc_2.value=$.state.rectAreaLTC2,ht.pointLights.value=$.state.point,ht.pointLightShadows.value=$.state.pointShadow,ht.hemisphereLights.value=$.state.hemi,ht.directionalShadowMap.value=$.state.directionalShadowMap,ht.directionalShadowMatrix.value=$.state.directionalShadowMatrix,ht.spotShadowMap.value=$.state.spotShadowMap,ht.spotLightMatrix.value=$.state.spotLightMatrix,ht.spotLightMap.value=$.state.spotLightMap,ht.pointShadowMap.value=$.state.pointShadowMap,ht.pointShadowMatrix.value=$.state.pointShadowMatrix),ue.currentProgram=At,ue.uniformsList=null,At}function y0(k){if(k.uniformsList===null){const Q=k.currentProgram.getUniforms();k.uniformsList=Fu.seqWithValue(Q.seq,k.uniforms)}return k.uniformsList}function T0(k,Q){const le=rt.get(k);le.outputColorSpace=Q.outputColorSpace,le.batching=Q.batching,le.batchingColor=Q.batchingColor,le.instancing=Q.instancing,le.instancingColor=Q.instancingColor,le.instancingMorph=Q.instancingMorph,le.skinning=Q.skinning,le.morphTargets=Q.morphTargets,le.morphNormals=Q.morphNormals,le.morphColors=Q.morphColors,le.morphTargetsCount=Q.morphTargetsCount,le.numClippingPlanes=Q.numClippingPlanes,le.numIntersection=Q.numClipIntersection,le.vertexAlphas=Q.vertexAlphas,le.vertexTangents=Q.vertexTangents,le.toneMapping=Q.toneMapping}function KA(k,Q,le,ue,$){Q.isScene!==!0&&(Q=dt),N.resetTextureUnits();const Be=Q.fog,Qe=ue.isMeshStandardMaterial?Q.environment:null,at=C===null?b.outputColorSpace:C.isXRRenderTarget===!0?C.texture.colorSpace:di,ot=(ue.isMeshStandardMaterial?ee:A).get(ue.envMap||Qe),St=ue.vertexColors===!0&&!!le.attributes.color&&le.attributes.color.itemSize===4,At=!!le.attributes.tangent&&(!!ue.normalMap||ue.anisotropy>0),ht=!!le.morphAttributes.position,fn=!!le.morphAttributes.normal,Cn=!!le.morphAttributes.color;let Ln=Xr;ue.toneMapped&&(C===null||C.isXRRenderTarget===!0)&&(Ln=b.toneMapping);const Ni=le.morphAttributes.position||le.morphAttributes.normal||le.morphAttributes.color,an=Ni!==void 0?Ni.length:0,mt=rt.get(ue),oi=m.state.lights;if(L===!0&&(J===!0||k!==I)){const Ki=k===I&&ue.id===M;Le.setState(ue,k,Ki)}let on=!1;ue.version===mt.__version?(mt.needsLights&&mt.lightsStateVersion!==oi.state.version||mt.outputColorSpace!==at||$.isBatchedMesh&&mt.batching===!1||!$.isBatchedMesh&&mt.batching===!0||$.isBatchedMesh&&mt.batchingColor===!0&&$.colorTexture===null||$.isBatchedMesh&&mt.batchingColor===!1&&$.colorTexture!==null||$.isInstancedMesh&&mt.instancing===!1||!$.isInstancedMesh&&mt.instancing===!0||$.isSkinnedMesh&&mt.skinning===!1||!$.isSkinnedMesh&&mt.skinning===!0||$.isInstancedMesh&&mt.instancingColor===!0&&$.instanceColor===null||$.isInstancedMesh&&mt.instancingColor===!1&&$.instanceColor!==null||$.isInstancedMesh&&mt.instancingMorph===!0&&$.morphTexture===null||$.isInstancedMesh&&mt.instancingMorph===!1&&$.morphTexture!==null||mt.envMap!==ot||ue.fog===!0&&mt.fog!==Be||mt.numClippingPlanes!==void 0&&(mt.numClippingPlanes!==Le.numPlanes||mt.numIntersection!==Le.numIntersection)||mt.vertexAlphas!==St||mt.vertexTangents!==At||mt.morphTargets!==ht||mt.morphNormals!==fn||mt.morphColors!==Cn||mt.toneMapping!==Ln||mt.morphTargetsCount!==an)&&(on=!0):(on=!0,mt.__version=ue.version);let ts=mt.currentProgram;on===!0&&(ts=gl(ue,Q,$));let Ga=!1,Di=!1,zd=!1;const Vn=ts.getUniforms(),br=mt.uniforms;if(Fe.useProgram(ts.program)&&(Ga=!0,Di=!0,zd=!0),ue.id!==M&&(M=ue.id,Di=!0),Ga||I!==k){Ee.reverseDepthBuffer?(U.copy(k.projectionMatrix),HU(U),WU(U),Vn.setValue(O,"projectionMatrix",U)):Vn.setValue(O,"projectionMatrix",k.projectionMatrix),Vn.setValue(O,"viewMatrix",k.matrixWorldInverse);const Ki=Vn.map.cameraPosition;Ki!==void 0&&Ki.setValue(O,et.setFromMatrixPosition(k.matrixWorld)),Ee.logarithmicDepthBuffer&&Vn.setValue(O,"logDepthBufFC",2/(Math.log(k.far+1)/Math.LN2)),(ue.isMeshPhongMaterial||ue.isMeshToonMaterial||ue.isMeshLambertMaterial||ue.isMeshBasicMaterial||ue.isMeshStandardMaterial||ue.isShaderMaterial)&&Vn.setValue(O,"isOrthographic",k.isOrthographicCamera===!0),I!==k&&(I=k,Di=!0,zd=!0)}if($.isSkinnedMesh){Vn.setOptional(O,$,"bindMatrix"),Vn.setOptional(O,$,"bindMatrixInverse");const Ki=$.skeleton;Ki&&(Ki.boneTexture===null&&Ki.computeBoneTexture(),Vn.setValue(O,"boneTexture",Ki.boneTexture,N))}$.isBatchedMesh&&(Vn.setOptional(O,$,"batchingTexture"),Vn.setValue(O,"batchingTexture",$._matricesTexture,N),Vn.setOptional(O,$,"batchingIdTexture"),Vn.setValue(O,"batchingIdTexture",$._indirectTexture,N),Vn.setOptional(O,$,"batchingColorTexture"),$._colorsTexture!==null&&Vn.setValue(O,"batchingColorTexture",$._colorsTexture,N));const Hd=le.morphAttributes;if((Hd.position!==void 0||Hd.normal!==void 0||Hd.color!==void 0)&&vt.update($,le,ts),(Di||mt.receiveShadow!==$.receiveShadow)&&(mt.receiveShadow=$.receiveShadow,Vn.setValue(O,"receiveShadow",$.receiveShadow)),ue.isMeshGouraudMaterial&&ue.envMap!==null&&(br.envMap.value=ot,br.flipEnvMap.value=ot.isCubeTexture&&ot.isRenderTargetTexture===!1?-1:1),ue.isMeshStandardMaterial&&ue.envMap===null&&Q.environment!==null&&(br.envMapIntensity.value=Q.environmentIntensity),Di&&(Vn.setValue(O,"toneMappingExposure",b.toneMappingExposure),mt.needsLights&&qA(br,zd),Be&&ue.fog===!0&&Ge.refreshFogUniforms(br,Be),Ge.refreshMaterialUniforms(br,ue,oe,j,m.state.transmissionRenderTarget[k.id]),Fu.upload(O,y0(mt),br,N)),ue.isShaderMaterial&&ue.uniformsNeedUpdate===!0&&(Fu.upload(O,y0(mt),br,N),ue.uniformsNeedUpdate=!1),ue.isSpriteMaterial&&Vn.setValue(O,"center",$.center),Vn.setValue(O,"modelViewMatrix",$.modelViewMatrix),Vn.setValue(O,"normalMatrix",$.normalMatrix),Vn.setValue(O,"modelMatrix",$.matrixWorld),ue.isShaderMaterial||ue.isRawShaderMaterial){const Ki=ue.uniformsGroups;for(let Wd=0,YA=Ki.length;Wd<YA;Wd++){const S0=Ki[Wd];Y.update(S0,ts),Y.bind(S0,ts)}}return ts}function qA(k,Q){k.ambientLightColor.needsUpdate=Q,k.lightProbe.needsUpdate=Q,k.directionalLights.needsUpdate=Q,k.directionalLightShadows.needsUpdate=Q,k.pointLights.needsUpdate=Q,k.pointLightShadows.needsUpdate=Q,k.spotLights.needsUpdate=Q,k.spotLightShadows.needsUpdate=Q,k.rectAreaLights.needsUpdate=Q,k.hemisphereLights.needsUpdate=Q}function XA(k){return k.isMeshLambertMaterial||k.isMeshToonMaterial||k.isMeshPhongMaterial||k.isMeshStandardMaterial||k.isShadowMaterial||k.isShaderMaterial&&k.lights===!0}this.getActiveCubeFace=function(){return w},this.getActiveMipmapLevel=function(){return E},this.getRenderTarget=function(){return C},this.setRenderTargetTextures=function(k,Q,le){rt.get(k.texture).__webglTexture=Q,rt.get(k.depthTexture).__webglTexture=le;const ue=rt.get(k);ue.__hasExternalTextures=!0,ue.__autoAllocateDepthBuffer=le===void 0,ue.__autoAllocateDepthBuffer||st.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ue.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(k,Q){const le=rt.get(k);le.__webglFramebuffer=Q,le.__useDefaultFramebuffer=Q===void 0},this.setRenderTarget=function(k,Q=0,le=0){C=k,w=Q,E=le;let ue=!0,$=null,Be=!1,Qe=!1;if(k){const ot=rt.get(k);if(ot.__useDefaultFramebuffer!==void 0)Fe.bindFramebuffer(O.FRAMEBUFFER,null),ue=!1;else if(ot.__webglFramebuffer===void 0)N.setupRenderTarget(k);else if(ot.__hasExternalTextures)N.rebindTextures(k,rt.get(k.texture).__webglTexture,rt.get(k.depthTexture).__webglTexture);else if(k.depthBuffer){const ht=k.depthTexture;if(ot.__boundDepthTexture!==ht){if(ht!==null&&rt.has(ht)&&(k.width!==ht.image.width||k.height!==ht.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");N.setupDepthRenderbuffer(k)}}const St=k.texture;(St.isData3DTexture||St.isDataArrayTexture||St.isCompressedArrayTexture)&&(Qe=!0);const At=rt.get(k).__webglFramebuffer;k.isWebGLCubeRenderTarget?(Array.isArray(At[Q])?$=At[Q][le]:$=At[Q],Be=!0):k.samples>0&&N.useMultisampledRTT(k)===!1?$=rt.get(k).__webglMultisampledFramebuffer:Array.isArray(At)?$=At[le]:$=At,T.copy(k.viewport),R.copy(k.scissor),V=k.scissorTest}else T.copy(ie).multiplyScalar(oe).floor(),R.copy(se).multiplyScalar(oe).floor(),V=je;if(Fe.bindFramebuffer(O.FRAMEBUFFER,$)&&ue&&Fe.drawBuffers(k,$),Fe.viewport(T),Fe.scissor(R),Fe.setScissorTest(V),Be){const ot=rt.get(k.texture);O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.TEXTURE_CUBE_MAP_POSITIVE_X+Q,ot.__webglTexture,le)}else if(Qe){const ot=rt.get(k.texture),St=Q||0;O.framebufferTextureLayer(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,ot.__webglTexture,le||0,St)}M=-1},this.readRenderTargetPixels=function(k,Q,le,ue,$,Be,Qe){if(!(k&&k.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let at=rt.get(k).__webglFramebuffer;if(k.isWebGLCubeRenderTarget&&Qe!==void 0&&(at=at[Qe]),at){Fe.bindFramebuffer(O.FRAMEBUFFER,at);try{const ot=k.texture,St=ot.format,At=ot.type;if(!Ee.textureFormatReadable(St)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Ee.textureTypeReadable(At)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Q>=0&&Q<=k.width-ue&&le>=0&&le<=k.height-$&&O.readPixels(Q,le,ue,$,kt.convert(St),kt.convert(At),Be)}finally{const ot=C!==null?rt.get(C).__webglFramebuffer:null;Fe.bindFramebuffer(O.FRAMEBUFFER,ot)}}},this.readRenderTargetPixelsAsync=async function(k,Q,le,ue,$,Be,Qe){if(!(k&&k.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let at=rt.get(k).__webglFramebuffer;if(k.isWebGLCubeRenderTarget&&Qe!==void 0&&(at=at[Qe]),at){const ot=k.texture,St=ot.format,At=ot.type;if(!Ee.textureFormatReadable(St))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Ee.textureTypeReadable(At))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(Q>=0&&Q<=k.width-ue&&le>=0&&le<=k.height-$){Fe.bindFramebuffer(O.FRAMEBUFFER,at);const ht=O.createBuffer();O.bindBuffer(O.PIXEL_PACK_BUFFER,ht),O.bufferData(O.PIXEL_PACK_BUFFER,Be.byteLength,O.STREAM_READ),O.readPixels(Q,le,ue,$,kt.convert(St),kt.convert(At),0);const fn=C!==null?rt.get(C).__webglFramebuffer:null;Fe.bindFramebuffer(O.FRAMEBUFFER,fn);const Cn=O.fenceSync(O.SYNC_GPU_COMMANDS_COMPLETE,0);return O.flush(),await zU(O,Cn,4),O.bindBuffer(O.PIXEL_PACK_BUFFER,ht),O.getBufferSubData(O.PIXEL_PACK_BUFFER,0,Be),O.deleteBuffer(ht),O.deleteSync(Cn),Be}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(k,Q=null,le=0){k.isTexture!==!0&&(Uu("WebGLRenderer: copyFramebufferToTexture function signature has changed."),Q=arguments[0]||null,k=arguments[1]);const ue=Math.pow(2,-le),$=Math.floor(k.image.width*ue),Be=Math.floor(k.image.height*ue),Qe=Q!==null?Q.x:0,at=Q!==null?Q.y:0;N.setTexture2D(k,0),O.copyTexSubImage2D(O.TEXTURE_2D,le,0,0,Qe,at,$,Be),Fe.unbindTexture()},this.copyTextureToTexture=function(k,Q,le=null,ue=null,$=0){k.isTexture!==!0&&(Uu("WebGLRenderer: copyTextureToTexture function signature has changed."),ue=arguments[0]||null,k=arguments[1],Q=arguments[2],$=arguments[3]||0,le=null);let Be,Qe,at,ot,St,At;le!==null?(Be=le.max.x-le.min.x,Qe=le.max.y-le.min.y,at=le.min.x,ot=le.min.y):(Be=k.image.width,Qe=k.image.height,at=0,ot=0),ue!==null?(St=ue.x,At=ue.y):(St=0,At=0);const ht=kt.convert(Q.format),fn=kt.convert(Q.type);N.setTexture2D(Q,0),O.pixelStorei(O.UNPACK_FLIP_Y_WEBGL,Q.flipY),O.pixelStorei(O.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Q.premultiplyAlpha),O.pixelStorei(O.UNPACK_ALIGNMENT,Q.unpackAlignment);const Cn=O.getParameter(O.UNPACK_ROW_LENGTH),Ln=O.getParameter(O.UNPACK_IMAGE_HEIGHT),Ni=O.getParameter(O.UNPACK_SKIP_PIXELS),an=O.getParameter(O.UNPACK_SKIP_ROWS),mt=O.getParameter(O.UNPACK_SKIP_IMAGES),oi=k.isCompressedTexture?k.mipmaps[$]:k.image;O.pixelStorei(O.UNPACK_ROW_LENGTH,oi.width),O.pixelStorei(O.UNPACK_IMAGE_HEIGHT,oi.height),O.pixelStorei(O.UNPACK_SKIP_PIXELS,at),O.pixelStorei(O.UNPACK_SKIP_ROWS,ot),k.isDataTexture?O.texSubImage2D(O.TEXTURE_2D,$,St,At,Be,Qe,ht,fn,oi.data):k.isCompressedTexture?O.compressedTexSubImage2D(O.TEXTURE_2D,$,St,At,oi.width,oi.height,ht,oi.data):O.texSubImage2D(O.TEXTURE_2D,$,St,At,Be,Qe,ht,fn,oi),O.pixelStorei(O.UNPACK_ROW_LENGTH,Cn),O.pixelStorei(O.UNPACK_IMAGE_HEIGHT,Ln),O.pixelStorei(O.UNPACK_SKIP_PIXELS,Ni),O.pixelStorei(O.UNPACK_SKIP_ROWS,an),O.pixelStorei(O.UNPACK_SKIP_IMAGES,mt),$===0&&Q.generateMipmaps&&O.generateMipmap(O.TEXTURE_2D),Fe.unbindTexture()},this.copyTextureToTexture3D=function(k,Q,le=null,ue=null,$=0){k.isTexture!==!0&&(Uu("WebGLRenderer: copyTextureToTexture3D function signature has changed."),le=arguments[0]||null,ue=arguments[1]||null,k=arguments[2],Q=arguments[3],$=arguments[4]||0);let Be,Qe,at,ot,St,At,ht,fn,Cn;const Ln=k.isCompressedTexture?k.mipmaps[$]:k.image;le!==null?(Be=le.max.x-le.min.x,Qe=le.max.y-le.min.y,at=le.max.z-le.min.z,ot=le.min.x,St=le.min.y,At=le.min.z):(Be=Ln.width,Qe=Ln.height,at=Ln.depth,ot=0,St=0,At=0),ue!==null?(ht=ue.x,fn=ue.y,Cn=ue.z):(ht=0,fn=0,Cn=0);const Ni=kt.convert(Q.format),an=kt.convert(Q.type);let mt;if(Q.isData3DTexture)N.setTexture3D(Q,0),mt=O.TEXTURE_3D;else if(Q.isDataArrayTexture||Q.isCompressedArrayTexture)N.setTexture2DArray(Q,0),mt=O.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}O.pixelStorei(O.UNPACK_FLIP_Y_WEBGL,Q.flipY),O.pixelStorei(O.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Q.premultiplyAlpha),O.pixelStorei(O.UNPACK_ALIGNMENT,Q.unpackAlignment);const oi=O.getParameter(O.UNPACK_ROW_LENGTH),on=O.getParameter(O.UNPACK_IMAGE_HEIGHT),ts=O.getParameter(O.UNPACK_SKIP_PIXELS),Ga=O.getParameter(O.UNPACK_SKIP_ROWS),Di=O.getParameter(O.UNPACK_SKIP_IMAGES);O.pixelStorei(O.UNPACK_ROW_LENGTH,Ln.width),O.pixelStorei(O.UNPACK_IMAGE_HEIGHT,Ln.height),O.pixelStorei(O.UNPACK_SKIP_PIXELS,ot),O.pixelStorei(O.UNPACK_SKIP_ROWS,St),O.pixelStorei(O.UNPACK_SKIP_IMAGES,At),k.isDataTexture||k.isData3DTexture?O.texSubImage3D(mt,$,ht,fn,Cn,Be,Qe,at,Ni,an,Ln.data):Q.isCompressedArrayTexture?O.compressedTexSubImage3D(mt,$,ht,fn,Cn,Be,Qe,at,Ni,Ln.data):O.texSubImage3D(mt,$,ht,fn,Cn,Be,Qe,at,Ni,an,Ln),O.pixelStorei(O.UNPACK_ROW_LENGTH,oi),O.pixelStorei(O.UNPACK_IMAGE_HEIGHT,on),O.pixelStorei(O.UNPACK_SKIP_PIXELS,ts),O.pixelStorei(O.UNPACK_SKIP_ROWS,Ga),O.pixelStorei(O.UNPACK_SKIP_IMAGES,Di),$===0&&Q.generateMipmaps&&O.generateMipmap(mt),Fe.unbindTexture()},this.initRenderTarget=function(k){rt.get(k).__webglFramebuffer===void 0&&N.setupRenderTarget(k)},this.initTexture=function(k){k.isCubeTexture?N.setTextureCube(k,0):k.isData3DTexture?N.setTexture3D(k,0):k.isDataArrayTexture||k.isCompressedArrayTexture?N.setTexture2DArray(k,0):N.setTexture2D(k,0),Fe.unbindTexture()},this.resetState=function(){w=0,E=0,C=null,Fe.reset(),An.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return ur}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===t0?"display-p3":"srgb",t.unpackColorSpace=en.workingColorSpace===Od?"display-p3":"srgb"}}class t9 extends Pn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Us,this.environmentIntensity=1,this.environmentRotation=new Us,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class n9{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Wm,this.updateRanges=[],this.version=0,this.uuid=bs()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let s=0,r=this.stride;s<r;s++)this.array[e+s]=t.array[i+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=bs()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=bs()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const bi=new Z;class a0{constructor(e,t,i,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)bi.fromBufferAttribute(this,t),bi.applyMatrix4(e),this.setXYZ(t,bi.x,bi.y,bi.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)bi.fromBufferAttribute(this,t),bi.applyNormalMatrix(e),this.setXYZ(t,bi.x,bi.y,bi.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)bi.fromBufferAttribute(this,t),bi.transformDirection(e),this.setXYZ(t,bi.x,bi.y,bi.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=gs(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=pn(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=pn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=pn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=pn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=pn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=gs(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=gs(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=gs(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=gs(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=pn(t,this.array),i=pn(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=pn(t,this.array),i=pn(i,this.array),s=pn(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this}setXYZW(e,t,i,s,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=pn(t,this.array),i=pn(i,this.array),s=pn(s,this.array),r=pn(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return new Ci(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new a0(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const P1=new Z,N1=new rn,D1=new rn,i9=new Z,L1=new xt,Yl=new Z,Xf=new Bs,O1=new xt,Yf=new Ud;class s9 extends Wi{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=Fb,this.bindMatrix=new xt,this.bindMatrixInverse=new xt,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new vr),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,Yl),this.boundingBox.expandByPoint(Yl)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Bs),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,Yl),this.boundingSphere.expandByPoint(Yl)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const i=this.material,s=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Xf.copy(this.boundingSphere),Xf.applyMatrix4(s),e.ray.intersectsSphere(Xf)!==!1&&(O1.copy(s).invert(),Yf.copy(e.ray).applyMatrix4(O1),!(this.boundingBox!==null&&Yf.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,Yf)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new rn,t=this.geometry.attributes.skinWeight;for(let i=0,s=t.count;i<s;i++){e.fromBufferAttribute(t,i);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===Fb?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===dU?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,s=this.geometry;N1.fromBufferAttribute(s.attributes.skinIndex,e),D1.fromBufferAttribute(s.attributes.skinWeight,e),P1.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const a=D1.getComponent(r);if(a!==0){const o=N1.getComponent(r);L1.multiplyMatrices(i.bones[o].matrixWorld,i.boneInverses[o]),t.addScaledVector(i9.copy(P1).applyMatrix4(L1),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}class PA extends Pn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class NA extends ni{constructor(e=null,t=1,i=1,s,r,a,o,l,c=Ai,u=Ai,d,h){super(null,a,o,l,c,u,s,r,d,h),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const U1=new xt,r9=new xt;class o0{constructor(e=[],t=[]){this.uuid=bs(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,s=this.bones.length;i<s;i++)this.boneInverses.push(new xt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new xt;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,s=this.boneTexture;for(let r=0,a=e.length;r<a;r++){const o=e[r]?e[r].matrixWorld:r9;U1.multiplyMatrices(o,t[r]),U1.toArray(i,r*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new o0(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new NA(t,e,e,$i,vs);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const s=this.bones[t];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,s=e.bones.length;i<s;i++){const r=e.bones[i];let a=t[r];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),a=new PA),this.bones.push(a),this.boneInverses.push(new xt().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let s=0,r=t.length;s<r;s++){const a=t[s];e.bones.push(a.uuid);const o=i[s];e.boneInverses.push(o.toArray())}return e}}class Km extends Ci{constructor(e,t,i,s=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const lo=new xt,F1=new xt,Jl=[],B1=new vr,a9=new xt,bc=new Wi,yc=new Bs;class o9 extends Wi{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Km(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<i;s++)this.setMatrixAt(s,a9)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new vr),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,lo),B1.copy(e.boundingBox).applyMatrix4(lo),this.boundingBox.union(B1)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Bs),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,lo),yc.copy(e.boundingSphere).applyMatrix4(lo),this.boundingSphere.union(yc)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const i=t.morphTargetInfluences,s=this.morphTexture.source.data.data,r=i.length+1,a=e*r+1;for(let o=0;o<i.length;o++)i[o]=s[a+o]}raycast(e,t){const i=this.matrixWorld,s=this.count;if(bc.geometry=this.geometry,bc.material=this.material,bc.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),yc.copy(this.boundingSphere),yc.applyMatrix4(i),e.ray.intersectsSphere(yc)!==!1))for(let r=0;r<s;r++){this.getMatrixAt(r,lo),F1.multiplyMatrices(i,lo),bc.matrixWorld=F1,bc.raycast(e,Jl);for(let a=0,o=Jl.length;a<o;a++){const l=Jl[a];l.instanceId=r,l.object=this,t.push(l)}Jl.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Km(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const i=t.morphTargetInfluences,s=i.length+1;this.morphTexture===null&&(this.morphTexture=new NA(new Float32Array(s*this.count),s,this.count,Qg,vs));const r=this.morphTexture.source.data.data;let a=0;for(let c=0;c<i.length;c++)a+=i[c];const o=this.geometry.morphTargetsRelative?1:1-a,l=s*e;r[l]=o,r.set(i,l+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}class DA extends Ns{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Rt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const ud=new Z,dd=new Z,V1=new xt,Tc=new Ud,Ql=new Bs,Jf=new Z,G1=new Z;class c0 extends Pn{constructor(e=new Es,t=new DA){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let s=1,r=t.count;s<r;s++)ud.fromBufferAttribute(t,s-1),dd.fromBufferAttribute(t,s),i[s]=i[s-1],i[s]+=ud.distanceTo(dd);e.setAttribute("lineDistance",new Ds(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,r=e.params.Line.threshold,a=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Ql.copy(i.boundingSphere),Ql.applyMatrix4(s),Ql.radius+=r,e.ray.intersectsSphere(Ql)===!1)return;V1.copy(s).invert(),Tc.copy(e.ray).applyMatrix4(V1);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=this.isLineSegments?2:1,u=i.index,h=i.attributes.position;if(u!==null){const f=Math.max(0,a.start),g=Math.min(u.count,a.start+a.count);for(let v=f,m=g-1;v<m;v+=c){const _=u.getX(v),y=u.getX(v+1),b=Zl(this,e,Tc,l,_,y);b&&t.push(b)}if(this.isLineLoop){const v=u.getX(g-1),m=u.getX(f),_=Zl(this,e,Tc,l,v,m);_&&t.push(_)}}else{const f=Math.max(0,a.start),g=Math.min(h.count,a.start+a.count);for(let v=f,m=g-1;v<m;v+=c){const _=Zl(this,e,Tc,l,v,v+1);_&&t.push(_)}if(this.isLineLoop){const v=Zl(this,e,Tc,l,g-1,f);v&&t.push(v)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=s.length;r<a;r++){const o=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}}function Zl(n,e,t,i,s,r){const a=n.geometry.attributes.position;if(ud.fromBufferAttribute(a,s),dd.fromBufferAttribute(a,r),t.distanceSqToSegment(ud,dd,Jf,G1)>i)return;Jf.applyMatrix4(n.matrixWorld);const l=e.ray.origin.distanceTo(Jf);if(!(l<e.near||l>e.far))return{distance:l,point:G1.clone().applyMatrix4(n.matrixWorld),index:s,face:null,faceIndex:null,barycoord:null,object:n}}const z1=new Z,H1=new Z;class c9 extends c0{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let s=0,r=t.count;s<r;s+=2)z1.fromBufferAttribute(t,s),H1.fromBufferAttribute(t,s+1),i[s]=s===0?0:i[s-1],i[s+1]=i[s]+z1.distanceTo(H1);e.setAttribute("lineDistance",new Ds(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class l9 extends c0{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class LA extends Ns{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Rt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const W1=new xt,qm=new Ud,$l=new Bs,eu=new Z;class OA extends Pn{constructor(e=new Es,t=new LA){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,r=e.params.Points.threshold,a=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),$l.copy(i.boundingSphere),$l.applyMatrix4(s),$l.radius+=r,e.ray.intersectsSphere($l)===!1)return;W1.copy(s).invert(),qm.copy(e.ray).applyMatrix4(W1);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=i.index,d=i.attributes.position;if(c!==null){const h=Math.max(0,a.start),f=Math.min(c.count,a.start+a.count);for(let g=h,v=f;g<v;g++){const m=c.getX(g);eu.fromBufferAttribute(d,m),j1(eu,m,l,s,e,t,this)}}else{const h=Math.max(0,a.start),f=Math.min(d.count,a.start+a.count);for(let g=h,v=f;g<v;g++)eu.fromBufferAttribute(d,g),j1(eu,g,l,s,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=s.length;r<a;r++){const o=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}}function j1(n,e,t,i,s,r,a){const o=qm.distanceSqToPoint(n);if(o<t){const l=new Z;qm.closestPointToPoint(n,l),l.applyMatrix4(i);const c=s.ray.origin.distanceTo(l);if(c<s.near||c>s.far)return;r.push({distance:c,distanceToRay:Math.sqrt(o),point:l,index:e,face:null,faceIndex:null,barycoord:null,object:a})}}class l0 extends Ns{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Rt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=pA,this.normalScale=new Xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Us,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Vs extends l0{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Xt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return mi(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Rt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Rt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Rt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}function tu(n,e,t){return!n||!t&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function u9(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function d9(n){function e(s,r){return n[s]-n[r]}const t=n.length,i=new Array(t);for(let s=0;s!==t;++s)i[s]=s;return i.sort(e),i}function K1(n,e,t){const i=n.length,s=new n.constructor(i);for(let r=0,a=0;a!==i;++r){const o=t[r]*e;for(let l=0;l!==e;++l)s[a++]=n[o+l]}return s}function UA(n,e,t,i){let s=1,r=n[0];for(;r!==void 0&&r[i]===void 0;)r=n[s++];if(r===void 0)return;let a=r[i];if(a!==void 0)if(Array.isArray(a))do a=r[i],a!==void 0&&(e.push(r.time),t.push.apply(t,a)),r=n[s++];while(r!==void 0);else if(a.toArray!==void 0)do a=r[i],a!==void 0&&(e.push(r.time),a.toArray(t,t.length)),r=n[s++];while(r!==void 0);else do a=r[i],a!==void 0&&(e.push(r.time),t.push(a)),r=n[s++];while(r!==void 0)}class fl{constructor(e,t,i,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,s=t[i],r=t[i-1];n:{e:{let a;t:{i:if(!(e<s)){for(let o=i+2;;){if(s===void 0){if(e<r)break i;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===o)break;if(r=s,s=t[++i],e<s)break e}a=t.length;break t}if(!(e>=r)){const o=t[1];e<o&&(i=2,r=o);for(let l=i-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(s=r,r=t[--i-1],e>=r)break e}a=i,i=0;break t}break n}for(;i<a;){const o=i+a>>>1;e<t[o]?a=o:i=o+1}if(s=t[i],r=t[i-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,s)}return this.interpolate_(i,r,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=e*s;for(let a=0;a!==s;++a)t[a]=i[r+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class h9 extends fl{constructor(e,t,i,s){super(e,t,i,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Bb,endingEnd:Bb}}intervalChanged_(e,t,i){const s=this.parameterPositions;let r=e-2,a=e+1,o=s[r],l=s[a];if(o===void 0)switch(this.getSettings_().endingStart){case Vb:r=e,o=2*t-i;break;case Gb:r=s.length-2,o=t+s[r]-s[r+1];break;default:r=e,o=i}if(l===void 0)switch(this.getSettings_().endingEnd){case Vb:a=e,l=2*i-t;break;case Gb:a=1,l=i+s[1]-s[0];break;default:a=e-1,l=t}const c=(i-t)*.5,u=this.valueSize;this._weightPrev=c/(t-o),this._weightNext=c/(l-i),this._offsetPrev=r*u,this._offsetNext=a*u}interpolate_(e,t,i,s){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,u=this._offsetPrev,d=this._offsetNext,h=this._weightPrev,f=this._weightNext,g=(i-t)/(s-t),v=g*g,m=v*g,_=-h*m+2*h*v-h*g,y=(1+h)*m+(-1.5-2*h)*v+(-.5+h)*g+1,b=(-1-f)*m+(1.5+f)*v+.5*g,p=f*m-f*v;for(let w=0;w!==o;++w)r[w]=_*a[u+w]+y*a[c+w]+b*a[l+w]+p*a[d+w];return r}}class f9 extends fl{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,u=(i-t)/(s-t),d=1-u;for(let h=0;h!==o;++h)r[h]=a[c+h]*d+a[l+h]*u;return r}}class p9 extends fl{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class Gs{constructor(e,t,i,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=tu(t,this.TimeBufferType),this.values=tu(i,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:tu(e.times,Array),values:tu(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(i.interpolation=s)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new p9(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new f9(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new h9(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case nl:t=this.InterpolantFactoryMethodDiscrete;break;case il:t=this.InterpolantFactoryMethodLinear;break;case bf:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return nl;case this.InterpolantFactoryMethodLinear:return il;case this.InterpolantFactoryMethodSmooth:return bf}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]*=e}return this}trim(e,t){const i=this.times,s=i.length;let r=0,a=s-1;for(;r!==s&&i[r]<e;)++r;for(;a!==-1&&i[a]>t;)--a;if(++a,r!==0||a!==s){r>=a&&(a=Math.max(a,1),r=a-1);const o=this.getValueSize();this.times=i.slice(r,a),this.values=this.values.slice(r*o,a*o)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,s=this.values,r=i.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let o=0;o!==r;o++){const l=i[o];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,l),e=!1;break}if(a!==null&&a>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,l,a),e=!1;break}a=l}if(s!==void 0&&u9(s))for(let o=0,l=s.length;o!==l;++o){const c=s[o];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),s=this.getInterpolation()===bf,r=e.length-1;let a=1;for(let o=1;o<r;++o){let l=!1;const c=e[o],u=e[o+1];if(c!==u&&(o!==1||c!==e[0]))if(s)l=!0;else{const d=o*i,h=d-i,f=d+i;for(let g=0;g!==i;++g){const v=t[d+g];if(v!==t[h+g]||v!==t[f+g]){l=!0;break}}}if(l){if(o!==a){e[a]=e[o];const d=o*i,h=a*i;for(let f=0;f!==i;++f)t[h+f]=t[d+f]}++a}}if(r>0){e[a]=e[r];for(let o=r*i,l=a*i,c=0;c!==i;++c)t[l+c]=t[o+c];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*i)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),i=this.constructor,s=new i(this.name,e,t);return s.createInterpolant=this.createInterpolant,s}}Gs.prototype.TimeBufferType=Float32Array;Gs.prototype.ValueBufferType=Float32Array;Gs.prototype.DefaultInterpolation=il;class ec extends Gs{constructor(e,t,i){super(e,t,i)}}ec.prototype.ValueTypeName="bool";ec.prototype.ValueBufferType=Array;ec.prototype.DefaultInterpolation=nl;ec.prototype.InterpolantFactoryMethodLinear=void 0;ec.prototype.InterpolantFactoryMethodSmooth=void 0;class FA extends Gs{}FA.prototype.ValueTypeName="color";class qo extends Gs{}qo.prototype.ValueTypeName="number";class m9 extends fl{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=(i-t)/(s-t);let c=e*o;for(let u=c+o;c!==u;c+=4)na.slerpFlat(r,0,a,c-o,a,c,l);return r}}class Xo extends Gs{InterpolantFactoryMethodLinear(e){return new m9(this.times,this.values,this.getValueSize(),e)}}Xo.prototype.ValueTypeName="quaternion";Xo.prototype.InterpolantFactoryMethodSmooth=void 0;class tc extends Gs{constructor(e,t,i){super(e,t,i)}}tc.prototype.ValueTypeName="string";tc.prototype.ValueBufferType=Array;tc.prototype.DefaultInterpolation=nl;tc.prototype.InterpolantFactoryMethodLinear=void 0;tc.prototype.InterpolantFactoryMethodSmooth=void 0;class Yo extends Gs{}Yo.prototype.ValueTypeName="vector";class g9{constructor(e="",t=-1,i=[],s=hU){this.name=e,this.tracks=i,this.duration=t,this.blendMode=s,this.uuid=bs(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,s=1/(e.fps||1);for(let a=0,o=i.length;a!==o;++a)t.push(v9(i[a]).scale(s));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],i=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,a=i.length;r!==a;++r)t.push(Gs.toJSON(i[r]));return s}static CreateFromMorphTargetSequence(e,t,i,s){const r=t.length,a=[];for(let o=0;o<r;o++){let l=[],c=[];l.push((o+r-1)%r,o,(o+1)%r),c.push(0,1,0);const u=d9(l);l=K1(l,1,u),c=K1(c,1,u),!s&&l[0]===0&&(l.push(r),c.push(c[0])),a.push(new qo(".morphTargetInfluences["+t[o].name+"]",l,c).scale(1/i))}return new this(e,-1,a)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const s=e;i=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<i.length;s++)if(i[s].name===t)return i[s];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const s={},r=/^([\w-]*?)([\d]+)$/;for(let o=0,l=e.length;o<l;o++){const c=e[o],u=c.name.match(r);if(u&&u.length>1){const d=u[1];let h=s[d];h||(s[d]=h=[]),h.push(c)}}const a=[];for(const o in s)a.push(this.CreateFromMorphTargetSequence(o,s[o],t,i));return a}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(d,h,f,g,v){if(f.length!==0){const m=[],_=[];UA(f,m,_,g),m.length!==0&&v.push(new d(h,m,_))}},s=[],r=e.name||"default",a=e.fps||30,o=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let d=0;d<c.length;d++){const h=c[d].keys;if(!(!h||h.length===0))if(h[0].morphTargets){const f={};let g;for(g=0;g<h.length;g++)if(h[g].morphTargets)for(let v=0;v<h[g].morphTargets.length;v++)f[h[g].morphTargets[v]]=-1;for(const v in f){const m=[],_=[];for(let y=0;y!==h[g].morphTargets.length;++y){const b=h[g];m.push(b.time),_.push(b.morphTarget===v?1:0)}s.push(new qo(".morphTargetInfluence["+v+"]",m,_))}l=f.length*a}else{const f=".bones["+t[d].name+"]";i(Yo,f+".position",h,"pos",s),i(Xo,f+".quaternion",h,"rot",s),i(Yo,f+".scale",h,"scl",s)}}return s.length===0?null:new this(r,l,s,o)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,s=e.length;i!==s;++i){const r=this.tracks[i];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function _9(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return qo;case"vector":case"vector2":case"vector3":case"vector4":return Yo;case"color":return FA;case"quaternion":return Xo;case"bool":case"boolean":return ec;case"string":return tc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function v9(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=_9(n.type);if(n.times===void 0){const t=[],i=[];UA(n.keys,t,i,"value"),n.times=t,n.values=i}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const Hr={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class b9{constructor(e,t,i){const s=this;let r=!1,a=0,o=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(u){o++,r===!1&&s.onStart!==void 0&&s.onStart(u,a,o),r=!0},this.itemEnd=function(u){a++,s.onProgress!==void 0&&s.onProgress(u,a,o),a===o&&(r=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(u){s.onError!==void 0&&s.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,d){return c.push(u,d),this},this.removeHandler=function(u){const d=c.indexOf(u);return d!==-1&&c.splice(d,2),this},this.getHandler=function(u){for(let d=0,h=c.length;d<h;d+=2){const f=c[d],g=c[d+1];if(f.global&&(f.lastIndex=0),f.test(u))return g}return null}}}const y9=new b9;class nc{constructor(e){this.manager=e!==void 0?e:y9,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(s,r){i.load(e,s,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}nc.DEFAULT_MATERIAL_NAME="__DEFAULT";const Ys={};class T9 extends Error{constructor(e,t){super(e),this.response=t}}class BA extends nc{constructor(e){super(e)}load(e,t,i,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=Hr.get(e);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(Ys[e]!==void 0){Ys[e].push({onLoad:t,onProgress:i,onError:s});return}Ys[e]=[],Ys[e].push({onLoad:t,onProgress:i,onError:s});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,l=this.responseType;fetch(a).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const u=Ys[e],d=c.body.getReader(),h=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),f=h?parseInt(h):0,g=f!==0;let v=0;const m=new ReadableStream({start(_){y();function y(){d.read().then(({done:b,value:p})=>{if(b)_.close();else{v+=p.byteLength;const w=new ProgressEvent("progress",{lengthComputable:g,loaded:v,total:f});for(let E=0,C=u.length;E<C;E++){const M=u[E];M.onProgress&&M.onProgress(w)}_.enqueue(p),y()}},b=>{_.error(b)})}}});return new Response(m)}else throw new T9(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>new DOMParser().parseFromString(u,o));case"json":return c.json();default:if(o===void 0)return c.text();{const d=/charset="?([^;"\s]*)"?/i.exec(o),h=d&&d[1]?d[1].toLowerCase():void 0,f=new TextDecoder(h);return c.arrayBuffer().then(g=>f.decode(g))}}}).then(c=>{Hr.add(e,c);const u=Ys[e];delete Ys[e];for(let d=0,h=u.length;d<h;d++){const f=u[d];f.onLoad&&f.onLoad(c)}}).catch(c=>{const u=Ys[e];if(u===void 0)throw this.manager.itemError(e),c;delete Ys[e];for(let d=0,h=u.length;d<h;d++){const f=u[d];f.onError&&f.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class S9 extends nc{constructor(e){super(e)}load(e,t,i,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,a=Hr.get(e);if(a!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0),a;const o=sl("img");function l(){u(),Hr.add(e,this),t&&t(this),r.manager.itemEnd(e)}function c(d){u(),s&&s(d),r.manager.itemError(e),r.manager.itemEnd(e)}function u(){o.removeEventListener("load",l,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(e),o.src=e,o}}class VA extends nc{constructor(e){super(e)}load(e,t,i,s){const r=new ni,a=new S9(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(o){r.image=o,r.needsUpdate=!0,t!==void 0&&t(r)},i,s),r}}class Vd extends Pn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Rt(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}const Qf=new xt,q1=new Z,X1=new Z;class u0{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Xt(512,512),this.map=null,this.mapPass=null,this.matrix=new xt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new i0,this._frameExtents=new Xt(1,1),this._viewportCount=1,this._viewports=[new rn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;q1.setFromMatrixPosition(e.matrixWorld),t.position.copy(q1),X1.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(X1),t.updateMatrixWorld(),Qf.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Qf),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Qf)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class E9 extends u0{constructor(){super(new Ei(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=jo*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(i!==t.fov||s!==t.aspect||r!==t.far)&&(t.fov=i,t.aspect=s,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class A9 extends Vd{constructor(e,t,i=0,s=Math.PI/3,r=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Pn.DEFAULT_UP),this.updateMatrix(),this.target=new Pn,this.distance=i,this.angle=s,this.penumbra=r,this.decay=a,this.map=null,this.shadow=new E9}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Y1=new xt,Sc=new Z,Zf=new Z;class C9 extends u0{constructor(){super(new Ei(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Xt(4,2),this._viewportCount=6,this._viewports=[new rn(2,1,1,1),new rn(0,1,1,1),new rn(3,1,1,1),new rn(1,1,1,1),new rn(3,0,1,1),new rn(1,0,1,1)],this._cubeDirections=[new Z(1,0,0),new Z(-1,0,0),new Z(0,0,1),new Z(0,0,-1),new Z(0,1,0),new Z(0,-1,0)],this._cubeUps=[new Z(0,1,0),new Z(0,1,0),new Z(0,1,0),new Z(0,1,0),new Z(0,0,1),new Z(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,s=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),Sc.setFromMatrixPosition(e.matrixWorld),i.position.copy(Sc),Zf.copy(i.position),Zf.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(Zf),i.updateMatrixWorld(),s.makeTranslation(-Sc.x,-Sc.y,-Sc.z),Y1.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Y1)}}class GA extends Vd{constructor(e,t,i=0,s=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=s,this.shadow=new C9}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class w9 extends u0{constructor(){super(new s0(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class zA extends Vd{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Pn.DEFAULT_UP),this.updateMatrix(),this.target=new Pn,this.shadow=new w9}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class R9 extends Vd{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class Gc{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let i=0,s=e.length;i<s;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class k9 extends nc{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,a=Hr.get(e);if(a!==void 0){if(r.manager.itemStart(e),a.then){a.then(c=>{t&&t(c),r.manager.itemEnd(e)}).catch(c=>{s&&s(c)});return}return setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0),a}const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader;const l=fetch(e,o).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(c){return Hr.add(e,c),t&&t(c),r.manager.itemEnd(e),c}).catch(function(c){s&&s(c),Hr.remove(e),r.manager.itemError(e),r.manager.itemEnd(e)});Hr.add(e,l),r.manager.itemStart(e)}}const d0="\\[\\]\\.:\\/",M9=new RegExp("["+d0+"]","g"),h0="[^"+d0+"]",x9="[^"+d0.replace("\\.","")+"]",I9=/((?:WC+[\/:])*)/.source.replace("WC",h0),P9=/(WCOD+)?/.source.replace("WCOD",x9),N9=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",h0),D9=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",h0),L9=new RegExp("^"+I9+P9+N9+D9+"$"),O9=["material","materials","bones","map"];class U9{constructor(e,t,i){const s=i||mn.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,s)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,s=this._bindings[i];s!==void 0&&s.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let s=this._targetGroup.nCachedObjects_,r=i.length;s!==r;++s)i[s].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class mn{constructor(e,t,i){this.path=t,this.parsedPath=i||mn.parseTrackName(t),this.node=mn.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new mn.Composite(e,t,i):new mn(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(M9,"")}static parseTrackName(e){const t=L9.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=i.nodeName&&i.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const r=i.nodeName.substring(s+1);O9.indexOf(r)!==-1&&(i.nodeName=i.nodeName.substring(0,s),i.objectName=r)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(r){for(let a=0;a<r.length;a++){const o=r[a];if(o.name===t||o.uuid===t)return o;const l=i(o.children);if(l)return l}return null},s=i(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)e[t++]=i[s]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,s=t.propertyName;let r=t.propertyIndex;if(e||(e=mn.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let c=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const a=e[s];if(a===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+s+" but it wasn't found.",e);return}let o=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?o=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=r}else a.fromArray!==void 0&&a.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=s;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}mn.Composite=U9;mn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};mn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};mn.prototype.GetterByBindingType=[mn.prototype._getValue_direct,mn.prototype._getValue_array,mn.prototype._getValue_arrayElement,mn.prototype._getValue_toArray];mn.prototype.SetterByBindingTypeAndVersioning=[[mn.prototype._setValue_direct,mn.prototype._setValue_direct_setNeedsUpdate,mn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[mn.prototype._setValue_array,mn.prototype._setValue_array_setNeedsUpdate,mn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[mn.prototype._setValue_arrayElement,mn.prototype._setValue_arrayElement_setNeedsUpdate,mn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[mn.prototype._setValue_fromArray,mn.prototype._setValue_fromArray_setNeedsUpdate,mn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Kg}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Kg);function J1(n,e){if(e===fU)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===Hm||e===fA){let t=n.getIndex();if(t===null){const a=[],o=n.getAttribute("position");if(o!==void 0){for(let l=0;l<o.count;l++)a.push(l);n.setIndex(a),t=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const i=t.count-2,s=[];if(e===Hm)for(let a=1;a<=i;a++)s.push(t.getX(0)),s.push(t.getX(a)),s.push(t.getX(a+1));else for(let a=0;a<i;a++)a%2===0?(s.push(t.getX(a)),s.push(t.getX(a+1)),s.push(t.getX(a+2))):(s.push(t.getX(a+2)),s.push(t.getX(a+1)),s.push(t.getX(a)));s.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=n.clone();return r.setIndex(s),r.clearGroups(),r}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}class F9 extends nc{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new H9(t)}),this.register(function(t){return new W9(t)}),this.register(function(t){return new $9(t)}),this.register(function(t){return new e7(t)}),this.register(function(t){return new t7(t)}),this.register(function(t){return new K9(t)}),this.register(function(t){return new q9(t)}),this.register(function(t){return new X9(t)}),this.register(function(t){return new Y9(t)}),this.register(function(t){return new z9(t)}),this.register(function(t){return new J9(t)}),this.register(function(t){return new j9(t)}),this.register(function(t){return new Z9(t)}),this.register(function(t){return new Q9(t)}),this.register(function(t){return new V9(t)}),this.register(function(t){return new n7(t)}),this.register(function(t){return new i7(t)})}load(e,t,i,s){const r=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const c=Gc.extractUrlBase(e);a=Gc.resolveURL(c,this.path)}else a=Gc.extractUrlBase(e);this.manager.itemStart(e);const o=function(c){s?s(c):console.error(c),r.manager.itemError(e),r.manager.itemEnd(e)},l=new BA(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{r.parse(c,a,function(u){t(u),r.manager.itemEnd(e)},o)}catch(u){o(u)}},i,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){let r;const a={},o={},l=new TextDecoder;if(typeof e=="string")r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===HA){try{a[Ot.KHR_BINARY_GLTF]=new s7(e)}catch(d){s&&s(d);return}r=JSON.parse(a[Ot.KHR_BINARY_GLTF].content)}else r=JSON.parse(l.decode(e));else r=e;if(r.asset===void 0||r.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new _7(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const d=this.pluginCallbacks[u](c);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[d.name]=d,a[d.name]=!0}if(r.extensionsUsed)for(let u=0;u<r.extensionsUsed.length;++u){const d=r.extensionsUsed[u],h=r.extensionsRequired||[];switch(d){case Ot.KHR_MATERIALS_UNLIT:a[d]=new G9;break;case Ot.KHR_DRACO_MESH_COMPRESSION:a[d]=new r7(r,this.dracoLoader);break;case Ot.KHR_TEXTURE_TRANSFORM:a[d]=new a7;break;case Ot.KHR_MESH_QUANTIZATION:a[d]=new o7;break;default:h.indexOf(d)>=0&&o[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}c.setExtensions(a),c.setPlugins(o),c.parse(i,s)}parseAsync(e,t){const i=this;return new Promise(function(s,r){i.parse(e,t,s,r)})}}function B9(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const Ot={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class V9{constructor(e){this.parser=e,this.name=Ot.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,s=t.length;i<s;i++){const r=t[i];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let s=t.cache.get(i);if(s)return s;const r=t.json,l=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let c;const u=new Rt(16777215);l.color!==void 0&&u.setRGB(l.color[0],l.color[1],l.color[2],di);const d=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new zA(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new GA(u),c.distance=d;break;case"spot":c=new A9(u),c.distance=d,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,nr(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),s=Promise.resolve(c),t.cache.add(i,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,r=i.json.nodes[e],o=(r.extensions&&r.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(l){return i._getNodeRef(t.cache,o,l)})}}class G9{constructor(){this.name=Ot.KHR_MATERIALS_UNLIT}getMaterialType(){return Ta}extendParams(e,t,i){const s=[];e.color=new Rt(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const a=r.baseColorFactor;e.color.setRGB(a[0],a[1],a[2],di),e.opacity=a[3]}r.baseColorTexture!==void 0&&s.push(i.assignTexture(e,"map",r.baseColorTexture,Si))}return Promise.all(s)}}class z9{constructor(e){this.parser=e,this.name=Ot.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}}class H9{constructor(e){this.parser=e,this.name=Ot.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Vs}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],a=s.extensions[this.name];if(a.clearcoatFactor!==void 0&&(t.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(r.push(i.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const o=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Xt(o,o)}return Promise.all(r)}}class W9{constructor(e){this.parser=e,this.name=Ot.KHR_MATERIALS_DISPERSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Vs}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return t.dispersion=r.dispersion!==void 0?r.dispersion:0,Promise.resolve()}}class j9{constructor(e){this.parser=e,this.name=Ot.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Vs}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],a=s.extensions[this.name];return a.iridescenceFactor!==void 0&&(t.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(t.iridescenceIOR=a.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(r)}}class K9{constructor(e){this.parser=e,this.name=Ot.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Vs}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new Rt(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=s.extensions[this.name];if(a.sheenColorFactor!==void 0){const o=a.sheenColorFactor;t.sheenColor.setRGB(o[0],o[1],o[2],di)}return a.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&r.push(i.assignTexture(t,"sheenColorMap",a.sheenColorTexture,Si)),a.sheenRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(r)}}class q9{constructor(e){this.parser=e,this.name=Ot.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Vs}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],a=s.extensions[this.name];return a.transmissionFactor!==void 0&&(t.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&r.push(i.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(r)}}class X9{constructor(e){this.parser=e,this.name=Ot.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Vs}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],a=s.extensions[this.name];t.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&r.push(i.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;const o=a.attenuationColor||[1,1,1];return t.attenuationColor=new Rt().setRGB(o[0],o[1],o[2],di),Promise.all(r)}}class Y9{constructor(e){this.parser=e,this.name=Ot.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Vs}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}class J9{constructor(e){this.parser=e,this.name=Ot.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Vs}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],a=s.extensions[this.name];t.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&r.push(i.assignTexture(t,"specularIntensityMap",a.specularTexture));const o=a.specularColorFactor||[1,1,1];return t.specularColor=new Rt().setRGB(o[0],o[1],o[2],di),a.specularColorTexture!==void 0&&r.push(i.assignTexture(t,"specularColorMap",a.specularColorTexture,Si)),Promise.all(r)}}class Q9{constructor(e){this.parser=e,this.name=Ot.EXT_MATERIALS_BUMP}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Vs}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],a=s.extensions[this.name];return t.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&r.push(i.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(r)}}class Z9{constructor(e){this.parser=e,this.name=Ot.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Vs}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],a=s.extensions[this.name];return a.anisotropyStrength!==void 0&&(t.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(t.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&r.push(i.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(r)}}class $9{constructor(e){this.parser=e,this.name=Ot.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,s=i.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const r=s.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,a)}}class e7{constructor(e){this.parser=e,this.name=Ot.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const a=r.extensions[t],o=s.images[a.source];let l=i.textureLoader;if(o.uri){const c=i.options.manager.getHandler(o.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,a.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class t7{constructor(e){this.parser=e,this.name=Ot.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const a=r.extensions[t],o=s.images[a.source];let l=i.textureLoader;if(o.uri){const c=i.options.manager.getHandler(o.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,a.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class n7{constructor(e){this.name=Ot.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const s=i.extensions[this.name],r=this.parser.getDependency("buffer",s.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(o){const l=s.byteOffset||0,c=s.byteLength||0,u=s.count,d=s.byteStride,h=new Uint8Array(o,l,c);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(u,d,h,s.mode,s.filter).then(function(f){return f.buffer}):a.ready.then(function(){const f=new ArrayBuffer(u*d);return a.decodeGltfBuffer(new Uint8Array(f),u,d,h,s.mode,s.filter),f})})}else return null}}class i7{constructor(e){this.name=Ot.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const s=t.meshes[i.mesh];for(const c of s.primitives)if(c.mode!==Qi.TRIANGLES&&c.mode!==Qi.TRIANGLE_STRIP&&c.mode!==Qi.TRIANGLE_FAN&&c.mode!==void 0)return null;const a=i.extensions[this.name].attributes,o=[],l={};for(const c in a)o.push(this.parser.getDependency("accessor",a[c]).then(u=>(l[c]=u,l[c])));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then(c=>{const u=c.pop(),d=u.isGroup?u.children:[u],h=c[0].count,f=[];for(const g of d){const v=new xt,m=new Z,_=new na,y=new Z(1,1,1),b=new o9(g.geometry,g.material,h);for(let p=0;p<h;p++)l.TRANSLATION&&m.fromBufferAttribute(l.TRANSLATION,p),l.ROTATION&&_.fromBufferAttribute(l.ROTATION,p),l.SCALE&&y.fromBufferAttribute(l.SCALE,p),b.setMatrixAt(p,v.compose(m,_,y));for(const p in l)if(p==="_COLOR_0"){const w=l[p];b.instanceColor=new Km(w.array,w.itemSize,w.normalized)}else p!=="TRANSLATION"&&p!=="ROTATION"&&p!=="SCALE"&&g.geometry.setAttribute(p,l[p]);Pn.prototype.copy.call(b,g),this.parser.assignFinalMaterial(b),f.push(b)}return u.isGroup?(u.clear(),u.add(...f),u):f[0]}))}}const HA="glTF",Ec=12,Q1={JSON:1313821514,BIN:5130562};class s7{constructor(e){this.name=Ot.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Ec),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==HA)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-Ec,r=new DataView(e,Ec);let a=0;for(;a<s;){const o=r.getUint32(a,!0);a+=4;const l=r.getUint32(a,!0);if(a+=4,l===Q1.JSON){const c=new Uint8Array(e,Ec+a,o);this.content=i.decode(c)}else if(l===Q1.BIN){const c=Ec+a;this.body=e.slice(c,c+o)}a+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class r7{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ot.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,s=this.dracoLoader,r=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},l={},c={};for(const u in a){const d=Xm[u]||u.toLowerCase();o[d]=a[u]}for(const u in e.attributes){const d=Xm[u]||u.toLowerCase();if(a[u]!==void 0){const h=i.accessors[e.attributes[u]],f=Io[h.componentType];c[d]=f.name,l[d]=h.normalized===!0}}return t.getDependency("bufferView",r).then(function(u){return new Promise(function(d,h){s.decodeDracoFile(u,function(f){for(const g in f.attributes){const v=f.attributes[g],m=l[g];m!==void 0&&(v.normalized=m)}d(f)},o,c,di,h)})})}}class a7{constructor(){this.name=Ot.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class o7{constructor(){this.name=Ot.KHR_MESH_QUANTIZATION}}class WA extends fl{constructor(e,t,i,s){super(e,t,i,s)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=e*s*3+s;for(let a=0;a!==s;a++)t[a]=i[r+a];return t}interpolate_(e,t,i,s){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=o*2,c=o*3,u=s-t,d=(i-t)/u,h=d*d,f=h*d,g=e*c,v=g-c,m=-2*f+3*h,_=f-h,y=1-m,b=_-h+d;for(let p=0;p!==o;p++){const w=a[v+p+o],E=a[v+p+l]*u,C=a[g+p+o],M=a[g+p]*u;r[p]=y*w+b*E+m*C+_*M}return r}}const c7=new na;class l7 extends WA{interpolate_(e,t,i,s){const r=super.interpolate_(e,t,i,s);return c7.fromArray(r).normalize().toArray(r),r}}const Qi={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Io={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Z1={9728:Ai,9729:Gi,9984:iA,9985:Iu,9986:xc,9987:lr},$1={33071:zr,33648:rd,10497:zo},$f={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Xm={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},xr={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},u7={CUBICSPLINE:void 0,LINEAR:il,STEP:nl},ep={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function d7(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new l0({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:mr})),n.DefaultMaterial}function fa(n,e,t){for(const i in t.extensions)n[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function nr(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function h7(n,e,t){let i=!1,s=!1,r=!1;for(let c=0,u=e.length;c<u;c++){const d=e[c];if(d.POSITION!==void 0&&(i=!0),d.NORMAL!==void 0&&(s=!0),d.COLOR_0!==void 0&&(r=!0),i&&s&&r)break}if(!i&&!s&&!r)return Promise.resolve(n);const a=[],o=[],l=[];for(let c=0,u=e.length;c<u;c++){const d=e[c];if(i){const h=d.POSITION!==void 0?t.getDependency("accessor",d.POSITION):n.attributes.position;a.push(h)}if(s){const h=d.NORMAL!==void 0?t.getDependency("accessor",d.NORMAL):n.attributes.normal;o.push(h)}if(r){const h=d.COLOR_0!==void 0?t.getDependency("accessor",d.COLOR_0):n.attributes.color;l.push(h)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l)]).then(function(c){const u=c[0],d=c[1],h=c[2];return i&&(n.morphAttributes.position=u),s&&(n.morphAttributes.normal=d),r&&(n.morphAttributes.color=h),n.morphTargetsRelative=!0,n})}function f7(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let i=0,s=t.length;i<s;i++)n.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function p7(n){let e;const t=n.extensions&&n.extensions[Ot.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+tp(t.attributes):e=n.indices+":"+tp(n.attributes)+":"+n.mode,n.targets!==void 0)for(let i=0,s=n.targets.length;i<s;i++)e+=":"+tp(n.targets[i]);return e}function tp(n){let e="";const t=Object.keys(n).sort();for(let i=0,s=t.length;i<s;i++)e+=t[i]+":"+n[t[i]]+";";return e}function Ym(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function m7(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const g7=new xt;class _7{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new B9,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,s=-1,r=!1,a=-1;if(typeof navigator<"u"){const o=navigator.userAgent;i=/^((?!chrome|android).)*safari/i.test(o)===!0;const l=o.match(/Version\/(\d+)/);s=i&&l?parseInt(l[1],10):-1,r=o.indexOf("Firefox")>-1,a=r?o.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||i&&s<17||r&&a<98?this.textureLoader=new VA(this.options.manager):this.textureLoader=new k9(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new BA(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,s=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(a){const o={scene:a[0][s.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:s.asset,parser:i,userData:{}};return fa(r,o,s),nr(o,s),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(o)})).then(function(){for(const l of o.scenes)l.updateMatrixWorld();e(o)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let s=0,r=t.length;s<r;s++){const a=t[s].joints;for(let o=0,l=a.length;o<l;o++)e[a[o]].isBone=!0}for(let s=0,r=e.length;s<r;s++){const a=e[s];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(i[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const s=i.clone(),r=(a,o)=>{const l=this.associations.get(a);l!=null&&this.associations.set(o,l);for(const[c,u]of a.children.entries())r(u,o.children[c])};return r(i,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const s=e(t[i]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let s=0;s<t.length;s++){const r=e(t[s]);r&&i.push(r)}return i}getDependency(e,t){const i=e+":"+t;let s=this.cache.get(i);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(r){return r.loadNode&&r.loadNode(t)});break;case"mesh":s=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(i,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(r,a){return i.getDependency(e,a)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Ot.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(r,a){i.load(Gc.resolveURL(t.uri,s.path),r,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const s=t.byteLength||0,r=t.byteOffset||0;return i.slice(r,r+s)})}loadAccessor(e){const t=this,i=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const a=$f[s.type],o=Io[s.componentType],l=s.normalized===!0,c=new o(s.count*a);return Promise.resolve(new Ci(c,a,l))}const r=[];return s.bufferView!==void 0?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),s.sparse!==void 0&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(a){const o=a[0],l=$f[s.type],c=Io[s.componentType],u=c.BYTES_PER_ELEMENT,d=u*l,h=s.byteOffset||0,f=s.bufferView!==void 0?i.bufferViews[s.bufferView].byteStride:void 0,g=s.normalized===!0;let v,m;if(f&&f!==d){const _=Math.floor(h/f),y="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+_+":"+s.count;let b=t.cache.get(y);b||(v=new c(o,_*f,s.count*f/u),b=new n9(v,f/u),t.cache.add(y,b)),m=new a0(b,l,h%f/u,g)}else o===null?v=new c(s.count*l):v=new c(o,h,s.count*l),m=new Ci(v,l,g);if(s.sparse!==void 0){const _=$f.SCALAR,y=Io[s.sparse.indices.componentType],b=s.sparse.indices.byteOffset||0,p=s.sparse.values.byteOffset||0,w=new y(a[1],b,s.sparse.count*_),E=new c(a[2],p,s.sparse.count*l);o!==null&&(m=new Ci(m.array.slice(),m.itemSize,m.normalized)),m.normalized=!1;for(let C=0,M=w.length;C<M;C++){const I=w[C];if(m.setX(I,E[C*l]),l>=2&&m.setY(I,E[C*l+1]),l>=3&&m.setZ(I,E[C*l+2]),l>=4&&m.setW(I,E[C*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}m.normalized=g}return m})}loadTexture(e){const t=this.json,i=this.options,r=t.textures[e].source,a=t.images[r];let o=this.textureLoader;if(a.uri){const l=i.manager.getHandler(a.uri);l!==null&&(o=l)}return this.loadTextureImage(e,r,o)}loadTextureImage(e,t,i){const s=this,r=this.json,a=r.textures[e],o=r.images[t],l=(o.uri||o.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,i).then(function(u){u.flipY=!1,u.name=a.name||o.name||"",u.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(u.name=o.uri);const h=(r.samplers||{})[a.sampler]||{};return u.magFilter=Z1[h.magFilter]||Gi,u.minFilter=Z1[h.minFilter]||lr,u.wrapS=$1[h.wrapS]||zo,u.wrapT=$1[h.wrapT]||zo,s.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const i=this,s=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const a=s.images[e],o=self.URL||self.webkitURL;let l=a.uri||"",c=!1;if(a.bufferView!==void 0)l=i.getDependency("bufferView",a.bufferView).then(function(d){c=!0;const h=new Blob([d],{type:a.mimeType});return l=o.createObjectURL(h),l});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(l).then(function(d){return new Promise(function(h,f){let g=h;t.isImageBitmapLoader===!0&&(g=function(v){const m=new ni(v);m.needsUpdate=!0,h(m)}),t.load(Gc.resolveURL(d,r.path),g,void 0,f)})}).then(function(d){return c===!0&&o.revokeObjectURL(l),nr(d,a),d.userData.mimeType=a.mimeType||m7(a.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),d});return this.sourceCache[e]=u,u}assignTexture(e,t,i,s){const r=this;return this.getDependency("texture",i.index).then(function(a){if(!a)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(a=a.clone(),a.channel=i.texCoord),r.extensions[Ot.KHR_TEXTURE_TRANSFORM]){const o=i.extensions!==void 0?i.extensions[Ot.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const l=r.associations.get(a);a=r.extensions[Ot.KHR_TEXTURE_TRANSFORM].extendTexture(a,o),r.associations.set(a,l)}}return s!==void 0&&(a.colorSpace=s),e[t]=a,a})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const s=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,a=t.attributes.normal===void 0;if(e.isPoints){const o="PointsMaterial:"+i.uuid;let l=this.cache.get(o);l||(l=new LA,Ns.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(o,l)),i=l}else if(e.isLine){const o="LineBasicMaterial:"+i.uuid;let l=this.cache.get(o);l||(l=new DA,Ns.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(o,l)),i=l}if(s||r||a){let o="ClonedMaterial:"+i.uuid+":";s&&(o+="derivative-tangents:"),r&&(o+="vertex-colors:"),a&&(o+="flat-shading:");let l=this.cache.get(o);l||(l=i.clone(),r&&(l.vertexColors=!0),a&&(l.flatShading=!0),s&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(o,l),this.associations.set(l,this.associations.get(i))),i=l}e.material=i}getMaterialType(){return l0}loadMaterial(e){const t=this,i=this.json,s=this.extensions,r=i.materials[e];let a;const o={},l=r.extensions||{},c=[];if(l[Ot.KHR_MATERIALS_UNLIT]){const d=s[Ot.KHR_MATERIALS_UNLIT];a=d.getMaterialType(),c.push(d.extendParams(o,r,t))}else{const d=r.pbrMetallicRoughness||{};if(o.color=new Rt(1,1,1),o.opacity=1,Array.isArray(d.baseColorFactor)){const h=d.baseColorFactor;o.color.setRGB(h[0],h[1],h[2],di),o.opacity=h[3]}d.baseColorTexture!==void 0&&c.push(t.assignTexture(o,"map",d.baseColorTexture,Si)),o.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,o.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(o,"metalnessMap",d.metallicRoughnessTexture)),c.push(t.assignTexture(o,"roughnessMap",d.metallicRoughnessTexture))),a=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(e,o)})))}r.doubleSided===!0&&(o.side=Is);const u=r.alphaMode||ep.OPAQUE;if(u===ep.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,u===ep.MASK&&(o.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&a!==Ta&&(c.push(t.assignTexture(o,"normalMap",r.normalTexture)),o.normalScale=new Xt(1,1),r.normalTexture.scale!==void 0)){const d=r.normalTexture.scale;o.normalScale.set(d,d)}if(r.occlusionTexture!==void 0&&a!==Ta&&(c.push(t.assignTexture(o,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&a!==Ta){const d=r.emissiveFactor;o.emissive=new Rt().setRGB(d[0],d[1],d[2],di)}return r.emissiveTexture!==void 0&&a!==Ta&&c.push(t.assignTexture(o,"emissiveMap",r.emissiveTexture,Si)),Promise.all(c).then(function(){const d=new a(o);return r.name&&(d.name=r.name),nr(d,r),t.associations.set(d,{materials:e}),r.extensions&&fa(s,d,r),d})}createUniqueName(e){const t=mn.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,s=this.primitiveCache;function r(o){return i[Ot.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,t).then(function(l){return ey(l,o,t)})}const a=[];for(let o=0,l=e.length;o<l;o++){const c=e[o],u=p7(c),d=s[u];if(d)a.push(d.promise);else{let h;c.extensions&&c.extensions[Ot.KHR_DRACO_MESH_COMPRESSION]?h=r(c):h=ey(new Es,c,t),s[u]={primitive:c,promise:h},a.push(h)}}return Promise.all(a)}loadMesh(e){const t=this,i=this.json,s=this.extensions,r=i.meshes[e],a=r.primitives,o=[];for(let l=0,c=a.length;l<c;l++){const u=a[l].material===void 0?d7(this.cache):this.getDependency("material",a[l].material);o.push(u)}return o.push(t.loadGeometries(a)),Promise.all(o).then(function(l){const c=l.slice(0,l.length-1),u=l[l.length-1],d=[];for(let f=0,g=u.length;f<g;f++){const v=u[f],m=a[f];let _;const y=c[f];if(m.mode===Qi.TRIANGLES||m.mode===Qi.TRIANGLE_STRIP||m.mode===Qi.TRIANGLE_FAN||m.mode===void 0)_=r.isSkinnedMesh===!0?new s9(v,y):new Wi(v,y),_.isSkinnedMesh===!0&&_.normalizeSkinWeights(),m.mode===Qi.TRIANGLE_STRIP?_.geometry=J1(_.geometry,fA):m.mode===Qi.TRIANGLE_FAN&&(_.geometry=J1(_.geometry,Hm));else if(m.mode===Qi.LINES)_=new c9(v,y);else if(m.mode===Qi.LINE_STRIP)_=new c0(v,y);else if(m.mode===Qi.LINE_LOOP)_=new l9(v,y);else if(m.mode===Qi.POINTS)_=new OA(v,y);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);Object.keys(_.geometry.morphAttributes).length>0&&f7(_,r),_.name=t.createUniqueName(r.name||"mesh_"+e),nr(_,r),m.extensions&&fa(s,_,m),t.assignFinalMaterial(_),d.push(_)}for(let f=0,g=d.length;f<g;f++)t.associations.set(d[f],{meshes:e,primitives:f});if(d.length===1)return r.extensions&&fa(s,d[0],r),d[0];const h=new Sa;r.extensions&&fa(s,h,r),t.associations.set(h,{meshes:e});for(let f=0,g=d.length;f<g;f++)h.add(d[f]);return h})}loadCamera(e){let t;const i=this.json.cameras[e],s=i[i.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new Ei(VU.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):i.type==="orthographic"&&(t=new s0(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),nr(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let s=0,r=t.joints.length;s<r;s++)i.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(s){const r=s.pop(),a=s,o=[],l=[];for(let c=0,u=a.length;c<u;c++){const d=a[c];if(d){o.push(d);const h=new xt;r!==null&&h.fromArray(r.array,c*16),l.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new o0(o,l)})}loadAnimation(e){const t=this.json,i=this,s=t.animations[e],r=s.name?s.name:"animation_"+e,a=[],o=[],l=[],c=[],u=[];for(let d=0,h=s.channels.length;d<h;d++){const f=s.channels[d],g=s.samplers[f.sampler],v=f.target,m=v.node,_=s.parameters!==void 0?s.parameters[g.input]:g.input,y=s.parameters!==void 0?s.parameters[g.output]:g.output;v.node!==void 0&&(a.push(this.getDependency("node",m)),o.push(this.getDependency("accessor",_)),l.push(this.getDependency("accessor",y)),c.push(g),u.push(v))}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l),Promise.all(c),Promise.all(u)]).then(function(d){const h=d[0],f=d[1],g=d[2],v=d[3],m=d[4],_=[];for(let y=0,b=h.length;y<b;y++){const p=h[y],w=f[y],E=g[y],C=v[y],M=m[y];if(p===void 0)continue;p.updateMatrix&&p.updateMatrix();const I=i._createAnimationTracks(p,w,E,C,M);if(I)for(let T=0;T<I.length;T++)_.push(I[T])}return new g9(r,void 0,_)})}createNodeMesh(e){const t=this.json,i=this,s=t.nodes[e];return s.mesh===void 0?null:i.getDependency("mesh",s.mesh).then(function(r){const a=i._getNodeRef(i.meshCache,s.mesh,r);return s.weights!==void 0&&a.traverse(function(o){if(o.isMesh)for(let l=0,c=s.weights.length;l<c;l++)o.morphTargetInfluences[l]=s.weights[l]}),a})}loadNode(e){const t=this.json,i=this,s=t.nodes[e],r=i._loadNodeShallow(e),a=[],o=s.children||[];for(let c=0,u=o.length;c<u;c++)a.push(i.getDependency("node",o[c]));const l=s.skin===void 0?Promise.resolve(null):i.getDependency("skin",s.skin);return Promise.all([r,Promise.all(a),l]).then(function(c){const u=c[0],d=c[1],h=c[2];h!==null&&u.traverse(function(f){f.isSkinnedMesh&&f.bind(h,g7)});for(let f=0,g=d.length;f<g;f++)u.add(d[f]);return u})}_loadNodeShallow(e){const t=this.json,i=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const r=t.nodes[e],a=r.name?s.createUniqueName(r.name):"",o=[],l=s._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&o.push(l),r.camera!==void 0&&o.push(s.getDependency("camera",r.camera).then(function(c){return s._getNodeRef(s.cameraCache,r.camera,c)})),s._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){o.push(c)}),this.nodeCache[e]=Promise.all(o).then(function(c){let u;if(r.isBone===!0?u=new PA:c.length>1?u=new Sa:c.length===1?u=c[0]:u=new Pn,u!==c[0])for(let d=0,h=c.length;d<h;d++)u.add(c[d]);if(r.name&&(u.userData.name=r.name,u.name=a),nr(u,r),r.extensions&&fa(i,u,r),r.matrix!==void 0){const d=new xt;d.fromArray(r.matrix),u.applyMatrix4(d)}else r.translation!==void 0&&u.position.fromArray(r.translation),r.rotation!==void 0&&u.quaternion.fromArray(r.rotation),r.scale!==void 0&&u.scale.fromArray(r.scale);return s.associations.has(u)||s.associations.set(u,{}),s.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],s=this,r=new Sa;i.name&&(r.name=s.createUniqueName(i.name)),nr(r,i),i.extensions&&fa(t,r,i);const a=i.nodes||[],o=[];for(let l=0,c=a.length;l<c;l++)o.push(s.getDependency("node",a[l]));return Promise.all(o).then(function(l){for(let u=0,d=l.length;u<d;u++)r.add(l[u]);const c=u=>{const d=new Map;for(const[h,f]of s.associations)(h instanceof Ns||h instanceof ni)&&d.set(h,f);return u.traverse(h=>{const f=s.associations.get(h);f!=null&&d.set(h,f)}),d};return s.associations=c(r),r})}_createAnimationTracks(e,t,i,s,r){const a=[],o=e.name?e.name:e.uuid,l=[];xr[r.path]===xr.weights?e.traverse(function(h){h.morphTargetInfluences&&l.push(h.name?h.name:h.uuid)}):l.push(o);let c;switch(xr[r.path]){case xr.weights:c=qo;break;case xr.rotation:c=Xo;break;case xr.position:case xr.scale:c=Yo;break;default:switch(i.itemSize){case 1:c=qo;break;case 2:case 3:default:c=Yo;break}break}const u=s.interpolation!==void 0?u7[s.interpolation]:il,d=this._getArrayFromAccessor(i);for(let h=0,f=l.length;h<f;h++){const g=new c(l[h]+"."+xr[r.path],t.array,d,u);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(g),a.push(g)}return a}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=Ym(t.constructor),s=new Float32Array(t.length);for(let r=0,a=t.length;r<a;r++)s[r]=t[r]*i;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const s=this instanceof Xo?l7:WA;return new s(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function v7(n,e,t){const i=e.attributes,s=new vr;if(i.POSITION!==void 0){const o=t.json.accessors[i.POSITION],l=o.min,c=o.max;if(l!==void 0&&c!==void 0){if(s.set(new Z(l[0],l[1],l[2]),new Z(c[0],c[1],c[2])),o.normalized){const u=Ym(Io[o.componentType]);s.min.multiplyScalar(u),s.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const o=new Z,l=new Z;for(let c=0,u=r.length;c<u;c++){const d=r[c];if(d.POSITION!==void 0){const h=t.json.accessors[d.POSITION],f=h.min,g=h.max;if(f!==void 0&&g!==void 0){if(l.setX(Math.max(Math.abs(f[0]),Math.abs(g[0]))),l.setY(Math.max(Math.abs(f[1]),Math.abs(g[1]))),l.setZ(Math.max(Math.abs(f[2]),Math.abs(g[2]))),h.normalized){const v=Ym(Io[h.componentType]);l.multiplyScalar(v)}o.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(o)}n.boundingBox=s;const a=new Bs;s.getCenter(a.center),a.radius=s.min.distanceTo(s.max)/2,n.boundingSphere=a}function ey(n,e,t){const i=e.attributes,s=[];function r(a,o){return t.getDependency("accessor",a).then(function(l){n.setAttribute(o,l)})}for(const a in i){const o=Xm[a]||a.toLowerCase();o in n.attributes||s.push(r(i[a],o))}if(e.indices!==void 0&&!n.index){const a=t.getDependency("accessor",e.indices).then(function(o){n.setIndex(o)});s.push(a)}return en.workingColorSpace!==di&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${en.workingColorSpace}" not supported.`),nr(n,e),v7(n,e,t),Promise.all(s).then(function(){return e.targets!==void 0?h7(n,e.targets,t):n})}function b7(n){let e;return{c(){e=K("canvas"),this.h()},l(t){e=q(t,"CANVAS",{class:!0,width:!0,height:!0}),F(e).forEach(S),this.h()},h(){x(e,"class",n[0]),x(e,"width",hd),x(e,"height",hd)},m(t,i){D(t,e,i),n[4](e)},p(t,[i]){i&1&&x(e,"class",t[0])},i:Tt,o:Tt,d(t){t&&S(e),n[4](null)}}}const hd=200,np=.6,y7=40,Js=50,nu=4;function T7(n,e,t){const i=new F9;let{canvasClass:s="block absolute top-2 left-2 rounded-full"}=e,{showEnvironment:r=!1}=e,{useRovOrientationData:a=!1}=e;const o=1.2*Math.PI/180;let l,c,u,d,h=y(),f=[],g=[],v=[],m;const _=E=>{c.add(E),v.push(E)};function y(){const E=[],C=Js,M=C/2;for(let T=0;T<y7;T++){const R=Math.random()*C-M,V=Math.random()*C-M,H=Math.random()*C-M;E.push(R,V,H)}const I=new Es;return I.setAttribute("position",new Ds(E,3)),I.computeBoundingSphere(),I}function b(E){const C=new _r({uniforms:{},transparent:!0,vertexShader:`
        varying float vOpacity;
        void main() {
          vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
          gl_PointSize = 0.3 * ( 300.0 / -mvPosition.z );
          gl_Position = projectionMatrix * mvPosition;
          // vOpacity = 1.0 - (-mvPosition.z / 80.0);
          vOpacity = 1.0 - (-mvPosition.z / 80.0) - max(1.0 - ((mvPosition.z * mvPosition.z - 20.) / 40.0), 0.0);
        }
      `,fragmentShader:`
        varying float vOpacity;
        void main() {
          gl_FragColor = vec4(1.0, 1.0, 1.0, vOpacity);
        }
      `}),M=Js*nu*.5;for(let I=0;I<nu;I++)for(let T=0;T<nu;T++)for(let R=0;R<nu;R++){const V=new OA(h,C),H={x:I*Js-M,y:T*Js-M,z:R*Js-M};V.position.set(H.x,H.y,H.z),g.push(H),f.push(V),E.add(V),v.push(V.geometry)}}const p=()=>{const E=new Z(d.position.x/Js,d.position.y/Js,d.position.z/Js).round().multiplyScalar(Js);for(let C=0;C<f.length;C++){const M=f[C],I=g[C];M.position.set(E.x+I.x,E.y+I.y,E.z+I.z)}};Da(()=>{l=new e9({canvas:m,antialias:!0,alpha:!0,failIfMajorPerformanceCaveat:!0}),l.setSize(hd,hd),l.shadowMap.enabled=!0,l.shadowMap.type=qg,v.push(l),c=new t9,b(c),u=new Ei(75,1/1,.1,1e3),u.position.z=5;const E=new R9(16777215,.8);_(E);const C=new zA(16777215,2);if(C.position.set(0,1,0),C.rotation.set(Math.PI*2,Math.PI*2,0),_(C),r){const I=new VA().load(N4,()=>{I.mapping=sd,c.background=I});v.push(I)}return i.load(D4,M=>{if(l===null)return;d=M.scene,c.add(d);const I=new GA(16777215,0,100);I.position.set(0,8.5,18),d.add(I);const T=d.children.find(z=>z.name==="Prop_R"),R=T.clone();R.position.x=-T.position.x,d.add(R);const V=d.children.find(z=>z.name==="Claw_R"),H=V.clone();H.rotation.z=Math.PI,d.add(H);const B=new Z(0,25,-50);let te=B.clone().normalize(),j=B.length();function oe(){if(l===null)return;requestAnimationFrame(oe);const z=Nd.get()||!a?1:0,W=ou.get(),ie=W.velocityX*np*z,se=-1*W.velocityY*np*z,je=W.velocityZ*np*z;d.translateX(se),d.translateY(je),d.translateZ(ie);const ge=-W.angularVelocityYaw*o*z;if(R.rotation.z+=ie*.15-ge*8,T.rotation.z+=ie*.15+ge*8,a?(d.rotation.x=XE.get(),d.rotation.z=YE.get(),d.rotation.y=qE.get()):ie>0&&(d.rotation.y+=ge),H.rotation.y=je,V.rotation.y=-je,I.intensity=500*Math.max(-je,0),W.buttonBitmask!==0){const J=new Z(0,20,50);j=J.length(),te=J.normalize()}else{const J=new Z(0,25,-50);j=J.length(),te=J.normalize()}const L=new Z().copy(te).applyQuaternion(d.quaternion);L.setY(0).normalize().setY(te.y).multiplyScalar(j).add(d.position),u.position.lerp(L,.1),u.lookAt(d.position),p(),l.render(c,u)}oe()},M=>{},M=>{cn("Error loading ROV model",1e3,!1,Zt.error),console.error("Error loading ROV model",M)}),()=>{for(const M of v)M.dispose?M.dispose():M.destroy?M.destroy():console.error("Unknown object to dispose",M);l=null,v=[],f=[],g=[]}});function w(E){Nn[E?"unshift":"push"](()=>{m=E,t(1,m)})}return n.$$set=E=>{"canvasClass"in E&&t(0,s=E.canvasClass),"showEnvironment"in E&&t(2,r=E.showEnvironment),"useRovOrientationData"in E&&t(3,a=E.useRovOrientationData)},[s,m,r,a,w]}class S7 extends Bt{constructor(e){super(),Vt(this,e,T7,b7,Ft,{canvasClass:0,showEnvironment:2,useRovOrientationData:3})}}const E7=`<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd" viewBox="0 0 123 232">
    <g>
        <path d="M113 140.769c-6 29.375-13.537 33.424-35.28 43.583-35.355 16.519-33.138 57.105-56.59 45.51-14.36-7.1-21.13-19.23-21.13-38.4 0-24.92 11.42-65.99 32.4-119.1 10.625-22.199 25.844-16.641 42.794-16.641 7.93 0 15.744-1.226 22.454 2.224 14.564 7.511 21.031 55.022 15.352 82.824" id="gpad_base_left" class="gpad-base"/>
        <g id="stick_left">
            <text x="58.772" y="222.614" style="font-family:&quot;ArialRoundedMTBold&quot;,&quot;Arial Rounded MT Bold&quot;,sans-serif;font-size:11px">Forward</text>
            <circle cx="82.237" cy="176.33" r="26.46" style="fill-opacity:.5" class="gpad-shadow"/>
            <circle cx="80.987" cy="175.09" r="25.21" style="fill:#6180b0;stroke:#000;stroke-width:2.49px" id="stick_left_base" class="gpad-stick-base"/>
            <g>
                <path d="M80.987 179.329v-8.477h25.442v-3.768a1.7 1.7 0 0 1 2.902-1.202l8.006 8.006a1.7 1.7 0 0 1 0 2.404l-8.006 8.006a1.7 1.7 0 0 1-2.902-1.202v-3.767z" style="fill:#ff00bf" id="l_stick_right_direction_highlight" class="gpad-direction-highlight"/>
            </g>
            <g>
                <path d="M76.749 175.09h8.477v25.442h3.767a1.7 1.7 0 0 1 1.203 2.902l-8.006 8.006a1.7 1.7 0 0 1-2.405 0l-8.005-8.006a1.7 1.7 0 0 1 1.202-2.902h3.767z" style="fill:#ff00bf" id="l_stick_down_direction_highlight" class="gpad-direction-highlight"/>
            </g>
            <g>
                <path d="M80.987 170.852v8.477H55.545v3.767a1.7 1.7 0 0 1-2.902 1.202l-8.006-8.006a1.703 1.703 0 0 1 0-2.404l8.006-8.006a1.701 1.701 0 0 1 2.902 1.202v3.768z" style="fill:#ff00bf" id="l_stick_left_direction_highlight" class="gpad-direction-highlight"/>
            </g>
            <g>
                <path d="M85.225 175.09h-8.477v-25.441h-3.767a1.701 1.701 0 0 1-1.202-2.902l8.006-8.006a1.7 1.7 0 0 1 2.404 0l8.006 8.006a1.699 1.699 0 0 1-1.202 2.902h-3.768z" style="fill:#ff00bf" id="l_stick_up_direction_highlight" class="gpad-direction-highlight"/>
            </g>
            <g>
                <g id="stick_button_left" class="gpad-thumbstick">
                    <circle cx="82.847" cy="176.96" r="17.12" style="fill-opacity:.5" class="gpad-shadow"/>
                    <use width="65" height="65" x="48" y="143" transform="matrix(1,0,0,1,0.25,0)" href="#lt3_a" class="gpad-highlight"/>
                    <g>
                        <g class="gpad-btn-bg">
                            <circle cx="80.987" cy="175.09" r="17.15" style="fill:#fff"/>
                            <path d="M80.987 157.94c9.466 0 17.15 7.685 17.15 17.15s-7.684 17.15-17.15 17.15-17.15-7.685-17.15-17.15 7.685-17.15 17.15-17.15m0 2.5c-8.085 0-14.65 6.564-14.65 14.65s6.565 14.65 14.65 14.65 14.65-6.564 14.65-14.65-6.564-14.65-14.65-14.65"/>
                        </g>
                        <g class="gpad-btn-bg">
                            <circle cx="80.987" cy="175.09" r="13.111" style="fill:#fff"/>
                            <path d="M80.987 161.979c7.236 0 13.111 5.875 13.111 13.111s-5.875 13.111-13.111 13.111-13.111-5.875-13.111-13.111 5.875-13.111 13.111-13.111m0 1.35c-6.491 0-11.761 5.27-11.761 11.761s5.27 11.761 11.761 11.761 11.761-5.27 11.761-11.761-5.27-11.761-11.761-11.761"/>
                        </g>
                    </g>
                </g>
            </g>
        </g>
        <g>
            <g id="select_button">
                <path d="M106.075 132.272a8.62 8.62 0 0 1 2.867 6.428 8.62 8.62 0 0 1-2.867 6.428h-11.55a8.62 8.62 0 0 1-2.867-6.428 8.62 8.62 0 0 1 2.867-6.428z" style="fill:#9a9a9a;fill-opacity:.5" class="gpad-shadow"/>
                <use width="43" height="39" x="78" y="118" transform="matrix(1.14878,0,0,1.14878,-14.5926,-20.5599)" href="#lt3_b" class="gpad-highlight"/>
                <path d="M105.066 131.238a8.62 8.62 0 0 1 2.868 6.428 8.62 8.62 0 0 1-2.868 6.427H93.517a8.62 8.62 0 0 1-2.868-6.427 8.62 8.62 0 0 1 2.868-6.428z" style="fill:#fff" class="gpad-btn-bg"/>
                <path d="M105.066 131.238a8.62 8.62 0 0 1 2.868 6.428 8.62 8.62 0 0 1-2.868 6.427H93.517a8.62 8.62 0 0 1-2.868-6.427 8.62 8.62 0 0 1 2.868-6.428zm-.542 1.35H94.059a7.27 7.27 0 0 0-2.06 5.078c0 1.973.786 3.764 2.061 5.077h10.464a7.27 7.27 0 0 0 2.06-5.077 7.27 7.27 0 0 0-2.06-5.078"/>
                <path d="M95.383 139.64h7.817c.534-.634.547-1.279 0-1.939h-7.817c-.555-.647-.546-1.305 0-1.974h7.817" style="fill:none;stroke:#000;stroke-width:.9px;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" id="select_button_icon" class="gpad-btn-icon"/>
            </g>
        </g>
        <g>
            <path d="M68.911 109.039a.853.853 0 0 0-.85-.85H50.322a1.67 1.67 0 0 1-1.671-1.671V91.282a1.67 1.67 0 0 1 1.671-1.671h17.739a.853.853 0 0 0 .85-.85v-17.71a1.7 1.7 0 0 1 1.7-1.7h15.207a1.67 1.67 0 0 1 1.671 1.671v17.739a.853.853 0 0 0 .85.85h17.739a1.67 1.67 0 0 1 1.671 1.671v15.236a1.67 1.67 0 0 1-1.671 1.671H88.339a.853.853 0 0 0-.85.85v17.739a1.67 1.67 0 0 1-1.671 1.671H70.582a1.67 1.67 0 0 1-1.671-1.671z" style="fill:#9a9a9a;fill-opacity:.05" class="gpad-shadow"/>
            <g id="dpad_up">
                <use width="48" height="53" x="53" y="54" transform="matrix(1.01954,0,0,1.01954,-1.61437,-3.02471)" href="#lt3_c" class="gpad-highlight"/>
            </g>
            <g id="dpad_down">
                <use width="48" height="52" x="53" y="91" transform="matrix(1.01954,0,0,1.01954,-1.61437,-3.02471)" href="#lt3_d" id="dpad_down_highlight" class="gpad-highlight"/>
            </g>
            <g id="dpad_right">
                <use width="52" height="48" x="70" y="75" transform="matrix(1.01954,0,0,1.01954,-1.61437,-3.02471)" href="#lt3_e" class="gpad-highlight"/>
            </g>
            <g id="dpad_left">
                <use width="52" height="48" x="33" y="75" transform="matrix(1.01954,0,0,1.01954,-1.61437,-3.02471)" href="#lt3_f" class="gpad-highlight"/>
            </g>
            <path d="M67.903 108.022a.85.85 0 0 0-.85-.85H49.314a1.67 1.67 0 0 1-1.67-1.671V90.264a1.67 1.67 0 0 1 1.67-1.671h17.739a.85.85 0 0 0 .85-.85V70.034a1.7 1.7 0 0 1 1.7-1.7h15.208a1.67 1.67 0 0 1 1.67 1.671v17.738a.85.85 0 0 0 .85.85h17.739c.443 0 .868.176 1.181.49.314.313.49.738.49 1.181v15.237a1.671 1.671 0 0 1-1.671 1.671H87.331a.85.85 0 0 0-.85.85v17.738a1.67 1.67 0 0 1-1.67 1.671H69.574c-.443 0-.868-.176-1.182-.489a1.68 1.68 0 0 1-.489-1.182z" style="fill:#fff" class="gpad-btn-bg"/>
            <path d="M67.903 108.022a.85.85 0 0 0-.85-.85H49.314a1.67 1.67 0 0 1-1.67-1.671V90.264a1.67 1.67 0 0 1 1.67-1.671h17.739a.85.85 0 0 0 .85-.85V70.034a1.7 1.7 0 0 1 1.7-1.7h15.208a1.67 1.67 0 0 1 1.67 1.671v17.738a.85.85 0 0 0 .85.85h17.739c.443 0 .868.176 1.181.49.314.313.49.738.49 1.181v15.237a1.671 1.671 0 0 1-1.671 1.671H87.331a.85.85 0 0 0-.85.85v17.738a1.67 1.67 0 0 1-1.67 1.671H69.574c-.443 0-.868-.176-1.182-.489a1.68 1.68 0 0 1-.489-1.182zM49.359 90.309v15.147h17.694l.503.049.479.146.442.236.39.32.321.391.236.442.145.479.05.503v17.693h15.146v-17.693l.05-.503.146-.479.235-.442.321-.391.391-.32.441-.236.479-.146.503-.049h17.694V90.309H87.331l-.503-.05-.479-.145-.441-.236-.391-.32-.321-.391-.235-.442-.146-.479-.05-.503V70.05H69.619v17.693l-.05.503-.145.479-.236.442-.321.391-.39.32-.442.236-.479.145-.503.05z"/>
            <g>
                <path d="m91.96 93.246 9.273 4.631-9.284 4.653v-9.295z" style="fill:none;stroke:#000;stroke-width:1.69px;stroke-linejoin:round" id="dpad_right_button_icon" class="gpad-btn-icon"/>
            </g>
            <g>
                <path d="m62.406 102.519-9.284-4.642 9.284-4.642z" style="fill:none;stroke:#000;stroke-width:1.69px;stroke-linejoin:round" id="dpad_left_button_icon" class="gpad-btn-icon"/>
            </g>
            <g>
                <path d="m81.819 112.649-4.641 9.284-4.642-9.284z" style="fill:none;stroke:#000;stroke-width:1.69px;stroke-linejoin:round" id="dpad_down_button_icon" class="gpad-btn-icon"/>
            </g>
            <g>
                <path d="m72.536 83.105 4.652-9.283 4.631 9.283z" style="fill:none;stroke:#000;stroke-width:1.69px;stroke-linejoin:round" id="dpad_up_button_icon" class="gpad-btn-icon"/>
            </g>
        </g>
        <g>
            <g id="shoulder_trigger_back_left">
                <path d="M114.915 30.441h5.073a1.7 1.7 0 0 1 1.471 2.551l-9.322 16.121a1.7 1.7 0 0 1-2.944 0l-9.298-16.08a1.726 1.726 0 0 1 1.496-2.592h5.024V10.957h.002a8.5 8.5 0 0 1 8.498 8.498z" style="fill:#ff00bf" class="gpad-direction-highlight"/>
                <path d="M53.55 40.321a1.7 1.7 0 0 1-1.7-1.7V18.479a6 6 0 0 1 6-6h18.295a9 9 0 0 1 8.172 5.23l9.32 20.199a1.7 1.7 0 0 1-1.544 2.413z" style="fill-opacity:.5" class="gpad-shadow"/>
                <use width="76" height="54" x="32" href="#lt3_g" class="gpad-highlight"/>
                <path d="M51.56 38.798a1.7 1.7 0 0 1-1.7-1.7V16.957a6 6 0 0 1 6-6h18.295a9 9 0 0 1 8.172 5.229l9.32 20.2a1.698 1.698 0 0 1-1.544 2.412z" style="fill:#fff" class="gpad-btn-bg"/>
                <path d="M51.56 38.798a1.7 1.7 0 0 1-1.7-1.7V16.957a6 6 0 0 1 6-6h18.295a9 9 0 0 1 8.172 5.229l9.32 20.2a1.698 1.698 0 0 1-1.544 2.412zm38.335-1.7a.3.3 0 0 1 .008-.064q-.003-.031.028-.064l.016-.016a.3.3 0 0 1 .069-.045l-9.233-20.011a7.3 7.3 0 0 0-6.628-4.241H55.86a4.3 4.3 0 0 0-4.3 4.3v20.141z"/>
            </g>
        </g>
        <g>
            <g id="shoulder_button_front_left">
                <path d="M92.9 44.65c1.591 0 3.117.632 4.243 1.757A6 6 0 0 1 98.9 50.65v7.6a1.7 1.7 0 0 1-1.7 1.7H50.8a1.7 1.7 0 0 1-1.7-1.7v-7.585a6.015 6.015 0 0 1 6.015-6.015z" style="fill:#9a9a9a;fill-opacity:.5" class="gpad-shadow"/>
                <use width="80" height="46" x="33" y="28" href="#lt3_h" class="gpad-highlight"/>
                <path d="M91.931 43.65a6 6 0 0 1 6 6v7.6a1.7 1.7 0 0 1-1.7 1.7h-46.4a1.7 1.7 0 0 1-1.7-1.7v-7.585a6.015 6.015 0 0 1 6.015-6.015z" style="fill:#fff" class="gpad-btn-bg"/>
                <path d="M91.931 43.65a6 6 0 0 1 6 6v7.6a1.7 1.7 0 0 1-1.7 1.7h-46.4a1.7 1.7 0 0 1-1.7-1.7v-7.585a6.015 6.015 0 0 1 6.015-6.015zm4.164 13.599.005-.019c-.033-.019-.008-.05.035-.076.026-.043.057-.067.076-.034l.02-.006V49.65a4.3 4.3 0 0 0-4.3-4.3H54.146a4.315 4.315 0 0 0-4.315 4.315v7.45l.019.006c.021-.037.056-.006.083.043.022.017.033.036.023.052l.011.034z"/>
            </g>
        </g>
        <path d="M103.913 149.248c7.13 6.332 11.626 15.566 11.626 25.842 0 19.07-15.482 34.552-34.552 34.552-19.069 0-34.551-15.482-34.551-34.552s15.482-34.552 34.551-34.552c2.159 0 4.271.199 6.32.578 1.498 5.206 6.3 9.018 11.985 9.018a12.4 12.4 0 0 0 4.621-.886" style="fill:#419bf3;fill-opacity:.25" id="stick_button_left_tap_target" class="gpad-tap-target"/>
        <path d="M97.301 125.355a12.6 12.6 0 0 1 1.991-.158c6.881 0 12.468 5.587 12.468 12.469s-5.587 12.468-12.468 12.468-12.469-5.587-12.469-12.468c0-3.13 1.155-5.992 3.063-8.182a34 34 0 0 0 7.415-4.129" style="fill:#f37f41;fill-opacity:.25" id="select_button_tap_target" class="gpad-tap-target"/>
        <g id="dpad_tap_targets">
            <path d="M45.065 86.582a34.18 34.18 0 0 1 20.827-20.827v20.827z" style="fill:#497d7f;fill-opacity:.25" id="dpad_up_left_tap_target" class="gpad-tap-target"/>
            <path d="M65.892 130.009a34.18 34.18 0 0 1-20.827-20.827h20.827z" style="fill:#617333;fill-opacity:.25" id="dpad_down_left_tap_target" class="gpad-tap-target"/>
            <path d="M109.319 109.182a34.18 34.18 0 0 1-20.827 20.827v-20.827z" style="fill:#552525;fill-opacity:.25" id="dpad_down_right_tap_target" class="gpad-tap-target"/>
            <path d="M88.492 65.755a34.18 34.18 0 0 1 20.827 20.827H88.492z" style="fill:#634669;fill-opacity:.25" id="dpad_up_right_tap_target" class="gpad-tap-target"/>
            <path d="M65.892 109.182H45.065a34 34 0 0 1-1.923-11.3c0-3.96.678-7.763 1.923-11.3h20.827l11.3 11.3z" style="fill:#b851b5;fill-opacity:.25" id="dpad_left_tap_target" class="gpad-tap-target"/>
            <path d="m65.892 109.182 11.3-11.3 11.3 11.3v20.827a34 34 0 0 1-11.3 1.923c-3.96 0-7.763-.677-11.3-1.923z" style="fill:#51b882;fill-opacity:.25" id="dpad_down_tap_target" class="gpad-tap-target"/>
            <path d="m88.492 109.182-11.3-11.3 11.3-11.3h20.827a34 34 0 0 1 1.923 11.3c0 3.961-.677 7.764-1.923 11.3z" style="fill:#5166b8;fill-opacity:.25" id="dpad_right_tap_target" class="gpad-tap-target"/>
            <path d="M65.892 86.582V65.755a34 34 0 0 1 11.3-1.923c3.96 0 7.764.678 11.3 1.923v20.827l-11.3 11.3z" style="fill:#b7b851;fill-opacity:.25" id="dpad_up_tap_target" class="gpad-tap-target"/>
        </g>
        <path d="M44.273 41.355V3.448h40.921l17.489 37.907z" style="fill:#419bf3;fill-opacity:.2" id="shoulder_trigger_back_left_tap_target" class="gpad-tap-target"/>
        <path d="M40.661 41.355h64.74v22.323h-64.74z" style="fill:#7041f3;fill-opacity:.2" id="shoulder_button_front_left_tap_target" class="gpad-tap-target"/>
    </g>
    <defs>
        <image id="lt3_a" width="65" height="65" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEEAAABBCAYAAACO98lFAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAHVUlEQVR4nO1b2XLjOAyEnawzmUxm9mF+Ll84P5eXzX1rX9R2q9UAacXeo2pQhaJsyyLRBEAQoCJ+U6yO3cHVcF31wb8N1XN+rX6Wv3+GDg6CEXqVXLvPQ8f1wQE5GAgi/Iralfmu6nugdjDfcXsQQD4NAgmfCb6m79w9TApAxXz/p8BYDIKZeeU1teuoAcmE/2i0/J/FQCwCQWY/E/wkdgDoZwUCpIJ+RMR7cs33TjRjXzD2AiFRfSf4CfEpXfM9CgTPPgRWfpPfGJCJqewDRDcIjdlXoStWDQE5AN4a/B5TDVkERBcICQCs5izkHyNvpMVvuJ+1gUFgAF6JX+RawXCa0QVEE4QEAFZtFXwTEWcjb6hlMAACgGBTUABeRn4e+YVaAMNAvIc4zxYQJQgFAGAV/ovhM2LcD7NQTWAteCF+MsygODC6gTitQCgAwGzyrH+JiPOI+Dq2zApECwTWAAj9SLwZ28zJxvic7bOvhutVBkQKgokD1AfwzEP4rxFxMTI+n9N9bBIsAIMAO4faMwD3MQdyLc9R+qDnW7J/FDNQ4aH+EP58FPrbyBfUAoweEODUMhDuie9G5u8eY2cmMA82jSEiBqcNlTm4ZRAgQP0x85ej4N/HFp9bILR8AoPAPkafEfQMx1vf4MxiBkLDDDIAvgs7ELBKYJlsgfAaO+f3GFOfwv93ALggivuZUKYJLhaAZz+LnQ/ArH+PiB8jA4hvsfML0IJNzE0hixPgHJ9juszy/0P+68LrWRCl2tBjDuuYrwbsBy5H4f8kEKAJcIwQgqNGFzazENAGaE/lUF2kmQZQIdowAWE0hSwiZFNgENgMGISL2K0MmUME8+BUG3oAYNBcJAkwuC8PApFziKwF8AfQBJgErlULsiUt20WC3X6DVxNeUl2IrXuMLRBsEg6EbEUACOwUsSxexnSJhC9QZ1htpVUbPuh+5z8yJ1pFkuvYOcm5TyBTyIBgTWBtUGYNYC1o5RIYiHUCAoPk4gkXVmeOeEtLNUEjRF4FeL9Q+QFHmCHdrkN4sGoAYomHmC/HzpdMNIGXGR4IO0V1jNAGjhg1NNaVwM2oCuoY/9Gdqu5XdBwZCJP+EROpJlQD0G2y2yXqdtl2boDXMTBhojAZ78k4dOfauyKVq4NLmigQbneone4DgI6BgRhkLFn+QnMXThMn4ziNmMUHVe7glDrQIIYB4I6dUPuQbubURJndmHg81h9lPsFtnnQWeBDaoVtplpBqg45HweCxuQnRcW0fnHXOJqEdaxY5iwGWCu/G4sbVGlO2Kk3GpSC4DhWMjDPhDwGEjqd3TOqXus1BB5517B5+aC1okY7N9d8cRwbC/5UWgZ+BoGXxfQqkQ5id2pFor6JtRgqCCuCyNRW7zg8FiEuZVXXLtESnVGmCE94lLcoszgFIn9Ma01vUEzQbmwMhE5737e46A8MJsi9l2tiqV2ZF28mY1hHb6oyzbdeRqw06MPa2zUL4bFJeC66AmFCPJrjSWFUT1PzeUiBckoXzCK5OWY1HD3ZsyW2gVAu0LMZJDG6fY7qF5nUbYHO+oEf4TCN1LDoOl1VKtUFBcB5YkXe1Qc0ouw0Lg9EiTaCw+nONksfwFL4K5Uw0InbVqGwrrabANQDuHJkczihzzM5CnYwt5/laAGAM7IdU+AdigPBkQHBARPBAxTmqCjotuDeMgWAwmLXsMIXz9u6QhuYRIXTWP7Sh0oQttXwCA4GBcElMK0PsC0Ke00q5u5WAfYCCfyfMILBfqFasFAQFwiU1HyKvDPEzGEg1lSyR6lYBgP8wCnwbETfEt+Gr06lTTMtwv1Y/h6vhWoVgTeAMkzuMxQKxWmsZTvOOFfCqBbcCAj7fxdQc1Cfg2TOqapGo1mBASGI8xTTL5CpDqsqupL5PQRbaB9W/iYi/Rr6h7wFCtjyiny4QcKMCAdWsKkPOo6OyzOajOcjM/GAKUHc1BTaHh5g7xdIULAijSTihNHHhhMhmkeOIpYc02CECCDUFtypMTqqovBYEEUqBeI25QwOp/2BbZhCqMwZVXIIl0a0KrAXOF2yF7z6uQ9rAzgpm8TrexiDoHkM9egWC9pNFhi420CAJS2PXxglUpqI6zitofZKLtb2lscqhsk+Ac3yMeVDmAjPd1qdnGXvOMbKTzH6vljWtUbp4gUFwTtUd5tQNE+8auwGIaGhChD3VmhVruQSmJTp3rLfn4BYD8WyuOafhEjsR4Y/t7QVCAwitVbqS2Ea+1/AZ5OIE1iz2E5o44VcAOChqAtANQgJEVglypTqefY4RqjDbpfSyM0k2rXfQo/6gxjsPzkyyFz9aYbPbUb4bThO8R3npA1S8+8RVKYDBbVa2Y9JUGgPCbZZB3hsACLGIirfgtETXKtsxue20u7bCRyx7GexT9cLGu5A97MgJyMLrPRHxL70SyFSAgTa7VhpMm11HxH/k5VClBJDq2tFMWLk+6KvCRy2fFy+L94IwoWO9NP5PnCGYUfUm/THfjv9NBf0N6UGHaHzqzbQAAAAASUVORK5CYII="/>
        <image id="lt3_b" width="43" height="39" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAnCAYAAACWn7G7AAAACXBIWXMAAA7EAAAOxAGVKw4bAAADoklEQVRYhdWZ3XbaMBCExxQSCm2v8nJ5wrxc7hrCT0joBRo8HkayKTetztkjY2T0abzeXQvgP2rdPRc/n15vuv6lezrdM9/kySpgty72CvaWBYxOZpCd9a3jBHeq9ADGwauwDUg1hOMxODXYcRM4wgpogpxVjn1xNcCvyufLomrAV7AG6pDJHFqbQyVLC4jA87SCBuQ3s5n0Duygn8X0mIZy/rLI59Nr58AD2KCqQs5LvyjHcznnwAqrcMdgXQ04KZhAOSlBCLgA8GD9QhbjsAr6IXawzx8YKn/xY1XX3cBvPyEI9wDg0YzQhJ0JrIPui81LX/NxXfClJZ8lrKq6KGBLAN+LLYspMN1BYY84K7kHsCtG9/G7cBXa1HdryrqvPhSwVbF16QlOYMJ26F2Aiu4AvNuiUqTQ8wN156SXVSosXUBV/SFG6GWBpWIoEx8L7A7AVsbMZIxHB57TWN3DBmXpBuqvVHYN4KfYWtRdmLJ8mLblewflYmjHApxi9k1u8FigVjir+kuAV+hdwWH3shCqRfc4iGk00bsco0GKsUldAqvCa/SuoG5AWILwlh/QP2yMJBqvo7IzP9FQV4Edeo3eh92naXwgGUGoNkFTFgSAjjkguYEDc8WatTTuauylssxKFOOIs8KaSGrZr1bBVWsDH5ySRaoVaLz2qzI2FUC1krSawbTV6koP3MmmjPM5Rt8YWrA6ocdCFiEaduboowBKzyedY3ldqgPSIppxNtWfDsfUyaxEPz2VMeqzmhD49O9lERpbFXoAnNKtDkqgmt81G2lMZSrt5Fqm2TcAm3K8FWgHdujJynohQkiFIugSOYPxug2A3w1gugbnVgGbsKosb70GcIYkfs906rBc6LYAbnBW+A29a4y5Q4RlHcmB6gJ7DMMOTDktZLRE1EKG7rARo7qEHXeDl+7pVLJETVl9DyMoVeND5qqrG/GB3Iq9o3/gkrLAiBtwACdK+wRepzKLadrk7xBWo8gO15HBX2viW27y2Rqwnqeq/h6Wqn8HTqZuEF0AsPwrRbgXMlobaG6vVUyE1fcwTySeKLiwC3DzVVwmAa5fi9WXGfy9YvIqTtXldQrvbwieyQZtyo6MFh1exPjOTGuTQ+0znBvE17QjM2WvK+1z1Xr9TS9ofKuounUE5O2jCBuAE3iKFGkfQIHHKrQqaBPWgB261aeWqqmrWPrX+7Pawq732OfUqrXr1N3vSbDabv0fodbu/X/hn29/AAo2VaYa5XYBAAAAAElFTkSuQmCC"/>
        <image id="lt3_c" width="48" height="53" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAA1CAYAAAAHz2g0AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAEw0lEQVRoge1ay3LbMAxc2c6zSU/5uX5hfq7HJo7t2OqhXGu1Akgp8UybmXIGI1mWCCxeBCEBX3x0l5zsR/9z9nzP3VN/CZ6zGTaE+4wiUiBzQFYZB0J3M86XDBewz/7LwISMTfAuOEbXqnPOELSvnAOIQawajCjsqtBaaFPoSug6+H2dXL+S5znXWnithH8HxG48uSA36cMrjIH4uVNtuJZ7ACc5nux3bzSyxIhZRXhqPzq6xhAcM8Ep5LFxTEFsAg258O426j68Hpm9BYCaPhZ6lyPPO/lf5ziPCAAZq+YjfydFQDIAmfCHIvSh0L781mdPMt/UhYr7uNtQcAbdTaFrOXoQasyQBxmqb1PbFJi0kyMB0SLqUnjunvqaC6n2KfwtgLtyvDVAbgkH4D5PzVPYt0Jre0YDW90zjQFg6j4EcAfgXohgbjB2J89OketQuxScSlglwiuIswttgGb2oQsRwLdCD+VIEHQnWiED4K6zBfBa+FAOve8d09g6j6UuRAs8APhuIOhKfCYCoBlnXzRP63FR7TEOaMbAezDnBIBaIosBAngUusdgBQY05+Bw36ffq/CnIuiuEC0apWg4ABde44DLf2SFR4ytQADKUC1A7e/wx31UeALTmPK5VN5qFuowXsAiEIyFBwyxQMYRALoCAWwEGAPa03O2SALIs5ACURAszDSlalYiALpFBmBX5gTGWteU7MWdr/DNGMhKCq0oyVTXBwVAxsxAmlW6co3C+6JY1TxH5kIKwuNBXcpLZi2dIwDUKMrvPaZliS6IUYU7y4VaVakXeFrb1yygeV6fy4pCz/2z1gG9ObJGVGJHwByAW2Jtz9VcZpELZUBq8VEjXfqz/1s80jEHQAZmCS19dvZo7Yn/+fEfwN8eXx7A0iDm8C5BjT5y/0UBLGGuOyeOLvhvCdgPA/AJsibUEeMNN6/xfgVwrDwTAYzkmAXABc+E9l7OAUMez4o53WFpD8gBZZZpAshMqUyU+R7D/la3hVp6qAVYPvO5rHUSWQN23rRApHFtPnHr9ybC877WfoDdCAejVoksMRoOQG/yJpRvB7UdssZgJVajmQV0Q78t5GAia7g7hQCAMeJoI07ht0V4ap7WWbInfgXwUohA2KE7CO80MymAKHDVb1Xzrxh3E44YNunaScgAaE/oVyGC2GJoK6ornVuKKm/kQpp1nCGFp4ZVeG8xZgBcIS8BCI0LtYIruupC3kVjn0aF57Zwi6EVottB7wtFc7IzF7kSreAL5DgGnrunvrQXI/+nz2r3mf97K6TVG82sQBAkBrRaIEqp1TQaaUv3tEcM2ve+aK297n1PTwzMSG6BZhC78J0wUoGYz9WtXPiwEYtxbEXvB3ZCTKe+JgDuQia8g2BTlde1Nc7umm7mo62kr+6e4XyB1BU6WwvOk59H8pbGXzMp8frSd2RuCa+rDnZtEsS1l3zqr35d/Td7SxkJXwORValRTaRzxEwaLzuixpNnnEz4CERU6Wal9dl99D1xaz/AoUy0xsnaIXMBKBAFk9Hkc4OQUeVbicg6Ps+cvo6XBBEY+DH6VqLKLAGi5/783KaUCxLV+6N7Fn2t4qPyrdCiLlpjhAK2vhn6lABLvtBqjUt9wfXlxm/KDCtMj03mWAAAAABJRU5ErkJggg=="/>
        <image id="lt3_d" width="48" height="52" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAA0CAYAAADMk7uRAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAEkklEQVRoge1ay3LbMAxcp3bzcnvqz+UL+3O5tY3t2I57CDdergBISjLT8Uw5g6EsiyQWDxKABFx4W7x34MPp8d1js/Zz8eM0d8wkJhJmPx0AgAGAMVAlE8b4wvrqemo7BdfRvRRIuGjBuBKC62yNaHFn+CSE4DoEMVg0YF7pqvjt80WAXLoRvRT/DUAsg0V0cWXyqqBIM1lzCb8kpP+9jX04PS4URLeQSF8lTPpipPci7VQAnPmj9E4KaKCJSAPOPJlcJqSAFIjOF9m5Mn8IiHwc29hOEzo5gIH0lXkyugLw1fqVAXGT8qY2TgkfAOyFnu33Hr02Oi24BtxBKd0VgGujr9JnIDhnJXkyvWvEOYDEkaVPTcg1QKnfALi1niBWGJqTamGM+Y3MsQjGqPbezHKKDyxxlvYtgDsA962/MxDqExkAmgOZ3zZS5v3ZI3rr6DVg9s+eGqCtE8A9gHUjAiGISAsKwO2ekn9CL/nIuY9tztFzINqBqIGbxvAawLdG6wbMtaBmRPuNpH/dxizkmUP7n+QCSU0ocmL6gAK4b8x/b71qgQ6dAXDpr0SyCi4TRre7KYAohJgK4h5nLXBr1TNBbZoAto1JMk+pq0/4zubCHmyjzny0ExGEOvS6XRMApaoaUADPOPvLS7tHjegcszQADLUwBQSB0IwyAJTyHmcTO+FsTrodZwfjqA8o81VIQSYJhoBucLZdXZwaOMh/aL/1QIxO9jJQzEwoA6LB3Ao9EPYVADJFh3WmXfJVWJICUMZ57SG1AllKr3FTBEC3yiwgrCQ/AJIByIAoiAyQMqMAXBORpCczPhWAA4kmnkJznw93nI8AGAP0WQBmNz8cLq79B/Cv28UDmOvEWb2moo+M+xQAY8xkdR22xchzUSErWnc2gGgyLzhl9Rw/8DQWiuo+Xv/pqg8VkAzAWB1H0709+iiTDGcAtIyi6aKCc804XyWAqvRX1XI0RGb+mgHYoU8Znw3MmGmlACo7V+lx0R1esyeV/AF1PnCQcVsD41rRYlbYKhPyLMrrOFvEOe2UlJKp41OjjYEhkMycysKWS96LUGScqd9Ve46ZlQNg87l2jfnfAP60a2qFIMZ8ogOQ2b5LbYM+adG0UMuMEQCaIoWxacw7iB36umjq0JUPZNL3ChptmmkhkxuNMr0uFJnRrwaC5kTHTkvsEQAgNh/aPbMnzawoSa+PRgAioWzQa8K1QBDhwbYEXsvUrbyYmQ/rOOqUR7mv9aCpxd29jKdpqkNHzjz5HIg04DUelaAXdmn7DkDn1SocS+tb9Nur+sCoE3MRj130bQmfoenorqPmVQGITMnPFj8X3JHfQHRpXDMjjWO8qLWy65X87wl6BSA6Y/x090Ot00L1joyLvST3OCnDh6yCFuW4WRSrsVAWG+VOHCzC5i/WdCusXrVWCXoWjntkmtp++poVCF+1qllFdaG51YUs0o3Cdb33NrYEEICIwIyVRTIQUWjsGokoZL5aaOx7Cb9XzlU0D86igC00HWcsbMFnNnN/Zy0KjyPtAKg/uZkstZkfOI058Wh7z8dPF9n+Akw5M9cvVTL/AAAAAElFTkSuQmCC"/>
        <image id="lt3_e" width="52" height="48" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAAwCAYAAABe6Vn9AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAEqUlEQVRogd2a3VLjMAyFT0qh/C1XvBxPyMtxudAW0nYv8GmOFclWYHd2Bs9o8m/7i2RbUgL8sDIsufnp9LLo/r9VnofHU/bebgcdiN7xd4vtfHXcgws7Y0CG5DbTRqtDp+Q2BJt1pAESCcx+rw2vI9phu2/lfL8HtQ464UGsgq0HGMF4QB7AMdhWUE+nl8FCVQ2KdiyIyoVzboWctrIgh7JP0eOZxhTK05CFIcC67FPWmMNFmuoB2c5bGWSrYLNyBnLGDmHY+TWAS7OlEExNMQOkmlGAEcBHkRHTSzrIs4Psz4EExJoaAS4BXAHYlC2PLZRqqgekJqYg70a0vuZYikxOYdYCsgFwXYTHERTrimDU1AhDgH2RHWqNe+NtELiuhi5Qa+YGwG3ZUiyUN0lYGKAeNwqzK7KVeuw4O5ZrqqmpsTJ+KBwzBLkuELcA7ozcYtIWoXQ8tTSk2qGZEeQNwKsjO3xq7r08o7MfnofH01c0dAfgF4D7IoTiuOJE0gLSscNxsy8wfDGD3KMTxEfrhbWmbR1Dl6XTBLoH8FDA7sr5a0yznzU7D8iOnR0+XxqfP2E+tqwFzIqnIUiHaH5XmMxPtfSASUs3mGZD1ZA3hjxz25ZnCUOQPWLtq8xmObvSe1A6MaimCKQNR2bhAe1Qa8ZqTde9pvZ7JqdAOpaoKU4W95hmvCVAHBM6Zgi4kfq0zqZHEpmcB8UJwgMjHE1zCRAXTh7vUS/e6nJ5MFX9GW/bQlnPgbKRfZpGC+ggnaSZ7aVugnhLQRiHRSbXg7L+nQXMaEg9ilHqinxE6yemx5CCWCjrgVvPW497QDzv1WE9eDsJhH5iy+QUJhMnRTFS5Pqcks96bYelBxTBWclcz9aVrcMtq/4t3ZJOMSXq+XZdWQ1FCYue/Ou6FgNFWRjrynsC9NchK/Za1P5ioAyIjftHTDMUkFuHxiJah02Q2KwP0IDygDIg7MiHEcJwnekBqXPK8MBCehmfEKqlIW1cQTQu0ZD5Qu4fE0Dq+uxFCMd2ohSWC2WB9IaWVjTmp2cAuSfjKaiGGKky/FYw1pmCUqDI1Gw2hiCMLglzwDx8QACkmR6+IIbdb6Vu1ZiaoQflAtkG7VvUN6lhAmHekQ/wbOqK4fcrgN8CRm2p+SnUrEQm540b1Yx2+lCuaQieySl4ITi1RCjVFKHClLAHBMw1pKa2xeR4ApNmliRJ7MxpkyRvqLW0RZ3lsWZXFU9D3szGN6hjQ+1f46BeGssbozaNRfOLzC5cYM8NltxcKzmiYTejVM3JeWFy1UYAZLVE06Z2KJwB3UkiSgV7Da0whcm8R7VmTe07qWA7k+qWIHZdqkp2DOm1I2oT0YlgyScVbzZV70OT9TznwYTrEMxN6mDqubFAaOIv+vLQ0lALSsVziapJwf3g9Tw8nuQbkQKNpmH1BqIPXi0YDyjyF72PX19aWFmO5rw25n3kysC0oDwwL8QIve1Zw8F3Vi9R0gJZAuRBachwdM6dn29+NA6gIjh7rVlno9jB7XkArlfgfdYPG1/440WzrmTxZi0PFsCCHy9sSfwak6onWWwnZ53+8q8xXvkfPy8t+XHpR5Y/ZaguuvoNjWEAAAAASUVORK5CYII="/>
        <image id="lt3_f" width="52" height="48" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAAwCAYAAABe6Vn9AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAEqElEQVRogd2ay3LbMAxFIT/qxE26ys/lC/Nz2bV1/IisLsprXV0BJNRkughnMPRDgngEkAQgmX2x1i05+Hl4XXT8Z7WX7mnIHtscoAPR+v7RpoOffG/BhYMRkC7ZZ/VHgxqSfQjmXpBguI/E5HPrGt5AvIFHcjvOg5oNQmBYVkHvAYb6HSgP4hr0MziFmlwwgFmJrJ3fGK4G4oGpXIv0wecq1Ma5iMKsqd+UHp8VMLJUBIMeA8XAezN7L31fdPc2BVM9UyBnEcBgMXjItgj/5kGxrgjEs8p7kYv0nehwFwW1kOdqDPHNkQyU1xgGdx8AFzM7F1mXXm+ClXOH5+G1g9tFLsfzBUA7M7srsqOeLcZQ0FWDgZsxzNnMTmZ2JH16DgQ3LpxD3vzZ2F9L3JnZfZF96QG1s9FSGSupdRjmWAQ3qLO5a+o8mgBg/kB4zsASgPhuZg+l3xPYzkb3w13NAME6bJk3MzuY2W8z+1X6Q5G3Anu2ca7d4F66p6FmIV4QYCGGeiSw+3LMls5rAfHcYTfDjenkOMyt6g2rLdvqcrDWvsA8mtmPAuVZKQvE1jnY6Lb6v87TFBAOiBYFdr1Hkn2BZStFexLPB7gNXG1brjvYOK9ONl8kvAhltspFUQIv2zynGApWAtDG8kCXMljcCMAAYmdT6zDUrLVcji3lQQHswUa3w8Ait2AgzAu42UCAvC3oXhdGJJHL6Txi18MGy/sS4DCPMkB90XW20WVgGejJwEz0exZiOLWWBwYBIAaRAbrYaJm+wOhGnbJMDUjjMAXS+G4rkrUQz4N30uXFiOkcLLKQdyLnQRyBaxTOkXgNCG7m6dC0JJ2e1FyOYTJ5UitHUqAhea537bC1gCK4mgtE/y/Rl9Uxa6v2Ic2WLjEl9HxYV9ZCtaJFq6DxWbpSsC0grbREYbwnZu2NtSUK0gSLgDIgvQjiMrhxZh/COapLiyIKl07BcbBe3APhdBnhy7qcd10AhGgatQMPsGaxJhBftFbA4Lz/ZKNlEHRmgXA+BDoBGJWw3KZASu/B8AA4IeNBZmM5jraRjR4JTK3mWWoCx0DqnzUYDABhTkeD42jbKkCcPiAfQrrtgcH9qitfNIc0RdZqzIFgrBx7so8leEeb1hFgsZNN3Q+WSi0K3iKgd5HTbLOxJsApOIcv3g3DTVDLHwrQT4Fi9wtLwh4QX5Tdja2DAWNQKD1p0TEKJBmI5xFbCZaC+8H1eC6lXE4txCsacnoMEP/DBZE+aIpcA/IKJVzGgpXU7XhvmrTbxUptrlUxvRfRQqOX87eA+MZxofGN4PBdV7+btaJSsLfCIatE49+RYWKByGaW0UrKloIL4vMMwlOcWeW4TKQbIldrPqtYD92wRGajDYF4L9LasQfkZZmZzFKvA70aVnEfwrgPvF66p4GeEUVA7O/6wItT5RoM62sFvhrX4b/FGyuaPimDwpWNc0v3nGyG6UXzHlgrpZi02YUrD421UKK/qb6MhfizB6apw1WOrz80DqAiOP09C6JNg0wvAvC+5x7roy188aKqK9m8PCfql714wS3xakxKT7LpIGeD/udXY6L2v19gWvLi0pdsfwDrTzKXc+jmowAAAABJRU5ErkJggg=="/>
        <image id="lt3_g" width="76" height="54" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEwAAAA2CAYAAABtLn+MAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAGRklEQVR4nO1b2XLjOBCDcl8zT/tz+cL9uTxuknHGGc+DBQuCQOpwbMdV21VdVGSZpGB0s9nsNKjI8+alaS+1Vb0I9/w7fj1HNna9sWvqn3Bv9/1/m3+0n72k+CIGloN0Ydf6twNXHWdENqFVgP6I+n0H70uAiy9SAIvAXIb2EmXgqmNVJIHlQH0WWgdx18++oF35jQCWsojgXLXq1wpkYtpcSWApOJ8A1tKu5X4DAwt9E18kA8BaScy6Er0GcNO21/aZsy35tCmSzNCBWgP4bboWpRBsPG9emn1Y1nsJY5eyiiARqBsAt9YqcA7aYKwRSc7dwSJAH62u5NrBczNdbJqJYc4uBey21TsA9217hw60G3SAqWkCyxmmvogm50D9auf3S8b1fjYyh8UMq5mkM4xsugfwIHqPDjxlmvuyueKAkV1kzwodWO82bhP66fW31DR3HYs5KlA0QQXqsdWnVh/b+8o0Zdk+jt/NkSZGZr23+grgDcB/bfsqn9FU3TwXmaYzrOTDCNwdtuA8AfgJ4Af6oNFk6cvYh/Y9VZQRVPquD3TMekXHbI6X4jVtF5tmzYcl/0XfRYb9bPUJnXnSlx2KYQrYWzuva/RNsRSvxYB2jkx1+s6wR2zZ9QMdaI/oFgG+wKX1N1XSKpkAo98km/kdN2EuFsrWBgCeNy+zzHLMJDUwpS8jaDRNAveELcPox76SYe70CdhUsDSg/UTfbGfJFdBz+EDeCmmw6qA9itKPHQIwAkHAFKym8IzGZYlpDWaumGORfg009WlcQRlecInfJ6wAcmixDv0nBiYlcMqyBjOYpoCVshO+f9SIX6N9Vfdh2v8U8RdQB74OfTuzGJ9RGVooYItYVvNhpUyFA+f7Sqq/1FLxDbhuu3g/gfWOPmi3+AKWXVQ+K2UrNGtBAMeu91HvkwuQhjruU9nqLsT3vIOdiPnyKKWwwq8dOFfPiXlicV9J+8FrdOy6xZY599iy6QHbGO0BW6bx/g2GLFNLGmVZiWGelknm6aAcSz0v56u3L0KeJHCG9X7UMZbVTNKBm/LckiB1ioyBpimnGmhjZjk67zHAShM+JDhz5uNMS+GOA6Ysc9AA1Fk2FbDvIrWVm6tzDTBnWTqP2Mskv7MklqWgWs3yHn2WEbTJAfY5AuYsI2hpz+tMc5YVzyFKZnmOgKm4aapZMumZQOPns5Od5wxY8mWeJSZoacX0g5tB7JhYdq6AeXCdtm1jZlkyzerqf66AUVJsVgtmSzGZOv/qdumcAUssK6XVp4BWO4TeyTkDpvu+EstKoLlZVo8GlWWlBGJpgkv0kOL9l1ZNDzVSEHuNYb6MQO3GGQMs1Vt52rikunk/lKR5cczk0xQ4Pa1XhjnLej9KDbCNXaeiEK13UOVAX5XeGROfG9DfCaTaEAUr+bAL6WsnJcBKxSClChoefzGe4fPHAoxz9R/TGecVSF59lJx+A0lhJ8CWlBl9oDt5RvvcIAtwYEmnS5xzAs8zu6m2DfKdDTBk2JQyI9Y2eOWMMiumTQ4onvfnYUk6+PDV1SP8lBAddfqJXWSVV83wDBLoflmPmo8liWWcL8FT4HyhGF2oFDA/PUk1DRz8HducOSNktM+s0D9gPaZJcs6JZX6KNAYeZTD3kg9L7NISI62WATqw0pnksQED+nPnD83ilTcMy6DoclIY1ZOSD6uVGCmDeGrzgT6Q+xbT7SMllhE01pIpaGmBiEH3FbAtKpPwv1Qxs0K3/PJZ/oI8KPUqwFNtvdxC9JCX7oRFdzRRPxEvA1YZUOsVVuiA4OecCNmVknGnOCRJK7yDRuDGfFo10k+B6hp9B67sUzPVApFTOHyVFBapa+G8vfbCw49RH6aDcSBnitYyrFDeWpyKXZwj2xQapXJ13q9WK/ZeqPVjpWOstKUY21YMxjiS1HYrvp3Tmv7f8kwPNFb21LZGvvFMjjRtWJ2RpwYM6Ne8apJgbW0KL8o+TFZLp7Rea41W2n+dGixKDbSUcfH01KxVkuJJNM1C0L+VwKKc2o/xOgGnAOq9Hru00C6+TKHmdUwR2u8gpbxeTXff86rE4osF0LydCtJ3YJjfS+1gO5RKOEdfJhxmJiAn93dC8Zcv/l2rdZ31glNKGuf2eSQpAqDylf8b/r+08hcXPo1pJDGcBwAAAABJRU5ErkJggg=="/>
        <image id="lt3_h" width="80" height="46" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAuCAYAAAC/OZ4cAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAFCElEQVRoge2b3XLaQAyFjxOanybpVV6uT9iXy10baEiAXuCDzx6ktWnTeJmJZjRrwKy9H9JqpTXAp/yTdO/Z2ffd07v297/kR/e4e6++Th5wBdJZwBMJIZ4Kd9KgA2hdcBz11QrUCMou+Kw4bwrM6gANnIPqKseT+v9AiSBpu0veB1AHmQ4wgJfpBXKY1Wt8kDg8B7dFCdEVQA4xHJzAY6uQLkS74Diy1Dklsqxt0KqGICOIR4MzeG5pl0HLYwep/c8FMYOnupF2E3xehbhILuzgFNZC2oW8jkACx/D+N0y3kgwegb316seUbaXvcjBmfQqDkL4kqiCnQPwoidzWwb0G+ibq1lhYYWSBkdsusAd11eu1tQpSIWpfc4jPYw5vLfrSq/7w6M/byXuFFR5OFOtjB3RLwrnu9QbAbd/eyPtXOLbEFgACpRWp1b0A+B0oYa5RujUt+WCFboEKUa2P1nYL4KvoLQaY1yjduQWAQDn3bVDCewGwArBEec9ACf0CgwV3ECusuXAN4H2vdxhA3mBwZw0qLQQRtz667ArDD3+JEl4UkQt4QGyBHnnpwnTdOwAPogpRrdDnwTnE5z8CpOsusf/RCY+wdZ586z8PIY5ZIN1RLfAOe+v71ishEiDnwtYsUAFyrrvG/l4JRc9ZY3D31BAWwCGARNG35sIPGCDeo3TjKJDMIZquOcAVjuGpe1PDVcX33RN+dI+7qXOgRmFCdFf+ihzgnOIA1xjmaoVHcLRMX5blFigSZSAESIicCxmJ70TPBSDnaAaWF+zHxDmRgEeXZGOpnLqxLqS5Brw1bR3gBsN97TAAXWFYikXwPLM6iALMylQRRFoj58ZoQc2La/8fKRpMFCDvQ92ZLusZVeS+PA4X0npCVEhQkOraUW7sAOcULoZ1QewpqIPz4AFMmAMpUUlLTVlhLux1dvG5xJc1bgw+hmjOS1cSbiFRJTlyaz+u6dwy5R7H7j/iAiC3QD95Koi0JD6z/M09TRr7GMBo4yUrTFJpmS0BzO7Vq9AR6OoYHGC2e+XgPFdkynMpN8w5sAWJqjEsnG6kjWACMRcAuQVGwCJoWpBkQr5BWUxoQRwga33UqAqdwSwkAhi5a1TFZdrDagZvlKWhFgFuMdz/qlctoCpIAqzOnwow2j9V69NEm8k4F82dnOMF1RZEx8JxsJy1RAlSLZJjd3hpOSuzPC+BL1EWIZmMt5bGUXQ6coC/ADyjBKml/HB7k1JzYU/AWcHlCp7uSXhM42rV6LnEq9I6nmcAPzFAVEuMXLmQzAI92rKGpukOMPyinAsJsJUshOK7crRC7ocoRLXCV5TRedQCoy1AXsznNv6av7EvJjCvbKGQ6jLmVYRIK/QdudSFDwPsq9K+G+c1QK0D6tZmtpnUKkAPiivRJY4jNGPAYWmTbWtmQWSNAYaWv911W9rOVKkFR11Z6D6xR+OTggh3n3ihzj4j1Kh+RksG2gLIVoNJ9ISCqgaRLSYGEb0QcAxPV/PqtlnxsQXxtDRKSV9RLtkmLWOKASa7c9mTWVnhsSXXdcnyek1V9VhTusN3xx4u8lK4vr/FHtgbBrBRbRBoD+JYZWljbfqMoMrRIEcesKy1+p2Wxass0dOq2hbw/AHLcLDBI76nVG3PAaC3NT2cO+kRX8oJT+h7P+cCMDqO4AI48SFzlZH/iEzqo3FxMMXrsf+KnDT4c/kr17/Ke/4V7FNG5A9o2xQCBInzyQAAAABJRU5ErkJggg=="/>
    </defs>
</svg>
`,A7=`<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd" viewBox="0 0 123 232">
    <g>
        <path d="M10 140.769c6 29.375 13.537 33.424 35.28 43.583 35.355 16.519 33.138 57.105 56.59 45.51 14.36-7.1 21.13-19.23 21.13-38.4 0-24.92-11.42-65.99-32.4-119.1-10.625-22.199-25.844-16.641-42.794-16.641-7.93 0-15.744-1.226-22.454 2.224C10.788 65.456 4.321 112.967 10 140.769" id="gpad_base_right" class="gpad-base"/>
        <g id="stick_right">
            <text x="16.251" y="222.47" style="font-family:&quot;ArialRoundedMTBold&quot;,&quot;Arial Rounded MT Bold&quot;,sans-serif;font-size:11px">Forward</text>
            <circle cx="41.79" cy="176.272" r="26.46" style="fill-opacity:.5" class="gpad-shadow"/>
            <circle cx="40.55" cy="175.022" r="25.21" style="fill:#6180b0;stroke:#000;stroke-width:2.49px" id="stick_right_base" class="gpad-stick-base"/>
            <g>
                <path d="M40.55 179.261v-8.477h25.441v-3.768a1.7 1.7 0 0 1 2.902-1.202l8.006 8.006a1.7 1.7 0 0 1 0 2.404l-8.006 8.006a1.7 1.7 0 0 1-2.902-1.202v-3.767z" style="fill:#ff00bf" id="r_stick_right_direction_highlight" class="gpad-direction-highlight"/>
            </g>
            <g>
                <path d="M36.311 175.022h8.478v25.441h3.767a1.7 1.7 0 0 1 1.202 2.903l-8.006 8.006a1.7 1.7 0 0 1-2.404 0l-8.006-8.006a1.7 1.7 0 0 1 1.202-2.903h3.767z" style="fill:#ff00bf" id="r_stick_down_direction_highlight" class="gpad-direction-highlight"/>
            </g>
            <g>
                <path d="M40.55 170.784v8.477H15.109v3.767a1.7 1.7 0 0 1-2.902 1.202l-8.006-8.006a1.7 1.7 0 0 1 0-2.404l8.006-8.006a1.7 1.7 0 0 1 2.902 1.202v3.768z" style="fill:#ff00bf" id="r_stick_left_direction_highlight" class="gpad-direction-highlight"/>
            </g>
            <g>
                <path d="M44.789 175.022h-8.478v-25.441h-3.767a1.7 1.7 0 0 1-1.202-2.902l8.006-8.006a1.7 1.7 0 0 1 2.404 0l8.006 8.006a1.7 1.7 0 0 1-1.202 2.902h-3.767z" style="fill:#ff00bf" id="r_stick_up_direction_highlight" class="gpad-direction-highlight"/>
            </g>
            <g>
                <g id="stick_button_right" class="gpad-thumbstick">
                    <circle cx="42.41" cy="176.892" r="17.12" style="fill-opacity:.5" class="gpad-shadow"/>
                    <use width="65" height="66" x="161" y="142" transform="matrix(1,0,0,1,-152.75,0)" href="#jsc_a" class="gpad-highlight"/>
                    <g>
                        <g class="gpad-btn-bg">
                            <circle cx="40.55" cy="175.022" r="17.15" style="fill:#fff"/>
                            <path d="M40.55 157.872c9.465 0 17.15 7.685 17.15 17.15s-7.685 17.15-17.15 17.15-17.15-7.685-17.15-17.15 7.685-17.15 17.15-17.15m0 2.689c-7.981 0-14.461 6.48-14.461 14.461s6.48 14.461 14.461 14.461 14.461-6.48 14.461-14.461-6.48-14.461-14.461-14.461"/>
                        </g>
                        <g class="gpad-btn-bg">
                            <circle cx="40.55" cy="175.022" r="13.111" style="fill:#fff"/>
                            <path d="M40.55 161.911c7.236 0 13.111 5.875 13.111 13.111s-5.875 13.111-13.111 13.111-13.111-5.875-13.111-13.111 5.875-13.111 13.111-13.111m0 1.35c-6.491 0-11.761 5.27-11.761 11.761s5.27 11.761 11.761 11.761 11.761-5.27 11.761-11.761-5.27-11.761-11.761-11.761"/>
                        </g>
                    </g>
                </g>
            </g>
        </g>
        <g>
            <g id="start_button">
                <path d="M29.219 132.023a8.69 8.69 0 0 1 2.89 6.477 8.69 8.69 0 0 1-2.89 6.477H17.581a8.69 8.69 0 0 1-2.89-6.477 8.69 8.69 0 0 1 2.89-6.477z" style="fill:#9a9a9a;fill-opacity:.5" class="gpad-shadow"/>
                <use width="46" height="41" x="664" y="373" transform="matrix(1.02273,0,0,1.02273,-680.352,-264.931)" href="#jsc_b" class="gpad-highlight"/>
                <path d="M28.245 131.064a8.7 8.7 0 0 1 2.889 6.478 8.7 8.7 0 0 1-2.889 6.477H16.606a8.69 8.69 0 0 1-2.89-6.477 8.69 8.69 0 0 1 2.89-6.478z" style="fill:#fff" class="gpad-btn-bg"/>
                <path d="M28.245 131.064a8.7 8.7 0 0 1 2.889 6.478 8.7 8.7 0 0 1-2.889 6.477H16.606a8.69 8.69 0 0 1-2.89-6.477 8.69 8.69 0 0 1 2.89-6.478zm-.543 1.351H17.148a7.33 7.33 0 0 0-2.082 5.127c0 1.992.794 3.801 2.083 5.127l10.553-.001a7.33 7.33 0 0 0 2.082-5.126 7.33 7.33 0 0 0-2.082-5.127"/>
                <path d="m20.045 134.516 6.117 3.029-6.11 3.022v-6.051z" style="fill:none;stroke:#000;stroke-width:1.12px;stroke-linejoin:round" id="start_button_icon" class="gpad-btn-icon"/>
            </g>
        </g>
        <g>
            <g id="button_1">
                <circle cx="45.1" cy="121.855" r="11.806" style="fill:#00ff04;fill-opacity:.5" class="gpad-shadow"/>
                <use width="52" height="52" x="171" y="95" transform="matrix(1,0,0,1,-152.75,-7.10543e-15)" href="#jsc_c" class="gpad-highlight"/>
                <circle cx="44.24" cy="121.007" r="11.8" style="fill:#00ff04" class="gpad-btn-bg"/>
                <path d="M44.24 109.207c6.512 0 11.8 5.287 11.8 11.8 0 6.512-5.288 11.8-11.8 11.8s-11.8-5.288-11.8-11.8 5.287-11.8 11.8-11.8m0 1.72c-5.563 0-10.08 4.516-10.08 10.08 0 5.563 4.517 10.079 10.08 10.079s10.079-4.516 10.079-10.079-4.516-10.08-10.079-10.08"/>
                <g id="cross_button_icon" class="gpad-btn-icon">
                    <path d="m40.595 117.35 7.72 7.731" style="fill:none;stroke:#000;stroke-width:1.72px;stroke-linecap:round;stroke-linejoin:round"/>
                    <path d="m40.595 125.081 7.72-7.731" style="fill:none;stroke:#000;stroke-width:1.72px;stroke-linecap:round;stroke-linejoin:round"/>
                </g>
            </g>
        </g>
        <g>
            <g id="button_2">
                <circle cx="65.95" cy="101.005" r="11.806" style="fill:#ff0009;fill-opacity:.5" class="gpad-shadow"/>
                <use width="52" height="52" x="192" y="74" transform="matrix(1,0,0,1,-152.75,-3.55271e-15)" href="#jsc_d" class="gpad-highlight"/>
                <circle cx="65.101" cy="100.145" r="11.8" style="fill:#ff0009" class="gpad-btn-bg"/>
                <path d="M65.101 88.345c6.513 0 11.8 5.288 11.8 11.8s-5.287 11.8-11.8 11.8-11.8-5.287-11.8-11.8c0-6.512 5.287-11.8 11.8-11.8m0 1.721c-5.563 0-10.079 4.516-10.079 10.079s4.516 10.08 10.079 10.08 10.08-4.517 10.08-10.08-4.517-10.079-10.08-10.079"/>
                <circle cx="65.101" cy="100.145" r="4.505" style="fill:none;stroke:#000;stroke-width:1.72px" id="circle_button_icon" class="gpad-btn-icon"/>
            </g>
        </g>
        <g>
            <g id="button_3">
                <circle cx="24.25" cy="101.005" r="11.806" style="fill:#48c0fb;fill-opacity:.5" class="gpad-shadow"/>
                <use width="51" height="52" x="151" y="74" transform="matrix(1,0,0,1,-152.75,-3.55271e-15)" href="#jsc_e" class="gpad-highlight"/>
                <circle cx="23.39" cy="100.145" r="11.8" style="fill:#48c0fb" class="gpad-btn-bg"/>
                <path d="M23.39 88.345c6.512 0 11.8 5.288 11.8 11.8s-5.288 11.8-11.8 11.8-11.8-5.287-11.8-11.8c0-6.512 5.287-11.8 11.8-11.8m0 1.7c-5.575 0-10.1 4.526-10.1 10.1 0 5.575 4.525 10.1 10.1 10.1s10.1-4.525 10.1-10.1-4.526-10.1-10.1-10.1"/>
                <path d="M27.895 96.371v7.258a.884.884 0 0 1-.883.883h-7.244a.883.883 0 0 1-.883-.883v-7.258c0-.487.395-.883.883-.883h7.244c.487 0 .883.396.883.883" style="fill:none;stroke:#000;stroke-width:1.7px;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" id="square_button_icon" class="gpad-btn-icon"/>
            </g>
        </g>
        <g>
            <g id="button_4">
                <circle cx="45.1" cy="80.155" r="11.806" style="fill:#fff000;fill-opacity:.5" class="gpad-shadow"/>
                <use width="48" height="47" x="173" y="56" transform="matrix(1,0,0,1,-152.75,0)" href="#jsc_f" class="gpad-highlight"/>
                <circle cx="44.24" cy="79.295" r="11.8" style="fill:#fff000" class="gpad-btn-bg"/>
                <path d="M44.24 67.495c6.512 0 11.8 5.288 11.8 11.8s-5.288 11.8-11.8 11.8-11.8-5.287-11.8-11.8c0-6.512 5.287-11.8 11.8-11.8m0 1.721c-5.563 0-10.08 4.516-10.08 10.079s4.517 10.08 10.08 10.08 10.079-4.517 10.079-10.08-4.516-10.079-10.079-10.079"/>
                <path d="m39.735 83.302 4.641-9.372 4.629 9.361h-9.27z" style="fill:none;stroke:#000;stroke-width:1.72px;stroke-linejoin:round" id="triangle_button_icon" class="gpad-btn-icon"/>
            </g>
        </g>
        <g>
            <g id="shoulder_trigger_back_right">
                <path d="M8.085 30.441H3.012a1.7 1.7 0 0 0-1.471 2.551l9.322 16.121a1.7 1.7 0 0 0 2.944 0l9.298-16.08a1.726 1.726 0 0 0-1.496-2.592h-5.024V10.957h-.002a8.5 8.5 0 0 0-8.498 8.498z" style="fill:#ff00bf" class="gpad-direction-highlight"/>
                <path d="M73 40.321a1.7 1.7 0 0 0 1.7-1.7V18.479a6 6 0 0 0-6-6H50.405a9 9 0 0 0-8.172 5.23l-9.32 20.199a1.7 1.7 0 0 0 1.544 2.413z" style="fill-opacity:.5" class="gpad-shadow"/>
                <use width="76" height="55" x="544" y="255" transform="matrix(-1,0,0,1,635,-256)" href="#jsc_g" class="gpad-highlight"/>
                <path d="M71.44 38.798a1.7 1.7 0 0 0 1.7-1.7V16.957a6 6 0 0 0-6-6H48.845a9 9 0 0 0-8.172 5.229l-9.32 20.2a1.698 1.698 0 0 0 1.544 2.412z" style="fill:#fff" class="gpad-btn-bg"/>
                <path d="M71.44 38.798H32.897a1.698 1.698 0 0 1-1.544-2.412l9.32-20.2a9 9 0 0 1 8.172-5.229H67.14a6 6 0 0 1 6 6v20.141a1.7 1.7 0 0 1-1.7 1.7m0-1.7V16.957a4.3 4.3 0 0 0-4.3-4.3H48.845a7.3 7.3 0 0 0-6.628 4.241l-9.233 20.011q.03.015.055.034c.02.005.036.026.048.055l.006.017a.4.4 0 0 1 .013.083zc-.939 0 0-.939 0 0"/>
            </g>
        </g>
        <g>
            <g id="shoulder_button_front_right">
                <path d="M32.1 44.7a6 6 0 0 0-4.243 1.757A6 6 0 0 0 26.1 50.7v7.6a1.7 1.7 0 0 0 1.7 1.7h46.4a1.7 1.7 0 0 0 1.7-1.7v-7.585a6.015 6.015 0 0 0-6.015-6.015z" style="fill:#9a9a9a;fill-opacity:.5" class="gpad-shadow"/>
                <use width="80" height="46" x="163" y="28" transform="matrix(1,0,0,1,-153,0)" href="#jsc_h" class="gpad-highlight"/>
                <path d="M31.069 43.65a6 6 0 0 0-6 6v7.6a1.7 1.7 0 0 0 1.7 1.7h46.4a1.7 1.7 0 0 0 1.7-1.7v-7.585a6.015 6.015 0 0 0-6.015-6.015z" style="fill:#fff" class="gpad-btn-bg"/>
                <path d="M31.069 43.65h37.785a6.015 6.015 0 0 1 6.015 6.015v7.585a1.7 1.7 0 0 1-1.7 1.7h-46.4a1.7 1.7 0 0 1-1.7-1.7v-7.6a6 6 0 0 1 6-6m41.964 13.599.006-.019c-.033-.019-.008-.05.034-.076.026-.043.057-.067.077-.034q.01-.004.019-.006v-7.449a4.315 4.315 0 0 0-4.315-4.315H31.069a4.3 4.3 0 0 0-4.3 4.3v7.465l.019.006c.021-.037.056-.006.083.043.022.017.034.036.024.052l.01.034z"/>
            </g>
        </g>
        <path d="M34.091 141.791a34.7 34.7 0 0 1 6.374-.588c19.07 0 34.552 15.482 34.552 34.552s-15.482 34.552-34.552 34.552c-19.069 0-34.551-15.482-34.551-34.552 0-10.648 4.827-20.178 12.411-26.518 1.298.465 2.697.718 4.155.718 5.345 0 9.9-3.406 11.611-8.164" style="fill:#419bf3;fill-opacity:.25" id="stick_button_right_tap_target" class="gpad-tap-target"/>
        <path d="M34.417 134.497c.26.997.399 2.043.399 3.122 0 6.809-5.528 12.336-12.336 12.336s-12.336-5.527-12.336-12.336 5.528-12.337 12.336-12.337c2.48 0 4.789.734 6.723 1.995a16.16 16.16 0 0 0 5.214 7.22" style="fill:#f38f41;fill-opacity:.25" id="start_button_tap_target" class="gpad-tap-target"/>
        <path d="M38.877 106.677a16.1 16.1 0 0 1 5.496-.963c1.93 0 3.781.34 5.496.963l9.655 9.656c.623 1.715.963 3.566.963 5.496 0 8.894-7.22 16.114-16.114 16.114s-16.115-7.22-16.115-16.114c0-1.93.34-3.781.963-5.496z" style="fill:#41f352;fill-opacity:.25" id="button_1_tap_target" class="gpad-tap-target"/>
        <path d="M59.731 85.823a16.1 16.1 0 0 1 5.496-.963c8.894 0 16.114 7.221 16.114 16.115s-7.22 16.114-16.114 16.114c-2.186 0-4.271-.436-6.173-1.226l-8.715-8.715a16.1 16.1 0 0 1-1.227-6.173c0-1.93.34-3.781.963-5.496z" style="fill:#f34146;fill-opacity:.25" id="button_2_tap_target" class="gpad-tap-target"/>
        <path d="M29.692 115.863a16.1 16.1 0 0 1-6.173 1.226c-8.894 0-16.115-7.22-16.115-16.114S14.625 84.86 23.519 84.86c1.93 0 3.781.34 5.495.963l9.656 9.656c.623 1.715.963 3.566.963 5.496 0 2.186-.436 4.271-1.226 6.173z" style="fill:#419bf3;fill-opacity:.25" id="button_3_tap_target" class="gpad-tap-target"/>
        <path d="M29.485 86.294a16.1 16.1 0 0 1-1.227-6.173c0-8.894 7.221-16.115 16.115-16.115s16.114 7.221 16.114 16.115c0 2.186-.436 4.271-1.226 6.173l-8.715 8.715a16.1 16.1 0 0 1-6.173 1.226c-2.186 0-4.271-.436-6.173-1.226z" style="fill:#f3ea41;fill-opacity:.25" id="button_4_tap_target" class="gpad-tap-target"/>
        <path d="M78.727 41.355V3.448H37.806L20.317 41.355z" style="fill:#419bf3;fill-opacity:.25" id="shoulder_trigger_back_right_tap_target" class="gpad-tap-target"/>
        <path d="M17.599 41.355h64.74v22.323h-64.74z" style="fill:#8141f3;fill-opacity:.25" id="shoulder_button_front_right_tap_target" class="gpad-tap-target"/>
    </g>
    <defs>
        <image id="jsc_a" width="65" height="66" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEEAAABCCAYAAAAIY7vrAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAHcElEQVR4nO1c23YbNwyEZEduLm7ykJ/LF+bn8lK7kZVa1vahHO3s7IDk6hK3J+U5OEtJ3iUwBEAQ4Dri/xar1xr4y/BtMvbX1efhtXi5KggqaMe4KRDXBOmiIBihVx19bkNH/+KAXAQEEX5lru67rA10zfrHdglAzgKhInwP6fgqcIv4nrPAOAkEIzw+r+nzmq5r+Y7vQYMQhxgFPdBnvc7AOBWIxSAQADrz64RuzHcOCBZ8iIiXGEHgPpPTjsVgLAJBANAZh7A3QrfUx+98X4ggLPRLROzLVckBgmctAqIbBAOACg9hb4neyGcGg0EA8xCchX8u/T31+fdMM7qB6AJBAGD75tmG0KCNXAEIA8Hjs+qz0M8R8ZdcQaolJwHRBCEBgNVdBb8j2tBVgYA2BDENYVh40A8ifMdg7MNrRROIKggNADDzGxL2t4TwO5sHO0g1BQbgR0TsEsLvAEP9RRcQt50AgHT2N0XIu4h4W+gd9UHQDNaGDASYgQLwFBHbGLXqtnzH/uWZREgjzm4QBAC2fwiCmWfh3xdCH78BKAiAZ9VAgOrvivBb8wznYFnwA/pfhm+rTBusORQtUA2AGrPqvyOBPxC9J2qBgJaBAA3YRsT3iPhTCL89FcBgHrp6pGYx0wQTDXLQwyaA2f8QEfeGMhB4haiBAHN4kme0nKsjjkdmLTMHDYZ4CYQWYPZ/NwSNgKawT+hdHQCCA5F9igKQRZNDxD+TrNowASHRAvYF0AKYwH0R+iORgsArBAdNDLRGi/sYV4ddTE1J74+YCp9Fk3YXOgOBhFczUC14G1NN+BgRn8qVzQGziGXUaYGCcCgg3BUQWHi+n4XngCkLoDi0boKgQDhfAAAgsDMHaIFTY14e0RgEAMFLKmuA/r1GmfuYB1DrGE1i4iCPICR7Aw2KEA+oOYDuYzQF1gKdxWwrzRrR2ms4R+oiSWgEm96kqSb0moJbFnl5ZC3g4Eh9gYIA4QbhgUFgJ6oriQut+f6DA2IdvmWaoCAoIVrUuEB3kS7HoFtx3pNgddHYRMfG+M6RTvIYvAhkmuBAACMcITJBeHWENT/gwNckSbaCaEAFcoEZg40o8tgYBN0sZT6BgdCw2M2+A6C1e4XQDMCbmJoBtHKX8OFWFF2WRxAqGaNsv6DEAOjAtbxiCwB8vinfuQnJ+ADPuk+Z8aA+weULNWGyScghvxQA5gNXTeIwP7yN56vzB6k5OsfoNMFljXiwLGu0VHjlA1d1oK1MVpbO4wDt6BwZBBcnuBSaI/b6TvhzgUC/pqGtnGbqj5w54FozjWzJY/U9VxOUL8ePTpJbgpu81MyhNrAjB8AlmptBHq+XtxSMLFhiBmpUVbMrNF1me6jJWwuEX6K1QDipOHrFpsnTi/DmQHAPcnVATWBkDJzbVBDODdR4q/FV3UDxQG4Q3rfzNrWrUHpmY35cMqVWq6zywiAoACy4Cu8If+cGPBWIGk86vuYQdJJS06iZgwNAa4NaBktrgie0TCuVH02kKBiqpcdnI7ukW2lnBln2xtUFwZwGT2i9y6jaf2tCwA/zxxNTTbiuGZFOAFxNEAyoVpziMJ0GMACuROd4USDS8VkTsH11qqcpLNQGOZFRK4+57HILBD6xUivSMh9cqOUibdVBZuaQaQIXRjmRwQlVBWCIMR/Qyi6pxrhSPQu+jWkZjktxrJkMxKxlKXenCaoB25gmMlxNgQUDENneQjUAaXcUYjiNhrokE9cjoQ0100xBaGkCGPke8wSG7ibVrLKUO5tHNjZXp7ko+0h9BoI1oXle4QjC19XnoSQZFAg1B06quNMnTpieVFfLF0HtHws9UJ9BYHNwWjBrNXOATa6JGZfI0KSFizFq6S4ez/kBqDe04MEQl+mz8vxxjGpBlhiKGAsVXCDVBIbu2bOZdGcTHAjZGQVoAUzgISL+KARtYJ/Q7RRnIJBJgDEwBW2oJSxqqpwVZdkc2PzYGaovAAggNgf2B7VAKQeBmjoq1PIcACyEW1K1JKexBMYZzP18UgWrwGNM/QIDAFNwq0JEdJ5UMdoA5laFOXVqzpZ1SatVp/UZz+YZteM6uipokNSMVGsHt9g3RHlohPfoDAKH1xpPuIMaaO6AhsYGrBEcKGmkuOgYX7qhaZTqtT7Jp9j0GJ/WJ3tPr7FP4NBYo8NWhGhXBG6pJkjcEDHOdsTcZ2THbJ5iWhrrPbjFjpH3K3jmjr7v3TWmrbm17TjVqiUxPdp7F9MKkYscNTjTnSsLzH13GKPbDLpBqADhqlPZ4W72BVmAxfsFPt2uh7tZ7fko7ws9oxuAbhAMELpc6vsNXBJzhzSyiDFLn+k5JKf6s5Xgokf9K0DUymKuNFarEDMImkR1L36o8DZ11tMWV42S13+ystiN6bvKleYRXEq/O6t91dd/0JIXwbL6pfZdiUxTagdz1e8Gue/nvQjGrfJWXFaz1N+5KRAt4nt+/iuB2ha+HOr+NmIumBP2osI7Js5uF3hNOGIa3MyEjviXviactRNeGI9IIrz/zAvjS5oD6DX/fcAv3/4G1s+EbdFAgYoAAAAASUVORK5CYII="/>
        <image id="jsc_b" width="46" height="41" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAApCAYAAABKvBuPAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAD00lEQVRYhdWZzXKjQAyEm8R2kv075eX8hHk533Ydm9gJe8g0NI0EYzuXTJVqKBjgk9BImgH4pq255eZtt7vp/pfmubv23otenIDWnMsAJ+drlakCN+BmoV9q3UIPYFmB2ZcFwI0dN8H56LkRpAqC41n4FFygHfYuONZz2XMd9sP6SFL4ENygVe4WhGP02W7RjwpZhJ+AJ9AEuy/9qhzfyzn27j6Edrj3Imc5zhSYwK8cPIFWyFWRtRyrIu42EAiFdTnJdb2Pik8A+2bWVisTeF1kU2QtfQTPlzr0qcib9ZR3EX6tkdUji0cuQuiHRAi/FnD6Ol+s0G9FjgBauUebzokGZvU5V3HoTYF8EnksPeE3GFtdwRW6LdCqbDQnCN8A6LbdrqHVe/BkUqqLPBTQHwB+lp6i8Gp1YJhoZ4M+YHAxdSudvGrxkdXd4lEUuRfwpwL6S4RKPJYxDk7/JvgRwGsZuwrGqXyU65ykfatxFX5OB/8N4I/BE5xAjVjvhE9rH2RcpBxd6oxpeF20uIdB+q+6CsEJT6tvAksSpsWntTkXgKn/U05ivN6Nt90OL81zNxdVCM44zQgyZ3W6C0Mjwd4xuMlarumX4NfQ0Fplca811M89HDKq0PoE5yTNwNU9VJkDhq+q0FEyG8CTKtBDIhXgCxhlGBIpDk5XYcija7SY5oG5DDyCr035DI1RFvVsqlYDhsjACcjxXjZEwGm1mYHPKXJJxcjWJdfnnhsVaxeDZ/Wy19cqnlR8TM0z04VEBp4V/FpzeLFEF2lkPDDOmicTrQ416WQro77dAWGh7laMqjqGsCOGyKDyGpw7yHiKKhTV5uGaVC2efXqv6hSUEYRWPmOcyjWKnDCk+70ppgoQfrISysAjBTRdK/Qe46qO0C3qMucewF8A/0QBlrhV8A4eQetLaTGGL1qU1xmTGdqAuFZ5LdAO3xYDRT4PAN2krA0UUPA3jOMu3aCT61o80X2a4DnqLrT83sC5Cqq2uEJHFteCX6GPyOtxL2u1HqevE5y+rq4yKWlH4C/Nc7ftdg7PF3pSIQx932uNaOkWrYA84lzt4w7eCKAnFPXba9acLcYhVd0kAl9cLGvc5Av1WrSiUehLV/nRSt/jePWGULagWJloRRfV0AoeZV5d7UQZtAev3RDSQbopE312tXJUQ2dJLZNwJ8vbLXuHDpttv2XwX7t3mMCzX9qpjWpoL5ayAi6sDC/arQ3gOTb7ErNF/4ICfq4fe9X+eAKv92R99NwuOI6qvv74pj8S3maUqHlmBDI596X/gLJ261834LY/b9+y/QdJLrfuY2EtwQAAAABJRU5ErkJggg=="/>
        <image id="jsc_c" width="52" height="52" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE3ElEQVRogd2a3XbaMBCEF0ISaJr2Ji+XJ8zL5aZJgAQK7kU0ZjyelQ1JTlt0zh7xI2R9Hmm1WhNxZmXymZ3dN48n9fcwuWs+awwfAkoA9DN9r4PvwXwE8CQgAZkM1FlpBuqTwI4CqoA40zY8WK6dcZujwEYDEYyCTM1r/ox/oyB7qfV1+5uxUINARhU3eNgFveY2XBRkHxE7eu0gR0NVgRJVptGHcMZtuPDAd4ntow+Im1EFS4EMDO42BnsREbOKqVoYEMP8rtiO2uF3g1CzDEiKKoJBXxa7ktpBRQKziYgt1dvSHt/jd1ynxSok6jAMg1yRXZPhs8s4TD9WSGE2EfFGhveAQ9veFHQq9YAEBkCsCkPMiy3o9ZyAAKVAGCwgXiNiXWoY4DbRn4apo8imnMIASEG+kS1KPY+DUgDiKQcgKLEuhhs1i9w7ouzNZ+3A22KmGmAwxa7LwBcRcUP2vdQAA1QGhDsPZZZiLxGxKsZqbaPrCXsqOYVYHZ5urA4gbqVmKNzxDAhTbRUHRVUd3mx5/diIIgNSKHYCmGYA+kEGqGOBoCa8Yg2GbaIwHaAy3TJ1LuOgDoBuC8jPYj8EqDbl4BCwdrQdQNze1HMM981jO+2GphxPt6s4LHxMMwd0E/01xHcdg3uL7r7FMHDtW6rZhQOqp5ICqUpOITgEhoJBIXbdbmPdJjBQBV6Q9yk4BSjJYx10CjV3DTcNKDV4OQzW7UPuO4XBGmPT6KMXOUwjeusnUwhOASrxHsTejTfZ68Tm1Fb70b54TwMQbkRr2HJqCjkgVmoRfYDapopyEe8qsTK82a6ju5c5IA162+LW0FgoNQ53eG0oEB/82AFoXwrCMO7waIH4gm4tcYTtjKcEfpslTbRfvWncpyqjUBbI5Qj0VJod5rLDnb1oHBa0zoIxh0XXZ+vpdDq44pyFmiZHsj7cZ3pkz8wlYHrXGwP0X5UxJ1ZNMbm4SgNG10fWryZGMnPXyGO56EavLs1US2qo8T7hQI7tdzSYU0iB0CkHidvE4JV4n6klSXamT4Q7WfymYJ2iQKySJjQ4JHHGmym7Zr0ob6QM4PIKAEuP4Np/ppDeRb0wTprrqEfW7sDGfXJOgfMKqBkQYKxUT6FpRHuEdYtf1eELr8iWpQakJjvUXD/LpK8MqDPe2nlIFdLodxXdOCs7xA0dHzbU30ux5+jmFlgpBurkFLi4NQTjRYvpwUkNl6bim5BNQz2xAuipAD2X9wqEdJZTKAViKJ5ymzK4dfgwXgd7zBEcWZ7niPhFYDz1VKFhL/cwuWvum0e8xfFWFdKYS4/NrOQxQMsC8WSAXqPuFJqhNBYGyIkKflTCIbwOks8zY4HgCKASphxyc7qGUnUyIDRUlTZxCCC5rbrhMYlGtyaxljjR6BxCdWPNctvuPMTZU5cK1qwp59rGpIJ1K8DaqWVNm7G5bY0YFJ5dO68xbLScp86ePnB0oBurS9bbnJyWv/U4xUUfX/M4RaBq2dQxD7xqoQ8Hpe6hVy0oPfkJngaAteB1Fu93lnMAeoxwm/axjySrJVUo4sweGhsotM8SKPpYP0toZAc8BeiFNx9+rJ+AaZJial7XEifZiVg/G63KSUACxb91aWQH3w5Oamfc5mv+GsPlbP68pOVs/l6WlX/hD4BnV/4AcperLpSp2XYAAAAASUVORK5CYII="/>
        <image id="jsc_d" width="52" height="52" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAFUElEQVRogd2a0XbaSBBEC+LY2E68L/k5f2F+zi+7iQO2A+yDp6BUqh4JzO5D5pw+EiCGuaqenp5GwB/WFpfu8HH/dFKf3xff9pf8/Q8DBYBT+hzBfBTwLKAORHXUtg/nfgRwHtxJQAaig15MvNamg1dDOD8ZajaQwKSBL4tzBTsMUga+K84ddDbYJFBQxUEqUzgFUoBkFdwsqC5QAeMD/2S2lKOqxcE4wDaYA86GKoGCiyWQKzm68Rp1O1VmC+B3YT2wLtRVjxbZvRTgc8dUMQfSwb81e5Vz/Zxtxz4e90+LCioqZOq4aynINYCbZtdyVCh+n3dYlXlt9tKM5wRMinWVGgEVMEscVbmWwa+CKRRdkn2qqxFm0yDW7ZyvCaiKTbpf5XLualTGQW4B3DW7bcbPVCUHepNBbwD8Km5CFfL9vQwUopqqQxdTkHsAX9rx3qBuZHBLAeK8IcwaR1VdUQ7ajSqNWlLIg4C6GmEI8gXAVzm/b6AESgop0Brv6lRADqDutgCAx/3TwO0OQBOBwNW5byAPzb42I9CtATEoJKCVwPB3HWZrxx2Ga9uhuUIOlebOHY7KPAD4qxmVIhDnhANtcYxmq3DdAsMFV6OcAlGlQRifcjmq87kB6dxxoAcBSgNVICpEFakOMF503zBcnxTMs5CoUFpEk0KqEk3nEIF0YdXBOrB//mqmUBwfF9tDuwIO88ez6ASkYToFBgJxknMO8i7qwprWKCqii+2m9feCYdTUpWWWQp4VMCNQt6PdYbgeeUDQQXPgHs3oilxsGTBW7VzXKAUatKW9rnI3T3N0YVXTTEFTIE2V1FYn9KVJr2fyC0bpKihUiahD3WCYyymEh2HgXQlPVqnMTWEK4wnvSCEFqnaivQzbVah+WIE0hdlZn1V/qk7aCUegHpRv4vyHFGDkDtY/oaoN4ty+dZyH5nPI4c7dcleFE++711/v5pQK9YD0x/+vNue3utf0gKpyU8p6q3JUKk8hXHNKFSj1NQlUVWY0v6pyrAqy6jcVSXr5WxfOg0J11zy38hyLlhbTuUWS1J/uVuM23JsCpSJgShKZlngtgJ9rblZVfbahT+9Pc7gKaHL74C6hLuDbZq0BpM0c+/GFNeVsGzGvLejNqqD2ve1DUkjv3lpMawEpCdXFEBjmcszZfhVGMC+W+JwaNHe5pBDvjiqj22bfz/D7ugtV1ejCWiB5BvCz2XMzh3KgVDR5B/q++LZvyZ1CqbtRoTWO+dxUVceV88/ZH2H+AfCj2c+ZQJNziM0jkQJpnqUBQBNN3Y1OFUkU6G8BokobHAOE1uYiVC9s6938hOMGyxNFYHznvepT1RQU6EeDolJUaVKhWPUJbscfXwqUJonAsKDBqLVGLpIQ3BXXOaQu94yjy1GdbkAYAElzlX4jJ568lnON6nBz1gNSl6NKhPKg4OpsbYyDVtW2aZrW6zbcy8BeDtYImOaQRrkUugmawvZg/sytbfMiraq4MmmR5OC0PNUr1qdFdS3vazBIOd2oxVTcVPKiif4DoVvytBWvgofOuZdgnvak6Bb/Tun94aUX7+z9lJNRIa8BpBpClcvpH1+alM6CATqbJat1u1Is4mupS498PxVJNP2hUp7JE9i3L0CYN9pKhSyMsx06xVClbYN4Ra4BoPO9yvxfcX6/2ya3vMXzCVpD0GLHVC2gyhf1XD8bheez/wUvoPidFDTSMRUzfIud/vtxT7jcgxcFWJpfwDCDKCszGN75tJ0+SRVtZ1V0Jp758fe8edpfHf/7h5e8TTxa1uvbBzp4/ZFHzC5Wczv1wT9tl34I8I9q/wJ8hc/eTcdQhAAAAABJRU5ErkJggg=="/>
        <image id="jsc_e" width="51" height="52" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAA0CAYAAAAnpACSAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAFSElEQVRogd2a3VIbOxCE28TYQIDc5OV4wrwcNyfhP8CeC9S41duzP4FTpyqqmtLaXmv1aUajmbGBv6htPnOwq+F61Xg/Nt+Hz3z+h2CKya8Zs4P5KNxqmACwKfpq/GGmB/BnYKtgBER7v/b3tOnEh5nXANZBLYKZgKAcFdf+jMHktbjuoJYCzcIYSAI4KsS1xMm9Sl+JQ2MJ1CRMAaIT/hKE7/Nefl818ArgRXqVCmwWqIQJIAliW8gX9BqCTEon/hxEoV5kAThGCbRdCeIAx012cn0s9zmMauJ3kCcDg4NIP2ojzRQgrglOft9kJ/0OvYY4jpqXTv6xyZP0/JxQbnZROx3MhEZUE5z4HsAJgNPWnwQgmhtwMLFnA3kQuTc41dQsUDIz3+zUiGriVOSsiUJRcwnGQe6b8H7VJuS77Df23iQMgVwr1AgBvgI4b/1XA9q3yXHfAAcTew4gt+g1SRh30Z27vhquN6qdd5hmYnNaOZXJXzQY9gqUYAYcTIYwdw2E9yoMFyAdqNEZVGbm3su1cgHgssmFARFmZ5PTzf+IN42oFtW81PNpP4oYVDtb0QrQa8a1ws1+3uQSwLcmBFJT42qrN1MY3kdn4Rrxw9QPVM53bGaYNrEd+r3CyRPmMmhGHYDDPOHNzBQEsuL0eCp6oKoG31sys8rETtBvfALR3AiTTIcTpQN4Qu3t+LnLb/SRxasDLdWMmpkDnYucoTcd3wdcWXUO+pkfpDx/+Nq9HQBsroZr/Nh8H1wzafPrQelA7Hl9hrEncxN6KTSiIHQOqmU9h9x9v2kmuGQ/YxyGQCr64D0OZ1OKzdz0uEe4jzSqoFesQLqWNFPFYx7KEE7js2O5N53k6okUZB9Eg1eP9SLQ2nBmSqoUII09tPtebAzGdT6ujpcy2cM5EyCmkrCUu6gJaAaa8qWp3Cj1R6jNqxvfV64CS4C+UmnVgPEqrkm9Uwoe98sUzP/VNtavalXUDExHrFVFpcvXZZylY84VNapnABhrZu4BPKFTzOSxkz90auwUh6V4LI353rbhg1QG0gzR4ya+3rX7qlKTAmgxI9UCPG1WsDINcDPzVfM0lxGv5+16sKn7raozzzbuUxhXYzICVRoCABy1XCCpX0E00tWY6R7j+EknkTToabPXAXQ8h5kESppx02KooanuHfpwI4XxanL6PqF0LGact+2a6bQukGonOoKpPaPhuINoyOEg/F5KATwOuwNwI3IrokDUqGtG513uGX6Bq6gwt+jjsKqUNFedUZifAH41IdQdenNTU+s006XNBYhv/gfkeClNtCpoaNr8gIMWfgL4R6DU3HzvaLDatS3JWirgDkAfrvGY7wVf8SUFDYX51UAIc4NeM+7RZvcMm5uZBoR+hvg+eETtGBIMN/4NDmammnnAQSvRk8W6mYCwZ+FAgVKy5ftqrgioGuQepKgToNt391yGNKnWnBK0lDpr+sxrVmY829QF8vRY3TOFIHTN0cyW1Jp5g24yr/u6+3atLCmcc6KcuB7A1Mii8yVNEsCoIKjm5emzp9ApfU6OQrXjYYxqQn8BGMGknzRGmik8G9qgujI+sUeMXXc6ND1MUrCq6DerFWAiCSoK6SmF1vzffzXz1Fm9ZIrE9f3kvUYeTNtUcgb03o19ynGqH2qr6kzKYRxgFQgwk57avzGW1ALSWeQpQJUvOcAo/vrQT+cBSienE/aKTFWoc6DUu2AJyGIYA3KoqpJTjZ0m7GbM68//u4m2ALWk11btQ33vv/8jkLaJfzctGXsorj/0N60/hvG29o9z2j77T3R/RfsXSO/jtpPsGBMAAAAASUVORK5CYII="/>
        <image id="jsc_f" width="48" height="47" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAvCAYAAAClgknJAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE80lEQVRogd1a21bbMBCchJAGSri0/BxfyM/RQkm4E9wHdvBovLKdwEurc/bY2Eaa2V2tdqUA/3ibfEUnF83VTv1cTs6bz469MwEDPalcvTWV685ktiYgwCcjRFuTyJu925rIaAIV4FO57tnfSkIB87qxv5XYaCKjCBj4qcieyEzu+V4JvAnwDYBXud/Ie5IZRWKQQIBXjRP4LGQ/ZC7PZhUCryEvJnyuRBoAzRCJXgIJeAIn4G8mcyFCSwCt5l8BPIc8AXiMK5+RjLpXL4kqAQOvbkKwCwAHIYdxXcS7fbRWIAFqnsAfANzH9UHIPKG1yCCJlID4PF2GWifwQwDfARzZlSRoBSfwHEDvQ9YhdyH3QoTWoEulc2KWEegBfxBAlwCORZZBgpaYx/8ogZcgQM2vAdwmhFWpul6Ms4C4joM/DJBLAKchZwBOQpZBjm6UWYDucwdgBeAPgBuTW7TW4Pz4mBNuhZoFdNLuo3Ubgv8B4GdcSUIJDLnQHVqXc7LUdiciIbFCQSCZuLMAs4gBjwPweQhJnKB1IUajLAox+ih4utpEgNfWiclFc1XMhcwCrn26zzKAngVoEqAFCErDqK4DGkZppf34Tr/J1ogirCrYDwKVmK/uc2QEKKdBLtO+L2S0AsMsSfIdw6wK14cpEivULODuQwscBwlO4pN4ptrnmpHlQhuUKzXfcY3QEEuZBwlaomhOQNMFEqALefj00Kn+7OGQQGlZdy2d3Gu8RyiuKfdCmFaozoEshHLFJQmKrr7qzxl47TvLjzixuSDqJHeXLPpWAppx0g005zkwUeCa+2S1gLZpgNecStMS9q3h2INC0Zk2zeU1ccuSNmah2vkQeA8SrqRaYlirMzoE9HktbXbg2umY+qKWJPoYWX2RAh0qE7MCRifqNuBrRLw48nE6SiLmmgV0AL/3wT/bvI9ss6DanIBnf16A630RzlDJFgfa0DgunXGmQCfPdpCal2h+0qlhR5JwJWV1so/TSeaIOXMh7Vhr2GeUpV+WpwyR0G9UOcyRXpD3v3ECbErAzVirYSlZDav7PDXwrnHNf7R/zYOqlvCVWF1HNc8qisI6doF2BZ5If9nkc+Wwb62PWchojUwCbumUAAdS7XMAzVO0cNG8H8gXNdWcal2Br1HWyKzItDYerInd/zVDVPBMnVX7/L8soVPLUvPa5y3ey8vbkDVaKzAT7a8HLifnzUVzpYNpBcXB/qDcOvF8ni7Vt7FFpdwF2BsA1yhrYlrhEeU862yx1Fwos8BcRCsp/VbT6ixtVtehQq4B/Aq5jmcrlC5UjUJ9BHxA5irMURz8I9q5we+UgGufuxIZAbqQEhieA4kbcdAHdHeg1c0e0e5KaF2c7UowICiBawC/47pC6z4d/x+7reJW0KSO7zOX2JYAJ+8N2km8Qqv9bKEsWt/Wohf3Wh+zvFRheTm0L6Shc2Xi24sFgW23FmmF2vNso8orqdrGli9cCtwjT1X7wPDuNL/JttYXJlrD9u1OkwRFV93aFnv1sGPM+YCTcCIuXmYC5equiaGC1oOO0Sc1Y09olERWCnqI7dvYUiKvIln6PHjMtMsZWXbctJfcZ7mQkvD7nQ76tioJR5xU+s5Blsz5yeTOJ5RbE6gQcUL+jq1Wrn682+Ww+1NFeeW0vq/ftIb+zE8OvmJX4aON/c3EV/xG4r9pfwEs4yD3oK/mAAAAAABJRU5ErkJggg=="/>
        <image id="jsc_g" width="76" height="55" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEwAAAA3CAYAAACmcqwpAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAGSklEQVR4nO1b2XLjOBCDcl8zT/tz+cL9uTxuknHGGe+DBQuCQOpwbMdV01VdVGSZpGB0s9nsAH9lljS1D583L40915hehHv+ndFxKrKx641dU/+Ee7vv/9v8o/3sJcUXMbAcpAu71r8duOo4I7IJrQL0R9TvO3hfAlx8kQJYBOYytJcoA1cdqyIJLAfqs9A6iLt+9gXtym8EsJRFBOeqVb9WIBPT5koCS8H5BLCWdi33GxhY6Jv4IhkA1kpi1pXoNYCbtr22z5xtyadNkWSGDtQawG/TtSiFYON589Lsw7LeSxi7lFUEiUDdALi1VoFz0AZjjUhy7g4WAfpodSXXDp6b6WLTTAxzdilgt63eAbhv2zt0oN2gA0xNE1jOMPVFNDkH6lc7v18yrvezkTksZljNJJ1hZNM9gAfRe3TgKdPcl80VB4zsIntW6MB6t3Gb0E+vv6WmuetYzFGBogkqUI+tPrX62N5XpinL9nH8bo40MTLrvdVXAG8A/mvbV/mMpurmucg0nWElH0bg7rAF5wnATwA/0AeNJktfxj6076mijKDSd32gY9YrOmZzvBSvabvYNGs+LPkv+i4y7GerT+jMk77sUAxTwN7aeV2jb4qleC0GtHNkqtN3hj1iy64f6EB7RLcI8AUurb+pklbJBBj9JtnM77gJc7FQtjYA8Lx5mWWWYyapgSl9GUGjaRK4J2wZRj/2lQxzp0/ApoKlAe0n+mY7S66AnsMH8lZIg1UH7VGUfuwQgBEIAqZgNYVnNC5LTGswc8Uci/RroKlP4wrK8IJL/D5hBZBDi3XoPzEwKYFTljWYwTQFrJSd8P2jRvwa7au6D9P+p4i/gDrwdejbmcX4jMrQQgFbxLKaDytlKhw431dS/aWWim/AddvF+wmsd/RBu8UXsOyi8lkpW6FZCwI4dr2Pep9cgDTUcZ/KVnchvucd7ETMl0cphRV+7cC5ek7ME4v7StoPXqNj1y22zLnHlk0P2MZoD9gyjfdvMGSZWtIoy0oM87RMMk8H5VjqeTlfvX0R8iSBM6z3o46xrGaSDtyU55YEqVNkDDRNOdVAGzPL0XmPAVaa8CHBmTMfZ1oKdxwwZZmDBqDOsqmAfReprdxcnWuAOcvSecReJvmdJbEsBdVqlvfos4ygTQ6wzxEwZxlBS3teZ5qzrHgOUTLLcwRMxU1TzZJJzwQaP5+d7DxnwJIv8ywxQUsrph/cDGLHxLJzBcyD67RtGzPLkmlWV/9zBYySYrNaMFuKydT5V7dL5wxYYlkprT4FtNoh9E7OGTDd95VYVgLNzbJ6NKgsKyUQSxNcoocU77+0anqokYLYawzzZQRqN84YYKneytPGJdXN+6EkzYtjJp+mwOlpvTLMWdb7UWqAbew6FYVovYMqB/qq9M6Y+NyA/k4g1YYoWMmHXUhfOykBVioGKVXQ8PiL8QyfPxZgnKv/mM44r0Dy6qPk9BtICjsBtqTM6APdyTPa5wZZgANLOl3inBN4ntlNtW2Q72yAIcOmlBmxtsErZ5RZMW1yQPG8Pw9L0sGHr64e4aeE6KjTT+wiq7xqhmeQQPfLetR8LEks43wJngLnC8XoQqWA+elJqmng4O/Y5swZIaN9ZoX+AesxTZJzTizzU6Qx8CiDuZd8WGKXlhhptQzQgZXOJI8NGNCfO39oFq+8YVgGRZeTwqielHxYrcRIGcRTmw/0gdy3mG4fKbGMoLGWTEFLC0QMuq+AbVGZhP+lipkVuuWXz/IX5EGpVwGeauvlFqKHvHQnLLqjifqJeBmwyoBar7BCBwQ/50TIrpSMO8UhSVrhHTQCN+bTqpF+ClTX6DtwZZ+aqRaInMLhq6SwSF0L5+21Fx5+jPowHYwDOVO0lmGF8tbiVOziHNmm0CiVq/N+tVqx90KtHysdY6Utxdi2YjDGkaS2W/HtnNb0/5ZneqCxsqe2NfKNZ3KkacPqjDw1YEC/5lWTBGtrU3hR9mGyWjql9VprtNL+69RgUWqgpYyLp6dmrZIUT6JpFoL+rQQW5dR+jNcJOAVQ7/XYpYV28WUKNa9jitB+Bynl9Wq6+55XJRZfLIDm7VSQvgPD/F5qB9uhVMI5+jLhMDMBObm/E4q/fPHvWq3rrBecUtI4t88jSREAla/83/C/0sr/GG+NaQW4IWcAAAAASUVORK5CYII="/>
        <image id="jsc_h" width="80" height="46" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAuCAYAAAC/OZ4cAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAFFElEQVRoge2b3VLbMBCFjyHQ8tNe8XI8IS/Xu5bfUqcX0YmPjndtp0AsZrozOzYxcaQvZ7XSygH+25use8+b3W5/vOv9Psruupvte93r4A5PQPoU8MRCiIfCXdTpAFoXnEf3agVqBGUbXKv+bwnMyQ4aOAfViUfXZ+9/RIsgbSfOq/dMgUw7GMDL/ARjkC1BdHgKqJfXMgeQQww7J/AyYPQuOJ9S5BoWKauXo58r1F7fG0EcdS6Bd2J+WvxEjg5S778WRIcXwfpTvA+OIzU6xE3ywRE8QtsU9/MIJDCG99EwXSWuPAX3Kkc97zBA7IN77a3qjKlPYWzEzwJXkEsgHsvm4L0C+J04/8dDu1JhpEBXn4I7L/6l+Ll4BNEz9bFNw8/hEdQLgGc5st2/UX8BnZzvbd8xUR9voCGq0L4GTohnGIdz9TlHNgeoyiOwZwBPxR/Lka+rGnVc3KvQFagQNXzPsIN3UfxS/AIDXIa0q3Atc4AatgT3iGEY0mjR9/m0ZlEIKzwq8ALAFYDr4leoIUYqbCGJaLZl2BIev/hTeU+UoXvs2j6ZhaPMyxD+igHgt+IEeVmuszEbjMfBNczHP1XfI4AH7Pp2igGOhzqzs47nixRIFWUK/F6cSrzADiIBtqhAHfuoPobuFnWCeSnHTXntBPWUBigXmUCyuZ8mEY5/19gpkBAZyhnAFhSoAJ8Qw9OsTKeQOD/sAHS32x+46262c2MgATKJMIwVIkOZADmlyRR4bIsAcqghPAWr42I0LassGwMjgJyqECJBMqQ/E0Aqj+MiM7KO49lYXvUnU6Cvez0bqxoVJq9NZeFjmwNkwiC8F+xU5/NZXaKmw5ACjEpSvgbmN0OQCpRQz1ED1Psf0zSZEKBmW8JjH3xpqvBcgftMnCkQqJV4ijFIB6oNiACuaT0GCEwY2mbtk/Z1dkm6pBoTqVGXef6h0YevaV5Q9T5MtdujcmSukKiSHME8xNe2SAjRlC27DsRcAOQK9H+eA+F7C6OS+Mr2L21a1Pc5gBmYrJpL1/e0YN5e9aiUHxYOInOAU7tX3git4LLswyHBy1lrm7Zdi6a+3o1K+UDMBUCuwAialoN0vUhnNaNHuwDZdhZQ6YSpwlB1ptEUAYzC1UvgWojkvA8Ypgc6EW/BXIEsJmgBlTBVkVlY700BRvunGq660Oaakcu2DvXcqpVVCM0LquzDQ3EHGVWhwzCOxsCohhYttlV5bBQBtjIHpGUVmQcAvwDcl3OHmClxb1MhHNXQ+KFawf2DocJBRbYMkO19xq4v9wB+YgeSatRwzlQIIFdgVgLXCgWkMRwLdRnXykQaGCdEAlIVUokMZ1dgCHEuhH0HS9e3PYYBmaXxVgqpbi4MTmO4G0clEqDuylFIYQj7tmZWifYaoJaxpjaTWgXokcWxXZOKJpaRGrNtzUiBPp6xFET1ef2shQ11t6hfGsq+P/yEfAxclES4hafPivCafnv6REKUPFoCCAwgfHrmTyhEWbjHwiTCIyG+2msKcOpxDqA9gFEosz8K05d4qQKrDia7c4SjtbODC4+N2FRBxNf32XJuO/dwkZfC9YNZFufeQgSuNfXRosqShrSv+7MqTWWjTk48nepPoWZPpbYGzs2rLP3MsYLnD1iGnTWIPM5VnVtVnpuXqBxSWhNc9IgvbeET+tF9PgvA6DyCC+DAh8zVZn4jsugejZuDqf6e+63IQZ3/LD/lequ950/B/tuM/QVZVxnyI0PV9gAAAABJRU5ErkJggg=="/>
    </defs>
</svg>
`;function C7(n){let e=Number(n[0].toFixed(3)),t=-1*Number(n[1].toFixed(3)),i=Number(n[2].toFixed(3)),s=-1*Number(n[3].toFixed(3));return{velocityX:t,velocityY:i,velocityZ:s,angularVelocityYaw:e}}const Ac=ft.A,ip=ft.B,sp=ft.X,rp=ft.Y,Cc=ft.LTrigger,wc=ft.RTrigger,ap=ft.RShoulder,op=ft.LShoulder,w7=ft.LStick,R7=ft.RStick,ty=ft.Back;class k7{constructor(){Ne(this,"requiredMsgsLoopIntervalId",null);Ne(this,"lastMove",{velocityX:0,velocityY:0,velocityZ:0,angularVelocityYaw:0,buttonBitmask:0});Ne(this,"lastMovementTime",0);Ne(this,"lastPingTime",0);Ne(this,"lastGpadLTriggerValue",0);Ne(this,"lastGpadRTriggerValue",0);Ne(this,"triggerNextFlightModeUi",null);Ne(this,"gamepadButtonTriggers",e=>{const t=[...e];if(t[ty]&&t[ty].released&&jA(),t[sp]&&t[sp].released,t[rp]&&t[rp].released&&this.triggerNextFlightModeUi&&(ci.get()||this.triggerNextFlightModeUi(1)),t[Ac]&&t[Ac].pressed?r_.set(!0):t[Ac]&&t[Ac].released&&r_.set(!1),t[ip]&&t[ip].released&&(ci.get()||this.startVideoRecording()),t[op]&&t[op].released?(ic.update(r=>Math.min(Math.max(10,r-10),200)),cn("Throttle "+ic.get()+"%",1e3,!1,Zt.info)):t[ap]&&t[ap].released&&(ic.update(r=>Math.min(Math.max(10,r+10),200)),cn("Throttle "+ic.get()+"%",1e3,!1,Zt.info)),t[Cc]||t[wc]){const r=t[Cc]?t[Cc].value:0,a=t[wc]?t[wc].value:0;r-this.lastGpadLTriggerValue,a-this.lastGpadRTriggerValue,this.lastGpadLTriggerValue=r,this.lastGpadRTriggerValue=a}const i=[Ac,ip,sp,rp,Cc,wc,w7,R7];t[op]=t[Cc],t[ap]=t[wc];const s=t.map((r,a)=>!r||i.includes(a)?!1:r.pressed||r.heldDown);this.sendButtonsToRov(s)});Ne(this,"gamepadAxisTriggers",e=>{const t=ic.get()/100,{velocityX:i,velocityY:s,velocityZ:r,angularVelocityYaw:a}=C7(e);this.moveRov(i*t,s*t,r*t,a*t)});Ne(this,"shutdownRov",()=>{iu("Shutdown ROV?",{response:e=>{e&&(cn("Sending Shutdown Request...",2e3,!1,Zt.info),this.sendActionAndWaitForDone(wn.create({body:{oneofKind:"shutdownRov",shutdownRov:{}}}),!0,t=>{t.body.oneofKind==="error"?cn("ROV Shutdown Error: "+t.body.error.message,5e3,!1,Zt.error):t.body.oneofKind==="done"&&(cn("Please wait 20 seconds before unplugging. ROV: "+t.body.done.message,8e3,!1,Zt.success),ln.close())}))}})});Ne(this,"rebootRov",()=>{iu("Reboot the ROV?",{body:"The ROV will stop responding for about two minutes and then you can re-connect.",response:e=>{e&&(cn("Sending Reboot Request...",2e3,!1,Zt.info),this.sendActionAndWaitForDone(wn.create({body:{oneofKind:"rebootRov",rebootRov:{}}}),!0,t=>{t.body.oneofKind==="error"?cn("ROV Reboot Error: "+t.body.error.message,5e3,!1,Zt.error):t.body.oneofKind==="done"&&(cn("Press Connect again in about 30 seconds ROV: "+t.body.done.message,8e3,!1,Zt.success),cn("ROV: "+t.body.done.message),ln.close())}))}})});Ne(this,"restartRovServices",()=>{iu("Restart ROV services?",{body:"The ROV will stop responding for about a minute and then you can re-connect.",response:e=>{if(!e)return;let t=this.showCommandOutputPopup("Restarting ROV Services",`Sending Service Restart Request (Please Wait)...
`,`

Done.`);In.sendRovMessage(wn.create({body:{oneofKind:"restartRovServices",restartRovServices:{}}}),!0,t)}})});Ne(this,"getRovStatusReport",()=>{let e=this.showCommandOutputPopup("ROV Status Report",`Sending Status Request (Please Wait)...
`,`

Done.`);In.sendRovMessage(wn.create({body:{oneofKind:"rovStatusReport",rovStatusReport:{}}}),!0,e)});Ne(this,"enableRovWifi",()=>{cn("Sending Enable Wifi Command...",2e3,!1,Zt.info),this.sendActionAndWaitForDone(wn.create({body:{oneofKind:"enableWifi",enableWifi:{}}}),!0,e=>{e.body.oneofKind==="error"?cn("Enable Wifi Error: "+e.body.error.message,8e3,!1,Zt.error):e.body.oneofKind==="done"&&cn("Wifi Enable: "+e.body.done.message,2e3,!1,Zt.success)})});Ne(this,"disableRovWifi",()=>{iu("Are you sure you want to disable rov wifi?",{body:"If the ROV is connected via wifi, <em>don't do this!</em>",response:e=>{e&&(cn("Sending Disable Wifi Command...",2e3,!1,Zt.info),this.sendActionAndWaitForDone(wn.create({body:{oneofKind:"disableWifi",disableWifi:{}}}),!0,t=>{t.body.oneofKind==="error"?cn("Disable Wifi Error: "+t.body.error.message,8e3,!1,Zt.error):t.body.oneofKind==="done"&&cn("Wifi Disable: "+t.body.done.message,2e3,!1,Zt.success)}))}})})}sendActionAndWaitForDone(e,t,i){In.sendRovMessage(e,t,s=>{const r=s.body.oneofKind;i&&(r==="done"||r==="error"||r==="continuedOutput")&&i(s)})}startRequiredMsgLoop(){this.requiredMsgsLoopIntervalId||(this.requiredMsgsLoopIntervalId=Number(setInterval(()=>{if(ln.connectionState.get()!==Dt.connected)return;const e=ti();e-this.lastPingTime>sO&&(In.sendRovMessage(wn.create({body:{oneofKind:"ping",ping:{time:e}}}),!0,null),this.lastPingTime=e),e-this.lastMovementTime>rO&&(In.sendRovMessage(wn.create({body:{oneofKind:"move",move:this.lastMove}}),!1,null),this.lastMovementTime=e)},10)))}stopRequiredMsgLoop(){clearInterval(this.requiredMsgsLoopIntervalId),this.requiredMsgsLoopIntervalId=null}showCommandOutputPopup(e,t,i){let s=dV(e,"");return s(t),r=>{const a=r.body.oneofKind;a==="continuedOutput"?s(r.body.continuedOutput.message+`
`):a==="done"?s(r.body.done.message+`
`+i):a==="error"&&s(r.body.error.message+`
`)}}takeControl(){ci.get()||In.sendRovMessage(wn.create({body:{oneofKind:"takeControl",takeControl:{}}}),!0,null)}disarm(){ci.get()||In.sendRovMessage(wn.create({body:{oneofKind:"disarm",disarm:{}}}),!0,null)}setFlightMode(e){QE.set(e),!ci.get()&&In.sendRovMessage(wn.create({body:{oneofKind:"setAutopilotMode",setAutopilotMode:{mode:e}}}),!0,null)}moveRov(e,t,i,s,r=-1){const a=r===-1?this.lastMove.buttonBitmask:r;ou.set({velocityX:e,velocityY:t,velocityZ:i,angularVelocityYaw:s,buttonBitmask:a}),this.lastMove=ou.get(),this.lastMovementTime=ti(),!ci.get()&&In.sendRovMessage(wn.create({body:{oneofKind:"move",move:{velocityX:e,velocityY:t,velocityZ:i,angularVelocityYaw:s,buttonBitmask:a}}}),!1,null)}sendButtonsToRov(e){const t=this.lastMove.velocityX,i=this.lastMove.velocityY,s=this.lastMove.velocityZ,r=this.lastMove.angularVelocityYaw,a=e.reduce((l,c,u)=>(c&&(l|=1<<oO[u]),l),0),o=ti()-this.lastMovementTime;this.lastMove.buttonBitmask===a&&o<700||(ou.set({velocityX:t,velocityY:i,velocityZ:s,angularVelocityYaw:r,buttonBitmask:a}),this.lastMove.buttonBitmask=a,this.lastMovementTime=ti(),!ci.get()&&In.sendRovMessage(wn.create({body:{oneofKind:"move",move:{velocityX:t,velocityY:i,velocityZ:s,angularVelocityYaw:r,buttonBitmask:a}}}),!0,null))}refreshAllSensorData(){In.sendRovMessage(wn.create({body:{oneofKind:"refreshAllSensors",refreshAllSensors:{}}}),!0,null)}moveClawToPosition(e){ci.get()||In.sendRovMessage(wn.create({body:{oneofKind:"moveClaw",moveClaw:{value:e}}}),!1,null)}toggleLights(){ci.get()||In.sendRovMessage(wn.create({body:{oneofKind:"toggleLights",toggleLights:{}}}),!0,null)}takePhoto(){ci.get()||In.sendRovMessage(wn.create({body:{oneofKind:"takePhoto",takePhoto:{}}}),!1,null)}startVideoRecording(){ci.get()||In.sendRovMessage(wn.create({body:{oneofKind:"startVideoRec",startVideoRec:{}}}),!0,null)}stopVideoRecording(){ci.get()||In.sendRovMessage(wn.create({body:{oneofKind:"stopVideoRec",stopVideoRec:{}}}),!0,null)}}const fd=new k7,ny=0,iy=1,sy=2,ry=3,ay=0,oy={" ":ft.A,"\\":ft.Y,enter:ft.B,shift:ft.X,tab:ft.Back,"?":ft.Start,"/":ft.Start,",":ft.DPadLeft,"<":ft.DPadLeft,".":ft.DPadRight,">":ft.DPadRight,1:ft.DPadLeft,2:ft.DPadLeft,3:ft.DPadRight,4:ft.DPadRight,q:ft.DPadUp,e:ft.DPadDown,"-":ft.LTrigger,_:ft.LTrigger,"+":ft.RTrigger,"=":ft.RTrigger,"]":ft.RShoulder,"[":ft.LShoulder,"}":ft.RShoulder,"{":ft.LShoulder},cy=Ze([]),ly=Ze([0,0,0,0]);class M7{constructor(){Ne(this,"gpadEmulator");Ne(this,"gpadApiWrapper");Ne(this,"realGamepadsConnected",Ze(0));Ne(this,"gamepadConnectDisconnectHandler",()=>{var i;const e=navigator.getGamepads();let t=e.reduce((s,r)=>r?s+1:s,0);t!=0&&((i=e[0])==null?void 0:i.emulation)==="emulated"&&(t-=1),t>1&&Fi("WARNING: More than one gamepad connected!",e),this.realGamepadsConnected.set(t)});Ne(this,"handleButtonChange",(e,t,i)=>{e!=0||!t||!t.buttons||(i.forEach((s,r)=>{s&&(s.value=t.buttons[r].value)}),cy.set(i))});Ne(this,"handleAxisChange",(e,t)=>{e!=0||!t||!t.axes||ly.set(t.axes)})}start(e,t){this.gpadEmulator||(this.gpadEmulator=new zE(.1),this.gpadEmulator.AddEmulatedGamepad(ay,!0,Hg,Wg),this.addEmulatedGamepadKeyboardBindings(ay),this.gpadApiWrapper=new zg({axisDeadZone:.05,updateDelay:28,buttonConfigs:im}),ly.subscribe(e),cy.subscribe(t),this.gpadApiWrapper.onGamepadConnect(this.gamepadConnectDisconnectHandler),this.gpadApiWrapper.onGamepadDisconnect(this.gamepadConnectDisconnectHandler),this.gpadApiWrapper.onGamepadAxisChange(this.handleAxisChange),this.gpadApiWrapper.onGamepadButtonChange(this.handleButtonChange))}gamepadApiSupported(){return this.gpadApiWrapper.gamepadApiSupported()}addEmulatedGamepadKeyboardBindings(e){const t=(i,s)=>{const r=["INPUT","TEXTAREA","SELECT","OPTION"];if(s.target&&r.includes(s.target.tagName))return;const a=s.key.toLowerCase(),o=i?1:0,l=i;s.key==="ArrowLeft"?(this.gpadEmulator.MoveAxis(e,sy,i?-1:0),s.preventDefault()):s.key==="ArrowRight"?(this.gpadEmulator.MoveAxis(e,sy,i?1:0),s.preventDefault()):s.key==="ArrowUp"?(this.gpadEmulator.MoveAxis(e,ry,i?-1:0),s.preventDefault()):s.key==="ArrowDown"?(this.gpadEmulator.MoveAxis(e,ry,i?1:0),s.preventDefault()):a==="a"?this.gpadEmulator.MoveAxis(e,ny,i?-1:0):a==="d"?this.gpadEmulator.MoveAxis(e,ny,i?1:0):a==="w"?this.gpadEmulator.MoveAxis(e,iy,i?-1:0):a==="s"?this.gpadEmulator.MoveAxis(e,iy,i?1:0):oy[a]!==void 0&&this.gpadEmulator.PressButton(e,oy[a],o,l)};window.onkeydown=i=>t(!0,i),window.onkeyup=i=>t(!1,i)}testGamepadJoysticks(){setInterval(()=>{this.gpadEmulator.MoveAxis(0,0,Math.random()*2-1),this.gpadEmulator.MoveAxis(0,1,Math.random()*2-1),this.gpadEmulator.MoveAxis(0,2,Math.random()*2-1),this.gpadEmulator.MoveAxis(0,3,Math.random()*2-1)},10)}cleanup(){this.gpadEmulator&&this.gpadEmulator.cleanup(),this.gpadApiWrapper&&this.gpadApiWrapper.cleanup(),this.gpadApiWrapper=null,this.gpadEmulator=null}}let uy=null;const Bu=()=>uy=uy??new M7;class x7{constructor(e,t,i,s=1e3){Ne(this,"gpadEmulator");Ne(this,"gpadApiWrapper");Ne(this,"gpadDisplay");Ne(this,"gpadHtmlContainer");Ne(this,"gpadButtonHighlightElements");Ne(this,"touchingButtonsCount",0);Ne(this,"someAxiesNotCentered",!1);Ne(this,"someButtonsPressed",!1);Ne(this,"tooltips");Ne(this,"handleButtonChange",(e,t,i)=>{if(e!=0||!t||!t.buttons)return;const s=ci.get();for(let r=0;r<i.length;r++)i[r]&&i[r].touchDown&&(!i[r].pressed||s)?this.tooltips[r]&&this.tooltips[r].open():(i[r]&&i[r].touchUp||i[r].pressed&&!s)&&this.tooltips[r]&&this.tooltips[r].close()});this.gpadApiWrapper=e,this.gpadEmulator=t,this.gpadHtmlContainer=i,this.gpadButtonHighlightElements=Br.map(a=>document.getElementById(a+"_highlight")),this.setupEmulatedGamepadInput(0,i);const{gpadDisplay:r}=nO(i,{AllowDpadDiagonals:!1,ClickableJoysticks:!0,VariableTriggers:!0,EmulatedGamepadOverlayMode:!0,GpadApiWrapper:e,GpadEmulator:t,JoystickDragDistance:30,TriggerDragDistance:50,EmulatedGamepadIndex:0,GpadDisplayConfig:{gamepadIndex:0}});this.gpadDisplay=r,this.addHelpTooltips(i,s),e.onGamepadButtonChange(this.handleButtonChange)}addHelpTooltips(e,t){this.tooltips=Br.map((i,s)=>{const r=e.querySelector(`#${i}_tap_target`);return r?jg(r,{label:im[s].helpLabel,config:{placement:im[s].tooltipPlacement,delay:t}}):null})}setupEmulatedGamepadInput(e,t){this.gpadEmulator.AddJoystickTouchEventListeners(e,[{tapTarget:t.querySelector("#gamepad-joystick-touch-area-left"),dragDistance:30,xAxisIndex:0,yAxisIndex:1,lockTargetWhilePressed:!0,directions:{[zt.up]:!0,[zt.down]:!0,[zt.left]:!0,[zt.right]:!0}},{tapTarget:t.querySelector("#gamepad-joystick-touch-area-right"),dragDistance:30,xAxisIndex:2,yAxisIndex:3,lockTargetWhilePressed:!0,directions:{[zt.up]:!0,[zt.down]:!0,[zt.left]:!0,[zt.right]:!0}}])}cleanup(){if(this.gpadDisplay.Cleanup(),this.gpadApiWrapper.offGamepadButtonChange(this.handleButtonChange),this.tooltips)for(const e of this.tooltips)e&&e.destroy()}}function I7(n){let e,t,i,s,r,a,o,l,c,u,d,h,f;return{c(){e=K("div"),t=K("div"),i=Te(),s=K("div"),r=Te(),a=K("div"),o=K("div"),l=new zc(!1),c=Te(),u=K("div"),d=new zc(!1),this.h()},l(g){e=q(g,"DIV",{class:!0});var v=F(e);t=q(v,"DIV",{id:!0,class:!0}),F(t).forEach(S),i=Se(v),s=q(v,"DIV",{id:!0,class:!0}),F(s).forEach(S),r=Se(v),a=q(v,"DIV",{class:!0});var m=F(a);o=q(m,"DIV",{class:!0});var _=F(o);l=Hc(_,!1),_.forEach(S),c=Se(m),u=q(m,"DIV",{class:!0});var y=F(u);d=Hc(y,!1),y.forEach(S),m.forEach(S),v.forEach(S),this.h()},h(){x(t,"id","gamepad-joystick-touch-area-left"),x(t,"class","gamepad-joystick-touch-area svelte-1kk8e90"),x(s,"id","gamepad-joystick-touch-area-right"),x(s,"class","gamepad-joystick-touch-area svelte-1kk8e90"),l.a=null,x(o,"class","gpad-display gpad-display-left svelte-1kk8e90"),Ct(o,"hidden",!n[1]),d.a=null,x(u,"class","gpad-display gpad-display-right svelte-1kk8e90"),Ct(u,"hidden",!n[1]),Ct(u,"rov-armed",n[2]),x(a,"class","inset-0 opacity-100 absolute pointer-events-none"),Ct(a,"hidden",n[0]),x(e,"class","contents")},m(g,v){D(g,e,v),P(e,t),P(e,i),P(e,s),P(e,r),P(e,a),P(a,o),l.m(E7,o),P(a,c),P(a,u),d.m(A7,u),n[5](e),f=!0},p(g,[v]){(!f||v&2)&&Ct(o,"hidden",!g[1]),(!f||v&2)&&Ct(u,"hidden",!g[1]),(!f||v&4)&&Ct(u,"rov-armed",g[2]),(!f||v&1)&&Ct(a,"hidden",g[0])},i(g){f||(g&&Qm(()=>{f&&(h||(h=C0(a,cp,{duration:100},!0)),h.run(1))}),f=!0)},o(g){g&&(h||(h=C0(a,cp,{duration:100},!1)),h.run(0)),f=!1},d(g){g&&S(e),g&&h&&h.end(),n[5](null)}}}function P7(n,e,t){let i;qn(n,Nd,u=>t(2,i=u));let s,{collapsedMode:r=!1}=e,{visible:a=!1}=e,{tooltipDelay:o=0}=e,l;Da(()=>{{s||console.error("missing GPAD_DISPLAY_CONTAINER",s);const u=Bu();u.start(fd.gamepadAxisTriggers,fd.gamepadButtonTriggers),l=new x7(u.gpadApiWrapper,u.gpadEmulator,s,o)}}),pd(()=>{l.cleanup()});function c(u){Nn[u?"unshift":"push"](()=>{s=u,t(3,s)})}return n.$$set=u=>{"collapsedMode"in u&&t(0,r=u.collapsedMode),"visible"in u&&t(1,a=u.visible),"tooltipDelay"in u&&t(4,o=u.tooltipDelay)},n.$$.update=()=>{n.$$.dirty&4},[r,a,i,s,o,c]}class N7 extends Bt{constructor(e){super(),Vt(this,e,P7,I7,Ft,{collapsedMode:0,visible:1,tooltipDelay:4})}}function D7(n){let e,t,i,s,r,a,o,l;t=new cx({props:{class:"max-w-11 max-h-11 h-full w-full text-warning-400-500-token pointer-events-none select-none",tabindex:"-1",variation:"round"}});const c=n[2].default,u=ii(c,n,n[1],null);return{c(){e=K("blockquote"),ct(t.$$.fragment),i=Te(),s=K("p"),r=K("b"),a=be(n[0]),o=Te(),u&&u.c(),this.h()},l(d){e=q(d,"BLOCKQUOTE",{class:!0});var h=F(e);pt(t.$$.fragment,h),i=Se(h),s=q(h,"P",{});var f=F(s);r=q(f,"B",{class:!0});var g=F(r);a=ye(g,n[0]),g.forEach(S),o=Se(f),u&&u.l(f),f.forEach(S),h.forEach(S),this.h()},h(){x(r,"class","block text-white"),x(e,"class","rounded-xl border-warning-400-500-token font-normal bg-warning-600/30 border-l-8 py-2 px-3 w-full max-w-lg mx-auto flex flex-row items-center text-left space-x-4")},m(d,h){D(d,e,h),lt(t,e,null),P(e,i),P(e,s),P(s,r),P(r,a),P(s,o),u&&u.m(s,null),l=!0},p(d,[h]){(!l||h&1)&&gt(a,d[0]),u&&u.p&&(!l||h&2)&&si(u,c,d,d[1],l?ai(c,d[1],h,null):ri(d[1]),null)},i(d){l||(ce(t.$$.fragment,d),ce(u,d),l=!0)},o(d){fe(t.$$.fragment,d),fe(u,d),l=!1},d(d){d&&S(e),ut(t),u&&u.d(d)}}}function L7(n,e,t){let{$$slots:i={},$$scope:s}=e,{heading:r="Warning"}=e;return n.$$set=a=>{"heading"in a&&t(0,r=a.heading),"$$scope"in a&&t(1,s=a.$$scope)},[r,s,i]}class f0 extends Bt{constructor(e){super(),Vt(this,e,L7,D7,Ft,{heading:0})}}function O7(n){let e,t,i,s,r,a,o,l;t=new pM({props:{class:"max-w-11 max-h-11 h-full w-full text-blue-500 pointer-events-none select-none",tabindex:"-1",variation:"round"}});const c=n[2].default,u=ii(c,n,n[1],null);return{c(){e=K("blockquote"),ct(t.$$.fragment),i=Te(),s=K("p"),r=K("b"),a=be(n[0]),o=Te(),u&&u.c(),this.h()},l(d){e=q(d,"BLOCKQUOTE",{class:!0});var h=F(e);pt(t.$$.fragment,h),i=Se(h),s=q(h,"P",{class:!0});var f=F(s);r=q(f,"B",{class:!0});var g=F(r);a=ye(g,n[0]),g.forEach(S),o=Se(f),u&&u.l(f),f.forEach(S),h.forEach(S),this.h()},h(){x(r,"class","block text-white"),x(s,"class","w-max flex-1"),x(e,"class","rounded-xl border-blue-500 font-normal bg-[#30439b] border-l-8 py-2 px-3 w-full max-w-lg mx-auto flex flex-row items-center text-left space-x-4")},m(d,h){D(d,e,h),lt(t,e,null),P(e,i),P(e,s),P(s,r),P(r,a),P(s,o),u&&u.m(s,null),l=!0},p(d,[h]){(!l||h&1)&&gt(a,d[0]),u&&u.p&&(!l||h&2)&&si(u,c,d,d[1],l?ai(c,d[1],h,null):ri(d[1]),null)},i(d){l||(ce(t.$$.fragment,d),ce(u,d),l=!0)},o(d){fe(t.$$.fragment,d),fe(u,d),l=!1},d(d){d&&S(e),ut(t),u&&u.d(d)}}}function U7(n,e,t){let{$$slots:i={},$$scope:s}=e,{heading:r="Info"}=e;return n.$$set=a=>{"heading"in a&&t(0,r=a.heading),"$$scope"in a&&t(1,s=a.$$scope)},[r,s,i]}class Va extends Bt{constructor(e){super(),Vt(this,e,U7,O7,Ft,{heading:0})}}function F7(n){let e,t,i,s,r,a,o,l;t=new rk({props:{class:"max-w-11 max-h-11 h-full w-full text-success-400-500-token pointer-events-none select-none",tabindex:"-1",variation:"round"}});const c=n[2].default,u=ii(c,n,n[1],null);return{c(){e=K("blockquote"),ct(t.$$.fragment),i=Te(),s=K("p"),r=K("b"),a=be(n[0]),o=Te(),u&&u.c(),this.h()},l(d){e=q(d,"BLOCKQUOTE",{class:!0});var h=F(e);pt(t.$$.fragment,h),i=Se(h),s=q(h,"P",{});var f=F(s);r=q(f,"B",{class:!0});var g=F(r);a=ye(g,n[0]),g.forEach(S),o=Se(f),u&&u.l(f),f.forEach(S),h.forEach(S),this.h()},h(){x(r,"class","block text-white"),x(e,"class","rounded-xl border-success-400-500-token font-normal bg-success-600/30 border-l-8 py-2 px-3 w-full max-w-lg mx-auto flex flex-row items-center text-left space-x-4")},m(d,h){D(d,e,h),lt(t,e,null),P(e,i),P(e,s),P(s,r),P(r,a),P(s,o),u&&u.m(s,null),l=!0},p(d,[h]){(!l||h&1)&&gt(a,d[0]),u&&u.p&&(!l||h&2)&&si(u,c,d,d[1],l?ai(c,d[1],h,null):ri(d[1]),null)},i(d){l||(ce(t.$$.fragment,d),ce(u,d),l=!0)},o(d){fe(t.$$.fragment,d),fe(u,d),l=!1},d(d){d&&S(e),ut(t),u&&u.d(d)}}}function B7(n,e,t){let{$$slots:i={},$$scope:s}=e,{heading:r="Success"}=e;return n.$$set=a=>{"heading"in a&&t(0,r=a.heading),"$$scope"in a&&t(1,s=a.$$scope)},[r,s,i]}class pl extends Bt{constructor(e){super(),Vt(this,e,B7,F7,Ft,{heading:0})}}function dy(n){let e,t;return e=new N7({props:{visible:!(n[0]==="gamepad"&&n[2]&&n[3]||n[0]==="touchscreen"),tooltipDelay:300}}),{c(){ct(e.$$.fragment)},l(i){pt(e.$$.fragment,i)},m(i,s){lt(e,i,s),t=!0},p(i,s){const r={};s&13&&(r.visible=!(i[0]==="gamepad"&&i[2]&&i[3]||i[0]==="touchscreen")),e.$set(r)},i(i){t||(ce(e.$$.fragment,i),t=!0)},o(i){fe(e.$$.fragment,i),t=!1},d(i){ut(e,i)}}}function V7(n){let e,t;return e=new Va({props:{heading:"Touch Controls",$$slots:{default:[H7]},$$scope:{ctx:n}}}),{c(){ct(e.$$.fragment)},l(i){pt(e.$$.fragment,i)},m(i,s){lt(e,i,s),t=!0},p(i,s){const r={};s&16384&&(r.$$scope={dirty:s,ctx:i}),e.$set(r)},i(i){t||(ce(e.$$.fragment,i),t=!0)},o(i){fe(e.$$.fragment,i),t=!1},d(i){ut(e,i)}}}function G7(n){let e,t;return e=new Va({props:{heading:"Keyboard Controls",$$slots:{default:[W7]},$$scope:{ctx:n}}}),{c(){ct(e.$$.fragment)},l(i){pt(e.$$.fragment,i)},m(i,s){lt(e,i,s),t=!0},p(i,s){const r={};s&16384&&(r.$$scope={dirty:s,ctx:i}),e.$set(r)},i(i){t||(ce(e.$$.fragment,i),t=!0)},o(i){fe(e.$$.fragment,i),t=!1},d(i){ut(e,i)}}}function z7(n){let e,t,i,s;const r=[K7,j7],a=[];function o(l,c){return l[2]?0:1}return e=o(n),t=a[e]=r[e](n),{c(){t.c(),i=dn()},l(l){t.l(l),i=dn()},m(l,c){a[e].m(l,c),D(l,i,c),s=!0},p(l,c){let u=e;e=o(l),e===u?a[e].p(l,c):(_n(),fe(a[u],1,1,()=>{a[u]=null}),vn(),t=a[e],t?t.p(l,c):(t=a[e]=r[e](l),t.c()),ce(t,1),t.m(i.parentNode,i))},i(l){s||(ce(t),s=!0)},o(l){fe(t),s=!1},d(l){l&&S(i),a[e].d(l)}}}function H7(n){let e,t,i;return{c(){e=be("Use the on-screen joysticks to test drive the ROV."),t=K("br"),i=be(`
        Touch & hold buttons to learn what they do.`)},l(s){e=ye(s,"Use the on-screen joysticks to test drive the ROV."),t=q(s,"BR",{}),i=ye(s,`
        Touch & hold buttons to learn what they do.`)},m(s,r){D(s,e,r),D(s,t,r),D(s,i,r)},p:Tt,d(s){s&&(S(e),S(t),S(i))}}}function W7(n){let e,t,i;return{c(){e=be("Use W A S D and arrow keys to test drive the ROV."),t=K("br"),i=be(`
        Press & hold number keys to learn what they do.`)},l(s){e=ye(s,"Use W A S D and arrow keys to test drive the ROV."),t=q(s,"BR",{}),i=ye(s,`
        Press & hold number keys to learn what they do.`)},m(s,r){D(s,e,r),D(s,t,r),D(s,i,r)},p:Tt,d(s){s&&(S(e),S(t),S(i))}}}function j7(n){let e,t;return e=new f0({props:{heading:"This browser does not support game controllers",$$slots:{default:[q7]},$$scope:{ctx:n}}}),{c(){ct(e.$$.fragment)},l(i){pt(e.$$.fragment,i)},m(i,s){lt(e,i,s),t=!0},p(i,s){const r={};s&16384&&(r.$$scope={dirty:s,ctx:i}),e.$set(r)},i(i){t||(ce(e.$$.fragment,i),t=!0)},o(i){fe(e.$$.fragment,i),t=!1},d(i){ut(e,i)}}}function K7(n){let e,t,i,s;const r=[Y7,X7],a=[];function o(l,c){return l[3]?0:1}return e=o(n),t=a[e]=r[e](n),{c(){t.c(),i=dn()},l(l){t.l(l),i=dn()},m(l,c){a[e].m(l,c),D(l,i,c),s=!0},p(l,c){let u=e;e=o(l),e!==u&&(_n(),fe(a[u],1,1,()=>{a[u]=null}),vn(),t=a[e],t||(t=a[e]=r[e](l),t.c()),ce(t,1),t.m(i.parentNode,i))},i(l){s||(ce(t),s=!0)},o(l){fe(t),s=!1},d(l){l&&S(i),a[e].d(l)}}}function q7(n){let e,t,i;return{c(){e=be("Please use keyboard or touch controls"),t=K("br"),i=be(`
          or try a different browser.`)},l(s){e=ye(s,"Please use keyboard or touch controls"),t=q(s,"BR",{}),i=ye(s,`
          or try a different browser.`)},m(s,r){D(s,e,r),D(s,t,r),D(s,i,r)},p:Tt,d(s){s&&(S(e),S(t),S(i))}}}function X7(n){let e,t;return e=new Va({props:{heading:"Connect a game controller to your computer",$$slots:{default:[J7]},$$scope:{ctx:n}}}),{c(){ct(e.$$.fragment)},l(i){pt(e.$$.fragment,i)},m(i,s){lt(e,i,s),t=!0},i(i){t||(ce(e.$$.fragment,i),t=!0)},o(i){fe(e.$$.fragment,i),t=!1},d(i){ut(e,i)}}}function Y7(n){let e,t;return e=new pl({props:{heading:"Game controller connected!",$$slots:{default:[Q7]},$$scope:{ctx:n}}}),{c(){ct(e.$$.fragment)},l(i){pt(e.$$.fragment,i)},m(i,s){lt(e,i,s),t=!0},i(i){t||(ce(e.$$.fragment,i),t=!0)},o(i){fe(e.$$.fragment,i),t=!1},d(i){ut(e,i)}}}function J7(n){let e,t,i;return{c(){e=be("1. Connect bluetooth controllers in your device's settings."),t=K("br"),i=be(`
            2. Press any button to enable your game controller.`)},l(s){e=ye(s,"1. Connect bluetooth controllers in your device's settings."),t=q(s,"BR",{}),i=ye(s,`
            2. Press any button to enable your game controller.`)},m(s,r){D(s,e,r),D(s,t,r),D(s,i,r)},p:Tt,d(s){s&&(S(e),S(t),S(i))}}}function Q7(n){let e,t,i;return{c(){e=be("Use the joysticks to test drive the ROV."),t=K("br"),i=be(`
            Press & hold buttons to learn what they do.`)},l(s){e=ye(s,"Use the joysticks to test drive the ROV."),t=q(s,"BR",{}),i=ye(s,`
            Press & hold buttons to learn what they do.`)},m(s,r){D(s,e,r),D(s,t,r),D(s,i,r)},p:Tt,d(s){s&&(S(e),S(t),S(i))}}}function Z7(n){let e,t,i,s,r,a,o,l="Tutorial",c,u,d,h,f,g,v,m,_,y,b,p,w="SKIP",E,C,M="NEXT",I,T,R,V=(n[0]==="gamepad"&&n[2]&&n[3]||n[0]==="touchscreen")&&dy(n);r=new gd({props:{class:"text-2xl pointer-events-none",tabindex:"-1",variation:"round"}}),u=new S7({props:{canvasClass:"relative block rounded-full m-8 bg-black text-white text-center vertical-center",showEnvironment:!0,useRovOrientationData:!1}});function H(z){n[9](z)}let B={onChange:n[8],variant:"-surface",options:[{label:"Gamepad",value:"gamepad",icon:aM},{label:"Keyboard",value:"keyboard",icon:SM},{label:"Touchscreen",value:"touchscreen",icon:ex}]};n[0]!==void 0&&(B.value=n[0]),h=new eA({props:B}),Nn.push(()=>vi(h,"value",H));const te=[z7,G7,V7],j=[];function oe(z,W){return z[0]==="gamepad"?0:z[0]==="keyboard"?1:z[0]==="touchscreen"?2:-1}return~(m=oe(n))&&(_=j[m]=te[m](n)),{c(){e=K("div"),V&&V.c(),t=Te(),i=K("div"),s=K("button"),ct(r.$$.fragment),a=Te(),o=K("h2"),o.textContent=l,c=Te(),ct(u.$$.fragment),d=Te(),ct(h.$$.fragment),g=Te(),v=K("b"),_&&_.c(),y=Te(),b=K("div"),p=K("button"),p.textContent=w,E=Te(),C=K("button"),C.textContent=M,this.h()},l(z){e=q(z,"DIV",{class:!0});var W=F(e);V&&V.l(W),t=Se(W),i=q(W,"DIV",{class:!0});var ie=F(i);s=q(ie,"BUTTON",{class:!0});var se=F(s);pt(r.$$.fragment,se),se.forEach(S),ie.forEach(S),a=Se(W),o=q(W,"H2",{class:!0,"data-svelte-h":!0}),En(o)!=="svelte-7jky68"&&(o.textContent=l),c=Se(W),pt(u.$$.fragment,W),d=Se(W),pt(h.$$.fragment,W),g=Se(W),v=q(W,"B",{class:!0});var je=F(v);_&&_.l(je),je.forEach(S),y=Se(W),b=q(W,"DIV",{class:!0});var ge=F(b);p=q(ge,"BUTTON",{class:!0,"data-svelte-h":!0}),En(p)!=="svelte-4mwnnc"&&(p.textContent=w),E=Se(ge),C=q(ge,"BUTTON",{class:!0,"data-svelte-h":!0}),En(C)!=="svelte-1vxxvw3"&&(C.textContent=M),ge.forEach(S),W.forEach(S),this.h()},h(){x(s,"class","btn btn-icon-lg btn-icon"),x(i,"class","flex flex-col justify-center align-middle right-2 top-2 absolute"),x(o,"class","h2 mt-3"),x(v,"class","w-full rounded-xl px-8 py-4 text-center"),x(p,"class","btn btn-md variant-outline-surface"),x(C,"class","btn btn-md variant-filled-primary shadow-md"),x(b,"class","space-x-4 z-10"),x(e,"class","h-full w-full rounded-3xl overflow-hidden shadow-2xl mt-auto flex flex-1 flex-col items-center justify-center relative bg-surface-800 p-4")},m(z,W){D(z,e,W),V&&V.m(e,null),P(e,t),P(e,i),P(i,s),lt(r,s,null),n[7](s),P(e,a),P(e,o),P(e,c),lt(u,e,null),P(e,d),lt(h,e,null),P(e,g),P(e,v),~m&&j[m].m(v,null),P(e,y),P(e,b),P(b,p),P(b,E),P(b,C),I=!0,T||(R=[X(s,"click",n[6]),X(p,"click",n[10]),X(C,"click",n[11])],T=!0)},p(z,[W]){z[0]==="gamepad"&&z[2]&&z[3]||z[0]==="touchscreen"?V?(V.p(z,W),W&13&&ce(V,1)):(V=dy(z),V.c(),ce(V,1),V.m(e,t)):V&&(_n(),fe(V,1,1,()=>{V=null}),vn());const ie={};W&2&&(ie.onChange=z[8]),!f&&W&1&&(f=!0,ie.value=z[0],_i(()=>f=!1)),h.$set(ie);let se=m;m=oe(z),m===se?~m&&j[m].p(z,W):(_&&(_n(),fe(j[se],1,1,()=>{j[se]=null}),vn()),~m?(_=j[m],_?_.p(z,W):(_=j[m]=te[m](z),_.c()),ce(_,1),_.m(v,null)):_=null)},i(z){I||(ce(V),ce(r.$$.fragment,z),ce(u.$$.fragment,z),ce(h.$$.fragment,z),ce(_),I=!0)},o(z){fe(V),fe(r.$$.fragment,z),fe(u.$$.fragment,z),fe(h.$$.fragment,z),fe(_),I=!1},d(z){z&&S(e),V&&V.d(),ut(r),n[7](null),ut(u),ut(h),~m&&j[m].d(),T=!1,kn(R)}}}function $7(n,e,t){let i,s;const a=Bu().realGamepadsConnected;qn(n,a,m=>t(5,s=m));let o="gamepad",l,c=!1;Da(()=>{ci.set(!0),Bu().start(fd.gamepadAxisTriggers,fd.gamepadButtonTriggers),t(2,c=Bu().gamepadApiSupported())}),pd(()=>{ci.set(!1),localStorage.setItem("tutorialComplete","true")});const u=()=>wa();function d(m){Nn[m?"unshift":"push"](()=>{l=m,t(1,l)})}const h=()=>{l.focus(),l.blur()};function f(m){o=m,t(0,o)}const g=()=>wa(),v=()=>{wa(),hV()};return n.$$.update=()=>{n.$$.dirty&32&&t(3,i=s>0),n.$$.dirty&32},[o,l,c,i,a,s,u,d,h,f,g,v]}class eV extends Bt{constructor(e){super(),Vt(this,e,$7,Z7,Ft,{})}}function tV(n){let e,t,i,s;return e=new Va({props:{heading:"Acro mode drives the rov based on angular velocity"}}),i=new pl({props:{heading:"Good for... IDK :)"}}),{c(){ct(e.$$.fragment),t=Te(),ct(i.$$.fragment)},l(r){pt(e.$$.fragment,r),t=Se(r),pt(i.$$.fragment,r)},m(r,a){lt(e,r,a),D(r,t,a),lt(i,r,a),s=!0},i(r){s||(ce(e.$$.fragment,r),ce(i.$$.fragment,r),s=!0)},o(r){fe(e.$$.fragment,r),fe(i.$$.fragment,r),s=!1},d(r){r&&S(t),ut(e,r),ut(i,r)}}}function nV(n){let e,t,i,s,r,a;return e=new Va({props:{heading:"Stabilize Depth mode maintains depth and stability"}}),i=new pl({props:{heading:"Good for getting photos and videos"}}),r=new f0({props:{heading:"Avoid near the seabed or obstacles"}}),{c(){ct(e.$$.fragment),t=Te(),ct(i.$$.fragment),s=Te(),ct(r.$$.fragment)},l(o){pt(e.$$.fragment,o),t=Se(o),pt(i.$$.fragment,o),s=Se(o),pt(r.$$.fragment,o)},m(o,l){lt(e,o,l),D(o,t,l),lt(i,o,l),D(o,s,l),lt(r,o,l),a=!0},i(o){a||(ce(e.$$.fragment,o),ce(i.$$.fragment,o),ce(r.$$.fragment,o),a=!0)},o(o){fe(e.$$.fragment,o),fe(i.$$.fragment,o),fe(r.$$.fragment,o),a=!1},d(o){o&&(S(t),S(s)),ut(e,o),ut(i,o),ut(r,o)}}}function iV(n){let e,t,i,s,r,a;return e=new Va({props:{heading:"Stabilize mode keeps the ROV level and stable."}}),i=new pl({props:{heading:"Good for general driving"}}),r=new f0({props:{heading:"Avoid in tight spaces"}}),{c(){ct(e.$$.fragment),t=Te(),ct(i.$$.fragment),s=Te(),ct(r.$$.fragment)},l(o){pt(e.$$.fragment,o),t=Se(o),pt(i.$$.fragment,o),s=Se(o),pt(r.$$.fragment,o)},m(o,l){lt(e,o,l),D(o,t,l),lt(i,o,l),D(o,s,l),lt(r,o,l),a=!0},i(o){a||(ce(e.$$.fragment,o),ce(i.$$.fragment,o),ce(r.$$.fragment,o),a=!0)},o(o){fe(e.$$.fragment,o),fe(i.$$.fragment,o),fe(r.$$.fragment,o),a=!1},d(o){o&&(S(t),S(s)),ut(e,o),ut(i,o),ut(r,o)}}}function sV(n){let e,t,i,s;return e=new Va({props:{heading:"Manual mode is the ROV's basic driving mode."}}),i=new pl({props:{heading:"Good control in tight spaces and over seabed"}}),{c(){ct(e.$$.fragment),t=Te(),ct(i.$$.fragment)},l(r){pt(e.$$.fragment,r),t=Se(r),pt(i.$$.fragment,r)},m(r,a){lt(e,r,a),D(r,t,a),lt(i,r,a),s=!0},i(r){s||(ce(e.$$.fragment,r),ce(i.$$.fragment,r),s=!0)},o(r){fe(e.$$.fragment,r),fe(i.$$.fragment,r),s=!1},d(r){r&&S(t),ut(e,r),ut(i,r)}}}function rV(n){let e,t,i,s,r,a,o="Fly Modes",l,c,u,d,h,f,g,v,m,_,y="BACK",b,p,w="DONE",E,C,M;s=new gd({props:{class:"text-2xl pointer-events-none",tabindex:"-1",variation:"round"}});function I(B){n[4](B)}let T={variant:"-surface",options:[{value:ls.manual,label:"Manual",icon:Zk},{value:ls.stabilize,label:"Stabilize",icon:Wk},{value:ls.depth_hold,label:"Stabilize Depth",icon:Ok},{value:ls.acrobatic,label:"Acro",icon:FM}]};n[0]!==void 0&&(T.value=n[0]),c=new eA({props:T}),Nn.push(()=>vi(c,"value",I));const R=[sV,iV,nV,tV],V=[];function H(B,te){return B[0]===ls.manual?0:B[0]===ls.stabilize?1:B[0]===ls.depth_hold?2:B[0]===ls.acrobatic?3:-1}return~(f=H(n))&&(g=V[f]=R[f](n)),{c(){e=K("div"),t=K("div"),i=K("button"),ct(s.$$.fragment),r=Te(),a=K("h2"),a.textContent=o,l=Te(),ct(c.$$.fragment),d=Te(),h=K("div"),g&&g.c(),v=Te(),m=K("div"),_=K("button"),_.textContent=y,b=Te(),p=K("button"),p.textContent=w,this.h()},l(B){e=q(B,"DIV",{class:!0});var te=F(e);t=q(te,"DIV",{class:!0});var j=F(t);i=q(j,"BUTTON",{class:!0});var oe=F(i);pt(s.$$.fragment,oe),oe.forEach(S),j.forEach(S),r=Se(te),a=q(te,"H2",{class:!0,"data-svelte-h":!0}),En(a)!=="svelte-7ghtd5"&&(a.textContent=o),l=Se(te),pt(c.$$.fragment,te),d=Se(te),h=q(te,"DIV",{class:!0});var z=F(h);g&&g.l(z),z.forEach(S),v=Se(te),m=q(te,"DIV",{class:!0});var W=F(m);_=q(W,"BUTTON",{class:!0,"data-svelte-h":!0}),En(_)!=="svelte-q94rop"&&(_.textContent=y),b=Se(W),p=q(W,"BUTTON",{class:!0,"data-svelte-h":!0}),En(p)!=="svelte-xbsfow"&&(p.textContent=w),W.forEach(S),te.forEach(S),this.h()},h(){x(i,"class","btn btn-icon-lg btn-icon"),x(t,"class","flex flex-col justify-center align-middle right-2 top-2 absolute"),x(a,"class","h2 m-8 mb-10"),x(h,"class","w-full rounded-xl px-8 py-8 space-y-2 h-64 min-h-fit"),x(_,"class","btn btn-md variant-outline-surface"),x(p,"class","btn btn-md variant-filled-primary shadow-md"),x(m,"class","space-x-4"),x(e,"class","w-full rounded-3xl shadow-2xl mt-auto flex flex-1 flex-col items-center justify-center relative bg-surface-800 p-4")},m(B,te){D(B,e,te),P(e,t),P(t,i),lt(s,i,null),n[3](i),P(e,r),P(e,a),P(e,l),lt(c,e,null),P(e,d),P(e,h),~f&&V[f].m(h,null),P(e,v),P(e,m),P(m,_),P(m,b),P(m,p),E=!0,C||(M=[X(i,"click",n[2]),X(_,"click",n[5]),X(p,"click",n[6])],C=!0)},p(B,[te]){const j={};!u&&te&1&&(u=!0,j.value=B[0],_i(()=>u=!1)),c.$set(j);let oe=f;f=H(B),f!==oe&&(g&&(_n(),fe(V[oe],1,1,()=>{V[oe]=null}),vn()),~f?(g=V[f],g||(g=V[f]=R[f](B),g.c()),ce(g,1),g.m(h,null)):g=null)},i(B){E||(ce(s.$$.fragment,B),ce(c.$$.fragment,B),ce(g),E=!0)},o(B){fe(s.$$.fragment,B),fe(c.$$.fragment,B),fe(g),E=!1},d(B){B&&S(e),ut(s),n[3](null),ut(c),~f&&V[f].d(),C=!1,kn(M)}}}function aV(n,e,t){let i=ls.manual,s;Da(()=>{ci.set(!0)}),pd(()=>{ci.set(!1)});const r=()=>wa();function a(u){Nn[u?"unshift":"push"](()=>{s=u,t(1,s)})}function o(u){i=u,t(0,i)}return[i,s,r,a,o,()=>{wa(),jA()},()=>wa()]}class oV extends Bt{constructor(e){super(),Vt(this,e,aV,rV,Ft,{})}}function cV(n){let e,t="",i;return{c(){e=K("iframe"),e.innerHTML=t,this.h()},l(s){e=q(s,"IFRAME",{title:!0,src:!0,"data-svelte-h":!0}),En(e)!=="svelte-1gyi3ur"&&(e.innerHTML=t),this.h()},h(){x(e,"title","WebRTC Check Page"),nC(e.src,i="https://livekit.io/connection-test?LIVEKIT_WS_URL=wss://1234.s..s.s.s")||x(e,"src",i)},m(s,r){D(s,e,r)},p:Tt,i:Tt,o:Tt,d(s){s&&S(e)}}}class lV extends Bt{constructor(e){super(),Vt(this,e,null,cV,Ft,{})}}const uV={LogTimeline:{ref:k4},TestDriveTut:{ref:eV},FlyModesTut:{ref:oV},ConnectionCheck:{ref:lV}};let Ss=null;const YV=()=>(Ss=Sy(),uV),wa=()=>Ss.close();function JV(n,e){const t={type:"alert",title:n,modalClasses:"w-fit max-w-sm px-6 py-5",buttonTextCancel:"OK",...e||{}};Ss.trigger(t)}function iu(n,e){const t={type:"confirm",title:n,modalClasses:"w-fit max-w-sm px-6 py-5",buttonTextCancel:"Cancel",buttonTextConfirm:"OK",...e||{}};Ss.trigger(t)}let su=!1;function QV(n,e=""){return new Promise((t,i)=>{if(su)return i("Password modal already open");su=!0;const s={type:"prompt",title:n,body:e,modalClasses:"w-fit max-w-sm px-6 py-5",valueAttr:{type:"text",placeholder:"password",required:!0},response:r=>{su=!1,t(r)}};try{Ss.trigger(s)}catch(r){su=!1,i(r)}})}function dV(n,e,t){const i={type:"alert",title:n,body:e,response:s=>{}};return Ss.trigger(i),s=>{Ss.update(r=>{let a=r.indexOf(i);return r[a].body=r[a].body+`
`+s,r})}}const p0=n=>{const e=Array.from(Jm(Ss)).pop();return e&&e.component===n?(wa(),!0):!1},ZV=()=>{p0("LogTimeline")||Ss.trigger({type:"component",component:"LogTimeline"})},jA=()=>{p0("TestDriveTut")||Ss.trigger({type:"component",component:"TestDriveTut"})},hV=()=>{p0("FlyModesTut")||Ss.trigger({type:"component",component:"FlyModesTut"})};export{fs as $,$m as A,gC as B,Sy as C,k0 as D,cp as E,AV as F,bV as G,qV as H,Va as I,hC as J,by as K,vV as L,Fi as M,LP as N,MV as O,ln as P,Dt as Q,eA as R,cn as S,Zt as T,tD as U,Fy as V,li as W,iu as X,JV as Y,id as Z,QV as _,dO as a,Ze as a0,_I as a1,kc as a2,IV as a3,YV as a4,oC as a5,es as a6,fd as a7,Bu as a8,wV as a9,FM as aA,XV as aB,DO as aC,pM as aD,WV as aE,jV as aF,cC as aa,rC as ab,EV as ac,qR as ad,kb as ae,xe as af,S7 as ag,xV as ah,Uy as ai,YR as aj,aC as ak,CV as al,a_ as am,XR as an,Nd as ao,dc as ap,ly as aq,r_ as ar,T4 as as,QE as at,ci as au,N7 as av,ls as aw,Zk as ax,Wk as ay,Ok as az,uO as b,hO as c,HE as d,bO as e,gO as f,_O as g,fO as h,Qn as i,Ti as j,jA as k,Lt as l,vO as m,cO as n,ZV as o,YE as p,XE as q,qE as r,KV as s,$t as t,un as u,Kt as v,WE as w,TV as x,SV as y,yV as z};
//# sourceMappingURL=modals.B10dOQl6.js.map
