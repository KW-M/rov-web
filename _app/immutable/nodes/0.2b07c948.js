var Ie=Object.defineProperty;var Me=(n,e,t)=>e in n?Ie(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ae=(n,e,t)=>(Me(n,typeof e!="symbol"?e+"":e,t),t);import{r as dist,u as noop$3,v as identity,w as run_all,x as setContext,y as getContext,z as get_store_value,A as split_css_unit,s as safe_not_equal,B as create_slot,f as element,a as space,g as claim_element,h as children,c as claim_space,d as detach,j as attr,i as insert_hydration,C as append_hydration,D as update_slot_base,E as get_all_dirty_from_scope,F as get_slot_changes,G as compute_slots,H as assign$1,I as exclude_internal_props,k as set_style,J as listen,K as bubble,l as text,m as claim_text,L as is_function,M as svg_element,N as claim_svg_element,O as toggle_class,b as afterUpdate,e as empty,P as component_subscribe,Q as createEventDispatcher,R as action_destroyer,S as add_render_callback,T as HtmlTagHydration,U as claim_html_tag,V as src_url_equal,q as construct_svelte_component,W as set_attributes,X as set_input_value,n as set_data,p as binding_callbacks,Y as buffer,Z as destroy_each,o as onMount,_ as set_svg_attributes,$ as compute_rest_props,a0 as get_svelte_dataset,a1 as onDestroy,a2 as null_to_empty,a3 as select_option}from"../chunks/scheduler.72229cf3.js";import{n as now,l as loop,f as create_rule,h as delete_rule,t as transition_out,a as transition_in,S as SvelteComponent,i as init,g as group_outros,c as check_outros,j as create_in_transition,k as create_bidirectional_transition,o as create_out_transition,b as create_component,d as claim_component,m as mount_component,e as destroy_component}from"../chunks/index.dabca455.js";import{w as writable,r as readable}from"../chunks/index.2d28d90b.js";var commonjsGlobal$1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs$1(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}const globals=typeof window<"u"?window:typeof globalThis<"u"?globalThis:dist.global;function create_animation(n,e,t,s){if(!e)return noop$3;const a=n.getBoundingClientRect();if(e.left===a.left&&e.right===a.right&&e.top===a.top&&e.bottom===a.bottom)return noop$3;const{delay:c=0,duration:u=300,easing:d=identity,start:m=now()+c,end:_=m+u,tick:b=noop$3,css:S}=t(n,{from:e,to:a},s);let C=!0,w=!1,O;function I(){S&&(O=create_rule(n,0,1,u,c,d,S)),c||(w=!0)}function N(){S&&delete_rule(n,O),C=!1}return loop(P=>{if(!w&&P>=m&&(w=!0),w&&P>=_&&(b(1,0),N()),!C)return!1;if(w){const B=P-m,x=0+1*d(B/u);b(x,1-x)}return!0}),I(),b(0,1),N}function fix_position(n){const e=getComputedStyle(n);if(e.position!=="absolute"&&e.position!=="fixed"){const{width:t,height:s}=e,a=n.getBoundingClientRect();n.style.position="absolute",n.style.width=t,n.style.height=s,add_transform(n,a)}}function add_transform(n,e){const t=n.getBoundingClientRect();if(e.left!==t.left||e.top!==t.top){const s=getComputedStyle(n),a=s.transform==="none"?"":s.transform;n.style.transform=`${a} translate(${e.left-t.left}px, ${e.top-t.top}px)`}}function ensure_array_like(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function outro_and_destroy_block(n,e){transition_out(n,1,1,()=>{e.delete(n.key)})}function fix_and_outro_and_destroy_block(n,e){n.f(),outro_and_destroy_block(n,e)}function update_keyed_each(n,e,t,s,a,c,u,d,m,_,b,S){let C=n.length,w=c.length,O=C;const I={};for(;O--;)I[n[O].key]=O;const N=[],P=new Map,B=new Map,x=[];for(O=w;O--;){const z=S(a,c,O),H=t(z);let W=u.get(H);W?s&&x.push(()=>W.p(z,e)):(W=_(H,z),W.c()),P.set(H,N[O]=W),H in I&&B.set(H,Math.abs(O-I[H]))}const F=new Set,k=new Set;function J(z){transition_in(z,1),z.m(d,b),u.set(z.key,z),b=z.first,w--}for(;C&&w;){const z=N[w-1],H=n[C-1],W=z.key,X=H.key;z===H?(b=z.first,C--,w--):P.has(X)?!u.has(W)||F.has(W)?J(z):k.has(X)?C--:B.get(W)>B.get(X)?(k.add(W),J(z)):(F.add(X),C--):(m(H,u),C--)}for(;C--;){const z=n[C];P.has(z.key)||m(z,u)}for(;w;)J(N[w-1]);return run_all(x),N}function get_spread_update(n,e){const t={},s={},a={$$scope:1};let c=n.length;for(;c--;){const u=n[c],d=e[c];if(d){for(const m in u)m in d||(s[m]=1);for(const m in d)a[m]||(t[m]=d[m],a[m]=1);n[c]=d}else for(const m in u)a[m]=1}for(const u in s)u in t||(t[u]=void 0);return t}function get_spread_object(n){return typeof n=="object"&&n!==null?n:{}}const prerender=!1,ssr=!1,_layout=Object.freeze(Object.defineProperty({__proto__:null,prerender,ssr},Symbol.toStringTag,{value:"Module"})),app="",storePopup=writable(void 0),DRAWER_STORE_KEY="drawerStore";function getDrawerStore(){const n=getContext(DRAWER_STORE_KEY);if(!n)throw new Error("drawerStore is not initialized. Please ensure that `initializeStores()` is invoked in the root layout file of this app!");return n}function initializeDrawerStore(){const n=drawerService();return setContext(DRAWER_STORE_KEY,n)}function drawerService(){const{subscribe:n,set:e,update:t}=writable({});return{subscribe:n,set:e,update:t,open:s=>t(()=>({open:!0,...s})),close:()=>t(s=>(s.open=!1,s))}}const MODAL_STORE_KEY="modalStore";function getModalStore(){const n=getContext(MODAL_STORE_KEY);if(!n)throw new Error("modalStore is not initialized. Please ensure that `initializeStores()` is invoked in the root layout file of this app!");return n}function initializeModalStore(){const n=modalService();return setContext(MODAL_STORE_KEY,n)}function modalService(){const{subscribe:n,set:e,update:t}=writable([]);return{subscribe:n,set:e,update:t,trigger:s=>t(a=>(a.push(s),a)),close:()=>t(s=>(s.length>0&&s.shift(),s)),clear:()=>e([])}}const toastDefaults={message:"Missing Toast Message",autohide:!0,timeout:5e3},TOAST_STORE_KEY="toastStore";function getToastStore(){const n=getContext(TOAST_STORE_KEY);if(!n)throw new Error("toastStore is not initialized. Please ensure that `initializeStores()` is invoked in the root layout file of this app!");return n}function initializeToastStore(){const n=toastService();return setContext(TOAST_STORE_KEY,n)}function randomUUID$1(){const n=Math.random();return Number(n).toString(32)}function toastService(){const{subscribe:n,set:e,update:t}=writable([]),s=c=>t(u=>{if(u.length>0){const d=u.findIndex(_=>_.id===c),m=u[d];m&&(m.callback&&m.callback({id:c,status:"closed"}),m.timeoutId&&clearTimeout(m.timeoutId),u.splice(d,1))}return u});function a(c){if(c.autohide===!0)return setTimeout(()=>{s(c.id)},c.timeout)}return{subscribe:n,close:s,trigger:c=>{const u=randomUUID$1();return t(d=>{c&&c.callback&&c.callback({id:u,status:"queued"}),c.hideDismiss&&(c.autohide=!0);const m={...toastDefaults,...c,id:u};return m.timeoutId=a(m),d.push(m),d}),u},freeze:c=>t(u=>(u.length>0&&clearTimeout(u[c].timeoutId),u)),unfreeze:c=>t(u=>(u.length>0&&(u[c].timeoutId=a(u[c])),u)),clear:()=>e([])}}function initializeStores(){initializeModalStore(),initializeToastStore(),initializeDrawerStore()}const stores={};function getStorage(n){return n==="local"?localStorage:sessionStorage}function localStorageStore(n,e,t){const s=(t==null?void 0:t.serializer)??JSON,a=(t==null?void 0:t.storage)??"local";function c(u,d){getStorage(a).setItem(u,s.stringify(d))}if(!stores[n]){const u=writable(e,_=>{const b=getStorage(a).getItem(n);b&&_(s.parse(b));{const S=C=>{C.key===n&&_(C.newValue?s.parse(C.newValue):null)};return window.addEventListener("storage",S),()=>window.removeEventListener("storage",S)}}),{subscribe:d,set:m}=u;stores[n]={set(_){c(n,_),m(_)},update(_){const b=_(get_store_value(u));c(n,b),m(b)},subscribe:d}}return stores[n]}localStorageStore("modeOsPrefers",!1);localStorageStore("modeUserPrefers",void 0);localStorageStore("modeCurrent",!1);const reducedMotionQuery="(prefers-reduced-motion: reduce)";function prefersReducedMotion(){return window.matchMedia(reducedMotionQuery).matches}const prefersReducedMotionStore=readable(prefersReducedMotion(),n=>{{const e=s=>{n(s.matches)},t=window.matchMedia(reducedMotionQuery);return t.addEventListener("change",e),()=>{t.removeEventListener("change",e)}}});function focusTrap(n,e){const t='a[href]:not([tabindex="-1"]), button:not([tabindex="-1"]), input:not([tabindex="-1"]), textarea:not([tabindex="-1"]), select:not([tabindex="-1"]), details:not([tabindex="-1"]), [tabindex]:not([tabindex="-1"])';let s,a;function c(S){S.shiftKey&&S.code==="Tab"&&(S.preventDefault(),a.focus())}function u(S){!S.shiftKey&&S.code==="Tab"&&(S.preventDefault(),s.focus())}const d=S=>{if(e===!1)return;const C=Array.from(n.querySelectorAll(t));C.length&&(s=C[0],a=C[C.length-1],S||s.focus(),s.addEventListener("keydown",c),a.addEventListener("keydown",u))};d(!1);function m(){s&&s.removeEventListener("keydown",c),a&&a.removeEventListener("keydown",u)}const _=(S,C)=>(S.length&&(m(),d(!0)),C),b=new MutationObserver(_);return b.observe(n,{childList:!0,subtree:!0}),{update(S){e=S,S?d(!1):m()},destroy(){m(),b.disconnect()}}}function cubicIn(n){return n*n*n}function cubicOut(n){const e=n-1;return e*e*e+1}function fade(n,{delay:e=0,duration:t=400,easing:s=identity}={}){const a=+getComputedStyle(n).opacity;return{delay:e,duration:t,easing:s,css:c=>`opacity: ${c*a}`}}function fly(n,{delay:e=0,duration:t=400,easing:s=cubicOut,x:a=0,y:c=0,opacity:u=0}={}){const d=getComputedStyle(n),m=+d.opacity,_=d.transform==="none"?"":d.transform,b=m*(1-u),[S,C]=split_css_unit(a),[w,O]=split_css_unit(c);return{delay:e,duration:t,easing:s,css:(I,N)=>`
			transform: ${_} translate(${(1-I)*S}${C}, ${(1-I)*w}${O});
			opacity: ${m-b*N}`}}function scale(n,{delay:e=0,duration:t=400,easing:s=cubicOut,start:a=0,opacity:c=0}={}){const u=getComputedStyle(n),d=+u.opacity,m=u.transform==="none"?"":u.transform,_=1-a,b=d*(1-c);return{delay:e,duration:t,easing:s,css:(S,C)=>`
			transform: ${m} scale(${1-_*C});
			opacity: ${d-b*C}
		`}}function dynamicTransition(n,e){const{transition:t,params:s,enabled:a}=e;return a?t(n,s):"duration"in s?t(n,{duration:0}):{duration:0}}const get_headline_slot_changes=n=>({}),get_headline_slot_context=n=>({}),get_trail_slot_changes=n=>({}),get_trail_slot_context=n=>({}),get_lead_slot_changes=n=>({}),get_lead_slot_context=n=>({});function create_if_block_2$5(n){let e,t,s;const a=n[22].lead,c=create_slot(a,n,n[21],get_lead_slot_context);return{c(){e=element("div"),c&&c.c(),this.h()},l(u){e=claim_element(u,"DIV",{class:!0});var d=children(e);c&&c.l(d),d.forEach(detach),this.h()},h(){attr(e,"class",t="app-bar-slot-lead "+n[4])},m(u,d){insert_hydration(u,e,d),c&&c.m(e,null),s=!0},p(u,d){c&&c.p&&(!s||d&2097152)&&update_slot_base(c,a,u,u[21],s?get_slot_changes(a,u[21],d,get_lead_slot_changes):get_all_dirty_from_scope(u[21]),get_lead_slot_context),(!s||d&16&&t!==(t="app-bar-slot-lead "+u[4]))&&attr(e,"class",t)},i(u){s||(transition_in(c,u),s=!0)},o(u){transition_out(c,u),s=!1},d(u){u&&detach(e),c&&c.d(u)}}}function create_if_block_1$7(n){let e,t,s;const a=n[22].trail,c=create_slot(a,n,n[21],get_trail_slot_context);return{c(){e=element("div"),c&&c.c(),this.h()},l(u){e=claim_element(u,"DIV",{class:!0});var d=children(e);c&&c.l(d),d.forEach(detach),this.h()},h(){attr(e,"class",t="app-bar-slot-trail "+n[2])},m(u,d){insert_hydration(u,e,d),c&&c.m(e,null),s=!0},p(u,d){c&&c.p&&(!s||d&2097152)&&update_slot_base(c,a,u,u[21],s?get_slot_changes(a,u[21],d,get_trail_slot_changes):get_all_dirty_from_scope(u[21]),get_trail_slot_context),(!s||d&4&&t!==(t="app-bar-slot-trail "+u[2]))&&attr(e,"class",t)},i(u){s||(transition_in(c,u),s=!0)},o(u){transition_out(c,u),s=!1},d(u){u&&detach(e),c&&c.d(u)}}}function create_if_block$b(n){let e,t,s;const a=n[22].headline,c=create_slot(a,n,n[21],get_headline_slot_context);return{c(){e=element("div"),c&&c.c(),this.h()},l(u){e=claim_element(u,"DIV",{class:!0});var d=children(e);c&&c.l(d),d.forEach(detach),this.h()},h(){attr(e,"class",t="app-bar-row-headline "+n[5])},m(u,d){insert_hydration(u,e,d),c&&c.m(e,null),s=!0},p(u,d){c&&c.p&&(!s||d&2097152)&&update_slot_base(c,a,u,u[21],s?get_slot_changes(a,u[21],d,get_headline_slot_changes):get_all_dirty_from_scope(u[21]),get_headline_slot_context),(!s||d&32&&t!==(t="app-bar-row-headline "+u[5]))&&attr(e,"class",t)},i(u){s||(transition_in(c,u),s=!0)},o(u){transition_out(c,u),s=!1},d(u){u&&detach(e),c&&c.d(u)}}}function create_fragment$y(n){let e,t,s,a,c,u,d,m,_,b,S=n[8].lead&&create_if_block_2$5(n);const C=n[22].default,w=create_slot(C,n,n[21],null);let O=n[8].trail&&create_if_block_1$7(n),I=n[8].headline&&create_if_block$b(n);return{c(){e=element("div"),t=element("div"),S&&S.c(),s=space(),a=element("div"),w&&w.c(),u=space(),O&&O.c(),m=space(),I&&I.c(),this.h()},l(N){e=claim_element(N,"DIV",{class:!0,"data-testid":!0,role:!0,"aria-label":!0,"aria-labelledby":!0});var P=children(e);t=claim_element(P,"DIV",{class:!0});var B=children(t);S&&S.l(B),s=claim_space(B),a=claim_element(B,"DIV",{class:!0});var x=children(a);w&&w.l(x),x.forEach(detach),u=claim_space(B),O&&O.l(B),B.forEach(detach),m=claim_space(P),I&&I.l(P),P.forEach(detach),this.h()},h(){attr(a,"class",c="app-bar-slot-default "+n[3]),attr(t,"class",d="app-bar-row-main "+n[6]),attr(e,"class",_="app-bar "+n[7]),attr(e,"data-testid","app-bar"),attr(e,"role","toolbar"),attr(e,"aria-label",n[0]),attr(e,"aria-labelledby",n[1])},m(N,P){insert_hydration(N,e,P),append_hydration(e,t),S&&S.m(t,null),append_hydration(t,s),append_hydration(t,a),w&&w.m(a,null),append_hydration(t,u),O&&O.m(t,null),append_hydration(e,m),I&&I.m(e,null),b=!0},p(N,[P]){N[8].lead?S?(S.p(N,P),P&256&&transition_in(S,1)):(S=create_if_block_2$5(N),S.c(),transition_in(S,1),S.m(t,s)):S&&(group_outros(),transition_out(S,1,1,()=>{S=null}),check_outros()),w&&w.p&&(!b||P&2097152)&&update_slot_base(w,C,N,N[21],b?get_slot_changes(C,N[21],P,null):get_all_dirty_from_scope(N[21]),null),(!b||P&8&&c!==(c="app-bar-slot-default "+N[3]))&&attr(a,"class",c),N[8].trail?O?(O.p(N,P),P&256&&transition_in(O,1)):(O=create_if_block_1$7(N),O.c(),transition_in(O,1),O.m(t,null)):O&&(group_outros(),transition_out(O,1,1,()=>{O=null}),check_outros()),(!b||P&64&&d!==(d="app-bar-row-main "+N[6]))&&attr(t,"class",d),N[8].headline?I?(I.p(N,P),P&256&&transition_in(I,1)):(I=create_if_block$b(N),I.c(),transition_in(I,1),I.m(e,null)):I&&(group_outros(),transition_out(I,1,1,()=>{I=null}),check_outros()),(!b||P&128&&_!==(_="app-bar "+N[7]))&&attr(e,"class",_),(!b||P&1)&&attr(e,"aria-label",N[0]),(!b||P&2)&&attr(e,"aria-labelledby",N[1])},i(N){b||(transition_in(S),transition_in(w,N),transition_in(O),transition_in(I),b=!0)},o(N){transition_out(S),transition_out(w,N),transition_out(O),transition_out(I),b=!1},d(N){N&&detach(e),S&&S.d(),w&&w.d(N),O&&O.d(),I&&I.d()}}}const cBase$1="flex flex-col",cRowMain="grid items-center",cRowHeadline="",cSlotLead="flex-none flex justify-between items-center",cSlotDefault="flex-auto",cSlotTrail="flex-none flex items-center space-x-4";function instance$y(n,e,t){let s,a,c,u,d,m,{$$slots:_={},$$scope:b}=e;const S=compute_slots(_);let{background:C="bg-surface-100-800-token"}=e,{border:w=""}=e,{padding:O="p-4"}=e,{shadow:I=""}=e,{spacing:N="space-y-4"}=e,{gridColumns:P="grid-cols-[auto_1fr_auto]"}=e,{gap:B="gap-4"}=e,{regionRowMain:x=""}=e,{regionRowHeadline:F=""}=e,{slotLead:k=""}=e,{slotDefault:J=""}=e,{slotTrail:z=""}=e,{label:H=""}=e,{labelledby:W=""}=e;return n.$$set=X=>{t(23,e=assign$1(assign$1({},e),exclude_internal_props(X))),"background"in X&&t(9,C=X.background),"border"in X&&t(10,w=X.border),"padding"in X&&t(11,O=X.padding),"shadow"in X&&t(12,I=X.shadow),"spacing"in X&&t(13,N=X.spacing),"gridColumns"in X&&t(14,P=X.gridColumns),"gap"in X&&t(15,B=X.gap),"regionRowMain"in X&&t(16,x=X.regionRowMain),"regionRowHeadline"in X&&t(17,F=X.regionRowHeadline),"slotLead"in X&&t(18,k=X.slotLead),"slotDefault"in X&&t(19,J=X.slotDefault),"slotTrail"in X&&t(20,z=X.slotTrail),"label"in X&&t(0,H=X.label),"labelledby"in X&&t(1,W=X.labelledby),"$$scope"in X&&t(21,b=X.$$scope)},n.$$.update=()=>{t(7,s=`${cBase$1} ${C} ${w} ${N} ${O} ${I} ${e.class??""}`),n.$$.dirty&114688&&t(6,a=`${cRowMain} ${P} ${B} ${x}`),n.$$.dirty&131072&&t(5,c=`${cRowHeadline} ${F}`),n.$$.dirty&262144&&t(4,u=`${cSlotLead} ${k}`),n.$$.dirty&524288&&t(3,d=`${cSlotDefault} ${J}`),n.$$.dirty&1048576&&t(2,m=`${cSlotTrail} ${z}`)},e=exclude_internal_props(e),[H,W,m,d,u,c,a,s,S,C,w,O,I,N,P,B,x,F,k,J,z,b,_]}class AppBar extends SvelteComponent{constructor(e){super(),init(this,e,instance$y,create_fragment$y,safe_not_equal,{background:9,border:10,padding:11,shadow:12,spacing:13,gridColumns:14,gap:15,regionRowMain:16,regionRowHeadline:17,slotLead:18,slotDefault:19,slotTrail:20,label:0,labelledby:1})}}const get_footer_slot_changes=n=>({}),get_footer_slot_context=n=>({}),get_sidebarRight_slot_changes=n=>({}),get_sidebarRight_slot_context=n=>({}),get_pageFooter_slot_changes=n=>({}),get_pageFooter_slot_context=n=>({}),get_pageHeader_slot_changes=n=>({}),get_pageHeader_slot_context=n=>({}),get_sidebarLeft_slot_changes=n=>({}),get_sidebarLeft_slot_context=n=>({}),get_header_slot_changes=n=>({}),get_header_slot_context=n=>({});function create_if_block_5$1(n){let e,t,s;const a=n[19].header,c=create_slot(a,n,n[18],get_header_slot_context);return{c(){e=element("header"),c&&c.c(),this.h()},l(u){e=claim_element(u,"HEADER",{id:!0,class:!0});var d=children(e);c&&c.l(d),d.forEach(detach),this.h()},h(){attr(e,"id","shell-header"),attr(e,"class",t="flex-none "+n[8])},m(u,d){insert_hydration(u,e,d),c&&c.m(e,null),s=!0},p(u,d){c&&c.p&&(!s||d&262144)&&update_slot_base(c,a,u,u[18],s?get_slot_changes(a,u[18],d,get_header_slot_changes):get_all_dirty_from_scope(u[18]),get_header_slot_context),(!s||d&256&&t!==(t="flex-none "+u[8]))&&attr(e,"class",t)},i(u){s||(transition_in(c,u),s=!0)},o(u){transition_out(c,u),s=!1},d(u){u&&detach(e),c&&c.d(u)}}}function create_if_block_4$2(n){let e,t;const s=n[19].sidebarLeft,a=create_slot(s,n,n[18],get_sidebarLeft_slot_context);return{c(){e=element("aside"),a&&a.c(),this.h()},l(c){e=claim_element(c,"ASIDE",{id:!0,class:!0});var u=children(e);a&&a.l(u),u.forEach(detach),this.h()},h(){attr(e,"id","sidebar-left"),attr(e,"class",n[7])},m(c,u){insert_hydration(c,e,u),a&&a.m(e,null),t=!0},p(c,u){a&&a.p&&(!t||u&262144)&&update_slot_base(a,s,c,c[18],t?get_slot_changes(s,c[18],u,get_sidebarLeft_slot_changes):get_all_dirty_from_scope(c[18]),get_sidebarLeft_slot_context),(!t||u&128)&&attr(e,"class",c[7])},i(c){t||(transition_in(a,c),t=!0)},o(c){transition_out(a,c),t=!1},d(c){c&&detach(e),a&&a.d(c)}}}function create_if_block_3$3(n){let e,t,s;const a=n[19].pageHeader,c=create_slot(a,n,n[18],get_pageHeader_slot_context),u=c||fallback_block_1();return{c(){e=element("header"),u&&u.c(),this.h()},l(d){e=claim_element(d,"HEADER",{id:!0,class:!0});var m=children(e);u&&u.l(m),m.forEach(detach),this.h()},h(){attr(e,"id","page-header"),attr(e,"class",t="flex-none "+n[5])},m(d,m){insert_hydration(d,e,m),u&&u.m(e,null),s=!0},p(d,m){c&&c.p&&(!s||m&262144)&&update_slot_base(c,a,d,d[18],s?get_slot_changes(a,d[18],m,get_pageHeader_slot_changes):get_all_dirty_from_scope(d[18]),get_pageHeader_slot_context),(!s||m&32&&t!==(t="flex-none "+d[5]))&&attr(e,"class",t)},i(d){s||(transition_in(u,d),s=!0)},o(d){transition_out(u,d),s=!1},d(d){d&&detach(e),u&&u.d(d)}}}function fallback_block_1(n){let e;return{c(){e=text("(slot:header)")},l(t){e=claim_text(t,"(slot:header)")},m(t,s){insert_hydration(t,e,s)},d(t){t&&detach(e)}}}function create_if_block_2$4(n){let e,t,s;const a=n[19].pageFooter,c=create_slot(a,n,n[18],get_pageFooter_slot_context),u=c||fallback_block();return{c(){e=element("footer"),u&&u.c(),this.h()},l(d){e=claim_element(d,"FOOTER",{id:!0,class:!0});var m=children(e);u&&u.l(m),m.forEach(detach),this.h()},h(){attr(e,"id","page-footer"),attr(e,"class",t="flex-none "+n[3])},m(d,m){insert_hydration(d,e,m),u&&u.m(e,null),s=!0},p(d,m){c&&c.p&&(!s||m&262144)&&update_slot_base(c,a,d,d[18],s?get_slot_changes(a,d[18],m,get_pageFooter_slot_changes):get_all_dirty_from_scope(d[18]),get_pageFooter_slot_context),(!s||m&8&&t!==(t="flex-none "+d[3]))&&attr(e,"class",t)},i(d){s||(transition_in(u,d),s=!0)},o(d){transition_out(u,d),s=!1},d(d){d&&detach(e),u&&u.d(d)}}}function fallback_block(n){let e;return{c(){e=text("(slot:footer)")},l(t){e=claim_text(t,"(slot:footer)")},m(t,s){insert_hydration(t,e,s)},d(t){t&&detach(e)}}}function create_if_block_1$6(n){let e,t;const s=n[19].sidebarRight,a=create_slot(s,n,n[18],get_sidebarRight_slot_context);return{c(){e=element("aside"),a&&a.c(),this.h()},l(c){e=claim_element(c,"ASIDE",{id:!0,class:!0});var u=children(e);a&&a.l(u),u.forEach(detach),this.h()},h(){attr(e,"id","sidebar-right"),attr(e,"class",n[6])},m(c,u){insert_hydration(c,e,u),a&&a.m(e,null),t=!0},p(c,u){a&&a.p&&(!t||u&262144)&&update_slot_base(a,s,c,c[18],t?get_slot_changes(s,c[18],u,get_sidebarRight_slot_changes):get_all_dirty_from_scope(c[18]),get_sidebarRight_slot_context),(!t||u&64)&&attr(e,"class",c[6])},i(c){t||(transition_in(a,c),t=!0)},o(c){transition_out(a,c),t=!1},d(c){c&&detach(e),a&&a.d(c)}}}function create_if_block$a(n){let e,t,s;const a=n[19].footer,c=create_slot(a,n,n[18],get_footer_slot_context);return{c(){e=element("footer"),c&&c.c(),this.h()},l(u){e=claim_element(u,"FOOTER",{id:!0,class:!0});var d=children(e);c&&c.l(d),d.forEach(detach),this.h()},h(){attr(e,"id","shell-footer"),attr(e,"class",t="flex-none "+n[2])},m(u,d){insert_hydration(u,e,d),c&&c.m(e,null),s=!0},p(u,d){c&&c.p&&(!s||d&262144)&&update_slot_base(c,a,u,u[18],s?get_slot_changes(a,u[18],d,get_footer_slot_changes):get_all_dirty_from_scope(u[18]),get_footer_slot_context),(!s||d&4&&t!==(t="flex-none "+u[2]))&&attr(e,"class",t)},i(u){s||(transition_in(c,u),s=!0)},o(u){transition_out(c,u),s=!1},d(u){u&&detach(e),c&&c.d(u)}}}function create_fragment$x(n){let e,t,s,a,c,u,d,m,_,b,S,C,w,O,I,N=n[10].header&&create_if_block_5$1(n),P=n[10].sidebarLeft&&create_if_block_4$2(n),B=n[10].pageHeader&&create_if_block_3$3(n);const x=n[19].default,F=create_slot(x,n,n[18],null);let k=n[10].pageFooter&&create_if_block_2$4(n),J=n[10].sidebarRight&&create_if_block_1$6(n),z=n[10].footer&&create_if_block$a(n);return{c(){e=element("div"),N&&N.c(),t=space(),s=element("div"),P&&P.c(),a=space(),c=element("div"),B&&B.c(),u=space(),d=element("main"),F&&F.c(),_=space(),k&&k.c(),S=space(),J&&J.c(),C=space(),z&&z.c(),this.h()},l(H){e=claim_element(H,"DIV",{id:!0,class:!0,"data-testid":!0});var W=children(e);N&&N.l(W),t=claim_space(W),s=claim_element(W,"DIV",{class:!0});var X=children(s);P&&P.l(X),a=claim_space(X),c=claim_element(X,"DIV",{id:!0,class:!0});var se=children(c);B&&B.l(se),u=claim_space(se),d=claim_element(se,"MAIN",{id:!0,class:!0});var re=children(d);F&&F.l(re),re.forEach(detach),_=claim_space(se),k&&k.l(se),se.forEach(detach),S=claim_space(X),J&&J.l(X),X.forEach(detach),C=claim_space(W),z&&z.l(W),W.forEach(detach),this.h()},h(){attr(d,"id","page-content"),attr(d,"class",m="flex-auto "+n[4]),attr(c,"id","page"),attr(c,"class",b=n[1]+" "+cPage),set_style(c,"scrollbar-gutter",n[0]),attr(s,"class","flex-auto "+cContentArea),attr(e,"id","appShell"),attr(e,"class",n[9]),attr(e,"data-testid","app-shell")},m(H,W){insert_hydration(H,e,W),N&&N.m(e,null),append_hydration(e,t),append_hydration(e,s),P&&P.m(s,null),append_hydration(s,a),append_hydration(s,c),B&&B.m(c,null),append_hydration(c,u),append_hydration(c,d),F&&F.m(d,null),append_hydration(c,_),k&&k.m(c,null),append_hydration(s,S),J&&J.m(s,null),append_hydration(e,C),z&&z.m(e,null),w=!0,O||(I=listen(c,"scroll",n[20]),O=!0)},p(H,[W]){H[10].header?N?(N.p(H,W),W&1024&&transition_in(N,1)):(N=create_if_block_5$1(H),N.c(),transition_in(N,1),N.m(e,t)):N&&(group_outros(),transition_out(N,1,1,()=>{N=null}),check_outros()),H[10].sidebarLeft?P?(P.p(H,W),W&1024&&transition_in(P,1)):(P=create_if_block_4$2(H),P.c(),transition_in(P,1),P.m(s,a)):P&&(group_outros(),transition_out(P,1,1,()=>{P=null}),check_outros()),H[10].pageHeader?B?(B.p(H,W),W&1024&&transition_in(B,1)):(B=create_if_block_3$3(H),B.c(),transition_in(B,1),B.m(c,u)):B&&(group_outros(),transition_out(B,1,1,()=>{B=null}),check_outros()),F&&F.p&&(!w||W&262144)&&update_slot_base(F,x,H,H[18],w?get_slot_changes(x,H[18],W,null):get_all_dirty_from_scope(H[18]),null),(!w||W&16&&m!==(m="flex-auto "+H[4]))&&attr(d,"class",m),H[10].pageFooter?k?(k.p(H,W),W&1024&&transition_in(k,1)):(k=create_if_block_2$4(H),k.c(),transition_in(k,1),k.m(c,null)):k&&(group_outros(),transition_out(k,1,1,()=>{k=null}),check_outros()),(!w||W&2&&b!==(b=H[1]+" "+cPage))&&attr(c,"class",b),W&1&&set_style(c,"scrollbar-gutter",H[0]),H[10].sidebarRight?J?(J.p(H,W),W&1024&&transition_in(J,1)):(J=create_if_block_1$6(H),J.c(),transition_in(J,1),J.m(s,null)):J&&(group_outros(),transition_out(J,1,1,()=>{J=null}),check_outros()),H[10].footer?z?(z.p(H,W),W&1024&&transition_in(z,1)):(z=create_if_block$a(H),z.c(),transition_in(z,1),z.m(e,null)):z&&(group_outros(),transition_out(z,1,1,()=>{z=null}),check_outros()),(!w||W&512)&&attr(e,"class",H[9])},i(H){w||(transition_in(N),transition_in(P),transition_in(B),transition_in(F,H),transition_in(k),transition_in(J),transition_in(z),w=!0)},o(H){transition_out(N),transition_out(P),transition_out(B),transition_out(F,H),transition_out(k),transition_out(J),transition_out(z),w=!1},d(H){H&&detach(e),N&&N.d(),P&&P.d(),B&&B.d(),F&&F.d(H),k&&k.d(),J&&J.d(),z&&z.d(),O=!1,I()}}}const cBaseAppShell="w-full h-full flex flex-col overflow-hidden",cContentArea="w-full h-full flex overflow-hidden",cPage="flex-1 overflow-x-hidden flex flex-col",cSidebarLeft="flex-none overflow-x-hidden overflow-y-auto",cSidebarRight="flex-none overflow-x-hidden overflow-y-auto";function instance$x(n,e,t){let s,a,c,u,d,m,_,b,{$$slots:S={},$$scope:C}=e;const w=compute_slots(S);let{scrollbarGutter:O="auto"}=e,{regionPage:I=""}=e,{slotHeader:N="z-10"}=e,{slotSidebarLeft:P="w-auto"}=e,{slotSidebarRight:B="w-auto"}=e,{slotPageHeader:x=""}=e,{slotPageContent:F=""}=e,{slotPageFooter:k=""}=e,{slotFooter:J=""}=e;function z(H){bubble.call(this,n,H)}return n.$$set=H=>{t(21,e=assign$1(assign$1({},e),exclude_internal_props(H))),"scrollbarGutter"in H&&t(0,O=H.scrollbarGutter),"regionPage"in H&&t(1,I=H.regionPage),"slotHeader"in H&&t(11,N=H.slotHeader),"slotSidebarLeft"in H&&t(12,P=H.slotSidebarLeft),"slotSidebarRight"in H&&t(13,B=H.slotSidebarRight),"slotPageHeader"in H&&t(14,x=H.slotPageHeader),"slotPageContent"in H&&t(15,F=H.slotPageContent),"slotPageFooter"in H&&t(16,k=H.slotPageFooter),"slotFooter"in H&&t(17,J=H.slotFooter),"$$scope"in H&&t(18,C=H.$$scope)},n.$$.update=()=>{t(9,s=`${cBaseAppShell} ${e.class??""}`),n.$$.dirty&2048&&t(8,a=`${N}`),n.$$.dirty&4096&&t(7,c=`${cSidebarLeft} ${P}`),n.$$.dirty&8192&&t(6,u=`${cSidebarRight} ${B}`),n.$$.dirty&16384&&t(5,d=`${x}`),n.$$.dirty&32768&&t(4,m=`${F}`),n.$$.dirty&65536&&t(3,_=`${k}`),n.$$.dirty&131072&&t(2,b=`${J}`)},e=exclude_internal_props(e),[O,I,b,_,m,d,u,c,a,s,w,N,P,B,x,F,k,J,C,S,z]}class AppShell extends SvelteComponent{constructor(e){super(),init(this,e,instance$x,create_fragment$x,safe_not_equal,{scrollbarGutter:0,regionPage:1,slotHeader:11,slotSidebarLeft:12,slotSidebarRight:13,slotPageHeader:14,slotPageContent:15,slotPageFooter:16,slotFooter:17})}}function flip$1(n,{from:e,to:t},s={}){const a=getComputedStyle(n),c=a.transform==="none"?"":a.transform,[u,d]=a.transformOrigin.split(" ").map(parseFloat),m=e.left+e.width*u/t.width-(t.left+u),_=e.top+e.height*d/t.height-(t.top+d),{delay:b=0,duration:S=w=>Math.sqrt(w)*120,easing:C=cubicOut}=s;return{delay:b,duration:is_function(S)?S(Math.sqrt(m*m+_*_)):S,easing:C,css:(w,O)=>{const I=O*m,N=O*_,P=w+O*e.width/t.width,B=w+O*e.height/t.height;return`transform: ${c} translate(${I}px, ${N}px) scale(${P}, ${B});`}}}const ProgressBar_svelte_svelte_type_style_lang="";function create_if_block$9(n){let e,t,s;const a=n[16].default,c=create_slot(a,n,n[15],null);return{c(){e=svg_element("text"),c&&c.c(),this.h()},l(u){e=claim_svg_element(u,"text",{x:!0,y:!0,"text-anchor":!0,"dominant-baseline":!0,"font-weight":!0,"font-size":!0,class:!0});var d=children(e);c&&c.l(d),d.forEach(detach),this.h()},h(){attr(e,"x","50%"),attr(e,"y","50%"),attr(e,"text-anchor","middle"),attr(e,"dominant-baseline","middle"),attr(e,"font-weight","bold"),attr(e,"font-size",n[2]),attr(e,"class",t="progress-radial-text "+n[7])},m(u,d){insert_hydration(u,e,d),c&&c.m(e,null),s=!0},p(u,d){c&&c.p&&(!s||d&32768)&&update_slot_base(c,a,u,u[15],s?get_slot_changes(a,u[15],d,null):get_all_dirty_from_scope(u[15]),null),(!s||d&4)&&attr(e,"font-size",u[2]),(!s||d&128&&t!==(t="progress-radial-text "+u[7]))&&attr(e,"class",t)},i(u){s||(transition_in(c,u),s=!0)},o(u){transition_out(c,u),s=!1},d(u){u&&detach(e),c&&c.d(u)}}}function create_fragment$w(n){let e,t,s,a,c,u,d=`${n[9]}
			${n[9]}`,m,_,b,S,C=n[0]!=null&&n[0]>=0&&n[13].default&&create_if_block$9(n);return{c(){e=element("figure"),t=svg_element("svg"),s=svg_element("circle"),c=svg_element("circle"),C&&C.c(),this.h()},l(w){e=claim_element(w,"FIGURE",{class:!0,"data-testid":!0,role:!0,"aria-labelledby":!0,"aria-valuenow":!0,"aria-valuetext":!0,"aria-valuemin":!0,"aria-valuemax":!0});var O=children(e);t=claim_svg_element(O,"svg",{viewBox:!0,class:!0});var I=children(t);s=claim_svg_element(I,"circle",{class:!0,"stroke-width":!0,r:!0,cx:!0,cy:!0}),children(s).forEach(detach),c=claim_svg_element(I,"circle",{class:!0,"stroke-width":!0,r:!0,cx:!0,cy:!0,"stroke-linecap":!0}),children(c).forEach(detach),C&&C.l(I),I.forEach(detach),O.forEach(detach),this.h()},h(){attr(s,"class",a="progress-radial-track "+cBaseTrack+" "+n[6]),attr(s,"stroke-width",n[1]),attr(s,"r",n[12]),attr(s,"cx","50%"),attr(s,"cy","50%"),attr(c,"class",u="progress-radial-meter "+cBaseMeter+" "+n[5]+" "+n[4]),attr(c,"stroke-width",n[1]),attr(c,"r",n[12]),attr(c,"cx","50%"),attr(c,"cy","50%"),attr(c,"stroke-linecap",n[3]),set_style(c,"stroke-dasharray",d),set_style(c,"stroke-dashoffset",n[10]),attr(t,"viewBox","0 0 "+baseSize+" "+baseSize),attr(t,"class","rounded-full"),toggle_class(t,"animate-spin",n[0]===void 0),attr(e,"class",m="progress-radial "+n[11]),attr(e,"data-testid","progress-radial"),attr(e,"role","meter"),attr(e,"aria-labelledby",n[8]),attr(e,"aria-valuenow",_=n[0]||0),attr(e,"aria-valuetext",b=n[0]?`${n[0]}%`:"Indeterminate Spinner"),attr(e,"aria-valuemin",0),attr(e,"aria-valuemax",100)},m(w,O){insert_hydration(w,e,O),append_hydration(e,t),append_hydration(t,s),append_hydration(t,c),C&&C.m(t,null),S=!0},p(w,[O]){(!S||O&64&&a!==(a="progress-radial-track "+cBaseTrack+" "+w[6]))&&attr(s,"class",a),(!S||O&2)&&attr(s,"stroke-width",w[1]),(!S||O&48&&u!==(u="progress-radial-meter "+cBaseMeter+" "+w[5]+" "+w[4]))&&attr(c,"class",u),(!S||O&2)&&attr(c,"stroke-width",w[1]),(!S||O&8)&&attr(c,"stroke-linecap",w[3]),O&512&&d!==(d=`${w[9]}
			${w[9]}`)&&set_style(c,"stroke-dasharray",d),O&1024&&set_style(c,"stroke-dashoffset",w[10]),w[0]!=null&&w[0]>=0&&w[13].default?C?(C.p(w,O),O&8193&&transition_in(C,1)):(C=create_if_block$9(w),C.c(),transition_in(C,1),C.m(t,null)):C&&(group_outros(),transition_out(C,1,1,()=>{C=null}),check_outros()),(!S||O&1)&&toggle_class(t,"animate-spin",w[0]===void 0),(!S||O&2048&&m!==(m="progress-radial "+w[11]))&&attr(e,"class",m),(!S||O&256)&&attr(e,"aria-labelledby",w[8]),(!S||O&1&&_!==(_=w[0]||0))&&attr(e,"aria-valuenow",_),(!S||O&1&&b!==(b=w[0]?`${w[0]}%`:"Indeterminate Spinner"))&&attr(e,"aria-valuetext",b)},i(w){S||(transition_in(C),S=!0)},o(w){transition_out(C),S=!1},d(w){w&&detach(e),C&&C.d()}}}const cBase="progress-radial relative overflow-hidden",cBaseTrack="fill-transparent",cBaseMeter="fill-transparent -rotate-90 origin-[50%_50%]",baseSize=512;function instance$w(n,e,t){let s,{$$slots:a={},$$scope:c}=e;const u=compute_slots(a);let{value:d=void 0}=e,{stroke:m=40}=e,{font:_=56}=e,{strokeLinecap:b="butt"}=e,{transition:S="transition-[stroke-dashoffset]"}=e,{width:C="w-36"}=e,{meter:w="stroke-surface-900 dark:stroke-surface-50"}=e,{track:O="stroke-surface-500/30"}=e,{fill:I="fill-token"}=e,{labelledby:N=""}=e;const P=baseSize/2-m/2;let B=P,x;function F(k){t(9,B=P*2*Math.PI),t(10,x=B-k/100*B)}return F(0),afterUpdate(()=>{F(d===void 0?25:d)}),n.$$set=k=>{t(18,e=assign$1(assign$1({},e),exclude_internal_props(k))),"value"in k&&t(0,d=k.value),"stroke"in k&&t(1,m=k.stroke),"font"in k&&t(2,_=k.font),"strokeLinecap"in k&&t(3,b=k.strokeLinecap),"transition"in k&&t(4,S=k.transition),"width"in k&&t(14,C=k.width),"meter"in k&&t(5,w=k.meter),"track"in k&&t(6,O=k.track),"fill"in k&&t(7,I=k.fill),"labelledby"in k&&t(8,N=k.labelledby),"$$scope"in k&&t(15,c=k.$$scope)},n.$$.update=()=>{t(11,s=`${cBase} ${C} ${e.class??""}`)},e=exclude_internal_props(e),[d,m,_,b,S,w,O,I,N,B,x,s,P,u,C,c,a]}class ProgressRadial extends SvelteComponent{constructor(e){super(),init(this,e,instance$w,create_fragment$w,safe_not_equal,{value:0,stroke:1,font:2,strokeLinecap:3,transition:4,width:14,meter:5,track:6,fill:7,labelledby:8})}}function create_if_block$8(n){let e=n[13],t,s,a=create_key_block(n);return{c(){a.c(),t=empty()},l(c){a.l(c),t=empty()},m(c,u){a.m(c,u),insert_hydration(c,t,u),s=!0},p(c,u){u[0]&8192&&safe_not_equal(e,e=c[13])?(group_outros(),transition_out(a,1,1,noop$3),check_outros(),a=create_key_block(c),a.c(),transition_in(a,1),a.m(t.parentNode,t)):a.p(c,u)},i(c){s||(transition_in(a),s=!0)},o(c){transition_out(a),s=!1},d(c){c&&detach(t),a.d(c)}}}function create_else_block$5(n){let e,t,s,a,c,u;const d=[create_if_block_8,create_else_block_1$1],m=[];function _(b,S){var C;return(C=b[15])!=null&&C.slot?0:1}return t=_(n),s=m[t]=d[t](n),{c(){e=element("div"),s.c(),this.h()},l(b){e=claim_element(b,"DIV",{class:!0,"data-testid":!0,role:!0,"aria-modal":!0,"aria-label":!0});var S=children(e);s.l(S),S.forEach(detach),this.h()},h(){var b;attr(e,"class",a="modal contents "+(((b=n[13][0])==null?void 0:b.modalClasses)??"")),attr(e,"data-testid","modal-component"),attr(e,"role","dialog"),attr(e,"aria-modal","true"),attr(e,"aria-label",c=n[13][0].title??"")},m(b,S){insert_hydration(b,e,S),m[t].m(e,null),u=!0},p(b,S){var w;let C=t;t=_(b),t===C?m[t].p(b,S):(group_outros(),transition_out(m[C],1,1,()=>{m[C]=null}),check_outros(),s=m[t],s?s.p(b,S):(s=m[t]=d[t](b),s.c()),transition_in(s,1),s.m(e,null)),(!u||S[0]&8192&&a!==(a="modal contents "+(((w=b[13][0])==null?void 0:w.modalClasses)??"")))&&attr(e,"class",a),(!u||S[0]&8192&&c!==(c=b[13][0].title??""))&&attr(e,"aria-label",c)},i(b){u||(transition_in(s),u=!0)},o(b){transition_out(s),u=!1},d(b){b&&detach(e),m[t].d()}}}function create_if_block_1$5(n){var w,O,I,N;let e,t,s,a,c,u,d=((w=n[13][0])==null?void 0:w.title)&&create_if_block_7(n),m=((O=n[13][0])==null?void 0:O.body)&&create_if_block_6(n),_=((I=n[13][0])==null?void 0:I.image)&&typeof((N=n[13][0])==null?void 0:N.image)=="string"&&create_if_block_5(n);function b(P,B){if(P[13][0].type==="alert")return create_if_block_2$3;if(P[13][0].type==="confirm")return create_if_block_3$2;if(P[13][0].type==="prompt")return create_if_block_4$1}let S=b(n),C=S&&S(n);return{c(){e=element("div"),d&&d.c(),t=space(),m&&m.c(),s=space(),_&&_.c(),a=space(),C&&C.c(),this.h()},l(P){e=claim_element(P,"DIV",{class:!0,"data-testid":!0,role:!0,"aria-modal":!0,"aria-label":!0});var B=children(e);d&&d.l(B),t=claim_space(B),m&&m.l(B),s=claim_space(B),_&&_.l(B),a=claim_space(B),C&&C.l(B),B.forEach(detach),this.h()},h(){attr(e,"class",c="modal "+n[17]),attr(e,"data-testid","modal"),attr(e,"role","dialog"),attr(e,"aria-modal","true"),attr(e,"aria-label",u=n[13][0].title??"")},m(P,B){insert_hydration(P,e,B),d&&d.m(e,null),append_hydration(e,t),m&&m.m(e,null),append_hydration(e,s),_&&_.m(e,null),append_hydration(e,a),C&&C.m(e,null)},p(P,B){var x,F,k,J;(x=P[13][0])!=null&&x.title?d?d.p(P,B):(d=create_if_block_7(P),d.c(),d.m(e,t)):d&&(d.d(1),d=null),(F=P[13][0])!=null&&F.body?m?m.p(P,B):(m=create_if_block_6(P),m.c(),m.m(e,s)):m&&(m.d(1),m=null),(k=P[13][0])!=null&&k.image&&typeof((J=P[13][0])==null?void 0:J.image)=="string"?_?_.p(P,B):(_=create_if_block_5(P),_.c(),_.m(e,a)):_&&(_.d(1),_=null),S===(S=b(P))&&C?C.p(P,B):(C&&C.d(1),C=S&&S(P),C&&(C.c(),C.m(e,null))),B[0]&131072&&c!==(c="modal "+P[17])&&attr(e,"class",c),B[0]&8192&&u!==(u=P[13][0].title??"")&&attr(e,"aria-label",u)},i:noop$3,o:noop$3,d(P){P&&detach(e),d&&d.d(),m&&m.d(),_&&_.d(),C&&C.d()}}}function create_else_block_1$1(n){var d,m;let e,t,s;const a=[(d=n[15])==null?void 0:d.props,{parent:n[16]}];var c=(m=n[15])==null?void 0:m.ref;function u(_,b){var C;let S={};if(b!==void 0&&b[0]&98304)S=get_spread_update(a,[b[0]&32768&&get_spread_object((C=_[15])==null?void 0:C.props),b[0]&65536&&{parent:_[16]}]);else for(let w=0;w<a.length;w+=1)S=assign$1(S,a[w]);return{props:S}}return c&&(e=construct_svelte_component(c,u(n))),{c(){e&&create_component(e.$$.fragment),t=empty()},l(_){e&&claim_component(e.$$.fragment,_),t=empty()},m(_,b){e&&mount_component(e,_,b),insert_hydration(_,t,b),s=!0},p(_,b){var S,C;if(b[0]&32768&&c!==(c=(S=_[15])==null?void 0:S.ref)){if(e){group_outros();const w=e;transition_out(w.$$.fragment,1,0,()=>{destroy_component(w,1)}),check_outros()}c?(e=construct_svelte_component(c,u(_,b)),create_component(e.$$.fragment),transition_in(e.$$.fragment,1),mount_component(e,t.parentNode,t)):e=null}else if(c){const w=b[0]&98304?get_spread_update(a,[b[0]&32768&&get_spread_object((C=_[15])==null?void 0:C.props),b[0]&65536&&{parent:_[16]}]):{};e.$set(w)}},i(_){s||(e&&transition_in(e.$$.fragment,_),s=!0)},o(_){e&&transition_out(e.$$.fragment,_),s=!1},d(_){_&&detach(t),e&&destroy_component(e,_)}}}function create_if_block_8(n){var d,m;let e,t,s;const a=[(d=n[15])==null?void 0:d.props,{parent:n[16]}];var c=(m=n[15])==null?void 0:m.ref;function u(_,b){var C;let S={$$slots:{default:[create_default_slot$3]},$$scope:{ctx:_}};if(b!==void 0&&b[0]&98304)S=get_spread_update(a,[b[0]&32768&&get_spread_object((C=_[15])==null?void 0:C.props),b[0]&65536&&{parent:_[16]}]);else for(let w=0;w<a.length;w+=1)S=assign$1(S,a[w]);return{props:S}}return c&&(e=construct_svelte_component(c,u(n))),{c(){e&&create_component(e.$$.fragment),t=empty()},l(_){e&&claim_component(e.$$.fragment,_),t=empty()},m(_,b){e&&mount_component(e,_,b),insert_hydration(_,t,b),s=!0},p(_,b){var S,C;if(b[0]&32768&&c!==(c=(S=_[15])==null?void 0:S.ref)){if(e){group_outros();const w=e;transition_out(w.$$.fragment,1,0,()=>{destroy_component(w,1)}),check_outros()}c?(e=construct_svelte_component(c,u(_,b)),create_component(e.$$.fragment),transition_in(e.$$.fragment,1),mount_component(e,t.parentNode,t)):e=null}else if(c){const w=b[0]&98304?get_spread_update(a,[b[0]&32768&&get_spread_object((C=_[15])==null?void 0:C.props),b[0]&65536&&{parent:_[16]}]):{};b[0]&32768|b[1]&65536&&(w.$$scope={dirty:b,ctx:_}),e.$set(w)}},i(_){s||(e&&transition_in(e.$$.fragment,_),s=!0)},o(_){e&&transition_out(e.$$.fragment,_),s=!1},d(_){_&&detach(t),e&&destroy_component(e,_)}}}function create_default_slot$3(n){var a;let e,t=((a=n[15])==null?void 0:a.slot)+"",s;return{c(){e=new HtmlTagHydration(!1),s=empty(),this.h()},l(c){e=claim_html_tag(c,!1),s=empty(),this.h()},h(){e.a=s},m(c,u){e.m(t,c,u),insert_hydration(c,s,u)},p(c,u){var d;u[0]&32768&&t!==(t=((d=c[15])==null?void 0:d.slot)+"")&&e.p(t)},d(c){c&&(detach(s),e.d())}}}function create_if_block_7(n){let e,t,s=n[13][0].title+"",a;return{c(){e=element("header"),t=new HtmlTagHydration(!1),this.h()},l(c){e=claim_element(c,"HEADER",{class:!0});var u=children(e);t=claim_html_tag(u,!1),u.forEach(detach),this.h()},h(){t.a=null,attr(e,"class",a="modal-header "+n[5])},m(c,u){insert_hydration(c,e,u),t.m(s,e)},p(c,u){u[0]&8192&&s!==(s=c[13][0].title+"")&&t.p(s),u[0]&32&&a!==(a="modal-header "+c[5])&&attr(e,"class",a)},d(c){c&&detach(e)}}}function create_if_block_6(n){let e,t,s=n[13][0].body+"",a;return{c(){e=element("article"),t=new HtmlTagHydration(!1),this.h()},l(c){e=claim_element(c,"ARTICLE",{class:!0});var u=children(e);t=claim_html_tag(u,!1),u.forEach(detach),this.h()},h(){t.a=null,attr(e,"class",a="modal-body "+n[6])},m(c,u){insert_hydration(c,e,u),t.m(s,e)},p(c,u){u[0]&8192&&s!==(s=c[13][0].body+"")&&t.p(s),u[0]&64&&a!==(a="modal-body "+c[6])&&attr(e,"class",a)},d(c){c&&detach(e)}}}function create_if_block_5(n){let e,t;return{c(){e=element("img"),this.h()},l(s){e=claim_element(s,"IMG",{class:!0,src:!0,alt:!0}),this.h()},h(){var s;attr(e,"class","modal-image "+cModalImage),src_url_equal(e.src,t=(s=n[13][0])==null?void 0:s.image)||attr(e,"src",t),attr(e,"alt","Modal")},m(s,a){insert_hydration(s,e,a)},p(s,a){var c;a[0]&8192&&!src_url_equal(e.src,t=(c=s[13][0])==null?void 0:c.image)&&attr(e,"src",t)},d(s){s&&detach(e)}}}function create_if_block_4$1(n){let e,t,s,a,c,u,d,m,_,b,S,C,w,O,I=[{class:"modal-prompt-input input"},{name:"prompt"},{type:"text"},n[13][0].valueAttr],N={};for(let P=0;P<I.length;P+=1)N=assign$1(N,I[P]);return{c(){e=element("form"),t=element("input"),s=space(),a=element("footer"),c=element("button"),u=text(n[0]),m=space(),_=element("button"),b=text(n[2]),this.h()},l(P){e=claim_element(P,"FORM",{class:!0});var B=children(e);t=claim_element(B,"INPUT",{class:!0,name:!0,type:!0}),s=claim_space(B),a=claim_element(B,"FOOTER",{class:!0});var x=children(a);c=claim_element(x,"BUTTON",{type:!0,class:!0});var F=children(c);u=claim_text(F,n[0]),F.forEach(detach),m=claim_space(x),_=claim_element(x,"BUTTON",{type:!0,class:!0});var k=children(_);b=claim_text(k,n[2]),k.forEach(detach),x.forEach(detach),B.forEach(detach),this.h()},h(){set_attributes(t,N),attr(c,"type","button"),attr(c,"class",d="btn "+n[3]),attr(_,"type","submit"),attr(_,"class",S="btn "+n[4]),attr(a,"class",C="modal-footer "+n[7]),attr(e,"class","space-y-4")},m(P,B){insert_hydration(P,e,B),append_hydration(e,t),t.autofocus&&t.focus(),set_input_value(t,n[14]),append_hydration(e,s),append_hydration(e,a),append_hydration(a,c),append_hydration(c,u),append_hydration(a,m),append_hydration(a,_),append_hydration(_,b),w||(O=[listen(t,"input",n[41]),listen(c,"click",n[23]),listen(e,"submit",n[25])],w=!0)},p(P,B){set_attributes(t,N=get_spread_update(I,[{class:"modal-prompt-input input"},{name:"prompt"},{type:"text"},B[0]&8192&&P[13][0].valueAttr])),B[0]&16384&&t.value!==P[14]&&set_input_value(t,P[14]),B[0]&1&&set_data(u,P[0]),B[0]&8&&d!==(d="btn "+P[3])&&attr(c,"class",d),B[0]&4&&set_data(b,P[2]),B[0]&16&&S!==(S="btn "+P[4])&&attr(_,"class",S),B[0]&128&&C!==(C="modal-footer "+P[7])&&attr(a,"class",C)},d(P){P&&detach(e),w=!1,run_all(O)}}}function create_if_block_3$2(n){let e,t,s,a,c,u,d,m,_,b,S;return{c(){e=element("footer"),t=element("button"),s=text(n[0]),c=space(),u=element("button"),d=text(n[1]),this.h()},l(C){e=claim_element(C,"FOOTER",{class:!0});var w=children(e);t=claim_element(w,"BUTTON",{type:!0,class:!0});var O=children(t);s=claim_text(O,n[0]),O.forEach(detach),c=claim_space(w),u=claim_element(w,"BUTTON",{type:!0,class:!0});var I=children(u);d=claim_text(I,n[1]),I.forEach(detach),w.forEach(detach),this.h()},h(){attr(t,"type","button"),attr(t,"class",a="btn "+n[3]),attr(u,"type","button"),attr(u,"class",m="btn "+n[4]),attr(e,"class",_="modal-footer "+n[7])},m(C,w){insert_hydration(C,e,w),append_hydration(e,t),append_hydration(t,s),append_hydration(e,c),append_hydration(e,u),append_hydration(u,d),b||(S=[listen(t,"click",n[23]),listen(u,"click",n[24])],b=!0)},p(C,w){w[0]&1&&set_data(s,C[0]),w[0]&8&&a!==(a="btn "+C[3])&&attr(t,"class",a),w[0]&2&&set_data(d,C[1]),w[0]&16&&m!==(m="btn "+C[4])&&attr(u,"class",m),w[0]&128&&_!==(_="modal-footer "+C[7])&&attr(e,"class",_)},d(C){C&&detach(e),b=!1,run_all(S)}}}function create_if_block_2$3(n){let e,t,s,a,c,u,d;return{c(){e=element("footer"),t=element("button"),s=text(n[0]),this.h()},l(m){e=claim_element(m,"FOOTER",{class:!0});var _=children(e);t=claim_element(_,"BUTTON",{type:!0,class:!0});var b=children(t);s=claim_text(b,n[0]),b.forEach(detach),_.forEach(detach),this.h()},h(){attr(t,"type","button"),attr(t,"class",a="btn "+n[3]),attr(e,"class",c="modal-footer "+n[7])},m(m,_){insert_hydration(m,e,_),append_hydration(e,t),append_hydration(t,s),u||(d=listen(t,"click",n[23]),u=!0)},p(m,_){_[0]&1&&set_data(s,m[0]),_[0]&8&&a!==(a="btn "+m[3])&&attr(t,"class",a),_[0]&128&&c!==(c="modal-footer "+m[7])&&attr(e,"class",c)},d(m){m&&detach(e),u=!1,d()}}}function create_key_block(n){let e,t,s,a,c,u,d,m,_,b,S,C;const w=[create_if_block_1$5,create_else_block$5],O=[];function I(N,P){return N[13][0].type!=="component"?0:1}return s=I(n),a=O[s]=w[s](n),{c(){e=element("div"),t=element("div"),a.c(),this.h()},l(N){e=claim_element(N,"DIV",{class:!0,"data-testid":!0});var P=children(e);t=claim_element(P,"DIV",{class:!0});var B=children(t);a.l(B),B.forEach(detach),P.forEach(detach),this.h()},h(){attr(t,"class",c="modal-transition "+n[18]),attr(e,"class",m="modal-backdrop "+n[19]),attr(e,"data-testid","modal-backdrop")},m(N,P){insert_hydration(N,e,P),append_hydration(e,t),O[s].m(t,null),b=!0,S||(C=[listen(e,"mousedown",n[21]),listen(e,"mouseup",n[22]),listen(e,"touchstart",n[39],{passive:!0}),listen(e,"touchend",n[40],{passive:!0}),action_destroyer(focusTrap.call(null,e,!0))],S=!0)},p(N,P){n=N;let B=s;s=I(n),s===B?O[s].p(n,P):(group_outros(),transition_out(O[B],1,1,()=>{O[B]=null}),check_outros(),a=O[s],a?a.p(n,P):(a=O[s]=w[s](n),a.c()),transition_in(a,1),a.m(t,null)),(!b||P[0]&262144&&c!==(c="modal-transition "+n[18]))&&attr(t,"class",c),(!b||P[0]&524288&&m!==(m="modal-backdrop "+n[19]))&&attr(e,"class",m)},i(N){b||(transition_in(a),add_render_callback(()=>{b&&(d&&d.end(1),u=create_in_transition(t,dynamicTransition,{transition:n[9],params:n[10],enabled:n[8]}),u.start())}),add_render_callback(()=>{b&&(_||(_=create_bidirectional_transition(e,dynamicTransition,{transition:fade,params:{duration:150},enabled:n[8]},!0)),_.run(1))}),b=!0)},o(N){transition_out(a),u&&u.invalidate(),d=create_out_transition(t,dynamicTransition,{transition:n[11],params:n[12],enabled:n[8]}),_||(_=create_bidirectional_transition(e,dynamicTransition,{transition:fade,params:{duration:150},enabled:n[8]},!1)),_.run(0),b=!1},d(N){N&&detach(e),O[s].d(),N&&d&&d.end(),N&&_&&_.end(),S=!1,run_all(C)}}}function create_fragment$v(n){let e,t,s,a,c=n[13].length>0&&create_if_block$8(n);return{c(){c&&c.c(),e=empty()},l(u){c&&c.l(u),e=empty()},m(u,d){c&&c.m(u,d),insert_hydration(u,e,d),t=!0,s||(a=listen(window,"keydown",n[26]),s=!0)},p(u,d){u[13].length>0?c?(c.p(u,d),d[0]&8192&&transition_in(c,1)):(c=create_if_block$8(u),c.c(),transition_in(c,1),c.m(e.parentNode,e)):c&&(group_outros(),transition_out(c,1,1,()=>{c=null}),check_outros())},i(u){t||(transition_in(c),t=!0)},o(u){transition_out(c),t=!1},d(u){u&&detach(e),c&&c.d(u),s=!1,a()}}}const cBackdrop$1="fixed top-0 left-0 right-0 bottom-0 overflow-y-auto",cTransitionLayer="w-full h-fit min-h-full p-4 overflow-y-auto flex justify-center",cModal="block overflow-y-auto",cModalImage="w-full h-auto";function instance$v(n,e,t){let s,a,c,u,d,m,_;component_subscribe(n,prefersReducedMotionStore,q=>t(43,_=q));const b=createEventDispatcher();let{position:S="items-center"}=e,{components:C={}}=e,{background:w="bg-surface-100-800-token"}=e,{width:O="w-modal"}=e,{height:I="h-auto"}=e,{padding:N="p-4"}=e,{spacing:P="space-y-4"}=e,{rounded:B="rounded-container-token"}=e,{shadow:x="shadow-xl"}=e,{zIndex:F="z-[999]"}=e,{buttonNeutral:k="variant-ghost-surface"}=e,{buttonPositive:J="variant-filled"}=e,{buttonTextCancel:z="Cancel"}=e,{buttonTextConfirm:H="Confirm"}=e,{buttonTextSubmit:W="Submit"}=e,{regionBackdrop:X="bg-surface-backdrop-token"}=e,{regionHeader:se="text-2xl font-bold"}=e,{regionBody:re="max-h-[200px] overflow-hidden"}=e,{regionFooter:ue="flex justify-end space-x-2"}=e,{transitions:de=!_}=e,{transitionIn:he=fly}=e,{transitionInParams:me={duration:150,opacity:0,x:0,y:100}}=e,{transitionOut:le=fly}=e,{transitionOutParams:_e={duration:150,opacity:0,x:0,y:100}}=e,fe;const ve={buttonTextCancel:z,buttonTextConfirm:H,buttonTextSubmit:W};let ne,j=!1;const $=getModalStore();component_subscribe(n,$,q=>t(13,m=q)),$.subscribe(q=>{q.length&&(q[0].type==="prompt"&&t(14,fe=q[0].value),t(0,z=q[0].buttonTextCancel||ve.buttonTextCancel),t(1,H=q[0].buttonTextConfirm||ve.buttonTextConfirm),t(2,W=q[0].buttonTextSubmit||ve.buttonTextSubmit),t(15,ne=typeof q[0].component=="string"?C[q[0].component]:q[0].component))});function Z(q){if(!(q.target instanceof Element))return;const ie=q.target.classList;(ie.contains("modal-backdrop")||ie.contains("modal-transition"))&&(j=!0)}function ce(q){if(!(q.target instanceof Element))return;const ie=q.target.classList;(ie.contains("modal-backdrop")||ie.contains("modal-transition"))&&j&&(m[0].response&&m[0].response(void 0),$.close(),b("backdrop",q)),j=!1}function Y(){m[0].response&&m[0].response(!1),$.close()}function K(){m[0].response&&m[0].response(!0),$.close()}function Q(q){q.preventDefault(),m[0].response&&m[0].response(fe),$.close()}function te(q){m.length&&q.code==="Escape"&&Y()}function oe(q){bubble.call(this,n,q)}function U(q){bubble.call(this,n,q)}function V(){fe=this.value,t(14,fe)}return n.$$set=q=>{t(46,e=assign$1(assign$1({},e),exclude_internal_props(q))),"position"in q&&t(27,S=q.position),"components"in q&&t(28,C=q.components),"background"in q&&t(29,w=q.background),"width"in q&&t(30,O=q.width),"height"in q&&t(31,I=q.height),"padding"in q&&t(32,N=q.padding),"spacing"in q&&t(33,P=q.spacing),"rounded"in q&&t(34,B=q.rounded),"shadow"in q&&t(35,x=q.shadow),"zIndex"in q&&t(36,F=q.zIndex),"buttonNeutral"in q&&t(3,k=q.buttonNeutral),"buttonPositive"in q&&t(4,J=q.buttonPositive),"buttonTextCancel"in q&&t(0,z=q.buttonTextCancel),"buttonTextConfirm"in q&&t(1,H=q.buttonTextConfirm),"buttonTextSubmit"in q&&t(2,W=q.buttonTextSubmit),"regionBackdrop"in q&&t(37,X=q.regionBackdrop),"regionHeader"in q&&t(5,se=q.regionHeader),"regionBody"in q&&t(6,re=q.regionBody),"regionFooter"in q&&t(7,ue=q.regionFooter),"transitions"in q&&t(8,de=q.transitions),"transitionIn"in q&&t(9,he=q.transitionIn),"transitionInParams"in q&&t(10,me=q.transitionInParams),"transitionOut"in q&&t(11,le=q.transitionOut),"transitionOutParams"in q&&t(12,_e=q.transitionOutParams)},n.$$.update=()=>{var q,ie,ge;n.$$.dirty[0]&134225920&&t(38,s=((q=m[0])==null?void 0:q.position)??S),t(19,a=`${cBackdrop$1} ${X} ${F} ${e.class??""} ${((ie=m[0])==null?void 0:ie.backdropClasses)??""}`),n.$$.dirty[1]&128&&t(18,c=`${cTransitionLayer} ${s??""}`),n.$$.dirty[0]&1610620928|n.$$.dirty[1]&31&&t(17,u=`${cModal} ${w} ${O} ${I} ${N} ${P} ${B} ${x} ${((ge=m[0])==null?void 0:ge.modalClasses)??""}`),n.$$.dirty[0]&1744830719|n.$$.dirty[1]&95&&t(16,d={position:S,background:w,width:O,height:I,padding:N,spacing:P,rounded:B,shadow:x,buttonNeutral:k,buttonPositive:J,buttonTextCancel:z,buttonTextConfirm:H,buttonTextSubmit:W,regionBackdrop:X,regionHeader:se,regionBody:re,regionFooter:ue,onClose:Y})},e=exclude_internal_props(e),[z,H,W,k,J,se,re,ue,de,he,me,le,_e,m,fe,ne,d,u,c,a,$,Z,ce,Y,K,Q,te,S,C,w,O,I,N,P,B,x,F,X,s,oe,U,V]}class Modal extends SvelteComponent{constructor(e){super(),init(this,e,instance$v,create_fragment$v,safe_not_equal,{position:27,components:28,background:29,width:30,height:31,padding:32,spacing:33,rounded:34,shadow:35,zIndex:36,buttonNeutral:3,buttonPositive:4,buttonTextCancel:0,buttonTextConfirm:1,buttonTextSubmit:2,regionBackdrop:37,regionHeader:5,regionBody:6,regionFooter:7,transitions:8,transitionIn:9,transitionInParams:10,transitionOut:11,transitionOutParams:12},null,[-1,-1])}}const{window:window_1}=globals;function create_if_block$7(n){let e,t,s,a,c,u,d,m,_,b,S;const C=n[32].default,w=create_slot(C,n,n[31],null);return{c(){e=element("div"),t=element("div"),w&&w.c(),this.h()},l(O){e=claim_element(O,"DIV",{class:!0,"data-testid":!0});var I=children(e);t=claim_element(I,"DIV",{class:!0,"data-testid":!0,role:!0,"aria-modal":!0,"aria-labelledby":!0,"aria-describedby":!0});var N=children(t);w&&w.l(N),N.forEach(detach),I.forEach(detach),this.h()},h(){attr(t,"class",s="drawer "+n[8]),attr(t,"data-testid","drawer"),attr(t,"role","dialog"),attr(t,"aria-modal","true"),attr(t,"aria-labelledby",n[0]),attr(t,"aria-describedby",n[1]),attr(e,"class",u="drawer-backdrop "+n[9]),attr(e,"data-testid","drawer-backdrop")},m(O,I){insert_hydration(O,e,I),append_hydration(e,t),w&&w.m(t,null),n[36](t),n[37](e),_=!0,b||(S=[listen(e,"mousedown",n[12]),listen(e,"touchstart",n[33],{passive:!0}),listen(e,"touchend",n[34],{passive:!0}),listen(e,"keypress",n[35]),action_destroyer(focusTrap.call(null,e,!0))],b=!0)},p(O,I){n=O,w&&w.p&&(!_||I[1]&1)&&update_slot_base(w,C,n,n[31],_?get_slot_changes(C,n[31],I,null):get_all_dirty_from_scope(n[31]),null),(!_||I[0]&256&&s!==(s="drawer "+n[8]))&&attr(t,"class",s),(!_||I[0]&1)&&attr(t,"aria-labelledby",n[0]),(!_||I[0]&2)&&attr(t,"aria-describedby",n[1]),(!_||I[0]&512&&u!==(u="drawer-backdrop "+n[9]))&&attr(e,"class",u)},i(O){_||(transition_in(w,O),O&&add_render_callback(()=>{_&&(c&&c.end(1),a=create_in_transition(t,dynamicTransition,{transition:fly,params:{x:n[7].x,y:n[7].y,duration:n[2],opacity:n[3]?void 0:1},enabled:n[4]}),a.start())}),O&&add_render_callback(()=>{_&&(m&&m.end(1),d=create_in_transition(e,dynamicTransition,{transition:fade,params:{duration:n[2]},enabled:n[4]&&n[3]}),d.start())}),_=!0)},o(O){transition_out(w,O),a&&a.invalidate(),O&&(c=create_out_transition(t,dynamicTransition,{transition:fly,params:{x:n[7].x,y:n[7].y,duration:n[2],opacity:n[3]?void 0:1,easing:cubicIn},enabled:n[4]})),d&&d.invalidate(),O&&(m=create_out_transition(e,dynamicTransition,{transition:fade,params:{duration:n[2]},enabled:n[4]&&n[3]})),_=!1},d(O){O&&detach(e),w&&w.d(O),n[36](null),O&&c&&c.end(),n[37](null),O&&m&&m.end(),b=!1,run_all(S)}}}function create_fragment$u(n){let e,t,s,a,c=n[10].open===!0&&create_if_block$7(n);return{c(){c&&c.c(),e=empty()},l(u){c&&c.l(u),e=empty()},m(u,d){c&&c.m(u,d),insert_hydration(u,e,d),t=!0,s||(a=listen(window_1,"keydown",n[13]),s=!0)},p(u,d){u[10].open===!0?c?(c.p(u,d),d[0]&1024&&transition_in(c,1)):(c=create_if_block$7(u),c.c(),transition_in(c,1),c.m(e.parentNode,e)):c&&(group_outros(),transition_out(c,1,1,()=>{c=null}),check_outros())},i(u){t||(transition_in(c),t=!0)},o(u){transition_out(c),t=!1},d(u){u&&detach(e),c&&c.d(u),s=!1,a()}}}const cBackdrop="fixed top-0 left-0 right-0 bottom-0 flex",cDrawer="overflow-y-auto transition-transform";function instance$u(n,e,t){let s,a,c,u,d,m,_,b;component_subscribe(n,prefersReducedMotionStore,U=>t(38,b=U));let{$$slots:S={},$$scope:C}=e;const w=createEventDispatcher();let{position:O="left"}=e,{bgDrawer:I="bg-surface-100-800-token"}=e,{border:N=""}=e,{rounded:P=""}=e,{shadow:B="shadow-xl"}=e,{width:x=""}=e,{height:F=""}=e,{bgBackdrop:k="bg-surface-backdrop-token"}=e,{blur:J=""}=e,{padding:z=""}=e,{zIndex:H="z-40"}=e,{regionBackdrop:W=""}=e,{regionDrawer:X=""}=e,{labelledby:se=""}=e,{describedby:re=""}=e,{duration:ue=200}=e,{transitions:de=!b}=e,{opacityTransition:he=!0}=e;const me={top:{alignment:"items-start",width:"w-full",height:"h-[50%]",rounded:"rounded-bl-container-token rounded-br-container-token"},bottom:{alignment:"items-end",width:"w-full",height:" h-[50%]",rounded:"rounded-tl-container-token rounded-tr-container-token"},left:{alignment:"justify-start",width:"w-[90%]",height:"h-full",rounded:"rounded-tr-container-token rounded-br-container-token"},right:{alignment:"justify-end",width:"w-[90%]",height:"h-full",rounded:"rounded-tl-container-token rounded-bl-container-token"}};let le,_e,fe={x:0,y:0};const ve=getDrawerStore();component_subscribe(n,ve,U=>t(10,_=U));const ne={position:O,bgBackdrop:k,blur:J,padding:z,bgDrawer:I,border:N,rounded:P,shadow:B,width:x,height:F,opacityTransition:he,regionBackdrop:W,regionDrawer:X,labelledby:se,describedby:re,duration:ue};function j(U){t(14,O=U.position||ne.position),t(21,k=U.bgBackdrop||ne.bgBackdrop),t(22,J=U.blur||ne.blur),t(23,z=U.padding||ne.padding),t(15,I=U.bgDrawer||ne.bgDrawer),t(16,N=U.border||ne.border),t(17,P=U.rounded||ne.rounded),t(18,B=U.shadow||ne.shadow),t(19,x=U.width||ne.width),t(20,F=U.height||ne.height),t(24,W=U.regionBackdrop||ne.regionBackdrop),t(25,X=U.regionDrawer||ne.regionDrawer),t(0,se=U.labelledby||ne.labelledby),t(1,re=U.describedby||ne.describedby),t(3,he=U.opacityTransition||ne.opacityTransition),t(2,ue=U.duration||ne.duration)}function $(){switch(O){case"top":t(7,fe={x:0,y:-window.innerWidth});break;case"bottom":t(7,fe={x:0,y:window.innerWidth});break;case"left":t(7,fe={x:-window.innerHeight,y:0});break;case"right":t(7,fe={x:window.innerHeight,y:0});break;default:console.error("Error: unknown position property value.");break}}function Z(U){U.target===le?(ve.close(),w("backdrop",U)):w("drawer",U)}function ce(U){_&&U.code==="Escape"&&ve.close()}ve.subscribe(U=>{U.open===!0&&(j(U),$())});function Y(U){bubble.call(this,n,U)}function K(U){bubble.call(this,n,U)}function Q(U){bubble.call(this,n,U)}function te(U){binding_callbacks[U?"unshift":"push"](()=>{_e=U,t(6,_e)})}function oe(U){binding_callbacks[U?"unshift":"push"](()=>{le=U,t(5,le)})}return n.$$set=U=>{t(44,e=assign$1(assign$1({},e),exclude_internal_props(U))),"position"in U&&t(14,O=U.position),"bgDrawer"in U&&t(15,I=U.bgDrawer),"border"in U&&t(16,N=U.border),"rounded"in U&&t(17,P=U.rounded),"shadow"in U&&t(18,B=U.shadow),"width"in U&&t(19,x=U.width),"height"in U&&t(20,F=U.height),"bgBackdrop"in U&&t(21,k=U.bgBackdrop),"blur"in U&&t(22,J=U.blur),"padding"in U&&t(23,z=U.padding),"zIndex"in U&&t(26,H=U.zIndex),"regionBackdrop"in U&&t(24,W=U.regionBackdrop),"regionDrawer"in U&&t(25,X=U.regionDrawer),"labelledby"in U&&t(0,se=U.labelledby),"describedby"in U&&t(1,re=U.describedby),"duration"in U&&t(2,ue=U.duration),"transitions"in U&&t(4,de=U.transitions),"opacityTransition"in U&&t(3,he=U.opacityTransition),"$$scope"in U&&t(31,C=U.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&16384&&t(30,s=me[O].alignment),n.$$.dirty[0]&540672&&t(29,a=x||me[O].width),n.$$.dirty[0]&1064960&&t(28,c=F||me[O].height),n.$$.dirty[0]&147456&&t(27,u=P||me[O].rounded),t(9,d=`${cBackdrop} ${k} ${z} ${J} ${s} ${W} ${H} ${e.class??""}`),n.$$.dirty[0]&973570048&&t(8,m=`${cDrawer} ${I} ${N} ${P} ${B} ${a} ${c} ${u} ${X}`)},e=exclude_internal_props(e),[se,re,ue,he,de,le,_e,fe,m,d,_,ve,Z,ce,O,I,N,P,B,x,F,k,J,z,W,X,H,u,c,a,s,C,S,Y,K,Q,te,oe]}class Drawer extends SvelteComponent{constructor(e){super(),init(this,e,instance$u,create_fragment$u,safe_not_equal,{position:14,bgDrawer:15,border:16,rounded:17,shadow:18,width:19,height:20,bgBackdrop:21,blur:22,padding:23,zIndex:26,regionBackdrop:24,regionDrawer:25,labelledby:0,describedby:1,duration:2,transitions:4,opacityTransition:3},null,[-1,-1])}}function get_each_context$5(n,e,t){const s=n.slice();return s[36]=e[t],s[38]=t,s}function create_if_block$6(n){let e,t,s=[],a=new Map,c,u,d,m=ensure_array_like(n[11]);const _=b=>b[36];for(let b=0;b<m.length;b+=1){let S=get_each_context$5(n,m,b),C=_(S);a.set(C,s[b]=create_each_block$5(C,S))}return{c(){e=element("div"),t=element("div");for(let b=0;b<s.length;b+=1)s[b].c();this.h()},l(b){e=claim_element(b,"DIV",{class:!0,"data-testid":!0});var S=children(e);t=claim_element(S,"DIV",{class:!0});var C=children(t);for(let w=0;w<s.length;w+=1)s[w].l(C);C.forEach(detach),S.forEach(detach),this.h()},h(){attr(t,"class",c="snackbar "+n[13]),attr(e,"class",u="snackbar-wrapper "+n[14]),attr(e,"data-testid","snackbar-wrapper")},m(b,S){insert_hydration(b,e,S),append_hydration(e,t);for(let C=0;C<s.length;C+=1)s[C]&&s[C].m(t,null);d=!0},p(b,S){if(S[0]&499103){m=ensure_array_like(b[11]),group_outros();for(let C=0;C<s.length;C+=1)s[C].r();s=update_keyed_each(s,S,_,1,b,m,a,t,fix_and_outro_and_destroy_block,create_each_block$5,null,get_each_context$5);for(let C=0;C<s.length;C+=1)s[C].a();check_outros()}(!d||S[0]&8192&&c!==(c="snackbar "+b[13]))&&attr(t,"class",c),(!d||S[0]&16384&&u!==(u="snackbar-wrapper "+b[14]))&&attr(e,"class",u)},i(b){if(!d){for(let S=0;S<m.length;S+=1)transition_in(s[S]);d=!0}},o(b){for(let S=0;S<s.length;S+=1)transition_out(s[S]);d=!1},d(b){b&&detach(e);for(let S=0;S<s.length;S+=1)s[S].d()}}}function create_if_block_1$4(n){let e,t,s=n[36].action&&create_if_block_3$1(n),a=!n[36].hideDismiss&&create_if_block_2$2(n);return{c(){e=element("div"),s&&s.c(),t=space(),a&&a.c(),this.h()},l(c){e=claim_element(c,"DIV",{class:!0});var u=children(e);s&&s.l(u),t=claim_space(u),a&&a.l(u),u.forEach(detach),this.h()},h(){attr(e,"class","toast-actions "+cToastActions)},m(c,u){insert_hydration(c,e,u),s&&s.m(e,null),append_hydration(e,t),a&&a.m(e,null)},p(c,u){c[36].action?s?s.p(c,u):(s=create_if_block_3$1(c),s.c(),s.m(e,t)):s&&(s.d(1),s=null),c[36].hideDismiss?a&&(a.d(1),a=null):a?a.p(c,u):(a=create_if_block_2$2(c),a.c(),a.m(e,null))},d(c){c&&detach(e),s&&s.d(),a&&a.d()}}}function create_if_block_3$1(n){let e,t,s=n[36].action.label+"",a,c;function u(){return n[30](n[38])}return{c(){e=element("button"),t=new HtmlTagHydration(!1),this.h()},l(d){e=claim_element(d,"BUTTON",{class:!0});var m=children(e);t=claim_html_tag(m,!1),m.forEach(detach),this.h()},h(){t.a=null,attr(e,"class",n[1])},m(d,m){insert_hydration(d,e,m),t.m(s,e),a||(c=listen(e,"click",u),a=!0)},p(d,m){n=d,m[0]&2048&&s!==(s=n[36].action.label+"")&&t.p(s),m[0]&2&&attr(e,"class",n[1])},d(d){d&&detach(e),a=!1,c()}}}function create_if_block_2$2(n){let e,t,s,a;function c(){return n[31](n[36])}return{c(){e=element("button"),t=text(n[3]),this.h()},l(u){e=claim_element(u,"BUTTON",{class:!0,"aria-label":!0});var d=children(e);t=claim_text(d,n[3]),d.forEach(detach),this.h()},h(){attr(e,"class",n[2]),attr(e,"aria-label","Dismiss toast")},m(u,d){insert_hydration(u,e,d),append_hydration(e,t),s||(a=listen(e,"click",c),s=!0)},p(u,d){n=u,d[0]&8&&set_data(t,n[3]),d[0]&4&&attr(e,"class",n[2])},d(u){u&&detach(e),s=!1,a()}}}function create_each_block$5(n,e){let t,s,a,c,u=e[36].message+"",d,m,_,b,S,C,w,O=noop$3,I,N,P,B=(e[36].action||!e[36].hideDismiss)&&create_if_block_1$4(e);function x(){return e[32](e[38])}function F(){return e[33](e[38])}return{key:n,first:null,c(){t=element("div"),s=element("div"),a=element("div"),c=new HtmlTagHydration(!1),d=space(),B&&B.c(),_=space(),this.h()},l(k){t=claim_element(k,"DIV",{role:!0,"aria-live":!0});var J=children(t);s=claim_element(J,"DIV",{class:!0,"data-testid":!0});var z=children(s);a=claim_element(z,"DIV",{class:!0});var H=children(a);c=claim_html_tag(H,!1),H.forEach(detach),d=claim_space(z),B&&B.l(z),z.forEach(detach),_=claim_space(J),J.forEach(detach),this.h()},h(){c.a=null,attr(a,"class","text-base"),attr(s,"class",m="toast "+e[12]+" "+(e[36].background??e[0])+" "+(e[36].classes??"")),attr(s,"data-testid","toast"),attr(t,"role",b=e[36].hideDismiss?"alert":"alertdialog"),attr(t,"aria-live","polite"),this.first=t},m(k,J){insert_hydration(k,t,J),append_hydration(t,s),append_hydration(s,a),c.m(u,a),append_hydration(s,d),B&&B.m(s,null),append_hydration(t,_),I=!0,N||(P=[listen(t,"mouseenter",x),listen(t,"mouseleave",F)],N=!0)},p(k,J){e=k,(!I||J[0]&2048)&&u!==(u=e[36].message+"")&&c.p(u),e[36].action||!e[36].hideDismiss?B?B.p(e,J):(B=create_if_block_1$4(e),B.c(),B.m(s,null)):B&&(B.d(1),B=null),(!I||J[0]&6145&&m!==(m="toast "+e[12]+" "+(e[36].background??e[0])+" "+(e[36].classes??"")))&&attr(s,"class",m),(!I||J[0]&2048&&b!==(b=e[36].hideDismiss?"alert":"alertdialog"))&&attr(t,"role",b)},r(){w=t.getBoundingClientRect()},f(){fix_position(t),O(),add_transform(t,w)},a(){O(),O=create_animation(t,w,flip$1,{duration:e[4]?250:0})},i(k){I||(add_render_callback(()=>{I&&(C&&C.end(1),S=create_in_transition(t,dynamicTransition,{transition:e[5],params:{x:e[10].x,y:e[10].y,...e[6]},enabled:e[4]}),S.start())}),I=!0)},o(k){S&&S.invalidate(),C=create_out_transition(t,dynamicTransition,{transition:e[7],params:{x:e[10].x,y:e[10].y,...e[8]},enabled:e[4]}),I=!1},d(k){k&&detach(t),B&&B.d(),k&&C&&C.end(),N=!1,run_all(P)}}}function create_fragment$t(n){let e,t,s=n[9].length&&create_if_block$6(n);return{c(){s&&s.c(),e=empty()},l(a){s&&s.l(a),e=empty()},m(a,c){s&&s.m(a,c),insert_hydration(a,e,c),t=!0},p(a,c){a[9].length?s?(s.p(a,c),c[0]&512&&transition_in(s,1)):(s=create_if_block$6(a),s.c(),transition_in(s,1),s.m(e.parentNode,e)):s&&(group_outros(),transition_out(s,1,1,()=>{s=null}),check_outros())},i(a){t||(transition_in(s),t=!0)},o(a){transition_out(s),t=!1},d(a){a&&detach(e),s&&s.d(a)}}}const cWrapper="flex fixed top-0 left-0 right-0 bottom-0 pointer-events-none",cSnackbar="flex flex-col gap-y-2",cToast="flex justify-between items-center pointer-events-auto",cToastActions="flex items-center space-x-2";function instance$t(n,e,t){let s,a,c,u,d,m;component_subscribe(n,prefersReducedMotionStore,j=>t(34,m=j));const _=getToastStore();component_subscribe(n,_,j=>t(9,d=j));let{position:b="b"}=e,{max:S=3}=e,{background:C="variant-filled-secondary"}=e,{width:w="max-w-[640px]"}=e,{color:O=""}=e,{padding:I="p-4"}=e,{spacing:N="space-x-4"}=e,{rounded:P="rounded-container-token"}=e,{shadow:B="shadow-lg"}=e,{zIndex:x="z-[888]"}=e,{buttonAction:F="btn variant-filled"}=e,{buttonDismiss:k="btn-icon btn-icon-sm variant-filled"}=e,{buttonDismissLabel:J=""}=e,{transitions:z=!m}=e,{transitionIn:H=fly}=e,{transitionInParams:W={duration:250}}=e,{transitionOut:X=fly}=e,{transitionOutParams:se={duration:250}}=e,re,ue,de={x:0,y:0};switch(b){case"t":re="justify-center items-start",ue="items-center",de={x:0,y:-100};break;case"b":re="justify-center items-end",ue="items-center",de={x:0,y:100};break;case"l":re="justify-start items-center",ue="items-start",de={x:-100,y:0};break;case"r":re="justify-end items-center",ue="items-end",de={x:100,y:0};break;case"tl":re="justify-start items-start",ue="items-start",de={x:-100,y:0};break;case"tr":re="justify-end items-start",ue="items-end",de={x:100,y:0};break;case"bl":re="justify-start items-end",ue="items-start",de={x:-100,y:0};break;case"br":re="justify-end items-end",ue="items-end",de={x:100,y:0};break}function he(j){var $,Z;(Z=($=d[j])==null?void 0:$.action)==null||Z.response(),_.close(d[j].id)}function me(j){var $;($=d[j])!=null&&$.hoverable&&(_.freeze(j),t(13,a+=" scale-[105%]"))}function le(j){var $;($=d[j])!=null&&$.hoverable&&(_.unfreeze(j),t(13,a=a.replace(" scale-[105%]","")))}const _e=j=>he(j),fe=j=>_.close(j.id),ve=j=>me(j),ne=j=>le(j);return n.$$set=j=>{t(35,e=assign$1(assign$1({},e),exclude_internal_props(j))),"position"in j&&t(19,b=j.position),"max"in j&&t(20,S=j.max),"background"in j&&t(0,C=j.background),"width"in j&&t(21,w=j.width),"color"in j&&t(22,O=j.color),"padding"in j&&t(23,I=j.padding),"spacing"in j&&t(24,N=j.spacing),"rounded"in j&&t(25,P=j.rounded),"shadow"in j&&t(26,B=j.shadow),"zIndex"in j&&t(27,x=j.zIndex),"buttonAction"in j&&t(1,F=j.buttonAction),"buttonDismiss"in j&&t(2,k=j.buttonDismiss),"buttonDismissLabel"in j&&t(3,J=j.buttonDismissLabel),"transitions"in j&&t(4,z=j.transitions),"transitionIn"in j&&t(5,H=j.transitionIn),"transitionInParams"in j&&t(6,W=j.transitionInParams),"transitionOut"in j&&t(7,X=j.transitionOut),"transitionOutParams"in j&&t(8,se=j.transitionOutParams)},n.$$.update=()=>{t(14,s=`${cWrapper} ${re} ${x} ${e.class||""}`),n.$$.dirty[0]&545259520&&t(13,a=`${cSnackbar} ${ue} ${I}`),n.$$.dirty[0]&132120576&&t(12,c=`${cToast} ${w} ${O} ${I} ${N} ${P} ${B}`),n.$$.dirty[0]&1049088&&t(11,u=Array.from(d).slice(0,S))},e=exclude_internal_props(e),[C,F,k,J,z,H,W,X,se,d,de,u,c,a,s,_,he,me,le,b,S,w,O,I,N,P,B,x,re,ue,_e,fe,ve,ne]}class Toast extends SvelteComponent{constructor(e){super(),init(this,e,instance$t,create_fragment$t,safe_not_equal,{position:19,max:20,background:0,width:21,color:22,padding:23,spacing:24,rounded:25,shadow:26,zIndex:27,buttonAction:1,buttonDismiss:2,buttonDismissLabel:3,transitions:4,transitionIn:5,transitionInParams:6,transitionOut:7,transitionOutParams:8},null,[-1,-1])}}function _mergeNamespaces(n,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(s){if(s!=="default"&&!(s in n)){var a=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(n,s,a.get?a:{enumerable:!0,get:function(){return t[s]}})}})}),Object.freeze(n)}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof dist.global<"u"?dist.global:typeof self<"u"?self:{};function getDefaultExportFromCjs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var loglevel={exports:{}};(function(n){(function(e,t){n.exports?n.exports=t():e.log=t()})(commonjsGlobal,function(){var e=function(){},t="undefined",s=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),a=["trace","debug","info","warn","error"];function c(I,N){var P=I[N];if(typeof P.bind=="function")return P.bind(I);try{return Function.prototype.bind.call(P,I)}catch{return function(){return Function.prototype.apply.apply(P,[I,arguments])}}}function u(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function d(I){return I==="debug"&&(I="log"),typeof console===t?!1:I==="trace"&&s?u:console[I]!==void 0?c(console,I):console.log!==void 0?c(console,"log"):e}function m(I,N){for(var P=0;P<a.length;P++){var B=a[P];this[B]=P<I?e:this.methodFactory(B,I,N)}this.log=this.debug}function _(I,N,P){return function(){typeof console!==t&&(m.call(this,N,P),this[I].apply(this,arguments))}}function b(I,N,P){return d(I)||_.apply(this,arguments)}function S(I,N,P){var B=this,x;N=N??"WARN";var F="loglevel";typeof I=="string"?F+=":"+I:typeof I=="symbol"&&(F=void 0);function k(W){var X=(a[W]||"silent").toUpperCase();if(!(typeof window===t||!F)){try{window.localStorage[F]=X;return}catch{}try{window.document.cookie=encodeURIComponent(F)+"="+X+";"}catch{}}}function J(){var W;if(!(typeof window===t||!F)){try{W=window.localStorage[F]}catch{}if(typeof W===t)try{var X=window.document.cookie,se=X.indexOf(encodeURIComponent(F)+"=");se!==-1&&(W=/^([^;]+)/.exec(X.slice(se))[1])}catch{}return B.levels[W]===void 0&&(W=void 0),W}}function z(){if(!(typeof window===t||!F)){try{window.localStorage.removeItem(F);return}catch{}try{window.document.cookie=encodeURIComponent(F)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}B.name=I,B.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},B.methodFactory=P||b,B.getLevel=function(){return x},B.setLevel=function(W,X){if(typeof W=="string"&&B.levels[W.toUpperCase()]!==void 0&&(W=B.levels[W.toUpperCase()]),typeof W=="number"&&W>=0&&W<=B.levels.SILENT){if(x=W,X!==!1&&k(W),m.call(B,W,I),typeof console===t&&W<B.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+W},B.setDefaultLevel=function(W){N=W,J()||B.setLevel(W,!1)},B.resetLevel=function(){B.setLevel(N,!1),z()},B.enableAll=function(W){B.setLevel(B.levels.TRACE,W)},B.disableAll=function(W){B.setLevel(B.levels.SILENT,W)};var H=J();H==null&&(H=N),B.setLevel(H,!1)}var C=new S,w={};C.getLogger=function(N){if(typeof N!="symbol"&&typeof N!="string"||N==="")throw new TypeError("You must supply a name when creating a logger.");var P=w[N];return P||(P=w[N]=new S(N,C.getLevel(),C.methodFactory)),P};var O=typeof window!==t?window.log:void 0;return C.noConflict=function(){return typeof window!==t&&window.log===C&&(window.log=O),C},C.getLoggers=function(){return w},C.default=C,C})})(loglevel);var loglevelExports=loglevel.exports,LogLevel;(function(n){n[n.trace=0]="trace",n[n.debug=1]="debug",n[n.info=2]="info",n[n.warn=3]="warn",n[n.error=4]="error",n[n.silent=5]="silent"})(LogLevel||(LogLevel={}));var LoggerNames;(function(n){n.Default="livekit",n.Room="livekit-room",n.Participant="livekit-participant",n.Track="livekit-track",n.Publication="livekit-track-publication",n.Engine="livekit-engine",n.Signal="livekit-signal",n.PCManager="livekit-pc-manager",n.PCTransport="livekit-pc-transport",n.E2EE="lk-e2ee"})(LoggerNames||(LoggerNames={}));let livekitLogger=loglevelExports.getLogger("livekit");livekitLogger.setDefaultLevel(LogLevel.info);function getLogger(n){const e=loglevelExports.getLogger(n);return e.setDefaultLevel(livekitLogger.getLevel()),e}loglevelExports.getLogger("lk-e2ee");function assert(n,e){if(!n)throw new Error(e)}const FLOAT32_MAX=34028234663852886e22,FLOAT32_MIN=-34028234663852886e22,UINT32_MAX=4294967295,INT32_MAX=2147483647,INT32_MIN=-2147483648;function assertInt32(n){if(typeof n!="number")throw new Error("invalid int 32: "+typeof n);if(!Number.isInteger(n)||n>INT32_MAX||n<INT32_MIN)throw new Error("invalid int 32: "+n)}function assertUInt32(n){if(typeof n!="number")throw new Error("invalid uint 32: "+typeof n);if(!Number.isInteger(n)||n>UINT32_MAX||n<0)throw new Error("invalid uint 32: "+n)}function assertFloat32(n){if(typeof n!="number")throw new Error("invalid float 32: "+typeof n);if(Number.isFinite(n)&&(n>FLOAT32_MAX||n<FLOAT32_MIN))throw new Error("invalid float 32: "+n)}const enumTypeSymbol=Symbol("@bufbuild/protobuf/enum-type");function getEnumType(n){const e=n[enumTypeSymbol];return assert(e,"missing enum type on enum object"),e}function setEnumType(n,e,t,s){n[enumTypeSymbol]=makeEnumType(e,t.map(a=>({no:a.no,name:a.name,localName:n[a.no]})))}function makeEnumType(n,e,t){const s=Object.create(null),a=Object.create(null),c=[];for(const u of e){const d=normalizeEnumValue(u);c.push(d),s[u.name]=d,a[u.no]=d}return{typeName:n,values:c,findName(u){return s[u]},findNumber(u){return a[u]}}}function makeEnum(n,e,t){const s={};for(const a of e){const c=normalizeEnumValue(a);s[c.localName]=c.no,s[c.no]=c.localName}return setEnumType(s,n,e),s}function normalizeEnumValue(n){return"localName"in n?n:Object.assign(Object.assign({},n),{localName:n.name})}class Message{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const s=this.getType(),a=s.runtime.bin,c=a.makeReadOptions(t);return a.readMessage(this,c.readerFactory(e),e.byteLength,c),this}fromJson(e,t){const s=this.getType(),a=s.runtime.json,c=a.makeReadOptions(t);return a.readMessage(s,e,c,this),this}fromJsonString(e,t){let s;try{s=JSON.parse(e)}catch(a){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(a instanceof Error?a.message:String(a)))}return this.fromJson(s,t)}toBinary(e){const t=this.getType(),s=t.runtime.bin,a=s.makeWriteOptions(e),c=a.writerFactory();return s.writeMessage(this,c,a),c.finish()}toJson(e){const t=this.getType(),s=t.runtime.json,a=s.makeWriteOptions(e);return s.writeMessage(this,a)}toJsonString(e){var t;const s=this.toJson(e);return JSON.stringify(s,null,(t=e==null?void 0:e.prettySpaces)!==null&&t!==void 0?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function makeMessageType(n,e,t,s){var a;const c=(a=s==null?void 0:s.localName)!==null&&a!==void 0?a:e.substring(e.lastIndexOf(".")+1),u={[c]:function(d){n.util.initFields(this),n.util.initPartial(d,this)}}[c];return Object.setPrototypeOf(u.prototype,new Message),Object.assign(u,{runtime:n,typeName:e,fields:n.util.newFieldList(t),fromBinary(d,m){return new u().fromBinary(d,m)},fromJson(d,m){return new u().fromJson(d,m)},fromJsonString(d,m){return new u().fromJsonString(d,m)},equals(d,m){return n.util.equals(u,d,m)}}),u}function makeProtoRuntime(n,e,t,s){return{syntax:n,json:e,bin:t,util:s,makeMessageType(a,c,u){return makeMessageType(this,a,c,u)},makeEnum,makeEnumType,getEnumType}}var ScalarType;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(ScalarType||(ScalarType={}));var LongType;(function(n){n[n.BIGINT=0]="BIGINT",n[n.STRING=1]="STRING"})(LongType||(LongType={}));function varint64read(){let n=0,e=0;for(let s=0;s<28;s+=7){let a=this.buf[this.pos++];if(n|=(a&127)<<s,!(a&128))return this.assertBounds(),[n,e]}let t=this.buf[this.pos++];if(n|=(t&15)<<28,e=(t&112)>>4,!(t&128))return this.assertBounds(),[n,e];for(let s=3;s<=31;s+=7){let a=this.buf[this.pos++];if(e|=(a&127)<<s,!(a&128))return this.assertBounds(),[n,e]}throw new Error("invalid varint")}function varint64write(n,e,t){for(let c=0;c<28;c=c+7){const u=n>>>c,d=!(!(u>>>7)&&e==0),m=(d?u|128:u)&255;if(t.push(m),!d)return}const s=n>>>28&15|(e&7)<<4,a=!!(e>>3);if(t.push((a?s|128:s)&255),!!a){for(let c=3;c<31;c=c+7){const u=e>>>c,d=!!(u>>>7),m=(d?u|128:u)&255;if(t.push(m),!d)return}t.push(e>>>31&1)}}const TWO_PWR_32_DBL$1=4294967296;function int64FromString(n){const e=n[0]==="-";e&&(n=n.slice(1));const t=1e6;let s=0,a=0;function c(u,d){const m=Number(n.slice(u,d));a*=t,s=s*t+m,s>=TWO_PWR_32_DBL$1&&(a=a+(s/TWO_PWR_32_DBL$1|0),s=s%TWO_PWR_32_DBL$1)}return c(-24,-18),c(-18,-12),c(-12,-6),c(-6),e?negate(s,a):newBits(s,a)}function int64ToString(n,e){let t=newBits(n,e);const s=t.hi&2147483648;s&&(t=negate(t.lo,t.hi));const a=uInt64ToString(t.lo,t.hi);return s?"-"+a:a}function uInt64ToString(n,e){if({lo:n,hi:e}=toUnsigned(n,e),e<=2097151)return String(TWO_PWR_32_DBL$1*e+n);const t=n&16777215,s=(n>>>24|e<<8)&16777215,a=e>>16&65535;let c=t+s*6777216+a*6710656,u=s+a*8147497,d=a*2;const m=1e7;return c>=m&&(u+=Math.floor(c/m),c%=m),u>=m&&(d+=Math.floor(u/m),u%=m),d.toString()+decimalFrom1e7WithLeadingZeros(u)+decimalFrom1e7WithLeadingZeros(c)}function toUnsigned(n,e){return{lo:n>>>0,hi:e>>>0}}function newBits(n,e){return{lo:n|0,hi:e|0}}function negate(n,e){return e=~e,n?n=~n+1:e+=1,newBits(n,e)}const decimalFrom1e7WithLeadingZeros=n=>{const e=String(n);return"0000000".slice(e.length)+e};function varint32write(n,e){if(n>=0){for(;n>127;)e.push(n&127|128),n=n>>>7;e.push(n)}else{for(let t=0;t<9;t++)e.push(n&127|128),n=n>>7;e.push(1)}}function varint32read(){let n=this.buf[this.pos++],e=n&127;if(!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<7,!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<14,!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<21,!(n&128))return this.assertBounds(),e;n=this.buf[this.pos++],e|=(n&15)<<28;for(let t=5;n&128&&t<10;t++)n=this.buf[this.pos++];if(n&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function makeInt64Support(){const n=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"&&(typeof dist.process!="object"||typeof dist.process.env!="object"||{}.BUF_BIGINT_DISABLE!=="1")){const a=BigInt("-9223372036854775808"),c=BigInt("9223372036854775807"),u=BigInt("0"),d=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(m){const _=typeof m=="bigint"?m:BigInt(m);if(_>c||_<a)throw new Error("int64 invalid: ".concat(m));return _},uParse(m){const _=typeof m=="bigint"?m:BigInt(m);if(_>d||_<u)throw new Error("uint64 invalid: ".concat(m));return _},enc(m){return n.setBigInt64(0,this.parse(m),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},uEnc(m){return n.setBigInt64(0,this.uParse(m),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},dec(m,_){return n.setInt32(0,m,!0),n.setInt32(4,_,!0),n.getBigInt64(0,!0)},uDec(m,_){return n.setInt32(0,m,!0),n.setInt32(4,_,!0),n.getBigUint64(0,!0)}}}const t=a=>assert(/^-?[0-9]+$/.test(a),"int64 invalid: ".concat(a)),s=a=>assert(/^[0-9]+$/.test(a),"uint64 invalid: ".concat(a));return{zero:"0",supported:!1,parse(a){return typeof a!="string"&&(a=a.toString()),t(a),a},uParse(a){return typeof a!="string"&&(a=a.toString()),s(a),a},enc(a){return typeof a!="string"&&(a=a.toString()),t(a),int64FromString(a)},uEnc(a){return typeof a!="string"&&(a=a.toString()),s(a),int64FromString(a)},dec(a,c){return int64ToString(a,c)},uDec(a,c){return uInt64ToString(a,c)}}}const protoInt64=makeInt64Support();var WireType;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32"})(WireType||(WireType={}));class BinaryWriter{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let a=0;a<this.chunks.length;a++)e+=this.chunks[a].length;let t=new Uint8Array(e),s=0;for(let a=0;a<this.chunks.length;a++)t.set(this.chunks[a],s),s+=this.chunks[a].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(assertUInt32(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return assertInt32(e),varint32write(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){assertFloat32(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){assertUInt32(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){assertInt32(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return assertInt32(e),e=(e<<1^e>>31)>>>0,varint32write(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),s=new DataView(t.buffer),a=protoInt64.enc(e);return s.setInt32(0,a.lo,!0),s.setInt32(4,a.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),s=new DataView(t.buffer),a=protoInt64.uEnc(e);return s.setInt32(0,a.lo,!0),s.setInt32(4,a.hi,!0),this.raw(t)}int64(e){let t=protoInt64.enc(e);return varint64write(t.lo,t.hi,this.buf),this}sint64(e){let t=protoInt64.enc(e),s=t.hi>>31,a=t.lo<<1^s,c=(t.hi<<1|t.lo>>>31)^s;return varint64write(a,c,this.buf),this}uint64(e){let t=protoInt64.uEnc(e);return varint64write(t.lo,t.hi,this.buf),this}}class BinaryReader{constructor(e,t){this.varint64=varint64read,this.uint32=varint32read,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t??new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,s=e&7;if(t<=0||s<0||s>5)throw new Error("illegal tag: field no "+t+" wire type "+s);return[t,s]}skip(e){let t=this.pos;switch(e){case WireType.Varint:for(;this.buf[this.pos++]&128;);break;case WireType.Bit64:this.pos+=4;case WireType.Bit32:this.pos+=4;break;case WireType.LengthDelimited:let s=this.uint32();this.pos+=s;break;case WireType.StartGroup:let a;for(;(a=this.tag()[1])!==WireType.EndGroup;)this.skip(a);break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(t,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return protoInt64.dec(...this.varint64())}uint64(){return protoInt64.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),s=-(e&1);return e=(e>>>1|(t&1)<<31)^s,t=t>>>1^s,protoInt64.dec(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return protoInt64.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return protoInt64.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function wrapField(n,e){return e instanceof Message||!n.fieldWrapper?e:n.fieldWrapper.wrapField(e)}ScalarType.DOUBLE,ScalarType.FLOAT,ScalarType.INT64,ScalarType.UINT64,ScalarType.INT32,ScalarType.UINT32,ScalarType.BOOL,ScalarType.STRING,ScalarType.BYTES;function scalarEquals(n,e,t){if(e===t)return!0;if(n==ScalarType.BYTES){if(!(e instanceof Uint8Array)||!(t instanceof Uint8Array)||e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}switch(n){case ScalarType.UINT64:case ScalarType.FIXED64:case ScalarType.INT64:case ScalarType.SFIXED64:case ScalarType.SINT64:return e==t}return!1}function scalarDefaultValue(n,e){switch(n){case ScalarType.BOOL:return!1;case ScalarType.UINT64:case ScalarType.FIXED64:case ScalarType.INT64:case ScalarType.SFIXED64:case ScalarType.SINT64:return e==0?protoInt64.zero:"0";case ScalarType.DOUBLE:case ScalarType.FLOAT:return 0;case ScalarType.BYTES:return new Uint8Array(0);case ScalarType.STRING:return"";default:return 0}}function scalarTypeInfo(n,e){const t=e===void 0;let s=WireType.Varint,a=e===0;switch(n){case ScalarType.STRING:a=t||!e.length,s=WireType.LengthDelimited;break;case ScalarType.BOOL:a=e===!1;break;case ScalarType.DOUBLE:s=WireType.Bit64;break;case ScalarType.FLOAT:s=WireType.Bit32;break;case ScalarType.INT64:a=t||e==0;break;case ScalarType.UINT64:a=t||e==0;break;case ScalarType.FIXED64:a=t||e==0,s=WireType.Bit64;break;case ScalarType.BYTES:a=t||!e.byteLength,s=WireType.LengthDelimited;break;case ScalarType.FIXED32:s=WireType.Bit32;break;case ScalarType.SFIXED32:s=WireType.Bit32;break;case ScalarType.SFIXED64:a=t||e==0,s=WireType.Bit64;break;case ScalarType.SINT64:a=t||e==0;break}const c=ScalarType[n].toLowerCase();return[s,c,t||a]}const unknownFieldsSymbol=Symbol("@bufbuild/protobuf/unknown-fields"),readDefaults={readUnknownFields:!0,readerFactory:n=>new BinaryReader(n)},writeDefaults={writeUnknownFields:!0,writerFactory:()=>new BinaryWriter};function makeReadOptions$1(n){return n?Object.assign(Object.assign({},readDefaults),n):readDefaults}function makeWriteOptions$1(n){return n?Object.assign(Object.assign({},writeDefaults),n):writeDefaults}function makeBinaryFormatCommon(){return{makeReadOptions:makeReadOptions$1,makeWriteOptions:makeWriteOptions$1,listUnknownFields(n){var e;return(e=n[unknownFieldsSymbol])!==null&&e!==void 0?e:[]},discardUnknownFields(n){delete n[unknownFieldsSymbol]},writeUnknownFields(n,e){const s=n[unknownFieldsSymbol];if(s)for(const a of s)e.tag(a.no,a.wireType).raw(a.data)},onUnknownField(n,e,t,s){const a=n;Array.isArray(a[unknownFieldsSymbol])||(a[unknownFieldsSymbol]=[]),a[unknownFieldsSymbol].push({no:e,wireType:t,data:s})},readMessage(n,e,t,s){const a=n.getType(),c=t===void 0?e.len:e.pos+t;for(;e.pos<c;){const[u,d]=e.tag(),m=a.fields.find(u);if(!m){const C=e.skip(d);s.readUnknownFields&&this.onUnknownField(n,u,d,C);continue}let _=n,b=m.repeated,S=m.localName;switch(m.oneof&&(_=_[m.oneof.localName],_.case!=S&&delete _.value,_.case=S,S="value"),m.kind){case"scalar":case"enum":const C=m.kind=="enum"?ScalarType.INT32:m.T;let w=readScalar$1;if(m.kind=="scalar"&&m.L>0&&(w=readScalarLTString),b){let P=_[S];if(d==WireType.LengthDelimited&&C!=ScalarType.STRING&&C!=ScalarType.BYTES){let B=e.uint32()+e.pos;for(;e.pos<B;)P.push(w(e,C))}else P.push(w(e,C))}else _[S]=w(e,C);break;case"message":const O=m.T;b?_[S].push(readMessageField(e,new O,s)):_[S]instanceof Message?readMessageField(e,_[S],s):(_[S]=readMessageField(e,new O,s),O.fieldWrapper&&!m.oneof&&!m.repeated&&(_[S]=O.fieldWrapper.unwrapField(_[S])));break;case"map":let[I,N]=readMapEntry(m,e,s);_[S][I]=N;break}}}}}function readMessageField(n,e,t){return e.getType().runtime.bin.readMessage(e,n,n.uint32(),t),e}function readMapEntry(n,e,t){const s=e.uint32(),a=e.pos+s;let c,u;for(;e.pos<a;){let[d]=e.tag();switch(d){case 1:c=readScalar$1(e,n.K);break;case 2:switch(n.V.kind){case"scalar":u=readScalar$1(e,n.V.T);break;case"enum":u=e.int32();break;case"message":u=readMessageField(e,new n.V.T,t);break}break}}if(c===void 0){let d=scalarDefaultValue(n.K,LongType.BIGINT);c=n.K==ScalarType.BOOL?d.toString():d}if(typeof c!="string"&&typeof c!="number"&&(c=c.toString()),u===void 0)switch(n.V.kind){case"scalar":u=scalarDefaultValue(n.V.T,LongType.BIGINT);break;case"enum":u=0;break;case"message":u=new n.V.T;break}return[c,u]}function readScalarLTString(n,e){const t=readScalar$1(n,e);return typeof t=="bigint"?t.toString():t}function readScalar$1(n,e){switch(e){case ScalarType.STRING:return n.string();case ScalarType.BOOL:return n.bool();case ScalarType.DOUBLE:return n.double();case ScalarType.FLOAT:return n.float();case ScalarType.INT32:return n.int32();case ScalarType.INT64:return n.int64();case ScalarType.UINT64:return n.uint64();case ScalarType.FIXED64:return n.fixed64();case ScalarType.BYTES:return n.bytes();case ScalarType.FIXED32:return n.fixed32();case ScalarType.SFIXED32:return n.sfixed32();case ScalarType.SFIXED64:return n.sfixed64();case ScalarType.SINT64:return n.sint64();case ScalarType.UINT32:return n.uint32();case ScalarType.SINT32:return n.sint32()}}function writeMapEntry(n,e,t,s,a){n.tag(t.no,WireType.LengthDelimited),n.fork();let c=s;switch(t.K){case ScalarType.INT32:case ScalarType.FIXED32:case ScalarType.UINT32:case ScalarType.SFIXED32:case ScalarType.SINT32:c=Number.parseInt(s);break;case ScalarType.BOOL:assert(s=="true"||s=="false"),c=s=="true";break}switch(writeScalar$1(n,t.K,1,c,!0),t.V.kind){case"scalar":writeScalar$1(n,t.V.T,2,a,!0);break;case"enum":writeScalar$1(n,ScalarType.INT32,2,a,!0);break;case"message":writeMessageField(n,e,t.V.T,2,a);break}n.join()}function writeMessageField(n,e,t,s,a){if(a!==void 0){const c=wrapField(t,a);n.tag(s,WireType.LengthDelimited).bytes(c.toBinary(e))}}function writeScalar$1(n,e,t,s,a){let[c,u,d]=scalarTypeInfo(e,s);(!d||a)&&n.tag(t,c)[u](s)}function writePacked(n,e,t,s){if(!s.length)return;n.tag(t,WireType.LengthDelimited).fork();let[,a]=scalarTypeInfo(e);for(let c=0;c<s.length;c++)n[a](s[c]);n.join()}function makeBinaryFormatProto3(){return Object.assign(Object.assign({},makeBinaryFormatCommon()),{writeMessage(n,e,t){const s=n.getType();for(const a of s.fields.byNumber()){let c,u=a.repeated,d=a.localName;if(a.oneof){const m=n[a.oneof.localName];if(m.case!==d)continue;c=m.value}else c=n[d];switch(a.kind){case"scalar":case"enum":let m=a.kind=="enum"?ScalarType.INT32:a.T;if(u)if(a.packed)writePacked(e,m,a.no,c);else for(const _ of c)writeScalar$1(e,m,a.no,_,!0);else c!==void 0&&writeScalar$1(e,m,a.no,c,!!a.oneof||a.opt);break;case"message":if(u)for(const _ of c)writeMessageField(e,t,a.T,a.no,_);else writeMessageField(e,t,a.T,a.no,c);break;case"map":for(const[_,b]of Object.entries(c))writeMapEntry(e,t,a,_,b);break}}return t.writeUnknownFields&&this.writeUnknownFields(n,e),e}})}let encTable="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),decTable=[];for(let n=0;n<encTable.length;n++)decTable[encTable[n].charCodeAt(0)]=n;decTable["-".charCodeAt(0)]=encTable.indexOf("+");decTable["_".charCodeAt(0)]=encTable.indexOf("/");const protoBase64={dec(n){let e=n.length*3/4;n[n.length-2]=="="?e-=2:n[n.length-1]=="="&&(e-=1);let t=new Uint8Array(e),s=0,a=0,c,u=0;for(let d=0;d<n.length;d++){if(c=decTable[n.charCodeAt(d)],c===void 0)switch(n[d]){case"=":a=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(a){case 0:u=c,a=1;break;case 1:t[s++]=u<<2|(c&48)>>4,u=c,a=2;break;case 2:t[s++]=(u&15)<<4|(c&60)>>2,u=c,a=3;break;case 3:t[s++]=(u&3)<<6|c,a=0;break}}if(a==1)throw Error("invalid base64 string.");return t.subarray(0,s)},enc(n){let e="",t=0,s,a=0;for(let c=0;c<n.length;c++)switch(s=n[c],t){case 0:e+=encTable[s>>2],a=(s&3)<<4,t=1;break;case 1:e+=encTable[a|s>>4],a=(s&15)<<2,t=2;break;case 2:e+=encTable[a|s>>6],e+=encTable[s&63],t=0;break}return t&&(e+=encTable[a],e+="=",t==1&&(e+="=")),e}},jsonReadDefaults={ignoreUnknownFields:!1},jsonWriteDefaults={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function makeReadOptions(n){return n?Object.assign(Object.assign({},jsonReadDefaults),n):jsonReadDefaults}function makeWriteOptions(n){return n?Object.assign(Object.assign({},jsonWriteDefaults),n):jsonWriteDefaults}function makeJsonFormatCommon(n){const e=n(writeEnum,writeScalar);return{makeReadOptions,makeWriteOptions,readMessage(t,s,a,c){if(s==null||Array.isArray(s)||typeof s!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(this.debug(s)));c=c??new t;const u={};for(const[d,m]of Object.entries(s)){const _=t.fields.findJsonName(d);if(!_){if(!a.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(d,'" is unknown'));continue}let b=_.localName,S=c;if(_.oneof){if(m===null&&_.kind=="scalar")continue;const C=u[_.oneof.localName];if(C)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(_.oneof.name,'" present: "').concat(C,'", "').concat(d,'"'));u[_.oneof.localName]=d,S=S[_.oneof.localName]={case:b},b="value"}if(_.repeated){if(m===null)continue;if(!Array.isArray(m))throw new Error("cannot decode field ".concat(t.typeName,".").concat(_.name," from JSON: ").concat(this.debug(m)));const C=S[b];for(const w of m){if(w===null)throw new Error("cannot decode field ".concat(t.typeName,".").concat(_.name," from JSON: ").concat(this.debug(w)));let O;switch(_.kind){case"message":O=_.T.fromJson(w,a);break;case"enum":if(O=readEnum(_.T,w,a.ignoreUnknownFields),O===void 0)continue;break;case"scalar":try{O=readScalar(_.T,w,_.L)}catch(I){let N="cannot decode field ".concat(t.typeName,".").concat(_.name," from JSON: ").concat(this.debug(w));throw I instanceof Error&&I.message.length>0&&(N+=": ".concat(I.message)),new Error(N)}break}C.push(O)}}else if(_.kind=="map"){if(m===null)continue;if(Array.isArray(m)||typeof m!="object")throw new Error("cannot decode field ".concat(t.typeName,".").concat(_.name," from JSON: ").concat(this.debug(m)));const C=S[b];for(const[w,O]of Object.entries(m)){if(O===null)throw new Error("cannot decode field ".concat(t.typeName,".").concat(_.name," from JSON: map value null"));let I;switch(_.V.kind){case"message":I=_.V.T.fromJson(O,a);break;case"enum":if(I=readEnum(_.V.T,O,a.ignoreUnknownFields),I===void 0)continue;break;case"scalar":try{I=readScalar(_.V.T,O,LongType.BIGINT)}catch(N){let P="cannot decode map value for field ".concat(t.typeName,".").concat(_.name," from JSON: ").concat(this.debug(m));throw N instanceof Error&&N.message.length>0&&(P+=": ".concat(N.message)),new Error(P)}break}try{C[readScalar(_.K,_.K==ScalarType.BOOL?w=="true"?!0:w=="false"?!1:w:w,LongType.BIGINT).toString()]=I}catch(N){let P="cannot decode map key for field ".concat(t.typeName,".").concat(_.name," from JSON: ").concat(this.debug(m));throw N instanceof Error&&N.message.length>0&&(P+=": ".concat(N.message)),new Error(P)}}}else switch(_.kind){case"message":const C=_.T;if(m===null&&C.typeName!="google.protobuf.Value"){if(_.oneof)throw new Error("cannot decode field ".concat(t.typeName,".").concat(_.name,' from JSON: null is invalid for oneof field "').concat(d,'"'));continue}S[b]instanceof Message?S[b].fromJson(m,a):(S[b]=C.fromJson(m,a),C.fieldWrapper&&!_.oneof&&(S[b]=C.fieldWrapper.unwrapField(S[b])));break;case"enum":const w=readEnum(_.T,m,a.ignoreUnknownFields);w!==void 0&&(S[b]=w);break;case"scalar":try{S[b]=readScalar(_.T,m,_.L)}catch(O){let I="cannot decode field ".concat(t.typeName,".").concat(_.name," from JSON: ").concat(this.debug(m));throw O instanceof Error&&O.message.length>0&&(I+=": ".concat(O.message)),new Error(I)}break}}return c},writeMessage(t,s){const a=t.getType(),c={};let u;try{for(const d of a.fields.byMember()){let m;if(d.kind=="oneof"){const _=t[d.localName];if(_.value===void 0)continue;if(u=d.findField(_.case),!u)throw"oneof case not found: "+_.case;m=e(u,_.value,s)}else u=d,m=e(u,t[u.localName],s);m!==void 0&&(c[s.useProtoFieldName?u.name:u.jsonName]=m)}}catch(d){const m=u?"cannot encode field ".concat(a.typeName,".").concat(u.name," to JSON"):"cannot encode message ".concat(a.typeName," to JSON"),_=d instanceof Error?d.message:String(d);throw new Error(m+(_.length>0?": ".concat(_):""))}return c},readScalar,writeScalar,debug:debugJsonValue}}function debugJsonValue(n){if(n===null)return"null";switch(typeof n){case"object":return Array.isArray(n)?"array":"object";case"string":return n.length>100?"string":'"'.concat(n.split('"').join('\\"'),'"');default:return String(n)}}function readScalar(n,e,t){switch(n){case ScalarType.DOUBLE:case ScalarType.FLOAT:if(e===null)return 0;if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const s=Number(e);if(Number.isNaN(s)||!Number.isFinite(s))break;return n==ScalarType.FLOAT&&assertFloat32(s),s;case ScalarType.INT32:case ScalarType.FIXED32:case ScalarType.SFIXED32:case ScalarType.SINT32:case ScalarType.UINT32:if(e===null)return 0;let a;if(typeof e=="number"?a=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(a=Number(e)),a===void 0)break;return n==ScalarType.UINT32?assertUInt32(a):assertInt32(a),a;case ScalarType.INT64:case ScalarType.SFIXED64:case ScalarType.SINT64:if(e===null)return protoInt64.zero;if(typeof e!="number"&&typeof e!="string")break;const c=protoInt64.parse(e);return t?c.toString():c;case ScalarType.FIXED64:case ScalarType.UINT64:if(e===null)return protoInt64.zero;if(typeof e!="number"&&typeof e!="string")break;const u=protoInt64.uParse(e);return t?u.toString():u;case ScalarType.BOOL:if(e===null)return!1;if(typeof e!="boolean")break;return e;case ScalarType.STRING:if(e===null)return"";if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case ScalarType.BYTES:if(e===null||e==="")return new Uint8Array(0);if(typeof e!="string")break;return protoBase64.dec(e)}throw new Error}function readEnum(n,e,t){if(e===null)return 0;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const s=n.findName(e);if(s||t)return s==null?void 0:s.no;break}throw new Error("cannot decode enum ".concat(n.typeName," from JSON: ").concat(debugJsonValue(e)))}function writeEnum(n,e,t,s){var a;if(e===void 0)return e;if(e===0&&!t)return;if(s)return e;if(n.typeName=="google.protobuf.NullValue")return null;const c=n.findNumber(e);return(a=c==null?void 0:c.name)!==null&&a!==void 0?a:e}function writeScalar(n,e,t){if(e!==void 0)switch(n){case ScalarType.INT32:case ScalarType.SFIXED32:case ScalarType.SINT32:case ScalarType.FIXED32:case ScalarType.UINT32:return assert(typeof e=="number"),e!=0||t?e:void 0;case ScalarType.FLOAT:case ScalarType.DOUBLE:return assert(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e!==0||t?e:void 0;case ScalarType.STRING:return assert(typeof e=="string"),e.length>0||t?e:void 0;case ScalarType.BOOL:return assert(typeof e=="boolean"),e||t?e:void 0;case ScalarType.UINT64:case ScalarType.FIXED64:case ScalarType.INT64:case ScalarType.SFIXED64:case ScalarType.SINT64:return assert(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),t||e!=0?e.toString(10):void 0;case ScalarType.BYTES:return assert(e instanceof Uint8Array),t||e.byteLength>0?protoBase64.enc(e):void 0}}function makeJsonFormatProto3(){return makeJsonFormatCommon((n,e)=>function(s,a,c){if(s.kind=="map"){const u={};switch(s.V.kind){case"scalar":for(const[m,_]of Object.entries(a)){const b=e(s.V.T,_,!0);assert(b!==void 0),u[m.toString()]=b}break;case"message":for(const[m,_]of Object.entries(a))u[m.toString()]=_.toJson(c);break;case"enum":const d=s.V.T;for(const[m,_]of Object.entries(a)){assert(_===void 0||typeof _=="number");const b=n(d,_,!0,c.enumAsInteger);assert(b!==void 0),u[m.toString()]=b}break}return c.emitDefaultValues||Object.keys(u).length>0?u:void 0}else if(s.repeated){const u=[];switch(s.kind){case"scalar":for(let d=0;d<a.length;d++)u.push(e(s.T,a[d],!0));break;case"enum":for(let d=0;d<a.length;d++)u.push(n(s.T,a[d],!0,c.enumAsInteger));break;case"message":for(let d=0;d<a.length;d++)u.push(wrapField(s.T,a[d]).toJson(c));break}return c.emitDefaultValues||u.length>0?u:void 0}else switch(s.kind){case"scalar":return e(s.T,a,!!s.oneof||s.opt||c.emitDefaultValues);case"enum":return n(s.T,a,!!s.oneof||s.opt||c.emitDefaultValues,c.enumAsInteger);case"message":return a!==void 0?wrapField(s.T,a).toJson(c):void 0}})}function makeUtilCommon(){return{setEnumType,initPartial(n,e){if(n===void 0)return;const t=e.getType();for(const s of t.fields.byMember()){const a=s.localName,c=e,u=n;if(u[a]!==void 0)switch(s.kind){case"oneof":const d=u[a].case;if(d===void 0)continue;const m=s.findField(d);let _=u[a].value;m&&m.kind=="message"&&!(_ instanceof m.T)?_=new m.T(_):m&&m.kind==="scalar"&&m.T===ScalarType.BYTES&&(_=toU8Arr(_)),c[a]={case:d,value:_};break;case"scalar":case"enum":let b=u[a];s.T===ScalarType.BYTES&&(b=s.repeated?b.map(toU8Arr):toU8Arr(b)),c[a]=b;break;case"map":switch(s.V.kind){case"scalar":case"enum":if(s.V.T===ScalarType.BYTES)for(const[w,O]of Object.entries(u[a]))c[a][w]=toU8Arr(O);else Object.assign(c[a],u[a]);break;case"message":const C=s.V.T;for(const w of Object.keys(u[a])){let O=u[a][w];C.fieldWrapper||(O=new C(O)),c[a][w]=O}break}break;case"message":const S=s.T;if(s.repeated)c[a]=u[a].map(C=>C instanceof S?C:new S(C));else if(u[a]!==void 0){const C=u[a];S.fieldWrapper?S.typeName==="google.protobuf.BytesValue"?c[a]=toU8Arr(C):c[a]=C:c[a]=C instanceof S?C:new S(C)}break}}},equals(n,e,t){return e===t?!0:!e||!t?!1:n.fields.byMember().every(s=>{const a=e[s.localName],c=t[s.localName];if(s.repeated){if(a.length!==c.length)return!1;switch(s.kind){case"message":return a.every((u,d)=>s.T.equals(u,c[d]));case"scalar":return a.every((u,d)=>scalarEquals(s.T,u,c[d]));case"enum":return a.every((u,d)=>scalarEquals(ScalarType.INT32,u,c[d]))}throw new Error("repeated cannot contain ".concat(s.kind))}switch(s.kind){case"message":return s.T.equals(a,c);case"enum":return scalarEquals(ScalarType.INT32,a,c);case"scalar":return scalarEquals(s.T,a,c);case"oneof":if(a.case!==c.case)return!1;const u=s.findField(a.case);if(u===void 0)return!0;switch(u.kind){case"message":return u.T.equals(a.value,c.value);case"enum":return scalarEquals(ScalarType.INT32,a.value,c.value);case"scalar":return scalarEquals(u.T,a.value,c.value)}throw new Error("oneof cannot contain ".concat(u.kind));case"map":const d=Object.keys(a).concat(Object.keys(c));switch(s.V.kind){case"message":const m=s.V.T;return d.every(b=>m.equals(a[b],c[b]));case"enum":return d.every(b=>scalarEquals(ScalarType.INT32,a[b],c[b]));case"scalar":const _=s.V.T;return d.every(b=>scalarEquals(_,a[b],c[b]))}break}})},clone(n){const e=n.getType(),t=new e,s=t;for(const a of e.fields.byMember()){const c=n[a.localName];let u;if(a.repeated)u=c.map(cloneSingularField);else if(a.kind=="map"){u=s[a.localName];for(const[d,m]of Object.entries(c))u[d]=cloneSingularField(m)}else a.kind=="oneof"?u=a.findField(c.case)?{case:c.case,value:cloneSingularField(c.value)}:{case:void 0}:u=cloneSingularField(c);s[a.localName]=u}return t}}}function cloneSingularField(n){if(n===void 0)return n;if(n instanceof Message)return n.clone();if(n instanceof Uint8Array){const e=new Uint8Array(n.byteLength);return e.set(n),e}return n}function toU8Arr(n){return n instanceof Uint8Array?n:new Uint8Array(n)}class InternalFieldList{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const t={};for(const s of this.list())t[s.jsonName]=t[s.name]=s;this.jsonNames=t}return this.jsonNames[e]}find(e){if(!this.numbers){const t={};for(const s of this.list())t[s.no]=s;this.numbers=t}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const s of this.list())s.oneof?s.oneof!==t&&(t=s.oneof,e.push(t)):e.push(s)}return this.members}}function localFieldName(n,e){const t=protoCamelCase(n);return e?t:safeObjectProperty(safeMessageProperty(t))}function localOneofName(n){return localFieldName(n,!1)}const fieldJsonName=protoCamelCase;function protoCamelCase(n){let e=!1;const t=[];for(let s=0;s<n.length;s++){let a=n.charAt(s);switch(a){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":t.push(a),e=!1;break;default:e&&(e=!1,a=a.toUpperCase()),t.push(a);break}}return t.join("")}const reservedObjectProperties=new Set(["constructor","toString","toJSON","valueOf"]),reservedMessageProperties=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),fallback=n=>"".concat(n,"$"),safeMessageProperty=n=>reservedMessageProperties.has(n)?fallback(n):n,safeObjectProperty=n=>reservedObjectProperties.has(n)?fallback(n):n;class InternalOneofInfo{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=localOneofName(e)}addField(e){assert(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let t=0;t<this.fields.length;t++)this._lookup[this.fields[t].localName]=this.fields[t]}return this._lookup[e]}}const proto3=makeProtoRuntime("proto3",makeJsonFormatProto3(),makeBinaryFormatProto3(),Object.assign(Object.assign({},makeUtilCommon()),{newFieldList(n){return new InternalFieldList(n,normalizeFieldInfosProto3)},initFields(n){for(const e of n.getType().fields.byMember()){if(e.opt)continue;const t=e.localName,s=n;if(e.repeated){s[t]=[];continue}switch(e.kind){case"oneof":s[t]={case:void 0};break;case"enum":s[t]=0;break;case"map":s[t]={};break;case"scalar":s[t]=scalarDefaultValue(e.T,e.L);break}}}}));function normalizeFieldInfosProto3(n){var e,t,s,a;const c=[];let u;for(const d of typeof n=="function"?n():n){const m=d;if(m.localName=localFieldName(d.name,d.oneof!==void 0),m.jsonName=(e=d.jsonName)!==null&&e!==void 0?e:fieldJsonName(d.name),m.repeated=(t=d.repeated)!==null&&t!==void 0?t:!1,d.kind=="scalar"&&(m.L=(s=d.L)!==null&&s!==void 0?s:LongType.BIGINT),m.packed=(a=d.packed)!==null&&a!==void 0?a:d.kind=="enum"||d.kind=="scalar"&&d.T!=ScalarType.BYTES&&d.T!=ScalarType.STRING,d.oneof!==void 0){const _=typeof d.oneof=="string"?d.oneof:d.oneof.name;(!u||u.name!=_)&&(u=new InternalOneofInfo(_)),m.oneof=u,u.addField(m)}c.push(m)}return c}class Timestamp extends Message{constructor(e){super(),this.seconds=protoInt64.zero,this.nanos=0,proto3.util.initPartial(e,this)}fromJson(e,t){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(proto3.json.debug(e)));const s=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!s)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const a=Date.parse(s[1]+"-"+s[2]+"-"+s[3]+"T"+s[4]+":"+s[5]+":"+s[6]+(s[8]?s[8]:"Z"));if(Number.isNaN(a))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(a<Date.parse("0001-01-01T00:00:00Z")||a>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=protoInt64.parse(a/1e3),this.nanos=0,s[7]&&(this.nanos=parseInt("1"+s[7]+"0".repeat(9-s[7].length))-1e9),this}toJson(e){const t=Number(this.seconds)*1e3;if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let s="Z";if(this.nanos>0){const a=(this.nanos+1e9).toString().substring(1);a.substring(3)==="000000"?s="."+a.substring(0,3)+"Z":a.substring(6)==="000"?s="."+a.substring(0,6)+"Z":s="."+a+"Z"}return new Date(t).toISOString().replace(".000Z",s)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Timestamp.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new Timestamp({seconds:protoInt64.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return new Timestamp().fromBinary(e,t)}static fromJson(e,t){return new Timestamp().fromJson(e,t)}static fromJsonString(e,t){return new Timestamp().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(Timestamp,e,t)}}Timestamp.runtime=proto3;Timestamp.typeName="google.protobuf.Timestamp";Timestamp.fields=proto3.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);var AudioCodec$1;(function(n){n[n.DEFAULT_AC=0]="DEFAULT_AC",n[n.OPUS=1]="OPUS",n[n.AAC=2]="AAC"})(AudioCodec$1||(AudioCodec$1={}));proto3.util.setEnumType(AudioCodec$1,"livekit.AudioCodec",[{no:0,name:"DEFAULT_AC"},{no:1,name:"OPUS"},{no:2,name:"AAC"}]);var VideoCodec$1;(function(n){n[n.DEFAULT_VC=0]="DEFAULT_VC",n[n.H264_BASELINE=1]="H264_BASELINE",n[n.H264_MAIN=2]="H264_MAIN",n[n.H264_HIGH=3]="H264_HIGH",n[n.VP8=4]="VP8"})(VideoCodec$1||(VideoCodec$1={}));proto3.util.setEnumType(VideoCodec$1,"livekit.VideoCodec",[{no:0,name:"DEFAULT_VC"},{no:1,name:"H264_BASELINE"},{no:2,name:"H264_MAIN"},{no:3,name:"H264_HIGH"},{no:4,name:"VP8"}]);var ImageCodec$1;(function(n){n[n.IC_DEFAULT=0]="IC_DEFAULT",n[n.IC_JPEG=1]="IC_JPEG"})(ImageCodec$1||(ImageCodec$1={}));proto3.util.setEnumType(ImageCodec$1,"livekit.ImageCodec",[{no:0,name:"IC_DEFAULT"},{no:1,name:"IC_JPEG"}]);var TrackType$1;(function(n){n[n.AUDIO=0]="AUDIO",n[n.VIDEO=1]="VIDEO",n[n.DATA=2]="DATA"})(TrackType$1||(TrackType$1={}));proto3.util.setEnumType(TrackType$1,"livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]);var TrackSource$2;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.CAMERA=1]="CAMERA",n[n.MICROPHONE=2]="MICROPHONE",n[n.SCREEN_SHARE=3]="SCREEN_SHARE",n[n.SCREEN_SHARE_AUDIO=4]="SCREEN_SHARE_AUDIO"})(TrackSource$2||(TrackSource$2={}));proto3.util.setEnumType(TrackSource$2,"livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]);var VideoQuality$1;(function(n){n[n.LOW=0]="LOW",n[n.MEDIUM=1]="MEDIUM",n[n.HIGH=2]="HIGH",n[n.OFF=3]="OFF"})(VideoQuality$1||(VideoQuality$1={}));proto3.util.setEnumType(VideoQuality$1,"livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]);var ConnectionQuality$1;(function(n){n[n.POOR=0]="POOR",n[n.GOOD=1]="GOOD",n[n.EXCELLENT=2]="EXCELLENT",n[n.LOST=3]="LOST"})(ConnectionQuality$1||(ConnectionQuality$1={}));proto3.util.setEnumType(ConnectionQuality$1,"livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]);var ClientConfigSetting$1;(function(n){n[n.UNSET=0]="UNSET",n[n.DISABLED=1]="DISABLED",n[n.ENABLED=2]="ENABLED"})(ClientConfigSetting$1||(ClientConfigSetting$1={}));proto3.util.setEnumType(ClientConfigSetting$1,"livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]);var DisconnectReason$1;(function(n){n[n.UNKNOWN_REASON=0]="UNKNOWN_REASON",n[n.CLIENT_INITIATED=1]="CLIENT_INITIATED",n[n.DUPLICATE_IDENTITY=2]="DUPLICATE_IDENTITY",n[n.SERVER_SHUTDOWN=3]="SERVER_SHUTDOWN",n[n.PARTICIPANT_REMOVED=4]="PARTICIPANT_REMOVED",n[n.ROOM_DELETED=5]="ROOM_DELETED",n[n.STATE_MISMATCH=6]="STATE_MISMATCH",n[n.JOIN_FAILURE=7]="JOIN_FAILURE"})(DisconnectReason$1||(DisconnectReason$1={}));proto3.util.setEnumType(DisconnectReason$1,"livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"}]);var ReconnectReason$1;(function(n){n[n.RR_UNKNOWN=0]="RR_UNKNOWN",n[n.RR_SIGNAL_DISCONNECTED=1]="RR_SIGNAL_DISCONNECTED",n[n.RR_PUBLISHER_FAILED=2]="RR_PUBLISHER_FAILED",n[n.RR_SUBSCRIBER_FAILED=3]="RR_SUBSCRIBER_FAILED",n[n.RR_SWITCH_CANDIDATE=4]="RR_SWITCH_CANDIDATE"})(ReconnectReason$1||(ReconnectReason$1={}));proto3.util.setEnumType(ReconnectReason$1,"livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]);var SubscriptionError$1;(function(n){n[n.SE_UNKNOWN=0]="SE_UNKNOWN",n[n.SE_CODEC_UNSUPPORTED=1]="SE_CODEC_UNSUPPORTED",n[n.SE_TRACK_NOTFOUND=2]="SE_TRACK_NOTFOUND"})(SubscriptionError$1||(SubscriptionError$1={}));proto3.util.setEnumType(SubscriptionError$1,"livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]);let Room$1=class Ce extends Message{constructor(e){super(),this.sid="",this.name="",this.emptyTimeout=0,this.maxParticipants=0,this.creationTime=protoInt64.zero,this.turnPassword="",this.enabledCodecs=[],this.metadata="",this.numParticipants=0,this.numPublishers=0,this.activeRecording=!1,proto3.util.initPartial(e,this)}static fromBinary(e,t){return new Ce().fromBinary(e,t)}static fromJson(e,t){return new Ce().fromJson(e,t)}static fromJsonString(e,t){return new Ce().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(Ce,e,t)}};Room$1.runtime=proto3;Room$1.typeName="livekit.Room";Room$1.fields=proto3.util.newFieldList(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Codec,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8}]);class Codec extends Message{constructor(e){super(),this.mime="",this.fmtpLine="",proto3.util.initPartial(e,this)}static fromBinary(e,t){return new Codec().fromBinary(e,t)}static fromJson(e,t){return new Codec().fromJson(e,t)}static fromJsonString(e,t){return new Codec().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(Codec,e,t)}}Codec.runtime=proto3;Codec.typeName="livekit.Codec";Codec.fields=proto3.util.newFieldList(()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]);class PlayoutDelay extends Message{constructor(e){super(),this.enabled=!1,this.min=0,this.max=0,proto3.util.initPartial(e,this)}static fromBinary(e,t){return new PlayoutDelay().fromBinary(e,t)}static fromJson(e,t){return new PlayoutDelay().fromJson(e,t)}static fromJsonString(e,t){return new PlayoutDelay().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(PlayoutDelay,e,t)}}PlayoutDelay.runtime=proto3;PlayoutDelay.typeName="livekit.PlayoutDelay";PlayoutDelay.fields=proto3.util.newFieldList(()=>[{no:1,name:"enabled",kind:"scalar",T:8},{no:2,name:"min",kind:"scalar",T:13},{no:3,name:"max",kind:"scalar",T:13}]);class ParticipantPermission extends Message{constructor(e){super(),this.canSubscribe=!1,this.canPublish=!1,this.canPublishData=!1,this.canPublishSources=[],this.hidden=!1,this.recorder=!1,this.canUpdateMetadata=!1,this.agent=!1,proto3.util.initPartial(e,this)}static fromBinary(e,t){return new ParticipantPermission().fromBinary(e,t)}static fromJson(e,t){return new ParticipantPermission().fromJson(e,t)}static fromJsonString(e,t){return new ParticipantPermission().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(ParticipantPermission,e,t)}}ParticipantPermission.runtime=proto3;ParticipantPermission.typeName="livekit.ParticipantPermission";ParticipantPermission.fields=proto3.util.newFieldList(()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:proto3.getEnumType(TrackSource$2),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8}]);class ParticipantInfo extends Message{constructor(e){super(),this.sid="",this.identity="",this.state=ParticipantInfo_State$1.JOINING,this.tracks=[],this.metadata="",this.joinedAt=protoInt64.zero,this.name="",this.version=0,this.region="",this.isPublisher=!1,proto3.util.initPartial(e,this)}static fromBinary(e,t){return new ParticipantInfo().fromBinary(e,t)}static fromJson(e,t){return new ParticipantInfo().fromJson(e,t)}static fromJsonString(e,t){return new ParticipantInfo().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(ParticipantInfo,e,t)}}ParticipantInfo.runtime=proto3;ParticipantInfo.typeName="livekit.ParticipantInfo";ParticipantInfo.fields=proto3.util.newFieldList(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:proto3.getEnumType(ParticipantInfo_State$1)},{no:4,name:"tracks",kind:"message",T:TrackInfo,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:ParticipantPermission},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8}]);var ParticipantInfo_State$1;(function(n){n[n.JOINING=0]="JOINING",n[n.JOINED=1]="JOINED",n[n.ACTIVE=2]="ACTIVE",n[n.DISCONNECTED=3]="DISCONNECTED"})(ParticipantInfo_State$1||(ParticipantInfo_State$1={}));proto3.util.setEnumType(ParticipantInfo_State$1,"livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]);class Encryption extends Message{constructor(e){super(),proto3.util.initPartial(e,this)}static fromBinary(e,t){return new Encryption().fromBinary(e,t)}static fromJson(e,t){return new Encryption().fromJson(e,t)}static fromJsonString(e,t){return new Encryption().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(Encryption,e,t)}}Encryption.runtime=proto3;Encryption.typeName="livekit.Encryption";Encryption.fields=proto3.util.newFieldList(()=>[]);var Encryption_Type$1;(function(n){n[n.NONE=0]="NONE",n[n.GCM=1]="GCM",n[n.CUSTOM=2]="CUSTOM"})(Encryption_Type$1||(Encryption_Type$1={}));proto3.util.setEnumType(Encryption_Type$1,"livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]);class SimulcastCodecInfo extends Message{constructor(e){super(),this.mimeType="",this.mid="",this.cid="",this.layers=[],proto3.util.initPartial(e,this)}static fromBinary(e,t){return new SimulcastCodecInfo().fromBinary(e,t)}static fromJson(e,t){return new SimulcastCodecInfo().fromJson(e,t)}static fromJsonString(e,t){return new SimulcastCodecInfo().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(SimulcastCodecInfo,e,t)}}SimulcastCodecInfo.runtime=proto3;SimulcastCodecInfo.typeName="livekit.SimulcastCodecInfo";SimulcastCodecInfo.fields=proto3.util.newFieldList(()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:VideoLayer,repeated:!0}]);class TrackInfo extends Message{constructor(e){super(),this.sid="",this.type=TrackType$1.AUDIO,this.name="",this.muted=!1,this.width=0,this.height=0,this.simulcast=!1,this.disableDtx=!1,this.source=TrackSource$2.UNKNOWN,this.layers=[],this.mimeType="",this.mid="",this.codecs=[],this.stereo=!1,this.disableRed=!1,this.encryption=Encryption_Type$1.NONE,this.stream="",proto3.util.initPartial(e,this)}static fromBinary(e,t){return new TrackInfo().fromBinary(e,t)}static fromJson(e,t){return new TrackInfo().fromJson(e,t)}static fromJsonString(e,t){return new TrackInfo().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(TrackInfo,e,t)}}TrackInfo.runtime=proto3;TrackInfo.typeName="livekit.TrackInfo";TrackInfo.fields=proto3.util.newFieldList(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:proto3.getEnumType(TrackType$1)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:proto3.getEnumType(TrackSource$2)},{no:10,name:"layers",kind:"message",T:VideoLayer,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:SimulcastCodecInfo,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:proto3.getEnumType(Encryption_Type$1)},{no:17,name:"stream",kind:"scalar",T:9}]);class VideoLayer extends Message{constructor(e){super(),this.quality=VideoQuality$1.LOW,this.width=0,this.height=0,this.bitrate=0,this.ssrc=0,proto3.util.initPartial(e,this)}static fromBinary(e,t){return new VideoLayer().fromBinary(e,t)}static fromJson(e,t){return new VideoLayer().fromJson(e,t)}static fromJsonString(e,t){return new VideoLayer().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(VideoLayer,e,t)}}VideoLayer.runtime=proto3;VideoLayer.typeName="livekit.VideoLayer";VideoLayer.fields=proto3.util.newFieldList(()=>[{no:1,name:"quality",kind:"enum",T:proto3.getEnumType(VideoQuality$1)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]);class DataPacket extends Message{constructor(e){super(),this.kind=DataPacket_Kind$1.RELIABLE,this.value={case:void 0},proto3.util.initPartial(e,this)}static fromBinary(e,t){return new DataPacket().fromBinary(e,t)}static fromJson(e,t){return new DataPacket().fromJson(e,t)}static fromJsonString(e,t){return new DataPacket().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(DataPacket,e,t)}}DataPacket.runtime=proto3;DataPacket.typeName="livekit.DataPacket";DataPacket.fields=proto3.util.newFieldList(()=>[{no:1,name:"kind",kind:"enum",T:proto3.getEnumType(DataPacket_Kind$1)},{no:2,name:"user",kind:"message",T:UserPacket,oneof:"value"},{no:3,name:"speaker",kind:"message",T:ActiveSpeakerUpdate,oneof:"value"}]);var DataPacket_Kind$1;(function(n){n[n.RELIABLE=0]="RELIABLE",n[n.LOSSY=1]="LOSSY"})(DataPacket_Kind$1||(DataPacket_Kind$1={}));proto3.util.setEnumType(DataPacket_Kind$1,"livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]);class ActiveSpeakerUpdate extends Message{constructor(e){super(),this.speakers=[],proto3.util.initPartial(e,this)}static fromBinary(e,t){return new ActiveSpeakerUpdate().fromBinary(e,t)}static fromJson(e,t){return new ActiveSpeakerUpdate().fromJson(e,t)}static fromJsonString(e,t){return new ActiveSpeakerUpdate().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(ActiveSpeakerUpdate,e,t)}}ActiveSpeakerUpdate.runtime=proto3;ActiveSpeakerUpdate.typeName="livekit.ActiveSpeakerUpdate";ActiveSpeakerUpdate.fields=proto3.util.newFieldList(()=>[{no:1,name:"speakers",kind:"message",T:SpeakerInfo,repeated:!0}]);class SpeakerInfo extends Message{constructor(e){super(),this.sid="",this.level=0,this.active=!1,proto3.util.initPartial(e,this)}static fromBinary(e,t){return new SpeakerInfo().fromBinary(e,t)}static fromJson(e,t){return new SpeakerInfo().fromJson(e,t)}static fromJsonString(e,t){return new SpeakerInfo().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(SpeakerInfo,e,t)}}SpeakerInfo.runtime=proto3;SpeakerInfo.typeName="livekit.SpeakerInfo";SpeakerInfo.fields=proto3.util.newFieldList(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]);class UserPacket extends Message{constructor(e){super(),this.participantSid="",this.participantIdentity="",this.payload=new Uint8Array(0),this.destinationSids=[],this.destinationIdentities=[],proto3.util.initPartial(e,this)}static fromBinary(e,t){return new UserPacket().fromBinary(e,t)}static fromJson(e,t){return new UserPacket().fromJson(e,t)}static fromJsonString(e,t){return new UserPacket().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(UserPacket,e,t)}}UserPacket.runtime=proto3;UserPacket.typeName="livekit.UserPacket";UserPacket.fields=proto3.util.newFieldList(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0}]);class ParticipantTracks extends Message{constructor(e){super(),this.participantSid="",this.trackSids=[],proto3.util.initPartial(e,this)}static fromBinary(e,t){return new ParticipantTracks().fromBinary(e,t)}static fromJson(e,t){return new ParticipantTracks().fromJson(e,t)}static fromJsonString(e,t){return new ParticipantTracks().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(ParticipantTracks,e,t)}}ParticipantTracks.runtime=proto3;ParticipantTracks.typeName="livekit.ParticipantTracks";ParticipantTracks.fields=proto3.util.newFieldList(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]);class ServerInfo extends Message{constructor(e){super(),this.edition=ServerInfo_Edition$1.Standard,this.version="",this.protocol=0,this.region="",this.nodeId="",this.debugInfo="",proto3.util.initPartial(e,this)}static fromBinary(e,t){return new ServerInfo().fromBinary(e,t)}static fromJson(e,t){return new ServerInfo().fromJson(e,t)}static fromJsonString(e,t){return new ServerInfo().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(ServerInfo,e,t)}}ServerInfo.runtime=proto3;ServerInfo.typeName="livekit.ServerInfo";ServerInfo.fields=proto3.util.newFieldList(()=>[{no:1,name:"edition",kind:"enum",T:proto3.getEnumType(ServerInfo_Edition$1)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9}]);var ServerInfo_Edition$1;(function(n){n[n.Standard=0]="Standard",n[n.Cloud=1]="Cloud"})(ServerInfo_Edition$1||(ServerInfo_Edition$1={}));proto3.util.setEnumType(ServerInfo_Edition$1,"livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]);class ClientInfo extends Message{constructor(e){super(),this.sdk=ClientInfo_SDK$1.UNKNOWN,this.version="",this.protocol=0,this.os="",this.osVersion="",this.deviceModel="",this.browser="",this.browserVersion="",this.address="",this.network="",proto3.util.initPartial(e,this)}static fromBinary(e,t){return new ClientInfo().fromBinary(e,t)}static fromJson(e,t){return new ClientInfo().fromJson(e,t)}static fromJsonString(e,t){return new ClientInfo().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(ClientInfo,e,t)}}ClientInfo.runtime=proto3;ClientInfo.typeName="livekit.ClientInfo";ClientInfo.fields=proto3.util.newFieldList(()=>[{no:1,name:"sdk",kind:"enum",T:proto3.getEnumType(ClientInfo_SDK$1)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9}]);var ClientInfo_SDK$1;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.JS=1]="JS",n[n.SWIFT=2]="SWIFT",n[n.ANDROID=3]="ANDROID",n[n.FLUTTER=4]="FLUTTER",n[n.GO=5]="GO",n[n.UNITY=6]="UNITY",n[n.REACT_NATIVE=7]="REACT_NATIVE",n[n.RUST=8]="RUST",n[n.PYTHON=9]="PYTHON",n[n.CPP=10]="CPP"})(ClientInfo_SDK$1||(ClientInfo_SDK$1={}));proto3.util.setEnumType(ClientInfo_SDK$1,"livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"}]);class ClientConfiguration extends Message{constructor(e){super(),this.resumeConnection=ClientConfigSetting$1.UNSET,this.forceRelay=ClientConfigSetting$1.UNSET,proto3.util.initPartial(e,this)}static fromBinary(e,t){return new ClientConfiguration().fromBinary(e,t)}static fromJson(e,t){return new ClientConfiguration().fromJson(e,t)}static fromJsonString(e,t){return new ClientConfiguration().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(ClientConfiguration,e,t)}}ClientConfiguration.runtime=proto3;ClientConfiguration.typeName="livekit.ClientConfiguration";ClientConfiguration.fields=proto3.util.newFieldList(()=>[{no:1,name:"video",kind:"message",T:VideoConfiguration},{no:2,name:"screen",kind:"message",T:VideoConfiguration},{no:3,name:"resume_connection",kind:"enum",T:proto3.getEnumType(ClientConfigSetting$1)},{no:4,name:"disabled_codecs",kind:"message",T:DisabledCodecs},{no:5,name:"force_relay",kind:"enum",T:proto3.getEnumType(ClientConfigSetting$1)}]);class VideoConfiguration extends Message{constructor(e){super(),this.hardwareEncoder=ClientConfigSetting$1.UNSET,proto3.util.initPartial(e,this)}static fromBinary(e,t){return new VideoConfiguration().fromBinary(e,t)}static fromJson(e,t){return new VideoConfiguration().fromJson(e,t)}static fromJsonString(e,t){return new VideoConfiguration().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(VideoConfiguration,e,t)}}VideoConfiguration.runtime=proto3;VideoConfiguration.typeName="livekit.VideoConfiguration";VideoConfiguration.fields=proto3.util.newFieldList(()=>[{no:1,name:"hardware_encoder",kind:"enum",T:proto3.getEnumType(ClientConfigSetting$1)}]);class DisabledCodecs extends Message{constructor(e){super(),this.codecs=[],this.publish=[],proto3.util.initPartial(e,this)}static fromBinary(e,t){return new DisabledCodecs().fromBinary(e,t)}static fromJson(e,t){return new DisabledCodecs().fromJson(e,t)}static fromJsonString(e,t){return new DisabledCodecs().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(DisabledCodecs,e,t)}}DisabledCodecs.runtime=proto3;DisabledCodecs.typeName="livekit.DisabledCodecs";DisabledCodecs.fields=proto3.util.newFieldList(()=>[{no:1,name:"codecs",kind:"message",T:Codec,repeated:!0},{no:2,name:"publish",kind:"message",T:Codec,repeated:!0}]);class RTPDrift extends Message{constructor(e){super(),this.duration=0,this.startTimestamp=protoInt64.zero,this.endTimestamp=protoInt64.zero,this.rtpClockTicks=protoInt64.zero,this.driftSamples=protoInt64.zero,this.driftMs=0,this.clockRate=0,proto3.util.initPartial(e,this)}static fromBinary(e,t){return new RTPDrift().fromBinary(e,t)}static fromJson(e,t){return new RTPDrift().fromJson(e,t)}static fromJsonString(e,t){return new RTPDrift().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(RTPDrift,e,t)}}RTPDrift.runtime=proto3;RTPDrift.typeName="livekit.RTPDrift";RTPDrift.fields=proto3.util.newFieldList(()=>[{no:1,name:"start_time",kind:"message",T:Timestamp},{no:2,name:"end_time",kind:"message",T:Timestamp},{no:3,name:"duration",kind:"scalar",T:1},{no:4,name:"start_timestamp",kind:"scalar",T:4},{no:5,name:"end_timestamp",kind:"scalar",T:4},{no:6,name:"rtp_clock_ticks",kind:"scalar",T:4},{no:7,name:"drift_samples",kind:"scalar",T:3},{no:8,name:"drift_ms",kind:"scalar",T:1},{no:9,name:"clock_rate",kind:"scalar",T:1}]);class RTPStats extends Message{constructor(e){super(),this.duration=0,this.packets=0,this.packetRate=0,this.bytes=protoInt64.zero,this.headerBytes=protoInt64.zero,this.bitrate=0,this.packetsLost=0,this.packetLossRate=0,this.packetLossPercentage=0,this.packetsDuplicate=0,this.packetDuplicateRate=0,this.bytesDuplicate=protoInt64.zero,this.headerBytesDuplicate=protoInt64.zero,this.bitrateDuplicate=0,this.packetsPadding=0,this.packetPaddingRate=0,this.bytesPadding=protoInt64.zero,this.headerBytesPadding=protoInt64.zero,this.bitratePadding=0,this.packetsOutOfOrder=0,this.frames=0,this.frameRate=0,this.jitterCurrent=0,this.jitterMax=0,this.gapHistogram={},this.nacks=0,this.nackAcks=0,this.nackMisses=0,this.nackRepeated=0,this.plis=0,this.firs=0,this.rttCurrent=0,this.rttMax=0,this.keyFrames=0,this.layerLockPlis=0,proto3.util.initPartial(e,this)}static fromBinary(e,t){return new RTPStats().fromBinary(e,t)}static fromJson(e,t){return new RTPStats().fromJson(e,t)}static fromJsonString(e,t){return new RTPStats().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(RTPStats,e,t)}}RTPStats.runtime=proto3;RTPStats.typeName="livekit.RTPStats";RTPStats.fields=proto3.util.newFieldList(()=>[{no:1,name:"start_time",kind:"message",T:Timestamp},{no:2,name:"end_time",kind:"message",T:Timestamp},{no:3,name:"duration",kind:"scalar",T:1},{no:4,name:"packets",kind:"scalar",T:13},{no:5,name:"packet_rate",kind:"scalar",T:1},{no:6,name:"bytes",kind:"scalar",T:4},{no:39,name:"header_bytes",kind:"scalar",T:4},{no:7,name:"bitrate",kind:"scalar",T:1},{no:8,name:"packets_lost",kind:"scalar",T:13},{no:9,name:"packet_loss_rate",kind:"scalar",T:1},{no:10,name:"packet_loss_percentage",kind:"scalar",T:2},{no:11,name:"packets_duplicate",kind:"scalar",T:13},{no:12,name:"packet_duplicate_rate",kind:"scalar",T:1},{no:13,name:"bytes_duplicate",kind:"scalar",T:4},{no:40,name:"header_bytes_duplicate",kind:"scalar",T:4},{no:14,name:"bitrate_duplicate",kind:"scalar",T:1},{no:15,name:"packets_padding",kind:"scalar",T:13},{no:16,name:"packet_padding_rate",kind:"scalar",T:1},{no:17,name:"bytes_padding",kind:"scalar",T:4},{no:41,name:"header_bytes_padding",kind:"scalar",T:4},{no:18,name:"bitrate_padding",kind:"scalar",T:1},{no:19,name:"packets_out_of_order",kind:"scalar",T:13},{no:20,name:"frames",kind:"scalar",T:13},{no:21,name:"frame_rate",kind:"scalar",T:1},{no:22,name:"jitter_current",kind:"scalar",T:1},{no:23,name:"jitter_max",kind:"scalar",T:1},{no:24,name:"gap_histogram",kind:"map",K:5,V:{kind:"scalar",T:13}},{no:25,name:"nacks",kind:"scalar",T:13},{no:37,name:"nack_acks",kind:"scalar",T:13},{no:26,name:"nack_misses",kind:"scalar",T:13},{no:38,name:"nack_repeated",kind:"scalar",T:13},{no:27,name:"plis",kind:"scalar",T:13},{no:28,name:"last_pli",kind:"message",T:Timestamp},{no:29,name:"firs",kind:"scalar",T:13},{no:30,name:"last_fir",kind:"message",T:Timestamp},{no:31,name:"rtt_current",kind:"scalar",T:13},{no:32,name:"rtt_max",kind:"scalar",T:13},{no:33,name:"key_frames",kind:"scalar",T:13},{no:34,name:"last_key_frame",kind:"message",T:Timestamp},{no:35,name:"layer_lock_plis",kind:"scalar",T:13},{no:36,name:"last_layer_lock_pli",kind:"message",T:Timestamp},{no:44,name:"packet_drift",kind:"message",T:RTPDrift},{no:45,name:"report_drift",kind:"message",T:RTPDrift}]);class TimedVersion extends Message{constructor(e){super(),this.unixMicro=protoInt64.zero,this.ticks=0,proto3.util.initPartial(e,this)}static fromBinary(e,t){return new TimedVersion().fromBinary(e,t)}static fromJson(e,t){return new TimedVersion().fromJson(e,t)}static fromJsonString(e,t){return new TimedVersion().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(TimedVersion,e,t)}}TimedVersion.runtime=proto3;TimedVersion.typeName="livekit.TimedVersion";TimedVersion.fields=proto3.util.newFieldList(()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]);const maxRetryDelay=7e3,DEFAULT_RETRY_DELAYS_IN_MS=[0,300,2*2*300,3*3*300,4*4*300,maxRetryDelay,maxRetryDelay,maxRetryDelay,maxRetryDelay,maxRetryDelay];class DefaultReconnectPolicy{constructor(e){this._retryDelays=e!==void 0?[...e]:DEFAULT_RETRY_DELAYS_IN_MS}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+Math.random()*1e3}}function __awaiter(n,e,t,s){function a(c){return c instanceof t?c:new t(function(u){u(c)})}return new(t||(t=Promise))(function(c,u){function d(b){try{_(s.next(b))}catch(S){u(S)}}function m(b){try{_(s.throw(b))}catch(S){u(S)}}function _(b){b.done?c(b.value):a(b.value).then(d,m)}_((s=s.apply(n,e||[])).next())})}function __values(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],s=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function __asyncValues(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof __values=="function"?__values(n):n[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(c){t[c]=n[c]&&function(u){return new Promise(function(d,m){u=n[c](u),a(d,m,u.done,u.value)})}}function a(c,u,d,m){Promise.resolve(m).then(function(_){c({value:_,done:d})},u)}}typeof SuppressedError=="function"&&SuppressedError;var events$1={exports:{}},R$1=typeof Reflect=="object"?Reflect:null,ReflectApply$1=R$1&&typeof R$1.apply=="function"?R$1.apply:function(e,t,s){return Function.prototype.apply.call(e,t,s)},ReflectOwnKeys$1;R$1&&typeof R$1.ownKeys=="function"?ReflectOwnKeys$1=R$1.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys$1=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:ReflectOwnKeys$1=function(e){return Object.getOwnPropertyNames(e)};function ProcessEmitWarning$1(n){console&&console.warn&&console.warn(n)}var NumberIsNaN$1=Number.isNaN||function(e){return e!==e};function EventEmitter$1(){EventEmitter$1.init.call(this)}events$1.exports=EventEmitter$1;events$1.exports.once=once$3;EventEmitter$1.EventEmitter=EventEmitter$1;EventEmitter$1.prototype._events=void 0;EventEmitter$1.prototype._eventsCount=0;EventEmitter$1.prototype._maxListeners=void 0;var defaultMaxListeners$1=10;function checkListener$1(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(EventEmitter$1,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners$1},set:function(n){if(typeof n!="number"||n<0||NumberIsNaN$1(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");defaultMaxListeners$1=n}});EventEmitter$1.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter$1.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||NumberIsNaN$1(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function _getMaxListeners$1(n){return n._maxListeners===void 0?EventEmitter$1.defaultMaxListeners:n._maxListeners}EventEmitter$1.prototype.getMaxListeners=function(){return _getMaxListeners$1(this)};EventEmitter$1.prototype.emit=function(e){for(var t=[],s=1;s<arguments.length;s++)t.push(arguments[s]);var a=e==="error",c=this._events;if(c!==void 0)a=a&&c.error===void 0;else if(!a)return!1;if(a){var u;if(t.length>0&&(u=t[0]),u instanceof Error)throw u;var d=new Error("Unhandled error."+(u?" ("+u.message+")":""));throw d.context=u,d}var m=c[e];if(m===void 0)return!1;if(typeof m=="function")ReflectApply$1(m,this,t);else for(var _=m.length,b=arrayClone$1(m,_),s=0;s<_;++s)ReflectApply$1(b[s],this,t);return!0};function _addListener$1(n,e,t,s){var a,c,u;if(checkListener$1(t),c=n._events,c===void 0?(c=n._events=Object.create(null),n._eventsCount=0):(c.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),c=n._events),u=c[e]),u===void 0)u=c[e]=t,++n._eventsCount;else if(typeof u=="function"?u=c[e]=s?[t,u]:[u,t]:s?u.unshift(t):u.push(t),a=_getMaxListeners$1(n),a>0&&u.length>a&&!u.warned){u.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=n,d.type=e,d.count=u.length,ProcessEmitWarning$1(d)}return n}EventEmitter$1.prototype.addListener=function(e,t){return _addListener$1(this,e,t,!1)};EventEmitter$1.prototype.on=EventEmitter$1.prototype.addListener;EventEmitter$1.prototype.prependListener=function(e,t){return _addListener$1(this,e,t,!0)};function onceWrapper$1(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap$1(n,e,t){var s={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},a=onceWrapper$1.bind(s);return a.listener=t,s.wrapFn=a,a}EventEmitter$1.prototype.once=function(e,t){return checkListener$1(t),this.on(e,_onceWrap$1(this,e,t)),this};EventEmitter$1.prototype.prependOnceListener=function(e,t){return checkListener$1(t),this.prependListener(e,_onceWrap$1(this,e,t)),this};EventEmitter$1.prototype.removeListener=function(e,t){var s,a,c,u,d;if(checkListener$1(t),a=this._events,a===void 0)return this;if(s=a[e],s===void 0)return this;if(s===t||s.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete a[e],a.removeListener&&this.emit("removeListener",e,s.listener||t));else if(typeof s!="function"){for(c=-1,u=s.length-1;u>=0;u--)if(s[u]===t||s[u].listener===t){d=s[u].listener,c=u;break}if(c<0)return this;c===0?s.shift():spliceOne$1(s,c),s.length===1&&(a[e]=s[0]),a.removeListener!==void 0&&this.emit("removeListener",e,d||t)}return this};EventEmitter$1.prototype.off=EventEmitter$1.prototype.removeListener;EventEmitter$1.prototype.removeAllListeners=function(e){var t,s,a;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[e]),this;if(arguments.length===0){var c=Object.keys(s),u;for(a=0;a<c.length;++a)u=c[a],u!=="removeListener"&&this.removeAllListeners(u);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=s[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(a=t.length-1;a>=0;a--)this.removeListener(e,t[a]);return this};function _listeners$1(n,e,t){var s=n._events;if(s===void 0)return[];var a=s[e];return a===void 0?[]:typeof a=="function"?t?[a.listener||a]:[a]:t?unwrapListeners$1(a):arrayClone$1(a,a.length)}EventEmitter$1.prototype.listeners=function(e){return _listeners$1(this,e,!0)};EventEmitter$1.prototype.rawListeners=function(e){return _listeners$1(this,e,!1)};EventEmitter$1.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):listenerCount$1.call(n,e)};EventEmitter$1.prototype.listenerCount=listenerCount$1;function listenerCount$1(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}EventEmitter$1.prototype.eventNames=function(){return this._eventsCount>0?ReflectOwnKeys$1(this._events):[]};function arrayClone$1(n,e){for(var t=new Array(e),s=0;s<e;++s)t[s]=n[s];return t}function spliceOne$1(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function unwrapListeners$1(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function once$3(n,e){return new Promise(function(t,s){function a(u){n.removeListener(e,c),s(u)}function c(){typeof n.removeListener=="function"&&n.removeListener("error",a),t([].slice.call(arguments))}eventTargetAgnosticAddListener$1(n,e,c,{once:!0}),e!=="error"&&addErrorHandlerIfEventEmitter$1(n,a,{once:!0})})}function addErrorHandlerIfEventEmitter$1(n,e,t){typeof n.on=="function"&&eventTargetAgnosticAddListener$1(n,"error",e,t)}function eventTargetAgnosticAddListener$1(n,e,t,s){if(typeof n.on=="function")s.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function a(c){s.once&&n.removeEventListener(e,a),t(c)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var eventsExports$1=events$1.exports;let logDisabled_=!0,deprecationWarnings_=!0;function extractVersion(n,e,t){const s=n.match(e);return s&&s.length>=t&&parseInt(s[t],10)}function wrapPeerConnectionEvent(n,e,t){if(!n.RTCPeerConnection)return;const s=n.RTCPeerConnection.prototype,a=s.addEventListener;s.addEventListener=function(u,d){if(u!==e)return a.apply(this,arguments);const m=_=>{const b=t(_);b&&(d.handleEvent?d.handleEvent(b):d(b))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(d,m),a.apply(this,[u,m])};const c=s.removeEventListener;s.removeEventListener=function(u,d){if(u!==e||!this._eventMap||!this._eventMap[e])return c.apply(this,arguments);if(!this._eventMap[e].has(d))return c.apply(this,arguments);const m=this._eventMap[e].get(d);return this._eventMap[e].delete(d),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,c.apply(this,[u,m])},Object.defineProperty(s,"on"+e,{get(){return this["_on"+e]},set(u){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),u&&this.addEventListener(e,this["_on"+e]=u)},enumerable:!0,configurable:!0})}function disableLog(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(logDisabled_=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function disableWarnings(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(deprecationWarnings_=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function log(){if(typeof window=="object"){if(logDisabled_)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function deprecated(n,e){deprecationWarnings_&&console.warn(n+" is deprecated, please use "+e+" instead.")}function detectBrowser(n){const e={browser:null,version:null};if(typeof n>"u"||!n.navigator||!n.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:t}=n;if(t.mozGetUserMedia)e.browser="firefox",e.version=extractVersion(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection)e.browser="chrome",e.version=extractVersion(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function isObject$1(n){return Object.prototype.toString.call(n)==="[object Object]"}function compactObject(n){return isObject$1(n)?Object.keys(n).reduce(function(e,t){const s=isObject$1(n[t]),a=s?compactObject(n[t]):n[t],c=s&&!Object.keys(a).length;return a===void 0||c?e:Object.assign(e,{[t]:a})},{}):n}function walkStats(n,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(s=>{s.endsWith("Id")?walkStats(n,n.get(e[s]),t):s.endsWith("Ids")&&e[s].forEach(a=>{walkStats(n,n.get(a),t)})}))}function filterStats(n,e,t){const s=t?"outbound-rtp":"inbound-rtp",a=new Map;if(e===null)return a;const c=[];return n.forEach(u=>{u.type==="track"&&u.trackIdentifier===e.id&&c.push(u)}),c.forEach(u=>{n.forEach(d=>{d.type===s&&d.trackId===u.id&&walkStats(n,d,a)})}),a}const logging=log;function shimGetUserMedia$2(n,e){const t=n&&n.navigator;if(!t.mediaDevices)return;const s=function(d){if(typeof d!="object"||d.mandatory||d.optional)return d;const m={};return Object.keys(d).forEach(_=>{if(_==="require"||_==="advanced"||_==="mediaSource")return;const b=typeof d[_]=="object"?d[_]:{ideal:d[_]};b.exact!==void 0&&typeof b.exact=="number"&&(b.min=b.max=b.exact);const S=function(C,w){return C?C+w.charAt(0).toUpperCase()+w.slice(1):w==="deviceId"?"sourceId":w};if(b.ideal!==void 0){m.optional=m.optional||[];let C={};typeof b.ideal=="number"?(C[S("min",_)]=b.ideal,m.optional.push(C),C={},C[S("max",_)]=b.ideal,m.optional.push(C)):(C[S("",_)]=b.ideal,m.optional.push(C))}b.exact!==void 0&&typeof b.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[S("",_)]=b.exact):["min","max"].forEach(C=>{b[C]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[S(C,_)]=b[C])})}),d.advanced&&(m.optional=(m.optional||[]).concat(d.advanced)),m},a=function(d,m){if(e.version>=61)return m(d);if(d=JSON.parse(JSON.stringify(d)),d&&typeof d.audio=="object"){const _=function(b,S,C){S in b&&!(C in b)&&(b[C]=b[S],delete b[S])};d=JSON.parse(JSON.stringify(d)),_(d.audio,"autoGainControl","googAutoGainControl"),_(d.audio,"noiseSuppression","googNoiseSuppression"),d.audio=s(d.audio)}if(d&&typeof d.video=="object"){let _=d.video.facingMode;_=_&&(typeof _=="object"?_:{ideal:_});const b=e.version<66;if(_&&(_.exact==="user"||_.exact==="environment"||_.ideal==="user"||_.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!b)){delete d.video.facingMode;let S;if(_.exact==="environment"||_.ideal==="environment"?S=["back","rear"]:(_.exact==="user"||_.ideal==="user")&&(S=["front"]),S)return t.mediaDevices.enumerateDevices().then(C=>{C=C.filter(O=>O.kind==="videoinput");let w=C.find(O=>S.some(I=>O.label.toLowerCase().includes(I)));return!w&&C.length&&S.includes("back")&&(w=C[C.length-1]),w&&(d.video.deviceId=_.exact?{exact:w.deviceId}:{ideal:w.deviceId}),d.video=s(d.video),logging("chrome: "+JSON.stringify(d)),m(d)})}d.video=s(d.video)}return logging("chrome: "+JSON.stringify(d)),m(d)},c=function(d){return e.version>=64?d:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[d.name]||d.name,message:d.message,constraint:d.constraint||d.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},u=function(d,m,_){a(d,b=>{t.webkitGetUserMedia(b,m,S=>{_&&_(c(S))})})};if(t.getUserMedia=u.bind(t),t.mediaDevices.getUserMedia){const d=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(m){return a(m,_=>d(_).then(b=>{if(_.audio&&!b.getAudioTracks().length||_.video&&!b.getVideoTracks().length)throw b.getTracks().forEach(S=>{S.stop()}),new DOMException("","NotFoundError");return b},b=>Promise.reject(c(b))))}}}function shimGetDisplayMedia$1(n,e){if(!(n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices)&&n.navigator.mediaDevices){if(typeof e!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}n.navigator.mediaDevices.getDisplayMedia=function(s){return e(s).then(a=>{const c=s.video&&s.video.width,u=s.video&&s.video.height,d=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:d||3}},c&&(s.video.mandatory.maxWidth=c),u&&(s.video.mandatory.maxHeight=u),n.navigator.mediaDevices.getUserMedia(s)})}}}function shimMediaStream(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function shimOnTrack$1(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",a=>{let c;n.RTCPeerConnection.prototype.getReceivers?c=this.getReceivers().find(d=>d.track&&d.track.id===a.track.id):c={track:a.track};const u=new Event("track");u.track=a.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[s.stream],this.dispatchEvent(u)}),s.stream.getTracks().forEach(a=>{let c;n.RTCPeerConnection.prototype.getReceivers?c=this.getReceivers().find(d=>d.track&&d.track.id===a.id):c={track:a};const u=new Event("track");u.track=a,u.receiver=c,u.transceiver={receiver:c},u.streams=[s.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else wrapPeerConnectionEvent(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function shimGetSendersWithDtmf(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(a,c){return{track:c,get dtmf(){return this._dtmf===void 0&&(c.kind==="audio"?this._dtmf=a.createDTMFSender(c):this._dtmf=null),this._dtmf},_pc:a}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const a=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(d,m){let _=a.apply(this,arguments);return _||(_=e(this,d),this._senders.push(_)),_};const c=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(d){c.apply(this,arguments);const m=this._senders.indexOf(d);m!==-1&&this._senders.splice(m,1)}}const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],t.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(e(this,u))})};const s=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(u=>{const d=this._senders.find(m=>m.track===u);d&&this._senders.splice(this._senders.indexOf(d),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(a=>a._pc=this),s},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function shimGetStats(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[s,a,c]=arguments;if(arguments.length>0&&typeof s=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof s!="function"))return e.apply(this,[]);const u=function(m){const _={};return m.result().forEach(S=>{const C={id:S.id,timestamp:S.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[S.type]||S.type};S.names().forEach(w=>{C[w]=S.stat(w)}),_[C.id]=C}),_},d=function(m){return new Map(Object.keys(m).map(_=>[_,m[_]]))};if(arguments.length>=2){const m=function(_){a(d(u(_)))};return e.apply(this,[m,s])}return new Promise((m,_)=>{e.apply(this,[function(b){m(d(u(b)))},_])}).then(a,c)}}function shimSenderReceiverGetStats(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const c=t.apply(this,[]);return c.forEach(u=>u._pc=this),c});const s=n.RTCPeerConnection.prototype.addTrack;s&&(n.RTCPeerConnection.prototype.addTrack=function(){const c=s.apply(this,arguments);return c._pc=this,c}),n.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>filterStats(u,c.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const a=t.apply(this,[]);return a.forEach(c=>c._pc=this),a}),wrapPeerConnectionEvent(n,"track",s=>(s.receiver._pc=s.srcElement,s)),n.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(c=>filterStats(c,a.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const s=arguments[0];let a,c,u;return this.getSenders().forEach(d=>{d.track===s&&(a?u=!0:a=d)}),this.getReceivers().forEach(d=>(d.track===s&&(c?u=!0:c=d),d.track===s)),u||a&&c?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():c?c.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function shimAddTrackRemoveTrackWithNative(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(u,d){if(!d)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=e.apply(this,arguments);return this._shimmedLocalStreams[d.id]?this._shimmedLocalStreams[d.id].indexOf(m)===-1&&this._shimmedLocalStreams[d.id].push(m):this._shimmedLocalStreams[d.id]=[d,m],m};const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(_=>{if(this.getSenders().find(S=>S.track===_))throw new DOMException("Track already exists.","InvalidAccessError")});const d=this.getSenders();t.apply(this,arguments);const m=this.getSenders().filter(_=>d.indexOf(_)===-1);this._shimmedLocalStreams[u.id]=[u].concat(m)};const s=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],s.apply(this,arguments)};const a=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(d=>{const m=this._shimmedLocalStreams[d].indexOf(u);m!==-1&&this._shimmedLocalStreams[d].splice(m,1),this._shimmedLocalStreams[d].length===1&&delete this._shimmedLocalStreams[d]}),a.apply(this,arguments)}}function shimAddTrackRemoveTrack(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return shimAddTrackRemoveTrackWithNative(n);const t=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const b=t.apply(this);return this._reverseStreams=this._reverseStreams||{},b.map(S=>this._reverseStreams[S.id])};const s=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(b){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},b.getTracks().forEach(S=>{if(this.getSenders().find(w=>w.track===S))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[b.id]){const S=new n.MediaStream(b.getTracks());this._streams[b.id]=S,this._reverseStreams[S.id]=b,b=S}s.apply(this,[b])};const a=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(b){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},a.apply(this,[this._streams[b.id]||b]),delete this._reverseStreams[this._streams[b.id]?this._streams[b.id].id:b.id],delete this._streams[b.id]},n.RTCPeerConnection.prototype.addTrack=function(b,S){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const C=[].slice.call(arguments,1);if(C.length!==1||!C[0].getTracks().find(I=>I===b))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(I=>I.track===b))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const O=this._streams[S.id];if(O)O.addTrack(b),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const I=new n.MediaStream([b]);this._streams[S.id]=I,this._reverseStreams[I.id]=S,this.addStream(I)}return this.getSenders().find(I=>I.track===b)};function c(_,b){let S=b.sdp;return Object.keys(_._reverseStreams||[]).forEach(C=>{const w=_._reverseStreams[C],O=_._streams[w.id];S=S.replace(new RegExp(O.id,"g"),w.id)}),new RTCSessionDescription({type:b.type,sdp:S})}function u(_,b){let S=b.sdp;return Object.keys(_._reverseStreams||[]).forEach(C=>{const w=_._reverseStreams[C],O=_._streams[w.id];S=S.replace(new RegExp(w.id,"g"),O.id)}),new RTCSessionDescription({type:b.type,sdp:S})}["createOffer","createAnswer"].forEach(function(_){const b=n.RTCPeerConnection.prototype[_],S={[_](){const C=arguments;return arguments.length&&typeof arguments[0]=="function"?b.apply(this,[O=>{const I=c(this,O);C[0].apply(null,[I])},O=>{C[1]&&C[1].apply(null,O)},arguments[2]]):b.apply(this,arguments).then(O=>c(this,O))}};n.RTCPeerConnection.prototype[_]=S[_]});const d=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?d.apply(this,arguments):(arguments[0]=u(this,arguments[0]),d.apply(this,arguments))};const m=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const _=m.get.apply(this);return _.type===""?_:c(this,_)}}),n.RTCPeerConnection.prototype.removeTrack=function(b){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!b._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(b._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let C;Object.keys(this._streams).forEach(w=>{this._streams[w].getTracks().find(I=>b.track===I)&&(C=this._streams[w])}),C&&(C.getTracks().length===1?this.removeStream(this._reverseStreams[C.id]):C.removeTrack(b.track),this.dispatchEvent(new Event("negotiationneeded")))}}function shimPeerConnection$1(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const s=n.RTCPeerConnection.prototype[t],a={[t](){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};n.RTCPeerConnection.prototype[t]=a[t]})}function fixNegotiationNeeded(n,e){wrapPeerConnectionEvent(n,"negotiationneeded",t=>{const s=t.target;if(!((e.version<72||s.getConfiguration&&s.getConfiguration().sdpSemantics==="plan-b")&&s.signalingState!=="stable"))return t})}var chromeShim=Object.freeze({__proto__:null,fixNegotiationNeeded,shimAddTrackRemoveTrack,shimAddTrackRemoveTrackWithNative,shimGetDisplayMedia:shimGetDisplayMedia$1,shimGetSendersWithDtmf,shimGetStats,shimGetUserMedia:shimGetUserMedia$2,shimMediaStream,shimOnTrack:shimOnTrack$1,shimPeerConnection:shimPeerConnection$1,shimSenderReceiverGetStats});function shimGetUserMedia$1(n,e){const t=n&&n.navigator,s=n&&n.MediaStreamTrack;if(t.getUserMedia=function(a,c,u){deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(a).then(c,u)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const a=function(u,d,m){d in u&&!(m in u)&&(u[m]=u[d],delete u[d])},c=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(u){return typeof u=="object"&&typeof u.audio=="object"&&(u=JSON.parse(JSON.stringify(u)),a(u.audio,"autoGainControl","mozAutoGainControl"),a(u.audio,"noiseSuppression","mozNoiseSuppression")),c(u)},s&&s.prototype.getSettings){const u=s.prototype.getSettings;s.prototype.getSettings=function(){const d=u.apply(this,arguments);return a(d,"mozAutoGainControl","autoGainControl"),a(d,"mozNoiseSuppression","noiseSuppression"),d}}if(s&&s.prototype.applyConstraints){const u=s.prototype.applyConstraints;s.prototype.applyConstraints=function(d){return this.kind==="audio"&&typeof d=="object"&&(d=JSON.parse(JSON.stringify(d)),a(d,"autoGainControl","mozAutoGainControl"),a(d,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[d])}}}}function shimGetDisplayMedia(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(s){if(!(s&&s.video)){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,Promise.reject(a)}return s.video===!0?s.video={mediaSource:e}:s.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(s)})}function shimOnTrack(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function shimPeerConnection(n,e){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){const c=n.RTCPeerConnection.prototype[a],u={[a](){return arguments[0]=new(a==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}};n.RTCPeerConnection.prototype[a]=u[a]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[c,u,d]=arguments;return s.apply(this,[c||null]).then(m=>{if(e.version<53&&!u)try{m.forEach(_=>{_.type=t[_.type]||_.type})}catch(_){if(_.name!=="TypeError")throw _;m.forEach((b,S)=>{m.set(S,Object.assign({},b,{type:t[b.type]||b.type}))})}return m}).then(u,d)}}function shimSenderGetStats(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const a=e.apply(this,[]);return a.forEach(c=>c._pc=this),a});const t=n.RTCPeerConnection.prototype.addTrack;t&&(n.RTCPeerConnection.prototype.addTrack=function(){const a=t.apply(this,arguments);return a._pc=this,a}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function shimReceiverGetStats(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const s=e.apply(this,[]);return s.forEach(a=>a._pc=this),s}),wrapPeerConnectionEvent(n,"track",t=>(t.receiver._pc=t.srcElement,t)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function shimRemoveStream(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){deprecated("removeStream","removeTrack"),this.getSenders().forEach(s=>{s.track&&t.getTracks().includes(s.track)&&this.removeTrack(s)})})}function shimRTCDataChannel(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function shimAddTransceiver(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const a=s.length>0;a&&s.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=e.apply(this,arguments);if(a){const{sender:u}=c,d=u.getParameters();(!("encodings"in d)||d.encodings.length===1&&Object.keys(d.encodings[0]).length===0)&&(d.encodings=s,u.sendEncodings=s,this.setParametersPromises.push(u.setParameters(d).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function shimGetParameters(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const s=e.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function shimCreateOffer(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function shimCreateAnswer(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var firefoxShim=Object.freeze({__proto__:null,shimAddTransceiver,shimCreateAnswer,shimCreateOffer,shimGetDisplayMedia,shimGetParameters,shimGetUserMedia:shimGetUserMedia$1,shimOnTrack,shimPeerConnection,shimRTCDataChannel,shimReceiverGetStats,shimRemoveStream,shimSenderGetStats});function shimLocalStreamsAPI(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(s){this._localStreams||(this._localStreams=[]),this._localStreams.includes(s)||this._localStreams.push(s),s.getAudioTracks().forEach(a=>e.call(this,a,s)),s.getVideoTracks().forEach(a=>e.call(this,a,s))},n.RTCPeerConnection.prototype.addTrack=function(s){for(var a=arguments.length,c=new Array(a>1?a-1:0),u=1;u<a;u++)c[u-1]=arguments[u];return c&&c.forEach(d=>{this._localStreams?this._localStreams.includes(d)||this._localStreams.push(d):this._localStreams=[d]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(t);if(s===-1)return;this._localStreams.splice(s,1);const a=t.getTracks();this.getSenders().forEach(c=>{a.includes(c.track)&&this.removeTrack(c)})})}}function shimRemoteStreamsAPI(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach(a=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(a))return;this._remoteStreams.push(a);const c=new Event("addstream");c.stream=a,this.dispatchEvent(c)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(c=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(c)>=0)return;s._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,s.dispatchEvent(u)})}),e.apply(s,arguments)}}}function shimCallbacksAPI(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,t=e.createOffer,s=e.createAnswer,a=e.setLocalDescription,c=e.setRemoteDescription,u=e.addIceCandidate;e.createOffer=function(_,b){const S=arguments.length>=2?arguments[2]:arguments[0],C=t.apply(this,[S]);return b?(C.then(_,b),Promise.resolve()):C},e.createAnswer=function(_,b){const S=arguments.length>=2?arguments[2]:arguments[0],C=s.apply(this,[S]);return b?(C.then(_,b),Promise.resolve()):C};let d=function(m,_,b){const S=a.apply(this,[m]);return b?(S.then(_,b),Promise.resolve()):S};e.setLocalDescription=d,d=function(m,_,b){const S=c.apply(this,[m]);return b?(S.then(_,b),Promise.resolve()):S},e.setRemoteDescription=d,d=function(m,_,b){const S=u.apply(this,[m]);return b?(S.then(_,b),Promise.resolve()):S},e.addIceCandidate=d}function shimGetUserMedia(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,s=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=a=>s(shimConstraints(a))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(s,a,c){e.mediaDevices.getUserMedia(s).then(a,c)}).bind(e))}function shimConstraints(n){return n&&n.video!==void 0?Object.assign({},n,{video:compactObject(n.video)}):n}function shimRTCIceServerUrls(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(s,a){if(s&&s.iceServers){const c=[];for(let u=0;u<s.iceServers.length;u++){let d=s.iceServers[u];d.urls===void 0&&d.url?(deprecated("RTCIceServer.url","RTCIceServer.urls"),d=JSON.parse(JSON.stringify(d)),d.urls=d.url,delete d.url,c.push(d)):c.push(s.iceServers[u])}s.iceServers=c}return new e(s,a)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function shimTrackEventTransceiver(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function shimCreateOfferLegacy(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(s){if(s){typeof s.offerToReceiveAudio<"u"&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const a=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):s.offerToReceiveAudio===!0&&!a&&this.addTransceiver("audio",{direction:"recvonly"}),typeof s.offerToReceiveVideo<"u"&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):s.offerToReceiveVideo===!0&&!c&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function shimAudioContext(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}var safariShim=Object.freeze({__proto__:null,shimAudioContext,shimCallbacksAPI,shimConstraints,shimCreateOfferLegacy,shimGetUserMedia,shimLocalStreamsAPI,shimRTCIceServerUrls,shimRemoteStreamsAPI,shimTrackEventTransceiver}),sdp$1={exports:{}};(function(n){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(s=>s.trim())},e.splitSections=function(t){return t.split(`
m=`).map((a,c)=>(c>0?"m="+a:a).trim()+`\r
`)},e.getDescription=function(t){const s=e.splitSections(t);return s&&s[0]},e.getMediaSections=function(t){const s=e.splitSections(t);return s.shift(),s},e.matchPrefix=function(t,s){return e.splitLines(t).filter(a=>a.indexOf(s)===0)},e.parseCandidate=function(t){let s;t.indexOf("a=candidate:")===0?s=t.substring(12).split(" "):s=t.substring(10).split(" ");const a={foundation:s[0],component:{1:"rtp",2:"rtcp"}[s[1]]||s[1],protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]};for(let c=8;c<s.length;c+=2)switch(s[c]){case"raddr":a.relatedAddress=s[c+1];break;case"rport":a.relatedPort=parseInt(s[c+1],10);break;case"tcptype":a.tcpType=s[c+1];break;case"ufrag":a.ufrag=s[c+1],a.usernameFragment=s[c+1];break;default:a[s[c]]===void 0&&(a[s[c]]=s[c+1]);break}return a},e.writeCandidate=function(t){const s=[];s.push(t.foundation);const a=t.component;a==="rtp"?s.push(1):a==="rtcp"?s.push(2):s.push(a),s.push(t.protocol.toUpperCase()),s.push(t.priority),s.push(t.address||t.ip),s.push(t.port);const c=t.type;return s.push("typ"),s.push(c),c!=="host"&&t.relatedAddress&&t.relatedPort&&(s.push("raddr"),s.push(t.relatedAddress),s.push("rport"),s.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(s.push("tcptype"),s.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(s.push("ufrag"),s.push(t.usernameFragment||t.ufrag)),"candidate:"+s.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let s=t.substring(9).split(" ");const a={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),a.name=s[0],a.clockRate=parseInt(s[1],10),a.channels=s.length===3?parseInt(s[2],10):1,a.numChannels=a.channels,a},e.writeRtpMap=function(t){let s=t.payloadType;t.preferredPayloadType!==void 0&&(s=t.preferredPayloadType);const a=t.channels||t.numChannels||1;return"a=rtpmap:"+s+" "+t.name+"/"+t.clockRate+(a!==1?"/"+a:"")+`\r
`},e.parseExtmap=function(t){const s=t.substring(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1],attributes:s.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`},e.parseFmtp=function(t){const s={};let a;const c=t.substring(t.indexOf(" ")+1).split(";");for(let u=0;u<c.length;u++)a=c[u].trim().split("="),s[a[0].trim()]=a[1];return s},e.writeFmtp=function(t){let s="",a=t.payloadType;if(t.preferredPayloadType!==void 0&&(a=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const c=[];Object.keys(t.parameters).forEach(u=>{t.parameters[u]!==void 0?c.push(u+"="+t.parameters[u]):c.push(u)}),s+="a=fmtp:"+a+" "+c.join(";")+`\r
`}return s},e.parseRtcpFb=function(t){const s=t.substring(t.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},e.writeRtcpFb=function(t){let s="",a=t.payloadType;return t.preferredPayloadType!==void 0&&(a=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(c=>{s+="a=rtcp-fb:"+a+" "+c.type+(c.parameter&&c.parameter.length?" "+c.parameter:"")+`\r
`}),s},e.parseSsrcMedia=function(t){const s=t.indexOf(" "),a={ssrc:parseInt(t.substring(7,s),10)},c=t.indexOf(":",s);return c>-1?(a.attribute=t.substring(s+1,c),a.value=t.substring(c+1)):a.attribute=t.substring(s+1),a},e.parseSsrcGroup=function(t){const s=t.substring(13).split(" ");return{semantics:s.shift(),ssrcs:s.map(a=>parseInt(a,10))}},e.getMid=function(t){const s=e.matchPrefix(t,"a=mid:")[0];if(s)return s.substring(6)},e.parseFingerprint=function(t){const s=t.substring(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1].toUpperCase()}},e.getDtlsParameters=function(t,s){return{role:"auto",fingerprints:e.matchPrefix(t+s,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,s){let a="a=setup:"+s+`\r
`;return t.fingerprints.forEach(c=>{a+="a=fingerprint:"+c.algorithm+" "+c.value+`\r
`}),a},e.parseCryptoLine=function(t){const s=t.substring(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;const s=t.substring(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,s){return e.matchPrefix(t+s,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,s){const a=e.matchPrefix(t+s,"a=ice-ufrag:")[0],c=e.matchPrefix(t+s,"a=ice-pwd:")[0];return a&&c?{usernameFragment:a.substring(12),password:c.substring(10)}:null},e.writeIceParameters=function(t){let s="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(s+=`a=ice-lite\r
`),s},e.parseRtpParameters=function(t){const s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=e.splitLines(t)[0].split(" ");s.profile=c[2];for(let d=3;d<c.length;d++){const m=c[d],_=e.matchPrefix(t,"a=rtpmap:"+m+" ")[0];if(_){const b=e.parseRtpMap(_),S=e.matchPrefix(t,"a=fmtp:"+m+" ");switch(b.parameters=S.length?e.parseFmtp(S[0]):{},b.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+m+" ").map(e.parseRtcpFb),s.codecs.push(b),b.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(b.name.toUpperCase());break}}}e.matchPrefix(t,"a=extmap:").forEach(d=>{s.headerExtensions.push(e.parseExtmap(d))});const u=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return s.codecs.forEach(d=>{u.forEach(m=>{d.rtcpFeedback.find(b=>b.type===m.type&&b.parameter===m.parameter)||d.rtcpFeedback.push(m)})}),s},e.writeRtpDescription=function(t,s){let a="";a+="m="+t+" ",a+=s.codecs.length>0?"9":"0",a+=" "+(s.profile||"UDP/TLS/RTP/SAVPF")+" ",a+=s.codecs.map(u=>u.preferredPayloadType!==void 0?u.preferredPayloadType:u.payloadType).join(" ")+`\r
`,a+=`c=IN IP4 0.0.0.0\r
`,a+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,s.codecs.forEach(u=>{a+=e.writeRtpMap(u),a+=e.writeFmtp(u),a+=e.writeRtcpFb(u)});let c=0;return s.codecs.forEach(u=>{u.maxptime>c&&(c=u.maxptime)}),c>0&&(a+="a=maxptime:"+c+`\r
`),s.headerExtensions&&s.headerExtensions.forEach(u=>{a+=e.writeExtmap(u)}),a},e.parseRtpEncodingParameters=function(t){const s=[],a=e.parseRtpParameters(t),c=a.fecMechanisms.indexOf("RED")!==-1,u=a.fecMechanisms.indexOf("ULPFEC")!==-1,d=e.matchPrefix(t,"a=ssrc:").map(C=>e.parseSsrcMedia(C)).filter(C=>C.attribute==="cname"),m=d.length>0&&d[0].ssrc;let _;const b=e.matchPrefix(t,"a=ssrc-group:FID").map(C=>C.substring(17).split(" ").map(O=>parseInt(O,10)));b.length>0&&b[0].length>1&&b[0][0]===m&&(_=b[0][1]),a.codecs.forEach(C=>{if(C.name.toUpperCase()==="RTX"&&C.parameters.apt){let w={ssrc:m,codecPayloadType:parseInt(C.parameters.apt,10)};m&&_&&(w.rtx={ssrc:_}),s.push(w),c&&(w=JSON.parse(JSON.stringify(w)),w.fec={ssrc:m,mechanism:u?"red+ulpfec":"red"},s.push(w))}}),s.length===0&&m&&s.push({ssrc:m});let S=e.matchPrefix(t,"b=");return S.length&&(S[0].indexOf("b=TIAS:")===0?S=parseInt(S[0].substring(7),10):S[0].indexOf("b=AS:")===0?S=parseInt(S[0].substring(5),10)*1e3*.95-50*40*8:S=void 0,s.forEach(C=>{C.maxBitrate=S})),s},e.parseRtcpParameters=function(t){const s={},a=e.matchPrefix(t,"a=ssrc:").map(d=>e.parseSsrcMedia(d)).filter(d=>d.attribute==="cname")[0];a&&(s.cname=a.value,s.ssrc=a.ssrc);const c=e.matchPrefix(t,"a=rtcp-rsize");s.reducedSize=c.length>0,s.compound=c.length===0;const u=e.matchPrefix(t,"a=rtcp-mux");return s.mux=u.length>0,s},e.writeRtcpParameters=function(t){let s="";return t.reducedSize&&(s+=`a=rtcp-rsize\r
`),t.mux&&(s+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(s+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),s},e.parseMsid=function(t){let s;const a=e.matchPrefix(t,"a=msid:");if(a.length===1)return s=a[0].substring(7).split(" "),{stream:s[0],track:s[1]};const c=e.matchPrefix(t,"a=ssrc:").map(u=>e.parseSsrcMedia(u)).filter(u=>u.attribute==="msid");if(c.length>0)return s=c[0].value.split(" "),{stream:s[0],track:s[1]}},e.parseSctpDescription=function(t){const s=e.parseMLine(t),a=e.matchPrefix(t,"a=max-message-size:");let c;a.length>0&&(c=parseInt(a[0].substring(19),10)),isNaN(c)&&(c=65536);const u=e.matchPrefix(t,"a=sctp-port:");if(u.length>0)return{port:parseInt(u[0].substring(12),10),protocol:s.fmt,maxMessageSize:c};const d=e.matchPrefix(t,"a=sctpmap:");if(d.length>0){const m=d[0].substring(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:c}}},e.writeSctpDescription=function(t,s){let a=[];return t.protocol!=="DTLS/SCTP"?a=["m="+t.kind+" 9 "+t.protocol+" "+s.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+s.port+`\r
`]:a=["m="+t.kind+" 9 "+t.protocol+" "+s.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+s.port+" "+s.protocol+` 65535\r
`],s.maxMessageSize!==void 0&&a.push("a=max-message-size:"+s.maxMessageSize+`\r
`),a.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,s,a){let c;const u=s!==void 0?s:2;return t?c=t:c=e.generateSessionId(),`v=0\r
o=`+(a||"thisisadapterortc")+" "+c+" "+u+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(t,s){const a=e.splitLines(t);for(let c=0;c<a.length;c++)switch(a[c]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[c].substring(2)}return s?e.getDirection(s):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){const a=e.splitLines(t)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},e.parseOLine=function(t){const a=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;const s=e.splitLines(t);for(let a=0;a<s.length;a++)if(s[a].length<2||s[a].charAt(1)!=="=")return!1;return!0},n.exports=e})(sdp$1);var sdpExports=sdp$1.exports,SDPUtils=getDefaultExportFromCjs(sdpExports),sdp=_mergeNamespaces({__proto__:null,default:SDPUtils},[sdpExports]);function shimRTCIceCandidate(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&(s=JSON.parse(JSON.stringify(s)),s.candidate=s.candidate.substring(2)),s.candidate&&s.candidate.length){const a=new e(s),c=SDPUtils.parseCandidate(s.candidate);for(const u in c)u in a||Object.defineProperty(a,u,{value:c[u]});return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new e(s)},n.RTCIceCandidate.prototype=e.prototype,wrapPeerConnectionEvent(n,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t))}function shimRTCIceCandidateRelayProtocol(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||wrapPeerConnectionEvent(n,"icecandidate",e=>{if(e.candidate){const t=SDPUtils.parseCandidate(e.candidate.candidate);t.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function shimMaxMessageSize(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(d){if(!d||!d.sdp)return!1;const m=SDPUtils.splitSections(d.sdp);return m.shift(),m.some(_=>{const b=SDPUtils.parseMLine(_);return b&&b.kind==="application"&&b.protocol.indexOf("SCTP")!==-1})},s=function(d){const m=d.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(m===null||m.length<2)return-1;const _=parseInt(m[1],10);return _!==_?-1:_},a=function(d){let m=65536;return e.browser==="firefox"&&(e.version<57?d===-1?m=16384:m=2147483637:e.version<60?m=e.version===57?65535:65536:m=2147483637),m},c=function(d,m){let _=65536;e.browser==="firefox"&&e.version===57&&(_=65535);const b=SDPUtils.matchPrefix(d.sdp,"a=max-message-size:");return b.length>0?_=parseInt(b[0].substring(19),10):e.browser==="firefox"&&m!==-1&&(_=2147483637),_},u=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const m=s(arguments[0]),_=a(m),b=c(arguments[0],m);let S;_===0&&b===0?S=Number.POSITIVE_INFINITY:_===0||b===0?S=Math.max(_,b):S=Math.min(_,b);const C={};Object.defineProperty(C,"maxMessageSize",{get(){return S}}),this._sctp=C}return u.apply(this,arguments)}}function shimSendThrowTypeError(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function e(s,a){const c=s.send;s.send=function(){const d=arguments[0],m=d.length||d.size||d.byteLength;if(s.readyState==="open"&&a.sctp&&m>a.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+a.sctp.maxMessageSize+" bytes)");return c.apply(s,arguments)}}const t=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const a=t.apply(this,arguments);return e(a,this),a},wrapPeerConnectionEvent(n,"datachannel",s=>(e(s.channel,s.target),s))}function shimConnectionState(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const s=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=a=>{const c=a.target;if(c._lastConnectionState!==c.connectionState){c._lastConnectionState=c.connectionState;const u=new Event("connectionstatechange",a);c.dispatchEvent(u)}return a},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function removeExtmapAllowMixed(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&a.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=a.sdp.split(`
`).filter(u=>u.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&a instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:a.type,sdp:c}):a.sdp=c}return t.apply(this,arguments)}}function shimAddIceCandidateNullOrEmpty(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function shimParameterlessSetLocalDescription(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.setLocalDescription;!t||t.length===0||(n.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if(typeof a!="object"||a.type&&a.sdp)return t.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer";break}return a.sdp||a.type!=="offer"&&a.type!=="answer"?t.apply(this,[a]):(a.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(u=>t.apply(this,[u]))})}var commonShim=Object.freeze({__proto__:null,removeExtmapAllowMixed,shimAddIceCandidateNullOrEmpty,shimConnectionState,shimMaxMessageSize,shimParameterlessSetLocalDescription,shimRTCIceCandidate,shimRTCIceCandidateRelayProtocol,shimSendThrowTypeError});function adapterFactory(){let{window:n}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const t=log,s=detectBrowser(n),a={browserDetails:s,commonShim,extractVersion,disableLog,disableWarnings,sdp};switch(s.browser){case"chrome":if(!chromeShim||!shimPeerConnection$1||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),a;if(s.version===null)return t("Chrome shim can not determine version, not shimming."),a;t("adapter.js shimming chrome."),a.browserShim=chromeShim,shimAddIceCandidateNullOrEmpty(n,s),shimParameterlessSetLocalDescription(n),shimGetUserMedia$2(n,s),shimMediaStream(n),shimPeerConnection$1(n,s),shimOnTrack$1(n),shimAddTrackRemoveTrack(n,s),shimGetSendersWithDtmf(n),shimGetStats(n),shimSenderReceiverGetStats(n),fixNegotiationNeeded(n,s),shimRTCIceCandidate(n),shimRTCIceCandidateRelayProtocol(n),shimConnectionState(n),shimMaxMessageSize(n,s),shimSendThrowTypeError(n),removeExtmapAllowMixed(n,s);break;case"firefox":if(!firefoxShim||!shimPeerConnection||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),a;t("adapter.js shimming firefox."),a.browserShim=firefoxShim,shimAddIceCandidateNullOrEmpty(n,s),shimParameterlessSetLocalDescription(n),shimGetUserMedia$1(n,s),shimPeerConnection(n,s),shimOnTrack(n),shimRemoveStream(n),shimSenderGetStats(n),shimReceiverGetStats(n),shimRTCDataChannel(n),shimAddTransceiver(n),shimGetParameters(n),shimCreateOffer(n),shimCreateAnswer(n),shimRTCIceCandidate(n),shimConnectionState(n),shimMaxMessageSize(n,s),shimSendThrowTypeError(n);break;case"safari":if(!safariShim||!e.shimSafari)return t("Safari shim is not included in this adapter release."),a;t("adapter.js shimming safari."),a.browserShim=safariShim,shimAddIceCandidateNullOrEmpty(n,s),shimParameterlessSetLocalDescription(n),shimRTCIceServerUrls(n),shimCreateOfferLegacy(n),shimCallbacksAPI(n),shimLocalStreamsAPI(n),shimRemoteStreamsAPI(n),shimTrackEventTransceiver(n),shimGetUserMedia(n),shimAudioContext(n),shimRTCIceCandidate(n),shimRTCIceCandidateRelayProtocol(n),shimMaxMessageSize(n,s),shimSendThrowTypeError(n),removeExtmapAllowMixed(n,s);break;default:t("Unsupported browser!");break}return a}adapterFactory({window:typeof window>"u"?void 0:window});const DECRYPTION_FAILURE_TOLERANCE=10,E2EE_FLAG="lk_e2ee",SALT="LKFrameEncryptionKey",KEY_PROVIDER_DEFAULTS={sharedKey:!1,ratchetSalt:SALT,ratchetWindowSize:8,failureTolerance:DECRYPTION_FAILURE_TOLERANCE};var KeyProviderEvent;(function(n){n.SetKey="setKey",n.RatchetRequest="ratchetRequest",n.KeyRatcheted="keyRatcheted"})(KeyProviderEvent||(KeyProviderEvent={}));var KeyHandlerEvent;(function(n){n.KeyRatcheted="keyRatcheted"})(KeyHandlerEvent||(KeyHandlerEvent={}));var EncryptionEvent;(function(n){n.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",n.EncryptionError="encryptionError"})(EncryptionEvent||(EncryptionEvent={}));var CryptorEvent;(function(n){n.Error="cryptorError"})(CryptorEvent||(CryptorEvent={}));function isE2EESupported(){return isInsertableStreamSupported()||isScriptTransformSupported()}function isScriptTransformSupported(){return typeof window.RTCRtpScriptTransform<"u"}function isInsertableStreamSupported(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}class BaseKeyProvider extends eventsExports$1.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(t,s)=>{livekitLogger.debug("key ratcheted event received",{material:t,keyIndex:s})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},KEY_PROVIDER_DEFAULTS),e),this.on(KeyProviderEvent.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,t,s){const a={key:e,participantIdentity:t,keyIndex:s};this.keyInfoMap.set("".concat(t??"shared","-").concat(s??0),a),this.emit(KeyProviderEvent.SetKey,a)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,t){this.emit(KeyProviderEvent.RatchetRequest,e,t)}}class LivekitError extends Error{constructor(e,t){super(t||"an error has occured"),this.code=e}}class ConnectionError extends LivekitError{constructor(e,t,s){super(1,e),this.status=s,this.reason=t}}class DeviceUnsupportedError extends LivekitError{constructor(e){super(21,e??"device is unsupported")}}class TrackInvalidError extends LivekitError{constructor(e){super(20,e??"track is invalid")}}class UnsupportedServer extends LivekitError{constructor(e){super(10,e??"unsupported server")}}class UnexpectedConnectionState extends LivekitError{constructor(e){super(12,e??"unexpected connection state")}}class NegotiationError extends LivekitError{constructor(e){super(13,e??"unable to negotiate")}}var MediaDeviceFailure;(function(n){n.PermissionDenied="PermissionDenied",n.NotFound="NotFound",n.DeviceInUse="DeviceInUse",n.Other="Other"})(MediaDeviceFailure||(MediaDeviceFailure={}));(function(n){function e(t){if(t&&"name"in t)return t.name==="NotFoundError"||t.name==="DevicesNotFoundError"?n.NotFound:t.name==="NotAllowedError"||t.name==="PermissionDeniedError"?n.PermissionDenied:t.name==="NotReadableError"||t.name==="TrackStartError"?n.DeviceInUse:n.Other}n.getFailure=e})(MediaDeviceFailure||(MediaDeviceFailure={}));var RoomEvent;(function(n){n.Connected="connected",n.Reconnecting="reconnecting",n.Reconnected="reconnected",n.Disconnected="disconnected",n.ConnectionStateChanged="connectionStateChanged",n.StateChanged="connectionStateChanged",n.MediaDevicesChanged="mediaDevicesChanged",n.ParticipantConnected="participantConnected",n.ParticipantDisconnected="participantDisconnected",n.TrackPublished="trackPublished",n.TrackSubscribed="trackSubscribed",n.TrackSubscriptionFailed="trackSubscriptionFailed",n.TrackUnpublished="trackUnpublished",n.TrackUnsubscribed="trackUnsubscribed",n.TrackMuted="trackMuted",n.TrackUnmuted="trackUnmuted",n.LocalTrackPublished="localTrackPublished",n.LocalTrackUnpublished="localTrackUnpublished",n.LocalAudioSilenceDetected="localAudioSilenceDetected",n.ActiveSpeakersChanged="activeSpeakersChanged",n.ParticipantMetadataChanged="participantMetadataChanged",n.ParticipantNameChanged="participantNameChanged",n.RoomMetadataChanged="roomMetadataChanged",n.DataReceived="dataReceived",n.ConnectionQualityChanged="connectionQualityChanged",n.TrackStreamStateChanged="trackStreamStateChanged",n.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",n.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",n.AudioPlaybackStatusChanged="audioPlaybackChanged",n.VideoPlaybackStatusChanged="videoPlaybackChanged",n.MediaDevicesError="mediaDevicesError",n.ParticipantPermissionsChanged="participantPermissionsChanged",n.SignalConnected="signalConnected",n.RecordingStatusChanged="recordingStatusChanged",n.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",n.EncryptionError="encryptionError",n.DCBufferStatusChanged="dcBufferStatusChanged",n.ActiveDeviceChanged="activeDeviceChanged"})(RoomEvent||(RoomEvent={}));var ParticipantEvent;(function(n){n.TrackPublished="trackPublished",n.TrackSubscribed="trackSubscribed",n.TrackSubscriptionFailed="trackSubscriptionFailed",n.TrackUnpublished="trackUnpublished",n.TrackUnsubscribed="trackUnsubscribed",n.TrackMuted="trackMuted",n.TrackUnmuted="trackUnmuted",n.LocalTrackPublished="localTrackPublished",n.LocalTrackUnpublished="localTrackUnpublished",n.ParticipantMetadataChanged="participantMetadataChanged",n.ParticipantNameChanged="participantNameChanged",n.DataReceived="dataReceived",n.IsSpeakingChanged="isSpeakingChanged",n.ConnectionQualityChanged="connectionQualityChanged",n.TrackStreamStateChanged="trackStreamStateChanged",n.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",n.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",n.MediaDevicesError="mediaDevicesError",n.AudioStreamAcquired="audioStreamAcquired",n.ParticipantPermissionsChanged="participantPermissionsChanged",n.PCTrackAdded="pcTrackAdded"})(ParticipantEvent||(ParticipantEvent={}));var EngineEvent;(function(n){n.TransportsCreated="transportsCreated",n.Connected="connected",n.Disconnected="disconnected",n.Resuming="resuming",n.Resumed="resumed",n.Restarting="restarting",n.Restarted="restarted",n.SignalResumed="signalResumed",n.SignalRestarted="signalRestarted",n.Closing="closing",n.MediaTrackAdded="mediaTrackAdded",n.ActiveSpeakersUpdate="activeSpeakersUpdate",n.DataPacketReceived="dataPacketReceived",n.RTPVideoMapUpdate="rtpVideoMapUpdate",n.DCBufferStatusChanged="dcBufferStatusChanged",n.ParticipantUpdate="participantUpdate",n.RoomUpdate="roomUpdate",n.SpeakersChanged="speakersChanged",n.StreamStateChanged="streamStateChanged",n.ConnectionQualityUpdate="connectionQualityUpdate",n.SubscriptionError="subscriptionError",n.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",n.RemoteMute="remoteMute",n.SubscribedQualityUpdate="subscribedQualityUpdate",n.LocalTrackUnpublished="localTrackUnpublished"})(EngineEvent||(EngineEvent={}));var TrackEvent;(function(n){n.Message="message",n.Muted="muted",n.Unmuted="unmuted",n.Restarted="restarted",n.Ended="ended",n.Subscribed="subscribed",n.Unsubscribed="unsubscribed",n.UpdateSettings="updateSettings",n.UpdateSubscription="updateSubscription",n.AudioPlaybackStarted="audioPlaybackStarted",n.AudioPlaybackFailed="audioPlaybackFailed",n.AudioSilenceDetected="audioSilenceDetected",n.VisibilityChanged="visibilityChanged",n.VideoDimensionsChanged="videoDimensionsChanged",n.VideoPlaybackStarted="videoPlaybackStarted",n.VideoPlaybackFailed="videoPlaybackFailed",n.ElementAttached="elementAttached",n.ElementDetached="elementDetached",n.UpstreamPaused="upstreamPaused",n.UpstreamResumed="upstreamResumed",n.SubscriptionPermissionChanged="subscriptionPermissionChanged",n.SubscriptionStatusChanged="subscriptionStatusChanged",n.SubscriptionFailed="subscriptionFailed"})(TrackEvent||(TrackEvent={}));function r(n,e,t){var s,a,c;e===void 0&&(e=50),t===void 0&&(t={});var u=(s=t.isImmediate)!=null&&s,d=(a=t.callback)!=null&&a,m=t.maxWait,_=Date.now(),b=[];function S(){if(m!==void 0){var w=Date.now()-_;if(w+e>=m)return m-w}return e}var C=function(){var w=[].slice.call(arguments),O=this;return new Promise(function(I,N){var P=u&&c===void 0;if(c!==void 0&&clearTimeout(c),c=setTimeout(function(){if(c=void 0,_=Date.now(),!u){var x=n.apply(O,w);d&&d(x),b.forEach(function(F){return(0,F.resolve)(x)}),b=[]}},S()),P){var B=n.apply(O,w);return d&&d(B),I(B)}b.push({resolve:I,reject:N})})};return C.cancel=function(w){c!==void 0&&clearTimeout(c),b.forEach(function(O){return(0,O.reject)(w)}),b=[]},C}const commonVersionIdentifier=/version\/(\d+(\.?_?\d+)+)/i;let browserDetails;function getBrowser(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof n>"u"&&typeof navigator>"u")return;const t=(n??navigator.userAgent).toLowerCase();if(browserDetails===void 0||e){const s=browsersList.find(a=>{let{test:c}=a;return c.test(t)});browserDetails=s==null?void 0:s.describe(t)}return browserDetails}const browsersList=[{test:/firefox|iceweasel|fxios/i,describe(n){return{name:"Firefox",version:getMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,n),os:n.toLowerCase().includes("fxios")?"iOS":void 0}}},{test:/chrom|crios|crmo/i,describe(n){return{name:"Chrome",version:getMatch(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,n),os:n.toLowerCase().includes("crios")?"iOS":void 0}}},{test:/safari|applewebkit/i,describe(n){return{name:"Safari",version:getMatch(commonVersionIdentifier,n),os:n.includes("mobile/")?"iOS":"macOS"}}}];function getMatch(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const s=e.match(n);return s&&s.length>=t&&s[t]||""}var version$1="1.15.10";const version=version$1,protocolVersion=11;class CriticalTimers{}CriticalTimers.setTimeout=function(){return setTimeout(...arguments)};CriticalTimers.setInterval=function(){return setInterval(...arguments)};CriticalTimers.clearTimeout=function(){return clearTimeout(...arguments)};CriticalTimers.clearInterval=function(){return clearInterval(...arguments)};class VideoPreset{constructor(e,t,s,a,c){this.width=e,this.height=t,this.encoding={maxBitrate:s,maxFramerate:a,priority:c}}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.width/this.height}}}const backupCodecs=["vp8","h264"],videoCodecs=["vp8","h264","vp9","av1"];function isBackupCodec(n){return!!backupCodecs.find(e=>e===n)}var AudioPresets;(function(n){n.telephone={maxBitrate:12e3},n.speech={maxBitrate:2e4},n.music={maxBitrate:32e3},n.musicStereo={maxBitrate:48e3},n.musicHighQuality={maxBitrate:64e3},n.musicHighQualityStereo={maxBitrate:96e3}})(AudioPresets||(AudioPresets={}));const VideoPresets={h90:new VideoPreset(160,90,9e4,20),h180:new VideoPreset(320,180,16e4,20),h216:new VideoPreset(384,216,18e4,20),h360:new VideoPreset(640,360,45e4,20),h540:new VideoPreset(960,540,8e5,25),h720:new VideoPreset(1280,720,17e5,30),h1080:new VideoPreset(1920,1080,3e6,30),h1440:new VideoPreset(2560,1440,5e6,30),h2160:new VideoPreset(3840,2160,8e6,30)},VideoPresets43={h120:new VideoPreset(160,120,7e4,20),h180:new VideoPreset(240,180,125e3,20),h240:new VideoPreset(320,240,14e4,20),h360:new VideoPreset(480,360,33e4,20),h480:new VideoPreset(640,480,5e5,20),h540:new VideoPreset(720,540,6e5,25),h720:new VideoPreset(960,720,13e5,30),h1080:new VideoPreset(1440,1080,23e5,30),h1440:new VideoPreset(1920,1440,38e5,30)},ScreenSharePresets={h360fps3:new VideoPreset(640,360,2e5,3,"medium"),h360fps15:new VideoPreset(640,360,4e5,15,"medium"),h720fps5:new VideoPreset(1280,720,8e5,5,"medium"),h720fps15:new VideoPreset(1280,720,15e5,15,"medium"),h720fps30:new VideoPreset(1280,720,2e6,30,"medium"),h1080fps15:new VideoPreset(1920,1080,25e5,15,"medium"),h1080fps30:new VideoPreset(1920,1080,5e6,30,"medium"),original:new VideoPreset(0,0,7e6,30,"medium")};var SignalTarget;(function(n){n[n.PUBLISHER=0]="PUBLISHER",n[n.SUBSCRIBER=1]="SUBSCRIBER"})(SignalTarget||(SignalTarget={}));proto3.util.setEnumType(SignalTarget,"livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]);var StreamState;(function(n){n[n.ACTIVE=0]="ACTIVE",n[n.PAUSED=1]="PAUSED"})(StreamState||(StreamState={}));proto3.util.setEnumType(StreamState,"livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]);var CandidateProtocol;(function(n){n[n.UDP=0]="UDP",n[n.TCP=1]="TCP",n[n.TLS=2]="TLS"})(CandidateProtocol||(CandidateProtocol={}));proto3.util.setEnumType(CandidateProtocol,"livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]);class SignalRequest extends Message{constructor(e){super(),this.message={case:void 0},proto3.util.initPartial(e,this)}static fromBinary(e,t){return new SignalRequest().fromBinary(e,t)}static fromJson(e,t){return new SignalRequest().fromJson(e,t)}static fromJsonString(e,t){return new SignalRequest().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(SignalRequest,e,t)}}SignalRequest.runtime=proto3;SignalRequest.typeName="livekit.SignalRequest";SignalRequest.fields=proto3.util.newFieldList(()=>[{no:1,name:"offer",kind:"message",T:SessionDescription,oneof:"message"},{no:2,name:"answer",kind:"message",T:SessionDescription,oneof:"message"},{no:3,name:"trickle",kind:"message",T:TrickleRequest,oneof:"message"},{no:4,name:"add_track",kind:"message",T:AddTrackRequest,oneof:"message"},{no:5,name:"mute",kind:"message",T:MuteTrackRequest,oneof:"message"},{no:6,name:"subscription",kind:"message",T:UpdateSubscription,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:UpdateTrackSettings,oneof:"message"},{no:8,name:"leave",kind:"message",T:LeaveRequest,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:UpdateVideoLayers,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:SubscriptionPermission,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:SyncState,oneof:"message"},{no:13,name:"simulate",kind:"message",T:SimulateScenario,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:UpdateParticipantMetadata,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Ping,oneof:"message"}]);class SignalResponse extends Message{constructor(e){super(),this.message={case:void 0},proto3.util.initPartial(e,this)}static fromBinary(e,t){return new SignalResponse().fromBinary(e,t)}static fromJson(e,t){return new SignalResponse().fromJson(e,t)}static fromJsonString(e,t){return new SignalResponse().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(SignalResponse,e,t)}}SignalResponse.runtime=proto3;SignalResponse.typeName="livekit.SignalResponse";SignalResponse.fields=proto3.util.newFieldList(()=>[{no:1,name:"join",kind:"message",T:JoinResponse,oneof:"message"},{no:2,name:"answer",kind:"message",T:SessionDescription,oneof:"message"},{no:3,name:"offer",kind:"message",T:SessionDescription,oneof:"message"},{no:4,name:"trickle",kind:"message",T:TrickleRequest,oneof:"message"},{no:5,name:"update",kind:"message",T:ParticipantUpdate,oneof:"message"},{no:6,name:"track_published",kind:"message",T:TrackPublishedResponse,oneof:"message"},{no:8,name:"leave",kind:"message",T:LeaveRequest,oneof:"message"},{no:9,name:"mute",kind:"message",T:MuteTrackRequest,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:SpeakersChanged,oneof:"message"},{no:11,name:"room_update",kind:"message",T:RoomUpdate,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:ConnectionQualityUpdate,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:StreamStateUpdate,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:SubscribedQualityUpdate,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:SubscriptionPermissionUpdate,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:TrackUnpublishedResponse,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:ReconnectResponse,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:Pong,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:SubscriptionResponse,oneof:"message"}]);class SimulcastCodec extends Message{constructor(e){super(),this.codec="",this.cid="",proto3.util.initPartial(e,this)}static fromBinary(e,t){return new SimulcastCodec().fromBinary(e,t)}static fromJson(e,t){return new SimulcastCodec().fromJson(e,t)}static fromJsonString(e,t){return new SimulcastCodec().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(SimulcastCodec,e,t)}}SimulcastCodec.runtime=proto3;SimulcastCodec.typeName="livekit.SimulcastCodec";SimulcastCodec.fields=proto3.util.newFieldList(()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]);class AddTrackRequest extends Message{constructor(e){super(),this.cid="",this.name="",this.type=TrackType$1.AUDIO,this.width=0,this.height=0,this.muted=!1,this.disableDtx=!1,this.source=TrackSource$2.UNKNOWN,this.layers=[],this.simulcastCodecs=[],this.sid="",this.stereo=!1,this.disableRed=!1,this.encryption=Encryption_Type$1.NONE,this.stream="",proto3.util.initPartial(e,this)}static fromBinary(e,t){return new AddTrackRequest().fromBinary(e,t)}static fromJson(e,t){return new AddTrackRequest().fromJson(e,t)}static fromJsonString(e,t){return new AddTrackRequest().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(AddTrackRequest,e,t)}}AddTrackRequest.runtime=proto3;AddTrackRequest.typeName="livekit.AddTrackRequest";AddTrackRequest.fields=proto3.util.newFieldList(()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:proto3.getEnumType(TrackType$1)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:proto3.getEnumType(TrackSource$2)},{no:9,name:"layers",kind:"message",T:VideoLayer,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:SimulcastCodec,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:proto3.getEnumType(Encryption_Type$1)},{no:15,name:"stream",kind:"scalar",T:9}]);class TrickleRequest extends Message{constructor(e){super(),this.candidateInit="",this.target=SignalTarget.PUBLISHER,proto3.util.initPartial(e,this)}static fromBinary(e,t){return new TrickleRequest().fromBinary(e,t)}static fromJson(e,t){return new TrickleRequest().fromJson(e,t)}static fromJsonString(e,t){return new TrickleRequest().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(TrickleRequest,e,t)}}TrickleRequest.runtime=proto3;TrickleRequest.typeName="livekit.TrickleRequest";TrickleRequest.fields=proto3.util.newFieldList(()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:proto3.getEnumType(SignalTarget)}]);class MuteTrackRequest extends Message{constructor(e){super(),this.sid="",this.muted=!1,proto3.util.initPartial(e,this)}static fromBinary(e,t){return new MuteTrackRequest().fromBinary(e,t)}static fromJson(e,t){return new MuteTrackRequest().fromJson(e,t)}static fromJsonString(e,t){return new MuteTrackRequest().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(MuteTrackRequest,e,t)}}MuteTrackRequest.runtime=proto3;MuteTrackRequest.typeName="livekit.MuteTrackRequest";MuteTrackRequest.fields=proto3.util.newFieldList(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]);class JoinResponse extends Message{constructor(e){super(),this.otherParticipants=[],this.serverVersion="",this.iceServers=[],this.subscriberPrimary=!1,this.alternativeUrl="",this.serverRegion="",this.pingTimeout=0,this.pingInterval=0,this.sifTrailer=new Uint8Array(0),proto3.util.initPartial(e,this)}static fromBinary(e,t){return new JoinResponse().fromBinary(e,t)}static fromJson(e,t){return new JoinResponse().fromJson(e,t)}static fromJsonString(e,t){return new JoinResponse().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(JoinResponse,e,t)}}JoinResponse.runtime=proto3;JoinResponse.typeName="livekit.JoinResponse";JoinResponse.fields=proto3.util.newFieldList(()=>[{no:1,name:"room",kind:"message",T:Room$1},{no:2,name:"participant",kind:"message",T:ParticipantInfo},{no:3,name:"other_participants",kind:"message",T:ParticipantInfo,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:ICEServer,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:ClientConfiguration},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:ServerInfo},{no:13,name:"sif_trailer",kind:"scalar",T:12}]);class ReconnectResponse extends Message{constructor(e){super(),this.iceServers=[],proto3.util.initPartial(e,this)}static fromBinary(e,t){return new ReconnectResponse().fromBinary(e,t)}static fromJson(e,t){return new ReconnectResponse().fromJson(e,t)}static fromJsonString(e,t){return new ReconnectResponse().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(ReconnectResponse,e,t)}}ReconnectResponse.runtime=proto3;ReconnectResponse.typeName="livekit.ReconnectResponse";ReconnectResponse.fields=proto3.util.newFieldList(()=>[{no:1,name:"ice_servers",kind:"message",T:ICEServer,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:ClientConfiguration}]);class TrackPublishedResponse extends Message{constructor(e){super(),this.cid="",proto3.util.initPartial(e,this)}static fromBinary(e,t){return new TrackPublishedResponse().fromBinary(e,t)}static fromJson(e,t){return new TrackPublishedResponse().fromJson(e,t)}static fromJsonString(e,t){return new TrackPublishedResponse().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(TrackPublishedResponse,e,t)}}TrackPublishedResponse.runtime=proto3;TrackPublishedResponse.typeName="livekit.TrackPublishedResponse";TrackPublishedResponse.fields=proto3.util.newFieldList(()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:TrackInfo}]);class TrackUnpublishedResponse extends Message{constructor(e){super(),this.trackSid="",proto3.util.initPartial(e,this)}static fromBinary(e,t){return new TrackUnpublishedResponse().fromBinary(e,t)}static fromJson(e,t){return new TrackUnpublishedResponse().fromJson(e,t)}static fromJsonString(e,t){return new TrackUnpublishedResponse().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(TrackUnpublishedResponse,e,t)}}TrackUnpublishedResponse.runtime=proto3;TrackUnpublishedResponse.typeName="livekit.TrackUnpublishedResponse";TrackUnpublishedResponse.fields=proto3.util.newFieldList(()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);class SessionDescription extends Message{constructor(e){super(),this.type="",this.sdp="",proto3.util.initPartial(e,this)}static fromBinary(e,t){return new SessionDescription().fromBinary(e,t)}static fromJson(e,t){return new SessionDescription().fromJson(e,t)}static fromJsonString(e,t){return new SessionDescription().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(SessionDescription,e,t)}}SessionDescription.runtime=proto3;SessionDescription.typeName="livekit.SessionDescription";SessionDescription.fields=proto3.util.newFieldList(()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9}]);class ParticipantUpdate extends Message{constructor(e){super(),this.participants=[],proto3.util.initPartial(e,this)}static fromBinary(e,t){return new ParticipantUpdate().fromBinary(e,t)}static fromJson(e,t){return new ParticipantUpdate().fromJson(e,t)}static fromJsonString(e,t){return new ParticipantUpdate().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(ParticipantUpdate,e,t)}}ParticipantUpdate.runtime=proto3;ParticipantUpdate.typeName="livekit.ParticipantUpdate";ParticipantUpdate.fields=proto3.util.newFieldList(()=>[{no:1,name:"participants",kind:"message",T:ParticipantInfo,repeated:!0}]);class UpdateSubscription extends Message{constructor(e){super(),this.trackSids=[],this.subscribe=!1,this.participantTracks=[],proto3.util.initPartial(e,this)}static fromBinary(e,t){return new UpdateSubscription().fromBinary(e,t)}static fromJson(e,t){return new UpdateSubscription().fromJson(e,t)}static fromJsonString(e,t){return new UpdateSubscription().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(UpdateSubscription,e,t)}}UpdateSubscription.runtime=proto3;UpdateSubscription.typeName="livekit.UpdateSubscription";UpdateSubscription.fields=proto3.util.newFieldList(()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:ParticipantTracks,repeated:!0}]);class UpdateTrackSettings extends Message{constructor(e){super(),this.trackSids=[],this.disabled=!1,this.quality=VideoQuality$1.LOW,this.width=0,this.height=0,this.fps=0,this.priority=0,proto3.util.initPartial(e,this)}static fromBinary(e,t){return new UpdateTrackSettings().fromBinary(e,t)}static fromJson(e,t){return new UpdateTrackSettings().fromJson(e,t)}static fromJsonString(e,t){return new UpdateTrackSettings().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(UpdateTrackSettings,e,t)}}UpdateTrackSettings.runtime=proto3;UpdateTrackSettings.typeName="livekit.UpdateTrackSettings";UpdateTrackSettings.fields=proto3.util.newFieldList(()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:proto3.getEnumType(VideoQuality$1)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]);class LeaveRequest extends Message{constructor(e){super(),this.canReconnect=!1,this.reason=DisconnectReason$1.UNKNOWN_REASON,proto3.util.initPartial(e,this)}static fromBinary(e,t){return new LeaveRequest().fromBinary(e,t)}static fromJson(e,t){return new LeaveRequest().fromJson(e,t)}static fromJsonString(e,t){return new LeaveRequest().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(LeaveRequest,e,t)}}LeaveRequest.runtime=proto3;LeaveRequest.typeName="livekit.LeaveRequest";LeaveRequest.fields=proto3.util.newFieldList(()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:proto3.getEnumType(DisconnectReason$1)}]);class UpdateVideoLayers extends Message{constructor(e){super(),this.trackSid="",this.layers=[],proto3.util.initPartial(e,this)}static fromBinary(e,t){return new UpdateVideoLayers().fromBinary(e,t)}static fromJson(e,t){return new UpdateVideoLayers().fromJson(e,t)}static fromJsonString(e,t){return new UpdateVideoLayers().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(UpdateVideoLayers,e,t)}}UpdateVideoLayers.runtime=proto3;UpdateVideoLayers.typeName="livekit.UpdateVideoLayers";UpdateVideoLayers.fields=proto3.util.newFieldList(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:VideoLayer,repeated:!0}]);class UpdateParticipantMetadata extends Message{constructor(e){super(),this.metadata="",this.name="",proto3.util.initPartial(e,this)}static fromBinary(e,t){return new UpdateParticipantMetadata().fromBinary(e,t)}static fromJson(e,t){return new UpdateParticipantMetadata().fromJson(e,t)}static fromJsonString(e,t){return new UpdateParticipantMetadata().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(UpdateParticipantMetadata,e,t)}}UpdateParticipantMetadata.runtime=proto3;UpdateParticipantMetadata.typeName="livekit.UpdateParticipantMetadata";UpdateParticipantMetadata.fields=proto3.util.newFieldList(()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9}]);class ICEServer extends Message{constructor(e){super(),this.urls=[],this.username="",this.credential="",proto3.util.initPartial(e,this)}static fromBinary(e,t){return new ICEServer().fromBinary(e,t)}static fromJson(e,t){return new ICEServer().fromJson(e,t)}static fromJsonString(e,t){return new ICEServer().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(ICEServer,e,t)}}ICEServer.runtime=proto3;ICEServer.typeName="livekit.ICEServer";ICEServer.fields=proto3.util.newFieldList(()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]);class SpeakersChanged extends Message{constructor(e){super(),this.speakers=[],proto3.util.initPartial(e,this)}static fromBinary(e,t){return new SpeakersChanged().fromBinary(e,t)}static fromJson(e,t){return new SpeakersChanged().fromJson(e,t)}static fromJsonString(e,t){return new SpeakersChanged().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(SpeakersChanged,e,t)}}SpeakersChanged.runtime=proto3;SpeakersChanged.typeName="livekit.SpeakersChanged";SpeakersChanged.fields=proto3.util.newFieldList(()=>[{no:1,name:"speakers",kind:"message",T:SpeakerInfo,repeated:!0}]);class RoomUpdate extends Message{constructor(e){super(),proto3.util.initPartial(e,this)}static fromBinary(e,t){return new RoomUpdate().fromBinary(e,t)}static fromJson(e,t){return new RoomUpdate().fromJson(e,t)}static fromJsonString(e,t){return new RoomUpdate().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(RoomUpdate,e,t)}}RoomUpdate.runtime=proto3;RoomUpdate.typeName="livekit.RoomUpdate";RoomUpdate.fields=proto3.util.newFieldList(()=>[{no:1,name:"room",kind:"message",T:Room$1}]);class ConnectionQualityInfo extends Message{constructor(e){super(),this.participantSid="",this.quality=ConnectionQuality$1.POOR,this.score=0,proto3.util.initPartial(e,this)}static fromBinary(e,t){return new ConnectionQualityInfo().fromBinary(e,t)}static fromJson(e,t){return new ConnectionQualityInfo().fromJson(e,t)}static fromJsonString(e,t){return new ConnectionQualityInfo().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(ConnectionQualityInfo,e,t)}}ConnectionQualityInfo.runtime=proto3;ConnectionQualityInfo.typeName="livekit.ConnectionQualityInfo";ConnectionQualityInfo.fields=proto3.util.newFieldList(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:proto3.getEnumType(ConnectionQuality$1)},{no:3,name:"score",kind:"scalar",T:2}]);class ConnectionQualityUpdate extends Message{constructor(e){super(),this.updates=[],proto3.util.initPartial(e,this)}static fromBinary(e,t){return new ConnectionQualityUpdate().fromBinary(e,t)}static fromJson(e,t){return new ConnectionQualityUpdate().fromJson(e,t)}static fromJsonString(e,t){return new ConnectionQualityUpdate().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(ConnectionQualityUpdate,e,t)}}ConnectionQualityUpdate.runtime=proto3;ConnectionQualityUpdate.typeName="livekit.ConnectionQualityUpdate";ConnectionQualityUpdate.fields=proto3.util.newFieldList(()=>[{no:1,name:"updates",kind:"message",T:ConnectionQualityInfo,repeated:!0}]);class StreamStateInfo extends Message{constructor(e){super(),this.participantSid="",this.trackSid="",this.state=StreamState.ACTIVE,proto3.util.initPartial(e,this)}static fromBinary(e,t){return new StreamStateInfo().fromBinary(e,t)}static fromJson(e,t){return new StreamStateInfo().fromJson(e,t)}static fromJsonString(e,t){return new StreamStateInfo().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(StreamStateInfo,e,t)}}StreamStateInfo.runtime=proto3;StreamStateInfo.typeName="livekit.StreamStateInfo";StreamStateInfo.fields=proto3.util.newFieldList(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:proto3.getEnumType(StreamState)}]);class StreamStateUpdate extends Message{constructor(e){super(),this.streamStates=[],proto3.util.initPartial(e,this)}static fromBinary(e,t){return new StreamStateUpdate().fromBinary(e,t)}static fromJson(e,t){return new StreamStateUpdate().fromJson(e,t)}static fromJsonString(e,t){return new StreamStateUpdate().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(StreamStateUpdate,e,t)}}StreamStateUpdate.runtime=proto3;StreamStateUpdate.typeName="livekit.StreamStateUpdate";StreamStateUpdate.fields=proto3.util.newFieldList(()=>[{no:1,name:"stream_states",kind:"message",T:StreamStateInfo,repeated:!0}]);class SubscribedQuality extends Message{constructor(e){super(),this.quality=VideoQuality$1.LOW,this.enabled=!1,proto3.util.initPartial(e,this)}static fromBinary(e,t){return new SubscribedQuality().fromBinary(e,t)}static fromJson(e,t){return new SubscribedQuality().fromJson(e,t)}static fromJsonString(e,t){return new SubscribedQuality().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(SubscribedQuality,e,t)}}SubscribedQuality.runtime=proto3;SubscribedQuality.typeName="livekit.SubscribedQuality";SubscribedQuality.fields=proto3.util.newFieldList(()=>[{no:1,name:"quality",kind:"enum",T:proto3.getEnumType(VideoQuality$1)},{no:2,name:"enabled",kind:"scalar",T:8}]);class SubscribedCodec extends Message{constructor(e){super(),this.codec="",this.qualities=[],proto3.util.initPartial(e,this)}static fromBinary(e,t){return new SubscribedCodec().fromBinary(e,t)}static fromJson(e,t){return new SubscribedCodec().fromJson(e,t)}static fromJsonString(e,t){return new SubscribedCodec().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(SubscribedCodec,e,t)}}SubscribedCodec.runtime=proto3;SubscribedCodec.typeName="livekit.SubscribedCodec";SubscribedCodec.fields=proto3.util.newFieldList(()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:SubscribedQuality,repeated:!0}]);class SubscribedQualityUpdate extends Message{constructor(e){super(),this.trackSid="",this.subscribedQualities=[],this.subscribedCodecs=[],proto3.util.initPartial(e,this)}static fromBinary(e,t){return new SubscribedQualityUpdate().fromBinary(e,t)}static fromJson(e,t){return new SubscribedQualityUpdate().fromJson(e,t)}static fromJsonString(e,t){return new SubscribedQualityUpdate().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(SubscribedQualityUpdate,e,t)}}SubscribedQualityUpdate.runtime=proto3;SubscribedQualityUpdate.typeName="livekit.SubscribedQualityUpdate";SubscribedQualityUpdate.fields=proto3.util.newFieldList(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:SubscribedQuality,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:SubscribedCodec,repeated:!0}]);class TrackPermission extends Message{constructor(e){super(),this.participantSid="",this.allTracks=!1,this.trackSids=[],this.participantIdentity="",proto3.util.initPartial(e,this)}static fromBinary(e,t){return new TrackPermission().fromBinary(e,t)}static fromJson(e,t){return new TrackPermission().fromJson(e,t)}static fromJsonString(e,t){return new TrackPermission().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(TrackPermission,e,t)}}TrackPermission.runtime=proto3;TrackPermission.typeName="livekit.TrackPermission";TrackPermission.fields=proto3.util.newFieldList(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]);class SubscriptionPermission extends Message{constructor(e){super(),this.allParticipants=!1,this.trackPermissions=[],proto3.util.initPartial(e,this)}static fromBinary(e,t){return new SubscriptionPermission().fromBinary(e,t)}static fromJson(e,t){return new SubscriptionPermission().fromJson(e,t)}static fromJsonString(e,t){return new SubscriptionPermission().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(SubscriptionPermission,e,t)}}SubscriptionPermission.runtime=proto3;SubscriptionPermission.typeName="livekit.SubscriptionPermission";SubscriptionPermission.fields=proto3.util.newFieldList(()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:TrackPermission,repeated:!0}]);class SubscriptionPermissionUpdate extends Message{constructor(e){super(),this.participantSid="",this.trackSid="",this.allowed=!1,proto3.util.initPartial(e,this)}static fromBinary(e,t){return new SubscriptionPermissionUpdate().fromBinary(e,t)}static fromJson(e,t){return new SubscriptionPermissionUpdate().fromJson(e,t)}static fromJsonString(e,t){return new SubscriptionPermissionUpdate().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(SubscriptionPermissionUpdate,e,t)}}SubscriptionPermissionUpdate.runtime=proto3;SubscriptionPermissionUpdate.typeName="livekit.SubscriptionPermissionUpdate";SubscriptionPermissionUpdate.fields=proto3.util.newFieldList(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]);class SyncState extends Message{constructor(e){super(),this.publishTracks=[],this.dataChannels=[],proto3.util.initPartial(e,this)}static fromBinary(e,t){return new SyncState().fromBinary(e,t)}static fromJson(e,t){return new SyncState().fromJson(e,t)}static fromJsonString(e,t){return new SyncState().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(SyncState,e,t)}}SyncState.runtime=proto3;SyncState.typeName="livekit.SyncState";SyncState.fields=proto3.util.newFieldList(()=>[{no:1,name:"answer",kind:"message",T:SessionDescription},{no:2,name:"subscription",kind:"message",T:UpdateSubscription},{no:3,name:"publish_tracks",kind:"message",T:TrackPublishedResponse,repeated:!0},{no:4,name:"data_channels",kind:"message",T:DataChannelInfo,repeated:!0},{no:5,name:"offer",kind:"message",T:SessionDescription}]);class DataChannelInfo extends Message{constructor(e){super(),this.label="",this.id=0,this.target=SignalTarget.PUBLISHER,proto3.util.initPartial(e,this)}static fromBinary(e,t){return new DataChannelInfo().fromBinary(e,t)}static fromJson(e,t){return new DataChannelInfo().fromJson(e,t)}static fromJsonString(e,t){return new DataChannelInfo().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(DataChannelInfo,e,t)}}DataChannelInfo.runtime=proto3;DataChannelInfo.typeName="livekit.DataChannelInfo";DataChannelInfo.fields=proto3.util.newFieldList(()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:proto3.getEnumType(SignalTarget)}]);class SimulateScenario extends Message{constructor(e){super(),this.scenario={case:void 0},proto3.util.initPartial(e,this)}static fromBinary(e,t){return new SimulateScenario().fromBinary(e,t)}static fromJson(e,t){return new SimulateScenario().fromJson(e,t)}static fromJsonString(e,t){return new SimulateScenario().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(SimulateScenario,e,t)}}SimulateScenario.runtime=proto3;SimulateScenario.typeName="livekit.SimulateScenario";SimulateScenario.fields=proto3.util.newFieldList(()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:proto3.getEnumType(CandidateProtocol),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"}]);class Ping extends Message{constructor(e){super(),this.timestamp=protoInt64.zero,this.rtt=protoInt64.zero,proto3.util.initPartial(e,this)}static fromBinary(e,t){return new Ping().fromBinary(e,t)}static fromJson(e,t){return new Ping().fromJson(e,t)}static fromJsonString(e,t){return new Ping().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(Ping,e,t)}}Ping.runtime=proto3;Ping.typeName="livekit.Ping";Ping.fields=proto3.util.newFieldList(()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]);class Pong extends Message{constructor(e){super(),this.lastPingTimestamp=protoInt64.zero,this.timestamp=protoInt64.zero,proto3.util.initPartial(e,this)}static fromBinary(e,t){return new Pong().fromBinary(e,t)}static fromJson(e,t){return new Pong().fromJson(e,t)}static fromJsonString(e,t){return new Pong().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(Pong,e,t)}}Pong.runtime=proto3;Pong.typeName="livekit.Pong";Pong.fields=proto3.util.newFieldList(()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]);class RegionSettings extends Message{constructor(e){super(),this.regions=[],proto3.util.initPartial(e,this)}static fromBinary(e,t){return new RegionSettings().fromBinary(e,t)}static fromJson(e,t){return new RegionSettings().fromJson(e,t)}static fromJsonString(e,t){return new RegionSettings().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(RegionSettings,e,t)}}RegionSettings.runtime=proto3;RegionSettings.typeName="livekit.RegionSettings";RegionSettings.fields=proto3.util.newFieldList(()=>[{no:1,name:"regions",kind:"message",T:RegionInfo,repeated:!0}]);class RegionInfo extends Message{constructor(e){super(),this.region="",this.url="",this.distance=protoInt64.zero,proto3.util.initPartial(e,this)}static fromBinary(e,t){return new RegionInfo().fromBinary(e,t)}static fromJson(e,t){return new RegionInfo().fromJson(e,t)}static fromJsonString(e,t){return new RegionInfo().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(RegionInfo,e,t)}}RegionInfo.runtime=proto3;RegionInfo.typeName="livekit.RegionInfo";RegionInfo.fields=proto3.util.newFieldList(()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]);class SubscriptionResponse extends Message{constructor(e){super(),this.trackSid="",this.err=SubscriptionError$1.SE_UNKNOWN,proto3.util.initPartial(e,this)}static fromBinary(e,t){return new SubscriptionResponse().fromBinary(e,t)}static fromJson(e,t){return new SubscriptionResponse().fromJson(e,t)}static fromJsonString(e,t){return new SubscriptionResponse().fromJsonString(e,t)}static equals(e,t){return proto3.util.equals(SubscriptionResponse,e,t)}}SubscriptionResponse.runtime=proto3;SubscriptionResponse.typeName="livekit.SubscriptionResponse";SubscriptionResponse.fields=proto3.util.newFieldList(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:proto3.getEnumType(SubscriptionError$1)}]);function cloneDeep(n){if(!(typeof n>"u"))return typeof structuredClone=="function"?structuredClone(n):JSON.parse(JSON.stringify(n))}const BACKGROUND_REACTION_DELAY=5e3,recycledElements=[];class Track extends eventsExports$1.EventEmitter{constructor(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var a;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=Track.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=livekitLogger,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),BACKGROUND_REACTION_DELAY):this.handleAppVisibilityChanged()},this.log=getLogger((a=s.loggerName)!==null&&a!==void 0?a:LoggerNames.Track),this.loggerContextCb=s.loggerContextCb,this.setMaxListeners(100),this.kind=t,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=Track.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),getLogContextFromTrack(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let t="audio";this.kind===Track.Kind.Video&&(t="video"),this.attachedElements.length===0&&Track.Kind.Video&&this.addAppVisibilityListener(),e||(t==="audio"&&(recycledElements.forEach(c=>{c.parentElement===null&&!e&&(e=c)}),e&&recycledElements.splice(recycledElements.indexOf(e),1)),e||(e=document.createElement(t))),this.attachedElements.includes(e)||this.attachedElements.push(e),attachToElement(this.mediaStreamTrack,e);const s=e.srcObject.getTracks(),a=s.some(c=>c.kind==="audio");return e.play().then(()=>{this.emit(a?TrackEvent.AudioPlaybackStarted:TrackEvent.VideoPlaybackStarted)}).catch(c=>{c.name==="NotAllowedError"?this.emit(a?TrackEvent.AudioPlaybackFailed:TrackEvent.VideoPlaybackFailed,c):c.name==="AbortError"?livekitLogger.debug("".concat(a?"audio":"video"," playback aborted, likely due to new play request")):livekitLogger.warn("could not playback ".concat(a?"audio":"video"),c),a&&e&&s.some(u=>u.kind==="video")&&c.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(TrackEvent.ElementAttached,e),e}detach(e){try{if(e){detachTrack(this.mediaStreamTrack,e);const s=this.attachedElements.indexOf(e);return s>=0&&(this.attachedElements.splice(s,1),this.recycleElement(e),this.emit(TrackEvent.ElementDetached,e)),e}const t=[];return this.attachedElements.forEach(s=>{detachTrack(this.mediaStreamTrack,s),t.push(s),this.recycleElement(s),this.emit(TrackEvent.ElementDetached,s)}),this.attachedElements=[],t}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval)}updateLoggerOptions(e){e.loggerName&&(this.log=getLogger(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let t=!0;e.pause(),recycledElements.forEach(s=>{s.parentElement||(t=!1)}),t&&recycledElements.push(e)}}handleAppVisibilityChanged(){return __awaiter(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden"})}addAppVisibilityListener(){isWeb()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){isWeb()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function attachToElement(n,e){let t;e.srcObject instanceof MediaStream?t=e.srcObject:t=new MediaStream;let s;n.kind==="audio"?s=t.getAudioTracks():s=t.getVideoTracks(),s.includes(n)||(s.forEach(a=>{t.removeTrack(a)}),t.addTrack(n)),(!isSafari()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=t.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==t&&(e.srcObject=t,(isSafari()||isFireFox())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=t,e.play().catch(()=>{})},0))}function detachTrack(n,e){if(e.srcObject instanceof MediaStream){const t=e.srcObject;t.removeTrack(n),t.getTracks().length>0?e.srcObject=t:e.srcObject=null}}(function(n){let e;(function(_){_.Audio="audio",_.Video="video",_.Unknown="unknown"})(e=n.Kind||(n.Kind={}));let t;(function(_){_.Camera="camera",_.Microphone="microphone",_.ScreenShare="screen_share",_.ScreenShareAudio="screen_share_audio",_.Unknown="unknown"})(t=n.Source||(n.Source={}));let s;(function(_){_.Active="active",_.Paused="paused",_.Unknown="unknown"})(s=n.StreamState||(n.StreamState={}));function a(_){switch(_){case e.Audio:return TrackType$1.AUDIO;case e.Video:return TrackType$1.VIDEO;default:return TrackType$1.DATA}}n.kindToProto=a;function c(_){switch(_){case TrackType$1.AUDIO:return e.Audio;case TrackType$1.VIDEO:return e.Video;default:return e.Unknown}}n.kindFromProto=c;function u(_){switch(_){case t.Camera:return TrackSource$2.CAMERA;case t.Microphone:return TrackSource$2.MICROPHONE;case t.ScreenShare:return TrackSource$2.SCREEN_SHARE;case t.ScreenShareAudio:return TrackSource$2.SCREEN_SHARE_AUDIO;default:return TrackSource$2.UNKNOWN}}n.sourceToProto=u;function d(_){switch(_){case TrackSource$2.CAMERA:return t.Camera;case TrackSource$2.MICROPHONE:return t.Microphone;case TrackSource$2.SCREEN_SHARE:return t.ScreenShare;case TrackSource$2.SCREEN_SHARE_AUDIO:return t.ScreenShareAudio;default:return t.Unknown}}n.sourceFromProto=d;function m(_){switch(_){case StreamState.ACTIVE:return s.Active;case StreamState.PAUSED:return s.Paused;default:return s.Unknown}}n.streamStateFromProto=m})(Track||(Track={}));function mergeDefaultOptions(n,e,t){var s;const a=(s=cloneDeep(n))!==null&&s!==void 0?s:{};return a.audio===!0&&(a.audio={}),a.video===!0&&(a.video={}),a.audio&&mergeObjectWithoutOverwriting(a.audio,e),a.video&&mergeObjectWithoutOverwriting(a.video,t),a}function mergeObjectWithoutOverwriting(n,e){return Object.keys(e).forEach(t=>{n[t]===void 0&&(n[t]=e[t])}),n}function constraintsForOptions(n){const e={};if(n.video)if(typeof n.video=="object"){const t={},s=t,a=n.video;Object.keys(a).forEach(c=>{switch(c){case"resolution":mergeObjectWithoutOverwriting(s,a.resolution);break;default:s[c]=a[c]}}),e.video=t}else e.video=n.video;else e.video=!1;return n.audio?typeof n.audio=="object"?e.audio=n.audio:e.audio=!0:e.audio=!1,e}function detectSilence(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return __awaiter(this,void 0,void 0,function*(){const t=getNewAudioContext();if(t){const s=t.createAnalyser();s.fftSize=2048;const a=s.frequencyBinCount,c=new Uint8Array(a);t.createMediaStreamSource(new MediaStream([n.mediaStreamTrack])).connect(s),yield sleep(e),s.getByteTimeDomainData(c);const d=c.some(m=>m!==128&&m!==0);return t.close(),!d}return!1})}function getNewAudioContext(){const n=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(n)return new n({latencyHint:"interactive"})}function sourceToKind(n){return n===Track.Source.Microphone?"audioinput":n===Track.Source.Camera?"videoinput":void 0}function screenCaptureToDisplayMediaStreamOptions(n){var e,t;let s=(e=n.video)!==null&&e!==void 0?e:!0;return n.resolution&&n.resolution.width>0&&n.resolution.height>0&&(s=typeof s=="boolean"?{}:s,isSafari()?s=Object.assign(Object.assign({},s),{width:{max:n.resolution.width},height:{max:n.resolution.height},frameRate:n.resolution.frameRate}):s=Object.assign(Object.assign({},s),{width:{ideal:n.resolution.width},height:{ideal:n.resolution.height},frameRate:n.resolution.frameRate})),{audio:(t=n.audio)!==null&&t!==void 0?t:!1,video:s,controller:n.controller,selfBrowserSurface:n.selfBrowserSurface,surfaceSwitching:n.surfaceSwitching,systemAudio:n.systemAudio}}function mimeTypeToVideoCodecString(n){const e=n.split("/")[1].toLowerCase();if(!videoCodecs.includes(e))throw Error("Video codec not supported: ".concat(e));return e}function getTrackPublicationInfo(n){const e=[];return n.forEach(t=>{t.track!==void 0&&e.push(new TrackPublishedResponse({cid:t.track.mediaStreamID,track:t.trackInfo}))}),e}function getLogContextFromTrack(n){return n instanceof Track?{trackSid:n.sid,trackSource:n.source,trackMuted:n.isMuted,trackEnabled:n.mediaStreamTrack.enabled,trackKind:n.kind}:{trackSid:n.trackSid,trackName:n.trackName,track:n.track?getLogContextFromTrack(n.track):void 0,trackEnabled:n.isEnabled,trackEncrypted:n.isEncrypted,trackMimeType:n.mimeType}}const separator="|",ddExtensionURI="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function unpackStreamId(n){const e=n.split(separator);return e.length>1?[e[0],n.substr(e[0].length+1)]:[n,""]}function sleep(n){return __awaiter(this,void 0,void 0,function*(){return new Promise(e=>CriticalTimers.setTimeout(e,n))})}function supportsTransceiver(){return"addTransceiver"in RTCPeerConnection.prototype}function supportsAddTrack(){return"addTrack"in RTCPeerConnection.prototype}function supportsAV1(){if(!("getCapabilities"in RTCRtpSender)||isSafari())return!1;const n=RTCRtpSender.getCapabilities("video");let e=!1;if(n){for(const t of n.codecs)if(t.mimeType==="video/AV1"){e=!0;break}}return e}function supportsVP9(){if(!("getCapabilities"in RTCRtpSender)||isFireFox())return!1;if(isSafari()){const t=getBrowser();if(t!=null&&t.version&&compareVersions(t.version,"16")<0)return!1}const n=RTCRtpSender.getCapabilities("video");let e=!1;if(n){for(const t of n.codecs)if(t.mimeType==="video/VP9"){e=!0;break}}return e}function isSVCCodec(n){return n==="av1"||n==="vp9"}function supportsSetSinkId(n){return document?(n||(n=document.createElement("audio")),"setSinkId"in n):!1}const setCodecPreferencesVersions={Chrome:"100",Safari:"15",Firefox:"100"};function supportsSetCodecPreferences(n){if(!isWeb()||!("setCodecPreferences"in n))return!1;const e=getBrowser();if(!(e!=null&&e.name)||!e.version)return!1;const t=setCodecPreferencesVersions[e.name];return t?compareVersions(e.version,t)>=0:!1}function isFireFox(){var n;return((n=getBrowser())===null||n===void 0?void 0:n.name)==="Firefox"}function isChromiumBased(){var n;return((n=getBrowser())===null||n===void 0?void 0:n.name)==="Chrome"}function isSafari(){var n;return((n=getBrowser())===null||n===void 0?void 0:n.name)==="Safari"}function isSafari17(){const n=getBrowser();return(n==null?void 0:n.name)==="Safari"&&n.version.startsWith("17.")}function isMobile(){return isWeb()?/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function isWeb(){return typeof document<"u"}function isReactNative(){return navigator.product=="ReactNative"}function isCloud(n){return n.hostname.endsWith(".livekit.cloud")||n.hostname.endsWith(".livekit.run")}function getLKReactNativeInfo(){if(dist.global&&dist.global.LiveKitReactNativeGlobal)return dist.global.LiveKitReactNativeGlobal}function getReactNativeOs(){if(!isReactNative())return;let n=getLKReactNativeInfo();if(n)return n.platform}function getDevicePixelRatio(){if(isWeb())return window.devicePixelRatio;if(isReactNative()){let n=getLKReactNativeInfo();if(n)return n.devicePixelRatio}return 1}function compareVersions(n,e){const t=n.split("."),s=e.split("."),a=Math.min(t.length,s.length);for(let c=0;c<a;++c){const u=parseInt(t[c],10),d=parseInt(s[c],10);if(u>d)return 1;if(u<d)return-1;if(c===a-1&&u===d)return 0}return n===""&&e!==""?-1:e===""?1:t.length==s.length?0:t.length<s.length?-1:1}function roDispatchCallback(n){for(const e of n)e.target.handleResize(e)}function ioDispatchCallback(n){for(const e of n)e.target.handleVisibilityChanged(e)}let resizeObserver=null;const getResizeObserver=()=>(resizeObserver||(resizeObserver=new ResizeObserver(roDispatchCallback)),resizeObserver);let intersectionObserver=null;const getIntersectionObserver=()=>(intersectionObserver||(intersectionObserver=new IntersectionObserver(ioDispatchCallback,{root:null,rootMargin:"0px"})),intersectionObserver);function getClientInfo(){var n;const e=new ClientInfo({sdk:ClientInfo_SDK$1.JS,protocol:protocolVersion,version});return isReactNative()&&(e.os=(n=getReactNativeOs())!==null&&n!==void 0?n:""),e}function createDummyVideoStreamTrack(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const a=document.createElement("canvas");a.width=n,a.height=e;const c=a.getContext("2d");c==null||c.fillRect(0,0,a.width,a.height),s&&c&&(c.beginPath(),c.arc(n/2,e/2,50,0,Math.PI*2,!0),c.closePath(),c.fillStyle="grey",c.fill());const u=a.captureStream(),[d]=u.getTracks();if(!d)throw Error("Could not get empty media stream video track");return d.enabled=t,d}let emptyAudioStreamTrack;function getEmptyAudioStreamTrack(){if(!emptyAudioStreamTrack){const n=new AudioContext,e=n.createOscillator(),t=n.createGain();t.gain.setValueAtTime(0,0);const s=n.createMediaStreamDestination();if(e.connect(t),t.connect(s),e.start(),[emptyAudioStreamTrack]=s.stream.getAudioTracks(),!emptyAudioStreamTrack)throw Error("Could not get empty media stream audio track");emptyAudioStreamTrack.enabled=!1}return emptyAudioStreamTrack.clone()}class Future{constructor(e,t){this.onFinally=t,this.promise=new Promise((s,a)=>__awaiter(this,void 0,void 0,function*(){this.resolve=s,this.reject=a,e&&(yield e(s,a))})).finally(()=>{var s;return(s=this.onFinally)===null||s===void 0?void 0:s.call(this)})}}class Mutex{constructor(){this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const t=new Promise(a=>e=()=>{this._locks-=1,a()}),s=this._locking.then(()=>e);return this._locking=this._locking.then(()=>t),s}}function isVideoCodec(n){return videoCodecs.includes(n)}function unwrapConstraint(n){if(typeof n=="string")return n;if(Array.isArray(n))return n[0];if(n.exact)return Array.isArray(n.exact)?n.exact[0]:n.exact;if(n.ideal)return Array.isArray(n.ideal)?n.ideal[0]:n.ideal;throw Error("could not unwrap constraint")}function toWebsocketUrl(n){return n.startsWith("http")?n.replace(/^(http)/,"ws"):n}function toHttpUrl(n){return n.startsWith("ws")?n.replace(/^(ws)/,"http"):n}const defaultId="default";class DeviceManager{static getInstance(){return this.instance===void 0&&(this.instance=new DeviceManager),this.instance}getDevices(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;var s;return __awaiter(this,void 0,void 0,function*(){if(((s=DeviceManager.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){livekitLogger.debug("awaiting getUserMedia promise");try{e?yield DeviceManager.userMediaPromiseMap.get(e):yield Promise.all(DeviceManager.userMediaPromiseMap.values())}catch{livekitLogger.warn("error waiting for media permissons")}}let a=yield navigator.mediaDevices.enumerateDevices();if(t&&!(isSafari()&&this.hasDeviceInUse(e))&&(a.length===0||a.some(u=>{const d=u.label==="",m=e?u.kind===e:!0;return d&&m}))){const u={video:e!=="audioinput"&&e!=="audiooutput",audio:e!=="videoinput"},d=yield navigator.mediaDevices.getUserMedia(u);a=yield navigator.mediaDevices.enumerateDevices(),d.getTracks().forEach(m=>{m.stop()})}return e&&(a=a.filter(c=>c.kind===e)),a})}normalizeDeviceId(e,t,s){return __awaiter(this,void 0,void 0,function*(){if(t!==defaultId)return t;const c=(yield this.getDevices(e)).find(u=>u.groupId===s&&u.deviceId!==defaultId);return c==null?void 0:c.deviceId})}hasDeviceInUse(e){return e?DeviceManager.userMediaPromiseMap.has(e):DeviceManager.userMediaPromiseMap.size>0}}DeviceManager.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];DeviceManager.userMediaPromiseMap=new Map;const defaultDimensionsTimeout=1e3;class LocalTrack extends Track{get constraints(){return this._constraints}constructor(e,t,s){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,c=arguments.length>4?arguments[4]:void 0;super(e,t,c),this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=r(()=>__awaiter(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>__awaiter(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(TrackEvent.Ended,this)},this.reacquireTrack=!1,this.providedByUser=a,this.muteLock=new Mutex,this.pauseUpstreamLock=new Mutex,this.processorLock=new Mutex,this.setMediaStreamTrack(e,!0),this._constraints=e.getConstraints(),s&&(this._constraints=s)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==Track.Kind.Video)return;const{width:e,height:t}=this._mediaStreamTrack.getSettings();if(e&&t)return{width:e,height:t}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,t;return(t=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&t!==void 0?t:this._mediaStreamTrack}setMediaStreamTrack(e,t){return __awaiter(this,void 0,void 0,function*(){if(e===this._mediaStreamTrack&&!t)return;this._mediaStreamTrack&&(this.attachedElements.forEach(a=>{detachTrack(this._mediaStreamTrack,a)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let s;if(this.processor&&e&&this.processorElement){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");attachToElement(e,this.processorElement),this.processorElement.muted=!0,yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),s=this.processor.processedTrack}this.sender&&(yield this.sender.replaceTrack(s??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(a=>{attachToElement(s??e,a)}))})}waitForDimensions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:defaultDimensionsTimeout;var t;return __awaiter(this,void 0,void 0,function*(){if(this.kind===Track.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((t=getBrowser())===null||t===void 0?void 0:t.os)==="iOS"&&(yield sleep(10));const s=Date.now();for(;Date.now()-s<e;){const a=this.dimensions;if(a)return a;yield sleep(50)}throw new TrackInvalidError("unable to get track dimensions after timeout")})}getDeviceId(){return __awaiter(this,void 0,void 0,function*(){if(this.source===Track.Source.ScreenShare)return;const{deviceId:e,groupId:t}=this._mediaStreamTrack.getSettings(),s=this.kind===Track.Kind.Audio?"audioinput":"videoinput";return DeviceManager.getInstance().normalizeDeviceId(s,e,t)})}mute(){return __awaiter(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return __awaiter(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return __awaiter(this,void 0,void 0,function*(){if(!this.sender)throw new TrackInvalidError("unable to replace an unpublished track");return this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),this.providedByUser=t,this.processor&&(yield this.stopProcessor()),this})}restart(e){return __awaiter(this,void 0,void 0,function*(){e||(e=this._constraints),this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const t={audio:!1,video:!1};this.kind===Track.Kind.Video?t.video=e:t.audio=e,this.attachedElements.forEach(c=>{detachTrack(this.mediaStreamTrack,c)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const a=(yield navigator.mediaDevices.getUserMedia(t)).getTracks()[0];return a.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(a),this._constraints=e,this.emit(TrackEvent.Restarted,this),this})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?TrackEvent.Muted:TrackEvent.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return __awaiter(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),isMobile()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return __awaiter(this,void 0,void 0,function*(){const e=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(TrackEvent.UpstreamPaused,this);const t=getBrowser();if((t==null?void 0:t.name)==="Safari"&&compareVersions(t.version,"12.0")<0)throw new DeviceUnsupportedError("pauseUpstream is not supported on Safari < 12.");yield this.sender.replaceTrack(null)}finally{e()}})}resumeUpstream(){return __awaiter(this,void 0,void 0,function*(){const e=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(TrackEvent.UpstreamResumed,this),yield this.sender.replaceTrack(this._mediaStreamTrack)}finally{e()}})}getRTCStatsReport(){var e;return __awaiter(this,void 0,void 0,function*(){return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;var s,a;return __awaiter(this,void 0,void 0,function*(){const c=yield this.processorLock.lock();try{if(this.log.debug("setting up processor",this.logContext),this.processor&&(yield this.stopProcessor()),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement=(s=this.processorElement)!==null&&s!==void 0?s:document.createElement(this.kind),attachToElement(this._mediaStreamTrack,this.processorElement),this.processorElement.muted=!0,this.processorElement.play().catch(d=>this.log.error("failed to play processor element",Object.assign(Object.assign({},this.logContext),{error:d})));const u={kind:this.kind,track:this._mediaStreamTrack,element:this.processorElement};if(yield e.init(u),this.processor=e,this.processor.processedTrack){for(const d of this.attachedElements)d!==this.processorElement&&t&&(detachTrack(this._mediaStreamTrack,d),attachToElement(this.processor.processedTrack,d));yield(a=this.sender)===null||a===void 0?void 0:a.replaceTrack(this.processor.processedTrack)}}finally{c()}})}getProcessor(){return this.processor}stopProcessor(){var e,t;return __awaiter(this,void 0,void 0,function*(){this.processor&&(this.log.debug("stopping processor",this.logContext),(e=this.processor.processedTrack)===null||e===void 0||e.stop(),yield this.processor.destroy(),this.processor=void 0,(t=this.processorElement)===null||t===void 0||t.remove(),this.processorElement=void 0,yield this.restart())})}}class E2EEManager extends eventsExports$1.EventEmitter{constructor(e){super(),this.onWorkerMessage=t=>{var s,a;const{kind:c,data:u}=t.data;switch(c){case"error":livekitLogger.error(u.error.message),this.emit(EncryptionEvent.EncryptionError,u.error);break;case"initAck":u.enabled&&this.keyProvider.getKeys().forEach(d=>{this.postKey(d)});break;case"enable":if(this.encryptionEnabled!==u.enabled&&u.participantIdentity===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity))this.emit(EncryptionEvent.ParticipantEncryptionStatusChanged,u.enabled,this.room.localParticipant),this.encryptionEnabled=u.enabled;else if(u.participantIdentity){const d=(a=this.room)===null||a===void 0?void 0:a.getParticipantByIdentity(u.participantIdentity);if(!d)throw TypeError("couldn't set encryption status, participant not found".concat(u.participantIdentity));this.emit(EncryptionEvent.ParticipantEncryptionStatusChanged,u.enabled,d)}this.encryptionEnabled&&this.keyProvider.getKeys().forEach(d=>{this.postKey(d)});break;case"ratchetKey":this.keyProvider.emit(KeyProviderEvent.KeyRatcheted,u.material,u.keyIndex);break}},this.onWorkerError=t=>{livekitLogger.error("e2ee worker encountered an error:",{error:t.error}),this.emit(EncryptionEvent.EncryptionError,t.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!isE2EESupported())throw new DeviceUnsupportedError("tried to setup end-to-end encryption on an unsupported browser");if(livekitLogger.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions()}};this.worker&&(livekitLogger.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}setParticipantCryptorEnabled(e,t){livekitLogger.debug("set e2ee to ".concat(e," for participant ").concat(t)),this.postEnable(e,t)}setSifTrailer(e){!e||e.length===0?livekitLogger.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(EngineEvent.RTPVideoMapUpdate,t=>{this.postRTPMap(t)})}setupEventListeners(e,t){e.on(RoomEvent.TrackPublished,(s,a)=>this.setParticipantCryptorEnabled(s.trackInfo.encryption!==Encryption_Type$1.NONE,a.identity)),e.on(RoomEvent.ConnectionStateChanged,s=>{s===ConnectionState.Connected&&e.participants.forEach(a=>{a.tracks.forEach(c=>{this.setParticipantCryptorEnabled(c.trackInfo.encryption!==Encryption_Type$1.NONE,a.identity)})})}).on(RoomEvent.TrackUnsubscribed,(s,a,c)=>{var u;const d={kind:"removeTransform",data:{participantIdentity:c.identity,trackId:s.mediaStreamID}};(u=this.worker)===null||u===void 0||u.postMessage(d)}).on(RoomEvent.TrackSubscribed,(s,a,c)=>{this.setupE2EEReceiver(s,c.identity,a.trackInfo)}).on(RoomEvent.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity),t.getKeys().forEach(s=>{this.postKey(s)})}),e.localParticipant.on(ParticipantEvent.LocalTrackPublished,s=>__awaiter(this,void 0,void 0,function*(){this.setupE2EESender(s.track,s.track.sender)})),t.on(KeyProviderEvent.SetKey,s=>this.postKey(s)).on(KeyProviderEvent.RatchetRequest,(s,a)=>this.postRatchetRequest(s,a))}postRatchetRequest(e,t){if(!this.worker)throw Error("could not ratchet key, worker is missing");const s={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t}};this.worker.postMessage(s)}postKey(e){let{key:t,participantIdentity:s,keyIndex:a}=e;var c;if(!this.worker)throw Error("could not set key, worker is missing");const u={kind:"setKey",data:{participantIdentity:s,isPublisher:s===((c=this.room)===null||c===void 0?void 0:c.localParticipant.identity),key:t,keyIndex:a}};this.worker.postMessage(u)}postEnable(e,t){if(this.worker){const s={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(s)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((t=this.room)===null||t===void 0)&&t.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const s={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(s)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}setupE2EEReceiver(e,t,s){if(e.receiver){if(!(s!=null&&s.mimeType)||s.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,t,e.kind==="video"?mimeTypeToVideoCodecString(s.mimeType):void 0)}}setupE2EESender(e,t){if(!(e instanceof LocalTrack)||!t){t||livekitLogger.warn("early return because sender is not ready");return}this.handleSender(t,e.mediaStreamID,void 0)}handleReceiver(e,t,s,a){return __awaiter(this,void 0,void 0,function*(){if(this.worker){if(isScriptTransformSupported()){const c={kind:"decode",participantIdentity:s,trackId:t,codec:a};e.transform=new RTCRtpScriptTransform(this.worker,c)}else{if(E2EE_FLAG in e&&a){const m={kind:"updateCodec",data:{trackId:t,codec:a,participantIdentity:s}};this.worker.postMessage(m);return}let c=e.writableStream,u=e.readableStream;if(!c||!u){const m=e.createEncodedStreams();e.writableStream=m.writable,c=m.writable,e.readableStream=m.readable,u=m.readable}const d={kind:"decode",data:{readableStream:u,writableStream:c,trackId:t,codec:a,participantIdentity:s}};this.worker.postMessage(d,[u,c])}e[E2EE_FLAG]=!0}})}handleSender(e,t,s){var a;if(!(E2EE_FLAG in e||!this.worker)){if(!(!((a=this.room)===null||a===void 0)&&a.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(isScriptTransformSupported()){livekitLogger.info("initialize script transform");const c={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:t,codec:s};e.transform=new RTCRtpScriptTransform(this.worker,c)}else{livekitLogger.info("initialize encoded streams");const c=e.createEncodedStreams(),u={kind:"encode",data:{readableStream:c.readable,writableStream:c.writable,codec:s,trackId:t,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(u,[c.readable,c.writable])}e[E2EE_FLAG]=!0}}}var QueueTaskStatus;(function(n){n[n.WAITING=0]="WAITING",n[n.RUNNING=1]="RUNNING",n[n.COMPLETED=2]="COMPLETED"})(QueueTaskStatus||(QueueTaskStatus={}));class AsyncQueue{constructor(){this.pendingTasks=new Map,this.taskMutex=new Mutex,this.nextTaskIndex=0}run(e){return __awaiter(this,void 0,void 0,function*(){const t={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:QueueTaskStatus.WAITING};this.pendingTasks.set(t.id,t);const s=yield this.taskMutex.lock();try{return t.executedAt=Date.now(),t.status=QueueTaskStatus.RUNNING,yield e()}finally{t.status=QueueTaskStatus.COMPLETED,this.pendingTasks.delete(t.id),s()}})}flush(){return __awaiter(this,void 0,void 0,function*(){return this.run(()=>__awaiter(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}const passThroughQueueSignals=["syncState","trickle","offer","answer","simulate","leave"];function canPassThroughQueue(n){const e=passThroughQueueSignals.indexOf(n.case)>=0;return livekitLogger.trace("request allowed to bypass queue:",{canPass:e,req:n}),e}var SignalConnectionState;(function(n){n[n.CONNECTING=0]="CONNECTING",n[n.CONNECTED=1]="CONNECTED",n[n.RECONNECTING=2]="RECONNECTING",n[n.DISCONNECTING=3]="DISCONNECTING",n[n.DISCONNECTED=4]="DISCONNECTED"})(SignalConnectionState||(SignalConnectionState={}));class SignalClient{get currentState(){return this.state}get isDisconnected(){return this.state===SignalConnectionState.DISCONNECTING||this.state===SignalConnectionState.DISCONNECTED}get isEstablishingConnection(){return this.state===SignalConnectionState.CONNECTING||this.state===SignalConnectionState.RECONNECTING}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var s;this.rtt=0,this.state=SignalConnectionState.DISCONNECTED,this.log=livekitLogger,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=getLogger((s=t.loggerName)!==null&&s!==void 0?s:LoggerNames.Signal),this.loggerContextCb=t.loggerContextCb,this.useJSON=e,this.requestQueue=new AsyncQueue,this.queuedRequests=[],this.closingLock=new Mutex,this.connectionLock=new Mutex,this.state=SignalConnectionState.DISCONNECTED}get logContext(){var e,t;return(t=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&t!==void 0?t:{}}join(e,t,s,a){return __awaiter(this,void 0,void 0,function*(){return this.state=SignalConnectionState.CONNECTING,this.options=s,yield this.connect(e,t,s,a)})}reconnect(e,t,s,a){return __awaiter(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=SignalConnectionState.RECONNECTING,this.clearPingInterval(),yield this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:s,reconnectReason:a}))})}connect(e,t,s,a){this.connectOptions=s,e=toWebsocketUrl(e),e=e.replace(/\/$/,""),e+="/rtc";const c=getClientInfo(),u=createConnectionParams(t,c,s);return new Promise((d,m)=>__awaiter(this,void 0,void 0,function*(){const _=yield this.connectionLock.lock();try{const b=()=>__awaiter(this,void 0,void 0,function*(){this.close(),clearTimeout(S),m(new ConnectionError("room connection has been cancelled (signal)"))}),S=setTimeout(()=>{this.close(),m(new ConnectionError("room connection has timed out (signal)"))},s.websocketTimeout);a!=null&&a.aborted&&b(),a==null||a.addEventListener("abort",b),this.log.debug("connecting to ".concat(e+u),this.logContext),this.ws&&(yield this.close()),this.ws=new WebSocket(e+u),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(S)},this.ws.onerror=C=>__awaiter(this,void 0,void 0,function*(){if(this.state!==SignalConnectionState.CONNECTED){clearTimeout(S);try{const w=yield fetch("http".concat(e.substring(2),"/validate").concat(u));if(w.status.toFixed(0).startsWith("4")){const O=yield w.text();m(new ConnectionError(O,0,w.status))}else m(new ConnectionError("Internal error",2,w.status))}catch{m(new ConnectionError("server was not reachable",1))}return}this.handleWSError(C)}),this.ws.onmessage=C=>__awaiter(this,void 0,void 0,function*(){var w,O,I,N;let P;if(typeof C.data=="string"){const B=JSON.parse(C.data);P=SignalResponse.fromJson(B)}else if(C.data instanceof ArrayBuffer)P=SignalResponse.fromBinary(new Uint8Array(C.data));else{this.log.error("could not decode websocket message: ".concat(typeof C.data),this.logContext);return}if(this.state!==SignalConnectionState.CONNECTED){let B=!1;if(((w=P.message)===null||w===void 0?void 0:w.case)==="join"?(this.state=SignalConnectionState.CONNECTED,a==null||a.removeEventListener("abort",b),this.pingTimeoutDuration=P.message.value.pingTimeout,this.pingIntervalDuration=P.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),d(P.message.value)):this.state===SignalConnectionState.RECONNECTING&&P.message.case!=="leave"?(this.state=SignalConnectionState.CONNECTED,a==null||a.removeEventListener("abort",b),this.startPingInterval(),((O=P.message)===null||O===void 0?void 0:O.case)==="reconnect"?d((I=P.message)===null||I===void 0?void 0:I.value):(d(),B=!0)):this.isEstablishingConnection&&P.message.case==="leave"?m(new ConnectionError("Received leave request while trying to (re)connect",4)):s.reconnect||m(new ConnectionError("did not receive join response, got ".concat((N=P.message)===null||N===void 0?void 0:N.case," instead"))),!B)return}this.signalLatency&&(yield sleep(this.signalLatency)),this.handleSignalResponse(P)}),this.ws.onclose=C=>{this.isEstablishingConnection&&m(new ConnectionError("Websocket got closed during a (re)connection attempt")),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:C.reason,state:this.state})),this.handleOnClose(C.reason)}}finally{_()}}))}close(){return __awaiter(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();try{if(this.state=SignalConnectionState.DISCONNECTING,this.ws){this.ws.onmessage=null,this.ws.onopen=null,this.ws.onclose=null;const t=new Promise(s=>{this.ws?this.ws.onclose=()=>{s()}:s()});this.ws.readyState<this.ws.CLOSING&&(this.ws.close(),yield Promise.race([t,sleep(250)])),this.ws=void 0}}finally{this.state=SignalConnectionState.DISCONNECTED,this.clearPingInterval(),e()}})}sendOffer(e){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:toProtoSessionDescription(e)})}sendAnswer(e){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:toProtoSessionDescription(e)})}sendIceCandidate(e,t){return this.log.trace("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new TrickleRequest({candidateInit:JSON.stringify(e),target:t})})}sendMuteTrack(e,t){return this.sendRequest({case:"mute",value:new MuteTrackRequest({sid:e,muted:t})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,t){return this.sendRequest({case:"updateMetadata",value:new UpdateParticipantMetadata({metadata:e,name:t})})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,t){return this.sendRequest({case:"updateLayers",value:new UpdateVideoLayers({trackSid:e,layers:t})})}sendUpdateSubscriptionPermissions(e,t){return this.sendRequest({case:"subscriptionPermission",value:new SubscriptionPermission({allParticipants:e,trackPermissions:t})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:protoInt64.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Ping({timestamp:protoInt64.parse(Date.now()),rtt:protoInt64.parse(this.rtt)})})])}sendLeave(){return this.sendRequest({case:"leave",value:new LeaveRequest({canReconnect:!1,reason:DisconnectReason$1.CLIENT_INITIATED})})}sendRequest(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return __awaiter(this,void 0,void 0,function*(){if(!t&&!canPassThroughQueue(e)&&this.state===SignalConnectionState.RECONNECTING){this.queuedRequests.push(()=>__awaiter(this,void 0,void 0,function*(){yield this.sendRequest(e,!0)}));return}if(t||(yield this.requestQueue.flush()),this.signalLatency&&(yield sleep(this.signalLatency)),!this.ws||this.ws.readyState!==this.ws.OPEN){this.log.error("cannot send signal request before connected, type: ".concat(e==null?void 0:e.case),this.logContext);return}const a=new SignalRequest({message:e});try{this.useJSON?this.ws.send(a.toJsonString()):this.ws.send(a.toBinary())}catch(c){this.log.error("error sending signal message",Object.assign(Object.assign({},this.logContext),{error:c}))}})}handleSignalResponse(e){var t,s;const a=e.message;if(a==null){this.log.debug("received unsupported message",this.logContext);return}let c=!1;if(a.case==="answer"){const u=fromProtoSessionDescription(a.value);this.onAnswer&&this.onAnswer(u)}else if(a.case==="offer"){const u=fromProtoSessionDescription(a.value);this.onOffer&&this.onOffer(u)}else if(a.case==="trickle"){const u=JSON.parse(a.value.candidateInit);this.onTrickle&&this.onTrickle(u,a.value.target)}else a.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((t=a.value.participants)!==null&&t!==void 0?t:[]):a.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(a.value):a.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((s=a.value.speakers)!==null&&s!==void 0?s:[]):a.case==="leave"?this.onLeave&&this.onLeave(a.value):a.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(a.value.sid,a.value.muted):a.case==="roomUpdate"?this.onRoomUpdate&&a.value.room&&this.onRoomUpdate(a.value.room):a.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(a.value):a.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(a.value):a.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(a.value):a.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(a.value):a.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(a.value):a.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(a.value):a.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(a.value):a.case==="pong"||(a.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(a.value.lastPingTimestamp.toString()),this.resetPingTimeout(),c=!0):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:a.case})));c||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return __awaiter(this,void 0,void 0,function*(){if(this.state===SignalConnectionState.DISCONNECTED)return;const t=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),t&&t(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=CriticalTimers.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&CriticalTimers.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=CriticalTimers.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&CriticalTimers.clearInterval(this.pingInterval)}}function fromProtoSessionDescription(n){const e={type:"offer",sdp:n.sdp};switch(n.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=n.type;break}return e}function toProtoSessionDescription(n){return new SessionDescription({sdp:n.sdp,type:n.type})}function createConnectionParams(n,e,t){var s;const a=new URLSearchParams;return a.set("access_token",n),t.reconnect&&(a.set("reconnect","1"),t.sid&&a.set("sid",t.sid)),a.set("auto_subscribe",t.autoSubscribe?"1":"0"),a.set("sdk",isReactNative()?"reactnative":"js"),a.set("version",e.version),a.set("protocol",e.protocol.toString()),e.deviceModel&&a.set("device_model",e.deviceModel),e.os&&a.set("os",e.os),e.osVersion&&a.set("os_version",e.osVersion),e.browser&&a.set("browser",e.browser),e.browserVersion&&a.set("browser_version",e.browserVersion),t.publishOnly!==void 0&&a.set("publish",t.publishOnly),t.adaptiveStream&&a.set("adaptive_stream","1"),t.reconnectReason&&a.set("reconnect_reason",t.reconnectReason.toString()),!((s=navigator.connection)===null||s===void 0)&&s.type&&a.set("network",navigator.connection.type),"?".concat(a.toString())}var parser$1={},grammar$2={exports:{}},grammar$1=grammar$2.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(n){return n.encoding?"rtpmap:%d %s/%s/%s":n.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(n){return n.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(n){return n.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(n){return"extmap:%d"+(n.direction?"/%s":"%v")+(n["encrypt-uri"]?" %s":"%v")+" %s"+(n.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(n){return n.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(n){var e="candidate:%s %d %s %d %s %d typ %s";return e+=n.raddr!=null?" raddr %s rport %d":"%v%v",e+=n.tcptype!=null?" tcptype %s":"%v",n.generation!=null&&(e+=" generation %d"),e+=n["network-id"]!=null?" network-id %d":"%v",e+=n["network-cost"]!=null?" network-cost %d":"%v",e}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(n){var e="ssrc:%d";return n.attribute!=null&&(e+=" %s",n.value!=null&&(e+=":%s")),e}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(n){return n.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(n){return n.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(n){return"imageattr:%s %s %s"+(n.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(n){return"simulcast:%s %s"+(n.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(n){return"ts-refclk:%s"+(n.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(n){var e="mediaclk:";return e+=n.id!=null?"id=%s %s":"%v%s",e+=n.mediaClockValue!=null?"=%s":"",e+=n.rateNumerator!=null?" rate=%s":"",e+=n.rateDenominator!=null?"/%s":"",e}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(grammar$1).forEach(function(n){var e=grammar$1[n];e.forEach(function(t){t.reg||(t.reg=/(.*)/),t.format||(t.format="%s")})});var grammarExports=grammar$2.exports;(function(n){var e=function(d){return String(Number(d))===d?Number(d):d},t=function(d,m,_,b){if(b&&!_)m[b]=e(d[1]);else for(var S=0;S<_.length;S+=1)d[S+1]!=null&&(m[_[S]]=e(d[S+1]))},s=function(d,m,_){var b=d.name&&d.names;d.push&&!m[d.push]?m[d.push]=[]:b&&!m[d.name]&&(m[d.name]={});var S=d.push?{}:b?m[d.name]:m;t(_.match(d.reg),S,d.names,d.name),d.push&&m[d.push].push(S)},a=grammarExports,c=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(d){var m={},_=[],b=m;return d.split(/(\r\n|\r|\n)/).filter(c).forEach(function(S){var C=S[0],w=S.slice(2);C==="m"&&(_.push({rtp:[],fmtp:[]}),b=_[_.length-1]);for(var O=0;O<(a[C]||[]).length;O+=1){var I=a[C][O];if(I.reg.test(w))return s(I,b,w)}}),m.media=_,m};var u=function(d,m){var _=m.split(/=(.+)/,2);return _.length===2?d[_[0]]=e(_[1]):_.length===1&&m.length>1&&(d[_[0]]=void 0),d};n.parseParams=function(d){return d.split(/;\s?/).reduce(u,{})},n.parseFmtpConfig=n.parseParams,n.parsePayloads=function(d){return d.toString().split(" ").map(Number)},n.parseRemoteCandidates=function(d){for(var m=[],_=d.split(" ").map(e),b=0;b<_.length;b+=3)m.push({component:_[b],ip:_[b+1],port:_[b+2]});return m},n.parseImageAttributes=function(d){return d.split(" ").map(function(m){return m.substring(1,m.length-1).split(",").reduce(u,{})})},n.parseSimulcastStreamList=function(d){return d.split(";").map(function(m){return m.split(",").map(function(_){var b,S=!1;return _[0]!=="~"?b=e(_):(b=e(_.substring(1,_.length)),S=!0),{scid:b,paused:S}})})}})(parser$1);var grammar=grammarExports,formatRegExp=/%[sdv%]/g,format=function(n){var e=1,t=arguments,s=t.length;return n.replace(formatRegExp,function(a){if(e>=s)return a;var c=t[e];switch(e+=1,a){case"%%":return"%";case"%s":return String(c);case"%d":return Number(c);case"%v":return""}})},makeLine=function(n,e,t){var s=e.format instanceof Function?e.format(e.push?t:t[e.name]):e.format,a=[n+"="+s];if(e.names)for(var c=0;c<e.names.length;c+=1){var u=e.names[c];e.name?a.push(t[e.name][u]):a.push(t[e.names[c]])}else a.push(t[e.name]);return format.apply(null,a)},defaultOuterOrder=["v","o","s","i","u","e","p","c","b","t","r","z","a"],defaultInnerOrder=["i","c","b","a"],writer$1=function(n,e){e=e||{},n.version==null&&(n.version=0),n.name==null&&(n.name=" "),n.media.forEach(function(c){c.payloads==null&&(c.payloads="")});var t=e.outerOrder||defaultOuterOrder,s=e.innerOrder||defaultInnerOrder,a=[];return t.forEach(function(c){grammar[c].forEach(function(u){u.name in n&&n[u.name]!=null?a.push(makeLine(c,u,n)):u.push in n&&n[u.push]!=null&&n[u.push].forEach(function(d){a.push(makeLine(c,u,d))})})}),n.media.forEach(function(c){a.push(makeLine("m",grammar.m[0],c)),s.forEach(function(u){grammar[u].forEach(function(d){d.name in c&&c[d.name]!=null?a.push(makeLine(u,d,c)):d.push in c&&c[d.push]!=null&&c[d.push].forEach(function(m){a.push(makeLine(u,d,m))})})})}),a.join(`\r
`)+`\r
`},parser=parser$1,writer$2=writer$1,write=writer$2,parse=parser.parse;const startBitrateForSVC=.7,PCEvents={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class PCTransport extends eventsExports$1.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var a;super(),this.log=livekitLogger,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=r(c=>__awaiter(this,void 0,void 0,function*(){this.emit(PCEvents.NegotiationStarted);try{yield this.createAndSendOffer()}catch(u){if(c)c(u);else throw u}}),100),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=getLogger((a=s.loggerName)!==null&&a!==void 0?a:LoggerNames.PCTransport),this.loggerOptions=s,this.config=e,this.mediaConstraints=t,this._pc=this.createPC()}createPC(){const e=isChromiumBased()?new RTCPeerConnection(this.config,this.mediaConstraints):new RTCPeerConnection(this.config);return e.onicecandidate=t=>{var s;t.candidate&&((s=this.onIceCandidate)===null||s===void 0||s.call(this,t.candidate))},e.onicecandidateerror=t=>{var s;(s=this.onIceCandidateError)===null||s===void 0||s.call(this,t)},e.oniceconnectionstatechange=()=>{var t;(t=this.onIceConnectionStateChange)===null||t===void 0||t.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var t;(t=this.onSignalingStatechange)===null||t===void 0||t.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,e.connectionState)},e.ondatachannel=t=>{var s;(s=this.onDataChannel)===null||s===void 0||s.call(this,t)},e.ontrack=t=>{var s;(s=this.onTrack)===null||s===void 0||s.call(this,t)},e}get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions).loggerContextCb)===null||t===void 0?void 0:t.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return __awaiter(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e){var t;return __awaiter(this,void 0,void 0,function*(){let s;if(e.type==="offer"){let{stereoMids:a,nackMids:c}=extractStereoAndNackAudioFromOffer(e);this.remoteStereoMids=a,this.remoteNackMids=c}else if(e.type==="answer"){const a=parse((t=e.sdp)!==null&&t!==void 0?t:"");a.media.forEach(c=>{c.type==="audio"&&this.trackBitrates.some(u=>{if(!u.transceiver||c.mid!=u.transceiver.mid)return!1;let d=0;if(c.rtp.some(_=>_.codec.toUpperCase()===u.codec.toUpperCase()?(d=_.payload,!0):!1),d===0)return!0;let m=!1;for(const _ of c.fmtp)if(_.payload===d){_.config=_.config.split(";").filter(b=>!b.includes("maxaveragebitrate")).join(";"),u.maxbr>0&&(_.config+=";maxaveragebitrate=".concat(u.maxbr*1e3)),m=!0;break}return m||u.maxbr>0&&c.fmtp.push({payload:d,config:"maxaveragebitrate=".concat(u.maxbr*1e3)}),!0})}),s=write(a)}yield this.setMungedSDP(e,s,!0),this.pendingCandidates.forEach(a=>{this.pc.addIceCandidate(a)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(PCEvents.NegotiationComplete),e.sdp&&parse(e.sdp).media.forEach(c=>{c.type==="video"&&this.emit(PCEvents.RTPVideoPayloadTypes,c.rtp)}))})}createAndSendOffer(e){var t;return __awaiter(this,void 0,void 0,function*(){if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const c=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&c)yield this._pc.setRemoteDescription(c);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const s=yield this.pc.createOffer(e),a=parse((t=s.sdp)!==null&&t!==void 0?t:"");a.media.forEach(c=>{c.type==="audio"?ensureAudioNackAndStereo(c,[],[]):c.type==="video"&&(ensureVideoDDExtensionForSVC(c),this.trackBitrates.some(u=>{if(!c.msid||!u.cid||!c.msid.includes(u.cid))return!1;let d=0;if(c.rtp.some(_=>_.codec.toUpperCase()===u.codec.toUpperCase()?(d=_.payload,!0):!1),d===0)return!0;let m=!1;for(const _ of c.fmtp)if(_.payload===d){_.config.includes("x-google-start-bitrate")||(_.config+=";x-google-start-bitrate=".concat(Math.round(u.maxbr*startBitrateForSVC))),_.config.includes("x-google-max-bitrate")||(_.config+=";x-google-max-bitrate=".concat(u.maxbr)),m=!0;break}return m||c.fmtp.push({payload:d,config:"x-google-start-bitrate=".concat(Math.round(u.maxbr*startBitrateForSVC),";x-google-max-bitrate=").concat(u.maxbr)}),!0}))}),yield this.setMungedSDP(s,write(a)),this.onOffer(s)})}createAndSetAnswer(){var e;return __awaiter(this,void 0,void 0,function*(){const t=yield this.pc.createAnswer(),s=parse((e=t.sdp)!==null&&e!==void 0?e:"");return s.media.forEach(a=>{a.type==="audio"&&ensureAudioNackAndStereo(a,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(t,write(s)),t})}createDataChannel(e,t){return this.pc.createDataChannel(e,t)}addTransceiver(e,t){return this.pc.addTransceiver(e,t)}addTrack(e){if(!this._pc)throw new UnexpectedConnectionState("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var t;if(!this._pc)throw new UnexpectedConnectionState("PC closed, cannot configure");return(t=this._pc)===null||t===void 0?void 0:t.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var t;return(t=this._pc)===null||t===void 0?void 0:t.removeTrack(e)}getConnectionState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&t!==void 0?t:"closed"}getICEConnectionState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&t!==void 0?t:"closed"}getSignallingState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&t!==void 0?t:"closed"}getTransceivers(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&t!==void 0?t:[]}getSenders(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&t!==void 0?t:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){var e;return __awaiter(this,void 0,void 0,function*(){if(!this._pc)return;let t="";const s=new Map,a=new Map;if((yield this._pc.getStats()).forEach(d=>{switch(d.type){case"transport":t=d.selectedCandidatePairId;break;case"candidate-pair":t===""&&d.selected&&(t=d.id),s.set(d.id,d);break;case"remote-candidate":a.set(d.id,"".concat(d.address,":").concat(d.port));break}}),t==="")return;const u=(e=s.get(t))===null||e===void 0?void 0:e.remoteCandidateId;if(u!==void 0)return a.get(u)})}setMungedSDP(e,t,s){return __awaiter(this,void 0,void 0,function*(){if(t){const a=e.sdp;e.sdp=t;try{this.log.debug("setting munged ".concat(s?"remote":"local"," description"),this.logContext),s?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(c){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:c,sdp:t})),e.sdp=a}}try{s?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(a){let c="unknown error";a instanceof Error?c=a.message:typeof a=="string"&&(c=a);const u={error:c,sdp:e.sdp};throw!s&&this.pc.remoteDescription&&(u.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:u})),new NegotiationError(c)}})}}function ensureAudioNackAndStereo(n,e,t){let s=0;n.rtp.some(a=>a.codec==="opus"?(s=a.payload,!0):!1),s>0&&(n.rtcpFb||(n.rtcpFb=[]),t.includes(n.mid)&&!n.rtcpFb.some(a=>a.payload===s&&a.type==="nack")&&n.rtcpFb.push({payload:s,type:"nack"}),e.includes(n.mid)&&n.fmtp.some(a=>a.payload===s?(a.config.includes("stereo=1")||(a.config+=";stereo=1"),!0):!1))}function ensureVideoDDExtensionForSVC(n){var e,t,s,a;const c=(t=(e=n.rtp[0])===null||e===void 0?void 0:e.codec)===null||t===void 0?void 0:t.toLowerCase();if(!isSVCCodec(c))return;let u=0;((s=n.ext)===null||s===void 0?void 0:s.some(m=>m.uri===ddExtensionURI?!0:(m.value>u&&(u=m.value),!1)))||(a=n.ext)===null||a===void 0||a.push({value:u+1,uri:ddExtensionURI})}function extractStereoAndNackAudioFromOffer(n){var e;const t=[],s=[],a=parse((e=n.sdp)!==null&&e!==void 0?e:"");let c=0;return a.media.forEach(u=>{var d;u.type==="audio"&&(u.rtp.some(m=>m.codec==="opus"?(c=m.payload,!0):!1),!((d=u.rtcpFb)===null||d===void 0)&&d.some(m=>m.payload===c&&m.type==="nack")&&s.push(u.mid),u.fmtp.some(m=>m.payload===c?(m.config.includes("sprop-stereo=1")&&t.push(u.mid),!0):!1))}),{stereoMids:t,nackMids:s}}const defaultVideoCodec="vp8",publishDefaults={audioBitrate:AudioPresets.music.maxBitrate,audioPreset:AudioPresets.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:ScreenSharePresets.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:defaultVideoCodec,backupCodec:!0},audioDefaults={autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0},videoDefaults={resolution:VideoPresets.h720.resolution},roomOptionDefaults={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new DefaultReconnectPolicy,disconnectOnPageLeave:!0,expWebAudioMix:!1},roomConnectOptionDefaults={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var PCTransportState;(function(n){n[n.NEW=0]="NEW",n[n.CONNECTING=1]="CONNECTING",n[n.CONNECTED=2]="CONNECTED",n[n.FAILED=3]="FAILED",n[n.CLOSING=4]="CLOSING",n[n.CLOSED=5]="CLOSED"})(PCTransportState||(PCTransportState={}));class PCTransportManager{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,t,s){var a;this.peerConnectionTimeout=roomConnectOptionDefaults.peerConnectionTimeout,this.log=livekitLogger,this.updateState=()=>{var u;const d=this.state,m=this.requiredTransports.map(_=>_.getConnectionState());m.every(_=>_==="connected")?this.state=PCTransportState.CONNECTED:m.some(_=>_==="failed")?this.state=PCTransportState.FAILED:m.some(_=>_==="connecting")?this.state=PCTransportState.CONNECTING:m.every(_=>_==="closed")?this.state=PCTransportState.CLOSED:m.some(_=>_==="closed")?this.state=PCTransportState.CLOSING:m.every(_=>_==="new")&&(this.state=PCTransportState.NEW),d!==this.state&&(this.log.debug("pc state change: from ".concat(PCTransportState[d]," to ").concat(PCTransportState[this.state]),this.logContext),(u=this.onStateChange)===null||u===void 0||u.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=getLogger((a=s.loggerName)!==null&&a!==void 0?a:LoggerNames.PCManager),this.loggerOptions=s,this.isPublisherConnectionRequired=!t,this.isSubscriberConnectionRequired=t;const c={optional:[{googDscp:!0}]};this.publisher=new PCTransport(e,c,s),this.subscriber=new PCTransport(e,s),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=u=>{var d;(d=this.onIceCandidate)===null||d===void 0||d.call(this,u,SignalTarget.PUBLISHER)},this.subscriber.onIceCandidate=u=>{var d;(d=this.onIceCandidate)===null||d===void 0||d.call(this,u,SignalTarget.SUBSCRIBER)},this.subscriber.onDataChannel=u=>{var d;(d=this.onDataChannel)===null||d===void 0||d.call(this,u)},this.subscriber.onTrack=u=>{var d;(d=this.onTrack)===null||d===void 0||d.call(this,u)},this.publisher.onOffer=u=>{var d;(d=this.onPublisherOffer)===null||d===void 0||d.call(this,u)},this.state=PCTransportState.NEW,this.connectionLock=new Mutex}get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions).loggerContextCb)===null||t===void 0?void 0:t.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e){return this.publisher.setRemoteDescription(e)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return __awaiter(this,void 0,void 0,function*(){if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const e=this.publisher;for(const t of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(t)}catch(s){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:s}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return __awaiter(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,t){return __awaiter(this,void 0,void 0,function*(){t===SignalTarget.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e){return __awaiter(this,void 0,void 0,function*(){return this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()})),yield this.subscriber.setRemoteDescription(e),yield this.subscriber.createAndSetAnswer()})}updateConfiguration(e,t){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),t&&this.triggerIceRestart()}ensurePCTransportConnection(e,t){var s;return __awaiter(this,void 0,void 0,function*(){const a=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((s=this.requiredTransports)===null||s===void 0?void 0:s.map(c=>this.ensureTransportConnected(c,e,t)))}finally{a()}})}negotiate(e){return __awaiter(this,void 0,void 0,function*(){return new Promise((t,s)=>__awaiter(this,void 0,void 0,function*(){const a=setTimeout(()=>{s("negotiation timed out")},this.peerConnectionTimeout),c=()=>{clearTimeout(a),s("negotiation aborted")};e.signal.addEventListener("abort",c),this.publisher.once(PCEvents.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(PCEvents.NegotiationComplete,()=>{clearTimeout(a),t()})}),yield this.publisher.negotiate(u=>{clearTimeout(a),s(u)})}))})}addPublisherTransceiver(e,t){return this.publisher.addTransceiver(e,t)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,t){return this.publisher.createDataChannel(e,t)}getConnectedAddress(e){return e===SignalTarget.PUBLISHER?this.publisher.getConnectedAddress():e===SignalTarget.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return __awaiter(this,void 0,void 0,function*(){if(e.getConnectionState()!=="connected")return new Promise((c,u)=>__awaiter(this,void 0,void 0,function*(){const d=()=>{this.log.warn("abort transport connection",this.logContext),CriticalTimers.clearTimeout(m),u(new ConnectionError("room connection has been cancelled",3))};t!=null&&t.signal.aborted&&d(),t==null||t.signal.addEventListener("abort",d);const m=CriticalTimers.setTimeout(()=>{t==null||t.signal.removeEventListener("abort",d),u(new ConnectionError("could not establish pc connection"))},s);for(;this.state!==PCTransportState.CONNECTED;)if(yield sleep(50),t!=null&&t.signal.aborted){u(new ConnectionError("room connection has been cancelled",3));return}CriticalTimers.clearTimeout(m),t==null||t.signal.removeEventListener("abort",d),c()}))})}}const lossyDataChannel="_lossy",reliableDataChannel="_reliable",minReconnectWait=2*1e3,leaveReconnect="leave-reconnect";var PCState;(function(n){n[n.New=0]="New",n[n.Connected=1]="Connected",n[n.Disconnected=2]="Disconnected",n[n.Reconnecting=3]="Reconnecting",n[n.Closed=4]="Closed"})(PCState||(PCState={}));class RTCEngine extends eventsExports$1.EventEmitter{get isClosed(){return this._isClosed}constructor(e){var t;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=roomConnectOptionDefaults.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.subscriberPrimary=!1,this.pcState=PCState.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=livekitLogger,this.handleDataChannel=s=>{let{channel:a}=s;return __awaiter(this,void 0,void 0,function*(){if(a){if(a.label===reliableDataChannel)this.reliableDCSub=a;else if(a.label===lossyDataChannel)this.lossyDCSub=a;else return;this.log.debug("on data channel ".concat(a.id,", ").concat(a.label),this.logContext),a.onmessage=this.handleDataMessage}})},this.handleDataMessage=s=>__awaiter(this,void 0,void 0,function*(){var a,c;const u=yield this.dataProcessLock.lock();try{let d;if(s.data instanceof ArrayBuffer)d=s.data;else if(s.data instanceof Blob)d=yield s.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:s.data}));return}const m=DataPacket.fromBinary(new Uint8Array(d));((a=m.value)===null||a===void 0?void 0:a.case)==="speaker"?this.emit(EngineEvent.ActiveSpeakersUpdate,m.value.value.speakers):((c=m.value)===null||c===void 0?void 0:c.case)==="user"&&this.emit(EngineEvent.DataPacketReceived,m.value.value,m.kind)}finally{u()}}),this.handleDataError=s=>{const c=s.currentTarget.maxRetransmits===0?"lossy":"reliable";if(s instanceof ErrorEvent&&s.error){const{error:u}=s.error;this.log.error("DataChannel error on ".concat(c,": ").concat(s.message),Object.assign(Object.assign({},this.logContext),{error:u}))}else this.log.error("Unknown DataChannel error on ".concat(c),Object.assign(Object.assign({},this.logContext),{event:s}))},this.handleBufferedAmountLow=s=>{const c=s.currentTarget.maxRetransmits===0?DataPacket_Kind$1.LOSSY:DataPacket_Kind$1.RELIABLE;this.updateAndEmitDCBufferStatus(c)},this.handleDisconnect=(s,a)=>{if(this._isClosed)return;this.log.warn("".concat(s," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const c=m=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(m,"ms. giving up"),this.logContext),this.emit(EngineEvent.Disconnected),this.close()},u=Date.now()-this.reconnectStart;let d=this.getNextRetryDelay({elapsedMs:u,retryCount:this.reconnectAttempts});if(d===null){c(u);return}s===leaveReconnect&&(d=0),this.log.debug("reconnecting in ".concat(d,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=CriticalTimers.setTimeout(()=>this.attemptReconnect(a),d)},this.waitForRestarted=()=>new Promise((s,a)=>{this.pcState===PCState.Connected&&s();const c=()=>{this.off(EngineEvent.Disconnected,u),s()},u=()=>{this.off(EngineEvent.Restarted,c),a()};this.once(EngineEvent.Restarted,c),this.once(EngineEvent.Disconnected,u)}),this.updateAndEmitDCBufferStatus=s=>{const a=this.isBufferStatusLow(s);typeof a<"u"&&a!==this.dcBufferStatus.get(s)&&(this.dcBufferStatus.set(s,a),this.emit(EngineEvent.DCBufferStatusChanged,a,s))},this.isBufferStatusLow=s=>{const a=this.dataChannelForKind(s);if(a)return a.bufferedAmount<=a.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===SignalConnectionState.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(ReconnectReason$1.RR_SIGNAL_DISCONNECTED))},this.log=getLogger((t=e.loggerName)!==null&&t!==void 0?t:LoggerNames.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new SignalClient(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new Mutex,this.dataProcessLock=new Mutex,this.dcBufferStatus=new Map([[DataPacket_Kind$1.LOSSY,!0],[DataPacket_Kind$1.RELIABLE,!0]]),this.client.onParticipantUpdate=s=>this.emit(EngineEvent.ParticipantUpdate,s),this.client.onConnectionQuality=s=>this.emit(EngineEvent.ConnectionQualityUpdate,s),this.client.onRoomUpdate=s=>this.emit(EngineEvent.RoomUpdate,s),this.client.onSubscriptionError=s=>this.emit(EngineEvent.SubscriptionError,s),this.client.onSubscriptionPermissionUpdate=s=>this.emit(EngineEvent.SubscriptionPermissionUpdate,s),this.client.onSpeakersChanged=s=>this.emit(EngineEvent.SpeakersChanged,s),this.client.onStreamStateUpdate=s=>this.emit(EngineEvent.StreamStateChanged,s)}get logContext(){var e,t,s,a,c,u;return{room:(t=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||t===void 0?void 0:t.name,roomSid:(a=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.room)===null||a===void 0?void 0:a.sid,identity:(u=(c=this.latestJoinResponse)===null||c===void 0?void 0:c.participant)===null||u===void 0?void 0:u.identity}}join(e,t,s,a){return __awaiter(this,void 0,void 0,function*(){this.url=e,this.token=t,this.signalOpts=s,this.maxJoinAttempts=s.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const c=yield this.client.join(e,t,s,a);return this._isClosed=!1,this.latestJoinResponse=c,this.subscriberPrimary=c.subscriberPrimary,this.pcManager||(yield this.configure(c)),this.subscriberPrimary||this.negotiate(),this.clientConfiguration=c.clientConfiguration,c}catch(c){if(c instanceof ConnectionError&&c.reason===1&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,t,s,a);throw c}})}close(){return __awaiter(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.emit(EngineEvent.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){var e;return __awaiter(this,void 0,void 0,function*(){yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const t=s=>{s&&(s.close(),s.onbufferedamountlow=null,s.onclose=null,s.onclosing=null,s.onerror=null,s.onmessage=null,s.onopen=null)};t(this.lossyDC),t(this.lossyDCSub),t(this.reliableDC),t(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0})}cleanupClient(){return __awaiter(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new TrackInvalidError("a track with the same ID has already been published");return new Promise((t,s)=>{const a=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],s(new ConnectionError("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[e.cid]={resolve:c=>{clearTimeout(a),t(c)},reject:()=>{clearTimeout(a),s(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:t}=this.pendingTrackResolvers[e.track.id];t&&t(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(t){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:t}))}return!1}updateMuteStatus(e,t){this.client.sendMuteTrack(e,t)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){var e;return __awaiter(this,void 0,void 0,function*(){return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){var t;return __awaiter(this,void 0,void 0,function*(){if(this.pcManager&&this.pcManager.currentState!==PCTransportState.NEW)return;this.participantSid=(t=e.participant)===null||t===void 0?void 0:t.sid;const s=this.makeRTCConfiguration(e);this.pcManager=new PCTransportManager(s,e.subscriberPrimary,this.loggerOptions),this.emit(EngineEvent.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(a,c)=>{this.client.sendIceCandidate(a,c)},this.pcManager.onPublisherOffer=a=>{this.client.sendOffer(a)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(a,c,u)=>__awaiter(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(a),this.logContext),a===PCTransportState.CONNECTED){const d=this.pcState===PCState.New;this.pcState=PCState.Connected,d&&this.emit(EngineEvent.Connected,e)}else a===PCTransportState.FAILED&&this.pcState===PCState.Connected&&(this.pcState=PCState.Disconnected,this.handleDisconnect("peerconnection failed",u==="failed"?ReconnectReason$1.RR_SUBSCRIBER_FAILED:ReconnectReason$1.RR_PUBLISHER_FAILED))}),this.pcManager.onTrack=a=>{this.emit(EngineEvent.MediaTrackAdded,a.track,a.streams[0],a.receiver)},this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=e=>__awaiter(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e))}),this.client.onTrickle=(e,t)=>{this.pcManager&&(this.log.trace("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:t})),this.pcManager.addIceCandidate(e,t))},this.client.onOffer=e=>__awaiter(this,void 0,void 0,function*(){if(!this.pcManager)return;const t=yield this.pcManager.createSubscriberAnswerFromOffer(e);this.client.sendAnswer(t)}),this.client.onLocalTrackPublished=e=>{var t;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(t=e.track)===null||t===void 0?void 0:t.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:s}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],s(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(EngineEvent.LocalTrackUnpublished,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,t)=>{this.emit(EngineEvent.RemoteMute,e,t)},this.client.onSubscribedQualityUpdate=e=>{this.emit(EngineEvent.SubscribedQualityUpdate,e)},this.client.onClose=()=>{this.handleDisconnect("signal",ReconnectReason$1.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{e!=null&&e.canReconnect?(this.fullReconnectOnNext=!0,this.handleDisconnect(leaveReconnect)):(this.emit(EngineEvent.Disconnected,e==null?void 0:e.reason),this.close()),this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason}))}}makeRTCConfiguration(e){var t;const s=Object.assign({},this.rtcConfig);if(!((t=this.signalOpts)===null||t===void 0)&&t.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),s.encodedInsertableStreams=!0),e.iceServers&&!s.iceServers){const a=[];e.iceServers.forEach(c=>{const u={urls:c.urls};c.username&&(u.username=c.username),c.credential&&(u.credential=c.credential),a.push(u)}),s.iceServers=a}return e.clientConfiguration&&e.clientConfiguration.forceRelay===ClientConfigSetting$1.ENABLED&&(s.iceTransportPolicy="relay"),s.sdpSemantics="unified-plan",s.continualGatheringPolicy="gather_continually",s}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(lossyDataChannel,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(reliableDataChannel,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}setPreferredCodec(e,t,s){if(!("getCapabilities"in RTCRtpSender))return;const a=RTCRtpSender.getCapabilities(t);if(!a)return;this.log.debug("get sender capabilities",Object.assign(Object.assign({},this.logContext),{cap:a}));const c=[],u=[],d=[];a.codecs.forEach(m=>{const _=m.mimeType.toLowerCase();if(_==="audio/opus"){c.push(m);return}if(!(_==="video/".concat(s))){d.push(m);return}if(s==="h264"){m.sdpFmtpLine&&m.sdpFmtpLine.includes("profile-level-id=42e01f")?c.push(m):u.push(m);return}c.push(m)}),supportsSetCodecPreferences(e)&&e.setCodecPreferences(c.concat(u,d))}createSender(e,t,s){return __awaiter(this,void 0,void 0,function*(){if(supportsTransceiver())return yield this.createTransceiverRTCRtpSender(e,t,s);if(supportsAddTrack())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new UnexpectedConnectionState("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,t,s,a){return __awaiter(this,void 0,void 0,function*(){if(supportsTransceiver())return this.createSimulcastTransceiverSender(e,t,s,a);if(supportsAddTrack())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new UnexpectedConnectionState("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,t,s){return __awaiter(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("publisher is closed");const a=[];e.mediaStream&&a.push(e.mediaStream);const c={direction:"sendonly",streams:a};s&&(c.sendEncodings=s);const u=yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,c);return e.kind===Track.Kind.Video&&t.videoCodec&&(this.setPreferredCodec(u,e.kind,t.videoCodec),e.codec=t.videoCodec),u.sender})}createSimulcastTransceiverSender(e,t,s,a){return __awaiter(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("publisher is closed");const c={direction:"sendonly"};a&&(c.sendEncodings=a);const u=yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,c);if(s.videoCodec)return this.setPreferredCodec(u,e.kind,s.videoCodec),e.setSimulcastTrackSender(s.videoCodec,u.sender),u.sender})}createRTCRtpSender(e){return __awaiter(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){var t,s,a;return __awaiter(this,void 0,void 0,function*(){if(!this._isClosed){if(this.attemptingReconnect){livekitLogger.warn("already attempting reconnect, returning early",this.logContext);return}(((t=this.clientConfiguration)===null||t===void 0?void 0:t.resumeConnection)===ClientConfigSetting$1.DISABLED||((a=(s=this.pcManager)===null||s===void 0?void 0:s.currentState)!==null&&a!==void 0?a:PCTransportState.NEW)===PCTransportState.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(c){this.reconnectAttempts+=1;let u=!0;c instanceof UnexpectedConnectionState?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:c})),u=!1):c instanceof SignalReconnectError||(this.fullReconnectOnNext=!0),u?this.handleDisconnect("reconnect",ReconnectReason$1.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(EngineEvent.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(t){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:t}))}return null}restartConnection(e){var t,s,a;return __awaiter(this,void 0,void 0,function*(){try{if(!this.url||!this.token)throw new UnexpectedConnectionState("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(EngineEvent.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let c;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new SignalReconnectError;c=yield this.join(e??this.url,this.token,this.signalOpts)}catch(u){throw u instanceof ConnectionError&&u.reason===0?new UnexpectedConnectionState("could not reconnect, token might be expired"):new SignalReconnectError}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(EngineEvent.SignalRestarted,c),yield this.waitForPCReconnected(),this.client.currentState!==SignalConnectionState.CONNECTED)throw new SignalReconnectError("Signal connection got severed during reconnect");(t=this.regionUrlProvider)===null||t===void 0||t.resetAttempts(),this.emit(EngineEvent.Restarted)}catch(c){const u=yield(s=this.regionUrlProvider)===null||s===void 0?void 0:s.getNextBestRegionUrl();if(u){yield this.restartConnection(u);return}else throw(a=this.regionUrlProvider)===null||a===void 0||a.resetAttempts(),c}})}resumeConnection(e){var t;return __awaiter(this,void 0,void 0,function*(){if(!this.url||!this.token)throw new UnexpectedConnectionState("could not reconnect, url or token not saved");if(!this.pcManager)throw new UnexpectedConnectionState("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(EngineEvent.Resuming);try{this.setupSignalClientCallbacks();const s=yield this.client.reconnect(this.url,this.token,this.participantSid,e);if(s){const a=this.makeRTCConfiguration(s);this.pcManager.updateConfiguration(a)}}catch(s){let a="";throw s instanceof Error&&(a=s.message,this.log.error(s.message,Object.assign(Object.assign({},this.logContext),{error:s}))),s instanceof ConnectionError&&s.reason===0?new UnexpectedConnectionState("could not reconnect, token might be expired"):s instanceof ConnectionError&&s.reason===4?s:new SignalReconnectError(a)}if(this.emit(EngineEvent.SignalResumed),this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==SignalConnectionState.CONNECTED)throw new SignalReconnectError("Signal connection got severed during reconnect");this.client.setReconnected(),((t=this.reliableDC)===null||t===void 0?void 0:t.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),this.emit(EngineEvent.Resumed)})}waitForPCInitialConnection(e,t){return __awaiter(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(t,e)})}waitForPCReconnected(){return __awaiter(this,void 0,void 0,function*(){this.pcState=PCState.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield sleep(minReconnectWait),!this.pcManager)throw new UnexpectedConnectionState("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=PCState.Connected}catch(e){throw this.pcState=PCState.Disconnected,new ConnectionError("could not establish PC connection, ".concat(e.message))}})}sendDataPacket(e,t){return __awaiter(this,void 0,void 0,function*(){const s=e.toBinary();yield this.ensurePublisherConnected(t);const a=this.dataChannelForKind(t);a&&a.send(s),this.updateAndEmitDCBufferStatus(t)})}ensureDataTransportConnected(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;var s;return __awaiter(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("PC manager is closed");const a=t?this.pcManager.subscriber:this.pcManager.publisher,c=t?"Subscriber":"Publisher";if(!a)throw new ConnectionError("".concat(c," connection not set"));!t&&!this.pcManager.publisher.isICEConnected&&this.pcManager.publisher.getICEConnectionState()!=="checking"&&this.negotiate();const u=this.dataChannelForKind(e,t);if((u==null?void 0:u.readyState)==="open")return;const d=new Date().getTime()+this.peerConnectionTimeout;for(;new Date().getTime()<d;){if(a.isICEConnected&&((s=this.dataChannelForKind(e,t))===null||s===void 0?void 0:s.readyState)==="open")return;yield sleep(50)}throw new ConnectionError("could not establish ".concat(c," connection, state: ").concat(a.getICEConnectionState()))})}ensurePublisherConnected(e){return __awaiter(this,void 0,void 0,function*(){yield this.ensureDataTransportConnected(e,!1)})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==PCTransportState.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return __awaiter(this,void 0,void 0,function*(){return new Promise((e,t)=>__awaiter(this,void 0,void 0,function*(){if(!this.pcManager){t(new NegotiationError("PC manager is closed"));return}this.pcManager.requirePublisher();const s=new AbortController,a=()=>{s.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&t("cannot negotiate on closed engine"),this.on(EngineEvent.Closing,a),this.pcManager.publisher.once(PCEvents.RTPVideoPayloadTypes,c=>{const u=new Map;c.forEach(d=>{const m=d.codec.toLowerCase();isVideoCodec(m)&&u.set(d.payload,m)}),this.emit(EngineEvent.RTPVideoMapUpdate,u)});try{yield this.pcManager.negotiate(s),e()}catch(c){c instanceof NegotiationError&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",ReconnectReason$1.RR_UNKNOWN),t(c)}finally{this.off(EngineEvent.Closing,a)}}))})}dataChannelForKind(e,t){if(t){if(e===DataPacket_Kind$1.LOSSY)return this.lossyDCSub;if(e===DataPacket_Kind$1.RELIABLE)return this.reliableDCSub}else{if(e===DataPacket_Kind$1.LOSSY)return this.lossyDC;if(e===DataPacket_Kind$1.RELIABLE)return this.reliableDC}}sendSyncState(e,t){var s,a;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const c=this.pcManager.subscriber.getLocalDescription(),u=this.pcManager.subscriber.getRemoteDescription(),d=(a=(s=this.signalOpts)===null||s===void 0?void 0:s.autoSubscribe)!==null&&a!==void 0?a:!0,m=new Array;e.forEach(_=>{_.isDesired!==d&&m.push(_.trackSid)}),this.client.sendSyncState(new SyncState({answer:c?toProtoSessionDescription({sdp:c.sdp,type:c.type}):void 0,offer:u?toProtoSessionDescription({sdp:u.sdp,type:u.type}):void 0,subscription:new UpdateSubscription({trackSids:m,subscribe:!d,participantTracks:[]}),publishTracks:getTrackPublicationInfo(t),dataChannels:this.dataChannelsInfo()}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],t=(s,a)=>{(s==null?void 0:s.id)!==void 0&&s.id!==null&&e.push(new DataChannelInfo({label:s.label,id:s.id,target:a}))};return t(this.dataChannelForKind(DataPacket_Kind$1.LOSSY),SignalTarget.PUBLISHER),t(this.dataChannelForKind(DataPacket_Kind$1.RELIABLE),SignalTarget.PUBLISHER),t(this.dataChannelForKind(DataPacket_Kind$1.LOSSY,!0),SignalTarget.SUBSCRIBER),t(this.dataChannelForKind(DataPacket_Kind$1.RELIABLE,!0),SignalTarget.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&CriticalTimers.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){isWeb()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){isWeb()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class SignalReconnectError extends Error{}class RegionUrlProvider{constructor(e,t){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=t}updateToken(e){this.token=e}isCloud(){return isCloud(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return __awaiter(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const t=this.regionSettings.regions.filter(s=>!this.attemptedRegions.find(a=>a.url===s.url));if(t.length>0){const s=t[0];return this.attemptedRegions.push(s),livekitLogger.debug("next region: ".concat(s.region)),s.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return __awaiter(this,void 0,void 0,function*(){const t=yield fetch("".concat(getCloudConfigUrl(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});if(t.ok){const s=yield t.json();return this.lastUpdateAt=Date.now(),s}else throw new ConnectionError("Could not fetch region settings: ".concat(t.statusText),t.status===401?0:void 0,t.status)})}}function getCloudConfigUrl(n){return"".concat(n.protocol.replace("ws","http"),"//").concat(n.host,"/settings")}const monitorFrequency=2e3;function computeBitrate(n,e){if(!e)return 0;let t,s;return"bytesReceived"in n?(t=n.bytesReceived,s=e.bytesReceived):"bytesSent"in n&&(t=n.bytesSent,s=e.bytesSent),t===void 0||s===void 0||n.timestamp===void 0||e.timestamp===void 0?0:(t-s)*8*1e3/(n.timestamp-e.timestamp)}class LocalAudioTrack extends LocalTrack{constructor(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0;super(e,Track.Kind.Audio,t,s,c),this.stopOnMute=!1,this.monitorSender=()=>__awaiter(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let u;try{u=yield this.getSenderStats()}catch(d){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:d}));return}u&&this.prevStats&&(this._currentBitrate=computeBitrate(u,this.prevStats)),this.prevStats=u}),this.audioContext=a,this.checkForSilence()}setDeviceId(e){return __awaiter(this,void 0,void 0,function*(){return this._constraints.deviceId===e?!0:(this._constraints.deviceId=e,this.isMuted||(yield this.restartTrack()),this.isMuted||unwrapConstraint(e)===this.mediaStreamTrack.getSettings().deviceId)})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return __awaiter(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.source===Track.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return __awaiter(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{const s=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==unwrapConstraint(this._constraints.deviceId);return this.source===Track.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||s)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}})}restartTrack(e){return __awaiter(this,void 0,void 0,function*(){let t;if(e){const s=constraintsForOptions({audio:e});typeof s.audio!="boolean"&&(t=s.audio)}yield this.restart(t)})}restart(e){const t=Object.create(null,{restart:{get:()=>super.restart}});return __awaiter(this,void 0,void 0,function*(){const s=yield t.restart.call(this,e);return this.checkForSilence(),s})}startMonitor(){isWeb()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},monitorFrequency)))}setProcessor(e){var t;return __awaiter(this,void 0,void 0,function*(){const s=yield this.processorLock.lock();try{if(!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");if(this.processor&&(yield this.stopProcessor()),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");const a={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(a),this.processor=e,this.processor.processedTrack&&(yield(t=this.sender)===null||t===void 0?void 0:t.replaceTrack(this.processor.processedTrack))}finally{s()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){var e;return __awaiter(this,void 0,void 0,function*(){if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const t=yield this.sender.getStats();let s;return t.forEach(a=>{a.type==="outbound-rtp"&&(s={type:"audio",streamId:a.id,packetsSent:a.packetsSent,packetsLost:a.packetsLost,bytesSent:a.bytesSent,timestamp:a.timestamp,roundTripTime:a.roundTripTime,jitter:a.jitter})}),s})}checkForSilence(){return __awaiter(this,void 0,void 0,function*(){const e=yield detectSilence(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(TrackEvent.AudioSilenceDetected)),e})}}function mediaTrackToLocalTrack(n,e,t){switch(n.kind){case"audio":return new LocalAudioTrack(n,e,!1,void 0,t);case"video":return new LocalVideoTrack(n,e,!1,t);default:throw new TrackInvalidError("unsupported track type: ".concat(n.kind))}}const presets169=Object.values(VideoPresets),presets43=Object.values(VideoPresets43),presetsScreenShare=Object.values(ScreenSharePresets),defaultSimulcastPresets169=[VideoPresets.h180,VideoPresets.h360],defaultSimulcastPresets43=[VideoPresets43.h180,VideoPresets43.h360],computeDefaultScreenShareSimulcastPresets=n=>[{scaleResolutionDownBy:2,fps:n.encoding.maxFramerate}].map(t=>{var s,a;return new VideoPreset(Math.floor(n.width/t.scaleResolutionDownBy),Math.floor(n.height/t.scaleResolutionDownBy),Math.max(15e4,Math.floor(n.encoding.maxBitrate/(Math.pow(t.scaleResolutionDownBy,2)*(((s=n.encoding.maxFramerate)!==null&&s!==void 0?s:30)/((a=t.fps)!==null&&a!==void 0?a:30))))),t.fps,n.encoding.priority)}),videoRids=["q","h","f"];function computeVideoEncodings(n,e,t,s){var a,c;let u=s==null?void 0:s.videoEncoding;n&&(u=s==null?void 0:s.screenShareEncoding);const d=s==null?void 0:s.simulcast,m=s==null?void 0:s.scalabilityMode,_=s==null?void 0:s.videoCodec;if(!u&&!d&&!m||!e||!t)return[{}];u||(u=determineAppropriateEncoding(n,e,t,_),livekitLogger.debug("using video encoding",u));const b=new VideoPreset(e,t,u.maxBitrate,u.maxFramerate,u.priority);if(m&&isSVCCodec(_)){livekitLogger.debug("using svc with scalabilityMode ".concat(m));const w=new ScalabilityMode(m),O=[];if(w.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(m));for(let I=0;I<w.spatial;I+=1)O.push({rid:videoRids[2-I],maxBitrate:u.maxBitrate/Math.pow(3,I),maxFramerate:b.encoding.maxFramerate});return O[0].scalabilityMode=m,livekitLogger.debug("encodings",O),O}if(!d)return[u];let S=[];n?S=(a=sortPresets(s==null?void 0:s.screenShareSimulcastLayers))!==null&&a!==void 0?a:defaultSimulcastLayers(n,b):S=(c=sortPresets(s==null?void 0:s.videoSimulcastLayers))!==null&&c!==void 0?c:defaultSimulcastLayers(n,b);let C;if(S.length>0){const w=S[0];S.length>1&&([,C]=S);const O=Math.max(e,t);if(O>=960&&C)return encodingsFromPresets(e,t,[w,C,b]);if(O>=480)return encodingsFromPresets(e,t,[w,b])}return encodingsFromPresets(e,t,[b])}function computeTrackBackupEncodings(n,e,t){var s,a,c,u;if(!t.backupCodec||t.backupCodec===!0||t.backupCodec.codec===t.videoCodec)return;e!==t.backupCodec.codec&&livekitLogger.warn("requested a different codec than specified as backup",{serverRequested:e,backup:t.backupCodec.codec}),t.videoCodec=e,t.videoEncoding=t.backupCodec.encoding;const d=n.mediaStreamTrack.getSettings(),m=(s=d.width)!==null&&s!==void 0?s:(a=n.dimensions)===null||a===void 0?void 0:a.width,_=(c=d.height)!==null&&c!==void 0?c:(u=n.dimensions)===null||u===void 0?void 0:u.height;return computeVideoEncodings(n.source===Track.Source.ScreenShare,m,_,t)}function determineAppropriateEncoding(n,e,t,s){const a=presetsForResolution(n,e,t);let{encoding:c}=a[0];const u=Math.max(e,t);for(let d=0;d<a.length;d+=1){const m=a[d];if(c=m.encoding,m.width>=u)break}if(s)switch(s){case"av1":c=Object.assign({},c),c.maxBitrate=c.maxBitrate*.7;break;case"vp9":c=Object.assign({},c),c.maxBitrate=c.maxBitrate*.85;break}return c}function presetsForResolution(n,e,t){if(n)return presetsScreenShare;const s=e>t?e/t:t/e;return Math.abs(s-16/9)<Math.abs(s-4/3)?presets169:presets43}function defaultSimulcastLayers(n,e){if(n)return computeDefaultScreenShareSimulcastPresets(e);const{width:t,height:s}=e,a=t>s?t/s:s/t;return Math.abs(a-16/9)<Math.abs(a-4/3)?defaultSimulcastPresets169:defaultSimulcastPresets43}function encodingsFromPresets(n,e,t){const s=[];if(t.forEach((a,c)=>{if(c>=videoRids.length)return;const u=Math.min(n,e),m={rid:videoRids[c],scaleResolutionDownBy:Math.max(1,u/Math.min(a.width,a.height)),maxBitrate:a.encoding.maxBitrate};a.encoding.maxFramerate&&(m.maxFramerate=a.encoding.maxFramerate);const _=isFireFox()||c===0;a.encoding.priority&&_&&(m.priority=a.encoding.priority,m.networkPriority=a.encoding.priority),s.push(m)}),isReactNative()&&getReactNativeOs()==="ios"){let a;s.forEach(u=>{a?u.maxFramerate&&u.maxFramerate>a&&(a=u.maxFramerate):a=u.maxFramerate});let c=!0;s.forEach(u=>{var d;u.maxFramerate!=a&&(c&&(c=!1,livekitLogger.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),livekitLogger.info('Setting framerate of encoding "'.concat((d=u.rid)!==null&&d!==void 0?d:"",'" to ').concat(a)),u.maxFramerate=a)})}return s}function sortPresets(n){if(n)return n.sort((e,t)=>{const{encoding:s}=e,{encoding:a}=t;return s.maxBitrate>a.maxBitrate?1:s.maxBitrate<a.maxBitrate?-1:s.maxBitrate===a.maxBitrate&&s.maxFramerate&&a.maxFramerate?s.maxFramerate>a.maxFramerate?1:-1:0})}class ScalabilityMode{constructor(e){const t=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!t)throw new Error("invalid scalability mode");if(this.spatial=parseInt(t[1]),this.temporal=parseInt(t[2]),t.length>3)switch(t[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=t[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}const refreshSubscribedCodecAfterNewCodec=5e3;class LocalVideoTrack extends LocalTrack{constructor(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=arguments.length>3?arguments[3]:void 0;super(e,Track.Kind.Video,t,s,a),this.simulcastCodecs=new Map,this.monitorSender=()=>__awaiter(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let c;try{c=yield this.getSenderStats()}catch(d){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:d}));return}const u=new Map(c.map(d=>[d.rid,d]));if(this.prevStats){let d=0;u.forEach((m,_)=>{var b;const S=(b=this.prevStats)===null||b===void 0?void 0:b.get(_);d+=computeBitrate(m,S)}),this._currentBitrate=d}this.prevStats=u}),this.senderLock=new Mutex}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var t;if(this.signalClient=e,!isWeb())return;const s=(t=this.sender)===null||t===void 0?void 0:t.getParameters();s&&(this.encodings=s.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},monitorFrequency))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});var t,s,a,c,u;return __awaiter(this,void 0,void 0,function*(){yield e.pauseUpstream.call(this);try{for(var d=!0,m=__asyncValues(this.simulcastCodecs.values()),_;_=yield m.next(),t=_.done,!t;d=!0)c=_.value,d=!1,yield(u=c.sender)===null||u===void 0?void 0:u.replaceTrack(null)}catch(b){s={error:b}}finally{try{!d&&!t&&(a=m.return)&&(yield a.call(m))}finally{if(s)throw s.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});var t,s,a,c,u;return __awaiter(this,void 0,void 0,function*(){yield e.resumeUpstream.call(this);try{for(var d=!0,m=__asyncValues(this.simulcastCodecs.values()),_;_=yield m.next(),t=_.done,!t;d=!0){c=_.value,d=!1;const b=c;yield(u=b.sender)===null||u===void 0?void 0:u.replaceTrack(b.mediaStreamTrack)}}catch(b){s={error:b}}finally{try{!d&&!t&&(a=m.return)&&(yield a.call(m))}finally{if(s)throw s.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return __awaiter(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.source===Track.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return __awaiter(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.source===Track.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}})}setTrackMuted(e){super.setTrackMuted(e);for(const t of this.simulcastCodecs.values())t.mediaStreamTrack.enabled=!e}getSenderStats(){var e;return __awaiter(this,void 0,void 0,function*(){if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const t=[],s=yield this.sender.getStats();return s.forEach(a=>{var c;if(a.type==="outbound-rtp"){const u={type:"video",streamId:a.id,frameHeight:a.frameHeight,frameWidth:a.frameWidth,firCount:a.firCount,pliCount:a.pliCount,nackCount:a.nackCount,packetsSent:a.packetsSent,bytesSent:a.bytesSent,framesSent:a.framesSent,timestamp:a.timestamp,rid:(c=a.rid)!==null&&c!==void 0?c:a.id,retransmittedPacketsSent:a.retransmittedPacketsSent,qualityLimitationReason:a.qualityLimitationReason,qualityLimitationResolutionChanges:a.qualityLimitationResolutionChanges},d=s.get(a.remoteId);d&&(u.jitter=d.jitter,u.packetsLost=d.packetsLost,u.roundTripTime=d.roundTripTime),t.push(u)}}),t})}setPublishingQuality(e){const t=[];for(let s=VideoQuality$1.LOW;s<=VideoQuality$1.HIGH;s+=1)t.push(new SubscribedQuality({quality:s,enabled:s<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(t)}setDeviceId(e){return __awaiter(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===unwrapConstraint(e)?!0:(this._constraints.deviceId=e,this.isMuted||(yield this.restartTrack()),this.isMuted||unwrapConstraint(e)===this._mediaStreamTrack.getSettings().deviceId)})}restartTrack(e){var t,s,a,c;return __awaiter(this,void 0,void 0,function*(){let u;if(e){const b=constraintsForOptions({video:e});typeof b.video!="boolean"&&(u=b.video)}yield this.restart(u);try{for(var d=!0,m=__asyncValues(this.simulcastCodecs.values()),_;_=yield m.next(),t=_.done,!t;d=!0){c=_.value,d=!1;const b=c;b.sender&&(b.mediaStreamTrack=this.mediaStreamTrack.clone(),yield b.sender.replaceTrack(b.mediaStreamTrack))}}catch(b){s={error:b}}finally{try{!d&&!t&&(a=m.return)&&(yield a.call(m))}finally{if(s)throw s.error}}})}setProcessor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const s=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});var a,c,u,d,m,_;return __awaiter(this,void 0,void 0,function*(){if(yield s.setProcessor.call(this,e,t),!((m=this.processor)===null||m===void 0)&&m.processedTrack)try{for(var b=!0,S=__asyncValues(this.simulcastCodecs.values()),C;C=yield S.next(),a=C.done,!a;b=!0)d=C.value,b=!1,yield(_=d.sender)===null||_===void 0?void 0:_.replaceTrack(this.processor.processedTrack)}catch(w){c={error:w}}finally{try{!b&&!a&&(u=S.return)&&(yield u.call(S))}finally{if(c)throw c.error}}})}addSimulcastTrack(e,t){if(this.simulcastCodecs.has(e))throw new Error("".concat(e," already added"));const s={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,s),s}setSimulcastTrackSender(e,t){const s=this.simulcastCodecs.get(e);s&&(s.sender=t,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},refreshSubscribedCodecAfterNewCodec))}setPublishingCodecs(e){var t,s,a,c,u,d,m;return __awaiter(this,void 0,void 0,function*(){if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(e[0].qualities),[];this.subscribedCodecs=e;const _=[];try{for(t=!0,s=__asyncValues(e);a=yield s.next(),c=a.done,!c;t=!0){m=a.value,t=!1;const b=m;if(!this.codec||this.codec===b.codec)yield this.setPublishingLayers(b.qualities);else{const S=this.simulcastCodecs.get(b.codec);if(this.log.debug("try setPublishingCodec for ".concat(b.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:S})),!S||!S.sender){for(const C of b.qualities)if(C.enabled){_.push(b.codec);break}}else S.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(b.codec),this.logContext),yield setPublishingLayersForSender(S.sender,S.encodings,b.qualities,this.senderLock,this.log,this.logContext))}}}catch(b){u={error:b}}finally{try{!t&&!c&&(d=s.return)&&(yield d.call(s))}finally{if(u)throw u.error}}return _})}setPublishingLayers(e){return __awaiter(this,void 0,void 0,function*(){this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:e})),!(!this.sender||!this.encodings)&&(yield setPublishingLayersForSender(this.sender,this.encodings,e,this.senderLock,this.log,this.logContext))})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return __awaiter(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),isMobile()&&this.isInBackground&&this.source===Track.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function setPublishingLayersForSender(n,e,t,s,a,c){return __awaiter(this,void 0,void 0,function*(){const u=yield s.lock();a.debug("setPublishingLayersForSender",Object.assign(Object.assign({},c),{sender:n,qualities:t,senderEncodings:e}));try{const d=n.getParameters(),{encodings:m}=d;if(!m)return;if(m.length!==e.length){a.warn("cannot set publishing layers, encodings mismatch");return}let _=!1;!1&&m[0].scalabilityMode||m.forEach((S,C)=>{var w;let O=(w=S.rid)!==null&&w!==void 0?w:"";O===""&&(O="q");const I=videoQualityForRid(O),N=t.find(P=>P.quality===I);N&&S.active!==N.enabled&&(_=!0,S.active=N.enabled,a.debug("setting layer ".concat(N.quality," to ").concat(S.active?"enabled":"disabled"),c),isFireFox()&&(N.enabled?(S.scaleResolutionDownBy=e[C].scaleResolutionDownBy,S.maxBitrate=e[C].maxBitrate,S.maxFrameRate=e[C].maxFrameRate):(S.scaleResolutionDownBy=4,S.maxBitrate=10,S.maxFrameRate=2)))}),_&&(d.encodings=m,a.debug("setting encodings",Object.assign(Object.assign({},c),{encodings:d.encodings})),yield n.setParameters(d))}finally{u()}})}function videoQualityForRid(n){switch(n){case"f":return VideoQuality$1.HIGH;case"h":return VideoQuality$1.MEDIUM;case"q":return VideoQuality$1.LOW;default:return VideoQuality$1.HIGH}}function videoLayersFromEncodings(n,e,t,s){if(!t)return[new VideoLayer({quality:VideoQuality$1.HIGH,width:n,height:e,bitrate:0,ssrc:0})];if(s){const a=t[0].scalabilityMode,c=new ScalabilityMode(a),u=[];for(let d=0;d<c.spatial;d+=1)u.push(new VideoLayer({quality:VideoQuality$1.HIGH-d,width:Math.ceil(n/Math.pow(2,d)),height:Math.ceil(e/Math.pow(2,d)),bitrate:t[0].maxBitrate?Math.ceil(t[0].maxBitrate/Math.pow(3,d)):0,ssrc:0}));return u}return t.map(a=>{var c,u,d;const m=(c=a.scaleResolutionDownBy)!==null&&c!==void 0?c:1;let _=videoQualityForRid((u=a.rid)!==null&&u!==void 0?u:"");return new VideoLayer({quality:_,width:Math.ceil(n/m),height:Math.ceil(e/m),bitrate:(d=a.maxBitrate)!==null&&d!==void 0?d:0,ssrc:0})})}class RemoteTrack extends Track{constructor(e,t,s,a,c){super(e,s,c),this.sid=t,this.receiver=a}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?TrackEvent.Muted:TrackEvent.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const t=s=>{s.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",t),this.receiver=void 0,this._currentBitrate=0,this.emit(TrackEvent.Ended,this))};e.addEventListener("removetrack",t)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){var e;return __awaiter(this,void 0,void 0,function*(){return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),monitorFrequency))}}class RemoteAudioTrack extends RemoteTrack{constructor(e,t,s,a,c,u){super(e,t,Track.Kind.Audio,s,u),this.monitorReceiver=()=>__awaiter(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const d=yield this.getReceiverStats();d&&this.prevStats&&this.receiver&&(this._currentBitrate=computeBitrate(d,this.prevStats)),this.prevStats=d}),this.audioContext=a,this.webAudioPluginNodes=[],c&&(this.sinkId=c.deviceId)}setVolume(e){var t;for(const s of this.attachedElements)this.audioContext?(t=this.gainNode)===null||t===void 0||t.gain.setTargetAtTime(e,0,.1):s.volume=e;isReactNative()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(isReactNative())return 1;let e=0;return this.attachedElements.forEach(t=>{t.volume>e&&(e=t.volume)}),e}setSinkId(e){return __awaiter(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(t=>{if(supportsSetSinkId(t))return t.setSinkId(e)}))})}attach(e){const t=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&supportsSetSinkId(e)&&e.setSinkId(this.sinkId),this.audioContext&&t&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let t;return e?(t=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=super.detach(),this.disconnectWebAudio()),t}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,t){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(t.srcObject);let s=this.sourceNode;this.webAudioPluginNodes.forEach(a=>{s.connect(a),s=a}),this.gainNode=e.createGain(),s.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(TrackEvent.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(a=>{this.emit(TrackEvent.AudioPlaybackFailed,a)})}disconnectWebAudio(){var e,t;(e=this.gainNode)===null||e===void 0||e.disconnect(),(t=this.sourceNode)===null||t===void 0||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return __awaiter(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t;return e.forEach(s=>{s.type==="inbound-rtp"&&(t={type:"audio",timestamp:s.timestamp,jitter:s.jitter,bytesReceived:s.bytesReceived,concealedSamples:s.concealedSamples,concealmentEvents:s.concealmentEvents,silentConcealedSamples:s.silentConcealedSamples,silentConcealmentEvents:s.silentConcealmentEvents,totalAudioEnergy:s.totalAudioEnergy,totalSamplesDuration:s.totalSamplesDuration})}),t})}}const REACTION_DELAY=100;class RemoteVideoTrack extends RemoteTrack{constructor(e,t,s,a,c){super(e,t,Track.Kind.Video,s,c),this.elementInfos=[],this.monitorReceiver=()=>__awaiter(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const u=yield this.getReceiverStats();u&&this.prevStats&&this.receiver&&(this._currentBitrate=computeBitrate(u,this.prevStats)),this.prevStats=u}),this.debouncedHandleResize=r(()=>{this.updateDimensions()},REACTION_DELAY),this.adaptiveStreamSettings=a}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(t=>{e?detachTrack(this._mediaStreamTrack,t):attachToElement(this._mediaStreamTrack,t)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(t=>t.element===e)===void 0){const t=new HTMLElementInfo(e);this.observeElementInfo(t)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(t=>t===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const t=this.elementInfos.filter(s=>s===e);for(const s of t)s.stopObserving();this.elementInfos=this.elementInfos.filter(s=>s!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let t=[];if(e)return this.stopObservingElement(e),super.detach(e);t=super.detach();for(const s of t)this.stopObservingElement(s);return t}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return __awaiter(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t,s="",a=new Map;return e.forEach(c=>{c.type==="inbound-rtp"?(s=c.codecId,t={type:"video",framesDecoded:c.framesDecoded,framesDropped:c.framesDropped,framesReceived:c.framesReceived,packetsReceived:c.packetsReceived,packetsLost:c.packetsLost,frameWidth:c.frameWidth,frameHeight:c.frameHeight,pliCount:c.pliCount,firCount:c.firCount,nackCount:c.nackCount,jitter:c.jitter,timestamp:c.timestamp,bytesReceived:c.bytesReceived,decoderImplementation:c.decoderImplementation}):c.type==="codec"&&a.set(c.id,c)}),t&&s!==""&&a.get(s)&&(t.mimeType=a.get(s).mimeType),t})}stopObservingElement(e){const t=this.elementInfos.filter(s=>s.element===e);for(const s of t)this.stopObservingElementInfo(s)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return __awaiter(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var e,t;const s=this.elementInfos.reduce((d,m)=>Math.max(d,m.visibilityChangedAt||0),0),a=!((t=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pauseVideoInBackground)!==null&&t!==void 0)||t?this.isInBackground:!1,c=this.elementInfos.some(d=>d.pictureInPicture),u=this.elementInfos.some(d=>d.visible)&&!a||c;if(this.lastVisible!==u){if(!u&&Date.now()-s<REACTION_DELAY){CriticalTimers.setTimeout(()=>{this.updateVisibility()},REACTION_DELAY);return}this.lastVisible=u,this.emit(TrackEvent.VisibilityChanged,u,this)}}updateDimensions(){var e,t;let s=0,a=0;const c=this.getPixelDensity();for(const u of this.elementInfos){const d=u.width()*c,m=u.height()*c;d+m>s+a&&(s=d,a=m)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===s&&((t=this.lastDimensions)===null||t===void 0?void 0:t.height)===a||(this.lastDimensions={width:s,height:a},this.emit(TrackEvent.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const t=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return t==="screen"?getDevicePixelRatio():t||(getDevicePixelRatio()>2?2:1)}}class HTMLElementInfo{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,t){this.onVisibilityChanged=s=>{var a;const{target:c,isIntersecting:u}=s;c===this.element&&(this.isIntersecting=u,this.visibilityChangedAt=Date.now(),(a=this.handleVisibilityChanged)===null||a===void 0||a.call(this))},this.onEnterPiP=()=>{var s;this.isPiP=!0,(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this)},this.onLeavePiP=()=>{var s;this.isPiP=!1,(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this)},this.element=e,this.isIntersecting=t??isElementInViewport(e),this.isPiP=isWeb()&&document.pictureInPictureElement===e,this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){this.isIntersecting=isElementInViewport(this.element),this.isPiP=document.pictureInPictureElement===this.element,this.element.handleResize=()=>{var e;(e=this.handleResize)===null||e===void 0||e.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,getIntersectionObserver().observe(this.element),getResizeObserver().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP)}stopObserving(){var e,t;(e=getIntersectionObserver())===null||e===void 0||e.unobserve(this.element),(t=getResizeObserver())===null||t===void 0||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP)}}function isElementInViewport(n){let e=n.offsetTop,t=n.offsetLeft;const s=n.offsetWidth,a=n.offsetHeight,{hidden:c}=n,{opacity:u,display:d}=getComputedStyle(n);for(;n.offsetParent;)n=n.offsetParent,e+=n.offsetTop,t+=n.offsetLeft;return e<window.pageYOffset+window.innerHeight&&t<window.pageXOffset+window.innerWidth&&e+a>window.pageYOffset&&t+s>window.pageXOffset&&!c&&(u!==""?parseFloat(u)>0:!0)&&d!=="none"}class TrackPublication extends eventsExports$1.EventEmitter{constructor(e,t,s,a){var c;super(),this.metadataMuted=!1,this.encryption=Encryption_Type$1.NONE,this.log=livekitLogger,this.handleMuted=()=>{this.emit(TrackEvent.Muted)},this.handleUnmuted=()=>{this.emit(TrackEvent.Unmuted)},this.log=getLogger((c=a==null?void 0:a.loggerName)!==null&&c!==void 0?c:LoggerNames.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=t,this.trackName=s,this.source=Track.Source.Unknown}setTrack(e){this.track&&(this.track.off(TrackEvent.Muted,this.handleMuted),this.track.off(TrackEvent.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(TrackEvent.Muted,this.handleMuted),e.on(TrackEvent.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),getLogContextFromTrack(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==Encryption_Type$1.NONE}get audioTrack(){if(this.track instanceof LocalAudioTrack||this.track instanceof RemoteAudioTrack)return this.track}get videoTrack(){if(this.track instanceof LocalVideoTrack||this.track instanceof RemoteVideoTrack)return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=Track.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===Track.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(n){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(n.SubscriptionStatus||(n.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(n.PermissionStatus||(n.PermissionStatus={}))})(TrackPublication||(TrackPublication={}));class LocalTrackPublication extends TrackPublication{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,t,s,a){super(e,t.sid,t.name,a),this.track=void 0,this.handleTrackEnded=()=>{this.emit(TrackEvent.Ended)},this.updateInfo(t),this.setTrack(s)}setTrack(e){this.track&&this.track.off(TrackEvent.Ended,this.handleTrackEnded),super.setTrack(e),e&&e.on(TrackEvent.Ended,this.handleTrackEnded)}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}mute(){var e;return __awaiter(this,void 0,void 0,function*(){return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){var e;return __awaiter(this,void 0,void 0,function*(){return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){var e;return __awaiter(this,void 0,void 0,function*(){yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){var e;return __awaiter(this,void 0,void 0,function*(){yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}}var ConnectionQuality$2;(function(n){n.Excellent="excellent",n.Good="good",n.Poor="poor",n.Lost="lost",n.Unknown="unknown"})(ConnectionQuality$2||(ConnectionQuality$2={}));function qualityFromProto(n){switch(n){case ConnectionQuality$1.EXCELLENT:return ConnectionQuality$2.Excellent;case ConnectionQuality$1.GOOD:return ConnectionQuality$2.Good;case ConnectionQuality$1.POOR:return ConnectionQuality$2.Poor;case ConnectionQuality$1.LOST:return ConnectionQuality$2.Lost;default:return ConnectionQuality$2.Unknown}}class Participant extends eventsExports$1.EventEmitter{get logContext(){var e,t;return Object.assign(Object.assign({},(t=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||t===void 0?void 0:t.call(e)),{participantSid:this.sid,participantId:this.identity})}get isEncrypted(){return this.tracks.size>0&&Array.from(this.tracks.values()).every(e=>e.isEncrypted)}get isAgent(){var e,t;return(t=(e=this.permissions)===null||e===void 0?void 0:e.agent)!==null&&t!==void 0?t:!1}constructor(e,t,s,a,c){var u;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=ConnectionQuality$2.Unknown,this.log=livekitLogger,this.log=getLogger((u=c==null?void 0:c.loggerName)!==null&&u!==void 0?u:LoggerNames.Participant),this.loggerOptions=c,this.setMaxListeners(100),this.sid=e,this.identity=t,this.name=s,this.metadata=a,this.audioTracks=new Map,this.videoTracks=new Map,this.tracks=new Map}getTracks(){return Array.from(this.tracks.values())}getTrack(e){for(const[,t]of this.tracks)if(t.source===e)return t}getTrackByName(e){for(const[,t]of this.tracks)if(t.trackName===e)return t}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const t=this.getTrack(Track.Source.Camera);return!(!((e=t==null?void 0:t.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const t=this.getTrack(Track.Source.Microphone);return!(!((e=t==null?void 0:t.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrack(Track.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,this.log.trace("update participant info",Object.assign(Object.assign({},this.logContext),{info:e})),!0)}_setMetadata(e){const t=this.metadata!==e,s=this.metadata;this.metadata=e,t&&this.emit(ParticipantEvent.ParticipantMetadataChanged,s)}_setName(e){const t=this.name!==e;this.name=e,t&&this.emit(ParticipantEvent.ParticipantNameChanged,e)}setPermissions(e){var t,s,a,c,u;const d=this.permissions,m=e.canPublish!==((t=this.permissions)===null||t===void 0?void 0:t.canPublish)||e.canSubscribe!==((s=this.permissions)===null||s===void 0?void 0:s.canSubscribe)||e.canPublishData!==((a=this.permissions)===null||a===void 0?void 0:a.canPublishData)||e.hidden!==((c=this.permissions)===null||c===void 0?void 0:c.hidden)||e.recorder!==((u=this.permissions)===null||u===void 0?void 0:u.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((_,b)=>{var S;return _!==((S=this.permissions)===null||S===void 0?void 0:S.canPublishSources[b])});return this.permissions=e,m&&this.emit(ParticipantEvent.ParticipantPermissionsChanged,d),m}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(ParticipantEvent.IsSpeakingChanged,e))}setConnectionQuality(e){const t=this._connectionQuality;this._connectionQuality=qualityFromProto(e),t!==this._connectionQuality&&this.emit(ParticipantEvent.ConnectionQualityChanged,this._connectionQuality)}setAudioContext(e){this.audioContext=e,this.audioTracks.forEach(t=>(t.track instanceof RemoteAudioTrack||t.track instanceof LocalAudioTrack)&&t.track.setAudioContext(e))}addTrackPublication(e){e.on(TrackEvent.Muted,()=>{this.emit(ParticipantEvent.TrackMuted,e)}),e.on(TrackEvent.Unmuted,()=>{this.emit(ParticipantEvent.TrackUnmuted,e)});const t=e;switch(t.track&&(t.track.sid=e.trackSid),this.tracks.set(e.trackSid,e),e.kind){case Track.Kind.Audio:this.audioTracks.set(e.trackSid,e);break;case Track.Kind.Video:this.videoTracks.set(e.trackSid,e);break}}}function trackPermissionToProto(n){var e,t,s;if(!n.participantSid&&!n.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new TrackPermission({participantIdentity:(e=n.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(t=n.participantSid)!==null&&t!==void 0?t:"",allTracks:(s=n.allowAll)!==null&&s!==void 0?s:!1,trackSids:n.allowedTrackSids||[]})}class RemoteTrackPublication extends TrackPublication{constructor(e,t,s,a){super(e,t.sid,t.name,a),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=VideoQuality$1.HIGH,this.handleEnded=c=>{this.setTrack(void 0),this.emit(TrackEvent.Ended,c)},this.handleVisibilityChange=c=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(c),this.logContext),this.disabled=!c,this.emitTrackUpdate()},this.handleVideoDimensionsChange=c=>{this.log.debug("adaptivestream video dimensions ".concat(c.width,"x").concat(c.height),this.logContext),this.videoDimensions=c,this.emitTrackUpdate()},this.subscribed=s,this.updateInfo(t)}setSubscribed(e){const t=this.subscriptionStatus,s=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const a=new UpdateSubscription({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new ParticipantTracks({participantSid:"",trackSids:[this.trackSid]})]});this.emit(TrackEvent.UpdateSubscription,a),this.emitSubscriptionUpdateIfChanged(t),this.emitPermissionUpdateIfChanged(s)}get subscriptionStatus(){return this.subscribed===!1?TrackPublication.SubscriptionStatus.Unsubscribed:super.isSubscribed?TrackPublication.SubscriptionStatus.Subscribed:TrackPublication.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?TrackPublication.PermissionStatus.Allowed:TrackPublication.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return!this.disabled}setEnabled(e){!this.isManualOperationAllowed()||this.disabled===!e||(this.disabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.currentVideoQuality===e||(this.currentVideoQuality=e,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var t,s;this.isManualOperationAllowed()&&(((t=this.videoDimensions)===null||t===void 0?void 0:t.width)===e.width&&((s=this.videoDimensions)===null||s===void 0?void 0:s.height)===e.height||(this.track instanceof RemoteVideoTrack&&(this.videoDimensions=e),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&this.track instanceof RemoteVideoTrack&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(e){const t=this.subscriptionStatus,s=this.permissionStatus,a=this.track;a!==e&&(a&&(a.off(TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),a.off(TrackEvent.VisibilityChanged,this.handleVisibilityChange),a.off(TrackEvent.Ended,this.handleEnded),a.detach(),a.stopMonitor(),this.emit(TrackEvent.Unsubscribed,a)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(TrackEvent.VisibilityChanged,this.handleVisibilityChange),e.on(TrackEvent.Ended,this.handleEnded),this.emit(TrackEvent.Subscribed,e)),this.emitPermissionUpdateIfChanged(s),this.emitSubscriptionUpdateIfChanged(t))}setAllowed(e){const t=this.subscriptionStatus,s=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(s),this.emitSubscriptionUpdateIfChanged(t)}setSubscriptionError(e){this.emit(TrackEvent.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const t=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):t!==e.muted&&this.emit(e.muted?TrackEvent.Muted:TrackEvent.Unmuted)}emitSubscriptionUpdateIfChanged(e){const t=this.subscriptionStatus;e!==t&&this.emit(TrackEvent.SubscriptionStatusChanged,t,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(TrackEvent.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.kind===Track.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return this.track instanceof RemoteVideoTrack&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new UpdateTrackSettings({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(e.width=Math.ceil(this.videoDimensions.width),e.height=Math.ceil(this.videoDimensions.height)):this.currentVideoQuality!==void 0?e.quality=this.currentVideoQuality:e.quality=VideoQuality$1.HIGH,this.emit(TrackEvent.UpdateSettings,e)}}class RemoteParticipant extends Participant{static fromParticipantInfo(e,t){return new RemoteParticipant(e,t.sid,t.identity,t.name,t.metadata)}constructor(e,t,s,a,c,u){super(t,s||"",a,c,u),this.signalClient=e,this.tracks=new Map,this.audioTracks=new Map,this.videoTracks=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(TrackEvent.UpdateSettings,t=>{this.log.debug("send update settings",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(e))),this.signalClient.sendUpdateTrackSettings(t)}),e.on(TrackEvent.UpdateSubscription,t=>{t.participantTracks.forEach(s=>{s.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(t)}),e.on(TrackEvent.SubscriptionPermissionChanged,t=>{this.emit(ParticipantEvent.TrackSubscriptionPermissionChanged,e,t)}),e.on(TrackEvent.SubscriptionStatusChanged,t=>{this.emit(ParticipantEvent.TrackSubscriptionStatusChanged,e,t)}),e.on(TrackEvent.Subscribed,t=>{this.emit(ParticipantEvent.TrackSubscribed,t,e)}),e.on(TrackEvent.Unsubscribed,t=>{this.emit(ParticipantEvent.TrackUnsubscribed,t,e)}),e.on(TrackEvent.SubscriptionFailed,t=>{this.emit(ParticipantEvent.TrackSubscriptionFailed,e.trackSid,t)})}getTrack(e){const t=super.getTrack(e);if(t)return t}getTrackByName(e){const t=super.getTrackByName(e);if(t)return t}setVolume(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Track.Source.Microphone;this.volumeMap.set(t,e);const s=this.getTrack(t);s&&s.track&&s.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Track.Source.Microphone;const t=this.getTrack(e);return t&&t.track?t.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,t,s,a,c,u){let d=this.getTrackPublication(t);if(d||t.startsWith("TR")||this.tracks.forEach(b=>{!d&&e.kind===b.kind.toString()&&(d=b)}),!d){if(u===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:t})),this.emit(ParticipantEvent.TrackSubscriptionFailed,t);return}u===void 0&&(u=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,t,s,a,c,u-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(d))),this.emit(ParticipantEvent.TrackSubscriptionFailed,t);return}const m=e.kind==="video";let _;return m?_=new RemoteVideoTrack(e,t,a,c):_=new RemoteAudioTrack(e,t,a,this.audioContext,this.audioOutput),_.source=d.source,_.isMuted=d.isMuted,_.setMediaStream(s),_.start(),d.setTrack(_),this.volumeMap.has(d.source)&&_ instanceof RemoteAudioTrack&&_.setVolume(this.volumeMap.get(d.source)),d}get hasMetadata(){return!!this.participantInfo}getTrackPublication(e){return this.tracks.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const t=new Map,s=new Map;return e.tracks.forEach(a=>{var c,u;let d=this.getTrackPublication(a.sid);if(d)d.updateInfo(a);else{const m=Track.kindFromProto(a.type);if(!m)return;d=new RemoteTrackPublication(m,a,(c=this.signalClient.connectOptions)===null||c===void 0?void 0:c.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(u=this.loggerOptions)===null||u===void 0?void 0:u.loggerName}),d.updateInfo(a),s.set(a.sid,d);const _=Array.from(this.tracks.values()).find(b=>b.source===(d==null?void 0:d.source));_&&d.source!==Track.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(d.source),Object.assign(Object.assign({},this.logContext),{oldTrack:getLogContextFromTrack(_),newTrack:getLogContextFromTrack(d)})),this.addTrackPublication(d)}t.set(a.sid,d)}),this.tracks.forEach(a=>{t.has(a.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(a))),this.unpublishTrack(a.trackSid,!0))}),s.forEach(a=>{this.emit(ParticipantEvent.TrackPublished,a)}),!0}unpublishTrack(e,t){const s=this.tracks.get(e);if(!s)return;const{track:a}=s;switch(a&&(a.stop(),s.setTrack(void 0)),this.tracks.delete(e),s.kind){case Track.Kind.Audio:this.audioTracks.delete(e);break;case Track.Kind.Video:this.videoTracks.delete(e);break}t&&this.emit(ParticipantEvent.TrackUnpublished,s)}setAudioOutput(e){return __awaiter(this,void 0,void 0,function*(){this.audioOutput=e;const t=[];this.audioTracks.forEach(s=>{var a;s.track instanceof RemoteAudioTrack&&t.push(s.track.setSinkId((a=e.deviceId)!==null&&a!==void 0?a:"default"))}),yield Promise.all(t)})}emit(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),a=1;a<t;a++)s[a-1]=arguments[a];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:s})),super.emit(e,...s)}}class LocalParticipant extends Participant{constructor(e,t,s,a){super(e,t,void 0,void 0,{loggerName:a.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Encryption_Type$1.NONE,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Future)},this.handleReconnected=()=>{var c,u;(u=(c=this.reconnectFuture)===null||c===void 0?void 0:c.resolve)===null||u===void 0||u.call(c),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var c,u;this.reconnectFuture&&(this.reconnectFuture.promise.catch(d=>this.log.warn(d.message,this.logContext)),(u=(c=this.reconnectFuture)===null||c===void 0?void 0:c.reject)===null||u===void 0||u.call(c,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0)},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(c=>trackPermissionToProto(c)))},this.onTrackUnmuted=c=>{this.onTrackMuted(c,c.isUpstreamPaused)},this.onTrackMuted=(c,u)=>{if(u===void 0&&(u=!0),!c.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(c)));return}this.engine.updateMuteStatus(c.sid,u)},this.onTrackUpstreamPaused=c=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(c))),this.onTrackMuted(c,!0)},this.onTrackUpstreamResumed=c=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(c))),this.onTrackMuted(c,c.isMuted)},this.handleSubscribedQualityUpdate=c=>__awaiter(this,void 0,void 0,function*(){var u,d,m,_,b,S;if(!(!((b=this.roomOptions)===null||b===void 0)&&b.dynacast))return;const C=this.videoTracks.get(c.trackSid);if(!C){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:c.trackSid}));return}if(c.subscribedCodecs.length>0){if(!C.videoTrack)return;const N=yield C.videoTrack.setPublishingCodecs(c.subscribedCodecs);try{for(var w=!0,O=__asyncValues(N),I;I=yield O.next(),u=I.done,!u;w=!0){_=I.value,w=!1;const P=_;isBackupCodec(P)&&(this.log.debug("publish ".concat(P," for ").concat(C.videoTrack.sid),Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(C))),yield this.publishAdditionalCodecForTrack(C.videoTrack,P,C.options))}}catch(P){d={error:P}}finally{try{!w&&!u&&(m=O.return)&&(yield m.call(O))}finally{if(d)throw d.error}}}else c.subscribedQualities.length>0&&(yield(S=C.videoTrack)===null||S===void 0?void 0:S.setPublishingLayers(c.subscribedQualities))}),this.handleLocalTrackUnpublished=c=>{const u=this.tracks.get(c.trackSid);if(!u){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:c.trackSid}));return}this.unpublishTrack(u.track)},this.handleTrackEnded=c=>__awaiter(this,void 0,void 0,function*(){if(c.source===Track.Source.ScreenShare||c.source===Track.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(c))),this.unpublishTrack(c);else if(c.isUserProvided)yield c.mute();else if(c instanceof LocalAudioTrack||c instanceof LocalVideoTrack)try{if(isWeb())try{const u=yield navigator==null?void 0:navigator.permissions.query({name:c.source===Track.Source.Camera?"camera":"microphone"});if(u&&u.state==="denied")throw this.log.warn("user has revoked access to ".concat(c.source),Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(c))),u.onchange=()=>{u.state!=="denied"&&(c.isMuted||c.restartTrack(),u.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}c.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(c))),yield c.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(c))),yield c.mute()}}),this.audioTracks=new Map,this.videoTracks=new Map,this.tracks=new Map,this.engine=s,this.roomOptions=a,this.setupEngine(s),this.activeDeviceMap=new Map}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Encryption_Type$1.NONE}getTrack(e){const t=super.getTrack(e);if(t)return t}getTrackByName(e){const t=super.getTrackByName(e);if(t)return t}setupEngine(e){this.engine=e,this.engine.on(EngineEvent.RemoteMute,(t,s)=>{const a=this.tracks.get(t);!a||!a.track||(s?a.mute():a.unmute())}),this.engine.on(EngineEvent.Connected,this.handleReconnected).on(EngineEvent.SignalRestarted,this.handleReconnected).on(EngineEvent.SignalResumed,this.handleReconnected).on(EngineEvent.Restarting,this.handleReconnecting).on(EngineEvent.Resuming,this.handleReconnecting).on(EngineEvent.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(EngineEvent.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(EngineEvent.Disconnected,this.handleDisconnected)}setMetadata(e){var t;this.engine.client.sendUpdateLocalMetadata(e,(t=this.name)!==null&&t!==void 0?t:"")}setName(e){var t;this.engine.client.sendUpdateLocalMetadata((t=this.metadata)!==null&&t!==void 0?t:"",e)}setCameraEnabled(e,t,s){return this.setTrackEnabled(Track.Source.Camera,e,t,s)}setMicrophoneEnabled(e,t,s){return this.setTrackEnabled(Track.Source.Microphone,e,t,s)}setScreenShareEnabled(e,t,s){return this.setTrackEnabled(Track.Source.ScreenShare,e,t,s)}setPermissions(e){const t=this.permissions,s=super.setPermissions(e);return s&&t&&this.emit(ParticipantEvent.ParticipantPermissionsChanged,t),s}setE2EEEnabled(e){return __awaiter(this,void 0,void 0,function*(){this.encryptionType=e?Encryption_Type$1.GCM:Encryption_Type$1.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,t,s,a){var c,u;return __awaiter(this,void 0,void 0,function*(){this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:t}));let d=this.getTrack(e);if(t)if(d)yield d.unmute();else{let m;if(this.pendingPublishing.has(e)){this.log.info("skipping duplicate published source",Object.assign(Object.assign({},this.logContext),{source:e}));return}this.pendingPublishing.add(e);try{switch(e){case Track.Source.Camera:m=yield this.createTracks({video:(c=s)!==null&&c!==void 0?c:!0});break;case Track.Source.Microphone:m=yield this.createTracks({audio:(u=s)!==null&&u!==void 0?u:!0});break;case Track.Source.ScreenShare:m=yield this.createScreenTracks(Object.assign({},s));break;default:throw new TrackInvalidError(e)}const _=[];for(const S of m)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(S))),_.push(this.publishTrack(S,a));[d]=yield Promise.all(_)}catch(_){throw m==null||m.forEach(b=>{b.stop()}),_ instanceof Error&&!(_ instanceof TrackInvalidError)&&this.emit(ParticipantEvent.MediaDevicesError,_),_}finally{this.pendingPublishing.delete(e)}}else if(d&&d.track)if(e===Track.Source.ScreenShare){d=yield this.unpublishTrack(d.track);const m=this.getTrack(Track.Source.ScreenShareAudio);m&&m.track&&this.unpublishTrack(m.track)}else yield d.mute();return d})}enableCameraAndMicrophone(){return __awaiter(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(Track.Source.Camera)||this.pendingPublishing.has(Track.Source.Microphone))){this.pendingPublishing.add(Track.Source.Camera),this.pendingPublishing.add(Track.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(t=>this.publishTrack(t)))}finally{this.pendingPublishing.delete(Track.Source.Camera),this.pendingPublishing.delete(Track.Source.Microphone)}}})}createTracks(e){var t,s;return __awaiter(this,void 0,void 0,function*(){const a=mergeDefaultOptions(e,(t=this.roomOptions)===null||t===void 0?void 0:t.audioCaptureDefaults,(s=this.roomOptions)===null||s===void 0?void 0:s.videoCaptureDefaults),c=constraintsForOptions(a);let u;try{u=yield navigator.mediaDevices.getUserMedia(c)}catch(d){throw d instanceof Error&&(c.audio&&(this.microphoneError=d),c.video&&(this.cameraError=d)),d}return c.audio&&(this.microphoneError=void 0,this.emit(ParticipantEvent.AudioStreamAcquired)),c.video&&(this.cameraError=void 0),u.getTracks().map(d=>{const m=d.kind==="audio";m?e.audio:e.video;let _;const b=m?c.audio:c.video;typeof b!="boolean"&&(_=b);const S=mediaTrackToLocalTrack(d,_,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return S.kind===Track.Kind.Video?S.source=Track.Source.Camera:S.kind===Track.Kind.Audio&&(S.source=Track.Source.Microphone),S.mediaStream=u,S})})}createScreenTracks(e){return __awaiter(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new DeviceUnsupportedError("getDisplayMedia not supported");e.resolution===void 0&&!isSafari17()&&(e.resolution=ScreenSharePresets.h1080fps30.resolution);const t=screenCaptureToDisplayMediaStreamOptions(e),s=yield navigator.mediaDevices.getDisplayMedia(t),a=s.getVideoTracks();if(a.length===0)throw new TrackInvalidError("no video track found");const c=new LocalVideoTrack(a[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});c.source=Track.Source.ScreenShare,e.contentHint&&(c.mediaStreamTrack.contentHint=e.contentHint);const u=[c];if(s.getAudioTracks().length>0){this.emit(ParticipantEvent.AudioStreamAcquired);const d=new LocalAudioTrack(s.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});d.source=Track.Source.ScreenShareAudio,u.push(d)}return u})}publishTrack(e,t){var s,a,c,u;return __awaiter(this,void 0,void 0,function*(){yield(s=this.reconnectFuture)===null||s===void 0?void 0:s.promise,e instanceof LocalTrack&&this.pendingPublishPromises.has(e)&&(yield this.pendingPublishPromises.get(e));let d;if(e instanceof MediaStreamTrack)d=e.getConstraints();else{d=e.constraints;let w;switch(e.source){case Track.Source.Microphone:w="audioinput";break;case Track.Source.Camera:w="videoinput"}w&&this.activeDeviceMap.has(w)&&(d=Object.assign(Object.assign({},d),{deviceId:this.activeDeviceMap.get(w)}))}if(e instanceof MediaStreamTrack)switch(e.kind){case"audio":e=new LocalAudioTrack(e,d,!0,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});break;case"video":e=new LocalVideoTrack(e,d,!0,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});break;default:throw new TrackInvalidError("unsupported MediaStreamTrack kind ".concat(e.kind))}else e.updateLoggerOptions({loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});e instanceof LocalAudioTrack&&e.setAudioContext(this.audioContext);let m;if(this.tracks.forEach(w=>{w.track&&w.track===e&&(m=w)}),m)return this.log.warn("track has already been published, skipping",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(m))),m;const _="channelCount"in e.mediaStreamTrack.getSettings()&&e.mediaStreamTrack.getSettings().channelCount===2||e.mediaStreamTrack.getConstraints().channelCount===2,b=(a=t==null?void 0:t.forceStereo)!==null&&a!==void 0?a:_;b&&(t||(t={}),t.dtx===void 0&&this.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(e))),t.red===void 0&&this.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(c=t.dtx)!==null&&c!==void 0||(t.dtx=!1),(u=t.red)!==null&&u!==void 0||(t.red=!1));const S=Object.assign(Object.assign({},this.roomOptions.publishDefaults),t);isSafari()&&this.roomOptions.e2ee&&(this.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari",Object.assign({},this.logContext)),S.simulcast=!1),S.source&&(e.source=S.source);const C=this.publish(e,S,b);this.pendingPublishPromises.set(e,C);try{return yield C}catch(w){throw w}finally{this.pendingPublishPromises.delete(e)}})}publish(e,t,s){var a,c,u,d,m,_,b,S,C,w,O,I,N;return __awaiter(this,void 0,void 0,function*(){Array.from(this.tracks.values()).find(H=>e instanceof LocalTrack&&H.source===e.source)&&e.source!==Track.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(e))),t.stopMicTrackOnMute&&e instanceof LocalAudioTrack&&(e.stopOnMute=!0),e.source===Track.Source.ScreenShare&&isFireFox()&&(t.simulcast=!1),t.videoCodec==="av1"&&!supportsAV1()&&(t.videoCodec=void 0),t.videoCodec==="vp9"&&!supportsVP9()&&(t.videoCodec=void 0),t.videoCodec===void 0&&(t.videoCodec=defaultVideoCodec);const B=t.videoCodec;e.on(TrackEvent.Muted,this.onTrackMuted),e.on(TrackEvent.Unmuted,this.onTrackUnmuted),e.on(TrackEvent.Ended,this.handleTrackEnded),e.on(TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),e.on(TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed);const x=new AddTrackRequest({cid:e.mediaStreamTrack.id,name:t.name,type:Track.kindToProto(e.kind),muted:e.isMuted,source:Track.sourceToProto(e.source),disableDtx:!(!((a=t.dtx)!==null&&a!==void 0)||a),encryption:this.encryptionType,stereo:s,disableRed:this.isE2EEEnabled||!(!((c=t.red)!==null&&c!==void 0)||c),stream:t==null?void 0:t.stream});let F;if(e.kind===Track.Kind.Video){let H={width:0,height:0};try{H=yield e.waitForDimensions()}catch{const X=(d=(u=this.roomOptions.videoCaptureDefaults)===null||u===void 0?void 0:u.resolution)!==null&&d!==void 0?d:VideoPresets.h720.resolution;H={width:X.width,height:X.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(e)),{dims:H}))}x.width=H.width,x.height=H.height,e instanceof LocalVideoTrack&&(isSVCCodec(B)&&(e.source===Track.Source.ScreenShare&&B==="vp9"&&(t.scalabilityMode="L1T3"),t.scalabilityMode=(m=t.scalabilityMode)!==null&&m!==void 0?m:"L3T3_KEY"),x.simulcastCodecs=[new SimulcastCodec({codec:B,cid:e.mediaStreamTrack.id})],t.backupCodec===!0&&(t.backupCodec={codec:defaultVideoCodec}),t.backupCodec&&B!==t.backupCodec.codec&&x.encryption===Encryption_Type$1.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),x.simulcastCodecs.push(new SimulcastCodec({codec:t.backupCodec.codec,cid:""})))),F=computeVideoEncodings(e.source===Track.Source.ScreenShare,x.width,x.height,t),x.layers=videoLayersFromEncodings(x.width,x.height,F,isSVCCodec(t.videoCodec))}else e.kind===Track.Kind.Audio&&(F=[{maxBitrate:(b=(_=t.audioPreset)===null||_===void 0?void 0:_.maxBitrate)!==null&&b!==void 0?b:t.audioBitrate,priority:(C=(S=t.audioPreset)===null||S===void 0?void 0:S.priority)!==null&&C!==void 0?C:"high",networkPriority:(O=(w=t.audioPreset)===null||w===void 0?void 0:w.priority)!==null&&O!==void 0?O:"high"}]);if(!this.engine||this.engine.isClosed)throw new UnexpectedConnectionState("cannot publish track when not connected");const k=yield this.engine.addTrack(x);let J;if(k.codecs.forEach(H=>{J===void 0&&(J=H.mimeType)}),J&&e.kind===Track.Kind.Video){const H=mimeTypeToVideoCodecString(J);H!==B&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(e)),{codec:H})),t.videoCodec=H,F=computeVideoEncodings(e.source===Track.Source.ScreenShare,x.width,x.height,t))}const z=new LocalTrackPublication(e.kind,k,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(z.options=t,e.sid=k.sid,!this.engine.pcManager)throw new UnexpectedConnectionState("pcManager is not ready");if(this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:F,trackInfo:k})),e.sender=yield this.engine.createSender(e,t,F),F)if(isFireFox()&&e.kind===Track.Kind.Audio){let H;for(const W of this.engine.pcManager.publisher.getTransceivers())if(W.sender===e.sender){H=W;break}H&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:H,codec:"opus",maxbr:!((I=F[0])===null||I===void 0)&&I.maxBitrate?F[0].maxBitrate/1e3:0})}else e.codec&&isSVCCodec(e.codec)&&(!((N=F[0])===null||N===void 0)&&N.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:x.cid,codec:e.codec,maxbr:F[0].maxBitrate/1e3});return yield this.engine.negotiate(),e instanceof LocalVideoTrack?e.startMonitor(this.engine.client):e instanceof LocalAudioTrack&&e.startMonitor(),this.addTrackPublication(z),this.emit(ParticipantEvent.LocalTrackPublished,z),z})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,t,s){var a;return __awaiter(this,void 0,void 0,function*(){if(this.encryptionType!==Encryption_Type$1.NONE)return;let c;if(this.tracks.forEach(S=>{S.track&&S.track===e&&(c=S)}),!c)throw new TrackInvalidError("track is not published");if(!(e instanceof LocalVideoTrack))throw new TrackInvalidError("track is not a video track");const u=Object.assign(Object.assign({},(a=this.roomOptions)===null||a===void 0?void 0:a.publishDefaults),s),d=computeTrackBackupEncodings(e,t,u);if(!d){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(e)));return}const m=e.addSimulcastTrack(t,d),_=new AddTrackRequest({cid:m.mediaStreamTrack.id,type:Track.kindToProto(e.kind),muted:e.isMuted,source:Track.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:u.videoCodec,cid:m.mediaStreamTrack.id}]});if(_.layers=videoLayersFromEncodings(_.width,_.height,d),!this.engine||this.engine.isClosed)throw new UnexpectedConnectionState("cannot publish track when not connected");const b=yield this.engine.addTrack(_);yield this.engine.createSimulcastSender(e,m,u,d),yield this.engine.negotiate(),this.log.debug("published ".concat(t," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:d,trackInfo:b}))})}unpublishTrack(e,t){var s,a;return __awaiter(this,void 0,void 0,function*(){const c=this.getPublicationForTrack(e),u=c?getLogContextFromTrack(c):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),u)),!c||!c.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),u));return}e=c.track,e.off(TrackEvent.Muted,this.onTrackMuted),e.off(TrackEvent.Unmuted,this.onTrackUnmuted),e.off(TrackEvent.Ended,this.handleTrackEnded),e.off(TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),e.off(TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed),t===void 0&&(t=(a=(s=this.roomOptions)===null||s===void 0?void 0:s.stopLocalTrackOnUnpublish)!==null&&a!==void 0?a:!0),t&&e.stop();let d=!1;const m=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<PCTransportState.FAILED&&m)try{for(const _ of this.engine.pcManager.publisher.getTransceivers())_.sender===m&&(_.direction="inactive",d=!0);if(this.engine.removeTrack(m)&&(d=!0),e instanceof LocalVideoTrack){for(const[,_]of e.simulcastCodecs)_.sender&&(this.engine.removeTrack(_.sender)&&(d=!0),_.sender=void 0);e.simulcastCodecs.clear()}}catch(_){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),u),{error:_}))}switch(this.tracks.delete(c.trackSid),c.kind){case Track.Kind.Audio:this.audioTracks.delete(c.trackSid);break;case Track.Kind.Video:this.videoTracks.delete(c.trackSid);break}return this.emit(ParticipantEvent.LocalTrackUnpublished,c),c.setTrack(void 0),d&&(yield this.engine.negotiate()),c})}unpublishTracks(e){return __awaiter(this,void 0,void 0,function*(){return(yield Promise.all(e.map(s=>this.unpublishTrack(s)))).filter(s=>s instanceof LocalTrackPublication)})}republishAllTracks(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return __awaiter(this,void 0,void 0,function*(){const s=[];this.tracks.forEach(a=>{a.track&&(e&&(a.options=Object.assign(Object.assign({},a.options),e)),s.push(a))}),yield Promise.all(s.map(a=>__awaiter(this,void 0,void 0,function*(){const c=a.track;yield this.unpublishTrack(c,!1),t&&!c.isMuted&&c.source!==Track.Source.ScreenShare&&c.source!==Track.Source.ScreenShareAudio&&(c instanceof LocalAudioTrack||c instanceof LocalVideoTrack)&&!c.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:a.trackSid})),yield c.restartTrack()),yield this.publishTrack(c,a.options)})))})}publishData(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return __awaiter(this,void 0,void 0,function*(){const a=Array.isArray(s)?s:s==null?void 0:s.destination,c=[],u=Array.isArray(s)?void 0:s.topic;a!==void 0&&a.forEach(m=>{m instanceof RemoteParticipant?c.push(m.sid):c.push(m)});const d=new DataPacket({kind:t,value:{case:"user",value:new UserPacket({participantSid:this.sid,payload:e,destinationSids:c,topic:u})}});yield this.engine.sendDataPacket(d,t)})}setTrackSubscriptionPermissions(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}updateInfo(e){return e.sid!==this.sid||!super.updateInfo(e)?!1:(e.tracks.forEach(t=>{var s,a;const c=this.tracks.get(t.sid);if(c){const u=c.isMuted||((a=(s=c.track)===null||s===void 0?void 0:s.isUpstreamPaused)!==null&&a!==void 0?a:!1);u!==t.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(c)),{mutedOnServer:u})),this.engine.client.sendMuteTrack(t.sid,u))}}),!0)}getPublicationForTrack(e){let t;return this.tracks.forEach(s=>{const a=s.track;a&&(e instanceof MediaStreamTrack?(a instanceof LocalAudioTrack||a instanceof LocalVideoTrack)&&a.mediaStreamTrack===e&&(t=s):e===a&&(t=s))}),t}}var ConnectionState;(function(n){n.Disconnected="disconnected",n.Connecting="connecting",n.Connected="connected",n.Reconnecting="reconnecting"})(ConnectionState||(ConnectionState={}));const connectionReconcileFrequency=2*1e3;class Room extends eventsExports$1.EventEmitter{constructor(e){var t,s,a;super(),t=this,this.state=ConnectionState.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=livekitLogger,this.connect=(c,u,d)=>__awaiter(this,void 0,void 0,function*(){var m;const _=yield this.disconnectLock.lock();if(this.state===ConnectionState.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),_(),Promise.resolve();if(this.connectFuture)return _(),this.connectFuture.promise;this.setAndEmitConnectionState(ConnectionState.Connecting),((m=this.regionUrlProvider)===null||m===void 0?void 0:m.getServerUrl().toString())!==c&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),isCloud(new URL(c))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new RegionUrlProvider(c,u):this.regionUrlProvider.updateToken(u),this.regionUrlProvider.fetchRegionSettings().catch(C=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:C}))}));const b=(C,w,O)=>__awaiter(this,void 0,void 0,function*(){var I;this.abortController&&this.abortController.abort();const N=new AbortController;this.abortController=N,_==null||_();try{yield this.attemptConnection(O??c,u,d,N),this.abortController=void 0,C()}catch(P){if(this.regionUrlProvider&&P instanceof ConnectionError&&P.reason!==3&&P.reason!==0){let B=null;try{B=yield this.regionUrlProvider.getNextBestRegionUrl((I=this.abortController)===null||I===void 0?void 0:I.signal)}catch(x){if(x instanceof ConnectionError&&(x.status===401||x.reason===3)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),w(x);return}}B?(this.log.info("Initial connection failed with ConnectionError: ".concat(P.message,". Retrying with another region: ").concat(B),this.logContext),yield b(C,w,B)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),w(P))}else this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),w(P)}}),S=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Future((C,w)=>{b(C,w,S)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(c,u,d,m,_,b)=>__awaiter(this,void 0,void 0,function*(){var S,C,w;const O=yield d.join(c,u,{autoSubscribe:m.autoSubscribe,publishOnly:m.publishOnly,adaptiveStream:typeof _.adaptiveStream=="object"?!0:_.adaptiveStream,maxRetries:m.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:m.websocketTimeout},b.signal);let I=O.serverInfo;if(I||(I={version:O.serverVersion,region:O.serverRegion}),this.log.debug("connected to Livekit Server ".concat(Object.entries(I).map(N=>{let[P,B]=N;return"".concat(P,": ").concat(B)}).join(", ")),{room:(S=O.room)===null||S===void 0?void 0:S.name,roomSid:(C=O.room)===null||C===void 0?void 0:C.sid,identity:(w=O.participant)===null||w===void 0?void 0:w.identity}),!O.serverVersion)throw new UnsupportedServer("unknown server version");return O.serverVersion==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),_.dynacast=!1),O}),this.applyJoinResponse=c=>{const u=c.participant;this.localParticipant.sid=u.sid,this.localParticipant.identity=u.identity,this.handleParticipantUpdates([u,...c.otherParticipants]),c.room&&this.handleRoomUpdate(c.room),this.options.e2ee&&this.e2eeManager&&this.e2eeManager.setSifTrailer(c.sifTrailer)},this.attemptConnection=(c,u,d,m)=>__awaiter(this,void 0,void 0,function*(){var _,b;this.state===ConnectionState.Reconnecting?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((_=this.regionUrlProvider)===null||_===void 0)&&_.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},roomConnectOptionDefaults),d),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const S=yield this.connectSignal(c,u,this.engine,this.connOptions,this.options,m);this.applyJoinResponse(S),this.setupLocalParticipantEvents(),this.emit(RoomEvent.SignalConnected)}catch(S){yield this.engine.close(),this.recreateEngine();const C=new ConnectionError("could not establish signal connection");throw S instanceof Error&&(C.message="".concat(C.message,": ").concat(S.message)),S instanceof ConnectionError&&(C.reason=S.reason,C.status=S.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:S})),C}if(m.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new ConnectionError("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,m)}catch(S){throw yield this.engine.close(),this.recreateEngine(),S}isWeb()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),isWeb()&&(document.addEventListener("freeze",this.onPageLeave),(b=navigator.mediaDevices)===null||b===void 0||b.addEventListener("devicechange",this.handleDeviceChange)),this.setAndEmitConnectionState(ConnectionState.Connected),this.emit(RoomEvent.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return __awaiter(t,void 0,void 0,function*(){var u,d,m,_;const b=yield this.disconnectLock.lock();try{if(this.state===ConnectionState.Disconnected){this.log.debug("already disconnected",this.logContext);return}this.log.info("disconnect from room",Object.assign({},this.logContext)),(this.state===ConnectionState.Connecting||this.state===ConnectionState.Reconnecting)&&(this.log.warn("abort connection attempt",this.logContext),(u=this.abortController)===null||u===void 0||u.abort(),(m=(d=this.connectFuture)===null||d===void 0?void 0:d.reject)===null||m===void 0||m.call(d,new ConnectionError("Client initiated disconnect")),this.connectFuture=void 0),!((_=this.engine)===null||_===void 0)&&_.client.isDisconnected||(yield this.engine.client.sendLeave()),this.engine&&(yield this.engine.close()),this.handleDisconnect(c,DisconnectReason$1.CLIENT_INITIATED),this.engine=void 0}finally{b()}})},this.onPageLeave=()=>__awaiter(this,void 0,void 0,function*(){yield this.disconnect()}),this.startAudio=()=>__awaiter(this,void 0,void 0,function*(){const c=[],u=getBrowser();if(u&&u.os==="iOS"){const d="livekit-dummy-audio-el";let m=document.getElementById(d);if(!m){m=document.createElement("audio"),m.id=d,m.autoplay=!0,m.hidden=!0;const _=getEmptyAudioStreamTrack();_.enabled=!0;const b=new MediaStream([_]);m.srcObject=b,document.addEventListener("visibilitychange",()=>{m&&(m.srcObject=document.hidden?null:b)}),document.body.append(m),this.once(RoomEvent.Disconnected,()=>{m==null||m.remove()})}c.push(m)}this.participants.forEach(d=>{d.audioTracks.forEach(m=>{m.track&&m.track.attachedElements.forEach(_=>{c.push(_)})})});try{yield Promise.all([this.acquireAudioContext(),...c.map(d=>(d.muted=!1,d.play()))]),this.handleAudioPlaybackStarted()}catch(d){throw this.handleAudioPlaybackFailed(d),d}}),this.startVideo=()=>__awaiter(this,void 0,void 0,function*(){const c=[];for(const u of this.participants.values())u.videoTracks.forEach(d=>{var m;(m=d.track)===null||m===void 0||m.attachedElements.forEach(_=>{c.includes(_)||c.push(_)})});yield Promise.all(c.map(u=>u.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(u=>{u.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile();for(const c of this.participants.values())this.handleParticipantDisconnected(c.sid,c);this.setAndEmitConnectionState(ConnectionState.Reconnecting)&&this.emit(RoomEvent.Reconnecting)},this.handleSignalRestarted=c=>__awaiter(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(c.serverRegion),Object.assign(Object.assign({},this.logContext),{region:c.serverRegion})),this.cachedParticipantSids=[],this.applyJoinResponse(c);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(u){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:u}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:c.serverRegion}))}catch{return}this.setAndEmitConnectionState(ConnectionState.Connected),this.emit(RoomEvent.Reconnected),this.registerConnectionReconcile(),this.participants.forEach(u=>{this.emit(RoomEvent.ParticipantConnected,u)})}),this.handleParticipantUpdates=c=>{c.forEach(u=>{if(u.identity===this.localParticipant.identity){this.localParticipant.updateInfo(u);return}const d=this.identityToSid.get(u.identity);d&&d!==u.sid&&this.handleParticipantDisconnected(d,this.participants.get(d));let m=this.participants.get(u.sid);const _=!m;u.state===ParticipantInfo_State$1.DISCONNECTED?this.handleParticipantDisconnected(u.sid,m):(m=this.getOrCreateParticipant(u.sid,u),_||m.updateInfo(u))})},this.handleActiveSpeakersUpdate=c=>{const u=[],d={};c.forEach(m=>{if(d[m.sid]=!0,m.sid===this.localParticipant.sid)this.localParticipant.audioLevel=m.level,this.localParticipant.setIsSpeaking(!0),u.push(this.localParticipant);else{const _=this.participants.get(m.sid);_&&(_.audioLevel=m.level,_.setIsSpeaking(!0),u.push(_))}}),d[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.participants.forEach(m=>{d[m.sid]||(m.audioLevel=0,m.setIsSpeaking(!1))}),this.activeSpeakers=u,this.emitWhenConnected(RoomEvent.ActiveSpeakersChanged,u)},this.handleSpeakersChanged=c=>{const u=new Map;this.activeSpeakers.forEach(m=>{u.set(m.sid,m)}),c.forEach(m=>{let _=this.participants.get(m.sid);m.sid===this.localParticipant.sid&&(_=this.localParticipant),_&&(_.audioLevel=m.level,_.setIsSpeaking(m.active),m.active?u.set(m.sid,_):u.delete(m.sid))});const d=Array.from(u.values());d.sort((m,_)=>_.audioLevel-m.audioLevel),this.activeSpeakers=d,this.emitWhenConnected(RoomEvent.ActiveSpeakersChanged,d)},this.handleStreamStateUpdate=c=>{c.streamStates.forEach(u=>{const d=this.participants.get(u.participantSid);if(!d)return;const m=d.getTrackPublication(u.trackSid);!m||!m.track||(m.track.streamState=Track.streamStateFromProto(u.state),d.emit(ParticipantEvent.TrackStreamStateChanged,m,m.track.streamState),this.emitWhenConnected(RoomEvent.TrackStreamStateChanged,m,m.track.streamState,d))})},this.handleSubscriptionPermissionUpdate=c=>{const u=this.participants.get(c.participantSid);if(!u)return;const d=u.getTrackPublication(c.trackSid);d&&d.setAllowed(c.allowed)},this.handleSubscriptionError=c=>{const u=Array.from(this.participants.values()).find(m=>m.tracks.has(c.trackSid));if(!u)return;const d=u.getTrackPublication(c.trackSid);d&&d.setSubscriptionError(c.err)},this.handleDataPacket=(c,u)=>{const d=this.participants.get(c.participantSid);this.emit(RoomEvent.DataReceived,c.payload,d,u,c.topic),d==null||d.emit(ParticipantEvent.DataReceived,c.payload,u)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(RoomEvent.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=c=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:c})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(RoomEvent.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(RoomEvent.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(RoomEvent.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>__awaiter(this,void 0,void 0,function*(){this.emit(RoomEvent.MediaDevicesChanged)}),this.handleRoomUpdate=c=>{const u=this.roomInfo;this.roomInfo=c,u&&u.metadata!==c.metadata&&this.emitWhenConnected(RoomEvent.RoomMetadataChanged,c.metadata),(u==null?void 0:u.activeRecording)!==c.activeRecording&&this.emitWhenConnected(RoomEvent.RecordingStatusChanged,c.activeRecording)},this.handleConnectionQualityUpdate=c=>{c.updates.forEach(u=>{if(u.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(u.quality);return}const d=this.participants.get(u.participantSid);d&&d.setConnectionQuality(u.quality)})},this.onLocalParticipantMetadataChanged=c=>{this.emit(RoomEvent.ParticipantMetadataChanged,c,this.localParticipant)},this.onLocalParticipantNameChanged=c=>{this.emit(RoomEvent.ParticipantNameChanged,c,this.localParticipant)},this.onLocalTrackMuted=c=>{this.emit(RoomEvent.TrackMuted,c,this.localParticipant)},this.onLocalTrackUnmuted=c=>{this.emit(RoomEvent.TrackUnmuted,c,this.localParticipant)},this.onLocalTrackPublished=c=>__awaiter(this,void 0,void 0,function*(){var u;this.emit(RoomEvent.LocalTrackPublished,c,this.localParticipant),c.track instanceof LocalAudioTrack&&(yield c.track.checkForSilence())&&this.emit(RoomEvent.LocalAudioSilenceDetected,c);const d=yield(u=c.track)===null||u===void 0?void 0:u.getDeviceId(),m=sourceToKind(c.source);m&&d&&d!==this.localParticipant.activeDeviceMap.get(m)&&(this.localParticipant.activeDeviceMap.set(m,d),this.emit(RoomEvent.ActiveDeviceChanged,m,d))}),this.onLocalTrackUnpublished=c=>{this.emit(RoomEvent.LocalTrackUnpublished,c,this.localParticipant)},this.onLocalConnectionQualityChanged=c=>{this.emit(RoomEvent.ConnectionQualityChanged,c,this.localParticipant)},this.onMediaDevicesError=c=>{this.emit(RoomEvent.MediaDevicesError,c)},this.onLocalParticipantPermissionsChanged=c=>{this.emit(RoomEvent.ParticipantPermissionsChanged,c,this.localParticipant)},this.setMaxListeners(100),this.participants=new Map,this.cachedParticipantSids=[],this.identityToSid=new Map,this.options=Object.assign(Object.assign({},roomOptionDefaults),e),this.log=getLogger((s=this.options.loggerName)!==null&&s!==void 0?s:LoggerNames.Room),this.options.audioCaptureDefaults=Object.assign(Object.assign({},audioDefaults),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},videoDefaults),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},publishDefaults),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new Mutex,this.localParticipant=new LocalParticipant("","",this.engine,this.options),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",unwrapConstraint(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",unwrapConstraint(this.options.audioCaptureDefaults.deviceId)),!((a=this.options.audioOutput)===null||a===void 0)&&a.deviceId&&this.switchActiveDevice("audiooutput",unwrapConstraint(this.options.audioOutput.deviceId)).catch(c=>this.log.warn("Could not set audio output: ".concat(c.message),this.logContext)),this.options.e2ee&&this.setupE2EE()}setE2EEEnabled(e){return __awaiter(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;this.options.e2ee&&(this.e2eeManager=new E2EEManager(this.options.e2ee),this.e2eeManager.on(EncryptionEvent.ParticipantEncryptionStatusChanged,(t,s)=>{s instanceof LocalParticipant&&(this.isE2EEEnabled=t),this.emit(RoomEvent.ParticipantEncryptionStatusChanged,t,s)}),this.e2eeManager.on(EncryptionEvent.EncryptionError,t=>this.emit(RoomEvent.EncryptionError,t)),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){return{room:this.name,roomSid:this.sid,identity:this.localParticipant.identity}}get isRecording(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&t!==void 0?t:!1}get sid(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.sid)!==null&&t!==void 0?t:""}get name(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&t!==void 0?t:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&t!==void 0?t:0}get numPublishers(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&t!==void 0?t:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new RTCEngine(this.options),this.engine.on(EngineEvent.ParticipantUpdate,this.handleParticipantUpdates).on(EngineEvent.RoomUpdate,this.handleRoomUpdate).on(EngineEvent.SpeakersChanged,this.handleSpeakersChanged).on(EngineEvent.StreamStateChanged,this.handleStreamStateUpdate).on(EngineEvent.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(EngineEvent.SubscriptionError,this.handleSubscriptionError).on(EngineEvent.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(EngineEvent.MediaTrackAdded,(e,t,s)=>{this.onTrackAdded(e,t,s)}).on(EngineEvent.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(EngineEvent.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(EngineEvent.DataPacketReceived,this.handleDataPacket).on(EngineEvent.Resuming,()=>{this.clearConnectionReconcile(),this.setAndEmitConnectionState(ConnectionState.Reconnecting)&&this.emit(RoomEvent.Reconnecting),this.cachedParticipantSids=Array.from(this.participants.keys())}).on(EngineEvent.Resumed,()=>{this.setAndEmitConnectionState(ConnectionState.Connected),this.emit(RoomEvent.Reconnected),this.registerConnectionReconcile(),this.updateSubscriptions(),Array.from(this.participants.values()).filter(t=>!this.cachedParticipantSids.includes(t.sid)).forEach(t=>this.emit(RoomEvent.ParticipantConnected,t)),this.cachedParticipantSids=[]}).on(EngineEvent.SignalResumed,()=>{this.state===ConnectionState.Reconnecting&&this.sendSyncState()}).on(EngineEvent.Restarting,this.handleRestarting).on(EngineEvent.SignalRestarted,this.handleSignalRestarted).on(EngineEvent.DCBufferStatusChanged,(e,t)=>{this.emit(RoomEvent.DCBufferStatusChanged,e,t)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return DeviceManager.getInstance().getDevices(e,t)}prepareConnection(e,t){return __awaiter(this,void 0,void 0,function*(){if(this.state===ConnectionState.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(isCloud(new URL(e))&&t){this.regionUrlProvider=new RegionUrlProvider(e,t);const s=yield this.regionUrlProvider.getNextBestRegionUrl();s&&this.state===ConnectionState.Disconnected&&(this.regionUrl=s,yield fetch(toHttpUrl(s),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(s),this.logContext))}else yield fetch(toHttpUrl(e),{method:"HEAD"})}catch(s){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:s}))}}})}getParticipantByIdentity(e){if(this.localParticipant.identity===e)return this.localParticipant;const t=this.identityToSid.get(e);if(t)return this.participants.get(t)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,t){return __awaiter(this,void 0,void 0,function*(){let s=()=>{},a;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":a=new SimulateScenario({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":a=new SimulateScenario({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":a=new SimulateScenario({scenario:{case:"serverLeave",value:!0}});break;case"migration":a=new SimulateScenario({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":s=()=>__awaiter(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),a=new SimulateScenario({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":s=()=>__awaiter(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),a=new SimulateScenario({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":a=new SimulateScenario({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),s=()=>__awaiter(this,void 0,void 0,function*(){const c=this.engine.client.onLeave;c&&c(new LeaveRequest({reason:DisconnectReason$1.CLIENT_INITIATED,canReconnect:!0}))});break;case"subscriber-bandwidth":if(t===void 0||typeof t!="number")throw new Error("subscriber-bandwidth requires a number as argument");a=new SimulateScenario({scenario:{case:"subscriberBandwidth",value:BigInt(t)}});break}a&&(yield this.engine.client.sendSimulateScenario(a),yield s())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveAudioOutputDevice(){var e,t;return(t=(e=this.options.audioOutput)===null||e===void 0?void 0:e.deviceId)!==null&&t!==void 0?t:""}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;var a,c,u;return __awaiter(this,void 0,void 0,function*(){let d=!1,m=!0;const _=s?{exact:t}:t;if(e==="audioinput"){const b=this.options.audioCaptureDefaults.deviceId;this.options.audioCaptureDefaults.deviceId=_,d=b!==_;const S=Array.from(this.localParticipant.audioTracks.values()).filter(C=>C.source===Track.Source.Microphone);try{m=(yield Promise.all(S.map(C=>{var w;return(w=C.audioTrack)===null||w===void 0?void 0:w.setDeviceId(_)}))).every(C=>C===!0)}catch(C){throw this.options.audioCaptureDefaults.deviceId=b,C}}else if(e==="videoinput"){const b=this.options.videoCaptureDefaults.deviceId;this.options.videoCaptureDefaults.deviceId=_,d=b!==_;const S=Array.from(this.localParticipant.videoTracks.values()).filter(C=>C.source===Track.Source.Camera);try{m=(yield Promise.all(S.map(C=>{var w;return(w=C.videoTrack)===null||w===void 0?void 0:w.setDeviceId(_)}))).every(C=>C===!0)}catch(C){throw this.options.videoCaptureDefaults.deviceId=b,C}}else if(e==="audiooutput"){if(!supportsSetSinkId()&&!this.options.expWebAudioMix||this.options.expWebAudioMix&&this.audioContext&&!("setSinkId"in this.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");(a=(u=this.options).audioOutput)!==null&&a!==void 0||(u.audioOutput={});const b=this.options.audioOutput.deviceId;this.options.audioOutput.deviceId=t,d=b!==_;try{this.options.expWebAudioMix?(c=this.audioContext)===null||c===void 0||c.setSinkId(t):yield Promise.all(Array.from(this.participants.values()).map(S=>S.setAudioOutput({deviceId:t})))}catch(S){throw this.options.audioOutput.deviceId=b,S}}return d&&m&&(this.localParticipant.activeDeviceMap.set(e,t),this.emit(RoomEvent.ActiveDeviceChanged,e,t)),m})}setupLocalParticipantEvents(){this.localParticipant.on(ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(ParticipantEvent.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(ParticipantEvent.TrackMuted,this.onLocalTrackMuted).on(ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).on(ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).on(ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).on(ParticipantEvent.AudioStreamAcquired,this.startAudio).on(ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.participants.clear(),this.maybeCreateEngine()}onTrackAdded(e,t,s){if(this.state===ConnectionState.Connecting||this.state===ConnectionState.Reconnecting){const b=()=>{this.onTrackAdded(e,t,s),S()},S=()=>{this.off(RoomEvent.Reconnected,b),this.off(RoomEvent.Connected,b),this.off(RoomEvent.Disconnected,S)};this.once(RoomEvent.Reconnected,b),this.once(RoomEvent.Connected,b),this.once(RoomEvent.Disconnected,S);return}if(this.state===ConnectionState.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}const a=unpackStreamId(t.id),c=a[0];let u=a[1],d=e.id;if(u&&u.startsWith("TR")&&(d=u),c===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const m=this.participants.get(c);if(!m){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(c),this.logContext);return}let _;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?_=this.options.adaptiveStream:_={}),m.addSubscribedMediaTrack(e,d,t,s,_)}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=arguments.length>1?arguments[1]:void 0;var s;if(this.clearConnectionReconcile(),this.state!==ConnectionState.Disconnected){this.regionUrl=void 0;try{this.participants.forEach(a=>{a.tracks.forEach(c=>{a.unpublishTrack(c.trackSid)})}),this.localParticipant.tracks.forEach(a=>{var c,u;a.track&&this.localParticipant.unpublishTrack(a.track,e),e&&((c=a.track)===null||c===void 0||c.detach(),(u=a.track)===null||u===void 0||u.stop())}),this.localParticipant.off(ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(ParticipantEvent.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(ParticipantEvent.TrackMuted,this.onLocalTrackMuted).off(ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).off(ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).off(ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).off(ParticipantEvent.AudioStreamAcquired,this.startAudio).off(ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.tracks.clear(),this.localParticipant.videoTracks.clear(),this.localParticipant.audioTracks.clear(),this.participants.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.expWebAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),isWeb()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(s=navigator.mediaDevices)===null||s===void 0||s.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(ConnectionState.Disconnected),this.emit(RoomEvent.Disconnected,t)}}}handleParticipantDisconnected(e,t){this.participants.delete(e),t&&(this.identityToSid.delete(t.identity),t.tracks.forEach(s=>{t.unpublishTrack(s.trackSid,!0)}),this.emit(RoomEvent.ParticipantDisconnected,t))}acquireAudioContext(){var e,t;return __awaiter(this,void 0,void 0,function*(){if(typeof this.options.expWebAudioMix!="boolean"&&this.options.expWebAudioMix.audioContext?this.audioContext=this.options.expWebAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=getNewAudioContext())!==null&&e!==void 0?e:void 0),this.audioContext&&this.audioContext.state==="suspended")try{yield this.audioContext.resume()}catch(a){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:a}))}this.options.expWebAudioMix&&this.participants.forEach(a=>a.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext);const s=((t=this.audioContext)===null||t===void 0?void 0:t.state)==="running";s!==this.canPlaybackAudio&&(this.audioEnabled=s,this.emit(RoomEvent.AudioPlaybackStatusChanged,s))})}createParticipant(e,t){var s;let a;return t?a=RemoteParticipant.fromParticipantInfo(this.engine.client,t):a=new RemoteParticipant(this.engine.client,e,"",void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.expWebAudioMix&&a.setAudioContext(this.audioContext),!((s=this.options.audioOutput)===null||s===void 0)&&s.deviceId&&a.setAudioOutput(this.options.audioOutput).catch(c=>this.log.warn("Could not set audio output: ".concat(c.message),this.logContext)),a}getOrCreateParticipant(e,t){if(this.participants.has(e))return this.participants.get(e);const s=this.createParticipant(e,t);return this.participants.set(e,s),this.identityToSid.set(t.identity,t.sid),this.emitWhenConnected(RoomEvent.ParticipantConnected,s),s.on(ParticipantEvent.TrackPublished,a=>{this.emitWhenConnected(RoomEvent.TrackPublished,a,s)}).on(ParticipantEvent.TrackSubscribed,(a,c)=>{a.kind===Track.Kind.Audio?(a.on(TrackEvent.AudioPlaybackStarted,this.handleAudioPlaybackStarted),a.on(TrackEvent.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):a.kind===Track.Kind.Video&&(a.on(TrackEvent.VideoPlaybackFailed,this.handleVideoPlaybackFailed),a.on(TrackEvent.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(RoomEvent.TrackSubscribed,a,c,s)}).on(ParticipantEvent.TrackUnpublished,a=>{this.emit(RoomEvent.TrackUnpublished,a,s)}).on(ParticipantEvent.TrackUnsubscribed,(a,c)=>{this.emit(RoomEvent.TrackUnsubscribed,a,c,s)}).on(ParticipantEvent.TrackSubscriptionFailed,a=>{this.emit(RoomEvent.TrackSubscriptionFailed,a,s)}).on(ParticipantEvent.TrackMuted,a=>{this.emitWhenConnected(RoomEvent.TrackMuted,a,s)}).on(ParticipantEvent.TrackUnmuted,a=>{this.emitWhenConnected(RoomEvent.TrackUnmuted,a,s)}).on(ParticipantEvent.ParticipantMetadataChanged,a=>{this.emitWhenConnected(RoomEvent.ParticipantMetadataChanged,a,s)}).on(ParticipantEvent.ParticipantNameChanged,a=>{this.emitWhenConnected(RoomEvent.ParticipantNameChanged,a,s)}).on(ParticipantEvent.ConnectionQualityChanged,a=>{this.emitWhenConnected(RoomEvent.ConnectionQualityChanged,a,s)}).on(ParticipantEvent.ParticipantPermissionsChanged,a=>{this.emitWhenConnected(RoomEvent.ParticipantPermissionsChanged,a,s)}).on(ParticipantEvent.TrackSubscriptionStatusChanged,(a,c)=>{this.emitWhenConnected(RoomEvent.TrackSubscriptionStatusChanged,a,c,s)}).on(ParticipantEvent.TrackSubscriptionFailed,(a,c)=>{this.emit(RoomEvent.TrackSubscriptionFailed,a,s,c)}).on(ParticipantEvent.TrackSubscriptionPermissionChanged,(a,c)=>{this.emitWhenConnected(RoomEvent.TrackSubscriptionPermissionChanged,a,c,s)}),t&&s.updateInfo(t),s}sendSyncState(){const e=Array.from(this.participants.values()).reduce((s,a)=>(s.push(...a.getTracks()),s),[]),t=this.localParticipant.getTracks();this.engine.sendSyncState(e,t)}updateSubscriptions(){for(const e of this.participants.values())for(const t of e.videoTracks.values())t.isSubscribed&&t instanceof RemoteTrackPublication&&t.emitTrackUpdate()}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=CriticalTimers.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,DisconnectReason$1.STATE_MISMATCH))):e=0},connectionReconcileFrequency)}clearConnectionReconcile(){this.connectionReconcileInterval&&CriticalTimers.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(RoomEvent.ConnectionStateChanged,this.state),!0)}emitWhenConnected(e){if(this.state===ConnectionState.Connected){for(var t=arguments.length,s=new Array(t>1?t-1:0),a=1;a<t;a++)s[a-1]=arguments[a];return this.emit(e,...s)}return!1}simulateParticipants(e){var t,s;return __awaiter(this,void 0,void 0,function*(){const a=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),c=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new Room$1({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:protoInt64.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new ParticipantInfo({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(RoomEvent.SignalConnected),this.emit(RoomEvent.Connected),this.setAndEmitConnectionState(ConnectionState.Connected),a.video){const u=new LocalTrackPublication(Track.Kind.Video,new TrackInfo({source:TrackSource$2.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType$1.AUDIO,name:"video-dummy"}),new LocalVideoTrack(a.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:createDummyVideoStreamTrack(160*((t=c.aspectRatios[0])!==null&&t!==void 0?t:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(u),this.localParticipant.emit(ParticipantEvent.LocalTrackPublished,u)}if(a.audio){const u=new LocalTrackPublication(Track.Kind.Audio,new TrackInfo({source:TrackSource$2.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType$1.AUDIO}),new LocalAudioTrack(a.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:getEmptyAudioStreamTrack(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(u),this.localParticipant.emit(ParticipantEvent.LocalTrackPublished,u)}for(let u=0;u<c.count-1;u+=1){let d=new ParticipantInfo({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(u),state:ParticipantInfo_State$1.ACTIVE,tracks:[],joinedAt:protoInt64.parse(Date.now())});const m=this.getOrCreateParticipant(d.identity,d);if(c.video){const _=createDummyVideoStreamTrack(160*((s=c.aspectRatios[u%c.aspectRatios.length])!==null&&s!==void 0?s:1),160,!1,!0),b=new TrackInfo({source:TrackSource$2.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType$1.AUDIO});m.addSubscribedMediaTrack(_,b.sid,new MediaStream([_])),d.tracks=[...d.tracks,b]}if(c.audio){const _=getEmptyAudioStreamTrack(),b=new TrackInfo({source:TrackSource$2.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType$1.AUDIO});m.addSubscribedMediaTrack(_,b.sid,new MediaStream([_])),d.tracks=[...d.tracks,b]}m.updateInfo(d)}})}emit(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),a=1;a<t;a++)s[a-1]=arguments[a];if(e!==RoomEvent.ActiveSpeakersChanged){const c=mapArgs(s).filter(u=>u!==void 0);this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:c}))}return super.emit(e,...s)}}function mapArgs(n){return n.map(e=>{if(e)return Array.isArray(e)?mapArgs(e):typeof e=="object"?"logContext"in e&&e.logContext:e})}var CheckStatus;(function(n){n[n.IDLE=0]="IDLE",n[n.RUNNING=1]="RUNNING",n[n.SKIPPED=2]="SKIPPED",n[n.SUCCESS=3]="SUCCESS",n[n.FAILED=4]="FAILED"})(CheckStatus||(CheckStatus={}));class Checker extends eventsExports$1.EventEmitter{constructor(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=CheckStatus.IDLE,this.logs=[],this.errorsAsWarnings=!1,this.url=e,this.token=t,this.name=this.constructor.name,this.room=new Room(s.roomOptions),this.connectOptions=s.connectOptions,s.errorsAsWarnings&&(this.errorsAsWarnings=s.errorsAsWarnings)}run(e){return __awaiter(this,void 0,void 0,function*(){if(this.status!==CheckStatus.IDLE)throw Error("check is running already");this.setStatus(CheckStatus.RUNNING);try{yield this.perform()}catch(t){t instanceof Error&&(this.errorsAsWarnings?this.appendWarning(t.message):this.appendError(t.message))}return yield this.disconnect(),yield new Promise(t=>setTimeout(t,500)),this.status!==CheckStatus.SKIPPED&&this.setStatus(this.isSuccess()?CheckStatus.SUCCESS:CheckStatus.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(){return __awaiter(this,void 0,void 0,function*(){return this.room.state===ConnectionState.Connected?this.room:(yield this.room.connect(this.url,this.token),this.room)})}disconnect(){return __awaiter(this,void 0,void 0,function*(){this.room&&this.room.state!==ConnectionState.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(CheckStatus.SKIPPED)}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}function createLocalTracks(n){var e,t;return __awaiter(this,void 0,void 0,function*(){n??(n={}),(e=n.audio)!==null&&e!==void 0||(n.audio=!0),(t=n.video)!==null&&t!==void 0||(n.video=!0);const s=mergeDefaultOptions(n,audioDefaults,videoDefaults),a=constraintsForOptions(s),c=navigator.mediaDevices.getUserMedia(a);n.audio&&(DeviceManager.userMediaPromiseMap.set("audioinput",c),c.catch(()=>DeviceManager.userMediaPromiseMap.delete("audioinput"))),n.video&&(DeviceManager.userMediaPromiseMap.set("videoinput",c),c.catch(()=>DeviceManager.userMediaPromiseMap.delete("videoinput")));const u=yield c;return u.getTracks().map(d=>{const m=d.kind==="audio";m?n.audio:n.video;let _;const b=m?a.audio:a.video;typeof b!="boolean"&&(_=b),_?_.deviceId=d.getSettings().deviceId:_={deviceId:d.getSettings().deviceId};const S=mediaTrackToLocalTrack(d,_);return S.kind===Track.Kind.Video?S.source=Track.Source.Camera:S.kind===Track.Kind.Audio&&(S.source=Track.Source.Microphone),S.mediaStream=u,S})})}function createLocalVideoTrack(n){return __awaiter(this,void 0,void 0,function*(){return(yield createLocalTracks({audio:!1,video:n}))[0]})}function createLocalAudioTrack(n){return __awaiter(this,void 0,void 0,function*(){return(yield createLocalTracks({audio:n,video:!1}))[0]})}class PublishAudioCheck extends Checker{get description(){return"Can publish audio"}perform(){var e;return __awaiter(this,void 0,void 0,function*(){const t=yield this.connect(),s=yield createLocalAudioTrack();t.localParticipant.publishTrack(s),yield new Promise(u=>setTimeout(u,3e3));const a=yield(e=s.sender)===null||e===void 0?void 0:e.getStats();if(!a)throw new Error("Could not get RTCStats");let c=0;if(a.forEach(u=>{u.type==="outbound-rtp"&&u.mediaType==="audio"&&(c=u.packetsSent)}),c===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(c," audio packets"))})}}class PublishVideoCheck extends Checker{get description(){return"Can publish video"}perform(){var e;return __awaiter(this,void 0,void 0,function*(){const t=yield this.connect(),s=yield createLocalVideoTrack();t.localParticipant.publishTrack(s),yield new Promise(u=>setTimeout(u,3e3));const a=yield(e=s.sender)===null||e===void 0?void 0:e.getStats();if(!a)throw new Error("Could not get RTCStats");let c=0;if(a.forEach(u=>{u.type==="outbound-rtp"&&u.mediaType==="video"&&(c=u.packetsSent)}),c===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(c," video packets"))})}}class ReconnectCheck extends Checker{get description(){return"Resuming connection after interruption"}perform(){var e;return __awaiter(this,void 0,void 0,function*(){const t=yield this.connect();let s=!1,a=!1,c;const u=new Promise(m=>{setTimeout(m,5e3),c=m});t.on(RoomEvent.Reconnecting,()=>{s=!0}).on(RoomEvent.Reconnected,()=>{a=!0,c(!0)}),(e=t.engine.client.ws)===null||e===void 0||e.close();const d=t.engine.client.onClose;if(d&&d(""),yield u,s){if(!a||t.state!==ConnectionState.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class TURNCheck extends Checker{get description(){return"Can connect via TURN"}perform(){var e,t;return __awaiter(this,void 0,void 0,function*(){const s=new SignalClient,a=yield s.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let c=!1,u=!1,d=!1;for(let m of a.iceServers)for(let _ of m.urls)_.startsWith("turn:")?(u=!0,d=!0):_.startsWith("turns:")&&(u=!0,d=!0,c=!0),_.startsWith("stun:")&&(d=!0);d?u&&!c&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield s.close(),!((t=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||t===void 0)&&t.iceServers||u?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(m=>setTimeout(m,0)))})}}class WebRTCCheck extends Checker{get description(){return"Establishing WebRTC connection"}perform(){return __awaiter(this,void 0,void 0,function*(){let e=!1,t=!1;this.room.on(RoomEvent.SignalConnected,()=>{const s=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(a,c)=>{if(a.candidate){const u=new RTCIceCandidate(a);let d="".concat(u.protocol," ").concat(u.address,":").concat(u.port," ").concat(u.type);u.address&&(isIPPrivate(u.address)?d+=" (private)":u.protocol==="tcp"&&u.tcpType==="passive"?(e=!0,d+=" (passive)"):u.protocol==="udp"&&(t=!0)),this.appendMessage(d)}s&&s(a,c)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=a=>{a instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(a.errorCode," ").concat(a.errorText," ").concat(a.url))})});try{yield this.connect(),livekitLogger.info("now the room is connected")}catch(s){throw this.appendWarning("ports need to be open on firewall in order to connect."),s}e||this.appendWarning("Server is not configured for ICE/TCP"),t||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function isIPPrivate(n){const e=n.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const t=parseInt(e[1],10);if(t>=16&&t<=31)return!0}}return!1}class WebSocketCheck extends Checker{get description(){return"Connecting to signal connection via WebSocket"}perform(){var e,t,s;return __awaiter(this,void 0,void 0,function*(){(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let a=new SignalClient;const c=yield a.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(c.serverVersion,".")),((e=c.serverInfo)===null||e===void 0?void 0:e.edition)===ServerInfo_Edition$1.Cloud&&(!((t=c.serverInfo)===null||t===void 0)&&t.region)&&this.appendMessage("LiveKit Cloud: ".concat((s=c.serverInfo)===null||s===void 0?void 0:s.region)),yield a.close()})}}class ConnectionCheck extends eventsExports$1.EventEmitter{constructor(e,t){super(),this.checkResults=new Map,this.url=e,this.token=t}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:CheckStatus.IDLE,name:"",description:""}),e}updateCheck(e,t){this.checkResults.set(e,t),this.emit("checkUpdate",e,t)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==CheckStatus.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return __awaiter(this,void 0,void 0,function*(){const t=this.getNextCheckId(),s=new e(this.url,this.token),a=u=>{this.updateCheck(t,u)};s.on("update",a);const c=yield s.run();return s.off("update",a),c})}checkWebsocket(){return __awaiter(this,void 0,void 0,function*(){return this.createAndRunCheck(WebSocketCheck)})}checkWebRTC(){return __awaiter(this,void 0,void 0,function*(){return this.createAndRunCheck(WebRTCCheck)})}checkTURN(){return __awaiter(this,void 0,void 0,function*(){return this.createAndRunCheck(TURNCheck)})}checkReconnect(){return __awaiter(this,void 0,void 0,function*(){return this.createAndRunCheck(ReconnectCheck)})}checkPublishAudio(){return __awaiter(this,void 0,void 0,function*(){return this.createAndRunCheck(PublishAudioCheck)})}checkPublishVideo(){return __awaiter(this,void 0,void 0,function*(){return this.createAndRunCheck(PublishVideoCheck)})}}var MavModeFlag=(n=>(n[n.MAV_MODE_FLAG_SAFETY_ARMED=128]="MAV_MODE_FLAG_SAFETY_ARMED",n[n.MAV_MODE_FLAG_MANUAL_INPUT_ENABLED=64]="MAV_MODE_FLAG_MANUAL_INPUT_ENABLED",n[n.MAV_MODE_FLAG_HIL_ENABLED=32]="MAV_MODE_FLAG_HIL_ENABLED",n[n.MAV_MODE_FLAG_STABILIZE_ENABLED=16]="MAV_MODE_FLAG_STABILIZE_ENABLED",n[n.MAV_MODE_FLAG_GUIDED_ENABLED=8]="MAV_MODE_FLAG_GUIDED_ENABLED",n[n.MAV_MODE_FLAG_AUTO_ENABLED=4]="MAV_MODE_FLAG_AUTO_ENABLED",n[n.MAV_MODE_FLAG_TEST_ENABLED=2]="MAV_MODE_FLAG_TEST_ENABLED",n[n.MAV_MODE_FLAG_CUSTOM_MODE_ENABLED=1]="MAV_MODE_FLAG_CUSTOM_MODE_ENABLED",n))(MavModeFlag||{}),MavState=(n=>(n.MAV_STATE_UNINIT="MAV_STATE_UNINIT",n.MAV_STATE_BOOT="MAV_STATE_BOOT",n.MAV_STATE_CALIBRATING="MAV_STATE_CALIBRATING",n.MAV_STATE_STANDBY="MAV_STATE_STANDBY",n.MAV_STATE_ACTIVE="MAV_STATE_ACTIVE",n.MAV_STATE_CRITICAL="MAV_STATE_CRITICAL",n.MAV_STATE_EMERGENCY="MAV_STATE_EMERGENCY",n.MAV_STATE_POWEROFF="MAV_STATE_POWEROFF",n.MAV_STATE_FLIGHT_TERMINATION="MAV_STATE_FLIGHT_TERMINATION",n))(MavState||{}),MavSeverity=(n=>(n.MAV_SEVERITY_EMERGENCY="MAV_SEVERITY_EMERGENCY",n.MAV_SEVERITY_ALERT="MAV_SEVERITY_ALERT",n.MAV_SEVERITY_CRITICAL="MAV_SEVERITY_CRITICAL",n.MAV_SEVERITY_ERROR="MAV_SEVERITY_ERROR",n.MAV_SEVERITY_WARNING="MAV_SEVERITY_WARNING",n.MAV_SEVERITY_NOTICE="MAV_SEVERITY_NOTICE",n.MAV_SEVERITY_INFO="MAV_SEVERITY_INFO",n.MAV_SEVERITY_DEBUG="MAV_SEVERITY_DEBUG",n))(MavSeverity||{}),MAVLinkType=(n=>(n.ACTUATOR_CONTROL_TARGET="ACTUATOR_CONTROL_TARGET",n.ACTUATOR_OUTPUT_STATUS="ACTUATOR_OUTPUT_STATUS",n.ADAP_TUNING="ADAP_TUNING",n.ADSB_VEHICLE="ADSB_VEHICLE",n.AHRS="AHRS",n.AHRS2="AHRS2",n.AHRS3="AHRS3",n.AIRSPEED_AUTOCAL="AIRSPEED_AUTOCAL",n.AIS_VESSEL="AIS_VESSEL",n.ALTITUDE="ALTITUDE",n.AOA_SSA="AOA_SSA",n.AP_ADC="AP_ADC",n.ATT_POS_MOCAP="ATT_POS_MOCAP",n.ATTITUDE="ATTITUDE",n.ATTITUDE_QUATERNION="ATTITUDE_QUATERNION",n.ATTITUDE_QUATERNION_COV="ATTITUDE_QUATERNION_COV",n.ATTITUDE_TARGET="ATTITUDE_TARGET",n.AUTH_KEY="AUTH_KEY",n.AUTOPILOT_STATE_FOR_GIMBAL_DEVICE="AUTOPILOT_STATE_FOR_GIMBAL_DEVICE",n.AUTOPILOT_VERSION="AUTOPILOT_VERSION",n.AUTOPILOT_VERSION_REQUEST="AUTOPILOT_VERSION_REQUEST",n.BATTERY_STATUS="BATTERY_STATUS",n.BATTERY2="BATTERY2",n.BUTTON_CHANGE="BUTTON_CHANGE",n.CAMERA_CAPTURE_STATUS="CAMERA_CAPTURE_STATUS",n.CAMERA_FEEDBACK="CAMERA_FEEDBACK",n.CAMERA_IMAGE_CAPTURED="CAMERA_IMAGE_CAPTURED",n.CAMERA_INFORMATION="CAMERA_INFORMATION",n.CAMERA_SETTINGS="CAMERA_SETTINGS",n.CAMERA_STATUS="CAMERA_STATUS",n.CAMERA_TRIGGER="CAMERA_TRIGGER",n.CELLULAR_CONFIG="CELLULAR_CONFIG",n.CELLULAR_STATUS="CELLULAR_STATUS",n.CHANGE_OPERATOR_CONTROL="CHANGE_OPERATOR_CONTROL",n.CHANGE_OPERATOR_CONTROL_ACK="CHANGE_OPERATOR_CONTROL_ACK",n.COLLISION="COLLISION",n.COMMAND_ACK="COMMAND_ACK",n.COMMAND_CANCEL="COMMAND_CANCEL",n.COMMAND_INT="COMMAND_INT",n.COMMAND_LONG="COMMAND_LONG",n.COMPASSMOT_STATUS="COMPASSMOT_STATUS",n.COMPONENT_INFORMATION="COMPONENT_INFORMATION",n.CONTROL_SYSTEM_STATE="CONTROL_SYSTEM_STATE",n.DATA_STREAM="DATA_STREAM",n.DATA_TRANSMISSION_HANDSHAKE="DATA_TRANSMISSION_HANDSHAKE",n.DATA16="DATA16",n.DATA32="DATA32",n.DATA64="DATA64",n.DATA96="DATA96",n.DEBUG="DEBUG",n.DEBUG_FLOAT_ARRAY="DEBUG_FLOAT_ARRAY",n.DEBUG_VECT="DEBUG_VECT",n.DEEPSTALL="DEEPSTALL",n.DEVICE_OP_READ="DEVICE_OP_READ",n.DEVICE_OP_READ_REPLY="DEVICE_OP_READ_REPLY",n.DEVICE_OP_WRITE="DEVICE_OP_WRITE",n.DEVICE_OP_WRITE_REPLY="DEVICE_OP_WRITE_REPLY",n.DIGICAM_CONFIGURE="DIGICAM_CONFIGURE",n.DIGICAM_CONTROL="DIGICAM_CONTROL",n.DISTANCE_SENSOR="DISTANCE_SENSOR",n.EFI_STATUS="EFI_STATUS",n.EKF_STATUS_REPORT="EKF_STATUS_REPORT",n.ENCAPSULATED_DATA="ENCAPSULATED_DATA",n.ESC_TELEMETRY_1_TO_4="ESC_TELEMETRY_1_TO_4",n.ESC_TELEMETRY_5_TO_8="ESC_TELEMETRY_5_TO_8",n.ESC_TELEMETRY_9_TO_12="ESC_TELEMETRY_9_TO_12",n.ESTIMATOR_STATUS="ESTIMATOR_STATUS",n.EXTENDED_SYS_STATE="EXTENDED_SYS_STATE",n.FENCE_FETCH_POINT="FENCE_FETCH_POINT",n.FENCE_POINT="FENCE_POINT",n.FENCE_STATUS="FENCE_STATUS",n.FILE_TRANSFER_PROTOCOL="FILE_TRANSFER_PROTOCOL",n.FLIGHT_INFORMATION="FLIGHT_INFORMATION",n.FOLLOW_TARGET="FOLLOW_TARGET",n.GENERATOR_STATUS="GENERATOR_STATUS",n.GIMBAL_CONTROL="GIMBAL_CONTROL",n.GIMBAL_DEVICE_ATTITUDE_STATUS="GIMBAL_DEVICE_ATTITUDE_STATUS",n.GIMBAL_DEVICE_INFORMATION="GIMBAL_DEVICE_INFORMATION",n.GIMBAL_DEVICE_SET_ATTITUDE="GIMBAL_DEVICE_SET_ATTITUDE",n.GIMBAL_MANAGER_INFORMATION="GIMBAL_MANAGER_INFORMATION",n.GIMBAL_MANAGER_SET_ATTITUDE="GIMBAL_MANAGER_SET_ATTITUDE",n.GIMBAL_MANAGER_SET_TILTPAN="GIMBAL_MANAGER_SET_TILTPAN",n.GIMBAL_MANAGER_STATUS="GIMBAL_MANAGER_STATUS",n.GIMBAL_REPORT="GIMBAL_REPORT",n.GIMBAL_TORQUE_CMD_REPORT="GIMBAL_TORQUE_CMD_REPORT",n.GLOBAL_POSITION_INT="GLOBAL_POSITION_INT",n.GLOBAL_POSITION_INT_COV="GLOBAL_POSITION_INT_COV",n.GLOBAL_VISION_POSITION_ESTIMATE="GLOBAL_VISION_POSITION_ESTIMATE",n.GOPRO_GET_REQUEST="GOPRO_GET_REQUEST",n.GOPRO_GET_RESPONSE="GOPRO_GET_RESPONSE",n.GOPRO_HEARTBEAT="GOPRO_HEARTBEAT",n.GOPRO_SET_REQUEST="GOPRO_SET_REQUEST",n.GOPRO_SET_RESPONSE="GOPRO_SET_RESPONSE",n.GPS_GLOBAL_ORIGIN="GPS_GLOBAL_ORIGIN",n.GPS_INJECT_DATA="GPS_INJECT_DATA",n.GPS_INPUT="GPS_INPUT",n.GPS_RAW_INT="GPS_RAW_INT",n.GPS_RTCM_DATA="GPS_RTCM_DATA",n.GPS_RTK="GPS_RTK",n.GPS_STATUS="GPS_STATUS",n.GPS2_RAW="GPS2_RAW",n.GPS2_RTK="GPS2_RTK",n.HEARTBEAT="HEARTBEAT",n.HIGH_LATENCY="HIGH_LATENCY",n.HIGH_LATENCY2="HIGH_LATENCY2",n.HIGHRES_IMU="HIGHRES_IMU",n.HIL_ACTUATOR_CONTROLS="HIL_ACTUATOR_CONTROLS",n.HIL_CONTROLS="HIL_CONTROLS",n.HIL_GPS="HIL_GPS",n.HIL_OPTICAL_FLOW="HIL_OPTICAL_FLOW",n.HIL_RC_INPUTS_RAW="HIL_RC_INPUTS_RAW",n.HIL_SENSOR="HIL_SENSOR",n.HIL_STATE="HIL_STATE",n.HIL_STATE_QUATERNION="HIL_STATE_QUATERNION",n.HOME_POSITION="HOME_POSITION",n.HWSTATUS="HWSTATUS",n.ISBD_LINK_STATUS="ISBD_LINK_STATUS",n.LANDING_TARGET="LANDING_TARGET",n.LED_CONTROL="LED_CONTROL",n.LIMITS_STATUS="LIMITS_STATUS",n.LINK_NODE_STATUS="LINK_NODE_STATUS",n.LOCAL_POSITION_NED="LOCAL_POSITION_NED",n.LOCAL_POSITION_NED_COV="LOCAL_POSITION_NED_COV",n.LOCAL_POSITION_NED_SYSTEM_GLOBAL_OFFSET="LOCAL_POSITION_NED_SYSTEM_GLOBAL_OFFSET",n.LOG_DATA="LOG_DATA",n.LOG_ENTRY="LOG_ENTRY",n.LOG_ERASE="LOG_ERASE",n.LOG_REQUEST_DATA="LOG_REQUEST_DATA",n.LOG_REQUEST_END="LOG_REQUEST_END",n.LOG_REQUEST_LIST="LOG_REQUEST_LIST",n.LOGGING_ACK="LOGGING_ACK",n.LOGGING_DATA="LOGGING_DATA",n.LOGGING_DATA_ACKED="LOGGING_DATA_ACKED",n.MAG_CAL_PROGRESS="MAG_CAL_PROGRESS",n.MAG_CAL_REPORT="MAG_CAL_REPORT",n.MANUAL_CONTROL="MANUAL_CONTROL",n.MANUAL_SETPOINT="MANUAL_SETPOINT",n.MEMINFO="MEMINFO",n.MEMORY_VECT="MEMORY_VECT",n.MESSAGE_INTERVAL="MESSAGE_INTERVAL",n.MISSION_ACK="MISSION_ACK",n.MISSION_CHANGED="MISSION_CHANGED",n.MISSION_CLEAR_ALL="MISSION_CLEAR_ALL",n.MISSION_COUNT="MISSION_COUNT",n.MISSION_CURRENT="MISSION_CURRENT",n.MISSION_ITEM="MISSION_ITEM",n.MISSION_ITEM_INT="MISSION_ITEM_INT",n.MISSION_ITEM_REACHED="MISSION_ITEM_REACHED",n.MISSION_REQUEST="MISSION_REQUEST",n.MISSION_REQUEST_INT="MISSION_REQUEST_INT",n.MISSION_REQUEST_LIST="MISSION_REQUEST_LIST",n.MISSION_REQUEST_PARTIAL_LIST="MISSION_REQUEST_PARTIAL_LIST",n.MISSION_SET_CURRENT="MISSION_SET_CURRENT",n.MISSION_WRITE_PARTIAL_LIST="MISSION_WRITE_PARTIAL_LIST",n.MOUNT_CONFIGURE="MOUNT_CONFIGURE",n.MOUNT_CONTROL="MOUNT_CONTROL",n.MOUNT_ORIENTATION="MOUNT_ORIENTATION",n.MOUNT_STATUS="MOUNT_STATUS",n.NAMED_VALUE_FLOAT="NAMED_VALUE_FLOAT",n.NAMED_VALUE_INT="NAMED_VALUE_INT",n.NAV_CONTROLLER_OUTPUT="NAV_CONTROLLER_OUTPUT",n.OBSTACLE_DISTANCE="OBSTACLE_DISTANCE",n.ODOMETRY="ODOMETRY",n.ONBOARD_COMPUTER_STATUS="ONBOARD_COMPUTER_STATUS",n.OPEN_DRONE_ID_AUTHENTICATION="OPEN_DRONE_ID_AUTHENTICATION",n.OPEN_DRONE_ID_BASIC_ID="OPEN_DRONE_ID_BASIC_ID",n.OPEN_DRONE_ID_LOCATION="OPEN_DRONE_ID_LOCATION",n.OPEN_DRONE_ID_MESSAGE_PACK="OPEN_DRONE_ID_MESSAGE_PACK",n.OPEN_DRONE_ID_OPERATOR_ID="OPEN_DRONE_ID_OPERATOR_ID",n.OPEN_DRONE_ID_SELF_ID="OPEN_DRONE_ID_SELF_ID",n.OPEN_DRONE_ID_SYSTEM="OPEN_DRONE_ID_SYSTEM",n.OPTICAL_FLOW="OPTICAL_FLOW",n.OPTICAL_FLOW_RAD="OPTICAL_FLOW_RAD",n.ORBIT_EXECUTION_STATUS="ORBIT_EXECUTION_STATUS",n.PARAM_EXT_ACK="PARAM_EXT_ACK",n.PARAM_EXT_REQUEST_LIST="PARAM_EXT_REQUEST_LIST",n.PARAM_EXT_REQUEST_READ="PARAM_EXT_REQUEST_READ",n.PARAM_EXT_SET="PARAM_EXT_SET",n.PARAM_EXT_VALUE="PARAM_EXT_VALUE",n.PARAM_MAP_RC="PARAM_MAP_RC",n.PARAM_REQUEST_LIST="PARAM_REQUEST_LIST",n.PARAM_REQUEST_READ="PARAM_REQUEST_READ",n.PARAM_SET="PARAM_SET",n.PARAM_VALUE="PARAM_VALUE",n.PID_TUNING="PID_TUNING",n.PING="PING",n.PLAY_TUNE="PLAY_TUNE",n.PLAY_TUNE_V2="PLAY_TUNE_V2",n.POSITION_TARGET_GLOBAL_INT="POSITION_TARGET_GLOBAL_INT",n.POSITION_TARGET_LOCAL_NED="POSITION_TARGET_LOCAL_NED",n.POWER_STATUS="POWER_STATUS",n.PROTOCOL_VERSION="PROTOCOL_VERSION",n.RADIO="RADIO",n.RADIO_STATUS="RADIO_STATUS",n.RALLY_FETCH_POINT="RALLY_FETCH_POINT",n.RALLY_POINT="RALLY_POINT",n.RANGEFINDER="RANGEFINDER",n.RAW_IMU="RAW_IMU",n.RAW_PRESSURE="RAW_PRESSURE",n.RAW_RPM="RAW_RPM",n.RC_CHANNELS="RC_CHANNELS",n.RC_CHANNELS_OVERRIDE="RC_CHANNELS_OVERRIDE",n.RC_CHANNELS_RAW="RC_CHANNELS_RAW",n.RC_CHANNELS_SCALED="RC_CHANNELS_SCALED",n.REMOTE_LOG_BLOCK_STATUS="REMOTE_LOG_BLOCK_STATUS",n.REMOTE_LOG_DATA_BLOCK="REMOTE_LOG_DATA_BLOCK",n.REQUEST_DATA_STREAM="REQUEST_DATA_STREAM",n.RESOURCE_REQUEST="RESOURCE_REQUEST",n.RPM="RPM",n.SAFETY_ALLOWED_AREA="SAFETY_ALLOWED_AREA",n.SAFETY_SET_ALLOWED_AREA="SAFETY_SET_ALLOWED_AREA",n.SCALED_IMU="SCALED_IMU",n.SCALED_IMU2="SCALED_IMU2",n.SCALED_IMU3="SCALED_IMU3",n.SCALED_PRESSURE="SCALED_PRESSURE",n.SCALED_PRESSURE2="SCALED_PRESSURE2",n.SCALED_PRESSURE3="SCALED_PRESSURE3",n.SENSOR_OFFSETS="SENSOR_OFFSETS",n.SERIAL_CONTROL="SERIAL_CONTROL",n.SERVO_OUTPUT_RAW="SERVO_OUTPUT_RAW",n.SET_ACTUATOR_CONTROL_TARGET="SET_ACTUATOR_CONTROL_TARGET",n.SET_ATTITUDE_TARGET="SET_ATTITUDE_TARGET",n.SET_GPS_GLOBAL_ORIGIN="SET_GPS_GLOBAL_ORIGIN",n.SET_HOME_POSITION="SET_HOME_POSITION",n.SET_MAG_OFFSETS="SET_MAG_OFFSETS",n.SET_MODE="SET_MODE",n.SET_POSITION_TARGET_GLOBAL_INT="SET_POSITION_TARGET_GLOBAL_INT",n.SET_POSITION_TARGET_LOCAL_NED="SET_POSITION_TARGET_LOCAL_NED",n.SETUP_SIGNING="SETUP_SIGNING",n.SIM_STATE="SIM_STATE",n.SIMSTATE="SIMSTATE",n.SMART_BATTERY_INFO="SMART_BATTERY_INFO",n.SMART_BATTERY_STATUS="SMART_BATTERY_STATUS",n.STATUSTEXT="STATUSTEXT",n.STORAGE_INFORMATION="STORAGE_INFORMATION",n.SUPPORTED_TUNES="SUPPORTED_TUNES",n.SYS_STATUS="SYS_STATUS",n.SYSTEM_TIME="SYSTEM_TIME",n.TERRAIN_CHECK="TERRAIN_CHECK",n.TERRAIN_DATA="TERRAIN_DATA",n.TERRAIN_REPORT="TERRAIN_REPORT",n.TERRAIN_REQUEST="TERRAIN_REQUEST",n.TIME_ESTIMATE_TO_TARGET="TIME_ESTIMATE_TO_TARGET",n.TIMESYNC="TIMESYNC",n.TRAJECTORY_REPRESENTATION_BEZIER="TRAJECTORY_REPRESENTATION_BEZIER",n.TRAJECTORY_REPRESENTATION_WAYPOINTS="TRAJECTORY_REPRESENTATION_WAYPOINTS",n.TUNNEL="TUNNEL",n.UAVCAN_NODE_INFO="UAVCAN_NODE_INFO",n.UAVCAN_NODE_STATUS="UAVCAN_NODE_STATUS",n.UTM_GLOBAL_POSITION="UTM_GLOBAL_POSITION",n.V2_EXTENSION="V2_EXTENSION",n.VFR_HUD="VFR_HUD",n.VIBRATION="VIBRATION",n.VICON_POSITION_ESTIMATE="VICON_POSITION_ESTIMATE",n.VIDEO_STREAM_INFORMATION="VIDEO_STREAM_INFORMATION",n.VIDEO_STREAM_STATUS="VIDEO_STREAM_STATUS",n.VISION_POSITION_DELTA="VISION_POSITION_DELTA",n.VISION_POSITION_ESTIMATE="VISION_POSITION_ESTIMATE",n.VISION_SPEED_ESTIMATE="VISION_SPEED_ESTIMATE",n.WHEEL_DISTANCE="WHEEL_DISTANCE",n.WIFI_CONFIG_AP="WIFI_CONFIG_AP",n.WIND="WIND",n.WIND_COV="WIND_COV",n))(MAVLinkType||{}),ConnectionStates=(n=>(n.init="Init",n.connecting="Connecting",n.connected="Connected",n.reconnecting="Reconnecting",n.disconnectedOk="Disconnected",n.failed="Failed",n))(ConnectionStates||{});new TextEncoder;const TD=new TextDecoder,DECODE_TXT=n=>TD.decode(n),ENCRYPTED_AUTH_TOKEN_PREFIX="AUTHTOKEN:",SEA_LEVEL_PRESSURE=1013.25;MAVLinkType.HEARTBEAT,MAVLinkType.ATTITUDE,MAVLinkType.SYS_STATUS,MAVLinkType.STATUSTEXT,MAVLinkType.SCALED_PRESSURE,MAVLinkType.SCALED_PRESSURE2,MAVLinkType.SCALED_PRESSURE3;const LIVEKIT_FRONTEND_ROOM_CONNECTION_CONFIG={autoSubscribe:!1,maxRetries:6,peerConnectionTimeout:15e3};new DefaultReconnectPolicy;const LIVEKIT_FRONTEND_ROOM_CONFIG={reconnectPolicy:new DefaultReconnectPolicy,dynacast:!0,disconnectOnPageLeave:!0,adaptiveStream:!0},SIMPLEPEER_BASE_CONFIG={initiator:!0,trickle:!1,config:{bundlePolicy:"balanced",iceTransportPolicy:"all"}};let computedTracker=[];function nStore(n){let e=[],t=(u,d=!0)=>(e.includes(u)||e.push(u),d&&u(n),()=>{e=e.filter(m=>m!=u)});function s(u){if(u===n&&(n===null||typeof n!="object"))return;let d=n;n=u;for(let m of e)m(n,d)}function a(){let u=computedTracker[computedTracker.length-1];return u&&t(u[0],!1),n}if(typeof n=="function")return computed(n);function c(){for(let u of e)u(n,n)}return{subscribe:t,set:s,get:a,refresh:c,update:u=>{typeof u=="function"&&s(u(n))}}}function computed(n){let e=nStore(null),t=[s];return s(),e;function s(){if(computedTracker.includes(t))throw Error("Circular computation");computedTracker.push(t);let a;try{a=n()}catch(c){throw computedTracker.pop(),c}computedTracker.pop(),e.set(a)}}async function listLivekitRoomsWithoutSDK(n,e){return await fetch(n+"/twirp/livekit.RoomService/ListRooms",{method:"POST",cache:"no-cache",mode:"cors",body:"{}",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e}}).then(t=>t.json()).then(t=>{const s=t.rooms;if(!Array.isArray(s))throw new Error(`Error getting livekit room list from ${n} - ${JSON.stringify(t)}`);return s.filter(a=>a.num_participants>0)}).catch(t=>{throw new Error(`Error getting livekit room list from  - ${n}: ${t}`)})}function getAuthTokenFromLivekitRoomMetadata(n,e="accessTokens"){try{const s=JSON.parse(n).accessTokens;if(!s||!Array.isArray(s)||s.length===0)return console.warn("Failed to get tokens list from livekit room metadata"),null;{const a=s[Math.floor(Math.random()*1e5)%s.length],c=a.split("|");if(c.length===4){const[u,d,m,_]=c;return{encrypted:!0,salt:d,iv:m,token:_,userGivenIdentity:u}}else if(c.length===2){const u=a.split("|"),[d,m]=u;return{encrypted:!1,token:m,userGivenIdentity:d}}else return console.log("Invalid auth token found in metadata: "+a),null}}catch(t){return console.warn("Error parsing livekit room metadata: "+n,t),null}}function waitfor(n){return new Promise(e=>{setTimeout(()=>{e()},n)})}function changesSubscribe(n,e){let t=!1;return n.subscribe(a=>{if(t==!1){t=!0;return}e(a)})}function oneShotSubscribe(n,e){const t=n.subscribe(s=>{s&&setTimeout(()=>{t(),e(s)})});return t}function getWebsocketURL(n,e=!1){return n.replace("http","ws")}/**
* @license
* Copyright 2009 The Closure Library Authors
* Copyright 2020 Daniel Wirtz / The long.js Authors.
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*
* SPDX-License-Identifier: Apache-2.0
*/var wasm=null;try{wasm=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Long(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}Long.prototype.__isLong__;Object.defineProperty(Long.prototype,"__isLong__",{value:!0});function isLong(n){return(n&&n.__isLong__)===!0}function ctz32(n){var e=Math.clz32(n&-n);return n?31-e:e}Long.isLong=isLong;var INT_CACHE={},UINT_CACHE={};function fromInt(n,e){var t,s,a;return e?(n>>>=0,(a=0<=n&&n<256)&&(s=UINT_CACHE[n],s)?s:(t=fromBits(n,0,!0),a&&(UINT_CACHE[n]=t),t)):(n|=0,(a=-128<=n&&n<128)&&(s=INT_CACHE[n],s)?s:(t=fromBits(n,n<0?-1:0,!1),a&&(INT_CACHE[n]=t),t))}Long.fromInt=fromInt;function fromNumber(n,e){if(isNaN(n))return e?UZERO:ZERO;if(e){if(n<0)return UZERO;if(n>=TWO_PWR_64_DBL)return MAX_UNSIGNED_VALUE}else{if(n<=-TWO_PWR_63_DBL)return MIN_VALUE;if(n+1>=TWO_PWR_63_DBL)return MAX_VALUE}return n<0?fromNumber(-n,e).neg():fromBits(n%TWO_PWR_32_DBL|0,n/TWO_PWR_32_DBL|0,e)}Long.fromNumber=fromNumber;function fromBits(n,e,t){return new Long(n,e,t)}Long.fromBits=fromBits;var pow_dbl=Math.pow;function fromString(n,e,t){if(n.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return e?UZERO:ZERO;if(t=t||10,t<2||36<t)throw RangeError("radix");var s;if((s=n.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return fromString(n.substring(1),e,t).neg();for(var a=fromNumber(pow_dbl(t,8)),c=ZERO,u=0;u<n.length;u+=8){var d=Math.min(8,n.length-u),m=parseInt(n.substring(u,u+d),t);if(d<8){var _=fromNumber(pow_dbl(t,d));c=c.mul(_).add(fromNumber(m))}else c=c.mul(a),c=c.add(fromNumber(m))}return c.unsigned=e,c}Long.fromString=fromString;function fromValue(n,e){return typeof n=="number"?fromNumber(n,e):typeof n=="string"?fromString(n,e):fromBits(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}Long.fromValue=fromValue;var TWO_PWR_16_DBL=65536,TWO_PWR_24_DBL=1<<24,TWO_PWR_32_DBL=TWO_PWR_16_DBL*TWO_PWR_16_DBL,TWO_PWR_64_DBL=TWO_PWR_32_DBL*TWO_PWR_32_DBL,TWO_PWR_63_DBL=TWO_PWR_64_DBL/2,TWO_PWR_24=fromInt(TWO_PWR_24_DBL),ZERO=fromInt(0);Long.ZERO=ZERO;var UZERO=fromInt(0,!0);Long.UZERO=UZERO;var ONE=fromInt(1);Long.ONE=ONE;var UONE=fromInt(1,!0);Long.UONE=UONE;var NEG_ONE=fromInt(-1);Long.NEG_ONE=NEG_ONE;var MAX_VALUE=fromBits(-1,2147483647,!1);Long.MAX_VALUE=MAX_VALUE;var MAX_UNSIGNED_VALUE=fromBits(-1,-1,!0);Long.MAX_UNSIGNED_VALUE=MAX_UNSIGNED_VALUE;var MIN_VALUE=fromBits(0,-2147483648,!1);Long.MIN_VALUE=MIN_VALUE;var LongPrototype=Long.prototype;LongPrototype.toInt=function(){return this.unsigned?this.low>>>0:this.low};LongPrototype.toNumber=function(){return this.unsigned?(this.high>>>0)*TWO_PWR_32_DBL+(this.low>>>0):this.high*TWO_PWR_32_DBL+(this.low>>>0)};LongPrototype.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(MIN_VALUE)){var t=fromNumber(e),s=this.div(t),a=s.mul(t).sub(this);return s.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var c=fromNumber(pow_dbl(e,6),this.unsigned),u=this,d="";;){var m=u.div(c),_=u.sub(m.mul(c)).toInt()>>>0,b=_.toString(e);if(u=m,u.isZero())return b+d;for(;b.length<6;)b="0"+b;d=""+b+d}};LongPrototype.getHighBits=function(){return this.high};LongPrototype.getHighBitsUnsigned=function(){return this.high>>>0};LongPrototype.getLowBits=function(){return this.low};LongPrototype.getLowBitsUnsigned=function(){return this.low>>>0};LongPrototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(MIN_VALUE)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1};LongPrototype.isZero=function(){return this.high===0&&this.low===0};LongPrototype.eqz=LongPrototype.isZero;LongPrototype.isNegative=function(){return!this.unsigned&&this.high<0};LongPrototype.isPositive=function(){return this.unsigned||this.high>=0};LongPrototype.isOdd=function(){return(this.low&1)===1};LongPrototype.isEven=function(){return(this.low&1)===0};LongPrototype.equals=function(e){return isLong(e)||(e=fromValue(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};LongPrototype.eq=LongPrototype.equals;LongPrototype.notEquals=function(e){return!this.eq(e)};LongPrototype.neq=LongPrototype.notEquals;LongPrototype.ne=LongPrototype.notEquals;LongPrototype.lessThan=function(e){return this.comp(e)<0};LongPrototype.lt=LongPrototype.lessThan;LongPrototype.lessThanOrEqual=function(e){return this.comp(e)<=0};LongPrototype.lte=LongPrototype.lessThanOrEqual;LongPrototype.le=LongPrototype.lessThanOrEqual;LongPrototype.greaterThan=function(e){return this.comp(e)>0};LongPrototype.gt=LongPrototype.greaterThan;LongPrototype.greaterThanOrEqual=function(e){return this.comp(e)>=0};LongPrototype.gte=LongPrototype.greaterThanOrEqual;LongPrototype.ge=LongPrototype.greaterThanOrEqual;LongPrototype.compare=function(e){if(isLong(e)||(e=fromValue(e)),this.eq(e))return 0;var t=this.isNegative(),s=e.isNegative();return t&&!s?-1:!t&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};LongPrototype.comp=LongPrototype.compare;LongPrototype.negate=function(){return!this.unsigned&&this.eq(MIN_VALUE)?MIN_VALUE:this.not().add(ONE)};LongPrototype.neg=LongPrototype.negate;LongPrototype.add=function(e){isLong(e)||(e=fromValue(e));var t=this.high>>>16,s=this.high&65535,a=this.low>>>16,c=this.low&65535,u=e.high>>>16,d=e.high&65535,m=e.low>>>16,_=e.low&65535,b=0,S=0,C=0,w=0;return w+=c+_,C+=w>>>16,w&=65535,C+=a+m,S+=C>>>16,C&=65535,S+=s+d,b+=S>>>16,S&=65535,b+=t+u,b&=65535,fromBits(C<<16|w,b<<16|S,this.unsigned)};LongPrototype.subtract=function(e){return isLong(e)||(e=fromValue(e)),this.add(e.neg())};LongPrototype.sub=LongPrototype.subtract;LongPrototype.multiply=function(e){if(this.isZero())return this;if(isLong(e)||(e=fromValue(e)),wasm){var t=wasm.mul(this.low,this.high,e.low,e.high);return fromBits(t,wasm.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?UZERO:ZERO;if(this.eq(MIN_VALUE))return e.isOdd()?MIN_VALUE:ZERO;if(e.eq(MIN_VALUE))return this.isOdd()?MIN_VALUE:ZERO;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(TWO_PWR_24)&&e.lt(TWO_PWR_24))return fromNumber(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,a=this.high&65535,c=this.low>>>16,u=this.low&65535,d=e.high>>>16,m=e.high&65535,_=e.low>>>16,b=e.low&65535,S=0,C=0,w=0,O=0;return O+=u*b,w+=O>>>16,O&=65535,w+=c*b,C+=w>>>16,w&=65535,w+=u*_,C+=w>>>16,w&=65535,C+=a*b,S+=C>>>16,C&=65535,C+=c*_,S+=C>>>16,C&=65535,C+=u*m,S+=C>>>16,C&=65535,S+=s*b+a*_+c*m+u*d,S&=65535,fromBits(w<<16|O,S<<16|C,this.unsigned)};LongPrototype.mul=LongPrototype.multiply;LongPrototype.divide=function(e){if(isLong(e)||(e=fromValue(e)),e.isZero())throw Error("division by zero");if(wasm){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?wasm.div_u:wasm.div_s)(this.low,this.high,e.low,e.high);return fromBits(t,wasm.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?UZERO:ZERO;var s,a,c;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return UZERO;if(e.gt(this.shru(1)))return UONE;c=UZERO}else{if(this.eq(MIN_VALUE)){if(e.eq(ONE)||e.eq(NEG_ONE))return MIN_VALUE;if(e.eq(MIN_VALUE))return ONE;var u=this.shr(1);return s=u.div(e).shl(1),s.eq(ZERO)?e.isNegative()?ONE:NEG_ONE:(a=this.sub(e.mul(s)),c=s.add(a.div(e)),c)}else if(e.eq(MIN_VALUE))return this.unsigned?UZERO:ZERO;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();c=ZERO}for(a=this;a.gte(e);){s=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var d=Math.ceil(Math.log(s)/Math.LN2),m=d<=48?1:pow_dbl(2,d-48),_=fromNumber(s),b=_.mul(e);b.isNegative()||b.gt(a);)s-=m,_=fromNumber(s,this.unsigned),b=_.mul(e);_.isZero()&&(_=ONE),c=c.add(_),a=a.sub(b)}return c};LongPrototype.div=LongPrototype.divide;LongPrototype.modulo=function(e){if(isLong(e)||(e=fromValue(e)),wasm){var t=(this.unsigned?wasm.rem_u:wasm.rem_s)(this.low,this.high,e.low,e.high);return fromBits(t,wasm.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};LongPrototype.mod=LongPrototype.modulo;LongPrototype.rem=LongPrototype.modulo;LongPrototype.not=function(){return fromBits(~this.low,~this.high,this.unsigned)};LongPrototype.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};LongPrototype.clz=LongPrototype.countLeadingZeros;LongPrototype.countTrailingZeros=function(){return this.low?ctz32(this.low):ctz32(this.high)+32};LongPrototype.ctz=LongPrototype.countTrailingZeros;LongPrototype.and=function(e){return isLong(e)||(e=fromValue(e)),fromBits(this.low&e.low,this.high&e.high,this.unsigned)};LongPrototype.or=function(e){return isLong(e)||(e=fromValue(e)),fromBits(this.low|e.low,this.high|e.high,this.unsigned)};LongPrototype.xor=function(e){return isLong(e)||(e=fromValue(e)),fromBits(this.low^e.low,this.high^e.high,this.unsigned)};LongPrototype.shiftLeft=function(e){return isLong(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?fromBits(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):fromBits(0,this.low<<e-32,this.unsigned)};LongPrototype.shl=LongPrototype.shiftLeft;LongPrototype.shiftRight=function(e){return isLong(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?fromBits(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):fromBits(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};LongPrototype.shr=LongPrototype.shiftRight;LongPrototype.shiftRightUnsigned=function(e){return isLong(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?fromBits(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?fromBits(this.high,0,this.unsigned):fromBits(this.high>>>e-32,0,this.unsigned)};LongPrototype.shru=LongPrototype.shiftRightUnsigned;LongPrototype.shr_u=LongPrototype.shiftRightUnsigned;LongPrototype.rotateLeft=function(e){var t;return isLong(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?fromBits(this.high,this.low,this.unsigned):e<32?(t=32-e,fromBits(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,fromBits(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))};LongPrototype.rotl=LongPrototype.rotateLeft;LongPrototype.rotateRight=function(e){var t;return isLong(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?fromBits(this.high,this.low,this.unsigned):e<32?(t=32-e,fromBits(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,fromBits(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))};LongPrototype.rotr=LongPrototype.rotateRight;LongPrototype.toSigned=function(){return this.unsigned?fromBits(this.low,this.high,!1):this};LongPrototype.toUnsigned=function(){return this.unsigned?this:fromBits(this.low,this.high,!0)};LongPrototype.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};LongPrototype.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};LongPrototype.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};Long.fromBytes=function(e,t,s){return s?Long.fromBytesLE(e,t):Long.fromBytesBE(e,t)};Long.fromBytesLE=function(e,t){return new Long(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};Long.fromBytesBE=function(e,t){return new Long(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var indexMinimal={},minimal$1={},aspromise,hasRequiredAspromise;function requireAspromise(){if(hasRequiredAspromise)return aspromise;hasRequiredAspromise=1,aspromise=n;function n(e,t){for(var s=new Array(arguments.length-1),a=0,c=2,u=!0;c<arguments.length;)s[a++]=arguments[c++];return new Promise(function(m,_){s[a]=function(S){if(u)if(u=!1,S)_(S);else{for(var C=new Array(arguments.length-1),w=0;w<C.length;)C[w++]=arguments[w];m.apply(null,C)}};try{e.apply(t||null,s)}catch(b){u&&(u=!1,_(b))}})}return aspromise}var base64$1={},hasRequiredBase64;function requireBase64(){return hasRequiredBase64||(hasRequiredBase64=1,function(n){var e=n;e.length=function(d){var m=d.length;if(!m)return 0;for(var _=0;--m%4>1&&d.charAt(m)==="=";)++_;return Math.ceil(d.length*3)/4-_};for(var t=new Array(64),s=new Array(123),a=0;a<64;)s[t[a]=a<26?a+65:a<52?a+71:a<62?a-4:a-59|43]=a++;e.encode=function(d,m,_){for(var b=null,S=[],C=0,w=0,O;m<_;){var I=d[m++];switch(w){case 0:S[C++]=t[I>>2],O=(I&3)<<4,w=1;break;case 1:S[C++]=t[O|I>>4],O=(I&15)<<2,w=2;break;case 2:S[C++]=t[O|I>>6],S[C++]=t[I&63],w=0;break}C>8191&&((b||(b=[])).push(String.fromCharCode.apply(String,S)),C=0)}return w&&(S[C++]=t[O],S[C++]=61,w===1&&(S[C++]=61)),b?(C&&b.push(String.fromCharCode.apply(String,S.slice(0,C))),b.join("")):String.fromCharCode.apply(String,S.slice(0,C))};var c="invalid encoding";e.decode=function(d,m,_){for(var b=_,S=0,C,w=0;w<d.length;){var O=d.charCodeAt(w++);if(O===61&&S>1)break;if((O=s[O])===void 0)throw Error(c);switch(S){case 0:C=O,S=1;break;case 1:m[_++]=C<<2|(O&48)>>4,C=O,S=2;break;case 2:m[_++]=(C&15)<<4|(O&60)>>2,C=O,S=3;break;case 3:m[_++]=(C&3)<<6|O,S=0;break}}if(S===1)throw Error(c);return _-b},e.test=function(d){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(d)}}(base64$1)),base64$1}var eventemitter,hasRequiredEventemitter;function requireEventemitter(){if(hasRequiredEventemitter)return eventemitter;hasRequiredEventemitter=1,eventemitter=n;function n(){this._listeners={}}return n.prototype.on=function(t,s,a){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:s,ctx:a||this}),this},n.prototype.off=function(t,s){if(t===void 0)this._listeners={};else if(s===void 0)this._listeners[t]=[];else for(var a=this._listeners[t],c=0;c<a.length;)a[c].fn===s?a.splice(c,1):++c;return this},n.prototype.emit=function(t){var s=this._listeners[t];if(s){for(var a=[],c=1;c<arguments.length;)a.push(arguments[c++]);for(c=0;c<s.length;)s[c].fn.apply(s[c++].ctx,a)}return this},eventemitter}var float,hasRequiredFloat;function requireFloat(){if(hasRequiredFloat)return float;hasRequiredFloat=1,float=n(n);function n(c){return typeof Float32Array<"u"?function(){var u=new Float32Array([-0]),d=new Uint8Array(u.buffer),m=d[3]===128;function _(w,O,I){u[0]=w,O[I]=d[0],O[I+1]=d[1],O[I+2]=d[2],O[I+3]=d[3]}function b(w,O,I){u[0]=w,O[I]=d[3],O[I+1]=d[2],O[I+2]=d[1],O[I+3]=d[0]}c.writeFloatLE=m?_:b,c.writeFloatBE=m?b:_;function S(w,O){return d[0]=w[O],d[1]=w[O+1],d[2]=w[O+2],d[3]=w[O+3],u[0]}function C(w,O){return d[3]=w[O],d[2]=w[O+1],d[1]=w[O+2],d[0]=w[O+3],u[0]}c.readFloatLE=m?S:C,c.readFloatBE=m?C:S}():function(){function u(m,_,b,S){var C=_<0?1:0;if(C&&(_=-_),_===0)m(1/_>0?0:2147483648,b,S);else if(isNaN(_))m(2143289344,b,S);else if(_>34028234663852886e22)m((C<<31|2139095040)>>>0,b,S);else if(_<11754943508222875e-54)m((C<<31|Math.round(_/1401298464324817e-60))>>>0,b,S);else{var w=Math.floor(Math.log(_)/Math.LN2),O=Math.round(_*Math.pow(2,-w)*8388608)&8388607;m((C<<31|w+127<<23|O)>>>0,b,S)}}c.writeFloatLE=u.bind(null,e),c.writeFloatBE=u.bind(null,t);function d(m,_,b){var S=m(_,b),C=(S>>31)*2+1,w=S>>>23&255,O=S&8388607;return w===255?O?NaN:C*(1/0):w===0?C*1401298464324817e-60*O:C*Math.pow(2,w-150)*(O+8388608)}c.readFloatLE=d.bind(null,s),c.readFloatBE=d.bind(null,a)}(),typeof Float64Array<"u"?function(){var u=new Float64Array([-0]),d=new Uint8Array(u.buffer),m=d[7]===128;function _(w,O,I){u[0]=w,O[I]=d[0],O[I+1]=d[1],O[I+2]=d[2],O[I+3]=d[3],O[I+4]=d[4],O[I+5]=d[5],O[I+6]=d[6],O[I+7]=d[7]}function b(w,O,I){u[0]=w,O[I]=d[7],O[I+1]=d[6],O[I+2]=d[5],O[I+3]=d[4],O[I+4]=d[3],O[I+5]=d[2],O[I+6]=d[1],O[I+7]=d[0]}c.writeDoubleLE=m?_:b,c.writeDoubleBE=m?b:_;function S(w,O){return d[0]=w[O],d[1]=w[O+1],d[2]=w[O+2],d[3]=w[O+3],d[4]=w[O+4],d[5]=w[O+5],d[6]=w[O+6],d[7]=w[O+7],u[0]}function C(w,O){return d[7]=w[O],d[6]=w[O+1],d[5]=w[O+2],d[4]=w[O+3],d[3]=w[O+4],d[2]=w[O+5],d[1]=w[O+6],d[0]=w[O+7],u[0]}c.readDoubleLE=m?S:C,c.readDoubleBE=m?C:S}():function(){function u(m,_,b,S,C,w){var O=S<0?1:0;if(O&&(S=-S),S===0)m(0,C,w+_),m(1/S>0?0:2147483648,C,w+b);else if(isNaN(S))m(0,C,w+_),m(2146959360,C,w+b);else if(S>17976931348623157e292)m(0,C,w+_),m((O<<31|2146435072)>>>0,C,w+b);else{var I;if(S<22250738585072014e-324)I=S/5e-324,m(I>>>0,C,w+_),m((O<<31|I/4294967296)>>>0,C,w+b);else{var N=Math.floor(Math.log(S)/Math.LN2);N===1024&&(N=1023),I=S*Math.pow(2,-N),m(I*4503599627370496>>>0,C,w+_),m((O<<31|N+1023<<20|I*1048576&1048575)>>>0,C,w+b)}}}c.writeDoubleLE=u.bind(null,e,0,4),c.writeDoubleBE=u.bind(null,t,4,0);function d(m,_,b,S,C){var w=m(S,C+_),O=m(S,C+b),I=(O>>31)*2+1,N=O>>>20&2047,P=4294967296*(O&1048575)+w;return N===2047?P?NaN:I*(1/0):N===0?I*5e-324*P:I*Math.pow(2,N-1075)*(P+4503599627370496)}c.readDoubleLE=d.bind(null,s,0,4),c.readDoubleBE=d.bind(null,a,4,0)}(),c}function e(c,u,d){u[d]=c&255,u[d+1]=c>>>8&255,u[d+2]=c>>>16&255,u[d+3]=c>>>24}function t(c,u,d){u[d]=c>>>24,u[d+1]=c>>>16&255,u[d+2]=c>>>8&255,u[d+3]=c&255}function s(c,u){return(c[u]|c[u+1]<<8|c[u+2]<<16|c[u+3]<<24)>>>0}function a(c,u){return(c[u]<<24|c[u+1]<<16|c[u+2]<<8|c[u+3])>>>0}return float}var inquire_1,hasRequiredInquire;function requireInquire(){if(hasRequiredInquire)return inquire_1;hasRequiredInquire=1,inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}return inquire_1}var utf8$2={},hasRequiredUtf8;function requireUtf8(){return hasRequiredUtf8||(hasRequiredUtf8=1,function(n){var e=n;e.length=function(s){for(var a=0,c=0,u=0;u<s.length;++u)c=s.charCodeAt(u),c<128?a+=1:c<2048?a+=2:(c&64512)===55296&&(s.charCodeAt(u+1)&64512)===56320?(++u,a+=4):a+=3;return a},e.read=function(s,a,c){var u=c-a;if(u<1)return"";for(var d=null,m=[],_=0,b;a<c;)b=s[a++],b<128?m[_++]=b:b>191&&b<224?m[_++]=(b&31)<<6|s[a++]&63:b>239&&b<365?(b=((b&7)<<18|(s[a++]&63)<<12|(s[a++]&63)<<6|s[a++]&63)-65536,m[_++]=55296+(b>>10),m[_++]=56320+(b&1023)):m[_++]=(b&15)<<12|(s[a++]&63)<<6|s[a++]&63,_>8191&&((d||(d=[])).push(String.fromCharCode.apply(String,m)),_=0);return d?(_&&d.push(String.fromCharCode.apply(String,m.slice(0,_))),d.join("")):String.fromCharCode.apply(String,m.slice(0,_))},e.write=function(s,a,c){for(var u=c,d,m,_=0;_<s.length;++_)d=s.charCodeAt(_),d<128?a[c++]=d:d<2048?(a[c++]=d>>6|192,a[c++]=d&63|128):(d&64512)===55296&&((m=s.charCodeAt(_+1))&64512)===56320?(d=65536+((d&1023)<<10)+(m&1023),++_,a[c++]=d>>18|240,a[c++]=d>>12&63|128,a[c++]=d>>6&63|128,a[c++]=d&63|128):(a[c++]=d>>12|224,a[c++]=d>>6&63|128,a[c++]=d&63|128);return c-u}}(utf8$2)),utf8$2}var pool_1,hasRequiredPool;function requirePool(){if(hasRequiredPool)return pool_1;hasRequiredPool=1,pool_1=n;function n(e,t,s){var a=s||8192,c=a>>>1,u=null,d=a;return function(_){if(_<1||_>c)return e(_);d+_>a&&(u=e(a),d=0);var b=t.call(u,d,d+=_);return d&7&&(d=(d|7)+1),b}}return pool_1}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=e;var n=requireMinimal();function e(c,u){this.lo=c>>>0,this.hi=u>>>0}var t=e.zero=new e(0,0);t.toNumber=function(){return 0},t.zzEncode=t.zzDecode=function(){return this},t.length=function(){return 1};var s=e.zeroHash="\0\0\0\0\0\0\0\0";e.fromNumber=function(u){if(u===0)return t;var d=u<0;d&&(u=-u);var m=u>>>0,_=(u-m)/4294967296>>>0;return d&&(_=~_>>>0,m=~m>>>0,++m>4294967295&&(m=0,++_>4294967295&&(_=0))),new e(m,_)},e.from=function(u){if(typeof u=="number")return e.fromNumber(u);if(n.isString(u))if(n.Long)u=n.Long.fromString(u);else return e.fromNumber(parseInt(u,10));return u.low||u.high?new e(u.low>>>0,u.high>>>0):t},e.prototype.toNumber=function(u){if(!u&&this.hi>>>31){var d=~this.lo+1>>>0,m=~this.hi>>>0;return d||(m=m+1>>>0),-(d+m*4294967296)}return this.lo+this.hi*4294967296},e.prototype.toLong=function(u){return n.Long?new n.Long(this.lo|0,this.hi|0,!!u):{low:this.lo|0,high:this.hi|0,unsigned:!!u}};var a=String.prototype.charCodeAt;return e.fromHash=function(u){return u===s?t:new e((a.call(u,0)|a.call(u,1)<<8|a.call(u,2)<<16|a.call(u,3)<<24)>>>0,(a.call(u,4)|a.call(u,5)<<8|a.call(u,6)<<16|a.call(u,7)<<24)>>>0)},e.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},e.prototype.zzEncode=function(){var u=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^u)>>>0,this.lo=(this.lo<<1^u)>>>0,this},e.prototype.zzDecode=function(){var u=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^u)>>>0,this.hi=(this.hi>>>1^u)>>>0,this},e.prototype.length=function(){var u=this.lo,d=(this.lo>>>28|this.hi<<4)>>>0,m=this.hi>>>24;return m===0?d===0?u<16384?u<128?1:2:u<2097152?3:4:d<16384?d<128?5:6:d<2097152?7:8:m<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(n){var e=n;e.asPromise=requireAspromise(),e.base64=requireBase64(),e.EventEmitter=requireEventemitter(),e.float=requireFloat(),e.inquire=requireInquire(),e.utf8=requireUtf8(),e.pool=requirePool(),e.LongBits=requireLongbits(),e.isNode=!!(typeof commonjsGlobal$1<"u"&&commonjsGlobal$1&&commonjsGlobal$1.process&&commonjsGlobal$1.process.versions&&commonjsGlobal$1.process.versions.node),e.global=e.isNode&&commonjsGlobal$1||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal$1,e.emptyArray=Object.freeze?Object.freeze([]):[],e.emptyObject=Object.freeze?Object.freeze({}):{},e.isInteger=Number.isInteger||function(c){return typeof c=="number"&&isFinite(c)&&Math.floor(c)===c},e.isString=function(c){return typeof c=="string"||c instanceof String},e.isObject=function(c){return c&&typeof c=="object"},e.isset=e.isSet=function(c,u){var d=c[u];return d!=null&&c.hasOwnProperty(u)?typeof d!="object"||(Array.isArray(d)?d.length:Object.keys(d).length)>0:!1},e.Buffer=function(){try{var a=e.inquire("buffer").Buffer;return a.prototype.utf8Write?a:null}catch{return null}}(),e._Buffer_from=null,e._Buffer_allocUnsafe=null,e.newBuffer=function(c){return typeof c=="number"?e.Buffer?e._Buffer_allocUnsafe(c):new e.Array(c):e.Buffer?e._Buffer_from(c):typeof Uint8Array>"u"?c:new Uint8Array(c)},e.Array=typeof Uint8Array<"u"?Uint8Array:Array,e.Long=e.global.dcodeIO&&e.global.dcodeIO.Long||e.global.Long||e.inquire("long"),e.key2Re=/^true|false|0|1$/,e.key32Re=/^-?(?:0|[1-9][0-9]*)$/,e.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,e.longToHash=function(c){return c?e.LongBits.from(c).toHash():e.LongBits.zeroHash},e.longFromHash=function(c,u){var d=e.LongBits.fromHash(c);return e.Long?e.Long.fromBits(d.lo,d.hi,u):d.toNumber(!!u)};function t(a,c,u){for(var d=Object.keys(c),m=0;m<d.length;++m)(a[d[m]]===void 0||!u)&&(a[d[m]]=c[d[m]]);return a}e.merge=t,e.lcFirst=function(c){return c.charAt(0).toLowerCase()+c.substring(1)};function s(a){function c(u,d){if(!(this instanceof c))return new c(u,d);Object.defineProperty(this,"message",{get:function(){return u}}),Error.captureStackTrace?Error.captureStackTrace(this,c):Object.defineProperty(this,"stack",{value:new Error().stack||""}),d&&t(this,d)}return c.prototype=Object.create(Error.prototype,{constructor:{value:c,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return a},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),c}e.newError=s,e.ProtocolError=s("ProtocolError"),e.oneOfGetter=function(c){for(var u={},d=0;d<c.length;++d)u[c[d]]=1;return function(){for(var m=Object.keys(this),_=m.length-1;_>-1;--_)if(u[m[_]]===1&&this[m[_]]!==void 0&&this[m[_]]!==null)return m[_]}},e.oneOfSetter=function(c){return function(u){for(var d=0;d<c.length;++d)c[d]!==u&&delete this[c[d]]}},e.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},e._configure=function(){var a=e.Buffer;if(!a){e._Buffer_from=e._Buffer_allocUnsafe=null;return}e._Buffer_from=a.from!==Uint8Array.from&&a.from||function(u,d){return new a(u,d)},e._Buffer_allocUnsafe=a.allocUnsafe||function(u){return new a(u)}}}(minimal$1)),minimal$1}var writer=Writer$1,util$5=requireMinimal(),BufferWriter$1,LongBits$1=util$5.LongBits,base64=util$5.base64,utf8$1=util$5.utf8;function Op(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function noop$2(){}function State(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function Writer$1(){this.len=0,this.head=new Op(noop$2,0,0),this.tail=this.head,this.states=null}var create$1=function n(){return util$5.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};Writer$1.create=create$1();Writer$1.alloc=function n(e){return new util$5.Array(e)};util$5.Array!==Array&&(Writer$1.alloc=util$5.pool(Writer$1.alloc,util$5.Array.prototype.subarray));Writer$1.prototype._push=function n(e,t,s){return this.tail=this.tail.next=new Op(e,t,s),this.len+=t,this};function writeByte(n,e,t){e[t]=n&255}function writeVarint32(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function VarintOp(n,e){this.len=n,this.next=void 0,this.val=e}VarintOp.prototype=Object.create(Op.prototype);VarintOp.prototype.fn=writeVarint32;Writer$1.prototype.uint32=function n(e){return this.len+=(this.tail=this.tail.next=new VarintOp((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};Writer$1.prototype.int32=function n(e){return e<0?this._push(writeVarint64,10,LongBits$1.fromNumber(e)):this.uint32(e)};Writer$1.prototype.sint32=function n(e){return this.uint32((e<<1^e>>31)>>>0)};function writeVarint64(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}Writer$1.prototype.uint64=function n(e){var t=LongBits$1.from(e);return this._push(writeVarint64,t.length(),t)};Writer$1.prototype.int64=Writer$1.prototype.uint64;Writer$1.prototype.sint64=function n(e){var t=LongBits$1.from(e).zzEncode();return this._push(writeVarint64,t.length(),t)};Writer$1.prototype.bool=function n(e){return this._push(writeByte,1,e?1:0)};function writeFixed32(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}Writer$1.prototype.fixed32=function n(e){return this._push(writeFixed32,4,e>>>0)};Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32;Writer$1.prototype.fixed64=function n(e){var t=LongBits$1.from(e);return this._push(writeFixed32,4,t.lo)._push(writeFixed32,4,t.hi)};Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64;Writer$1.prototype.float=function n(e){return this._push(util$5.float.writeFloatLE,4,e)};Writer$1.prototype.double=function n(e){return this._push(util$5.float.writeDoubleLE,8,e)};var writeBytes=util$5.Array.prototype.set?function n(e,t,s){t.set(e,s)}:function n(e,t,s){for(var a=0;a<e.length;++a)t[s+a]=e[a]};Writer$1.prototype.bytes=function n(e){var t=e.length>>>0;if(!t)return this._push(writeByte,1,0);if(util$5.isString(e)){var s=Writer$1.alloc(t=base64.length(e));base64.decode(e,s,0),e=s}return this.uint32(t)._push(writeBytes,t,e)};Writer$1.prototype.string=function n(e){var t=utf8$1.length(e);return t?this.uint32(t)._push(utf8$1.write,t,e):this._push(writeByte,1,0)};Writer$1.prototype.fork=function n(){return this.states=new State(this),this.head=this.tail=new Op(noop$2,0,0),this.len=0,this};Writer$1.prototype.reset=function n(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop$2,0,0),this.len=0),this};Writer$1.prototype.ldelim=function n(){var e=this.head,t=this.tail,s=this.len;return this.reset().uint32(s),s&&(this.tail.next=e.next,this.tail=t,this.len+=s),this};Writer$1.prototype.finish=function n(){for(var e=this.head.next,t=this.constructor.alloc(this.len),s=0;e;)e.fn(e.val,t,s),s+=e.len,e=e.next;return t};Writer$1._configure=function(n){BufferWriter$1=n,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$4=requireMinimal();function BufferWriter(){Writer.call(this)}BufferWriter._configure=function(){BufferWriter.alloc=util$4._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$4.Buffer&&util$4.Buffer.prototype instanceof Uint8Array&&util$4.Buffer.prototype.set.name==="set"?function(e,t,s){t.set(e,s)}:function(e,t,s){if(e.copy)e.copy(t,s,0,e.length);else for(var a=0;a<e.length;)t[s++]=e[a++]}};BufferWriter.prototype.bytes=function n(e){util$4.isString(e)&&(e=util$4._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(BufferWriter.writeBytesBuffer,t,e),this};function writeStringBuffer(n,e,t){n.length<40?util$4.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}BufferWriter.prototype.string=function n(e){var t=util$4.Buffer.byteLength(e);return this.uint32(t),t&&this._push(writeStringBuffer,t,e),this};BufferWriter._configure();var reader=Reader$1,util$3=requireMinimal(),BufferReader$1,LongBits=util$3.LongBits,utf8=util$3.utf8;function indexOutOfRange(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function Reader$1(n){this.buf=n,this.pos=0,this.len=n.length}var create_array=typeof Uint8Array<"u"?function n(e){if(e instanceof Uint8Array||Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")}:function n(e){if(Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")},create=function n(){return util$3.Buffer?function(t){return(Reader$1.create=function(a){return util$3.Buffer.isBuffer(a)?new BufferReader$1(a):create_array(a)})(t)}:create_array};Reader$1.create=create();Reader$1.prototype._slice=util$3.Array.prototype.subarray||util$3.Array.prototype.slice;Reader$1.prototype.uint32=function n(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return e}}();Reader$1.prototype.int32=function n(){return this.uint32()|0};Reader$1.prototype.sint32=function n(){var e=this.uint32();return e>>>1^-(e&1)|0};function readLongVarint(){var n=new LongBits(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw indexOutOfRange(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw indexOutOfRange(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}Reader$1.prototype.bool=function n(){return this.uint32()!==0};function readFixed32_end(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}Reader$1.prototype.fixed32=function n(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)};Reader$1.prototype.sfixed32=function n(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)|0};function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.prototype.float=function n(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var e=util$3.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Reader$1.prototype.double=function n(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var e=util$3.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Reader$1.prototype.bytes=function n(){var e=this.uint32(),t=this.pos,s=this.pos+e;if(s>this.len)throw indexOutOfRange(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,s);if(t===s){var a=util$3.Buffer;return a?a.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,s)};Reader$1.prototype.string=function n(){var e=this.bytes();return utf8.read(e,0,e.length)};Reader$1.prototype.skip=function n(e){if(typeof e=="number"){if(this.pos+e>this.len)throw indexOutOfRange(this,e);this.pos+=e}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this};Reader$1.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};Reader$1._configure=function(n){BufferReader$1=n,Reader$1.create=create(),BufferReader$1._configure();var e=util$3.Long?"toLong":"toNumber";util$3.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[e](!1)},uint64:function(){return readLongVarint.call(this)[e](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[e](!1)},fixed64:function(){return readFixed64.call(this)[e](!0)},sfixed64:function(){return readFixed64.call(this)[e](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$2=requireMinimal();function BufferReader(n){Reader.call(this,n)}BufferReader._configure=function(){util$2.Buffer&&(BufferReader.prototype._slice=util$2.Buffer.prototype.slice)};BufferReader.prototype.string=function n(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};BufferReader._configure();var rpc={},service=Service,util$1=requireMinimal();(Service.prototype=Object.create(util$1.EventEmitter.prototype)).constructor=Service;function Service(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");util$1.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}Service.prototype.rpcCall=function n(e,t,s,a,c){if(!a)throw TypeError("request must be specified");var u=this;if(!c)return util$1.asPromise(n,u,e,t,s,a);if(!u.rpcImpl){setTimeout(function(){c(Error("already ended"))},0);return}try{return u.rpcImpl(e,t[u.requestDelimited?"encodeDelimited":"encode"](a).finish(),function(m,_){if(m)return u.emit("error",m,e),c(m);if(_===null){u.end(!0);return}if(!(_ instanceof s))try{_=s[u.responseDelimited?"decodeDelimited":"decode"](_)}catch(b){return u.emit("error",b,e),c(b)}return u.emit("data",_,e),c(null,_)})}catch(d){u.emit("error",d,e),setTimeout(function(){c(d)},0);return}};Service.prototype.end=function n(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};(function(n){var e=n;e.Service=service})(rpc);var roots={};(function(n){var e=n;e.build="minimal",e.Writer=writer,e.BufferWriter=writer_buffer,e.Reader=reader,e.BufferReader=reader_buffer,e.util=requireMinimal(),e.rpc=rpc,e.roots=roots,e.configure=t;function t(){e.util._configure(),e.Writer._configure(e.BufferWriter),e.Reader._configure(e.BufferReader)}t()})(indexMinimal);var minimal=indexMinimal;const _m0=getDefaultExportFromCjs$1(minimal);_m0.util.Long!==Long&&(_m0.util.Long=Long,_m0.configure());var AudioCodec;(function(n){n[n.DEFAULT_AC=0]="DEFAULT_AC",n[n.OPUS=1]="OPUS",n[n.AAC=2]="AAC",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(AudioCodec||(AudioCodec={}));var VideoCodec;(function(n){n[n.DEFAULT_VC=0]="DEFAULT_VC",n[n.H264_BASELINE=1]="H264_BASELINE",n[n.H264_MAIN=2]="H264_MAIN",n[n.H264_HIGH=3]="H264_HIGH",n[n.VP8=4]="VP8",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(VideoCodec||(VideoCodec={}));var ImageCodec;(function(n){n[n.IC_DEFAULT=0]="IC_DEFAULT",n[n.IC_JPEG=1]="IC_JPEG",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(ImageCodec||(ImageCodec={}));var TrackType;(function(n){n[n.AUDIO=0]="AUDIO",n[n.VIDEO=1]="VIDEO",n[n.DATA=2]="DATA",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(TrackType||(TrackType={}));var TrackSource$1;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.CAMERA=1]="CAMERA",n[n.MICROPHONE=2]="MICROPHONE",n[n.SCREEN_SHARE=3]="SCREEN_SHARE",n[n.SCREEN_SHARE_AUDIO=4]="SCREEN_SHARE_AUDIO",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(TrackSource$1||(TrackSource$1={}));var VideoQuality;(function(n){n[n.LOW=0]="LOW",n[n.MEDIUM=1]="MEDIUM",n[n.HIGH=2]="HIGH",n[n.OFF=3]="OFF",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(VideoQuality||(VideoQuality={}));var ConnectionQuality;(function(n){n[n.POOR=0]="POOR",n[n.GOOD=1]="GOOD",n[n.EXCELLENT=2]="EXCELLENT",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(ConnectionQuality||(ConnectionQuality={}));var ClientConfigSetting;(function(n){n[n.UNSET=0]="UNSET",n[n.DISABLED=1]="DISABLED",n[n.ENABLED=2]="ENABLED",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(ClientConfigSetting||(ClientConfigSetting={}));var DisconnectReason;(function(n){n[n.UNKNOWN_REASON=0]="UNKNOWN_REASON",n[n.CLIENT_INITIATED=1]="CLIENT_INITIATED",n[n.DUPLICATE_IDENTITY=2]="DUPLICATE_IDENTITY",n[n.SERVER_SHUTDOWN=3]="SERVER_SHUTDOWN",n[n.PARTICIPANT_REMOVED=4]="PARTICIPANT_REMOVED",n[n.ROOM_DELETED=5]="ROOM_DELETED",n[n.STATE_MISMATCH=6]="STATE_MISMATCH",n[n.JOIN_FAILURE=7]="JOIN_FAILURE",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(DisconnectReason||(DisconnectReason={}));var ReconnectReason;(function(n){n[n.RR_UNKNOWN=0]="RR_UNKNOWN",n[n.RR_SIGNAL_DISCONNECTED=1]="RR_SIGNAL_DISCONNECTED",n[n.RR_PUBLISHER_FAILED=2]="RR_PUBLISHER_FAILED",n[n.RR_SUBSCRIBER_FAILED=3]="RR_SUBSCRIBER_FAILED",n[n.RR_SWITCH_CANDIDATE=4]="RR_SWITCH_CANDIDATE",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(ReconnectReason||(ReconnectReason={}));var SubscriptionError;(function(n){n[n.SE_UNKNOWN=0]="SE_UNKNOWN",n[n.SE_CODEC_UNSUPPORTED=1]="SE_CODEC_UNSUPPORTED",n[n.SE_TRACK_NOTFOUND=2]="SE_TRACK_NOTFOUND",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(SubscriptionError||(SubscriptionError={}));var ParticipantInfo_State;(function(n){n[n.JOINING=0]="JOINING",n[n.JOINED=1]="JOINED",n[n.ACTIVE=2]="ACTIVE",n[n.DISCONNECTED=3]="DISCONNECTED",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(ParticipantInfo_State||(ParticipantInfo_State={}));var Encryption_Type;(function(n){n[n.NONE=0]="NONE",n[n.GCM=1]="GCM",n[n.CUSTOM=2]="CUSTOM",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(Encryption_Type||(Encryption_Type={}));var DataPacket_Kind;(function(n){n[n.RELIABLE=0]="RELIABLE",n[n.LOSSY=1]="LOSSY",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(DataPacket_Kind||(DataPacket_Kind={}));var ServerInfo_Edition;(function(n){n[n.Standard=0]="Standard",n[n.Cloud=1]="Cloud",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(ServerInfo_Edition||(ServerInfo_Edition={}));var ClientInfo_SDK;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.JS=1]="JS",n[n.SWIFT=2]="SWIFT",n[n.ANDROID=3]="ANDROID",n[n.FLUTTER=4]="FLUTTER",n[n.GO=5]="GO",n[n.UNITY=6]="UNITY",n[n.REACT_NATIVE=7]="REACT_NATIVE",n[n.RUST=8]="RUST",n[n.PYTHON=9]="PYTHON",n[n.CPP=10]="CPP",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(ClientInfo_SDK||(ClientInfo_SDK={}));_m0.util.Long!==Long&&(_m0.util.Long=Long,_m0.configure());var EncodedFileType;(function(n){n[n.DEFAULT_FILETYPE=0]="DEFAULT_FILETYPE",n[n.MP4=1]="MP4",n[n.OGG=2]="OGG",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(EncodedFileType||(EncodedFileType={}));var SegmentedFileProtocol;(function(n){n[n.DEFAULT_SEGMENTED_FILE_PROTOCOL=0]="DEFAULT_SEGMENTED_FILE_PROTOCOL",n[n.HLS_PROTOCOL=1]="HLS_PROTOCOL",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(SegmentedFileProtocol||(SegmentedFileProtocol={}));var SegmentedFileSuffix;(function(n){n[n.INDEX=0]="INDEX",n[n.TIMESTAMP=1]="TIMESTAMP",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(SegmentedFileSuffix||(SegmentedFileSuffix={}));var ImageFileSuffix;(function(n){n[n.IMAGE_SUFFIX_INDEX=0]="IMAGE_SUFFIX_INDEX",n[n.IMAGE_SUFFIX_TIMESTAMP=1]="IMAGE_SUFFIX_TIMESTAMP",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(ImageFileSuffix||(ImageFileSuffix={}));var StreamProtocol;(function(n){n[n.DEFAULT_PROTOCOL=0]="DEFAULT_PROTOCOL",n[n.RTMP=1]="RTMP",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(StreamProtocol||(StreamProtocol={}));var EncodingOptionsPreset;(function(n){n[n.H264_720P_30=0]="H264_720P_30",n[n.H264_720P_60=1]="H264_720P_60",n[n.H264_1080P_30=2]="H264_1080P_30",n[n.H264_1080P_60=3]="H264_1080P_60",n[n.PORTRAIT_H264_720P_30=4]="PORTRAIT_H264_720P_30",n[n.PORTRAIT_H264_720P_60=5]="PORTRAIT_H264_720P_60",n[n.PORTRAIT_H264_1080P_30=6]="PORTRAIT_H264_1080P_30",n[n.PORTRAIT_H264_1080P_60=7]="PORTRAIT_H264_1080P_60",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(EncodingOptionsPreset||(EncodingOptionsPreset={}));var EgressStatus;(function(n){n[n.EGRESS_STARTING=0]="EGRESS_STARTING",n[n.EGRESS_ACTIVE=1]="EGRESS_ACTIVE",n[n.EGRESS_ENDING=2]="EGRESS_ENDING",n[n.EGRESS_COMPLETE=3]="EGRESS_COMPLETE",n[n.EGRESS_FAILED=4]="EGRESS_FAILED",n[n.EGRESS_ABORTED=5]="EGRESS_ABORTED",n[n.EGRESS_LIMIT_REACHED=6]="EGRESS_LIMIT_REACHED",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(EgressStatus||(EgressStatus={}));var StreamInfo_Status;(function(n){n[n.ACTIVE=0]="ACTIVE",n[n.FINISHED=1]="FINISHED",n[n.FAILED=2]="FAILED",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(StreamInfo_Status||(StreamInfo_Status={}));_m0.util.Long!==Long&&(_m0.util.Long=Long,_m0.configure());var mapObj={exports:{}};const isObject=n=>typeof n=="object"&&n!==null,mapObjectSkip=Symbol("skip"),isObjectCustom=n=>isObject(n)&&!(n instanceof RegExp)&&!(n instanceof Error)&&!(n instanceof Date),mapObject=(n,e,t,s=new WeakMap)=>{if(t={deep:!1,target:{},...t},s.has(n))return s.get(n);s.set(n,t.target);const{target:a}=t;delete t.target;const c=u=>u.map(d=>isObjectCustom(d)?mapObject(d,e,t,s):d);if(Array.isArray(n))return c(n);for(const[u,d]of Object.entries(n)){const m=e(u,d,n);if(m===mapObjectSkip)continue;let[_,b,{shouldRecurse:S=!0}={}]=m;_!=="__proto__"&&(t.deep&&S&&isObjectCustom(b)&&(b=Array.isArray(b)?c(b):mapObject(b,e,t,s)),a[_]=b)}return a};mapObj.exports=(n,e,t)=>{if(!isObject(n))throw new TypeError(`Expected an object, got \`${n}\` (${typeof n})`);return mapObject(n,e,t)};mapObj.exports.mapObjectSkip=mapObjectSkip;var camelcase={exports:{}};const UPPERCASE=/[\p{Lu}]/u,LOWERCASE=/[\p{Ll}]/u,LEADING_CAPITAL=/^[\p{Lu}](?![\p{Lu}])/gu,IDENTIFIER=/([\p{Alpha}\p{N}_]|$)/u,SEPARATORS=/[_.\- ]+/,LEADING_SEPARATORS=new RegExp("^"+SEPARATORS.source),SEPARATORS_AND_IDENTIFIER=new RegExp(SEPARATORS.source+IDENTIFIER.source,"gu"),NUMBERS_AND_IDENTIFIER=new RegExp("\\d+"+IDENTIFIER.source,"gu"),preserveCamelCase=(n,e,t)=>{let s=!1,a=!1,c=!1;for(let u=0;u<n.length;u++){const d=n[u];s&&UPPERCASE.test(d)?(n=n.slice(0,u)+"-"+n.slice(u),s=!1,c=a,a=!0,u++):a&&c&&LOWERCASE.test(d)?(n=n.slice(0,u-1)+"-"+n.slice(u-1),c=a,a=!1,s=!0):(s=e(d)===d&&t(d)!==d,c=a,a=t(d)===d&&e(d)!==d)}return n},preserveConsecutiveUppercase=(n,e)=>(LEADING_CAPITAL.lastIndex=0,n.replace(LEADING_CAPITAL,t=>e(t))),postProcess=(n,e)=>(SEPARATORS_AND_IDENTIFIER.lastIndex=0,NUMBERS_AND_IDENTIFIER.lastIndex=0,n.replace(SEPARATORS_AND_IDENTIFIER,(t,s)=>e(s)).replace(NUMBERS_AND_IDENTIFIER,t=>e(t))),camelCase=(n,e)=>{if(!(typeof n=="string"||Array.isArray(n)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(n)?n=n.map(c=>c.trim()).filter(c=>c.length).join("-"):n=n.trim(),n.length===0)return"";const t=e.locale===!1?c=>c.toLowerCase():c=>c.toLocaleLowerCase(e.locale),s=e.locale===!1?c=>c.toUpperCase():c=>c.toLocaleUpperCase(e.locale);return n.length===1?e.pascalCase?s(n):t(n):(n!==t(n)&&(n=preserveCamelCase(n,t,s)),n=n.replace(LEADING_SEPARATORS,""),e.preserveConsecutiveUppercase?n=preserveConsecutiveUppercase(n,t):n=t(n),e.pascalCase&&(n=s(n.charAt(0))+n.slice(1)),postProcess(n,s))};camelcase.exports=camelCase;camelcase.exports.default=camelCase;class QuickLRU{constructor(e={}){if(!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");this.maxSize=e.maxSize,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_set(e,t){if(this.cache.set(e,t),this._size++,this._size>=this.maxSize){if(this._size=0,typeof this.onEviction=="function")for(const[s,a]of this.oldCache.entries())this.onEviction(s,a);this.oldCache=this.cache,this.cache=new Map}}get(e){if(this.cache.has(e))return this.cache.get(e);if(this.oldCache.has(e)){const t=this.oldCache.get(e);return this.oldCache.delete(e),this._set(e,t),t}}set(e,t){return this.cache.has(e)?this.cache.set(e,t):this._set(e,t),this}has(e){return this.cache.has(e)||this.oldCache.has(e)}peek(e){if(this.cache.has(e))return this.cache.get(e);if(this.oldCache.has(e))return this.oldCache.get(e)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache)yield e;for(const e of this.oldCache){const[t]=e;this.cache.has(t)||(yield e)}}get size(){let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}}var quickLru=QuickLRU;const QuickLru=quickLru;new QuickLru({maxSize:1e5});var IngressInput;(function(n){n[n.RTMP_INPUT=0]="RTMP_INPUT",n[n.WHIP_INPUT=1]="WHIP_INPUT",n[n.URL_INPUT=2]="URL_INPUT",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(IngressInput||(IngressInput={}));var IngressAudioEncodingPreset;(function(n){n[n.OPUS_STEREO_96KBPS=0]="OPUS_STEREO_96KBPS",n[n.OPUS_MONO_64KBS=1]="OPUS_MONO_64KBS",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(IngressAudioEncodingPreset||(IngressAudioEncodingPreset={}));var IngressVideoEncodingPreset;(function(n){n[n.H264_720P_30FPS_3_LAYERS=0]="H264_720P_30FPS_3_LAYERS",n[n.H264_1080P_30FPS_3_LAYERS=1]="H264_1080P_30FPS_3_LAYERS",n[n.H264_540P_25FPS_2_LAYERS=2]="H264_540P_25FPS_2_LAYERS",n[n.H264_720P_30FPS_1_LAYER=3]="H264_720P_30FPS_1_LAYER",n[n.H264_1080P_30FPS_1_LAYER=4]="H264_1080P_30FPS_1_LAYER",n[n.H264_720P_30FPS_3_LAYERS_HIGH_MOTION=5]="H264_720P_30FPS_3_LAYERS_HIGH_MOTION",n[n.H264_1080P_30FPS_3_LAYERS_HIGH_MOTION=6]="H264_1080P_30FPS_3_LAYERS_HIGH_MOTION",n[n.H264_540P_25FPS_2_LAYERS_HIGH_MOTION=7]="H264_540P_25FPS_2_LAYERS_HIGH_MOTION",n[n.H264_720P_30FPS_1_LAYER_HIGH_MOTION=8]="H264_720P_30FPS_1_LAYER_HIGH_MOTION",n[n.H264_1080P_30FPS_1_LAYER_HIGH_MOTION=9]="H264_1080P_30FPS_1_LAYER_HIGH_MOTION",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(IngressVideoEncodingPreset||(IngressVideoEncodingPreset={}));var IngressState_Status;(function(n){n[n.ENDPOINT_INACTIVE=0]="ENDPOINT_INACTIVE",n[n.ENDPOINT_BUFFERING=1]="ENDPOINT_BUFFERING",n[n.ENDPOINT_PUBLISHING=2]="ENDPOINT_PUBLISHING",n[n.ENDPOINT_ERROR=3]="ENDPOINT_ERROR",n[n.ENDPOINT_COMPLETE=4]="ENDPOINT_COMPLETE",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED"})(IngressState_Status||(IngressState_Status={}));_m0.util.Long!==Long&&(_m0.util.Long=Long,_m0.configure());_m0.util.Long!==Long&&(_m0.util.Long=Long,_m0.configure());var TrackSource;(function(n){n.CAMERA="camera",n.MICROPHONE="microphone",n.SCREEN_SHARE="screen_share",n.SCREEN_SHARE_AUDIO="screen_share_audio"})(TrackSource||(TrackSource={}));function getKeyMaterial(n){let e=new TextEncoder;return window.crypto.subtle.importKey("raw",e.encode(n),{name:"PBKDF2"},!1,["deriveBits","deriveKey"])}function getKey(n,e){return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:e,iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async function decrypt(n,e,t,s){console.log("decrypting",n,e,t,s);const a=base64ToBytes(n),c=base64ToBytes(e),u=base64ToBytes(t);let d=await getKeyMaterial(s),m=await getKey(d,c);try{let _=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u},m,a);return DECODE_TXT(_)}catch(_){console.warn("Failed to decrypt",_)}}const base64codes=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,62,255,255,255,63,52,53,54,55,56,57,58,59,60,61,255,255,255,0,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];function getBase64Code(n){if(n>=base64codes.length)throw new Error("Unable to parse base64 string.");const e=base64codes[n];if(e===255)throw new Error("Unable to parse base64 string.");return e}function base64ToBytes(n){if(n.length%4!==0)throw new Error("Unable to parse base64 string.");const e=n.indexOf("=");if(e!==-1&&e<n.length-2)throw new Error("Unable to parse base64 string.");let t=n.endsWith("==")?2:n.endsWith("=")?1:0,s=n.length,a=new Uint8Array(3*(s/4)),c;for(let u=0,d=0;u<s;u+=4,d+=3)c=getBase64Code(n.charCodeAt(u))<<18|getBase64Code(n.charCodeAt(u+1))<<12|getBase64Code(n.charCodeAt(u+2))<<6|getBase64Code(n.charCodeAt(u+3)),a[d]=c>>16,a[d+1]=c>>8&255,a[d+2]=c&255;return a.subarray(0,a.length-t)}const appendLog=console.log;class LivekitGenericConnection{constructor(){ae(this,"config");ae(this,"lastMsgRecivedTimestamp");ae(this,"connectionState");ae(this,"latestRecivedDataMessage");ae(this,"participantConnectionEvents");ae(this,"_rovRoomName");ae(this,"_accessToken");ae(this,"_reconnectAttemptCount",0);ae(this,"_shouldReconnect");ae(this,"_videoElem");ae(this,"_roomConn");this.config={},this._shouldReconnect=!0,this.connectionState=nStore(ConnectionStates.init),this.latestRecivedDataMessage=nStore(null),this.participantConnectionEvents=nStore(null)}async init(e){this.config=e,this._shouldReconnect=!0,this._roomConn=new Room(e.roomConfig),this._roomConn.on(RoomEvent.DCBufferStatusChanged,t=>{appendLog("LK: DCBufferStatusChanged ",t)}).on(RoomEvent.SignalConnected,async()=>{appendLog(`LK: Signal connection established to ${this.config.hostUrl}`)}).on(RoomEvent.Connected,async()=>{appendLog(`LK: Connected to room: ${this._roomConn.name} via ${this.config.hostUrl}`),this.connectionState.set(ConnectionStates.connected)}).on(RoomEvent.Disconnected,t=>{this.connectionState.set(ConnectionStates.disconnectedOk);let s=this._shouldReconnect&&!!this._roomConn;t===DisconnectReason$1.DUPLICATE_IDENTITY?(console.warn("LK: disconnected from room - duplicate identity"),s=!1):t===DisconnectReason$1.CLIENT_INITIATED?(console.log("LK: disconnected from room - client initiated"),s=!1):t===DisconnectReason$1.SERVER_SHUTDOWN?(console.log("LK: disconnected from room - server shutdown"),s=!1):t===DisconnectReason$1.PARTICIPANT_REMOVED?(console.log("LK: disconnected from room - participant removed"),s=!1):t===DisconnectReason$1.ROOM_DELETED?(console.log("LK: disconnected from room - room deleted"),s=!1):t===DisconnectReason$1.STATE_MISMATCH?(console.log("LK: disconnected from room - state mismatch"),s=!1):t===DisconnectReason$1.JOIN_FAILURE?console.log("LK: disconnected from room - join failure"):t===DisconnectReason$1.UNKNOWN_REASON?console.log("LK: disconnected from room - unknown reason"):t===DisconnectReason$1.UNRECOGNIZED&&console.log("LK: disconnected from room - unrecognized"),s?this._reconnect():this.close()}).on(RoomEvent.Reconnecting,()=>{appendLog(`LK: Reconnecting to room ${this._roomConn.name} via ${this.config.hostUrl}`),this.connectionState.set(ConnectionStates.reconnecting)}).on(RoomEvent.Reconnected,async()=>{appendLog("LK: Successfully reconnected. server",await this._roomConn.engine.getConnectedServerAddress()),this.connectionState.set(ConnectionStates.connected)}).on(RoomEvent.ParticipantMetadataChanged,t=>{appendLog("LK: Participant Metadata Changed",t)}).on(RoomEvent.ParticipantConnected,async t=>{appendLog(`LK: Participant ${t.identity} (${t.sid}) connected`,t.metadata),this.participantConnectionEvents.set({id:t.identity,joined:!0}),t.on(ParticipantEvent.ConnectionQualityChanged,()=>{appendLog("LK: ParticipantEvent.ConnectionQualityChanged",t.connectionQuality)})}).on(RoomEvent.ParticipantDisconnected,t=>{appendLog(`LK: Participant ${t.identity} (${t.sid}) disconnected`),this.participantConnectionEvents.set({id:t.identity,joined:!1})}).on(RoomEvent.MediaDevicesError,t=>{const s=MediaDeviceFailure.getFailure(t);appendLog("LK: Media device failure",s)}).on(RoomEvent.ConnectionQualityChanged,(t,s)=>{appendLog(`LK: connection quality for ${s?s.identity:"[no identity]"} changed to ${t}`)}).on(RoomEvent.RoomMetadataChanged,t=>{try{appendLog("LK: New metadata for room",JSON.parse(t))}catch{appendLog("LK: New metadata for room (NOT VALID JSON)",t)}}).on(RoomEvent.MediaDevicesChanged,()=>{appendLog("LK: MediaDevicesChanged")}).on(RoomEvent.LocalTrackUnpublished,(t,s)=>{appendLog("LK: LocalTrackUnpublished",t.trackSid,"by participant",s.identity,"source",t.track?t.track.source:"[no track found]")}).on(RoomEvent.LocalTrackPublished,(t,s)=>{appendLog("LK: LocalVideoTrackPublished",t.trackSid,"by participant",s.identity,"source",t.track?t.track.source:"[no track found]")}).on(RoomEvent.MediaDevicesError,t=>{const s=MediaDeviceFailure.getFailure(t);appendLog("LK: media device failure",s)}).on(RoomEvent.AudioPlaybackStatusChanged,()=>{appendLog("LK: AudioPlaybackStatusChanged. canPlaybackAudio =",this._roomConn.canPlaybackAudio)})}async start(e,t){this._rovRoomName=e,this._accessToken=t,this._shouldReconnect=!0;const s=Date.now();console.log(`LK: Starting conn with ${e} via ${this.config.hostUrl} token = ${t}`);try{const a=setTimeout(()=>{console.log(`livekit connect timeout for ${this.config.hostUrl}. Reconnecting...`),this._reconnect()},16e3);await this._connect(),clearTimeout(a),console.log(`LK: Connected in ${Date.now()-s}ms ${this.config.hostUrl}`)}catch(a){console.log(`LK: Error connecting to ${this.config.hostUrl}. Reconnecting...`,a),this._reconnect()}}async sendMessage(e,t=!0,s=[]){if(!this._roomConn||this._roomConn.state!==ConnectionState.Connected||this.connectionState.get()!=ConnectionStates.connected)return console.warn("LK: Can't send message, room not connected");s.length==0&&(s=[...this._roomConn.participants.values()].map(c=>c.identity));const a=s.map(c=>{const u=this.getParticipantSid(c);return u||console.warn("LK: SendMessge: No participant found for livekit identity: ",c),u||null}).filter(c=>c!=null);a.length!=0&&await this._roomConn.localParticipant.publishData(e,t?DataPacket_Kind$1.RELIABLE:DataPacket_Kind$1.LOSSY,{destination:a})}getParticipantSid(e){const t=[...this._roomConn.participants.values()].find(s=>s.identity===e);return t?t.sid:null}getLivekitIdentitiy(){return this._roomConn?this._roomConn.localParticipant.identity:null}getRoomName(){return this._roomConn?this._roomConn.name:this._rovRoomName}async close(){this._shouldReconnect=!1,this._roomConn&&(console.info("LK: Closing Livekit Connection: ",this._rovRoomName,this.config.hostUrl),await this._roomConn.disconnect(!0))}async _connect(){await this._roomConn.connect(getWebsocketURL(this.config.hostUrl),this._accessToken,this.config.roomConnectionConfig),console.info("LK: Connected to room",this._roomConn.name,this._roomConn)}async _reconnect(){try{await this._roomConn.disconnect(!0)}catch(e){console.error("LK: Error disconnecting from room",e)}if(this._shouldReconnect!=!1)if(this._reconnectAttemptCount<this.config.reconnectAttempts){const e=this._reconnectAttemptCount*800;this._reconnectAttemptCount++,await waitfor(e);try{await this._connect()}catch(t){throw console.error("LK: Error reconnecting to room",t),t}}else console.error("LK: Failed to reconnect after ",this._reconnectAttemptCount,"/",this.config.reconnectAttempts,"attempts"),this._fail()}_fail(){this._shouldReconnect=!1,this.connectionState.set(ConnectionStates.failed)}}class LivekitViewerConnection extends LivekitGenericConnection{constructor(){super();ae(this,"remoteVideoTracks");this.remoteVideoTracks=nStore(new Map)}subscribeToTracks(t){this._rovRoomName===t.identity&&t.tracks.forEach(s=>{s.setSubscribed(!0)})}async init(t){await super.init(t),this._roomConn.on(RoomEvent.DataReceived,async(s,a)=>{if(!a)return console.warn("LK: Ignoring received data message with no participant. This can happen when the message is sent before connection completes or if the message comes from the server: ",s);if(a.identity!==this._rovRoomName)return;const c=a.identity;a.sid,this.lastMsgRecivedTimestamp=Date.now(),this.latestRecivedDataMessage.set({senderId:c,msg:s})}).on(RoomEvent.Connected,()=>{this._roomConn.participants.forEach(this.subscribeToTracks.bind(this))}).on(RoomEvent.ParticipantConnected,s=>{this.subscribeToTracks(s)}).on(RoomEvent.TrackPublished,(s,a)=>{this.subscribeToTracks(a)}).on(RoomEvent.TrackSubscribed,(s,a,c)=>{if(s.kind!==Track.Kind.Video)return console.warn("LK: Subscribed to unknown track kind: ",s.kind,s.source);const u=this.remoteVideoTracks.get();if(u.has(s.source)){if(u.get(s.source)==s)return;console.warn("LK: already subscribed to video track "+s.source+", unsubscribing from old track"),u.get(s.source).stop()}appendLog("LK: subscribed to video",s.source),u.set(s.source,s),this.remoteVideoTracks.set(u),s.on("upstreamPaused",()=>{console.log("LK: video upstream paused")}),s.on("muted",()=>{console.log("LK: video muted")}),s.on("ended",()=>{console.log("LK: video ended")})}).on(RoomEvent.TrackUnsubscribed,(s,a,c)=>{appendLog("LK: Unsubscribed from track",a.source,a.trackSid," from participant: ",c.identity),this.remoteVideoTracks.update(u=>(u.delete(a.source),u))})}}const $Reader=minimal.Reader,$Writer=minimal.Writer,$util=minimal.util,$root=minimal.roots.default||(minimal.roots.default={}),rov_actions_proto=$root.rov_actions_proto=(()=>{const n={};return n.LogLevel=function(){const e={},t=Object.create(e);return t[e[0]="Debug"]=0,t[e[1]="Info"]=1,t[e[2]="Warning"]=2,t[e[3]="Error"]=3,t[e[4]="Critical"]=4,t}(),n.SensorMeasurmentTypes=function(){const e={},t=Object.create(e);return t[e[0]="depth_meters"]=0,t[e[1]="water_temp_celsius"]=1,t[e[2]="pressure_mbar"]=2,t[e[3]="yaw_degrees"]=3,t[e[4]="pitch_degrees"]=4,t[e[5]="roll_degrees"]=5,t[e[6]="x_acceleration_m_s2"]=6,t[e[7]="y_acceleration_m_s2"]=7,t[e[8]="z_acceleration_m_s2"]=8,t[e[9]="battery_voltage"]=9,t[e[10]="battery_current_amps"]=10,t[e[11]="internal_temp_celsius"]=11,t}(),n.Measurement=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.MeasurementType=0,e.prototype.Value=0,e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),s.MeasurementType!=null&&Object.hasOwnProperty.call(s,"MeasurementType")&&a.uint32(8).int32(s.MeasurementType),s.Value!=null&&Object.hasOwnProperty.call(s,"Value")&&a.uint32(21).float(s.Value),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.Measurement;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.MeasurementType=s.int32();break}case 2:{u.Value=s.float();break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){if(typeof s!="object"||s===null)return"object expected";if(s.MeasurementType!=null&&s.hasOwnProperty("MeasurementType"))switch(s.MeasurementType){default:return"MeasurementType: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:break}return s.Value!=null&&s.hasOwnProperty("Value")&&typeof s.Value!="number"?"Value: number expected":null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.Measurement)return s;let a=new $root.rov_actions_proto.Measurement;switch(s.MeasurementType){default:if(typeof s.MeasurementType=="number"){a.MeasurementType=s.MeasurementType;break}break;case"depth_meters":case 0:a.MeasurementType=0;break;case"water_temp_celsius":case 1:a.MeasurementType=1;break;case"pressure_mbar":case 2:a.MeasurementType=2;break;case"yaw_degrees":case 3:a.MeasurementType=3;break;case"pitch_degrees":case 4:a.MeasurementType=4;break;case"roll_degrees":case 5:a.MeasurementType=5;break;case"x_acceleration_m_s2":case 6:a.MeasurementType=6;break;case"y_acceleration_m_s2":case 7:a.MeasurementType=7;break;case"z_acceleration_m_s2":case 8:a.MeasurementType=8;break;case"battery_voltage":case 9:a.MeasurementType=9;break;case"battery_current_amps":case 10:a.MeasurementType=10;break;case"internal_temp_celsius":case 11:a.MeasurementType=11;break}return s.Value!=null&&(a.Value=Number(s.Value)),a},e.toObject=function(s,a){a||(a={});let c={};return a.defaults&&(c.MeasurementType=a.enums===String?"depth_meters":0,c.Value=0),s.MeasurementType!=null&&s.hasOwnProperty("MeasurementType")&&(c.MeasurementType=a.enums===String?$root.rov_actions_proto.SensorMeasurmentTypes[s.MeasurementType]===void 0?s.MeasurementType:$root.rov_actions_proto.SensorMeasurmentTypes[s.MeasurementType]:s.MeasurementType),s.Value!=null&&s.hasOwnProperty("Value")&&(c.Value=a.json&&!isFinite(s.Value)?String(s.Value):s.Value),c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.Measurement"},e}(),n.DataTransportMethod=function(){const e={},t=Object.create(e);return t[e[0]="LivekitReliable"]=0,t[e[1]="LivekitUnreliable"]=1,t[e[3]="DirectUnreliable"]=3,t}(),n.InternalWebpageEvent=function(){const e={},t=Object.create(e);return t[e[0]="Nothing"]=0,t[e[1]="RovConnected"]=1,t[e[2]="RovDisconnected"]=2,t[e[3]="UserConnected"]=3,t[e[4]="UserDisconnected"]=4,t}(),n.PingAction=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.Time=$util.Long?$util.Long.fromBits(0,0,!1):0,e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),s.Time!=null&&Object.hasOwnProperty.call(s,"Time")&&a.uint32(8).int64(s.Time),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.PingAction;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.Time=s.int64();break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":s.Time!=null&&s.hasOwnProperty("Time")&&!$util.isInteger(s.Time)&&!(s.Time&&$util.isInteger(s.Time.low)&&$util.isInteger(s.Time.high))?"Time: integer|Long expected":null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.PingAction)return s;let a=new $root.rov_actions_proto.PingAction;return s.Time!=null&&($util.Long?(a.Time=$util.Long.fromValue(s.Time)).unsigned=!1:typeof s.Time=="string"?a.Time=parseInt(s.Time,10):typeof s.Time=="number"?a.Time=s.Time:typeof s.Time=="object"&&(a.Time=new $util.LongBits(s.Time.low>>>0,s.Time.high>>>0).toNumber())),a},e.toObject=function(s,a){a||(a={});let c={};if(a.defaults)if($util.Long){let u=new $util.Long(0,0,!1);c.Time=a.longs===String?u.toString():a.longs===Number?u.toNumber():u}else c.Time=a.longs===String?"0":0;return s.Time!=null&&s.hasOwnProperty("Time")&&(typeof s.Time=="number"?c.Time=a.longs===String?String(s.Time):s.Time:c.Time=a.longs===String?$util.Long.prototype.toString.call(s.Time):a.longs===Number?new $util.LongBits(s.Time.low>>>0,s.Time.high>>>0).toNumber():s.Time),c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.PingAction"},e}(),n.PasswordAttemptAction=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.Password="",e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),s.Password!=null&&Object.hasOwnProperty.call(s,"Password")&&a.uint32(10).string(s.Password),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.PasswordAttemptAction;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.Password=s.string();break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":s.Password!=null&&s.hasOwnProperty("Password")&&!$util.isString(s.Password)?"Password: string expected":null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.PasswordAttemptAction)return s;let a=new $root.rov_actions_proto.PasswordAttemptAction;return s.Password!=null&&(a.Password=String(s.Password)),a},e.toObject=function(s,a){a||(a={});let c={};return a.defaults&&(c.Password=""),s.Password!=null&&s.hasOwnProperty("Password")&&(c.Password=s.Password),c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.PasswordAttemptAction"},e}(),n.AuthTokenAttemptAction=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.Token="",e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),s.Token!=null&&Object.hasOwnProperty.call(s,"Token")&&a.uint32(10).string(s.Token),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.AuthTokenAttemptAction;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.Token=s.string();break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":s.Token!=null&&s.hasOwnProperty("Token")&&!$util.isString(s.Token)?"Token: string expected":null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.AuthTokenAttemptAction)return s;let a=new $root.rov_actions_proto.AuthTokenAttemptAction;return s.Token!=null&&(a.Token=String(s.Token)),a},e.toObject=function(s,a){a||(a={});let c={};return a.defaults&&(c.Token=""),s.Token!=null&&s.hasOwnProperty("Token")&&(c.Token=s.Token),c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.AuthTokenAttemptAction"},e}(),n.TakeControlAction=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.TakeControlAction;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":null},e.fromObject=function(s){return s instanceof $root.rov_actions_proto.TakeControlAction?s:new $root.rov_actions_proto.TakeControlAction},e.toObject=function(){return{}},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.TakeControlAction"},e}(),n.MoveAction=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.VelocityX=0,e.prototype.VelocityY=0,e.prototype.VelocityZ=0,e.prototype.AngularVelocityYaw=0,e.prototype.ButtonBitmask=0,e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),s.VelocityX!=null&&Object.hasOwnProperty.call(s,"VelocityX")&&a.uint32(13).float(s.VelocityX),s.VelocityY!=null&&Object.hasOwnProperty.call(s,"VelocityY")&&a.uint32(21).float(s.VelocityY),s.VelocityZ!=null&&Object.hasOwnProperty.call(s,"VelocityZ")&&a.uint32(29).float(s.VelocityZ),s.AngularVelocityYaw!=null&&Object.hasOwnProperty.call(s,"AngularVelocityYaw")&&a.uint32(37).float(s.AngularVelocityYaw),s.ButtonBitmask!=null&&Object.hasOwnProperty.call(s,"ButtonBitmask")&&a.uint32(40).int32(s.ButtonBitmask),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.MoveAction;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.VelocityX=s.float();break}case 2:{u.VelocityY=s.float();break}case 3:{u.VelocityZ=s.float();break}case 4:{u.AngularVelocityYaw=s.float();break}case 5:{u.ButtonBitmask=s.int32();break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":s.VelocityX!=null&&s.hasOwnProperty("VelocityX")&&typeof s.VelocityX!="number"?"VelocityX: number expected":s.VelocityY!=null&&s.hasOwnProperty("VelocityY")&&typeof s.VelocityY!="number"?"VelocityY: number expected":s.VelocityZ!=null&&s.hasOwnProperty("VelocityZ")&&typeof s.VelocityZ!="number"?"VelocityZ: number expected":s.AngularVelocityYaw!=null&&s.hasOwnProperty("AngularVelocityYaw")&&typeof s.AngularVelocityYaw!="number"?"AngularVelocityYaw: number expected":s.ButtonBitmask!=null&&s.hasOwnProperty("ButtonBitmask")&&!$util.isInteger(s.ButtonBitmask)?"ButtonBitmask: integer expected":null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.MoveAction)return s;let a=new $root.rov_actions_proto.MoveAction;return s.VelocityX!=null&&(a.VelocityX=Number(s.VelocityX)),s.VelocityY!=null&&(a.VelocityY=Number(s.VelocityY)),s.VelocityZ!=null&&(a.VelocityZ=Number(s.VelocityZ)),s.AngularVelocityYaw!=null&&(a.AngularVelocityYaw=Number(s.AngularVelocityYaw)),s.ButtonBitmask!=null&&(a.ButtonBitmask=s.ButtonBitmask|0),a},e.toObject=function(s,a){a||(a={});let c={};return a.defaults&&(c.VelocityX=0,c.VelocityY=0,c.VelocityZ=0,c.AngularVelocityYaw=0,c.ButtonBitmask=0),s.VelocityX!=null&&s.hasOwnProperty("VelocityX")&&(c.VelocityX=a.json&&!isFinite(s.VelocityX)?String(s.VelocityX):s.VelocityX),s.VelocityY!=null&&s.hasOwnProperty("VelocityY")&&(c.VelocityY=a.json&&!isFinite(s.VelocityY)?String(s.VelocityY):s.VelocityY),s.VelocityZ!=null&&s.hasOwnProperty("VelocityZ")&&(c.VelocityZ=a.json&&!isFinite(s.VelocityZ)?String(s.VelocityZ):s.VelocityZ),s.AngularVelocityYaw!=null&&s.hasOwnProperty("AngularVelocityYaw")&&(c.AngularVelocityYaw=a.json&&!isFinite(s.AngularVelocityYaw)?String(s.AngularVelocityYaw):s.AngularVelocityYaw),s.ButtonBitmask!=null&&s.hasOwnProperty("ButtonBitmask")&&(c.ButtonBitmask=s.ButtonBitmask),c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.MoveAction"},e}(),n.BeginVideoStreamAction=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.BeginVideoStreamAction;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":null},e.fromObject=function(s){return s instanceof $root.rov_actions_proto.BeginVideoStreamAction?s:new $root.rov_actions_proto.BeginVideoStreamAction},e.toObject=function(){return{}},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.BeginVideoStreamAction"},e}(),n.TakePhotoAction=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.TakePhotoAction;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":null},e.fromObject=function(s){return s instanceof $root.rov_actions_proto.TakePhotoAction?s:new $root.rov_actions_proto.TakePhotoAction},e.toObject=function(){return{}},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.TakePhotoAction"},e}(),n.StartVideoRecAction=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.StartVideoRecAction;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":null},e.fromObject=function(s){return s instanceof $root.rov_actions_proto.StartVideoRecAction?s:new $root.rov_actions_proto.StartVideoRecAction},e.toObject=function(){return{}},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.StartVideoRecAction"},e}(),n.StopVideoRecAction=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.StopVideoRecAction;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":null},e.fromObject=function(s){return s instanceof $root.rov_actions_proto.StopVideoRecAction?s:new $root.rov_actions_proto.StopVideoRecAction},e.toObject=function(){return{}},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.StopVideoRecAction"},e}(),n.ToogleLightsAction=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.ToogleLightsAction;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":null},e.fromObject=function(s){return s instanceof $root.rov_actions_proto.ToogleLightsAction?s:new $root.rov_actions_proto.ToogleLightsAction},e.toObject=function(){return{}},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.ToogleLightsAction"},e}(),n.ShutdownRovAction=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.ShutdownRovAction;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":null},e.fromObject=function(s){return s instanceof $root.rov_actions_proto.ShutdownRovAction?s:new $root.rov_actions_proto.ShutdownRovAction},e.toObject=function(){return{}},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.ShutdownRovAction"},e}(),n.RebootRovAction=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.RebootRovAction;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":null},e.fromObject=function(s){return s instanceof $root.rov_actions_proto.RebootRovAction?s:new $root.rov_actions_proto.RebootRovAction},e.toObject=function(){return{}},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.RebootRovAction"},e}(),n.EnableWifiAction=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.EnableWifiAction;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":null},e.fromObject=function(s){return s instanceof $root.rov_actions_proto.EnableWifiAction?s:new $root.rov_actions_proto.EnableWifiAction},e.toObject=function(){return{}},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.EnableWifiAction"},e}(),n.DisableWifiAction=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.DisableWifiAction;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":null},e.fromObject=function(s){return s instanceof $root.rov_actions_proto.DisableWifiAction?s:new $root.rov_actions_proto.DisableWifiAction},e.toObject=function(){return{}},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.DisableWifiAction"},e}(),n.RovStatusReportAction=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.RovStatusReportAction;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":null},e.fromObject=function(s){return s instanceof $root.rov_actions_proto.RovStatusReportAction?s:new $root.rov_actions_proto.RovStatusReportAction},e.toObject=function(){return{}},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.RovStatusReportAction"},e}(),n.RestartRovServicesAction=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.RestartRovServicesAction;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":null},e.fromObject=function(s){return s instanceof $root.rov_actions_proto.RestartRovServicesAction?s:new $root.rov_actions_proto.RestartRovServicesAction},e.toObject=function(){return{}},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.RestartRovServicesAction"},e}(),n.RovLogsAction=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.RovLogsAction;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":null},e.fromObject=function(s){return s instanceof $root.rov_actions_proto.RovLogsAction?s:new $root.rov_actions_proto.RovLogsAction},e.toObject=function(){return{}},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.RovLogsAction"},e}(),n.RefreshAllSensorsAction=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.RefreshAllSensorsAction;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":null},e.fromObject=function(s){return s instanceof $root.rov_actions_proto.RefreshAllSensorsAction?s:new $root.rov_actions_proto.RefreshAllSensorsAction},e.toObject=function(){return{}},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.RefreshAllSensorsAction"},e}(),n.MavlinkAction=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.Message=$util.newBuffer([]),e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),s.Message!=null&&Object.hasOwnProperty.call(s,"Message")&&a.uint32(10).bytes(s.Message),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.MavlinkAction;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.Message=s.bytes();break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":s.Message!=null&&s.hasOwnProperty("Message")&&!(s.Message&&typeof s.Message.length=="number"||$util.isString(s.Message))?"Message: buffer expected":null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.MavlinkAction)return s;let a=new $root.rov_actions_proto.MavlinkAction;return s.Message!=null&&(typeof s.Message=="string"?$util.base64.decode(s.Message,a.Message=$util.newBuffer($util.base64.length(s.Message)),0):s.Message.length>=0&&(a.Message=s.Message)),a},e.toObject=function(s,a){a||(a={});let c={};return a.defaults&&(a.bytes===String?c.Message="":(c.Message=[],a.bytes!==Array&&(c.Message=$util.newBuffer(c.Message)))),s.Message!=null&&s.hasOwnProperty("Message")&&(c.Message=a.bytes===String?$util.base64.encode(s.Message,0,s.Message.length):a.bytes===Array?Array.prototype.slice.call(s.Message):s.Message),c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.MavlinkAction"},e}(),n.SimplepeerSignalAction=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.Message="",e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),s.Message!=null&&Object.hasOwnProperty.call(s,"Message")&&a.uint32(10).string(s.Message),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.SimplepeerSignalAction;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.Message=s.string();break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":s.Message!=null&&s.hasOwnProperty("Message")&&!$util.isString(s.Message)?"Message: string expected":null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.SimplepeerSignalAction)return s;let a=new $root.rov_actions_proto.SimplepeerSignalAction;return s.Message!=null&&(a.Message=String(s.Message)),a},e.toObject=function(s,a){a||(a={});let c={};return a.defaults&&(c.Message=""),s.Message!=null&&s.hasOwnProperty("Message")&&(c.Message=s.Message),c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.SimplepeerSignalAction"},e}(),n.DisarmAction=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.DisarmAction;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":null},e.fromObject=function(s){return s instanceof $root.rov_actions_proto.DisarmAction?s:new $root.rov_actions_proto.DisarmAction},e.toObject=function(){return{}},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.DisarmAction"},e}(),n.SetAutopilotModeAction=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.mode=0,e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),s.mode!=null&&Object.hasOwnProperty.call(s,"mode")&&a.uint32(8).int32(s.mode),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.SetAutopilotModeAction;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.mode=s.int32();break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":s.mode!=null&&s.hasOwnProperty("mode")&&!$util.isInteger(s.mode)?"mode: integer expected":null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.SetAutopilotModeAction)return s;let a=new $root.rov_actions_proto.SetAutopilotModeAction;return s.mode!=null&&(a.mode=s.mode|0),a},e.toObject=function(s,a){a||(a={});let c={};return a.defaults&&(c.mode=0),s.mode!=null&&s.hasOwnProperty("mode")&&(c.mode=s.mode),c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.SetAutopilotModeAction"},e}(),n.ActionBackendMetadata=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.FromUserId="",e.prototype.InternalWebpageEvt=0,e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),s.FromUserId!=null&&Object.hasOwnProperty.call(s,"FromUserId")&&a.uint32(10).string(s.FromUserId),s.InternalWebpageEvt!=null&&Object.hasOwnProperty.call(s,"InternalWebpageEvt")&&a.uint32(16).int32(s.InternalWebpageEvt),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.ActionBackendMetadata;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.FromUserId=s.string();break}case 2:{u.InternalWebpageEvt=s.int32();break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){if(typeof s!="object"||s===null)return"object expected";if(s.FromUserId!=null&&s.hasOwnProperty("FromUserId")&&!$util.isString(s.FromUserId))return"FromUserId: string expected";if(s.InternalWebpageEvt!=null&&s.hasOwnProperty("InternalWebpageEvt"))switch(s.InternalWebpageEvt){default:return"InternalWebpageEvt: enum value expected";case 0:case 1:case 2:case 3:case 4:break}return null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.ActionBackendMetadata)return s;let a=new $root.rov_actions_proto.ActionBackendMetadata;switch(s.FromUserId!=null&&(a.FromUserId=String(s.FromUserId)),s.InternalWebpageEvt){default:if(typeof s.InternalWebpageEvt=="number"){a.InternalWebpageEvt=s.InternalWebpageEvt;break}break;case"Nothing":case 0:a.InternalWebpageEvt=0;break;case"RovConnected":case 1:a.InternalWebpageEvt=1;break;case"RovDisconnected":case 2:a.InternalWebpageEvt=2;break;case"UserConnected":case 3:a.InternalWebpageEvt=3;break;case"UserDisconnected":case 4:a.InternalWebpageEvt=4;break}return a},e.toObject=function(s,a){a||(a={});let c={};return a.defaults&&(c.FromUserId="",c.InternalWebpageEvt=a.enums===String?"Nothing":0),s.FromUserId!=null&&s.hasOwnProperty("FromUserId")&&(c.FromUserId=s.FromUserId),s.InternalWebpageEvt!=null&&s.hasOwnProperty("InternalWebpageEvt")&&(c.InternalWebpageEvt=a.enums===String?$root.rov_actions_proto.InternalWebpageEvent[s.InternalWebpageEvt]===void 0?s.InternalWebpageEvt:$root.rov_actions_proto.InternalWebpageEvent[s.InternalWebpageEvt]:s.InternalWebpageEvt),c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.ActionBackendMetadata"},e}(),n.RovAction=function(){function e(s){if(s)for(let a=Object.keys(s),c=0;c<a.length;++c)s[a[c]]!=null&&(this[a[c]]=s[a[c]])}e.prototype.BackendMetadata=null,e.prototype.ExchangeId=0,e.prototype.Ping=null,e.prototype.PasswordAttempt=null,e.prototype.AuthTokenAttempt=null,e.prototype.TakeControl=null,e.prototype.Move=null,e.prototype.BeginVideoStream=null,e.prototype.TakePhoto=null,e.prototype.StartVideoRec=null,e.prototype.StopVideoRec=null,e.prototype.ToogleLights=null,e.prototype.ShutdownRov=null,e.prototype.RebootRov=null,e.prototype.EnableWifi=null,e.prototype.DisableWifi=null,e.prototype.RovStatusReport=null,e.prototype.RestartRovServices=null,e.prototype.RovLogs=null,e.prototype.RefreshAllSensors=null,e.prototype.Mavlink=null,e.prototype.SimplepeerSignal=null,e.prototype.Disarm=null,e.prototype.SetAutopilotMode=null;let t;return Object.defineProperty(e.prototype,"Body",{get:$util.oneOfGetter(t=["Ping","PasswordAttempt","AuthTokenAttempt","TakeControl","Move","BeginVideoStream","TakePhoto","StartVideoRec","StopVideoRec","ToogleLights","ShutdownRov","RebootRov","EnableWifi","DisableWifi","RovStatusReport","RestartRovServices","RovLogs","RefreshAllSensors","Mavlink","SimplepeerSignal","Disarm","SetAutopilotMode"]),set:$util.oneOfSetter(t)}),e.create=function(a){return new e(a)},e.encode=function(a,c){return c||(c=$Writer.create()),a.BackendMetadata!=null&&Object.hasOwnProperty.call(a,"BackendMetadata")&&$root.rov_actions_proto.ActionBackendMetadata.encode(a.BackendMetadata,c.uint32(10).fork()).ldelim(),a.ExchangeId!=null&&Object.hasOwnProperty.call(a,"ExchangeId")&&c.uint32(16).int32(a.ExchangeId),a.Ping!=null&&Object.hasOwnProperty.call(a,"Ping")&&$root.rov_actions_proto.PingAction.encode(a.Ping,c.uint32(26).fork()).ldelim(),a.PasswordAttempt!=null&&Object.hasOwnProperty.call(a,"PasswordAttempt")&&$root.rov_actions_proto.PasswordAttemptAction.encode(a.PasswordAttempt,c.uint32(34).fork()).ldelim(),a.AuthTokenAttempt!=null&&Object.hasOwnProperty.call(a,"AuthTokenAttempt")&&$root.rov_actions_proto.AuthTokenAttemptAction.encode(a.AuthTokenAttempt,c.uint32(42).fork()).ldelim(),a.TakeControl!=null&&Object.hasOwnProperty.call(a,"TakeControl")&&$root.rov_actions_proto.TakeControlAction.encode(a.TakeControl,c.uint32(50).fork()).ldelim(),a.Move!=null&&Object.hasOwnProperty.call(a,"Move")&&$root.rov_actions_proto.MoveAction.encode(a.Move,c.uint32(58).fork()).ldelim(),a.BeginVideoStream!=null&&Object.hasOwnProperty.call(a,"BeginVideoStream")&&$root.rov_actions_proto.BeginVideoStreamAction.encode(a.BeginVideoStream,c.uint32(66).fork()).ldelim(),a.TakePhoto!=null&&Object.hasOwnProperty.call(a,"TakePhoto")&&$root.rov_actions_proto.TakePhotoAction.encode(a.TakePhoto,c.uint32(74).fork()).ldelim(),a.StartVideoRec!=null&&Object.hasOwnProperty.call(a,"StartVideoRec")&&$root.rov_actions_proto.StartVideoRecAction.encode(a.StartVideoRec,c.uint32(82).fork()).ldelim(),a.StopVideoRec!=null&&Object.hasOwnProperty.call(a,"StopVideoRec")&&$root.rov_actions_proto.StopVideoRecAction.encode(a.StopVideoRec,c.uint32(90).fork()).ldelim(),a.ToogleLights!=null&&Object.hasOwnProperty.call(a,"ToogleLights")&&$root.rov_actions_proto.ToogleLightsAction.encode(a.ToogleLights,c.uint32(98).fork()).ldelim(),a.ShutdownRov!=null&&Object.hasOwnProperty.call(a,"ShutdownRov")&&$root.rov_actions_proto.ShutdownRovAction.encode(a.ShutdownRov,c.uint32(106).fork()).ldelim(),a.RebootRov!=null&&Object.hasOwnProperty.call(a,"RebootRov")&&$root.rov_actions_proto.RebootRovAction.encode(a.RebootRov,c.uint32(114).fork()).ldelim(),a.EnableWifi!=null&&Object.hasOwnProperty.call(a,"EnableWifi")&&$root.rov_actions_proto.EnableWifiAction.encode(a.EnableWifi,c.uint32(122).fork()).ldelim(),a.DisableWifi!=null&&Object.hasOwnProperty.call(a,"DisableWifi")&&$root.rov_actions_proto.DisableWifiAction.encode(a.DisableWifi,c.uint32(130).fork()).ldelim(),a.RovStatusReport!=null&&Object.hasOwnProperty.call(a,"RovStatusReport")&&$root.rov_actions_proto.RovStatusReportAction.encode(a.RovStatusReport,c.uint32(138).fork()).ldelim(),a.RestartRovServices!=null&&Object.hasOwnProperty.call(a,"RestartRovServices")&&$root.rov_actions_proto.RestartRovServicesAction.encode(a.RestartRovServices,c.uint32(146).fork()).ldelim(),a.RovLogs!=null&&Object.hasOwnProperty.call(a,"RovLogs")&&$root.rov_actions_proto.RovLogsAction.encode(a.RovLogs,c.uint32(154).fork()).ldelim(),a.RefreshAllSensors!=null&&Object.hasOwnProperty.call(a,"RefreshAllSensors")&&$root.rov_actions_proto.RefreshAllSensorsAction.encode(a.RefreshAllSensors,c.uint32(162).fork()).ldelim(),a.Mavlink!=null&&Object.hasOwnProperty.call(a,"Mavlink")&&$root.rov_actions_proto.MavlinkAction.encode(a.Mavlink,c.uint32(170).fork()).ldelim(),a.SimplepeerSignal!=null&&Object.hasOwnProperty.call(a,"SimplepeerSignal")&&$root.rov_actions_proto.SimplepeerSignalAction.encode(a.SimplepeerSignal,c.uint32(178).fork()).ldelim(),a.Disarm!=null&&Object.hasOwnProperty.call(a,"Disarm")&&$root.rov_actions_proto.DisarmAction.encode(a.Disarm,c.uint32(186).fork()).ldelim(),a.SetAutopilotMode!=null&&Object.hasOwnProperty.call(a,"SetAutopilotMode")&&$root.rov_actions_proto.SetAutopilotModeAction.encode(a.SetAutopilotMode,c.uint32(194).fork()).ldelim(),c},e.encodeDelimited=function(a,c){return this.encode(a,c).ldelim()},e.decode=function(a,c){a instanceof $Reader||(a=$Reader.create(a));let u=c===void 0?a.len:a.pos+c,d=new $root.rov_actions_proto.RovAction;for(;a.pos<u;){let m=a.uint32();switch(m>>>3){case 1:{d.BackendMetadata=$root.rov_actions_proto.ActionBackendMetadata.decode(a,a.uint32());break}case 2:{d.ExchangeId=a.int32();break}case 3:{d.Ping=$root.rov_actions_proto.PingAction.decode(a,a.uint32());break}case 4:{d.PasswordAttempt=$root.rov_actions_proto.PasswordAttemptAction.decode(a,a.uint32());break}case 5:{d.AuthTokenAttempt=$root.rov_actions_proto.AuthTokenAttemptAction.decode(a,a.uint32());break}case 6:{d.TakeControl=$root.rov_actions_proto.TakeControlAction.decode(a,a.uint32());break}case 7:{d.Move=$root.rov_actions_proto.MoveAction.decode(a,a.uint32());break}case 8:{d.BeginVideoStream=$root.rov_actions_proto.BeginVideoStreamAction.decode(a,a.uint32());break}case 9:{d.TakePhoto=$root.rov_actions_proto.TakePhotoAction.decode(a,a.uint32());break}case 10:{d.StartVideoRec=$root.rov_actions_proto.StartVideoRecAction.decode(a,a.uint32());break}case 11:{d.StopVideoRec=$root.rov_actions_proto.StopVideoRecAction.decode(a,a.uint32());break}case 12:{d.ToogleLights=$root.rov_actions_proto.ToogleLightsAction.decode(a,a.uint32());break}case 13:{d.ShutdownRov=$root.rov_actions_proto.ShutdownRovAction.decode(a,a.uint32());break}case 14:{d.RebootRov=$root.rov_actions_proto.RebootRovAction.decode(a,a.uint32());break}case 15:{d.EnableWifi=$root.rov_actions_proto.EnableWifiAction.decode(a,a.uint32());break}case 16:{d.DisableWifi=$root.rov_actions_proto.DisableWifiAction.decode(a,a.uint32());break}case 17:{d.RovStatusReport=$root.rov_actions_proto.RovStatusReportAction.decode(a,a.uint32());break}case 18:{d.RestartRovServices=$root.rov_actions_proto.RestartRovServicesAction.decode(a,a.uint32());break}case 19:{d.RovLogs=$root.rov_actions_proto.RovLogsAction.decode(a,a.uint32());break}case 20:{d.RefreshAllSensors=$root.rov_actions_proto.RefreshAllSensorsAction.decode(a,a.uint32());break}case 21:{d.Mavlink=$root.rov_actions_proto.MavlinkAction.decode(a,a.uint32());break}case 22:{d.SimplepeerSignal=$root.rov_actions_proto.SimplepeerSignalAction.decode(a,a.uint32());break}case 23:{d.Disarm=$root.rov_actions_proto.DisarmAction.decode(a,a.uint32());break}case 24:{d.SetAutopilotMode=$root.rov_actions_proto.SetAutopilotModeAction.decode(a,a.uint32());break}default:a.skipType(m&7);break}}return d},e.decodeDelimited=function(a){return a instanceof $Reader||(a=new $Reader(a)),this.decode(a,a.uint32())},e.verify=function(a){if(typeof a!="object"||a===null)return"object expected";let c={};if(a.BackendMetadata!=null&&a.hasOwnProperty("BackendMetadata")){let u=$root.rov_actions_proto.ActionBackendMetadata.verify(a.BackendMetadata);if(u)return"BackendMetadata."+u}if(a.ExchangeId!=null&&a.hasOwnProperty("ExchangeId")&&!$util.isInteger(a.ExchangeId))return"ExchangeId: integer expected";if(a.Ping!=null&&a.hasOwnProperty("Ping")){c.Body=1;{let u=$root.rov_actions_proto.PingAction.verify(a.Ping);if(u)return"Ping."+u}}if(a.PasswordAttempt!=null&&a.hasOwnProperty("PasswordAttempt")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.PasswordAttemptAction.verify(a.PasswordAttempt);if(u)return"PasswordAttempt."+u}}if(a.AuthTokenAttempt!=null&&a.hasOwnProperty("AuthTokenAttempt")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.AuthTokenAttemptAction.verify(a.AuthTokenAttempt);if(u)return"AuthTokenAttempt."+u}}if(a.TakeControl!=null&&a.hasOwnProperty("TakeControl")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.TakeControlAction.verify(a.TakeControl);if(u)return"TakeControl."+u}}if(a.Move!=null&&a.hasOwnProperty("Move")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.MoveAction.verify(a.Move);if(u)return"Move."+u}}if(a.BeginVideoStream!=null&&a.hasOwnProperty("BeginVideoStream")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.BeginVideoStreamAction.verify(a.BeginVideoStream);if(u)return"BeginVideoStream."+u}}if(a.TakePhoto!=null&&a.hasOwnProperty("TakePhoto")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.TakePhotoAction.verify(a.TakePhoto);if(u)return"TakePhoto."+u}}if(a.StartVideoRec!=null&&a.hasOwnProperty("StartVideoRec")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.StartVideoRecAction.verify(a.StartVideoRec);if(u)return"StartVideoRec."+u}}if(a.StopVideoRec!=null&&a.hasOwnProperty("StopVideoRec")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.StopVideoRecAction.verify(a.StopVideoRec);if(u)return"StopVideoRec."+u}}if(a.ToogleLights!=null&&a.hasOwnProperty("ToogleLights")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.ToogleLightsAction.verify(a.ToogleLights);if(u)return"ToogleLights."+u}}if(a.ShutdownRov!=null&&a.hasOwnProperty("ShutdownRov")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.ShutdownRovAction.verify(a.ShutdownRov);if(u)return"ShutdownRov."+u}}if(a.RebootRov!=null&&a.hasOwnProperty("RebootRov")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.RebootRovAction.verify(a.RebootRov);if(u)return"RebootRov."+u}}if(a.EnableWifi!=null&&a.hasOwnProperty("EnableWifi")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.EnableWifiAction.verify(a.EnableWifi);if(u)return"EnableWifi."+u}}if(a.DisableWifi!=null&&a.hasOwnProperty("DisableWifi")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.DisableWifiAction.verify(a.DisableWifi);if(u)return"DisableWifi."+u}}if(a.RovStatusReport!=null&&a.hasOwnProperty("RovStatusReport")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.RovStatusReportAction.verify(a.RovStatusReport);if(u)return"RovStatusReport."+u}}if(a.RestartRovServices!=null&&a.hasOwnProperty("RestartRovServices")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.RestartRovServicesAction.verify(a.RestartRovServices);if(u)return"RestartRovServices."+u}}if(a.RovLogs!=null&&a.hasOwnProperty("RovLogs")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.RovLogsAction.verify(a.RovLogs);if(u)return"RovLogs."+u}}if(a.RefreshAllSensors!=null&&a.hasOwnProperty("RefreshAllSensors")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.RefreshAllSensorsAction.verify(a.RefreshAllSensors);if(u)return"RefreshAllSensors."+u}}if(a.Mavlink!=null&&a.hasOwnProperty("Mavlink")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.MavlinkAction.verify(a.Mavlink);if(u)return"Mavlink."+u}}if(a.SimplepeerSignal!=null&&a.hasOwnProperty("SimplepeerSignal")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.SimplepeerSignalAction.verify(a.SimplepeerSignal);if(u)return"SimplepeerSignal."+u}}if(a.Disarm!=null&&a.hasOwnProperty("Disarm")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.DisarmAction.verify(a.Disarm);if(u)return"Disarm."+u}}if(a.SetAutopilotMode!=null&&a.hasOwnProperty("SetAutopilotMode")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.SetAutopilotModeAction.verify(a.SetAutopilotMode);if(u)return"SetAutopilotMode."+u}}return null},e.fromObject=function(a){if(a instanceof $root.rov_actions_proto.RovAction)return a;let c=new $root.rov_actions_proto.RovAction;if(a.BackendMetadata!=null){if(typeof a.BackendMetadata!="object")throw TypeError(".rov_actions_proto.RovAction.BackendMetadata: object expected");c.BackendMetadata=$root.rov_actions_proto.ActionBackendMetadata.fromObject(a.BackendMetadata)}if(a.ExchangeId!=null&&(c.ExchangeId=a.ExchangeId|0),a.Ping!=null){if(typeof a.Ping!="object")throw TypeError(".rov_actions_proto.RovAction.Ping: object expected");c.Ping=$root.rov_actions_proto.PingAction.fromObject(a.Ping)}if(a.PasswordAttempt!=null){if(typeof a.PasswordAttempt!="object")throw TypeError(".rov_actions_proto.RovAction.PasswordAttempt: object expected");c.PasswordAttempt=$root.rov_actions_proto.PasswordAttemptAction.fromObject(a.PasswordAttempt)}if(a.AuthTokenAttempt!=null){if(typeof a.AuthTokenAttempt!="object")throw TypeError(".rov_actions_proto.RovAction.AuthTokenAttempt: object expected");c.AuthTokenAttempt=$root.rov_actions_proto.AuthTokenAttemptAction.fromObject(a.AuthTokenAttempt)}if(a.TakeControl!=null){if(typeof a.TakeControl!="object")throw TypeError(".rov_actions_proto.RovAction.TakeControl: object expected");c.TakeControl=$root.rov_actions_proto.TakeControlAction.fromObject(a.TakeControl)}if(a.Move!=null){if(typeof a.Move!="object")throw TypeError(".rov_actions_proto.RovAction.Move: object expected");c.Move=$root.rov_actions_proto.MoveAction.fromObject(a.Move)}if(a.BeginVideoStream!=null){if(typeof a.BeginVideoStream!="object")throw TypeError(".rov_actions_proto.RovAction.BeginVideoStream: object expected");c.BeginVideoStream=$root.rov_actions_proto.BeginVideoStreamAction.fromObject(a.BeginVideoStream)}if(a.TakePhoto!=null){if(typeof a.TakePhoto!="object")throw TypeError(".rov_actions_proto.RovAction.TakePhoto: object expected");c.TakePhoto=$root.rov_actions_proto.TakePhotoAction.fromObject(a.TakePhoto)}if(a.StartVideoRec!=null){if(typeof a.StartVideoRec!="object")throw TypeError(".rov_actions_proto.RovAction.StartVideoRec: object expected");c.StartVideoRec=$root.rov_actions_proto.StartVideoRecAction.fromObject(a.StartVideoRec)}if(a.StopVideoRec!=null){if(typeof a.StopVideoRec!="object")throw TypeError(".rov_actions_proto.RovAction.StopVideoRec: object expected");c.StopVideoRec=$root.rov_actions_proto.StopVideoRecAction.fromObject(a.StopVideoRec)}if(a.ToogleLights!=null){if(typeof a.ToogleLights!="object")throw TypeError(".rov_actions_proto.RovAction.ToogleLights: object expected");c.ToogleLights=$root.rov_actions_proto.ToogleLightsAction.fromObject(a.ToogleLights)}if(a.ShutdownRov!=null){if(typeof a.ShutdownRov!="object")throw TypeError(".rov_actions_proto.RovAction.ShutdownRov: object expected");c.ShutdownRov=$root.rov_actions_proto.ShutdownRovAction.fromObject(a.ShutdownRov)}if(a.RebootRov!=null){if(typeof a.RebootRov!="object")throw TypeError(".rov_actions_proto.RovAction.RebootRov: object expected");c.RebootRov=$root.rov_actions_proto.RebootRovAction.fromObject(a.RebootRov)}if(a.EnableWifi!=null){if(typeof a.EnableWifi!="object")throw TypeError(".rov_actions_proto.RovAction.EnableWifi: object expected");c.EnableWifi=$root.rov_actions_proto.EnableWifiAction.fromObject(a.EnableWifi)}if(a.DisableWifi!=null){if(typeof a.DisableWifi!="object")throw TypeError(".rov_actions_proto.RovAction.DisableWifi: object expected");c.DisableWifi=$root.rov_actions_proto.DisableWifiAction.fromObject(a.DisableWifi)}if(a.RovStatusReport!=null){if(typeof a.RovStatusReport!="object")throw TypeError(".rov_actions_proto.RovAction.RovStatusReport: object expected");c.RovStatusReport=$root.rov_actions_proto.RovStatusReportAction.fromObject(a.RovStatusReport)}if(a.RestartRovServices!=null){if(typeof a.RestartRovServices!="object")throw TypeError(".rov_actions_proto.RovAction.RestartRovServices: object expected");c.RestartRovServices=$root.rov_actions_proto.RestartRovServicesAction.fromObject(a.RestartRovServices)}if(a.RovLogs!=null){if(typeof a.RovLogs!="object")throw TypeError(".rov_actions_proto.RovAction.RovLogs: object expected");c.RovLogs=$root.rov_actions_proto.RovLogsAction.fromObject(a.RovLogs)}if(a.RefreshAllSensors!=null){if(typeof a.RefreshAllSensors!="object")throw TypeError(".rov_actions_proto.RovAction.RefreshAllSensors: object expected");c.RefreshAllSensors=$root.rov_actions_proto.RefreshAllSensorsAction.fromObject(a.RefreshAllSensors)}if(a.Mavlink!=null){if(typeof a.Mavlink!="object")throw TypeError(".rov_actions_proto.RovAction.Mavlink: object expected");c.Mavlink=$root.rov_actions_proto.MavlinkAction.fromObject(a.Mavlink)}if(a.SimplepeerSignal!=null){if(typeof a.SimplepeerSignal!="object")throw TypeError(".rov_actions_proto.RovAction.SimplepeerSignal: object expected");c.SimplepeerSignal=$root.rov_actions_proto.SimplepeerSignalAction.fromObject(a.SimplepeerSignal)}if(a.Disarm!=null){if(typeof a.Disarm!="object")throw TypeError(".rov_actions_proto.RovAction.Disarm: object expected");c.Disarm=$root.rov_actions_proto.DisarmAction.fromObject(a.Disarm)}if(a.SetAutopilotMode!=null){if(typeof a.SetAutopilotMode!="object")throw TypeError(".rov_actions_proto.RovAction.SetAutopilotMode: object expected");c.SetAutopilotMode=$root.rov_actions_proto.SetAutopilotModeAction.fromObject(a.SetAutopilotMode)}return c},e.toObject=function(a,c){c||(c={});let u={};return c.defaults&&(u.BackendMetadata=null,u.ExchangeId=0),a.BackendMetadata!=null&&a.hasOwnProperty("BackendMetadata")&&(u.BackendMetadata=$root.rov_actions_proto.ActionBackendMetadata.toObject(a.BackendMetadata,c)),a.ExchangeId!=null&&a.hasOwnProperty("ExchangeId")&&(u.ExchangeId=a.ExchangeId),a.Ping!=null&&a.hasOwnProperty("Ping")&&(u.Ping=$root.rov_actions_proto.PingAction.toObject(a.Ping,c),c.oneofs&&(u.Body="Ping")),a.PasswordAttempt!=null&&a.hasOwnProperty("PasswordAttempt")&&(u.PasswordAttempt=$root.rov_actions_proto.PasswordAttemptAction.toObject(a.PasswordAttempt,c),c.oneofs&&(u.Body="PasswordAttempt")),a.AuthTokenAttempt!=null&&a.hasOwnProperty("AuthTokenAttempt")&&(u.AuthTokenAttempt=$root.rov_actions_proto.AuthTokenAttemptAction.toObject(a.AuthTokenAttempt,c),c.oneofs&&(u.Body="AuthTokenAttempt")),a.TakeControl!=null&&a.hasOwnProperty("TakeControl")&&(u.TakeControl=$root.rov_actions_proto.TakeControlAction.toObject(a.TakeControl,c),c.oneofs&&(u.Body="TakeControl")),a.Move!=null&&a.hasOwnProperty("Move")&&(u.Move=$root.rov_actions_proto.MoveAction.toObject(a.Move,c),c.oneofs&&(u.Body="Move")),a.BeginVideoStream!=null&&a.hasOwnProperty("BeginVideoStream")&&(u.BeginVideoStream=$root.rov_actions_proto.BeginVideoStreamAction.toObject(a.BeginVideoStream,c),c.oneofs&&(u.Body="BeginVideoStream")),a.TakePhoto!=null&&a.hasOwnProperty("TakePhoto")&&(u.TakePhoto=$root.rov_actions_proto.TakePhotoAction.toObject(a.TakePhoto,c),c.oneofs&&(u.Body="TakePhoto")),a.StartVideoRec!=null&&a.hasOwnProperty("StartVideoRec")&&(u.StartVideoRec=$root.rov_actions_proto.StartVideoRecAction.toObject(a.StartVideoRec,c),c.oneofs&&(u.Body="StartVideoRec")),a.StopVideoRec!=null&&a.hasOwnProperty("StopVideoRec")&&(u.StopVideoRec=$root.rov_actions_proto.StopVideoRecAction.toObject(a.StopVideoRec,c),c.oneofs&&(u.Body="StopVideoRec")),a.ToogleLights!=null&&a.hasOwnProperty("ToogleLights")&&(u.ToogleLights=$root.rov_actions_proto.ToogleLightsAction.toObject(a.ToogleLights,c),c.oneofs&&(u.Body="ToogleLights")),a.ShutdownRov!=null&&a.hasOwnProperty("ShutdownRov")&&(u.ShutdownRov=$root.rov_actions_proto.ShutdownRovAction.toObject(a.ShutdownRov,c),c.oneofs&&(u.Body="ShutdownRov")),a.RebootRov!=null&&a.hasOwnProperty("RebootRov")&&(u.RebootRov=$root.rov_actions_proto.RebootRovAction.toObject(a.RebootRov,c),c.oneofs&&(u.Body="RebootRov")),a.EnableWifi!=null&&a.hasOwnProperty("EnableWifi")&&(u.EnableWifi=$root.rov_actions_proto.EnableWifiAction.toObject(a.EnableWifi,c),c.oneofs&&(u.Body="EnableWifi")),a.DisableWifi!=null&&a.hasOwnProperty("DisableWifi")&&(u.DisableWifi=$root.rov_actions_proto.DisableWifiAction.toObject(a.DisableWifi,c),c.oneofs&&(u.Body="DisableWifi")),a.RovStatusReport!=null&&a.hasOwnProperty("RovStatusReport")&&(u.RovStatusReport=$root.rov_actions_proto.RovStatusReportAction.toObject(a.RovStatusReport,c),c.oneofs&&(u.Body="RovStatusReport")),a.RestartRovServices!=null&&a.hasOwnProperty("RestartRovServices")&&(u.RestartRovServices=$root.rov_actions_proto.RestartRovServicesAction.toObject(a.RestartRovServices,c),c.oneofs&&(u.Body="RestartRovServices")),a.RovLogs!=null&&a.hasOwnProperty("RovLogs")&&(u.RovLogs=$root.rov_actions_proto.RovLogsAction.toObject(a.RovLogs,c),c.oneofs&&(u.Body="RovLogs")),a.RefreshAllSensors!=null&&a.hasOwnProperty("RefreshAllSensors")&&(u.RefreshAllSensors=$root.rov_actions_proto.RefreshAllSensorsAction.toObject(a.RefreshAllSensors,c),c.oneofs&&(u.Body="RefreshAllSensors")),a.Mavlink!=null&&a.hasOwnProperty("Mavlink")&&(u.Mavlink=$root.rov_actions_proto.MavlinkAction.toObject(a.Mavlink,c),c.oneofs&&(u.Body="Mavlink")),a.SimplepeerSignal!=null&&a.hasOwnProperty("SimplepeerSignal")&&(u.SimplepeerSignal=$root.rov_actions_proto.SimplepeerSignalAction.toObject(a.SimplepeerSignal,c),c.oneofs&&(u.Body="SimplepeerSignal")),a.Disarm!=null&&a.hasOwnProperty("Disarm")&&(u.Disarm=$root.rov_actions_proto.DisarmAction.toObject(a.Disarm,c),c.oneofs&&(u.Body="Disarm")),a.SetAutopilotMode!=null&&a.hasOwnProperty("SetAutopilotMode")&&(u.SetAutopilotMode=$root.rov_actions_proto.SetAutopilotModeAction.toObject(a.SetAutopilotMode,c),c.oneofs&&(u.Body="SetAutopilotMode")),u},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(a){return a===void 0&&(a="type.googleapis.com"),a+"/rov_actions_proto.RovAction"},e}(),n.DoneResponse=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.Message="",e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),s.Message!=null&&Object.hasOwnProperty.call(s,"Message")&&a.uint32(10).string(s.Message),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.DoneResponse;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.Message=s.string();break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":s.Message!=null&&s.hasOwnProperty("Message")&&!$util.isString(s.Message)?"Message: string expected":null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.DoneResponse)return s;let a=new $root.rov_actions_proto.DoneResponse;return s.Message!=null&&(a.Message=String(s.Message)),a},e.toObject=function(s,a){a||(a={});let c={};return a.defaults&&(c.Message=""),s.Message!=null&&s.hasOwnProperty("Message")&&(c.Message=s.Message),c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.DoneResponse"},e}(),n.ErrorResponse=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.Message="",e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),s.Message!=null&&Object.hasOwnProperty.call(s,"Message")&&a.uint32(10).string(s.Message),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.ErrorResponse;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.Message=s.string();break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":s.Message!=null&&s.hasOwnProperty("Message")&&!$util.isString(s.Message)?"Message: string expected":null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.ErrorResponse)return s;let a=new $root.rov_actions_proto.ErrorResponse;return s.Message!=null&&(a.Message=String(s.Message)),a},e.toObject=function(s,a){a||(a={});let c={};return a.defaults&&(c.Message=""),s.Message!=null&&s.hasOwnProperty("Message")&&(c.Message=s.Message),c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.ErrorResponse"},e}(),n.PongResponse=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.Time=$util.Long?$util.Long.fromBits(0,0,!1):0,e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),s.Time!=null&&Object.hasOwnProperty.call(s,"Time")&&a.uint32(8).int64(s.Time),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.PongResponse;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.Time=s.int64();break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":s.Time!=null&&s.hasOwnProperty("Time")&&!$util.isInteger(s.Time)&&!(s.Time&&$util.isInteger(s.Time.low)&&$util.isInteger(s.Time.high))?"Time: integer|Long expected":null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.PongResponse)return s;let a=new $root.rov_actions_proto.PongResponse;return s.Time!=null&&($util.Long?(a.Time=$util.Long.fromValue(s.Time)).unsigned=!1:typeof s.Time=="string"?a.Time=parseInt(s.Time,10):typeof s.Time=="number"?a.Time=s.Time:typeof s.Time=="object"&&(a.Time=new $util.LongBits(s.Time.low>>>0,s.Time.high>>>0).toNumber())),a},e.toObject=function(s,a){a||(a={});let c={};if(a.defaults)if($util.Long){let u=new $util.Long(0,0,!1);c.Time=a.longs===String?u.toString():a.longs===Number?u.toNumber():u}else c.Time=a.longs===String?"0":0;return s.Time!=null&&s.hasOwnProperty("Time")&&(typeof s.Time=="number"?c.Time=a.longs===String?String(s.Time):s.Time:c.Time=a.longs===String?$util.Long.prototype.toString.call(s.Time):a.longs===Number?new $util.LongBits(s.Time.low>>>0,s.Time.high>>>0).toNumber():s.Time),c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.PongResponse"},e}(),n.SensorUpdatesResponse=function(){function e(t){if(this.MeasurementUpdates=[],t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.MeasurementUpdates=$util.emptyArray,e.create=function(s){return new e(s)},e.encode=function(s,a){if(a||(a=$Writer.create()),s.MeasurementUpdates!=null&&s.MeasurementUpdates.length)for(let c=0;c<s.MeasurementUpdates.length;++c)$root.rov_actions_proto.Measurement.encode(s.MeasurementUpdates[c],a.uint32(10).fork()).ldelim();return a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.SensorUpdatesResponse;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.MeasurementUpdates&&u.MeasurementUpdates.length||(u.MeasurementUpdates=[]),u.MeasurementUpdates.push($root.rov_actions_proto.Measurement.decode(s,s.uint32()));break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){if(typeof s!="object"||s===null)return"object expected";if(s.MeasurementUpdates!=null&&s.hasOwnProperty("MeasurementUpdates")){if(!Array.isArray(s.MeasurementUpdates))return"MeasurementUpdates: array expected";for(let a=0;a<s.MeasurementUpdates.length;++a){let c=$root.rov_actions_proto.Measurement.verify(s.MeasurementUpdates[a]);if(c)return"MeasurementUpdates."+c}}return null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.SensorUpdatesResponse)return s;let a=new $root.rov_actions_proto.SensorUpdatesResponse;if(s.MeasurementUpdates){if(!Array.isArray(s.MeasurementUpdates))throw TypeError(".rov_actions_proto.SensorUpdatesResponse.MeasurementUpdates: array expected");a.MeasurementUpdates=[];for(let c=0;c<s.MeasurementUpdates.length;++c){if(typeof s.MeasurementUpdates[c]!="object")throw TypeError(".rov_actions_proto.SensorUpdatesResponse.MeasurementUpdates: object expected");a.MeasurementUpdates[c]=$root.rov_actions_proto.Measurement.fromObject(s.MeasurementUpdates[c])}}return a},e.toObject=function(s,a){a||(a={});let c={};if((a.arrays||a.defaults)&&(c.MeasurementUpdates=[]),s.MeasurementUpdates&&s.MeasurementUpdates.length){c.MeasurementUpdates=[];for(let u=0;u<s.MeasurementUpdates.length;++u)c.MeasurementUpdates[u]=$root.rov_actions_proto.Measurement.toObject(s.MeasurementUpdates[u],a)}return c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.SensorUpdatesResponse"},e}(),n.PasswordRequiredResponse=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.RovId="",e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),s.RovId!=null&&Object.hasOwnProperty.call(s,"RovId")&&a.uint32(10).string(s.RovId),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.PasswordRequiredResponse;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.RovId=s.string();break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":s.RovId!=null&&s.hasOwnProperty("RovId")&&!$util.isString(s.RovId)?"RovId: string expected":null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.PasswordRequiredResponse)return s;let a=new $root.rov_actions_proto.PasswordRequiredResponse;return s.RovId!=null&&(a.RovId=String(s.RovId)),a},e.toObject=function(s,a){a||(a={});let c={};return a.defaults&&(c.RovId=""),s.RovId!=null&&s.hasOwnProperty("RovId")&&(c.RovId=s.RovId),c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.PasswordRequiredResponse"},e}(),n.PasswordAcceptedResponse=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.AuthToken="",e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),s.AuthToken!=null&&Object.hasOwnProperty.call(s,"AuthToken")&&a.uint32(10).string(s.AuthToken),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.PasswordAcceptedResponse;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.AuthToken=s.string();break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":s.AuthToken!=null&&s.hasOwnProperty("AuthToken")&&!$util.isString(s.AuthToken)?"AuthToken: string expected":null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.PasswordAcceptedResponse)return s;let a=new $root.rov_actions_proto.PasswordAcceptedResponse;return s.AuthToken!=null&&(a.AuthToken=String(s.AuthToken)),a},e.toObject=function(s,a){a||(a={});let c={};return a.defaults&&(c.AuthToken=""),s.AuthToken!=null&&s.hasOwnProperty("AuthToken")&&(c.AuthToken=s.AuthToken),c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.PasswordAcceptedResponse"},e}(),n.PasswordInvalidResponse=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.PasswordInvalidResponse;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":null},e.fromObject=function(s){return s instanceof $root.rov_actions_proto.PasswordInvalidResponse?s:new $root.rov_actions_proto.PasswordInvalidResponse},e.toObject=function(){return{}},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.PasswordInvalidResponse"},e}(),n.DriverChangedResponse=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.DriverPeerId="",e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),s.DriverPeerId!=null&&Object.hasOwnProperty.call(s,"DriverPeerId")&&a.uint32(10).string(s.DriverPeerId),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.DriverChangedResponse;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.DriverPeerId=s.string();break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":s.DriverPeerId!=null&&s.hasOwnProperty("DriverPeerId")&&!$util.isString(s.DriverPeerId)?"DriverPeerId: string expected":null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.DriverChangedResponse)return s;let a=new $root.rov_actions_proto.DriverChangedResponse;return s.DriverPeerId!=null&&(a.DriverPeerId=String(s.DriverPeerId)),a},e.toObject=function(s,a){a||(a={});let c={};return a.defaults&&(c.DriverPeerId=""),s.DriverPeerId!=null&&s.hasOwnProperty("DriverPeerId")&&(c.DriverPeerId=s.DriverPeerId),c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.DriverChangedResponse"},e}(),n.ClientConnectedResponse=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.ClientPeerId="",e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),s.ClientPeerId!=null&&Object.hasOwnProperty.call(s,"ClientPeerId")&&a.uint32(10).string(s.ClientPeerId),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.ClientConnectedResponse;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.ClientPeerId=s.string();break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":s.ClientPeerId!=null&&s.hasOwnProperty("ClientPeerId")&&!$util.isString(s.ClientPeerId)?"ClientPeerId: string expected":null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.ClientConnectedResponse)return s;let a=new $root.rov_actions_proto.ClientConnectedResponse;return s.ClientPeerId!=null&&(a.ClientPeerId=String(s.ClientPeerId)),a},e.toObject=function(s,a){a||(a={});let c={};return a.defaults&&(c.ClientPeerId=""),s.ClientPeerId!=null&&s.hasOwnProperty("ClientPeerId")&&(c.ClientPeerId=s.ClientPeerId),c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.ClientConnectedResponse"},e}(),n.ClientDisconnectedResponse=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.ClientPeerId="",e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),s.ClientPeerId!=null&&Object.hasOwnProperty.call(s,"ClientPeerId")&&a.uint32(10).string(s.ClientPeerId),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.ClientDisconnectedResponse;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.ClientPeerId=s.string();break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":s.ClientPeerId!=null&&s.hasOwnProperty("ClientPeerId")&&!$util.isString(s.ClientPeerId)?"ClientPeerId: string expected":null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.ClientDisconnectedResponse)return s;let a=new $root.rov_actions_proto.ClientDisconnectedResponse;return s.ClientPeerId!=null&&(a.ClientPeerId=String(s.ClientPeerId)),a},e.toObject=function(s,a){a||(a={});let c={};return a.defaults&&(c.ClientPeerId=""),s.ClientPeerId!=null&&s.hasOwnProperty("ClientPeerId")&&(c.ClientPeerId=s.ClientPeerId),c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.ClientDisconnectedResponse"},e}(),n.HeartbeatResponse=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.Time=$util.Long?$util.Long.fromBits(0,0,!1):0,e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),s.Time!=null&&Object.hasOwnProperty.call(s,"Time")&&a.uint32(8).int64(s.Time),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.HeartbeatResponse;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.Time=s.int64();break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":s.Time!=null&&s.hasOwnProperty("Time")&&!$util.isInteger(s.Time)&&!(s.Time&&$util.isInteger(s.Time.low)&&$util.isInteger(s.Time.high))?"Time: integer|Long expected":null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.HeartbeatResponse)return s;let a=new $root.rov_actions_proto.HeartbeatResponse;return s.Time!=null&&($util.Long?(a.Time=$util.Long.fromValue(s.Time)).unsigned=!1:typeof s.Time=="string"?a.Time=parseInt(s.Time,10):typeof s.Time=="number"?a.Time=s.Time:typeof s.Time=="object"&&(a.Time=new $util.LongBits(s.Time.low>>>0,s.Time.high>>>0).toNumber())),a},e.toObject=function(s,a){a||(a={});let c={};if(a.defaults)if($util.Long){let u=new $util.Long(0,0,!1);c.Time=a.longs===String?u.toString():a.longs===Number?u.toNumber():u}else c.Time=a.longs===String?"0":0;return s.Time!=null&&s.hasOwnProperty("Time")&&(typeof s.Time=="number"?c.Time=a.longs===String?String(s.Time):s.Time:c.Time=a.longs===String?$util.Long.prototype.toString.call(s.Time):a.longs===Number?new $util.LongBits(s.Time.low>>>0,s.Time.high>>>0).toNumber():s.Time),c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.HeartbeatResponse"},e}(),n.ContinuedOutputResponse=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.Message="",e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),s.Message!=null&&Object.hasOwnProperty.call(s,"Message")&&a.uint32(10).string(s.Message),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.ContinuedOutputResponse;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.Message=s.string();break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":s.Message!=null&&s.hasOwnProperty("Message")&&!$util.isString(s.Message)?"Message: string expected":null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.ContinuedOutputResponse)return s;let a=new $root.rov_actions_proto.ContinuedOutputResponse;return s.Message!=null&&(a.Message=String(s.Message)),a},e.toObject=function(s,a){a||(a={});let c={};return a.defaults&&(c.Message=""),s.Message!=null&&s.hasOwnProperty("Message")&&(c.Message=s.Message),c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.ContinuedOutputResponse"},e}(),n.MavlinkResponse=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.Message=$util.newBuffer([]),e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),s.Message!=null&&Object.hasOwnProperty.call(s,"Message")&&a.uint32(10).bytes(s.Message),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.MavlinkResponse;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.Message=s.bytes();break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":s.Message!=null&&s.hasOwnProperty("Message")&&!(s.Message&&typeof s.Message.length=="number"||$util.isString(s.Message))?"Message: buffer expected":null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.MavlinkResponse)return s;let a=new $root.rov_actions_proto.MavlinkResponse;return s.Message!=null&&(typeof s.Message=="string"?$util.base64.decode(s.Message,a.Message=$util.newBuffer($util.base64.length(s.Message)),0):s.Message.length>=0&&(a.Message=s.Message)),a},e.toObject=function(s,a){a||(a={});let c={};return a.defaults&&(a.bytes===String?c.Message="":(c.Message=[],a.bytes!==Array&&(c.Message=$util.newBuffer(c.Message)))),s.Message!=null&&s.hasOwnProperty("Message")&&(c.Message=a.bytes===String?$util.base64.encode(s.Message,0,s.Message.length):a.bytes===Array?Array.prototype.slice.call(s.Message):s.Message),c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.MavlinkResponse"},e}(),n.SimplepeerSignalResponse=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.Message="",e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),s.Message!=null&&Object.hasOwnProperty.call(s,"Message")&&a.uint32(10).string(s.Message),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.SimplepeerSignalResponse;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.Message=s.string();break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){return typeof s!="object"||s===null?"object expected":s.Message!=null&&s.hasOwnProperty("Message")&&!$util.isString(s.Message)?"Message: string expected":null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.SimplepeerSignalResponse)return s;let a=new $root.rov_actions_proto.SimplepeerSignalResponse;return s.Message!=null&&(a.Message=String(s.Message)),a},e.toObject=function(s,a){a||(a={});let c={};return a.defaults&&(c.Message=""),s.Message!=null&&s.hasOwnProperty("Message")&&(c.Message=s.Message),c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.SimplepeerSignalResponse"},e}(),n.SystemMonitorResponse=function(){function e(t){if(this.Warnings=[],t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.CpuTemp=0,e.prototype.CpuUsage=0,e.prototype.MemoryUsage=0,e.prototype.DiskUsage=0,e.prototype.Warnings=$util.emptyArray,e.create=function(s){return new e(s)},e.encode=function(s,a){if(a||(a=$Writer.create()),s.CpuTemp!=null&&Object.hasOwnProperty.call(s,"CpuTemp")&&a.uint32(13).float(s.CpuTemp),s.CpuUsage!=null&&Object.hasOwnProperty.call(s,"CpuUsage")&&a.uint32(21).float(s.CpuUsage),s.MemoryUsage!=null&&Object.hasOwnProperty.call(s,"MemoryUsage")&&a.uint32(29).float(s.MemoryUsage),s.DiskUsage!=null&&Object.hasOwnProperty.call(s,"DiskUsage")&&a.uint32(37).float(s.DiskUsage),s.Warnings!=null&&s.Warnings.length)for(let c=0;c<s.Warnings.length;++c)a.uint32(42).string(s.Warnings[c]);return a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.SystemMonitorResponse;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.CpuTemp=s.float();break}case 2:{u.CpuUsage=s.float();break}case 3:{u.MemoryUsage=s.float();break}case 4:{u.DiskUsage=s.float();break}case 5:{u.Warnings&&u.Warnings.length||(u.Warnings=[]),u.Warnings.push(s.string());break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){if(typeof s!="object"||s===null)return"object expected";if(s.CpuTemp!=null&&s.hasOwnProperty("CpuTemp")&&typeof s.CpuTemp!="number")return"CpuTemp: number expected";if(s.CpuUsage!=null&&s.hasOwnProperty("CpuUsage")&&typeof s.CpuUsage!="number")return"CpuUsage: number expected";if(s.MemoryUsage!=null&&s.hasOwnProperty("MemoryUsage")&&typeof s.MemoryUsage!="number")return"MemoryUsage: number expected";if(s.DiskUsage!=null&&s.hasOwnProperty("DiskUsage")&&typeof s.DiskUsage!="number")return"DiskUsage: number expected";if(s.Warnings!=null&&s.hasOwnProperty("Warnings")){if(!Array.isArray(s.Warnings))return"Warnings: array expected";for(let a=0;a<s.Warnings.length;++a)if(!$util.isString(s.Warnings[a]))return"Warnings: string[] expected"}return null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.SystemMonitorResponse)return s;let a=new $root.rov_actions_proto.SystemMonitorResponse;if(s.CpuTemp!=null&&(a.CpuTemp=Number(s.CpuTemp)),s.CpuUsage!=null&&(a.CpuUsage=Number(s.CpuUsage)),s.MemoryUsage!=null&&(a.MemoryUsage=Number(s.MemoryUsage)),s.DiskUsage!=null&&(a.DiskUsage=Number(s.DiskUsage)),s.Warnings){if(!Array.isArray(s.Warnings))throw TypeError(".rov_actions_proto.SystemMonitorResponse.Warnings: array expected");a.Warnings=[];for(let c=0;c<s.Warnings.length;++c)a.Warnings[c]=String(s.Warnings[c])}return a},e.toObject=function(s,a){a||(a={});let c={};if((a.arrays||a.defaults)&&(c.Warnings=[]),a.defaults&&(c.CpuTemp=0,c.CpuUsage=0,c.MemoryUsage=0,c.DiskUsage=0),s.CpuTemp!=null&&s.hasOwnProperty("CpuTemp")&&(c.CpuTemp=a.json&&!isFinite(s.CpuTemp)?String(s.CpuTemp):s.CpuTemp),s.CpuUsage!=null&&s.hasOwnProperty("CpuUsage")&&(c.CpuUsage=a.json&&!isFinite(s.CpuUsage)?String(s.CpuUsage):s.CpuUsage),s.MemoryUsage!=null&&s.hasOwnProperty("MemoryUsage")&&(c.MemoryUsage=a.json&&!isFinite(s.MemoryUsage)?String(s.MemoryUsage):s.MemoryUsage),s.DiskUsage!=null&&s.hasOwnProperty("DiskUsage")&&(c.DiskUsage=a.json&&!isFinite(s.DiskUsage)?String(s.DiskUsage):s.DiskUsage),s.Warnings&&s.Warnings.length){c.Warnings=[];for(let u=0;u<s.Warnings.length;++u)c.Warnings[u]=s.Warnings[u]}return c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.SystemMonitorResponse"},e}(),n.LogMessageResponse=function(){function e(t){if(t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.Message="",e.prototype.Level=0,e.create=function(s){return new e(s)},e.encode=function(s,a){return a||(a=$Writer.create()),s.Message!=null&&Object.hasOwnProperty.call(s,"Message")&&a.uint32(10).string(s.Message),s.Level!=null&&Object.hasOwnProperty.call(s,"Level")&&a.uint32(16).int32(s.Level),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.LogMessageResponse;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.Message=s.string();break}case 2:{u.Level=s.int32();break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){if(typeof s!="object"||s===null)return"object expected";if(s.Message!=null&&s.hasOwnProperty("Message")&&!$util.isString(s.Message))return"Message: string expected";if(s.Level!=null&&s.hasOwnProperty("Level"))switch(s.Level){default:return"Level: enum value expected";case 0:case 1:case 2:case 3:case 4:break}return null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.LogMessageResponse)return s;let a=new $root.rov_actions_proto.LogMessageResponse;switch(s.Message!=null&&(a.Message=String(s.Message)),s.Level){default:if(typeof s.Level=="number"){a.Level=s.Level;break}break;case"Debug":case 0:a.Level=0;break;case"Info":case 1:a.Level=1;break;case"Warning":case 2:a.Level=2;break;case"Error":case 3:a.Level=3;break;case"Critical":case 4:a.Level=4;break}return a},e.toObject=function(s,a){a||(a={});let c={};return a.defaults&&(c.Message="",c.Level=a.enums===String?"Debug":0),s.Message!=null&&s.hasOwnProperty("Message")&&(c.Message=s.Message),s.Level!=null&&s.hasOwnProperty("Level")&&(c.Level=a.enums===String?$root.rov_actions_proto.LogLevel[s.Level]===void 0?s.Level:$root.rov_actions_proto.LogLevel[s.Level]:s.Level),c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.LogMessageResponse"},e}(),n.ResponseBackendMetadata=function(){function e(t){if(this.TargetUserIds=[],t)for(let s=Object.keys(t),a=0;a<s.length;++a)t[s[a]]!=null&&(this[s[a]]=t[s[a]])}return e.prototype.TargetUserIds=$util.emptyArray,e.prototype.TransportMethod=0,e.create=function(s){return new e(s)},e.encode=function(s,a){if(a||(a=$Writer.create()),s.TargetUserIds!=null&&s.TargetUserIds.length)for(let c=0;c<s.TargetUserIds.length;++c)a.uint32(10).string(s.TargetUserIds[c]);return s.TransportMethod!=null&&Object.hasOwnProperty.call(s,"TransportMethod")&&a.uint32(16).int32(s.TransportMethod),a},e.encodeDelimited=function(s,a){return this.encode(s,a).ldelim()},e.decode=function(s,a){s instanceof $Reader||(s=$Reader.create(s));let c=a===void 0?s.len:s.pos+a,u=new $root.rov_actions_proto.ResponseBackendMetadata;for(;s.pos<c;){let d=s.uint32();switch(d>>>3){case 1:{u.TargetUserIds&&u.TargetUserIds.length||(u.TargetUserIds=[]),u.TargetUserIds.push(s.string());break}case 2:{u.TransportMethod=s.int32();break}default:s.skipType(d&7);break}}return u},e.decodeDelimited=function(s){return s instanceof $Reader||(s=new $Reader(s)),this.decode(s,s.uint32())},e.verify=function(s){if(typeof s!="object"||s===null)return"object expected";if(s.TargetUserIds!=null&&s.hasOwnProperty("TargetUserIds")){if(!Array.isArray(s.TargetUserIds))return"TargetUserIds: array expected";for(let a=0;a<s.TargetUserIds.length;++a)if(!$util.isString(s.TargetUserIds[a]))return"TargetUserIds: string[] expected"}if(s.TransportMethod!=null&&s.hasOwnProperty("TransportMethod"))switch(s.TransportMethod){default:return"TransportMethod: enum value expected";case 0:case 1:case 3:break}return null},e.fromObject=function(s){if(s instanceof $root.rov_actions_proto.ResponseBackendMetadata)return s;let a=new $root.rov_actions_proto.ResponseBackendMetadata;if(s.TargetUserIds){if(!Array.isArray(s.TargetUserIds))throw TypeError(".rov_actions_proto.ResponseBackendMetadata.TargetUserIds: array expected");a.TargetUserIds=[];for(let c=0;c<s.TargetUserIds.length;++c)a.TargetUserIds[c]=String(s.TargetUserIds[c])}switch(s.TransportMethod){default:if(typeof s.TransportMethod=="number"){a.TransportMethod=s.TransportMethod;break}break;case"LivekitReliable":case 0:a.TransportMethod=0;break;case"LivekitUnreliable":case 1:a.TransportMethod=1;break;case"DirectUnreliable":case 3:a.TransportMethod=3;break}return a},e.toObject=function(s,a){a||(a={});let c={};if((a.arrays||a.defaults)&&(c.TargetUserIds=[]),a.defaults&&(c.TransportMethod=a.enums===String?"LivekitReliable":0),s.TargetUserIds&&s.TargetUserIds.length){c.TargetUserIds=[];for(let u=0;u<s.TargetUserIds.length;++u)c.TargetUserIds[u]=s.TargetUserIds[u]}return s.TransportMethod!=null&&s.hasOwnProperty("TransportMethod")&&(c.TransportMethod=a.enums===String?$root.rov_actions_proto.DataTransportMethod[s.TransportMethod]===void 0?s.TransportMethod:$root.rov_actions_proto.DataTransportMethod[s.TransportMethod]:s.TransportMethod),c},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/rov_actions_proto.ResponseBackendMetadata"},e}(),n.RovResponse=function(){function e(s){if(s)for(let a=Object.keys(s),c=0;c<a.length;++c)s[a[c]]!=null&&(this[a[c]]=s[a[c]])}e.prototype.BackendMetadata=null,e.prototype.ExchangeId=0,e.prototype.Done=null,e.prototype.Error=null,e.prototype.Pong=null,e.prototype.ContinuedOutput=null,e.prototype.SensorUpdates=null,e.prototype.PasswordRequired=null,e.prototype.PasswordAccepted=null,e.prototype.PasswordInvalid=null,e.prototype.DriverChanged=null,e.prototype.ClientConnected=null,e.prototype.ClientDisconnected=null,e.prototype.Heartbeat=null,e.prototype.Mavlink=null,e.prototype.SimplepeerSignal=null,e.prototype.SystemMonitor=null,e.prototype.LogMessage=null;let t;return Object.defineProperty(e.prototype,"Body",{get:$util.oneOfGetter(t=["Done","Error","Pong","ContinuedOutput","SensorUpdates","PasswordRequired","PasswordAccepted","PasswordInvalid","DriverChanged","ClientConnected","ClientDisconnected","Heartbeat","Mavlink","SimplepeerSignal","SystemMonitor","LogMessage"]),set:$util.oneOfSetter(t)}),e.create=function(a){return new e(a)},e.encode=function(a,c){return c||(c=$Writer.create()),a.BackendMetadata!=null&&Object.hasOwnProperty.call(a,"BackendMetadata")&&$root.rov_actions_proto.ResponseBackendMetadata.encode(a.BackendMetadata,c.uint32(10).fork()).ldelim(),a.ExchangeId!=null&&Object.hasOwnProperty.call(a,"ExchangeId")&&c.uint32(16).int32(a.ExchangeId),a.Done!=null&&Object.hasOwnProperty.call(a,"Done")&&$root.rov_actions_proto.DoneResponse.encode(a.Done,c.uint32(26).fork()).ldelim(),a.Error!=null&&Object.hasOwnProperty.call(a,"Error")&&$root.rov_actions_proto.ErrorResponse.encode(a.Error,c.uint32(34).fork()).ldelim(),a.Pong!=null&&Object.hasOwnProperty.call(a,"Pong")&&$root.rov_actions_proto.PongResponse.encode(a.Pong,c.uint32(42).fork()).ldelim(),a.ContinuedOutput!=null&&Object.hasOwnProperty.call(a,"ContinuedOutput")&&$root.rov_actions_proto.ContinuedOutputResponse.encode(a.ContinuedOutput,c.uint32(50).fork()).ldelim(),a.SensorUpdates!=null&&Object.hasOwnProperty.call(a,"SensorUpdates")&&$root.rov_actions_proto.SensorUpdatesResponse.encode(a.SensorUpdates,c.uint32(58).fork()).ldelim(),a.PasswordRequired!=null&&Object.hasOwnProperty.call(a,"PasswordRequired")&&$root.rov_actions_proto.PasswordRequiredResponse.encode(a.PasswordRequired,c.uint32(66).fork()).ldelim(),a.PasswordAccepted!=null&&Object.hasOwnProperty.call(a,"PasswordAccepted")&&$root.rov_actions_proto.PasswordAcceptedResponse.encode(a.PasswordAccepted,c.uint32(74).fork()).ldelim(),a.PasswordInvalid!=null&&Object.hasOwnProperty.call(a,"PasswordInvalid")&&$root.rov_actions_proto.PasswordInvalidResponse.encode(a.PasswordInvalid,c.uint32(82).fork()).ldelim(),a.DriverChanged!=null&&Object.hasOwnProperty.call(a,"DriverChanged")&&$root.rov_actions_proto.DriverChangedResponse.encode(a.DriverChanged,c.uint32(106).fork()).ldelim(),a.ClientConnected!=null&&Object.hasOwnProperty.call(a,"ClientConnected")&&$root.rov_actions_proto.ClientConnectedResponse.encode(a.ClientConnected,c.uint32(114).fork()).ldelim(),a.ClientDisconnected!=null&&Object.hasOwnProperty.call(a,"ClientDisconnected")&&$root.rov_actions_proto.ClientDisconnectedResponse.encode(a.ClientDisconnected,c.uint32(122).fork()).ldelim(),a.Heartbeat!=null&&Object.hasOwnProperty.call(a,"Heartbeat")&&$root.rov_actions_proto.HeartbeatResponse.encode(a.Heartbeat,c.uint32(130).fork()).ldelim(),a.Mavlink!=null&&Object.hasOwnProperty.call(a,"Mavlink")&&$root.rov_actions_proto.MavlinkResponse.encode(a.Mavlink,c.uint32(138).fork()).ldelim(),a.SimplepeerSignal!=null&&Object.hasOwnProperty.call(a,"SimplepeerSignal")&&$root.rov_actions_proto.SimplepeerSignalResponse.encode(a.SimplepeerSignal,c.uint32(146).fork()).ldelim(),a.SystemMonitor!=null&&Object.hasOwnProperty.call(a,"SystemMonitor")&&$root.rov_actions_proto.SystemMonitorResponse.encode(a.SystemMonitor,c.uint32(154).fork()).ldelim(),a.LogMessage!=null&&Object.hasOwnProperty.call(a,"LogMessage")&&$root.rov_actions_proto.LogMessageResponse.encode(a.LogMessage,c.uint32(162).fork()).ldelim(),c},e.encodeDelimited=function(a,c){return this.encode(a,c).ldelim()},e.decode=function(a,c){a instanceof $Reader||(a=$Reader.create(a));let u=c===void 0?a.len:a.pos+c,d=new $root.rov_actions_proto.RovResponse;for(;a.pos<u;){let m=a.uint32();switch(m>>>3){case 1:{d.BackendMetadata=$root.rov_actions_proto.ResponseBackendMetadata.decode(a,a.uint32());break}case 2:{d.ExchangeId=a.int32();break}case 3:{d.Done=$root.rov_actions_proto.DoneResponse.decode(a,a.uint32());break}case 4:{d.Error=$root.rov_actions_proto.ErrorResponse.decode(a,a.uint32());break}case 5:{d.Pong=$root.rov_actions_proto.PongResponse.decode(a,a.uint32());break}case 6:{d.ContinuedOutput=$root.rov_actions_proto.ContinuedOutputResponse.decode(a,a.uint32());break}case 7:{d.SensorUpdates=$root.rov_actions_proto.SensorUpdatesResponse.decode(a,a.uint32());break}case 8:{d.PasswordRequired=$root.rov_actions_proto.PasswordRequiredResponse.decode(a,a.uint32());break}case 9:{d.PasswordAccepted=$root.rov_actions_proto.PasswordAcceptedResponse.decode(a,a.uint32());break}case 10:{d.PasswordInvalid=$root.rov_actions_proto.PasswordInvalidResponse.decode(a,a.uint32());break}case 13:{d.DriverChanged=$root.rov_actions_proto.DriverChangedResponse.decode(a,a.uint32());break}case 14:{d.ClientConnected=$root.rov_actions_proto.ClientConnectedResponse.decode(a,a.uint32());break}case 15:{d.ClientDisconnected=$root.rov_actions_proto.ClientDisconnectedResponse.decode(a,a.uint32());break}case 16:{d.Heartbeat=$root.rov_actions_proto.HeartbeatResponse.decode(a,a.uint32());break}case 17:{d.Mavlink=$root.rov_actions_proto.MavlinkResponse.decode(a,a.uint32());break}case 18:{d.SimplepeerSignal=$root.rov_actions_proto.SimplepeerSignalResponse.decode(a,a.uint32());break}case 19:{d.SystemMonitor=$root.rov_actions_proto.SystemMonitorResponse.decode(a,a.uint32());break}case 20:{d.LogMessage=$root.rov_actions_proto.LogMessageResponse.decode(a,a.uint32());break}default:a.skipType(m&7);break}}return d},e.decodeDelimited=function(a){return a instanceof $Reader||(a=new $Reader(a)),this.decode(a,a.uint32())},e.verify=function(a){if(typeof a!="object"||a===null)return"object expected";let c={};if(a.BackendMetadata!=null&&a.hasOwnProperty("BackendMetadata")){let u=$root.rov_actions_proto.ResponseBackendMetadata.verify(a.BackendMetadata);if(u)return"BackendMetadata."+u}if(a.ExchangeId!=null&&a.hasOwnProperty("ExchangeId")&&!$util.isInteger(a.ExchangeId))return"ExchangeId: integer expected";if(a.Done!=null&&a.hasOwnProperty("Done")){c.Body=1;{let u=$root.rov_actions_proto.DoneResponse.verify(a.Done);if(u)return"Done."+u}}if(a.Error!=null&&a.hasOwnProperty("Error")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.ErrorResponse.verify(a.Error);if(u)return"Error."+u}}if(a.Pong!=null&&a.hasOwnProperty("Pong")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.PongResponse.verify(a.Pong);if(u)return"Pong."+u}}if(a.ContinuedOutput!=null&&a.hasOwnProperty("ContinuedOutput")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.ContinuedOutputResponse.verify(a.ContinuedOutput);if(u)return"ContinuedOutput."+u}}if(a.SensorUpdates!=null&&a.hasOwnProperty("SensorUpdates")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.SensorUpdatesResponse.verify(a.SensorUpdates);if(u)return"SensorUpdates."+u}}if(a.PasswordRequired!=null&&a.hasOwnProperty("PasswordRequired")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.PasswordRequiredResponse.verify(a.PasswordRequired);if(u)return"PasswordRequired."+u}}if(a.PasswordAccepted!=null&&a.hasOwnProperty("PasswordAccepted")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.PasswordAcceptedResponse.verify(a.PasswordAccepted);if(u)return"PasswordAccepted."+u}}if(a.PasswordInvalid!=null&&a.hasOwnProperty("PasswordInvalid")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.PasswordInvalidResponse.verify(a.PasswordInvalid);if(u)return"PasswordInvalid."+u}}if(a.DriverChanged!=null&&a.hasOwnProperty("DriverChanged")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.DriverChangedResponse.verify(a.DriverChanged);if(u)return"DriverChanged."+u}}if(a.ClientConnected!=null&&a.hasOwnProperty("ClientConnected")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.ClientConnectedResponse.verify(a.ClientConnected);if(u)return"ClientConnected."+u}}if(a.ClientDisconnected!=null&&a.hasOwnProperty("ClientDisconnected")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.ClientDisconnectedResponse.verify(a.ClientDisconnected);if(u)return"ClientDisconnected."+u}}if(a.Heartbeat!=null&&a.hasOwnProperty("Heartbeat")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.HeartbeatResponse.verify(a.Heartbeat);if(u)return"Heartbeat."+u}}if(a.Mavlink!=null&&a.hasOwnProperty("Mavlink")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.MavlinkResponse.verify(a.Mavlink);if(u)return"Mavlink."+u}}if(a.SimplepeerSignal!=null&&a.hasOwnProperty("SimplepeerSignal")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.SimplepeerSignalResponse.verify(a.SimplepeerSignal);if(u)return"SimplepeerSignal."+u}}if(a.SystemMonitor!=null&&a.hasOwnProperty("SystemMonitor")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.SystemMonitorResponse.verify(a.SystemMonitor);if(u)return"SystemMonitor."+u}}if(a.LogMessage!=null&&a.hasOwnProperty("LogMessage")){if(c.Body===1)return"Body: multiple values";c.Body=1;{let u=$root.rov_actions_proto.LogMessageResponse.verify(a.LogMessage);if(u)return"LogMessage."+u}}return null},e.fromObject=function(a){if(a instanceof $root.rov_actions_proto.RovResponse)return a;let c=new $root.rov_actions_proto.RovResponse;if(a.BackendMetadata!=null){if(typeof a.BackendMetadata!="object")throw TypeError(".rov_actions_proto.RovResponse.BackendMetadata: object expected");c.BackendMetadata=$root.rov_actions_proto.ResponseBackendMetadata.fromObject(a.BackendMetadata)}if(a.ExchangeId!=null&&(c.ExchangeId=a.ExchangeId|0),a.Done!=null){if(typeof a.Done!="object")throw TypeError(".rov_actions_proto.RovResponse.Done: object expected");c.Done=$root.rov_actions_proto.DoneResponse.fromObject(a.Done)}if(a.Error!=null){if(typeof a.Error!="object")throw TypeError(".rov_actions_proto.RovResponse.Error: object expected");c.Error=$root.rov_actions_proto.ErrorResponse.fromObject(a.Error)}if(a.Pong!=null){if(typeof a.Pong!="object")throw TypeError(".rov_actions_proto.RovResponse.Pong: object expected");c.Pong=$root.rov_actions_proto.PongResponse.fromObject(a.Pong)}if(a.ContinuedOutput!=null){if(typeof a.ContinuedOutput!="object")throw TypeError(".rov_actions_proto.RovResponse.ContinuedOutput: object expected");c.ContinuedOutput=$root.rov_actions_proto.ContinuedOutputResponse.fromObject(a.ContinuedOutput)}if(a.SensorUpdates!=null){if(typeof a.SensorUpdates!="object")throw TypeError(".rov_actions_proto.RovResponse.SensorUpdates: object expected");c.SensorUpdates=$root.rov_actions_proto.SensorUpdatesResponse.fromObject(a.SensorUpdates)}if(a.PasswordRequired!=null){if(typeof a.PasswordRequired!="object")throw TypeError(".rov_actions_proto.RovResponse.PasswordRequired: object expected");c.PasswordRequired=$root.rov_actions_proto.PasswordRequiredResponse.fromObject(a.PasswordRequired)}if(a.PasswordAccepted!=null){if(typeof a.PasswordAccepted!="object")throw TypeError(".rov_actions_proto.RovResponse.PasswordAccepted: object expected");c.PasswordAccepted=$root.rov_actions_proto.PasswordAcceptedResponse.fromObject(a.PasswordAccepted)}if(a.PasswordInvalid!=null){if(typeof a.PasswordInvalid!="object")throw TypeError(".rov_actions_proto.RovResponse.PasswordInvalid: object expected");c.PasswordInvalid=$root.rov_actions_proto.PasswordInvalidResponse.fromObject(a.PasswordInvalid)}if(a.DriverChanged!=null){if(typeof a.DriverChanged!="object")throw TypeError(".rov_actions_proto.RovResponse.DriverChanged: object expected");c.DriverChanged=$root.rov_actions_proto.DriverChangedResponse.fromObject(a.DriverChanged)}if(a.ClientConnected!=null){if(typeof a.ClientConnected!="object")throw TypeError(".rov_actions_proto.RovResponse.ClientConnected: object expected");c.ClientConnected=$root.rov_actions_proto.ClientConnectedResponse.fromObject(a.ClientConnected)}if(a.ClientDisconnected!=null){if(typeof a.ClientDisconnected!="object")throw TypeError(".rov_actions_proto.RovResponse.ClientDisconnected: object expected");c.ClientDisconnected=$root.rov_actions_proto.ClientDisconnectedResponse.fromObject(a.ClientDisconnected)}if(a.Heartbeat!=null){if(typeof a.Heartbeat!="object")throw TypeError(".rov_actions_proto.RovResponse.Heartbeat: object expected");c.Heartbeat=$root.rov_actions_proto.HeartbeatResponse.fromObject(a.Heartbeat)}if(a.Mavlink!=null){if(typeof a.Mavlink!="object")throw TypeError(".rov_actions_proto.RovResponse.Mavlink: object expected");c.Mavlink=$root.rov_actions_proto.MavlinkResponse.fromObject(a.Mavlink)}if(a.SimplepeerSignal!=null){if(typeof a.SimplepeerSignal!="object")throw TypeError(".rov_actions_proto.RovResponse.SimplepeerSignal: object expected");c.SimplepeerSignal=$root.rov_actions_proto.SimplepeerSignalResponse.fromObject(a.SimplepeerSignal)}if(a.SystemMonitor!=null){if(typeof a.SystemMonitor!="object")throw TypeError(".rov_actions_proto.RovResponse.SystemMonitor: object expected");c.SystemMonitor=$root.rov_actions_proto.SystemMonitorResponse.fromObject(a.SystemMonitor)}if(a.LogMessage!=null){if(typeof a.LogMessage!="object")throw TypeError(".rov_actions_proto.RovResponse.LogMessage: object expected");c.LogMessage=$root.rov_actions_proto.LogMessageResponse.fromObject(a.LogMessage)}return c},e.toObject=function(a,c){c||(c={});let u={};return c.defaults&&(u.BackendMetadata=null,u.ExchangeId=0),a.BackendMetadata!=null&&a.hasOwnProperty("BackendMetadata")&&(u.BackendMetadata=$root.rov_actions_proto.ResponseBackendMetadata.toObject(a.BackendMetadata,c)),a.ExchangeId!=null&&a.hasOwnProperty("ExchangeId")&&(u.ExchangeId=a.ExchangeId),a.Done!=null&&a.hasOwnProperty("Done")&&(u.Done=$root.rov_actions_proto.DoneResponse.toObject(a.Done,c),c.oneofs&&(u.Body="Done")),a.Error!=null&&a.hasOwnProperty("Error")&&(u.Error=$root.rov_actions_proto.ErrorResponse.toObject(a.Error,c),c.oneofs&&(u.Body="Error")),a.Pong!=null&&a.hasOwnProperty("Pong")&&(u.Pong=$root.rov_actions_proto.PongResponse.toObject(a.Pong,c),c.oneofs&&(u.Body="Pong")),a.ContinuedOutput!=null&&a.hasOwnProperty("ContinuedOutput")&&(u.ContinuedOutput=$root.rov_actions_proto.ContinuedOutputResponse.toObject(a.ContinuedOutput,c),c.oneofs&&(u.Body="ContinuedOutput")),a.SensorUpdates!=null&&a.hasOwnProperty("SensorUpdates")&&(u.SensorUpdates=$root.rov_actions_proto.SensorUpdatesResponse.toObject(a.SensorUpdates,c),c.oneofs&&(u.Body="SensorUpdates")),a.PasswordRequired!=null&&a.hasOwnProperty("PasswordRequired")&&(u.PasswordRequired=$root.rov_actions_proto.PasswordRequiredResponse.toObject(a.PasswordRequired,c),c.oneofs&&(u.Body="PasswordRequired")),a.PasswordAccepted!=null&&a.hasOwnProperty("PasswordAccepted")&&(u.PasswordAccepted=$root.rov_actions_proto.PasswordAcceptedResponse.toObject(a.PasswordAccepted,c),c.oneofs&&(u.Body="PasswordAccepted")),a.PasswordInvalid!=null&&a.hasOwnProperty("PasswordInvalid")&&(u.PasswordInvalid=$root.rov_actions_proto.PasswordInvalidResponse.toObject(a.PasswordInvalid,c),c.oneofs&&(u.Body="PasswordInvalid")),a.DriverChanged!=null&&a.hasOwnProperty("DriverChanged")&&(u.DriverChanged=$root.rov_actions_proto.DriverChangedResponse.toObject(a.DriverChanged,c),c.oneofs&&(u.Body="DriverChanged")),a.ClientConnected!=null&&a.hasOwnProperty("ClientConnected")&&(u.ClientConnected=$root.rov_actions_proto.ClientConnectedResponse.toObject(a.ClientConnected,c),c.oneofs&&(u.Body="ClientConnected")),a.ClientDisconnected!=null&&a.hasOwnProperty("ClientDisconnected")&&(u.ClientDisconnected=$root.rov_actions_proto.ClientDisconnectedResponse.toObject(a.ClientDisconnected,c),c.oneofs&&(u.Body="ClientDisconnected")),a.Heartbeat!=null&&a.hasOwnProperty("Heartbeat")&&(u.Heartbeat=$root.rov_actions_proto.HeartbeatResponse.toObject(a.Heartbeat,c),c.oneofs&&(u.Body="Heartbeat")),a.Mavlink!=null&&a.hasOwnProperty("Mavlink")&&(u.Mavlink=$root.rov_actions_proto.MavlinkResponse.toObject(a.Mavlink,c),c.oneofs&&(u.Body="Mavlink")),a.SimplepeerSignal!=null&&a.hasOwnProperty("SimplepeerSignal")&&(u.SimplepeerSignal=$root.rov_actions_proto.SimplepeerSignalResponse.toObject(a.SimplepeerSignal,c),c.oneofs&&(u.Body="SimplepeerSignal")),a.SystemMonitor!=null&&a.hasOwnProperty("SystemMonitor")&&(u.SystemMonitor=$root.rov_actions_proto.SystemMonitorResponse.toObject(a.SystemMonitor,c),c.oneofs&&(u.Body="SystemMonitor")),a.LogMessage!=null&&a.hasOwnProperty("LogMessage")&&(u.LogMessage=$root.rov_actions_proto.LogMessageResponse.toObject(a.LogMessage,c),c.oneofs&&(u.Body="LogMessage")),u},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.getTypeUrl=function(a){return a===void 0&&(a="type.googleapis.com"),a+"/rov_actions_proto.RovResponse"},e}(),n})();var browser$2={exports:{}},ms,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms;hasRequiredMs=1;var n=1e3,e=n*60,t=e*60,s=t*24,a=s*7,c=s*365.25;ms=function(b,S){S=S||{};var C=typeof b;if(C==="string"&&b.length>0)return u(b);if(C==="number"&&isFinite(b))return S.long?m(b):d(b);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(b))};function u(b){if(b=String(b),!(b.length>100)){var S=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(b);if(S){var C=parseFloat(S[1]),w=(S[2]||"ms").toLowerCase();switch(w){case"years":case"year":case"yrs":case"yr":case"y":return C*c;case"weeks":case"week":case"w":return C*a;case"days":case"day":case"d":return C*s;case"hours":case"hour":case"hrs":case"hr":case"h":return C*t;case"minutes":case"minute":case"mins":case"min":case"m":return C*e;case"seconds":case"second":case"secs":case"sec":case"s":return C*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return C;default:return}}}}function d(b){var S=Math.abs(b);return S>=s?Math.round(b/s)+"d":S>=t?Math.round(b/t)+"h":S>=e?Math.round(b/e)+"m":S>=n?Math.round(b/n)+"s":b+"ms"}function m(b){var S=Math.abs(b);return S>=s?_(b,S,s,"day"):S>=t?_(b,S,t,"hour"):S>=e?_(b,S,e,"minute"):S>=n?_(b,S,n,"second"):b+" ms"}function _(b,S,C,w){var O=S>=C*1.5;return Math.round(b/C)+" "+w+(O?"s":"")}return ms}function setup(n){t.debug=t,t.default=t,t.coerce=m,t.disable=c,t.enable=a,t.enabled=u,t.humanize=requireMs(),t.destroy=_,Object.keys(n).forEach(b=>{t[b]=n[b]}),t.names=[],t.skips=[],t.formatters={};function e(b){let S=0;for(let C=0;C<b.length;C++)S=(S<<5)-S+b.charCodeAt(C),S|=0;return t.colors[Math.abs(S)%t.colors.length]}t.selectColor=e;function t(b){let S,C=null,w,O;function I(...N){if(!I.enabled)return;const P=I,B=Number(new Date),x=B-(S||B);P.diff=x,P.prev=S,P.curr=B,S=B,N[0]=t.coerce(N[0]),typeof N[0]!="string"&&N.unshift("%O");let F=0;N[0]=N[0].replace(/%([a-zA-Z%])/g,(J,z)=>{if(J==="%%")return"%";F++;const H=t.formatters[z];if(typeof H=="function"){const W=N[F];J=H.call(P,W),N.splice(F,1),F--}return J}),t.formatArgs.call(P,N),(P.log||t.log).apply(P,N)}return I.namespace=b,I.useColors=t.useColors(),I.color=t.selectColor(b),I.extend=s,I.destroy=t.destroy,Object.defineProperty(I,"enabled",{enumerable:!0,configurable:!1,get:()=>C!==null?C:(w!==t.namespaces&&(w=t.namespaces,O=t.enabled(b)),O),set:N=>{C=N}}),typeof t.init=="function"&&t.init(I),I}function s(b,S){const C=t(this.namespace+(typeof S>"u"?":":S)+b);return C.log=this.log,C}function a(b){t.save(b),t.namespaces=b,t.names=[],t.skips=[];let S;const C=(typeof b=="string"?b:"").split(/[\s,]+/),w=C.length;for(S=0;S<w;S++)C[S]&&(b=C[S].replace(/\*/g,".*?"),b[0]==="-"?t.skips.push(new RegExp("^"+b.slice(1)+"$")):t.names.push(new RegExp("^"+b+"$")))}function c(){const b=[...t.names.map(d),...t.skips.map(d).map(S=>"-"+S)].join(",");return t.enable(""),b}function u(b){if(b[b.length-1]==="*")return!0;let S,C;for(S=0,C=t.skips.length;S<C;S++)if(t.skips[S].test(b))return!1;for(S=0,C=t.names.length;S<C;S++)if(t.names[S].test(b))return!0;return!1}function d(b){return b.toString().substring(2,b.toString().length-2).replace(/\.\*\?$/,"*")}function m(b){return b instanceof Error?b.stack||b.message:b}function _(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var common=setup;(function(n,e){e.formatArgs=s,e.save=a,e.load=c,e.useColors=t,e.storage=u(),e.destroy=(()=>{let m=!1;return()=>{m||(m=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(m){if(m[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+m[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const _="color: "+this.color;m.splice(1,0,_,"color: inherit");let b=0,S=0;m[0].replace(/%[a-zA-Z%]/g,C=>{C!=="%%"&&(b++,C==="%c"&&(S=b))}),m.splice(S,0,_)}e.log=console.debug||console.log||(()=>{});function a(m){try{m?e.storage.setItem("debug",m):e.storage.removeItem("debug")}catch{}}function c(){let m;try{m=e.storage.getItem("debug")}catch{}return!m&&typeof dist.process<"u"&&"env"in dist.process&&(m={}.DEBUG),m}function u(){try{return localStorage}catch{}}n.exports=common(e);const{formatters:d}=n.exports;d.j=function(m){try{return JSON.stringify(m)}catch(_){return"[UnexpectedJSONParseError]: "+_.message}}})(browser$2,browser$2.exports);var browserExports$1=browser$2.exports,getBrowserRtc=function n(){if(typeof globalThis>"u")return null;var e={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null},browser$1={exports:{}},safeBuffer={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(n,e){var t=buffer,s=t.Buffer;function a(u,d){for(var m in u)d[m]=u[m]}s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?n.exports=t:(a(t,e),e.Buffer=c);function c(u,d,m){return s(u,d,m)}c.prototype=Object.create(s.prototype),a(s,c),c.from=function(u,d,m){if(typeof u=="number")throw new TypeError("Argument must not be a number");return s(u,d,m)},c.alloc=function(u,d,m){if(typeof u!="number")throw new TypeError("Argument must be a number");var _=s(u);return d!==void 0?typeof m=="string"?_.fill(d,m):_.fill(d):_.fill(0),_},c.allocUnsafe=function(u){if(typeof u!="number")throw new TypeError("Argument must be a number");return s(u)},c.allocUnsafeSlow=function(u){if(typeof u!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(u)}})(safeBuffer,safeBuffer.exports);var safeBufferExports=safeBuffer.exports,MAX_BYTES=65536,MAX_UINT32=4294967295;function oldBrowser(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}var Buffer$1=safeBufferExports.Buffer,crypto=commonjsGlobal$1.crypto||commonjsGlobal$1.msCrypto;crypto&&crypto.getRandomValues?browser$1.exports=randomBytes:browser$1.exports=oldBrowser;function randomBytes(n,e){if(n>MAX_UINT32)throw new RangeError("requested too many random bytes");var t=Buffer$1.allocUnsafe(n);if(n>0)if(n>MAX_BYTES)for(var s=0;s<n;s+=MAX_BYTES)crypto.getRandomValues(t.slice(s,s+MAX_BYTES));else crypto.getRandomValues(t);return typeof e=="function"?dist.process.nextTick(function(){e(null,t)}):t}var browserExports=browser$1.exports,readableBrowser={exports:{}},events={exports:{}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function n(e,t,s){return Function.prototype.apply.call(e,t,s)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:ReflectOwnKeys=function(e){return Object.getOwnPropertyNames(e)};function ProcessEmitWarning(n){console&&console.warn&&console.warn(n)}var NumberIsNaN=Number.isNaN||function n(e){return e!==e};function EventEmitter(){EventEmitter.init.call(this)}events.exports=EventEmitter;events.exports.once=once$2;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=void 0;EventEmitter.prototype._eventsCount=0;EventEmitter.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(n){if(typeof n!="number"||n<0||NumberIsNaN(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");defaultMaxListeners=n}});EventEmitter.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter.prototype.setMaxListeners=function n(e){if(typeof e!="number"||e<0||NumberIsNaN(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function _getMaxListeners(n){return n._maxListeners===void 0?EventEmitter.defaultMaxListeners:n._maxListeners}EventEmitter.prototype.getMaxListeners=function n(){return _getMaxListeners(this)};EventEmitter.prototype.emit=function n(e){for(var t=[],s=1;s<arguments.length;s++)t.push(arguments[s]);var a=e==="error",c=this._events;if(c!==void 0)a=a&&c.error===void 0;else if(!a)return!1;if(a){var u;if(t.length>0&&(u=t[0]),u instanceof Error)throw u;var d=new Error("Unhandled error."+(u?" ("+u.message+")":""));throw d.context=u,d}var m=c[e];if(m===void 0)return!1;if(typeof m=="function")ReflectApply(m,this,t);else for(var _=m.length,b=arrayClone(m,_),s=0;s<_;++s)ReflectApply(b[s],this,t);return!0};function _addListener(n,e,t,s){var a,c,u;if(checkListener(t),c=n._events,c===void 0?(c=n._events=Object.create(null),n._eventsCount=0):(c.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),c=n._events),u=c[e]),u===void 0)u=c[e]=t,++n._eventsCount;else if(typeof u=="function"?u=c[e]=s?[t,u]:[u,t]:s?u.unshift(t):u.push(t),a=_getMaxListeners(n),a>0&&u.length>a&&!u.warned){u.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=n,d.type=e,d.count=u.length,ProcessEmitWarning(d)}return n}EventEmitter.prototype.addListener=function n(e,t){return _addListener(this,e,t,!1)};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.prependListener=function n(e,t){return _addListener(this,e,t,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(n,e,t){var s={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},a=onceWrapper.bind(s);return a.listener=t,s.wrapFn=a,a}EventEmitter.prototype.once=function n(e,t){return checkListener(t),this.on(e,_onceWrap(this,e,t)),this};EventEmitter.prototype.prependOnceListener=function n(e,t){return checkListener(t),this.prependListener(e,_onceWrap(this,e,t)),this};EventEmitter.prototype.removeListener=function n(e,t){var s,a,c,u,d;if(checkListener(t),a=this._events,a===void 0)return this;if(s=a[e],s===void 0)return this;if(s===t||s.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete a[e],a.removeListener&&this.emit("removeListener",e,s.listener||t));else if(typeof s!="function"){for(c=-1,u=s.length-1;u>=0;u--)if(s[u]===t||s[u].listener===t){d=s[u].listener,c=u;break}if(c<0)return this;c===0?s.shift():spliceOne(s,c),s.length===1&&(a[e]=s[0]),a.removeListener!==void 0&&this.emit("removeListener",e,d||t)}return this};EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.removeAllListeners=function n(e){var t,s,a;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[e]),this;if(arguments.length===0){var c=Object.keys(s),u;for(a=0;a<c.length;++a)u=c[a],u!=="removeListener"&&this.removeAllListeners(u);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=s[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(a=t.length-1;a>=0;a--)this.removeListener(e,t[a]);return this};function _listeners(n,e,t){var s=n._events;if(s===void 0)return[];var a=s[e];return a===void 0?[]:typeof a=="function"?t?[a.listener||a]:[a]:t?unwrapListeners(a):arrayClone(a,a.length)}EventEmitter.prototype.listeners=function n(e){return _listeners(this,e,!0)};EventEmitter.prototype.rawListeners=function n(e){return _listeners(this,e,!1)};EventEmitter.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):listenerCount.call(n,e)};EventEmitter.prototype.listenerCount=listenerCount;function listenerCount(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}EventEmitter.prototype.eventNames=function n(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(n,e){for(var t=new Array(e),s=0;s<e;++s)t[s]=n[s];return t}function spliceOne(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function unwrapListeners(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function once$2(n,e){return new Promise(function(t,s){function a(u){n.removeListener(e,c),s(u)}function c(){typeof n.removeListener=="function"&&n.removeListener("error",a),t([].slice.call(arguments))}eventTargetAgnosticAddListener(n,e,c,{once:!0}),e!=="error"&&addErrorHandlerIfEventEmitter(n,a,{once:!0})})}function addErrorHandlerIfEventEmitter(n,e,t){typeof n.on=="function"&&eventTargetAgnosticAddListener(n,"error",e,t)}function eventTargetAgnosticAddListener(n,e,t,s){if(typeof n.on=="function")s.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function a(c){s.once&&n.removeEventListener(e,a),t(c)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var eventsExports=events.exports,streamBrowser=eventsExports.EventEmitter,util={},types={},shams$1=function n(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),s=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(s)!=="[object Symbol]")return!1;var a=42;e[t]=a;for(t in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var c=Object.getOwnPropertySymbols(e);if(c.length!==1||c[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var u=Object.getOwnPropertyDescriptor(e,t);if(u.value!==a||u.enumerable!==!0)return!1}return!0},hasSymbols$2=shams$1,shams=function n(){return hasSymbols$2()&&!!Symbol.toStringTag},origSymbol=typeof Symbol<"u"&&Symbol,hasSymbolSham=shams$1,hasSymbols$1=function n(){return typeof origSymbol!="function"||typeof Symbol!="function"||typeof origSymbol("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:hasSymbolSham()},test={foo:{}},$Object=Object,hasProto$1=function n(){return{__proto__:test}.foo===test.foo&&!({__proto__:null}instanceof $Object)},ERROR_MESSAGE="Function.prototype.bind called on incompatible ",toStr$3=Object.prototype.toString,max$1=Math.max,funcType="[object Function]",concatty=function n(e,t){for(var s=[],a=0;a<e.length;a+=1)s[a]=e[a];for(var c=0;c<t.length;c+=1)s[c+e.length]=t[c];return s},slicy=function n(e,t){for(var s=[],a=t||0,c=0;a<e.length;a+=1,c+=1)s[c]=e[a];return s},joiny=function(n,e){for(var t="",s=0;s<n.length;s+=1)t+=n[s],s+1<n.length&&(t+=e);return t},implementation$1=function n(e){var t=this;if(typeof t!="function"||toStr$3.apply(t)!==funcType)throw new TypeError(ERROR_MESSAGE+t);for(var s=slicy(arguments,1),a,c=function(){if(this instanceof a){var b=t.apply(this,concatty(s,arguments));return Object(b)===b?b:this}return t.apply(e,concatty(s,arguments))},u=max$1(0,t.length-s.length),d=[],m=0;m<u;m++)d[m]="$"+m;if(a=Function("binder","return function ("+joiny(d,",")+"){ return binder.apply(this,arguments); }")(c),t.prototype){var _=function(){};_.prototype=t.prototype,a.prototype=new _,_.prototype=null}return a},implementation=implementation$1,functionBind=Function.prototype.bind||implementation,call$1=Function.prototype.call,$hasOwn=Object.prototype.hasOwnProperty,bind$1=functionBind,hasown=bind$1.call(call$1,$hasOwn),undefined$1,$SyntaxError$1=SyntaxError,$Function=Function,$TypeError$2=TypeError,getEvalledConstructor=function(n){try{return $Function('"use strict"; return ('+n+").constructor;")()}catch{}},$gOPD$1=Object.getOwnPropertyDescriptor;if($gOPD$1)try{$gOPD$1({},"")}catch{$gOPD$1=null}var throwTypeError=function(){throw new $TypeError$2},ThrowTypeError=$gOPD$1?function(){try{return arguments.callee,throwTypeError}catch{try{return $gOPD$1(arguments,"callee").get}catch{return throwTypeError}}}():throwTypeError,hasSymbols=hasSymbols$1(),hasProto=hasProto$1(),getProto$1=Object.getPrototypeOf||(hasProto?function(n){return n.__proto__}:null),needsEval={},TypedArray=typeof Uint8Array>"u"||!getProto$1?undefined$1:getProto$1(Uint8Array),INTRINSICS={"%AggregateError%":typeof AggregateError>"u"?undefined$1:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?undefined$1:ArrayBuffer,"%ArrayIteratorPrototype%":hasSymbols&&getProto$1?getProto$1([][Symbol.iterator]()):undefined$1,"%AsyncFromSyncIteratorPrototype%":undefined$1,"%AsyncFunction%":needsEval,"%AsyncGenerator%":needsEval,"%AsyncGeneratorFunction%":needsEval,"%AsyncIteratorPrototype%":needsEval,"%Atomics%":typeof Atomics>"u"?undefined$1:Atomics,"%BigInt%":typeof BigInt>"u"?undefined$1:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?undefined$1:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?undefined$1:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?undefined$1:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?undefined$1:Float32Array,"%Float64Array%":typeof Float64Array>"u"?undefined$1:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?undefined$1:FinalizationRegistry,"%Function%":$Function,"%GeneratorFunction%":needsEval,"%Int8Array%":typeof Int8Array>"u"?undefined$1:Int8Array,"%Int16Array%":typeof Int16Array>"u"?undefined$1:Int16Array,"%Int32Array%":typeof Int32Array>"u"?undefined$1:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":hasSymbols&&getProto$1?getProto$1(getProto$1([][Symbol.iterator]())):undefined$1,"%JSON%":typeof JSON=="object"?JSON:undefined$1,"%Map%":typeof Map>"u"?undefined$1:Map,"%MapIteratorPrototype%":typeof Map>"u"||!hasSymbols||!getProto$1?undefined$1:getProto$1(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?undefined$1:Promise,"%Proxy%":typeof Proxy>"u"?undefined$1:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?undefined$1:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?undefined$1:Set,"%SetIteratorPrototype%":typeof Set>"u"||!hasSymbols||!getProto$1?undefined$1:getProto$1(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?undefined$1:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":hasSymbols&&getProto$1?getProto$1(""[Symbol.iterator]()):undefined$1,"%Symbol%":hasSymbols?Symbol:undefined$1,"%SyntaxError%":$SyntaxError$1,"%ThrowTypeError%":ThrowTypeError,"%TypedArray%":TypedArray,"%TypeError%":$TypeError$2,"%Uint8Array%":typeof Uint8Array>"u"?undefined$1:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?undefined$1:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?undefined$1:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?undefined$1:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?undefined$1:WeakMap,"%WeakRef%":typeof WeakRef>"u"?undefined$1:WeakRef,"%WeakSet%":typeof WeakSet>"u"?undefined$1:WeakSet};if(getProto$1)try{null.error}catch(n){var errorProto=getProto$1(getProto$1(n));INTRINSICS["%Error.prototype%"]=errorProto}var doEval=function n(e){var t;if(e==="%AsyncFunction%")t=getEvalledConstructor("async function () {}");else if(e==="%GeneratorFunction%")t=getEvalledConstructor("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=getEvalledConstructor("async function* () {}");else if(e==="%AsyncGenerator%"){var s=n("%AsyncGeneratorFunction%");s&&(t=s.prototype)}else if(e==="%AsyncIteratorPrototype%"){var a=n("%AsyncGenerator%");a&&getProto$1&&(t=getProto$1(a.prototype))}return INTRINSICS[e]=t,t},LEGACY_ALIASES={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},bind=functionBind,hasOwn=hasown,$concat=bind.call(Function.call,Array.prototype.concat),$spliceApply=bind.call(Function.apply,Array.prototype.splice),$replace=bind.call(Function.call,String.prototype.replace),$strSlice=bind.call(Function.call,String.prototype.slice),$exec=bind.call(Function.call,RegExp.prototype.exec),rePropName=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,reEscapeChar=/\\(\\)?/g,stringToPath=function n(e){var t=$strSlice(e,0,1),s=$strSlice(e,-1);if(t==="%"&&s!=="%")throw new $SyntaxError$1("invalid intrinsic syntax, expected closing `%`");if(s==="%"&&t!=="%")throw new $SyntaxError$1("invalid intrinsic syntax, expected opening `%`");var a=[];return $replace(e,rePropName,function(c,u,d,m){a[a.length]=d?$replace(m,reEscapeChar,"$1"):u||c}),a},getBaseIntrinsic=function n(e,t){var s=e,a;if(hasOwn(LEGACY_ALIASES,s)&&(a=LEGACY_ALIASES[s],s="%"+a[0]+"%"),hasOwn(INTRINSICS,s)){var c=INTRINSICS[s];if(c===needsEval&&(c=doEval(s)),typeof c>"u"&&!t)throw new $TypeError$2("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:a,name:s,value:c}}throw new $SyntaxError$1("intrinsic "+e+" does not exist!")},getIntrinsic=function n(e,t){if(typeof e!="string"||e.length===0)throw new $TypeError$2("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new $TypeError$2('"allowMissing" argument must be a boolean');if($exec(/^%?[^%]*%?$/,e)===null)throw new $SyntaxError$1("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var s=stringToPath(e),a=s.length>0?s[0]:"",c=getBaseIntrinsic("%"+a+"%",t),u=c.name,d=c.value,m=!1,_=c.alias;_&&(a=_[0],$spliceApply(s,$concat([0,1],_)));for(var b=1,S=!0;b<s.length;b+=1){var C=s[b],w=$strSlice(C,0,1),O=$strSlice(C,-1);if((w==='"'||w==="'"||w==="`"||O==='"'||O==="'"||O==="`")&&w!==O)throw new $SyntaxError$1("property names with quotes must have matching quotes");if((C==="constructor"||!S)&&(m=!0),a+="."+C,u="%"+a+"%",hasOwn(INTRINSICS,u))d=INTRINSICS[u];else if(d!=null){if(!(C in d)){if(!t)throw new $TypeError$2("base intrinsic for "+e+" exists, but the property is not available.");return}if($gOPD$1&&b+1>=s.length){var I=$gOPD$1(d,C);S=!!I,S&&"get"in I&&!("originalValue"in I.get)?d=I.get:d=d[C]}else S=hasOwn(d,C),d=d[C];S&&!m&&(INTRINSICS[u]=d)}}return d},callBind$2={exports:{}},GetIntrinsic$4=getIntrinsic,$defineProperty$1=GetIntrinsic$4("%Object.defineProperty%",!0),hasPropertyDescriptors$1=function n(){if($defineProperty$1)try{return $defineProperty$1({},"a",{value:1}),!0}catch{return!1}return!1};hasPropertyDescriptors$1.hasArrayLengthDefineBug=function n(){if(!hasPropertyDescriptors$1())return null;try{return $defineProperty$1([],"length",{value:1}).length!==1}catch{return!0}};var hasPropertyDescriptors_1=hasPropertyDescriptors$1,GetIntrinsic$3=getIntrinsic,$gOPD=GetIntrinsic$3("%Object.getOwnPropertyDescriptor%",!0);if($gOPD)try{$gOPD([],"length")}catch{$gOPD=null}var gopd$1=$gOPD,hasPropertyDescriptors=hasPropertyDescriptors_1(),GetIntrinsic$2=getIntrinsic,$defineProperty=hasPropertyDescriptors&&GetIntrinsic$2("%Object.defineProperty%",!0);if($defineProperty)try{$defineProperty({},"a",{value:1})}catch{$defineProperty=!1}var $SyntaxError=GetIntrinsic$2("%SyntaxError%"),$TypeError$1=GetIntrinsic$2("%TypeError%"),gopd=gopd$1,defineDataProperty=function n(e,t,s){if(!e||typeof e!="object"&&typeof e!="function")throw new $TypeError$1("`obj` must be an object or a function`");if(typeof t!="string"&&typeof t!="symbol")throw new $TypeError$1("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new $TypeError$1("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new $TypeError$1("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new $TypeError$1("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new $TypeError$1("`loose`, if provided, must be a boolean");var a=arguments.length>3?arguments[3]:null,c=arguments.length>4?arguments[4]:null,u=arguments.length>5?arguments[5]:null,d=arguments.length>6?arguments[6]:!1,m=!!gopd&&gopd(e,t);if($defineProperty)$defineProperty(e,t,{configurable:u===null&&m?m.configurable:!u,enumerable:a===null&&m?m.enumerable:!a,value:s,writable:c===null&&m?m.writable:!c});else if(d||!a&&!c&&!u)e[t]=s;else throw new $SyntaxError("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},GetIntrinsic$1=getIntrinsic,define=defineDataProperty,hasDescriptors=hasPropertyDescriptors_1(),gOPD$1=gopd$1,$TypeError=GetIntrinsic$1("%TypeError%"),$floor=GetIntrinsic$1("%Math.floor%"),setFunctionLength=function n(e,t){if(typeof e!="function")throw new $TypeError("`fn` is not a function");if(typeof t!="number"||t<0||t>4294967295||$floor(t)!==t)throw new $TypeError("`length` must be a positive 32-bit integer");var s=arguments.length>2&&!!arguments[2],a=!0,c=!0;if("length"in e&&gOPD$1){var u=gOPD$1(e,"length");u&&!u.configurable&&(a=!1),u&&!u.writable&&(c=!1)}return(a||c||!s)&&(hasDescriptors?define(e,"length",t,!0,!0):define(e,"length",t)),e};(function(n){var e=functionBind,t=getIntrinsic,s=setFunctionLength,a=t("%TypeError%"),c=t("%Function.prototype.apply%"),u=t("%Function.prototype.call%"),d=t("%Reflect.apply%",!0)||e.call(u,c),m=t("%Object.defineProperty%",!0),_=t("%Math.max%");if(m)try{m({},"a",{value:1})}catch{m=null}n.exports=function(C){if(typeof C!="function")throw new a("a function is required");var w=d(e,u,arguments);return s(w,1+_(0,C.length-(arguments.length-1)),!0)};var b=function(){return d(e,c,arguments)};m?m(n.exports,"apply",{value:b}):n.exports.apply=b})(callBind$2);var callBindExports=callBind$2.exports,GetIntrinsic=getIntrinsic,callBind$1=callBindExports,$indexOf$1=callBind$1(GetIntrinsic("String.prototype.indexOf")),callBound$2=function n(e,t){var s=GetIntrinsic(e,!!t);return typeof s=="function"&&$indexOf$1(e,".prototype.")>-1?callBind$1(s):s},hasToStringTag$3=shams(),callBound$1=callBound$2,$toString$1=callBound$1("Object.prototype.toString"),isStandardArguments=function n(e){return hasToStringTag$3&&e&&typeof e=="object"&&Symbol.toStringTag in e?!1:$toString$1(e)==="[object Arguments]"},isLegacyArguments=function n(e){return isStandardArguments(e)?!0:e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&$toString$1(e)!=="[object Array]"&&$toString$1(e.callee)==="[object Function]"},supportsStandardArguments=function(){return isStandardArguments(arguments)}();isStandardArguments.isLegacyArguments=isLegacyArguments;var isArguments=supportsStandardArguments?isStandardArguments:isLegacyArguments,toStr$2=Object.prototype.toString,fnToStr$1=Function.prototype.toString,isFnRegex=/^\s*(?:function)?\*/,hasToStringTag$2=shams(),getProto=Object.getPrototypeOf,getGeneratorFunc=function(){if(!hasToStringTag$2)return!1;try{return Function("return function*() {}")()}catch{}},GeneratorFunction,isGeneratorFunction=function n(e){if(typeof e!="function")return!1;if(isFnRegex.test(fnToStr$1.call(e)))return!0;if(!hasToStringTag$2){var t=toStr$2.call(e);return t==="[object GeneratorFunction]"}if(!getProto)return!1;if(typeof GeneratorFunction>"u"){var s=getGeneratorFunc();GeneratorFunction=s?getProto(s):!1}return getProto(e)===GeneratorFunction},fnToStr=Function.prototype.toString,reflectApply=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,badArrayLike,isCallableMarker;if(typeof reflectApply=="function"&&typeof Object.defineProperty=="function")try{badArrayLike=Object.defineProperty({},"length",{get:function(){throw isCallableMarker}}),isCallableMarker={},reflectApply(function(){throw 42},null,badArrayLike)}catch(n){n!==isCallableMarker&&(reflectApply=null)}else reflectApply=null;var constructorRegex=/^\s*class\b/,isES6ClassFn=function n(e){try{var t=fnToStr.call(e);return constructorRegex.test(t)}catch{return!1}},tryFunctionObject=function n(e){try{return isES6ClassFn(e)?!1:(fnToStr.call(e),!0)}catch{return!1}},toStr$1=Object.prototype.toString,objectClass="[object Object]",fnClass="[object Function]",genClass="[object GeneratorFunction]",ddaClass="[object HTMLAllCollection]",ddaClass2="[object HTML document.all class]",ddaClass3="[object HTMLCollection]",hasToStringTag$1=typeof Symbol=="function"&&!!Symbol.toStringTag,isIE68=!(0 in[,]),isDDA=function n(){return!1};if(typeof document=="object"){var all=document.all;toStr$1.call(all)===toStr$1.call(document.all)&&(isDDA=function(e){if((isIE68||!e)&&(typeof e>"u"||typeof e=="object"))try{var t=toStr$1.call(e);return(t===ddaClass||t===ddaClass2||t===ddaClass3||t===objectClass)&&e("")==null}catch{}return!1})}var isCallable$1=reflectApply?function n(e){if(isDDA(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;try{reflectApply(e,null,badArrayLike)}catch(t){if(t!==isCallableMarker)return!1}return!isES6ClassFn(e)&&tryFunctionObject(e)}:function n(e){if(isDDA(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(hasToStringTag$1)return tryFunctionObject(e);if(isES6ClassFn(e))return!1;var t=toStr$1.call(e);return t!==fnClass&&t!==genClass&&!/^\[object HTML/.test(t)?!1:tryFunctionObject(e)},isCallable=isCallable$1,toStr=Object.prototype.toString,hasOwnProperty=Object.prototype.hasOwnProperty,forEachArray=function n(e,t,s){for(var a=0,c=e.length;a<c;a++)hasOwnProperty.call(e,a)&&(s==null?t(e[a],a,e):t.call(s,e[a],a,e))},forEachString=function n(e,t,s){for(var a=0,c=e.length;a<c;a++)s==null?t(e.charAt(a),a,e):t.call(s,e.charAt(a),a,e)},forEachObject=function n(e,t,s){for(var a in e)hasOwnProperty.call(e,a)&&(s==null?t(e[a],a,e):t.call(s,e[a],a,e))},forEach$1=function n(e,t,s){if(!isCallable(t))throw new TypeError("iterator must be a function");var a;arguments.length>=3&&(a=s),toStr.call(e)==="[object Array]"?forEachArray(e,t,a):typeof e=="string"?forEachString(e,t,a):forEachObject(e,t,a)},forEach_1=forEach$1,possibleNames=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],g$1=typeof globalThis>"u"?commonjsGlobal$1:globalThis,availableTypedArrays$1=function n(){for(var e=[],t=0;t<possibleNames.length;t++)typeof g$1[possibleNames[t]]=="function"&&(e[e.length]=possibleNames[t]);return e},forEach=forEach_1,availableTypedArrays=availableTypedArrays$1,callBind=callBindExports,callBound=callBound$2,gOPD=gopd$1,$toString=callBound("Object.prototype.toString"),hasToStringTag=shams(),g=typeof globalThis>"u"?commonjsGlobal$1:globalThis,typedArrays=availableTypedArrays(),$slice=callBound("String.prototype.slice"),getPrototypeOf=Object.getPrototypeOf,$indexOf=callBound("Array.prototype.indexOf",!0)||function n(e,t){for(var s=0;s<e.length;s+=1)if(e[s]===t)return s;return-1},cache={__proto__:null};hasToStringTag&&gOPD&&getPrototypeOf?forEach(typedArrays,function(n){var e=new g[n];if(Symbol.toStringTag in e){var t=getPrototypeOf(e),s=gOPD(t,Symbol.toStringTag);if(!s){var a=getPrototypeOf(t);s=gOPD(a,Symbol.toStringTag)}cache["$"+n]=callBind(s.get)}}):forEach(typedArrays,function(n){var e=new g[n],t=e.slice||e.set;t&&(cache["$"+n]=callBind(t))});var tryTypedArrays=function n(e){var t=!1;return forEach(cache,function(s,a){if(!t)try{"$"+s(e)===a&&(t=$slice(a,1))}catch{}}),t},trySlices=function n(e){var t=!1;return forEach(cache,function(s,a){if(!t)try{s(e),t=$slice(a,1)}catch{}}),t},whichTypedArray$1=function n(e){if(!e||typeof e!="object")return!1;if(!hasToStringTag){var t=$slice($toString(e),8,-1);return $indexOf(typedArrays,t)>-1?t:t!=="Object"?!1:trySlices(e)}return gOPD?tryTypedArrays(e):null},whichTypedArray=whichTypedArray$1,isTypedArray=function n(e){return!!whichTypedArray(e)};(function(n){var e=isArguments,t=isGeneratorFunction,s=whichTypedArray$1,a=isTypedArray;function c(ee){return ee.call.bind(ee)}var u=typeof BigInt<"u",d=typeof Symbol<"u",m=c(Object.prototype.toString),_=c(Number.prototype.valueOf),b=c(String.prototype.valueOf),S=c(Boolean.prototype.valueOf);if(u)var C=c(BigInt.prototype.valueOf);if(d)var w=c(Symbol.prototype.valueOf);function O(ee,Re){if(typeof ee!="object")return!1;try{return Re(ee),!0}catch{return!1}}n.isArgumentsObject=e,n.isGeneratorFunction=t,n.isTypedArray=a;function I(ee){return typeof Promise<"u"&&ee instanceof Promise||ee!==null&&typeof ee=="object"&&typeof ee.then=="function"&&typeof ee.catch=="function"}n.isPromise=I;function N(ee){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(ee):a(ee)||$(ee)}n.isArrayBufferView=N;function P(ee){return s(ee)==="Uint8Array"}n.isUint8Array=P;function B(ee){return s(ee)==="Uint8ClampedArray"}n.isUint8ClampedArray=B;function x(ee){return s(ee)==="Uint16Array"}n.isUint16Array=x;function F(ee){return s(ee)==="Uint32Array"}n.isUint32Array=F;function k(ee){return s(ee)==="Int8Array"}n.isInt8Array=k;function J(ee){return s(ee)==="Int16Array"}n.isInt16Array=J;function z(ee){return s(ee)==="Int32Array"}n.isInt32Array=z;function H(ee){return s(ee)==="Float32Array"}n.isFloat32Array=H;function W(ee){return s(ee)==="Float64Array"}n.isFloat64Array=W;function X(ee){return s(ee)==="BigInt64Array"}n.isBigInt64Array=X;function se(ee){return s(ee)==="BigUint64Array"}n.isBigUint64Array=se;function re(ee){return m(ee)==="[object Map]"}re.working=typeof Map<"u"&&re(new Map);function ue(ee){return typeof Map>"u"?!1:re.working?re(ee):ee instanceof Map}n.isMap=ue;function de(ee){return m(ee)==="[object Set]"}de.working=typeof Set<"u"&&de(new Set);function he(ee){return typeof Set>"u"?!1:de.working?de(ee):ee instanceof Set}n.isSet=he;function me(ee){return m(ee)==="[object WeakMap]"}me.working=typeof WeakMap<"u"&&me(new WeakMap);function le(ee){return typeof WeakMap>"u"?!1:me.working?me(ee):ee instanceof WeakMap}n.isWeakMap=le;function _e(ee){return m(ee)==="[object WeakSet]"}_e.working=typeof WeakSet<"u"&&_e(new WeakSet);function fe(ee){return _e(ee)}n.isWeakSet=fe;function ve(ee){return m(ee)==="[object ArrayBuffer]"}ve.working=typeof ArrayBuffer<"u"&&ve(new ArrayBuffer);function ne(ee){return typeof ArrayBuffer>"u"?!1:ve.working?ve(ee):ee instanceof ArrayBuffer}n.isArrayBuffer=ne;function j(ee){return m(ee)==="[object DataView]"}j.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&j(new DataView(new ArrayBuffer(1),0,1));function $(ee){return typeof DataView>"u"?!1:j.working?j(ee):ee instanceof DataView}n.isDataView=$;var Z=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function ce(ee){return m(ee)==="[object SharedArrayBuffer]"}function Y(ee){return typeof Z>"u"?!1:(typeof ce.working>"u"&&(ce.working=ce(new Z)),ce.working?ce(ee):ee instanceof Z)}n.isSharedArrayBuffer=Y;function K(ee){return m(ee)==="[object AsyncFunction]"}n.isAsyncFunction=K;function Q(ee){return m(ee)==="[object Map Iterator]"}n.isMapIterator=Q;function te(ee){return m(ee)==="[object Set Iterator]"}n.isSetIterator=te;function oe(ee){return m(ee)==="[object Generator]"}n.isGeneratorObject=oe;function U(ee){return m(ee)==="[object WebAssembly.Module]"}n.isWebAssemblyCompiledModule=U;function V(ee){return O(ee,_)}n.isNumberObject=V;function q(ee){return O(ee,b)}n.isStringObject=q;function ie(ee){return O(ee,S)}n.isBooleanObject=ie;function ge(ee){return u&&O(ee,C)}n.isBigIntObject=ge;function pe(ee){return d&&O(ee,w)}n.isSymbolObject=pe;function ye(ee){return V(ee)||q(ee)||ie(ee)||ge(ee)||pe(ee)}n.isBoxedPrimitive=ye;function be(ee){return typeof Uint8Array<"u"&&(ne(ee)||Y(ee))}n.isAnyArrayBuffer=be,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(ee){Object.defineProperty(n,ee,{enumerable:!1,value:function(){throw new Error(ee+" is not supported in userland")}})})})(types);var isBufferBrowser=function n(e){return e&&typeof e=="object"&&typeof e.copy=="function"&&typeof e.fill=="function"&&typeof e.readUInt8=="function"},inherits_browser={exports:{}};typeof Object.create=="function"?inherits_browser.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:inherits_browser.exports=function(e,t){if(t){e.super_=t;var s=function(){};s.prototype=t.prototype,e.prototype=new s,e.prototype.constructor=e}};var inherits_browserExports=inherits_browser.exports;(function(n){var e=Object.getOwnPropertyDescriptors||function($){for(var Z=Object.keys($),ce={},Y=0;Y<Z.length;Y++)ce[Z[Y]]=Object.getOwnPropertyDescriptor($,Z[Y]);return ce},t=/%[sdj%]/g;n.format=function(j){if(!k(j)){for(var $=[],Z=0;Z<arguments.length;Z++)$.push(u(arguments[Z]));return $.join(" ")}for(var Z=1,ce=arguments,Y=ce.length,K=String(j).replace(t,function(te){if(te==="%%")return"%";if(Z>=Y)return te;switch(te){case"%s":return String(ce[Z++]);case"%d":return Number(ce[Z++]);case"%j":try{return JSON.stringify(ce[Z++])}catch{return"[Circular]"}default:return te}}),Q=ce[Z];Z<Y;Q=ce[++Z])B(Q)||!W(Q)?K+=" "+Q:K+=" "+u(Q);return K},n.deprecate=function(j,$){if(typeof dist.process<"u"&&dist.process.noDeprecation===!0)return j;if(typeof dist.process>"u")return function(){return n.deprecate(j,$).apply(this,arguments)};var Z=!1;function ce(){if(!Z){if(dist.process.throwDeprecation)throw new Error($);dist.process.traceDeprecation?console.trace($):console.error($),Z=!0}return j.apply(this,arguments)}return ce};var s={},a=/^$/;if({}.NODE_DEBUG){var c={}.NODE_DEBUG;c=c.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),a=new RegExp("^"+c+"$","i")}n.debuglog=function(j){if(j=j.toUpperCase(),!s[j])if(a.test(j)){var $=dist.process.pid;s[j]=function(){var Z=n.format.apply(n,arguments);console.error("%s %d: %s",j,$,Z)}}else s[j]=function(){};return s[j]};function u(j,$){var Z={seen:[],stylize:m};return arguments.length>=3&&(Z.depth=arguments[2]),arguments.length>=4&&(Z.colors=arguments[3]),P($)?Z.showHidden=$:$&&n._extend(Z,$),z(Z.showHidden)&&(Z.showHidden=!1),z(Z.depth)&&(Z.depth=2),z(Z.colors)&&(Z.colors=!1),z(Z.customInspect)&&(Z.customInspect=!0),Z.colors&&(Z.stylize=d),b(Z,j,Z.depth)}n.inspect=u,u.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},u.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function d(j,$){var Z=u.styles[$];return Z?"\x1B["+u.colors[Z][0]+"m"+j+"\x1B["+u.colors[Z][1]+"m":j}function m(j,$){return j}function _(j){var $={};return j.forEach(function(Z,ce){$[Z]=!0}),$}function b(j,$,Z){if(j.customInspect&&$&&re($.inspect)&&$.inspect!==n.inspect&&!($.constructor&&$.constructor.prototype===$)){var ce=$.inspect(Z,j);return k(ce)||(ce=b(j,ce,Z)),ce}var Y=S(j,$);if(Y)return Y;var K=Object.keys($),Q=_(K);if(j.showHidden&&(K=Object.getOwnPropertyNames($)),se($)&&(K.indexOf("message")>=0||K.indexOf("description")>=0))return C($);if(K.length===0){if(re($)){var te=$.name?": "+$.name:"";return j.stylize("[Function"+te+"]","special")}if(H($))return j.stylize(RegExp.prototype.toString.call($),"regexp");if(X($))return j.stylize(Date.prototype.toString.call($),"date");if(se($))return C($)}var oe="",U=!1,V=["{","}"];if(N($)&&(U=!0,V=["[","]"]),re($)){var q=$.name?": "+$.name:"";oe=" [Function"+q+"]"}if(H($)&&(oe=" "+RegExp.prototype.toString.call($)),X($)&&(oe=" "+Date.prototype.toUTCString.call($)),se($)&&(oe=" "+C($)),K.length===0&&(!U||$.length==0))return V[0]+oe+V[1];if(Z<0)return H($)?j.stylize(RegExp.prototype.toString.call($),"regexp"):j.stylize("[Object]","special");j.seen.push($);var ie;return U?ie=w(j,$,Z,Q,K):ie=K.map(function(ge){return O(j,$,Z,Q,ge,U)}),j.seen.pop(),I(ie,oe,V)}function S(j,$){if(z($))return j.stylize("undefined","undefined");if(k($)){var Z="'"+JSON.stringify($).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return j.stylize(Z,"string")}if(F($))return j.stylize(""+$,"number");if(P($))return j.stylize(""+$,"boolean");if(B($))return j.stylize("null","null")}function C(j){return"["+Error.prototype.toString.call(j)+"]"}function w(j,$,Z,ce,Y){for(var K=[],Q=0,te=$.length;Q<te;++Q)_e($,String(Q))?K.push(O(j,$,Z,ce,String(Q),!0)):K.push("");return Y.forEach(function(oe){oe.match(/^\d+$/)||K.push(O(j,$,Z,ce,oe,!0))}),K}function O(j,$,Z,ce,Y,K){var Q,te,oe;if(oe=Object.getOwnPropertyDescriptor($,Y)||{value:$[Y]},oe.get?oe.set?te=j.stylize("[Getter/Setter]","special"):te=j.stylize("[Getter]","special"):oe.set&&(te=j.stylize("[Setter]","special")),_e(ce,Y)||(Q="["+Y+"]"),te||(j.seen.indexOf(oe.value)<0?(B(Z)?te=b(j,oe.value,null):te=b(j,oe.value,Z-1),te.indexOf(`
`)>-1&&(K?te=te.split(`
`).map(function(U){return"  "+U}).join(`
`).slice(2):te=`
`+te.split(`
`).map(function(U){return"   "+U}).join(`
`))):te=j.stylize("[Circular]","special")),z(Q)){if(K&&Y.match(/^\d+$/))return te;Q=JSON.stringify(""+Y),Q.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(Q=Q.slice(1,-1),Q=j.stylize(Q,"name")):(Q=Q.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),Q=j.stylize(Q,"string"))}return Q+": "+te}function I(j,$,Z){var ce=j.reduce(function(Y,K){return K.indexOf(`
`)>=0,Y+K.replace(/\u001b\[\d\d?m/g,"").length+1},0);return ce>60?Z[0]+($===""?"":$+`
 `)+" "+j.join(`,
  `)+" "+Z[1]:Z[0]+$+" "+j.join(", ")+" "+Z[1]}n.types=types;function N(j){return Array.isArray(j)}n.isArray=N;function P(j){return typeof j=="boolean"}n.isBoolean=P;function B(j){return j===null}n.isNull=B;function x(j){return j==null}n.isNullOrUndefined=x;function F(j){return typeof j=="number"}n.isNumber=F;function k(j){return typeof j=="string"}n.isString=k;function J(j){return typeof j=="symbol"}n.isSymbol=J;function z(j){return j===void 0}n.isUndefined=z;function H(j){return W(j)&&de(j)==="[object RegExp]"}n.isRegExp=H,n.types.isRegExp=H;function W(j){return typeof j=="object"&&j!==null}n.isObject=W;function X(j){return W(j)&&de(j)==="[object Date]"}n.isDate=X,n.types.isDate=X;function se(j){return W(j)&&(de(j)==="[object Error]"||j instanceof Error)}n.isError=se,n.types.isNativeError=se;function re(j){return typeof j=="function"}n.isFunction=re;function ue(j){return j===null||typeof j=="boolean"||typeof j=="number"||typeof j=="string"||typeof j=="symbol"||typeof j>"u"}n.isPrimitive=ue,n.isBuffer=isBufferBrowser;function de(j){return Object.prototype.toString.call(j)}function he(j){return j<10?"0"+j.toString(10):j.toString(10)}var me=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function le(){var j=new Date,$=[he(j.getHours()),he(j.getMinutes()),he(j.getSeconds())].join(":");return[j.getDate(),me[j.getMonth()],$].join(" ")}n.log=function(){console.log("%s - %s",le(),n.format.apply(n,arguments))},n.inherits=inherits_browserExports,n._extend=function(j,$){if(!$||!W($))return j;for(var Z=Object.keys($),ce=Z.length;ce--;)j[Z[ce]]=$[Z[ce]];return j};function _e(j,$){return Object.prototype.hasOwnProperty.call(j,$)}var fe=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;n.promisify=function($){if(typeof $!="function")throw new TypeError('The "original" argument must be of type Function');if(fe&&$[fe]){var Z=$[fe];if(typeof Z!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(Z,fe,{value:Z,enumerable:!1,writable:!1,configurable:!0}),Z}function Z(){for(var ce,Y,K=new Promise(function(oe,U){ce=oe,Y=U}),Q=[],te=0;te<arguments.length;te++)Q.push(arguments[te]);Q.push(function(oe,U){oe?Y(oe):ce(U)});try{$.apply(this,Q)}catch(oe){Y(oe)}return K}return Object.setPrototypeOf(Z,Object.getPrototypeOf($)),fe&&Object.defineProperty(Z,fe,{value:Z,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(Z,e($))},n.promisify.custom=fe;function ve(j,$){if(!j){var Z=new Error("Promise was rejected with a falsy value");Z.reason=j,j=Z}return $(j)}function ne(j){if(typeof j!="function")throw new TypeError('The "original" argument must be of type Function');function $(){for(var Z=[],ce=0;ce<arguments.length;ce++)Z.push(arguments[ce]);var Y=Z.pop();if(typeof Y!="function")throw new TypeError("The last argument must be of type Function");var K=this,Q=function(){return Y.apply(K,arguments)};j.apply(this,Z).then(function(te){dist.process.nextTick(Q.bind(null,null,te))},function(te){dist.process.nextTick(ve.bind(null,te,Q))})}return Object.setPrototypeOf($,Object.getPrototypeOf(j)),Object.defineProperties($,e(j)),$}n.callbackify=ne})(util);var buffer_list,hasRequiredBuffer_list;function requireBuffer_list(){if(hasRequiredBuffer_list)return buffer_list;hasRequiredBuffer_list=1;function n(O,I){var N=Object.keys(O);if(Object.getOwnPropertySymbols){var P=Object.getOwnPropertySymbols(O);I&&(P=P.filter(function(B){return Object.getOwnPropertyDescriptor(O,B).enumerable})),N.push.apply(N,P)}return N}function e(O){for(var I=1;I<arguments.length;I++){var N=arguments[I]!=null?arguments[I]:{};I%2?n(Object(N),!0).forEach(function(P){t(O,P,N[P])}):Object.getOwnPropertyDescriptors?Object.defineProperties(O,Object.getOwnPropertyDescriptors(N)):n(Object(N)).forEach(function(P){Object.defineProperty(O,P,Object.getOwnPropertyDescriptor(N,P))})}return O}function t(O,I,N){return I=u(I),I in O?Object.defineProperty(O,I,{value:N,enumerable:!0,configurable:!0,writable:!0}):O[I]=N,O}function s(O,I){if(!(O instanceof I))throw new TypeError("Cannot call a class as a function")}function a(O,I){for(var N=0;N<I.length;N++){var P=I[N];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(O,u(P.key),P)}}function c(O,I,N){return I&&a(O.prototype,I),N&&a(O,N),Object.defineProperty(O,"prototype",{writable:!1}),O}function u(O){var I=d(O,"string");return typeof I=="symbol"?I:String(I)}function d(O,I){if(typeof O!="object"||O===null)return O;var N=O[Symbol.toPrimitive];if(N!==void 0){var P=N.call(O,I||"default");if(typeof P!="object")return P;throw new TypeError("@@toPrimitive must return a primitive value.")}return(I==="string"?String:Number)(O)}var m=buffer,_=m.Buffer,b=util,S=b.inspect,C=S&&S.custom||"inspect";function w(O,I,N){_.prototype.copy.call(O,I,N)}return buffer_list=function(){function O(){s(this,O),this.head=null,this.tail=null,this.length=0}return c(O,[{key:"push",value:function(N){var P={data:N,next:null};this.length>0?this.tail.next=P:this.head=P,this.tail=P,++this.length}},{key:"unshift",value:function(N){var P={data:N,next:this.head};this.length===0&&(this.tail=P),this.head=P,++this.length}},{key:"shift",value:function(){if(this.length!==0){var N=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,N}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(N){if(this.length===0)return"";for(var P=this.head,B=""+P.data;P=P.next;)B+=N+P.data;return B}},{key:"concat",value:function(N){if(this.length===0)return _.alloc(0);for(var P=_.allocUnsafe(N>>>0),B=this.head,x=0;B;)w(B.data,P,x),x+=B.data.length,B=B.next;return P}},{key:"consume",value:function(N,P){var B;return N<this.head.data.length?(B=this.head.data.slice(0,N),this.head.data=this.head.data.slice(N)):N===this.head.data.length?B=this.shift():B=P?this._getString(N):this._getBuffer(N),B}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(N){var P=this.head,B=1,x=P.data;for(N-=x.length;P=P.next;){var F=P.data,k=N>F.length?F.length:N;if(k===F.length?x+=F:x+=F.slice(0,N),N-=k,N===0){k===F.length?(++B,P.next?this.head=P.next:this.head=this.tail=null):(this.head=P,P.data=F.slice(k));break}++B}return this.length-=B,x}},{key:"_getBuffer",value:function(N){var P=_.allocUnsafe(N),B=this.head,x=1;for(B.data.copy(P),N-=B.data.length;B=B.next;){var F=B.data,k=N>F.length?F.length:N;if(F.copy(P,P.length-N,0,k),N-=k,N===0){k===F.length?(++x,B.next?this.head=B.next:this.head=this.tail=null):(this.head=B,B.data=F.slice(k));break}++x}return this.length-=x,P}},{key:C,value:function(N,P){return S(this,e(e({},P),{},{depth:0,customInspect:!1}))}}]),O}(),buffer_list}function destroy(n,e){var t=this,s=this._readableState&&this._readableState.destroyed,a=this._writableState&&this._writableState.destroyed;return s||a?(e?e(n):n&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,dist.process.nextTick(emitErrorNT,this,n)):dist.process.nextTick(emitErrorNT,this,n)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(n||null,function(c){!e&&c?t._writableState?t._writableState.errorEmitted?dist.process.nextTick(emitCloseNT,t):(t._writableState.errorEmitted=!0,dist.process.nextTick(emitErrorAndCloseNT,t,c)):dist.process.nextTick(emitErrorAndCloseNT,t,c):e?(dist.process.nextTick(emitCloseNT,t),e(c)):dist.process.nextTick(emitCloseNT,t)}),this)}function emitErrorAndCloseNT(n,e){emitErrorNT(n,e),emitCloseNT(n)}function emitCloseNT(n){n._writableState&&!n._writableState.emitClose||n._readableState&&!n._readableState.emitClose||n.emit("close")}function undestroy(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function emitErrorNT(n,e){n.emit("error",e)}function errorOrDestroy(n,e){var t=n._readableState,s=n._writableState;t&&t.autoDestroy||s&&s.autoDestroy?n.destroy(e):n.emit("error",e)}var destroy_1={destroy,undestroy,errorOrDestroy},errorsBrowser={};function _inheritsLoose(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}var codes={};function createErrorType(n,e,t){t||(t=Error);function s(c,u,d){return typeof e=="string"?e:e(c,u,d)}var a=function(c){_inheritsLoose(u,c);function u(d,m,_){return c.call(this,s(d,m,_))||this}return u}(t);a.prototype.name=t.name,a.prototype.code=n,codes[n]=a}function oneOf(n,e){if(Array.isArray(n)){var t=n.length;return n=n.map(function(s){return String(s)}),t>2?"one of ".concat(e," ").concat(n.slice(0,t-1).join(", "),", or ")+n[t-1]:t===2?"one of ".concat(e," ").concat(n[0]," or ").concat(n[1]):"of ".concat(e," ").concat(n[0])}else return"of ".concat(e," ").concat(String(n))}function startsWith(n,e,t){return n.substr(!t||t<0?0:+t,e.length)===e}function endsWith(n,e,t){return(t===void 0||t>n.length)&&(t=n.length),n.substring(t-e.length,t)===e}function includes(n,e,t){return typeof t!="number"&&(t=0),t+e.length>n.length?!1:n.indexOf(e,t)!==-1}createErrorType("ERR_INVALID_OPT_VALUE",function(n,e){return'The value "'+e+'" is invalid for option "'+n+'"'},TypeError);createErrorType("ERR_INVALID_ARG_TYPE",function(n,e,t){var s;typeof e=="string"&&startsWith(e,"not ")?(s="must not be",e=e.replace(/^not /,"")):s="must be";var a;if(endsWith(n," argument"))a="The ".concat(n," ").concat(s," ").concat(oneOf(e,"type"));else{var c=includes(n,".")?"property":"argument";a='The "'.concat(n,'" ').concat(c," ").concat(s," ").concat(oneOf(e,"type"))}return a+=". Received type ".concat(typeof t),a},TypeError);createErrorType("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");createErrorType("ERR_METHOD_NOT_IMPLEMENTED",function(n){return"The "+n+" method is not implemented"});createErrorType("ERR_STREAM_PREMATURE_CLOSE","Premature close");createErrorType("ERR_STREAM_DESTROYED",function(n){return"Cannot call "+n+" after a stream was destroyed"});createErrorType("ERR_MULTIPLE_CALLBACK","Callback called multiple times");createErrorType("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");createErrorType("ERR_STREAM_WRITE_AFTER_END","write after end");createErrorType("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);createErrorType("ERR_UNKNOWN_ENCODING",function(n){return"Unknown encoding: "+n},TypeError);createErrorType("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");errorsBrowser.codes=codes;var ERR_INVALID_OPT_VALUE=errorsBrowser.codes.ERR_INVALID_OPT_VALUE;function highWaterMarkFrom(n,e,t){return n.highWaterMark!=null?n.highWaterMark:e?n[t]:null}function getHighWaterMark(n,e,t,s){var a=highWaterMarkFrom(e,s,t);if(a!=null){if(!(isFinite(a)&&Math.floor(a)===a)||a<0){var c=s?t:"highWaterMark";throw new ERR_INVALID_OPT_VALUE(c,a)}return Math.floor(a)}return n.objectMode?16:16*1024}var state={getHighWaterMark},browser=deprecate;function deprecate(n,e){if(config("noDeprecation"))return n;var t=!1;function s(){if(!t){if(config("throwDeprecation"))throw new Error(e);config("traceDeprecation")?console.trace(e):console.warn(e),t=!0}return n.apply(this,arguments)}return s}function config(n){try{if(!commonjsGlobal$1.localStorage)return!1}catch{return!1}var e=commonjsGlobal$1.localStorage[n];return e==null?!1:String(e).toLowerCase()==="true"}var _stream_writable,hasRequired_stream_writable;function require_stream_writable(){if(hasRequired_stream_writable)return _stream_writable;hasRequired_stream_writable=1,_stream_writable=H;function n(Y){var K=this;this.next=null,this.entry=null,this.finish=function(){ce(K,Y)}}var e;H.WritableState=J;var t={deprecate:browser},s=streamBrowser,a=buffer.Buffer,c=(typeof commonjsGlobal$1<"u"?commonjsGlobal$1:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function u(Y){return a.from(Y)}function d(Y){return a.isBuffer(Y)||Y instanceof c}var m=destroy_1,_=state,b=_.getHighWaterMark,S=errorsBrowser.codes,C=S.ERR_INVALID_ARG_TYPE,w=S.ERR_METHOD_NOT_IMPLEMENTED,O=S.ERR_MULTIPLE_CALLBACK,I=S.ERR_STREAM_CANNOT_PIPE,N=S.ERR_STREAM_DESTROYED,P=S.ERR_STREAM_NULL_VALUES,B=S.ERR_STREAM_WRITE_AFTER_END,x=S.ERR_UNKNOWN_ENCODING,F=m.errorOrDestroy;inherits_browserExports(H,s);function k(){}function J(Y,K,Q){e=e||require_stream_duplex(),Y=Y||{},typeof Q!="boolean"&&(Q=K instanceof e),this.objectMode=!!Y.objectMode,Q&&(this.objectMode=this.objectMode||!!Y.writableObjectMode),this.highWaterMark=b(this,Y,"writableHighWaterMark",Q),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var te=Y.decodeStrings===!1;this.decodeStrings=!te,this.defaultEncoding=Y.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(oe){me(K,oe)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=Y.emitClose!==!1,this.autoDestroy=!!Y.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new n(this)}J.prototype.getBuffer=function(){for(var K=this.bufferedRequest,Q=[];K;)Q.push(K),K=K.next;return Q},function(){try{Object.defineProperty(J.prototype,"buffer",{get:t.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var z;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(z=Function.prototype[Symbol.hasInstance],Object.defineProperty(H,Symbol.hasInstance,{value:function(K){return z.call(this,K)?!0:this!==H?!1:K&&K._writableState instanceof J}})):z=function(K){return K instanceof this};function H(Y){e=e||require_stream_duplex();var K=this instanceof e;if(!K&&!z.call(H,this))return new H(Y);this._writableState=new J(Y,this,K),this.writable=!0,Y&&(typeof Y.write=="function"&&(this._write=Y.write),typeof Y.writev=="function"&&(this._writev=Y.writev),typeof Y.destroy=="function"&&(this._destroy=Y.destroy),typeof Y.final=="function"&&(this._final=Y.final)),s.call(this)}H.prototype.pipe=function(){F(this,new I)};function W(Y,K){var Q=new B;F(Y,Q),dist.process.nextTick(K,Q)}function X(Y,K,Q,te){var oe;return Q===null?oe=new P:typeof Q!="string"&&!K.objectMode&&(oe=new C("chunk",["string","Buffer"],Q)),oe?(F(Y,oe),dist.process.nextTick(te,oe),!1):!0}H.prototype.write=function(Y,K,Q){var te=this._writableState,oe=!1,U=!te.objectMode&&d(Y);return U&&!a.isBuffer(Y)&&(Y=u(Y)),typeof K=="function"&&(Q=K,K=null),U?K="buffer":K||(K=te.defaultEncoding),typeof Q!="function"&&(Q=k),te.ending?W(this,Q):(U||X(this,te,Y,Q))&&(te.pendingcb++,oe=re(this,te,U,Y,K,Q)),oe},H.prototype.cork=function(){this._writableState.corked++},H.prototype.uncork=function(){var Y=this._writableState;Y.corked&&(Y.corked--,!Y.writing&&!Y.corked&&!Y.bufferProcessing&&Y.bufferedRequest&&fe(this,Y))},H.prototype.setDefaultEncoding=function(K){if(typeof K=="string"&&(K=K.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((K+"").toLowerCase())>-1))throw new x(K);return this._writableState.defaultEncoding=K,this},Object.defineProperty(H.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function se(Y,K,Q){return!Y.objectMode&&Y.decodeStrings!==!1&&typeof K=="string"&&(K=a.from(K,Q)),K}Object.defineProperty(H.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function re(Y,K,Q,te,oe,U){if(!Q){var V=se(K,te,oe);te!==V&&(Q=!0,oe="buffer",te=V)}var q=K.objectMode?1:te.length;K.length+=q;var ie=K.length<K.highWaterMark;if(ie||(K.needDrain=!0),K.writing||K.corked){var ge=K.lastBufferedRequest;K.lastBufferedRequest={chunk:te,encoding:oe,isBuf:Q,callback:U,next:null},ge?ge.next=K.lastBufferedRequest:K.bufferedRequest=K.lastBufferedRequest,K.bufferedRequestCount+=1}else ue(Y,K,!1,q,te,oe,U);return ie}function ue(Y,K,Q,te,oe,U,V){K.writelen=te,K.writecb=V,K.writing=!0,K.sync=!0,K.destroyed?K.onwrite(new N("write")):Q?Y._writev(oe,K.onwrite):Y._write(oe,U,K.onwrite),K.sync=!1}function de(Y,K,Q,te,oe){--K.pendingcb,Q?(dist.process.nextTick(oe,te),dist.process.nextTick($,Y,K),Y._writableState.errorEmitted=!0,F(Y,te)):(oe(te),Y._writableState.errorEmitted=!0,F(Y,te),$(Y,K))}function he(Y){Y.writing=!1,Y.writecb=null,Y.length-=Y.writelen,Y.writelen=0}function me(Y,K){var Q=Y._writableState,te=Q.sync,oe=Q.writecb;if(typeof oe!="function")throw new O;if(he(Q),K)de(Y,Q,te,K,oe);else{var U=ve(Q)||Y.destroyed;!U&&!Q.corked&&!Q.bufferProcessing&&Q.bufferedRequest&&fe(Y,Q),te?dist.process.nextTick(le,Y,Q,U,oe):le(Y,Q,U,oe)}}function le(Y,K,Q,te){Q||_e(Y,K),K.pendingcb--,te(),$(Y,K)}function _e(Y,K){K.length===0&&K.needDrain&&(K.needDrain=!1,Y.emit("drain"))}function fe(Y,K){K.bufferProcessing=!0;var Q=K.bufferedRequest;if(Y._writev&&Q&&Q.next){var te=K.bufferedRequestCount,oe=new Array(te),U=K.corkedRequestsFree;U.entry=Q;for(var V=0,q=!0;Q;)oe[V]=Q,Q.isBuf||(q=!1),Q=Q.next,V+=1;oe.allBuffers=q,ue(Y,K,!0,K.length,oe,"",U.finish),K.pendingcb++,K.lastBufferedRequest=null,U.next?(K.corkedRequestsFree=U.next,U.next=null):K.corkedRequestsFree=new n(K),K.bufferedRequestCount=0}else{for(;Q;){var ie=Q.chunk,ge=Q.encoding,pe=Q.callback,ye=K.objectMode?1:ie.length;if(ue(Y,K,!1,ye,ie,ge,pe),Q=Q.next,K.bufferedRequestCount--,K.writing)break}Q===null&&(K.lastBufferedRequest=null)}K.bufferedRequest=Q,K.bufferProcessing=!1}H.prototype._write=function(Y,K,Q){Q(new w("_write()"))},H.prototype._writev=null,H.prototype.end=function(Y,K,Q){var te=this._writableState;return typeof Y=="function"?(Q=Y,Y=null,K=null):typeof K=="function"&&(Q=K,K=null),Y!=null&&this.write(Y,K),te.corked&&(te.corked=1,this.uncork()),te.ending||Z(this,te,Q),this},Object.defineProperty(H.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function ve(Y){return Y.ending&&Y.length===0&&Y.bufferedRequest===null&&!Y.finished&&!Y.writing}function ne(Y,K){Y._final(function(Q){K.pendingcb--,Q&&F(Y,Q),K.prefinished=!0,Y.emit("prefinish"),$(Y,K)})}function j(Y,K){!K.prefinished&&!K.finalCalled&&(typeof Y._final=="function"&&!K.destroyed?(K.pendingcb++,K.finalCalled=!0,dist.process.nextTick(ne,Y,K)):(K.prefinished=!0,Y.emit("prefinish")))}function $(Y,K){var Q=ve(K);if(Q&&(j(Y,K),K.pendingcb===0&&(K.finished=!0,Y.emit("finish"),K.autoDestroy))){var te=Y._readableState;(!te||te.autoDestroy&&te.endEmitted)&&Y.destroy()}return Q}function Z(Y,K,Q){K.ending=!0,$(Y,K),Q&&(K.finished?dist.process.nextTick(Q):Y.once("finish",Q)),K.ended=!0,Y.writable=!1}function ce(Y,K,Q){var te=Y.entry;for(Y.entry=null;te;){var oe=te.callback;K.pendingcb--,oe(Q),te=te.next}K.corkedRequestsFree.next=Y}return Object.defineProperty(H.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(K){this._writableState&&(this._writableState.destroyed=K)}}),H.prototype.destroy=m.destroy,H.prototype._undestroy=m.undestroy,H.prototype._destroy=function(Y,K){K(Y)},_stream_writable}var _stream_duplex,hasRequired_stream_duplex;function require_stream_duplex(){if(hasRequired_stream_duplex)return _stream_duplex;hasRequired_stream_duplex=1;var n=Object.keys||function(_){var b=[];for(var S in _)b.push(S);return b};_stream_duplex=u;var e=require_stream_readable(),t=require_stream_writable();inherits_browserExports(u,e);for(var s=n(t.prototype),a=0;a<s.length;a++){var c=s[a];u.prototype[c]||(u.prototype[c]=t.prototype[c])}function u(_){if(!(this instanceof u))return new u(_);e.call(this,_),t.call(this,_),this.allowHalfOpen=!0,_&&(_.readable===!1&&(this.readable=!1),_.writable===!1&&(this.writable=!1),_.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",d)))}Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(u.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function d(){this._writableState.ended||dist.process.nextTick(m,this)}function m(_){_.end()}return Object.defineProperty(u.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(b){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=b,this._writableState.destroyed=b)}}),_stream_duplex}var string_decoder={},hasRequiredString_decoder;function requireString_decoder(){if(hasRequiredString_decoder)return string_decoder;hasRequiredString_decoder=1;var n=safeBufferExports.Buffer,e=n.isEncoding||function(P){switch(P=""+P,P&&P.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function t(P){if(!P)return"utf8";for(var B;;)switch(P){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return P;default:if(B)return;P=(""+P).toLowerCase(),B=!0}}function s(P){var B=t(P);if(typeof B!="string"&&(n.isEncoding===e||!e(P)))throw new Error("Unknown encoding: "+P);return B||P}string_decoder.StringDecoder=a;function a(P){this.encoding=s(P);var B;switch(this.encoding){case"utf16le":this.text=S,this.end=C,B=4;break;case"utf8":this.fillLast=m,B=4;break;case"base64":this.text=w,this.end=O,B=3;break;default:this.write=I,this.end=N;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(B)}a.prototype.write=function(P){if(P.length===0)return"";var B,x;if(this.lastNeed){if(B=this.fillLast(P),B===void 0)return"";x=this.lastNeed,this.lastNeed=0}else x=0;return x<P.length?B?B+this.text(P,x):this.text(P,x):B||""},a.prototype.end=b,a.prototype.text=_,a.prototype.fillLast=function(P){if(this.lastNeed<=P.length)return P.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);P.copy(this.lastChar,this.lastTotal-this.lastNeed,0,P.length),this.lastNeed-=P.length};function c(P){return P<=127?0:P>>5===6?2:P>>4===14?3:P>>3===30?4:P>>6===2?-1:-2}function u(P,B,x){var F=B.length-1;if(F<x)return 0;var k=c(B[F]);return k>=0?(k>0&&(P.lastNeed=k-1),k):--F<x||k===-2?0:(k=c(B[F]),k>=0?(k>0&&(P.lastNeed=k-2),k):--F<x||k===-2?0:(k=c(B[F]),k>=0?(k>0&&(k===2?k=0:P.lastNeed=k-3),k):0))}function d(P,B,x){if((B[0]&192)!==128)return P.lastNeed=0,"";if(P.lastNeed>1&&B.length>1){if((B[1]&192)!==128)return P.lastNeed=1,"";if(P.lastNeed>2&&B.length>2&&(B[2]&192)!==128)return P.lastNeed=2,""}}function m(P){var B=this.lastTotal-this.lastNeed,x=d(this,P);if(x!==void 0)return x;if(this.lastNeed<=P.length)return P.copy(this.lastChar,B,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);P.copy(this.lastChar,B,0,P.length),this.lastNeed-=P.length}function _(P,B){var x=u(this,P,B);if(!this.lastNeed)return P.toString("utf8",B);this.lastTotal=x;var F=P.length-(x-this.lastNeed);return P.copy(this.lastChar,0,F),P.toString("utf8",B,F)}function b(P){var B=P&&P.length?this.write(P):"";return this.lastNeed?B+"":B}function S(P,B){if((P.length-B)%2===0){var x=P.toString("utf16le",B);if(x){var F=x.charCodeAt(x.length-1);if(F>=55296&&F<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=P[P.length-2],this.lastChar[1]=P[P.length-1],x.slice(0,-1)}return x}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=P[P.length-1],P.toString("utf16le",B,P.length-1)}function C(P){var B=P&&P.length?this.write(P):"";if(this.lastNeed){var x=this.lastTotal-this.lastNeed;return B+this.lastChar.toString("utf16le",0,x)}return B}function w(P,B){var x=(P.length-B)%3;return x===0?P.toString("base64",B):(this.lastNeed=3-x,this.lastTotal=3,x===1?this.lastChar[0]=P[P.length-1]:(this.lastChar[0]=P[P.length-2],this.lastChar[1]=P[P.length-1]),P.toString("base64",B,P.length-x))}function O(P){var B=P&&P.length?this.write(P):"";return this.lastNeed?B+this.lastChar.toString("base64",0,3-this.lastNeed):B}function I(P){return P.toString(this.encoding)}function N(P){return P&&P.length?this.write(P):""}return string_decoder}var ERR_STREAM_PREMATURE_CLOSE=errorsBrowser.codes.ERR_STREAM_PREMATURE_CLOSE;function once$1(n){var e=!1;return function(){if(!e){e=!0;for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];n.apply(this,s)}}}function noop$1(){}function isRequest$1(n){return n.setHeader&&typeof n.abort=="function"}function eos$1(n,e,t){if(typeof e=="function")return eos$1(n,null,e);e||(e={}),t=once$1(t||noop$1);var s=e.readable||e.readable!==!1&&n.readable,a=e.writable||e.writable!==!1&&n.writable,c=function(){n.writable||d()},u=n._writableState&&n._writableState.finished,d=function(){a=!1,u=!0,s||t.call(n)},m=n._readableState&&n._readableState.endEmitted,_=function(){s=!1,m=!0,a||t.call(n)},b=function(O){t.call(n,O)},S=function(){var O;if(s&&!m)return(!n._readableState||!n._readableState.ended)&&(O=new ERR_STREAM_PREMATURE_CLOSE),t.call(n,O);if(a&&!u)return(!n._writableState||!n._writableState.ended)&&(O=new ERR_STREAM_PREMATURE_CLOSE),t.call(n,O)},C=function(){n.req.on("finish",d)};return isRequest$1(n)?(n.on("complete",d),n.on("abort",S),n.req?C():n.on("request",C)):a&&!n._writableState&&(n.on("end",c),n.on("close",c)),n.on("end",_),n.on("finish",d),e.error!==!1&&n.on("error",b),n.on("close",S),function(){n.removeListener("complete",d),n.removeListener("abort",S),n.removeListener("request",C),n.req&&n.req.removeListener("finish",d),n.removeListener("end",c),n.removeListener("close",c),n.removeListener("finish",d),n.removeListener("end",_),n.removeListener("error",b),n.removeListener("close",S)}}var endOfStream=eos$1,async_iterator,hasRequiredAsync_iterator;function requireAsync_iterator(){if(hasRequiredAsync_iterator)return async_iterator;hasRequiredAsync_iterator=1;var n;function e(x,F,k){return F=t(F),F in x?Object.defineProperty(x,F,{value:k,enumerable:!0,configurable:!0,writable:!0}):x[F]=k,x}function t(x){var F=s(x,"string");return typeof F=="symbol"?F:String(F)}function s(x,F){if(typeof x!="object"||x===null)return x;var k=x[Symbol.toPrimitive];if(k!==void 0){var J=k.call(x,F||"default");if(typeof J!="object")return J;throw new TypeError("@@toPrimitive must return a primitive value.")}return(F==="string"?String:Number)(x)}var a=endOfStream,c=Symbol("lastResolve"),u=Symbol("lastReject"),d=Symbol("error"),m=Symbol("ended"),_=Symbol("lastPromise"),b=Symbol("handlePromise"),S=Symbol("stream");function C(x,F){return{value:x,done:F}}function w(x){var F=x[c];if(F!==null){var k=x[S].read();k!==null&&(x[_]=null,x[c]=null,x[u]=null,F(C(k,!1)))}}function O(x){dist.process.nextTick(w,x)}function I(x,F){return function(k,J){x.then(function(){if(F[m]){k(C(void 0,!0));return}F[b](k,J)},J)}}var N=Object.getPrototypeOf(function(){}),P=Object.setPrototypeOf((n={get stream(){return this[S]},next:function(){var F=this,k=this[d];if(k!==null)return Promise.reject(k);if(this[m])return Promise.resolve(C(void 0,!0));if(this[S].destroyed)return new Promise(function(W,X){dist.process.nextTick(function(){F[d]?X(F[d]):W(C(void 0,!0))})});var J=this[_],z;if(J)z=new Promise(I(J,this));else{var H=this[S].read();if(H!==null)return Promise.resolve(C(H,!1));z=new Promise(this[b])}return this[_]=z,z}},e(n,Symbol.asyncIterator,function(){return this}),e(n,"return",function(){var F=this;return new Promise(function(k,J){F[S].destroy(null,function(z){if(z){J(z);return}k(C(void 0,!0))})})}),n),N),B=function(F){var k,J=Object.create(P,(k={},e(k,S,{value:F,writable:!0}),e(k,c,{value:null,writable:!0}),e(k,u,{value:null,writable:!0}),e(k,d,{value:null,writable:!0}),e(k,m,{value:F._readableState.endEmitted,writable:!0}),e(k,b,{value:function(H,W){var X=J[S].read();X?(J[_]=null,J[c]=null,J[u]=null,H(C(X,!1))):(J[c]=H,J[u]=W)},writable:!0}),k));return J[_]=null,a(F,function(z){if(z&&z.code!=="ERR_STREAM_PREMATURE_CLOSE"){var H=J[u];H!==null&&(J[_]=null,J[c]=null,J[u]=null,H(z)),J[d]=z;return}var W=J[c];W!==null&&(J[_]=null,J[c]=null,J[u]=null,W(C(void 0,!0))),J[m]=!0}),F.on("readable",O.bind(null,J)),J};return async_iterator=B,async_iterator}var fromBrowser,hasRequiredFromBrowser;function requireFromBrowser(){return hasRequiredFromBrowser||(hasRequiredFromBrowser=1,fromBrowser=function(){throw new Error("Readable.from is not available in the browser")}),fromBrowser}var _stream_readable,hasRequired_stream_readable;function require_stream_readable(){if(hasRequired_stream_readable)return _stream_readable;hasRequired_stream_readable=1,_stream_readable=W;var n;W.ReadableState=H,eventsExports.EventEmitter;var e=function(V,q){return V.listeners(q).length},t=streamBrowser,s=buffer.Buffer,a=(typeof commonjsGlobal$1<"u"?commonjsGlobal$1:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function c(U){return s.from(U)}function u(U){return s.isBuffer(U)||U instanceof a}var d=util,m;d&&d.debuglog?m=d.debuglog("stream"):m=function(){};var _=requireBuffer_list(),b=destroy_1,S=state,C=S.getHighWaterMark,w=errorsBrowser.codes,O=w.ERR_INVALID_ARG_TYPE,I=w.ERR_STREAM_PUSH_AFTER_EOF,N=w.ERR_METHOD_NOT_IMPLEMENTED,P=w.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,B,x,F;inherits_browserExports(W,t);var k=b.errorOrDestroy,J=["error","close","destroy","pause","resume"];function z(U,V,q){if(typeof U.prependListener=="function")return U.prependListener(V,q);!U._events||!U._events[V]?U.on(V,q):Array.isArray(U._events[V])?U._events[V].unshift(q):U._events[V]=[q,U._events[V]]}function H(U,V,q){n=n||require_stream_duplex(),U=U||{},typeof q!="boolean"&&(q=V instanceof n),this.objectMode=!!U.objectMode,q&&(this.objectMode=this.objectMode||!!U.readableObjectMode),this.highWaterMark=C(this,U,"readableHighWaterMark",q),this.buffer=new _,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=U.emitClose!==!1,this.autoDestroy=!!U.autoDestroy,this.destroyed=!1,this.defaultEncoding=U.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,U.encoding&&(B||(B=requireString_decoder().StringDecoder),this.decoder=new B(U.encoding),this.encoding=U.encoding)}function W(U){if(n=n||require_stream_duplex(),!(this instanceof W))return new W(U);var V=this instanceof n;this._readableState=new H(U,this,V),this.readable=!0,U&&(typeof U.read=="function"&&(this._read=U.read),typeof U.destroy=="function"&&(this._destroy=U.destroy)),t.call(this)}Object.defineProperty(W.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(V){this._readableState&&(this._readableState.destroyed=V)}}),W.prototype.destroy=b.destroy,W.prototype._undestroy=b.undestroy,W.prototype._destroy=function(U,V){V(U)},W.prototype.push=function(U,V){var q=this._readableState,ie;return q.objectMode?ie=!0:typeof U=="string"&&(V=V||q.defaultEncoding,V!==q.encoding&&(U=s.from(U,V),V=""),ie=!0),X(this,U,V,!1,ie)},W.prototype.unshift=function(U){return X(this,U,null,!0,!1)};function X(U,V,q,ie,ge){m("readableAddChunk",V);var pe=U._readableState;if(V===null)pe.reading=!1,me(U,pe);else{var ye;if(ge||(ye=re(pe,V)),ye)k(U,ye);else if(pe.objectMode||V&&V.length>0)if(typeof V!="string"&&!pe.objectMode&&Object.getPrototypeOf(V)!==s.prototype&&(V=c(V)),ie)pe.endEmitted?k(U,new P):se(U,pe,V,!0);else if(pe.ended)k(U,new I);else{if(pe.destroyed)return!1;pe.reading=!1,pe.decoder&&!q?(V=pe.decoder.write(V),pe.objectMode||V.length!==0?se(U,pe,V,!1):fe(U,pe)):se(U,pe,V,!1)}else ie||(pe.reading=!1,fe(U,pe))}return!pe.ended&&(pe.length<pe.highWaterMark||pe.length===0)}function se(U,V,q,ie){V.flowing&&V.length===0&&!V.sync?(V.awaitDrain=0,U.emit("data",q)):(V.length+=V.objectMode?1:q.length,ie?V.buffer.unshift(q):V.buffer.push(q),V.needReadable&&le(U)),fe(U,V)}function re(U,V){var q;return!u(V)&&typeof V!="string"&&V!==void 0&&!U.objectMode&&(q=new O("chunk",["string","Buffer","Uint8Array"],V)),q}W.prototype.isPaused=function(){return this._readableState.flowing===!1},W.prototype.setEncoding=function(U){B||(B=requireString_decoder().StringDecoder);var V=new B(U);this._readableState.decoder=V,this._readableState.encoding=this._readableState.decoder.encoding;for(var q=this._readableState.buffer.head,ie="";q!==null;)ie+=V.write(q.data),q=q.next;return this._readableState.buffer.clear(),ie!==""&&this._readableState.buffer.push(ie),this._readableState.length=ie.length,this};var ue=1073741824;function de(U){return U>=ue?U=ue:(U--,U|=U>>>1,U|=U>>>2,U|=U>>>4,U|=U>>>8,U|=U>>>16,U++),U}function he(U,V){return U<=0||V.length===0&&V.ended?0:V.objectMode?1:U!==U?V.flowing&&V.length?V.buffer.head.data.length:V.length:(U>V.highWaterMark&&(V.highWaterMark=de(U)),U<=V.length?U:V.ended?V.length:(V.needReadable=!0,0))}W.prototype.read=function(U){m("read",U),U=parseInt(U,10);var V=this._readableState,q=U;if(U!==0&&(V.emittedReadable=!1),U===0&&V.needReadable&&((V.highWaterMark!==0?V.length>=V.highWaterMark:V.length>0)||V.ended))return m("read: emitReadable",V.length,V.ended),V.length===0&&V.ended?Q(this):le(this),null;if(U=he(U,V),U===0&&V.ended)return V.length===0&&Q(this),null;var ie=V.needReadable;m("need readable",ie),(V.length===0||V.length-U<V.highWaterMark)&&(ie=!0,m("length less than watermark",ie)),V.ended||V.reading?(ie=!1,m("reading or ended",ie)):ie&&(m("do read"),V.reading=!0,V.sync=!0,V.length===0&&(V.needReadable=!0),this._read(V.highWaterMark),V.sync=!1,V.reading||(U=he(q,V)));var ge;return U>0?ge=K(U,V):ge=null,ge===null?(V.needReadable=V.length<=V.highWaterMark,U=0):(V.length-=U,V.awaitDrain=0),V.length===0&&(V.ended||(V.needReadable=!0),q!==U&&V.ended&&Q(this)),ge!==null&&this.emit("data",ge),ge};function me(U,V){if(m("onEofChunk"),!V.ended){if(V.decoder){var q=V.decoder.end();q&&q.length&&(V.buffer.push(q),V.length+=V.objectMode?1:q.length)}V.ended=!0,V.sync?le(U):(V.needReadable=!1,V.emittedReadable||(V.emittedReadable=!0,_e(U)))}}function le(U){var V=U._readableState;m("emitReadable",V.needReadable,V.emittedReadable),V.needReadable=!1,V.emittedReadable||(m("emitReadable",V.flowing),V.emittedReadable=!0,dist.process.nextTick(_e,U))}function _e(U){var V=U._readableState;m("emitReadable_",V.destroyed,V.length,V.ended),!V.destroyed&&(V.length||V.ended)&&(U.emit("readable"),V.emittedReadable=!1),V.needReadable=!V.flowing&&!V.ended&&V.length<=V.highWaterMark,Y(U)}function fe(U,V){V.readingMore||(V.readingMore=!0,dist.process.nextTick(ve,U,V))}function ve(U,V){for(;!V.reading&&!V.ended&&(V.length<V.highWaterMark||V.flowing&&V.length===0);){var q=V.length;if(m("maybeReadMore read 0"),U.read(0),q===V.length)break}V.readingMore=!1}W.prototype._read=function(U){k(this,new N("_read()"))},W.prototype.pipe=function(U,V){var q=this,ie=this._readableState;switch(ie.pipesCount){case 0:ie.pipes=U;break;case 1:ie.pipes=[ie.pipes,U];break;default:ie.pipes.push(U);break}ie.pipesCount+=1,m("pipe count=%d opts=%j",ie.pipesCount,V);var ge=(!V||V.end!==!1)&&U!==dist.process.stdout&&U!==dist.process.stderr,pe=ge?be:Ee;ie.endEmitted?dist.process.nextTick(pe):q.once("end",pe),U.on("unpipe",ye);function ye(Se,Te){m("onunpipe"),Se===q&&Te&&Te.hasUnpiped===!1&&(Te.hasUnpiped=!0,Oe())}function be(){m("onend"),U.end()}var ee=ne(q);U.on("drain",ee);var Re=!1;function Oe(){m("cleanup"),U.removeListener("close",ke),U.removeListener("finish",we),U.removeListener("drain",ee),U.removeListener("error",Ae),U.removeListener("unpipe",ye),q.removeListener("end",be),q.removeListener("end",Ee),q.removeListener("data",Pe),Re=!0,ie.awaitDrain&&(!U._writableState||U._writableState.needDrain)&&ee()}q.on("data",Pe);function Pe(Se){m("ondata");var Te=U.write(Se);m("dest.write",Te),Te===!1&&((ie.pipesCount===1&&ie.pipes===U||ie.pipesCount>1&&oe(ie.pipes,U)!==-1)&&!Re&&(m("false write response, pause",ie.awaitDrain),ie.awaitDrain++),q.pause())}function Ae(Se){m("onerror",Se),Ee(),U.removeListener("error",Ae),e(U,"error")===0&&k(U,Se)}z(U,"error",Ae);function ke(){U.removeListener("finish",we),Ee()}U.once("close",ke);function we(){m("onfinish"),U.removeListener("close",ke),Ee()}U.once("finish",we);function Ee(){m("unpipe"),q.unpipe(U)}return U.emit("pipe",q),ie.flowing||(m("pipe resume"),q.resume()),U};function ne(U){return function(){var q=U._readableState;m("pipeOnDrain",q.awaitDrain),q.awaitDrain&&q.awaitDrain--,q.awaitDrain===0&&e(U,"data")&&(q.flowing=!0,Y(U))}}W.prototype.unpipe=function(U){var V=this._readableState,q={hasUnpiped:!1};if(V.pipesCount===0)return this;if(V.pipesCount===1)return U&&U!==V.pipes?this:(U||(U=V.pipes),V.pipes=null,V.pipesCount=0,V.flowing=!1,U&&U.emit("unpipe",this,q),this);if(!U){var ie=V.pipes,ge=V.pipesCount;V.pipes=null,V.pipesCount=0,V.flowing=!1;for(var pe=0;pe<ge;pe++)ie[pe].emit("unpipe",this,{hasUnpiped:!1});return this}var ye=oe(V.pipes,U);return ye===-1?this:(V.pipes.splice(ye,1),V.pipesCount-=1,V.pipesCount===1&&(V.pipes=V.pipes[0]),U.emit("unpipe",this,q),this)},W.prototype.on=function(U,V){var q=t.prototype.on.call(this,U,V),ie=this._readableState;return U==="data"?(ie.readableListening=this.listenerCount("readable")>0,ie.flowing!==!1&&this.resume()):U==="readable"&&!ie.endEmitted&&!ie.readableListening&&(ie.readableListening=ie.needReadable=!0,ie.flowing=!1,ie.emittedReadable=!1,m("on readable",ie.length,ie.reading),ie.length?le(this):ie.reading||dist.process.nextTick($,this)),q},W.prototype.addListener=W.prototype.on,W.prototype.removeListener=function(U,V){var q=t.prototype.removeListener.call(this,U,V);return U==="readable"&&dist.process.nextTick(j,this),q},W.prototype.removeAllListeners=function(U){var V=t.prototype.removeAllListeners.apply(this,arguments);return(U==="readable"||U===void 0)&&dist.process.nextTick(j,this),V};function j(U){var V=U._readableState;V.readableListening=U.listenerCount("readable")>0,V.resumeScheduled&&!V.paused?V.flowing=!0:U.listenerCount("data")>0&&U.resume()}function $(U){m("readable nexttick read 0"),U.read(0)}W.prototype.resume=function(){var U=this._readableState;return U.flowing||(m("resume"),U.flowing=!U.readableListening,Z(this,U)),U.paused=!1,this};function Z(U,V){V.resumeScheduled||(V.resumeScheduled=!0,dist.process.nextTick(ce,U,V))}function ce(U,V){m("resume",V.reading),V.reading||U.read(0),V.resumeScheduled=!1,U.emit("resume"),Y(U),V.flowing&&!V.reading&&U.read(0)}W.prototype.pause=function(){return m("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(m("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function Y(U){var V=U._readableState;for(m("flow",V.flowing);V.flowing&&U.read()!==null;);}W.prototype.wrap=function(U){var V=this,q=this._readableState,ie=!1;U.on("end",function(){if(m("wrapped end"),q.decoder&&!q.ended){var ye=q.decoder.end();ye&&ye.length&&V.push(ye)}V.push(null)}),U.on("data",function(ye){if(m("wrapped data"),q.decoder&&(ye=q.decoder.write(ye)),!(q.objectMode&&ye==null)&&!(!q.objectMode&&(!ye||!ye.length))){var be=V.push(ye);be||(ie=!0,U.pause())}});for(var ge in U)this[ge]===void 0&&typeof U[ge]=="function"&&(this[ge]=function(be){return function(){return U[be].apply(U,arguments)}}(ge));for(var pe=0;pe<J.length;pe++)U.on(J[pe],this.emit.bind(this,J[pe]));return this._read=function(ye){m("wrapped _read",ye),ie&&(ie=!1,U.resume())},this},typeof Symbol=="function"&&(W.prototype[Symbol.asyncIterator]=function(){return x===void 0&&(x=requireAsync_iterator()),x(this)}),Object.defineProperty(W.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(W.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(W.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(V){this._readableState&&(this._readableState.flowing=V)}}),W._fromList=K,Object.defineProperty(W.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function K(U,V){if(V.length===0)return null;var q;return V.objectMode?q=V.buffer.shift():!U||U>=V.length?(V.decoder?q=V.buffer.join(""):V.buffer.length===1?q=V.buffer.first():q=V.buffer.concat(V.length),V.buffer.clear()):q=V.buffer.consume(U,V.decoder),q}function Q(U){var V=U._readableState;m("endReadable",V.endEmitted),V.endEmitted||(V.ended=!0,dist.process.nextTick(te,V,U))}function te(U,V){if(m("endReadableNT",U.endEmitted,U.length),!U.endEmitted&&U.length===0&&(U.endEmitted=!0,V.readable=!1,V.emit("end"),U.autoDestroy)){var q=V._writableState;(!q||q.autoDestroy&&q.finished)&&V.destroy()}}typeof Symbol=="function"&&(W.from=function(U,V){return F===void 0&&(F=requireFromBrowser()),F(W,U,V)});function oe(U,V){for(var q=0,ie=U.length;q<ie;q++)if(U[q]===V)return q;return-1}return _stream_readable}var _stream_transform=Transform$1,_require$codes$1=errorsBrowser.codes,ERR_METHOD_NOT_IMPLEMENTED=_require$codes$1.ERR_METHOD_NOT_IMPLEMENTED,ERR_MULTIPLE_CALLBACK=_require$codes$1.ERR_MULTIPLE_CALLBACK,ERR_TRANSFORM_ALREADY_TRANSFORMING=_require$codes$1.ERR_TRANSFORM_ALREADY_TRANSFORMING,ERR_TRANSFORM_WITH_LENGTH_0=_require$codes$1.ERR_TRANSFORM_WITH_LENGTH_0,Duplex=require_stream_duplex();inherits_browserExports(Transform$1,Duplex);function afterTransform(n,e){var t=this._transformState;t.transforming=!1;var s=t.writecb;if(s===null)return this.emit("error",new ERR_MULTIPLE_CALLBACK);t.writechunk=null,t.writecb=null,e!=null&&this.push(e),s(n);var a=this._readableState;a.reading=!1,(a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}function Transform$1(n){if(!(this instanceof Transform$1))return new Transform$1(n);Duplex.call(this,n),this._transformState={afterTransform:afterTransform.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,n&&(typeof n.transform=="function"&&(this._transform=n.transform),typeof n.flush=="function"&&(this._flush=n.flush)),this.on("prefinish",prefinish)}function prefinish(){var n=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(e,t){done(n,e,t)}):done(this,null,null)}Transform$1.prototype.push=function(n,e){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,n,e)};Transform$1.prototype._transform=function(n,e,t){t(new ERR_METHOD_NOT_IMPLEMENTED("_transform()"))};Transform$1.prototype._write=function(n,e,t){var s=this._transformState;if(s.writecb=t,s.writechunk=n,s.writeencoding=e,!s.transforming){var a=this._readableState;(s.needTransform||a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}};Transform$1.prototype._read=function(n){var e=this._transformState;e.writechunk!==null&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};Transform$1.prototype._destroy=function(n,e){Duplex.prototype._destroy.call(this,n,function(t){e(t)})};function done(n,e,t){if(e)return n.emit("error",e);if(t!=null&&n.push(t),n._writableState.length)throw new ERR_TRANSFORM_WITH_LENGTH_0;if(n._transformState.transforming)throw new ERR_TRANSFORM_ALREADY_TRANSFORMING;return n.push(null)}var _stream_passthrough=PassThrough,Transform=_stream_transform;inherits_browserExports(PassThrough,Transform);function PassThrough(n){if(!(this instanceof PassThrough))return new PassThrough(n);Transform.call(this,n)}PassThrough.prototype._transform=function(n,e,t){t(null,n)};var eos;function once(n){var e=!1;return function(){e||(e=!0,n.apply(void 0,arguments))}}var _require$codes=errorsBrowser.codes,ERR_MISSING_ARGS=_require$codes.ERR_MISSING_ARGS,ERR_STREAM_DESTROYED=_require$codes.ERR_STREAM_DESTROYED;function noop(n){if(n)throw n}function isRequest(n){return n.setHeader&&typeof n.abort=="function"}function destroyer(n,e,t,s){s=once(s);var a=!1;n.on("close",function(){a=!0}),eos===void 0&&(eos=endOfStream),eos(n,{readable:e,writable:t},function(u){if(u)return s(u);a=!0,s()});var c=!1;return function(u){if(!a&&!c){if(c=!0,isRequest(n))return n.abort();if(typeof n.destroy=="function")return n.destroy();s(u||new ERR_STREAM_DESTROYED("pipe"))}}}function call(n){n()}function pipe(n,e){return n.pipe(e)}function popCallback(n){return!n.length||typeof n[n.length-1]!="function"?noop:n.pop()}function pipeline(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];var s=popCallback(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new ERR_MISSING_ARGS("streams");var a,c=e.map(function(u,d){var m=d<e.length-1,_=d>0;return destroyer(u,m,_,function(b){a||(a=b),b&&c.forEach(call),!m&&(c.forEach(call),s(a))})});return e.reduce(pipe)}var pipeline_1=pipeline;(function(n,e){e=n.exports=require_stream_readable(),e.Stream=e,e.Readable=e,e.Writable=require_stream_writable(),e.Duplex=require_stream_duplex(),e.Transform=_stream_transform,e.PassThrough=_stream_passthrough,e.finished=endOfStream,e.pipeline=pipeline_1})(readableBrowser,readableBrowser.exports);var readableBrowserExports=readableBrowser.exports;/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let promise;var queueMicrotask_1=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:commonjsGlobal$1):n=>(promise||(promise=Promise.resolve())).then(n).catch(e=>setTimeout(()=>{throw e},0));function assign(n,e){for(const t in e)Object.defineProperty(n,t,{value:e[t],enumerable:!0,configurable:!0});return n}function createError(n,e,t){if(!n||typeof n=="string")throw new TypeError("Please pass an Error to err-code");t||(t={}),typeof e=="object"&&(t=e,e=""),e&&(t.code=e);try{return assign(n,t)}catch{t.message=n.message,t.stack=n.stack;const a=function(){};return a.prototype=Object.create(Object.getPrototypeOf(n)),assign(new a,t)}}var errCode$1=createError;/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const debug=browserExports$1("simple-peer"),getBrowserRTC=getBrowserRtc,randombytes=browserExports,stream=readableBrowserExports,queueMicrotask$1=queueMicrotask_1,errCode=errCode$1,{Buffer}=buffer,MAX_BUFFERED_AMOUNT=64*1024,ICECOMPLETE_TIMEOUT=5*1e3,CHANNEL_CLOSING_TIMEOUT=5*1e3;function filterTrickle(n){return n.replace(/a=ice-options:trickle\s\n/g,"")}function warn(n){console.warn(n)}class Peer extends stream.Duplex{constructor(e){if(e=Object.assign({allowHalfOpen:!1},e),super(e),this._id=randombytes(4).toString("hex").slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||randombytes(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||Peer.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},Peer.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(t=>t),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||ICECOMPLETE_TIMEOUT,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&typeof e.wrtc=="object"?e.wrtc:getBrowserRTC(),!this._wrtc)throw errCode(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(t){this.destroy(errCode(t,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=t=>{this._onIceCandidate(t)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(t=>{this.destroy(errCode(t,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=t=>{this._setupData(t)},this.streams&&this.streams.forEach(t=>{this.addStream(t)}),this._pc.ontrack=t=>{this._onTrack(t)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this.destroying){if(this.destroyed)throw errCode(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof e=="string")try{e=JSON.parse(e)}catch{e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(t=>{this._addIceCandidate(t)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(t=>{this.destroy(errCode(t,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.destroy(errCode(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const t=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(t).catch(s=>{!t.address||t.address.endsWith(".local")?warn("Ignoring unsupported ICE candidate."):this.destroy(errCode(s,"ERR_ADD_ICE_CANDIDATE"))})}send(e){if(!this.destroying){if(this.destroyed)throw errCode(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}addTransceiver(e,t){if(!this.destroying){if(this.destroyed)throw errCode(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(s){this.destroy(errCode(s,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:t}})}}addStream(e){if(!this.destroying){if(this.destroyed)throw errCode(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach(t=>{this.addTrack(t,e)})}}addTrack(e,t){if(this.destroying)return;if(this.destroyed)throw errCode(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const s=this._senderMap.get(e)||new Map;let a=s.get(t);if(!a)a=this._pc.addTrack(e,t),s.set(t,a),this._senderMap.set(e,s),this._needsNegotiation();else throw a.removed?errCode(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):errCode(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(e,t,s){if(this.destroying)return;if(this.destroyed)throw errCode(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const a=this._senderMap.get(e),c=a?a.get(s):null;if(!c)throw errCode(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,a),c.replaceTrack!=null?c.replaceTrack(t):this.destroy(errCode(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,t){if(this.destroying)return;if(this.destroyed)throw errCode(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const s=this._senderMap.get(e),a=s?s.get(t):null;if(!a)throw errCode(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{a.removed=!0,this._pc.removeTrack(a)}catch(c){c.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(a):this.destroy(errCode(c,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){if(!this.destroying){if(this.destroyed)throw errCode(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach(t=>{this.removeTrack(t,e)})}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,queueMicrotask$1(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw errCode(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(e){this._destroy(e,()=>{})}_destroy(e,t){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),queueMicrotask$1(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close"),t()}))}_setupData(e){if(!e.channel)return this.destroy(errCode(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=MAX_BUFFERED_AMOUNT),this.channelName=this._channel.label,this._channel.onmessage=s=>{this._onChannelMessage(s)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=s=>{const a=s.error instanceof Error?s.error:new Error(`Datachannel error: ${s.message} ${s.filename}:${s.lineno}:${s.colno}`);this.destroy(errCode(a,"ERR_DATA_CHANNEL"))};let t=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(t&&this._onChannelClose(),t=!0):t=!1},CHANNEL_CLOSING_TIMEOUT)}_read(){}_write(e,t,s){if(this.destroyed)return s(errCode(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(a){return this.destroy(errCode(a,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>MAX_BUFFERED_AMOUNT?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=s):s(null)}else this._debug("write before connect"),this._chunk=e,this._cb=s}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=filterTrickle(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;const c=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:c.type,sdp:c.sdp})},s=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))},a=c=>{this.destroy(errCode(c,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(s).catch(a)}).catch(e=>{this.destroy(errCode(e,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(e=>{!e.mid&&e.sender.track&&!e.requested&&(e.requested=!0,this.addTransceiver(e.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=filterTrickle(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;const c=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:c.type,sdp:c.sdp}),this.initiator||this._requestMissingTransceivers()},s=()=>{this.destroyed||(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))},a=c=>{this.destroy(errCode(c,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(s).catch(a)}).catch(e=>{this.destroy(errCode(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(errCode(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.destroy(errCode(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.destroy(errCode(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const t=s=>(Object.prototype.toString.call(s.values)==="[object Array]"&&s.values.forEach(a=>{Object.assign(s,a)}),s);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(s=>{const a=[];s.forEach(c=>{a.push(t(c))}),e(null,a)},s=>e(s)):this._pc.getStats.length>0?this._pc.getStats(s=>{if(this.destroyed)return;const a=[];s.result().forEach(c=>{const u={};c.names().forEach(d=>{u[d]=c.stat(d)}),u.id=c.id,u.type=c.type,u.timestamp=c.timestamp,a.push(t(u))}),e(null,a)},s=>e(s)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this.getStats((t,s)=>{if(this.destroyed)return;t&&(s=[]);const a={},c={},u={};let d=!1;s.forEach(_=>{(_.type==="remotecandidate"||_.type==="remote-candidate")&&(a[_.id]=_),(_.type==="localcandidate"||_.type==="local-candidate")&&(c[_.id]=_),(_.type==="candidatepair"||_.type==="candidate-pair")&&(u[_.id]=_)});const m=_=>{d=!0;let b=c[_.localCandidateId];b&&(b.ip||b.address)?(this.localAddress=b.ip||b.address,this.localPort=Number(b.port)):b&&b.ipAddress?(this.localAddress=b.ipAddress,this.localPort=Number(b.portNumber)):typeof _.googLocalAddress=="string"&&(b=_.googLocalAddress.split(":"),this.localAddress=b[0],this.localPort=Number(b[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let S=a[_.remoteCandidateId];S&&(S.ip||S.address)?(this.remoteAddress=S.ip||S.address,this.remotePort=Number(S.port)):S&&S.ipAddress?(this.remoteAddress=S.ipAddress,this.remotePort=Number(S.portNumber)):typeof _.googRemoteAddress=="string"&&(S=_.googRemoteAddress.split(":"),this.remoteAddress=S[0],this.remotePort=Number(S[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(s.forEach(_=>{_.type==="transport"&&_.selectedCandidatePairId&&m(u[_.selectedCandidatePairId]),(_.type==="googCandidatePair"&&_.googActiveConnection==="true"||(_.type==="candidatepair"||_.type==="candidate-pair")&&_.selected)&&m(_)}),!d&&(!Object.keys(u).length||Object.keys(c).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(b){return this.destroy(errCode(b,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const _=this._cb;this._cb=null,_(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>MAX_BUFFERED_AMOUNT||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let t=e.data;t instanceof ArrayBuffer&&(t=Buffer.from(t)),this.push(t)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(e){this.destroyed||e.streams.forEach(t=>{this._debug("on track"),this.emit("track",e.track,t),this._remoteTracks.push({track:e.track,stream:t}),!this._remoteStreams.some(s=>s.id===t.id)&&(this._remoteStreams.push(t),queueMicrotask$1(()=>{this._debug("on stream"),this.emit("stream",t)}))})}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],debug.apply(null,e)}}Peer.WEBRTC_SUPPORT=!!getBrowserRTC();Peer.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};Peer.channelConfig={};var simplePeer=Peer;const SimplePeer=getDefaultExportFromCjs$1(simplePeer);let globalConnId=0;class SimplePeerConnection{constructor(){ae(this,"lastMsgRecivedTimestamp");ae(this,"connectionState",nStore(ConnectionStates.init));ae(this,"latestRecivedDataMessage",nStore(null));ae(this,"outgoingSignalingMessages",nStore(null));ae(this,"remoteVideoStreams",nStore(new Map));ae(this,"_p");ae(this,"_spConfig",null);ae(this,"_msgSendQueue",[]);ae(this,"_reconnectAttemptCount");ae(this,"_shouldReconnect");ae(this,"_initiator",!1);ae(this,"_connectionId",-1);ae(this,"_signalMsgSendCounter",0);ae(this,"_signalMsgRecivedCounter",0)}start(e,t=!0,s=0){this._shouldReconnect=t,this._spConfig=Object.assign({},e,SimplePeer.config),console.debug("SIMPLEPEER: starting with opts: ",this._spConfig),this._spConfig.initiator&&(this._connectionId=globalConnId++),this._p=new SimplePeer(this._spConfig),this._p._debug=(...a)=>console.debug("SIMPLEPEER DEBUG: "+a[0],...a.slice(1)),this._reconnectAttemptCount=s,this._initiator=this._spConfig.initiator||!1,this.connectionState.set(ConnectionStates.connecting),this._p.on("signal",a=>{if(this._signalMsgSendCounter++,this._connectionId===-1)return console.warn("SIMPLEPEER: sending signal message when connectionId is null, this should not happen!");a=Object.assign({},a,{connId:this._connectionId,msgNum:this._signalMsgSendCounter}),console.debug("SIMPLEPEER: signal out",a),this.outgoingSignalingMessages.set(JSON.stringify(a))}),this._p.on("connect",()=>{console.info("SIMPLEPEER: Connected"),this._emptyMsgQueue(),this._reconnectAttemptCount=0,this.connectionState.set(ConnectionStates.connected)}),this._p.on("data",a=>{this.lastMsgRecivedTimestamp=Date.now(),this.latestRecivedDataMessage.set(a)}),this._p.on("stream",a=>{console.info("SIMPLEPEER: got video stream: ",a),this.remoteVideoStreams.update(c=>(c.set(a.id,a),c))}),this._p.on("close",()=>{console.warn("SIMPLEPEER: connection closed"),this.stop()}),this._p.on("error",a=>{this.resetConnectionStats(),console.error("SIMPLEPEER: error ",a),this.connectionState.set(ConnectionStates.failed)})}resetConnectionStats(){this._connectionId=-1,this._signalMsgRecivedCounter=0,this._signalMsgSendCounter=0}stop(){this.resetConnectionStats(),this.connectionState.set(ConnectionStates.disconnectedOk),this.remoteVideoStreams.set(new Map),this._shouldReconnect=!1,this._p&&this._p.destroy()}restart(e,t){this.stop(),this._connectionId=e||-1,this.start(this._spConfig,this._shouldReconnect,this._reconnectAttemptCount),t&&this.ingestSignalingMsg(t)}ingestSignalingMsg(e){try{const t=JSON.parse(e);if(console.info("SIMPLEPEER: signal in",t,t.connId,this._connectionId),this._p.destroyed)return this.restart(t.connId,e);if(this._connectionId===-1)this._connectionId=t.connId;else if(t.connId<this._connectionId){console.log("SP: Err Older Remote ConnId!",t.connId,"<",this._connectionId);return}else if(t.connId>this._connectionId){this._initiator?console.log("SP: Err Newer Remote ConnId!",t.connId,">",this._connectionId):this.restart(t.connId,e);return}if(t.msgNum<=this._signalMsgRecivedCounter){console.log("SP: Invalid MsgNum Order!",t.msgNum,"<=",this._signalMsgRecivedCounter);return}this._signalMsgRecivedCounter=t.msgNum,this._p.signal(t)}catch(t){console.warn("failed to parse & ingest simplepeer signalling message: ",e,t.message)}}sendMessage(e){this._msgSendQueue.push(e),this._emptyMsgQueue()}_emptyMsgQueue(){if(!this._p||!this._p.connected)return!1;for(this._msgSendQueue.length;this._msgSendQueue.length>0;){const e=this._msgSendQueue.shift();try{this._p.send(e)}catch(t){console.error("failed to send message over simplepeer data channel: ",t.message),this._msgSendQueue.unshift(e)}}}}const appReady=nStore(!1),debugPageModeActive=nStore(!1);nStore(!1);const fullscreenOpen=nStore(!1),sidebarExpanded=nStore(!1);nStore(null);nStore("raspberrypi.local");const rovPeerIdEndNumber=nStore(0);nStore(!1);const isRovDriver=nStore(!1),ourPeerId=nStore("No Peer Id");nStore(null);nStore(null);var ToastSeverity=(n=>(n.success="success",n.info="tertiary",n.warning="warning",n.error="error",n))(ToastSeverity||{});const toastHistoryMap=new Map,toastHistoryStore=nStore([]),setToastHistory=n=>{toastHistoryMap.set(n.msg,n),toastHistoryStore.set(Array.from(toastHistoryMap.values()).reverse())};let toastTool;const setupToasts=()=>{toastTool=getToastStore(),sidebarExpanded.subscribe(n=>{n&&toastHistoryMap.forEach(e=>{e.closed=!0,toastTool.close(e.toastId)})})};function randomUUID(){const n=Math.random();return Number(n).toString(32)}const showToastMessage=(n,e=2e3,t=!0,s="tertiary",a=null)=>{const c=toastHistoryMap.get(n),u=c?c.toastId:randomUUID();if(sidebarExpanded.get())return setToastHistory({msg:n,severity:s,messageRepeatCount:c?c.messageRepeatCount+1:1,toastId:u,closed:!0}),u;if(toastTool&&(!c||!t)){let d=toastTool.trigger({classes:`variant-filled-${s} w-72`,message:n,timeout:e,callback:({id:m,status:_})=>{if(_=="closed"){const b=toastHistoryMap.get(n);b&&setToastHistory({...b,closed:!0}),a&&a()}},hoverable:!0,autohide:!0});return toastHistoryMap.set(n,{msg:n,toastId:d,closed:!1,severity:s,messageRepeatCount:1}),d}else c.closed&&toastHistoryMap.delete(n),setToastHistory({...c,messageRepeatCount:c.messageRepeatCount+1})},urlParams=new URLSearchParams(window.location.search);function getStringQueryParam(n,e){const t=urlParams.get(n);if(t==null||t===""){if(e===void 0)throw new Error("Missing required url query parameter (string): "+n);return e}return t}function getBooleanQueryParam(n,e){const t=urlParams.get(n);if(t==null||t===""){if(e===void 0)throw new Error("Missing required boolean url query parameter (boolean): "+n);return e}return t.toLowerCase()!=="false"}const LIVEKIT_LIST_ONLY_TOKEN="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ2aWRlbyI6eyJyb29tTGlzdCI6dHJ1ZSwicm9vbUpvaW4iOmZhbHNlLCJjYW5QdWJsaXNoIjpmYWxzZSwiY2FuU3Vic2NyaWJlIjpmYWxzZSwiY2FuUHVibGlzaERhdGEiOmZhbHNlLCJjYW5VcGRhdGVPd25NZXRhZGF0YSI6ZmFsc2V9LCJpYXQiOjE2OTE0NTEzNDEsIm5iZiI6MTY5MTQ1MTM0MSwiZXhwIjoxMTE1MjI1MTM0MSwiaXNzIjoiQVBJSGQ3Qm9hOVJVVWlUIiwic3ViIjoibHQiLCJqdGkiOiJsdCJ9.X5fI6ceu2aLf0bc-h3PKc-u2PRzSAgVZEpK5FjScRGQ",URL_PARAMS={DEBUG_MODE:getBooleanQueryParam("DEBUG_MODE",!1),SHOW_REMOTE_LOGS:getBooleanQueryParam("SHOW_REMOTE_LOGS",!0),LIVEKIT_CLOUD_ENDPOINT:getStringQueryParam("LIVEKIT_CLOUD_URL","https://rov-web.livekit.cloud"),LIVEKIT_LOCAL_ENDPOINT:getStringQueryParam("LIVEKIT_LOCAL_URL","http://localhost:7880")},PING_INTERVAL=1e3,MOVE_MSG_TIMEOUT=100;var GPAD_STANDARD_BUTTON_INDEX=(n=>(n[n.A=0]="A",n[n.B=1]="B",n[n.X=2]="X",n[n.Y=3]="Y",n[n.LB=4]="LB",n[n.RB=5]="RB",n[n.LT=6]="LT",n[n.RT=7]="RT",n[n.SELECT=8]="SELECT",n[n.START=9]="START",n[n.LSTICK=10]="LSTICK",n[n.RSTICK=11]="RSTICK",n[n.DPAD_UP=12]="DPAD_UP",n[n.DPAD_DOWN=13]="DPAD_DOWN",n[n.DPAD_LEFT=14]="DPAD_LEFT",n[n.DPAD_RIGHT=15]="DPAD_RIGHT",n[n.VENDOR=16]="VENDOR",n))(GPAD_STANDARD_BUTTON_INDEX||{});const GPAD_STANDARD_BUTTON_INDEX_TO_MAVLINK_INDEX={0:0,1:1,2:2,3:3,4:9,5:10,8:4,9:6,10:7,11:8,12:11,13:12,14:13,15:14,16:5},GAME_CONTROLLER_BUTTON_CONFIG=[{btnName:"button_1",helpLabel:"ENABLE Thrusters / Take Control / Manual Mode",tooltipPlacement:"left"},{btnName:"button_2",helpLabel:"STOP Thrusters",tooltipPlacement:"left"},{btnName:"button_3",helpLabel:"Stablize Mode",tooltipPlacement:"left"},{btnName:"button_4",helpLabel:"Depth Hold Mode",tooltipPlacement:"left"},{btnName:"shoulder_button_front_left",helpLabel:"Open Claw",tooltipPlacement:"right",fireWhileHolding:!0},{btnName:"shoulder_button_front_right",helpLabel:"Close Claw",tooltipPlacement:"left",fireWhileHolding:!0},{btnName:"shoulder_trigger_back_left",helpLabel:"Slow motors (Use +/- button for claw)",fireWhileHolding:!0,tooltipPlacement:"right"},{btnName:"shoulder_trigger_back_right",helpLabel:"Slow motors (Use +/- button for claw)",fireWhileHolding:!0,tooltipPlacement:"left"},{btnName:"select_button",helpLabel:"Move-Roll Toggle",tooltipPlacement:"right"},{btnName:"start_button",helpLabel:"Acrobatic Mode",tooltipPlacement:"left"},{btnName:"stick_button_left",helpLabel:"Move Forward-Back & Turn (TBD: Click & Hold for alt gamepad actions)",tooltipPlacement:"right"},{btnName:"stick_button_right",helpLabel:"Move Up-Down & Left-Right",tooltipPlacement:"left"},{btnName:"d_pad_up",helpLabel:"Look Up",fireWhileHolding:!0,tooltipPlacement:"right"},{btnName:"d_pad_down",helpLabel:"Look Down",fireWhileHolding:!0,tooltipPlacement:"right"},{btnName:"d_pad_left",helpLabel:"Dim Lights",fireWhileHolding:!0,tooltipPlacement:"right"},{btnName:"d_pad_right",helpLabel:"Brighten Lights",fireWhileHolding:!0,tooltipPlacement:"right"}],ONSCREEN_GPAD_BUTTON_LABELS=["button_1","button_2","button_3","button_4","shoulder_button_front_left","shoulder_button_front_right","shoulder_trigger_back_left","shoulder_trigger_back_right","select_button","start_button","stick_button_left","stick_button_right","d_pad_up","d_pad_down","d_pad_left","d_pad_right"],ONSCREEN_GPAD_BUTTON_TOUCHED_CLASS="touched",ONSCREEN_GPAD_BUTTON_PRESSED_CLASS="pressed",networkLatencyMs=nStore(1/0),depthM=nStore(1/0),waterTempC=nStore(1/0),internalTempC=nStore(1/0);nStore(1/0);const pressureMbar=nStore(1/0),rovHeading=nStore(0),rovPitch=nStore(0),rovRoll=nStore(0);function updateSensorValues(n){for(let e of n.MeasurementUpdates)e.MeasurementType==rov_actions_proto.SensorMeasurmentTypes.pressure_mbar?(pressureMbar.set(e.Value),depthM.set((e.Value-SEA_LEVEL_PRESSURE)*.009962143853)):e.MeasurementType==rov_actions_proto.SensorMeasurmentTypes.water_temp_celsius?waterTempC.set(e.Value):e.MeasurementType==rov_actions_proto.SensorMeasurmentTypes.internal_temp_celsius?internalTempC.set(e.Value):e.MeasurementType==rov_actions_proto.SensorMeasurmentTypes.yaw_degrees?rovHeading.set(e.Value):e.MeasurementType==rov_actions_proto.SensorMeasurmentTypes.pitch_degrees?rovPitch.set(e.Value):e.MeasurementType==rov_actions_proto.SensorMeasurmentTypes.roll_degrees&&rovRoll.set(e.Value)}let modalTool;const setupModals=()=>{modalTool=getModalStore()};function modalConfirm(n,e,t){console.log("modalConfirm",n,e);const s={type:"confirm",title:n,body:e,response:a=>{a&&t&&t()}};modalTool.trigger(s)}let passwordModalOpen=!1;function modalPasswordPrompt(n,e=""){return new Promise((t,s)=>{if(passwordModalOpen)return s("Password modal already open");passwordModalOpen=!0;const a={type:"prompt",title:n,body:e,valueAttr:{type:"text",placeholder:"password",required:!0},response:c=>{console.log("modalPasswordPrompt response",c),passwordModalOpen=!1,t(c)}};try{modalTool.trigger(a)}catch(c){passwordModalOpen=!1,s(c)}})}function modalScrollingText(n,e,t){const s={type:"alert",title:n,body:e,response:a=>{t&&t(a)}};return modalTool.trigger(s),a=>{modalTool.update(c=>{let u=c.indexOf(s);return c[u].body=c[u].body+`
`+a,c})}}var FlightMode=(n=>(n[n.unknown=-1]="unknown",n[n.manual=19]="manual",n[n.stabilize=0]="stabilize",n[n.acrobatic=1]="acrobatic",n[n.depth_hold=2]="depth_hold",n[n.surface=9]="surface",n))(FlightMode||{});const FlightmodeNameMap={19:"Manual",0:"Stabilize",1:"Acrobatic",2:"Depth Hold",9:"Surface",[-1]:"Unknown"};MavState.MAV_STATE_UNINIT+"",MavState.MAV_STATE_BOOT+"",MavState.MAV_STATE_CALIBRATING+"",MavState.MAV_STATE_STANDBY+"",MavState.MAV_STATE_ACTIVE+"",MavState.MAV_STATE_CRITICAL+"",MavState.MAV_STATE_EMERGENCY+"",MavState.MAV_STATE_POWEROFF+"",MavState.MAV_STATE_FLIGHT_TERMINATION+"";nStore(1/0);const batteryPercent=nStore(1/0),batteryVoltage=nStore(1/0),batteryCurrent=nStore(1/0),autopilotLoad=nStore(1/0),autopilotErrorCount=nStore(0),autopilotMode=nStore(FlightMode.unknown),autopilotMavState=nStore(MavState.MAV_STATE_UNINIT),autopilotArmed=nStore(!1),cpuTempC=nStore(1/0),cpuUsagePercent=nStore(1/0),memUsagePercent=nStore(1/0),diskUsagePercent=nStore(1/0);function updateSystemMonitorDisplay(n,e,t,s,a){cpuTempC.set(n),cpuUsagePercent.set(e),memUsagePercent.set(t),diskUsagePercent.set(s),a.forEach(c=>{console.warn("System Monitor Warning: "+c),showToastMessage(c,5e3,!0,ToastSeverity.warning)})}function updateBatteryDisplay(n,e,t){batteryPercent.set(n),batteryVoltage.set(e),batteryCurrent.set(t)}function updateAutopilotFlightModeDisplay(n){n in FlightmodeNameMap?autopilotMode.set(n):(showToastMessage("ROV is in unknown flight mode: "+String(n),4e3,!0,ToastSeverity.warning),autopilotMode.set(FlightMode.unknown))}function updateAutopilotStatusDisplay(n){autopilotMavState.set(n)}function updateAutopilotLoadDisplay(n){autopilotLoad.set(n)}function updateAutopilotErrorCountDisplay(n){autopilotErrorCount.set(n)}const handleMavlinkMessage=n=>{if(!n.message)return;if(!n.message.type)return console.debug("@ invalid mavlink message rcvd: ",n);const e=n.message;switch(e.type){case"HEARTBEAT":handleHearbeatRecived(e);break;case"ATTITUDE":handleAttitudeRecived(e);break;case"SYS_STATUS":handleSystemStatusRecived(e);break;case"STATUSTEXT":handleStatusTextRecived(e);break;case"SCALED_PRESSURE":handleScaledPressureRecived(e);break;case"SCALED_PRESSURE2":handleScaledPressure2Recived(e);break;default:URL_PARAMS.DEBUG_MODE&&console.debug("@ unhandled mavlink message "+String(e.type),e)}},handleHearbeatRecived=n=>{if(n.autopilot.type=="MAV_AUTOPILOT_INVALID")return;const e=n.custom_mode;updateAutopilotFlightModeDisplay(e);const t=n.system_status.type||MavState.MAV_STATE_UNINIT;updateAutopilotStatusDisplay(t);const s=n.base_mode.bits,a=(s&MavModeFlag.MAV_MODE_FLAG_SAFETY_ARMED)>0;autopilotArmed.set(a);const c=(s&MavModeFlag.MAV_MODE_FLAG_MANUAL_INPUT_ENABLED)>0,u=(s&MavModeFlag.MAV_MODE_FLAG_HIL_ENABLED)>0,d=(s&MavModeFlag.MAV_MODE_FLAG_STABILIZE_ENABLED)>0,m=(s&MavModeFlag.MAV_MODE_FLAG_GUIDED_ENABLED)>0,_=(s&MavModeFlag.MAV_MODE_FLAG_AUTO_ENABLED)>0,b=(s&MavModeFlag.MAV_MODE_FLAG_TEST_ENABLED)>0;URL_PARAMS.DEBUG_MODE&&console.debug("@  autopilot state",t,"flight mode",e,"armed",a,"manual_enabled",c,"hil_enabled",u,"stabilize_enabled",d,"guided_enabled",m,"auto_enabled",_,"test_enabled",b)},handleAttitudeRecived=n=>{URL_PARAMS.DEBUG_MODE&&console.debug("@  attitude",n),updateSensorValues({MeasurementUpdates:[{MeasurementType:rov_actions_proto.SensorMeasurmentTypes.yaw_degrees,Value:n.yaw/Math.PI*180},{MeasurementType:rov_actions_proto.SensorMeasurmentTypes.pitch_degrees,Value:n.pitch/Math.PI*180},{MeasurementType:rov_actions_proto.SensorMeasurmentTypes.roll_degrees,Value:n.roll/Math.PI*180}]})},handleScaledPressureRecived=n=>{URL_PARAMS.DEBUG_MODE&&console.debug("@  scaled pressure",n),pressureMbar.set(n.press_abs),depthM.set((n.press_abs-SEA_LEVEL_PRESSURE)*.009962143853),internalTempC.set(n.temperature/100)},handleScaledPressure2Recived=n=>{URL_PARAMS.DEBUG_MODE&&console.debug("@  scaled pressure 2",n),waterTempC.set(n.temperature/100)},handleSystemStatusRecived=n=>{URL_PARAMS.DEBUG_MODE&&console.debug("@  system status",n);const e=n.voltage_battery/1e3,t=n.current_battery/100,s=n.errors_comm+n.errors_count1+n.errors_count2+n.errors_count3+n.errors_count4;updateBatteryDisplay(n.battery_remaining,e,t),updateAutopilotErrorCountDisplay(s),updateAutopilotLoadDisplay(n.load),n.errors_comm>0&&showToastMessage(`${s} autopilot errors detected!`,5e3,!0,ToastSeverity.warning),(e<14||n.battery_remaining>0&&n.battery_remaining<10)&&showToastMessage(`Low Battery: ${e.toFixed(2)}volts`,8e3,!0,ToastSeverity.warning),t>20&&showToastMessage(`High Current Draw: ${t.toFixed(1)} amps`,5e3,!0,ToastSeverity.error)},handleStatusTextRecived=n=>{const e=n.severity.type,t=n.text.join("");URL_PARAMS.DEBUG_MODE&&console.debug("@  status text",n);const a={[MavSeverity.MAV_SEVERITY_INFO]:ToastSeverity.info,[MavSeverity.MAV_SEVERITY_DEBUG]:ToastSeverity.info,[MavSeverity.MAV_SEVERITY_NOTICE]:ToastSeverity.info,[MavSeverity.MAV_SEVERITY_WARNING]:ToastSeverity.warning,[MavSeverity.MAV_SEVERITY_ALERT]:ToastSeverity.warning,[MavSeverity.MAV_SEVERITY_CRITICAL]:ToastSeverity.error,[MavSeverity.MAV_SEVERITY_EMERGENCY]:ToastSeverity.error,[MavSeverity.MAV_SEVERITY_ERROR]:ToastSeverity.error}[e]||ToastSeverity.info;showToastMessage(t+" - "+e,5e3,!1,a)};let lastTimeRecvdPong=NaN;class FrontendRovMsgHandlerClass{constructor(){ae(this,"replyContinuityCallbacks",[])}handleRecivedMessage(e){let t=new Uint8Array(e);if(!t||t.length===0)return;const s=rov_actions_proto.RovResponse.decode(new Uint8Array(e)),a=s.ExchangeId;if(this.runExchangeCallback(s,a),s.Done)return this.handleDoneMsgRecived(s.Done,a);if(s.Error)return this.handleErrorMsgRecived(s.Error,a);if(s.Pong)return this.handlePongMsgRecived(s.Pong,a);if(s.ContinuedOutput)return this.handleContinuedOutputMsgRecived(s.ContinuedOutput,a);if(s.SensorUpdates)return this.handleSensorUpdatesMsgRecived(s.SensorUpdates,a);if(s.PasswordRequired)return this.handlePasswordRequiredMsgRecived(s.PasswordRequired,a);if(s.PasswordAccepted)return this.handlePasswordAcceptedMsgRecived(s.PasswordAccepted,a);if(s.PasswordInvalid)return this.handlePasswordInvalidMsgRecived(s.PasswordInvalid,a);if(s.DriverChanged)return this.handleDriverChangedMsgRecived(s.DriverChanged,a);if(s.ClientConnected)return this.handleClientConnectedMsgRecived(s.ClientConnected,a);if(s.ClientDisconnected)return this.handleClientDisconnectedMsgRecived(s.ClientDisconnected,a);if(s.SimplepeerSignal&&s.SimplepeerSignal.Message)frontendConnMngr.ingestSimplePeerSignallingMsg(s.SimplepeerSignal.Message);else{if(s.Mavlink)return this.handleMavlinkMessageRecived(s.Mavlink,a);if(s.SystemMonitor)return this.handleSystemMonitorMsgRecived(s.SystemMonitor,a);if(s.LogMessage)return this.handleLogMsgRecived(s.LogMessage,a);console.warn("Unhandled ROV message recived: ",s)}}handleDoneMsgRecived(e,t){URL_PARAMS.DEBUG_MODE&&console.debug("Done: ",e)}handleErrorMsgRecived(e,t){console.warn("ROV Error: ",e),showToastMessage("ROV Error: "+e.Message,2e3,null)}handlePongMsgRecived(e,t){lastTimeRecvdPong=Date.now();const s=lastTimeRecvdPong-Number.parseFloat(e.Time);networkLatencyMs.set(s)}handleContinuedOutputMsgRecived(e,t){URL_PARAMS.DEBUG_MODE&&console.debug("ContinuedOutput: ",t,e)}handleSensorUpdatesMsgRecived(e,t){URL_PARAMS.DEBUG_MODE&&console.debug("SensorUpdates: ",e),updateSensorValues(e)}handleSystemMonitorMsgRecived(e,t){updateSystemMonitorDisplay(e.CpuTemp,e.CpuUsage,e.MemoryUsage,e.DiskUsage,e.Warnings)}handlePasswordRequiredMsgRecived(e,t){URL_PARAMS.DEBUG_MODE&&console.debug("PasswordRequired for rovId:",e.RovId),modalPasswordPrompt("Enter ROV Password","").then(s=>{s?this.sendRovMessage({PasswordAttempt:{Password:s},ExchangeId:t},null):delete this.replyContinuityCallbacks[t]})}handlePasswordAcceptedMsgRecived(e,t){showToastMessage("Password Accepted",1e3,null)}handlePasswordInvalidMsgRecived(e,t){showToastMessage("Wrong Password",1e3,null),this.handlePasswordRequiredMsgRecived(e,t)}handleDriverChangedMsgRecived(e,t){let s=frontendConnMngr.currentLivekitIdentity.get();e.DriverPeerId==s?(showToastMessage("You are now the driver"),isRovDriver.set(!0)):(showToastMessage("ROV Driver is now "+e.DriverPeerId),isRovDriver.set(!1))}handleMavlinkMessageRecived(e,t){if(!e.Message)return;const s=DECODE_TXT(e.Message);try{const a=JSON.parse(s);handleMavlinkMessage(a)}catch{console.warn("@ Mav MSG RECIVED W INVALID JSON: ",s)}}handleClientConnectedMsgRecived(e,t){showToastMessage(e.ClientPeerId+" Connected to ROV",1500,null)}handleClientDisconnectedMsgRecived(e,t){showToastMessage(e.ClientPeerId+" Disconnected from ROV",1500,null)}handleLogMsgRecived(e,t){if(URL_PARAMS.SHOW_REMOTE_LOGS){let s=JSON.parse(e.Message);if(Array.isArray(s)||(s=[s]),s.length===0)return;typeof s[0]=="string"?s[0]="REMOTE LOG: "+s[0]:s.unshift("REMOTE LOG: "),e.Level==rov_actions_proto.LogLevel.Debug?console.debug(...s):e.Level==rov_actions_proto.LogLevel.Info?console.info(...s):e.Level==rov_actions_proto.LogLevel.Warning?console.warn(...s):e.Level==rov_actions_proto.LogLevel.Error?console.error(...s):e.Level==rov_actions_proto.LogLevel.Critical&&console.error(...s)}}sendRovMessage(e,t=null){frontendConnMngr.currentLivekitIdentity.get()!==null&&(e.ExchangeId||(e.ExchangeId=this.replyContinuityCallbacks.length+1),this.replyContinuityCallbacks[e.ExchangeId]||(this.replyContinuityCallbacks[e.ExchangeId]={callback:t,originalMsgData:e}),frontendConnMngr.sendMessageToRov(e,!1))}resendMessage(e){const t=this.replyContinuityCallbacks[e];t&&t.originalMsgData?(console.info("Resending message: ",t.originalMsgData),this.sendRovMessage(t.originalMsgData,t.callback)):console.warn("resendMessage(): No message to resend for ExchangeId: ",e)}runExchangeCallback(e,t){const s=this.replyContinuityCallbacks[t];s&&(s.callback&&s.callback(e),(e.Done||e.Error)&&delete this.replyContinuityCallbacks[t])}}const frontendRovMsgHandler=new FrontendRovMsgHandlerClass;var VideoStreamMethod=(n=>(n.none="none",n.livekit="livekit",n.simplepeer="simplepeer",n))(VideoStreamMethod||{});class FrontendConnectionManager{constructor(){ae(this,"connectionState",nStore(ConnectionStates.init));ae(this,"livekitConnection",new LivekitViewerConnection);ae(this,"videoStreams",nStore(void 0));ae(this,"currentLivekitIdentity",nStore(null));ae(this,"simplepeerConnection");ae(this,"livekitRoomPollingInterval",-1);ae(this,"openLivekitRoomInfo",nStore([]));ae(this,"_cleanupFuncs",{});ae(this,"currentVideoStreamMethod",nStore("none"));this.simplepeerConnection=new SimplePeerConnection,changesSubscribe(this.livekitConnection.latestRecivedDataMessage,e=>{const{senderId:t,msg:s}=e;t==this.livekitConnection.getRoomName()&&frontendRovMsgHandler.handleRecivedMessage(s)}),changesSubscribe(this.simplepeerConnection.latestRecivedDataMessage,e=>{frontendRovMsgHandler.handleRecivedMessage(e)}),changesSubscribe(this.simplepeerConnection.outgoingSignalingMessages,e=>{this.sendMessageToRov({SimplepeerSignal:{Message:e}},!0)})}async pollForOpenLivekitRooms(e){this.livekitRoomPollingInterval!==-1&&clearInterval(this.livekitRoomPollingInterval);const t=async()=>{if(this.connectionState.get()===ConnectionStates.connected||this.connectionState.get()===ConnectionStates.reconnecting)return;let s;try{s=await listLivekitRoomsWithoutSDK(e,LIVEKIT_LIST_ONLY_TOKEN)}catch(u){return console.warn("LK Error: Could not retrive list of livekit rooms",u),this.openLivekitRoomInfo.set([])}const c=s.map(u=>({name:u.name,token:u.metadata.length===0?"":getAuthTokenFromLivekitRoomMetadata(u.metadata)})).sort((u,d)=>u.name>d.name?1:d.name>u.name?-1:0);this.openLivekitRoomInfo.set(c)};await t(),this.livekitRoomPollingInterval=window.setInterval(t,5e3)}async onConnectedActions(){await this.startSimplePeerConnection()}async _keepTrackOfConnectionState(){this._cleanupFuncs.livekitConnState&&this._cleanupFuncs.livekitConnState();const e=changesSubscribe(this.livekitConnection.connectionState,s=>{this.simplepeerConnection&&this.simplepeerConnection.connectionState.get()===ConnectionStates.connected?this.connectionState.set(ConnectionStates.connected):this.connectionState.set(s)}),t=changesSubscribe(this.simplepeerConnection.connectionState,s=>{this.livekitConnection&&this.livekitConnection.connectionState.get()===ConnectionStates.connected?this.connectionState.set(ConnectionStates.connected):this.connectionState.set(s)});this._cleanupFuncs.livekitConnState=()=>{e(),t()}}async initUsingCloudLivekitConnection(){this.livekitConnection.close(),this.pollForOpenLivekitRooms(URL_PARAMS.LIVEKIT_CLOUD_ENDPOINT),await this.livekitConnection.init({hostUrl:URL_PARAMS.LIVEKIT_CLOUD_ENDPOINT,publishVideo:!1,reconnectAttempts:3,roomConnectionConfig:LIVEKIT_FRONTEND_ROOM_CONNECTION_CONFIG,roomConfig:LIVEKIT_FRONTEND_ROOM_CONFIG})}async initUsingLocalLivekitConnection(){this.livekitConnection.close(),this.pollForOpenLivekitRooms(URL_PARAMS.LIVEKIT_LOCAL_ENDPOINT),await this.livekitConnection.init({hostUrl:URL_PARAMS.LIVEKIT_LOCAL_ENDPOINT,publishVideo:!1,reconnectAttempts:3,roomConnectionConfig:LIVEKIT_FRONTEND_ROOM_CONNECTION_CONFIG,roomConfig:LIVEKIT_FRONTEND_ROOM_CONFIG})}async connectToLivekitRoom(e,t){if(!this.livekitConnection||!this.livekitConnection.config)throw new Error("connectToLivekitRoom() called before livekitConnection was initilized");this._keepTrackOfConnectionState(),await this.livekitConnection.start(e,t),this.currentLivekitIdentity.set(this.livekitConnection.getLivekitIdentitiy()),oneShotSubscribe(this.livekitConnection.latestRecivedDataMessage,()=>this.onConnectedActions())}async startSimplePeerConnection(){if(!this.livekitConnection||this.livekitConnection.connectionState.get()!=ConnectionStates.connected)throw new Error("startSimplePeerConnection() called when livekitConnection was not fully connected!");if(!this.simplepeerConnection)throw new Error("startSimplePeerConnection() called without initilized simplepeerConnection!");this.simplepeerConnection.start(Object.assign({},SIMPLEPEER_BASE_CONFIG,{initiator:!0,offerOptions:{offerToReceiveVideo:!0}}))}async ingestSimplePeerSignallingMsg(e){const t=this.simplepeerConnection;if(t)t.ingestSignalingMsg(e);else throw new Error("ingestSimplePeerSignallingMsg() called when simplepeerConnection was not initilized!")}async toggleSimplePeerConnection(){if(!this.simplepeerConnection)throw new Error("toggleSimplePeerConnection() called without simplepeerConnection in class!");const e=this.simplepeerConnection.connectionState.get();console.log("toggleSimplePeerConnection(): state",e),[ConnectionStates.disconnectedOk,ConnectionStates.failed,ConnectionStates.init].includes(e)?this.startSimplePeerConnection():this.simplepeerConnection.stop()}async sendMessageToRov(e,t=!1){if(!this.livekitConnection)throw new Error("sendMessageToRov() called before livekitConnection was initilized");t=!1;const s=rov_actions_proto.RovAction.encode(e).finish(),a=this.livekitConnection._rovRoomName;URL_PARAMS.DEBUG_MODE&&console.debug("Sending Message to ",a,t?"reliably":"unreliably",":",e),t&&this.livekitConnection.connectionState.get()===ConnectionStates.connected?await this.livekitConnection.sendMessage(s,t,[a]):this.simplepeerConnection&&this.simplepeerConnection.connectionState.get()===ConnectionStates.connected?await this.simplepeerConnection.sendMessage(s):await this.livekitConnection.sendMessage(s,!1,[a])}async disconnect(){this.simplepeerConnection&&await this.simplepeerConnection.stop(),this.livekitConnection&&await this.livekitConnection.close();for(const e in this._cleanupFuncs)this._cleanupFuncs[e]()}}const frontendConnMngr=new FrontendConnectionManager;var l$2=(n=>(n.up="up",n.down="down",n.left="left",n.right="right",n))(l$2||{}),v=(n=>(n.onOff="onOff",n.variable="variable",n))(v||{}),f$2=(n=>(n.real="real",n.emulated="emulated",n.overlay="overlay",n))(f$2||{});function i(n,e,t){const s=Math.sqrt(n*n+e*e);return s>t?{x:n/s,y:e/s}:{x:n/t,y:e/t}}function o$1(n){if(n instanceof SVGGraphicsElement){n.getAttribute("transform")&&console.warn("Setting Transform origin on an element that already has a transform attribute. This may break the transform!",n);const e=n.getBBox();n.style.transformOrigin=`${e.x+e.width/2}px ${e.y+e.height/2}px`}else if(n instanceof HTMLElement){console.warn("Setting Transform origin on an element that is not an SVG element. This may break the transform!",n);const e=n.getBoundingClientRect();n.style.transformOrigin=`${e.width/2}px ${e.height/2}px`}}var L=Object.defineProperty,M=(n,e,t)=>e in n?L(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,h=(n,e,t)=>(M(n,typeof e!="symbol"?e+"":e,t),t);const T=18,A=4,E=class{constructor(n){if(h(this,"getNativeGamepads",()=>[]),h(this,"buttonPressThreshold",.1),h(this,"realGpadToPatchedIndexMap",[]),h(this,"patchedGpadToRealIndexMap",[]),h(this,"emulatedGamepads",[]),h(this,"emulatedGamepadsMetadata",[]),h(this,"undoEventPatch",()=>{}),this.buttonPressThreshold=n||this.buttonPressThreshold,E.instanceRunning)throw new Error("Only one GamepadEmulator instance may exist at a time!");E.instanceRunning=!0,this.undoEventPatch=this.monkeyPatchGamepadEvents(),this.monkeyPatchGetGamepads()}AddEmulatedGamepad(n,e,t=T,s=A){if((n===-1||!n&&n!==0)&&(n=this.nextEmptyEGpadIndex(e)),this.emulatedGamepads[n])return!1;const a={emulation:f$2.emulated,connected:!0,timestamp:Math.floor(Date.now()/1e3),displayId:"Emulated Gamepad "+n,id:"Emulated Gamepad "+n+" (Xinput STANDARD GAMEPAD)",mapping:"standard",index:n,buttons:new Array(t).fill({pressed:!1,value:0,touched:!1},0,t),axes:new Array(s).fill(0,0,s),hapticActuators:[]};this.emulatedGamepads[n]=a,this.emulatedGamepadsMetadata[n]={overlayMode:e};const c=new Event("gamepadconnected");return c.gamepad=a,window.dispatchEvent(c),a}RemoveEmulatedGamepad(n){this.ClearDisplayButtonEventListeners(n),this.ClearDisplayJoystickEventListeners(n);var e=this.emulatedGamepads[n];if(e){delete this.emulatedGamepads[n],delete this.emulatedGamepadsMetadata[n];const t={...e,connected:!1,timestamp:Math.floor(Date.now()/1e3)},s=new Event("gamepaddisconnected");s.gamepad=t,window.dispatchEvent(s)}else console.warn("Error: removing emulated gamepad. No emulated gamepad exists at index "+n)}PressButton(n,e,t,s){if(this.emulatedGamepads[n]===void 0)throw new Error("Error: PressButton() - no emulated gamepad at index "+n+", pass a valid index, or call AddEmulatedGamepad() first to create an emulated gamepad at that index");var a=t>this.buttonPressThreshold;this.emulatedGamepads[n].buttons[e]={pressed:a,value:t||0,touched:a||s||!1}}MoveAxis(n,e,t){if(!this.emulatedGamepads[n])throw new Error("Error: MoveAxis() - no emulated gamepad at index "+n+", pass a valid index, or call AddEmulatedGamepad() first to create an emulated gamepad at that index");this.emulatedGamepads[n].axes[e]=t}AddDisplayButtonEventListeners(n,e){if(!this.emulatedGamepads[n])throw new Error("Error: AddDisplayJoystickEventListeners() - no emulated gamepad at index "+n+", pass a valid index, or call AddEmulatedGamepad() first to create an emulated gamepad at that index");let t=[];for(var s=0;s<e.length;s++){const a=e[s],c=a.buttonIndex,u=a.tapTarget;if(!u){console.warn("AddDisplayButtonEventListeners() - no tap target in button config "+c+", skipping...");continue}const d=S=>{S.changedTouches[0].target==u&&S.preventDefault()};window.addEventListener("touchstart",d,{passive:!1});const m=S=>{const C=S.buttons==1?1:0;(!a.lockTargetWhilePressed||C==0)&&this.PressButton(n,c,C,!0)};u.addEventListener("pointerenter",m);const _=S=>{const C=S.buttons==1?1:0;(!a.lockTargetWhilePressed||C==0)&&this.PressButton(n,c,0,!1)};u.addEventListener("pointerleave",_);const b=S=>{};if(u.addEventListener("pointercancel",b),a.type==v.onOff){const S=w=>{w.preventDefault(),this.PressButton(n,c,1,!0),a.lockTargetWhilePressed?u.setPointerCapture(w.pointerId):u.releasePointerCapture(w.pointerId),console.log("on/off pointer down",u.hasPointerCapture(w.pointerId))};u.addEventListener("pointerdown",S);const C=()=>{this.PressButton(n,c,0,!0)};u.addEventListener("pointerup",C),t.push(function(){window.removeEventListener("touchstart",d),u.removeEventListener("pointerenter",m),u.removeEventListener("pointerleave",_),u.removeEventListener("pointerdown",S),u.removeEventListener("pointerup",C),u.removeEventListener("pointercancel",b)})}else if(a.type==v.variable){const S={...a},C=this.AddDragControlListener(S,(w,O,I)=>{let N=w?this.buttonPressThreshold+1e-5:0;N+=a.directions[l$2.left]||a.directions[l$2.right]?Math.abs(O):0,N+=a.directions[l$2.up]||a.directions[l$2.down]?Math.abs(I):0,this.PressButton(n,a.buttonIndex,Math.min(N,1),w)});t.push(function(){window.removeEventListener("touchstart",d),u.removeEventListener("pointerenter",m),u.removeEventListener("pointerleave",_),u.removeEventListener("pointercancel",b),C()})}}this.emulatedGamepadsMetadata[n].removeButtonListenersFunc=()=>{t.forEach(a=>a())}}AddDisplayJoystickEventListeners(n,e){if(!this.emulatedGamepads[n])throw new Error("Error: AddDisplayJoystickEventListeners() - no emulated gamepad at index "+n+", pass a valid index, or call AddEmulatedGamepad() first to create an emulated gamepad at that index");let t=[];for(let s=0;s<e.length;s++){const a=e[s];if(a.tapTarget==null){console.warn(`AddDisplayJoystickEventListeners() - no tap target in joystick config ${s}, skipping...`);continue}const c=this.AddDragControlListener(a,(u,d,m)=>{a.xAxisIndex!==void 0&&this.MoveAxis(n,a.xAxisIndex,d),a.yAxisIndex!==void 0&&this.MoveAxis(n,a.yAxisIndex,m)});t.push(c)}this.emulatedGamepadsMetadata[n].removeJoystickListenersFunc=()=>{t.forEach(s=>s())}}ClearDisplayButtonEventListeners(n){var e;this.emulatedGamepadsMetadata[n]&&((e=this.emulatedGamepadsMetadata[n])!=null&&e.removeButtonListenersFunc)&&this.emulatedGamepadsMetadata[n].removeButtonListenersFunc()}ClearDisplayJoystickEventListeners(n){var e;this.emulatedGamepadsMetadata[n]&&((e=this.emulatedGamepadsMetadata[n])!=null&&e.removeJoystickListenersFunc)&&this.emulatedGamepadsMetadata[n].removeJoystickListenersFunc()}AddDragControlListener(n,e){let t={startX:0,startY:0},s=-1;const a=d=>{var m=d.pointerId;if(s===m){const _=n.directions[l$2.left]?-1:0,b=n.directions[l$2.right]?1:0,S=n.directions[l$2.up]?-1:0,C=n.directions[l$2.down]?1:0,w=d.clientX-t.startX,O=d.clientY-t.startY;let{x:I,y:N}=i(w,O,n.dragDistance);I=Math.max(Math.min(I,b),_),N=Math.max(Math.min(N,C),S),e(!0,I,N)}},c=d=>{s==d.pointerId&&(document.removeEventListener("pointermove",a,!1),document.removeEventListener("pointerup",c,!1),s=-1,e(!1,0,0))};n.tapTarget.addEventListener("pointerdown",d=>{d.preventDefault(),t.startX=d.clientX,t.startY=d.clientY,s=d.pointerId,n.lockTargetWhilePressed?n.tapTarget.setPointerCapture(d.pointerId):n.tapTarget.releasePointerCapture(d.pointerId),console.log("stick pointer down",n.tapTarget.hasPointerCapture(d.pointerId)),e(!0,0,0),document.addEventListener("pointermove",a,!1),document.addEventListener("pointerup",c,!1)});const u=d=>{d.changedTouches[0].target==n.tapTarget&&d.preventDefault()};return window.addEventListener("touchstart",u,{passive:!1}),function(){window.removeEventListener("touchstart",u),n.tapTarget.removeEventListener("pointerdown",a)}}cloneGamepad(n){if(!n)return n;const e=n.axes?n.axes.length:0,t=n.buttons?n.buttons.length:0,s={};for(let a in n)if(a==="axes"){const c=new Array(e);for(let u=0;u<e;u++)c[u]=Number(n.axes[u]);Object.defineProperty(s,"axes",{value:c,enumerable:!0})}else if(a==="buttons"){const c=new Array(t);for(let u=0;u<t;u++){const d=n.buttons[u];if(d==null)c[u]=d;else{const m=d.pressed,_=d.value,b=d.touched||!1;c[u]={pressed:m,value:_,touched:b}}}Object.defineProperty(s,"buttons",{value:c,enumerable:!0})}else Object.defineProperty(s,a,{get:()=>n[a],configurable:!0,enumerable:!0});return s.emulation||(s.emulation=f$2.real),s}nextEmptyEGpadIndex(n){let e=0;if(n)do{if(!this.emulatedGamepads[e])break;e++}while(e<this.emulatedGamepads.length);else{const t=Math.max(this.emulatedGamepads.length,this.patchedGpadToRealIndexMap.length);do{if(!this.emulatedGamepads[e]&&this.patchedGpadToRealIndexMap[e]==null)break;console.log("nextEmptyEGpadIndex",e,!this.emulatedGamepads[e],this.patchedGpadToRealIndexMap[e]==null),e++}while(e<t)}return e}nextEmptyRealGpadIndex(n){let e=n;const t=Math.max(this.emulatedGamepads.length,this.patchedGpadToRealIndexMap.length);do{const s=this.emulatedGamepadsMetadata[e],a=this.realGpadToPatchedIndexMap[e]==null&&this.patchedGpadToRealIndexMap[e]==null;if(s&&s.overlayMode||!s&&a)break;e++}while(e<t);return e}monkeyPatchGamepadEvents(){let n,e,t,s;window.hasOwnProperty("ongamepadconnected")&&(n=Object.getOwnPropertyDescriptor(window,"ongamepadconnected"),t=window.ongamepadconnected,window.ongamepadconnected=null,Object.defineProperty(window,"ongamepadconnected",{get:()=>function(u){},set:u=>{t=u},configurable:!0})),window.hasOwnProperty("ongamepaddisconnected")&&(e=Object.getOwnPropertyDescriptor(window,"ongamepaddisconnected"),s=window.ongamepaddisconnected,window.ongamepaddisconnected=null,Object.defineProperty(window,"ongamepaddisconnected",{get:()=>function(u){},set:u=>{t=u},configurable:!0}));const a=u=>{const d=u.gamepad;if(d&&d.emulation===void 0){u.stopImmediatePropagation();const m=this.cloneGamepad(u.gamepad),_=m.index,b=this.nextEmptyRealGpadIndex(_);this.realGpadToPatchedIndexMap[_]=b,this.patchedGpadToRealIndexMap[b]=_,Object.defineProperty(m,"index",{get:()=>b}),Object.defineProperty(m,"emulation",{get:()=>f$2.real}),console.log(`real gamepad connected ${m.id} (${_}>${b})`,this.realGpadToPatchedIndexMap,this.emulatedGamepads,this.emulatedGamepadsMetadata),u=new Event("gamepadconnected"),u.gamepad=m,window.dispatchEvent(u)}console.log("windowOngamepadconnected",t),t&&t.call(window,u)};window.addEventListener("gamepadconnected",a);const c=u=>{const d=u.gamepad;if(d&&d.emulation===void 0){u.stopImmediatePropagation();const m=this.cloneGamepad(u.gamepad),_=this.realGpadToPatchedIndexMap[m.index]||m.index;Object.defineProperty(m,"index",{get:()=>_}),delete this.realGpadToPatchedIndexMap[m.index],delete this.patchedGpadToRealIndexMap[_],u=new Event("gamepaddisconnected"),u.gamepad=m,window.dispatchEvent(u)}s&&s.call(window,u)};return window.addEventListener("gamepaddisconnected",c),function(){window.removeEventListener("gamepadconnected",a),window.hasOwnProperty("ongamepadconnected")&&(Object.defineProperty(window,"ongamepadconnected",n),window.ongamepadconnected=t),window.removeEventListener("gamepaddisconnected",c),window.hasOwnProperty("ongamepaddisconnected")&&(Object.defineProperty(window,"ongamepaddisconnected",e),window.ongamepaddisconnected=s)}}monkeyPatchGetGamepads(){const n=this;let e=navigator.getGamepads||navigator.webkitGetGamepads||navigator.mozGetGamepads||navigator.msGetGamepads;e&&(this.getNativeGamepads=e),navigator.getGamepads=function(){let t=[],s=e!=null?n.getNativeGamepads.apply(navigator):[];for(let c=0;c<s.length;c++){const u=s[c];if(!u)continue;let d=n.cloneGamepad(u),m=n.realGpadToPatchedIndexMap[d.index]||d.index;Object.defineProperty(d,"index",{get:()=>m}),t[m]=d}let a=n.emulatedGamepads;for(let c=0;c<a.length;c++){let u=t[c],d=a[c];if(d&&u){u.emulation=f$2.overlay;let m=Math.max(u.buttons.length,d.buttons.length);for(let b=0;b<m;b++){const S=d.buttons[b]||{touched:!1,pressed:!1,value:0},C=u.buttons[b]||{touched:!1,pressed:!1,value:0};t[c].buttons[b]={touched:S.touched||C.touched||!1,pressed:S.pressed||C.pressed||!1,value:Math.max(S.value,C.value)||0}}let _=Math.max(d.axes.length,u.axes.length);for(let b=0;b<_;b++){const S=d.axes[b]||0,C=u.axes[b]||0;t[c].axes[b]=Math.abs(S||0)>Math.abs(C||0)?S||0:C||0}}else d&&(d.emulation=f$2.emulated,d.timestamp=Math.floor(Date.now()/1e3),t[c]=n.cloneGamepad(d))}return t}}cleanup(){for(let n=0;n<this.emulatedGamepads.length;n++)this.ClearDisplayButtonEventListeners(n),this.ClearDisplayJoystickEventListeners(n);this.emulatedGamepads=[],this.undoEventPatch(),navigator.getGamepads=this.getNativeGamepads,E.instanceRunning=!1}};let y=E;h(y,"instanceRunning",!1);var f$1=Object.defineProperty,l$1=(n,e,t)=>e in n?f$1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,o=(n,e,t)=>(l$1(n,typeof e!="symbol"?e+"":e,t),t);class G{constructor(e){o(this,"updateDelay"),o(this,"axisDeadZone"),o(this,"buttonConfigs"),o(this,"currentStateOfGamepads"),o(this,"gamepadConnectListeners"),o(this,"gamepadDisconnectListeners"),o(this,"gamepadButtonChangeListeners"),o(this,"gamepadAxisChangeListeners"),this.updateDelay=e.updateDelay||0,this.axisDeadZone=e.axisDeadZone||0,this.buttonConfigs=e.buttonConfigs||[],this.currentStateOfGamepads=[],this.gamepadConnectListeners=[],this.gamepadDisconnectListeners=[],this.gamepadButtonChangeListeners=[],this.gamepadAxisChangeListeners=[],navigator.gamepadInputEmulation="gamepad",window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,navigator.getGamepads=navigator.getGamepads||navigator.webkitGetGamepads||navigator.mozGetGamepads||navigator.msGetGamepads,this.gamepadApiSupported()&&this.tickLoop()}setButtonsConfig(e){this.buttonConfigs=e}onGamepadConnect(e){return this.gamepadConnectListeners.push(e),window.addEventListener("gamepadconnected",e,!0),e}offGamepadConnect(e){this.gamepadConnectListeners=this.gamepadConnectListeners.filter(t=>t!==e),window.removeEventListener("gamepadconnected",e,!0)}onGamepadDisconnect(e){return this.gamepadDisconnectListeners.push(e),window.addEventListener("gamepaddisconnected",e,!0),e}offGamepadDisconnect(e){this.gamepadDisconnectListeners=this.gamepadDisconnectListeners.filter(t=>t!==e),window.removeEventListener("gamepaddisconnected",e,!0)}onGamepadAxisChange(e){return this.gamepadAxisChangeListeners.push(e),e}offGamepadAxisChange(e){this.gamepadAxisChangeListeners=this.gamepadAxisChangeListeners.filter(t=>t!==e)}onGamepadButtonChange(e){return this.gamepadButtonChangeListeners.push(e),e}offGamepadButtonChange(e){this.gamepadButtonChangeListeners=this.gamepadButtonChangeListeners.filter(t=>t!==e)}gamepadApiSupported(){return!!navigator.getGamepads&&!!navigator.getGamepads()}getCurrentGamepadStates(e=!1){return e&&this.checkForGamepadChanges(),this.currentStateOfGamepads}tickLoop(){this.checkForGamepadChanges(),this.updateDelay==0?requestAnimationFrame(this.tickLoop.bind(this)):setTimeout(()=>{requestAnimationFrame(this.tickLoop.bind(this))},this.updateDelay)}checkForGamepadChanges(){let e=navigator.getGamepads();for(var t=0;t<e.length;t++){let s=e[t];!s||(this.currentStateOfGamepads[t]||(this.currentStateOfGamepads[t]=s),this.checkForAxisChanges(t,s),this.checkForButtonChanges(t,s),this.currentStateOfGamepads[t]=s)}}checkForAxisChanges(e,t){let s=t.axes;if(s.length==0)return;let a=this.currentStateOfGamepads[e].axes||[],c=[],u,d=!1;for(u=0;u<s.length;u++){let m=s[u]||0,_=a[u]||0;if(m!=_){if(Math.abs(m)<this.axisDeadZone&&Math.abs(_)<this.axisDeadZone)continue;c[u]=!0,d=!0}else c[u]=!1}d&&this.gamepadAxisChangeListeners.forEach(m=>m(e,t,c))}checkForButtonChanges(e,t){let s=t.buttons;if(s.length==0)return;const a=this.currentStateOfGamepads[e].buttons||s;let c=[],u,d=!1;for(u=0;u<s.length;u++){let m=!1;const _=s[u]||{pressed:!1,value:0,touched:!1},b=a[u]||{pressed:!1,value:0,touched:!1},S=this.buttonConfigs[u]||{},C={};_.touched&&!b.touched?(C.touchDown=!0,m=!0):!_.touched&&b.touched&&(C.touchUp=!0,m=!0),_.pressed&&!b.pressed?(C.pressed=!0,m=!0):!_.pressed&&b.pressed&&(C.released=!0,m=!0),S.fireWhileHolding&&_.pressed&&b.pressed&&(C.heldDown=!0,m=!0),_.value!=b.value&&(C.valueChanged=!0,m=!0),m?(d=!0,c[u]=C):c[u]=!1}d&&this.gamepadButtonChangeListeners.forEach(m=>m(e,t,c))}}var p=Object.defineProperty,f=(n,e,t)=>e in n?p(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,l=(n,e,t)=>(f(n,typeof e!="symbol"?e+"":e,t),t);class D{constructor(e,t){l(this,"config"),l(this,"apiWrapper"),l(this,"btnChangeListener"),l(this,"axisChangeListener"),l(this,"DefaultJoystickDisplayFunction",(s,a,c)=>{const u=s.movementRange;if(s.joystickElement.style.transform=`translate(${a*u}px,${c*u}px)`,s.highlights&&this.config.moveDirectionHighlightClass){const d=s.highlights[l$2.up],m=s.highlights[l$2.down],_=s.highlights[l$2.left],b=s.highlights[l$2.right];d&&c<-.1?d.classList.add(this.config.moveDirectionHighlightClass||""):d&&d.classList.remove(this.config.moveDirectionHighlightClass||""),m&&c>.1?m.classList.add(this.config.moveDirectionHighlightClass||""):m&&m.classList.remove(this.config.moveDirectionHighlightClass||""),_&&a<-.1?_.classList.add(this.config.moveDirectionHighlightClass||""):_&&_.classList.remove(this.config.moveDirectionHighlightClass||""),b&&a>.1?b.classList.add(this.config.moveDirectionHighlightClass||""):b&&b.classList.remove(this.config.moveDirectionHighlightClass||"")}}),l(this,"DefaultButtonDisplayFunction",(s,a,c,u,d,m)=>{const _=s.highlight;if(this.config.touchedHighlightClass&&_&&(d.touchDown?_.classList.add(this.config.touchedHighlightClass):d.touchUp&&_.classList.remove(this.config.touchedHighlightClass)),this.config.pressedHighlightClass&&_&&(d.pressed?_.classList.add(this.config.pressedHighlightClass):d.released&&_.classList.remove(this.config.pressedHighlightClass)),s.type==v.variable){const b=s.directionHighlight;if(this.config.moveDirectionHighlightClass&&b&&(d.pressed?b.classList.add(this.config.moveDirectionHighlightClass):d.released&&b.classList.remove(this.config.moveDirectionHighlightClass)),s.buttonElement){const S=s.direction==l$2.left||s.direction==l$2.right,C=s.direction==l$2.right||s.direction==l$2.down;s.buttonElement.style.transform=`translate${S?"X":"Y"}(${C?"":"-"}${a*s.movementRange}px)`}}}),l(this,"displayButtonChanges",(s,a,c)=>{if(s!=this.config.gamepadIndex)return;const u=this.config.buttons;for(let d=0;d<u.length;d++){const m=c[d];if(!m||Object.keys(m).length==0)continue;const _=u[d],b=a.buttons[d].value,S=a.buttons[d].touched,C=a.buttons[d].pressed;this.config.buttonDisplayFunction?this.config.buttonDisplayFunction(_,b,S,C,m,d):this.DefaultButtonDisplayFunction(_,b,S,C,m,d)}}),this.config=e,this.apiWrapper=t||new G({buttonConfigs:[],updateDelay:0}),this.btnChangeListener=this.apiWrapper.onGamepadButtonChange(this.displayButtonChanges.bind(this)),this.axisChangeListener=this.apiWrapper.onGamepadAxisChange(this.displayJoystickChanges.bind(this))}displayJoystickChanges(e,t,s){if(e!=this.config.gamepadIndex)return;const a=this.config.sticks;for(let c=0;c<a.length;c++){const u=a[c];if(u.xAxisIndex!==void 0&&s[u.xAxisIndex]||u.yAxisIndex!==void 0&&s[u.yAxisIndex]){const d=t.axes,m=u.xAxisIndex!==void 0&&d[u.xAxisIndex]||0,_=u.yAxisIndex!==void 0&&d[u.yAxisIndex]||0;this.config.joystickDisplayFunction?this.config.joystickDisplayFunction(u,m,_):this.DefaultJoystickDisplayFunction(u,m,_)}}}Cleanup(){this.apiWrapper.offGamepadButtonChange(this.btnChangeListener),this.apiWrapper.offGamepadAxisChange(this.axisChangeListener)}}class GamepadUi{constructor(){ae(this,"gpadButtonHighlightElements");ae(this,"gamepadContainer");ae(this,"gamepadHelpTooltip");ae(this,"gamepadHelpTooltipText");ae(this,"defaultTooltipTarget");ae(this,"tooManyGamepadsNotice");ae(this,"currentPopperTarget");ae(this,"touchingButtonsCount",0);ae(this,"someAxiesNotCentered",!1);ae(this,"someButtonsPressed",!1);ae(this,"gamepadHelpVisible",!1);ae(this,"cleanupTooltip")}start(){this.gamepadContainer=document.getElementById("gamepad-container"),this.gpadButtonHighlightElements=ONSCREEN_GPAD_BUTTON_LABELS.map(e=>document.getElementById(e+"_highlight")),this.gamepadHelpTooltip=document.querySelector("#gamepad-help-tooltip"),this.gamepadHelpTooltipText=document.querySelector("#gamepad-help-text"),this.defaultTooltipTarget=document.querySelector("#select_button"),this.tooManyGamepadsNotice=document.getElementById("too-many-gamepads-notice"),this.currentPopperTarget=this.defaultTooltipTarget}toggleGamepadHelpScreen(){this.gamepadHelpVisible=!this.gamepadHelpVisible,this.gamepadHelpVisible?(document.body.classList.add("gamepad-help-open"),document.body.classList.remove("driving-now")):document.body.classList.remove("gamepad-help-open")}showNotSupported(){alert("Game controllers are not supported in your browser! Use keyboard or mouse/touch controls or switch to a more modern browser.")}handleGamepadVisualFeedbackAxisEvents(e,t){e.forEach(a=>{let c=a.thumbStickElement,u=a.axisRange,d=a.xValue||0,m=a.yValue||0;c.style.transform=`rotateY(${-d*30}deg) rotateX(${m*30}deg) translate(${d*u}px,${m*u}px)`,this.gamepadHelpVisible&&(a.upIndicatorElement&&a.downIndicatorElement&&(Math.abs(d)<t?m<-t?(a.upIndicatorElement.style.opacity=Math.max(-m,0),a.downIndicatorElement.style.opacity=0):m>t?(a.upIndicatorElement.style.opacity=0,a.downIndicatorElement.style.opacity=Math.max(m,0)):(a.upIndicatorElement.style.opacity=0,a.downIndicatorElement.style.opacity=0):(a.upIndicatorElement.style.opacity=0,a.downIndicatorElement.style.opacity=0)),a.leftIndicatorElement&&a.rightIndicatorElement&&(Math.abs(m)<t?d<-t?(a.leftIndicatorElement.style.opacity=Math.max(-d,0),a.rightIndicatorElement.style.opacity=0):d>t?(a.leftIndicatorElement.style.opacity=0,a.rightIndicatorElement.style.opacity=Math.max(d,0)):(a.leftIndicatorElement.style.opacity=0,a.rightIndicatorElement.style.opacity=0):(a.leftIndicatorElement.style.opacity=0,a.rightIndicatorElement.style.opacity=0)))});let s=e.reduce((a,c)=>a+Math.abs(c.xValue)+Math.abs(c.yValue)>.05?1:0,0);!this.gamepadHelpVisible&&s>0&&this.someAxiesNotCentered==!1?(this.someAxiesNotCentered=!0,this.setGamepadVisability()):this.someAxiesNotCentered==!0&&s==0&&(this.someAxiesNotCentered=!1,this.setGamepadVisability())}setGamepadVisability(){!this.gamepadHelpVisible&&(this.someAxiesNotCentered||this.someButtonsPressed)?document.body.classList.add("driving-now"):document.body.classList.remove("driving-now")}setGamepadButtonClass(e,t){let s=t[e],a=this.gpadButtonHighlightElements[e];!s||!a||(s.touched?a.classList.add(ONSCREEN_GPAD_BUTTON_TOUCHED_CLASS):a.classList.remove(ONSCREEN_GPAD_BUTTON_TOUCHED_CLASS),s.pressed?a.classList.add(ONSCREEN_GPAD_BUTTON_PRESSED_CLASS):a.classList.remove(ONSCREEN_GPAD_BUTTON_PRESSED_CLASS))}handleGamepadVisualFeedbackButtonEvents(e){let t=0;for(let s=0;s<e.length;s++)this.setGamepadButtonClass(s,e),t+=e[s].pressed?1:0;!this.gamepadHelpVisible&&t>0&&this.someButtonsPressed==!1?(this.someButtonsPressed=!0,this.setGamepadVisability()):this.someButtonsPressed==!0&&(this.someButtonsPressed=!1,this.setGamepadVisability())}handleGamepadVisualFeedbackVariableTriggerButtonEvents(e,t){for(let s=0;s<t.length;s++){const a=t[s],c=a.buttonIndex;this.setGamepadButtonClass(c,e);let u=e[c]?e[c].value:0;a.buttonElement.style.transform=`rotateX(${u*30}deg) translateY(${u*a.axisRange}px)`}}getButtonHighlightElements(){return console.log("getButtonHighlightElements",this.gpadButtonHighlightElements),this.gpadButtonHighlightElements}}function bindStringSvelteStoreToLocalStorage(n,e,t){e.set(localStorage.getItem(n)||e.get()||t),changesSubscribe(e,s=>localStorage.setItem(n,String(s)))}function bindNumberSvelteStoreToLocalStorage(n,e,t){e.set(parseFloat(localStorage.getItem(n))||e.get()||t),changesSubscribe(e,s=>localStorage.setItem(n,String(s)))}function getURLQueryStringVariable(n){let t=window.location.search.substring(1).split("&");for(let s=0;s<t.length;s++){let a=t[s].split("=");if(decodeURIComponent(a[0])==n)return decodeURIComponent(a[1])}}function toggleFullscreen(n,e){e=e||document.documentElement;let t=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;!t||e!==t?(e.requestFullscreen||e.webkitEnterFullscreen||e.webkitRequestFullscreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullscreen).apply(e):(document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen).apply(document)}function calculateDesiredMotion(n){let e=Number(n[0].toFixed(3)),t=-1*Number(n[1].toFixed(3)),s=Number(n[2].toFixed(3)),a=-1*Number(n[3].toFixed(3));return{VelocityX:t,VelocityY:s,VelocityZ:a,AngularVelocityYaw:e}}class RovActionsClass{constructor(){ae(this,"requiredMsgsLoopIntervalId",null);ae(this,"lastMove",{VelocityX:0,VelocityY:0,VelocityZ:0,AngularVelocityYaw:0,ButtonBitmask:0});ae(this,"lastMovementTime",0);ae(this,"lastPingTime",0);ae(this,"sensitivity",1);ae(this,"shutdownRov",()=>{modalConfirm("Shutdown the ROV?","",()=>{showToastMessage("Sending Shutdown Request...",2e3,!1,ToastSeverity.info),this.sendActionAndWaitForDone({ShutdownRov:{}},e=>{e.Error?showToastMessage("ROV Shutdown Error: "+e.Error.Message,5e3,!1,ToastSeverity.error):e.Done&&(showToastMessage("Please wait 20 seconds before unplugging. ROV: "+e.Done.Message,8e3,!1,ToastSeverity.success),frontendConnMngr.disconnect())})})});ae(this,"rebootRov",()=>{modalConfirm("Reboot the ROV?","The ROV will stop responding for about two minutes and then you can re-connect.",()=>{showToastMessage("Sending Reboot Request...",2e3,!1,ToastSeverity.info),this.sendActionAndWaitForDone({RebootRov:{}},e=>{e.Error?showToastMessage("ROV Reboot Error: "+e.Error.Message,5e3,!1,ToastSeverity.error):e.Done&&(showToastMessage("Press Connect again in about 30 seconds ROV: "+e.Done.Message,8e3,!1,ToastSeverity.success),showToastMessage("ROV: "+e.Done.Message),frontendConnMngr.disconnect())})})});ae(this,"restartRovServices",()=>{modalConfirm("Restart ROV services?","The ROV will stop responding for about a minute and then you can re-connect.",()=>{let e=this.showCommandOutputPopup("Restarting ROV Services",`Sending Service Restart Request (Please Wait)...
`,`

Done.`);frontendRovMsgHandler.sendRovMessage({RestartRovServices:{}},e)})});ae(this,"getRovStatusReport",()=>{let e=this.showCommandOutputPopup("ROV Status Report",`Sending Status Request (Please Wait)...
`,`

Done.`);frontendRovMsgHandler.sendRovMessage({RovStatusReport:{}},e)});ae(this,"getRovLogs",()=>{let e=this.showCommandOutputPopup("ROV Logs",`Sending Request (Please Wait)...
`,`

Done.`);frontendRovMsgHandler.sendRovMessage({RovLogs:{}},e)});ae(this,"enableRovWifi",()=>{showToastMessage("Sending Enable Wifi Command...",2e3,!1,ToastSeverity.info),this.sendActionAndWaitForDone({EnableWifi:{}},e=>{e.Error?showToastMessage("Enable Wifi Error: "+e.Error.Message,8e3,!1,ToastSeverity.error):e.Done&&showToastMessage("Wifi Enable: "+e.Done.Message,2e3,!1,ToastSeverity.success)})});ae(this,"disableRovWifi",()=>{modalConfirm("Are you sure you want to disable rov wifi?","If the ROV is connected via wifi, <em>don't do this!</em>",()=>{showToastMessage("Sending Disable Wifi Command...",2e3,!1,ToastSeverity.info),this.sendActionAndWaitForDone({DisableWifi:{}},e=>{e.Error?showToastMessage("Disable Wifi Error: "+e.Error.Message,8e3,!1,ToastSeverity.error):e.Done&&showToastMessage("Wifi Disable: "+e.Done.Message,2e3,!1,ToastSeverity.success)})})})}gamepadButtonTriggers(e,t){const s=GPAD_STANDARD_BUTTON_INDEX.A,a=GPAD_STANDARD_BUTTON_INDEX.B;GPAD_STANDARD_BUTTON_INDEX.X,GPAD_STANDARD_BUTTON_INDEX.Y;const c=GPAD_STANDARD_BUTTON_INDEX.LT,u=GPAD_STANDARD_BUTTON_INDEX.RT,d=GPAD_STANDARD_BUTTON_INDEX.RB,m=GPAD_STANDARD_BUTTON_INDEX.LB;if(t[s]&&t[s].released?this.takeControl():t[a]&&t[a].released&&this.disarm(),t[c]||t[u]){const S=t[c]?e.buttons[c].value:0,C=t[u]?e.buttons[u].value:0;this.sensitivity=1-Math.max(S,C)*.8}const _=[s,a,c,u,m,d],b=t.map((S,C)=>S===!1||_.includes(C)?!1:S.pressed||S.heldDown);this.sendButtonsToRov(b)}gamepadAxisTriggers(e){const t=this.sensitivity,{VelocityX:s,VelocityY:a,VelocityZ:c,AngularVelocityYaw:u}=calculateDesiredMotion(e.axes);s==0&&a==0&&c==0&&u==0&&console.info("GAMEPAD MOTION: STOPed"),this.moveRov(s*t,a*t,c*t,u*t)}sendActionAndWaitForDone(e,t){frontendRovMsgHandler.sendRovMessage(e,s=>{t&&(s.Done||s.Error||s.ContinuedOutput)&&t(s)})}startRequiredMsgLoop(){this.requiredMsgsLoopIntervalId||(this.requiredMsgsLoopIntervalId=Number(setInterval(()=>{if(frontendConnMngr.connectionState.get()!=ConnectionStates.connected)return;const e=Date.now();e-this.lastPingTime>PING_INTERVAL&&(frontendRovMsgHandler.sendRovMessage({Ping:{Time:Date.now()}},null),this.lastPingTime=e),e-this.lastMovementTime>MOVE_MSG_TIMEOUT&&(frontendRovMsgHandler.sendRovMessage({Move:this.lastMove},null),this.lastMovementTime=e)},10)))}stopRequiredMsgLoop(){clearInterval(this.requiredMsgsLoopIntervalId),this.requiredMsgsLoopIntervalId=null}showCommandOutputPopup(e,t,s){let a=modalScrollingText(e,"",null);return a(t),c=>{c.ContinuedOutput?a(c.ContinuedOutput.Message+`
`):c.Done?a(c.Done.Message+`
`+s):c.Error&&a(c.Error.Message+`
`)}}takeControl(){frontendRovMsgHandler.sendRovMessage({TakeControl:{}},null)}disarm(){frontendRovMsgHandler.sendRovMessage({Disarm:{}},null)}setFlightMode(e){frontendRovMsgHandler.sendRovMessage({SetAutopilotMode:{mode:e}},null)}moveRov(e,t,s,a,c=-1){const u=c===-1?this.lastMove.ButtonBitmask:c;e-this.lastMove.VelocityX+(t-this.lastMove.VelocityY)+(s-this.lastMove.VelocityZ)+(a-this.lastMove.AngularVelocityYaw);const d={VelocityX:e,VelocityY:t,VelocityZ:s,AngularVelocityYaw:a,ButtonBitmask:u};console.log("MOVE:",d.VelocityX,d.VelocityY,d.VelocityZ,d.AngularVelocityYaw,d.ButtonBitmask),frontendRovMsgHandler.sendRovMessage({Move:d},null),this.lastMove=d,this.lastMovementTime=Date.now()}sendButtonsToRov(e){const t=this.lastMove.VelocityX,s=this.lastMove.VelocityY,a=this.lastMove.VelocityZ,c=this.lastMove.AngularVelocityYaw,u=e.reduce((m,_,b)=>(_&&(m|=1<<GPAD_STANDARD_BUTTON_INDEX_TO_MAVLINK_INDEX[b]),m),0),d=Date.now()-this.lastMovementTime;this.lastMove.ButtonBitmask===u&&d<700||(frontendRovMsgHandler.sendRovMessage({Move:{VelocityX:t,VelocityY:s,VelocityZ:a,AngularVelocityYaw:c,ButtonBitmask:u}},null),this.lastMove.ButtonBitmask=u,this.lastMovementTime=Date.now())}refreshAllSensorData(){frontendRovMsgHandler.sendRovMessage({RefreshAllSensors:{}},null)}toggleLights(){frontendRovMsgHandler.sendRovMessage({ToogleLights:{}},null)}takePhoto(){frontendRovMsgHandler.sendRovMessage({TakePhoto:{}},null)}startVideoRecording(){frontendRovMsgHandler.sendRovMessage({StartVideoRec:{}},null)}stopVideoRecording(){frontendRovMsgHandler.sendRovMessage({StopVideoRec:{}},null)}}const RovActions=new RovActionsClass;function popup(n,e){const{computePosition:t,autoUpdate:s,offset:a,shift:c,flip:u,arrow:d,size:m,autoPlacement:_,hide:b,inline:S}=get_store_value(storePopup),C={open:!1,autoUpdateCleanup:()=>{}},w=':is(a[href], button, input, textarea, select, details, [tabindex]):not([tabindex="-1"])';let O;const I="https://www.skeleton.dev/utilities/popups";let N,P,B=!1;function x(){N=document.querySelector(`[data-popup="${e.target}"]`)??document.createElement("div"),P=N.querySelector(".arrow")??document.createElement("div")}x();function F(){var se,re,ue,de,he,me,le,_e;if(!N)throw new Error(`The data-popup="${e.target}" element was not found. ${I}`);if(!t)throw new Error(`Floating UI 'computePosition' not found for data-popup="${e.target}". ${I}`);if(!a)throw new Error(`Floating UI 'offset' not found for data-popup="${e.target}". ${I}`);if(!c)throw new Error(`Floating UI 'shift' not found for data-popup="${e.target}". ${I}`);if(!u)throw new Error(`Floating UI 'flip' not found for data-popup="${e.target}". ${I}`);if(!d)throw new Error(`Floating UI 'arrow' not found for data-popup="${e.target}". ${I}`);const X=[];m&&X.push(m((se=e.middleware)==null?void 0:se.size)),_&&X.push(_((re=e.middleware)==null?void 0:re.autoPlacement)),b&&X.push(b((ue=e.middleware)==null?void 0:ue.hide)),S&&X.push(S((de=e.middleware)==null?void 0:de.inline)),t(n,N,{placement:e.placement??"bottom",middleware:[a(((he=e.middleware)==null?void 0:he.offset)??8),c(((me=e.middleware)==null?void 0:me.shift)??{padding:8}),u((le=e.middleware)==null?void 0:le.flip),d(((_e=e.middleware)==null?void 0:_e.arrow)??{element:P||null}),...X]}).then(({x:fe,y:ve,placement:ne,middlewareData:j})=>{if(Object.assign(N.style,{left:`${fe}px`,top:`${ve}px`}),P){const{x:$,y:Z}=j.arrow,ce={top:"bottom",right:"left",bottom:"top",left:"right"}[ne.split("-")[0]];Object.assign(P.style,{left:$!=null?`${$}px`:"",top:Z!=null?`${Z}px`:"",right:"",bottom:"",[ce]:"-4px"})}})}function k(){N&&(B=!0,setTimeout(()=>{B&&(C.open=!0,e.state&&e.state({state:C.open}),F(),N.style.display="block",N.style.opacity="1",N.style.pointerEvents="auto",N.removeAttribute("inert"),C.autoUpdateCleanup=s(n,N,F),O=Array.from(N==null?void 0:N.querySelectorAll(w)))},e.delay??0))}function J(X){if(!N)return;B=!1;const se=parseFloat(window.getComputedStyle(N).transitionDuration.replace("s",""))*1e3;setTimeout(()=>{C.open=!1,e.state&&e.state({state:C.open}),N.style.opacity="0",N.setAttribute("inert",""),C.autoUpdateCleanup&&C.autoUpdateCleanup(),X&&X()},se)}function z(){C.open===!1?k():J()}function H(X){if(C.open===!1||n.contains(X.target))return;if(N&&N.contains(X.target)===!1){J();return}const se=e.closeQuery===void 0?"a[href], button":e.closeQuery,re=N==null?void 0:N.querySelectorAll(se);re==null||re.forEach(ue=>{ue.contains(X.target)&&J()})}const W=X=>{if(C.open===!1)return;const se=X.key;if(se==="Escape"){X.preventDefault(),n.focus(),J();return}O=Array.from(N==null?void 0:N.querySelectorAll(w)),C.open&&document.activeElement===n&&(se==="ArrowDown"||se==="Tab")&&w.length>0&&O.length>0&&(X.preventDefault(),O[0].focus())};switch(e.event){case"click":n.addEventListener("click",z,!0),window.addEventListener("click",H,!0);break;case"hover":n.addEventListener("mouseover",()=>k(),!0),n.addEventListener("mouseleave",()=>J(),!0);break;case"focus-blur":n.addEventListener("focus",z,!0),n.addEventListener("blur",()=>J(),!0);break;case"focus-click":n.addEventListener("focus",k,!0),window.addEventListener("click",H,!0);break;default:throw new Error(`Event value of '${e.event}' is not supported. ${I}`)}return window.addEventListener("keydown",W,!0),F(),{update(X){J(()=>{e=X,F(),x()})},toggle:z,open:k,close:J,destroy(){n.removeEventListener("click",z,!0),n.removeEventListener("mouseover",k,!0),n.removeEventListener("mouseleave",()=>J(),!0),n.removeEventListener("focus",z,!0),n.removeEventListener("focus",k,!0),n.removeEventListener("blur",()=>J(),!0),window.removeEventListener("click",H,!0),window.removeEventListener("keydown",W,!0)}}}function get_each_context$4(n,e,t){const s=n.slice();return s[1]=e[t],s}function create_each_block$4(n){let e,t=n[1].label+"",s,a,c,u,d,m,_;return{c(){e=element("div"),s=text(t),a=space(),c=element("div"),u=space(),this.h()},l(b){e=claim_element(b,"DIV",{class:!0,"data-popup":!0});var S=children(e);s=claim_text(S,t),a=claim_space(S),c=claim_element(S,"DIV",{class:!0}),children(c).forEach(detach),u=claim_space(S),S.forEach(detach),this.h()},h(){attr(c,"class","arrow variant-filled-primary popper-tooltip-arrow"),attr(e,"class","card px-4 py-2 opacity-95 font-bold max-w[40px] variant-filled-primary z-40 pointer-events-none select-none"),attr(e,"data-popup",d=n[1].id)},m(b,S){insert_hydration(b,e,S),append_hydration(e,s),append_hydration(e,a),append_hydration(e,c),append_hydration(e,u),_=!0},p(b,S){(!_||S&1)&&t!==(t=b[1].label+"")&&set_data(s,t),(!_||S&1&&d!==(d=b[1].id))&&attr(e,"data-popup",d)},i(b){_||(b&&add_render_callback(()=>{_&&(m||(m=create_bidirectional_transition(e,fade,{duration:1e3},!0)),m.run(1))}),_=!0)},o(b){b&&(m||(m=create_bidirectional_transition(e,fade,{duration:1e3},!1)),m.run(0)),_=!1},d(b){b&&detach(e),b&&m&&m.end()}}}function create_fragment$s(n){let e,t,s=ensure_array_like(n[0]),a=[];for(let u=0;u<s.length;u+=1)a[u]=create_each_block$4(get_each_context$4(n,s,u));const c=u=>transition_out(a[u],1,1,()=>{a[u]=null});return{c(){for(let u=0;u<a.length;u+=1)a[u].c();e=empty()},l(u){for(let d=0;d<a.length;d+=1)a[d].l(u);e=empty()},m(u,d){for(let m=0;m<a.length;m+=1)a[m]&&a[m].m(u,d);insert_hydration(u,e,d),t=!0},p(u,[d]){if(d&1){s=ensure_array_like(u[0]);let m;for(m=0;m<s.length;m+=1){const _=get_each_context$4(u,s,m);a[m]?(a[m].p(_,d),transition_in(a[m],1)):(a[m]=create_each_block$4(_),a[m].c(),transition_in(a[m],1),a[m].m(e.parentNode,e))}for(group_outros(),m=s.length;m<a.length;m+=1)c(m);check_outros()}},i(u){if(!t){for(let d=0;d<s.length;d+=1)transition_in(a[d]);t=!0}},o(u){a=a.filter(Boolean);for(let d=0;d<a.length;d+=1)transition_out(a[d]);t=!1},d(u){u&&detach(e),destroy_each(a,u)}}}let savedTooltips=nStore([]);const addTooltip=async(n,e,t)=>{let s,a,c;return savedTooltips.update(u=>(a="TT-"+String(u.length),t=Object.assign({event:"hover",target:a,delay:1500,placement:"left",middleware:{autoPlacement:{autoAlignment:!1,crossAxis:!0,allowedPlacements:["left","right"]}}},t),c=u.length,u.push({id:a,label:e,config:t}),u)),await waitfor(1),s=popup(n,t),savedTooltips.get()[c].actions=s,s};function instance$s(n,e,t){let s;return component_subscribe(n,savedTooltips,a=>t(0,s=a)),[s]}class HelpTooltips extends SvelteComponent{constructor(e){super(),init(this,e,instance$s,create_fragment$s,safe_not_equal,{})}}const LEFT_X_AXIS_INDEX=0,LEFT_Y_AXIS_INDEX=1,RIGHT_X_AXIS_INDEX=2,RIGHT_Y_AXIS_INDEX=3,X_BUTTON_INDEX=0,gpadHelpTooltips=[];class GamepadController{constructor(){ae(this,"gpadUi");ae(this,"gpadEmulator");ae(this,"gpadApiWrapper");ae(this,"touchedGpadButtonCount",0);ae(this,"onAxisChange");ae(this,"onButtonChange");this.gpadUi=new GamepadUi,this.touchedGpadButtonCount=0}start(e,t){this.gpadUi.start(),this.gpadEmulator=new y(.1),new G({}).gamepadApiSupported()||this.gpadUi.showNotSupported(),this.gpadApiWrapper=new G({axisDeadZone:.05,updateDelay:28,buttonConfigs:GAME_CONTROLLER_BUTTON_CONFIG}),this.onAxisChange=e,this.onButtonChange=t,this.gpadApiWrapper.onGamepadConnect(this.gamepadConnectDisconnectHandler.bind(this)),this.gpadApiWrapper.onGamepadDisconnect(this.gamepadConnectDisconnectHandler.bind(this)),this.gpadApiWrapper.onGamepadAxisChange(this.handleAxisChange.bind(this)),this.gpadApiWrapper.onGamepadButtonChange(this.handleButtonChange.bind(this))}setupOnscreenGamepad(e){this.gpadEmulator.AddEmulatedGamepad(0,!0,T,A),this.setupGamepadDisplay(0,e),this.setupEmulatedGamepadInput(0,e),this.addEmulatedGamepadKeyboardBindings(0),this.addHelpTooltips()}gamepadConnectDisconnectHandler(){const e=navigator.getGamepads();let t=e.reduce((s,a)=>a?s+1:s,0);t!=0&&e[0].emulated&&(t-=1),t>1&&console.log("WARNING: More than one gamepad connected!",e)}handleButtonChange(e,t,s){if(!(e!=0||!t||!t.buttons)){this.onButtonChange&&this.onButtonChange(t,s);for(let a=0;a<s.length;a++)s[a]&&s[a].touchDown?gpadHelpTooltips[a]&&gpadHelpTooltips[a].open():s[a]&&s[a].touchUp&&gpadHelpTooltips[a]&&gpadHelpTooltips[a].close()}}handleAxisChange(e,t){if(e!=0||!t||!t.axes)return;this.onAxisChange&&this.onAxisChange(t);const s=[{axisRange:14,xValue:t.axes[0]||0,yValue:t.axes[1]||0,thumbStickElement:document.getElementById("stick_left"),upIndicatorElement:document.getElementById("l_stick_up_direction_highlight"),downIndicatorElement:document.getElementById("l_stick_down_direction_highlight"),leftIndicatorElement:document.getElementById("l_stick_left_direction_highlight"),rightIndicatorElement:document.getElementById("l_stick_right_direction_highlight"),upHelpText:"Forward",downHelpText:"Back",leftHelpText:"Turn Left",rightHelpText:"Turn Right"},{axisRange:14,xValue:t.axes[2]||0,yValue:t.axes[3]||0,thumbStickElement:document.getElementById("stick_right"),upIndicatorElement:document.getElementById("r_stick_up_direction_highlight"),downIndicatorElement:document.getElementById("r_stick_down_direction_highlight"),leftIndicatorElement:document.getElementById("r_stick_left_direction_highlight"),rightIndicatorElement:document.getElementById("r_stick_right_direction_highlight"),upHelpText:"Up",downHelpText:"Down",leftHelpText:"Strafe Left",rightHelpText:"Strafe Right"}];this.gpadUi.handleGamepadVisualFeedbackAxisEvents(s,.4)}setupGamepadDisplay(e,t){t.querySelectorAll("#stick_right, #stick_left").forEach(c=>{o$1(c)});const s=ONSCREEN_GPAD_BUTTON_LABELS.map((c,u)=>c.includes("trigger")?{type:v.variable,highlight:t.querySelector("#"+c+"_highlight"),buttonElement:t.querySelector("#"+c),direction:l$2.down,directionHighlight:t.querySelector("#"+c+"_direction_highlight"),movementRange:10}:{type:v.onOff,highlight:t.querySelector("#"+c+"_highlight")}),a=[{joystickElement:t.querySelector("#stick_left"),xAxisIndex:0,yAxisIndex:1,movementRange:10,highlights:{[l$2.up]:t.querySelector("#l_stick_up_direction_highlight"),[l$2.down]:t.querySelector("#l_stick_down_direction_highlight"),[l$2.left]:t.querySelector("#l_stick_left_direction_highlight"),[l$2.right]:t.querySelector("#l_stick_right_direction_highlight")}},{joystickElement:t.querySelector("#stick_right"),xAxisIndex:2,yAxisIndex:3,movementRange:10,highlights:{[l$2.up]:t.querySelector("#r_stick_up_direction_highlight"),[l$2.down]:t.querySelector("#r_stick_down_direction_highlight"),[l$2.left]:t.querySelector("#r_stick_left_direction_highlight"),[l$2.right]:t.querySelector("#r_stick_right_direction_highlight")}}];new D({gamepadIndex:e,pressedHighlightClass:"pressed",touchedHighlightClass:"touched",moveDirectionHighlightClass:"moved",buttons:s,sticks:a},this.gpadApiWrapper)}setupEmulatedGamepadInput(e,t){const s=ONSCREEN_GPAD_BUTTON_LABELS.map((c,u)=>c.includes("trigger")?{type:v.variable,buttonIndex:u,tapTarget:t.querySelector("#"+c+"_touch_target"),dragDistance:50,lockTargetWhilePressed:!0,directions:{[l$2.up]:!1,[l$2.down]:!0,[l$2.left]:!1,[l$2.right]:!1}}:{type:v.onOff,buttonIndex:u,lockTargetWhilePressed:c.includes("stick"),tapTarget:t.querySelector("#"+c+"_touch_target")});this.gpadEmulator.AddDisplayButtonEventListeners(e,s);const a=[{tapTarget:t.querySelector("#gamepad-joystick-touch-area-left"),dragDistance:30,xAxisIndex:0,yAxisIndex:1,lockTargetWhilePressed:!0,directions:{[l$2.up]:!0,[l$2.down]:!0,[l$2.left]:!0,[l$2.right]:!0}},{tapTarget:t.querySelector("#gamepad-joystick-touch-area-right"),dragDistance:30,xAxisIndex:2,yAxisIndex:3,lockTargetWhilePressed:!0,directions:{[l$2.up]:!0,[l$2.down]:!0,[l$2.left]:!0,[l$2.right]:!0}},{tapTarget:t.querySelector("#stick_button_left_touch_target"),dragDistance:30,xAxisIndex:0,yAxisIndex:1,lockTargetWhilePressed:!0,directions:{[l$2.up]:!0,[l$2.down]:!0,[l$2.left]:!0,[l$2.right]:!0}},{tapTarget:t.querySelector("#stick_button_right_touch_target"),dragDistance:30,xAxisIndex:2,yAxisIndex:3,lockTargetWhilePressed:!0,directions:{[l$2.up]:!0,[l$2.down]:!0,[l$2.left]:!0,[l$2.right]:!0}}];this.gpadEmulator.AddDisplayJoystickEventListeners(e,a)}addEmulatedGamepadKeyboardBindings(e){const t=(s,a)=>{const c=["INPUT","TEXTAREA","SELECT","OPTION"];if(a=a||window.event,c.includes(a.target.tagName))return;const u=parseInt(a.key);a.key==="Space"&&s&&this.gpadEmulator.PressButton(e,X_BUTTON_INDEX,1,!0),a.key==="a"?this.gpadEmulator.MoveAxis(e,LEFT_X_AXIS_INDEX,s?-1:0):a.key==="d"?this.gpadEmulator.MoveAxis(e,LEFT_X_AXIS_INDEX,s?1:0):a.key==="w"?this.gpadEmulator.MoveAxis(e,LEFT_Y_AXIS_INDEX,s?-1:0):a.key==="s"?this.gpadEmulator.MoveAxis(e,LEFT_Y_AXIS_INDEX,s?1:0):a.key==="ArrowLeft"?(this.gpadEmulator.MoveAxis(e,RIGHT_X_AXIS_INDEX,s?-1:0),a.preventDefault()):a.key==="ArrowRight"?(this.gpadEmulator.MoveAxis(e,RIGHT_X_AXIS_INDEX,s?1:0),a.preventDefault()):a.key==="ArrowUp"?(this.gpadEmulator.MoveAxis(e,RIGHT_Y_AXIS_INDEX,s?-1:0),a.preventDefault()):a.key==="ArrowDown"?(this.gpadEmulator.MoveAxis(e,RIGHT_Y_AXIS_INDEX,s?1:0),a.preventDefault()):isNaN(u)?a.keyCode&&this.gpadEmulator.PressButton(e,a.keyCode-66+9,s?1:0,s):this.gpadEmulator.PressButton(e,Math.max(u-1,0),s?1:0,s)};window.onkeydown=s=>t(!0,s),window.onkeyup=s=>t(!1,s)}testGamepadJoysticks(){setInterval(()=>{this.gpadEmulator.MoveAxis(0,0,Math.random()*2-1),this.gpadEmulator.MoveAxis(0,1,Math.random()*2-1),this.gpadEmulator.MoveAxis(0,2,Math.random()*2-1),this.gpadEmulator.MoveAxis(0,3,Math.random()*2-1)},10)}addHelpTooltips(){ONSCREEN_GPAD_BUTTON_LABELS.forEach(async(e,t)=>{const s=document.getElementById(e+"_touch_target");s&&(gpadHelpTooltips[t]=await addTooltip(s,GAME_CONTROLLER_BUTTON_CONFIG[t].helpLabel,{placement:GAME_CONTROLLER_BUTTON_CONFIG[t].tooltipPlacement}))})}}const gpadCtrl=new GamepadController;class FrontendStartupFlowClass{async start(){await this.checkIfInIframe()}async onConnectedActions(){await frontendConnMngr.startSimplePeerConnection()}async checkIfInIframe(){if(window.parent===window){console.log("We are not in an iframe, trying to connect to Livekit Cloud...");try{await frontendConnMngr.initUsingCloudLivekitConnection()}catch(e){await this.failedToConnectToLivekitCloud(e)}}else console.log("We are in an iframe, alerting user"),modalConfirm("Uh oh, rov control won't work here","Click ok to open this page outside BlueOS",()=>{window.open(window.location.toString())})}async failedToConnectToLivekitCloud(e){throw console.error("Livekit Cloud Not Accessable",e),new Error("Byeeeee!")}async failedToConnectToLocalLivekit(e){console.error("Local Livekit Server Not Accessable: ",e)}async navigateToROVLocalIframePage(){window.location.href=URL_PARAMS.LIVEKIT_LOCAL_ENDPOINT+"/offlineframe"}}const frontendStartupFlow=new FrontendStartupFlowClass,initPage=()=>{debugPageModeActive.set(getURLQueryStringVariable("debug")!=null),document.addEventListener("fullscreenchange",n=>{fullscreenOpen.set(document.fullscreenElement!==null)}),window.onbeforeunload=()=>{frontendConnMngr.disconnect()},bindNumberSvelteStoreToLocalStorage("rovPeerIdEndNumber",rovPeerIdEndNumber,0),bindStringSvelteStoreToLocalStorage("ourPeerId",ourPeerId),frontendStartupFlow.start(),gpadCtrl.start(RovActions.gamepadAxisTriggers.bind(RovActions),RovActions.gamepadButtonTriggers.bind(RovActions),10),RovActions.startRequiredMsgLoop()},LoadingIndicator_svelte_svelte_type_style_lang="";function create_if_block$5(n){let e,t,s,a,c;return{c(){e=element("div"),t=element("div"),s=space(),a=element("span"),c=text(n[0]),this.h()},l(u){e=claim_element(u,"DIV",{id:!0,class:!0});var d=children(e);t=claim_element(d,"DIV",{class:!0}),children(t).forEach(detach),s=claim_space(d),a=claim_element(d,"SPAN",{id:!0,class:!0});var m=children(a);c=claim_text(m,n[0]),m.forEach(detach),d.forEach(detach),this.h()},h(){attr(t,"class","svelte-112od4m"),attr(a,"id","site_loading_text"),attr(a,"class","svelte-112od4m"),attr(e,"id","site_loading_indicator"),attr(e,"class","lds-circle bg-surface-900 border-4 border-surface-700 shadow-2xl svelte-112od4m")},m(u,d){insert_hydration(u,e,d),append_hydration(e,t),append_hydration(e,s),append_hydration(e,a),append_hydration(a,c)},p(u,d){d&1&&set_data(c,u[0])},d(u){u&&detach(e)}}}function create_fragment$r(n){let e,t=n[0]!=null&&create_if_block$5(n);return{c(){t&&t.c(),e=empty()},l(s){t&&t.l(s),e=empty()},m(s,a){t&&t.m(s,a),insert_hydration(s,e,a)},p(s,[a]){s[0]!=null?t?t.p(s,a):(t=create_if_block$5(s),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:noop$3,o:noop$3,d(s){s&&detach(e),t&&t.d(s)}}}let currentMsg=nStore(null);function instance$r(n,e,t){let s;return component_subscribe(n,currentMsg,a=>t(0,s=a)),[s]}class LoadingIndicator extends SvelteComponent{constructor(e){super(),init(this,e,instance$r,create_fragment$r,safe_not_equal,{})}}const GamepadLeftSvg=`<svg width="100%" height="100%" viewBox="0 0 123 232" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd">
  <g id="left_side_of_controller">
    <path d="M112.977 140.769c-6 29.375-13.537 33.424-35.28 43.583-35.355 16.519-33.138 57.105-56.59 45.51-14.36-7.1-21.13-19.23-21.13-38.4 0-24.92 11.42-65.99 32.4-119.1 10.625-22.199 25.844-16.641 42.794-16.641 7.93 0 15.744-1.226 22.454 2.224 14.564 7.511 21.031 55.022 15.352 82.824Z"/>
    <g id="stick_button_left">
      <g id="stick_bg_left">
        <circle id="shadow10" cx="81.987" cy="176.33" r="26.46" style="fill-opacity:.5"/>
        <circle id="Oval5" cx="80.737" cy="175.09" r="25.21" style="fill:#6180b0;stroke:#000;stroke-width:2.49px"/>
      </g>
      <path d="M80.737 179.329v-8.477h25.442v-7.872l12.11 12.11-12.11 12.11v-7.871H80.737Z" style="fill:#ff00bf" class="direction_highlight" id="l_stick_right_direction_highlight"/>
      <path d="M76.499 175.09h8.477v25.442h7.872l-12.11 12.11-12.11-12.11h7.871V175.09Z" style="fill:#ff00bf" class="direction_highlight" id="l_stick_down_direction_highlight"/>
      <path d="M80.737 170.852v8.477H55.295v7.871l-12.11-12.11 12.11-12.11v7.872h25.442Z" style="fill:#ff00bf" class="direction_highlight" id="l_stick_left_direction_highlight"/>
      <path d="M84.976 175.09h-8.477v-25.442h-7.872l12.11-12.11 12.11 12.11h-7.871v25.442Z" style="fill:#ff00bf" class="direction_highlight" id="l_stick_up_direction_highlight"/>
      <g id="stick_left">
        <circle id="shadow11" cx="82.597" cy="176.96" r="17.12" style="fill-opacity:.5"/>
        <use xlink:href="#2a" x="48" y="143" width="65" height="65" class="gpad-highlight" id="stick_button_left_highlight"/>
        <g id="Group-6">
          <circle id="Oval-Copy" cx="80.737" cy="175.09" r="15.88" style="fill:#fff;stroke:#000;stroke-width:2.49px"/>
          <circle id="Oval-Copy-2" cx="80.737" cy="175.09" r="12.14" style="fill:#fff;stroke:#000;stroke-width:1.25px"/>
          <path d="M79.737 170.127a.402.402 0 0 0-.4-.4h-.725a.4.4 0 0 1-.32-.64l2.125-2.833a.4.4 0 0 1 .64 0l2.125 2.833a.4.4 0 0 1-.32.64h-.725a.402.402 0 0 0-.4.4v2.088a.402.402 0 0 0 .354.397c1.712.21 3.36.845 4.718 1.903a.4.4 0 0 0 .481.011l.619-.445a.399.399 0 0 1 .634.332l-.058 3.054a.4.4 0 0 1-.519.374l-2.916-.91a.402.402 0 0 1-.114-.707l.125-.091a.398.398 0 0 0-.018-.662 7.939 7.939 0 0 0-2.845-1.046.4.4 0 0 0-.459.394c-.002 1.15-.002 4.148-.002 5.234a.4.4 0 0 0 .4.4h.725a.4.4 0 0 1 .32.64l-2.125 2.833a.398.398 0 0 1-.64 0l-2.125-2.833a.4.4 0 0 1 .32-.64h.725a.4.4 0 0 0 .4-.4v-5.21a.4.4 0 0 0-.467-.395 8.156 8.156 0 0 0-2.818 1.075.398.398 0 0 0-.024.654c.045.036.093.072.141.108a.4.4 0 0 1-.127.704l-2.93.861a.399.399 0 0 1-.513-.383l-.006-3.054a.4.4 0 0 1 .639-.322l.604.451a.4.4 0 0 0 .486-.005c1.357-1.045 2.985-1.681 4.666-1.909a.4.4 0 0 0 .348-.396l.001-2.105Z"/>
        </g>
      </g>
    </g>
    <g id="select_button">
      <use xlink:href="#2b" x="78" y="118" width="43" height="39" class="gpad-highlight" id="select_button_highlight"/>
      <path id="select" d="M105.267 133.325a7.506 7.506 0 0 1 2.496 5.595 7.507 7.507 0 0 1-2.496 5.596H95.213a7.507 7.507 0 0 1-2.496-5.596c0-2.22.964-4.217 2.496-5.595h10.054Z" style="fill:#9a9a9a;fill-opacity:.5"/>
      <path id="select1" d="M104.162 132.138a7.506 7.506 0 0 1 2.496 5.595 7.507 7.507 0 0 1-2.496 5.596H94.108a7.507 7.507 0 0 1-2.496-5.596c0-2.22.964-4.217 2.496-5.595h10.054Z" style="fill:#fff;stroke:#000;stroke-width:1.35px"/>
      <text x="96.295" y="141.267" style="font-family:'ArialRoundedMTBold','Arial Rounded MT Bold',sans-serif;font-size:9.858px">?</text>
    </g>
    <g id="d_pad">
      <path d="M86.434 71.626c.913 0 1.659.746 1.659 1.659v18.212h18.212c.913 0 1.66.747 1.66 1.659v14.893c0 .913-.747 1.66-1.66 1.66H88.093v18.211c0 .913-.746 1.66-1.659 1.66H71.541c-.911 0-1.66-.749-1.66-1.66v-18.211H51.67c-.911 0-1.66-.749-1.66-1.66V93.156c0-.902.747-1.659 1.66-1.659h18.211V73.285c0-.902.747-1.659 1.66-1.659h14.893Z" style="fill:#9a9a9a;fill-opacity:.5" id="shadow14"/>
      <use xlink:href="#2c" x="53" y="54" width="48" height="53" class="gpad-highlight" id="d_pad_up_highlight"/>
      <use xlink:href="#2d" x="53" y="91" width="48" height="52" class="gpad-highlight" id="d_pad_down_highlight"/>
      <use xlink:href="#2e" x="70" y="75" width="52" height="48" class="gpad-highlight" id="d_pad_right_highlight"/>
      <use xlink:href="#2f" x="33" y="75" width="52" height="48" class="gpad-highlight" id="d_pad_left_highlight"/>
      <path d="M84.774 69.966c.913 0 1.66.747 1.66 1.66v18.211h18.222c.902 0 1.659.747 1.659 1.66V106.4c0 .903-.757 1.66-1.659 1.66H86.434v18.211c0 .903-.747 1.66-1.66 1.66H69.892c-.911 0-1.66-.749-1.66-1.66v-18.222H50.01c-.91 0-1.659-.749-1.659-1.659V91.497c0-.913.747-1.66 1.659-1.66h18.212V71.626c0-.913.747-1.66 1.659-1.66h14.893Z" style="fill:#fff;stroke:#000;stroke-width:1.66px;stroke-linejoin:round"/>
      <path d="m91.827 94.401 9.095 4.542-9.105 4.564V94.39l.01.011Z" style="fill:none;stroke:#000;stroke-width:1.66px;stroke-linejoin:round" id="d_pad_right"/>
      <path d="m62.839 103.496-9.106-4.553 9.106-4.553v9.106Z" style="fill:none;stroke:#000;stroke-width:1.66px;stroke-linejoin:round" id="d_pad_left"/>
      <path d="m81.881 113.432-4.553 9.106-4.553-9.106h9.106Z" style="fill:none;stroke:#000;stroke-width:1.66px;stroke-linejoin:round" id="d_pad_down"/>
      <path d="m72.775 84.455 4.563-9.106 4.543 9.106h-9.106Z" style="fill:none;stroke:#000;stroke-width:1.66px;stroke-linejoin:round" id="d_pad_up"/>
      <path id="center_icon" d="M71.374 99.114c0-.817.672-1.49 1.49-1.49h8.939c.817 0 1.49.673 1.49 1.49v3.642c0 .817-.673 1.49-1.49 1.49h-8.939c-.818 0-1.49-.673-1.49-1.49v-3.642Zm1.071 1.382v2.389c0 .268.219.485.49.485h8.83a.49.49 0 0 0 .491-.485v-1.742l-1.452-1.437a.497.497 0 0 0-.694 0l-1.249 1.236.308.305c.099.091.156.22.156.355a.491.491 0 0 1-.85.331l-3.394-3.36a.497.497 0 0 0-.694 0l-1.942 1.923Zm5.55-2.209a.662.662 0 1 1 .001 1.323.662.662 0 0 1-.001-1.323Zm-5.131-1.656-.082.001c.21-.594.775-.995 1.406-.994h6.29c.649 0 1.202.415 1.406.994l-.081-.001h-8.939Zm1.242-1.985.082-.002h6.29c.028 0 .055 0 .082.002a1.493 1.493 0 0 0-1.406-.995h-3.642c-.63 0-1.196.4-1.406.995Z"/>
    </g>
    <g id="shoulder_trigger_back_left">
      <g class="direction_highlight" id="shoulder_trigger_back_left_direction_highlight">
        <path d="M110.415 51.254 98.146 34.763h24.538l-12.269 16.491Z" style="fill:#ff00bf"/>
        <path d="M97.161 17.167c2.534 0 13.254.512 13.218 21" style="fill:none;stroke:#ff00bf;stroke-width:8.5px;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5"/>
      </g>
      <path id="shadow4" d="M54.417 40.591h37.84c1.52 0 2.77-.618 2.77-1.36a.695.695 0 0 0-.07-.309l-10.9-23.604c-.7-1.545-3.53-2.648-6.75-2.648h-11.8c-7.66 0-13.86 3.05-13.86 6.811v19.761c0 .741 1.25 1.36 2.77 1.36v-.011Z" style="fill-opacity:.5"/>
      <use xlink:href="#2g" x="32" y="3" width="76" height="56" transform="translate(0 -4.346)" class="gpad-highlight" id="shoulder_trigger_back_left_highlight"/>
      <path id="bg" d="M51.957 38.16c-.38 0-.73-.072-.98-.196-.25-.124-.4-.288-.4-.484V17.719c0-1.69 1.4-3.225 3.65-4.327a20.546 20.546 0 0 1 8.83-1.803h11.79c1.26 0 2.48.206 3.46.597.98.392 1.67.928 1.95 1.525l10.9 23.625c.03.34-.13.515-.38.628-.26.134-.6.206-.98.206h-37.84v-.01Z" style="fill:#fff;stroke:#000;stroke-width:2.2px"/>
      <path d="m74.228 32.999-.217-.942a.766.766 0 0 0-1.493.343l.9 3.914 3.914-.9a.766.766 0 0 0-.343-1.493l-1.606.369c.66-1.61.965-3.317.85-5.04a.766.766 0 0 0-1.529.101 9.59 9.59 0 0 1-.476 3.648Zm-9.227-13.535a2.177 2.177 0 1 1 4.168-.327.93.93 0 0 1 .191.118l2.594 2.023a.986.986 0 0 1-1.213 1.555l-2.594-2.023a1.04 1.04 0 0 1-.16-.158 2.16 2.16 0 0 1-1.678.093l-3.292 3.361.048.141.046.179c.021.101.036.205.043.312v.269c-.006.101-.019.2-.038.297l-.055.216a1.959 1.959 0 0 1-.044.129l3.292 3.361a2.16 2.16 0 0 1 1.678.093.957.957 0 0 1 .16-.158l2.594-2.023a.986.986 0 0 1 1.213 1.555L69.36 30.5a.97.97 0 0 1-.191.117 2.179 2.179 0 1 1-4.308.516 2.184 2.184 0 0 1 .14-.842l-3.291-3.362-.006.002a2.14 2.14 0 0 1-.356.093l-.131.018-.236.013-.171-.007-.188-.023a2.142 2.142 0 0 1-.447-.125l-.232-.108-.19-.117-.204-.158-.153-.147-.147-.173-.081-.113-.129-.221-.084-.186a2.661 2.661 0 0 1-.035-.095h-2.107v1.616a.704.704 0 1 1-1.408 0v-4.641a.704.704 0 1 1 1.408 0v1.616h2.107l.084-.209.08-.155.124-.195.144-.181.089-.095.125-.115.144-.113.065-.045.274-.156a2.182 2.182 0 0 1 .737-.2l.313-.006.24.027c.128.021.251.053.371.095l3.291-3.361Zm1.228 10.811.04-.038a1.127 1.127 0 1 1-.04.038Zm-4.929-6.48a1.13 1.13 0 0 0-1.401.76l-.032.141-.014.181.016.195.03.128a1.13 1.13 0 0 0 1.396.761l.113-.04c.411-.168.7-.572.7-1.044l-.002-.072a1.13 1.13 0 0 0-.698-.972l-.108-.038Zm12.928-7.039a9.59 9.59 0 0 1 .476 3.648.766.766 0 0 0 1.529.101c.115-1.723-.19-3.43-.85-5.04l1.606.369a.766.766 0 0 0 .343-1.493l-3.914-.901-.9 3.915a.765.765 0 1 0 1.493.343l.217-.942Zm-7.959 2.762a1.128 1.128 0 1 0-.04-.039l.04.039Z"/>
    </g>
    <g id="shoulder_button_front_left">
      <path id="shadow5" d="M94.279 44.584H54.287c-2.643 0-4.818 2.591-4.818 5.74v6.9c.004 1.258.875 2.29 1.931 2.29h45.767c1.059 0 1.93-1.038 1.93-2.3v-6.88c0-3.149-2.175-5.74-4.818-5.74v-.01Z" style="fill-opacity:.5"/>
      <use xlink:href="#2h" x="30" y="31" width="86" height="41" class="gpad-highlight" id="shoulder_button_front_left_highlight"/>
      <path id="bg1" d="M92.769 44.934h.017c2.109 0 3.844 2.067 3.844 4.58v6.92c0 .625-.433 1.14-.957 1.14H49.897c-.529 0-.965-.519-.965-1.15v-6.9c0-2.513 1.735-4.58 3.844-4.58h39.993v-.01Z" style="fill:#fff;stroke:#000;stroke-width:2.12px"/>
      <text x="70.61" y="54.634" style="font-family:'ArialRoundedMTBold','Arial Rounded MT Bold',sans-serif;font-size:15px">-</text>
    </g>
    <g id="l_touch_targets" opacity="0">
      <path id="stick_button_left_touch_target" d="M103.497 149.101c7.227 6.337 11.792 15.634 11.792 25.989 0 19.069-15.482 34.551-34.552 34.551-19.069 0-34.551-15.482-34.551-34.551 0-19.07 15.482-34.552 34.551-34.552 2.258 0 4.466.217 6.601.631 1.548 5.051 6.247 8.728 11.797 8.728 1.535 0 3.005-.281 4.362-.796Z" style="fill:#419bf3"/>
      <path id="select_button_touch_target" d="M93.558 126.53a12.266 12.266 0 0 1 5.577-1.333c6.809 0 12.336 5.534 12.336 12.35s-5.527 12.35-12.336 12.35-12.337-5.534-12.337-12.35c0-1.681.336-3.284.945-4.744a18.743 18.743 0 0 0 5.815-6.273Z" style="fill:#419bf3"/>
      <path id="d_pad_left_touch_target" d="M57.9 116.925c-10.093-.218-18.219-8.48-18.219-18.625 0-10.281 8.346-18.628 18.628-18.628.14 0 .279.002.419.005l18.205 18.204v.01L57.9 116.925Z" style="fill:#419bf3"/>
      <path id="d_pad_down_touch_target" d="m57.9 116.925 19.042-19.043 19.033 19.042c.004.14.006.279.006.419 0 10.282-8.348 18.629-18.629 18.629-10.282 0-19.452-8.765-19.452-19.047Z" style="fill:#419bf3"/>
      <path id="d_pad_up_touch_target" d="M67.141 63.678h20.421c4.962 3.261 8.277 8.827 8.413 15.17L76.942 97.882l-.009-.001-18.205-18.204c-.004-.14-.005-.279-.005-.419 0-6.512 3.349-12.249 8.418-15.58Z" style="fill:#419bf3"/>
      <path id="d_pad_right_touch_target" d="m76.942 97.882 19.033-19.034c10.281 0 19.048 9.171 19.048 19.452 0 10.282-8.348 18.629-18.629 18.629-.14 0-.279-.002-.419-.005L76.942 97.882Z" style="fill:#419bf3"/>
      <path id="shoulder_button_front_left_touch_target" d="M99.096 41.101H47.503c-2.766 0-5.009 2.197-5.009 4.908v15.706c0 1.077.905 1.963 2.004 1.963h57.603c1.099 0 2.004-.886 2.004-1.963V46.009c0-2.711-2.243-4.908-5.009-4.908Z" style="fill:#419bf3"/>
      <path id="shoulder_trigger_back_left_touch_target" d="M47.697 41.101h52.635c1.521 0 2.816-1.579 2.065-2.955-2.77-5.082-14.508-29.61-14.508-29.61-.743-1.517-3.545-2.595-6.742-2.595H58.788c-7.657 0-13.864 3.027-13.864 6.761v27.047c0 .741 1.252 1.352 2.773 1.352Z" style="fill:#419bf3"/>
    </g>
  </g>
  <defs>
    <image id="2a" width="65" height="65" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEEAAABBCAYAAACO98lFAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAHVUlEQVR4nO1b2XLjOAyEnawzmUxm9mF+Ll84P5eXzX1rX9R2q9UAacXeo2pQhaJsyyLRBEAQoCJ+U6yO3cHVcF31wb8N1XN+rX6Wv3+GDg6CEXqVXLvPQ8f1wQE5GAgi/Iralfmu6nugdjDfcXsQQD4NAgmfCb6m79w9TApAxXz/p8BYDIKZeeU1teuoAcmE/2i0/J/FQCwCQWY/E/wkdgDoZwUCpIJ+RMR7cs33TjRjXzD2AiFRfSf4CfEpXfM9CgTPPgRWfpPfGJCJqewDRDcIjdlXoStWDQE5AN4a/B5TDVkERBcICQCs5izkHyNvpMVvuJ+1gUFgAF6JX+RawXCa0QVEE4QEAFZtFXwTEWcjb6hlMAACgGBTUABeRn4e+YVaAMNAvIc4zxYQJQgFAGAV/ovhM2LcD7NQTWAteCF+MsygODC6gTitQCgAwGzyrH+JiPOI+Dq2zApECwTWAAj9SLwZ28zJxvic7bOvhutVBkQKgokD1AfwzEP4rxFxMTI+n9N9bBIsAIMAO4faMwD3MQdyLc9R+qDnW7J/FDNQ4aH+EP58FPrbyBfUAoweEODUMhDuie9G5u8eY2cmMA82jSEiBqcNlTm4ZRAgQP0x85ej4N/HFp9bILR8AoPAPkafEfQMx1vf4MxiBkLDDDIAvgs7ELBKYJlsgfAaO+f3GFOfwv93ALggivuZUKYJLhaAZz+LnQ/ArH+PiB8jA4hvsfML0IJNzE0hixPgHJ9juszy/0P+68LrWRCl2tBjDuuYrwbsBy5H4f8kEKAJcIwQgqNGFzazENAGaE/lUF2kmQZQIdowAWE0hSwiZFNgENgMGISL2K0MmUME8+BUG3oAYNBcJAkwuC8PApFziKwF8AfQBJgErlULsiUt20WC3X6DVxNeUl2IrXuMLRBsEg6EbEUACOwUsSxexnSJhC9QZ1htpVUbPuh+5z8yJ1pFkuvYOcm5TyBTyIBgTWBtUGYNYC1o5RIYiHUCAoPk4gkXVmeOeEtLNUEjRF4FeL9Q+QFHmCHdrkN4sGoAYomHmC/HzpdMNIGXGR4IO0V1jNAGjhg1NNaVwM2oCuoY/9Gdqu5XdBwZCJP+EROpJlQD0G2y2yXqdtl2boDXMTBhojAZ78k4dOfauyKVq4NLmigQbneone4DgI6BgRhkLFn+QnMXThMn4ziNmMUHVe7glDrQIIYB4I6dUPuQbubURJndmHg81h9lPsFtnnQWeBDaoVtplpBqg45HweCxuQnRcW0fnHXOJqEdaxY5iwGWCu/G4sbVGlO2Kk3GpSC4DhWMjDPhDwGEjqd3TOqXus1BB5517B5+aC1okY7N9d8cRwbC/5UWgZ+BoGXxfQqkQ5id2pFor6JtRgqCCuCyNRW7zg8FiEuZVXXLtESnVGmCE94lLcoszgFIn9Ma01vUEzQbmwMhE5737e46A8MJsi9l2tiqV2ZF28mY1hHb6oyzbdeRqw06MPa2zUL4bFJeC66AmFCPJrjSWFUT1PzeUiBckoXzCK5OWY1HD3ZsyW2gVAu0LMZJDG6fY7qF5nUbYHO+oEf4TCN1LDoOl1VKtUFBcB5YkXe1Qc0ouw0Lg9EiTaCw+nONksfwFL4K5Uw0InbVqGwrrabANQDuHJkczihzzM5CnYwt5/laAGAM7IdU+AdigPBkQHBARPBAxTmqCjotuDeMgWAwmLXsMIXz9u6QhuYRIXTWP7Sh0oQttXwCA4GBcElMK0PsC0Ke00q5u5WAfYCCfyfMILBfqFasFAQFwiU1HyKvDPEzGEg1lSyR6lYBgP8wCnwbETfEt+Gr06lTTMtwv1Y/h6vhWoVgTeAMkzuMxQKxWmsZTvOOFfCqBbcCAj7fxdQc1Cfg2TOqapGo1mBASGI8xTTL5CpDqsqupL5PQRbaB9W/iYi/Rr6h7wFCtjyiny4QcKMCAdWsKkPOo6OyzOajOcjM/GAKUHc1BTaHh5g7xdIULAijSTihNHHhhMhmkeOIpYc02CECCDUFtypMTqqovBYEEUqBeI25QwOp/2BbZhCqMwZVXIIl0a0KrAXOF2yF7z6uQ9rAzgpm8TrexiDoHkM9egWC9pNFhi420CAJS2PXxglUpqI6zitofZKLtb2lscqhsk+Ac3yMeVDmAjPd1qdnGXvOMbKTzH6vljWtUbp4gUFwTtUd5tQNE+8auwGIaGhChD3VmhVruQSmJTp3rLfn4BYD8WyuOafhEjsR4Y/t7QVCAwitVbqS2Ea+1/AZ5OIE1iz2E5o44VcAOChqAtANQgJEVglypTqefY4RqjDbpfSyM0k2rXfQo/6gxjsPzkyyFz9aYbPbUb4bThO8R3npA1S8+8RVKYDBbVa2Y9JUGgPCbZZB3hsACLGIirfgtETXKtsxue20u7bCRyx7GexT9cLGu5A97MgJyMLrPRHxL70SyFSAgTa7VhpMm11HxH/k5VClBJDq2tFMWLk+6KvCRy2fFy+L94IwoWO9NP5PnCGYUfUm/THfjv9NBf0N6UGHaHzqzbQAAAAASUVORK5CYII="/>
    <image id="2b" width="43" height="39" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAnCAYAAACWn7G7AAAACXBIWXMAAA7EAAAOxAGVKw4bAAADoklEQVRYhdWZ3XbaMBCExxQSCm2v8nJ5wrxc7hrCT0joBRo8HkayKTetztkjY2T0abzeXQvgP2rdPRc/n15vuv6lezrdM9/kySpgty72CvaWBYxOZpCd9a3jBHeq9ADGwauwDUg1hOMxODXYcRM4wgpogpxVjn1xNcCvyufLomrAV7AG6pDJHFqbQyVLC4jA87SCBuQ3s5n0Duygn8X0mIZy/rLI59Nr58AD2KCqQs5LvyjHcznnwAqrcMdgXQ04KZhAOSlBCLgA8GD9QhbjsAr6IXawzx8YKn/xY1XX3cBvPyEI9wDg0YzQhJ0JrIPui81LX/NxXfClJZ8lrKq6KGBLAN+LLYspMN1BYY84K7kHsCtG9/G7cBXa1HdryrqvPhSwVbF16QlOYMJ26F2Aiu4AvNuiUqTQ8wN156SXVSosXUBV/SFG6GWBpWIoEx8L7A7AVsbMZIxHB57TWN3DBmXpBuqvVHYN4KfYWtRdmLJ8mLblewflYmjHApxi9k1u8FigVjir+kuAV+hdwWH3shCqRfc4iGk00bsco0GKsUldAqvCa/SuoG5AWILwlh/QP2yMJBqvo7IzP9FQV4Edeo3eh92naXwgGUGoNkFTFgSAjjkguYEDc8WatTTuauylssxKFOOIs8KaSGrZr1bBVWsDH5ySRaoVaLz2qzI2FUC1krSawbTV6koP3MmmjPM5Rt8YWrA6ocdCFiEaduboowBKzyedY3ldqgPSIppxNtWfDsfUyaxEPz2VMeqzmhD49O9lERpbFXoAnNKtDkqgmt81G2lMZSrt5Fqm2TcAm3K8FWgHdujJynohQkiFIugSOYPxug2A3w1gugbnVgGbsKosb70GcIYkfs906rBc6LYAbnBW+A29a4y5Q4RlHcmB6gJ7DMMOTDktZLRE1EKG7rARo7qEHXeDl+7pVLJETVl9DyMoVeND5qqrG/GB3Iq9o3/gkrLAiBtwACdK+wRepzKLadrk7xBWo8gO15HBX2viW27y2Rqwnqeq/h6Wqn8HTqZuEF0AsPwrRbgXMlobaG6vVUyE1fcwTySeKLiwC3DzVVwmAa5fi9WXGfy9YvIqTtXldQrvbwieyQZtyo6MFh1exPjOTGuTQ+0znBvE17QjM2WvK+1z1Xr9TS9ofKuounUE5O2jCBuAE3iKFGkfQIHHKrQqaBPWgB261aeWqqmrWPrX+7Pawq732OfUqrXr1N3vSbDabv0fodbu/X/hn29/AAo2VaYa5XYBAAAAAElFTkSuQmCC"/>
    <image id="2c" width="48" height="53" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAA1CAYAAAAHz2g0AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAEw0lEQVRoge1ay3LbMAxc2c6zSU/5uX5hfq7HJo7t2OqhXGu1Akgp8UybmXIGI1mWCCxeBCEBX3x0l5zsR/9z9nzP3VN/CZ6zGTaE+4wiUiBzQFYZB0J3M86XDBewz/7LwISMTfAuOEbXqnPOELSvnAOIQawajCjsqtBaaFPoSug6+H2dXL+S5znXWnithH8HxG48uSA36cMrjIH4uVNtuJZ7ACc5nux3bzSyxIhZRXhqPzq6xhAcM8Ep5LFxTEFsAg258O426j68Hpm9BYCaPhZ6lyPPO/lf5ziPCAAZq+YjfydFQDIAmfCHIvSh0L781mdPMt/UhYr7uNtQcAbdTaFrOXoQasyQBxmqb1PbFJi0kyMB0SLqUnjunvqaC6n2KfwtgLtyvDVAbgkH4D5PzVPYt0Jre0YDW90zjQFg6j4EcAfgXohgbjB2J89OketQuxScSlglwiuIswttgGb2oQsRwLdCD+VIEHQnWiED4K6zBfBa+FAOve8d09g6j6UuRAs8APhuIOhKfCYCoBlnXzRP63FR7TEOaMbAezDnBIBaIosBAngUusdgBQY05+Bw36ffq/CnIuiuEC0apWg4ABde44DLf2SFR4ytQADKUC1A7e/wx31UeALTmPK5VN5qFuowXsAiEIyFBwyxQMYRALoCAWwEGAPa03O2SALIs5ACURAszDSlalYiALpFBmBX5gTGWteU7MWdr/DNGMhKCq0oyVTXBwVAxsxAmlW6co3C+6JY1TxH5kIKwuNBXcpLZi2dIwDUKMrvPaZliS6IUYU7y4VaVakXeFrb1yygeV6fy4pCz/2z1gG9ObJGVGJHwByAW2Jtz9VcZpELZUBq8VEjXfqz/1s80jEHQAZmCS19dvZo7Yn/+fEfwN8eXx7A0iDm8C5BjT5y/0UBLGGuOyeOLvhvCdgPA/AJsibUEeMNN6/xfgVwrDwTAYzkmAXABc+E9l7OAUMez4o53WFpD8gBZZZpAshMqUyU+R7D/la3hVp6qAVYPvO5rHUSWQN23rRApHFtPnHr9ybC877WfoDdCAejVoksMRoOQG/yJpRvB7UdssZgJVajmQV0Q78t5GAia7g7hQCAMeJoI07ht0V4ap7WWbInfgXwUohA2KE7CO80MymAKHDVb1Xzrxh3E44YNunaScgAaE/oVyGC2GJoK6ornVuKKm/kQpp1nCGFp4ZVeG8xZgBcIS8BCI0LtYIruupC3kVjn0aF57Zwi6EVottB7wtFc7IzF7kSreAL5DgGnrunvrQXI/+nz2r3mf97K6TVG82sQBAkBrRaIEqp1TQaaUv3tEcM2ve+aK297n1PTwzMSG6BZhC78J0wUoGYz9WtXPiwEYtxbEXvB3ZCTKe+JgDuQia8g2BTlde1Nc7umm7mo62kr+6e4XyB1BU6WwvOk59H8pbGXzMp8frSd2RuCa+rDnZtEsS1l3zqr35d/Td7SxkJXwORValRTaRzxEwaLzuixpNnnEz4CERU6Wal9dl99D1xaz/AoUy0xsnaIXMBKBAFk9Hkc4OQUeVbicg6Ps+cvo6XBBEY+DH6VqLKLAGi5/783KaUCxLV+6N7Fn2t4qPyrdCiLlpjhAK2vhn6lABLvtBqjUt9wfXlxm/KDCtMj03mWAAAAABJRU5ErkJggg=="/>
    <image id="2d" width="48" height="52" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAA0CAYAAADMk7uRAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAEkklEQVRoge1ay3LbMAxcp3bzcnvqz+UL+3O5tY3t2I57CDdergBISjLT8Uw5g6EsiyQWDxKABFx4W7x34MPp8d1js/Zz8eM0d8wkJhJmPx0AgAGAMVAlE8b4wvrqemo7BdfRvRRIuGjBuBKC62yNaHFn+CSE4DoEMVg0YF7pqvjt80WAXLoRvRT/DUAsg0V0cWXyqqBIM1lzCb8kpP+9jX04PS4URLeQSF8lTPpipPci7VQAnPmj9E4KaKCJSAPOPJlcJqSAFIjOF9m5Mn8IiHwc29hOEzo5gIH0lXkyugLw1fqVAXGT8qY2TgkfAOyFnu33Hr02Oi24BtxBKd0VgGujr9JnIDhnJXkyvWvEOYDEkaVPTcg1QKnfALi1niBWGJqTamGM+Y3MsQjGqPbezHKKDyxxlvYtgDsA962/MxDqExkAmgOZ3zZS5v3ZI3rr6DVg9s+eGqCtE8A9gHUjAiGISAsKwO2ekn9CL/nIuY9tztFzINqBqIGbxvAawLdG6wbMtaBmRPuNpH/dxizkmUP7n+QCSU0ocmL6gAK4b8x/b71qgQ6dAXDpr0SyCi4TRre7KYAohJgK4h5nLXBr1TNBbZoAto1JMk+pq0/4zubCHmyjzny0ExGEOvS6XRMApaoaUADPOPvLS7tHjegcszQADLUwBQSB0IwyAJTyHmcTO+FsTrodZwfjqA8o81VIQSYJhoBucLZdXZwaOMh/aL/1QIxO9jJQzEwoA6LB3Ao9EPYVADJFh3WmXfJVWJICUMZ57SG1AllKr3FTBEC3yiwgrCQ/AJIByIAoiAyQMqMAXBORpCczPhWAA4kmnkJznw93nI8AGAP0WQBmNz8cLq79B/Cv28UDmOvEWb2moo+M+xQAY8xkdR22xchzUSErWnc2gGgyLzhl9Rw/8DQWiuo+Xv/pqg8VkAzAWB1H0709+iiTDGcAtIyi6aKCc804XyWAqvRX1XI0RGb+mgHYoU8Znw3MmGmlACo7V+lx0R1esyeV/AF1PnCQcVsD41rRYlbYKhPyLMrrOFvEOe2UlJKp41OjjYEhkMycysKWS96LUGScqd9Ve46ZlQNg87l2jfnfAP60a2qFIMZ8ogOQ2b5LbYM+adG0UMuMEQCaIoWxacw7iB36umjq0JUPZNL3ChptmmkhkxuNMr0uFJnRrwaC5kTHTkvsEQAgNh/aPbMnzawoSa+PRgAioWzQa8K1QBDhwbYEXsvUrbyYmQ/rOOqUR7mv9aCpxd29jKdpqkNHzjz5HIg04DUelaAXdmn7DkDn1SocS+tb9Nur+sCoE3MRj130bQmfoenorqPmVQGITMnPFj8X3JHfQHRpXDMjjWO8qLWy65X87wl6BSA6Y/x090Ot00L1joyLvST3OCnDh6yCFuW4WRSrsVAWG+VOHCzC5i/WdCusXrVWCXoWjntkmtp++poVCF+1qllFdaG51YUs0o3Cdb33NrYEEICIwIyVRTIQUWjsGokoZL5aaOx7Cb9XzlU0D86igC00HWcsbMFnNnN/Zy0KjyPtAKg/uZkstZkfOI058Wh7z8dPF9n+Akw5M9cvVTL/AAAAAElFTkSuQmCC"/>
    <image id="2e" width="52" height="48" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAAwCAYAAABe6Vn9AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAEqUlEQVRogd2a3VLjMAyFT0qh/C1XvBxPyMtxudAW0nYv8GmOFclWYHd2Bs9o8m/7i2RbUgL8sDIsufnp9LLo/r9VnofHU/bebgcdiN7xd4vtfHXcgws7Y0CG5DbTRqtDp+Q2BJt1pAESCcx+rw2vI9phu2/lfL8HtQ464UGsgq0HGMF4QB7AMdhWUE+nl8FCVQ2KdiyIyoVzboWctrIgh7JP0eOZxhTK05CFIcC67FPWmMNFmuoB2c5bGWSrYLNyBnLGDmHY+TWAS7OlEExNMQOkmlGAEcBHkRHTSzrIs4Psz4EExJoaAS4BXAHYlC2PLZRqqgekJqYg70a0vuZYikxOYdYCsgFwXYTHERTrimDU1AhDgH2RHWqNe+NtELiuhi5Qa+YGwG3ZUiyUN0lYGKAeNwqzK7KVeuw4O5ZrqqmpsTJ+KBwzBLkuELcA7ozcYtIWoXQ8tTSk2qGZEeQNwKsjO3xq7r08o7MfnofH01c0dAfgF4D7IoTiuOJE0gLSscNxsy8wfDGD3KMTxEfrhbWmbR1Dl6XTBLoH8FDA7sr5a0yznzU7D8iOnR0+XxqfP2E+tqwFzIqnIUiHaH5XmMxPtfSASUs3mGZD1ZA3hjxz25ZnCUOQPWLtq8xmObvSe1A6MaimCKQNR2bhAe1Qa8ZqTde9pvZ7JqdAOpaoKU4W95hmvCVAHBM6Zgi4kfq0zqZHEpmcB8UJwgMjHE1zCRAXTh7vUS/e6nJ5MFX9GW/bQlnPgbKRfZpGC+ggnaSZ7aVugnhLQRiHRSbXg7L+nQXMaEg9ilHqinxE6yemx5CCWCjrgVvPW497QDzv1WE9eDsJhH5iy+QUJhMnRTFS5Pqcks96bYelBxTBWclcz9aVrcMtq/4t3ZJOMSXq+XZdWQ1FCYue/Ou6FgNFWRjrynsC9NchK/Za1P5ioAyIjftHTDMUkFuHxiJah02Q2KwP0IDygDIg7MiHEcJwnekBqXPK8MBCehmfEKqlIW1cQTQu0ZD5Qu4fE0Dq+uxFCMd2ohSWC2WB9IaWVjTmp2cAuSfjKaiGGKky/FYw1pmCUqDI1Gw2hiCMLglzwDx8QACkmR6+IIbdb6Vu1ZiaoQflAtkG7VvUN6lhAmHekQ/wbOqK4fcrgN8CRm2p+SnUrEQm540b1Yx2+lCuaQieySl4ITi1RCjVFKHClLAHBMw1pKa2xeR4ApNmliRJ7MxpkyRvqLW0RZ3lsWZXFU9D3szGN6hjQ+1f46BeGssbozaNRfOLzC5cYM8NltxcKzmiYTejVM3JeWFy1UYAZLVE06Z2KJwB3UkiSgV7Da0whcm8R7VmTe07qWA7k+qWIHZdqkp2DOm1I2oT0YlgyScVbzZV70OT9TznwYTrEMxN6mDqubFAaOIv+vLQ0lALSsVziapJwf3g9Tw8nuQbkQKNpmH1BqIPXi0YDyjyF72PX19aWFmO5rw25n3kysC0oDwwL8QIve1Zw8F3Vi9R0gJZAuRBachwdM6dn29+NA6gIjh7rVlno9jB7XkArlfgfdYPG1/440WzrmTxZi0PFsCCHy9sSfwak6onWWwnZ53+8q8xXvkfPy8t+XHpR5Y/ZaguuvoNjWEAAAAASUVORK5CYII="/>
    <image id="2f" width="52" height="48" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAAwCAYAAABe6Vn9AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAEqElEQVRogd2ay3LbMAxFIT/qxE26ys/lC/Nz2bV1/IisLsprXV0BJNRkughnMPRDgngEkAQgmX2x1i05+Hl4XXT8Z7WX7mnIHtscoAPR+v7RpoOffG/BhYMRkC7ZZ/VHgxqSfQjmXpBguI/E5HPrGt5AvIFHcjvOg5oNQmBYVkHvAYb6HSgP4hr0MziFmlwwgFmJrJ3fGK4G4oGpXIv0wecq1Ma5iMKsqd+UHp8VMLJUBIMeA8XAezN7L31fdPc2BVM9UyBnEcBgMXjItgj/5kGxrgjEs8p7kYv0nehwFwW1kOdqDPHNkQyU1xgGdx8AFzM7F1mXXm+ClXOH5+G1g9tFLsfzBUA7M7srsqOeLcZQ0FWDgZsxzNnMTmZ2JH16DgQ3LpxD3vzZ2F9L3JnZfZF96QG1s9FSGSupdRjmWAQ3qLO5a+o8mgBg/kB4zsASgPhuZg+l3xPYzkb3w13NAME6bJk3MzuY2W8z+1X6Q5G3Anu2ca7d4F66p6FmIV4QYCGGeiSw+3LMls5rAfHcYTfDjenkOMyt6g2rLdvqcrDWvsA8mtmPAuVZKQvE1jnY6Lb6v87TFBAOiBYFdr1Hkn2BZStFexLPB7gNXG1brjvYOK9ONl8kvAhltspFUQIv2zynGApWAtDG8kCXMljcCMAAYmdT6zDUrLVcji3lQQHswUa3w8Ait2AgzAu42UCAvC3oXhdGJJHL6Txi18MGy/sS4DCPMkB90XW20WVgGejJwEz0exZiOLWWBwYBIAaRAbrYaJm+wOhGnbJMDUjjMAXS+G4rkrUQz4N30uXFiOkcLLKQdyLnQRyBaxTOkXgNCG7m6dC0JJ2e1FyOYTJ5UitHUqAhea537bC1gCK4mgtE/y/Rl9Uxa6v2Ic2WLjEl9HxYV9ZCtaJFq6DxWbpSsC0grbREYbwnZu2NtSUK0gSLgDIgvQjiMrhxZh/COapLiyIKl07BcbBe3APhdBnhy7qcd10AhGgatQMPsGaxJhBftFbA4Lz/ZKNlEHRmgXA+BDoBGJWw3KZASu/B8AA4IeNBZmM5jraRjR4JTK3mWWoCx0DqnzUYDABhTkeD42jbKkCcPiAfQrrtgcH9qitfNIc0RdZqzIFgrBx7so8leEeb1hFgsZNN3Q+WSi0K3iKgd5HTbLOxJsApOIcv3g3DTVDLHwrQT4Fi9wtLwh4QX5Tdja2DAWNQKD1p0TEKJBmI5xFbCZaC+8H1eC6lXE4txCsacnoMEP/DBZE+aIpcA/IKJVzGgpXU7XhvmrTbxUptrlUxvRfRQqOX87eA+MZxofGN4PBdV7+btaJSsLfCIatE49+RYWKByGaW0UrKloIL4vMMwlOcWeW4TKQbIldrPqtYD92wRGajDYF4L9LasQfkZZmZzFKvA70aVnEfwrgPvF66p4GeEUVA7O/6wItT5RoM62sFvhrX4b/FGyuaPimDwpWNc0v3nGyG6UXzHlgrpZi02YUrD421UKK/qb6MhfizB6apw1WOrz80DqAiOP09C6JNg0wvAvC+5x7roy188aKqK9m8PCfql714wS3xakxKT7LpIGeD/udXY6L2v19gWvLi0pdsfwDrTzKXc+jmowAAAABJRU5ErkJggg=="/>
    <image id="2g" width="76" height="56" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEwAAAA4CAYAAABXJB78AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAGn0lEQVR4nO2c21LjSBBE0zYwHhhmX/bn+ML9OV6XGTCL5wGllU5ltSSDL0RsRXRIsmypdZRVXX2BBQ6wh+3jwj5ajGx9Px23bFsc63YbzuOfxd/+2w/ZnEo7KIXi++kzv98hwBxQOvbPPxXapEoHUA5jiX1QfpygHQpMy1uxTfA+BdxopQVWAkA4Xha2z2O9zqT7YwhL4Wj5z44dIICPQ7uqThSqqgCtuuL7DjEpDsjgPCZVkFheZZ/ngH1wH7b4hk1VwFA1KytXXVnJVov+vnLRylxZDollY8cKT1X3IZWVChPjQ/LBFcy1bK/lWIsqz6EhbIFaXQSgkDYAXqRsunts7Bq8/vZh+7g4FNoAmKnL3Y4QrgHcyPabHSu8ltKAoWsmWAqMyiKoZym/u62rltd8s+PZtnfhEODV/RQUIa1ty0JoqjKNa61YVgFTV1RYvwH8ksJjQqQK1UUPds3kkim4ExaBrAF8t7KWQqhJZZXCKlUkddH9COeb3Gtp10jphl5/llUxTKFRJVTVdwC3XbmTrYKjym7QBtZqKStgqq5fAJ7sPgv7nacZy+46OCSW7YCNuCNdkcq6A/DDikKjEt0tk0vS5gKjutbdfRSW52baWu41AFMgqbnCUsBXd1zjXVE/ANwD+NkVQrtFrzIN/p6XTUktHBhbRwWm6lrK9z030zRjKd+ZrbJWDGMqkYDd4R3UX9iHRpW5wsYC/lRgrjDeY2nf9bSDOZoq7SCVJYW5S2rryPhFl7xHD+0e+8CosKkpRWXeSjLoV8ry/EyBEdoS0lrOUdlYK+nAGPTvunIv5Sd6lySwsdg1BxgV9ophkFdlpfzM0wsG/9kt5hUQx7c8YVVgDPzaUtId79C3ktrMt3IvhGN/CI9jvK7D0txMy3N37hq9yhby+8k2xSWTyqi0VBjw2ToqMGAfzhyFEYymJ8AwtikwTWYJ7Qq9e+/ysoft46REVoGltz4GbW0l5V9V33GOKTRVlsYtz/yf0L9EBcZ4tkIf/CerbBk+S+Nd2o/0znYq3vn2/mQaGkolfcf7s/riCOhWiifTnubsXmYITQNr5WGpi6TDNz4qkTraKaP3e7VM377ur9C7qCbVz6i7bApMYxmD/ySlJYVpZVvgWspJY1+toN8yd2etCxukqlFyaBouYsgYU1nLJb2CDi1l7mMjqx+xKV235J4JWiuhbtqYwvx4rACfC6mql6usFdNSHKsapVGVtYBp5Vpx6BhqatVH7+sNkrvlVJWt7NqljQFLFT4VnCn1GFOZw9JeiELT8AKgVtlcYJdgVQMwBiy1mD4aPCqGrwhMjQ9XJdeem6UWM+VlALLKviqwlO60eiNJaaqyyS3mVwWmlhoATWbHgLW6cQP76sAODf4p+48qc7f86sDUpuZlSWUpxfg0l0yrY85R1LTldGg+slL1L8s4piqbslQgVXTsYXTM/BT5mgKs4lk18awd8pfudzrAuNcpbwHzN+mTotUqGr0ZcDxg1Qy5jm5U4HTrs/Qb+e0bzCpgaXjYZ2/SCppX9G+E4+anUpgOKOrypgpcGsOr5h+aCqvcLkHSaSzKWYeSTwHM66v1TODSgKivbxukF5xZcmB+c1eUT2FxRobZMrrvpbH8Y1uaXdKZIp73vM231UjMFpgWw1rLjDh+zhu9dee9f3Zsq1TGenIsfzD5gZmDnJVLJlgbDCcZqCxW8kU+a+YzR7KkMs6ScyLEZ8G9cVsU+wD2gSV3rFTFNQ3qhi/o5yMndTOOZD6HyRfNl8xpN50NT8uhorViWLWe4Ql9oFRl6XzkuYHpC2cco2f8i/25ypbiBvAql1RY+pZ80RorpAtD0mz3KSylQmnFD5X21B3rXKUuiYpKuwLely526X+KXwqMyoFU5hm9i5ZjSye2VlhRaFzaOdk9W4kr3Y2BU4dwWRG6Ykr+zjmMnV68p0O6lKByTcCgtVpJfTv68FqBm+6GVaYMnAcaH9LX9qvSfIXPC4ZryAbQdsA6t9QbsgP9ahXRuDBnSeYprZWAew9F15Gl4D+qMN5o0PHEEJguHUiB/pwzS1N6Lakkhe1W9rT6ktz3v9nhzVLf69yu6OZpUjWAUC0ebivMWktguBaUAKulApeiLprHoGp4qvoruIHFh5r4J39V38uvec6g758lcNvieHcdXWhXPkz4izaHkiBdgqoq81CThrH83GBVYvMBiz9Z1v1LUNMcc2i+vwcnLeGc9ICN1SyXDmjMBkDG1rke/MBTljdeun32fxz434L9AZ7ptX/DaxeNAAAAAElFTkSuQmCC"/>
    <image id="2h" width="86" height="41" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFYAAAApCAYAAACvIt7jAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAEmklEQVRoge2bzVLbQBCEW8YGgiG58HI8IS/HMeBfrBy0Y/W2ZlaKqyivEqZqSrKx1t6Pdmt2JAPf8SXRXHLQS/t20XFzjNfmub3kuMmAHJhjj+caCjJ7PBX0KAwB2jhb7++Tx79yRBDHtqOAw4k7QBliE6SOOSewLXKAUWbHRYDdiRNU3i7QA1wEW++4mqME8hRsFbILd6lPCFTORcob2rfHCnfMIq4dnlIV4mfanuSx/V3HySKbcACVAXIuaZ+Bl6yhplC1KsBj2rc8Ygj8rFxV7UCxKRgqw1ylY2xr+/waDy6Pe83wTlYK1SAeARxou0j7HGflvrRvDcM9g3XUyko1gCsAt04aZA8uR01g1QIM6oFyn/Imbb3P79qCKlY9kqHeArgDcJ/yjvIWvYrHVFtLqFpZpTvKLfrzSCPHtum58ZMXhjawRAfOgD4A+EFpkFm5pvbawbIFGNQ9OqCblCaWRo4bwGU7iBTL3mpg79BBXVM+pDTlqmoXzvjXDLUCBstQt+jnY1C9E5xlA1HuEjj7q+exbAP36BS6BvAE4DHlOj3PluCBvTZUC64G2AbMArbolOpB5ZOb7S8wwQo8xTJYU+wTgJ/oAT+gtwS1Ax67hlCwbANmAe/o5wDndau0b3YHeIqV4IogUuwjOqi/0naNHizbQa21LPsjn7TYAkyJahO36CuFwYrzpX3Da/PcMlhvpcUe66nWlPuI3g4MLCu2JrCRYvfwobLvWkbVT6jYUg3L5ZZVBKZeO5HNWbF7dJ+7Qe+7O3Tz/IBfUnL1k0Vp5aVLWV4gcD1roLXs8qqCmkIVy35qfmvzUaiuDfDgpTrWg7uUXAVpYGutY1mx9jkNsjcXXVmO9kM8K9B9D3Qpoz5trTF1bl4HDwjmtyz90Qlt9p6C/PzLca8RuqTlDBvbEuH8Io8d+wBWIHOpwsU0e1CtYfOyQt8aLtyEsXkqdB1jEEt6AZcLpXaavak1KTbIyxNeec0BLK+8uKTaIYfNq62sF+uFp1gPKjcobMmnNd8BeSOmdn/VliEvad/RlVgb9JBLcCd1t7x2mgfV4BlUr4atHSyQfxttjh8AfqMHzAo+0DGhDzNYbfx6PcoNelWCXrNF3oCZE1hdfe3RwXxHDneDoXJDS1DFMlzuqO+Q13S8OuGloNZ6tYc3V1atwWXVRmBHr3mVbICLaf7q6OWZ2k9cFp7PavtQFbuH77UA0EaN7ugaEC9PuePD3SBdQ88NLFufNl7sasIWuc9OUqxXah0x7N5wg4IvJmpjAqgbrjdfrs3Nb3eSXn3re+xr89zSVVp7kyYdzHD4K8NrafZVbf7WGgrWvol60uZFg9a0JxnnHJ4V2PYkz9sbHzFsTER9gtpjbEHECuYcrWOzydO1L68xoXfC6O1Gk5oTFUYEVwGfZL94N0xUFVjof8UGv6jjU2noV9nmWWoy8WsGUAEHQHCnoQKMvvZzAqrhea6KynsewASwQHhvLO/r43CsmYWnXg84v8a9jTOEUbg13muGF8eaWWhbMHqueFf3JBjBjzn+FZBjMYA35XcIF8P5X345c+mvZr7ji+IPPk7IumiDX5AAAAAASUVORK5CYII="/>
  </defs>
</svg>
`,GamepadRightSvg=`<svg width="100%" height="100%" viewBox="0 0 123 232" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd">
  <g id="right_side_of_controller">
    <path d="M10.5 140.855c6 29.375 13.537 33.424 35.28 43.583 35.355 16.519 33.138 57.105 56.59 45.51 14.36-7.1 21.13-19.23 21.13-38.4 0-24.92-11.42-65.99-32.4-119.1-10.625-22.2-25.844-16.642-42.794-16.642-7.93 0-15.744-1.225-22.454 2.225-14.564 7.511-21.031 55.022-15.352 82.824Z"/>
    <g id="stick_button_right">
      <g id="stick_bg_right">
        <circle id="shadow12" cx="42.54" cy="176.272" r="26.46" style="fill-opacity:.5"/>
        <circle id="Oval6" cx="41.3" cy="175.022" r="25.21" style="fill:#6180b0;stroke:#000;stroke-width:2.49px"/>
      </g>
      <path d="M41.215 179.291v-8.477h25.442v-7.872l12.11 12.11-12.11 12.11v-7.871H41.215Z" style="fill:#ff00bf" class="direction_highlight" id="r_stick_right_direction_highlight"/>
      <path d="M36.977 175.052h8.477v25.442h7.871l-12.11 12.11-12.11-12.11h7.872v-25.442Z" style="fill:#ff00bf" class="direction_highlight" id="r_stick_down_direction_highlight"/>
      <path d="M41.216 170.814v8.477H15.774v7.871l-12.11-12.11 12.11-12.11v7.872h25.442Z" style="fill:#ff00bf" class="direction_highlight" id="r_stick_left_direction_highlight"/>
      <path d="M45.454 175.052h-8.477V149.61h-7.872l12.11-12.11 12.11 12.11h-7.871v25.442Z" style="fill:#ff00bf" class="direction_highlight" id="r_stick_up_direction_highlight"/>
      <g id="stick_right">
        <circle id="shadow13" cx="43.16" cy="176.892" r="17.12" style="fill-opacity:.5"/>
        <use xlink:href="#4a" x="161" y="142" width="65" height="66" transform="translate(-152)" class="gpad-highlight" id="stick_button_right_highlight"/>
        <g id="Group-61">
          <circle id="Oval-Copy1" cx="41.3" cy="175.022" r="15.88" style="fill:#fff;stroke:#000;stroke-width:2.49px"/>
          <circle id="Oval-Copy-21" cx="41.3" cy="175.022" r="12.14" style="fill:#fff;stroke:#000;stroke-width:1.25px"/>
          <path d="M39.689 175a.318.318 0 0 0 .317-.353l-.282-2.586a.318.318 0 0 0-.317-.284h-2.102a.32.32 0 0 1-.239-.53l3.995-4.543a.317.317 0 0 1 .478 0l3.995 4.543a.32.32 0 0 1-.239.53h-2.102c-.163 0-.3.122-.317.284l-.282 2.586a.318.318 0 0 0 .317.353h3.433a.32.32 0 0 0 .319-.319v-.968a.318.318 0 0 1 .51-.255l3.05 2.287a.32.32 0 0 1 0 .51l-3.05 2.287a.318.318 0 0 1-.51-.255v-.968a.32.32 0 0 0-.319-.319h-3.721a.32.32 0 0 0-.317.284l-.386 3.542a.318.318 0 0 0 .317.353h.029a.318.318 0 0 1 .233.537l-.966 1.034a.318.318 0 0 1-.466 0 972.66 972.66 0 0 1-.966-1.034.318.318 0 0 1 .233-.537h.029a.318.318 0 0 0 .317-.353l-.386-3.542a.32.32 0 0 0-.317-.284h-3.721a.32.32 0 0 0-.319.319v.968a.318.318 0 0 1-.51.255l-3.05-2.287a.32.32 0 0 1 0-.51l3.05-2.287a.318.318 0 0 1 .51.255v.968a.32.32 0 0 0 .319.319h3.433Z"/>
        </g>
      </g>
    </g>
    <g id="start_button">
      <path id="start" d="M30.051 132.744a8.497 8.497 0 0 1 2.825 6.334 8.495 8.495 0 0 1-2.825 6.333H18.67a8.495 8.495 0 0 1-2.825-6.333 8.497 8.497 0 0 1 2.825-6.334h11.381Z" style="fill:#9a9a9a;fill-opacity:.5"/>
      <use xlink:href="#4b" x="152" y="117" width="46" height="41" transform="translate(-152)" class="gpad-highlight" id="start_button_highlight"/>
      <path id="start1" d="M28.85 131.196a8.494 8.494 0 0 1 2.826 6.333 8.496 8.496 0 0 1-2.826 6.333H17.47a8.495 8.495 0 0 1-2.825-6.333 8.493 8.493 0 0 1 2.825-6.333h11.38Z" style="fill:#fff;stroke:#000;stroke-width:1.35px"/>
      <path id="Playstation_Btn_Icon" d="m20.832 134.571 5.982 2.961-5.975 2.955v-5.916h-.007Z" style="stroke:#000;stroke-width:1.1px;stroke-linejoin:round"/>
    </g>
    <g id="button_1">
      <g id="Group">
        <circle id="shadow" cx="45.85" cy="121.855" r="11.806" style="fill:#00ff04;fill-opacity:.5"/>
        <use xlink:href="#4c" x="171" y="95" width="52" height="52" transform="translate(-152)" class="gpad-highlight" id="button_1_highlight"/>
        <circle id="Oval" cx="44.99" cy="121.007" r="10.945" style="fill:#00ff04;stroke:#000;stroke-width:1.72px"/>
      </g>
      <g id="Playstation_Btn_Icon1">
        <path id="Line" d="m41.345 117.35 7.72 7.731" style="fill:none;stroke:#000;stroke-width:1.72px;stroke-linecap:round;stroke-linejoin:round"/>
        <path id="Line-Copy" d="m41.345 125.081 7.72-7.731" style="fill:none;stroke:#000;stroke-width:1.72px;stroke-linecap:round;stroke-linejoin:round"/>
      </g>
    </g>
    <g id="button_2">
      <g id="Group1">
        <circle id="shadow1" cx="66.7" cy="101.005" r="11.806" style="fill:#ff0009;fill-opacity:.5"/>
        <use xlink:href="#4d" x="192" y="74" width="52" height="52" transform="translate(-152)" class="gpad-highlight" id="button_2_highlight"/>
        <circle id="Oval1" cx="65.851" cy="100.145" r="10.945" style="fill:#ff0009;stroke:#000;stroke-width:1.72px"/>
      </g>
      <path d="M60.941 95.78c-.898 0-1.637.739-1.637 1.637v5.456c0 .898.739 1.637 1.637 1.637h5.456c.898 0 1.637-.739 1.637-1.637v-5.456c0-.898-.739-1.637-1.637-1.637h-5.456Zm11.457.546a.548.548 0 0 0-.931-.386l-2.182 2.183a.542.542 0 0 0-.16.385v3.274c0 .145.057.284.16.386l2.182 2.182c.103.102.241.16.386.16a.548.548 0 0 0 .545-.546v-7.638Zm-8.746.911a2.905 2.905 0 0 1 2.898 2.908 2.906 2.906 0 0 1-2.898 2.909 2.905 2.905 0 0 1-2.897-2.909 2.904 2.904 0 0 1 2.897-2.908Zm0 1.212c.933 0 1.69.76 1.69 1.696 0 .936-.757 1.696-1.69 1.696-.932 0-1.689-.76-1.689-1.696 0-.936.757-1.696 1.689-1.696Z"/>
    </g>
    <g id="button_3">
      <g id="Group2">
        <circle id="shadow2" cx="25" cy="101.005" r="11.806" style="fill:#48c0fb;fill-opacity:.5"/>
        <use xlink:href="#4e" x="151" y="74" width="51" height="52" transform="translate(-152)" class="gpad-highlight" id="button_3_highlight"/>
        <circle id="Oval3" cx="24.14" cy="100.145" r="10.945" style="fill:#48c0fb;stroke:#000;stroke-width:1.72px"/>
      </g>
      <path d="M17.592 98.69c0-.798.657-1.455 1.455-1.455h.677c.486 0 .941-.243 1.21-.647l.591-.888c.27-.404.725-.647 1.211-.647h2.808c.486 0 .941.243 1.21.647l.591.888c.27.404.725.647 1.211.647h.676c.798 0 1.455.657 1.455 1.455v5.093c0 .798-.657 1.455-1.455 1.455H19.047a1.462 1.462 0 0 1-1.455-1.455V98.69Zm9.821 2.183a3.288 3.288 0 0 1-3.273 3.273 3.289 3.289 0 0 1-3.274-3.273 3.29 3.29 0 0 1 3.274-3.274 3.289 3.289 0 0 1 3.273 3.274Zm-3.273 2.182a2.192 2.192 0 0 0 2.182-2.182 2.193 2.193 0 0 0-2.182-2.183 2.193 2.193 0 0 0-2.183 2.183c0 1.197.985 2.182 2.183 2.182Z"/>
    </g>
    <g id="button_4">
      <g id="Group3">
        <circle id="shadow3" cx="45.85" cy="80.155" r="11.806" style="fill:#fff000;fill-opacity:.5"/>
        <use xlink:href="#4f" x="173" y="56" width="48" height="47" transform="translate(-152)" class="gpad-highlight" id="button_4_highlight"/>
        <circle id="Oval4" cx="44.99" cy="79.295" r="10.945" style="fill:#fff000;stroke:#000;stroke-width:1.72px"/>
      </g>
      <path id="Light_Icon" d="M44.99 72.753c.336 0 .613.277.613.613v1.227a.616.616 0 0 1-.613.613.616.616 0 0 1-.614-.613v-1.227c0-.336.277-.613.614-.613Zm0 10.631c.336 0 .613.277.613.613v1.227a.616.616 0 0 1-.613.613.617.617 0 0 1-.614-.613v-1.227c0-.336.277-.613.614-.613Zm0-6.542a2.465 2.465 0 0 0-2.454 2.453 2.465 2.465 0 0 0 2.454 2.453 2.464 2.464 0 0 0 2.453-2.453 2.464 2.464 0 0 0-2.453-2.453Zm4.626-1.305a.616.616 0 0 0 .195-.449.616.616 0 0 0-.613-.613.616.616 0 0 0-.449.195l-.868.867a.615.615 0 0 0-.164.418c0 .336.277.613.613.613a.615.615 0 0 0 .418-.164l.867-.867h.001Zm-7.518 7.517a.612.612 0 0 0-.418-1.062c-.17 0-.333.07-.449.195l-.866.867a.612.612 0 0 0 .866.866l.867-.866Zm9.434-3.759a.617.617 0 0 1-.614.614h-1.226a.616.616 0 0 1-.613-.614c0-.336.276-.613.613-.613h1.226c.337 0 .614.277.614.613Zm-10.631 0a.617.617 0 0 1-.613.614h-1.227a.617.617 0 0 1-.613-.614c0-.336.277-.613.613-.613h1.227c.336 0 .613.277.613.613Zm7.847 4.626a.614.614 0 0 0 .867-.867l-.867-.867a.616.616 0 1 0-.867.867l.867.866v.001Zm-7.517-7.517a.617.617 0 0 0 1.032-.449.612.612 0 0 0-.165-.418l-.867-.867a.611.611 0 0 0-.441-.187.613.613 0 0 0-.426 1.054l.867.867Z" style="fill-rule:nonzero"/>
    </g>
    <g id="shoulder_trigger_back_right">
      <g class="direction_highlight" id="shoulder_trigger_back_right_direction_highlight">
        <path d="m12.269 51.254 12.27-16.491H0l12.269 16.491Z" style="fill:#ff00bf"/>
        <path d="M25.523 17.167c-2.534 0-13.254.512-13.218 21" style="fill:none;stroke:#ff00bf;stroke-width:8.5px;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5"/>
      </g>
      <path id="shadow6" d="M70.5 39.658H32.67c-1.52 0-2.78-.6-2.78-1.32 0-.1.03-.2.07-.3l10.9-22.92c.71-1.5 3.53-2.57 6.76-2.57h11.8c7.65 0 13.86 2.96 13.86 6.61v19.18c0 .72-1.25 1.32-2.78 1.32Z" style="fill-opacity:.5"/>
      <use xlink:href="#4g" x="165" y="3" width="76" height="55" transform="translate(-152 -4.306)" class="gpad-highlight" id="shoulder_trigger_back_right_highlight"/>
      <path id="bg" d="M31.21 37.298c-.37 0-.72-.06-.98-.19-.25-.12-.4-.28-.4-.47l10.92-23.07c.28-.58.97-1.1 1.95-1.48.99-.37 2.2-.58 3.46-.58h11.8c3.44 0 6.56.67 8.82 1.75 2.34 1.11 3.66 2.63 3.65 4.2v19.18c0 .19-.15.35-.4.47-.26.13-.62.2-.98.2H31.2l.01-.01Z" style="fill:#fff;stroke:#000;stroke-width:2.17px"/>
      <path d="M60.102 31.312a10.054 10.054 0 0 1-1.374 2.86.681.681 0 0 0 1.122.769c.892-1.302 1.505-2.722 1.785-4.195l1.075 1.05a.68.68 0 1 0 .95-.974l-2.551-2.49-2.489 2.551a.68.68 0 1 0 .973.95l.509-.521Zm-8.281-11.708a1.932 1.932 0 1 1 3.698-.289.862.862 0 0 1 .17.104l2.302 1.795a.876.876 0 0 1-1.077 1.38l-2.301-1.796a.82.82 0 0 1-.143-.139 1.924 1.924 0 0 1-1.489.082l-2.921 2.983a1.183 1.183 0 0 1 .043.125c.011.038.022.076.031.115l.01.043c.019.09.031.183.037.277l.002.022.001.037a.508.508 0 0 1 .001.039v.026l-.001.071v.006l-.002.038a1.91 1.91 0 0 1-.034.263l-.014.066-.025.096-.004.012a1.515 1.515 0 0 1-.045.132l2.921 2.983a1.939 1.939 0 0 1 1.489.082.898.898 0 0 1 .143-.139l2.301-1.796a.875.875 0 0 1 1.077 1.38l-2.302 1.795a.862.862 0 0 1-.17.104 1.933 1.933 0 0 1-1.828 2.326 1.932 1.932 0 0 1-1.87-2.615L48.9 26.229l-.005.002a1.954 1.954 0 0 1-.339.085c-.026.005-.053.008-.079.011l-.014.002c-.035.004-.07.006-.105.008l-.018.001-.012.001-.048.001h-.027l-.074-.001-.013-.001-.015-.001a13.143 13.143 0 0 1-.119-.01l-.013-.001-.063-.009-.021-.003a1.881 1.881 0 0 1-.54-.175l-.011-.005-.02-.011-.011-.005-.01-.006-.01-.005-.046-.026-.018-.01-.007-.005c-.03-.018-.06-.036-.089-.056l-.009-.007a1.622 1.622 0 0 1-.141-.106l-.013-.01-.027-.024a1.461 1.461 0 0 1-.128-.122l-.008-.009-.039-.042-.005-.006-.028-.033-.027-.032-.007-.009-.012-.015-.012-.016-.029-.038-.005-.008-.032-.045-.006-.01a1.934 1.934 0 0 1-.076-.123l-.024-.044a.773.773 0 0 1-.015-.029l-.038-.079-.005-.011-.004-.011-.004-.008-.015-.035-.004-.011-.004-.009c-.011-.028-.022-.056-.031-.085h-1.87v1.434a.625.625 0 0 1-1.25 0v-4.118a.625.625 0 0 1 1.25 0v1.434h1.87a1.351 1.351 0 0 1 .05-.132l.005-.011.019-.043.034-.069.005-.01.006-.01.003-.007.023-.041a1.82 1.82 0 0 1 .095-.151l.006-.01.009-.012.023-.032.009-.012.007-.009a.106.106 0 0 0 .009-.011l.006-.008.009-.012.028-.034.036-.042.001-.001.063-.067.008-.009.008-.008.076-.072.026-.023.009-.007c.041-.035.083-.068.126-.099l.002-.002.047-.033.01-.006a2.03 2.03 0 0 1 .201-.118l.011-.005.021-.01.011-.005a1.924 1.924 0 0 1 .654-.178l.012-.001.058-.004.015-.001.015-.001h.022l.038-.001h.05l.012.001h.025l.012.001.018.001.032.002.012.001.024.002c.045.004.09.009.133.016l.012.002c.113.019.223.048.329.085l2.921-2.983Zm1.089 9.594.036-.034a1.002 1.002 0 1 1-.036.034Zm-4.373-5.75a1.002 1.002 0 0 0-1.269.783l-.003.016c-.006.04-.01.081-.012.122v.013l-.001.026c0 .054.005.107.013.158l.001.007.001.008c.007.037.015.073.026.109l.001.004a1.002 1.002 0 0 0 1.238.675l.007-.001.012-.004.011-.004a.142.142 0 0 0 .022-.007l.013-.005.009-.003a1.001 1.001 0 0 0 .648-.937l-.002-.064a1.002 1.002 0 0 0-.619-.862l-.027-.011-.009-.003-.013-.005-.01-.003-.012-.004-.009-.003-.016-.005Zm11.565-5.943-.509-.522a.681.681 0 0 0-.962-.012.681.681 0 0 0-.011.962l2.489 2.551 2.551-2.49a.68.68 0 0 0-.95-.974l-1.075 1.05c-.28-1.472-.893-2.893-1.785-4.195a.68.68 0 0 0-1.122.769 10.047 10.047 0 0 1 1.374 2.861Zm-7.156 2.147a1.002 1.002 0 1 0-.036-.034l.036.034Z"/>
    </g>
    <g id="shoulder_button_front_right">
      <path id="shadow7" d="M32.192 43.878h39.986c2.643 0 4.817 2.645 4.817 5.859v7.033c0 1.288-.871 2.347-1.93 2.347h-45.76c-1.059 0-1.93-1.059-1.93-2.347v-7.033c0-3.214 2.175-5.859 4.817-5.859Z" style="fill-opacity:.5"/>
      <use xlink:href="#4h" x="159" y="30" width="87" height="41" transform="translate(-152)" class="gpad-highlight" id="shoulder_button_front_right_highlight"/>
      <path id="bg1" d="M30.673 44.236h40.011c2.109 0 3.844 2.109 3.844 4.674v7.053c0 .638-.432 1.164-.957 1.164H27.795c-.53 0-.965-.53-.965-1.174V48.91c0-2.565 1.735-4.674 3.843-4.674Z" style="fill:#fff;stroke:#000;stroke-width:2.15px"/>
      <text x="48.396" y="55.277" style="font-family:'ArialRoundedMTBold','Arial Rounded MT Bold',sans-serif;font-size:13px">+</text>
    </g>
    <g id="r_touch_targets" opacity="0">
      <path id="stick_button_right_touch_target" d="M34.841 141.791a34.686 34.686 0 0 1 6.374-.588c19.07 0 34.552 15.482 34.552 34.552s-15.482 34.552-34.552 34.552c-19.069 0-34.551-15.482-34.551-34.552 0-10.648 4.827-20.178 12.411-26.518 1.298.465 2.697.718 4.155.718 5.345 0 9.9-3.406 11.611-8.164Z" style="fill:#419bf3"/>
      <path id="start_button_touch_target" d="M35.167 134.497c.26.997.399 2.043.399 3.122 0 6.809-5.528 12.336-12.336 12.336-6.808 0-12.336-5.527-12.336-12.336s5.528-12.337 12.336-12.337c2.48 0 4.789.734 6.723 1.995a16.16 16.16 0 0 0 5.214 7.22Z" style="fill:#419bf3"/>
      <path id="button_1_touch_target" d="M39.627 106.677a16.066 16.066 0 0 1 5.496-.963c1.93 0 3.781.34 5.496.963l9.655 9.656c.623 1.715.963 3.566.963 5.496 0 8.894-7.22 16.114-16.114 16.114-8.894 0-16.115-7.22-16.115-16.114 0-1.93.34-3.781.963-5.496l9.656-9.656Z" style="fill:#419bf3"/>
      <path id="button_2_touch_target" d="M60.481 85.823a16.066 16.066 0 0 1 5.496-.963c8.894 0 16.114 7.221 16.114 16.115 0 8.894-7.22 16.114-16.114 16.114-2.186 0-4.271-.436-6.173-1.226l-8.715-8.715a16.056 16.056 0 0 1-1.227-6.173c0-1.93.34-3.781.963-5.496l9.656-9.656Z" style="fill:#419bf3"/>
      <path id="button_3_touch_target" d="M30.442 115.863a16.056 16.056 0 0 1-6.173 1.226c-8.894 0-16.115-7.22-16.115-16.114 0-8.894 7.221-16.115 16.115-16.115 1.93 0 3.781.34 5.495.963l9.656 9.656c.623 1.715.963 3.566.963 5.496 0 2.186-.436 4.271-1.226 6.173l-8.715 8.715Z" style="fill:#419bf3"/>
      <path id="button_4_touch_target" d="M30.235 86.294a16.056 16.056 0 0 1-1.227-6.173c0-8.894 7.221-16.115 16.115-16.115 8.894 0 16.114 7.221 16.114 16.115 0 2.186-.436 4.271-1.226 6.173l-8.715 8.715a16.056 16.056 0 0 1-6.173 1.226c-2.186 0-4.271-.436-6.173-1.226l-8.715-8.715Z" style="fill:#419bf3"/>
      <path id="shoulder_trigger_back_right_touch_target" d="M76.155 41.187H23.519c-1.52 0-2.586-2.458-1.769-4.167.046-.096 14.212-28.399 14.212-28.399.743-1.517 3.546-2.595 6.744-2.595h22.358c7.656 0 13.863 3.027 13.863 6.762v27.046c0 .742-1.252 1.353-2.772 1.353Z" style="fill:#419bf3"/>
      <path id="shoulder_button_front_right_touch_target" d="M25.477 41.187h48.72c2.613 0 4.73 2.007 4.73 4.483v14.346c0 .983-.854 1.793-1.892 1.793H22.639c-1.038 0-1.892-.81-1.892-1.793V45.67c0-2.476 2.117-4.483 4.73-4.483Z" style="fill:#419bf3"/>
    </g>
  </g>
  <defs>
    <image id="4a" width="65" height="66" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEEAAABCCAYAAAAIY7vrAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAHcElEQVR4nO1c23YbNwyEZEduLm7ykJ/LF+bn8lK7kZVa1vahHO3s7IDk6hK3J+U5OEtJ3iUwBEAQ4Dri/xar1xr4y/BtMvbX1efhtXi5KggqaMe4KRDXBOmiIBihVx19bkNH/+KAXAQEEX5lru67rA10zfrHdglAzgKhInwP6fgqcIv4nrPAOAkEIzw+r+nzmq5r+Y7vQYMQhxgFPdBnvc7AOBWIxSAQADrz64RuzHcOCBZ8iIiXGEHgPpPTjsVgLAJBANAZh7A3QrfUx+98X4ggLPRLROzLVckBgmctAqIbBAOACg9hb4neyGcGg0EA8xCchX8u/T31+fdMM7qB6AJBAGD75tmG0KCNXAEIA8Hjs+qz0M8R8ZdcQaolJwHRBCEBgNVdBb8j2tBVgYA2BDENYVh40A8ifMdg7MNrRROIKggNADDzGxL2t4TwO5sHO0g1BQbgR0TsEsLvAEP9RRcQt50AgHT2N0XIu4h4W+gd9UHQDNaGDASYgQLwFBHbGLXqtnzH/uWZREgjzm4QBAC2fwiCmWfh3xdCH78BKAiAZ9VAgOrvivBb8wznYFnwA/pfhm+rTBusORQtUA2AGrPqvyOBPxC9J2qBgJaBAA3YRsT3iPhTCL89FcBgHrp6pGYx0wQTDXLQwyaA2f8QEfeGMhB4haiBAHN4kme0nKsjjkdmLTMHDYZ4CYQWYPZ/NwSNgKawT+hdHQCCA5F9igKQRZNDxD+TrNowASHRAvYF0AKYwH0R+iORgsArBAdNDLRGi/sYV4ddTE1J74+YCp9Fk3YXOgOBhFczUC14G1NN+BgRn8qVzQGziGXUaYGCcCgg3BUQWHi+n4XngCkLoDi0boKgQDhfAAAgsDMHaIFTY14e0RgEAMFLKmuA/r1GmfuYB1DrGE1i4iCPICR7Aw2KEA+oOYDuYzQF1gKdxWwrzRrR2ms4R+oiSWgEm96kqSb0moJbFnl5ZC3g4Eh9gYIA4QbhgUFgJ6oriQut+f6DA2IdvmWaoCAoIVrUuEB3kS7HoFtx3pNgddHYRMfG+M6RTvIYvAhkmuBAACMcITJBeHWENT/gwNckSbaCaEAFcoEZg40o8tgYBN0sZT6BgdCw2M2+A6C1e4XQDMCbmJoBtHKX8OFWFF2WRxAqGaNsv6DEAOjAtbxiCwB8vinfuQnJ+ADPuk+Z8aA+weULNWGyScghvxQA5gNXTeIwP7yN56vzB6k5OsfoNMFljXiwLGu0VHjlA1d1oK1MVpbO4wDt6BwZBBcnuBSaI/b6TvhzgUC/pqGtnGbqj5w54FozjWzJY/U9VxOUL8ePTpJbgpu81MyhNrAjB8AlmptBHq+XtxSMLFhiBmpUVbMrNF1me6jJWwuEX6K1QDipOHrFpsnTi/DmQHAPcnVATWBkDJzbVBDODdR4q/FV3UDxQG4Q3rfzNrWrUHpmY35cMqVWq6zywiAoACy4Cu8If+cGPBWIGk86vuYQdJJS06iZgwNAa4NaBktrgie0TCuVH02kKBiqpcdnI7ukW2lnBln2xtUFwZwGT2i9y6jaf2tCwA/zxxNTTbiuGZFOAFxNEAyoVpziMJ0GMACuROd4USDS8VkTsH11qqcpLNQGOZFRK4+57HILBD6xUivSMh9cqOUibdVBZuaQaQIXRjmRwQlVBWCIMR/Qyi6pxrhSPQu+jWkZjktxrJkMxKxlKXenCaoB25gmMlxNgQUDENneQjUAaXcUYjiNhrokE9cjoQ0100xBaGkCGPke8wSG7ibVrLKUO5tHNjZXp7ko+0h9BoI1oXle4QjC19XnoSQZFAg1B06quNMnTpieVFfLF0HtHws9UJ9BYHNwWjBrNXOATa6JGZfI0KSFizFq6S4ez/kBqDe04MEQl+mz8vxxjGpBlhiKGAsVXCDVBIbu2bOZdGcTHAjZGQVoAUzgISL+KARtYJ/Q7RRnIJBJgDEwBW2oJSxqqpwVZdkc2PzYGaovAAggNgf2B7VAKQeBmjoq1PIcACyEW1K1JKexBMYZzP18UgWrwGNM/QIDAFNwq0JEdJ5UMdoA5laFOXVqzpZ1SatVp/UZz+YZteM6uipokNSMVGsHt9g3RHlohPfoDAKH1xpPuIMaaO6AhsYGrBEcKGmkuOgYX7qhaZTqtT7Jp9j0GJ/WJ3tPr7FP4NBYo8NWhGhXBG6pJkjcEDHOdsTcZ2THbJ5iWhrrPbjFjpH3K3jmjr7v3TWmrbm17TjVqiUxPdp7F9MKkYscNTjTnSsLzH13GKPbDLpBqADhqlPZ4W72BVmAxfsFPt2uh7tZ7fko7ws9oxuAbhAMELpc6vsNXBJzhzSyiDFLn+k5JKf6s5Xgokf9K0DUymKuNFarEDMImkR1L36o8DZ11tMWV42S13+ystiN6bvKleYRXEq/O6t91dd/0JIXwbL6pfZdiUxTagdz1e8Gue/nvQjGrfJWXFaz1N+5KRAt4nt+/iuB2ha+HOr+NmIumBP2osI7Js5uF3hNOGIa3MyEjviXviactRNeGI9IIrz/zAvjS5oD6DX/fcAv3/4G1s+EbdFAgYoAAAAASUVORK5CYII="/>
    <image id="4b" width="46" height="41" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAApCAYAAABKvBuPAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAD00lEQVRYhdWZzXKjQAyEm8R2kv075eX8hHk533Ydm9gJe8g0NI0EYzuXTJVqKBjgk9BImgH4pq255eZtt7vp/pfmubv23otenIDWnMsAJ+drlakCN+BmoV9q3UIPYFmB2ZcFwI0dN8H56LkRpAqC41n4FFygHfYuONZz2XMd9sP6SFL4ENygVe4WhGP02W7RjwpZhJ+AJ9AEuy/9qhzfyzn27j6Edrj3Imc5zhSYwK8cPIFWyFWRtRyrIu42EAiFdTnJdb2Pik8A+2bWVisTeF1kU2QtfQTPlzr0qcib9ZR3EX6tkdUji0cuQuiHRAi/FnD6Ol+s0G9FjgBauUebzokGZvU5V3HoTYF8EnksPeE3GFtdwRW6LdCqbDQnCN8A6LbdrqHVe/BkUqqLPBTQHwB+lp6i8Gp1YJhoZ4M+YHAxdSudvGrxkdXd4lEUuRfwpwL6S4RKPJYxDk7/JvgRwGsZuwrGqXyU65ykfatxFX5OB/8N4I/BE5xAjVjvhE9rH2RcpBxd6oxpeF20uIdB+q+6CsEJT6tvAksSpsWntTkXgKn/U05ivN6Nt90OL81zNxdVCM44zQgyZ3W6C0Mjwd4xuMlarumX4NfQ0Fplca811M89HDKq0PoE5yTNwNU9VJkDhq+q0FEyG8CTKtBDIhXgCxhlGBIpDk5XYcija7SY5oG5DDyCr035DI1RFvVsqlYDhsjACcjxXjZEwGm1mYHPKXJJxcjWJdfnnhsVaxeDZ/Wy19cqnlR8TM0z04VEBp4V/FpzeLFEF2lkPDDOmicTrQ416WQro77dAWGh7laMqjqGsCOGyKDyGpw7yHiKKhTV5uGaVC2efXqv6hSUEYRWPmOcyjWKnDCk+70ppgoQfrISysAjBTRdK/Qe46qO0C3qMucewF8A/0QBlrhV8A4eQetLaTGGL1qU1xmTGdqAuFZ5LdAO3xYDRT4PAN2krA0UUPA3jOMu3aCT61o80X2a4DnqLrT83sC5Cqq2uEJHFteCX6GPyOtxL2u1HqevE5y+rq4yKWlH4C/Nc7ftdg7PF3pSIQx932uNaOkWrYA84lzt4w7eCKAnFPXba9acLcYhVd0kAl9cLGvc5Av1WrSiUehLV/nRSt/jePWGULagWJloRRfV0AoeZV5d7UQZtAev3RDSQbopE312tXJUQ2dJLZNwJ8vbLXuHDpttv2XwX7t3mMCzX9qpjWpoL5ayAi6sDC/arQ3gOTb7ErNF/4ICfq4fe9X+eAKv92R99NwuOI6qvv74pj8S3maUqHlmBDI596X/gLJ261834LY/b9+y/QdJLrfuY2EtwQAAAABJRU5ErkJggg=="/>
    <image id="4c" width="52" height="52" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE3ElEQVRogd2a3XbaMBCEF0ISaJr2Ji+XJ8zL5aZJgAQK7kU0ZjyelQ1JTlt0zh7xI2R9Hmm1WhNxZmXymZ3dN48n9fcwuWs+awwfAkoA9DN9r4PvwXwE8CQgAZkM1FlpBuqTwI4CqoA40zY8WK6dcZujwEYDEYyCTM1r/ox/oyB7qfV1+5uxUINARhU3eNgFveY2XBRkHxE7eu0gR0NVgRJVptGHcMZtuPDAd4ntow+Im1EFS4EMDO42BnsREbOKqVoYEMP8rtiO2uF3g1CzDEiKKoJBXxa7ktpBRQKziYgt1dvSHt/jd1ynxSok6jAMg1yRXZPhs8s4TD9WSGE2EfFGhveAQ9veFHQq9YAEBkCsCkPMiy3o9ZyAAKVAGCwgXiNiXWoY4DbRn4apo8imnMIASEG+kS1KPY+DUgDiKQcgKLEuhhs1i9w7ouzNZ+3A22KmGmAwxa7LwBcRcUP2vdQAA1QGhDsPZZZiLxGxKsZqbaPrCXsqOYVYHZ5urA4gbqVmKNzxDAhTbRUHRVUd3mx5/diIIgNSKHYCmGYA+kEGqGOBoCa8Yg2GbaIwHaAy3TJ1LuOgDoBuC8jPYj8EqDbl4BCwdrQdQNze1HMM981jO+2GphxPt6s4LHxMMwd0E/01xHcdg3uL7r7FMHDtW6rZhQOqp5ICqUpOITgEhoJBIXbdbmPdJjBQBV6Q9yk4BSjJYx10CjV3DTcNKDV4OQzW7UPuO4XBGmPT6KMXOUwjeusnUwhOASrxHsTejTfZ68Tm1Fb70b54TwMQbkRr2HJqCjkgVmoRfYDapopyEe8qsTK82a6ju5c5IA162+LW0FgoNQ53eG0oEB/82AFoXwrCMO7waIH4gm4tcYTtjKcEfpslTbRfvWncpyqjUBbI5Qj0VJod5rLDnb1oHBa0zoIxh0XXZ+vpdDq44pyFmiZHsj7cZ3pkz8wlYHrXGwP0X5UxJ1ZNMbm4SgNG10fWryZGMnPXyGO56EavLs1US2qo8T7hQI7tdzSYU0iB0CkHidvE4JV4n6klSXamT4Q7WfymYJ2iQKySJjQ4JHHGmym7Zr0ob6QM4PIKAEuP4Np/ppDeRb0wTprrqEfW7sDGfXJOgfMKqBkQYKxUT6FpRHuEdYtf1eELr8iWpQakJjvUXD/LpK8MqDPe2nlIFdLodxXdOCs7xA0dHzbU30ux5+jmFlgpBurkFLi4NQTjRYvpwUkNl6bim5BNQz2xAuipAD2X9wqEdJZTKAViKJ5ymzK4dfgwXgd7zBEcWZ7niPhFYDz1VKFhL/cwuWvum0e8xfFWFdKYS4/NrOQxQMsC8WSAXqPuFJqhNBYGyIkKflTCIbwOks8zY4HgCKASphxyc7qGUnUyIDRUlTZxCCC5rbrhMYlGtyaxljjR6BxCdWPNctvuPMTZU5cK1qwp59rGpIJ1K8DaqWVNm7G5bY0YFJ5dO68xbLScp86ePnB0oBurS9bbnJyWv/U4xUUfX/M4RaBq2dQxD7xqoQ8Hpe6hVy0oPfkJngaAteB1Fu93lnMAeoxwm/axjySrJVUo4sweGhsotM8SKPpYP0toZAc8BeiFNx9+rJ+AaZJial7XEifZiVg/G63KSUACxb91aWQH3w5Oamfc5mv+GsPlbP68pOVs/l6WlX/hD4BnV/4AcperLpSp2XYAAAAASUVORK5CYII="/>
    <image id="4d" width="52" height="52" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAFUElEQVRogd2a0XbaSBBEC+LY2E68L/k5f2F+zi+7iQO2A+yDp6BUqh4JzO5D5pw+EiCGuaqenp5GwB/WFpfu8HH/dFKf3xff9pf8/Q8DBYBT+hzBfBTwLKAORHXUtg/nfgRwHtxJQAaig15MvNamg1dDOD8ZajaQwKSBL4tzBTsMUga+K84ddDbYJFBQxUEqUzgFUoBkFdwsqC5QAeMD/2S2lKOqxcE4wDaYA86GKoGCiyWQKzm68Rp1O1VmC+B3YT2wLtRVjxbZvRTgc8dUMQfSwb81e5Vz/Zxtxz4e90+LCioqZOq4aynINYCbZtdyVCh+n3dYlXlt9tKM5wRMinWVGgEVMEscVbmWwa+CKRRdkn2qqxFm0yDW7ZyvCaiKTbpf5XLualTGQW4B3DW7bcbPVCUHepNBbwD8Km5CFfL9vQwUopqqQxdTkHsAX9rx3qBuZHBLAeK8IcwaR1VdUQ7ajSqNWlLIg4C6GmEI8gXAVzm/b6AESgop0Brv6lRADqDutgCAx/3TwO0OQBOBwNW5byAPzb42I9CtATEoJKCVwPB3HWZrxx2Ga9uhuUIOlebOHY7KPAD4qxmVIhDnhANtcYxmq3DdAsMFV6OcAlGlQRifcjmq87kB6dxxoAcBSgNVICpEFakOMF503zBcnxTMs5CoUFpEk0KqEk3nEIF0YdXBOrB//mqmUBwfF9tDuwIO88ez6ASkYToFBgJxknMO8i7qwprWKCqii+2m9feCYdTUpWWWQp4VMCNQt6PdYbgeeUDQQXPgHs3oilxsGTBW7VzXKAUatKW9rnI3T3N0YVXTTEFTIE2V1FYn9KVJr2fyC0bpKihUiahD3WCYyymEh2HgXQlPVqnMTWEK4wnvSCEFqnaivQzbVah+WIE0hdlZn1V/qk7aCUegHpRv4vyHFGDkDtY/oaoN4ty+dZyH5nPI4c7dcleFE++711/v5pQK9YD0x/+vNue3utf0gKpyU8p6q3JUKk8hXHNKFSj1NQlUVWY0v6pyrAqy6jcVSXr5WxfOg0J11zy38hyLlhbTuUWS1J/uVuM23JsCpSJgShKZlngtgJ9rblZVfbahT+9Pc7gKaHL74C6hLuDbZq0BpM0c+/GFNeVsGzGvLejNqqD2ve1DUkjv3lpMawEpCdXFEBjmcszZfhVGMC+W+JwaNHe5pBDvjiqj22bfz/D7ugtV1ejCWiB5BvCz2XMzh3KgVDR5B/q++LZvyZ1CqbtRoTWO+dxUVceV88/ZH2H+AfCj2c+ZQJNziM0jkQJpnqUBQBNN3Y1OFUkU6G8BokobHAOE1uYiVC9s6938hOMGyxNFYHznvepT1RQU6EeDolJUaVKhWPUJbscfXwqUJonAsKDBqLVGLpIQ3BXXOaQu94yjy1GdbkAYAElzlX4jJ568lnON6nBz1gNSl6NKhPKg4OpsbYyDVtW2aZrW6zbcy8BeDtYImOaQRrkUugmawvZg/sytbfMiraq4MmmR5OC0PNUr1qdFdS3vazBIOd2oxVTcVPKiif4DoVvytBWvgofOuZdgnvak6Bb/Tun94aUX7+z9lJNRIa8BpBpClcvpH1+alM6CATqbJat1u1Is4mupS498PxVJNP2hUp7JE9i3L0CYN9pKhSyMsx06xVClbYN4Ra4BoPO9yvxfcX6/2ya3vMXzCVpD0GLHVC2gyhf1XD8bheez/wUvoPidFDTSMRUzfIud/vtxT7jcgxcFWJpfwDCDKCszGN75tJ0+SRVtZ1V0Jp758fe8edpfHf/7h5e8TTxa1uvbBzp4/ZFHzC5Wczv1wT9tl34I8I9q/wJ8hc/eTcdQhAAAAABJRU5ErkJggg=="/>
    <image id="4e" width="51" height="52" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAA0CAYAAAAnpACSAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAFSElEQVRogd2a3VIbOxCE28TYQIDc5OV4wrwcNyfhP8CeC9S41duzP4FTpyqqmtLaXmv1aUajmbGBv6htPnOwq+F61Xg/Nt+Hz3z+h2CKya8Zs4P5KNxqmACwKfpq/GGmB/BnYKtgBER7v/b3tOnEh5nXANZBLYKZgKAcFdf+jMHktbjuoJYCzcIYSAI4KsS1xMm9Sl+JQ2MJ1CRMAaIT/hKE7/Nefl818ArgRXqVCmwWqIQJIAliW8gX9BqCTEon/hxEoV5kAThGCbRdCeIAx012cn0s9zmMauJ3kCcDg4NIP2ojzRQgrglOft9kJ/0OvYY4jpqXTv6xyZP0/JxQbnZROx3MhEZUE5z4HsAJgNPWnwQgmhtwMLFnA3kQuTc41dQsUDIz3+zUiGriVOSsiUJRcwnGQe6b8H7VJuS77Df23iQMgVwr1AgBvgI4b/1XA9q3yXHfAAcTew4gt+g1SRh30Z27vhquN6qdd5hmYnNaOZXJXzQY9gqUYAYcTIYwdw2E9yoMFyAdqNEZVGbm3su1cgHgssmFARFmZ5PTzf+IN42oFtW81PNpP4oYVDtb0QrQa8a1ws1+3uQSwLcmBFJT42qrN1MY3kdn4Rrxw9QPVM53bGaYNrEd+r3CyRPmMmhGHYDDPOHNzBQEsuL0eCp6oKoG31sys8rETtBvfALR3AiTTIcTpQN4Qu3t+LnLb/SRxasDLdWMmpkDnYucoTcd3wdcWXUO+pkfpDx/+Nq9HQBsroZr/Nh8H1wzafPrQelA7Hl9hrEncxN6KTSiIHQOqmU9h9x9v2kmuGQ/YxyGQCr64D0OZ1OKzdz0uEe4jzSqoFesQLqWNFPFYx7KEE7js2O5N53k6okUZB9Eg1eP9SLQ2nBmSqoUII09tPtebAzGdT6ujpcy2cM5EyCmkrCUu6gJaAaa8qWp3Cj1R6jNqxvfV64CS4C+UmnVgPEqrkm9Uwoe98sUzP/VNtavalXUDExHrFVFpcvXZZylY84VNapnABhrZu4BPKFTzOSxkz90auwUh6V4LI353rbhg1QG0gzR4ya+3rX7qlKTAmgxI9UCPG1WsDINcDPzVfM0lxGv5+16sKn7raozzzbuUxhXYzICVRoCABy1XCCpX0E00tWY6R7j+EknkTToabPXAXQ8h5kESppx02KooanuHfpwI4XxanL6PqF0LGact+2a6bQukGonOoKpPaPhuINoyOEg/F5KATwOuwNwI3IrokDUqGtG513uGX6Bq6gwt+jjsKqUNFedUZifAH41IdQdenNTU+s006XNBYhv/gfkeClNtCpoaNr8gIMWfgL4R6DU3HzvaLDatS3JWirgDkAfrvGY7wVf8SUFDYX51UAIc4NeM+7RZvcMm5uZBoR+hvg+eETtGBIMN/4NDmammnnAQSvRk8W6mYCwZ+FAgVKy5ftqrgioGuQepKgToNt391yGNKnWnBK0lDpr+sxrVmY829QF8vRY3TOFIHTN0cyW1Jp5g24yr/u6+3atLCmcc6KcuB7A1Mii8yVNEsCoIKjm5emzp9ApfU6OQrXjYYxqQn8BGMGknzRGmik8G9qgujI+sUeMXXc6ND1MUrCq6DerFWAiCSoK6SmF1vzffzXz1Fm9ZIrE9f3kvUYeTNtUcgb03o19ynGqH2qr6kzKYRxgFQgwk57avzGW1ALSWeQpQJUvOcAo/vrQT+cBSienE/aKTFWoc6DUu2AJyGIYA3KoqpJTjZ0m7GbM68//u4m2ALWk11btQ33vv/8jkLaJfzctGXsorj/0N60/hvG29o9z2j77T3R/RfsXSO/jtpPsGBMAAAAASUVORK5CYII="/>
    <image id="4f" width="48" height="47" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAvCAYAAAClgknJAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE80lEQVRogd1a21bbMBCchJAGSri0/BxfyM/RQkm4E9wHdvBovLKdwEurc/bY2Eaa2V2tdqUA/3ibfEUnF83VTv1cTs6bz469MwEDPalcvTWV685ktiYgwCcjRFuTyJu925rIaAIV4FO57tnfSkIB87qxv5XYaCKjCBj4qcieyEzu+V4JvAnwDYBXud/Ie5IZRWKQQIBXjRP4LGQ/ZC7PZhUCryEvJnyuRBoAzRCJXgIJeAIn4G8mcyFCSwCt5l8BPIc8AXiMK5+RjLpXL4kqAQOvbkKwCwAHIYdxXcS7fbRWIAFqnsAfANzH9UHIPKG1yCCJlID4PF2GWifwQwDfARzZlSRoBSfwHEDvQ9YhdyH3QoTWoEulc2KWEegBfxBAlwCORZZBgpaYx/8ogZcgQM2vAdwmhFWpul6Ms4C4joM/DJBLAKchZwBOQpZBjm6UWYDucwdgBeAPgBuTW7TW4Pz4mBNuhZoFdNLuo3Ubgv8B4GdcSUIJDLnQHVqXc7LUdiciIbFCQSCZuLMAs4gBjwPweQhJnKB1IUajLAox+ih4utpEgNfWiclFc1XMhcwCrn26zzKAngVoEqAFCErDqK4DGkZppf34Tr/J1ogirCrYDwKVmK/uc2QEKKdBLtO+L2S0AsMsSfIdw6wK14cpEivULODuQwscBwlO4pN4ptrnmpHlQhuUKzXfcY3QEEuZBwlaomhOQNMFEqALefj00Kn+7OGQQGlZdy2d3Gu8RyiuKfdCmFaozoEshHLFJQmKrr7qzxl47TvLjzixuSDqJHeXLPpWAppx0g005zkwUeCa+2S1gLZpgNecStMS9q3h2INC0Zk2zeU1ccuSNmah2vkQeA8SrqRaYlirMzoE9HktbXbg2umY+qKWJPoYWX2RAh0qE7MCRifqNuBrRLw48nE6SiLmmgV0AL/3wT/bvI9ss6DanIBnf16A630RzlDJFgfa0DgunXGmQCfPdpCal2h+0qlhR5JwJWV1so/TSeaIOXMh7Vhr2GeUpV+WpwyR0G9UOcyRXpD3v3ECbErAzVirYSlZDav7PDXwrnHNf7R/zYOqlvCVWF1HNc8qisI6doF2BZ5If9nkc+Wwb62PWchojUwCbumUAAdS7XMAzVO0cNG8H8gXNdWcal2Br1HWyKzItDYerInd/zVDVPBMnVX7/L8soVPLUvPa5y3ey8vbkDVaKzAT7a8HLifnzUVzpYNpBcXB/qDcOvF8ni7Vt7FFpdwF2BsA1yhrYlrhEeU862yx1Fwos8BcRCsp/VbT6ixtVtehQq4B/Aq5jmcrlC5UjUJ9BHxA5irMURz8I9q5we+UgGufuxIZAbqQEhieA4kbcdAHdHeg1c0e0e5KaF2c7UowICiBawC/47pC6z4d/x+7reJW0KSO7zOX2JYAJ+8N2km8Qqv9bKEsWt/Wohf3Wh+zvFRheTm0L6Shc2Xi24sFgW23FmmF2vNso8orqdrGli9cCtwjT1X7wPDuNL/JttYXJlrD9u1OkwRFV93aFnv1sGPM+YCTcCIuXmYC5equiaGC1oOO0Sc1Y09olERWCnqI7dvYUiKvIln6PHjMtMsZWXbctJfcZ7mQkvD7nQ76tioJR5xU+s5Blsz5yeTOJ5RbE6gQcUL+jq1Wrn682+Ww+1NFeeW0vq/ftIb+zE8OvmJX4aON/c3EV/xG4r9pfwEs4yD3oK/mAAAAAABJRU5ErkJggg=="/>
    <image id="4g" width="76" height="55" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEwAAAA3CAYAAACmcqwpAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAGiUlEQVR4nO2b3XbaSBCES9ixN7G9e5OXyxPm5XK3scHGMnuByiqVumckgQHnbJ8zRwKEfj6qe3p6hgZHth+7X4289P3G3tfPo9cl2xVe7ypbAMDP5rufo2pzbrBqAku3UfPPltxPBsj3S68BzAN3FGCBqrStgv1VcNzc+4nUE7W3wmcKcBK4g4ElqlIwKwBXsu9tCbQM1luw9VaCCKAM7nrCzU0xPqSCuqo0HuOK83OquRtGatLWyra19xzg+3l/7H41GbSDFGbqUtUQynXXvtg+P6tBy6wES8G8BlvuO8CR2iJoixUWwFJlEcwXADeyvZH3CVDdtaSyTF2qklYa4Wxlu5XXbA2Gqouu926HuqTGH6pKQd0mjeAITdXJ8+o26xE9VikoQnqR7XO35XurbqvGcyJyzUUuKeqiKhQWlfRX175K43sO7QrlDiACFgV2AlM1PUvb2Fbhqbuqiw5c8xCFKbQVhjGKoL517U72Ce4Wscqy3jJySXdHPjAV9YIezlqa/kh+Tv1B/LrzgSWBXhV2iz2QbwDurREclXYjN68qA5YDU1ekmjYAntCr2q+l52RrEMSxpQrzxFTd8Ra9uu4BPAD4u9sSGlWmD7AEmMcvdUl1wycMw4BeJ0pHVhBoGstmATN1Rb0i1fW1A3MP4B/sgSk0qowKm+KSfDhuHZoDozuuMQwBTGN4njZo2mMOlLZEYZG6CIzBXtX1gD00glO3dBc5BJgHfbrkGmNYmRtvu2NaecZlMaygLnVHDfZ36N1RGxXmLnIl565ZNCRiIwAC086FAFo5hsfxGKYbKozFCvOAn7kjgTHYP0ijwgjM49cSYO6aVIt2Ko19TpfddPeysWNXkESWcWwSMKtGRD0jgz3d8U6a95IM+uom7o5A2SX1tbe2O+8r+thIWKo8j21RTjiyOQqrxa5IYWyag2kPWUpaS1bK/N+683LYw89aDDuCaNQRDdMG91MFFtS6VGERLE1YtXmWr+44B5ZbFM90mEVYW8TDsxIsfe5ZaYUqa4q6tPmQKJP/lMprqcCnGTrP9ybXiwoAURGgWJtb4pI+DNJkVVukKt6kFxSnwPLPHB5VoMMdLzN50w4nKmqO7qcIrHPHSF2RO7rC+FpdIBoGzam0qtXAaqytVX2ze1mssFIJx2OXqoywSvWv2sPPMc8VFZz+6BGoST/gKnoTKKqLD671rgiaDrCzLvtYoCKL4mKpZd8bWAosOIHGg6xn9LqXBtnJgfXIVgOVgQstBJYMgzyViIqEWaBfmm9dnJUU5rC8Tu+B3iurHuirPdBnsBGwyiDb3dFL0A7rj1IXkCtsbqIauWMtQf2U0AbAJhQIS+qKhj61Icens0hhcwbZJXf842ABkrhWBtlTgHmSGtXpgcIEw5GstvAkXE8x1TzTj9QVAdOEVV/rWNFr56wkfCQsXsvXTpRgzQIYDY1qAd+hZfUkvRmdUPBrHduiyV2f3MhW8QAVcCVgUQzztRJRT+g33WKoro82vbavo4gWo7gS9TwjuwbC3tFdMiqTRDHKZ2PQ7Z9q/Kj3QGC6HMABOrhIbQNThWUDVS/r+MIRYDzFxQmEVzv21ApjDZ+THZzcdYAltRWn2bIBaZSl88Z0WovnY109KhCewhTYFv3s9xN6eL4QZbQIJbKsHpaN4N3ldLqK0+uv2P+KOmNzSmDa0eiygTWAx65xUYqqLYI2a21FNufnN8EJUk40cH7vXAmrA+MPuMEe1r8AfqNX2zMqy51kmwLzqatIUTr13qIH6DV74HzAdIab02u/u/aIMTTvAIBKDMsu7LCoIKD/BT0fO2dlgg/MXpDxao09pEeMVfaCcQcwySWjX0hnjHVBB2+GytJ041xVidLSAV0rRnCMZcU4li13ihZ38IIEweN0JnnKZOiprBZOdJGdB38CS3tKBcZBcXQxTQ34/gvyucYI1qng6cNmy6AITtuk9CJTmALz3EsDqWf9mrPRzuGS3PoQTZeh6+pqTWJHWf9oUfDP5vtOhkc6WG7lRtxFFdSlwKK5W/KHZgem8LI/PFRdEnaQgvPhhs8mR4nuOYuFWelGqxdRJaMNvjOwwUMlJWodT/qM8SXCopWgedshcEVg/PeZWh6mBT8uIypNgF4CKLcMXFQPK8ICggdM/lEbgfGe8BJh0TxrLxUNU1hA8pAGTY/LAF0yLGAci6Jhz/t+6f+S1QcN4E363oVbCOTD/pGbQPw0tuTP8f/bQvsPPoCzn/bfs3UAAAAASUVORK5CYII="/>
    <image id="4h" width="87" height="41" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFcAAAApCAYAAABA4LXdAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAEk0lEQVRoge2bzVLbQBCE24kxhJ+ceDmekJfjCBhwsHKw2ttqzeyakFStUkzV1Aphy9qP9uzMrAC+7J/Z6rMXuBsePn2Nnu1+dTv86Xs/BCYBeeq53i2CODv3EdgnQTCoKxuzcydfvwNzYENjPAlydfIVqOp+rnbdXmDXVKqjO+y4CjmdrICNAH5Ljk+F3JNlUPfJ8Qx4BjicvIF1qDVfImBVIiHq+D6O++D3VcDryodmUL8nnkEG+gTsilVwhJo5X3+81t3wsHLAM7hBnHWo69HP5HiNOWQHDPQDebDjCOqvxFdIAPuHZMp11RLq2egbG+mq5ChE9GSq3AjsbvQ3GVU0NCoert4JXIu1qliC3QA4F7+Qcw44U29Ppqp1sG8AXsU5J3/vgDK/elhArlpC/CF+MY6EraHCw0NvpnAIV8G+iHM+sPfMMgdVbw2uxlmqljCvAFzK6IAj9fZmCkVVq2C3AJ5Qwpy+j6Hkm5yDjAVusJApYIVLqDcArjEHvEFZ4HqGCxT1uWq3o29Q5hGFD03TVmiEhdpCxhh7iQPUGwA/x+NrlDDBRS6C2wtkX8wUripWw4G/bocCOBRQLVtgzGQM9bBwjQNcAqZ6CZc3thTlaqy9QBEIMA0Z6pp6EnKcLYym6vWYywWN6iXgGxyAMzRo3O0VbrSYveIAd4OiWAf/giKe8Nt5NzzgfnU7tMJCFhoI+ApFxQwNmjUsRbksEHjvjLHvKFC3mK4phOv5/FS5QZ+2BpgKvsAUNMelwNVsgXDXKIAYBhRqlGqmc/xIhaalr4Kmn9vPS8oWtEBgGPDqU8FmRdJkngq31WJsNW68iaM30Kvp13iP+Ty8Z6Jzagqn1hXTG+AY/YWyi0+ayp1a1Ah3q805YnO0U+BGN6L9Te8iaV6oyu1NwV6haedL24tpDxcN8bTgttpx2uDQxeAdywgLXv5qs4bdMLrCznYmJhbB9TcoWE2ktf5mSrJHWXV7znFpOkev0OgvKHOmqBxwaArXW2cOVVXKG2BWgPF1ryh5oKYpvZrDZSHB8vcJwPP4s6pZ+wqpejPlcnTFEuwzpnU3b0qrs6XB9SrtGQe4jyiAqWIHvPcLA3O4mpaocrX80wIBKLGKSs6aNj2ahz4V0RYHqI8ogB1uFH+PtgYOO5dSpbUayNqCI/gXzCuzpcAFpnA1/D2jKPgJ0/AQhYaJtRY0hcutDsLay/lom6fHVqObw/X5qoI1NFC5rl4AGLKdCC5qvqDtUJSoC4B2kWo7EEuAG+1I6DpDz5Sr1wNQVy7BKiRVNP+63iWKFrLe4UYblZrjEihhZzF3Yke4jbjrKZp+dTKwvQKNzEOhhwjdfdCQEKVjR6ulYp5e+Kq6w7xZ0/uzCjVrlfY6eml8hJo+tyDq9VxXj9kzYB9B1cr0rPdY6xaFB193oufGUtUC7d4CdzX9gxWutt8QjEuwwY6j8t+hzyozf1YsBJBss9ccwbhUcxXX/Pj66CnHFETjafKsj7l0sMBcxRw93QrjrFoTRrK/1nr/EiFn3a0INoD2o/sfgvC//+fOKfaZ/+75sr9ovwE6VuMXJQtz3QAAAABJRU5ErkJggg=="/>
  </defs>
</svg>
`,OnscreenGamepads_svelte_svelte_type_style_lang="";function create_fragment$q(n){let e,t,s,a,c,u,d,m,_,b,S,C;return{c(){e=element("div"),t=element("div"),s=space(),a=element("div"),c=space(),u=element("div"),d=new HtmlTagHydration(!1),m=space(),_=element("div"),b=new HtmlTagHydration(!1),this.h()},l(w){e=claim_element(w,"DIV",{id:!0,class:!0});var O=children(e);t=claim_element(O,"DIV",{id:!0,class:!0}),children(t).forEach(detach),s=claim_space(O),a=claim_element(O,"DIV",{id:!0,class:!0}),children(a).forEach(detach),c=claim_space(O),u=claim_element(O,"DIV",{class:!0});var I=children(u);d=claim_html_tag(I,!1),I.forEach(detach),m=claim_space(O),_=claim_element(O,"DIV",{class:!0});var N=children(_);b=claim_html_tag(N,!1),N.forEach(detach),O.forEach(detach),this.h()},h(){attr(t,"id","gamepad-joystick-touch-area-left"),attr(t,"class","gamepad-joystick-touch-area svelte-vynov5"),attr(a,"id","gamepad-joystick-touch-area-right"),attr(a,"class","gamepad-joystick-touch-area svelte-vynov5"),d.a=null,attr(u,"class","gpad-display gpad-display-left"),toggle_class(u,"hidden",!n[0]),b.a=null,attr(_,"class","gpad-display gpad-display-right"),toggle_class(_,"hidden",!n[0]),attr(e,"id","gamepad-container"),attr(e,"class","inset-0 opacity-30 absolute pointer-events-none"),toggle_class(e,"hidden",collapsedMode)},m(w,O){insert_hydration(w,e,O),append_hydration(e,t),append_hydration(e,s),append_hydration(e,a),append_hydration(e,c),append_hydration(e,u),d.m(GamepadLeftSvg,u),append_hydration(e,m),append_hydration(e,_),b.m(GamepadRightSvg,_),n[2](e),C=!0},p(w,[O]){(!C||O&1)&&toggle_class(u,"hidden",!w[0]),(!C||O&1)&&toggle_class(_,"hidden",!w[0])},i(w){C||(w&&add_render_callback(()=>{C&&(S||(S=create_bidirectional_transition(e,fade,{duration:100},!0)),S.run(1))}),C=!0)},o(w){w&&(S||(S=create_bidirectional_transition(e,fade,{duration:100},!1)),S.run(0)),C=!1},d(w){w&&detach(e),n[2](null),w&&S&&S.end()}}}let collapsedMode=!1;function instance$q(n,e,t){let s,{visible:a=!1}=e;onMount(()=>{gpadCtrl.setupOnscreenGamepad(s)});function c(u){binding_callbacks[u?"unshift":"push"](()=>{s=u,t(1,s)})}return n.$$set=u=>{"visible"in u&&t(0,a=u.visible)},[a,s,c]}class OnscreenGamepads extends SvelteComponent{constructor(e){super(),init(this,e,instance$q,create_fragment$q,safe_not_equal,{visible:0})}}function resizeToFit(n,e=!0){function t(){const s=n.parentElement;if(s){const a=s.offsetWidth,c=s.offsetHeight,u=n.videoWidth,d=n.videoHeight,m=a/c,_=u/d;m>_?(n.style.width="auto",n.style.height="100%"):(n.style.width="100%",n.style.height="auto")}}return t(),window.addEventListener("resize",t),{update(s){t()},destroy(){window.removeEventListener("resize",t)}}}function create_fragment$p(n){let e,t,s,a,c=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[3]},{viewBox:"0 0 24 24"}],u={};for(let d=0;d<c.length;d+=1)u=assign$1(u,c[d]);return{c(){e=svg_element("svg"),t=new HtmlTagHydration(!0),this.h()},l(d){e=claim_svg_element(d,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var m=children(e);t=claim_html_tag(m,!0),m.forEach(detach),this.h()},h(){t.a=null,set_svg_attributes(e,u)},m(d,m){insert_hydration(d,e,m),t.m(n[4],e),s||(a=[listen(e,"click",n[7]),listen(e,"keydown",n[8]),listen(e,"keyup",n[9]),listen(e,"focus",n[10]),listen(e,"blur",n[11]),listen(e,"mouseenter",n[12]),listen(e,"mouseleave",n[13]),listen(e,"mouseover",n[14]),listen(e,"mouseout",n[15])],s=!0)},p(d,[m]){m&16&&t.p(d[4]),set_svg_attributes(e,u=get_spread_update(c,[{xmlns:"http://www.w3.org/2000/svg"},m&32&&d[5],m&2&&{role:d[1]},m&1&&{width:d[0]},m&1&&{height:d[0]},m&4&&{fill:d[2]},m&8&&{"aria-label":d[3]},{viewBox:"0 0 24 24"}]))},i:noop$3,o:noop$3,d(d){d&&detach(e),s=!1,run_all(a)}}}let svgfilled$g='<path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-8 12H9.5v-2h-2v2H6V9h1.5v2.5h2V9H11v6zm2-6h4c.55 0 1 .45 1 1v4c0 .55-.45 1-1 1h-4V9zm1.5 4.5h2v-3h-2v3z"/>',svgoutlined$g='<path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM7.5 13h2v2H11V9H9.5v2.5h-2V9H6v6h1.5zM18 14v-4c0-.55-.45-1-1-1h-4v6h4c.55 0 1-.45 1-1zm-1.5-.5h-2v-3h2v3z"/>',svground$g='<path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-8.75 12c-.41 0-.75-.34-.75-.75V13h-2v1.25c0 .41-.34.75-.75.75S6 14.66 6 14.25v-4.5c0-.41.34-.75.75-.75s.75.34.75.75v1.75h2V9.75c0-.41.34-.75.75-.75s.75.34.75.75v4.5c0 .41-.34.75-.75.75zm3.25-6H17c.55 0 1 .45 1 1v4c0 .55-.45 1-1 1h-3.5c-.28 0-.5-.22-.5-.5v-5c0-.28.22-.5.5-.5zm1 4.5h2v-3h-2v3z"/>',svgsharp$g='<path d="M21 3H3v18h18V3zM11 15H9.5v-2h-2v2H6V9h1.5v2.5h2V9H11v6zm2-6h4c.55 0 1 .45 1 1v4c0 .55-.45 1-1 1h-4V9zm1.5 4.5h2v-3h-2v3z"/>',svgtwotone$g='<path d="M14.5 10.5h2v3h-2zM19 5H5v14h14V5zm-8 10H9.5v-2h-2v2H6V9h1.5v2.5h2V9H11v6zm7-1c0 .55-.45 1-1 1h-4V9h4c.55 0 1 .45 1 1v4z" opacity=".3"/><path d="M5 21h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2zM5 5h14v14H5V5zm4.5 6.5h-2V9H6v6h1.5v-2h2v2H11V9H9.5zM17 9h-4v6h4c.55 0 1-.45 1-1v-4c0-.55-.45-1-1-1zm-.5 4.5h-2v-3h2v3z"/>';function instance$p(n,e,t){const s=["size","role","color","variation","ariaLabel"];let a=compute_rest_props(e,s);const c=getContext("iconCtx")??{};let{size:u=c.size||"24"}=e,{role:d=c.role||"img"}=e,{color:m=c.color||"currentColor"}=e,{variation:_=c.variation||"outlined"}=e,b;switch(_){case"filled":b=svgfilled$g;break;case"outlined":b=svgoutlined$g;break;case"round":b=svground$g;break;case"sharp":b=svgsharp$g;break;case"two-tone":b=svgtwotone$g;break;default:b=svgoutlined$g}let{ariaLabel:S="hd"}=e;function C(k){bubble.call(this,n,k)}function w(k){bubble.call(this,n,k)}function O(k){bubble.call(this,n,k)}function I(k){bubble.call(this,n,k)}function N(k){bubble.call(this,n,k)}function P(k){bubble.call(this,n,k)}function B(k){bubble.call(this,n,k)}function x(k){bubble.call(this,n,k)}function F(k){bubble.call(this,n,k)}return n.$$set=k=>{e=assign$1(assign$1({},e),exclude_internal_props(k)),t(5,a=compute_rest_props(e,s)),"size"in k&&t(0,u=k.size),"role"in k&&t(1,d=k.role),"color"in k&&t(2,m=k.color),"variation"in k&&t(6,_=k.variation),"ariaLabel"in k&&t(3,S=k.ariaLabel)},[u,d,m,S,b,a,_,C,w,O,I,N,P,B,x,F]}class Hd extends SvelteComponent{constructor(e){super(),init(this,e,instance$p,create_fragment$p,safe_not_equal,{size:0,role:1,color:2,variation:6,ariaLabel:3})}}function create_fragment$o(n){let e,t,s,a,c=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[3]},{viewBox:"0 0 24 24"}],u={};for(let d=0;d<c.length;d+=1)u=assign$1(u,c[d]);return{c(){e=svg_element("svg"),t=new HtmlTagHydration(!0),this.h()},l(d){e=claim_svg_element(d,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var m=children(e);t=claim_html_tag(m,!0),m.forEach(detach),this.h()},h(){t.a=null,set_svg_attributes(e,u)},m(d,m){insert_hydration(d,e,m),t.m(n[4],e),s||(a=[listen(e,"click",n[7]),listen(e,"keydown",n[8]),listen(e,"keyup",n[9]),listen(e,"focus",n[10]),listen(e,"blur",n[11]),listen(e,"mouseenter",n[12]),listen(e,"mouseleave",n[13]),listen(e,"mouseover",n[14]),listen(e,"mouseout",n[15])],s=!0)},p(d,[m]){m&16&&t.p(d[4]),set_svg_attributes(e,u=get_spread_update(c,[{xmlns:"http://www.w3.org/2000/svg"},m&32&&d[5],m&2&&{role:d[1]},m&1&&{width:d[0]},m&1&&{height:d[0]},m&4&&{fill:d[2]},m&8&&{"aria-label":d[3]},{viewBox:"0 0 24 24"}]))},i:noop$3,o:noop$3,d(d){d&&detach(e),s=!1,run_all(a)}}}let svgfilled$f='<path d="M17.5 15v-2h1.1l.9 2H21l-.9-2.1c.5-.2.9-.8.9-1.4v-1c0-.8-.7-1.5-1.5-1.5H16v4.9l1.1 1.1h.4zm0-4.5h2v1h-2v-1zm-4.5 0v.4l1.5 1.5v-1.9c0-.8-.7-1.5-1.5-1.5h-1.9l1.5 1.5h.4zm-3.5-1-7-7-1.1 1L6.9 9h-.4v2h-2V9H3v6h1.5v-2.5h2V15H8v-4.9l1.5 1.5V15h3.4l7.6 7.6 1.1-1.1-12.1-12z"/>',svgoutlined$f='<path d="M17.5 15v-2h1.1l.9 2H21l-.9-2.1c.5-.3.9-.8.9-1.4v-1c0-.8-.7-1.5-1.5-1.5H16v4.86L17.14 15h.36zm0-4.5h2v1h-2v-1zm-4.5 0v.36l1.5 1.5V10.5c0-.8-.7-1.5-1.5-1.5h-1.86l1.5 1.5H13zM2.51 2.49 1.45 3.55 6.9 9h-.4v2h-2V9H3v6h1.5v-2.5h2V15H8v-4.9l1.5 1.5V15h3.4l7.6 7.6 1.06-1.06z"/>',svground$f='<path d="M17.5 14.25V13h1.1l.72 1.59a.693.693 0 0 0 1.27-.55l-.49-1.14c.5-.3.9-.8.9-1.4v-1c0-.83-.67-1.5-1.5-1.5H17c-.55 0-1 .45-1 1v3.9l1.04 1.04c.27-.11.46-.38.46-.69zm0-3.75h2v1h-2v-1zm-4.5 0v.4l1.5 1.5v-1.9c0-.82-.68-1.5-1.5-1.5h-1.9l1.5 1.5h.4zm8.03 10.53-18-18a.742.742 0 1 0-1.05 1.05l4.98 4.98c-.27.11-.46.38-.46.69V11h-2V9.75c0-.41-.34-.75-.75-.75S3 9.34 3 9.75v4.5c0 .41.34.75.75.75s.75-.34.75-.75V12.5h2v1.75c0 .41.34.75.75.75s.75-.34.75-.75V10.1l1.5 1.5v2.9c0 .28.22.5.5.5h2.5c.12 0 .24-.01.36-.04l7.11 7.11c.29.29.76.29 1.05 0a.74.74 0 0 0 .01-1.04z"/>',svgsharp$f='<path d="M17.5 15v-2h1.1l.9 2H21l-.9-2.1h.9V9h-5v4.86L17.14 15h.36zm0-4.5h2v1h-2v-1zm-4.5 0v.36l1.5 1.5V10.5c0-.8-.7-1.5-1.5-1.5h-1.86l1.5 1.5H13zM2.51 2.49 1.45 3.55 6.9 9h-.4v2h-2V9H3v6h1.5v-2.5h2V15H8v-4.9l1.5 1.5V15h3.4l7.6 7.6 1.06-1.06z"/>',svgtwotone$f='<path d="M17.5 15v-2h1.1l.9 2H21l-.9-2.1c.5-.3.9-.8.9-1.4v-1c0-.8-.7-1.5-1.5-1.5H16v4.86L17.14 15h.36zm0-4.5h2v1h-2v-1zm-4.5 0v.36l1.5 1.5V10.5c0-.8-.7-1.5-1.5-1.5h-1.86l1.5 1.5H13zM2.51 2.49 1.45 3.55 6.9 9h-.4v2h-2V9H3v6h1.5v-2.5h2V15H8v-4.9l1.5 1.5V15h3.4l7.6 7.6 1.06-1.06z"/>';function instance$o(n,e,t){const s=["size","role","color","variation","ariaLabel"];let a=compute_rest_props(e,s);const c=getContext("iconCtx")??{};let{size:u=c.size||"24"}=e,{role:d=c.role||"img"}=e,{color:m=c.color||"currentColor"}=e,{variation:_=c.variation||"outlined"}=e,b;switch(_){case"filled":b=svgfilled$f;break;case"outlined":b=svgoutlined$f;break;case"round":b=svground$f;break;case"sharp":b=svgsharp$f;break;case"two-tone":b=svgtwotone$f;break;default:b=svgoutlined$f}let{ariaLabel:S="hdr off"}=e;function C(k){bubble.call(this,n,k)}function w(k){bubble.call(this,n,k)}function O(k){bubble.call(this,n,k)}function I(k){bubble.call(this,n,k)}function N(k){bubble.call(this,n,k)}function P(k){bubble.call(this,n,k)}function B(k){bubble.call(this,n,k)}function x(k){bubble.call(this,n,k)}function F(k){bubble.call(this,n,k)}return n.$$set=k=>{e=assign$1(assign$1({},e),exclude_internal_props(k)),t(5,a=compute_rest_props(e,s)),"size"in k&&t(0,u=k.size),"role"in k&&t(1,d=k.role),"color"in k&&t(2,m=k.color),"variation"in k&&t(6,_=k.variation),"ariaLabel"in k&&t(3,S=k.ariaLabel)},[u,d,m,S,b,a,_,C,w,O,I,N,P,B,x,F]}class Hdr_off extends SvelteComponent{constructor(e){super(),init(this,e,instance$o,create_fragment$o,safe_not_equal,{size:0,role:1,color:2,variation:6,ariaLabel:3})}}const blurOnClick=n=>{const e=()=>{n.blur()};return n.addEventListener("click",e),{destroy(){n.removeEventListener("click",e)}}},VideoPlayer_svelte_svelte_type_style_lang="";function create_else_block$4(n){let e,t,s,a="Use HD Video",c;return e=new Hd({props:{class:"block text-2xl pointer-events-none",tabindex:"-1",variation:"round"}}),{c(){create_component(e.$$.fragment),t=space(),s=element("span"),s.textContent=a,this.h()},l(u){claim_component(e.$$.fragment,u),t=claim_space(u),s=claim_element(u,"SPAN",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(s)!=="svelte-ww9iko"&&(s.textContent=a),this.h()},h(){attr(s,"class","inline")},m(u,d){mount_component(e,u,d),insert_hydration(u,t,d),insert_hydration(u,s,d),c=!0},i(u){c||(transition_in(e.$$.fragment,u),c=!0)},o(u){transition_out(e.$$.fragment,u),c=!1},d(u){u&&(detach(t),detach(s)),destroy_component(e,u)}}}function create_if_block_1$3(n){let e,t="Switching...";return{c(){e=element("span"),e.textContent=t,this.h()},l(s){e=claim_element(s,"SPAN",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(e)!=="svelte-1xajnko"&&(e.textContent=t),this.h()},h(){attr(e,"class","inline")},m(s,a){insert_hydration(s,e,a)},i:noop$3,o:noop$3,d(s){s&&detach(e)}}}function create_if_block$4(n){let e,t,s,a="Use Basic Video",c;return e=new Hdr_off({props:{class:"block text-2xl pointer-events-none",tabindex:"-1",variation:"round"}}),{c(){create_component(e.$$.fragment),t=space(),s=element("span"),s.textContent=a,this.h()},l(u){claim_component(e.$$.fragment,u),t=claim_space(u),s=claim_element(u,"SPAN",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(s)!=="svelte-cekork"&&(s.textContent=a),this.h()},h(){attr(s,"class","inline")},m(u,d){mount_component(e,u,d),insert_hydration(u,t,d),insert_hydration(u,s,d),c=!0},i(u){c||(transition_in(e.$$.fragment,u),c=!0)},o(u){transition_out(e.$$.fragment,u),c=!1},d(u){u&&(detach(t),detach(s)),destroy_component(e,u)}}}function create_fragment$n(n){let e,t,s,a,c,u,d,m="",_,b,S,C,w,O,I;const N=[create_if_block$4,create_if_block_1$3,create_else_block$4],P=[];function B(x,F){return F&2&&(s=null),s==null&&(s=!!x[7](x[1])),s?0:x[4]?1:2}return a=B(n,-1),c=P[a]=N[a](n),{c(){e=element("div"),t=element("button"),c.c(),u=space(),d=element("video"),d.innerHTML=m,b=space(),S=element("video"),this.h()},l(x){e=claim_element(x,"DIV",{id:!0,class:!0});var F=children(e);t=claim_element(F,"BUTTON",{class:!0});var k=children(t);c.l(k),k.forEach(detach),u=claim_space(F),d=claim_element(F,"VIDEO",{class:!0,tabindex:!0,"data-svelte-h":!0}),get_svelte_dataset(d)!=="svelte-s7oz39"&&(d.innerHTML=m),b=claim_space(F),S=claim_element(F,"VIDEO",{class:!0,tabindex:!0}),children(S).forEach(detach),F.forEach(detach),this.h()},h(){attr(t,"class","opacity-100 hd-video-btn btn variant-filled-warning text-white btn-base shadow-md absolute top-3 left-1/2 -translate-x-1/2 svelte-qbac6u"),toggle_class(t,"!opacity-100",n[3]),attr(d,"class","video-livestream lk-video svelte-qbac6u"),d.muted=!0,d.playsInline=!0,d.autoplay=!0,d.controls=!1,attr(d,"tabindex","-1"),toggle_class(d,"!visible",n[7](n[0])&&!n[7](n[1])),attr(S,"class","video-livestream sp-video svelte-qbac6u"),S.muted=!0,S.playsInline=!0,S.autoplay=!0,S.controls=!1,attr(S,"tabindex","-1"),toggle_class(S,"!visible",n[7](n[1])),attr(e,"id","livestream_container"),attr(e,"class","svelte-qbac6u"),toggle_class(e,"full",n[5])},m(x,F){insert_hydration(x,e,F),append_hydration(e,t),P[a].m(t,null),append_hydration(e,u),append_hydration(e,d),n[13](d),append_hydration(e,b),append_hydration(e,S),n[16](S),n[17](e),w=!0,O||(I=[action_destroyer(blurOnClick.call(null,t)),listen(t,"click",n[10]),action_destroyer(_=resizeToFit.call(null,d,n[7](n[0]))),listen(d,"pointerenter",n[11]),listen(d,"pointerleave",n[12]),listen(d,"canplay",n[8](n[6].livekit)),listen(d,"playing",n[8](n[6].livekit)),listen(d,"play",n[8](n[6].livekit)),listen(d,"stalled",n[9](n[6].livekit)),listen(d,"pause",n[9](n[6].livekit)),listen(d,"ended",n[9](n[6].livekit)),listen(d,"suspend",n[9](n[6].livekit)),listen(d,"error",n[9](n[6].livekit)),listen(d,"waiting",n[9](n[6].livekit)),action_destroyer(C=resizeToFit.call(null,S,n[7](n[1]))),listen(S,"pointerenter",n[14]),listen(S,"pointerleave",n[15]),listen(S,"canplay",n[8](n[6].simplepeer)),listen(S,"playing",n[8](n[6].simplepeer)),listen(S,"play",n[8](n[6].simplepeer)),listen(S,"stalled",n[9](n[6].simplepeer)),listen(S,"pause",n[9](n[6].simplepeer)),listen(S,"ended",n[9](n[6].simplepeer)),listen(S,"suspend",n[9](n[6].simplepeer)),listen(S,"error",n[9](n[6].simplepeer)),listen(S,"waiting",n[9](n[6].simplepeer))],O=!0)},p(x,[F]){let k=a;a=B(x,F),a!==k&&(group_outros(),transition_out(P[k],1,1,()=>{P[k]=null}),check_outros(),c=P[a],c||(c=P[a]=N[a](x),c.c()),transition_in(c,1),c.m(t,null)),(!w||F&8)&&toggle_class(t,"!opacity-100",x[3]),_&&is_function(_.update)&&F&1&&_.update.call(null,x[7](x[0])),(!w||F&131)&&toggle_class(d,"!visible",x[7](x[0])&&!x[7](x[1])),C&&is_function(C.update)&&F&2&&C.update.call(null,x[7](x[1])),(!w||F&130)&&toggle_class(S,"!visible",x[7](x[1])),(!w||F&32)&&toggle_class(e,"full",x[5])},i(x){w||(transition_in(c),w=!0)},o(x){transition_out(c),w=!1},d(x){x&&detach(e),P[a].d(),n[13](null),n[16](null),n[17](null),O=!1,run_all(I)}}}function instance$n(n,e,t){let s;component_subscribe(n,fullscreenOpen,H=>t(5,s=H));var a=(H=>(H.livekit="LK",H.simplepeer="SP",H))(a||{});let c={playable:!1,videoElem:null},u={playable:!1,videoElem:null},d=null,m=!1,_=!1;const b=H=>!!(H.playable&&H.stream!=null),S=()=>{console.log("updateVideoVisibility",b(c),b(u)),d&&(t(4,_=!1),b(u)?c.stream&&c.stream.stop():(c.stream&&c.stream.start(),c.stream==null&&showToastMessage("Waiting for livekit video stream...",1e3,!1,ToastSeverity.info)))},C=H=>W=>{console.log("Video CanPlay",H,W&&W.type?W.type:null),H=="LK"?(t(0,c.playable=!0,c),t(0,c)):H=="SP"&&(t(1,u.playable=!0,u),t(1,u),u.videoElem.play().catch(X=>{console.log("Video cannot play",X),showToastMessage("Click this message to play or try reloading the page",5e3,!1,ToastSeverity.warning,()=>u.videoElem.play()),w(H)(null)})),S()},w=H=>W=>{console.log("Video CantPlay",H,W&&W.type?W.type:null,W),H=="LK"?(t(0,c.playable=!1,c),t(0,c)):H=="SP"&&(t(1,u.playable=!1,u),t(1,u)),S()};let O,I;onMount(()=>{O=frontendConnMngr.livekitConnection.remoteVideoTracks.subscribe(H=>{const W=H.values().next().value;c.stream&&c.stream.detach&&(console.log("Video detach stream lk",Object.assign({},c.stream),Object.assign({},W)),W.detach(c.videoElem)),W?(c.streamId==W.mediaStreamID&&console.warn("VideoPlayer: LK: repeat stream ID!",W.mediaStreamID),W.attach(c.videoElem),t(0,c.streamId=W.mediaStreamID,c),t(0,c.stream=W,c),W.streamState==Track.StreamState.Active&&t(0,c.playable=!0,c)):(t(0,c.playable=!1,c),t(0,c.streamId=null,c),t(0,c.stream=null,c),S())}),I=frontendConnMngr.simplepeerConnection.remoteVideoStreams.subscribe(H=>{const W=H.values().next().value;W?(u.streamId==W.id&&console.warn("VideoPlayer: SP: repeat stream ID!",W.id),t(1,u.videoElem.srcObject=W,u),t(1,u.streamId=W.id,u),t(1,u.stream=W,u),W.active&&t(1,u.playable=!0,u)):(t(1,u.playable=!1,u),t(1,u.streamId=null,u),t(1,u.stream=null,u),S())})}),onDestroy(()=>{O(),I()});const N=()=>{t(4,_=!0),frontendConnMngr.toggleSimplePeerConnection()},P=()=>t(3,m=!0),B=()=>t(3,m=!1);function x(H){binding_callbacks[H?"unshift":"push"](()=>{c.videoElem=H,t(0,c)})}const F=()=>t(3,m=!0),k=()=>t(3,m=!1);function J(H){binding_callbacks[H?"unshift":"push"](()=>{u.videoElem=H,t(1,u)})}function z(H){binding_callbacks[H?"unshift":"push"](()=>{d=H,t(2,d)})}return[c,u,d,m,_,s,a,b,C,w,N,P,B,x,F,k,J,z]}class VideoPlayer extends SvelteComponent{constructor(e){super(),init(this,e,instance$n,create_fragment$n,safe_not_equal,{})}}const bgvariants=["bg-green-900","bg-yellow-900","bg-red-900","bg-blue-900","bg-purple-900","bg-indigo-900","bg-gray-900","bg-orange-900"],bordervariants=["border-green-700","border-yellow-700","border-red-700","border-blue-700","border-purple-700","border-indigo-700","border-gray-700","border-orange-700"];let instanceCounter=0;const getColors=()=>{const n=bgvariants[instanceCounter],e=bordervariants[instanceCounter];return instanceCounter=(instanceCounter+1)%bgvariants.length,{bg:n,border:e}};function get_each_context$3(n,e,t){const s=n.slice();return s[10]=e[t],s}function create_default_slot$2(n){let e,t=n[5](n[0])+"",s,a,c,u;return{c(){e=svg_element("tspan"),s=text(t),a=space(),c=svg_element("tspan"),u=text(n[1]),this.h()},l(d){e=claim_svg_element(d,"tspan",{x:!0,dy:!0});var m=children(e);s=claim_text(m,t),m.forEach(detach),a=claim_space(d),c=claim_svg_element(d,"tspan",{x:!0,dy:!0,"font-weight":!0});var _=children(c);u=claim_text(_,n[1]),_.forEach(detach),this.h()},h(){attr(e,"x","50%"),attr(e,"dy","-0.5em"),attr(c,"x","50%"),attr(c,"dy","1em"),attr(c,"font-weight","normal")},m(d,m){insert_hydration(d,e,m),append_hydration(e,s),insert_hydration(d,a,m),insert_hydration(d,c,m),append_hydration(c,u)},p(d,m){m&1&&t!==(t=d[5](d[0])+"")&&set_data(s,t),m&2&&set_data(u,d[1])},d(d){d&&(detach(e),detach(a),detach(c))}}}function create_each_block$3(n){let e,t,s=n[10]+"",a;return{c(){e=svg_element("svg"),t=svg_element("text"),a=text(s),this.h()},l(c){e=claim_svg_element(c,"svg",{class:!0,viewBox:!0});var u=children(e);t=claim_svg_element(u,"text",{x:!0,y:!0,"text-anchor":!0,"font-weight":!0,"dominant-baseline":!0,"font-size":!0,class:!0});var d=children(t);a=claim_text(d,s),d.forEach(detach),u.forEach(detach),this.h()},h(){attr(t,"x","50%"),attr(t,"y","50%"),attr(t,"text-anchor","middle"),attr(t,"font-weight","bold"),attr(t,"dominant-baseline","middle"),attr(t,"font-size","32"),attr(t,"class","fill-token"),attr(e,"class","w-full max-h-10 mt-2"),attr(e,"viewBox","0 0 175 30")},m(c,u){insert_hydration(c,e,u),append_hydration(e,t),append_hydration(t,a)},p(c,u){u&8&&s!==(s=c[10]+"")&&set_data(a,s)},d(c){c&&detach(e)}}}function create_fragment$m(n){let e,t,s,a;t=new ProgressRadial({props:{value:n[2],strokeLinecap:"round",font:126,width:"w-full",class:"mb-4",$$slots:{default:[create_default_slot$2]},$$scope:{ctx:n}}});let c=ensure_array_like(n[3]),u=[];for(let d=0;d<c.length;d+=1)u[d]=create_each_block$3(get_each_context$3(n,c,d));return{c(){e=element("div"),create_component(t.$$.fragment),s=space();for(let d=0;d<u.length;d+=1)u[d].c();this.h()},l(d){e=claim_element(d,"DIV",{class:!0});var m=children(e);claim_component(t.$$.fragment,m),s=claim_space(m);for(let _=0;_<u.length;_+=1)u[_].l(m);m.forEach(detach),this.h()},h(){attr(e,"class","border-2 shadow-md rounded-md p-4 "+n[4].bg+" "+n[4].border)},m(d,m){insert_hydration(d,e,m),mount_component(t,e,null),append_hydration(e,s);for(let _=0;_<u.length;_+=1)u[_]&&u[_].m(e,null);a=!0},p(d,[m]){const _={};if(m&4&&(_.value=d[2]),m&8195&&(_.$$scope={dirty:m,ctx:d}),t.$set(_),m&8){c=ensure_array_like(d[3]);let b;for(b=0;b<c.length;b+=1){const S=get_each_context$3(d,c,b);u[b]?u[b].p(S,m):(u[b]=create_each_block$3(S),u[b].c(),u[b].m(e,null))}for(;b<u.length;b+=1)u[b].d(1);u.length=c.length}},i(d){a||(transition_in(t.$$.fragment,d),a=!0)},o(d){transition_out(t.$$.fragment,d),a=!1},d(d){d&&detach(e),destroy_component(t),destroy_each(u,d)}}}function instance$m(n,e,t){let s,a,c,{value:u=2.02302}=e,{min:d=0}=e,{max:m=100}=e,{unit:_="%"}=e,{name:b=""}=e;const S=getColors(),C=w=>Number.isNaN(w)||w==1/0?"":w==-1/0?"-":w<9999?String(w).substring(0,4):w.toExponential(0);return n.$$set=w=>{"value"in w&&t(0,u=w.value),"min"in w&&t(6,d=w.min),"max"in w&&t(7,m=w.max),"unit"in w&&t(1,_=w.unit),"name"in w&&t(8,b=w.name)},n.$$.update=()=>{n.$$.dirty&256&&t(3,s=b.split(" ")),n.$$.dirty&1&&t(9,a=!u&&u!==0||Number.isNaN(u)?0:u),n.$$.dirty&704&&t(2,c=Math.max(Math.round((a-d)/(m-d)*100),0))},[u,_,c,s,S,C,d,m,b,a]}class CircleStatIndicator extends SvelteComponent{constructor(e){super(),init(this,e,instance$m,create_fragment$m,safe_not_equal,{value:0,min:6,max:7,unit:1,name:8})}}function create_fragment$l(n){let e,t,s,a,c=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[3]},{viewBox:"0 0 24 24"}],u={};for(let d=0;d<c.length;d+=1)u=assign$1(u,c[d]);return{c(){e=svg_element("svg"),t=new HtmlTagHydration(!0),this.h()},l(d){e=claim_svg_element(d,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var m=children(e);t=claim_html_tag(m,!0),m.forEach(detach),this.h()},h(){t.a=null,set_svg_attributes(e,u)},m(d,m){insert_hydration(d,e,m),t.m(n[4],e),s||(a=[listen(e,"click",n[7]),listen(e,"keydown",n[8]),listen(e,"keyup",n[9]),listen(e,"focus",n[10]),listen(e,"blur",n[11]),listen(e,"mouseenter",n[12]),listen(e,"mouseleave",n[13]),listen(e,"mouseover",n[14]),listen(e,"mouseout",n[15])],s=!0)},p(d,[m]){m&16&&t.p(d[4]),set_svg_attributes(e,u=get_spread_update(c,[{xmlns:"http://www.w3.org/2000/svg"},m&32&&d[5],m&2&&{role:d[1]},m&1&&{width:d[0]},m&1&&{height:d[0]},m&4&&{fill:d[2]},m&8&&{"aria-label":d[3]},{viewBox:"0 0 24 24"}]))},i:noop$3,o:noop$3,d(d){d&&detach(e),s=!1,run_all(a)}}}let svgfilled$e='<path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>',svgoutlined$e='<path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/>',svground$e='<path d="M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59 7.11 5.7A.996.996 0 1 0 5.7 7.11L10.59 12 5.7 16.89a.996.996 0 1 0 1.41 1.41L12 13.41l4.89 4.89a.996.996 0 1 0 1.41-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z"/>',svgsharp$e='<path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/>',svgtwotone$e='<path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/>';function instance$l(n,e,t){const s=["size","role","color","variation","ariaLabel"];let a=compute_rest_props(e,s);const c=getContext("iconCtx")??{};let{size:u=c.size||"24"}=e,{role:d=c.role||"img"}=e,{color:m=c.color||"currentColor"}=e,{variation:_=c.variation||"outlined"}=e,b;switch(_){case"filled":b=svgfilled$e;break;case"outlined":b=svgoutlined$e;break;case"round":b=svground$e;break;case"sharp":b=svgsharp$e;break;case"two-tone":b=svgtwotone$e;break;default:b=svgoutlined$e}let{ariaLabel:S="close"}=e;function C(k){bubble.call(this,n,k)}function w(k){bubble.call(this,n,k)}function O(k){bubble.call(this,n,k)}function I(k){bubble.call(this,n,k)}function N(k){bubble.call(this,n,k)}function P(k){bubble.call(this,n,k)}function B(k){bubble.call(this,n,k)}function x(k){bubble.call(this,n,k)}function F(k){bubble.call(this,n,k)}return n.$$set=k=>{e=assign$1(assign$1({},e),exclude_internal_props(k)),t(5,a=compute_rest_props(e,s)),"size"in k&&t(0,u=k.size),"role"in k&&t(1,d=k.role),"color"in k&&t(2,m=k.color),"variation"in k&&t(6,_=k.variation),"ariaLabel"in k&&t(3,S=k.ariaLabel)},[u,d,m,S,b,a,_,C,w,O,I,N,P,B,x,F]}class Close extends SvelteComponent{constructor(e){super(),init(this,e,instance$l,create_fragment$l,safe_not_equal,{size:0,role:1,color:2,variation:6,ariaLabel:3})}}function create_fragment$k(n){let e,t,s,a,c=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[3]},{viewBox:"0 0 24 24"}],u={};for(let d=0;d<c.length;d+=1)u=assign$1(u,c[d]);return{c(){e=svg_element("svg"),t=new HtmlTagHydration(!0),this.h()},l(d){e=claim_svg_element(d,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var m=children(e);t=claim_html_tag(m,!0),m.forEach(detach),this.h()},h(){t.a=null,set_svg_attributes(e,u)},m(d,m){insert_hydration(d,e,m),t.m(n[4],e),s||(a=[listen(e,"click",n[7]),listen(e,"keydown",n[8]),listen(e,"keyup",n[9]),listen(e,"focus",n[10]),listen(e,"blur",n[11]),listen(e,"mouseenter",n[12]),listen(e,"mouseleave",n[13]),listen(e,"mouseover",n[14]),listen(e,"mouseout",n[15])],s=!0)},p(d,[m]){m&16&&t.p(d[4]),set_svg_attributes(e,u=get_spread_update(c,[{xmlns:"http://www.w3.org/2000/svg"},m&32&&d[5],m&2&&{role:d[1]},m&1&&{width:d[0]},m&1&&{height:d[0]},m&4&&{fill:d[2]},m&8&&{"aria-label":d[3]},{viewBox:"0 0 24 24"}]))},i:noop$3,o:noop$3,d(d){d&&detach(e),s=!1,run_all(a)}}}let svgfilled$d='<path d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>',svgoutlined$d='<path d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12l4.58-4.59z"/>',svground$d='<path d="M14.71 6.71a.996.996 0 0 0-1.41 0L8.71 11.3a.996.996 0 0 0 0 1.41l4.59 4.59a.996.996 0 1 0 1.41-1.41L10.83 12l3.88-3.88c.39-.39.38-1.03 0-1.41z"/>',svgsharp$d='<path d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12l4.58-4.59z"/>',svgtwotone$d='<path d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12l4.58-4.59z"/>';function instance$k(n,e,t){const s=["size","role","color","variation","ariaLabel"];let a=compute_rest_props(e,s);const c=getContext("iconCtx")??{};let{size:u=c.size||"24"}=e,{role:d=c.role||"img"}=e,{color:m=c.color||"currentColor"}=e,{variation:_=c.variation||"outlined"}=e,b;switch(_){case"filled":b=svgfilled$d;break;case"outlined":b=svgoutlined$d;break;case"round":b=svground$d;break;case"sharp":b=svgsharp$d;break;case"two-tone":b=svgtwotone$d;break;default:b=svgoutlined$d}let{ariaLabel:S="chevron left"}=e;function C(k){bubble.call(this,n,k)}function w(k){bubble.call(this,n,k)}function O(k){bubble.call(this,n,k)}function I(k){bubble.call(this,n,k)}function N(k){bubble.call(this,n,k)}function P(k){bubble.call(this,n,k)}function B(k){bubble.call(this,n,k)}function x(k){bubble.call(this,n,k)}function F(k){bubble.call(this,n,k)}return n.$$set=k=>{e=assign$1(assign$1({},e),exclude_internal_props(k)),t(5,a=compute_rest_props(e,s)),"size"in k&&t(0,u=k.size),"role"in k&&t(1,d=k.role),"color"in k&&t(2,m=k.color),"variation"in k&&t(6,_=k.variation),"ariaLabel"in k&&t(3,S=k.ariaLabel)},[u,d,m,S,b,a,_,C,w,O,I,N,P,B,x,F]}class Chevron_left extends SvelteComponent{constructor(e){super(),init(this,e,instance$k,create_fragment$k,safe_not_equal,{size:0,role:1,color:2,variation:6,ariaLabel:3})}}function create_fragment$j(n){let e,t,s,a,c=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[3]},{viewBox:"0 0 24 24"}],u={};for(let d=0;d<c.length;d+=1)u=assign$1(u,c[d]);return{c(){e=svg_element("svg"),t=new HtmlTagHydration(!0),this.h()},l(d){e=claim_svg_element(d,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var m=children(e);t=claim_html_tag(m,!0),m.forEach(detach),this.h()},h(){t.a=null,set_svg_attributes(e,u)},m(d,m){insert_hydration(d,e,m),t.m(n[4],e),s||(a=[listen(e,"click",n[7]),listen(e,"keydown",n[8]),listen(e,"keyup",n[9]),listen(e,"focus",n[10]),listen(e,"blur",n[11]),listen(e,"mouseenter",n[12]),listen(e,"mouseleave",n[13]),listen(e,"mouseover",n[14]),listen(e,"mouseout",n[15])],s=!0)},p(d,[m]){m&16&&t.p(d[4]),set_svg_attributes(e,u=get_spread_update(c,[{xmlns:"http://www.w3.org/2000/svg"},m&32&&d[5],m&2&&{role:d[1]},m&1&&{width:d[0]},m&1&&{height:d[0]},m&4&&{fill:d[2]},m&8&&{"aria-label":d[3]},{viewBox:"0 0 24 24"}]))},i:noop$3,o:noop$3,d(d){d&&detach(e),s=!1,run_all(a)}}}let svgfilled$c='<path d="M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>',svgoutlined$c='<path d="M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6-6-6z"/>',svground$c='<path d="M9.29 6.71a.996.996 0 0 0 0 1.41L13.17 12l-3.88 3.88a.996.996 0 1 0 1.41 1.41l4.59-4.59a.996.996 0 0 0 0-1.41L10.7 6.7c-.38-.38-1.02-.38-1.41.01z"/>',svgsharp$c='<path d="M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6-6-6z"/>',svgtwotone$c='<path d="M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6-6-6z"/>';function instance$j(n,e,t){const s=["size","role","color","variation","ariaLabel"];let a=compute_rest_props(e,s);const c=getContext("iconCtx")??{};let{size:u=c.size||"24"}=e,{role:d=c.role||"img"}=e,{color:m=c.color||"currentColor"}=e,{variation:_=c.variation||"outlined"}=e,b;switch(_){case"filled":b=svgfilled$c;break;case"outlined":b=svgoutlined$c;break;case"round":b=svground$c;break;case"sharp":b=svgsharp$c;break;case"two-tone":b=svgtwotone$c;break;default:b=svgoutlined$c}let{ariaLabel:S="chevron right"}=e;function C(k){bubble.call(this,n,k)}function w(k){bubble.call(this,n,k)}function O(k){bubble.call(this,n,k)}function I(k){bubble.call(this,n,k)}function N(k){bubble.call(this,n,k)}function P(k){bubble.call(this,n,k)}function B(k){bubble.call(this,n,k)}function x(k){bubble.call(this,n,k)}function F(k){bubble.call(this,n,k)}return n.$$set=k=>{e=assign$1(assign$1({},e),exclude_internal_props(k)),t(5,a=compute_rest_props(e,s)),"size"in k&&t(0,u=k.size),"role"in k&&t(1,d=k.role),"color"in k&&t(2,m=k.color),"variation"in k&&t(6,_=k.variation),"ariaLabel"in k&&t(3,S=k.ariaLabel)},[u,d,m,S,b,a,_,C,w,O,I,N,P,B,x,F]}class Chevron_right extends SvelteComponent{constructor(e){super(),init(this,e,instance$j,create_fragment$j,safe_not_equal,{size:0,role:1,color:2,variation:6,ariaLabel:3})}}function create_fragment$i(n){let e,t,s,a,c=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[3]},{viewBox:"0 0 24 24"}],u={};for(let d=0;d<c.length;d+=1)u=assign$1(u,c[d]);return{c(){e=svg_element("svg"),t=new HtmlTagHydration(!0),this.h()},l(d){e=claim_svg_element(d,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var m=children(e);t=claim_html_tag(m,!0),m.forEach(detach),this.h()},h(){t.a=null,set_svg_attributes(e,u)},m(d,m){insert_hydration(d,e,m),t.m(n[4],e),s||(a=[listen(e,"click",n[7]),listen(e,"keydown",n[8]),listen(e,"keyup",n[9]),listen(e,"focus",n[10]),listen(e,"blur",n[11]),listen(e,"mouseenter",n[12]),listen(e,"mouseleave",n[13]),listen(e,"mouseover",n[14]),listen(e,"mouseout",n[15])],s=!0)},p(d,[m]){m&16&&t.p(d[4]),set_svg_attributes(e,u=get_spread_update(c,[{xmlns:"http://www.w3.org/2000/svg"},m&32&&d[5],m&2&&{role:d[1]},m&1&&{width:d[0]},m&1&&{height:d[0]},m&4&&{fill:d[2]},m&8&&{"aria-label":d[3]},{viewBox:"0 0 24 24"}]))},i:noop$3,o:noop$3,d(d){d&&detach(e),s=!1,run_all(a)}}}let svgfilled$b='<path d="m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"/>',svgoutlined$b='<path d="m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14l-6-6z"/>',svground$b='<path d="M11.29 8.71 6.7 13.3a.996.996 0 1 0 1.41 1.41L12 10.83l3.88 3.88a.996.996 0 1 0 1.41-1.41L12.7 8.71a.996.996 0 0 0-1.41 0z"/>',svgsharp$b='<path d="m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14l-6-6z"/>',svgtwotone$b='<path d="m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14l-6-6z"/>';function instance$i(n,e,t){const s=["size","role","color","variation","ariaLabel"];let a=compute_rest_props(e,s);const c=getContext("iconCtx")??{};let{size:u=c.size||"24"}=e,{role:d=c.role||"img"}=e,{color:m=c.color||"currentColor"}=e,{variation:_=c.variation||"outlined"}=e,b;switch(_){case"filled":b=svgfilled$b;break;case"outlined":b=svgoutlined$b;break;case"round":b=svground$b;break;case"sharp":b=svgsharp$b;break;case"two-tone":b=svgtwotone$b;break;default:b=svgoutlined$b}let{ariaLabel:S="expand less"}=e;function C(k){bubble.call(this,n,k)}function w(k){bubble.call(this,n,k)}function O(k){bubble.call(this,n,k)}function I(k){bubble.call(this,n,k)}function N(k){bubble.call(this,n,k)}function P(k){bubble.call(this,n,k)}function B(k){bubble.call(this,n,k)}function x(k){bubble.call(this,n,k)}function F(k){bubble.call(this,n,k)}return n.$$set=k=>{e=assign$1(assign$1({},e),exclude_internal_props(k)),t(5,a=compute_rest_props(e,s)),"size"in k&&t(0,u=k.size),"role"in k&&t(1,d=k.role),"color"in k&&t(2,m=k.color),"variation"in k&&t(6,_=k.variation),"ariaLabel"in k&&t(3,S=k.ariaLabel)},[u,d,m,S,b,a,_,C,w,O,I,N,P,B,x,F]}class Expand_less extends SvelteComponent{constructor(e){super(),init(this,e,instance$i,create_fragment$i,safe_not_equal,{size:0,role:1,color:2,variation:6,ariaLabel:3})}}function create_fragment$h(n){let e,t,s,a,c=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[3]},{viewBox:"0 0 24 24"}],u={};for(let d=0;d<c.length;d+=1)u=assign$1(u,c[d]);return{c(){e=svg_element("svg"),t=new HtmlTagHydration(!0),this.h()},l(d){e=claim_svg_element(d,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var m=children(e);t=claim_html_tag(m,!0),m.forEach(detach),this.h()},h(){t.a=null,set_svg_attributes(e,u)},m(d,m){insert_hydration(d,e,m),t.m(n[4],e),s||(a=[listen(e,"click",n[7]),listen(e,"keydown",n[8]),listen(e,"keyup",n[9]),listen(e,"focus",n[10]),listen(e,"blur",n[11]),listen(e,"mouseenter",n[12]),listen(e,"mouseleave",n[13]),listen(e,"mouseover",n[14]),listen(e,"mouseout",n[15])],s=!0)},p(d,[m]){m&16&&t.p(d[4]),set_svg_attributes(e,u=get_spread_update(c,[{xmlns:"http://www.w3.org/2000/svg"},m&32&&d[5],m&2&&{role:d[1]},m&1&&{width:d[0]},m&1&&{height:d[0]},m&4&&{fill:d[2]},m&8&&{"aria-label":d[3]},{viewBox:"0 0 24 24"}]))},i:noop$3,o:noop$3,d(d){d&&detach(e),s=!1,run_all(a)}}}let svgfilled$a='<path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"/>',svgoutlined$a='<path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6-1.41-1.41z"/>',svground$a='<path d="M15.88 9.29 12 13.17 8.12 9.29a.996.996 0 1 0-1.41 1.41l4.59 4.59c.39.39 1.02.39 1.41 0l4.59-4.59a.996.996 0 0 0 0-1.41c-.39-.38-1.03-.39-1.42 0z"/>',svgsharp$a='<path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6-1.41-1.41z"/>',svgtwotone$a='<path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6-1.41-1.41z"/>';function instance$h(n,e,t){const s=["size","role","color","variation","ariaLabel"];let a=compute_rest_props(e,s);const c=getContext("iconCtx")??{};let{size:u=c.size||"24"}=e,{role:d=c.role||"img"}=e,{color:m=c.color||"currentColor"}=e,{variation:_=c.variation||"outlined"}=e,b;switch(_){case"filled":b=svgfilled$a;break;case"outlined":b=svgoutlined$a;break;case"round":b=svground$a;break;case"sharp":b=svgsharp$a;break;case"two-tone":b=svgtwotone$a;break;default:b=svgoutlined$a}let{ariaLabel:S="expand more"}=e;function C(k){bubble.call(this,n,k)}function w(k){bubble.call(this,n,k)}function O(k){bubble.call(this,n,k)}function I(k){bubble.call(this,n,k)}function N(k){bubble.call(this,n,k)}function P(k){bubble.call(this,n,k)}function B(k){bubble.call(this,n,k)}function x(k){bubble.call(this,n,k)}function F(k){bubble.call(this,n,k)}return n.$$set=k=>{e=assign$1(assign$1({},e),exclude_internal_props(k)),t(5,a=compute_rest_props(e,s)),"size"in k&&t(0,u=k.size),"role"in k&&t(1,d=k.role),"color"in k&&t(2,m=k.color),"variation"in k&&t(6,_=k.variation),"ariaLabel"in k&&t(3,S=k.ariaLabel)},[u,d,m,S,b,a,_,C,w,O,I,N,P,B,x,F]}class Expand_more extends SvelteComponent{constructor(e){super(),init(this,e,instance$h,create_fragment$h,safe_not_equal,{size:0,role:1,color:2,variation:6,ariaLabel:3})}}const fragmentShader=`precision mediump float;

uniform vec2 resolution;
uniform float yaw;
uniform float roll;
uniform float pitch;

const float pi = 3.1415927;
const float deg = pi / 180.0;

// Uncomment to see the lat-long grid for context
#define SHOW_LARGE_GRID
#define SHOW_SPHERE
#define SHOW_SPHERE_GRID

mat3 rotationAll(float yaw, float pitch, float roll) {
        /// yaw
    return mat3(

    cos(yaw), 0, -sin(yaw),
       0,     1,    0,
    sin(yaw), 0, cos(yaw))
/// pitch
     * mat3(
    1,     0,          0,
    0, cos(pitch), sin(pitch),
    0, -sin(pitch), cos(pitch))

 /// roll
     * mat3(
    cos(roll), sin(roll),  0,
    -sin(roll), cos(roll), 0,
    0,            0,       1);
}

void main() {
    vec2 uv = gl_FragCoord.xy / resolution;
    float scale = 1.0 / resolution.x; // min(resolution.x, resolution.y);
    vec4 color = vec4(0.0, 0.0, 0.0, 0.0);

	const float verticalFieldOfView = 50.0 * deg;
	const float insetSphereRadius = 0.5;


    // Inset sphere
    vec2 spherePoint = (uv - insetSphereRadius) / insetSphereRadius; //(uv - insetSphereRadius) / insetSphereRadius;
    if (length(spherePoint) <= 1.0) {
        vec3 c = vec3(0);
        vec2 s = clamp(spherePoint, vec2(-1.0), vec2(1.0));

        // Show convex sphere grid lines
        // vec3 dir = rotationAll(yaw, pitch,roll) * vec3(s.xy, sqrt(max(0.0, 1.0 - dot(s.xy, s.xy))));
        //             float latLongLine = (1.0 - pow(smoothstep(0.0, 0.09, min(abs(fract(atan(dir.y, length(dir.xz)) / (15.0 * deg)) - 0.5), abs(fract(atan(dir.x, dir.z) / (15.0 * deg)) - 0.5)) * 2.0), 10.0));
        //             c += latLongLine * vec3(-dir.y, dir.y, 1);

        // show concave sphere grid lines:
        vec3 dir = rotationAll(yaw, pitch,roll) * normalize(vec3(s.xy, 1.0));
        // vec3 dir = rotationAll(yaw, pitch,roll) * vec3(s.xy, sqrt(max(0.0, 1.0 - dot(s.xy, s.xy))));
        // float latLongLine = (1.0 - pow(smoothstep(0.0, 0.09, min(abs(fract(atan(dir.y, length(dir.xz)) / (15.0 * deg)) - 0.5), abs(fract(atan(dir.x, dir.z) / (15.0 * deg)) - 0.5)) * 2.0), 10.0));
        // float latLongLine = (1.0 - pow(smoothstep(0.0, 0.04, min(abs(fract(atan(dir.y, length(dir.xz)) / (15.0 * deg)) - 0.5), abs(fract(atan(dir.x, dir.z) / (15.0 * deg)) - 0.5)) * 2.0), 10.0));


        float latLine = (1.0 - pow(smoothstep(0.0, 0.4,abs(fract(atan(dir.y, length(dir.xz)) / (15.0 * deg)) - 0.5) * 2.0), 1.0));

        float longLine = (1.0 - pow(smoothstep(0.0, 0.4, abs(fract(atan(dir.x, dir.z) / (15.0 * deg)) - 0.5) * 2.0), 10.0));


        c += (max(latLine,longLine) * 0.8) * vec3(dir.y / 2.0,  dir.y / 2.0 + 0.5, dir.y / 2.0 + 1.0) *(dir.y / 2.0 + 0.7);
                // c += latLine * vec3(1.0 - abs(dir.y),  dir.y - 0.5, -dir.y + 0.5) *(dir.y / 2.0 + 0.5);
                // c += longLine *  vec3(dir.y / 2.0 + 0.5,  dir.y / 2.0 + 0.5, dir.y / 2.0 + 0.5) / 2.0;

        // Fade the inset sphere to antialias its border transition
        float fade = clamp((1.0 - length(spherePoint)) * 2.0, 0.0, 1.0);
        color.rgb = mix(vec3(0), c, fade);
        float fade2 = clamp((1.0 - length(spherePoint)) * 5.0, 0.0, 0.4);
        color.a = fade2;
    }

  gl_FragColor = color;
}
`;/* @license twgl.js 5.5.3 Copyright (c) 2015, Gregg Tavares All Rights Reserved.
Available via the MIT license.
see: http://github.com/greggman/twgl.js for details */const BYTE$2=5120,UNSIGNED_BYTE$3=5121,SHORT$2=5122,UNSIGNED_SHORT$3=5123,INT$3=5124,UNSIGNED_INT$3=5125,FLOAT$3=5126,UNSIGNED_SHORT_4_4_4_4$1=32819,UNSIGNED_SHORT_5_5_5_1$1=32820,UNSIGNED_SHORT_5_6_5$1=33635,HALF_FLOAT$1=5131,UNSIGNED_INT_2_10_10_10_REV$1=33640,UNSIGNED_INT_10F_11F_11F_REV$1=35899,UNSIGNED_INT_5_9_9_9_REV$1=35902,FLOAT_32_UNSIGNED_INT_24_8_REV$1=36269,UNSIGNED_INT_24_8$1=34042,glTypeToTypedArray={};{const n=glTypeToTypedArray;n[BYTE$2]=Int8Array,n[UNSIGNED_BYTE$3]=Uint8Array,n[SHORT$2]=Int16Array,n[UNSIGNED_SHORT$3]=Uint16Array,n[INT$3]=Int32Array,n[UNSIGNED_INT$3]=Uint32Array,n[FLOAT$3]=Float32Array,n[UNSIGNED_SHORT_4_4_4_4$1]=Uint16Array,n[UNSIGNED_SHORT_5_5_5_1$1]=Uint16Array,n[UNSIGNED_SHORT_5_6_5$1]=Uint16Array,n[HALF_FLOAT$1]=Uint16Array,n[UNSIGNED_INT_2_10_10_10_REV$1]=Uint32Array,n[UNSIGNED_INT_10F_11F_11F_REV$1]=Uint32Array,n[UNSIGNED_INT_5_9_9_9_REV$1]=Uint32Array,n[FLOAT_32_UNSIGNED_INT_24_8_REV$1]=Uint32Array,n[UNSIGNED_INT_24_8$1]=Uint32Array}function getGLTypeForTypedArray(n){if(n instanceof Int8Array)return BYTE$2;if(n instanceof Uint8Array||n instanceof Uint8ClampedArray)return UNSIGNED_BYTE$3;if(n instanceof Int16Array)return SHORT$2;if(n instanceof Uint16Array)return UNSIGNED_SHORT$3;if(n instanceof Int32Array)return INT$3;if(n instanceof Uint32Array)return UNSIGNED_INT$3;if(n instanceof Float32Array)return FLOAT$3;throw new Error("unsupported typed array type")}function getGLTypeForTypedArrayType(n){if(n===Int8Array)return BYTE$2;if(n===Uint8Array||n===Uint8ClampedArray)return UNSIGNED_BYTE$3;if(n===Int16Array)return SHORT$2;if(n===Uint16Array)return UNSIGNED_SHORT$3;if(n===Int32Array)return INT$3;if(n===Uint32Array)return UNSIGNED_INT$3;if(n===Float32Array)return FLOAT$3;throw new Error("unsupported typed array type")}function getTypedArrayTypeForGLType(n){const e=glTypeToTypedArray[n];if(!e)throw new Error("unknown gl type");return e}const isArrayBuffer$1=typeof SharedArrayBuffer<"u"?function n(e){return e&&e.buffer&&(e.buffer instanceof ArrayBuffer||e.buffer instanceof SharedArrayBuffer)}:function n(e){return e&&e.buffer&&e.buffer instanceof ArrayBuffer};function error$1(...n){console.error(...n)}const isTypeWeakMaps=new Map;function isType(n,e){if(!n||typeof n!="object")return!1;let t=isTypeWeakMaps.get(e);t||(t=new WeakMap,isTypeWeakMaps.set(e,t));let s=t.get(n);if(s===void 0){const a=Object.prototype.toString.call(n);s=a.substring(8,a.length-1)===e,t.set(n,s)}return s}function isBuffer(n,e){return typeof WebGLBuffer<"u"&&isType(e,"WebGLBuffer")}function isTexture(n,e){return typeof WebGLTexture<"u"&&isType(e,"WebGLTexture")}const STATIC_DRAW=35044,ARRAY_BUFFER$1=34962,ELEMENT_ARRAY_BUFFER$2=34963,BUFFER_SIZE=34660,BYTE$1=5120,UNSIGNED_BYTE$2=5121,SHORT$1=5122,UNSIGNED_SHORT$2=5123,INT$2=5124,UNSIGNED_INT$2=5125,FLOAT$2=5126,defaults$2={attribPrefix:""};function setBufferFromTypedArray(n,e,t,s,a){n.bindBuffer(e,t),n.bufferData(e,s,a||STATIC_DRAW)}function createBufferFromTypedArray(n,e,t,s){if(isBuffer(n,e))return e;t=t||ARRAY_BUFFER$1;const a=n.createBuffer();return setBufferFromTypedArray(n,t,a,e,s),a}function isIndices(n){return n==="indices"}function getNormalizationForTypedArrayType(n){return n===Int8Array||n===Uint8Array}function getArray$1(n){return n.length?n:n.data}const texcoordRE=/coord|texture/i,colorRE=/color|colour/i;function guessNumComponentsFromName(n,e){let t;if(texcoordRE.test(n)?t=2:colorRE.test(n)?t=4:t=3,e%t>0)throw new Error(`Can not guess numComponents for attribute '${n}'. Tried ${t} but ${e} values is not evenly divisible by ${t}. You should specify it.`);return t}function getNumComponents$1(n,e,t){return n.numComponents||n.size||guessNumComponentsFromName(e,t||getArray$1(n).length)}function makeTypedArray(n,e){if(isArrayBuffer$1(n))return n;if(isArrayBuffer$1(n.data))return n.data;Array.isArray(n)&&(n={data:n});let t=n.type?typedArrayTypeFromGLTypeOrTypedArrayCtor(n.type):void 0;return t||(isIndices(e)?t=Uint16Array:t=Float32Array),new t(n.data)}function glTypeFromGLTypeOrTypedArrayType(n){return typeof n=="number"?n:n?getGLTypeForTypedArrayType(n):FLOAT$2}function typedArrayTypeFromGLTypeOrTypedArrayCtor(n){return typeof n=="number"?getTypedArrayTypeForGLType(n):n||Float32Array}function attribBufferFromBuffer(n,e){return{buffer:e.buffer,numValues:2*3*4,type:glTypeFromGLTypeOrTypedArrayType(e.type),arrayType:typedArrayTypeFromGLTypeOrTypedArrayCtor(e.type)}}function attribBufferFromSize(n,e){const t=e.data||e,s=typedArrayTypeFromGLTypeOrTypedArrayCtor(e.type),a=t*s.BYTES_PER_ELEMENT,c=n.createBuffer();return n.bindBuffer(ARRAY_BUFFER$1,c),n.bufferData(ARRAY_BUFFER$1,a,e.drawType||STATIC_DRAW),{buffer:c,numValues:t,type:getGLTypeForTypedArrayType(s),arrayType:s}}function attribBufferFromArrayLike(n,e,t){const s=makeTypedArray(e,t);return{arrayType:s.constructor,buffer:createBufferFromTypedArray(n,s,void 0,e.drawType),type:getGLTypeForTypedArray(s),numValues:0}}function createAttribsFromArrays(n,e){const t={};return Object.keys(e).forEach(function(s){if(!isIndices(s)){const a=e[s],c=a.attrib||a.name||a.attribName||defaults$2.attribPrefix+s;if(a.value){if(!Array.isArray(a.value)&&!isArrayBuffer$1(a.value))throw new Error("array.value is not array or typedarray");t[c]={value:a.value}}else{let u;a.buffer&&a.buffer instanceof WebGLBuffer?u=attribBufferFromBuffer:typeof a=="number"||typeof a.data=="number"?u=attribBufferFromSize:u=attribBufferFromArrayLike;const{buffer:d,type:m,numValues:_,arrayType:b}=u(n,a,s),S=a.normalize!==void 0?a.normalize:getNormalizationForTypedArrayType(b),C=getNumComponents$1(a,s,_);t[c]={buffer:d,numComponents:C,type:m,normalize:S,stride:a.stride||0,offset:a.offset||0,divisor:a.divisor===void 0?void 0:a.divisor,drawType:a.drawType}}}}),n.bindBuffer(ARRAY_BUFFER$1,null),t}function getBytesPerValueForGLType(n,e){return e===BYTE$1||e===UNSIGNED_BYTE$2?1:e===SHORT$1||e===UNSIGNED_SHORT$2?2:e===INT$2||e===UNSIGNED_INT$2||e===FLOAT$2?4:0}const positionKeys=["position","positions","a_position"];function getNumElementsFromAttributes(n,e){let t,s;for(s=0;s<positionKeys.length&&(t=positionKeys[s],!(t in e||(t=defaults$2.attribPrefix+t,t in e)));++s);s===positionKeys.length&&(t=Object.keys(e)[0]);const a=e[t];if(!a.buffer)return 1;n.bindBuffer(ARRAY_BUFFER$1,a.buffer);const c=n.getBufferParameter(ARRAY_BUFFER$1,BUFFER_SIZE);n.bindBuffer(ARRAY_BUFFER$1,null);const u=getBytesPerValueForGLType(n,a.type),d=c/u,m=a.numComponents||a.size,_=d/m;if(_%1!==0)throw new Error(`numComponents ${m} not correct for length ${length}`);return _}function createBufferInfoFromArrays(n,e,t){const s=createAttribsFromArrays(n,e),a=Object.assign({},t||{});a.attribs=Object.assign({},t?t.attribs:{},s);const c=e.indices;if(c){const u=makeTypedArray(c,"indices");a.indices=createBufferFromTypedArray(n,u,ELEMENT_ARRAY_BUFFER$2),a.numElements=u.length,a.elementType=getGLTypeForTypedArray(u)}else a.numElements||(a.numElements=getNumElementsFromAttributes(n,a.attribs));return a}function isWebGL2(n){return!!n.texStorage2D}const glEnumToString=function(){const n={},e={};function t(s){const a=s.constructor.name;if(!n[a]){for(const c in s)if(typeof s[c]=="number"){const u=e[s[c]];e[s[c]]=u?`${u} | ${c}`:c}n[a]=!0}}return function(a,c){return t(a),e[c]||(typeof c=="number"?`0x${c.toString(16)}`:c)}}(),error=error$1;function getElementById(n){return typeof document<"u"&&document.getElementById?document.getElementById(n):null}const TEXTURE0=33984,ARRAY_BUFFER=34962,ELEMENT_ARRAY_BUFFER$1=34963,COMPILE_STATUS=35713,LINK_STATUS=35714,FRAGMENT_SHADER=35632,VERTEX_SHADER=35633,SEPARATE_ATTRIBS=35981,ACTIVE_UNIFORMS=35718,ACTIVE_ATTRIBUTES=35721,TRANSFORM_FEEDBACK_VARYINGS=35971,ACTIVE_UNIFORM_BLOCKS=35382,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398,UNIFORM_BLOCK_DATA_SIZE=35392,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395,FLOAT=5126,FLOAT_VEC2=35664,FLOAT_VEC3=35665,FLOAT_VEC4=35666,INT=5124,INT_VEC2=35667,INT_VEC3=35668,INT_VEC4=35669,BOOL=35670,BOOL_VEC2=35671,BOOL_VEC3=35672,BOOL_VEC4=35673,FLOAT_MAT2=35674,FLOAT_MAT3=35675,FLOAT_MAT4=35676,SAMPLER_2D=35678,SAMPLER_CUBE=35680,SAMPLER_3D=35679,SAMPLER_2D_SHADOW=35682,FLOAT_MAT2x3=35685,FLOAT_MAT2x4=35686,FLOAT_MAT3x2=35687,FLOAT_MAT3x4=35688,FLOAT_MAT4x2=35689,FLOAT_MAT4x3=35690,SAMPLER_2D_ARRAY=36289,SAMPLER_2D_ARRAY_SHADOW=36292,SAMPLER_CUBE_SHADOW=36293,UNSIGNED_INT=5125,UNSIGNED_INT_VEC2=36294,UNSIGNED_INT_VEC3=36295,UNSIGNED_INT_VEC4=36296,INT_SAMPLER_2D=36298,INT_SAMPLER_3D=36299,INT_SAMPLER_CUBE=36300,INT_SAMPLER_2D_ARRAY=36303,UNSIGNED_INT_SAMPLER_2D=36306,UNSIGNED_INT_SAMPLER_3D=36307,UNSIGNED_INT_SAMPLER_CUBE=36308,UNSIGNED_INT_SAMPLER_2D_ARRAY=36311,TEXTURE_2D$1=3553,TEXTURE_CUBE_MAP=34067,TEXTURE_3D=32879,TEXTURE_2D_ARRAY=35866,typeMap={};function getBindPointForSamplerType(n,e){return typeMap[e].bindPoint}function floatSetter(n,e){return function(t){n.uniform1f(e,t)}}function floatArraySetter(n,e){return function(t){n.uniform1fv(e,t)}}function floatVec2Setter(n,e){return function(t){n.uniform2fv(e,t)}}function floatVec3Setter(n,e){return function(t){n.uniform3fv(e,t)}}function floatVec4Setter(n,e){return function(t){n.uniform4fv(e,t)}}function intSetter(n,e){return function(t){n.uniform1i(e,t)}}function intArraySetter(n,e){return function(t){n.uniform1iv(e,t)}}function intVec2Setter(n,e){return function(t){n.uniform2iv(e,t)}}function intVec3Setter(n,e){return function(t){n.uniform3iv(e,t)}}function intVec4Setter(n,e){return function(t){n.uniform4iv(e,t)}}function uintSetter(n,e){return function(t){n.uniform1ui(e,t)}}function uintArraySetter(n,e){return function(t){n.uniform1uiv(e,t)}}function uintVec2Setter(n,e){return function(t){n.uniform2uiv(e,t)}}function uintVec3Setter(n,e){return function(t){n.uniform3uiv(e,t)}}function uintVec4Setter(n,e){return function(t){n.uniform4uiv(e,t)}}function floatMat2Setter(n,e){return function(t){n.uniformMatrix2fv(e,!1,t)}}function floatMat3Setter(n,e){return function(t){n.uniformMatrix3fv(e,!1,t)}}function floatMat4Setter(n,e){return function(t){n.uniformMatrix4fv(e,!1,t)}}function floatMat23Setter(n,e){return function(t){n.uniformMatrix2x3fv(e,!1,t)}}function floatMat32Setter(n,e){return function(t){n.uniformMatrix3x2fv(e,!1,t)}}function floatMat24Setter(n,e){return function(t){n.uniformMatrix2x4fv(e,!1,t)}}function floatMat42Setter(n,e){return function(t){n.uniformMatrix4x2fv(e,!1,t)}}function floatMat34Setter(n,e){return function(t){n.uniformMatrix3x4fv(e,!1,t)}}function floatMat43Setter(n,e){return function(t){n.uniformMatrix4x3fv(e,!1,t)}}function samplerSetter(n,e,t,s){const a=getBindPointForSamplerType(n,e);return isWebGL2(n)?function(c){let u,d;!c||isTexture(n,c)?(u=c,d=null):(u=c.texture,d=c.sampler),n.uniform1i(s,t),n.activeTexture(TEXTURE0+t),n.bindTexture(a,u),n.bindSampler(t,d)}:function(c){n.uniform1i(s,t),n.activeTexture(TEXTURE0+t),n.bindTexture(a,c)}}function samplerArraySetter(n,e,t,s,a){const c=getBindPointForSamplerType(n,e),u=new Int32Array(a);for(let d=0;d<a;++d)u[d]=t+d;return isWebGL2(n)?function(d){n.uniform1iv(s,u),d.forEach(function(m,_){n.activeTexture(TEXTURE0+u[_]);let b,S;!m||isTexture(n,m)?(b=m,S=null):(b=m.texture,S=m.sampler),n.bindSampler(t,S),n.bindTexture(c,b)})}:function(d){n.uniform1iv(s,u),d.forEach(function(m,_){n.activeTexture(TEXTURE0+u[_]),n.bindTexture(c,m)})}}typeMap[FLOAT]={Type:Float32Array,size:4,setter:floatSetter,arraySetter:floatArraySetter};typeMap[FLOAT_VEC2]={Type:Float32Array,size:8,setter:floatVec2Setter,cols:2};typeMap[FLOAT_VEC3]={Type:Float32Array,size:12,setter:floatVec3Setter,cols:3};typeMap[FLOAT_VEC4]={Type:Float32Array,size:16,setter:floatVec4Setter,cols:4};typeMap[INT]={Type:Int32Array,size:4,setter:intSetter,arraySetter:intArraySetter};typeMap[INT_VEC2]={Type:Int32Array,size:8,setter:intVec2Setter,cols:2};typeMap[INT_VEC3]={Type:Int32Array,size:12,setter:intVec3Setter,cols:3};typeMap[INT_VEC4]={Type:Int32Array,size:16,setter:intVec4Setter,cols:4};typeMap[UNSIGNED_INT]={Type:Uint32Array,size:4,setter:uintSetter,arraySetter:uintArraySetter};typeMap[UNSIGNED_INT_VEC2]={Type:Uint32Array,size:8,setter:uintVec2Setter,cols:2};typeMap[UNSIGNED_INT_VEC3]={Type:Uint32Array,size:12,setter:uintVec3Setter,cols:3};typeMap[UNSIGNED_INT_VEC4]={Type:Uint32Array,size:16,setter:uintVec4Setter,cols:4};typeMap[BOOL]={Type:Uint32Array,size:4,setter:intSetter,arraySetter:intArraySetter};typeMap[BOOL_VEC2]={Type:Uint32Array,size:8,setter:intVec2Setter,cols:2};typeMap[BOOL_VEC3]={Type:Uint32Array,size:12,setter:intVec3Setter,cols:3};typeMap[BOOL_VEC4]={Type:Uint32Array,size:16,setter:intVec4Setter,cols:4};typeMap[FLOAT_MAT2]={Type:Float32Array,size:32,setter:floatMat2Setter,rows:2,cols:2};typeMap[FLOAT_MAT3]={Type:Float32Array,size:48,setter:floatMat3Setter,rows:3,cols:3};typeMap[FLOAT_MAT4]={Type:Float32Array,size:64,setter:floatMat4Setter,rows:4,cols:4};typeMap[FLOAT_MAT2x3]={Type:Float32Array,size:32,setter:floatMat23Setter,rows:2,cols:3};typeMap[FLOAT_MAT2x4]={Type:Float32Array,size:32,setter:floatMat24Setter,rows:2,cols:4};typeMap[FLOAT_MAT3x2]={Type:Float32Array,size:48,setter:floatMat32Setter,rows:3,cols:2};typeMap[FLOAT_MAT3x4]={Type:Float32Array,size:48,setter:floatMat34Setter,rows:3,cols:4};typeMap[FLOAT_MAT4x2]={Type:Float32Array,size:64,setter:floatMat42Setter,rows:4,cols:2};typeMap[FLOAT_MAT4x3]={Type:Float32Array,size:64,setter:floatMat43Setter,rows:4,cols:3};typeMap[SAMPLER_2D]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_2D$1};typeMap[SAMPLER_CUBE]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_CUBE_MAP};typeMap[SAMPLER_3D]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_3D};typeMap[SAMPLER_2D_SHADOW]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_2D$1};typeMap[SAMPLER_2D_ARRAY]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_2D_ARRAY};typeMap[SAMPLER_2D_ARRAY_SHADOW]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_2D_ARRAY};typeMap[SAMPLER_CUBE_SHADOW]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_CUBE_MAP};typeMap[INT_SAMPLER_2D]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_2D$1};typeMap[INT_SAMPLER_3D]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_3D};typeMap[INT_SAMPLER_CUBE]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_CUBE_MAP};typeMap[INT_SAMPLER_2D_ARRAY]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_2D_ARRAY};typeMap[UNSIGNED_INT_SAMPLER_2D]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_2D$1};typeMap[UNSIGNED_INT_SAMPLER_3D]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_3D};typeMap[UNSIGNED_INT_SAMPLER_CUBE]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_CUBE_MAP};typeMap[UNSIGNED_INT_SAMPLER_2D_ARRAY]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_2D_ARRAY};function floatAttribSetter(n,e){return function(t){if(t.value)switch(n.disableVertexAttribArray(e),t.value.length){case 4:n.vertexAttrib4fv(e,t.value);break;case 3:n.vertexAttrib3fv(e,t.value);break;case 2:n.vertexAttrib2fv(e,t.value);break;case 1:n.vertexAttrib1fv(e,t.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else n.bindBuffer(ARRAY_BUFFER,t.buffer),n.enableVertexAttribArray(e),n.vertexAttribPointer(e,t.numComponents||t.size,t.type||FLOAT,t.normalize||!1,t.stride||0,t.offset||0),n.vertexAttribDivisor&&n.vertexAttribDivisor(e,t.divisor||0)}}function intAttribSetter(n,e){return function(t){if(t.value)if(n.disableVertexAttribArray(e),t.value.length===4)n.vertexAttrib4iv(e,t.value);else throw new Error("The length of an integer constant value must be 4!");else n.bindBuffer(ARRAY_BUFFER,t.buffer),n.enableVertexAttribArray(e),n.vertexAttribIPointer(e,t.numComponents||t.size,t.type||INT,t.stride||0,t.offset||0),n.vertexAttribDivisor&&n.vertexAttribDivisor(e,t.divisor||0)}}function uintAttribSetter(n,e){return function(t){if(t.value)if(n.disableVertexAttribArray(e),t.value.length===4)n.vertexAttrib4uiv(e,t.value);else throw new Error("The length of an unsigned integer constant value must be 4!");else n.bindBuffer(ARRAY_BUFFER,t.buffer),n.enableVertexAttribArray(e),n.vertexAttribIPointer(e,t.numComponents||t.size,t.type||UNSIGNED_INT,t.stride||0,t.offset||0),n.vertexAttribDivisor&&n.vertexAttribDivisor(e,t.divisor||0)}}function matAttribSetter(n,e,t){const s=t.size,a=t.count;return function(c){n.bindBuffer(ARRAY_BUFFER,c.buffer);const u=c.size||c.numComponents||s,d=u/a,m=c.type||FLOAT,b=typeMap[m].size*u,S=c.normalize||!1,C=c.offset||0,w=b/a;for(let O=0;O<a;++O)n.enableVertexAttribArray(e+O),n.vertexAttribPointer(e+O,d,m,S,b,C+w*O),n.vertexAttribDivisor&&n.vertexAttribDivisor(e+O,c.divisor||0)}}const attrTypeMap={};attrTypeMap[FLOAT]={size:4,setter:floatAttribSetter};attrTypeMap[FLOAT_VEC2]={size:8,setter:floatAttribSetter};attrTypeMap[FLOAT_VEC3]={size:12,setter:floatAttribSetter};attrTypeMap[FLOAT_VEC4]={size:16,setter:floatAttribSetter};attrTypeMap[INT]={size:4,setter:intAttribSetter};attrTypeMap[INT_VEC2]={size:8,setter:intAttribSetter};attrTypeMap[INT_VEC3]={size:12,setter:intAttribSetter};attrTypeMap[INT_VEC4]={size:16,setter:intAttribSetter};attrTypeMap[UNSIGNED_INT]={size:4,setter:uintAttribSetter};attrTypeMap[UNSIGNED_INT_VEC2]={size:8,setter:uintAttribSetter};attrTypeMap[UNSIGNED_INT_VEC3]={size:12,setter:uintAttribSetter};attrTypeMap[UNSIGNED_INT_VEC4]={size:16,setter:uintAttribSetter};attrTypeMap[BOOL]={size:4,setter:intAttribSetter};attrTypeMap[BOOL_VEC2]={size:8,setter:intAttribSetter};attrTypeMap[BOOL_VEC3]={size:12,setter:intAttribSetter};attrTypeMap[BOOL_VEC4]={size:16,setter:intAttribSetter};attrTypeMap[FLOAT_MAT2]={size:4,setter:matAttribSetter,count:2};attrTypeMap[FLOAT_MAT3]={size:9,setter:matAttribSetter,count:3};attrTypeMap[FLOAT_MAT4]={size:16,setter:matAttribSetter,count:4};const errorRE=/ERROR:\s*\d+:(\d+)/gi;function addLineNumbersWithError(n,e="",t=0){const s=[...e.matchAll(errorRE)],a=new Map(s.map((c,u)=>{const d=parseInt(c[1]),m=s[u+1],_=m?m.index:e.length,b=e.substring(c.index,_);return[d-1,b]}));return n.split(`
`).map((c,u)=>{const d=a.get(u);return`${u+1+t}: ${c}${d?`

^^^ ${d}`:""}`}).join(`
`)}const spaceRE=/^[ \t]*\n/;function prepShaderSource(n){let e=0;return spaceRE.test(n)&&(e=1,n=n.replace(spaceRE,"")),{lineOffset:e,shaderSource:n}}function reportError(n,e){return n.errorCallback(e),n.callback&&setTimeout(()=>{n.callback(`${e}
${n.errors.join(`
`)}`)}),null}function checkShaderStatus(n,e,t,s){if(s=s||error,!n.getShaderParameter(t,COMPILE_STATUS)){const c=n.getShaderInfoLog(t),{lineOffset:u,shaderSource:d}=prepShaderSource(n.getShaderSource(t)),m=`${addLineNumbersWithError(d,c,u)}
Error compiling ${glEnumToString(n,e)}: ${c}`;return s(m),m}return""}function getProgramOptions(n,e,t){let s,a,c;if(typeof e=="function"&&(t=e,e=void 0),typeof n=="function")t=n,n=void 0;else if(n&&!Array.isArray(n)){const _=n;t=_.errorCallback,n=_.attribLocations,s=_.transformFeedbackVaryings,a=_.transformFeedbackMode,c=_.callback}const u=t||error,d=[],m={errorCallback(_,...b){d.push(_),u(_,...b)},transformFeedbackVaryings:s,transformFeedbackMode:a,callback:c,errors:d};{let _={};Array.isArray(n)?n.forEach(function(b,S){_[b]=e?e[S]:S}):_=n||{},m.attribLocations=_}return m}const defaultShaderType=["VERTEX_SHADER","FRAGMENT_SHADER"];function getShaderTypeFromScriptType(n,e){if(e.indexOf("frag")>=0)return FRAGMENT_SHADER;if(e.indexOf("vert")>=0)return VERTEX_SHADER}function deleteProgramAndShaders(n,e,t){const s=n.getAttachedShaders(e);for(const a of s)t.has(a)&&n.deleteShader(a);n.deleteProgram(e)}const wait=(n=0)=>new Promise(e=>setTimeout(e,n));function createProgramNoCheck(n,e,t){const s=n.createProgram(),{attribLocations:a,transformFeedbackVaryings:c,transformFeedbackMode:u}=getProgramOptions(t);for(let d=0;d<e.length;++d){let m=e[d];if(typeof m=="string"){const _=getElementById(m),b=_?_.text:m;let S=n[defaultShaderType[d]];_&&_.type&&(S=getShaderTypeFromScriptType(n,_.type)||S),m=n.createShader(S),n.shaderSource(m,prepShaderSource(b).shaderSource),n.compileShader(m),n.attachShader(s,m)}}Object.entries(a).forEach(([d,m])=>n.bindAttribLocation(s,m,d));{let d=c;d&&(d.attribs&&(d=d.attribs),Array.isArray(d)||(d=Object.keys(d)),n.transformFeedbackVaryings(s,d,u||SEPARATE_ATTRIBS))}return n.linkProgram(s),s}function createProgram(n,e,t,s,a){const c=getProgramOptions(t,s,a),u=new Set(e),d=createProgramNoCheck(n,e,c);function m(_,b){const S=getProgramErrors(_,b,c.errorCallback);return S&&deleteProgramAndShaders(_,b,u),S}if(c.callback){waitForProgramLinkCompletionAsync(n,d).then(()=>{const _=m(n,d);c.callback(_,_?void 0:d)});return}return m(n,d)?void 0:d}async function waitForProgramLinkCompletionAsync(n,e){const t=n.getExtension("KHR_parallel_shader_compile"),s=t?(c,u)=>c.getProgramParameter(u,t.COMPLETION_STATUS_KHR):()=>!0;let a=0;do await wait(a),a=1e3/60;while(!s(n,e))}function getProgramErrors(n,e,t){if(t=t||error,!n.getProgramParameter(e,LINK_STATUS)){const a=n.getProgramInfoLog(e);t(`Error in program linking: ${a}`);const u=n.getAttachedShaders(e).map(d=>checkShaderStatus(n,n.getShaderParameter(d,n.SHADER_TYPE),d,t));return`${a}
${u.filter(d=>d).join(`
`)}`}}function createProgramFromSources(n,e,t,s,a){return createProgram(n,e,t,s,a)}function isBuiltIn(n){const e=n.name;return e.startsWith("gl_")||e.startsWith("webgl_")}const tokenRE=/(\.|\[|]|\w+)/g,isDigit=n=>n>="0"&&n<="9";function addSetterToUniformTree(n,e,t,s){const a=n.split(tokenRE).filter(d=>d!=="");let c=0,u="";for(;;){const d=a[c++];u+=d;const m=isDigit(d[0]),_=m?parseInt(d):d;if(m&&(u+=a[c++]),c===a.length){t[_]=e;break}else{const S=a[c++],C=S==="[",w=t[_]||(C?[]:{});t[_]=w,t=w,s[u]=s[u]||function(O){return function(I){setUniformTree(O,I)}}(w),u+=S}}}function createUniformSetters(n,e){let t=0;function s(d,m,_){const b=m.name.endsWith("[0]"),S=m.type,C=typeMap[S];if(!C)throw new Error(`unknown type: 0x${S.toString(16)}`);let w;if(C.bindPoint){const O=t;t+=m.size,b?w=C.arraySetter(n,S,O,_,m.size):w=C.setter(n,S,O,_,m.size)}else C.arraySetter&&b?w=C.arraySetter(n,_):w=C.setter(n,_);return w.location=_,w}const a={},c={},u=n.getProgramParameter(e,ACTIVE_UNIFORMS);for(let d=0;d<u;++d){const m=n.getActiveUniform(e,d);if(isBuiltIn(m))continue;let _=m.name;_.endsWith("[0]")&&(_=_.substr(0,_.length-3));const b=n.getUniformLocation(e,m.name);if(b){const S=s(e,m,b);a[_]=S,addSetterToUniformTree(_,S,c,a)}}return a}function createTransformFeedbackInfo(n,e){const t={},s=n.getProgramParameter(e,TRANSFORM_FEEDBACK_VARYINGS);for(let a=0;a<s;++a){const c=n.getTransformFeedbackVarying(e,a);t[c.name]={index:a,type:c.type,size:c.size}}return t}function createUniformBlockSpecFromProgram(n,e){const t=n.getProgramParameter(e,ACTIVE_UNIFORMS),s=[],a=[];for(let d=0;d<t;++d){a.push(d),s.push({});const m=n.getActiveUniform(e,d);s[d].name=m.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach(function(d){const m=d[0],_=d[1];n.getActiveUniforms(e,a,n[m]).forEach(function(b,S){s[S][_]=b})});const c={},u=n.getProgramParameter(e,ACTIVE_UNIFORM_BLOCKS);for(let d=0;d<u;++d){const m=n.getActiveUniformBlockName(e,d),_={index:n.getUniformBlockIndex(e,m),usedByVertexShader:n.getActiveUniformBlockParameter(e,d,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER),usedByFragmentShader:n.getActiveUniformBlockParameter(e,d,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER),size:n.getActiveUniformBlockParameter(e,d,UNIFORM_BLOCK_DATA_SIZE),uniformIndices:n.getActiveUniformBlockParameter(e,d,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES)};_.used=_.usedByVertexShader||_.usedByFragmentShader,c[m]=_}return{blockSpecs:c,uniformData:s}}function setUniformTree(n,e){for(const t in e){const s=n[t];typeof s=="function"?s(e[t]):setUniformTree(n[t],e[t])}}function setUniforms(n,...e){const t=n.uniformSetters||n,s=e.length;for(let a=0;a<s;++a){const c=e[a];if(Array.isArray(c)){const u=c.length;for(let d=0;d<u;++d)setUniforms(t,c[d])}else for(const u in c){const d=t[u];d&&d(c[u])}}}function createAttributeSetters(n,e){const t={},s=n.getProgramParameter(e,ACTIVE_ATTRIBUTES);for(let a=0;a<s;++a){const c=n.getActiveAttrib(e,a);if(isBuiltIn(c))continue;const u=n.getAttribLocation(e,c.name),d=attrTypeMap[c.type],m=d.setter(n,u,d);m.location=u,t[c.name]=m}return t}function setAttributes(n,e){for(const t in e){const s=n[t];s&&s(e[t])}}function setBuffersAndAttributes(n,e,t){t.vertexArrayObject?n.bindVertexArray(t.vertexArrayObject):(setAttributes(e.attribSetters||e,t.attribs),t.indices&&n.bindBuffer(ELEMENT_ARRAY_BUFFER$1,t.indices))}function createProgramInfoFromProgram(n,e){const t=createUniformSetters(n,e),s=createAttributeSetters(n,e),a={program:e,uniformSetters:t,attribSetters:s};return isWebGL2(n)&&(a.uniformBlockSpec=createUniformBlockSpecFromProgram(n,e),a.transformFeedbackInfo=createTransformFeedbackInfo(n,e)),a}const notIdRE=/\s|{|}|;/;function createProgramInfo(n,e,t,s,a){const c=getProgramOptions(t,s,a),u=[];if(e=e.map(function(_){if(!notIdRE.test(_)){const b=getElementById(_);if(b)_=b.text;else{const S=`no element with id: ${_}`;c.errorCallback(S),u.push(S)}}return _}),u.length)return reportError(c,"");const d=c.callback;d&&(c.callback=(_,b)=>{d(_,_?void 0:createProgramInfoFromProgram(n,b))});const m=createProgramFromSources(n,e,c);return m?createProgramInfoFromProgram(n,m):null}const TRIANGLES=4,UNSIGNED_SHORT=5123;function drawBufferInfo(n,e,t,s,a,c){t=t===void 0?TRIANGLES:t;const u=e.indices,d=e.elementType,m=s===void 0?e.numElements:s;a=a===void 0?0:a,d||u?c!==void 0?n.drawElementsInstanced(t,m,d===void 0?UNSIGNED_SHORT:e.elementType,a,c):n.drawElements(t,m,d===void 0?UNSIGNED_SHORT:e.elementType,a):c!==void 0?n.drawArraysInstanced(t,a,m,c):n.drawArrays(t,a,m)}function create_fragment$g(n){let e,t,s;return{c(){e=element("div"),t=element("canvas"),this.h()},l(a){e=claim_element(a,"DIV",{class:!0});var c=children(e);t=claim_element(c,"CANVAS",{id:!0,width:!0,height:!0,class:!0}),children(t).forEach(detach),c.forEach(detach),this.h()},h(){attr(t,"id","AHRS-display"),attr(t,"width","100"),attr(t,"height","100"),attr(t,"class","w-full aspect-square"),attr(e,"class",s="border-2 shadow-md rounded-md p-2 "+n[2].bg+" "+n[2].border+" "+n[1])},m(a,c){insert_hydration(a,e,c),append_hydration(e,t),n[9](t)},p(a,[c]){c&2&&s!==(s="border-2 shadow-md rounded-md p-2 "+a[2].bg+" "+a[2].border+" "+a[1])&&attr(e,"class",s)},i:noop$3,o:noop$3,d(a){a&&detach(e),n[9](null)}}}function instance$g(n,e,t){let s,a,c,u;component_subscribe(n,rovRoll,O=>t(6,a=O)),component_subscribe(n,rovPitch,O=>t(7,c=O)),component_subscribe(n,rovHeading,O=>t(8,u=O));let d;const m=getColors(),_=`
attribute vec4 position;
void main() {
  gl_Position = position;
}
`;let b,S,C;onMount(()=>{if(t(3,b=d.getContext("webgl")),!b){console.warn("Unable to initialize WebGL. Your browser or machine may not support it.");return}t(4,S=createProgramInfo(b,[_,fragmentShader])),t(5,C=createBufferInfoFromArrays(b,{position:[-1,-1,0,1,-1,0,-1,1,0,-1,1,0,1,-1,0,1,1,0]}))});function w(O){binding_callbacks[O?"unshift":"push"](()=>{d=O,t(0,d)})}return n.$$set=O=>{t(11,e=assign$1(assign$1({},e),exclude_internal_props(O)))},n.$$.update=()=>{if(t(1,s=`${e.class??""}`),n.$$.dirty&504&&S&&b){b.viewport(0,0,b.canvas.width,b.canvas.height);const O={yaw:u*(3.14/180)*-1,pitch:c*(3.14/180)*-1,roll:a*(3.14/180),resolution:[b.canvas.width,b.canvas.height]};b.useProgram(S.program),setBuffersAndAttributes(b,S,C),setUniforms(S,O),drawBufferInfo(b,C)}},e=exclude_internal_props(e),[d,s,m,b,S,C,a,c,u,w]}class YawRollViz extends SvelteComponent{constructor(e){super(),init(this,e,instance$g,create_fragment$g,safe_not_equal,{})}}function get_each_context$2(n,e,t){const s=n.slice();return s[20]=e[t],s[22]=t,s}function create_if_block_1$2(n){let e,t,s=[],a=new Map,c,u,d,m=ensure_array_like(n[3]);const _=S=>S[20].toastId;for(let S=0;S<m.length;S+=1){let C=get_each_context$2(n,m,S),w=_(C);a.set(w,s[S]=create_each_block$2(w,C))}let b=n[1]&&create_if_block_2$1(n);return{c(){e=element("section"),t=element("div");for(let S=0;S<s.length;S+=1)s[S].c();c=space(),b&&b.c(),u=empty(),this.h()},l(S){e=claim_element(S,"SECTION",{class:!0});var C=children(e);t=claim_element(C,"DIV",{class:!0});var w=children(t);for(let O=0;O<s.length;O+=1)s[O].l(w);w.forEach(detach),C.forEach(detach),c=claim_space(S),b&&b.l(S),u=empty(),this.h()},h(){attr(t,"class","p-2 max-h-80 relative z-0 pb-4"),toggle_class(t,"h-24",!n[1]),toggle_class(t,"overflow-y-clip",!n[1]),toggle_class(t,"overflow-y-auto",n[1]),attr(e,"class","overflow-clip rounded-b-xl bg-black relative shadow-md pt-2")},m(S,C){insert_hydration(S,e,C),append_hydration(e,t);for(let w=0;w<s.length;w+=1)s[w]&&s[w].m(t,null);insert_hydration(S,c,C),b&&b.m(S,C),insert_hydration(S,u,C),d=!0},p(S,C){C&16399&&(m=ensure_array_like(S[3]),group_outros(),s=update_keyed_each(s,C,_,1,S,m,a,t,outro_and_destroy_block,create_each_block$2,null,get_each_context$2),check_outros()),(!d||C&2)&&toggle_class(t,"h-24",!S[1]),(!d||C&2)&&toggle_class(t,"overflow-y-clip",!S[1]),(!d||C&2)&&toggle_class(t,"overflow-y-auto",S[1]),S[1]?b?(b.p(S,C),C&2&&transition_in(b,1)):(b=create_if_block_2$1(S),b.c(),transition_in(b,1),b.m(u.parentNode,u)):b&&(group_outros(),transition_out(b,1,1,()=>{b=null}),check_outros())},i(S){if(!d){for(let C=0;C<m.length;C+=1)transition_in(s[C]);transition_in(b),d=!0}},o(S){for(let C=0;C<s.length;C+=1)transition_out(s[C]);transition_out(b),d=!1},d(S){S&&(detach(e),detach(c),detach(u));for(let C=0;C<s.length;C+=1)s[C].d();b&&b.d(S)}}}function create_if_block_3(n){let e,t,s,a,c,u,d,m=n[2]&&create_if_block_4(n);function _(){return n[16](n[22])}return{c(){e=element("button"),m&&m.c(),t=space(),this.h()},l(b){e=claim_element(b,"BUTTON",{class:!0,role:!0});var S=children(e);m&&m.l(S),t=claim_space(S),S.forEach(detach),this.h()},h(){attr(e,"class",s=`btn relative shadow-2xl variant-filled-${n[20].severity} btn-md toast flex justify-between items-center pointer-events-auto  p-4 space-x-4 rounded-container-token shadow-lg w-full cursor-pointer`),attr(e,"role","banner"),toggle_class(e,"mb-2",n[1]),toggle_class(e,"h-16",n[22]!=n[0]),toggle_class(e,"border-2",n[22]==n[0]),set_style(e,"top",(n[1]?0:-n[14](n[22]))+"em"),set_style(e,"z-index",10-n[22])},m(b,S){insert_hydration(b,e,S),m&&m.m(e,null),append_hydration(e,t),c=!0,u||(d=listen(e,"click",_),u=!0)},p(b,S){n=b,n[2]?m?m.p(n,S):(m=create_if_block_4(n),m.c(),m.m(e,t)):m&&(m.d(1),m=null),(!c||S&8&&s!==(s=`btn relative shadow-2xl variant-filled-${n[20].severity} btn-md toast flex justify-between items-center pointer-events-auto  p-4 space-x-4 rounded-container-token shadow-lg w-full cursor-pointer`))&&attr(e,"class",s),(!c||S&10)&&toggle_class(e,"mb-2",n[1]),(!c||S&9)&&toggle_class(e,"h-16",n[22]!=n[0]),(!c||S&9)&&toggle_class(e,"border-2",n[22]==n[0]),S&10&&set_style(e,"top",(n[1]?0:-n[14](n[22]))+"em"),S&8&&set_style(e,"z-index",10-n[22])},i(b){c||(add_render_callback(()=>{c&&(a||(a=create_bidirectional_transition(e,scale,{duration:200,delay:0},!0)),a.run(1))}),c=!0)},o(b){a||(a=create_bidirectional_transition(e,scale,{duration:200,delay:0},!1)),a.run(0),c=!1},d(b){b&&detach(e),m&&m.d(),b&&a&&a.end(),u=!1,d()}}}function create_if_block_4(n){let e,t,s=n[20].messageRepeatCount>1?`[x${n[20].messageRepeatCount}] `:"",a,c=n[20].msg+"",u,d;return{c(){e=element("div"),t=element("p"),a=text(s),u=text(c),this.h()},l(m){e=claim_element(m,"DIV",{class:!0,style:!0});var _=children(e);t=claim_element(_,"P",{});var b=children(t);a=claim_text(b,s),u=claim_text(b,c),b.forEach(detach),_.forEach(detach),this.h()},h(){attr(e,"class","alert-message overflow-hidden text-left text-ellipsis whitespace-normal"),attr(e,"style",d=n[0]==n[22]?"":"max-height:3em")},m(m,_){insert_hydration(m,e,_),append_hydration(e,t),append_hydration(t,a),append_hydration(t,u)},p(m,_){_&8&&s!==(s=m[20].messageRepeatCount>1?`[x${m[20].messageRepeatCount}] `:"")&&set_data(a,s),_&8&&c!==(c=m[20].msg+"")&&set_data(u,c),_&9&&d!==(d=m[0]==m[22]?"":"max-height:3em")&&attr(e,"style",d)},d(m){m&&detach(e)}}}function create_each_block$2(n,e){let t,s,a,c=e[20].closed&&create_if_block_3(e);return{key:n,first:null,c(){t=empty(),c&&c.c(),s=empty(),this.h()},l(u){t=empty(),c&&c.l(u),s=empty(),this.h()},h(){this.first=t},m(u,d){insert_hydration(u,t,d),c&&c.m(u,d),insert_hydration(u,s,d),a=!0},p(u,d){e=u,e[20].closed?c?(c.p(e,d),d&8&&transition_in(c,1)):(c=create_if_block_3(e),c.c(),transition_in(c,1),c.m(s.parentNode,s)):c&&(group_outros(),transition_out(c,1,1,()=>{c=null}),check_outros())},i(u){a||(transition_in(c),a=!0)},o(u){transition_out(c),a=!1},d(u){u&&(detach(t),detach(s)),c&&c.d(u)}}}function create_if_block_2$1(n){let e,t,s,a,c;return t=new Expand_less({props:{class:"text-2xl pointer-events-none",tabindex:"-1",variation:"round"}}),{c(){e=element("button"),create_component(t.$$.fragment),this.h()},l(u){e=claim_element(u,"BUTTON",{class:!0});var d=children(e);claim_component(t.$$.fragment,d),d.forEach(detach),this.h()},h(){attr(e,"class","btn variant-filled-primary relative max-w-28 mx-auto mr-4 z-10 shadow-xl -mt-5 -mb-5 z-1")},m(u,d){insert_hydration(u,e,d),mount_component(t,e,null),s=!0,a||(c=listen(e,"click",n[17]),a=!0)},p:noop$3,i(u){s||(transition_in(t.$$.fragment,u),s=!0)},o(u){transition_out(t.$$.fragment,u),s=!1},d(u){u&&detach(e),destroy_component(t),a=!1,c()}}}function create_else_block$3(n){let e,t;return e=new Chevron_right({props:{class:"text-2xl pointer-events-none",tabindex:"-1",variation:"round"}}),{c(){create_component(e.$$.fragment)},l(s){claim_component(e.$$.fragment,s)},m(s,a){mount_component(e,s,a),t=!0},i(s){t||(transition_in(e.$$.fragment,s),t=!0)},o(s){transition_out(e.$$.fragment,s),t=!1},d(s){destroy_component(e,s)}}}function create_if_block$3(n){let e,t;return e=new Chevron_left({props:{class:"text-2xl pointer-events-none",tabindex:"-1",variation:"round"}}),{c(){create_component(e.$$.fragment)},l(s){claim_component(e.$$.fragment,s)},m(s,a){mount_component(e,s,a),t=!0},i(s){t||(transition_in(e.$$.fragment,s),t=!0)},o(s){transition_out(e.$$.fragment,s),t=!1},d(s){destroy_component(e,s)}}}function create_fragment$f(n){let e,t,s,a,c,u,d,m,_,b,S,C,w,O,I,N,P,B,x,F,k,J,z,H,W,X,se,re,ue,de,he,me,le=n[3].length>0&&n[2]&&create_if_block_1$2(n);a=new YawRollViz({props:{class:"m-2 mb-0"}}),d=new CircleStatIndicator({props:{value:n[4],min:0,max:50,unit:"M",name:"Depth"}}),_=new CircleStatIndicator({props:{value:n[5],min:6,max:27,unit:"*C",name:"WaterTemp"}}),S=new CircleStatIndicator({props:{value:n[6],min:11,max:17.6,unit:"Volts",name:"BattVolts"}}),w=new CircleStatIndicator({props:{value:n[7],min:0,max:60,unit:"Amps",name:"BattAmps"}}),I=new CircleStatIndicator({props:{value:n[8],min:20,max:600,unit:"ms",name:"Net Latency"}}),P=new CircleStatIndicator({props:{value:n[9],min:0,max:120,unit:"%",name:"Autopilot Load"}}),x=new CircleStatIndicator({props:{value:n[10],min:0,max:100,unit:"%",name:"Memory Usage"}}),k=new CircleStatIndicator({props:{value:n[11],min:0,max:100,unit:"%",name:"Disk Usage"}}),z=new CircleStatIndicator({props:{value:n[12],min:20,max:120,unit:"*C",name:"CPU Temp"}}),W=new CircleStatIndicator({props:{value:n[13],min:0,max:100,unit:"%",name:"CPU Usage"}});const _e=[create_if_block$3,create_else_block$3],fe=[];function ve(ne,j){return ne[2]?0:1}return re=ve(n),ue=fe[re]=_e[re](n),{c(){e=element("div"),le&&le.c(),t=space(),s=element("section"),create_component(a.$$.fragment),c=space(),u=element("div"),create_component(d.$$.fragment),m=space(),create_component(_.$$.fragment),b=space(),create_component(S.$$.fragment),C=space(),create_component(w.$$.fragment),O=space(),create_component(I.$$.fragment),N=space(),create_component(P.$$.fragment),B=space(),create_component(x.$$.fragment),F=space(),create_component(k.$$.fragment),J=space(),create_component(z.$$.fragment),H=space(),create_component(W.$$.fragment),X=space(),se=element("button"),ue.c(),this.h()},l(ne){e=claim_element(ne,"DIV",{class:!0});var j=children(e);le&&le.l(j),t=claim_space(j),s=claim_element(j,"SECTION",{class:!0});var $=children(s);claim_component(a.$$.fragment,$),c=claim_space($),u=claim_element($,"DIV",{class:!0});var Z=children(u);claim_component(d.$$.fragment,Z),m=claim_space(Z),claim_component(_.$$.fragment,Z),b=claim_space(Z),claim_component(S.$$.fragment,Z),C=claim_space(Z),claim_component(w.$$.fragment,Z),O=claim_space(Z),claim_component(I.$$.fragment,Z),N=claim_space(Z),claim_component(P.$$.fragment,Z),B=claim_space(Z),claim_component(x.$$.fragment,Z),F=claim_space(Z),claim_component(k.$$.fragment,Z),J=claim_space(Z),claim_component(z.$$.fragment,Z),H=claim_space(Z),claim_component(W.$$.fragment,Z),Z.forEach(detach),$.forEach(detach),X=claim_space(j),se=claim_element(j,"BUTTON",{class:!0});var ce=children(se);ue.l(ce),ce.forEach(detach),j.forEach(detach),this.h()},h(){attr(u,"class","grid gap-2 p-2"),toggle_class(u,"grid-cols-1",!n[2]),toggle_class(u,"grid-cols-2",n[2]),attr(s,"class","flex-auto basis-0 overflow-auto"),attr(se,"class","btn w-full variant-filled-surface relative rounded-b-none rounded-t-xl z-10"),attr(e,"class","flex flex-col h-full overflow-hidden relative"),toggle_class(e,"w-72",n[2]),toggle_class(e,"w-28",!n[2])},m(ne,j){insert_hydration(ne,e,j),le&&le.m(e,null),append_hydration(e,t),append_hydration(e,s),mount_component(a,s,null),append_hydration(s,c),append_hydration(s,u),mount_component(d,u,null),append_hydration(u,m),mount_component(_,u,null),append_hydration(u,b),mount_component(S,u,null),append_hydration(u,C),mount_component(w,u,null),append_hydration(u,O),mount_component(I,u,null),append_hydration(u,N),mount_component(P,u,null),append_hydration(u,B),mount_component(x,u,null),append_hydration(u,F),mount_component(k,u,null),append_hydration(u,J),mount_component(z,u,null),append_hydration(u,H),mount_component(W,u,null),append_hydration(e,X),append_hydration(e,se),fe[re].m(se,null),de=!0,he||(me=listen(se,"click",n[15]),he=!0)},p(ne,[j]){ne[3].length>0&&ne[2]?le?(le.p(ne,j),j&12&&transition_in(le,1)):(le=create_if_block_1$2(ne),le.c(),transition_in(le,1),le.m(e,t)):le&&(group_outros(),transition_out(le,1,1,()=>{le=null}),check_outros());const $={};j&16&&($.value=ne[4]),d.$set($);const Z={};j&32&&(Z.value=ne[5]),_.$set(Z);const ce={};j&64&&(ce.value=ne[6]),S.$set(ce);const Y={};j&128&&(Y.value=ne[7]),w.$set(Y);const K={};j&256&&(K.value=ne[8]),I.$set(K);const Q={};j&512&&(Q.value=ne[9]),P.$set(Q);const te={};j&1024&&(te.value=ne[10]),x.$set(te);const oe={};j&2048&&(oe.value=ne[11]),k.$set(oe);const U={};j&4096&&(U.value=ne[12]),z.$set(U);const V={};j&8192&&(V.value=ne[13]),W.$set(V),(!de||j&4)&&toggle_class(u,"grid-cols-1",!ne[2]),(!de||j&4)&&toggle_class(u,"grid-cols-2",ne[2]);let q=re;re=ve(ne),re!==q&&(group_outros(),transition_out(fe[q],1,1,()=>{fe[q]=null}),check_outros(),ue=fe[re],ue||(ue=fe[re]=_e[re](ne),ue.c()),transition_in(ue,1),ue.m(se,null)),(!de||j&4)&&toggle_class(e,"w-72",ne[2]),(!de||j&4)&&toggle_class(e,"w-28",!ne[2])},i(ne){de||(transition_in(le),transition_in(a.$$.fragment,ne),transition_in(d.$$.fragment,ne),transition_in(_.$$.fragment,ne),transition_in(S.$$.fragment,ne),transition_in(w.$$.fragment,ne),transition_in(I.$$.fragment,ne),transition_in(P.$$.fragment,ne),transition_in(x.$$.fragment,ne),transition_in(k.$$.fragment,ne),transition_in(z.$$.fragment,ne),transition_in(W.$$.fragment,ne),transition_in(ue),de=!0)},o(ne){transition_out(le),transition_out(a.$$.fragment,ne),transition_out(d.$$.fragment,ne),transition_out(_.$$.fragment,ne),transition_out(S.$$.fragment,ne),transition_out(w.$$.fragment,ne),transition_out(I.$$.fragment,ne),transition_out(P.$$.fragment,ne),transition_out(x.$$.fragment,ne),transition_out(k.$$.fragment,ne),transition_out(z.$$.fragment,ne),transition_out(W.$$.fragment,ne),transition_out(ue),de=!1},d(ne){ne&&detach(e),le&&le.d(),destroy_component(a),destroy_component(d),destroy_component(_),destroy_component(S),destroy_component(w),destroy_component(I),destroy_component(P),destroy_component(x),destroy_component(k),destroy_component(z),destroy_component(W),fe[re].d(),he=!1,me()}}}function instance$f(n,e,t){let s,a,c,u,d,m,_,b,S,C,w,O;component_subscribe(n,sidebarExpanded,z=>t(2,s=z)),component_subscribe(n,toastHistoryStore,z=>t(3,a=z)),component_subscribe(n,depthM,z=>t(4,c=z)),component_subscribe(n,waterTempC,z=>t(5,u=z)),component_subscribe(n,batteryVoltage,z=>t(6,d=z)),component_subscribe(n,batteryCurrent,z=>t(7,m=z)),component_subscribe(n,networkLatencyMs,z=>t(8,_=z)),component_subscribe(n,autopilotLoad,z=>t(9,b=z)),component_subscribe(n,memUsagePercent,z=>t(10,S=z)),component_subscribe(n,diskUsagePercent,z=>t(11,C=z)),component_subscribe(n,cpuTempC,z=>t(12,w=z)),component_subscribe(n,cpuUsagePercent,z=>t(13,O=z));let I=-1,N=!1;const P=z=>z==0?0:(3.5+Math.min(z,6)/60*5)*z,B=getDrawerStore();B.subscribe(z=>{sidebarExpanded.set(z.open)});const x=()=>B.close();return[I,N,s,a,c,u,d,m,_,b,S,C,w,O,P,()=>{get_store_value(B).open?x():sidebarExpanded.set(!sidebarExpanded.get())},z=>{N?I==z?t(0,I=-1):t(0,I=z):(sidebarExpanded.set(!0),t(0,I=z),t(1,N=!0))},()=>{t(0,I=-1),t(1,N=!1)}]}class Sidebar extends SvelteComponent{constructor(e){super(),init(this,e,instance$f,create_fragment$f,safe_not_equal,{})}}const CompassDial_svelte_svelte_type_style_lang="";function create_fragment$e(n){let e,t,s,a,c;return{c(){e=element("div"),t=element("div"),s=space(),a=element("div"),this.h()},l(u){e=claim_element(u,"DIV",{class:!0,style:!0});var d=children(e);t=claim_element(d,"DIV",{class:!0}),children(t).forEach(detach),s=claim_space(d),a=claim_element(d,"DIV",{class:!0,id:!0}),children(a).forEach(detach),d.forEach(detach),this.h()},h(){attr(t,"class","line svelte-1epa793"),attr(a,"class","bg svelte-1epa793"),attr(a,"id","compassDiscImg"),set_style(a,"transform",`translateX(${n[0]}px)`),attr(e,"class",c=null_to_empty("compass  bg-surface-900 rounded-full overflow-clip border-surface-900 border-x-4 "+n[1].class||"")+" svelte-1epa793"),set_style(e,"height","34px"),set_style(e,"min-width","200px")},m(u,d){insert_hydration(u,e,d),append_hydration(e,t),append_hydration(e,s),append_hydration(e,a)},p(u,[d]){d&1&&set_style(a,"transform",`translateX(${u[0]}px)`),d&2&&c!==(c=null_to_empty("compass  bg-surface-900 rounded-full overflow-clip border-surface-900 border-x-4 "+u[1].class||"")+" svelte-1epa793")&&attr(e,"class",c)},i:noop$3,o:noop$3,d(u){u&&detach(e)}}}function instance$e(n,e,t){let s;return component_subscribe(n,rovHeading,a=>t(0,s=a)),n.$$set=a=>{t(1,e=assign$1(assign$1({},e),exclude_internal_props(a)))},e=exclude_internal_props(e),[s,e]}class CompassDial extends SvelteComponent{constructor(e){super(),init(this,e,instance$e,create_fragment$e,safe_not_equal,{})}}function create_fragment$d(n){let e,t,s,a,c=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[3]},{viewBox:"0 0 24 24"}],u={};for(let d=0;d<c.length;d+=1)u=assign$1(u,c[d]);return{c(){e=svg_element("svg"),t=new HtmlTagHydration(!0),this.h()},l(d){e=claim_svg_element(d,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var m=children(e);t=claim_html_tag(m,!0),m.forEach(detach),this.h()},h(){t.a=null,set_svg_attributes(e,u)},m(d,m){insert_hydration(d,e,m),t.m(n[4],e),s||(a=[listen(e,"click",n[7]),listen(e,"keydown",n[8]),listen(e,"keyup",n[9]),listen(e,"focus",n[10]),listen(e,"blur",n[11]),listen(e,"mouseenter",n[12]),listen(e,"mouseleave",n[13]),listen(e,"mouseover",n[14]),listen(e,"mouseout",n[15])],s=!0)},p(d,[m]){m&16&&t.p(d[4]),set_svg_attributes(e,u=get_spread_update(c,[{xmlns:"http://www.w3.org/2000/svg"},m&32&&d[5],m&2&&{role:d[1]},m&1&&{width:d[0]},m&1&&{height:d[0]},m&4&&{fill:d[2]},m&8&&{"aria-label":d[3]},{viewBox:"0 0 24 24"}]))},i:noop$3,o:noop$3,d(d){d&&detach(e),s=!1,run_all(a)}}}let svgfilled$9='<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>',svgoutlined$9='<path d="M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>',svground$9='<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 15c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1s1 .45 1 1v4c0 .55-.45 1-1 1zm1-8h-2V7h2v2z"/>',svgsharp$9='<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>',svgtwotone$9='<path d="M12 4c-4.41 0-8 3.59-8 8s3.59 8 8 8 8-3.59 8-8-3.59-8-8-8zm1 13h-2v-6h2v6zm0-8h-2V7h2v2z" opacity=".3"/><path d="M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>';function instance$d(n,e,t){const s=["size","role","color","variation","ariaLabel"];let a=compute_rest_props(e,s);const c=getContext("iconCtx")??{};let{size:u=c.size||"24"}=e,{role:d=c.role||"img"}=e,{color:m=c.color||"currentColor"}=e,{variation:_=c.variation||"outlined"}=e,b;switch(_){case"filled":b=svgfilled$9;break;case"outlined":b=svgoutlined$9;break;case"round":b=svground$9;break;case"sharp":b=svgsharp$9;break;case"two-tone":b=svgtwotone$9;break;default:b=svgoutlined$9}let{ariaLabel:S="info"}=e;function C(k){bubble.call(this,n,k)}function w(k){bubble.call(this,n,k)}function O(k){bubble.call(this,n,k)}function I(k){bubble.call(this,n,k)}function N(k){bubble.call(this,n,k)}function P(k){bubble.call(this,n,k)}function B(k){bubble.call(this,n,k)}function x(k){bubble.call(this,n,k)}function F(k){bubble.call(this,n,k)}return n.$$set=k=>{e=assign$1(assign$1({},e),exclude_internal_props(k)),t(5,a=compute_rest_props(e,s)),"size"in k&&t(0,u=k.size),"role"in k&&t(1,d=k.role),"color"in k&&t(2,m=k.color),"variation"in k&&t(6,_=k.variation),"ariaLabel"in k&&t(3,S=k.ariaLabel)},[u,d,m,S,b,a,_,C,w,O,I,N,P,B,x,F]}class Info extends SvelteComponent{constructor(e){super(),init(this,e,instance$d,create_fragment$d,safe_not_equal,{size:0,role:1,color:2,variation:6,ariaLabel:3})}}function create_fragment$c(n){let e,t,s,a,c=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[3]},{viewBox:"0 0 24 24"}],u={};for(let d=0;d<c.length;d+=1)u=assign$1(u,c[d]);return{c(){e=svg_element("svg"),t=new HtmlTagHydration(!0),this.h()},l(d){e=claim_svg_element(d,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var m=children(e);t=claim_html_tag(m,!0),m.forEach(detach),this.h()},h(){t.a=null,set_svg_attributes(e,u)},m(d,m){insert_hydration(d,e,m),t.m(n[4],e),s||(a=[listen(e,"click",n[7]),listen(e,"keydown",n[8]),listen(e,"keyup",n[9]),listen(e,"focus",n[10]),listen(e,"blur",n[11]),listen(e,"mouseenter",n[12]),listen(e,"mouseleave",n[13]),listen(e,"mouseover",n[14]),listen(e,"mouseout",n[15])],s=!0)},p(d,[m]){m&16&&t.p(d[4]),set_svg_attributes(e,u=get_spread_update(c,[{xmlns:"http://www.w3.org/2000/svg"},m&32&&d[5],m&2&&{role:d[1]},m&1&&{width:d[0]},m&1&&{height:d[0]},m&4&&{fill:d[2]},m&8&&{"aria-label":d[3]},{viewBox:"0 0 24 24"}]))},i:noop$3,o:noop$3,d(d){d&&detach(e),s=!1,run_all(a)}}}let svgfilled$8='<path d="M13 3h-2v10h2V3zm4.83 2.17-1.42 1.42A6.92 6.92 0 0 1 19 12c0 3.87-3.13 7-7 7A6.995 6.995 0 0 1 7.58 6.58L6.17 5.17A8.932 8.932 0 0 0 3 12a9 9 0 0 0 18 0c0-2.74-1.23-5.18-3.17-6.83z"/>',svgoutlined$8='<path d="M13 3h-2v10h2V3zm4.83 2.17-1.42 1.42A6.92 6.92 0 0 1 19 12c0 3.87-3.13 7-7 7A6.995 6.995 0 0 1 7.58 6.58L6.17 5.17A8.932 8.932 0 0 0 3 12a9 9 0 0 0 18 0c0-2.74-1.23-5.18-3.17-6.83z"/>',svground$8='<path d="M12 3c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1s1-.45 1-1V4c0-.55-.45-1-1-1zm5.14 2.86a.99.99 0 0 0-.01 1.39c1.13 1.2 1.83 2.8 1.87 4.57.09 3.83-3.08 7.13-6.91 7.17A6.981 6.981 0 0 1 5 12c0-1.84.71-3.51 1.87-4.76.37-.39.37-1-.01-1.38a.993.993 0 0 0-1.43.02A8.92 8.92 0 0 0 3 11.74c-.14 4.88 3.83 9.1 8.71 9.25 5.1.16 9.29-3.93 9.29-9 0-2.37-.92-4.51-2.42-6.11-.38-.41-1.04-.42-1.44-.02z"/>',svgsharp$8='<path d="M13 3h-2v10h2V3zm4.83 2.17-1.42 1.42A6.92 6.92 0 0 1 19 12c0 3.87-3.13 7-7 7A6.995 6.995 0 0 1 7.58 6.58L6.17 5.17A8.932 8.932 0 0 0 3 12a9 9 0 0 0 18 0c0-2.74-1.23-5.18-3.17-6.83z"/>',svgtwotone$8='<path d="M13 3h-2v10h2V3zm4.83 2.17-1.42 1.42A6.92 6.92 0 0 1 19 12c0 3.87-3.13 7-7 7A6.995 6.995 0 0 1 7.58 6.58L6.17 5.17A8.932 8.932 0 0 0 3 12a9 9 0 0 0 18 0c0-2.74-1.23-5.18-3.17-6.83z"/>';function instance$c(n,e,t){const s=["size","role","color","variation","ariaLabel"];let a=compute_rest_props(e,s);const c=getContext("iconCtx")??{};let{size:u=c.size||"24"}=e,{role:d=c.role||"img"}=e,{color:m=c.color||"currentColor"}=e,{variation:_=c.variation||"outlined"}=e,b;switch(_){case"filled":b=svgfilled$8;break;case"outlined":b=svgoutlined$8;break;case"round":b=svground$8;break;case"sharp":b=svgsharp$8;break;case"two-tone":b=svgtwotone$8;break;default:b=svgoutlined$8}let{ariaLabel:S="power settings new"}=e;function C(k){bubble.call(this,n,k)}function w(k){bubble.call(this,n,k)}function O(k){bubble.call(this,n,k)}function I(k){bubble.call(this,n,k)}function N(k){bubble.call(this,n,k)}function P(k){bubble.call(this,n,k)}function B(k){bubble.call(this,n,k)}function x(k){bubble.call(this,n,k)}function F(k){bubble.call(this,n,k)}return n.$$set=k=>{e=assign$1(assign$1({},e),exclude_internal_props(k)),t(5,a=compute_rest_props(e,s)),"size"in k&&t(0,u=k.size),"role"in k&&t(1,d=k.role),"color"in k&&t(2,m=k.color),"variation"in k&&t(6,_=k.variation),"ariaLabel"in k&&t(3,S=k.ariaLabel)},[u,d,m,S,b,a,_,C,w,O,I,N,P,B,x,F]}class Power_settings_new extends SvelteComponent{constructor(e){super(),init(this,e,instance$c,create_fragment$c,safe_not_equal,{size:0,role:1,color:2,variation:6,ariaLabel:3})}}function create_fragment$b(n){let e,t,s,a,c=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[3]},{viewBox:"0 0 24 24"}],u={};for(let d=0;d<c.length;d+=1)u=assign$1(u,c[d]);return{c(){e=svg_element("svg"),t=new HtmlTagHydration(!0),this.h()},l(d){e=claim_svg_element(d,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var m=children(e);t=claim_html_tag(m,!0),m.forEach(detach),this.h()},h(){t.a=null,set_svg_attributes(e,u)},m(d,m){insert_hydration(d,e,m),t.m(n[4],e),s||(a=[listen(e,"click",n[7]),listen(e,"keydown",n[8]),listen(e,"keyup",n[9]),listen(e,"focus",n[10]),listen(e,"blur",n[11]),listen(e,"mouseenter",n[12]),listen(e,"mouseleave",n[13]),listen(e,"mouseover",n[14]),listen(e,"mouseout",n[15])],s=!0)},p(d,[m]){m&16&&t.p(d[4]),set_svg_attributes(e,u=get_spread_update(c,[{xmlns:"http://www.w3.org/2000/svg"},m&32&&d[5],m&2&&{role:d[1]},m&1&&{width:d[0]},m&1&&{height:d[0]},m&4&&{fill:d[2]},m&8&&{"aria-label":d[3]},{viewBox:"0 0 24 24"}]))},i:noop$3,o:noop$3,d(d){d&&detach(e),s=!1,run_all(a)}}}let svgfilled$7='<path d="M12 5V2L8 6l4 4V7c3.31 0 6 2.69 6 6 0 2.97-2.17 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93 0-4.42-3.58-8-8-8zm-6 8c0-1.65.67-3.15 1.76-4.24L6.34 7.34A8.014 8.014 0 0 0 4 13c0 4.08 3.05 7.44 7 7.93v-2.02c-2.83-.48-5-2.94-5-5.91z"/>',svgoutlined$7='<path d="M6 13c0-1.65.67-3.15 1.76-4.24L6.34 7.34A8.014 8.014 0 0 0 4 13c0 4.08 3.05 7.44 7 7.93v-2.02c-2.83-.48-5-2.94-5-5.91zm14 0c0-4.42-3.58-8-8-8-.06 0-.12.01-.18.01l1.09-1.09L11.5 2.5 8 6l3.5 3.5 1.41-1.41-1.08-1.08c.06 0 .12-.01.17-.01 3.31 0 6 2.69 6 6 0 2.97-2.17 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93z"/>',svground$7='<path d="M12 5V3.21c0-.45-.54-.67-.85-.35l-2.8 2.79c-.2.2-.2.51 0 .71l2.79 2.79c.32.31.86.09.86-.36V7c3.31 0 6 2.69 6 6 0 2.72-1.83 5.02-4.31 5.75-.42.12-.69.52-.69.95 0 .65.62 1.16 1.25.97A7.991 7.991 0 0 0 20 13c0-4.42-3.58-8-8-8zm-6 8c0-1.34.44-2.58 1.19-3.59.3-.4.26-.95-.09-1.31-.42-.42-1.14-.38-1.5.1a7.991 7.991 0 0 0 4.15 12.47c.63.19 1.25-.32 1.25-.97 0-.43-.27-.83-.69-.95C7.83 18.02 6 15.72 6 13z"/>',svgsharp$7='<path d="M12 5V2L8 6l4 4V7c3.31 0 6 2.69 6 6 0 2.97-2.17 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93 0-4.42-3.58-8-8-8zm-6 8c0-1.65.67-3.15 1.76-4.24L6.34 7.34A8.014 8.014 0 0 0 4 13c0 4.08 3.05 7.44 7 7.93v-2.02c-2.83-.48-5-2.94-5-5.91z"/>',svgtwotone$7='<path d="M12 5V2L8 6l4 4V7c3.31 0 6 2.69 6 6 0 2.97-2.17 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93 0-4.42-3.58-8-8-8zm-6 8c0-1.65.67-3.15 1.76-4.24L6.34 7.34A8.014 8.014 0 0 0 4 13c0 4.08 3.05 7.44 7 7.93v-2.02c-2.83-.48-5-2.94-5-5.91z"/>';function instance$b(n,e,t){const s=["size","role","color","variation","ariaLabel"];let a=compute_rest_props(e,s);const c=getContext("iconCtx")??{};let{size:u=c.size||"24"}=e,{role:d=c.role||"img"}=e,{color:m=c.color||"currentColor"}=e,{variation:_=c.variation||"outlined"}=e,b;switch(_){case"filled":b=svgfilled$7;break;case"outlined":b=svgoutlined$7;break;case"round":b=svground$7;break;case"sharp":b=svgsharp$7;break;case"two-tone":b=svgtwotone$7;break;default:b=svgoutlined$7}let{ariaLabel:S="restart alt"}=e;function C(k){bubble.call(this,n,k)}function w(k){bubble.call(this,n,k)}function O(k){bubble.call(this,n,k)}function I(k){bubble.call(this,n,k)}function N(k){bubble.call(this,n,k)}function P(k){bubble.call(this,n,k)}function B(k){bubble.call(this,n,k)}function x(k){bubble.call(this,n,k)}function F(k){bubble.call(this,n,k)}return n.$$set=k=>{e=assign$1(assign$1({},e),exclude_internal_props(k)),t(5,a=compute_rest_props(e,s)),"size"in k&&t(0,u=k.size),"role"in k&&t(1,d=k.role),"color"in k&&t(2,m=k.color),"variation"in k&&t(6,_=k.variation),"ariaLabel"in k&&t(3,S=k.ariaLabel)},[u,d,m,S,b,a,_,C,w,O,I,N,P,B,x,F]}class Restart_alt extends SvelteComponent{constructor(e){super(),init(this,e,instance$b,create_fragment$b,safe_not_equal,{size:0,role:1,color:2,variation:6,ariaLabel:3})}}function create_fragment$a(n){let e,t,s,a,c=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[3]},{viewBox:"0 0 24 24"}],u={};for(let d=0;d<c.length;d+=1)u=assign$1(u,c[d]);return{c(){e=svg_element("svg"),t=new HtmlTagHydration(!0),this.h()},l(d){e=claim_svg_element(d,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var m=children(e);t=claim_html_tag(m,!0),m.forEach(detach),this.h()},h(){t.a=null,set_svg_attributes(e,u)},m(d,m){insert_hydration(d,e,m),t.m(n[4],e),s||(a=[listen(e,"click",n[7]),listen(e,"keydown",n[8]),listen(e,"keyup",n[9]),listen(e,"focus",n[10]),listen(e,"blur",n[11]),listen(e,"mouseenter",n[12]),listen(e,"mouseleave",n[13]),listen(e,"mouseover",n[14]),listen(e,"mouseout",n[15])],s=!0)},p(d,[m]){m&16&&t.p(d[4]),set_svg_attributes(e,u=get_spread_update(c,[{xmlns:"http://www.w3.org/2000/svg"},m&32&&d[5],m&2&&{role:d[1]},m&1&&{width:d[0]},m&1&&{height:d[0]},m&4&&{fill:d[2]},m&8&&{"aria-label":d[3]},{viewBox:"0 0 24 24"}]))},i:noop$3,o:noop$3,d(d){d&&detach(e),s=!1,run_all(a)}}}let svgfilled$6='<path d="M17 1.01 7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14zm-1-6h-3V8h-2v5H8l4 4 4-4z"/>',svgoutlined$6='<path d="M17 1.01 7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14zm-1-6h-3V8h-2v5H8l4 4 4-4z"/>',svground$6='<path d="M17 1.01 7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14zm-2.21-6H13V9c0-.55-.45-1-1-1s-1 .45-1 1v4H9.21c-.45 0-.67.54-.35.85l2.79 2.79c.2.2.51.2.71 0l2.79-2.79a.5.5 0 0 0-.36-.85z"/>',svgsharp$6='<path d="M5 1v22h14V1H5zm12 18H7V5h10v14zm-1-6h-3V8h-2v5H8l4 4 4-4z"/>',svgtwotone$6='<path d="M7 19h10V5H7v14zm4-6V8h2v5h3l-4 4-4-4h3z" opacity=".3"/><path d="M16 13h-3V8h-2v5H8l4 4zm1-11.99L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"/>';function instance$a(n,e,t){const s=["size","role","color","variation","ariaLabel"];let a=compute_rest_props(e,s);const c=getContext("iconCtx")??{};let{size:u=c.size||"24"}=e,{role:d=c.role||"img"}=e,{color:m=c.color||"currentColor"}=e,{variation:_=c.variation||"outlined"}=e,b;switch(_){case"filled":b=svgfilled$6;break;case"outlined":b=svgoutlined$6;break;case"round":b=svground$6;break;case"sharp":b=svgsharp$6;break;case"two-tone":b=svgtwotone$6;break;default:b=svgoutlined$6}let{ariaLabel:S="system update"}=e;function C(k){bubble.call(this,n,k)}function w(k){bubble.call(this,n,k)}function O(k){bubble.call(this,n,k)}function I(k){bubble.call(this,n,k)}function N(k){bubble.call(this,n,k)}function P(k){bubble.call(this,n,k)}function B(k){bubble.call(this,n,k)}function x(k){bubble.call(this,n,k)}function F(k){bubble.call(this,n,k)}return n.$$set=k=>{e=assign$1(assign$1({},e),exclude_internal_props(k)),t(5,a=compute_rest_props(e,s)),"size"in k&&t(0,u=k.size),"role"in k&&t(1,d=k.role),"color"in k&&t(2,m=k.color),"variation"in k&&t(6,_=k.variation),"ariaLabel"in k&&t(3,S=k.ariaLabel)},[u,d,m,S,b,a,_,C,w,O,I,N,P,B,x,F]}class System_update extends SvelteComponent{constructor(e){super(),init(this,e,instance$a,create_fragment$a,safe_not_equal,{size:0,role:1,color:2,variation:6,ariaLabel:3})}}function create_fragment$9(n){let e,t,s,a,c=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[3]},{viewBox:"0 0 24 24"}],u={};for(let d=0;d<c.length;d+=1)u=assign$1(u,c[d]);return{c(){e=svg_element("svg"),t=new HtmlTagHydration(!0),this.h()},l(d){e=claim_svg_element(d,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var m=children(e);t=claim_html_tag(m,!0),m.forEach(detach),this.h()},h(){t.a=null,set_svg_attributes(e,u)},m(d,m){insert_hydration(d,e,m),t.m(n[4],e),s||(a=[listen(e,"click",n[7]),listen(e,"keydown",n[8]),listen(e,"keyup",n[9]),listen(e,"focus",n[10]),listen(e,"blur",n[11]),listen(e,"mouseenter",n[12]),listen(e,"mouseleave",n[13]),listen(e,"mouseover",n[14]),listen(e,"mouseout",n[15])],s=!0)},p(d,[m]){m&16&&t.p(d[4]),set_svg_attributes(e,u=get_spread_update(c,[{xmlns:"http://www.w3.org/2000/svg"},m&32&&d[5],m&2&&{role:d[1]},m&1&&{width:d[0]},m&1&&{height:d[0]},m&4&&{fill:d[2]},m&8&&{"aria-label":d[3]},{viewBox:"0 0 24 24"}]))},i:noop$3,o:noop$3,d(d){d&&detach(e),s=!1,run_all(a)}}}let svgfilled$5='<path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>',svgoutlined$5='<path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>',svground$5='<path d="M6 14c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1h3c.55 0 1-.45 1-1s-.45-1-1-1H7v-2c0-.55-.45-1-1-1zm0-4c.55 0 1-.45 1-1V7h2c.55 0 1-.45 1-1s-.45-1-1-1H6c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1zm11 7h-2c-.55 0-1 .45-1 1s.45 1 1 1h3c.55 0 1-.45 1-1v-3c0-.55-.45-1-1-1s-1 .45-1 1v2zM14 6c0 .55.45 1 1 1h2v2c0 .55.45 1 1 1s1-.45 1-1V6c0-.55-.45-1-1-1h-3c-.55 0-1 .45-1 1z"/>',svgsharp$5='<path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>',svgtwotone$5='<path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>';function instance$9(n,e,t){const s=["size","role","color","variation","ariaLabel"];let a=compute_rest_props(e,s);const c=getContext("iconCtx")??{};let{size:u=c.size||"24"}=e,{role:d=c.role||"img"}=e,{color:m=c.color||"currentColor"}=e,{variation:_=c.variation||"outlined"}=e,b;switch(_){case"filled":b=svgfilled$5;break;case"outlined":b=svgoutlined$5;break;case"round":b=svground$5;break;case"sharp":b=svgsharp$5;break;case"two-tone":b=svgtwotone$5;break;default:b=svgoutlined$5}let{ariaLabel:S="fullscreen"}=e;function C(k){bubble.call(this,n,k)}function w(k){bubble.call(this,n,k)}function O(k){bubble.call(this,n,k)}function I(k){bubble.call(this,n,k)}function N(k){bubble.call(this,n,k)}function P(k){bubble.call(this,n,k)}function B(k){bubble.call(this,n,k)}function x(k){bubble.call(this,n,k)}function F(k){bubble.call(this,n,k)}return n.$$set=k=>{e=assign$1(assign$1({},e),exclude_internal_props(k)),t(5,a=compute_rest_props(e,s)),"size"in k&&t(0,u=k.size),"role"in k&&t(1,d=k.role),"color"in k&&t(2,m=k.color),"variation"in k&&t(6,_=k.variation),"ariaLabel"in k&&t(3,S=k.ariaLabel)},[u,d,m,S,b,a,_,C,w,O,I,N,P,B,x,F]}class Fullscreen extends SvelteComponent{constructor(e){super(),init(this,e,instance$9,create_fragment$9,safe_not_equal,{size:0,role:1,color:2,variation:6,ariaLabel:3})}}function create_fragment$8(n){let e,t,s,a,c=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[3]},{viewBox:"0 0 24 24"}],u={};for(let d=0;d<c.length;d+=1)u=assign$1(u,c[d]);return{c(){e=svg_element("svg"),t=new HtmlTagHydration(!0),this.h()},l(d){e=claim_svg_element(d,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var m=children(e);t=claim_html_tag(m,!0),m.forEach(detach),this.h()},h(){t.a=null,set_svg_attributes(e,u)},m(d,m){insert_hydration(d,e,m),t.m(n[4],e),s||(a=[listen(e,"click",n[7]),listen(e,"keydown",n[8]),listen(e,"keyup",n[9]),listen(e,"focus",n[10]),listen(e,"blur",n[11]),listen(e,"mouseenter",n[12]),listen(e,"mouseleave",n[13]),listen(e,"mouseover",n[14]),listen(e,"mouseout",n[15])],s=!0)},p(d,[m]){m&16&&t.p(d[4]),set_svg_attributes(e,u=get_spread_update(c,[{xmlns:"http://www.w3.org/2000/svg"},m&32&&d[5],m&2&&{role:d[1]},m&1&&{width:d[0]},m&1&&{height:d[0]},m&4&&{fill:d[2]},m&8&&{"aria-label":d[3]},{viewBox:"0 0 24 24"}]))},i:noop$3,o:noop$3,d(d){d&&detach(e),s=!1,run_all(a)}}}let svgfilled$4='<path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>',svgoutlined$4='<path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>',svground$4='<path d="M6 16h2v2c0 .55.45 1 1 1s1-.45 1-1v-3c0-.55-.45-1-1-1H6c-.55 0-1 .45-1 1s.45 1 1 1zm2-8H6c-.55 0-1 .45-1 1s.45 1 1 1h3c.55 0 1-.45 1-1V6c0-.55-.45-1-1-1s-1 .45-1 1v2zm7 11c.55 0 1-.45 1-1v-2h2c.55 0 1-.45 1-1s-.45-1-1-1h-3c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1zm1-11V6c0-.55-.45-1-1-1s-1 .45-1 1v3c0 .55.45 1 1 1h3c.55 0 1-.45 1-1s-.45-1-1-1h-2z"/>',svgsharp$4='<path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>',svgtwotone$4='<path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>';function instance$8(n,e,t){const s=["size","role","color","variation","ariaLabel"];let a=compute_rest_props(e,s);const c=getContext("iconCtx")??{};let{size:u=c.size||"24"}=e,{role:d=c.role||"img"}=e,{color:m=c.color||"currentColor"}=e,{variation:_=c.variation||"outlined"}=e,b;switch(_){case"filled":b=svgfilled$4;break;case"outlined":b=svgoutlined$4;break;case"round":b=svground$4;break;case"sharp":b=svgsharp$4;break;case"two-tone":b=svgtwotone$4;break;default:b=svgoutlined$4}let{ariaLabel:S="fullscreen exit"}=e;function C(k){bubble.call(this,n,k)}function w(k){bubble.call(this,n,k)}function O(k){bubble.call(this,n,k)}function I(k){bubble.call(this,n,k)}function N(k){bubble.call(this,n,k)}function P(k){bubble.call(this,n,k)}function B(k){bubble.call(this,n,k)}function x(k){bubble.call(this,n,k)}function F(k){bubble.call(this,n,k)}return n.$$set=k=>{e=assign$1(assign$1({},e),exclude_internal_props(k)),t(5,a=compute_rest_props(e,s)),"size"in k&&t(0,u=k.size),"role"in k&&t(1,d=k.role),"color"in k&&t(2,m=k.color),"variation"in k&&t(6,_=k.variation),"ariaLabel"in k&&t(3,S=k.ariaLabel)},[u,d,m,S,b,a,_,C,w,O,I,N,P,B,x,F]}class Fullscreen_exit extends SvelteComponent{constructor(e){super(),init(this,e,instance$8,create_fragment$8,safe_not_equal,{size:0,role:1,color:2,variation:6,ariaLabel:3})}}function create_fragment$7(n){let e,t,s,a,c=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[3]},{viewBox:"0 0 24 24"}],u={};for(let d=0;d<c.length;d+=1)u=assign$1(u,c[d]);return{c(){e=svg_element("svg"),t=new HtmlTagHydration(!0),this.h()},l(d){e=claim_svg_element(d,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var m=children(e);t=claim_html_tag(m,!0),m.forEach(detach),this.h()},h(){t.a=null,set_svg_attributes(e,u)},m(d,m){insert_hydration(d,e,m),t.m(n[4],e),s||(a=[listen(e,"click",n[7]),listen(e,"keydown",n[8]),listen(e,"keyup",n[9]),listen(e,"focus",n[10]),listen(e,"blur",n[11]),listen(e,"mouseenter",n[12]),listen(e,"mouseleave",n[13]),listen(e,"mouseover",n[14]),listen(e,"mouseout",n[15])],s=!0)},p(d,[m]){m&16&&t.p(d[4]),set_svg_attributes(e,u=get_spread_update(c,[{xmlns:"http://www.w3.org/2000/svg"},m&32&&d[5],m&2&&{role:d[1]},m&1&&{width:d[0]},m&1&&{height:d[0]},m&4&&{fill:d[2]},m&8&&{"aria-label":d[3]},{viewBox:"0 0 24 24"}]))},i:noop$3,o:noop$3,d(d){d&&detach(e),s=!1,run_all(a)}}}let svgfilled$3='<path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>',svgoutlined$3='<path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>',svground$3='<path d="M4 18h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zm0-5h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zM3 7c0 .55.45 1 1 1h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1z"/>',svgsharp$3='<path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>',svgtwotone$3='<path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>';function instance$7(n,e,t){const s=["size","role","color","variation","ariaLabel"];let a=compute_rest_props(e,s);const c=getContext("iconCtx")??{};let{size:u=c.size||"24"}=e,{role:d=c.role||"img"}=e,{color:m=c.color||"currentColor"}=e,{variation:_=c.variation||"outlined"}=e,b;switch(_){case"filled":b=svgfilled$3;break;case"outlined":b=svgoutlined$3;break;case"round":b=svground$3;break;case"sharp":b=svgsharp$3;break;case"two-tone":b=svgtwotone$3;break;default:b=svgoutlined$3}let{ariaLabel:S="menu"}=e;function C(k){bubble.call(this,n,k)}function w(k){bubble.call(this,n,k)}function O(k){bubble.call(this,n,k)}function I(k){bubble.call(this,n,k)}function N(k){bubble.call(this,n,k)}function P(k){bubble.call(this,n,k)}function B(k){bubble.call(this,n,k)}function x(k){bubble.call(this,n,k)}function F(k){bubble.call(this,n,k)}return n.$$set=k=>{e=assign$1(assign$1({},e),exclude_internal_props(k)),t(5,a=compute_rest_props(e,s)),"size"in k&&t(0,u=k.size),"role"in k&&t(1,d=k.role),"color"in k&&t(2,m=k.color),"variation"in k&&t(6,_=k.variation),"ariaLabel"in k&&t(3,S=k.ariaLabel)},[u,d,m,S,b,a,_,C,w,O,I,N,P,B,x,F]}class Menu extends SvelteComponent{constructor(e){super(),init(this,e,instance$7,create_fragment$7,safe_not_equal,{size:0,role:1,color:2,variation:6,ariaLabel:3})}}function create_fragment$6(n){let e,t,s,a,c=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[3]},{viewBox:"0 0 24 24"}],u={};for(let d=0;d<c.length;d+=1)u=assign$1(u,c[d]);return{c(){e=svg_element("svg"),t=new HtmlTagHydration(!0),this.h()},l(d){e=claim_svg_element(d,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var m=children(e);t=claim_html_tag(m,!0),m.forEach(detach),this.h()},h(){t.a=null,set_svg_attributes(e,u)},m(d,m){insert_hydration(d,e,m),t.m(n[4],e),s||(a=[listen(e,"click",n[7]),listen(e,"keydown",n[8]),listen(e,"keyup",n[9]),listen(e,"focus",n[10]),listen(e,"blur",n[11]),listen(e,"mouseenter",n[12]),listen(e,"mouseleave",n[13]),listen(e,"mouseover",n[14]),listen(e,"mouseout",n[15])],s=!0)},p(d,[m]){m&16&&t.p(d[4]),set_svg_attributes(e,u=get_spread_update(c,[{xmlns:"http://www.w3.org/2000/svg"},m&32&&d[5],m&2&&{role:d[1]},m&1&&{width:d[0]},m&1&&{height:d[0]},m&4&&{fill:d[2]},m&8&&{"aria-label":d[3]},{viewBox:"0 0 24 24"}]))},i:noop$3,o:noop$3,d(d){d&&detach(e),s=!1,run_all(a)}}}let svgfilled$2='<path d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>',svgoutlined$2='<path d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>',svground$2='<path d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>',svgsharp$2='<path d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>',svgtwotone$2='<path d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>';function instance$6(n,e,t){const s=["size","role","color","variation","ariaLabel"];let a=compute_rest_props(e,s);const c=getContext("iconCtx")??{};let{size:u=c.size||"24"}=e,{role:d=c.role||"img"}=e,{color:m=c.color||"currentColor"}=e,{variation:_=c.variation||"outlined"}=e,b;switch(_){case"filled":b=svgfilled$2;break;case"outlined":b=svgoutlined$2;break;case"round":b=svground$2;break;case"sharp":b=svgsharp$2;break;case"two-tone":b=svgtwotone$2;break;default:b=svgoutlined$2}let{ariaLabel:S="more horiz"}=e;function C(k){bubble.call(this,n,k)}function w(k){bubble.call(this,n,k)}function O(k){bubble.call(this,n,k)}function I(k){bubble.call(this,n,k)}function N(k){bubble.call(this,n,k)}function P(k){bubble.call(this,n,k)}function B(k){bubble.call(this,n,k)}function x(k){bubble.call(this,n,k)}function F(k){bubble.call(this,n,k)}return n.$$set=k=>{e=assign$1(assign$1({},e),exclude_internal_props(k)),t(5,a=compute_rest_props(e,s)),"size"in k&&t(0,u=k.size),"role"in k&&t(1,d=k.role),"color"in k&&t(2,m=k.color),"variation"in k&&t(6,_=k.variation),"ariaLabel"in k&&t(3,S=k.ariaLabel)},[u,d,m,S,b,a,_,C,w,O,I,N,P,B,x,F]}class More_horiz extends SvelteComponent{constructor(e){super(),init(this,e,instance$6,create_fragment$6,safe_not_equal,{size:0,role:1,color:2,variation:6,ariaLabel:3})}}function create_fragment$5(n){let e,t,s,a,c=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[3]},{viewBox:"0 0 24 24"}],u={};for(let d=0;d<c.length;d+=1)u=assign$1(u,c[d]);return{c(){e=svg_element("svg"),t=new HtmlTagHydration(!0),this.h()},l(d){e=claim_svg_element(d,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var m=children(e);t=claim_html_tag(m,!0),m.forEach(detach),this.h()},h(){t.a=null,set_svg_attributes(e,u)},m(d,m){insert_hydration(d,e,m),t.m(n[4],e),s||(a=[listen(e,"click",n[7]),listen(e,"keydown",n[8]),listen(e,"keyup",n[9]),listen(e,"focus",n[10]),listen(e,"blur",n[11]),listen(e,"mouseenter",n[12]),listen(e,"mouseleave",n[13]),listen(e,"mouseover",n[14]),listen(e,"mouseout",n[15])],s=!0)},p(d,[m]){m&16&&t.p(d[4]),set_svg_attributes(e,u=get_spread_update(c,[{xmlns:"http://www.w3.org/2000/svg"},m&32&&d[5],m&2&&{role:d[1]},m&1&&{width:d[0]},m&1&&{height:d[0]},m&4&&{fill:d[2]},m&8&&{"aria-label":d[3]},{viewBox:"0 0 24 24"}]))},i:noop$3,o:noop$3,d(d){d&&detach(e),s=!1,run_all(a)}}}let svgfilled$1='<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>',svgoutlined$1='<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>',svground$1='<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75-.9.92c-.5.51-.86.97-1.04 1.69-.08.32-.13.68-.13 1.14h-2v-.5a3.997 3.997 0 0 1 1.17-2.83l1.24-1.26c.46-.44.68-1.1.55-1.8a1.99 1.99 0 0 0-1.39-1.53c-1.11-.31-2.14.32-2.47 1.27-.12.37-.43.65-.82.65h-.3C8.4 9 8 8.44 8.16 7.88a4.008 4.008 0 0 1 3.23-2.83c1.52-.24 2.97.55 3.87 1.8 1.18 1.63.83 3.38-.19 4.4z"/>',svgsharp$1='<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>',svgtwotone$1='<path d="M12 4c-4.41 0-8 3.59-8 8s3.59 8 8 8 8-3.59 8-8-3.59-8-8-8zm1 14h-2v-2h2v2zm0-3h-2c0-3.25 3-3 3-5 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 2.5-3 2.75-3 5z" opacity=".3"/><path d="M11 16h2v2h-2zm1-14C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"/>';function instance$5(n,e,t){const s=["size","role","color","variation","ariaLabel"];let a=compute_rest_props(e,s);const c=getContext("iconCtx")??{};let{size:u=c.size||"24"}=e,{role:d=c.role||"img"}=e,{color:m=c.color||"currentColor"}=e,{variation:_=c.variation||"outlined"}=e,b;switch(_){case"filled":b=svgfilled$1;break;case"outlined":b=svgoutlined$1;break;case"round":b=svground$1;break;case"sharp":b=svgsharp$1;break;case"two-tone":b=svgtwotone$1;break;default:b=svgoutlined$1}let{ariaLabel:S="help"}=e;function C(k){bubble.call(this,n,k)}function w(k){bubble.call(this,n,k)}function O(k){bubble.call(this,n,k)}function I(k){bubble.call(this,n,k)}function N(k){bubble.call(this,n,k)}function P(k){bubble.call(this,n,k)}function B(k){bubble.call(this,n,k)}function x(k){bubble.call(this,n,k)}function F(k){bubble.call(this,n,k)}return n.$$set=k=>{e=assign$1(assign$1({},e),exclude_internal_props(k)),t(5,a=compute_rest_props(e,s)),"size"in k&&t(0,u=k.size),"role"in k&&t(1,d=k.role),"color"in k&&t(2,m=k.color),"variation"in k&&t(6,_=k.variation),"ariaLabel"in k&&t(3,S=k.ariaLabel)},[u,d,m,S,b,a,_,C,w,O,I,N,P,B,x,F]}class Help extends SvelteComponent{constructor(e){super(),init(this,e,instance$5,create_fragment$5,safe_not_equal,{size:0,role:1,color:2,variation:6,ariaLabel:3})}}function create_fragment$4(n){let e,t,s,a,c=[{xmlns:"http://www.w3.org/2000/svg"},n[5],{role:n[1]},{width:n[0]},{height:n[0]},{fill:n[2]},{"aria-label":n[3]},{viewBox:"0 0 24 24"}],u={};for(let d=0;d<c.length;d+=1)u=assign$1(u,c[d]);return{c(){e=svg_element("svg"),t=new HtmlTagHydration(!0),this.h()},l(d){e=claim_svg_element(d,"svg",{xmlns:!0,role:!0,width:!0,height:!0,fill:!0,"aria-label":!0,viewBox:!0});var m=children(e);t=claim_html_tag(m,!0),m.forEach(detach),this.h()},h(){t.a=null,set_svg_attributes(e,u)},m(d,m){insert_hydration(d,e,m),t.m(n[4],e),s||(a=[listen(e,"click",n[7]),listen(e,"keydown",n[8]),listen(e,"keyup",n[9]),listen(e,"focus",n[10]),listen(e,"blur",n[11]),listen(e,"mouseenter",n[12]),listen(e,"mouseleave",n[13]),listen(e,"mouseover",n[14]),listen(e,"mouseout",n[15])],s=!0)},p(d,[m]){m&16&&t.p(d[4]),set_svg_attributes(e,u=get_spread_update(c,[{xmlns:"http://www.w3.org/2000/svg"},m&32&&d[5],m&2&&{role:d[1]},m&1&&{width:d[0]},m&1&&{height:d[0]},m&4&&{fill:d[2]},m&8&&{"aria-label":d[3]},{viewBox:"0 0 24 24"}]))},i:noop$3,o:noop$3,d(d){d&&detach(e),s=!1,run_all(a)}}}let svgfilled='<path d="M15.73 3H8.27L3 8.27v7.46L8.27 21h7.46L21 15.73V8.27L15.73 3zM17 15.74 15.74 17 12 13.26 8.26 17 7 15.74 10.74 12 7 8.26 8.26 7 12 10.74 15.74 7 17 8.26 13.26 12 17 15.74z"/>',svgoutlined='<path d="M15.73 3H8.27L3 8.27v7.46L8.27 21h7.46L21 15.73V8.27L15.73 3zM19 14.9 14.9 19H9.1L5 14.9V9.1L9.1 5h5.8L19 9.1v5.8zm-4.17-7.14L12 10.59 9.17 7.76 7.76 9.17 10.59 12l-2.83 2.83 1.41 1.41L12 13.41l2.83 2.83 1.41-1.41L13.41 12l2.83-2.83-1.41-1.41z"/>',svground='<path d="M14.9 3H9.1c-.53 0-1.04.21-1.42.59l-4.1 4.1C3.21 8.06 3 8.57 3 9.1v5.8c0 .53.21 1.04.59 1.41l4.1 4.1c.37.38.88.59 1.41.59h5.8c.53 0 1.04-.21 1.41-.59l4.1-4.1c.38-.37.59-.88.59-1.41V9.1c0-.53-.21-1.04-.59-1.41l-4.1-4.1c-.37-.38-.88-.59-1.41-.59zm.64 12.54a.996.996 0 0 1-1.41 0L12 13.41l-2.12 2.12a.996.996 0 1 1-1.41-1.41L10.59 12 8.46 9.88a.996.996 0 1 1 1.41-1.41L12 10.59l2.12-2.12a.996.996 0 1 1 1.41 1.41L13.41 12l2.12 2.12c.4.39.4 1.03.01 1.42z"/>',svgsharp='<path d="M15.73 3H8.27L3 8.27v7.46L8.27 21h7.46L21 15.73V8.27L15.73 3zm.51 11.83-1.41 1.41L12 13.41l-2.83 2.83-1.41-1.41L10.59 12 7.76 9.17l1.41-1.41L12 10.59l2.83-2.83 1.41 1.41L13.41 12l2.83 2.83z"/>',svgtwotone='<path d="M9.1 5 5 9.1v5.8L9.1 19h5.8l4.1-4.1V9.1L14.9 5H9.1zm7.14 9.83-1.41 1.41L12 13.41l-2.83 2.83-1.41-1.41L10.59 12 7.76 9.17l1.41-1.41L12 10.59l2.83-2.83 1.41 1.41L13.41 12l2.83 2.83z" opacity=".3"/><path d="M15.73 3H8.27L3 8.27v7.46L8.27 21h7.46L21 15.73V8.27L15.73 3zM19 14.9 14.9 19H9.1L5 14.9V9.1L9.1 5h5.8L19 9.1v5.8zm-4.17-7.14L12 10.59 9.17 7.76 7.76 9.17 10.59 12l-2.83 2.83 1.41 1.41L12 13.41l2.83 2.83 1.41-1.41L13.41 12l2.83-2.83-1.41-1.41z"/>';function instance$4(n,e,t){const s=["size","role","color","variation","ariaLabel"];let a=compute_rest_props(e,s);const c=getContext("iconCtx")??{};let{size:u=c.size||"24"}=e,{role:d=c.role||"img"}=e,{color:m=c.color||"currentColor"}=e,{variation:_=c.variation||"outlined"}=e,b;switch(_){case"filled":b=svgfilled;break;case"outlined":b=svgoutlined;break;case"round":b=svground;break;case"sharp":b=svgsharp;break;case"two-tone":b=svgtwotone;break;default:b=svgoutlined}let{ariaLabel:S="dangerous"}=e;function C(k){bubble.call(this,n,k)}function w(k){bubble.call(this,n,k)}function O(k){bubble.call(this,n,k)}function I(k){bubble.call(this,n,k)}function N(k){bubble.call(this,n,k)}function P(k){bubble.call(this,n,k)}function B(k){bubble.call(this,n,k)}function x(k){bubble.call(this,n,k)}function F(k){bubble.call(this,n,k)}return n.$$set=k=>{e=assign$1(assign$1({},e),exclude_internal_props(k)),t(5,a=compute_rest_props(e,s)),"size"in k&&t(0,u=k.size),"role"in k&&t(1,d=k.role),"color"in k&&t(2,m=k.color),"variation"in k&&t(6,_=k.variation),"ariaLabel"in k&&t(3,S=k.ariaLabel)},[u,d,m,S,b,a,_,C,w,O,I,N,P,B,x,F]}class Dangerous extends SvelteComponent{constructor(e){super(),init(this,e,instance$4,create_fragment$4,safe_not_equal,{size:0,role:1,color:2,variation:6,ariaLabel:3})}}function get_each_context$1(n,e,t){const s=n.slice();return s[6]=e[t],s}function create_else_block$2(n){let e,t=FlightmodeNameMap[n[6]]+"",s;return{c(){e=element("option"),s=text(t),this.h()},l(a){e=claim_element(a,"OPTION",{});var c=children(e);s=claim_text(c,t),c.forEach(detach),this.h()},h(){e.__value=n[6],set_input_value(e,e.__value)},m(a,c){insert_hydration(a,e,c),append_hydration(e,s)},p:noop$3,d(a){a&&detach(e)}}}function create_if_block$2(n){let e,t;return{c(){e=element("option"),t=text("Flight Mode"),this.h()},l(s){e=claim_element(s,"OPTION",{});var a=children(e);t=claim_text(a,"Flight Mode"),a.forEach(detach),this.h()},h(){e.__value=n[6],set_input_value(e,e.__value),e.disabled=!0},m(s,a){insert_hydration(s,e,a),append_hydration(e,t)},p:noop$3,d(s){s&&detach(e)}}}function create_each_block$1(n){let e;function t(c,u){return c[6]==FlightMode.unknown?create_if_block$2:create_else_block$2}let a=t(n)(n);return{c(){a.c(),e=empty()},l(c){a.l(c),e=empty()},m(c,u){a.m(c,u),insert_hydration(c,e,u)},p(c,u){a.p(c,u)},d(c){c&&detach(e),a.d(c)}}}function create_fragment$3(n){let e,t,s,a,c,u,d,m=ensure_array_like(n[3]),_=[];for(let b=0;b<m.length;b+=1)_[b]=create_each_block$1(get_each_context$1(n,m,b));return a=new Expand_more({props:{class:"absolute right-2 top-1/2 -translate-y-1/2 text-2xl pointer-events-none",tabindex:"-1"}}),{c(){e=element("div"),t=element("select");for(let b=0;b<_.length;b+=1)_[b].c();s=space(),create_component(a.$$.fragment),this.h()},l(b){e=claim_element(b,"DIV",{class:!0});var S=children(e);t=claim_element(S,"SELECT",{class:!0});var C=children(t);for(let w=0;w<_.length;w+=1)_[w].l(C);C.forEach(detach),s=claim_space(S),claim_component(a.$$.fragment,S),S.forEach(detach),this.h()},h(){t.disabled=n[1],attr(t,"class","select variant-outline-primary appearance-none md:pl-4"),attr(e,"class","rounded-full bg-slate-50 relative mx-2 mr-4")},m(b,S){insert_hydration(b,e,S),append_hydration(e,t);for(let C=0;C<_.length;C+=1)_[C]&&_[C].m(t,null);select_option(t,n[0]),append_hydration(e,s),mount_component(a,e,null),c=!0,u||(d=listen(t,"change",n[5]),u=!0)},p(b,[S]){if(S&8){m=ensure_array_like(b[3]);let C;for(C=0;C<m.length;C+=1){const w=get_each_context$1(b,m,C);_[C]?_[C].p(w,S):(_[C]=create_each_block$1(w),_[C].c(),_[C].m(t,null))}for(;C<_.length;C+=1)_[C].d(1);_.length=m.length}(!c||S&2)&&(t.disabled=b[1]),(!c||S&9)&&select_option(t,b[0])},i(b){c||(transition_in(a.$$.fragment,b),c=!0)},o(b){transition_out(a.$$.fragment,b),c=!1},d(b){b&&detach(e),destroy_each(_,b),destroy_component(a),u=!1,d()}}}function instance$3(n,e,t){let s;component_subscribe(n,autopilotMode,_=>t(4,s=_));let{disabled:a=!1}=e,{selectedMode:c=FlightMode.unknown}=e,u=_=>{const b=parseInt(_);console.log("Flightmode change: ",b),autopilotMode.set(FlightMode.unknown),RovActions.setFlightMode(b)},d=Object.values(FlightMode).filter(_=>typeof _=="number");const m=_=>u(_.currentTarget.value);return n.$$set=_=>{"disabled"in _&&t(1,a=_.disabled),"selectedMode"in _&&t(0,c=_.selectedMode)},n.$$.update=()=>{n.$$.dirty&16&&t(0,c=s)},[c,a,u,d,s,m]}class FlightModeSelector extends SvelteComponent{constructor(e){super(),init(this,e,instance$3,create_fragment$3,safe_not_equal,{disabled:1,selectedMode:0})}}function create_else_block_2(n){let e,t,s,a,c,u,d,m;return t=new Power_settings_new({props:{class:"text-2xl pointer-events-none",tabindex:"-1",variation:"round"}}),a=new More_horiz({props:{class:"text-2xl pointer-events-none",tabindex:"-1",variation:"round"}}),{c(){e=element("button"),create_component(t.$$.fragment),s=space(),create_component(a.$$.fragment),this.h()},l(_){e=claim_element(_,"BUTTON",{class:!0});var b=children(e);claim_component(t.$$.fragment,b),s=claim_space(b),claim_component(a.$$.fragment,b),b.forEach(detach),this.h()},h(){e.disabled=c=!n[1],attr(e,"class","btn variant-filled-primary")},m(_,b){insert_hydration(_,e,b),mount_component(t,e,null),append_hydration(e,s),mount_component(a,e,null),u=!0,d||(m=listen(e,"click",n[17]),d=!0)},p(_,b){(!u||b&2&&c!==(c=!_[1]))&&(e.disabled=c)},i(_){u||(transition_in(t.$$.fragment,_),transition_in(a.$$.fragment,_),u=!0)},o(_){transition_out(t.$$.fragment,_),transition_out(a.$$.fragment,_),u=!1},d(_){_&&detach(e),destroy_component(t),destroy_component(a),d=!1,m()}}}function create_if_block_2(n){let e,t,s,a,c,u,d,m,_,b,S,C,w,O,I,N,P,B;return s=new Close({props:{class:"text-2xl  pointer-events-none",tabindex:"-1",variation:"round"}}),u=new Power_settings_new({props:{class:"text-2xl pointer-events-none",tabindex:"-1",variation:"round"}}),_=new Restart_alt({props:{class:"text-2xl pointer-events-none",tabindex:"-1",variation:"round"}}),C=new Info({props:{class:"text-2xl pointer-events-none",tabindex:"-1",variation:"round"}}),I=new System_update({props:{class:"text-2xl pointer-events-none",tabindex:"-1",variation:"round"}}),{c(){e=element("div"),t=element("button"),create_component(s.$$.fragment),a=space(),c=element("button"),create_component(u.$$.fragment),d=space(),m=element("button"),create_component(_.$$.fragment),b=space(),S=element("button"),create_component(C.$$.fragment),w=space(),O=element("button"),create_component(I.$$.fragment),this.h()},l(x){e=claim_element(x,"DIV",{class:!0});var F=children(e);t=claim_element(F,"BUTTON",{});var k=children(t);claim_component(s.$$.fragment,k),k.forEach(detach),a=claim_space(F),c=claim_element(F,"BUTTON",{class:!0});var J=children(c);claim_component(u.$$.fragment,J),J.forEach(detach),d=claim_space(F),m=claim_element(F,"BUTTON",{class:!0});var z=children(m);claim_component(_.$$.fragment,z),z.forEach(detach),b=claim_space(F),S=claim_element(F,"BUTTON",{class:!0});var H=children(S);claim_component(C.$$.fragment,H),H.forEach(detach),w=claim_space(F),O=claim_element(F,"BUTTON",{class:!0});var W=children(O);claim_component(I.$$.fragment,W),W.forEach(detach),F.forEach(detach),this.h()},h(){attr(c,"class","variant-filled-secondary"),attr(m,"class","variant-filled-secondary"),attr(S,"class","variant-filled-secondary"),attr(O,"class","variant-filled-secondary"),attr(e,"class","btn-group variant-filled-primary justify-evenly relative")},m(x,F){insert_hydration(x,e,F),append_hydration(e,t),mount_component(s,t,null),append_hydration(e,a),append_hydration(e,c),mount_component(u,c,null),append_hydration(e,d),append_hydration(e,m),mount_component(_,m,null),append_hydration(e,b),append_hydration(e,S),mount_component(C,S,null),append_hydration(e,w),append_hydration(e,O),mount_component(I,O,null),N=!0,P||(B=[listen(t,"click",n[12]),listen(c,"click",n[13]),listen(m,"click",n[14]),listen(S,"click",n[15]),listen(O,"click",n[16])],P=!0)},p:noop$3,i(x){N||(transition_in(s.$$.fragment,x),transition_in(u.$$.fragment,x),transition_in(_.$$.fragment,x),transition_in(C.$$.fragment,x),transition_in(I.$$.fragment,x),N=!0)},o(x){transition_out(s.$$.fragment,x),transition_out(u.$$.fragment,x),transition_out(_.$$.fragment,x),transition_out(C.$$.fragment,x),transition_out(I.$$.fragment,x),N=!1},d(x){x&&detach(e),destroy_component(s),destroy_component(u),destroy_component(_),destroy_component(C),destroy_component(I),P=!1,run_all(B)}}}function create_lead_slot(n){let e,t,s,a,c,u,d,m,_,b,S,C;t=new Menu({props:{class:"text-2xl pointer-events-none",tabindex:"-1",variation:"round"}}),c=new FlightModeSelector({props:{disabled:!n[1]}});const w=[create_if_block_2,create_else_block_2],O=[];function I(N,P){return N[0]&&N[1]?0:1}return m=I(n),_=O[m]=w[m](n),{c(){e=element("button"),create_component(t.$$.fragment),a=space(),create_component(c.$$.fragment),u=space(),d=element("div"),_.c(),this.h()},l(N){e=claim_element(N,"BUTTON",{class:!0});var P=children(e);claim_component(t.$$.fragment,P),P.forEach(detach),a=claim_space(N),claim_component(c.$$.fragment,N),u=claim_space(N),d=claim_element(N,"DIV",{class:!0,style:!0});var B=children(d);_.l(B),B.forEach(detach),this.h()},h(){e.disabled=s=!n[1],attr(e,"class","btn btn-lg btn-icon bg-initial lg:hidden"),attr(d,"class","overflow-visible"),set_style(d,"max-width","4em")},m(N,P){insert_hydration(N,e,P),mount_component(t,e,null),insert_hydration(N,a,P),mount_component(c,N,P),insert_hydration(N,u,P),insert_hydration(N,d,P),O[m].m(d,null),b=!0,S||(C=listen(e,"click",n[6]),S=!0)},p(N,P){(!b||P&2&&s!==(s=!N[1]))&&(e.disabled=s);const B={};P&2&&(B.disabled=!N[1]),c.$set(B);let x=m;m=I(N),m===x?O[m].p(N,P):(group_outros(),transition_out(O[x],1,1,()=>{O[x]=null}),check_outros(),_=O[m],_?_.p(N,P):(_=O[m]=w[m](N),_.c()),transition_in(_,1),_.m(d,null))},i(N){b||(transition_in(t.$$.fragment,N),transition_in(c.$$.fragment,N),transition_in(_),b=!0)},o(N){transition_out(t.$$.fragment,N),transition_out(c.$$.fragment,N),transition_out(_),b=!1},d(N){N&&(detach(e),detach(a),detach(u),detach(d)),destroy_component(t),destroy_component(c,N),O[m].d(),S=!1,C()}}}function create_default_slot$1(n){let e,t;return e=new CompassDial({props:{class:"w-full flex-auto -z-10"}}),{c(){create_component(e.$$.fragment)},l(s){claim_component(e.$$.fragment,s)},m(s,a){mount_component(e,s,a),t=!0},p:noop$3,i(s){t||(transition_in(e.$$.fragment,s),t=!0)},o(s){transition_out(e.$$.fragment,s),t=!1},d(s){destroy_component(e,s)}}}function create_else_block_1(n){let e,t,s="GO",a,c,u="Enable Thrusters",d,m,_;return{c(){e=element("button"),t=element("span"),t.textContent=s,a=space(),c=element("span"),c.textContent=u,this.h()},l(b){e=claim_element(b,"BUTTON",{class:!0});var S=children(e);t=claim_element(S,"SPAN",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(t)!=="svelte-ywhe5a"&&(t.textContent=s),a=claim_space(S),c=claim_element(S,"SPAN",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(c)!=="svelte-1ig7gwa"&&(c.textContent=u),S.forEach(detach),this.h()},h(){attr(t,"class","block text-2xl -my-2 pointer-events-none font-mono font-bold"),attr(c,"class","hidden lg:inline"),e.disabled=d=!n[1],attr(e,"class","variant-filled-success max-lg:btn-icon lg:btn btn-base")},m(b,S){insert_hydration(b,e,S),append_hydration(e,t),append_hydration(e,a),append_hydration(e,c),m||(_=listen(e,"click",n[8]),m=!0)},p(b,S){S&2&&d!==(d=!b[1])&&(e.disabled=d)},i:noop$3,o:noop$3,d(b){b&&detach(e),m=!1,_()}}}function create_if_block_1$1(n){let e,t,s,a,c="Halt Thrusters",u,d,m,_;return t=new Dangerous({props:{class:"block text-2xl pointer-events-none",tabindex:"-1",variation:"round"}}),{c(){e=element("button"),create_component(t.$$.fragment),s=space(),a=element("span"),a.textContent=c,this.h()},l(b){e=claim_element(b,"BUTTON",{class:!0});var S=children(e);claim_component(t.$$.fragment,S),s=claim_space(S),a=claim_element(S,"SPAN",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(a)!=="svelte-1al6m2m"&&(a.textContent=c),S.forEach(detach),this.h()},h(){attr(a,"class","hidden lg:inline"),e.disabled=u=!n[1],attr(e,"class","variant-filled-error max-lg:btn-icon lg:btn btn-base")},m(b,S){insert_hydration(b,e,S),mount_component(t,e,null),append_hydration(e,s),append_hydration(e,a),d=!0,m||(_=listen(e,"click",n[7]),m=!0)},p(b,S){(!d||S&2&&u!==(u=!b[1]))&&(e.disabled=u)},i(b){d||(transition_in(t.$$.fragment,b),d=!0)},o(b){transition_out(t.$$.fragment,b),d=!1},d(b){b&&detach(e),destroy_component(t),m=!1,_()}}}function create_else_block$1(n){let e,t;return e=new Fullscreen({props:{class:"text-2xl pointer-events-none",tabindex:"-1",variation:"round"}}),{c(){create_component(e.$$.fragment)},l(s){claim_component(e.$$.fragment,s)},m(s,a){mount_component(e,s,a),t=!0},i(s){t||(transition_in(e.$$.fragment,s),t=!0)},o(s){transition_out(e.$$.fragment,s),t=!1},d(s){destroy_component(e,s)}}}function create_if_block$1(n){let e,t;return e=new Fullscreen_exit({props:{class:"text-2xl pointer-events-none",tabindex:"-1",variation:"round"}}),{c(){create_component(e.$$.fragment)},l(s){claim_component(e.$$.fragment,s)},m(s,a){mount_component(e,s,a),t=!0},i(s){t||(transition_in(e.$$.fragment,s),t=!0)},o(s){transition_out(e.$$.fragment,s),t=!1},d(s){destroy_component(e,s)}}}function create_trail_slot(n){let e,t,s,a,c,u,d="Help",m,_,b,S,C,w,O;const I=[create_if_block_1$1,create_else_block_1],N=[];function P(k,J){return k[2]?0:1}e=P(n),t=N[e]=I[e](n),c=new Help({props:{class:"text-2xl pointer-events-none",tabindex:"-1",variation:"round"}});const B=[create_if_block$1,create_else_block$1],x=[];function F(k,J){return k[3]?0:1}return b=F(n),S=x[b]=B[b](n),{c(){t.c(),s=space(),a=element("button"),create_component(c.$$.fragment),u=element("span"),u.textContent=d,m=space(),_=element("button"),S.c(),this.h()},l(k){t.l(k),s=claim_space(k),a=claim_element(k,"BUTTON",{class:!0});var J=children(a);claim_component(c.$$.fragment,J),u=claim_element(J,"SPAN",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(u)!=="svelte-drr3ws"&&(u.textContent=d),J.forEach(detach),m=claim_space(k),_=claim_element(k,"BUTTON",{class:!0});var z=children(_);S.l(z),z.forEach(detach),this.h()},h(){attr(u,"class","hidden lg:inline"),attr(a,"class","max-lg:btn-icon lg:btn variant-filled-secondary text-white btn-base"),attr(_,"class","btn btn-lg btn-icon bg-initial")},m(k,J){N[e].m(k,J),insert_hydration(k,s,J),insert_hydration(k,a,J),mount_component(c,a,null),append_hydration(a,u),insert_hydration(k,m,J),insert_hydration(k,_,J),x[b].m(_,null),C=!0,w||(O=listen(_,"click",n[11]),w=!0)},p(k,J){let z=e;e=P(k),e===z?N[e].p(k,J):(group_outros(),transition_out(N[z],1,1,()=>{N[z]=null}),check_outros(),t=N[e],t?t.p(k,J):(t=N[e]=I[e](k),t.c()),transition_in(t,1),t.m(s.parentNode,s));let H=b;b=F(k),b!==H&&(group_outros(),transition_out(x[H],1,1,()=>{x[H]=null}),check_outros(),S=x[b],S||(S=x[b]=B[b](k),S.c()),transition_in(S,1),S.m(_,null))},i(k){C||(transition_in(t),transition_in(c.$$.fragment,k),transition_in(S),C=!0)},o(k){transition_out(t),transition_out(c.$$.fragment,k),transition_out(S),C=!1},d(k){k&&(detach(s),detach(a),detach(m),detach(_)),N[e].d(k),destroy_component(c),x[b].d(),w=!1,O()}}}function create_fragment$2(n){let e,t;return e=new AppBar({props:{padding:"p-2",class:"overflow-visible",background:"bg-transparent",slotDefault:"flex justify-around overflow-visible min-w-0",$$slots:{trail:[create_trail_slot],default:[create_default_slot$1],lead:[create_lead_slot]},$$scope:{ctx:n}}}),{c(){create_component(e.$$.fragment)},l(s){claim_component(e.$$.fragment,s)},m(s,a){mount_component(e,s,a),t=!0},p(s,[a]){const c={};a&4194319&&(c.$$scope={dirty:a,ctx:s}),e.$set(c)},i(s){t||(transition_in(e.$$.fragment,s),t=!0)},o(s){transition_out(e.$$.fragment,s),t=!1},d(s){destroy_component(e,s)}}}function instance$2(n,e,t){let s,a,c,u,d;component_subscribe(n,autopilotArmed,J=>t(2,u=J)),component_subscribe(n,fullscreenOpen,J=>t(3,d=J));const m=frontendConnMngr.currentVideoStreamMethod;component_subscribe(n,m,J=>t(10,c=J));const _=frontendConnMngr.connectionState;component_subscribe(n,_,J=>t(9,a=J));const b=getDrawerStore(),S=()=>b.open();let C=!1;const w=()=>{RovActions.disarm()},O=()=>{RovActions.takeControl()},I=J=>{toggleFullscreen(J,null)},N=()=>t(0,C=!1),P=()=>{RovActions.shutdownRov(),t(0,C=!1)},B=()=>{RovActions.rebootRov(),t(0,C=!1)},x=()=>{RovActions.getRovStatusReport(),t(0,C=!1)},F=()=>{RovActions.restartRovServices(),t(0,C=!1)},k=()=>t(0,C=!0);return n.$$.update=()=>{n.$$.dirty&1024&&VideoStreamMethod.simplepeer,n.$$.dirty&512&&t(1,s=a===ConnectionStates.connected)},[C,s,u,d,m,_,S,w,O,a,c,I,N,P,B,x,F,k]}class Topbar extends SvelteComponent{constructor(e){super(),init(this,e,instance$2,create_fragment$2,safe_not_equal,{})}}const RovSelector_svelte_svelte_type_style_lang="";function get_each_context(n,e,t){const s=n.slice();return s[12]=e[t],s}function create_else_block(n){let e,t,s,a,c,u,d,m,_,b,S,C=n[1]?"Disconnect":"Connect",w,O,I,N;return{c(){e=element("span"),t=element("p"),s=text(n[0]),a=space(),c=element("p"),u=text("You Are: "),d=element("span"),m=text(n[3]),_=space(),b=element("button"),S=element("span"),w=text(C),this.h()},l(P){e=claim_element(P,"SPAN",{class:!0});var B=children(e);t=claim_element(B,"P",{class:!0});var x=children(t);s=claim_text(x,n[0]),x.forEach(detach),a=claim_space(B),c=claim_element(B,"P",{class:!0});var F=children(c);u=claim_text(F,"You Are: "),d=claim_element(F,"SPAN",{class:!0});var k=children(d);m=claim_text(k,n[3]),k.forEach(detach),F.forEach(detach),B.forEach(detach),_=claim_space(P),b=claim_element(P,"BUTTON",{class:!0});var J=children(b);S=claim_element(J,"SPAN",{class:!0});var z=children(S);w=claim_text(z,C),z.forEach(detach),J.forEach(detach),this.h()},h(){attr(t,"class","m-0 p-0 font-bold"),attr(d,"class","font-bold"),attr(c,"class","m-0 p-0 text-primary-200"),attr(e,"class","px-3 align-middle text-right text-white"),attr(S,"class","whitespace-nowrap inline"),attr(b,"class","btn mr-3 btn-md variant-filled-error align-top")},m(P,B){insert_hydration(P,e,B),append_hydration(e,t),append_hydration(t,s),append_hydration(e,a),append_hydration(e,c),append_hydration(c,u),append_hydration(c,d),append_hydration(d,m),insert_hydration(P,_,B),insert_hydration(P,b,B),append_hydration(b,S),append_hydration(S,w),I||(N=listen(b,"click",n[11]),I=!0)},p(P,B){B&1&&set_data(s,P[0]),B&8&&set_data(m,P[3]),B&2&&C!==(C=P[1]?"Disconnect":"Connect")&&set_data(w,C)},i(P){P&&(O||add_render_callback(()=>{O=create_in_transition(b,fade,{}),O.start()}))},o:noop$3,d(P){P&&(detach(e),detach(_),detach(b)),I=!1,N()}}}function create_if_block_1(n){let e,t="Connect to a ROV:",s,a,c,u=ensure_array_like(n[2]),d=[];for(let _=0;_<u.length;_+=1)d[_]=create_each_block(get_each_context(n,u,_));const m=_=>transition_out(d[_],1,1,()=>{d[_]=null});return{c(){e=element("h2"),e.textContent=t,s=space(),a=element("div");for(let _=0;_<d.length;_+=1)d[_].c();this.h()},l(_){e=claim_element(_,"H2",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(e)!=="svelte-1tnk2i1"&&(e.textContent=t),s=claim_space(_),a=claim_element(_,"DIV",{class:!0});var b=children(a);for(let S=0;S<d.length;S+=1)d[S].l(b);b.forEach(detach),this.h()},h(){attr(e,"class","text-center py-4 px-6 font-bold"),attr(a,"class","flex flex-col align-stretch overflow-y-auto w-full p-3 pt-0")},m(_,b){insert_hydration(_,e,b),insert_hydration(_,s,b),insert_hydration(_,a,b);for(let S=0;S<d.length;S+=1)d[S]&&d[S].m(a,null);c=!0},p(_,b){if(b&132){u=ensure_array_like(_[2]);let S;for(S=0;S<u.length;S+=1){const C=get_each_context(_,u,S);d[S]?(d[S].p(C,b),transition_in(d[S],1)):(d[S]=create_each_block(C),d[S].c(),transition_in(d[S],1),d[S].m(a,null))}for(group_outros(),S=u.length;S<d.length;S+=1)m(S);check_outros()}},i(_){if(!c){for(let b=0;b<u.length;b+=1)transition_in(d[b]);c=!0}},o(_){d=d.filter(Boolean);for(let b=0;b<d.length;b+=1)transition_out(d[b]);c=!1},d(_){_&&(detach(e),detach(s),detach(a)),destroy_each(d,_)}}}function create_if_block(n){let e,t="Searching for online ROVs...";return{c(){e=element("h2"),e.textContent=t,this.h()},l(s){e=claim_element(s,"H2",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(e)!=="svelte-15o12co"&&(e.textContent=t),this.h()},h(){attr(e,"class","text-center py-4 px-6 font-bold")},m(s,a){insert_hydration(s,e,a)},p:noop$3,i:noop$3,o:noop$3,d(s){s&&detach(e)}}}function create_each_block(n){let e,t=n[12].name+"",s,a,c,u,d,m,_,b,S;c=new Chevron_right({props:{variant:"round",class:"text-2xl inline-block pointer-events-none",tabindex:"-1"}});function C(){return n[10](n[12])}return{c(){e=element("button"),s=text(t),a=space(),create_component(c.$$.fragment),u=space(),this.h()},l(w){e=claim_element(w,"BUTTON",{class:!0});var O=children(e);s=claim_text(O,t),a=claim_space(O),claim_component(c.$$.fragment,O),u=claim_space(O),O.forEach(detach),this.h()},h(){e.disabled=d=!n[12].token,attr(e,"class","btn ring-white variant-filled-primary align-top block m-1")},m(w,O){insert_hydration(w,e,O),append_hydration(e,s),append_hydration(e,a),mount_component(c,e,null),append_hydration(e,u),_=!0,b||(S=listen(e,"click",C),b=!0)},p(w,O){n=w,(!_||O&4)&&t!==(t=n[12].name+"")&&set_data(s,t),(!_||O&4&&d!==(d=!n[12].token))&&(e.disabled=d)},i(w){_||(transition_in(c.$$.fragment,w),w&&(m||add_render_callback(()=>{m=create_in_transition(e,fade,{}),m.start()})),_=!0)},o(w){transition_out(c.$$.fragment,w),_=!1},d(w){w&&detach(e),destroy_component(c),b=!1,S()}}}function create_fragment$1(n){let e,t,s,a,c,u,d;const m=[create_if_block,create_if_block_1,create_else_block],_=[];function b(S,C){return S[2].length==0?0:S[1]?2:1}return s=b(n),a=_[s]=m[s](n),{c(){e=element("div"),t=element("div"),a.c(),this.h()},l(S){e=claim_element(S,"DIV",{id:!0,class:!0});var C=children(e);t=claim_element(C,"DIV",{class:!0});var w=children(t);a.l(w),w.forEach(detach),C.forEach(detach),this.h()},h(){attr(t,"class",c=` bg-surface-700 border-2 border-surface-500 m-0 items-center flex whitespace-nowrap text-center rounded-xl max-h-full  ${n[1]?"rounded-b-none border-b-0":"flex-col shadow-2xl"}`),toggle_class(t,"p-1",n[1]),attr(e,"id","rov_chooser"),attr(e,"class",u=null_to_empty(`absolute left-1/2 bottom-0  -translate-x-1/2 transition-all overflow-visible z-50  ${n[1]?" ":"disconnected  top-0"} `)+" svelte-1simma4")},m(S,C){insert_hydration(S,e,C),append_hydration(e,t),_[s].m(t,null),d=!0},p(S,[C]){let w=s;s=b(S),s===w?_[s].p(S,C):(group_outros(),transition_out(_[w],1,1,()=>{_[w]=null}),check_outros(),a=_[s],a?a.p(S,C):(a=_[s]=m[s](S),a.c()),transition_in(a,1),a.m(t,null)),(!d||C&2&&c!==(c=` bg-surface-700 border-2 border-surface-500 m-0 items-center flex whitespace-nowrap text-center rounded-xl max-h-full  ${S[1]?"rounded-b-none border-b-0":"flex-col shadow-2xl"}`))&&attr(t,"class",c),(!d||C&2)&&toggle_class(t,"p-1",S[1]),(!d||C&2&&u!==(u=null_to_empty(`absolute left-1/2 bottom-0  -translate-x-1/2 transition-all overflow-visible z-50  ${S[1]?" ":"disconnected  top-0"} `)+" svelte-1simma4"))&&attr(e,"class",u)},i(S){d||(transition_in(a),d=!0)},o(S){transition_out(a),d=!1},d(S){S&&detach(e),_[s].d()}}}function instance$1(n,e,t){let s,a,c,u,{selectedRov:d=""}=e;const m=frontendConnMngr.connectionState;component_subscribe(n,m,I=>t(9,a=I));const _=frontendConnMngr.openLivekitRoomInfo;component_subscribe(n,_,I=>t(2,c=I));const b=frontendConnMngr.currentLivekitIdentity;component_subscribe(n,b,I=>t(3,u=I));async function S(I){if(!I.token)return showToastMessage("ROV is not available at the moment. Please wait & try again.",5e3,!1,ToastSeverity.error);t(0,d=I.name);let N="";if(I.token.encrypted){t(0,d=I.name);const P=I.token.salt,B=I.token.iv;for(;;){await waitfor(200);const x=await modalPasswordPrompt("Enter ROV Password");if(!x)return;try{const F=await decrypt(I.token.token,P,B,x);if(console.log('Decrypted Token:"'+F+'"',I.name),!F||!F.startsWith(ENCRYPTED_AUTH_TOKEN_PREFIX)){showToastMessage("Incorrect password. Please try again.",2e3,!1,ToastSeverity.warning);continue}showToastMessage("Password accepted. Connecting...",2e3,!1,ToastSeverity.success),N=F.substring(ENCRYPTED_AUTH_TOKEN_PREFIX.length);break}catch(F){console.error("Token Decryption Failure:",F),showToastMessage("Incorrect password. Please try again. (Token Decryption Failure)",2e3,!1,ToastSeverity.warning);continue}}}else N=I.token.token;frontendConnMngr.connectToLivekitRoom(I.name,N)}function C(){frontendConnMngr.disconnect(),t(0,d="")}const w=I=>S(I),O=()=>C();return n.$$set=I=>{"selectedRov"in I&&t(0,d=I.selectedRov)},n.$$.update=()=>{n.$$.dirty&513&&t(1,s=d!=""&&a!==ConnectionStates.disconnectedOk&&a!==ConnectionStates.failed)},[d,s,c,u,m,_,b,S,C,a,w,O]}class RovSelector extends SvelteComponent{constructor(e){super(),init(this,e,instance$1,create_fragment$1,safe_not_equal,{selectedRov:0})}}const sides=["top","right","bottom","left"],alignments=["start","end"],placements=sides.reduce((n,e)=>n.concat(e,e+"-"+alignments[0],e+"-"+alignments[1]),[]),min=Math.min,max=Math.max,round=Math.round,floor=Math.floor,createCoords=n=>({x:n,y:n}),oppositeSideMap={left:"right",right:"left",bottom:"top",top:"bottom"},oppositeAlignmentMap={start:"end",end:"start"};function clamp(n,e,t){return max(n,min(e,t))}function evaluate(n,e){return typeof n=="function"?n(e):n}function getSide(n){return n.split("-")[0]}function getAlignment(n){return n.split("-")[1]}function getOppositeAxis(n){return n==="x"?"y":"x"}function getAxisLength(n){return n==="y"?"height":"width"}function getSideAxis(n){return["top","bottom"].includes(getSide(n))?"y":"x"}function getAlignmentAxis(n){return getOppositeAxis(getSideAxis(n))}function getAlignmentSides(n,e,t){t===void 0&&(t=!1);const s=getAlignment(n),a=getAlignmentAxis(n),c=getAxisLength(a);let u=a==="x"?s===(t?"end":"start")?"right":"left":s==="start"?"bottom":"top";return e.reference[c]>e.floating[c]&&(u=getOppositePlacement(u)),[u,getOppositePlacement(u)]}function getExpandedPlacements(n){const e=getOppositePlacement(n);return[getOppositeAlignmentPlacement(n),e,getOppositeAlignmentPlacement(e)]}function getOppositeAlignmentPlacement(n){return n.replace(/start|end/g,e=>oppositeAlignmentMap[e])}function getSideList(n,e,t){const s=["left","right"],a=["right","left"],c=["top","bottom"],u=["bottom","top"];switch(n){case"top":case"bottom":return t?e?a:s:e?s:a;case"left":case"right":return e?c:u;default:return[]}}function getOppositeAxisPlacements(n,e,t,s){const a=getAlignment(n);let c=getSideList(getSide(n),t==="start",s);return a&&(c=c.map(u=>u+"-"+a),e&&(c=c.concat(c.map(getOppositeAlignmentPlacement)))),c}function getOppositePlacement(n){return n.replace(/left|right|bottom|top/g,e=>oppositeSideMap[e])}function expandPaddingObject(n){return{top:0,right:0,bottom:0,left:0,...n}}function getPaddingObject(n){return typeof n!="number"?expandPaddingObject(n):{top:n,right:n,bottom:n,left:n}}function rectToClientRect(n){return{...n,top:n.y,left:n.x,right:n.x+n.width,bottom:n.y+n.height}}function computeCoordsFromPlacement(n,e,t){let{reference:s,floating:a}=n;const c=getSideAxis(e),u=getAlignmentAxis(e),d=getAxisLength(u),m=getSide(e),_=c==="y",b=s.x+s.width/2-a.width/2,S=s.y+s.height/2-a.height/2,C=s[d]/2-a[d]/2;let w;switch(m){case"top":w={x:b,y:s.y-a.height};break;case"bottom":w={x:b,y:s.y+s.height};break;case"right":w={x:s.x+s.width,y:S};break;case"left":w={x:s.x-a.width,y:S};break;default:w={x:s.x,y:s.y}}switch(getAlignment(e)){case"start":w[u]-=C*(t&&_?-1:1);break;case"end":w[u]+=C*(t&&_?-1:1);break}return w}const computePosition$1=async(n,e,t)=>{const{placement:s="bottom",strategy:a="absolute",middleware:c=[],platform:u}=t,d=c.filter(Boolean),m=await(u.isRTL==null?void 0:u.isRTL(e));let _=await u.getElementRects({reference:n,floating:e,strategy:a}),{x:b,y:S}=computeCoordsFromPlacement(_,s,m),C=s,w={},O=0;for(let I=0;I<d.length;I++){const{name:N,fn:P}=d[I],{x:B,y:x,data:F,reset:k}=await P({x:b,y:S,initialPlacement:s,placement:C,strategy:a,middlewareData:w,rects:_,platform:u,elements:{reference:n,floating:e}});if(b=B??b,S=x??S,w={...w,[N]:{...w[N],...F}},k&&O<=50){O++,typeof k=="object"&&(k.placement&&(C=k.placement),k.rects&&(_=k.rects===!0?await u.getElementRects({reference:n,floating:e,strategy:a}):k.rects),{x:b,y:S}=computeCoordsFromPlacement(_,C,m)),I=-1;continue}}return{x:b,y:S,placement:C,strategy:a,middlewareData:w}};async function detectOverflow(n,e){var t;e===void 0&&(e={});const{x:s,y:a,platform:c,rects:u,elements:d,strategy:m}=n,{boundary:_="clippingAncestors",rootBoundary:b="viewport",elementContext:S="floating",altBoundary:C=!1,padding:w=0}=evaluate(e,n),O=getPaddingObject(w),N=d[C?S==="floating"?"reference":"floating":S],P=rectToClientRect(await c.getClippingRect({element:(t=await(c.isElement==null?void 0:c.isElement(N)))==null||t?N:N.contextElement||await(c.getDocumentElement==null?void 0:c.getDocumentElement(d.floating)),boundary:_,rootBoundary:b,strategy:m})),B=S==="floating"?{...u.floating,x:s,y:a}:u.reference,x=await(c.getOffsetParent==null?void 0:c.getOffsetParent(d.floating)),F=await(c.isElement==null?void 0:c.isElement(x))?await(c.getScale==null?void 0:c.getScale(x))||{x:1,y:1}:{x:1,y:1},k=rectToClientRect(c.convertOffsetParentRelativeRectToViewportRelativeRect?await c.convertOffsetParentRelativeRectToViewportRelativeRect({rect:B,offsetParent:x,strategy:m}):B);return{top:(P.top-k.top+O.top)/F.y,bottom:(k.bottom-P.bottom+O.bottom)/F.y,left:(P.left-k.left+O.left)/F.x,right:(k.right-P.right+O.right)/F.x}}const arrow=n=>({name:"arrow",options:n,async fn(e){const{x:t,y:s,placement:a,rects:c,platform:u,elements:d,middlewareData:m}=e,{element:_,padding:b=0}=evaluate(n,e)||{};if(_==null)return{};const S=getPaddingObject(b),C={x:t,y:s},w=getAlignmentAxis(a),O=getAxisLength(w),I=await u.getDimensions(_),N=w==="y",P=N?"top":"left",B=N?"bottom":"right",x=N?"clientHeight":"clientWidth",F=c.reference[O]+c.reference[w]-C[w]-c.floating[O],k=C[w]-c.reference[w],J=await(u.getOffsetParent==null?void 0:u.getOffsetParent(_));let z=J?J[x]:0;(!z||!await(u.isElement==null?void 0:u.isElement(J)))&&(z=d.floating[x]||c.floating[O]);const H=F/2-k/2,W=z/2-I[O]/2-1,X=min(S[P],W),se=min(S[B],W),re=X,ue=z-I[O]-se,de=z/2-I[O]/2+H,he=clamp(re,de,ue),me=!m.arrow&&getAlignment(a)!=null&&de!=he&&c.reference[O]/2-(de<re?X:se)-I[O]/2<0,le=me?de<re?de-re:de-ue:0;return{[w]:C[w]+le,data:{[w]:he,centerOffset:de-he-le,...me&&{alignmentOffset:le}},reset:me}}});function getPlacementList(n,e,t){return(n?[...t.filter(a=>getAlignment(a)===n),...t.filter(a=>getAlignment(a)!==n)]:t.filter(a=>getSide(a)===a)).filter(a=>n?getAlignment(a)===n||(e?getOppositeAlignmentPlacement(a)!==a:!1):!0)}const autoPlacement=function(n){return n===void 0&&(n={}),{name:"autoPlacement",options:n,async fn(e){var t,s,a;const{rects:c,middlewareData:u,placement:d,platform:m,elements:_}=e,{crossAxis:b=!1,alignment:S,allowedPlacements:C=placements,autoAlignment:w=!0,...O}=evaluate(n,e),I=S!==void 0||C===placements?getPlacementList(S||null,w,C):C,N=await detectOverflow(e,O),P=((t=u.autoPlacement)==null?void 0:t.index)||0,B=I[P];if(B==null)return{};const x=getAlignmentSides(B,c,await(m.isRTL==null?void 0:m.isRTL(_.floating)));if(d!==B)return{reset:{placement:I[0]}};const F=[N[getSide(B)],N[x[0]],N[x[1]]],k=[...((s=u.autoPlacement)==null?void 0:s.overflows)||[],{placement:B,overflows:F}],J=I[P+1];if(J)return{data:{index:P+1,overflows:k},reset:{placement:J}};const z=k.map(X=>{const se=getAlignment(X.placement);return[X.placement,se&&b?X.overflows.slice(0,2).reduce((re,ue)=>re+ue,0):X.overflows[0],X.overflows]}).sort((X,se)=>X[1]-se[1]),W=((a=z.filter(X=>X[2].slice(0,getAlignment(X[0])?2:3).every(se=>se<=0))[0])==null?void 0:a[0])||z[0][0];return W!==d?{data:{index:P+1,overflows:k},reset:{placement:W}}:{}}}},flip=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(e){var t,s;const{placement:a,middlewareData:c,rects:u,initialPlacement:d,platform:m,elements:_}=e,{mainAxis:b=!0,crossAxis:S=!0,fallbackPlacements:C,fallbackStrategy:w="bestFit",fallbackAxisSideDirection:O="none",flipAlignment:I=!0,...N}=evaluate(n,e);if((t=c.arrow)!=null&&t.alignmentOffset)return{};const P=getSide(a),B=getSide(d)===d,x=await(m.isRTL==null?void 0:m.isRTL(_.floating)),F=C||(B||!I?[getOppositePlacement(d)]:getExpandedPlacements(d));!C&&O!=="none"&&F.push(...getOppositeAxisPlacements(d,I,O,x));const k=[d,...F],J=await detectOverflow(e,N),z=[];let H=((s=c.flip)==null?void 0:s.overflows)||[];if(b&&z.push(J[P]),S){const re=getAlignmentSides(a,u,x);z.push(J[re[0]],J[re[1]])}if(H=[...H,{placement:a,overflows:z}],!z.every(re=>re<=0)){var W,X;const re=(((W=c.flip)==null?void 0:W.index)||0)+1,ue=k[re];if(ue)return{data:{index:re,overflows:H},reset:{placement:ue}};let de=(X=H.filter(he=>he.overflows[0]<=0).sort((he,me)=>he.overflows[1]-me.overflows[1])[0])==null?void 0:X.placement;if(!de)switch(w){case"bestFit":{var se;const he=(se=H.map(me=>[me.placement,me.overflows.filter(le=>le>0).reduce((le,_e)=>le+_e,0)]).sort((me,le)=>me[1]-le[1])[0])==null?void 0:se[0];he&&(de=he);break}case"initialPlacement":de=d;break}if(a!==de)return{reset:{placement:de}}}return{}}}};async function convertValueToCoords(n,e){const{placement:t,platform:s,elements:a}=n,c=await(s.isRTL==null?void 0:s.isRTL(a.floating)),u=getSide(t),d=getAlignment(t),m=getSideAxis(t)==="y",_=["left","top"].includes(u)?-1:1,b=c&&m?-1:1,S=evaluate(e,n);let{mainAxis:C,crossAxis:w,alignmentAxis:O}=typeof S=="number"?{mainAxis:S,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...S};return d&&typeof O=="number"&&(w=d==="end"?O*-1:O),m?{x:w*b,y:C*_}:{x:C*_,y:w*b}}const offset=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(e){const{x:t,y:s}=e,a=await convertValueToCoords(e,n);return{x:t+a.x,y:s+a.y,data:a}}}},shift=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(e){const{x:t,y:s,placement:a}=e,{mainAxis:c=!0,crossAxis:u=!1,limiter:d={fn:N=>{let{x:P,y:B}=N;return{x:P,y:B}}},...m}=evaluate(n,e),_={x:t,y:s},b=await detectOverflow(e,m),S=getSideAxis(getSide(a)),C=getOppositeAxis(S);let w=_[C],O=_[S];if(c){const N=C==="y"?"top":"left",P=C==="y"?"bottom":"right",B=w+b[N],x=w-b[P];w=clamp(B,w,x)}if(u){const N=S==="y"?"top":"left",P=S==="y"?"bottom":"right",B=O+b[N],x=O-b[P];O=clamp(B,O,x)}const I=d.fn({...e,[C]:w,[S]:O});return{...I,data:{x:I.x-t,y:I.y-s}}}}};function getNodeName(n){return isNode(n)?(n.nodeName||"").toLowerCase():"#document"}function getWindow(n){var e;return(n==null||(e=n.ownerDocument)==null?void 0:e.defaultView)||window}function getDocumentElement(n){var e;return(e=(isNode(n)?n.ownerDocument:n.document)||window.document)==null?void 0:e.documentElement}function isNode(n){return n instanceof Node||n instanceof getWindow(n).Node}function isElement(n){return n instanceof Element||n instanceof getWindow(n).Element}function isHTMLElement(n){return n instanceof HTMLElement||n instanceof getWindow(n).HTMLElement}function isShadowRoot(n){return typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof getWindow(n).ShadowRoot}function isOverflowElement(n){const{overflow:e,overflowX:t,overflowY:s,display:a}=getComputedStyle$1(n);return/auto|scroll|overlay|hidden|clip/.test(e+s+t)&&!["inline","contents"].includes(a)}function isTableElement(n){return["table","td","th"].includes(getNodeName(n))}function isContainingBlock(n){const e=isWebKit(),t=getComputedStyle$1(n);return t.transform!=="none"||t.perspective!=="none"||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","perspective","filter"].some(s=>(t.willChange||"").includes(s))||["paint","layout","strict","content"].some(s=>(t.contain||"").includes(s))}function getContainingBlock(n){let e=getParentNode(n);for(;isHTMLElement(e)&&!isLastTraversableNode(e);){if(isContainingBlock(e))return e;e=getParentNode(e)}return null}function isWebKit(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function isLastTraversableNode(n){return["html","body","#document"].includes(getNodeName(n))}function getComputedStyle$1(n){return getWindow(n).getComputedStyle(n)}function getNodeScroll(n){return isElement(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.pageXOffset,scrollTop:n.pageYOffset}}function getParentNode(n){if(getNodeName(n)==="html")return n;const e=n.assignedSlot||n.parentNode||isShadowRoot(n)&&n.host||getDocumentElement(n);return isShadowRoot(e)?e.host:e}function getNearestOverflowAncestor(n){const e=getParentNode(n);return isLastTraversableNode(e)?n.ownerDocument?n.ownerDocument.body:n.body:isHTMLElement(e)&&isOverflowElement(e)?e:getNearestOverflowAncestor(e)}function getOverflowAncestors(n,e,t){var s;e===void 0&&(e=[]),t===void 0&&(t=!0);const a=getNearestOverflowAncestor(n),c=a===((s=n.ownerDocument)==null?void 0:s.body),u=getWindow(a);return c?e.concat(u,u.visualViewport||[],isOverflowElement(a)?a:[],u.frameElement&&t?getOverflowAncestors(u.frameElement):[]):e.concat(a,getOverflowAncestors(a,[],t))}function getCssDimensions(n){const e=getComputedStyle$1(n);let t=parseFloat(e.width)||0,s=parseFloat(e.height)||0;const a=isHTMLElement(n),c=a?n.offsetWidth:t,u=a?n.offsetHeight:s,d=round(t)!==c||round(s)!==u;return d&&(t=c,s=u),{width:t,height:s,$:d}}function unwrapElement(n){return isElement(n)?n:n.contextElement}function getScale(n){const e=unwrapElement(n);if(!isHTMLElement(e))return createCoords(1);const t=e.getBoundingClientRect(),{width:s,height:a,$:c}=getCssDimensions(e);let u=(c?round(t.width):t.width)/s,d=(c?round(t.height):t.height)/a;return(!u||!Number.isFinite(u))&&(u=1),(!d||!Number.isFinite(d))&&(d=1),{x:u,y:d}}const noOffsets=createCoords(0);function getVisualOffsets(n){const e=getWindow(n);return!isWebKit()||!e.visualViewport?noOffsets:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function shouldAddVisualOffsets(n,e,t){return e===void 0&&(e=!1),!t||e&&t!==getWindow(n)?!1:e}function getBoundingClientRect(n,e,t,s){e===void 0&&(e=!1),t===void 0&&(t=!1);const a=n.getBoundingClientRect(),c=unwrapElement(n);let u=createCoords(1);e&&(s?isElement(s)&&(u=getScale(s)):u=getScale(n));const d=shouldAddVisualOffsets(c,t,s)?getVisualOffsets(c):createCoords(0);let m=(a.left+d.x)/u.x,_=(a.top+d.y)/u.y,b=a.width/u.x,S=a.height/u.y;if(c){const C=getWindow(c),w=s&&isElement(s)?getWindow(s):s;let O=C.frameElement;for(;O&&s&&w!==C;){const I=getScale(O),N=O.getBoundingClientRect(),P=getComputedStyle$1(O),B=N.left+(O.clientLeft+parseFloat(P.paddingLeft))*I.x,x=N.top+(O.clientTop+parseFloat(P.paddingTop))*I.y;m*=I.x,_*=I.y,b*=I.x,S*=I.y,m+=B,_+=x,O=getWindow(O).frameElement}}return rectToClientRect({width:b,height:S,x:m,y:_})}function convertOffsetParentRelativeRectToViewportRelativeRect(n){let{rect:e,offsetParent:t,strategy:s}=n;const a=isHTMLElement(t),c=getDocumentElement(t);if(t===c)return e;let u={scrollLeft:0,scrollTop:0},d=createCoords(1);const m=createCoords(0);if((a||!a&&s!=="fixed")&&((getNodeName(t)!=="body"||isOverflowElement(c))&&(u=getNodeScroll(t)),isHTMLElement(t))){const _=getBoundingClientRect(t);d=getScale(t),m.x=_.x+t.clientLeft,m.y=_.y+t.clientTop}return{width:e.width*d.x,height:e.height*d.y,x:e.x*d.x-u.scrollLeft*d.x+m.x,y:e.y*d.y-u.scrollTop*d.y+m.y}}function getClientRects(n){return Array.from(n.getClientRects())}function getWindowScrollBarX(n){return getBoundingClientRect(getDocumentElement(n)).left+getNodeScroll(n).scrollLeft}function getDocumentRect(n){const e=getDocumentElement(n),t=getNodeScroll(n),s=n.ownerDocument.body,a=max(e.scrollWidth,e.clientWidth,s.scrollWidth,s.clientWidth),c=max(e.scrollHeight,e.clientHeight,s.scrollHeight,s.clientHeight);let u=-t.scrollLeft+getWindowScrollBarX(n);const d=-t.scrollTop;return getComputedStyle$1(s).direction==="rtl"&&(u+=max(e.clientWidth,s.clientWidth)-a),{width:a,height:c,x:u,y:d}}function getViewportRect(n,e){const t=getWindow(n),s=getDocumentElement(n),a=t.visualViewport;let c=s.clientWidth,u=s.clientHeight,d=0,m=0;if(a){c=a.width,u=a.height;const _=isWebKit();(!_||_&&e==="fixed")&&(d=a.offsetLeft,m=a.offsetTop)}return{width:c,height:u,x:d,y:m}}function getInnerBoundingClientRect(n,e){const t=getBoundingClientRect(n,!0,e==="fixed"),s=t.top+n.clientTop,a=t.left+n.clientLeft,c=isHTMLElement(n)?getScale(n):createCoords(1),u=n.clientWidth*c.x,d=n.clientHeight*c.y,m=a*c.x,_=s*c.y;return{width:u,height:d,x:m,y:_}}function getClientRectFromClippingAncestor(n,e,t){let s;if(e==="viewport")s=getViewportRect(n,t);else if(e==="document")s=getDocumentRect(getDocumentElement(n));else if(isElement(e))s=getInnerBoundingClientRect(e,t);else{const a=getVisualOffsets(n);s={...e,x:e.x-a.x,y:e.y-a.y}}return rectToClientRect(s)}function hasFixedPositionAncestor(n,e){const t=getParentNode(n);return t===e||!isElement(t)||isLastTraversableNode(t)?!1:getComputedStyle$1(t).position==="fixed"||hasFixedPositionAncestor(t,e)}function getClippingElementAncestors(n,e){const t=e.get(n);if(t)return t;let s=getOverflowAncestors(n,[],!1).filter(d=>isElement(d)&&getNodeName(d)!=="body"),a=null;const c=getComputedStyle$1(n).position==="fixed";let u=c?getParentNode(n):n;for(;isElement(u)&&!isLastTraversableNode(u);){const d=getComputedStyle$1(u),m=isContainingBlock(u);!m&&d.position==="fixed"&&(a=null),(c?!m&&!a:!m&&d.position==="static"&&!!a&&["absolute","fixed"].includes(a.position)||isOverflowElement(u)&&!m&&hasFixedPositionAncestor(n,u))?s=s.filter(b=>b!==u):a=d,u=getParentNode(u)}return e.set(n,s),s}function getClippingRect(n){let{element:e,boundary:t,rootBoundary:s,strategy:a}=n;const u=[...t==="clippingAncestors"?getClippingElementAncestors(e,this._c):[].concat(t),s],d=u[0],m=u.reduce((_,b)=>{const S=getClientRectFromClippingAncestor(e,b,a);return _.top=max(S.top,_.top),_.right=min(S.right,_.right),_.bottom=min(S.bottom,_.bottom),_.left=max(S.left,_.left),_},getClientRectFromClippingAncestor(e,d,a));return{width:m.right-m.left,height:m.bottom-m.top,x:m.left,y:m.top}}function getDimensions(n){return getCssDimensions(n)}function getRectRelativeToOffsetParent(n,e,t){const s=isHTMLElement(e),a=getDocumentElement(e),c=t==="fixed",u=getBoundingClientRect(n,!0,c,e);let d={scrollLeft:0,scrollTop:0};const m=createCoords(0);if(s||!s&&!c)if((getNodeName(e)!=="body"||isOverflowElement(a))&&(d=getNodeScroll(e)),s){const _=getBoundingClientRect(e,!0,c,e);m.x=_.x+e.clientLeft,m.y=_.y+e.clientTop}else a&&(m.x=getWindowScrollBarX(a));return{x:u.left+d.scrollLeft-m.x,y:u.top+d.scrollTop-m.y,width:u.width,height:u.height}}function getTrueOffsetParent(n,e){return!isHTMLElement(n)||getComputedStyle$1(n).position==="fixed"?null:e?e(n):n.offsetParent}function getOffsetParent(n,e){const t=getWindow(n);if(!isHTMLElement(n))return t;let s=getTrueOffsetParent(n,e);for(;s&&isTableElement(s)&&getComputedStyle$1(s).position==="static";)s=getTrueOffsetParent(s,e);return s&&(getNodeName(s)==="html"||getNodeName(s)==="body"&&getComputedStyle$1(s).position==="static"&&!isContainingBlock(s))?t:s||getContainingBlock(n)||t}const getElementRects=async function(n){let{reference:e,floating:t,strategy:s}=n;const a=this.getOffsetParent||getOffsetParent,c=this.getDimensions;return{reference:getRectRelativeToOffsetParent(e,await a(t),s),floating:{x:0,y:0,...await c(t)}}};function isRTL(n){return getComputedStyle$1(n).direction==="rtl"}const platform={convertOffsetParentRelativeRectToViewportRelativeRect,getDocumentElement,getClippingRect,getOffsetParent,getElementRects,getClientRects,getDimensions,getScale,isElement,isRTL};function observeMove(n,e){let t=null,s;const a=getDocumentElement(n);function c(){clearTimeout(s),t&&t.disconnect(),t=null}function u(d,m){d===void 0&&(d=!1),m===void 0&&(m=1),c();const{left:_,top:b,width:S,height:C}=n.getBoundingClientRect();if(d||e(),!S||!C)return;const w=floor(b),O=floor(a.clientWidth-(_+S)),I=floor(a.clientHeight-(b+C)),N=floor(_),B={rootMargin:-w+"px "+-O+"px "+-I+"px "+-N+"px",threshold:max(0,min(1,m))||1};let x=!0;function F(k){const J=k[0].intersectionRatio;if(J!==m){if(!x)return u();J?u(!1,J):s=setTimeout(()=>{u(!1,1e-7)},100)}x=!1}try{t=new IntersectionObserver(F,{...B,root:a.ownerDocument})}catch{t=new IntersectionObserver(F,B)}t.observe(n)}return u(!0),c}function autoUpdate(n,e,t,s){s===void 0&&(s={});const{ancestorScroll:a=!0,ancestorResize:c=!0,elementResize:u=typeof ResizeObserver=="function",layoutShift:d=typeof IntersectionObserver=="function",animationFrame:m=!1}=s,_=unwrapElement(n),b=a||c?[..._?getOverflowAncestors(_):[],...getOverflowAncestors(e)]:[];b.forEach(P=>{a&&P.addEventListener("scroll",t,{passive:!0}),c&&P.addEventListener("resize",t)});const S=_&&d?observeMove(_,t):null;let C=-1,w=null;u&&(w=new ResizeObserver(P=>{let[B]=P;B&&B.target===_&&w&&(w.unobserve(e),cancelAnimationFrame(C),C=requestAnimationFrame(()=>{w&&w.observe(e)})),t()}),_&&!m&&w.observe(_),w.observe(e));let O,I=m?getBoundingClientRect(n):null;m&&N();function N(){const P=getBoundingClientRect(n);I&&(P.x!==I.x||P.y!==I.y||P.width!==I.width||P.height!==I.height)&&t(),I=P,O=requestAnimationFrame(N)}return t(),()=>{b.forEach(P=>{a&&P.removeEventListener("scroll",t),c&&P.removeEventListener("resize",t)}),S&&S(),w&&w.disconnect(),w=null,m&&cancelAnimationFrame(O)}}const computePosition=(n,e,t)=>{const s=new Map,a={platform,...t},c={...a.platform,_c:s};return computePosition$1(n,e,{...a,platform:c})};function create_default_slot_1(n){let e,t;return e=new Sidebar({}),{c(){create_component(e.$$.fragment)},l(s){claim_component(e.$$.fragment,s)},m(s,a){mount_component(e,s,a),t=!0},i(s){t||(transition_in(e.$$.fragment,s),t=!0)},o(s){transition_out(e.$$.fragment,s),t=!1},d(s){destroy_component(e,s)}}}function create_default_slot(n){let e,t,s,a,c,u,d,m;return e=new RovSelector({}),s=new LoadingIndicator({}),c=new VideoPlayer({}),d=new OnscreenGamepads({}),{c(){create_component(e.$$.fragment),t=space(),create_component(s.$$.fragment),a=space(),create_component(c.$$.fragment),u=space(),create_component(d.$$.fragment)},l(_){claim_component(e.$$.fragment,_),t=claim_space(_),claim_component(s.$$.fragment,_),a=claim_space(_),claim_component(c.$$.fragment,_),u=claim_space(_),claim_component(d.$$.fragment,_)},m(_,b){mount_component(e,_,b),insert_hydration(_,t,b),mount_component(s,_,b),insert_hydration(_,a,b),mount_component(c,_,b),insert_hydration(_,u,b),mount_component(d,_,b),m=!0},i(_){m||(transition_in(e.$$.fragment,_),transition_in(s.$$.fragment,_),transition_in(c.$$.fragment,_),transition_in(d.$$.fragment,_),m=!0)},o(_){transition_out(e.$$.fragment,_),transition_out(s.$$.fragment,_),transition_out(c.$$.fragment,_),transition_out(d.$$.fragment,_),m=!1},d(_){_&&(detach(t),detach(a),detach(u)),destroy_component(e,_),destroy_component(s,_),destroy_component(c,_),destroy_component(d,_)}}}function create_pageHeader_slot(n){let e,t;return e=new Topbar({}),{c(){create_component(e.$$.fragment)},l(s){claim_component(e.$$.fragment,s)},m(s,a){mount_component(e,s,a),t=!0},i(s){t||(transition_in(e.$$.fragment,s),t=!0)},o(s){transition_out(e.$$.fragment,s),t=!1},d(s){destroy_component(e,s)}}}function create_sidebarLeft_slot(n){let e,t;return e=new Sidebar({}),{c(){create_component(e.$$.fragment)},l(s){claim_component(e.$$.fragment,s)},m(s,a){mount_component(e,s,a),t=!0},i(s){t||(transition_in(e.$$.fragment,s),t=!0)},o(s){transition_out(e.$$.fragment,s),t=!1},d(s){destroy_component(e,s)}}}function create_fragment(n){let e,t,s,a,c,u,d,m,_,b;return e=new HelpTooltips({}),s=new Modal({}),c=new Toast({props:{position:"tl"}}),d=new Drawer({props:{width:"w-72",$$slots:{default:[create_default_slot_1]},$$scope:{ctx:n}}}),_=new AppShell({props:{slotSidebarLeft:"bg-surface-500/5 hidden lg:block",regionPage:"[&>main]:relative",$$slots:{sidebarLeft:[create_sidebarLeft_slot],pageHeader:[create_pageHeader_slot],default:[create_default_slot]},$$scope:{ctx:n}}}),{c(){create_component(e.$$.fragment),t=space(),create_component(s.$$.fragment),a=space(),create_component(c.$$.fragment),u=space(),create_component(d.$$.fragment),m=space(),create_component(_.$$.fragment)},l(S){claim_component(e.$$.fragment,S),t=claim_space(S),claim_component(s.$$.fragment,S),a=claim_space(S),claim_component(c.$$.fragment,S),u=claim_space(S),claim_component(d.$$.fragment,S),m=claim_space(S),claim_component(_.$$.fragment,S)},m(S,C){mount_component(e,S,C),insert_hydration(S,t,C),mount_component(s,S,C),insert_hydration(S,a,C),mount_component(c,S,C),insert_hydration(S,u,C),mount_component(d,S,C),insert_hydration(S,m,C),mount_component(_,S,C),b=!0},p(S,[C]){const w={};C&1&&(w.$$scope={dirty:C,ctx:S}),d.$set(w);const O={};C&1&&(O.$$scope={dirty:C,ctx:S}),_.$set(O)},i(S){b||(transition_in(e.$$.fragment,S),transition_in(s.$$.fragment,S),transition_in(c.$$.fragment,S),transition_in(d.$$.fragment,S),transition_in(_.$$.fragment,S),b=!0)},o(S){transition_out(e.$$.fragment,S),transition_out(s.$$.fragment,S),transition_out(c.$$.fragment,S),transition_out(d.$$.fragment,S),transition_out(_.$$.fragment,S),b=!1},d(S){S&&(detach(t),detach(a),detach(u),detach(m)),destroy_component(e,S),destroy_component(s,S),destroy_component(c,S),destroy_component(d,S),destroy_component(_,S)}}}function instance(n){return initializeStores(),storePopup.set({computePosition,autoUpdate,autoPlacement,flip,shift,offset,arrow}),setupToasts(),setupModals(),initPage(),onMount(()=>{appReady.set(!0)}),onDestroy(()=>{RovActions.stopRequiredMsgLoop(),frontendConnMngr.disconnect(),gpadCtrl.gpadEmulator.cleanup()}),[]}class Layout extends SvelteComponent{constructor(e){super(),init(this,e,instance,create_fragment,safe_not_equal,{})}}export{Layout as component,_layout as universal};
//# sourceMappingURL=0.2b07c948.js.map
