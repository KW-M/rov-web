{"version":3,"file":"proxy-9225cf57.js","sources":["../../js/consts.ts","../../js/wsHook.ts","../../frontend/js/proxy.ts"],"sourcesContent":["import type { RoomConnectOptions } from \"livekit-client\"\n\ndeclare global {\n    interface Window {\n        LIVEKIT_TOKEN: string\n    }\n}\n\nconst TE = new TextEncoder();\nexport const ENCODE_TXT = (txt: string) => TE.encode(txt)\nconst TD = new TextDecoder();\nexport const DECODE_TXT = (data: ArrayBufferLike) => TD.decode(data)\n\nexport const LIVEKIT_CLOUD_ENDPOINT = 'https://rov-web.livekit.cloud'\nexport const LIVEKIT_LOCAL_ENDPOINT = 'http://localhost:7880'\nexport const PROXY_PREFIX = 'proxy:';\n\nexport const LIVEKIT_BACKEND_ROOM_CONNECTION_CONFIG: RoomConnectOptions = {\n    autoSubscribe: false,\n    maxRetries: 1000,\n    peerConnectionTimeout: 45_000, // miliseconds\n}\n\nexport const LIVEKIT_FRONTEND_ROOM_CONNECTION_CONFIG: RoomConnectOptions = {\n    autoSubscribe: true,\n    maxRetries: 6,\n    peerConnectionTimeout: 15_000, // miliseconds\n}\n","/* eslint-disable no-proto */\n/* eslint-disable accessor-pairs */\n/* eslint-disable no-global-assign */\n\n/* wsHook.js\n * https://github.com/skepticfx/wshook\n * Reference: http://www.w3.org/TR/2011/WD-websockets-20110419/#websocket\n */\n\ndeclare global {\n  interface MessageEvent {\n    path?: string[];\n    parts?: string[];\n    __proto__: MessageEvent\n  }\n  interface WebSocket {\n    _onopen?: (ev?: Event) => void;\n    _onerror?: (ev?: Event) => void;\n    _onclose?: (ev?: CloseEvent) => void;\n    _onmessage?: (ev?: MessageEvent) => void;\n    _addEventListener?: <K extends keyof WebSocketEventMap>(type: K, listener: (this: WebSocket, ev: WebSocketEventMap[K]) => any, options?: boolean | AddEventListenerOptions) => void;\n    _readyState: number;\n    isReal?: boolean;\n  }\n}\n\ntype socketMsgDataTypes = string | ArrayBufferLike | Blob | ArrayBufferView\n\n// Mutable MessageEvent.\n// Subclasses MessageEvent and makes data, origin and other MessageEvent properites mutatble.\nexport interface MutableMessageEvent<T = any> extends MessageEvent<T> {\n  bubbles: boolean;\n  cancelBubble: boolean;\n  cancelable: boolean;\n  currentTarget: EventTarget | null;\n  data: T;\n  defaultPrevented: boolean;\n  eventPhase: number;\n  lastEventId: string;\n  origin: string;\n  path: string[];\n  ports: MessagePort[];\n  returnValue: boolean;\n  source: MessageEventSource | null;\n  srcElement: EventTarget | null;\n  target: EventTarget | null;\n  timeStamp: number;\n  type: string;\n}\n\nconst MakeMutableMessageEvent = (ev: MessageEvent) => {\n  return {\n    ...ev,\n    bubbles: ev.bubbles || false,\n    cancelBubble: ev.cancelBubble || false,\n    cancelable: ev.cancelable || false,\n    currentTarget: ev.currentTarget || null,\n    data: ev.data,\n    defaultPrevented: ev.defaultPrevented || false,\n    eventPhase: ev.eventPhase || 0,\n    lastEventId: ev.lastEventId || '',\n    origin: ev.origin || '',\n    path: ev.path || new Array(0),\n    ports: ev.parts || new Array(0),\n    returnValue: ev.returnValue || true,\n    source: ev.source || null,\n    srcElement: ev.srcElement || null,\n    target: ev.target || null,\n    timeStamp: ev.timeStamp || -1,\n    type: ev.type || 'message',\n    initMessageEvent: ev.initMessageEvent || null,\n    __proto__: ev.__proto__,// || MessageEvent.__proto__\n  } as MutableMessageEvent\n}\n\nexport const wsHook = {\n  triggerOnOpen: (wsObject: WebSocket, ev?: Event) => {\n    ev = ev || new Event(\"open\", { composed: false, bubbles: false, cancelable: false })\n    wsObject._readyState = 1;\n    if (wsObject._onopen) wsObject._onopen(ev);\n    // wsObject.dispatchEvent(ev)\n  },\n  triggerOnError: (wsObject: WebSocket, ev?: Event) => {\n    ev = ev || new Event(\"error\", { composed: false, bubbles: false, cancelable: false })\n    wsObject._readyState = 3;\n    if (wsObject._onerror) wsObject._onerror(ev);\n  },\n  triggerOnClose: (wsObject: WebSocket, ev?: CloseEvent) => {\n    ev = ev || new CloseEvent(\"close\", { wasClean: true, reason: \"wsHook\", composed: false, bubbles: false, cancelable: false, code: 1006 })\n    wsObject._readyState = 3;\n    if (wsObject._onclose) wsObject._onclose(ev);\n  },\n  triggerOnMessage: (wsObject: WebSocket, data: socketMsgDataTypes) => {\n    // @ts-ignore\n    if (!(typeof data === typeof '' || data instanceof ArrayBuffer)) data = (data as Uint8Array).buffer;\n    console.log(\"triggerOnMessage\", data, wsObject);\n    const ev = new MessageEvent(\"mesage\", { data: data, origin: wsObject.url, bubbles: false, cancelable: false, composed: false })\n    if (wsObject._onmessage) wsObject._onmessage(ev);\n  },\n  /**\n   * Whenever the a \"new WebSocket()\" call is made, wsHook.allowNewSocket will get called with the url of the new websocket\n   * @param url: the url passed to the new WebSocket() constructor\n   * @returns Return true to allow the default websocket behavior. Return false to create a mock WebSocket that never hits the network but can still be controlled with wsHook.trigger* calls.\n   */\n  allowNewSocket: (url: string): boolean => {\n    return true;\n  },\n  modifyUrl: (url: string | URL) => {\n    return url\n  },\n  afterInit: (wsObject: WebSocket): WebSocket => {\n    return wsObject;\n  },\n  beforeOpen: (ev: Event, url: string, wsObject: WebSocket): Event | null => {\n    return ev;\n  },\n  beforeError: (ev: Event, url: string, wsObject: WebSocket): Event | null => {\n    return ev;\n  },\n  beforeClose: (ev: CloseEvent, url: string, wsObject: WebSocket): CloseEvent | null => {\n    return ev;\n  },\n  beforeSend: (data: socketMsgDataTypes, url: string, wsObject: WebSocket): socketMsgDataTypes | null => {\n    return data;\n  },\n  afterRecive: (ev: MessageEvent, url: string, wsObject: WebSocket): MessageEvent | MutableMessageEvent | null => {\n    return ev;\n  },\n  resetHooks: () => { }\n};\n\n(function () {\n\n  // setup WSHook default functions\n  const defaultWSHooks = Object.assign({}, wsHook) // make a copy of the default functions\n  wsHook.resetHooks = function () {\n    Object.assign(wsHook, defaultWSHooks)\n  }\n\n  // overwrite the default websocket\n  var _WS = WebSocket\n  // @ts-ignore\n  WebSocket = Object.assign(function (url: string | URL, protocols?: string | string[] | undefined): WebSocket {\n    const allowRealSocket = wsHook.allowNewSocket(url.toString())\n    url = wsHook.modifyUrl(url) || url\n    let WSObject: WebSocket;\n    if (allowRealSocket) {\n      WSObject = protocols ? new _WS(url, protocols) : new _WS(url);\n      WSObject.isReal = true;\n    } else {\n      // @ts-ignore\n      WSObject = Object.assign({}, _WS);\n      Object.defineProperty(WSObject, 'url', { get() { return url } })\n      Object.defineProperty(WSObject, 'protocols', { get() { return protocols } })\n      Object.defineProperty(WSObject, 'readyState', { get() { return this._readyState } })\n      Object.defineProperty(WSObject, 'close', { value: () => { return wsHook.triggerOnClose(this) } })\n      Object.defineProperty(WSObject, 'isReal', { value: false })\n      Object.defineProperty(WSObject, '_readyState', { value: 0, writable: true })\n    }\n\n    // Hook the websocket send function\n    var _send = WSObject.send\n    WSObject.send = function (data) {\n      console.log(\"hook send\")\n      arguments[0] = wsHook.beforeSend(data, WSObject.url, this) || null;\n      if (arguments[0] == null) return;\n      _send.apply(this, arguments)\n    }\n\n    // Events needs to be proxied and bubbled down.\n    WSObject._onopen = undefined;\n    WSObject._onerror = undefined;\n    WSObject._addEventListener = WSObject.addEventListener || function () {\n      // console.log(\"fake addEventListener() called\")\n      // const eventName = arguments[0];\n      // const userFunc = arguments[1];\n      // if (eventName === 'message') {\n      //   WSObject._onmessage = userFunc\n      // } else if (eventName === 'open') {\n      //   WSObject._onopen = userFunc\n      // } else if (eventName === 'error') {\n      //   WSObject._onerror = userFunc\n      // } else if (eventName === 'close') {\n      //   WSObject._onclose = userFunc\n      // }\n    };\n    WSObject.addEventListener = function () {\n      const eventThis = this\n      const eventName = arguments[0];\n      const userFunc = arguments[1];\n\n      if (eventName === 'message') {\n        WSObject._onmessage = userFunc\n        arguments[1] = (function (userFunc) {\n          return function () {\n            arguments[0] = wsHook.afterRecive(MakeMutableMessageEvent(arguments[0]), WSObject.url, WSObject)\n            if (arguments[0] === null) return\n            userFunc.apply(eventThis, arguments)\n          }\n        })(userFunc)\n      } else if (eventName === 'open') {\n        WSObject._onopen = userFunc\n        arguments[1] = (function (userFunc) {\n          return function () {\n            arguments[0] = wsHook.beforeOpen(arguments[0], WSObject.url, WSObject)\n            if (arguments[0] === null) return\n            userFunc.apply(eventThis, arguments)\n          }\n        })(userFunc)\n      } else if (eventName === 'error') {\n        WSObject._onerror = userFunc\n        arguments[1] = (function (userFunc) {\n          return function () {\n            arguments[0] = wsHook.beforeError(arguments[0], WSObject.url, WSObject)\n            if (arguments[0] === null) return\n            userFunc.apply(eventThis, arguments)\n          }\n        })(userFunc)\n      } else if (eventName === 'close') {\n        WSObject._onclose = userFunc\n        arguments[1] = (function (userFunc) {\n          return function () {\n            arguments[0] = wsHook.beforeClose(arguments[0], WSObject.url, WSObject)\n            if (arguments[0] === null) return\n            userFunc.apply(eventThis, arguments)\n          }\n        })(userFunc)\n      }\n      return WSObject._addEventListener?.apply(this, arguments)\n    }\n\n    Object.defineProperty(WSObject, 'onmessage', {\n      'set': function () {\n        var eventThis = this\n        var userFunc = arguments[0]\n        WSObject._onmessage = userFunc\n        var onMessageHandler = userFunc ? function () {\n          if (!WSObject.isReal) console.log('onMessageHandler', arguments)\n          arguments[0] = wsHook.afterRecive(MakeMutableMessageEvent(arguments[0]), WSObject.url, WSObject)\n          if (arguments[0] === null) return\n          userFunc.apply(eventThis, arguments)\n        } : null;\n\n        console.log('onMsgHandler', arguments)\n        WSObject._addEventListener?.apply(this, ['message', onMessageHandler, false])\n      }\n    })\n\n    Object.defineProperty(WSObject, 'onopen', {\n      'set': function () {\n        var eventThis = this\n        var userFunc = arguments[0]\n        WSObject._onopen = userFunc\n        var onOpenHandler = userFunc ? function () {\n          if (!WSObject.isReal) console.log('onOpenHandler', arguments)\n          arguments[0] = wsHook.beforeOpen(arguments[0], WSObject.url, WSObject)\n          if (arguments[0] === null) return\n          userFunc.apply(eventThis, arguments)\n        } : null;\n        console.log('onOpenHandler', arguments)\n        WSObject._addEventListener?.apply(this, ['open', onOpenHandler, false])\n      }\n    })\n\n    Object.defineProperty(WSObject, 'onerror', {\n      'set': function () {\n        var eventThis = this\n        var userFunc = arguments[0]\n        WSObject._onerror = userFunc\n        var onErrorHandler = userFunc ? function () {\n          if (!WSObject.isReal) console.log('onErrorHandler', arguments)\n          arguments[0] = wsHook.beforeError(arguments[0], WSObject.url, WSObject)\n          if (arguments[0] === null) return\n          userFunc.apply(eventThis, arguments)\n        } : null\n        WSObject._addEventListener?.apply(this, ['error', onErrorHandler, false])\n      }\n    })\n\n    Object.defineProperty(WSObject, 'onclose', {\n      'set': function () {\n        var eventThis = this\n        var userFunc = arguments[0]\n        WSObject._onclose = userFunc\n        var onCloseHandler = userFunc ? function () {\n          if (!WSObject.isReal) console.log('onCloseHandler', arguments)\n          arguments[0] = wsHook.beforeClose(arguments[0], WSObject.url, WSObject)\n          if (arguments[0] === null) return\n          userFunc.apply(eventThis, arguments)\n        } : null\n        WSObject._addEventListener?.apply(this, ['close', onCloseHandler, false])\n      }\n    })\n\n    wsHook.afterInit(WSObject);\n    WSObject._readyState = _WS.OPEN;\n    return WSObject\n  }, _WS);\n})();\n","// https://stackoverflow.com/questions/61865890/run-websocket-in-web-worker-or-service-worker-javascript\n// https://github.com/skepticfx/wshook\n// https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Transferable_objects\n// Some Ideas\n\nimport { DECODE_TXT, ENCODE_TXT, PROXY_PREFIX } from \"../../js/consts\";\nimport { waitfor } from \"../../js/util\";\nimport { wsHook } from \"../../js/wsHook\";\n\nexport enum proxyMessageTypes {\n    openWebsocket,\n    socketMsg,\n    outgoingHttpReq,\n    incomingHttpReq,\n}\n\nexport type proxyInterchangeFormat = {\n    type: proxyMessageTypes;\n    url: string;\n    body: number[]; // binary data\n    result: object; // for fetch response\n}\n\nlet isOnline = true;\nconst proxiedWsObjects: { [key: string]: WebSocket } = {};\nlet sendProxyMessageCallback: ((data: ArrayBufferLike) => void) | null = null\nexport function setSendProxyMessageCallback(callback: (data: ArrayBufferLike) => void) {\n    sendProxyMessageCallback = callback;\n}\n\nconst isProxiedUrl = (url: string) => {\n    return url.startsWith(PROXY_PREFIX) || !isOnline\n}\n\nwsHook.allowNewSocket = (url) => {\n    console.log(\"Checking ws url: \", url)\n    if (isProxiedUrl(url)) {\n        console.log(\"Proxying ws url: \", url)\n        return false;\n    } else return true;\n};\n\nwsHook.modifyUrl = (url: string | URL) => {\n    url = url.toString();\n    if (isProxiedUrl(url)) url = url.substring(PROXY_PREFIX.length)\n    console.log(\"modifyUrl: \", url)\n    return url\n};\n\n\nwsHook.afterInit = (wsObject) => {\n    const url = wsObject.url;\n    if (!wsObject.isReal) {\n        proxiedWsObjects[url] = wsObject;\n        setTimeout(() => {\n            wsHook.triggerOnOpen(wsObject);\n            sendNewConnMsgThruProxy(url);\n        }, 1)\n    }\n    return wsObject;\n};\n\nwsHook.beforeSend = (data, url, wsObject) => {\n    if (wsObject.isReal) {\n        return data;\n    } else {\n        console.log(\"beforeSend: \", wsObject.isReal, wsObject.url, data)\n        sendDataThruProxy(url, new Uint8Array(data as ArrayBuffer))\n        return null\n    }\n}\n\nfunction sendNewConnMsgThruProxy(url: string) {\n    const proxiedMsg = {\n        type: proxyMessageTypes.openWebsocket,\n        url: url,\n    } as proxyInterchangeFormat\n    console.log(\"Sending openWebsocket msg Thru Proxy\", proxiedMsg)\n    if (sendProxyMessageCallback) sendProxyMessageCallback(ENCODE_TXT(JSON.stringify(proxiedMsg)))\n}\n\nfunction sendDataThruProxy(url: string, data: ArrayBufferLike) {\n    const binary = new Uint8Array(data)\n    const proxiedMsg = {\n        type: proxyMessageTypes.socketMsg,\n        url: url,\n        body: new Array(...binary)\n    } as proxyInterchangeFormat\n    console.log(\"Sending Data Thru Proxy\", proxiedMsg)\n    if (sendProxyMessageCallback) sendProxyMessageCallback(ENCODE_TXT(JSON.stringify(proxiedMsg)))\n}\n\nexport function receiveProxiedMsg(rawMsg: ArrayBufferLike) {\n    const proxiedMsg = JSON.parse(DECODE_TXT(rawMsg)) as proxyInterchangeFormat;\n    if (proxiedMsg.type === proxyMessageTypes.socketMsg) {\n        const ws = proxiedWsObjects[proxiedMsg.url]\n        const body = new Uint8Array(proxiedMsg.body)\n        console.log(\"Received Proxy Message\", proxiedMsg, body)\n        if (ws) wsHook.triggerOnMessage(ws, body)\n    }\n}\n"],"names":["TE","ENCODE_TXT","txt","TD","DECODE_TXT","data","LIVEKIT_CLOUD_ENDPOINT","LIVEKIT_LOCAL_ENDPOINT","PROXY_PREFIX","LIVEKIT_BACKEND_ROOM_CONNECTION_CONFIG","LIVEKIT_FRONTEND_ROOM_CONNECTION_CONFIG","MakeMutableMessageEvent","ev","wsHook","wsObject","url","defaultWSHooks","_WS","protocols","allowRealSocket","WSObject","_send","eventThis","eventName","userFunc","_a","onMessageHandler","onOpenHandler","onErrorHandler","onCloseHandler","proxyMessageTypes","proxyMessageTypes2","isOnline","proxiedWsObjects","sendProxyMessageCallback","setSendProxyMessageCallback","callback","isProxiedUrl","sendNewConnMsgThruProxy","sendDataThruProxy","proxiedMsg","binary","receiveProxiedMsg","rawMsg","ws","body"],"mappings":"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"}