import{D as c,p as s,E as y}from"./proxy-9225cf57.js";const d={},a={};let r;function l(n){r=n}function f(n){if(a[n])return a[n];const e=a[n]=new WebSocket(n);return e.binaryType="arraybuffer",e.addEventListener("message",t=>{let o=typeof t.data=="string"?y(t.data):t.data;const i=new Uint8Array(o);r&&r(y(JSON.stringify({type:s.socketMsg,body:new Array(...i),url:n})))}),e.addEventListener("error",t=>{console.warn("ws err "+n,t)}),e.addEventListener("close",t=>{console.warn("ws close "+n,t)}),e}function p(n,e){let t=a[n];t||(t=f(n)),t.readyState!==WebSocket.OPEN?(console.log("osending",c(e),t.readyState,WebSocket.OPEN),t.addEventListener("open",()=>t.send(e))):(console.log("sending"),t.send(e))}function g(n,e){if(d[n]!=null)return;(d[n]=fetch(n,e)).then(async o=>{console.log("fetch result",o);let i=new Uint8Array(await o.arrayBuffer());r&&r(y(JSON.stringify({type:s.outgoingHttpReq,result:o,body:new Array(...i),url:n})))}).catch(o=>{console.log("fetch err",o)})}function w(n){const e=JSON.parse(c(n));console.log("Received Proxy Message",e),e.type===s.openWebsocket?f(e.url):e.type===s.socketMsg?p(e.url,new Uint8Array(e.body)):e.type===s.incomingHttpReq&&g(e.url,JSON.parse(c(new Uint8Array(e.body))))}export{w as r,l as s};
//# sourceMappingURL=proxyReciever-e68a371e.js.map
