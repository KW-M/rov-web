(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))c(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const g of n.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&c(g)}).observe(document,{childList:!0,subtree:!0});function t(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(a){if(a.ep)return;a.ep=!0;const n=t(a);fetch(a.href,n)}})();const O=new TextEncoder,p=e=>O.encode(e),E=new TextDecoder,h=e=>E.decode(e),C="https://rov-web.livekit.cloud",R="http://localhost:7880",b="proxy:",T={autoSubscribe:!1,maxRetries:1e3,peerConnectionTimeout:45e3},w={autoSubscribe:!0,maxRetries:6,peerConnectionTimeout:15e3},m=e=>({...e,bubbles:e.bubbles||!1,cancelBubble:e.cancelBubble||!1,cancelable:e.cancelable||!1,currentTarget:e.currentTarget||null,data:e.data,defaultPrevented:e.defaultPrevented||!1,eventPhase:e.eventPhase||0,lastEventId:e.lastEventId||"",origin:e.origin||"",path:e.path||new Array(0),ports:e.parts||new Array(0),returnValue:e.returnValue||!0,source:e.source||null,srcElement:e.srcElement||null,target:e.target||null,timeStamp:e.timeStamp||-1,type:e.type||"message",initMessageEvent:e.initMessageEvent||null,__proto__:e.__proto__}),o={triggerOnOpen:(e,r)=>{r=r||new Event("open",{composed:!1,bubbles:!1,cancelable:!1}),e._readyState=1,e._onopen&&e._onopen(r)},triggerOnError:(e,r)=>{r=r||new Event("error",{composed:!1,bubbles:!1,cancelable:!1}),e._readyState=3,e._onerror&&e._onerror(r)},triggerOnClose:(e,r)=>{r=r||new CloseEvent("close",{wasClean:!0,reason:"wsHook",composed:!1,bubbles:!1,cancelable:!1,code:1006}),e._readyState=3,e._onclose&&e._onclose(r)},triggerOnMessage:(e,r)=>{typeof r=="string"||r instanceof ArrayBuffer||(r=r.buffer),console.log("triggerOnMessage",r,e);const t=new MessageEvent("mesage",{data:r,origin:e.url,bubbles:!1,cancelable:!1,composed:!1});e._onmessage&&e._onmessage(t)},allowNewSocket:e=>!0,modifyUrl:e=>e,afterInit:e=>e,beforeOpen:(e,r,t)=>e,beforeError:(e,r,t)=>e,beforeClose:(e,r,t)=>e,beforeSend:(e,r,t)=>e,afterRecive:(e,r,t)=>e,resetHooks:()=>{}};(function(){const e=Object.assign({},o);o.resetHooks=function(){Object.assign(o,e)};var r=WebSocket;WebSocket=Object.assign(function(t,c){const a=o.allowNewSocket(t.toString());t=o.modifyUrl(t)||t;let n;a?(n=c?new r(t,c):new r(t),n.isReal=!0):(n=Object.assign({},r),Object.defineProperty(n,"url",{get(){return t}}),Object.defineProperty(n,"protocols",{get(){return c}}),Object.defineProperty(n,"readyState",{get(){return this._readyState}}),Object.defineProperty(n,"close",{value:()=>o.triggerOnClose(this)}),Object.defineProperty(n,"isReal",{value:!1}),Object.defineProperty(n,"_readyState",{value:0,writable:!0}));var g=n.send;return n.send=function(u){console.log("hook send"),arguments[0]=o.beforeSend(u,n.url,this)||null,arguments[0]!=null&&g.apply(this,arguments)},n._onopen=void 0,n._onerror=void 0,n._addEventListener=n.addEventListener||function(){},n.addEventListener=function(){var i;const u=this,s=arguments[0],l=arguments[1];return s==="message"?(n._onmessage=l,arguments[1]=function(f){return function(){arguments[0]=o.afterRecive(m(arguments[0]),n.url,n),arguments[0]!==null&&f.apply(u,arguments)}}(l)):s==="open"?(n._onopen=l,arguments[1]=function(f){return function(){arguments[0]=o.beforeOpen(arguments[0],n.url,n),arguments[0]!==null&&f.apply(u,arguments)}}(l)):s==="error"?(n._onerror=l,arguments[1]=function(f){return function(){arguments[0]=o.beforeError(arguments[0],n.url,n),arguments[0]!==null&&f.apply(u,arguments)}}(l)):s==="close"&&(n._onclose=l,arguments[1]=function(f){return function(){arguments[0]=o.beforeClose(arguments[0],n.url,n),arguments[0]!==null&&f.apply(u,arguments)}}(l)),(i=n._addEventListener)==null?void 0:i.apply(this,arguments)},Object.defineProperty(n,"onmessage",{set:function(){var i;var u=this,s=arguments[0];n._onmessage=s;var l=s?function(){n.isReal||console.log("onMessageHandler",arguments),arguments[0]=o.afterRecive(m(arguments[0]),n.url,n),arguments[0]!==null&&s.apply(u,arguments)}:null;console.log("onMsgHandler",arguments),(i=n._addEventListener)==null||i.apply(this,["message",l,!1])}}),Object.defineProperty(n,"onopen",{set:function(){var i;var u=this,s=arguments[0];n._onopen=s;var l=s?function(){n.isReal||console.log("onOpenHandler",arguments),arguments[0]=o.beforeOpen(arguments[0],n.url,n),arguments[0]!==null&&s.apply(u,arguments)}:null;console.log("onOpenHandler",arguments),(i=n._addEventListener)==null||i.apply(this,["open",l,!1])}}),Object.defineProperty(n,"onerror",{set:function(){var i;var u=this,s=arguments[0];n._onerror=s;var l=s?function(){n.isReal||console.log("onErrorHandler",arguments),arguments[0]=o.beforeError(arguments[0],n.url,n),arguments[0]!==null&&s.apply(u,arguments)}:null;(i=n._addEventListener)==null||i.apply(this,["error",l,!1])}}),Object.defineProperty(n,"onclose",{set:function(){var i;var u=this,s=arguments[0];n._onclose=s;var l=s?function(){n.isReal||console.log("onCloseHandler",arguments),arguments[0]=o.beforeClose(arguments[0],n.url,n),arguments[0]!==null&&s.apply(u,arguments)}:null;(i=n._addEventListener)==null||i.apply(this,["close",l,!1])}}),o.afterInit(n),n._readyState=r.OPEN,n},r)})();var P=(e=>(e[e.openWebsocket=0]="openWebsocket",e[e.socketMsg=1]="socketMsg",e[e.outgoingHttpReq=2]="outgoingHttpReq",e[e.incomingHttpReq=3]="incomingHttpReq",e))(P||{});let S=!0;const y={};let d=null;function I(e){d=e}const _=e=>e.startsWith(b)||!S;o.allowNewSocket=e=>(console.log("Checking ws url: ",e),_(e)?(console.log("Proxying ws url: ",e),!1):!0);o.modifyUrl=e=>(e=e.toString(),_(e)&&(e=e.substring(b.length)),console.log("modifyUrl: ",e),e);o.afterInit=e=>{const r=e.url;return e.isReal||(y[r]=e,setTimeout(()=>{o.triggerOnOpen(e),v(r)},1)),e};o.beforeSend=(e,r,t)=>t.isReal?e:(console.log("beforeSend: ",t.isReal,t.url,e),N(r,new Uint8Array(e)),null);function v(e){const r={type:0,url:e};console.log("Sending openWebsocket msg Thru Proxy",r),d&&d(p(JSON.stringify(r)))}function N(e,r){const t=new Uint8Array(r),c={type:1,url:e,body:new Array(...t)};console.log("Sending Data Thru Proxy",c),d&&d(p(JSON.stringify(c)))}function L(e){const r=JSON.parse(h(e));if(r.type===1){const t=y[r.url],c=new Uint8Array(r.body);console.log("Received Proxy Message",r,c),t&&o.triggerOnMessage(t,c)}}export{h as D,p as E,R as L,b as P,C as a,T as b,w as c,P as p,L as r,I as s};
//# sourceMappingURL=proxy-9225cf57.js.map
